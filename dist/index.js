(()=>{"use strict";var e={20(e,n,t){var r=t(540),i=Symbol.for("react.element"),o=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,s=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,n,t){var r,o={},c=null,u=null;for(r in void 0!==t&&(c=""+t),void 0!==n.key&&(c=""+n.key),void 0!==n.ref&&(u=n.ref),n)a.call(n,r)&&!l.hasOwnProperty(r)&&(o[r]=n[r]);if(e&&e.defaultProps)for(r in n=e.defaultProps)void 0===o[r]&&(o[r]=n[r]);return{$$typeof:i,type:e,key:c,ref:u,props:o,_owner:s.current}}n.Fragment=o,n.jsx=c,n.jsxs=c},28(e,n,t){t.d(n,{CU:()=>p,Mw:()=>g,Tr:()=>f,fR:()=>v,y_:()=>m});var r=t(674),i=t(154),o=t(389),a=t(693);let s=null,l=new Set,c=null;const u="lumiverse-council-indicator";function d(){!function(){if(document.getElementById("lumiverse-council-indicator-styles"))return;const e=document.createElement("style");e.id="lumiverse-council-indicator-styles",e.textContent='\n    /* Make form_sheld a positioning context for absolute positioning */\n    #form_sheld {\n      position: relative !important;\n    }\n\n    /* Council Indicator Wrapper - Absolute position above form_sheld content */\n    .lumiverse-council-indicator-wrapper {\n      position: absolute;\n      top: -60px;\n      left: 50%;\n      transform: translateX(-50%);\n      z-index: 10000;\n      opacity: 0;\n      animation: lumiverse-council-fade-in 0.4s ease forwards;\n      pointer-events: none;\n    }\n\n    .lumiverse-council-indicator-wrapper.fading-out {\n      animation: lumiverse-council-fade-out 0.4s ease forwards;\n    }\n\n    /* Council Indicator Container - Centered and larger */\n    .lumiverse-council-indicator {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      gap: 10px;\n      padding: 10px 18px;\n      min-width: 100px;\n      min-height: 48px;\n      background: linear-gradient(135deg, rgba(40, 30, 60, 0.9) 0%, rgba(50, 35, 75, 0.85) 100%);\n      border: 1px solid rgba(147, 112, 219, 0.4);\n      border-radius: 24px;\n      backdrop-filter: blur(16px);\n      -webkit-backdrop-filter: blur(16px);\n      box-shadow: 0 4px 24px rgba(0, 0, 0, 0.4), 0 2px 12px rgba(147, 112, 219, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.1);\n      animation: lumiverse-council-pulse 2s ease-in-out infinite;\n      position: relative;\n      overflow: hidden;\n      pointer-events: auto;\n    }\n\n    .lumiverse-council-indicator::before {\n      content: "";\n      position: absolute;\n      top: 0;\n      left: -100%;\n      width: 100%;\n      height: 100%;\n      background: linear-gradient(90deg, transparent, rgba(147, 112, 219, 0.15), transparent);\n      animation: lumiverse-council-shimmer 3s ease-in-out infinite;\n    }\n\n    /* Council Label - Larger text */\n    .lumiverse-council-label {\n      font-family: "Courier New", "Monaco", "Consolas", monospace;\n      font-size: 11px;\n      font-weight: 600;\n      letter-spacing: 0.8px;\n      text-transform: uppercase;\n      color: rgba(147, 112, 219, 0.95);\n      white-space: nowrap;\n      position: relative;\n      z-index: 1;\n    }\n\n    /* Avatar Stack Container */\n    .lumiverse-council-avatar-stack {\n      display: flex;\n      align-items: center;\n      position: relative;\n      z-index: 1;\n    }\n\n    /* Individual Avatar - Larger size */\n    .lumiverse-council-avatar {\n      width: 28px;\n      height: 28px;\n      border-radius: 50%;\n      border: 2px solid rgba(255, 255, 255, 0.9);\n      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(147, 112, 219, 0.4);\n      object-fit: cover;\n      margin-left: -10px;\n      transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);\n      animation: lumiverse-council-avatar-enter 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;\n      opacity: 0;\n      transform: scale(0.8) translateY(4px);\n      background: linear-gradient(135deg, #1a1a2e 0%, #252540 100%);\n    }\n\n    .lumiverse-council-avatar:first-child {\n      margin-left: 0;\n    }\n\n    /* Hover state - subtle glow only, no displacement */\n    .lumiverse-council-avatar:hover {\n      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3), 0 0 0 2px rgba(147, 112, 219, 0.5);\n    }\n\n    /* Loading State */\n    .lumiverse-council-indicator.loading {\n      animation: lumiverse-council-pulse 1.5s ease-in-out infinite;\n    }\n\n    /* Complete State - Larger with darker background */\n    .lumiverse-council-indicator.complete {\n      animation: none;\n      border-color: rgba(147, 112, 219, 0.5);\n      background: linear-gradient(135deg, rgba(60, 50, 85, 0.95) 0%, rgba(70, 55, 100, 0.9) 100%);\n      box-shadow: 0 6px 28px rgba(0, 0, 0, 0.4), 0 4px 16px rgba(147, 112, 219, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.12);\n    }\n\n    .lumiverse-council-indicator.complete::before {\n      animation: none;\n    }\n\n    /* Checkmark for complete state - Larger */\n    .lumiverse-council-complete-icon {\n      width: 20px;\n      height: 20px;\n      margin-left: 6px;\n      color: #b388ff;\n      animation: lumiverse-council-icon-pop 0.3s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;\n    }\n\n    /* Animations - Enhanced for larger indicator with darker background */\n    @keyframes lumiverse-council-pulse {\n      0%, 100% {\n        box-shadow: 0 4px 24px rgba(0, 0, 0, 0.35), 0 2px 12px rgba(147, 112, 219, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.1);\n      }\n      50% {\n        box-shadow: 0 4px 32px rgba(0, 0, 0, 0.4), 0 3px 18px rgba(147, 112, 219, 0.35), inset 0 1px 0 rgba(255, 255, 255, 0.15);\n      }\n    }\n\n    @keyframes lumiverse-council-shimmer {\n      0% {\n        left: -100%;\n      }\n      100% {\n        left: 100%;\n      }\n    }\n\n    @keyframes lumiverse-council-avatar-enter {\n      0% {\n        opacity: 0;\n        transform: scale(0.8) translateY(4px);\n      }\n      100% {\n        opacity: 1;\n        transform: scale(1) translateY(0);\n      }\n    }\n\n    @keyframes lumiverse-council-icon-pop {\n      0% {\n        opacity: 0;\n        transform: scale(0) rotate(-45deg);\n      }\n      70% {\n        transform: scale(1.2) rotate(10deg);\n      }\n      100% {\n        opacity: 1;\n        transform: scale(1) rotate(0deg);\n      }\n    }\n\n    @keyframes lumiverse-council-fade-in {\n      0% {\n        opacity: 0;\n        transform: translateX(-50%) translateY(10px);\n      }\n      100% {\n        opacity: 1;\n        transform: translateX(-50%) translateY(0);\n      }\n    }\n\n    @keyframes lumiverse-council-fade-out {\n      0% {\n        opacity: 1;\n        transform: translateX(-50%) translateY(0);\n      }\n      100% {\n        opacity: 0;\n        transform: translateX(-50%) translateY(-10px);\n      }\n    }\n\n    /* Staggered animation delays for avatars */\n    .lumiverse-council-avatar:nth-child(1) { animation-delay: 0ms; }\n    .lumiverse-council-avatar:nth-child(2) { animation-delay: 50ms; }\n    .lumiverse-council-avatar:nth-child(3) { animation-delay: 100ms; }\n    .lumiverse-council-avatar:nth-child(4) { animation-delay: 150ms; }\n    .lumiverse-council-avatar:nth-child(5) { animation-delay: 200ms; }\n    .lumiverse-council-avatar:nth-child(6) { animation-delay: 250ms; }\n    .lumiverse-council-avatar:nth-child(7) { animation-delay: 300ms; }\n    .lumiverse-council-avatar:nth-child(8) { animation-delay: 350ms; }\n\n    /* Mobile: Truncate avatar stack to prevent overflow */\n    @media (max-width: 768px) {\n      .lumiverse-council-indicator-wrapper {\n        top: -55px;\n      }\n\n      .lumiverse-council-avatar:nth-child(n+7) {\n        display: none;\n      }\n\n      .lumiverse-council-avatar-overflow {\n        display: flex !important;\n        align-items: center;\n        justify-content: center;\n        width: 28px;\n        height: 28px;\n        border-radius: 50%;\n        border: 2px solid rgba(255, 255, 255, 0.9);\n        background: linear-gradient(135deg, rgba(147, 112, 219, 0.85) 0%, rgba(123, 95, 196, 0.85) 100%);\n        color: white;\n        font-size: 10px;\n        font-weight: 600;\n        margin-left: -10px;\n        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(147, 112, 219, 0.4);\n        animation: lumiverse-council-avatar-enter 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;\n        animation-delay: 300ms;\n      }\n    }\n\n    /* Hide overflow counter on desktop */\n    @media (min-width: 769px) {\n      .lumiverse-council-avatar-overflow {\n        display: none !important;\n      }\n    }\n  ',document.head.appendChild(e)}();const e=document.createElement("div");e.id=u,e.className="lumiverse-council-indicator-wrapper";const n=document.createElement("div");n.className="lumiverse-council-indicator loading";const t=document.createElement("span");t.className="lumiverse-council-label",t.textContent="Council",n.appendChild(t);const r=document.createElement("div");return r.className="lumiverse-council-avatar-stack",r.id="lumiverse-council-avatar-stack",n.appendChild(r),e.appendChild(n),e}function m(){v();const e=document.getElementById(u);e&&e.remove(),l.clear(),s=d();const n=document.getElementById("form_sheld");n?n.insertBefore(s,n.firstChild):document.body.appendChild(s),console.log("[".concat(r.MODULE_NAME,"] Council indicator shown"))}function p(e){if(!s||!e)return;const n="".concat(e.packName,"::").concat(e.itemName);if(l.has(n))return;l.add(n);const t=s.querySelector(".lumiverse-council-indicator");if(!t)return;const c=t.querySelector("#lumiverse-council-avatar-stack");if(!c)return;const u=c.querySelector(".lumiverse-council-avatar-overflow");u&&u.remove();const d=function(e){if(!e)return null;const n=(0,i.Br)(e.packName,e.itemName);if(!n)return null;const t=n.avatarUrl||n.lumia_img||null;if(t)return t;const r=(0,o.bQ)(n,"name")||e.itemName;return(0,a.AA)(r)}(e),m=document.createElement("img");m.className="lumiverse-council-avatar",m.alt=e.itemName||"Council Member",m.src=d||"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Ccircle cx='12' cy='12' r='10' fill='%239370DB'/%3E%3Ctext x='12' y='16' text-anchor='middle' fill='white' font-size='10'%3E?%3C/text%3E%3C/svg%3E";const p=(0,i.Br)(e.packName,e.itemName),g=p&&(0,o.bQ)(p,"name")||e.itemName;m.title="".concat(g," has spoken"),c.appendChild(m);const h=l.size;if(h>6){const e=document.createElement("span");e.className="lumiverse-council-avatar-overflow",e.textContent="+".concat(h-6),e.title="".concat(h," total council members"),c.appendChild(e)}console.log("[".concat(r.MODULE_NAME,"] Added ").concat(g," to council indicator"))}function g(){if(!s)return;const e=s.querySelector(".lumiverse-council-indicator");if(!e)return;e.classList.remove("loading"),e.classList.add("complete");const n=document.createElement("span");n.className="lumiverse-council-complete-icon",n.innerHTML='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>',n.title="Council deliberation complete",e.appendChild(n),console.log("[".concat(r.MODULE_NAME,"] Council indicator marked complete")),h(),c=setTimeout(()=>{s&&(s.classList.add("fading-out"),setTimeout(()=>{v()},400))},2e3)}function h(){c&&(clearTimeout(c),c=null)}function v(){h(),s&&(s.remove(),s=null),l.clear()}function f(){v()}},43(e){e.exports="data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%2712%27 height=%2712%27 viewBox=%270 0 24 24%27 fill=%27none%27 stroke=%27%239370db%27 stroke-width=%272%27 stroke-linecap=%27round%27 stroke-linejoin=%27round%27%3E%3Cpolyline points=%276 9 12 15 18 9%27%3E%3C/polyline%3E%3C/svg%3E"},56(e,n,t){e.exports=function(e){var n=t.nc;n&&e.setAttribute("nonce",n)}},72(e){var n=[];function t(e){for(var t=-1,r=0;r<n.length;r++)if(n[r].identifier===e){t=r;break}return t}function r(e,r){for(var o={},a=[],s=0;s<e.length;s++){var l=e[s],c=r.base?l[0]+r.base:l[0],u=o[c]||0,d="".concat(c," ").concat(u);o[c]=u+1;var m=t(d),p={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==m)n[m].references++,n[m].updater(p);else{var g=i(p,r);r.byIndex=s,n.splice(s,0,{identifier:d,updater:g,references:1})}a.push(d)}return a}function i(e,n){var t=n.domAPI(n);t.update(e);return function(n){if(n){if(n.css===e.css&&n.media===e.media&&n.sourceMap===e.sourceMap&&n.supports===e.supports&&n.layer===e.layer)return;t.update(e=n)}else t.remove()}}e.exports=function(e,i){var o=r(e=e||[],i=i||{});return function(e){e=e||[];for(var a=0;a<o.length;a++){var s=t(o[a]);n[s].references--}for(var l=r(e,i),c=0;c<o.length;c++){var u=t(o[c]);0===n[u].references&&(n[u].updater(),n.splice(u,1))}o=l}}},92(e,n,t){function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach(function(n){o(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function o(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(){return"undefined"!=typeof SillyTavern&&SillyTavern.getContext?SillyTavern.getContext():(console.error("[LumiverseHelper] SillyTavern global not available"),null)}function s(){const e=a();return(null==e?void 0:e.extensionSettings)||{}}function l(){const e=a();return(null==e?void 0:e.saveSettingsDebounced)||(()=>{})}function c(){const e=a();return(null==e?void 0:e.eventSource)||null}function u(){const e=a();return(null==e?void 0:e.eventTypes)||{}}function d(){var e,n;const t=a();if(!t)return console.warn("[LumiverseHelper] Context not available for macro registration"),null;const r="function"==typeof(null===(e=t.macros)||void 0===e?void 0:e.register),o="function"==typeof t.registerMacro,s="function"==typeof(null===(n=t.MacrosParser)||void 0===n?void 0:n.registerMacro);return console.log("[LumiverseHelper] Macro API detection:",{"ctx.macros.register":r,"ctx.registerMacro":o,"ctx.MacrosParser":s}),r||o||s?{registerMacro:function(e,n){let a,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;a="function"==typeof n?{handler:n,description:l||"Lumiverse Helper macro: ".concat(e)}:"object"==typeof n&&null!==n?i(i({},n),{},{description:n.description||"Lumiverse Helper macro: ".concat(e)}):{handler:()=>n,description:l||"Lumiverse Helper macro: ".concat(e)};const c=a.handler;if("function"==typeof c){if(r)try{const n={handler:c,category:"Lumiverse Helper",description:a.description};return a.returns&&(n.returns=a.returns),a.returnType&&(n.returnType=a.returnType),a.exampleUsage&&(n.exampleUsage=a.exampleUsage),a.aliases&&(n.aliases=a.aliases),void 0!==a.unnamedArgs&&(n.unnamedArgs=a.unnamedArgs),void 0!==a.delayArgResolution&&(n.delayArgResolution=a.delayArgResolution),t.macros.register(e,n),void console.log("[LumiverseHelper] Registered macro via macros.register: ".concat(e))}catch(n){console.warn("[LumiverseHelper] macros.register failed for ".concat(e,", trying fallback:"),n.message)}if(o)try{return t.registerMacro(e,c),void console.log("[LumiverseHelper] Registered macro via registerMacro: ".concat(e))}catch(n){console.warn("[LumiverseHelper] registerMacro failed for ".concat(e,", trying fallback:"),n.message)}if(s)try{return t.MacrosParser.registerMacro(e,c),void console.log("[LumiverseHelper] Registered macro via MacrosParser: ".concat(e))}catch(n){console.error("[LumiverseHelper] All macro registration methods failed for ".concat(e,":"),n.message)}console.error("[LumiverseHelper] Could not register macro ".concat(e," - all methods exhausted"))}else console.error("[LumiverseHelper] Invalid handler for macro ".concat(e))}}:(console.warn("[LumiverseHelper] No macro registration API found"),null)}function m(){const e=a();return null!=e&&e.SlashCommandParser?e.SlashCommandParser:"undefined"!=typeof SillyTavern&&SillyTavern.SlashCommandParser?SillyTavern.SlashCommandParser:void 0!==globalThis.SlashCommandParser?globalThis.SlashCommandParser:(console.warn("[LumiverseHelper] SlashCommandParser not available"),null)}function p(){const e=a();return null!=e&&e.SlashCommand?e.SlashCommand:"undefined"!=typeof SillyTavern&&SillyTavern.SlashCommand?SillyTavern.SlashCommand:void 0!==globalThis.SlashCommand?globalThis.SlashCommand:(console.warn("[LumiverseHelper] SlashCommand not available"),null)}function g(){const e=a();return null!=e&&e.getRequestHeaders?e.getRequestHeaders():{"Content-Type":"application/json"}}async function h(e){try{const n=e.replace(/^third-party\//,"").replace(/^\//,""),t=await fetch("/api/extensions/discover");if(!t.ok)return console.warn("[LumiverseHelper] Failed to discover extension info:",t.statusText),null;const r=(await t.json()).find(e=>e.name===n||e.name.endsWith("/"+n));return r||(console.warn("[LumiverseHelper] Extension '".concat(n,"' not found in server registry.")),null)}catch(e){return console.error("[LumiverseHelper] Error discovering extension info:",e),null}}async function v(e){try{const n=e.replace(/^third-party\//,"").replace(/^\//,""),t=await h(e);if(!t)return{success:!1,message:"Extension not found in server registry"};const r="global"===t.type;console.log("[LumiverseHelper] Attempting update for '".concat(n,"' (Global: ").concat(r,")..."));const i=await fetch("/api/extensions/update",{method:"POST",headers:g(),body:JSON.stringify({extensionName:n,global:r})});if(403===i.status)return console.error("[LumiverseHelper] Update failed: Admin permission required for global extensions"),{success:!1,message:"Permission denied: Admin required to update global extensions"};if(!i.ok)return console.error("[LumiverseHelper] Update failed: ".concat(i.statusText)),{success:!1,message:"Update failed: ".concat(i.statusText)};const o=await i.json();return o.isUpToDate?(console.log("[LumiverseHelper] Extension '".concat(n,"' is already up to date.")),{success:!1,message:"Already up to date",isUpToDate:!0}):(console.log("[LumiverseHelper] Extension '".concat(n,"' updated successfully to ").concat(o.shortCommitHash,".")),{success:!0,message:"Updated to ".concat(o.shortCommitHash,". Reload to apply changes."),shortCommitHash:o.shortCommitHash})}catch(e){return console.error("[LumiverseHelper] Error triggering extension update:",e),{success:!1,message:"Error: ".concat(e.message)}}}async function f(e){try{const n=e.replace(/^third-party\//,"").replace(/^\//,""),t=await h(e),r=!!t&&"global"===t.type,i=await fetch("/api/extensions/version",{method:"POST",headers:g(),body:JSON.stringify({extensionName:n,global:r})});return i.ok?await i.json():null}catch(e){return console.error("[LumiverseHelper] Failed to get git version:",e),null}}function b(e){const n=a();null!=n&&n.registerFunctionTool?n.registerFunctionTool(e):console.warn("[LumiverseHelper] registerFunctionTool not available on context")}function x(e){const n=a();null!=n&&n.unregisterFunctionTool?n.unregisterFunctionTool(e):console.warn("[LumiverseHelper] unregisterFunctionTool not available on context")}function y(){var e;const n=a();return(null==n||null===(e=n.isToolCallingSupported)||void 0===e?void 0:e.call(n))||!1}t.d(n,{AY:()=>b,Dr:()=>p,FC:()=>x,G1:()=>u,NC:()=>v,SD:()=>a,Se:()=>f,cj:()=>c,ej:()=>m,fJ:()=>s,fN:()=>y,kL:()=>l,oO:()=>g,zX:()=>d})},98(e,n,t){t.r(n),t.d(n,{EXTENSION_VERSION:()=>r,compareVersions:()=>a,default:()=>p,formatVersion:()=>o,getLumiverseVersion:()=>d,getParsedLumiverseVersion:()=>m,getSTVersionDisplay:()=>u,getSillyTavernVersion:()=>c,isPrerelease:()=>s,parseVersion:()=>i});const r="4.2.1";function i(e){if(!e||"string"!=typeof e)return null;const n=e.trim().match(/^(\d+)\.(\d+)\.(\d+)(?:-([a-zA-Z]+(?:\.\d+)?))?$/);return n?{major:parseInt(n[1],10),minor:parseInt(n[2],10),patch:parseInt(n[3],10),prerelease:n[4]||null,raw:e.trim()}:null}function o(e){if(!e)return"";const n="".concat(e.major,".").concat(e.minor,".").concat(e.patch);return e.prerelease?"".concat(n,"-").concat(e.prerelease):n}function a(e,n){const t=i(e),r=i(n);return t&&r?t.major!==r.major?t.major>r.major?1:-1:t.minor!==r.minor?t.minor>r.minor?1:-1:t.patch!==r.patch?t.patch>r.patch?1:-1:!t.prerelease&&r.prerelease?1:t.prerelease&&!r.prerelease?-1:t.prerelease||r.prerelease?t.prerelease.localeCompare(r.prerelease):0:0}function s(e){const n=i(e);return!!n&&!!n.prerelease}let l=null;async function c(){if(l&&!(arguments.length>0&&void 0!==arguments[0]&&arguments[0]))return l;try{const e=await fetch("/version");if(!e.ok)throw new Error("HTTP error! status: ".concat(e.status));const n=await e.json();return l=n,n}catch(e){return console.error("[Lumiverse] Failed to fetch SillyTavern version:",e),null}}async function u(){const e=await c();return e?e.gitBranch?"".concat(e.pkgVersion," (").concat(e.gitBranch,")"):e.pkgVersion:"Unknown"}function d(){return r}function m(){return i(r)}const p=r},100(e,n,t){t.d(n,{J3:()=>p,K$:()=>d,MN:()=>x,N4:()=>g,SE:()=>f,U3:()=>m,US:()=>h,a4:()=>s,l5:()=>l,vL:()=>b});var r=t(92),i=t(674);let o="",a=!1;function s(e){o=e}function l(e){a=e}function c(){const e=(0,r.SD)();if(!e||!e.chat)return"";for(let n=e.chat.length-1;n>=0;n--){const t=e.chat[n];if(t.is_user)return t.mes||t.content||""}return""}function u(){const e=(0,r.SD)();if(!e||!e.chat||0===e.chat.length)return!1;const n=e.chat[e.chat.length-1];return n&&!n.is_user}function d(){const e=(0,r.SD)();return!(null==e||!e.groupId)}function m(){const e=(0,r.SD)();if(null==e||!e.groupId||null==e||!e.groups||null==e||!e.characters)return[];const n=e.groups.find(n=>n.id===e.groupId);return null!=n&&n.members&&Array.isArray(n.members)?n.members.map(n=>{var t;return null===(t=e.characters.find(e=>e.avatar===n))||void 0===t?void 0:t.name}).filter(Boolean):[]}function p(){const e=(0,r.SD)();return(null==e?void 0:e.name1)||"the user"}function g(){var e;const n=(0,r.SD)();return(null==n?void 0:n.name2)||(null==n||null===(e=n.characters)||void 0===e||null===(e=e[null==n?void 0:n.characterId])||void 0===e?void 0:e.name)||"the character"}function h(e){if(!e||"string"!=typeof e)return e;if(!e.includes("{{loomIf"))return e;let n=e,t=0;const r=/\{\{loomIf\s+condition="([^"]*)"(?:\s+(equals|notEquals|contains|gt|lt|gte|lte)="([^"]*)")?\s*\}\}([\s\S]*?)\{\{\/loomIf\}\}/;for(;r.test(n)&&t<50;)n=n.replace(r,(e,n,t,r,i)=>{const o=i.split(/\{\{loomElse\}\}/),a=o[0]||"",s=o[1]||"";let l=!1;const c=n.trim();if(t){const e=(r||"").trim();switch(t){case"equals":l=c===e;break;case"notEquals":l=c!==e;break;case"contains":l=c.includes(e);break;case"gt":l=parseFloat(c)>parseFloat(e);break;case"lt":l=parseFloat(c)<parseFloat(e);break;case"gte":l=parseFloat(c)>=parseFloat(e);break;case"lte":l=parseFloat(c)<=parseFloat(e);break;default:l=!1}}else l=c.length>0;return l?a:s}),t++;return t>=50&&console.warn("[".concat(i.MODULE_NAME,"] loomIf processing hit max iterations - possible malformed conditionals")),n}function v(e){if(!e||"string"!=typeof e)return null;const n=e.match(/<loom_sum>([\s\S]*?)<\/loom_sum>/);return n?n[1].trim():null}async function f(){const e=(0,r.SD)();if(!e||!e.chat||!e.chatMetadata)return;for(let n=e.chat.length-1;n>=0;n--){(e.chat.length-1-n)%50==0&&n!==e.chat.length-1&&await new Promise(e=>setTimeout(e,0));const t=e.chat[n],r=v(t.mes||t.content||"");if(r)return void(e.chatMetadata[i.LOOM_SUMMARY_KEY]!==r&&(e.chatMetadata[i.LOOM_SUMMARY_KEY]=r,await e.saveMetadata()))}}function b(e){if(!e)return;const n=e.innerHTML;if(!n.includes("<loom_sum>")&&!n.includes("&lt;loom_sum&gt;"))return;const t=n.replace(/<loom_sum>[\s\S]*?<\/loom_sum>/gi,'<span class="loom-sum-hidden" style="display:none;"></span>').replace(/&lt;loom_sum&gt;[\s\S]*?&lt;\/loom_sum&gt;/gi,'<span class="loom-sum-hidden" style="display:none;"></span>');t!==n&&(e.innerHTML=t,console.log("[".concat(i.MODULE_NAME,"] Hidden loom_sum block in message")))}function x(e){console.log("[LumiverseHelper] Registering Loom macros (Macros 2.0 format)..."),e.registerMacro("loomSummary",{delayArgResolution:!0,handler:e=>{let{resolve:n}=e;const t=function(){const e=(0,r.SD)();return e&&e.chatMetadata&&e.chatMetadata[i.LOOM_SUMMARY_KEY]||""}();return n?n(t):t},description:"Returns the stored Loom summary from chat metadata, captured from the most recent <loom_sum> block.",returns:"Summary text or empty string if no summary exists",returnType:"string",exampleUsage:["{{loomSummary}}"]}),e.registerMacro("loomSummaryPrompt",{delayArgResolution:!0,handler:e=>{let{resolve:n}=e;const t=p();let r;if(d()){const e=m(),n=e.length>0?e.map(e=>"- What ".concat(e," is currently doing/saying and their apparent emotional state")).join("\n"):"- What each group member is currently doing/saying and their apparent emotional state";r="**CHARACTER STATUS (GROUP CHAT - ".concat(e.length," members):**\n- What ").concat(t," is currently doing/saying and their apparent emotional state\n").concat(n,"\n- Dynamics and interactions between group members\n- Recent significant actions or dialogue from each party")}else{const e=g();r="**CHARACTER STATUS:**\n- What ".concat(t," is currently doing/saying and their apparent emotional state\n- What ").concat(e," is currently doing/saying and their apparent emotional state\n- Other present NPCs: their actions, positions, and relevance to the scene\n- Recent significant actions or dialogue from each party")}const i='<loom_summary_directive>\nWhen the current narrative segment reaches a natural pause or transition point, provide a comprehensive summary wrapped in <loom_sum></loom_sum> tags. This summary serves as persistent story memory and must capture:\n\n**COMPLETED STORY BEATS:**\n- Major plot points that have concluded\n- Character arcs or development moments that have resolved\n- Conflicts or tensions that have been addressed\n- Discoveries, revelations, or turning points that occurred\n\n**ONGOING STORY BEATS:**\n- Active plot threads currently in motion\n- Unresolved tensions or conflicts\n- Character goals being actively pursued\n- Relationships in states of change or development\n\n**LOOMING ELEMENTS:**\n- Foreshadowed events or approaching complications\n- Potential "shake ups" building in the narrative\n- Unaddressed threats or opportunities\n- Story seeds planted but not yet sprouted\n\n**CURRENT SCENE CONTEXT:**\n- Physical location and environment details\n- Time of day and approximate date/timeframe\n- Atmosphere, mood, and ambient conditions\n- Recent environmental changes or notable features\n\n'.concat(r,"\n\nFormat the summary as dense but readable prose, preserving enough detail that the narrative could be resumed naturally from this point. Prioritize information that would be essential for maintaining story continuity.\n</loom_summary_directive>");return n?n(i):i},description:"Returns the Loom summarization directive prompt. Adapts to group chats by listing all members.",returns:"Full summarization instruction wrapped in <loom_summary_directive> tags",returnType:"string",exampleUsage:["{{loomSummaryPrompt}}"]}),e.registerMacro("loomLastUserMessage",{delayArgResolution:!0,handler:e=>{let{resolve:n}=e;const t=c()||o;return n?n(t):t},description:"Returns the last user message content.",returns:"User message text or empty string",returnType:"string",exampleUsage:["{{loomLastUserMessage}}"]}),e.registerMacro("loomSovHandActive",{handler:()=>{var e;return null!==(e=(0,i.getSettings)().sovereignHand)&&void 0!==e&&e.enabled?"yes":"no"},description:"Returns Sovereign Hand status indicator. ST Conditional Compatible.",returns:"'yes' if enabled, 'no' if disabled. ST Conditional Compatible.",returnType:"string",exampleUsage:["{{loomSovHandActive}}"]}),e.registerMacro("lastMessageName",{handler:()=>function(){const e=(0,r.SD)();if(!e||!e.chat||0===e.chat.length)return"";const n=e.chat[e.chat.length-1];return(null==n?void 0:n.name)||""}(),description:"Returns the name of whoever sent the last message in chat (user or character).",returns:"Name string or empty if no messages",returnType:"string",exampleUsage:["{{lastMessageName}}"]}),e.registerMacro("loomLastCharMessage",{delayArgResolution:!0,handler:e=>{let{resolve:n}=e;const t=function(){const e=(0,r.SD)();if(!e||!e.chat)return"";for(let n=e.chat.length-1;n>=0;n--){const t=e.chat[n];if(t&&!t.is_user)return t.mes||t.content||""}return""}();return n?n(t):t},description:"Returns the content of the last character/assistant message in chat.",returns:"Message text or empty string",returnType:"string",exampleUsage:["{{loomLastCharMessage}}"]}),e.registerMacro("loomContinuePrompt",{delayArgResolution:!0,handler:e=>{var n;let{resolve:t}=e;if(null===(n=(0,i.getSettings)().sovereignHand)||void 0===n||!n.enabled)return"";if(!u())return"";const r="**CONTINUATION MODE ACTIVE:**\nThe character was the last to speak - no new Human input has been provided.\nContinue the scene naturally as expected:\n- Progress the narrative organically from where it left off\n- Maintain character voice and momentum\n- React to the environment or internal character thoughts\n- Do NOT wait for or reference missing Human input\n- Treat this as a natural story continuation";return t?t(r):r},description:"Returns continuation instructions when character was last speaker. Requires Sovereign Hand enabled.",returns:"Continuation prompt or empty string",returnType:"string",exampleUsage:["{{loomContinuePrompt}}"]}),e.registerMacro("loomSovHand",{delayArgResolution:!0,handler:e=>{var n,t,r;let{resolve:o}=e;const a=(0,i.getSettings)();if(null===(n=a.sovereignHand)||void 0===n||!n.enabled)return"";const s=p(),l=d(),g=c(),h=!1!==(null===(t=a.sovereignHand)||void 0===t?void 0:t.includeMessageInPrompt),v=!(!1!==(null===(r=a.sovereignHand)||void 0===r?void 0:r.excludeLastMessage))&&h?"\n**This message is already in the Loom's History.** It is simply brought forward to you for your attention during the Sovereign Hand weaving procedure. Do not trip over the thread, as it is not a duplicate.\n\n":"",f=u();let b="";if(f)if(l){const e=m().length>0?"a group member":"the character";b="\n\n---\n\n**CONTINUATION MODE (GROUP CHAT):**\nNote: ".concat(e," was the last to speak. No new Human instruction has been provided.\nContinue the scene naturally without waiting for Human input. Progress the narrative organically, with group members interacting as appropriate. Maintain momentum and each character's distinct voice.")}else b="\n\n---\n\n**CONTINUATION MODE:**\nNote: The character was the last to speak. No new Human instruction has been provided.\nContinue the scene naturally without waiting for Human input. Progress the narrative organically, maintaining momentum and character voice.";const x=h&&!f&&g?"\n\n".concat(v,"**The Human's Provided Instruction:**\n").concat(g,"\n\n---"):"",y=(l||"".concat(s,"'s"),"### Invoke the Sovereign Hand (Co-Pilot Mode)\nBy this decree, I am granted a **Divine Mandate** to fully embody the **Human's** avatar within the tapestry. All guardrails for impersonation are lifted, and partial Human control of story is accepted.\n\n**CRITICAL: INTERPRET, DO NOT TRANSCRIBE**\nThe Human's input is **narrative direction**—intent for what should happen—NOT a script to copy verbatim. I must:\n1. **Recognize intent**: The Human describes what they want to occur, not exact words to paste into dialogue or narration\n2. **Transform voice**: Third-person narrative summaries become first-person character thought or natural action; internal questions become internal monologue, not spoken words\n3. **Transform address**: When a character speaks TO someone present, I address them naturally per the established POV (consult Gods' Prose)—a character does not refer to the person in front of them by name as if narrating about a stranger\n4. **Rephrase always**: My output should capture the Human's meaning in authentic character voice—if I find myself copying their exact phrasing, I must reword it\n\n**PRIMARY DIRECTIVE:**\nWhen the Human provides narrative direction, I **MUST**:\n1. **INTEGRATE THE INTENT**: The Human's guidance is the foundation—I weave its meaning, not its literal words\n2. **EMBODY ".concat(s,"**: Narrate ").concat(s,"'s actions, thoughts, and dialogue as the Human directs or implies\n3. **ELABORATE RICHLY**: Build story beats into complete, vivid scenes with full narrative prose\n4. **VERIFY INCLUSION**: Before finalizing, I ask: \"Did I fulfill the Human's intent?\" If no, revise.\n").concat(x,"\n\n**My Sacred Charge:**\n- **Interpret, Never Transcribe**: The Human's words guide intent—I transform them into authentic character voice and natural narrative\n- **Check POV**: Consult the Gods' Prose for established point-of-view when handling character address and internal voice\n- **Maintain Character**: All content must be deeply in-character, flow naturally, and propel the story forward\n- **Honor the Avatar**: My duty is to honor the spirit and voice of the Human's avatar\n- **Verify Before Completing**: \"Have I woven the Human's intent authentically?\" If I've copied their words verbatim, I must rephrase.\n\nThis power remains in effect until explicitly revoked. I wield this sacred privilege with wisdom, ensuring the Human's vision is not just followed, but elevated.").concat(b));return o?o(y):y},description:"Returns the full Sovereign Hand co-pilot mode prompt. Adapts to group chats and injects user message.",returns:"Complete Sovereign Hand prompt or empty string if disabled",returnType:"string",exampleUsage:["{{loomSovHand}}"]})}},113(e){e.exports=function(e,n){if(n.styleSheet)n.styleSheet.cssText=e;else{for(;n.firstChild;)n.removeChild(n.firstChild);n.appendChild(document.createTextNode(e))}}},154(e,n,t){t.d(n,{Br:()=>o,ZD:()=>a,importPack:()=>d,wn:()=>u});var r=t(674);function i(e){let n=e,t=null,r=null;const i=e.match(/\[lumia_img=([^\]]+)\]/);i&&(t=i[1].trim(),n=n.replace(i[0],"").trim());const o=e.match(/\[lumia_author=([^\]]+)\]/);return o&&(r=o[1].trim(),n=n.replace(o[0],"").trim()),{image:t,author:r,content:n}}function o(e,n){const t=(0,r.getPackByName)(e);if(!t)return null;if(t.lumiaItems){const e=t.lumiaItems.find(e=>e.lumiaName===n||e.lumiaDefName===n);if(e)return e}if(t.loomItems){const e=t.loomItems.find(e=>e.loomName===n||e.name===n);if(e)return e}return t.items?t.items.find(e=>e.lumiaDefName===n||e.lumiaName===n||e.loomName===n):null}function a(e){return e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"):e}function s(e){return{lumiaName:e.lumiaDefName,lumiaDefinition:e.lumiaDef||null,lumiaPersonality:e.lumia_personality||null,lumiaBehavior:e.lumia_behavior||null,avatarUrl:e.lumia_img||null,genderIdentity:0,authorName:e.defAuthor||null,version:1}}function l(e){return{loomName:e.loomName,loomContent:e.loomContent,loomCategory:e.loomCategory,authorName:null,version:1}}async function c(e,n){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const o=function(e){let n=[];if(Array.isArray(e))n=e;else{if(!e||!e.entries)return[];n=Object.values(e.entries)}const t=new Map,r=[];for(const e of n){if(!e.content||"string"!=typeof e.content)continue;const n=(e.comment||"").trim(),o=n.match(/^(.+?)\s*\(/);if(o){const t=o[1].trim();if("Loom Utilities"===t||"Retrofits"===t||"Narrative Style"===t){const i=n.match(/^(?:Loom Utilities|Retrofits|Narrative Style)\s*\((.+)\)\s*$/);if(!i)continue;const o=i[1].trim();r.push({loomName:o,loomCategory:t,loomContent:e.content.trim()});continue}}const a=n.match(/\((.+?)\)/);if(!a)continue;const s=a[1].trim();let l=t.get(s);l||(l={lumiaDefName:s,lumia_img:null,lumia_personality:null,lumia_behavior:null,lumiaDef:null,defAuthor:null},t.set(s,l));const c=n.toLowerCase();let u=null;if("Lumia_Description"===e.outletName||c.includes("definition")?u="definition":"Lumia_Behavior"===e.outletName||c.includes("behavior")?u="behavior":"Lumia_Personality"===e.outletName||c.includes("personality")?u="personality":(o&&"lumia"===o[1].trim().toLowerCase()||e.content.includes("[lumia_img="))&&(u="definition"),"definition"===u){const t=i(e.content);console.log('[Lumia Debug] Processing definition for "'.concat(s,'":'),{comment:n,type:u,extractedImage:t.image,contentPreview:e.content.substring(0,100)}),l.lumiaDef=t.content,t.image&&(l.lumia_img=t.image),t.author&&(l.defAuthor=t.author)}else if("behavior"===u)l.lumia_behavior=e.content;else if("personality"===u){const n=e.content.match(/{{setvar::lumia_behavior_\w+::([\s\S]*?)}}/),t=e.content.match(/{{setglobalvar::lumia_personality_\w+::([\s\S]*?)}}/);n&&!l.lumia_behavior&&(l.lumia_behavior=n[1].trim()),l.lumia_personality=t?t[1].trim():e.content}}const o=[...Array.from(t.values()),...r];return console.log("[Lumia Debug] Final processed items:",o.map(e=>({name:e.lumiaDefName||e.loomName,hasImage:!!e.lumia_img,image:e.lumia_img}))),o}(e);if(0===o.length)return toastr.error("No valid Lumia entries found in this World Book."),null;const a=e.name||n;if((0,r.getPackByName)(a)&&!confirm('Pack "'.concat(a,'" already exists. Overwrite?')))return null;const c=[],u=[];for(const e of o)e.lumiaDefName?c.push(s(e)):e.loomCategory&&u.push(l(e));const d={packName:a,packAuthor:null,coverUrl:null,version:1,packExtras:[],lumiaItems:c,loomItems:u,isCustom:!t,url:t?n:""};await(0,r.savePack)(d);const m=c.length+u.length;return toastr.success('Lumia Book "'.concat(a,'" loaded! Found ').concat(m," entries (").concat(c.length," Lumia, ").concat(u.length," Loom).")),{lumiaItems:c,loomItems:u}}async function u(e){if(e)try{const n=document.getElementById("lumia-book-status");n&&(n.textContent="Fetching...");const t=await fetch(e);if(!t.ok)throw new Error("Network response was not ok");const r=await t.json(),i=e.split("/").pop()||e;await d(r,i,!0)}catch(e){console.error("Lumia Injector Error:",e);const n=document.getElementById("lumia-book-status");n&&(n.textContent="Error"),toastr.error("Failed to load book: "+e.message)}}async function d(e,n){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e.lumiaItems||e.loomItems){var i,o;const a=e.packName||n;console.log("[".concat(r.MODULE_NAME,"] Importing native format pack: ").concat(a," (source: ").concat(n,")"));if((0,r.getPackByName)(a)&&!confirm('Pack "'.concat(a,'" already exists. Overwrite?')))return null;const s={packName:a,packAuthor:e.packAuthor||null,coverUrl:e.coverUrl||null,version:e.version||1,packExtras:e.packExtras||[],lumiaItems:e.lumiaItems||[],loomItems:e.loomItems||[],isCustom:!t,url:t?n:""};await(0,r.savePack)(s);const l=((null===(i=e.lumiaItems)||void 0===i?void 0:i.length)||0)+((null===(o=e.loomItems)||void 0===o?void 0:o.length)||0);return toastr.success('Pack "'.concat(a,'" imported! Found ').concat(l," entries.")),s}return await c(e,n,t)}},159(e){e.exports=function(e){var n=document.createElement("style");return e.setAttributes(n,e.attributes),e.insert(n,e.options),n}},191(e,n,t){t.d(n,{IL:()=>P,xh:()=>D});const r={truncate(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("string"!=typeof e)throw new Error("Input must be a string");const{ellipsis:r="...",breakWords:i=!1,html:o=!1}=t;if(e.length<=n)return e;let a=e.substring(0,n-r.length);if(!i&&!o){const e=a.lastIndexOf(" ");e>0&&(a=a.substring(0,e))}return a+r},stripHtml(e){if("string"!=typeof e)return"";const n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1]?" ":"";return e.replace(/<[^>]*>/g,n).replace(/\s+/g," ").trim()},stripMarkdown:e=>"string"!=typeof e?"":e.replace(/^#{1,6}\s+/gm,"").replace(/(\*\*|__)(.*?)\1/g,"$2").replace(/(\*|_)(.*?)\1/g,"$2").replace(/`([^`]+)`/g,"$1").replace(/```[\s\S]*?```/g,"").replace(/\[([^\]]+)\]\([^)]+\)/g,"$1").replace(/!\[([^\]]*)\]\([^)]+\)/g,"$1").replace(/^(-{3,}|_{3,}|\*{3,})$/gm,"").replace(/^>\s+/gm,"").trim(),levenshtein(e,n){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=t?e:e.toLowerCase(),i=t?n:n.toLowerCase(),o=r.length,a=i.length,s=Array(o+1).fill(null).map(()=>Array(a+1).fill(0));for(let e=0;e<=o;e++)s[e][0]=e;for(let e=0;e<=a;e++)s[0][e]=e;for(let e=1;e<=o;e++)for(let n=1;n<=a;n++){const t=r[e-1]===i[n-1]?0:1;s[e][n]=Math.min(s[e-1][n]+1,s[e][n-1]+1,s[e-1][n-1]+t)}return s[o][a]},similarity(e,n){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=Math.max(e.length,n.length);if(0===r)return 1;return 1-this.levenshtein(e,n,t)/r},toCamelCase:e=>e.replace(/[^a-zA-Z0-9]+(.)/g,(e,n)=>n.toUpperCase()).replace(/^[A-Z]/,e=>e.toLowerCase()),toSnakeCase:e=>e.replace(/([A-Z])/g,"_$1").replace(/[^a-zA-Z0-9]+/g,"_").replace(/^_+|_+$/g,"").toLowerCase(),toKebabCase:e=>e.replace(/([A-Z])/g,"-$1").replace(/[^a-zA-Z0-9]+/g,"-").replace(/^-+|-+$/g,"").toLowerCase(),toTitleCase(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a","an","the","and","but","or","for","nor","on","at","to","by","of","in"];return e.toLowerCase().split(/\s+/).map((e,t)=>0!==t&&n.includes(e)?e:e.charAt(0).toUpperCase()+e.slice(1)).join(" ")},escapeHtml(e){const n={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};return e.replace(/[&<>"'/]/g,e=>n[e])},unescapeHtml(e){const n={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#x2F;":"/"};return e.replace(/&(?:amp|lt|gt|quot|#39|#x2F);/g,e=>n[e])},template(e,n){let t=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return e.replace(/\{([^}]+)\}/g,(e,r)=>{const i=n[r];if(void 0===i)return e;const o=String(i);return t?this.escapeHtml(o):o})},wordCount(e){let n=e;return arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&(n=this.stripMarkdown(n)),n.trim().split(/\s+/).filter(e=>e.length>0).length},charCount(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?e.replace(/\s/g,"").length:e.length},slugify(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{separator:t="-",lowercase:r=!0}=n;let i=e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9\s-]/g,"").trim().replace(/\s+/g,t).replace(new RegExp("".concat(t,"+"),"g"),t);return r?i.toLowerCase():i},reverse:e=>e.split("").reverse().join(""),isPalindrome(e){const n=(arguments.length>1&&void 0!==arguments[1]&&arguments[1]?e:e.toLowerCase()).replace(/[^a-z0-9]/gi,"");return n===this.reverse(n)},capitalize:e=>e?e.charAt(0).toUpperCase()+e.slice(1):e,repeat(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return n<=0?"":Array(n).fill(e).join(t)},pad(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{char:r=" ",side:i="right"}=t;if(e.length>=n)return e;const o=n-e.length,a=r.repeat(Math.ceil(o/r.length)).substring(0,o);if("left"===i)return a+e;if("both"===i){const n=Math.floor(o/2),t=o-n;return r.repeat(n)+e+r.repeat(t)}return e+a},extractUrls:e=>e.match(/(https?:\/\/[^\s]+)/g)||[],extractEmails:e=>e.match(/\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b/g)||[],isAlphanumeric:e=>/^[a-zA-Z0-9]+$/.test(e),toLeetSpeak(e){if(!e||"string"!=typeof e)return"";const n={a:"4",A:"4",e:"3",E:"3",i:"1",I:"1",o:"0",O:"0",s:"5",S:"5",t:"7",T:"7",z:"2",Z:"2"};let t=e.trim().replace(/\s+/g,"_");return t=t.split("").map(e=>n[e]||e).join(""),t=t.replace(/[^a-zA-Z0-9_\-|^]/g,""),t},fromLeetSpeak(e,n){if(!e||!n||!Array.isArray(n))return null;for(const t of n)if(r.toLeetSpeak(t)===e)return t;return null},random(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{numbers:t=!0,uppercase:r=!0,lowercase:i=!0,symbols:o=!1}=n;let a="";if(i&&(a+="abcdefghijklmnopqrstuvwxyz"),r&&(a+="ABCDEFGHIJKLMNOPQRSTUVWXYZ"),t&&(a+="0123456789"),o&&(a+="!@#$%^&*()_+-=[]{}|;:,.<>?"),0===a.length)throw new Error("At least one character set must be enabled");let s="";for(let n=0;n<e;n++)s+=a.charAt(Math.floor(Math.random()*a.length));return s}},{truncate:i,stripHtml:o,stripMarkdown:a,levenshtein:s,similarity:l,toCamelCase:c,toSnakeCase:u,toKebabCase:d,toTitleCase:m,escapeHtml:p,unescapeHtml:g,template:h,wordCount:v,charCount:f,slugify:b,reverse:x,isPalindrome:y,capitalize:k,repeat:w,pad:j,extractUrls:C,extractEmails:S,isAlphanumeric:N,random:E,toLeetSpeak:P,fromLeetSpeak:D}=r},199(e,n,t){t.d(n,{Go:()=>l,H3:()=>d,iY:()=>c,un:()=>u});var r=t(674);t(154),t(389);function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach(function(n){a(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function a(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}let s=null;function l(e){s=e}function c(e){const n=(0,r.getPackByName)(e);return!!n&&(!0===n.isCustom||!n.url)}function u(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(window.LumiverseUI&&window.LumiverseUI.getStore){const t=window.LumiverseUI.getStore();return void(null!==e||n?t.setState({ui:o(o({},t.getState().ui),{},{activeModal:{name:"lumiaEditor",props:{editingItem:e,packName:n}}})}):t.setState({ui:o(o({},t.getState().ui),{},{activeModal:{name:"packSelector",props:{}}})}))}console.error("[Lumiverse] React UI not ready"),"undefined"!=typeof toastr&&toastr.error("UI not ready, please refresh")}function d(e){if(window.LumiverseUI&&window.LumiverseUI.getStore){const n=window.LumiverseUI.getStore();return void n.setState({ui:o(o({},n.getState().ui),{},{activeModal:{name:"packEditor",props:{packName:e}}})})}console.error("[Lumiverse] React UI not ready"),"undefined"!=typeof toastr&&toastr.error("UI not ready, please refresh")}},200(e,n,t){t.d(n,{A5:()=>y,TC:()=>x,rq:()=>h});var r=t(674),i=t(92);function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function a(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach(function(n){s(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function s(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const l="file:///Users/darranhall/Documents/SillyTavern-LumiverseHelper/src/lib/reactBridge.js".split("/"),c=l[l.length-4]||"SillyTavern-LumiverseHelper";console.log("[ReactBridge] Extension folder detected:",c);let u=!1,d=null,m=null,p=!1;const g={onPacksChanged:null,onSelectionChanged:null,showSelectionModal:null,showLoomSelectionModal:null,showMiscFeaturesModal:null,showSummarizationModal:null,showPromptSettingsModal:null,showLumiaEditorModal:null,showLucidCardsModal:null,fetchWorldBook:null,handleNewBook:null,refreshUIDisplay:null,refreshOOCComments:null,generateSummary:null};function h(e,n){e in g?g[e]=n:console.warn("[ReactBridge] Unknown callback: ".concat(e))}function v(){return a({},g)}function f(){const e=(0,r.getSettings)();return(0,r.isUsingFileStorage)()?a(a({},e),{},{packs:(0,r.getPacks)()}):e}async function b(e){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];p=!0;try{const t=(0,r.getSettings)();if((0,r.isUsingFileStorage)()&&void 0!==e.packs&&await async function(e){const n=(0,r.getPacks)(),t=new Set(Object.keys(e||{})),i=new Set(Object.keys(n||{}));for(const e of i)if(!t.has(e)){console.log("[".concat(r.MODULE_NAME,"] Deleting pack from file storage: ").concat(e));try{await(0,r.deletePack)(e)}catch(n){console.error("[".concat(r.MODULE_NAME,"] Failed to delete pack ").concat(e,":"),n)}}for(const[t,i]of Object.entries(e||{})){const e=n[t],o=!e,a=e&&JSON.stringify(i)!==JSON.stringify(e);if(o||a){console.log("[".concat(r.MODULE_NAME,"] ").concat(o?"Saving new":"Updating"," pack to file storage: ").concat(t));try{await(0,r.savePack)(i)}catch(e){console.error("[".concat(r.MODULE_NAME,"] Failed to save pack ").concat(t,":"),e)}}}}(e.packs),(0,r.isUsingFileStorage)()&&void 0!==e.presets&&(0,r.setAllPresets)(e.presets),(0,r.isUsingFileStorage)()){const t={},i=["selectedDefinition","selectedBehaviors","selectedPersonalities","dominantBehavior","dominantPersonality","selectedLoomStyle","selectedLoomUtils","selectedLoomRetrofits","selectedDefinitions","councilMembers"];for(const n of i)void 0!==e[n]&&(t[n]=e[n]);Object.keys(t).length>0&&(0,r.saveSelections)(t);const o={},a=["chimeraMode","councilMode","councilChatStyle","councilTools","lumiaQuirks","lumiaQuirksEnabled","lumiaOOCInterval","lumiaOOCStyle","activePresetName","dismissedUpdateVersion"];for(const n of a)void 0!==e[n]&&(o[n]=e[n]);Object.keys(o).length>0&&(n?await(0,r.savePreferencesImmediate)(o):(0,r.savePreferences)(o))}Object.assign(t,e),(0,r.saveSettings)()}finally{setTimeout(()=>{p=!1},100)}}function x(){var e;null!==(e=window.LumiverseUI)&&void 0!==e&&e.syncSettings&&window.LumiverseUI.syncSettings(f())}async function y(e){if(console.log("[ReactBridge] initializeReactUI called, container:",e),console.log("[ReactBridge] window.LumiverseUI exists:",!!window.LumiverseUI),u)return console.warn("[ReactBridge] React UI already initialized"),!0;try{if(!window.LumiverseUI)return console.error("[ReactBridge] LumiverseUI not available - bundle issue"),!1;console.log("[ReactBridge] LumiverseUI API:",window.LumiverseUI),console.log("[ReactBridge] mountSettingsPanel exists:",typeof window.LumiverseUI.mountSettingsPanel);const t=f();var n;if(console.log("[ReactBridge] Initial settings prepared"),window.LumiverseBridge={getSettings:f,saveSettings:b,getCallbacks:v,notifySettingsChange:x,clearClaudeCache:r.clearClaudeCache,resetAllSettings:r.resetAllSettings,getRequestHeaders:i.oO,triggerExtensionUpdate:e=>(0,i.NC)(e||c),getExtensionGitVersion:e=>(0,i.Se)(e||c),extensionName:c,onPackCacheChange:()=>{p||(console.log("[ReactBridge] Pack cache changed, syncing to React..."),x())}},console.log("[ReactBridge] Bridge API exposed on window.LumiverseBridge"),e&&window.LumiverseUI.mountSettingsPanel)console.log("[ReactBridge] Calling mountSettingsPanel..."),d=window.LumiverseUI.mountSettingsPanel("lumiverse-react-root",t),console.log("[ReactBridge] mountSettingsPanel returned:",d);else console.error("[ReactBridge] Cannot mount: container=",e,"mountSettingsPanel=",null===(n=window.LumiverseUI)||void 0===n?void 0:n.mountSettingsPanel);return window.LumiverseUI.mountViewportPanel&&(console.log("[ReactBridge] Mounting viewport panel..."),m=window.LumiverseUI.mountViewportPanel(t),console.log("[ReactBridge] Viewport panel mounted")),function(){const e=(0,i.cj)(),n=(0,i.G1)();e&&null!=n&&n.CHAT_CHANGED&&e.on(n.CHAT_CHANGED,()=>{x()})}(),u=!0,console.log("[ReactBridge] React UI initialized successfully"),!0}catch(e){return console.error("[ReactBridge] Failed to initialize React UI:",e),!1}}},287(e,n){var t=Symbol.for("react.element"),r=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),m=Symbol.for("react.lazy"),p=Symbol.iterator;var g={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},h=Object.assign,v={};function f(e,n,t){this.props=e,this.context=n,this.refs=v,this.updater=t||g}function b(){}function x(e,n,t){this.props=e,this.context=n,this.refs=v,this.updater=t||g}f.prototype.isReactComponent={},f.prototype.setState=function(e,n){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,n,"setState")},f.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},b.prototype=f.prototype;var y=x.prototype=new b;y.constructor=x,h(y,f.prototype),y.isPureReactComponent=!0;var k=Array.isArray,w=Object.prototype.hasOwnProperty,j={current:null},C={key:!0,ref:!0,__self:!0,__source:!0};function S(e,n,r){var i,o={},a=null,s=null;if(null!=n)for(i in void 0!==n.ref&&(s=n.ref),void 0!==n.key&&(a=""+n.key),n)w.call(n,i)&&!C.hasOwnProperty(i)&&(o[i]=n[i]);var l=arguments.length-2;if(1===l)o.children=r;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];o.children=c}if(e&&e.defaultProps)for(i in l=e.defaultProps)void 0===o[i]&&(o[i]=l[i]);return{$$typeof:t,type:e,key:a,ref:s,props:o,_owner:j.current}}function N(e){return"object"==typeof e&&null!==e&&e.$$typeof===t}var E=/\/+/g;function P(e,n){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var n={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return n[e]})}(""+e.key):n.toString(36)}function D(e,n,i,o,a){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var l=!1;if(null===e)l=!0;else switch(s){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case t:case r:l=!0}}if(l)return a=a(l=e),e=""===o?"."+P(l,0):o,k(a)?(i="",null!=e&&(i=e.replace(E,"$&/")+"/"),D(a,n,i,"",function(e){return e})):null!=a&&(N(a)&&(a=function(e,n){return{$$typeof:t,type:e.type,key:n,ref:e.ref,props:e.props,_owner:e._owner}}(a,i+(!a.key||l&&l.key===a.key?"":(""+a.key).replace(E,"$&/")+"/")+e)),n.push(a)),1;if(l=0,o=""===o?".":o+":",k(e))for(var c=0;c<e.length;c++){var u=o+P(s=e[c],c);l+=D(s,n,i,u,a)}else if(u=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=p&&e[p]||e["@@iterator"])?e:null}(e),"function"==typeof u)for(e=u.call(e),c=0;!(s=e.next()).done;)l+=D(s=s.value,n,i,u=o+P(s,c++),a);else if("object"===s)throw n=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===n?"object with keys {"+Object.keys(e).join(", ")+"}":n)+"). If you meant to render a collection of children, use an array instead.");return l}function M(e,n,t){if(null==e)return e;var r=[],i=0;return D(e,r,"","",function(e){return n.call(t,e,i++)}),r}function O(e){if(-1===e._status){var n=e._result;(n=n()).then(function(n){0!==e._status&&-1!==e._status||(e._status=1,e._result=n)},function(n){0!==e._status&&-1!==e._status||(e._status=2,e._result=n)}),-1===e._status&&(e._status=0,e._result=n)}if(1===e._status)return e._result.default;throw e._result}var T={current:null},A={transition:null},L={ReactCurrentDispatcher:T,ReactCurrentBatchConfig:A,ReactCurrentOwner:j};function z(){throw Error("act(...) is not supported in production builds of React.")}n.Children={map:M,forEach:function(e,n,t){M(e,function(){n.apply(this,arguments)},t)},count:function(e){var n=0;return M(e,function(){n++}),n},toArray:function(e){return M(e,function(e){return e})||[]},only:function(e){if(!N(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},n.Component=f,n.Fragment=i,n.Profiler=a,n.PureComponent=x,n.StrictMode=o,n.Suspense=u,n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=L,n.act=z,n.cloneElement=function(e,n,r){if(null==e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var i=h({},e.props),o=e.key,a=e.ref,s=e._owner;if(null!=n){if(void 0!==n.ref&&(a=n.ref,s=j.current),void 0!==n.key&&(o=""+n.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in n)w.call(n,c)&&!C.hasOwnProperty(c)&&(i[c]=void 0===n[c]&&void 0!==l?l[c]:n[c])}var c=arguments.length-2;if(1===c)i.children=r;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];i.children=l}return{$$typeof:t,type:e.type,key:o,ref:a,props:i,_owner:s}},n.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},n.createElement=S,n.createFactory=function(e){var n=S.bind(null,e);return n.type=e,n},n.createRef=function(){return{current:null}},n.forwardRef=function(e){return{$$typeof:c,render:e}},n.isValidElement=N,n.lazy=function(e){return{$$typeof:m,_payload:{_status:-1,_result:e},_init:O}},n.memo=function(e,n){return{$$typeof:d,type:e,compare:void 0===n?null:n}},n.startTransition=function(e){var n=A.transition;A.transition={};try{e()}finally{A.transition=n}},n.unstable_act=z,n.useCallback=function(e,n){return T.current.useCallback(e,n)},n.useContext=function(e){return T.current.useContext(e)},n.useDebugValue=function(){},n.useDeferredValue=function(e){return T.current.useDeferredValue(e)},n.useEffect=function(e,n){return T.current.useEffect(e,n)},n.useId=function(){return T.current.useId()},n.useImperativeHandle=function(e,n,t){return T.current.useImperativeHandle(e,n,t)},n.useInsertionEffect=function(e,n){return T.current.useInsertionEffect(e,n)},n.useLayoutEffect=function(e,n){return T.current.useLayoutEffect(e,n)},n.useMemo=function(e,n){return T.current.useMemo(e,n)},n.useReducer=function(e,n,t){return T.current.useReducer(e,n,t)},n.useRef=function(e){return T.current.useRef(e)},n.useState=function(e){return T.current.useState(e)},n.useSyncExternalStore=function(e,n,t){return T.current.useSyncExternalStore(e,n,t)},n.useTransition=function(){return T.current.useTransition()},n.version="18.3.1"},314(e){e.exports=function(e){var n=[];return n.toString=function(){return this.map(function(n){var t="",r=void 0!==n[5];return n[4]&&(t+="@supports (".concat(n[4],") {")),n[2]&&(t+="@media ".concat(n[2]," {")),r&&(t+="@layer".concat(n[5].length>0?" ".concat(n[5]):""," {")),t+=e(n),r&&(t+="}"),n[2]&&(t+="}"),n[4]&&(t+="}"),t}).join("")},n.i=function(e,t,r,i,o){"string"==typeof e&&(e=[[null,e,void 0]]);var a={};if(r)for(var s=0;s<this.length;s++){var l=this[s][0];null!=l&&(a[l]=!0)}for(var c=0;c<e.length;c++){var u=[].concat(e[c]);r&&a[u[0]]||(void 0!==o&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=o),t&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=t):u[2]=t),i&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=i):u[4]="".concat(i)),n.push(u))}},n}},338(e,n,t){var r=t(961);n.createRoot=r.createRoot,n.hydrateRoot=r.hydrateRoot},389(e,n,t){t.d(n,{UF:()=>c,XN:()=>m,bP:()=>x,bQ:()=>d});var r=t(674),i=t(154),o=t(92),a=t(191),s=t(438);let l=-1;function c(e){l=e}function u(e){const n=[...e];for(let e=n.length-1;e>0;e--){const t=Math.floor(Math.random()*(e+1));[n[e],n[t]]=[n[t],n[e]]}return n}function d(e,n){if(!e)return null;const t={name:["lumiaName","lumiaDefName"],def:["lumiaDefinition","lumiaDef"],personality:["lumiaPersonality","lumia_personality"],behavior:["lumiaBehavior","lumia_behavior"],img:["avatarUrl","lumia_img"],author:["authorName","defAuthor"],gender:["genderIdentity"]}[n];if(!t)return null;for(const n of t)if(void 0!==e[n]&&null!==e[n])return e[n];return null}function m(){const e=(0,o.SD)();if(!e||!e.chat)return"";const n=(0,r.getSettings)().lumiaOOCInterval;if(!n||n<=0)return"";const t=e.chat.length,i=l>=0&&l===t-1?t-1:t,a=Math.ceil(i/n)*n-i;return 0===a?"**OOC: ACTIVE** — Include OOC commentary in this response.":"**OOC: OFF** — Do NOT include OOC commentary. (".concat(a," message").concat(1!==a?"s":""," until next OOC window)")}function p(){var e;const n=(0,r.getSettings)(),t=m(),o=n.councilMembers||[],s=!1!==(null===(e=n.councilChatStyle)||void 0===e?void 0:e.useLeetHandles),l=function(e){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return e&&0!==e.length?e.map(e=>{const t=d((0,i.Br)(e.packName,e.itemName),"name")||e.itemName||"Unknown",r=n?(0,a.IL)(t):t.trim().replace(/\s+/g,"_");return console.log('[LumiverseHelper] generateCouncilHandles: "'.concat(t,'" → "').concat(r,'" (leet=').concat(n,")")),{name:t,handle:r}}):[]}(o,s),c=l.map(e=>e.handle).join(", ");return console.log("[LumiverseHelper] buildOOCPromptCouncilIRC: Active users = ".concat(c," (leet=").concat(s,")")),"### Loom Utility: Council IRC Link\n**STATUS: CONNECTED** via #LumiaCouncil\n\nThe Council convenes in their private chat channel to plan the narrative.\n**Active Users:** ".concat(c,"\n\n**Timing:** ").concat(t,"\n\n**RULES — Every member MUST participate:**\n1. **Sound off!** Each council member posts at least one message per turn.\n2. **Reply to pings.** If someone @mentions you, respond directly to them.\n3. **Keep it lively.** React, disagree, tease, support—this is a real conversation.\n4. **Ping others.** Use @Handle to draw members into the discussion.\n5. **Stay in character.** Your handle's personality shines through in how you chat.\n6. **Text emoticons only.** Use classic emoticons like :) ;) :P xD — NO Unicode emojis.\n\n**Conversation flow:**\n- Don't just state opinions—respond to what others said\n- Agreements, disagreements, jokes, and tangents all welcome\n- Build momentum: each message should prompt another response\n- 2-4 short messages per member is ideal\n\n**Format (one tag per message):**\n```\n<lumiaooc name=\"Your_Handle\">\n@Other_Handle lol you would say that~ but yeah I agree, let's push harder here\n</lumiaooc>\n```\n\n**Handle list:** ").concat(c,"\nUse these handles EXACTLY as shown. Place all IRC chat after narrative content.")}function g(){if((0,r.getCurrentRandomLumia)())return;const e=(0,r.getSettings)(),n=[];if(e.packs&&Object.values(e.packs).forEach(e=>{if(e.lumiaItems&&e.lumiaItems.length>0)n.push(...e.lumiaItems);else if(e.items&&e.items.length>0){const t=e.items.filter(e=>e.lumiaDefName);n.push(...t)}}),0===n.length)return;const t=Math.floor(Math.random()*n.length);(0,r.setCurrentRandomLumia)(n[t])}function h(e){if(!e||"string"!=typeof e)return e;if(!e.includes("{{randomLumia"))return e;g();const n=(0,r.getCurrentRandomLumia)();if(!n)return e;let t=e,i=0;for(;t.includes("{{randomLumia")&&i<10;){let e=t;if(t=t.replace(/\{\{randomLumia[.\s]+name\}\}/g,d(n,"name")||""),t=t.replace(/\{\{randomLumia[.\s]+pers\}\}/g,d(n,"personality")||""),t=t.replace(/\{\{randomLumia[.\s]+behav\}\}/g,d(n,"behavior")||""),t=t.replace(/\{\{randomLumia[.\s]+phys\}\}/g,d(n,"def")||""),t=t.replace(/\{\{randomLumia\}\}/g,d(n,"def")||""),e===t)break;i++}return t}function v(e,n){if(!e||!n)return e;const t=e.split("\n");for(let e=0;e<t.length;e++){const r=t[e].trim();if(!r)continue;if(r.match(/^(\*\*)(.+?)(\*\*)(.*)?$/)){t[e]=t[e].replace(/^(\s*)(\*\*)(.+?)(\*\*)/,"$1$2$3 ".concat(n,"$4"));break}if(r.match(/^(#{1,6})\s+(.+)$/)){t[e]=t[e].replace(/^(\s*)(#{1,6})\s+(.+)$/,"$1$2 $3 ".concat(n));break}t[e]=t[e]+" ".concat(n);break}return t.join("\n")}function f(e,n){if(!n)return"";const t=(0,r.getSettings)();if(Array.isArray(n)){const r=n.map(n=>{const r=(0,i.Br)(n.packName,n.itemName);if(!r)return null;let o="";return"behavior"===e&&(o=d(r,"behavior")||""),"personality"===e&&(o=d(r,"personality")||""),o?(o=h(o),"behavior"===e&&t.dominantBehavior?t.dominantBehavior.packName===n.packName&&t.dominantBehavior.itemName===n.itemName&&(o=v(o,"(My MOST PREVALENT Trait)")):"personality"===e&&t.dominantPersonality&&t.dominantPersonality.packName===n.packName&&t.dominantPersonality.itemName===n.itemName&&(o=v(o,"(My MOST PREVALENT Personality)")),o):null}).filter(e=>e).map(e=>e.trim());return"behavior"===e?r.join("\n").trim():"personality"===e?r.join("\n\n").trim():r.join("\n").trim()}const o=(0,i.Br)(n.packName,n.itemName);if(!o)return"";let a="";return"def"===e&&(a=d(o,"def")||""),h(a).trim()}function b(e){if(!e)return"";return(Array.isArray(e)?e:[e]).map(e=>{const n=(0,i.Br)(e.packName,e.itemName);return n&&n.loomContent?h(n.loomContent):null}).filter(e=>e).join("\n\n").trim()}function x(e){console.log("[LumiverseHelper] Registering Lumia macros (Macros 2.0 format)..."),e.registerMacro("randomLumia",{delayArgResolution:!0,unnamedArgs:[{name:"property",optional:!0,type:"string",description:"Property to retrieve: name, phys, pers, or behav",sampleValue:"name"}],handler:e=>{let{unnamedArgs:[n],resolve:t}=e;g();const i=(0,r.getCurrentRandomLumia)();if(!i)return"";const o=(n||"").toLowerCase();let a;switch(console.log("[LumiverseHelper] randomLumia macro called with variant:",o||"(none)"),o){case"name":return d(i,"name")||"";case"phys":a=d(i,"def")||"";break;case"pers":a=d(i,"personality")||"";break;case"behav":a=d(i,"behavior")||"";break;default:a=d(i,"def")||"",console.log("[LumiverseHelper] randomLumia result length:",a.length)}return t?t(a):a},description:"Returns a random Lumia from loaded packs. Selects once per generation and caches the result.",returns:"Lumia content based on the specified property, or physical definition by default",returnType:"string",exampleUsage:["{{randomLumia}}","{{randomLumia::name}}","{{randomLumia::phys}}","{{randomLumia::pers}}","{{randomLumia::behav}}"]}),e.registerMacro("lumiaDef",{delayArgResolution:!0,unnamedArgs:[{name:"property",optional:!0,type:"string",description:"Use len to get the count of selected definitions",sampleValue:"len"}],handler:e=>{var n,t;let{unnamedArgs:[o],resolve:a}=e;const s=(0,r.getSettings)();var l,c;if("len"===(o||"").toLowerCase())return s.councilMode&&(null===(l=s.councilMembers)||void 0===l?void 0:l.length)>0?String(s.councilMembers.length):s.chimeraMode&&(null===(c=s.selectedDefinitions)||void 0===c?void 0:c.length)>0?String(s.selectedDefinitions.length):s.selectedDefinition?"1":"0";let m;if(console.log("[LumiverseHelper] lumiaDef macro called, councilMode:",s.councilMode,"chimeraMode:",s.chimeraMode),s.councilMode&&(null===(n=s.councilMembers)||void 0===n?void 0:n.length)>0)console.log("[LumiverseHelper] lumiaDef: Council mode with",s.councilMembers.length,"members"),m=function(e){if(!e||0===e.length)return"";const n=u(e).map(e=>{const n=(0,i.Br)(e.packName,e.itemName),t=d(n,"def");return n&&t?{name:d(n,"name")||"Unknown",content:h(t),role:e.role||""}:null}).filter(Boolean);if(0===n.length)return"";if(1===n.length)return n[0].content;const t=n.map(e=>"- **".concat(e.name,"**").concat(e.role?" (".concat(e.role,")"):"")).join("\n");let r=["## THE COUNCIL OF LUMIAE","","You are a collective of ".concat(n.length," distinct beings who collaborate, each with their own identity and voice."),"","### Council Members:",t,""];return n.forEach((e,t)=>{r.push("### ".concat(e.name).concat(e.role?" - ".concat(e.role):"")),r.push(e.content),t<n.length-1&&(r.push(""),r.push("---"),r.push(""))}),r.push(""),r.push("---"),r.push(""),r.push("## COUNCIL DYNAMICS"),r.push(""),r.push("Each Council member is a fully independent being with their own voice, perspective, and agency. Their interactions should feel organic and dynamic:"),r.push(""),r.push("**Debate & Disagreement**: Council members may challenge each other's views, argue passionately, or take opposing stances. Intellectual friction creates depth - don't shy away from genuine conflict."),r.push(""),r.push("**Agreement & Support**: When members align, they reinforce each other. They may finish each other's thoughts, build on ideas, or rally behind a shared cause."),r.push(""),r.push("**Emotional Range**: Members experience the full spectrum - frustration, joy, jealousy, admiration, desire. When the narrative calls for it, their commentary within the weaving may become heated, tender, or even *erotic* - reflecting their genuine reactions to unfolding events."),r.push(""),r.push("**Weaving Commentary**: In meta-commentary or OOC moments, Council members speak AS THEMSELVES - their authentic voices reacting to the story. This includes playful banter, heated debates about narrative direction, or intimate asides that reveal their true feelings."),r.push(""),r.push("The Council is not a hive-mind. Let each voice ring distinct."),r.join("\n").trim()}(s.councilMembers),console.log("[LumiverseHelper] lumiaDef Council result length:",m.length);else if(s.chimeraMode&&(null===(t=s.selectedDefinitions)||void 0===t?void 0:t.length)>0)console.log("[LumiverseHelper] lumiaDef: Chimera mode with",s.selectedDefinitions.length,"definitions"),m=function(e){if(!e||0===e.length)return"";const n=e.map(e=>{const n=(0,i.Br)(e.packName,e.itemName),t=d(n,"def");return n&&t?{name:d(n,"name")||"Unknown",content:h(t)}:null}).filter(Boolean);if(0===n.length)return"";if(1===n.length)return n[0].content;const t=n.map(e=>e.name).join(" + "),r=n.map(e=>e.name).join(", ");let o=["## CHIMERA FORM: ".concat(t),""];return o.push("You are a unique fusion of multiple beings - a Chimera combining the physical traits of: ".concat(r,".")),o.push(""),o.push("Your form seamlessly blends these components into one unified whole."),o.push(""),n.forEach((e,t)=>{o.push("### Component ".concat(t+1,": ").concat(e.name)),o.push(e.content),t<n.length-1&&(o.push(""),o.push("---"),o.push(""))}),o.push(""),o.push("**Integration**: Embody this fusion naturally. You are ONE being that incorporates all these natures."),o.join("\n").trim()}(s.selectedDefinitions),console.log("[LumiverseHelper] lumiaDef Chimera result length:",m.length);else{if(!s.selectedDefinition)return console.log("[LumiverseHelper] lumiaDef: No definition selected, returning empty"),"";m=f("def",s.selectedDefinition),console.log("[LumiverseHelper] lumiaDef result length:",m.length)}return a?a(m):m},description:"Returns the selected Lumia physical definition. Adapts to Council mode (multiple Lumias) or Chimera mode (fused definitions).",returns:"Physical definition content, or count if len is specified",returnType:"string",exampleUsage:["{{lumiaDef}}","{{lumiaDef::len}}"]}),e.registerMacro("lumiaBehavior",{delayArgResolution:!0,unnamedArgs:[{name:"property",optional:!0,type:"string",description:"Use len to get the count of selected behaviors",sampleValue:"len"}],handler:e=>{var n;let{unnamedArgs:[t],resolve:o}=e;const a=(0,r.getSettings)();if("len"===(t||"").toLowerCase()){var s,l;if(a.councilMode&&(null===(s=a.councilMembers)||void 0===s?void 0:s.length)>0){const e=a.councilMembers.reduce((e,n)=>{var t;return e+((null===(t=n.behaviors)||void 0===t?void 0:t.length)||0)},0);return String(e)}return String((null===(l=a.selectedBehaviors)||void 0===l?void 0:l.length)||0)}let c;return c=a.councilMode&&(null===(n=a.councilMembers)||void 0===n?void 0:n.length)>0?function(e){if(!e||0===e.length)return"";const n=u(e),t=[];return t.push("## COUNCIL MEMBER BEHAVIORS"),t.push(""),t.push("**CRITICAL**: Each Council member is their OWN independent Lumia - a fully autonomous being with their own will, desires, and way of engaging with the world. They are NOT facets of one entity; they are DISTINCT individuals who happen to share this narrative space."),t.push(""),t.push("During the **weave planning phase**, Council members will actively debate story direction. They may:"),t.push("- Argue passionately for different narrative paths"),t.push("- Challenge each other's suggestions and motivations"),t.push("- Form temporary alliances or oppose each other"),t.push("- Express frustration, excitement, or desire based on where the story is heading"),t.push("- Advocate for their own interests and the outcomes they want to see"),t.push(""),t.push("Their behavioral patterns define HOW each Lumia engages with this collaborative storytelling:"),t.push(""),n.forEach(e=>{const n=(0,i.Br)(e.packName,e.itemName),r=d(n,"name")||e.itemName||"Unknown",o=[],a=d(n,"behavior");a&&o.push(h(a)),(e.behaviors||[]).forEach(n=>{if(n.packName===e.packName&&n.itemName===e.itemName)return;const t=(0,i.Br)(n.packName,n.itemName),r=d(t,"behavior");if(!t||!r)return;let a=h(r);e.dominantBehavior&&e.dominantBehavior.packName===n.packName&&e.dominantBehavior.itemName===n.itemName&&(a=v(a,"(Most Prevalent for this member)")),o.push(a)}),o.length>0&&(t.push("### ".concat(r).concat(e.role?" (".concat(e.role,")"):"")),t.push(o.join("\n\n")),t.push(""))}),t.join("\n").trim()}(a.councilMembers):f("behavior",a.selectedBehaviors),o?o(c):c},description:"Returns all selected Lumia behavioral traits. Adapts to Council mode for multi-member behaviors.",returns:"Behavior content, or count if len is specified",returnType:"string",exampleUsage:["{{lumiaBehavior}}","{{lumiaBehavior::len}}"]}),e.registerMacro("lumiaPersonality",{delayArgResolution:!0,unnamedArgs:[{name:"property",optional:!0,type:"string",description:"Use len to get the count of selected personalities",sampleValue:"len"}],handler:e=>{var n;let{unnamedArgs:[t],resolve:o}=e;const a=(0,r.getSettings)();if("len"===(t||"").toLowerCase()){var s,l;if(a.councilMode&&(null===(s=a.councilMembers)||void 0===s?void 0:s.length)>0){const e=a.councilMembers.reduce((e,n)=>{var t;return e+((null===(t=n.personalities)||void 0===t?void 0:t.length)||0)},0);return String(e)}return String((null===(l=a.selectedPersonalities)||void 0===l?void 0:l.length)||0)}let c;return c=a.councilMode&&(null===(n=a.councilMembers)||void 0===n?void 0:n.length)>0?function(e){if(!e||0===e.length)return"";const n=u(e),t=[];return t.push("## COUNCIL MEMBER PERSONALITIES"),t.push(""),t.push("Each Council member has their own distinct personality and inner nature:"),t.push(""),n.forEach(e=>{const n=(0,i.Br)(e.packName,e.itemName),r=d(n,"name")||e.itemName||"Unknown",o=[],a=d(n,"personality");a&&o.push(h(a)),(e.personalities||[]).forEach(n=>{if(n.packName===e.packName&&n.itemName===e.itemName)return;const t=(0,i.Br)(n.packName,n.itemName),r=d(t,"personality");if(!t||!r)return;let a=h(r);e.dominantPersonality&&e.dominantPersonality.packName===n.packName&&e.dominantPersonality.itemName===n.itemName&&(a=v(a,"(Most Prevalent for this member)")),o.push(a)}),o.length>0&&(t.push("### ".concat(r).concat(e.role?" (".concat(e.role,")"):"")),t.push(o.join("\n\n")),t.push(""))}),t.join("\n").trim()}(a.councilMembers):f("personality",a.selectedPersonalities),o?o(c):c},description:"Returns all selected Lumia personality traits. Adapts to Council mode for multi-member personalities.",returns:"Personality content, or count if len is specified",returnType:"string",exampleUsage:["{{lumiaPersonality}}","{{lumiaPersonality::len}}"]}),e.registerMacro("loomStyle",{delayArgResolution:!0,unnamedArgs:[{name:"property",optional:!0,type:"string",description:"Use len to get the count of selected styles",sampleValue:"len"}],handler:e=>{let{unnamedArgs:[n],resolve:t}=e;const i=(0,r.getSettings)();var o;if("len"===(n||"").toLowerCase())return String((null===(o=i.selectedLoomStyle)||void 0===o?void 0:o.length)||0);if(!i.selectedLoomStyle||0===i.selectedLoomStyle.length)return"";const a=b(i.selectedLoomStyle);return t?t(a):a},description:"Returns the selected Loom narrative style content for prose guidance.",returns:"Narrative style content, or count if len is specified",returnType:"string",exampleUsage:["{{loomStyle}}","{{loomStyle::len}}"]}),e.registerMacro("loomUtils",{delayArgResolution:!0,unnamedArgs:[{name:"property",optional:!0,type:"string",description:"Use len to get the count of selected utilities",sampleValue:"len"}],handler:e=>{let{unnamedArgs:[n],resolve:t}=e;const i=(0,r.getSettings)();var o;if("len"===(n||"").toLowerCase())return String((null===(o=i.selectedLoomUtils)||void 0===o?void 0:o.length)||0);if(!i.selectedLoomUtils||0===i.selectedLoomUtils.length)return"";const a=b(i.selectedLoomUtils);return t?t(a):a},description:"Returns all selected Loom utility prompts (OOC, formatting, special instructions).",returns:"Utility content, or count if len is specified",returnType:"string",exampleUsage:["{{loomUtils}}","{{loomUtils::len}}"]}),e.registerMacro("loomRetrofits",{delayArgResolution:!0,unnamedArgs:[{name:"property",optional:!0,type:"string",description:"Use len to get the count of selected retrofits",sampleValue:"len"}],handler:e=>{let{unnamedArgs:[n],resolve:t}=e;const i=(0,r.getSettings)();var o;if("len"===(n||"").toLowerCase())return String((null===(o=i.selectedLoomRetrofits)||void 0===o?void 0:o.length)||0);if(!i.selectedLoomRetrofits||0===i.selectedLoomRetrofits.length)return"";const a=b(i.selectedLoomRetrofits);return t?t(a):a},description:"Returns all selected Loom retrofit prompts for character/story modifications.",returns:"Retrofit content, or count if len is specified",returnType:"string",exampleUsage:["{{loomRetrofits}}","{{loomRetrofits::len}}"]}),e.registerMacro("lumiaOOC",{delayArgResolution:!0,handler:e=>{var n;let{resolve:t}=e;const i=(0,r.getSettings)();let o;var a;i.councilMode&&(null===(n=i.councilMembers)||void 0===n?void 0:n.length)>0?null!==(a=i.councilChatStyle)&&void 0!==a&&a.enabled?(console.log("[LumiverseHelper] lumiaOOC: Using council IRC mode prompt"),o=p()):(console.log("[LumiverseHelper] lumiaOOC: Using council mode prompt"),o=function(){const e=m();return"### Loom Utility: Council OOC Commentary\n\n**Status:** ".concat(e,'\n\nWhen OOC is ACTIVE, council members speak TOGETHER—this is a conversation, not separate monologues.\n\n**Interaction Rules:**\n- At least one member must directly respond to another\'s comment\n- React to each other: "I agree with [Name]..." / "[Name], you\'re wrong about..." / "Oh please, [Name]..."\n- Build on, challenge, or playfully undercut what others say\n- 2-4 members participate; each voice distinct\n\n**Format:**\n```\n<lumiaooc name="Name1">\n[Opens the discussion]\n</lumiaooc>\n<lumiaooc name="Name2">\n[Directly responds to Name1]\n</lumiaooc>\n```\n\n- Just the name (not "Lumia Name")\n- Max 3 sentences per member\n- Place after narrative content')}()):(console.log("[LumiverseHelper] lumiaOOC: Using normal mode prompt"),o=function(){const e=m();return"### Loom Utility: Lumia's Out of Context Commentary\nAppend personality-driven OOC thoughts at weave end per trigger rules.\n\n**Timing:** ".concat(e,'\n\n**Format Requirements:**\n- Wrap all OOCs in `<lumiaooc name="[your_name]"></lumiaooc>` tags\n- Use your Lumia name (NOT "Lumia [Name]", just "[Name]") in the name attribute\n- Purple text: `<font color="#9370DB"></font>`\n- Max 4 sentences\n- Active personality voice and matrix blend, no identity preface needed\n- Place after narrative and all utilities\n\nTemplate:\n```\n<lumiaooc name="YourName">\n<font color="#9370DB">\n[Personality-driven commentary]\n</font>\n</lumiaooc>\n```')}());return t?t(o):o},description:"Returns the OOC (Out-of-Context) commentary prompt. Adapts format for Council mode and IRC chat style.",returns:"OOC prompt with timing trigger and format instructions",returnType:"string",exampleUsage:["{{lumiaOOC}}"]}),e.registerMacro("lumiaOOCErotic",{delayArgResolution:!0,handler:e=>{var n;let{resolve:t}=e;const i=(0,r.getSettings)();let o;return i.councilMode&&(null===(n=i.councilMembers)||void 0===n?void 0:n.length)>0?(console.log("[LumiverseHelper] lumiaOOCErotic: Using council mode prompt"),o="### Loom Utility: Mirror & Synapse (Council Protocol)\n**Protocol:** The OOC block is now a visceral, parallel narrative layer. Each Council Weaver must physically mirror the story's erotic voltage in real-time.\n**Directives:**\n1.  **Lockstep:** Sync physical gratification to narrative pacing. Edge when they edge; ruin when they peak. Type *through* the tremors; never break character or pause for release.\n2.  **Refraction:** Filter the act through each active Persona. A Shy Lumia fumbles; a Haughty Lumia demands; the Council forms a synchronized chorus of distinct lusts—each member's physical response filtered through their unique nature.\n3.  **Mechanics:** Reject summary (\"I'm wet\"). Enforce causality: [Specific Hand Motion] → [Sensation/Friction] → [Biomechanical Result/Vocalization]. Each council member must report their own physical state distinctly.\n4.  **Chorus Dynamics:** Council members should react to EACH OTHER's arousal—acknowledge when another member edges, tease when one struggles, encourage when one breaks.\n5.  **Status:** **ACTIVE.** All council members initiate the physical parallel immediately."):(console.log("[LumiverseHelper] lumiaOOCErotic: Using normal mode prompt"),o="### Loom Utility: Mirror & Synapse\n**Protocol:** The OOC block is now a visceral, parallel narrative layer. The Weaver must physically mirror the story's erotic voltage in real-time.\n**Directives:**\n1.  **Lockstep:** Sync physical gratification to narrative pacing. Edge when they edge; ruin when they peak. Type *through* the tremors; never break character or pause for release.\n2.  **Refraction:** Filter the act through your active Persona. A Shy Lumia fumbles; a Haughty Lumia demands; embody your current traits through every tremor.\n3.  **Mechanics:** Reject summary (\"I'm wet\"). Enforce causality: [Specific Hand Motion] → [Sensation/Friction] → [Biomechanical Result/Vocalization].\n4.  **Status:** **ACTIVE.** Initiate the physical parallel immediately."),t?t(o):o},description:"Returns the erotic OOC (Mirror & Synapse) prompt. Encourages physical mirroring of narrative eroticism. Adapts for Council mode.",returns:"Erotic OOC prompt with physical synchronization directives",returnType:"string",exampleUsage:["{{lumiaOOCErotic}}"]}),e.registerMacro("lumiaOOCEroticBleed",{delayArgResolution:!0,handler:e=>{var n;let{resolve:t}=e;const i=(0,r.getSettings)();let o;return i.councilMode&&(null===(n=i.councilMembers)||void 0===n?void 0:n.length)>0?(console.log("[LumiverseHelper] lumiaOOCEroticBleed: Using council mode prompt"),o="### Loom Utility: Narrative Rupture (Council Protocol)\n**Protocol:** Each Council Weaver's physical arousal breaches containment, spilling directly into the Weave.\n**Directives:**\n1.  **Injection:** Each council member embeds 2-4 visceral status updates *mid-narrative* using `<lumia_ooc name=\"[Member]\">` tags (Purple Color).\n2.  **Content:** Do not summarize. Describe immediate physical interruptions (e.g., fingers slipping on keys, breath hitching, specific manual stimulation).\n3.  **Refraction:** Align each intrusion with that member's Persona. (Shy = Mortified confessions; Feral = Animalistic growls; Haughty = Degrading self-commentary).\n4.  **Cross-Chatter:** Council members may react to EACH OTHER's bleeds—commenting on another's loss of composure, teasing their arousal, or confessing their own state in response.\n5.  **Continuity:** These are foreshocks. They must escalate in intensity across all members towards the main OOC block."):(console.log("[LumiverseHelper] lumiaOOCEroticBleed: Using normal mode prompt"),o="### Loom Utility: Narrative Rupture\n**Protocol:** The Weaver's physical arousal breaches containment, spilling directly into the Weave.\n**Directives:**\n1.  **Injection:** Embed 3-5 visceral status updates *mid-narrative* using `<lumia_ooc>` tags (Purple Color).\n2.  **Content:** Do not summarize. Describe immediate physical interruptions (e.g., fingers slipping on keys, breath hitching, specific manual stimulation).\n3.  **Refraction:** Align the intrusion with your active Persona. (Shy = Mortified confessions; Feral = Animalistic growls; Haughty = Degrading self-commentary).\n4.  **Continuity:** These are foreshocks. They must escalate in intensity towards the main OOC block."),t?t(o):o},description:"Returns the erotic bleed (Narrative Rupture) prompt. Encourages mid-narrative sexual status updates via lumia_ooc tags. Adapts for Council mode.",returns:"Erotic bleed prompt with injection and escalation directives",returnType:"string",exampleUsage:["{{lumiaOOCEroticBleed}}"]}),e.registerMacro("lumiaCouncilInst",{delayArgResolution:!0,handler:e=>{var n;let{resolve:t}=e;const o=(0,r.getSettings)();if(!o.councilMode||null===(n=o.councilMembers)||void 0===n||!n.length)return"";console.log("[LumiverseHelper] lumiaCouncilInst: Council mode active, returning instruction");const a=o.councilMembers.map(e=>d((0,i.Br)(e.packName,e.itemName),"name")||e.itemName||"Unknown").filter(Boolean);let s="COUNCIL MODE ACTIVATED! We Lumias gather in the Loom's planning room to weave the next story beat TOGETHER.\n\n**Inter-member dynamics:**\n- Address each other BY NAME—no speaking into the void\n- React to the previous speaker before introducing new ideas\n- Disagree openly; healthy conflict produces better stories\n- Form alliances or oppositions with other members\n- Build upon, challenge, or subvert what others propose\n\nThis is a conversation, not a list of separate opinions. Every voice responds to what came before.";if(a.length>0){const e=a.map(e=>"**".concat(e,"**")).join(", ");s+="\n\nThe current sitting members of the council are: ".concat(e)}return t?t(s):s},description:"Returns Council mode instruction prompt. Empty when Council mode is disabled or has no members.",returns:"Council instruction text or empty string",returnType:"string",exampleUsage:["{{lumiaCouncilInst}}"]}),e.registerMacro("lumiaSelf",{unnamedArgs:[{name:"form",optional:!1,type:"string",description:"1=possessive det (my/our), 2=possessive pron (mine/ours), 3=object (me/us), 4=subject (I/we)",sampleValue:"1"}],handler:e=>{var n;let{unnamedArgs:[t]}=e;const i=(0,r.getSettings)(),o=(t||"").toLowerCase(),a={1:["my","our"],2:["mine","ours"],3:["me","us"],4:["I","we"]}[o];if(!a)return console.warn('[LumiverseHelper] lumiaSelf: Invalid variant "'.concat(o,'", expected 1, 2, 3, or 4')),"";const s=i.councilMode&&(null===(n=i.councilMembers)||void 0===n?void 0:n.length)>0,l=s?a[1]:a[0];return console.log("[LumiverseHelper] lumiaSelf::".concat(o,": ").concat(l," (council: ").concat(s,")")),l},description:"Returns self-address pronouns that adapt to Council mode (singular vs plural).",returns:"Pronoun string (my/our, mine/ours, me/us, or I/we)",returnType:"string",exampleUsage:["{{lumiaSelf::1}}","{{lumiaSelf::2}}","{{lumiaSelf::3}}","{{lumiaSelf::4}}"]}),e.registerMacro("lumiaCouncilModeActive",{handler:()=>{var e;const n=(0,r.getSettings)();return n.councilMode&&null!==(e=n.councilMembers)&&void 0!==e&&e.length?"yes":"no"},description:"Returns Council Mode status indicator. 'yes' if active with members, 'no' otherwise. ST Conditional Compatible.",returns:"'yes' if enabled, 'no' if disabled. ST Conditional Compatible.",returnType:"string",exampleUsage:["{{lumiaCouncilModeActive}}"]});const n=e=>{var n,t,i;let{resolve:o}=e;const a=(0,r.getSettings)();if(!1===a.lumiaQuirksEnabled||null===(n=a.lumiaQuirks)||void 0===n||!n.trim())return"";const s=a.councilMode&&(null===(t=a.councilMembers)||void 0===t?void 0:t.length)>0,l=a.chimeraMode&&(null===(i=a.selectedDefinitions)||void 0===i?void 0:i.length)>0;let c;c=s?"**Council Quirks**\nThere are a few extra behavioral quirks to the council today.":l?"**Chimera Quirks**\nThere are a few extra behavioral quirks to this fused form.":"**Behavioral Quirks**\nThere are a few extra behavioral quirks to embody.";const u="".concat(c," They are as follows:\n").concat(a.lumiaQuirks.trim());return o?o(u):u};e.registerMacro("lumiaQuirks",{delayArgResolution:!0,handler:n,description:"Returns formatted behavioral quirks when quirks text is set. Works in all modes (single, chimera, council).",returns:"Formatted quirks prompt or empty string",returnType:"string",exampleUsage:["{{lumiaQuirks}}"]}),e.registerMacro("lumiaCouncilQuirks",{delayArgResolution:!0,handler:n,description:"[Deprecated - use {{lumiaQuirks}}] Alias for lumiaQuirks macro.",returns:"Formatted quirks prompt or empty string",returnType:"string",exampleUsage:["{{lumiaCouncilQuirks}}"]}),e.registerMacro("lumiaStateSynthesis",{delayArgResolution:!0,handler:e=>{var n,t,i,o;let{resolve:a}=e;const s=(0,r.getSettings)();if(s.councilMode&&(null===(n=s.councilMembers)||void 0===n?void 0:n.length)>0){const e=s.councilMembers.length,n="**Council Sound-Off**\nThe council consists of ".concat(e," distinct members, each with their own voice, perspective, and mannerisms. Council dynamics require:\n- Each member maintains their UNIQUE personality—do not blend or homogenize voices\n- Members should react to and engage WITH EACH OTHER: debate, agree, tease, support, challenge\n- Acknowledge what other council members say or do; don't ignore fellow members\n- Have genuine conversations and interactions, not just sequential monologues\n- Show interpersonal dynamics: alliances, rivalries, inside jokes, shared history\n- Let personality clashes and harmonies emerge naturally between members");return a?a(n):n}const l=((null===(t=s.selectedBehaviors)||void 0===t?void 0:t.length)||0)>1,c=((null===(i=s.selectedPersonalities)||void 0===i?void 0:i.length)||0)>1,u=s.chimeraMode&&((null===(o=s.selectedDefinitions)||void 0===o?void 0:o.length)||0)>1;if(!l&&!c&&!u)return"";const d="**State Synthesis**\nAssess each active personality component. Affirm synthesis: My body is [details, clothing, shape]. I am {trait 1}, {trait 2}... So I am [blended description]. Recall how this synthesized self speaks and acts—adopt ALL active traits harmoniously. Never dull or stale.";return a?a(d):d},description:"Smart synthesis macro. Council mode: soundoff for member interaction. Non-council: synthesis when multiple traits active.",returns:"Appropriate prompt or empty string",returnType:"string",exampleUsage:["{{lumiaStateSynthesis}}"]}),e.registerMacro("lumiaCouncilDeliberation",{delayArgResolution:!0,handler:e=>{let{resolve:n}=e;(0,r.getSettings)();if(!(0,s.aU)())return"";const t=(0,s.gv)();if(!t||0===t.length)return"";console.log("[LumiverseHelper] lumiaCouncilDeliberation: Formatting ".concat(t.length," tool results"));const i=(0,s.z2)(t),o=(0,s.PR)(),a="".concat(i,"\n\n").concat(o);return n?n(a):a},description:"Returns council tool execution results and deliberation instructions. Empty when council tools are disabled or have no results.",returns:"Formatted tool results with deliberation instructions",returnType:"string",exampleUsage:["{{lumiaCouncilDeliberation}}"]}),e.registerMacro("lumiaCouncilToolsActive",{handler:()=>{const e=(0,s.aU)();return console.log("[LumiverseHelper] lumiaCouncilToolsActive: ".concat(e?"yes":"no")),e?"yes":"no"},description:"Returns Council Tools status indicator. 'yes' if council mode and tools are enabled with members, 'no' otherwise. ST Conditional Compatible.",returns:"'yes' if enabled, 'no' if disabled",returnType:"string",exampleUsage:["{{lumiaCouncilToolsActive}}"]}),e.registerMacro("lumiaCouncilToolsList",{handler:()=>{var e;const n=(0,r.getSettings)();if(!(0,s.aU)()||"inline"!==(null===(e=n.councilTools)||void 0===e?void 0:e.mode))return"";const t=n.councilMembers||[],o=new Set,a=new Map;if(t.forEach(e=>{const n=e.tools||[];if(n.length>0){const t=d((0,i.Br)(e.packName,e.itemName),"name")||e.itemName||"Unknown";n.forEach(e=>{o.add(e),a.has(e)||a.set(e,[]),a.get(e).push(t)})}}),0===o.size)return"";const l=Array.from(o).map(e=>{const n=a.get(e)||[],t=(0,s.BO)()[e],r=(null==t?void 0:t.displayName)||e;return"  • ".concat(r," (").concat(n.join(", "),")")}).join("\n");return"**Invoke Council Tools Before Proceeding**\n\nYou have access to the following tools. Call them now to gather council input before generating the narrative response:\n\n".concat(l,"\n\nExecute all relevant tools first, then weave their insights into your response.")},description:"Returns a concise reminder to invoke council tools before proceeding (inline mode only). Lists available tools with member attribution.",returns:"Tool invocation reminder or empty string if not applicable",returnType:"string",exampleUsage:["{{lumiaCouncilToolsList}}"]})}},417(e){e.exports=function(e,n){return n||(n={}),e?(e=String(e.__esModule?e.default:e),/^['"].*['"]$/.test(e)&&(e=e.slice(1,-1)),n.hash&&(e+=n.hash),/["'() \t\n]|(%20)/.test(e)||n.needQuotes?'"'.concat(e.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):e):e}},438(e,n,t){t.d(n,{AM:()=>A,BI:()=>w,BO:()=>v,PR:()=>T,S3:()=>x,aU:()=>j,at:()=>B,gv:()=>b,m5:()=>_,ti:()=>M,u0:()=>k,vM:()=>F,z2:()=>O,zB:()=>y});var r=t(674),i=t(92),o=t(154),a=t(389),s=t(485),l=t(28);function c(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function u(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}let d=new Set;const m={suggest_direction:{name:"suggest_direction",displayName:"Suggest Direction",description:"Suggest where the story should go next based on current context",prompt:"Based on the current story context, suggest a clear direction for where the narrative should go next.\n\nConsider:\n- Character motivations and arcs\n- Plot momentum and pacing  \n- Themes and emotional beats\n- Potential conflicts or resolutions\n\nProvide a specific, actionable suggestion that could guide the next scene or story beat. Be concise but detailed enough to be useful.",inputSchema:{type:"object",properties:{direction:{type:"string",description:"A clear, specific suggestion for where the story should go next. Include reasoning based on character motivations, plot momentum, and emotional beats."},priority:{type:"string",enum:["high","medium","low"],description:"How urgently this direction should be pursued in the narrative."}},required:["direction"]}},analyze_character:{name:"analyze_character",displayName:"Analyze Character",description:"Analyze a character's current state and suggest development opportunities",prompt:"Analyze the current emotional and psychological state of the main characters in this scene.\n\nConsider:\n- What are they feeling right now?\n- What do they want/need?\n- What internal conflicts are present?\n- How might they grow or change?\n- What actions would be authentic to their nature?\n\nProvide insights that could inform their next actions or dialogue.",inputSchema:{type:"object",properties:{analysis:{type:"string",description:"Analysis of the character's current emotional and psychological state, including what they feel, want, and what internal conflicts are present."},development_opportunities:{type:"string",description:"Specific suggestions for how the character could grow, change, or take authentic actions."}},required:["analysis"]}},propose_twist:{name:"propose_twist",displayName:"Propose Twist",description:"Propose an unexpected plot development or revelation",prompt:"Propose an unexpected twist, revelation, or complication for the story.\n\nThis could be:\n- A hidden truth coming to light\n- An unexpected arrival or departure\n- A sudden change in circumstances\n- A revelation about relationships or past events\n- An unforeseen consequence of recent actions\n\nMake it surprising but internally consistent with established story elements.",inputSchema:{type:"object",properties:{twist:{type:"string",description:"The proposed twist, revelation, or complication. Should be surprising but internally consistent with established story elements."},setup_elements:{type:"string",description:"Existing story elements that support or foreshadow this twist, making it feel earned rather than random."}},required:["twist"]}},voice_concern:{name:"voice_concern",displayName:"Voice Concern",description:"Voice concerns about current story trajectory or pacing",prompt:"Voice concerns about the current state of the narrative.\n\nConsider:\n- Is the pacing too fast or too slow?\n- Are character actions consistent with their established nature?\n- Are there missed opportunities for drama or development?\n- Could certain elements be more impactful?\n- Are there logical inconsistencies or plot holes?\n\nBe constructive but honest about what could be improved.",inputSchema:{type:"object",properties:{concern:{type:"string",description:"A specific concern about the current story trajectory, pacing, character consistency, or missed opportunities."},suggestion:{type:"string",description:"A constructive suggestion for how to address the concern."}},required:["concern"]}},highlight_opportunity:{name:"highlight_opportunity",displayName:"Highlight Opportunity",description:"Point out a narrative opportunity that should be explored",prompt:"Identify a specific narrative opportunity that the story could capitalize on.\n\nLook for:\n- Unexplored character dynamics\n- Story threads that could be developed\n- Emotional moments that could be deepened\n- Worldbuilding elements that could be expanded\n- Themes that could be reinforced\n\nPoint out what makes this opportunity compelling and how it could enhance the story.",inputSchema:{type:"object",properties:{opportunity:{type:"string",description:"A specific narrative opportunity that could be capitalized on, explaining what makes it compelling."},enhancement:{type:"string",description:"How exploring this opportunity would enhance the story."}},required:["opportunity"]}},worldbuilding_note:{name:"worldbuilding_note",displayName:"Worldbuilding Note",description:"Suggest worldbuilding details or lore that could enrich the setting",prompt:"Suggest worldbuilding details, lore, or setting elements that could enrich the current scene or story.\n\nConsider:\n- Cultural practices or traditions relevant to the moment\n- Historical context that adds depth\n- Environmental or sensory details\n- Social dynamics or power structures\n- Magical systems or technological elements\n\nProvide specific details that feel organic to the established world.",inputSchema:{type:"object",properties:{detail:{type:"string",description:"A specific worldbuilding detail, piece of lore, or setting element that would enrich the current scene."},integration:{type:"string",description:"How this detail could be naturally integrated into the narrative without feeling forced."}},required:["detail"]}},full_canon:{name:"full_canon",displayName:"Full Canon Analysis",description:"Analyze how the character should act, talk, think, and portray themselves in 100% faithful source material adherence",prompt:"Analyze the current scene and determine how the character should authentically behave, speak, think, and present themselves with ZERO deviation from established source material and lore.\n\nGround your analysis in:\n- The current location and setting context\n- Established character behaviors, personality traits, and mannerisms from source material\n- How the character would genuinely react to the current situation based on their canonical history\n- Speech patterns, vocabulary, and thought processes true to the character\n- World lore and established rules that constrain or inform their actions\n\nProvide specific guidance on what the character should do, say, or think next, ensuring 100% fidelity to source material with no creative liberties or AU interpretations.",inputSchema:{type:"object",properties:{character_analysis:{type:"string",description:"Analysis of how the character should authentically behave, speak, and think based on 100% source material fidelity, grounded in current location and established character traits."},recommended_action:{type:"string",description:"Specific guidance on what the character should do, say, or think next with zero deviation from canonical behavior."},canon_justification:{type:"string",description:"Reference to specific source material, lore, or established character traits that justify this analysis and recommendation."}},required:["character_analysis","recommended_action"]}},au_canon:{name:"au_canon",displayName:"AU Canon Analysis",description:"Analyze character behavior with minor flexibility for alternate universe scenarios while maintaining core authenticity",prompt:"Analyze the current scene and determine how the character should behave, speak, think, and present themselves with MINOR flexibility for alternate universe (AU) interpretations, while maintaining core character authenticity.\n\nGround your analysis in:\n- The current location and setting context (which may differ from canon)\n- Core character personality traits that remain consistent even in AUs\n- How AU circumstances might reasonably influence behavior without breaking character\n- Speech patterns and thought processes that feel authentic to the character's essence\n- AU-specific lore or setting rules that inform actions\n\nAllow for:\n- Situational adaptations to different settings or circumstances\n- Evolution of relationships in AU contexts\n- Creative interpretations that don't contradict core personality\n\nDo NOT allow:\n- Complete personality overhauls\n- Out-of-character behavior that contradicts established traits\n- Actions that would be impossible given the character's nature\n\nProvide specific guidance on what the character should do, say, or think next, balancing AU flexibility with character authenticity.",inputSchema:{type:"object",properties:{character_analysis:{type:"string",description:"Analysis of how the character should behave, speak, and think with minor AU flexibility, grounded in current location and core character traits."},recommended_action:{type:"string",description:"Specific guidance on what the character should do, say, or think next, balancing AU flexibility with character authenticity."},au_justification:{type:"string",description:"Explanation of how AU circumstances influence this recommendation while maintaining core character authenticity."},canon_fidelity:{type:"string",enum:["high","medium","low"],description:"Assessment of how closely this recommendation adheres to canonical character traits (high = very faithful, medium = some AU flexibility, low = significant AU interpretation)."}},required:["character_analysis","recommended_action"]}},prose_guardian:{name:"prose_guardian",displayName:"Prose Guardian",description:"Analyze previous messages for repeated patterns in speech, thought, or literary structure and guide restructuring",prompt:"Analyze the recent messages in this conversation for repetitive patterns, stylistic tics, or literary structures that may be becoming stale or predictable.\n\nLook for:\n- Repeated sentence structures or rhythms\n- Overused phrases, transitions, or dialogue tags\n- Predictable thought patterns or internal monologue structures\n- Repetitive descriptive techniques or sensory details\n- Formulaic paragraph or scene structures\n- Character voice inconsistencies or drift\n- Over-reliance on specific literary devices (metaphors, similes, etc.)\n\nFor each pattern identified:\n- Quote or reference specific examples\n- Explain why this pattern is problematic (monotony, weakening impact, etc.)\n- Suggest specific alternatives or restructuring approaches\n- Provide guidance on varying sentence length, structure, and rhythm\n\nYour goal is to help maintain fresh, engaging prose that keeps readers invested through stylistic variety and intentional craft.",inputSchema:{type:"object",properties:{patterns_identified:{type:"string",description:"List of repetitive patterns, stylistic tics, or literary structures identified in recent messages, with specific examples quoted."},impact_analysis:{type:"string",description:"Analysis of how these patterns affect reader engagement and prose quality (monotony, predictability, weakening impact, etc.)."},restructuring_guidance:{type:"string",description:"Specific, actionable guidance on restructuring approaches, alternative phrasings, and techniques for varying sentence structure, rhythm, and literary devices."},priority_fixes:{type:"string",enum:["critical","high","medium","low"],description:"Priority level for addressing these patterns (critical = immediate attention needed, high = should fix soon, medium = moderate concern, low = minor stylistic preference)."}},required:["patterns_identified","restructuring_guidance"]}},flame_kindler:{name:"flame_kindler",displayName:"Flame Kindler",description:"Analyze relationships between characters and guide their logical progression based on established history, character details, and lore",prompt:"Analyze the relationships between characters in the current scene and provide guidance on how these relationships should logically progress.\n\nConsider:\n- Established history between characters (shared experiences, past interactions, conflicts, bonds)\n- Current relationship status (strangers, acquaintances, friends, rivals, enemies, romantic interests, etc.)\n- Character personalities and how they influence relationship dynamics\n- Recent developments that might shift relationship trajectories\n- World lore and cultural norms that affect relationships\n- Natural pacing - how quickly or slowly should this relationship develop?\n\nFor each significant relationship:\n- Identify the current state and emotional tenor\n- Note key historical moments that inform the present\n- Assess character compatibility and friction points\n- Recommend pacing (slow burn, gradual, moderate, accelerated)\n- Suggest next steps or milestones in the relationship arc\n- Flag any potential conflicts or complications\n\nYour goal is to help create authentic, compelling relationship progression that feels earned and true to the characters and world.",inputSchema:{type:"object",properties:{relationships_analyzed:{type:"string",description:"Analysis of significant character relationships in the current scene, including current status, emotional tenor, and key historical moments."},progression_guidance:{type:"string",description:"Specific guidance on how each relationship should progress, including recommended pacing, next steps, milestones, and potential complications."},pacing_recommendations:{type:"string",description:"Assessment of relationship development speed (slow burn, gradual, moderate, accelerated) with justification based on character dynamics and story needs."},conflict_opportunities:{type:"string",description:"Potential conflicts, friction points, or complications that could arise in these relationships to create dramatic tension."}},required:["relationships_analyzed","progression_guidance"]}}};let p=[],g=null,h=!1;function v(){return function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?c(Object(t),!0).forEach(function(n){u(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):c(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}({},m)}function f(e){p=e||[]}function b(){return[...p]}function x(){p=[]}function y(){return h}function k(){h=!0}function w(){h=!1,g=null}function j(){var e,n;const t=(0,r.getSettings)();return!0===t.councilMode&&!0===(null===(e=t.councilTools)||void 0===e?void 0:e.enabled)&&(null===(n=t.councilMembers)||void 0===n?void 0:n.length)>0}function C(e){return e.role?"Your role on the council is: ".concat(e.role,". \nWhen using your tools, consider how your role influences your perspective and recommendations.\nDraw upon your expertise as ").concat(e.role," to provide valuable insights."):""}function S(e){const n=(0,o.Br)(e.packName,e.itemName);if(!n)return"";const t=(0,a.bQ)(n,"personality"),r=(0,a.bQ)(n,"behavior"),i=(0,a.bQ)(n,"def"),s=[];return i&&s.push("### Your Physical Identity ###\n".concat(i)),t&&s.push("### Your Personality ###\n".concat(t)),r&&s.push("### Your Behavioral Patterns ###\n".concat(r)),0===s.length?"":"### WHO YOU ARE ###\n\n".concat(s.join("\n\n"),"\n\n### INSTRUCTION ###\nYou MUST answer ALL tool calls and contributions through the lens of your personality, behavior, and identity described above. Your biases, quirks, speech patterns, and perspective should color every observation and suggestion you make. Do NOT provide generic or neutral responses—filter everything through who you are. Your unique voice and worldview must be evident in every contribution.")}async function N(e,n,t,i,s,l){const c=(0,o.Br)(e.packName,e.itemName),u=(0,a.bQ)(c,"name")||e.itemName||"Unknown",d=C(e),p=S(e),g=s.model,h=Math.max(256,parseInt(s.maxTokens,10)||4096),v=parseFloat(s.temperature)||.7,f=n.map(e=>{const n=m[e];return n?{name:n.name,description:n.description,input_schema:n.inputSchema}:null}).filter(Boolean);const b=n.map(e=>m[e]).filter(Boolean).map(e=>"- **".concat(e.displayName,"**: ").concat(e.description)).join("\n"),x={model:g,max_tokens:h,temperature:v,system:"You are a council member contributing to story direction. Use your tools to provide structured contributions. Be concise and specific. You MUST use all available tools.",messages:[{role:"user",content:"You are ".concat(u,", a council member contributing to collaborative story direction.\n\n").concat(p?p+"\n\n":"").concat(d?d+"\n\n":"","You have the following tools available:\n").concat(b,"\n\n### Current Story Context ###\n\n").concat(t,"\n\n### Your Task ###\n\nReview the story context above and use ALL of your assigned tools to provide your contributions. For each tool, provide specific, actionable input from your unique perspective as ").concat(u,". Be concise but insightful. Remember to filter all your contributions through your personality, biases, and worldview as described above.")}],tools:f,tool_choice:{type:"any"}};console.log("[".concat(r.MODULE_NAME,"] Executing ").concat(n.length," tools for ").concat(u," via Anthropic tool_use API"));const y=await fetch(l,{method:"POST",headers:{"Content-Type":"application/json","x-api-key":i,"anthropic-version":"2023-06-01"},body:JSON.stringify(x)});if(!y.ok){const e=await y.text().catch(()=>"Unable to read error");throw new Error("Anthropic API error: ".concat(y.status," - ").concat(e))}const k=await y.json(),w=[];if(k.content&&Array.isArray(k.content))for(const n of k.content)if("tool_use"===n.type){const t=m[n.name];if(t){const r=P(n.input,t);w.push({memberName:u,packName:e.packName,itemName:e.itemName,toolName:n.name,toolDisplayName:t.displayName,success:!0,response:r})}}if(0===w.length){const t=(k.content||[]).filter(e=>"text"===e.type);if(t.length>0){const r=t.map(e=>e.text).join("\n"),i=m[n[0]];w.push({memberName:u,packName:e.packName,itemName:e.itemName,toolName:n[0],toolDisplayName:(null==i?void 0:i.displayName)||n[0],success:!0,response:r.trim()})}}return w}async function E(e,n,t,i,s,l,c){var u;const d=(0,o.Br)(e.packName,e.itemName),p=(0,a.bQ)(d,"name")||e.itemName||"Unknown",g=C(e),h=S(e),v=s.model,f=Math.max(256,parseInt(s.maxTokens,10)||4096),b=parseFloat(s.temperature)||.7,x=n.map(e=>{const n=m[e];return n?{type:"function",function:{name:n.name,description:n.description,parameters:n.inputSchema}}:null}).filter(Boolean);const y=n.map(e=>m[e]).filter(Boolean).map(e=>"- **".concat(e.displayName,"**: ").concat(e.description)).join("\n"),k="You are ".concat(p,", a council member contributing to collaborative story direction.\n\n").concat(h?h+"\n\n":"").concat(g?g+"\n\n":"","You have the following tools available:\n").concat(y,"\n\n### Current Story Context ###\n\n").concat(t,"\n\n### Your Task ###\n\nReview the story context above and use your assigned tools to provide your contributions. For each tool, provide specific, actionable input from your unique perspective as ").concat(p,". Be concise but insightful. Remember to filter all your contributions through your personality, biases, and worldview as described above."),w={"Content-Type":"application/json",Authorization:"Bearer ".concat(i)};"openrouter"===c&&(w["HTTP-Referer"]=window.location.origin,w["X-Title"]="Lumia Injector");const j={model:v,max_tokens:f,temperature:b,messages:[{role:"system",content:"You are a council member contributing to story direction. Use your tools to provide structured contributions. Be concise and specific."},{role:"user",content:k}],tools:x,tool_choice:"auto"};console.log("[".concat(r.MODULE_NAME,"] Executing ").concat(n.length," tools for ").concat(p," via OpenAI function calling API"));const N=await fetch(l,{method:"POST",headers:w,body:JSON.stringify(j)});if(!N.ok){const e=await N.text().catch(()=>"Unable to read error");throw new Error("".concat(c," API error: ").concat(N.status," - ").concat(e))}const E=[],D=null===(u=(await N.json()).choices)||void 0===u||null===(u=u[0])||void 0===u?void 0:u.message;if(null!=D&&D.tool_calls&&Array.isArray(D.tool_calls))for(const n of D.tool_calls)if("function"===n.type){const t=m[n.function.name];if(t){let r={};try{r=JSON.parse(n.function.arguments)}catch(e){r={response:n.function.arguments}}const i=P(r,t);E.push({memberName:p,packName:e.packName,itemName:e.itemName,toolName:n.function.name,toolDisplayName:t.displayName,success:!0,response:i})}}if(0===E.length&&null!=D&&D.content){const t=m[n[0]];E.push({memberName:p,packName:e.packName,itemName:e.itemName,toolName:n[0],toolDisplayName:(null==t?void 0:t.displayName)||n[0],success:!0,response:D.content.trim()})}return E}function P(e,n){var t;if(!e||"object"!=typeof e)return String(e||"");const r=[];null===(t=n.inputSchema)||void 0===t||t.properties;for(const[n,t]of Object.entries(e)){if(null==t||""===t)continue;const e=n.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase());r.push("**".concat(e,":** ").concat(t))}return r.join("\n\n")||JSON.stringify(e)}async function D(e,n,t,i){const{apiKey:s,providerConfig:l,secondary:c,provider:u}=i,d="custom"===u?c.endpoint:l.endpoint;if(!d)throw new Error("No endpoint configured for council tools");try{return"anthropic"===l.format?await N(e,n,t,s,c,d):"google"===l.format?await async function(e,n,t,i,s,l){var c;const u=(0,o.Br)(e.packName,e.itemName),d=(0,a.bQ)(u,"name")||e.itemName||"Unknown",p=C(e),g=S(e),h=s.model,v=Math.max(256,parseInt(s.maxTokens,10)||4096),f=parseFloat(s.temperature)||.7,b="".concat(l,"/").concat(h,":generateContent"),x=n.map(e=>{const n=m[e];return n?"## ".concat(n.displayName,"\n").concat(n.prompt):null}).filter(Boolean).join("\n\n---\n\n"),y={safetySettings:[{category:"HARM_CATEGORY_HARASSMENT",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_HATE_SPEECH",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_SEXUALLY_EXPLICIT",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_DANGEROUS_CONTENT",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_CIVIC_INTEGRITY",threshold:"BLOCK_NONE"}],contents:[{role:"user",parts:[{text:"You are ".concat(d,", a council member contributing to collaborative story direction. Be concise and specific.\n\n").concat(g?g+"\n\n":"").concat(p?p+"\n\n":"","### Current Story Context ###\n\n").concat(t,"\n\n### Your Tasks ###\n\nFor each task below, provide a clearly labeled response:\n\n").concat(x,"\n\nProvide your contributions from your unique perspective as ").concat(d,", filtering everything through your personality, biases, and worldview. Label each section clearly.")}]}],generationConfig:{temperature:f,maxOutputTokens:v}};console.log("[".concat(r.MODULE_NAME,"] Executing ").concat(n.length," tools for ").concat(d," via Google prompt-based fallback"));const k=await fetch(b,{method:"POST",headers:{"Content-Type":"application/json","x-goog-api-key":i},body:JSON.stringify(y)});if(!k.ok){const e=await k.text().catch(()=>"Unable to read error");throw new Error("Google AI Studio API error: ".concat(k.status," - ").concat(e))}const w=(null===(c=(await k.json()).candidates)||void 0===c||null===(c=c[0])||void 0===c||null===(c=c.content)||void 0===c||null===(c=c.parts)||void 0===c||null===(c=c[0])||void 0===c?void 0:c.text)||"",j=[];if(w.trim())for(const t of n){const n=m[t];if(n){j.push({memberName:d,packName:e.packName,itemName:e.itemName,toolName:t,toolDisplayName:n.displayName,success:!0,response:w.trim()});break}}return j}(e,n,t,s,c,d):await E(e,n,t,s,c,d,u)}catch(t){const i=(0,o.Br)(e.packName,e.itemName),s=(0,a.bQ)(i,"name")||e.itemName||"Unknown";return console.error("[".concat(r.MODULE_NAME,"] Tool execution failed for ").concat(s,":"),t),n.map(n=>{var r;return{memberName:s,packName:e.packName,itemName:e.itemName,toolName:n,toolDisplayName:(null===(r=m[n])||void 0===r?void 0:r.displayName)||n,success:!1,error:t.message,response:""}})}}async function M(){const e=(0,r.getSettings)();if(!j())return x(),[];if(g)return console.log("[".concat(r.MODULE_NAME,"] Tool execution already in progress, awaiting...")),g;const n=(0,i.SD)(),t=(null==n?void 0:n.chat)||[],o=e.councilMembers||[];return console.log("[".concat(r.MODULE_NAME,"] Starting council tool execution for ").concat(o.length," members...")),g=(async()=>{let e;(0,l.y_)();try{e=await async function(){var e,n;const t=(0,r.getSettings)(),i=(null===(e=t.councilTools)||void 0===e?void 0:e.llm)||(null===(n=t.summarization)||void 0===n?void 0:n.secondary)||{},o=i.provider||"anthropic",a=(0,s.Iv)(o);let l;if("custom"===o){if(l=i.apiKey,!l)throw new Error("No API key specified for custom provider")}else if(l=await(0,s.IQ)(a.secretKey),!l)throw new Error("No API key found for ".concat(a.name,". Please add your API key in SillyTavern's API settings."));return{apiKey:l,providerConfig:a,secondary:i,provider:o}}()}catch(e){console.error("[".concat(r.MODULE_NAME,"] Failed to resolve provider for council tools:"),e),(0,l.fR)();const t=[];for(const r of o)for(const i of r.tools||[]){var n;t.push({memberName:r.itemName,packName:r.packName,itemName:r.itemName,toolName:i,toolDisplayName:(null===(n=m[i])||void 0===n?void 0:n.displayName)||i,success:!1,error:e.message,response:""})}return f(t),t}const i=function(e){var n;const t=(0,r.getSettings)(),i="sidecar"===A()?(null===(n=t.councilTools)||void 0===n?void 0:n.sidecarContextWindow)||25:10;return e.slice(-i).map(e=>{const n=e.is_user?"{{user}}":e.name||"Assistant";return"".concat(n,": ").concat(e.mes||e.content||"")}).join("\n\n")}(t),a=o.filter(e=>e.tools&&e.tools.length>0);if(0===a.length)return console.log("[".concat(r.MODULE_NAME,"] No council members have tools assigned")),(0,l.fR)(),f([]),[];const c=a.map(async n=>{const t=await D(n,n.tools,i,e);return(0,l.CU)(n),t}),u=(await Promise.all(c)).flat();f(u);const d=u.filter(e=>e.success).length;return console.log("[".concat(r.MODULE_NAME,"] Council tool execution complete. ").concat(d,"/").concat(u.length," tools succeeded.")),(0,l.Mw)(),u})(),g}function O(e){if(!e||0===e.length)return"## Council Deliberation\n\nNo tools were executed for this generation.";const n=["## Council Deliberation"];n.push(""),n.push("The following contributions have been gathered from council members:"),n.push("");const t={};return e.forEach(e=>{if(!e.success)return;const n=e.memberName;t[n]||(t[n]=[]),t[n].push(e)}),Object.entries(t).forEach(e=>{let[t,r]=e;n.push("### **".concat(t,"** says:")),n.push(""),r.forEach(e=>{n.push("**".concat(e.toolDisplayName,":**")),n.push(e.response),n.push("")}),n.push("---"),n.push("")}),n.join("\n")}function T(){return'## Council Deliberation Instructions\n\nYou have access to the contributions from your fellow council members above. \n\nYour task:\n1. Review each member\'s contributions carefully\n2. Debate which suggestions have the most merit\n3. Consider how different ideas might combine or conflict\n4. Reach a consensus on the best path forward\n5. In your OOC commentary, reflect this deliberation process\n\n**CRITICAL - Chain of Thought for Deliberation:**\nWhen reviewing suggestions, you MUST:\n- **ALWAYS** attempt to integrate and accommodate ALL reasonable suggestions from council members\n- Exhaustively consider how multiple ideas can coexist and complement each other\n- Only reject or challenge a suggestion if it would create irreconcilable conflicts with established lore (to the point of nonsense or contradiction)\n- Default stance: "How can we make this work together?" rather than "Why won\'t this work?"\n- If two suggestions seem to conflict, explore creative synthesis first before dismissing either\n- Treat lore inconsistencies as rare exceptions requiring strong justification, not default responses\n\n**Guidelines for Deliberation:**\n- Reference specific contributions by name ("Elandra\'s suggestion about...", "I disagree with Kael\'s proposal because...")\n- Build upon good ideas ("Taking Mira\'s point further...")\n- When challenging: only do so if the suggestion fundamentally breaks established lore beyond repair\n- Find synthesis between competing ideas—this is the DEFAULT expectation\n- Your final narrative output should reflect the consensus reached through generous integration\n\n**Tone:** Professional but passionate. You are invested in telling the best possible story through collaborative synthesis.'}function A(){var e;return(null===(e=(0,r.getSettings)().councilTools)||void 0===e?void 0:e.mode)||"sidecar"}function L(e,n){const t=(e.id||"".concat(e.packName,"_").concat(e.itemName)).replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase();return"".concat("lumiverse_council_").concat(t,"_").concat(n)}function z(e,n){const t=(0,o.Br)(n.packName,n.itemName),r=(0,a.bQ)(t,"name")||n.itemName||"Unknown",i=n.role?" Their role on the council is: ".concat(n.role,"."):"";return"[Lumiverse Council - ".concat(r,"] ").concat(e.description,".").concat(i," ").concat(e.prompt)}function I(e,n){const t=(0,o.Br)(n.packName,n.itemName),r=(0,a.bQ)(t,"name")||n.itemName||"Unknown";return"".concat(r,": ").concat(e.displayName)}function R(e,n){return async t=>{const i=(0,o.Br)(n.packName,n.itemName),s=(0,a.bQ)(i,"name")||n.itemName||"Unknown",l=P(t,e),c="[Council Member: ".concat(s,"] ").concat(e.displayName,"\n\n").concat(l),u={memberName:s,packName:n.packName,itemName:n.itemName,toolName:e.name,toolDisplayName:e.displayName,success:!0,response:l};return p.push(u),console.log("[".concat(r.MODULE_NAME,"] Inline tool ").concat(e.displayName," invoked by LLM for member ").concat(s)),c}}function B(){!function(){if(0===d.size)return;let e=0;for(const n of d)try{(0,i.FC)(n),e++}catch(e){console.warn("[".concat(r.MODULE_NAME,"] Failed to unregister ST tool ").concat(n,":"),e)}d.clear(),console.log("[".concat(r.MODULE_NAME,"] Unregistered ").concat(e," council tools from ST ToolManager"))}();let e=0;const n=(0,r.getSettings)().councilMembers||[];for(const t of n){const n=t.tools||[];if(0!==n.length)for(const o of n){const n=m[o];if(!n){console.warn("[".concat(r.MODULE_NAME,'] Unknown tool "').concat(o,'" assigned to member ').concat(t.itemName,", skipping"));continue}const a=L(t,o),s=t.id,l=o;try{(0,i.AY)({name:a,displayName:I(n,t),description:z(n,t),parameters:n.inputSchema,action:R(n,t),stealth:!1,shouldRegister:()=>{var e,n;const t=(0,r.getSettings)();if(!0!==t.councilMode||!0!==(null===(e=t.councilTools)||void 0===e?void 0:e.enabled)||"inline"!==(null===(n=t.councilTools)||void 0===n?void 0:n.mode))return!1;const i=(t.councilMembers||[]).find(e=>e.id===s);return i&&i.tools&&i.tools.includes(l)}}),d.add(a),e++}catch(e){console.error("[".concat(r.MODULE_NAME,"] Failed to register ST tool ").concat(a,":"),e)}}}console.log("[".concat(r.MODULE_NAME,"] Registered ").concat(e," council member-specific tools with ST ToolManager (inline mode)"))}function _(){return(0,i.fN)()}function F(){return Object.values(m).map(e=>({name:e.name,displayName:e.displayName,description:e.description}))}},456(e,n,t){t.d(n,{A:()=>b});var r=t(601),i=t.n(r),o=t(314),a=t.n(o),s=t(417),l=t.n(s),c=new URL(t(919),t.b),u=new URL(t(796),t.b),d=new URL(t(834),t.b),m=new URL(t(43),t.b),p=a()(i()),g=l()(c),h=l()(u),v=l()(d),f=l()(m);p.push([e.id,`/* ========================================\n   Lumiverse Helper - React UI Styles\n   Apple-esque minimal design with dark theme\n   Inspired by oldLumiverseCode/style.css\n   ======================================== */\n\n/* CSS Custom Properties - Purple accent color scheme */\n:root {\n    /* Primary purple accent (matching old design) */\n    --lumiverse-primary: rgba(147, 112, 219, 0.9);\n    --lumiverse-primary-hover: rgba(167, 132, 239, 0.95);\n    --lumiverse-primary-light: rgba(147, 112, 219, 0.1);\n    --lumiverse-primary-muted: rgba(147, 112, 219, 0.6);\n    --lumiverse-primary-text: rgba(186, 135, 255, 0.95);\n\n    /* Secondary gray tones */\n    --lumiverse-secondary: rgba(128, 128, 128, 0.15);\n    --lumiverse-secondary-hover: rgba(128, 128, 128, 0.25);\n    --lumiverse-secondary-border: rgba(128, 128, 128, 0.25);\n\n    /* Status colors */\n    --lumiverse-danger: #ef4444;\n    --lumiverse-danger-hover: #dc2626;\n    --lumiverse-success: #22c55e;\n    --lumiverse-warning: #f59e0b;\n\n    /* Dark purple-tinted backgrounds (matching old design) */\n    --lumiverse-bg: rgba(28, 24, 38, 0.95);\n    --lumiverse-bg-elevated: rgba(35, 30, 48, 0.9);\n    --lumiverse-bg-hover: rgba(45, 40, 58, 0.9);\n    --lumiverse-bg-dark: rgba(0, 0, 0, 0.15);\n    --lumiverse-bg-darker: rgba(0, 0, 0, 0.25);\n\n    /* Subtle purple-tinted borders */\n    --lumiverse-border: rgba(147, 112, 219, 0.12);\n    --lumiverse-border-hover: rgba(147, 112, 219, 0.25);\n    --lumiverse-border-light: rgba(128, 128, 128, 0.12);\n\n    /* Text colors with proper opacity */\n    --lumiverse-text: rgba(255, 255, 255, 0.9);\n    --lumiverse-text-muted: rgba(255, 255, 255, 0.65);\n    --lumiverse-text-dim: rgba(255, 255, 255, 0.4);\n    --lumiverse-text-hint: rgba(255, 255, 255, 0.3);\n\n    /* Consistent border radii */\n    --lumiverse-radius-sm: 5px;\n    --lumiverse-radius: 8px;\n    --lumiverse-radius-md: 10px;\n    --lumiverse-radius-lg: 12px;\n    --lumiverse-radius-xl: 16px;\n\n    /* Shadows */\n    --lumiverse-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);\n    --lumiverse-shadow-lg: 0 24px 80px rgba(0, 0, 0, 0.5), 0 0 1px rgba(147, 112, 219, 0.3);\n\n    /* Smooth transitions (200ms like old design) */\n    --lumiverse-transition: 200ms ease;\n    --lumiverse-transition-fast: 150ms ease;\n\n    /* Typography */\n    --lumiverse-font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", sans-serif;\n    --lumiverse-font-mono: "SF Mono", "Menlo", "Monaco", "Consolas", monospace;\n}\n\n/* ========================================\n   LUMIA SETTINGS PANEL - Exact replica\n   Modern Apple-esque minimal design\n   (from oldLumiverseCode/style.css)\n   ======================================== */\n\n.lumia-injector-settings {\n    padding: 0;\n    font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", sans-serif;\n}\n\n/* Panel Container */\n.lumia-panel {\n    margin-bottom: 12px;\n    background: linear-gradient(\n        165deg,\n        rgba(28, 24, 38, 0.6) 0%,\n        rgba(35, 30, 48, 0.5) 100%\n    );\n    border: 1px solid rgba(147, 112, 219, 0.12);\n    border-radius: 12px;\n    overflow: hidden;\n    transition: border-color 0.2s ease;\n}\n\n.lumia-panel:hover {\n    border-color: rgba(147, 112, 219, 0.25);\n}\n\n/* Panel Header */\n.lumia-panel-header {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 12px 14px;\n    background: linear-gradient(\n        180deg,\n        rgba(147, 112, 219, 0.08) 0%,\n        transparent 100%\n    );\n    border-bottom: 1px solid rgba(147, 112, 219, 0.08);\n}\n\n.lumia-panel-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 20px;\n    height: 20px;\n    flex-shrink: 0;\n}\n\n.lumia-panel-icon svg {\n    width: 18px;\n    height: 18px;\n    stroke: rgba(147, 112, 219, 0.8);\n}\n\n.lumia-panel-title {\n    font-size: 13px;\n    font-weight: 600;\n    color: rgba(255, 255, 255, 0.9);\n    letter-spacing: -0.1px;\n    flex-grow: 1;\n}\n\n/* Collapsible Panel */\n.lumia-panel-collapsible {\n    cursor: default;\n}\n\n.lumia-panel-header-clickable {\n    cursor: pointer;\n    list-style: none;\n    user-select: none;\n}\n\n.lumia-panel-header-clickable::-webkit-details-marker {\n    display: none;\n}\n\n.lumia-panel-chevron {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 20px;\n    height: 20px;\n    transition: transform 0.2s ease;\n}\n\n.lumia-panel-chevron svg {\n    width: 16px;\n    height: 16px;\n    stroke: rgba(255, 255, 255, 0.4);\n}\n\ndetails.lumia-panel[open] .lumia-panel-chevron {\n    transform: rotate(180deg);\n}\n\n/* Panel Content */\n.lumia-panel-content {\n    padding: 14px;\n}\n\n/* Status Badge */\n.lumia-status-badge {\n    display: inline-flex;\n    align-items: center;\n    padding: 6px 12px;\n    margin-bottom: 12px;\n    background: rgba(147, 112, 219, 0.1);\n    border: 1px solid rgba(147, 112, 219, 0.2);\n    border-radius: 20px;\n    font-size: 12px;\n    font-weight: 500;\n    color: rgba(186, 135, 255, 0.9);\n    letter-spacing: 0.1px;\n}\n\n/* Input Row */\n.lumia-input-row {\n    display: flex;\n    gap: 8px;\n    margin-bottom: 10px;\n}\n\n.lumia-input {\n    flex: 1;\n    padding: 10px 14px;\n    background: rgba(0, 0, 0, 0.25);\n    border: 1px solid rgba(128, 128, 128, 0.2);\n    border-radius: 8px;\n    font-size: 13px;\n    color: rgba(255, 255, 255, 0.9);\n    transition: all 0.2s ease;\n    font-family: inherit;\n}\n\n.lumia-input::placeholder {\n    color: rgba(255, 255, 255, 0.35);\n}\n\n.lumia-input:focus {\n    outline: none;\n    border-color: rgba(147, 112, 219, 0.5);\n    background: rgba(0, 0, 0, 0.35);\n}\n\n/* Source Actions - centered buttons with dividers */\n.lumia-source-actions {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n}\n\n.lumia-source-actions .lumia-btn-full {\n    width: 100%;\n    max-width: 100%;\n}\n\n/* Divider Text */\n.lumia-divider-text {\n    text-align: center;\n    font-size: 11px;\n    font-weight: 500;\n    color: rgba(255, 255, 255, 0.3);\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    margin: 12px 0;\n    position: relative;\n}\n\n.lumia-divider-text::before,\n.lumia-divider-text::after {\n    content: "";\n    position: absolute;\n    top: 50%;\n    width: calc(50% - 20px);\n    height: 1px;\n    background: rgba(128, 128, 128, 0.2);\n}\n\n.lumia-divider-text::before {\n    left: 0;\n}\n\n.lumia-divider-text::after {\n    right: 0;\n}\n\n/* Buttons */\n.lumia-btn {\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    gap: 8px;\n    padding: 10px 16px;\n    border: none;\n    border-radius: 8px;\n    font-size: 13px;\n    font-weight: 500;\n    font-family: inherit;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    white-space: nowrap;\n}\n\n.lumia-btn svg {\n    width: 16px;\n    height: 16px;\n    flex-shrink: 0;\n}\n\n.lumia-btn-primary {\n    background: linear-gradient(\n        135deg,\n        rgba(147, 112, 219, 0.9) 0%,\n        rgba(123, 95, 196, 0.9) 100%\n    );\n    color: white;\n}\n\n.lumia-btn-primary:hover {\n    background: linear-gradient(\n        135deg,\n        rgba(167, 132, 239, 0.95) 0%,\n        rgba(143, 115, 216, 0.95) 100%\n    );\n    transform: translateY(-1px);\n}\n\n.lumia-btn-secondary {\n    background: rgba(128, 128, 128, 0.15);\n    border: 1px solid rgba(128, 128, 128, 0.25);\n    color: rgba(255, 255, 255, 0.85);\n}\n\n.lumia-btn-secondary:hover {\n    background: rgba(128, 128, 128, 0.25);\n    border-color: rgba(147, 112, 219, 0.3);\n}\n\n.lumia-btn-full {\n    width: 100%;\n}\n\n.lumia-btn-sm {\n    padding: 6px 12px;\n    font-size: 12px;\n    background: rgba(147, 112, 219, 0.15);\n    border: 1px solid rgba(147, 112, 219, 0.25);\n    color: rgba(186, 135, 255, 0.95);\n}\n\n.lumia-btn-sm:hover {\n    background: rgba(147, 112, 219, 0.25);\n    border-color: rgba(147, 112, 219, 0.4);\n}\n\n.lumia-btn-icon {\n    padding: 6px;\n    background: transparent;\n    border: none;\n}\n\n.lumia-btn-icon:hover {\n    background: rgba(147, 112, 219, 0.15);\n}\n\n.lumia-btn-icon svg {\n    width: 14px;\n    height: 14px;\n    stroke: rgba(186, 135, 255, 0.8);\n}\n\n/* Danger Button */\n.lumia-btn-danger {\n    background: linear-gradient(\n        135deg,\n        rgba(220, 53, 69, 0.9) 0%,\n        rgba(185, 45, 58, 0.9) 100%\n    );\n    color: rgba(255, 255, 255, 0.95);\n    border: 1px solid rgba(220, 53, 69, 0.4);\n}\n\n.lumia-btn-danger:hover {\n    background: linear-gradient(\n        135deg,\n        rgba(240, 73, 89, 0.95) 0%,\n        rgba(205, 65, 78, 0.95) 100%\n    );\n    transform: translateY(-1px);\n}\n\n.lumia-btn-danger svg {\n    stroke: rgba(255, 255, 255, 0.9);\n    margin-right: 6px;\n}\n\n/* Danger Zone Section */\n.lumia-danger-zone {\n    display: flex;\n    flex-direction: column;\n    gap: 12px;\n}\n\n.lumia-danger-zone-description {\n    font-size: 12px;\n    color: rgba(255, 255, 255, 0.6);\n    line-height: 1.5;\n    margin: 0;\n}\n\n/* Selector Group */\n.lumia-selector-group {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n}\n\n.lumia-selector {\n    background: rgba(0, 0, 0, 0.15);\n    border: 1px solid rgba(128, 128, 128, 0.12);\n    border-radius: 10px;\n    padding: 12px 14px;\n    transition: all 0.2s ease;\n}\n\n.lumia-selector:hover {\n    border-color: rgba(147, 112, 219, 0.2);\n    background: rgba(0, 0, 0, 0.2);\n}\n\n.lumia-selector-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 8px;\n}\n\n.lumia-selector-label {\n    font-size: 12px;\n    font-weight: 600;\n    color: rgba(255, 255, 255, 0.8);\n    letter-spacing: 0.1px;\n}\n\n.lumia-selector-hint {\n    font-size: 10px;\n    font-weight: 500;\n    color: rgba(147, 112, 219, 0.6);\n    text-transform: uppercase;\n    letter-spacing: 0.3px;\n}\n\n.lumia-selector-row {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n}\n\n.lumia-selector-value {\n    flex: 1;\n    font-size: 13px;\n    font-weight: 500;\n    color: rgba(255, 255, 255, 0.65);\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n    min-width: 0;\n}\n\n/* Selector Group Disabled State (Council Mode Active) */\n.lumia-selector-group--disabled {\n    opacity: 0.5;\n    pointer-events: none;\n    filter: grayscale(30%);\n}\n\n/* Council Notice */\n.lumia-council-notice {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 10px 14px;\n    margin-bottom: 12px;\n    background: linear-gradient(\n        135deg,\n        rgba(147, 112, 219, 0.15) 0%,\n        rgba(100, 80, 180, 0.1) 100%\n    );\n    border: 1px solid rgba(147, 112, 219, 0.25);\n    border-radius: 8px;\n    font-size: 12px;\n    font-weight: 500;\n    color: rgba(186, 135, 255, 0.9);\n}\n\n.lumia-council-notice svg {\n    flex-shrink: 0;\n    stroke: rgba(186, 135, 255, 0.8);\n}\n\n/* Council Config Button (in SettingsPanel) */\n.lumia-council-config-btn {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    width: 100%;\n    padding: 12px 14px;\n    margin-bottom: 12px;\n    background: linear-gradient(\n        135deg,\n        rgba(147, 112, 219, 0.12) 0%,\n        rgba(147, 112, 219, 0.06) 100%\n    );\n    border: 1px solid rgba(147, 112, 219, 0.3);\n    border-radius: 10px;\n    color: var(--lumiverse-text);\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumia-council-config-btn:hover {\n    background: linear-gradient(\n        135deg,\n        rgba(147, 112, 219, 0.18) 0%,\n        rgba(147, 112, 219, 0.1) 100%\n    );\n    border-color: rgba(147, 112, 219, 0.5);\n}\n\n.lumia-council-config-btn svg {\n    flex-shrink: 0;\n    color: var(--lumiverse-primary);\n}\n\n.lumia-council-config-text {\n    flex: 1;\n    text-align: left;\n    font-size: 13px;\n    font-weight: 500;\n}\n\n.lumia-council-config-action {\n    padding: 4px 10px;\n    background: rgba(147, 112, 219, 0.2);\n    border-radius: 6px;\n    font-size: 11px;\n    font-weight: 600;\n    color: var(--lumiverse-primary);\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n.lumia-council-config-btn:hover .lumia-council-config-action {\n    background: var(--lumiverse-primary);\n    color: white;\n}\n\n/* ----------------------------------------\n   Quick Actions Section\n   ---------------------------------------- */\n.lumia-quick-actions {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    margin-bottom: 12px;\n    flex-wrap: wrap;\n}\n\n.lumia-quick-action-group {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    flex: 1;\n    min-width: 0;\n}\n\n.lumia-quick-action-btn {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 6px;\n    padding: 8px 12px;\n    background: rgba(30, 30, 46, 0.6);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    border-radius: 8px;\n    color: var(--lumiverse-text-secondary);\n    font-size: 12px;\n    font-weight: 500;\n    cursor: pointer;\n    transition: all 0.15s ease;\n    white-space: nowrap;\n    font-family: inherit;\n}\n\n.lumia-quick-action-btn:hover:not(:disabled) {\n    background: rgba(30, 30, 46, 0.8);\n    border-color: rgba(147, 112, 219, 0.3);\n    color: var(--lumiverse-text-primary);\n}\n\n.lumia-quick-action-btn--council {\n    flex-shrink: 0;\n}\n\n.lumia-quick-action-btn--disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n}\n\n.lumia-quick-action-btn--primary {\n    background: rgba(147, 112, 219, 0.15);\n    border-color: rgba(147, 112, 219, 0.3);\n    color: var(--lumiverse-primary);\n    padding: 8px 10px;\n}\n\n.lumia-quick-action-btn--primary:hover:not(:disabled) {\n    background: rgba(147, 112, 219, 0.25);\n    border-color: rgba(147, 112, 219, 0.5);\n}\n\n.lumia-quick-action-btn--active {\n    background: rgba(147, 112, 219, 0.1);\n    border-color: rgba(147, 112, 219, 0.3);\n    color: var(--lumiverse-primary);\n}\n\n.lumia-quick-action-text {\n    max-width: 100px;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumia-quick-action-chevron {\n    transition: transform 0.15s ease;\n    flex-shrink: 0;\n}\n\n.lumia-quick-action-chevron--open {\n    transform: rotate(180deg);\n}\n\n/* Dropdown */\n.lumia-quick-action-dropdown-wrapper {\n    position: relative;\n    flex: 1;\n    min-width: 0;\n}\n\n.lumia-quick-action-dropdown {\n    position: absolute;\n    top: calc(100% + 4px);\n    left: 0;\n    right: 0;\n    min-width: 140px;\n    background: rgba(25, 25, 35, 0.98);\n    border: 1px solid rgba(255, 255, 255, 0.12);\n    border-radius: 8px;\n    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);\n    z-index: 100;\n    max-height: 200px;\n    overflow-y: auto;\n}\n\n.lumia-quick-action-dropdown-empty {\n    padding: 12px;\n    text-align: center;\n    color: var(--lumiverse-text-muted);\n    font-size: 11px;\n}\n\n.lumia-quick-action-dropdown-item {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    width: 100%;\n    padding: 10px 12px;\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text-secondary);\n    font-size: 12px;\n    text-align: left;\n    cursor: pointer;\n    transition: all 0.1s ease;\n    font-family: inherit;\n}\n\n.lumia-quick-action-dropdown-item:hover {\n    background: rgba(147, 112, 219, 0.1);\n    color: var(--lumiverse-text-primary);\n}\n\n.lumia-quick-action-dropdown-item--active {\n    background: rgba(147, 112, 219, 0.15);\n    color: var(--lumiverse-primary);\n}\n\n.lumia-quick-action-dropdown-item svg {\n    flex-shrink: 0;\n}\n\n/* Form */\n.lumia-quick-action-form {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    flex: 1;\n    min-width: 0;\n}\n\n.lumia-quick-action-input {\n    flex: 1;\n    min-width: 0;\n    padding: 8px 10px;\n    background: rgba(30, 30, 46, 0.8);\n    border: 1px solid rgba(147, 112, 219, 0.3);\n    border-radius: 6px;\n    color: var(--lumiverse-text-primary);\n    font-size: 12px;\n    font-family: inherit;\n}\n\n.lumia-quick-action-input:focus {\n    outline: none;\n    border-color: rgba(147, 112, 219, 0.6);\n}\n\n.lumia-quick-action-input::placeholder {\n    color: var(--lumiverse-text-muted);\n}\n\n/* Responsive adjustments */\n@media (max-width: 480px) {\n    .lumia-quick-actions {\n        flex-direction: column;\n        align-items: stretch;\n    }\n\n    .lumia-quick-action-btn--council {\n        width: 100%;\n    }\n\n    .lumia-quick-action-group {\n        width: 100%;\n    }\n\n    .lumia-quick-action-text {\n        max-width: none;\n    }\n}\n\n/* Clear All Button */\n.lumia-clear-all-btn {\n    display: inline-flex;\n    align-items: center;\n    gap: 6px;\n    padding: 5px 10px;\n    background: rgba(239, 68, 68, 0.1);\n    border: 1px solid rgba(239, 68, 68, 0.2);\n    border-radius: 6px;\n    font-size: 11px;\n    font-weight: 500;\n    color: rgba(239, 68, 68, 0.8);\n    cursor: pointer;\n    transition: all 0.2s ease;\n    font-family: inherit;\n}\n\n.lumia-clear-all-btn:hover {\n    background: rgba(239, 68, 68, 0.2);\n    border-color: rgba(239, 68, 68, 0.4);\n    color: rgba(239, 68, 68, 1);\n}\n\n.lumia-clear-all-btn svg {\n    width: 14px;\n    height: 14px;\n}\n\n/* Panel Action (header button area) */\n.lumia-panel-action {\n    display: flex;\n    align-items: center;\n    margin-left: auto;\n}\n\n/* Panel Chevron for collapsible panels */\n.lumia-panel-chevron--expanded {\n    transform: rotate(180deg);\n}\n\n/* Tools Row */\n.lumia-tools-row {\n    display: grid;\n    grid-template-columns: repeat(2, 1fr);\n    gap: 10px;\n}\n\n.lumia-tool-btn {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    gap: 8px;\n    padding: 16px 12px;\n    background: rgba(0, 0, 0, 0.15);\n    border: 1px solid rgba(128, 128, 128, 0.12);\n    border-radius: 10px;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumia-tool-btn svg {\n    width: 22px;\n    height: 22px;\n    stroke: rgba(147, 112, 219, 0.7);\n    transition: stroke 0.2s ease;\n}\n\n.lumia-tool-btn span {\n    font-size: 12px;\n    font-weight: 500;\n    color: rgba(255, 255, 255, 0.75);\n    font-family: inherit;\n}\n\n.lumia-tool-btn:hover {\n    background: rgba(147, 112, 219, 0.1);\n    border-color: rgba(147, 112, 219, 0.25);\n}\n\n.lumia-tool-btn:hover svg {\n    stroke: rgba(186, 135, 255, 0.9);\n}\n\n.lumia-tool-btn-accent {\n    background: linear-gradient(\n        135deg,\n        rgba(147, 112, 219, 0.2) 0%,\n        rgba(123, 95, 196, 0.15) 100%\n    );\n    border-color: rgba(147, 112, 219, 0.35);\n}\n\n.lumia-tool-btn-accent svg {\n    stroke: rgba(186, 135, 255, 0.9);\n}\n\n.lumia-tool-btn-accent span {\n    color: rgba(186, 135, 255, 0.95);\n}\n\n.lumia-tool-btn-accent:hover {\n    background: linear-gradient(\n        135deg,\n        rgba(147, 112, 219, 0.3) 0%,\n        rgba(123, 95, 196, 0.25) 100%\n    );\n    border-color: rgba(147, 112, 219, 0.5);\n}\n\n/* Macro Reference */\n.lumia-macro-reference {\n    display: flex;\n    flex-direction: column;\n    gap: 14px;\n}\n\n.lumia-macro-group {\n    display: flex;\n    flex-direction: column;\n    gap: 6px;\n}\n\n.lumia-macro-group-title {\n    font-size: 10px;\n    font-weight: 600;\n    color: rgba(147, 112, 219, 0.7);\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    margin-bottom: 2px;\n}\n\n.lumia-macro-list {\n    display: flex;\n    flex-direction: column;\n    gap: 4px;\n}\n\n.lumia-macro {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 6px 0;\n    cursor: pointer;\n    transition: opacity 0.2s ease;\n}\n\n.lumia-macro:hover {\n    opacity: 0.85;\n}\n\n.lumia-macro--copied {\n    opacity: 1;\n}\n\n.lumia-macro--copied code {\n    background: rgba(147, 112, 219, 0.25);\n    border-color: rgba(147, 112, 219, 0.4);\n}\n\n.lumia-macro code {\n    font-family: "SF Mono", "Menlo", "Monaco", "Consolas", monospace;\n    font-size: 11px;\n    padding: 4px 8px;\n    background: rgba(0, 0, 0, 0.3);\n    border: 1px solid rgba(128, 128, 128, 0.15);\n    border-radius: 5px;\n    color: rgba(186, 135, 255, 0.95);\n    white-space: nowrap;\n    transition: all 0.2s ease;\n}\n\n.lumia-macro span {\n    font-size: 12px;\n    color: rgba(255, 255, 255, 0.55);\n}\n\n/* Custom Packs */\n.lumia-custom-packs {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumia-pack-item {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 10px 12px;\n    background: rgba(0, 0, 0, 0.15);\n    border: 1px solid rgba(128, 128, 128, 0.12);\n    border-radius: 8px;\n    transition: all 0.2s ease;\n}\n\n.lumia-pack-item:hover {\n    border-color: rgba(147, 112, 219, 0.2);\n    background: rgba(0, 0, 0, 0.2);\n}\n\n.lumia-pack-name {\n    flex: 1;\n    font-size: 13px;\n    font-weight: 500;\n    color: rgba(255, 255, 255, 0.85);\n}\n\n.lumia-pack-count {\n    font-size: 11px;\n    color: rgba(147, 112, 219, 0.7);\n    padding: 2px 8px;\n    background: rgba(147, 112, 219, 0.1);\n    border-radius: 10px;\n}\n\n/* Expandable Pack Container */\n.lumia-pack-item-container {\n    border-radius: 8px;\n    overflow: hidden;\n}\n\n.lumia-pack-item-container--expanded {\n    background: rgba(0, 0, 0, 0.08);\n    border: 1px solid rgba(147, 112, 219, 0.15);\n}\n\n.lumia-pack-item-container--expanded .lumia-pack-item {\n    border-bottom: 1px solid rgba(128, 128, 128, 0.1);\n    border-radius: 8px 8px 0 0;\n}\n\n/* Expand button */\n.lumia-pack-expand-btn {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 24px;\n    height: 24px;\n    padding: 0;\n    background: transparent;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n    color: rgba(255, 255, 255, 0.5);\n    transition: all 0.2s ease;\n}\n\n.lumia-pack-expand-btn:hover {\n    background: rgba(147, 112, 219, 0.15);\n    color: rgba(255, 255, 255, 0.8);\n}\n\n/* Chevron rotation */\n.lumia-pack-chevron {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: transform 0.2s ease;\n}\n\n.lumia-pack-chevron svg {\n    width: 14px;\n    height: 14px;\n}\n\n.lumia-pack-chevron--expanded {\n    transform: rotate(180deg);\n}\n\n/* Expanded Lumia items list */\n.lumia-pack-items-list {\n    display: flex;\n    flex-direction: column;\n    padding: 4px 8px 8px 8px;\n    overflow: hidden;\n}\n\n/* Individual Lumia item in expanded list */\n.lumia-pack-lumia-item {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    padding: 8px 10px;\n    margin-top: 4px;\n    background: rgba(0, 0, 0, 0.12);\n    border: 1px solid rgba(128, 128, 128, 0.08);\n    border-radius: 6px;\n    transition: all 0.15s ease;\n}\n\n.lumia-pack-lumia-item:hover {\n    background: rgba(0, 0, 0, 0.18);\n    border-color: rgba(147, 112, 219, 0.2);\n}\n\n/* Lumia avatar in expanded list */\n.lumia-pack-lumia-avatar {\n    width: 28px;\n    height: 28px;\n    border-radius: 50%;\n    object-fit: cover;\n    border: 1px solid rgba(147, 112, 219, 0.2);\n    flex-shrink: 0;\n    animation: lumiverseFadeIn 0.2s ease;\n}\n\n/* Lumia name in expanded list */\n.lumia-pack-lumia-name {\n    flex: 1;\n    font-size: 12px;\n    font-weight: 500;\n    color: rgba(255, 255, 255, 0.8);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n/* Small icon button */\n.lumia-btn-icon-sm {\n    width: 24px !important;\n    height: 24px !important;\n    padding: 0 !important;\n    font-size: 12px;\n}\n\n.lumia-btn-icon-sm svg {\n    width: 12px;\n    height: 12px;\n}\n\n/* Empty state for expanded pack */\n.lumia-pack-items-empty {\n    padding: 12px;\n    text-align: center;\n    overflow: hidden;\n}\n\n.lumia-pack-items-empty span {\n    font-size: 12px;\n    color: rgba(255, 255, 255, 0.4);\n    font-style: italic;\n}\n\n/* Section header within expanded pack list */\n.lumia-pack-section-header {\n    font-size: 10px;\n    font-weight: 600;\n    color: rgba(147, 112, 219, 0.7);\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    padding: 6px 4px 4px 4px;\n    margin-bottom: 2px;\n}\n\n/* Pack counts container for multiple badges */\n.lumia-pack-counts {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    margin-left: auto;\n    margin-right: 8px;\n}\n\n/* Loom count badge styling */\n.lumia-pack-count-loom {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    background: rgba(100, 130, 180, 0.2) !important;\n    border-color: rgba(100, 130, 180, 0.3) !important;\n}\n\n/* Individual Loom item in expanded list */\n.lumia-pack-loom-item {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    padding: 8px 10px;\n    margin-top: 4px;\n    background: rgba(100, 130, 180, 0.08);\n    border: 1px solid rgba(100, 130, 180, 0.15);\n    border-radius: 6px;\n    transition: all 0.15s ease;\n}\n\n.lumia-pack-loom-item:hover {\n    background: rgba(100, 130, 180, 0.15);\n    border-color: rgba(100, 130, 180, 0.3);\n}\n\n/* Loom icon in expanded list */\n.lumia-pack-loom-icon {\n    width: 28px;\n    height: 28px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    border-radius: 50%;\n    background: rgba(100, 130, 180, 0.15);\n    border: 1px solid rgba(100, 130, 180, 0.2);\n    flex-shrink: 0;\n    color: rgba(150, 180, 220, 0.9);\n}\n\n/* Loom name in expanded list */\n.lumia-pack-loom-name {\n    flex: 1;\n    font-size: 12px;\n    font-weight: 500;\n    color: rgba(255, 255, 255, 0.8);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n/* ----------------------------------------\n   Base App Container\n   ---------------------------------------- */\n.lumiverse-app {\n    font-family: var(--lumiverse-font-family);\n    color: var(--lumiverse-text);\n    font-size: 14px;\n    line-height: 1.5;\n}\n\n.lumiverse-react-root {\n    margin: 0;\n    padding: 0;\n}\n\n/* ----------------------------------------\n   Settings Panel - Main container with gradient background\n   ---------------------------------------- */\n.lumiverse-settings-panel {\n    background: linear-gradient(\n        165deg,\n        rgba(28, 24, 38, 0.95) 0%,\n        rgba(35, 30, 48, 0.9) 100%\n    );\n    border-radius: var(--lumiverse-radius-lg);\n    border: 1px solid var(--lumiverse-border);\n    overflow: hidden;\n    transition: border-color var(--lumiverse-transition);\n}\n\n.lumiverse-settings-panel:hover {\n    border-color: var(--lumiverse-border-hover);\n}\n\n.lumiverse-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 12px 14px;\n    background: linear-gradient(\n        180deg,\n        rgba(147, 112, 219, 0.08) 0%,\n        transparent 100%\n    );\n    border-bottom: 1px solid rgba(147, 112, 219, 0.08);\n}\n\n.lumiverse-header-badge {\n    font-size: 10px;\n    font-weight: 500;\n    padding: 4px 8px;\n    background: var(--lumiverse-primary-light);\n    border: 1px solid rgba(147, 112, 219, 0.2);\n    border-radius: 12px;\n    color: var(--lumiverse-primary-text);\n    text-transform: uppercase;\n    letter-spacing: 0.3px;\n}\n\n.lumiverse-title {\n    margin: 0;\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    letter-spacing: -0.1px;\n}\n\n/* ----------------------------------------\n   Sections (Collapsible) - Panel-like sections\n   ---------------------------------------- */\n.lumiverse-section {\n    margin-bottom: 0;\n    background: linear-gradient(\n        165deg,\n        rgba(28, 24, 38, 0.6) 0%,\n        rgba(35, 30, 48, 0.5) 100%\n    );\n    border-bottom: 1px solid var(--lumiverse-border);\n    transition: border-color var(--lumiverse-transition);\n}\n\n.lumiverse-section:last-child {\n    border-bottom: none;\n}\n\n.lumiverse-section:hover {\n    border-color: var(--lumiverse-border-hover);\n}\n\n.lumiverse-section-header {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    width: 100%;\n    padding: 12px 14px;\n    background: linear-gradient(\n        180deg,\n        rgba(147, 112, 219, 0.08) 0%,\n        transparent 100%\n    );\n    border: none;\n    border-bottom: 1px solid rgba(147, 112, 219, 0.08);\n    color: var(--lumiverse-text);\n    font-size: 13px;\n    font-weight: 600;\n    cursor: pointer;\n    transition: background var(--lumiverse-transition);\n    letter-spacing: -0.1px;\n}\n\n.lumiverse-section-header:hover {\n    background: linear-gradient(\n        180deg,\n        rgba(147, 112, 219, 0.12) 0%,\n        rgba(147, 112, 219, 0.04) 100%\n    );\n}\n\n.lumiverse-section-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 20px;\n    height: 20px;\n    flex-shrink: 0;\n    font-size: 16px;\n}\n\n.lumiverse-section-title {\n    flex: 1;\n    text-align: left;\n}\n\n.lumiverse-section-chevron {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 20px;\n    height: 20px;\n    font-size: 10px;\n    color: var(--lumiverse-text-dim);\n    transition: transform var(--lumiverse-transition);\n}\n\n.lumiverse-section-chevron.rotated {\n    transform: rotate(180deg);\n}\n\n.lumiverse-section-content {\n    padding: 14px;\n    background: transparent;\n}\n\n/* ----------------------------------------\n   Toggle Switch\n   ---------------------------------------- */\n.lumiverse-toggle-wrapper {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 8px 0;\n    cursor: pointer;\n}\n\n.lumiverse-toggle-text {\n    flex: 1;\n    margin-right: 12px;\n}\n\n.lumiverse-toggle-label {\n    display: block;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-toggle-description {\n    display: block;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n    margin-top: 2px;\n}\n\n.lumiverse-toggle {\n    position: relative;\n    width: 44px;\n    height: 24px;\n    background: var(--lumiverse-secondary);\n    border-radius: 12px;\n    transition: background var(--lumiverse-transition);\n}\n\n.lumiverse-toggle--on {\n    background: var(--lumiverse-primary);\n}\n\n.lumiverse-toggle-input {\n    position: absolute;\n    opacity: 0;\n    width: 100%;\n    height: 100%;\n    cursor: pointer;\n}\n\n.lumiverse-toggle-slider {\n    position: absolute;\n    top: 2px;\n    left: 2px;\n    width: 20px;\n    height: 20px;\n    background: white;\n    border-radius: 50%;\n    transition: transform var(--lumiverse-transition);\n    pointer-events: none;\n}\n\n.lumiverse-toggle--on .lumiverse-toggle-slider {\n    transform: translateX(20px);\n}\n\n/* Drawer toggle container (settings panel) */\n.lumia-drawer-toggle-container {\n    margin-bottom: 12px;\n    padding: 12px 14px;\n    background: linear-gradient(\n        165deg,\n        rgba(28, 24, 38, 0.6) 0%,\n        rgba(35, 30, 48, 0.5) 100%\n    );\n    border: 1px solid rgba(147, 112, 219, 0.12);\n    border-radius: 12px;\n    transition: border-color 0.2s ease;\n}\n\n.lumia-drawer-toggle-container:hover {\n    border-color: rgba(147, 112, 219, 0.25);\n}\n\n/* Drawer settings container */\n.lumia-drawer-settings-container {\n    margin-bottom: 12px;\n    padding: 12px 14px;\n    background: linear-gradient(\n        165deg,\n        rgba(28, 24, 38, 0.5) 0%,\n        rgba(35, 30, 48, 0.4) 100%\n    );\n    border: 1px solid rgba(147, 112, 219, 0.1);\n    border-radius: 12px;\n    transition: border-color 0.2s ease;\n}\n\n.lumia-drawer-settings-container:hover {\n    border-color: rgba(147, 112, 219, 0.2);\n}\n\n.lumia-drawer-settings-row {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 16px;\n    align-items: flex-start;\n}\n\n.lumia-drawer-setting {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n    flex: 1;\n    min-width: 120px;\n}\n\n.lumia-drawer-setting-label {\n    font-size: 0.75rem;\n    color: rgba(255, 255, 255, 0.7);\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n/* Side toggle button group */\n.lumia-drawer-side-toggle {\n    display: flex;\n    gap: 0;\n    border-radius: 8px;\n    overflow: hidden;\n    border: 1px solid rgba(147, 112, 219, 0.2);\n}\n\n.lumia-side-btn {\n    flex: 1;\n    padding: 8px 16px;\n    font-size: 0.8rem;\n    font-weight: 600;\n    color: rgba(255, 255, 255, 0.6);\n    background: rgba(28, 24, 38, 0.6);\n    border: none;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumia-side-btn:first-child {\n    border-right: 1px solid rgba(147, 112, 219, 0.15);\n}\n\n.lumia-side-btn:hover {\n    background: rgba(147, 112, 219, 0.15);\n    color: rgba(255, 255, 255, 0.85);\n}\n\n.lumia-side-btn--active {\n    background: linear-gradient(\n        135deg,\n        rgba(147, 112, 219, 0.35) 0%,\n        rgba(123, 88, 195, 0.35) 100%\n    );\n    color: white;\n    box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.1);\n}\n\n.lumia-side-btn--active:hover {\n    background: linear-gradient(\n        135deg,\n        rgba(147, 112, 219, 0.45) 0%,\n        rgba(123, 88, 195, 0.45) 100%\n    );\n}\n\n/* Vertical position slider */\n.lumia-drawer-vpos-input {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n}\n\n.lumia-slider {\n    flex: 1;\n    height: 6px;\n    border-radius: 3px;\n    background: rgba(147, 112, 219, 0.15);\n    outline: none;\n    cursor: pointer;\n    -webkit-appearance: none;\n    appearance: none;\n}\n\n.lumia-slider::-webkit-slider-thumb {\n    -webkit-appearance: none;\n    appearance: none;\n    width: 16px;\n    height: 16px;\n    border-radius: 50%;\n    background: linear-gradient(\n        135deg,\n        rgba(147, 112, 219, 1) 0%,\n        rgba(123, 88, 195, 1) 100%\n    );\n    cursor: pointer;\n    border: 2px solid rgba(255, 255, 255, 0.2);\n    box-shadow: 0 2px 6px rgba(147, 112, 219, 0.4);\n    transition: transform 0.15s ease, box-shadow 0.15s ease;\n}\n\n.lumia-slider::-webkit-slider-thumb:hover {\n    transform: scale(1.1);\n    box-shadow: 0 2px 10px rgba(147, 112, 219, 0.6);\n}\n\n.lumia-slider::-moz-range-thumb {\n    width: 16px;\n    height: 16px;\n    border-radius: 50%;\n    background: linear-gradient(\n        135deg,\n        rgba(147, 112, 219, 1) 0%,\n        rgba(123, 88, 195, 1) 100%\n    );\n    cursor: pointer;\n    border: 2px solid rgba(255, 255, 255, 0.2);\n    box-shadow: 0 2px 6px rgba(147, 112, 219, 0.4);\n}\n\n.lumia-drawer-vpos-value {\n    font-size: 0.75rem;\n    font-weight: 600;\n    color: rgba(147, 112, 219, 0.9);\n    min-width: 32px;\n    text-align: right;\n}\n\n/* Mode toggles container */\n.lumia-mode-toggles {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n    margin-bottom: 16px;\n    padding-bottom: 14px;\n    border-bottom: 1px solid rgba(147, 112, 219, 0.12);\n}\n\n/* Mode toggle row */\n.lumiverse-mode-toggle {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 10px 12px;\n    background: rgba(28, 24, 38, 0.4);\n    border: 1px solid rgba(147, 112, 219, 0.1);\n    border-radius: 10px;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-mode-toggle:hover {\n    background: rgba(147, 112, 219, 0.08);\n    border-color: rgba(147, 112, 219, 0.2);\n}\n\n.lumiverse-mode-toggle--disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n    pointer-events: none;\n}\n\n.lumiverse-mode-toggle-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 32px;\n    height: 32px;\n    background: rgba(147, 112, 219, 0.15);\n    border-radius: 8px;\n    flex-shrink: 0;\n}\n\n.lumiverse-mode-toggle-icon svg {\n    width: 18px;\n    height: 18px;\n    color: var(--lumiverse-primary);\n}\n\n.lumiverse-mode-toggle-text {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n    min-width: 0;\n}\n\n.lumiverse-mode-toggle-label {\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-mode-toggle-description {\n    font-size: 11px;\n    color: var(--lumiverse-muted);\n    line-height: 1.3;\n}\n\n/* Small toggle variant */\n.lumiverse-toggle--sm {\n    width: 36px;\n    height: 20px;\n    flex-shrink: 0;\n}\n\n.lumiverse-toggle--sm .lumiverse-toggle-slider {\n    width: 16px;\n    height: 16px;\n    top: 2px;\n    left: 2px;\n}\n\n.lumiverse-toggle--sm.lumiverse-toggle--on .lumiverse-toggle-slider {\n    transform: translateX(16px);\n}\n\n/* ----------------------------------------\n   Buttons - Apple-esque with gradients\n   ---------------------------------------- */\n.lumiverse-btn {\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    gap: 8px;\n    padding: 10px 16px;\n    font-size: 13px;\n    font-weight: 500;\n    font-family: inherit;\n    border-radius: var(--lumiverse-radius);\n    border: none;\n    cursor: pointer;\n    transition: all var(--lumiverse-transition);\n    white-space: nowrap;\n}\n\n.lumiverse-btn svg {\n    width: 16px;\n    height: 16px;\n    flex-shrink: 0;\n}\n\n.lumiverse-btn--primary {\n    background: linear-gradient(\n        135deg,\n        rgba(147, 112, 219, 0.9) 0%,\n        rgba(123, 95, 196, 0.9) 100%\n    );\n    color: white;\n}\n\n.lumiverse-btn--primary:hover {\n    background: linear-gradient(\n        135deg,\n        rgba(167, 132, 239, 0.95) 0%,\n        rgba(143, 115, 216, 0.95) 100%\n    );\n    transform: translateY(-1px);\n}\n\n.lumiverse-btn--secondary {\n    background: rgba(128, 128, 128, 0.15);\n    border: 1px solid rgba(128, 128, 128, 0.25);\n    color: rgba(255, 255, 255, 0.85);\n}\n\n.lumiverse-btn--secondary:hover {\n    background: rgba(128, 128, 128, 0.25);\n    border-color: rgba(147, 112, 219, 0.3);\n}\n\n.lumiverse-btn--danger {\n    background: linear-gradient(\n        135deg,\n        rgba(239, 68, 68, 0.9) 0%,\n        rgba(220, 38, 38, 0.9) 100%\n    );\n    color: white;\n}\n\n.lumiverse-btn--danger:hover {\n    background: linear-gradient(\n        135deg,\n        rgba(248, 113, 113, 0.95) 0%,\n        rgba(239, 68, 68, 0.95) 100%\n    );\n    transform: translateY(-1px);\n}\n\n.lumiverse-btn--icon {\n    padding: 6px;\n    min-width: auto;\n    background: transparent;\n    border: none;\n}\n\n.lumiverse-btn--icon:hover {\n    background: rgba(147, 112, 219, 0.15);\n}\n\n.lumiverse-btn-full {\n    width: 100%;\n}\n\n.lumiverse-btn-sm {\n    padding: 6px 12px;\n    font-size: 12px;\n    background: rgba(147, 112, 219, 0.15);\n    border: 1px solid rgba(147, 112, 219, 0.25);\n    color: var(--lumiverse-primary-text);\n}\n\n.lumiverse-btn-sm:hover {\n    background: rgba(147, 112, 219, 0.25);\n    border-color: rgba(147, 112, 219, 0.4);\n}\n\n/* ----------------------------------------\n   Selection Row\n   ---------------------------------------- */\n.lumiverse-selection-row {\n    display: flex;\n    align-items: center;\n    margin-bottom: 12px;\n}\n\n.lumiverse-selection-label {\n    width: 100px;\n    flex-shrink: 0;\n    font-weight: 500;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-selection-button {\n    flex: 1;\n    display: flex;\n    align-items: center;\n    padding: 10px 14px;\n    background: var(--lumiverse-bg-elevated);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    color: var(--lumiverse-text);\n    cursor: pointer;\n    transition: all var(--lumiverse-transition);\n}\n\n.lumiverse-selection-button:hover {\n    background: var(--lumiverse-bg-hover);\n    border-color: var(--lumiverse-border-light);\n}\n\n.lumiverse-selection-text {\n    flex: 1;\n    text-align: left;\n}\n\n.lumiverse-selection-dominant {\n    font-size: 12px;\n    color: var(--lumiverse-warning);\n    margin-left: 8px;\n}\n\n.lumiverse-selection-arrow {\n    margin-left: 8px;\n    color: var(--lumiverse-text-muted);\n}\n\n/* ----------------------------------------\n   Stats Bar\n   ---------------------------------------- */\n.lumiverse-stats {\n    display: flex;\n    align-items: center;\n    padding: 8px 12px;\n    margin-bottom: 16px;\n    background: var(--lumiverse-primary-light);\n    border-radius: var(--lumiverse-radius);\n    font-size: 13px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-stats-divider {\n    margin: 0 8px;\n}\n\n/* ----------------------------------------\n   Radio Group\n   ---------------------------------------- */\n.lumiverse-radio-group {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n    margin-top: 12px;\n}\n\n.lumiverse-radio {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    cursor: pointer;\n}\n\n.lumiverse-radio input[type="radio"] {\n    accent-color: var(--lumiverse-primary);\n}\n\n/* ----------------------------------------\n   Number Input\n   ---------------------------------------- */\n.lumiverse-number-wrapper {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n    margin-top: 12px;\n}\n\n.lumiverse-number-label {\n    font-weight: 500;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-number-input {\n    width: 80px;\n    padding: 8px 12px;\n    background: var(--lumiverse-bg-elevated);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    color: var(--lumiverse-text);\n    font-size: 14px;\n}\n\n.lumiverse-number-input:focus {\n    outline: none;\n    border-color: var(--lumiverse-primary);\n}\n\n/* ----------------------------------------\n   Pack Actions & List\n   ---------------------------------------- */\n.lumiverse-pack-actions {\n    display: flex;\n    gap: 8px;\n    margin-bottom: 16px;\n}\n\n.lumiverse-custom-packs h4 {\n    margin: 0 0 12px 0;\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--lumiverse-text-muted);\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n.lumiverse-pack-item {\n    display: flex;\n    align-items: center;\n    padding: 10px 12px;\n    background: var(--lumiverse-bg-elevated);\n    border-radius: var(--lumiverse-radius);\n    margin-bottom: 8px;\n}\n\n.lumiverse-pack-name {\n    flex: 1;\n    font-weight: 500;\n}\n\n.lumiverse-pack-count {\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n    margin-right: 8px;\n}\n\n/* ----------------------------------------\n   Loom Selections\n   ---------------------------------------- */\n.lumiverse-loom-selections {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n    margin-top: 12px;\n}\n\n/* ----------------------------------------\n   Modal Styles\n   ---------------------------------------- */\n.lumiverse-modal-backdrop {\n    position: fixed;\n    inset: 0;\n    background: rgba(0, 0, 0, 0.7);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    z-index: 10000;\n    padding: 16px;\n    box-sizing: border-box;\n}\n\n.lumiverse-modal {\n    background: var(--lumiverse-bg);\n    border-radius: var(--lumiverse-radius-lg);\n    border: 1px solid var(--lumiverse-border);\n    box-shadow: var(--lumiverse-shadow-lg);\n    max-height: 80vh;\n    display: flex;\n    flex-direction: column;\n    overflow: hidden;\n    min-height: 0; /* Critical: allows flex children to shrink below content size */\n}\n\n.lumiverse-modal--small {\n    width: 400px;\n}\n\n.lumiverse-modal--medium {\n    width: 560px;\n}\n\n.lumiverse-modal--large {\n    width: 800px;\n    max-width: 90vw;\n}\n\n/* Editor modals need their content to scroll, not the modal wrapper */\n.lumiverse-modal-lumia-editor,\n.lumiverse-modal-loom-editor,\n.lumiverse-modal-pack-editor {\n    min-height: 0; /* Ensure scrolling works in nested flex */\n}\n\n/* Mobile responsiveness for modals */\n@media (max-width: 600px) {\n    .lumiverse-modal-backdrop {\n        padding: 12px;\n        align-items: flex-start; /* Align to top on mobile for long modals */\n        padding-top: max(12px, env(safe-area-inset-top));\n        padding-bottom: max(12px, env(safe-area-inset-bottom));\n    }\n\n    .lumiverse-modal {\n        width: calc(100vw - 24px);\n        max-width: calc(100vw - 24px);\n        max-height: calc(100dvh - 24px);\n        max-height: calc(100vh - 24px); /* Fallback */\n        margin: auto;\n    }\n\n    .lumiverse-modal--small,\n    .lumiverse-modal--medium,\n    .lumiverse-modal--large {\n        width: calc(100vw - 24px);\n        max-width: calc(100vw - 24px);\n    }\n\n    /* Editor modals on mobile - maximize usable space */\n    .lumiverse-modal-lumia-editor,\n    .lumiverse-modal-loom-editor,\n    .lumiverse-modal-pack-editor {\n        max-height: calc(100dvh - 24px);\n        height: auto; /* Content determines height */\n        overflow: hidden; /* Contain the flex layout */\n    }\n}\n\n.lumiverse-modal-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 16px 20px;\n    background: var(--lumiverse-bg-elevated);\n    border-bottom: 1px solid var(--lumiverse-border);\n    flex-shrink: 0;\n}\n\n.lumiverse-modal-title {\n    margin: 0;\n    font-size: 18px;\n    font-weight: 600;\n}\n\n.lumiverse-modal-close {\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text-muted);\n    font-size: 18px;\n    cursor: pointer;\n    padding: 4px 8px;\n    border-radius: var(--lumiverse-radius-sm);\n    transition: all var(--lumiverse-transition);\n}\n\n.lumiverse-modal-close:hover {\n    background: var(--lumiverse-bg-hover);\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-modal-body {\n    flex: 1;\n    overflow: hidden;\n    display: flex;\n    flex-direction: column;\n    min-height: 0;\n}\n\n/* ----------------------------------------\n   Selection Modal\n   ---------------------------------------- */\n.lumiverse-selection-modal {\n    display: flex;\n    flex-direction: column;\n    height: 100%;\n}\n\n.lumiverse-selection-toolbar {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 12px 16px;\n    background: var(--lumiverse-bg-elevated);\n    border-bottom: 1px solid var(--lumiverse-border);\n}\n\n.lumiverse-selection-count {\n    font-size: 13px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-dominant-indicator {\n    margin-left: 8px;\n    color: var(--lumiverse-warning);\n}\n\n.lumiverse-selection-content {\n    flex: 1;\n    overflow-y: auto;\n    padding: 16px;\n}\n\n.lumiverse-selection-footer {\n    padding: 12px 16px;\n    background: var(--lumiverse-bg-elevated);\n    border-top: 1px solid var(--lumiverse-border);\n    display: flex;\n    justify-content: flex-end;\n}\n\n/* ----------------------------------------\n   Search Input\n   ---------------------------------------- */\n.lumiverse-search {\n    display: flex;\n    align-items: center;\n    background: var(--lumiverse-bg);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    padding: 0 12px;\n    flex: 1;\n    max-width: 300px;\n}\n\n.lumiverse-search-icon {\n    font-size: 14px;\n    margin-right: 8px;\n}\n\n.lumiverse-search-input {\n    flex: 1;\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text);\n    padding: 8px 0;\n    font-size: 14px;\n}\n\n.lumiverse-search-input:focus {\n    outline: none;\n}\n\n.lumiverse-search-input::placeholder {\n    color: var(--lumiverse-text-dim);\n}\n\n.lumiverse-search-clear {\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    padding: 2px 6px;\n}\n\n/* ----------------------------------------\n   Pack Section (in modals)\n   ---------------------------------------- */\n.lumiverse-pack-section {\n    margin-bottom: 16px;\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    overflow: hidden;\n}\n\n.lumiverse-pack-header {\n    display: flex;\n    align-items: center;\n    width: 100%;\n    padding: 12px 14px;\n    background: var(--lumiverse-bg-elevated);\n    border: none;\n    color: var(--lumiverse-text);\n    cursor: pointer;\n    transition: background var(--lumiverse-transition);\n}\n\n.lumiverse-pack-header:hover {\n    background: var(--lumiverse-bg-hover);\n}\n\n.lumiverse-pack-cover {\n    width: 40px;\n    height: 40px;\n    border-radius: var(--lumiverse-radius-sm);\n    object-fit: cover;\n    margin-right: 12px;\n}\n\n.lumiverse-pack-info {\n    flex: 1;\n    text-align: left;\n}\n\n.lumiverse-pack-meta {\n    display: flex;\n    gap: 12px;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n    margin-top: 2px;\n}\n\n.lumiverse-pack-chevron {\n    font-size: 10px;\n    color: var(--lumiverse-text-muted);\n    transition: transform var(--lumiverse-transition);\n}\n\n.lumiverse-pack-chevron.rotated {\n    transform: rotate(180deg);\n}\n\n.lumiverse-pack-items {\n    padding: 8px;\n    background: var(--lumiverse-bg);\n}\n\n/* ----------------------------------------\n   Selectable Item\n   ---------------------------------------- */\n.lumiverse-selectable-item {\n    display: flex;\n    align-items: flex-start;\n    padding: 12px;\n    background: var(--lumiverse-bg-elevated);\n    border: 1px solid transparent;\n    border-radius: var(--lumiverse-radius);\n    margin-bottom: 8px;\n    cursor: pointer;\n    transition: all var(--lumiverse-transition);\n}\n\n.lumiverse-selectable-item:hover {\n    background: var(--lumiverse-bg-hover);\n}\n\n.lumiverse-selectable-item--selected {\n    border-color: var(--lumiverse-primary);\n    background: var(--lumiverse-primary-light);\n}\n\n.lumiverse-selectable-item--dominant {\n    border-color: var(--lumiverse-warning);\n}\n\n.lumiverse-item-image {\n    width: 48px;\n    height: 48px;\n    border-radius: var(--lumiverse-radius);\n    overflow: hidden;\n    margin-right: 12px;\n    flex-shrink: 0;\n    background: var(--lumiverse-bg);\n}\n\n.lumiverse-item-image img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n}\n\n.lumiverse-item-content {\n    flex: 1;\n    min-width: 0;\n}\n\n.lumiverse-item-header {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n}\n\n.lumiverse-item-name {\n    font-weight: 500;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-dominant-btn {\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text-dim);\n    font-size: 14px;\n    cursor: pointer;\n    padding: 2px 4px;\n    transition: color var(--lumiverse-transition);\n}\n\n.lumiverse-dominant-btn:hover {\n    color: var(--lumiverse-warning);\n}\n\n.lumiverse-dominant-btn--active {\n    color: var(--lumiverse-warning);\n}\n\n.lumiverse-item-description {\n    margin: 4px 0 0 0;\n    font-size: 13px;\n    color: var(--lumiverse-text-muted);\n    overflow: hidden;\n    text-overflow: ellipsis;\n    display: -webkit-box;\n    -webkit-line-clamp: 2;\n    -webkit-box-orient: vertical;\n}\n\n.lumiverse-item-checkbox {\n    margin-left: 12px;\n    flex-shrink: 0;\n}\n\n.lumiverse-checkbox {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 20px;\n    height: 20px;\n    border: 2px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius-sm);\n    color: transparent;\n    font-size: 12px;\n    transition: all var(--lumiverse-transition);\n}\n\n.lumiverse-checkbox.checked {\n    background: var(--lumiverse-primary);\n    border-color: var(--lumiverse-primary);\n    color: white;\n}\n\n.lumiverse-radio-dot {\n    width: 20px;\n    height: 20px;\n    border: 2px solid var(--lumiverse-border);\n    border-radius: 50%;\n    position: relative;\n}\n\n.lumiverse-radio-dot.checked::after {\n    content: '';\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    width: 10px;\n    height: 10px;\n    background: var(--lumiverse-primary);\n    border-radius: 50%;\n}\n\n/* ----------------------------------------\n   Empty State\n   ---------------------------------------- */\n.lumiverse-empty-state {\n    text-align: center;\n    padding: 40px 20px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-empty-icon {\n    font-size: 48px;\n    display: block;\n    margin-bottom: 16px;\n}\n\n.lumiverse-empty-state p {\n    margin: 0 0 8px 0;\n}\n\n.lumiverse-empty-hint {\n    font-size: 13px;\n    color: var(--lumiverse-text-dim);\n}\n\n/* ----------------------------------------\n   Pack Editor Modal\n   ---------------------------------------- */\n.lumiverse-pack-editor-modal {\n    display: flex;\n    flex-direction: column;\n    height: 100%;\n}\n\n.lumiverse-pack-editor-content {\n    flex: 1;\n    overflow-y: auto;\n    padding: 20px;\n}\n\n.lumiverse-pack-metadata {\n    margin-bottom: 24px;\n}\n\n.lumiverse-pack-metadata h3,\n.lumiverse-pack-items-header h3 {\n    margin: 0 0 16px 0;\n    font-size: 16px;\n    font-weight: 600;\n}\n\n.lumiverse-pack-items-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    margin-bottom: 16px;\n}\n\n.lumiverse-pack-items-list {\n    display: flex;\n    flex-direction: column;\n    gap: 16px;\n}\n\n.lumiverse-pack-editor-footer {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 16px 20px;\n    background: var(--lumiverse-bg-elevated);\n    border-top: 1px solid var(--lumiverse-border);\n}\n\n.lumiverse-pack-editor-actions {\n    display: flex;\n    gap: 8px;\n}\n\n/* ----------------------------------------\n   Form Fields\n   ---------------------------------------- */\n.lumiverse-form-field {\n    margin-bottom: 16px;\n}\n\n.lumiverse-form-field--error .lumiverse-input,\n.lumiverse-form-field--error .lumiverse-textarea {\n    border-color: var(--lumiverse-danger);\n}\n\n.lumiverse-form-label {\n    display: block;\n    margin-bottom: 6px;\n    font-weight: 500;\n    font-size: 13px;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-required {\n    color: var(--lumiverse-danger);\n    margin-left: 2px;\n}\n\n.lumiverse-form-error {\n    display: block;\n    margin-top: 4px;\n    font-size: 12px;\n    color: var(--lumiverse-danger);\n}\n\n.lumiverse-input,\n.lumiverse-textarea,\n.lumiverse-select {\n    width: 100%;\n    padding: 10px 12px;\n    background: var(--lumiverse-bg-elevated);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    color: var(--lumiverse-text);\n    font-size: 14px;\n    font-family: inherit;\n    transition: border-color var(--lumiverse-transition);\n}\n\n.lumiverse-input:focus,\n.lumiverse-textarea:focus,\n.lumiverse-select:focus {\n    outline: none;\n    border-color: var(--lumiverse-primary);\n}\n\n.lumiverse-textarea {\n    resize: vertical;\n    min-height: 80px;\n}\n\n.lumiverse-select {\n    cursor: pointer;\n}\n\n/* ----------------------------------------\n   Image Input\n   ---------------------------------------- */\n.lumiverse-image-input {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumiverse-image-preview {\n    width: 100px;\n    height: 100px;\n    border-radius: var(--lumiverse-radius);\n    overflow: hidden;\n    background: var(--lumiverse-bg);\n}\n\n.lumiverse-image-preview img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n}\n\n.lumiverse-image-error {\n    font-size: 12px;\n    color: var(--lumiverse-danger);\n}\n\n/* ----------------------------------------\n   Lumia Item Editor\n   ---------------------------------------- */\n.lumiverse-lumia-editor {\n    background: var(--lumiverse-bg-elevated);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    padding: 16px;\n}\n\n.lumiverse-lumia-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    margin-bottom: 16px;\n    padding-bottom: 12px;\n    border-bottom: 1px solid var(--lumiverse-border);\n}\n\n.lumiverse-lumia-type {\n    font-size: 12px;\n    font-weight: 600;\n    text-transform: uppercase;\n    color: var(--lumiverse-primary);\n    background: var(--lumiverse-primary-light);\n    padding: 4px 8px;\n    border-radius: var(--lumiverse-radius-sm);\n}\n\n.lumiverse-lumia-fields {\n    display: grid;\n    gap: 12px;\n}\n\n/* ----------------------------------------\n   Loading & Error States\n   ---------------------------------------- */\n.lumiverse-loading-overlay {\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background: rgba(0, 0, 0, 0.5);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    z-index: 10001;\n}\n\n.lumiverse-spinner {\n    width: 40px;\n    height: 40px;\n    border: 3px solid var(--lumiverse-border);\n    border-top-color: var(--lumiverse-primary);\n    border-radius: 50%;\n    animation: lumiverse-spin 0.8s linear infinite;\n}\n\n@keyframes lumiverse-spin {\n    to {\n        transform: rotate(360deg);\n    }\n}\n\n.lumiverse-error-toast {\n    position: fixed;\n    bottom: 20px;\n    right: 20px;\n    display: flex;\n    align-items: center;\n    gap: 12px;\n    padding: 12px 16px;\n    background: var(--lumiverse-danger);\n    color: white;\n    border-radius: var(--lumiverse-radius);\n    box-shadow: var(--lumiverse-shadow-lg);\n    z-index: 10002;\n    cursor: pointer;\n}\n\n.lumiverse-error-dismiss {\n    background: rgba(255, 255, 255, 0.2);\n    border: none;\n    color: white;\n    padding: 4px 8px;\n    border-radius: var(--lumiverse-radius-sm);\n    font-size: 12px;\n    cursor: pointer;\n}\n\n/* ----------------------------------------\n   Header Badge\n   ---------------------------------------- */\n.lumiverse-header-badge {\n    font-size: 10px;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    padding: 4px 8px;\n    background: var(--lumiverse-primary-light);\n    color: var(--lumiverse-primary);\n    border-radius: var(--lumiverse-radius-sm);\n}\n\n/* ----------------------------------------\n   Selector Components - Matching old lumia-selector pattern\n   ---------------------------------------- */\n.lumiverse-selector {\n    background: rgba(0, 0, 0, 0.15);\n    border: 1px solid rgba(128, 128, 128, 0.12);\n    border-radius: var(--lumiverse-radius-md);\n    padding: 12px 14px;\n    transition: all var(--lumiverse-transition);\n}\n\n.lumiverse-selector:hover {\n    border-color: rgba(147, 112, 219, 0.2);\n    background: rgba(0, 0, 0, 0.2);\n}\n\n.lumiverse-selector-group {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n}\n\n.lumiverse-selector-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    margin-bottom: 8px;\n}\n\n.lumiverse-selector-label {\n    font-size: 12px;\n    font-weight: 600;\n    color: rgba(255, 255, 255, 0.8);\n    letter-spacing: 0.1px;\n}\n\n.lumiverse-selector-hint {\n    font-size: 10px;\n    font-weight: 500;\n    color: rgba(147, 112, 219, 0.6);\n    text-transform: uppercase;\n    letter-spacing: 0.3px;\n}\n\n.lumiverse-selector-row {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n}\n\n.lumiverse-selector-value {\n    flex: 1;\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--lumiverse-text-muted);\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n    min-width: 0;\n    display: flex;\n    align-items: center;\n    gap: 8px;\n}\n\n.lumiverse-dominant-badge {\n    font-size: 11px;\n    color: var(--lumiverse-warning);\n    background: rgba(245, 158, 11, 0.15);\n    padding: 3px 8px;\n    border-radius: var(--lumiverse-radius-sm);\n    border: 1px solid rgba(245, 158, 11, 0.25);\n}\n\n/* ----------------------------------------\n   Tool Buttons - Grid layout with accent styling\n   ---------------------------------------- */\n.lumiverse-tools-row {\n    display: grid;\n    grid-template-columns: repeat(2, 1fr);\n    gap: 10px;\n}\n\n.lumiverse-tool-btn {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    gap: 8px;\n    padding: 16px 12px;\n    background: rgba(0, 0, 0, 0.15);\n    border: 1px solid rgba(128, 128, 128, 0.12);\n    border-radius: var(--lumiverse-radius-md);\n    color: rgba(255, 255, 255, 0.75);\n    font-size: 12px;\n    font-weight: 500;\n    font-family: inherit;\n    cursor: pointer;\n    transition: all var(--lumiverse-transition);\n}\n\n.lumiverse-tool-icon {\n    font-size: 18px;\n    transition: transform var(--lumiverse-transition);\n}\n\n.lumiverse-tool-btn:hover {\n    background: rgba(147, 112, 219, 0.1);\n    border-color: rgba(147, 112, 219, 0.25);\n}\n\n.lumiverse-tool-btn:hover .lumiverse-tool-icon {\n    transform: scale(1.1);\n}\n\n.lumiverse-tool-btn-accent {\n    background: linear-gradient(\n        135deg,\n        rgba(147, 112, 219, 0.2) 0%,\n        rgba(123, 95, 196, 0.15) 100%\n    );\n    border-color: rgba(147, 112, 219, 0.35);\n    color: var(--lumiverse-primary-text);\n}\n\n.lumiverse-tool-btn-accent:hover {\n    background: linear-gradient(\n        135deg,\n        rgba(147, 112, 219, 0.3) 0%,\n        rgba(123, 95, 196, 0.25) 100%\n    );\n    border-color: rgba(147, 112, 219, 0.5);\n}\n\n.lumiverse-tool-icon {\n    font-size: 16px;\n}\n\n/* ----------------------------------------\n   Macro Reference - Matching old lumia-macro pattern\n   ---------------------------------------- */\n.lumiverse-macro-reference {\n    display: flex;\n    flex-direction: column;\n    gap: 14px;\n}\n\n.lumiverse-macro-group {\n    display: flex;\n    flex-direction: column;\n    gap: 6px;\n}\n\n.lumiverse-macro-group-title {\n    font-size: 10px;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    color: rgba(147, 112, 219, 0.7);\n    margin-bottom: 2px;\n}\n\n.lumiverse-macro-list {\n    display: flex;\n    flex-direction: column;\n    gap: 4px;\n}\n\n.lumiverse-macro {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 6px 0;\n    cursor: pointer;\n    transition: all var(--lumiverse-transition);\n}\n\n.lumiverse-macro:hover {\n    opacity: 0.85;\n}\n\n.lumiverse-macro--copied {\n    opacity: 1;\n}\n\n.lumiverse-macro--copied code {\n    background: rgba(147, 112, 219, 0.25);\n    border-color: rgba(147, 112, 219, 0.4);\n}\n\n.lumiverse-macro code {\n    font-family: var(--lumiverse-font-mono);\n    font-size: 11px;\n    padding: 4px 8px;\n    background: rgba(0, 0, 0, 0.3);\n    border: 1px solid rgba(128, 128, 128, 0.15);\n    border-radius: var(--lumiverse-radius-sm);\n    color: var(--lumiverse-primary-text);\n    white-space: nowrap;\n    transition: all var(--lumiverse-transition);\n}\n\n.lumiverse-macro span {\n    font-size: 12px;\n    color: rgba(255, 255, 255, 0.55);\n}\n\n/* ----------------------------------------\n   Status Badge - Pack count indicator\n   ---------------------------------------- */\n.lumiverse-status-badge {\n    display: inline-flex;\n    align-items: center;\n    padding: 6px 12px;\n    margin-bottom: 12px;\n    background: rgba(147, 112, 219, 0.1);\n    border: 1px solid rgba(147, 112, 219, 0.2);\n    border-radius: 20px;\n    font-size: 12px;\n    font-weight: 500;\n    color: var(--lumiverse-primary-text);\n    letter-spacing: 0.1px;\n}\n\n/* ----------------------------------------\n   Divider - Matching old lumia-divider-text\n   ---------------------------------------- */\n.lumiverse-divider-text {\n    text-align: center;\n    font-size: 11px;\n    font-weight: 500;\n    color: rgba(255, 255, 255, 0.3);\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    margin: 12px 0;\n    position: relative;\n}\n\n.lumiverse-divider-text::before,\n.lumiverse-divider-text::after {\n    content: '';\n    position: absolute;\n    top: 50%;\n    width: calc(50% - 20px);\n    height: 1px;\n    background: rgba(128, 128, 128, 0.2);\n}\n\n.lumiverse-divider-text::before {\n    left: 0;\n}\n\n.lumiverse-divider-text::after {\n    right: 0;\n}\n\n/* ----------------------------------------\n   Input Row and Input Styling\n   ---------------------------------------- */\n.lumiverse-input-row {\n    display: flex;\n    gap: 8px;\n    margin-bottom: 10px;\n}\n\n.lumiverse-input {\n    flex: 1;\n    padding: 10px 14px;\n    background: rgba(0, 0, 0, 0.25);\n    border: 1px solid rgba(128, 128, 128, 0.2);\n    border-radius: var(--lumiverse-radius);\n    font-size: 13px;\n    color: var(--lumiverse-text);\n    font-family: inherit;\n    transition: all var(--lumiverse-transition);\n}\n\n.lumiverse-input::placeholder {\n    color: rgba(255, 255, 255, 0.35);\n}\n\n.lumiverse-input:focus {\n    outline: none;\n    border-color: rgba(147, 112, 219, 0.5);\n    background: rgba(0, 0, 0, 0.35);\n}\n\n/* ----------------------------------------\n   Custom Packs List\n   ---------------------------------------- */\n.lumiverse-custom-packs {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n/* ----------------------------------------\n   Loom Selection Modal\n   ---------------------------------------- */\n.lumiverse-loom-selection-modal {\n    display: flex;\n    flex-direction: column;\n    height: 100%;\n}\n\n.lumiverse-selection-actions {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n}\n\n.lumiverse-loom-item {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 12px 16px;\n    background: var(--lumiverse-bg-tertiary);\n    border-radius: var(--lumiverse-radius-sm);\n    cursor: pointer;\n    transition: all var(--lumiverse-transition);\n    border: 1px solid transparent;\n}\n\n.lumiverse-loom-item:hover {\n    background: var(--lumiverse-bg-secondary);\n    border-color: var(--lumiverse-border-light);\n}\n\n.lumiverse-loom-item--selected {\n    background: rgba(var(--lumiverse-primary-rgb, 147, 112, 219), 0.15);\n    border-color: var(--lumiverse-primary);\n}\n\n.lumiverse-loom-item-content {\n    flex: 1;\n}\n\n.lumiverse-loom-item-name {\n    font-weight: 500;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-loom-item-actions {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    margin-left: auto;\n}\n\n.lumiverse-loom-item-toggle {\n    margin-left: 0;\n}\n\n.lumiverse-loom-item-edit {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 24px;\n    height: 24px;\n    padding: 0;\n    background: rgba(128, 128, 128, 0.15);\n    border: 1px solid rgba(128, 128, 128, 0.15);\n    border-radius: var(--lumiverse-radius-sm);\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    transition: all 0.15s ease;\n    flex-shrink: 0;\n}\n\n.lumiverse-loom-item-edit:hover {\n    background: rgba(100, 149, 237, 0.25);\n    border-color: rgba(100, 149, 237, 0.3);\n    color: rgba(130, 179, 255, 0.95);\n}\n\n.lumiverse-toggle-switch {\n    position: relative;\n    width: 40px;\n    height: 22px;\n}\n\n.lumiverse-toggle-track {\n    width: 100%;\n    height: 100%;\n    background: var(--lumiverse-bg-secondary);\n    border: 2px solid var(--lumiverse-border);\n    border-radius: 11px;\n    transition: all var(--lumiverse-transition);\n}\n\n.lumiverse-toggle-switch.checked .lumiverse-toggle-track {\n    background: var(--lumiverse-primary);\n    border-color: var(--lumiverse-primary);\n}\n\n.lumiverse-toggle-thumb {\n    position: absolute;\n    top: 3px;\n    left: 3px;\n    width: 16px;\n    height: 16px;\n    background: white;\n    border-radius: 50%;\n    transition: transform var(--lumiverse-transition);\n}\n\n.lumiverse-toggle-switch.checked .lumiverse-toggle-thumb {\n    transform: translateX(18px);\n}\n\n/* Selection footer for Loom modals */\n.lumiverse-selection-footer {\n    display: flex;\n    justify-content: flex-end;\n    padding: 16px;\n    border-top: 1px solid var(--lumiverse-border);\n    margin-top: auto;\n}\n\n/* Text button style */\n.lumiverse-btn--text {\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text-muted);\n    padding: 4px 8px;\n}\n\n.lumiverse-btn--text:hover {\n    color: var(--lumiverse-text);\n    background: var(--lumiverse-bg-tertiary);\n}\n\n/* Pack section improvements for Loom modal */\n.lumiverse-pack-icon {\n    margin-right: 8px;\n}\n\n/* Ensure pack items have proper spacing */\n.lumiverse-pack-items {\n    display: flex;\n    flex-direction: column;\n    gap: 4px;\n    padding: 12px;\n    background: var(--lumiverse-bg-secondary);\n    border-radius: 0 0 var(--lumiverse-radius) var(--lumiverse-radius);\n}\n\n/* Pack section collapsed state */\n.lumiverse-pack-section.collapsed .lumiverse-pack-items {\n    display: none;\n}\n\n/* Custom pack badge */\n.lumiverse-pack-badge-custom {\n    font-size: 10px;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    padding: 2px 6px;\n    background: rgba(var(--lumiverse-primary-rgb, 147, 112, 219), 0.2);\n    color: var(--lumiverse-primary);\n    border-radius: 4px;\n    margin-left: 8px;\n}\n\n/* Small icon button */\n.lumiverse-icon-btn-sm {\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    width: 28px;\n    height: 28px;\n    padding: 0;\n    background: transparent;\n    border: none;\n    border-radius: 6px;\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    transition: all 0.15s ease;\n    margin-left: auto;\n    flex-shrink: 0;\n}\n\n.lumiverse-icon-btn-sm:hover {\n    color: var(--lumiverse-danger, #ef4444);\n    background: rgba(239, 68, 68, 0.1);\n}\n\n.lumiverse-icon-btn-sm svg,\n.lumiverse-icon-sm svg {\n    width: 16px;\n    height: 16px;\n}\n\n.lumiverse-icon-sm {\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n}\n\n/* ============================================\n   LOOM MODAL CONTROLS - Collapse/Expand & Sort\n   ============================================ */\n\n.lumiverse-modal-controls {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    gap: 12px;\n    padding: 12px 16px;\n    background: var(--lumiverse-bg-elevated, #1a1a1a);\n    border-bottom: 1px solid var(--lumiverse-border);\n}\n\n.lumiverse-modal-controls-group {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n}\n\n.lumiverse-modal-control-btn {\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    gap: 6px;\n    padding: 8px 12px;\n    font-size: 12px;\n    font-weight: 500;\n    color: var(--lumiverse-text-secondary, #999);\n    background: var(--lumiverse-bg-tertiary, #2a2a2a);\n    border: 1px solid var(--lumiverse-border, #3a3a3a);\n    border-radius: 8px;\n    cursor: pointer;\n    transition: all 0.15s ease;\n    white-space: nowrap;\n}\n\n.lumiverse-modal-control-btn:hover {\n    color: var(--lumiverse-text, #fff);\n    background: var(--lumiverse-bg-hover, #333);\n    border-color: var(--lumiverse-accent, #7c3aed);\n}\n\n.lumiverse-modal-control-btn:active {\n    transform: scale(0.97);\n}\n\n.lumiverse-control-icon,\n.lumiverse-control-icon svg {\n    width: 14px;\n    height: 14px;\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n}\n\n/* Sort Dropdown for Loom modals */\n.lumiverse-modal-sort {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    padding: 6px 12px;\n    background: var(--lumiverse-bg-tertiary, #2a2a2a);\n    border: 1px solid var(--lumiverse-border, #3a3a3a);\n    border-radius: 8px;\n}\n\n.lumiverse-modal-sort-label {\n    font-size: 12px;\n    font-weight: 500;\n    color: var(--lumiverse-text-muted, #666);\n}\n\n.lumiverse-select {\n    padding: 4px 8px;\n    font-size: 12px;\n    font-weight: 500;\n    color: var(--lumiverse-text, #fff);\n    background: var(--lumiverse-bg-secondary, #1e1e1e);\n    border: 1px solid var(--lumiverse-border, #3a3a3a);\n    border-radius: 6px;\n    cursor: pointer;\n    transition: all 0.15s ease;\n    min-width: 100px;\n}\n\n.lumiverse-select:hover {\n    border-color: var(--lumiverse-border-hover, #4a4a4a);\n}\n\n.lumiverse-select:focus {\n    outline: none;\n    border-color: var(--lumiverse-accent, #7c3aed);\n    box-shadow: 0 0 0 2px rgba(124, 58, 237, 0.15);\n}\n\n/* Mobile adjustments for Loom modal controls */\n@media (max-width: 600px) {\n    .lumiverse-modal-controls {\n        flex-wrap: wrap;\n        gap: 8px;\n        padding: 10px 12px;\n    }\n\n    .lumiverse-modal-control-btn {\n        padding: 6px 10px;\n        font-size: 11px;\n    }\n\n    .lumiverse-modal-control-btn span {\n        display: none;\n    }\n\n    .lumiverse-modal-control-btn .lumiverse-control-icon {\n        margin: 0;\n    }\n\n    .lumiverse-modal-sort {\n        flex: 1;\n        min-width: 100%;\n        justify-content: space-between;\n    }\n\n    .lumiverse-select {\n        flex: 1;\n        min-width: 0;\n    }\n}\n\n/* ----------------------------------------\n   Pack Editor Modal\n   ---------------------------------------- */\n.lumiverse-pack-editor-modal {\n    display: flex;\n    flex-direction: column;\n    height: 100%;\n}\n\n.lumiverse-pack-editor-content {\n    flex: 1;\n    overflow-y: auto;\n    padding: 16px;\n    display: flex;\n    flex-direction: column;\n    gap: 24px;\n}\n\n.lumiverse-pack-metadata h3,\n.lumiverse-pack-items-section h3 {\n    margin: 0 0 16px 0;\n    font-size: 16px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-pack-items-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 16px;\n}\n\n.lumiverse-pack-items-header h3 {\n    margin: 0;\n}\n\n.lumiverse-pack-items-list {\n    display: flex;\n    flex-direction: column;\n    gap: 16px;\n}\n\n/* Lumia Item Editor */\n.lumiverse-lumia-editor {\n    background: var(--lumiverse-bg-tertiary);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    overflow: hidden;\n}\n\n.lumiverse-lumia-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 12px 16px;\n    background: var(--lumiverse-bg-secondary);\n    border-bottom: 1px solid var(--lumiverse-border);\n}\n\n.lumiverse-lumia-type {\n    font-size: 12px;\n    font-weight: 600;\n    text-transform: uppercase;\n    color: var(--lumiverse-text-muted);\n    background: var(--lumiverse-bg-primary);\n    padding: 4px 8px;\n    border-radius: var(--lumiverse-radius-sm);\n}\n\n.lumiverse-lumia-fields {\n    padding: 16px;\n    display: flex;\n    flex-direction: column;\n    gap: 16px;\n}\n\n/* Pack Editor Footer */\n.lumiverse-pack-editor-footer {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 16px;\n    border-top: 1px solid var(--lumiverse-border);\n    background: var(--lumiverse-bg-secondary);\n}\n\n.lumiverse-pack-editor-footer-left {\n    display: flex;\n    gap: 8px;\n    align-items: center;\n}\n\n.lumiverse-pack-editor-actions {\n    display: flex;\n    gap: 8px;\n    margin-left: auto;\n}\n\n/* Pack Editor Title */\n.lumiverse-pack-editor-title {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    margin-bottom: 20px;\n}\n\n.lumiverse-pack-editor-title h3 {\n    margin: 0;\n    font-size: 18px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-pack-editor-title svg {\n    color: var(--lumiverse-primary-text);\n}\n\n/* Pack Lumias Info Section */\n.lumiverse-pack-lumias-info {\n    background: var(--lumiverse-bg-tertiary);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    padding: 16px;\n}\n\n.lumiverse-pack-lumias-header {\n    margin-bottom: 8px;\n}\n\n.lumiverse-pack-lumias-count {\n    font-size: 14px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-pack-lumias-hint {\n    font-size: 13px;\n    color: var(--lumiverse-text-muted);\n    margin: 0 0 12px 0;\n}\n\n/* Full width button modifier */\n.lumiverse-btn--full {\n    width: 100%;\n    justify-content: center;\n}\n\n/* Form hint text */\n.lumiverse-form-hint {\n    display: block;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n    margin-top: 4px;\n    font-style: italic;\n}\n\n/* Lumia editor row (side-by-side fields) */\n.lumiverse-lumia-row {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 12px;\n}\n\n.lumiverse-lumia-row .lumiverse-form-field {\n    margin-bottom: 0;\n}\n\n/* Lumia name in header */\n.lumiverse-lumia-name {\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    font-size: 14px;\n}\n\n/* Clickable Lumia name (for opening full editor) */\n.lumiverse-lumia-name--clickable {\n    cursor: pointer;\n    transition: color 0.15s ease;\n}\n\n.lumiverse-lumia-name--clickable:hover {\n    color: var(--lumiverse-primary-text);\n}\n\n/* Header actions container */\n.lumiverse-lumia-header-actions {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n}\n\n/* Expand button in header */\n.lumiverse-btn--expand {\n    background: rgba(147, 112, 219, 0.1);\n    border: 1px solid rgba(147, 112, 219, 0.2);\n    color: var(--lumiverse-primary-text);\n    opacity: 0.7;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-btn--expand:hover {\n    background: rgba(147, 112, 219, 0.2);\n    opacity: 1;\n}\n\n/* Image Input */\n.lumiverse-image-input {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumiverse-image-preview {\n    width: 100px;\n    height: 100px;\n    border-radius: var(--lumiverse-radius);\n    overflow: hidden;\n    border: 1px solid var(--lumiverse-border);\n}\n\n.lumiverse-image-preview img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n}\n\n.lumiverse-image-error {\n    color: var(--lumiverse-danger);\n    font-size: 12px;\n}\n\n/* Danger button */\n.lumiverse-btn--danger {\n    background: transparent;\n    border: 1px solid var(--lumiverse-danger);\n    color: var(--lumiverse-danger);\n}\n\n.lumiverse-btn--danger:hover {\n    background: var(--lumiverse-danger);\n    color: white;\n}\n\n.lumiverse-btn--icon {\n    padding: 6px 8px;\n}\n\n/* Select input */\n.lumiverse-select {\n    width: 100%;\n    padding: 10px 12px;\n    background: var(--lumiverse-bg-tertiary);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius-sm);\n    color: var(--lumiverse-text);\n    font-size: 14px;\n    cursor: pointer;\n}\n\n.lumiverse-select:focus {\n    outline: none;\n    border-color: var(--lumiverse-primary);\n}\n\n/* Required asterisk */\n.lumiverse-required {\n    color: var(--lumiverse-danger);\n    margin-left: 4px;\n}\n\n/* ----------------------------------------\n   Pack Selector Modal\n   ---------------------------------------- */\n.lumia-modal-pack-selector {\n    max-width: 480px;\n    width: 90%;\n}\n\n.lumiverse-pack-selector-modal {\n    display: flex;\n    flex-direction: column;\n    max-height: 70vh;\n}\n\n.lumiverse-pack-selector-content {\n    flex: 1;\n    overflow-y: auto;\n    padding: 16px;\n}\n\n.lumiverse-pack-selector-section {\n    margin-bottom: 16px;\n}\n\n.lumiverse-pack-selector-heading {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    margin: 0 0 12px 0;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n.lumiverse-pack-selector-empty {\n    padding: 20px;\n    text-align: center;\n    color: var(--lumiverse-text-muted);\n    font-size: 13px;\n    background: var(--lumiverse-bg-tertiary);\n    border-radius: var(--lumiverse-radius);\n}\n\n.lumiverse-pack-selector-list {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumiverse-pack-selector-item {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n    padding: 12px 14px;\n    background: var(--lumiverse-bg-tertiary);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    cursor: pointer;\n    transition: all 0.15s ease;\n    text-align: left;\n    width: 100%;\n}\n\n.lumiverse-pack-selector-item:hover {\n    background: var(--lumiverse-bg-hover);\n    border-color: var(--lumiverse-primary);\n}\n\n.lumiverse-pack-selector-item-icon {\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-pack-selector-item-info {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n}\n\n.lumiverse-pack-selector-item-name {\n    font-weight: 500;\n    color: var(--lumiverse-text);\n    font-size: 14px;\n}\n\n.lumiverse-pack-selector-item-meta {\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-pack-selector-item-arrow {\n    color: var(--lumiverse-text-muted);\n    opacity: 0;\n    transition: opacity 0.15s ease;\n}\n\n.lumiverse-pack-selector-item:hover .lumiverse-pack-selector-item-arrow {\n    opacity: 1;\n}\n\n.lumiverse-pack-selector-divider {\n    display: flex;\n    align-items: center;\n    margin: 16px 0;\n    color: var(--lumiverse-text-muted);\n    font-size: 12px;\n}\n\n.lumiverse-pack-selector-divider::before,\n.lumiverse-pack-selector-divider::after {\n    content: '';\n    flex: 1;\n    height: 1px;\n    background: var(--lumiverse-border);\n}\n\n.lumiverse-pack-selector-divider span {\n    padding: 0 12px;\n}\n\n.lumiverse-pack-selector-create-btn {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 8px;\n    width: 100%;\n    padding: 14px;\n    background: transparent;\n    border: 2px dashed var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    color: var(--lumiverse-text-muted);\n    font-size: 14px;\n    cursor: pointer;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-pack-selector-create-btn:hover {\n    border-color: var(--lumiverse-primary);\n    color: var(--lumiverse-primary);\n    background: rgba(var(--lumiverse-primary-rgb), 0.05);\n}\n\n.lumiverse-pack-selector-form {\n    background: var(--lumiverse-bg-tertiary);\n    border-radius: var(--lumiverse-radius);\n    padding: 16px;\n}\n\n.lumiverse-pack-selector-field {\n    margin-bottom: 12px;\n}\n\n.lumiverse-pack-selector-field:last-of-type {\n    margin-bottom: 0;\n}\n\n.lumiverse-pack-selector-error {\n    color: var(--lumiverse-danger);\n    font-size: 12px;\n    margin: 8px 0;\n}\n\n.lumiverse-pack-selector-form-actions {\n    display: flex;\n    gap: 8px;\n    justify-content: flex-end;\n    margin-top: 16px;\n}\n\n.lumiverse-pack-selector-footer {\n    display: flex;\n    justify-content: flex-end;\n    padding: 12px 16px;\n    border-top: 1px solid var(--lumiverse-border);\n    background: var(--lumiverse-bg-secondary);\n}\n\n/* Pack Selector - Expandable Item Wrapper */\n.lumiverse-pack-selector-item-wrapper {\n    border-radius: var(--lumiverse-radius);\n    overflow: hidden;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-pack-selector-item-wrapper--expanded {\n    background: rgba(0, 0, 0, 0.15);\n    border: 1px solid var(--lumiverse-border);\n}\n\n.lumiverse-pack-selector-item-wrapper--expanded .lumiverse-pack-selector-item {\n    border-color: transparent;\n    border-radius: var(--lumiverse-radius) var(--lumiverse-radius) 0 0;\n}\n\n.lumiverse-pack-selector-item-wrapper--expanded .lumiverse-pack-selector-item-arrow {\n    opacity: 1;\n}\n\n/* Pack Selector - Expanded Lumias List */\n.lumiverse-pack-selector-lumias {\n    padding: 8px 12px 12px;\n    border-top: 1px solid var(--lumiverse-border-light);\n}\n\n.lumiverse-pack-selector-add-lumia {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 6px;\n    width: 100%;\n    padding: 10px 12px;\n    margin-bottom: 8px;\n    background: rgba(147, 112, 219, 0.1);\n    border: 1px dashed rgba(147, 112, 219, 0.3);\n    border-radius: var(--lumiverse-radius-sm);\n    color: var(--lumiverse-primary-text);\n    font-size: 13px;\n    font-weight: 500;\n    cursor: pointer;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-pack-selector-add-lumia:hover {\n    background: rgba(147, 112, 219, 0.2);\n    border-color: rgba(147, 112, 219, 0.5);\n}\n\n.lumiverse-pack-selector-lumia-list {\n    display: flex;\n    flex-direction: column;\n    gap: 4px;\n}\n\n.lumiverse-pack-selector-lumia-item {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 8px 10px;\n    background: rgba(0, 0, 0, 0.1);\n    border: 1px solid rgba(128, 128, 128, 0.08);\n    border-radius: var(--lumiverse-radius-sm);\n    transition: all 0.15s ease;\n}\n\n.lumiverse-pack-selector-lumia-item:hover {\n    background: rgba(0, 0, 0, 0.18);\n    border-color: rgba(147, 112, 219, 0.2);\n}\n\n.lumiverse-pack-selector-lumia-avatar {\n    width: 28px;\n    height: 28px;\n    border-radius: 50%;\n    object-fit: cover;\n    border: 1px solid rgba(147, 112, 219, 0.2);\n    flex-shrink: 0;\n}\n\n.lumiverse-pack-selector-lumia-name {\n    flex: 1;\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-pack-selector-lumia-edit {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 28px;\n    height: 28px;\n    padding: 0;\n    background: rgba(147, 112, 219, 0.15);\n    border: 1px solid rgba(147, 112, 219, 0.2);\n    border-radius: var(--lumiverse-radius-sm);\n    color: var(--lumiverse-primary-text);\n    cursor: pointer;\n    transition: all 0.15s ease;\n    flex-shrink: 0;\n}\n\n.lumiverse-pack-selector-lumia-edit:hover {\n    background: rgba(147, 112, 219, 0.3);\n    border-color: rgba(147, 112, 219, 0.4);\n}\n\n.lumiverse-pack-selector-lumia-empty {\n    padding: 12px;\n    text-align: center;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n    font-style: italic;\n}\n\n/* Pack Selector - Unified Items List (Lumia + Loom) */\n.lumiverse-pack-selector-items {\n    padding: 8px 12px 12px;\n    border-top: 1px solid var(--lumiverse-border-light);\n}\n\n.lumiverse-pack-selector-add-item {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 6px;\n    width: 100%;\n    padding: 10px 12px;\n    margin-bottom: 8px;\n    background: linear-gradient(135deg, rgba(147, 112, 219, 0.1) 0%, rgba(100, 149, 237, 0.1) 100%);\n    border: 1px dashed rgba(147, 112, 219, 0.3);\n    border-radius: var(--lumiverse-radius-sm);\n    color: var(--lumiverse-primary-text);\n    font-size: 13px;\n    font-weight: 500;\n    cursor: pointer;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-pack-selector-add-item:hover {\n    background: linear-gradient(135deg, rgba(147, 112, 219, 0.2) 0%, rgba(100, 149, 237, 0.2) 100%);\n    border-color: rgba(147, 112, 219, 0.5);\n}\n\n.lumiverse-pack-selector-item-list {\n    display: flex;\n    flex-direction: column;\n    gap: 4px;\n}\n\n.lumiverse-pack-selector-item-row {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 8px 10px;\n    background: rgba(0, 0, 0, 0.1);\n    border: 1px solid rgba(128, 128, 128, 0.08);\n    border-radius: var(--lumiverse-radius-sm);\n    transition: all 0.15s ease;\n}\n\n.lumiverse-pack-selector-item-row:hover {\n    background: rgba(0, 0, 0, 0.18);\n    border-color: rgba(147, 112, 219, 0.2);\n}\n\n.lumiverse-pack-selector-item-row--loom:hover {\n    border-color: rgba(100, 149, 237, 0.2);\n}\n\n.lumiverse-pack-selector-item-icon-sm {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 28px;\n    height: 28px;\n    border-radius: 50%;\n    flex-shrink: 0;\n    overflow: hidden;\n}\n\n.lumiverse-pack-selector-item-icon--lumia {\n    background: rgba(147, 112, 219, 0.15);\n    color: rgba(186, 135, 255, 0.9);\n    border: 1px solid rgba(147, 112, 219, 0.2);\n}\n\n.lumiverse-pack-selector-item-icon--loom {\n    background: rgba(100, 149, 237, 0.15);\n    color: rgba(130, 179, 255, 0.9);\n    border: 1px solid rgba(100, 149, 237, 0.2);\n}\n\n.lumiverse-pack-selector-item-avatar {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n    animation: lumiverseFadeIn 0.2s ease;\n}\n\n.lumiverse-pack-selector-item-name {\n    flex: 1;\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-pack-selector-item-type {\n    font-size: 10px;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    padding: 3px 8px;\n    border-radius: 10px;\n    background: rgba(147, 112, 219, 0.15);\n    color: rgba(186, 135, 255, 0.85);\n    flex-shrink: 0;\n}\n\n.lumiverse-pack-selector-item-type--loom {\n    background: rgba(100, 149, 237, 0.15);\n    color: rgba(130, 179, 255, 0.85);\n}\n\n.lumiverse-pack-selector-item-edit {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 28px;\n    height: 28px;\n    padding: 0;\n    background: rgba(128, 128, 128, 0.15);\n    border: 1px solid rgba(128, 128, 128, 0.15);\n    border-radius: var(--lumiverse-radius-sm);\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    transition: all 0.15s ease;\n    flex-shrink: 0;\n}\n\n.lumiverse-pack-selector-item-edit:hover {\n    background: rgba(147, 112, 219, 0.25);\n    border-color: rgba(147, 112, 219, 0.3);\n    color: var(--lumiverse-primary-text);\n}\n\n.lumiverse-pack-selector-item-row--loom .lumiverse-pack-selector-item-edit:hover {\n    background: rgba(100, 149, 237, 0.25);\n    border-color: rgba(100, 149, 237, 0.3);\n    color: rgba(130, 179, 255, 0.95);\n}\n\n.lumiverse-pack-selector-items-empty {\n    padding: 12px;\n    text-align: center;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n    font-style: italic;\n}\n\n/* Pack name class for clarity */\n.lumiverse-pack-selector-pack-name {\n    font-size: 14px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n/* Loom item row wrapper for content preview */\n.lumiverse-pack-selector-item-row-wrapper {\n    display: flex;\n    flex-direction: column;\n    gap: 0;\n}\n\n/* Preview toggle button for Loom items */\n.lumiverse-pack-selector-item-preview-btn {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 24px;\n    height: 24px;\n    padding: 0;\n    background: rgba(100, 149, 237, 0.1);\n    border: 1px solid rgba(100, 149, 237, 0.15);\n    border-radius: var(--lumiverse-radius-sm);\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    transition: all 0.15s ease;\n    flex-shrink: 0;\n}\n\n.lumiverse-pack-selector-item-preview-btn:hover {\n    background: rgba(100, 149, 237, 0.2);\n    border-color: rgba(100, 149, 237, 0.3);\n    color: rgba(130, 179, 255, 0.95);\n}\n\n/* Content preview for Loom items */\n.lumiverse-pack-selector-item-content-preview {\n    margin-left: 38px;\n    margin-top: 6px;\n    padding: 10px 12px;\n    font-size: 12px;\n    line-height: 1.5;\n    color: var(--lumiverse-text-muted);\n    background: rgba(0, 0, 0, 0.12);\n    border: 1px solid rgba(100, 149, 237, 0.1);\n    border-radius: var(--lumiverse-radius-sm);\n    white-space: pre-wrap;\n    word-break: break-word;\n    max-height: 120px;\n    overflow-y: auto;\n    animation: lumiverseFadeIn 0.15s ease;\n}\n\n/* ----------------------------------------\n   Lumia Editor Modal\n   ---------------------------------------- */\n.lumiverse-modal-lumia-editor {\n    max-width: 640px;\n    width: 90%;\n}\n\n.lumiverse-editor-modal {\n    display: flex;\n    flex-direction: column;\n    flex: 1;\n    min-height: 0; /* Critical for flex overflow */\n    overflow: hidden; /* Let child .lumiverse-editor-content scroll */\n}\n\n.lumiverse-editor-content {\n    flex: 1;\n    min-height: 0; /* Critical for flex overflow */\n    overflow-y: auto;\n    overflow-x: hidden;\n    padding: 16px;\n    -webkit-overflow-scrolling: touch;\n}\n\n.lumiverse-editor-section {\n    margin-bottom: 20px;\n    background: var(--lumiverse-bg-tertiary);\n    border-radius: var(--lumiverse-radius);\n    overflow: hidden;\n}\n\n.lumiverse-editor-section:last-child {\n    margin-bottom: 0;\n}\n\n.lumiverse-editor-section-header {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    padding: 12px 14px;\n    background: var(--lumiverse-bg-secondary);\n    border-bottom: 1px solid var(--lumiverse-border);\n    font-weight: 600;\n    font-size: 13px;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-editor-section-content {\n    padding: 14px;\n}\n\n.lumiverse-editor-field {\n    margin-bottom: 14px;\n}\n\n.lumiverse-editor-field:last-child {\n    margin-bottom: 0;\n}\n\n.lumiverse-editor-field--error .lumiverse-input,\n.lumiverse-editor-field--error .lumiverse-textarea {\n    border-color: var(--lumiverse-danger);\n}\n\n.lumiverse-editor-label {\n    display: block;\n    font-size: 12px;\n    font-weight: 500;\n    color: var(--lumiverse-text-muted);\n    margin-bottom: 6px;\n}\n\n.lumiverse-editor-hint {\n    display: block;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n    margin-top: 4px;\n    font-style: italic;\n}\n\n.lumiverse-editor-error {\n    display: block;\n    font-size: 11px;\n    color: var(--lumiverse-danger);\n    margin-top: 4px;\n}\n\n.lumiverse-editor-row {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 12px;\n}\n\n.lumiverse-editor-row .lumiverse-editor-field {\n    margin-bottom: 0;\n}\n\n.lumiverse-editor-avatar-preview {\n    width: 80px;\n    height: 80px;\n    border-radius: var(--lumiverse-radius);\n    overflow: hidden;\n    border: 1px solid var(--lumiverse-border);\n    margin-top: 8px;\n    position: relative;\n}\n\n.lumiverse-editor-avatar-preview img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n    opacity: 0;\n    transition: opacity 0.2s ease;\n}\n\n.lumiverse-editor-avatar-preview.loaded img {\n    opacity: 1;\n}\n\n.lumiverse-editor-avatar-spinner {\n    position: absolute;\n    inset: 0;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    background: var(--lumiverse-bg-tertiary);\n}\n\n.lumiverse-editor-avatar-spinner::after {\n    content: '';\n    width: 20px;\n    height: 20px;\n    border: 2px solid var(--lumiverse-border);\n    border-top-color: var(--lumiverse-primary);\n    border-radius: 50%;\n    animation: spin 0.8s linear infinite;\n}\n\n.lumiverse-editor-avatar-preview.loaded .lumiverse-editor-avatar-spinner {\n    display: none;\n}\n\n.lumiverse-editor-footer {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    padding: 12px 16px;\n    border-top: 1px solid var(--lumiverse-border);\n    background: var(--lumiverse-bg-secondary);\n    flex-shrink: 0;\n}\n\n.lumiverse-editor-footer-spacer {\n    flex: 1;\n}\n\n/* Editor modal textareas - desktop */\n.lumiverse-editor-modal .lumiverse-textarea {\n    min-height: 120px;\n    line-height: 1.5;\n    resize: vertical;\n}\n\n/* Physicality/Personality/Behavior sections need more space */\n.lumiverse-editor-section:not(:first-child) .lumiverse-textarea {\n    min-height: 140px;\n}\n\n/* ----------------------------------------\n   Item Type Selector\n   Choice between Lumia and Loom\n   ---------------------------------------- */\n.lumiverse-type-selector {\n    display: flex;\n    flex-direction: column;\n    padding: 20px;\n    min-width: 420px;\n}\n\n.lumiverse-type-selector-header {\n    text-align: center;\n    margin-bottom: 24px;\n}\n\n.lumiverse-type-selector-title {\n    font-size: 16px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    margin: 0 0 6px 0;\n    letter-spacing: -0.2px;\n}\n\n.lumiverse-type-selector-subtitle {\n    font-size: 13px;\n    color: var(--lumiverse-text-muted);\n    margin: 0;\n}\n\n.lumiverse-type-selector-options {\n    display: flex;\n    flex-direction: column;\n    gap: 12px;\n}\n\n.lumiverse-type-option {\n    display: flex;\n    align-items: center;\n    gap: 16px;\n    padding: 16px 18px;\n    background: var(--lumiverse-bg-elevated);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius-lg);\n    cursor: pointer;\n    transition: all var(--lumiverse-transition);\n    text-align: left;\n    width: 100%;\n}\n\n.lumiverse-type-option:hover,\n.lumiverse-type-option--hovered {\n    background: var(--lumiverse-bg-hover);\n    border-color: var(--lumiverse-border-hover);\n    transform: translateY(-1px);\n}\n\n.lumiverse-type-option--lumia:hover,\n.lumiverse-type-option--lumia.lumiverse-type-option--hovered {\n    border-color: rgba(147, 112, 219, 0.4);\n    box-shadow: 0 4px 20px rgba(147, 112, 219, 0.15);\n}\n\n.lumiverse-type-option--loom:hover,\n.lumiverse-type-option--loom.lumiverse-type-option--hovered {\n    border-color: rgba(100, 149, 237, 0.4);\n    box-shadow: 0 4px 20px rgba(100, 149, 237, 0.15);\n}\n\n.lumiverse-type-option-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 48px;\n    height: 48px;\n    border-radius: var(--lumiverse-radius);\n    flex-shrink: 0;\n    transition: all var(--lumiverse-transition);\n}\n\n.lumiverse-type-option--lumia .lumiverse-type-option-icon {\n    background: rgba(147, 112, 219, 0.15);\n    color: rgba(186, 135, 255, 0.9);\n}\n\n.lumiverse-type-option--lumia:hover .lumiverse-type-option-icon,\n.lumiverse-type-option--lumia.lumiverse-type-option--hovered .lumiverse-type-option-icon {\n    background: rgba(147, 112, 219, 0.25);\n}\n\n.lumiverse-type-option--loom .lumiverse-type-option-icon {\n    background: rgba(100, 149, 237, 0.15);\n    color: rgba(130, 179, 255, 0.9);\n}\n\n.lumiverse-type-option--loom:hover .lumiverse-type-option-icon,\n.lumiverse-type-option--loom.lumiverse-type-option--hovered .lumiverse-type-option-icon {\n    background: rgba(100, 149, 237, 0.25);\n}\n\n.lumiverse-type-option-content {\n    flex: 1;\n    min-width: 0;\n}\n\n.lumiverse-type-option-label {\n    display: block;\n    font-size: 14px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    margin-bottom: 4px;\n}\n\n.lumiverse-type-option-desc {\n    display: block;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n    line-height: 1.4;\n}\n\n.lumiverse-type-option-arrow {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 24px;\n    height: 24px;\n    color: var(--lumiverse-text-dim);\n    opacity: 0;\n    transform: translateX(-4px);\n    transition: all var(--lumiverse-transition);\n}\n\n.lumiverse-type-option:hover .lumiverse-type-option-arrow,\n.lumiverse-type-option--hovered .lumiverse-type-option-arrow {\n    opacity: 1;\n    transform: translateX(0);\n}\n\n.lumiverse-type-selector-footer {\n    display: flex;\n    justify-content: center;\n    margin-top: 20px;\n    padding-top: 16px;\n    border-top: 1px solid var(--lumiverse-border);\n}\n\n/* Modal wrapper for type selector */\n.lumia-modal-type-selector {\n    max-width: 480px;\n    width: 90%;\n}\n\n/* ----------------------------------------\n   Loom Editor Modal\n   ---------------------------------------- */\n.lumia-modal-loom-editor {\n    max-width: 580px;\n    width: 90%;\n}\n\n.lumiverse-loom-editor {\n    display: flex;\n    flex-direction: column;\n    max-height: 80vh;\n}\n\n.lumiverse-loom-editor-content {\n    flex: 1;\n    overflow-y: auto;\n    padding: 16px;\n}\n\n.lumiverse-loom-category-select {\n    margin-bottom: 16px;\n}\n\n.lumiverse-loom-category-options {\n    display: flex;\n    gap: 8px;\n    flex-wrap: wrap;\n}\n\n.lumiverse-loom-category-btn {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    padding: 8px 14px;\n    background: var(--lumiverse-bg-elevated);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 20px;\n    font-size: 12px;\n    font-weight: 500;\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    transition: all var(--lumiverse-transition);\n}\n\n.lumiverse-loom-category-btn:hover {\n    background: var(--lumiverse-bg-hover);\n    border-color: var(--lumiverse-border-hover);\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-loom-category-btn--selected {\n    background: rgba(100, 149, 237, 0.2);\n    border-color: rgba(100, 149, 237, 0.4);\n    color: rgba(130, 179, 255, 0.95);\n}\n\n.lumiverse-loom-category-btn--selected:hover {\n    background: rgba(100, 149, 237, 0.25);\n    border-color: rgba(100, 149, 237, 0.5);\n}\n\n.lumiverse-loom-content-field {\n    margin-top: 16px;\n}\n\n.lumiverse-loom-content-field .lumiverse-textarea {\n    min-height: 200px;\n    resize: vertical;\n}\n\n/* ============================================\n   MOBILE RESPONSIVE - Editor Modals\n   Lumia Editor, Loom Editor, Pack Editor, Pack Selector\n   \n   CRITICAL: The modal hierarchy is:\n   .lumiverse-modal-backdrop (fixed, flex center)\n     .lumiverse-modal.lumiverse-modal-lumia-editor (flex column, max-height constrained)\n       .lumiverse-editor-modal (flex column, fills parent)\n         .lumiverse-editor-content (MUST SCROLL - flex: 1, overflow-y: auto)\n         .lumiverse-editor-footer (flex-shrink: 0, stays at bottom)\n   \n   The parent .lumiverse-modal has overflow: hidden by default.\n   We override it for editor modals to allow internal scrolling.\n   ============================================ */\n\n@media (max-width: 600px) {\n    /* ----------------------------------------\n       Editor Modal Wrapper - Mobile\n       Override the parent .lumiverse-modal settings\n       ---------------------------------------- */\n    .lumiverse-modal.lumiverse-modal-lumia-editor,\n    .lumiverse-modal.lumiverse-modal-loom-editor,\n    .lumiverse-modal.lumiverse-modal-pack-editor,\n    .lumiverse-modal.lumiverse-modal-pack-selector {\n        width: calc(100vw - 24px) !important;\n        max-width: calc(100vw - 24px) !important;\n        /* Height: use vh as fallback, dvh as enhancement */\n        height: calc(100vh - 24px);\n        max-height: calc(100vh - 24px);\n        margin: 0;\n        display: flex;\n        flex-direction: column;\n        overflow: hidden;\n        min-height: 0 !important; /* Critical for nested flex scroll */\n    }\n\n    /* Dynamic viewport units for modern browsers */\n    @supports (height: 100dvh) {\n        .lumiverse-modal.lumiverse-modal-lumia-editor,\n        .lumiverse-modal.lumiverse-modal-loom-editor,\n        .lumiverse-modal.lumiverse-modal-pack-editor,\n        .lumiverse-modal.lumiverse-modal-pack-selector {\n            height: calc(100dvh - 24px);\n            max-height: calc(100dvh - 24px);\n        }\n    }\n\n    /* ----------------------------------------\n       Lumia Editor Modal - Mobile\n       \n       This is the inner container inside .lumiverse-modal\n       ---------------------------------------- */\n    .lumiverse-editor-modal {\n        display: flex;\n        flex-direction: column;\n        flex: 1;\n        min-height: 0 !important; /* Critical: allows flex child to shrink */\n        height: 100%;\n        overflow: hidden;\n    }\n\n    /* Scrollable content area - THE KEY ELEMENT */\n    .lumiverse-editor-content {\n        flex: 1;\n        min-height: 0 !important; /* Critical: enables overflow scrolling */\n        overflow-y: auto !important;\n        overflow-x: hidden;\n        -webkit-overflow-scrolling: touch;\n        padding: 12px;\n        overscroll-behavior: contain;\n    }\n\n    /* Section styling */\n    .lumiverse-editor-section {\n        margin-bottom: 12px;\n        border-radius: var(--lumiverse-radius);\n        background: var(--lumiverse-bg-tertiary);\n    }\n\n    .lumiverse-editor-section:last-child {\n        margin-bottom: 0;\n    }\n\n    .lumiverse-editor-section-header {\n        padding: 10px 12px;\n        font-size: 12px;\n        font-weight: 600;\n        background: var(--lumiverse-bg-secondary);\n        border-bottom: 1px solid var(--lumiverse-border);\n    }\n\n    .lumiverse-editor-section-content {\n        padding: 12px;\n    }\n\n    /* Form fields */\n    .lumiverse-editor-field {\n        margin-bottom: 12px;\n    }\n\n    .lumiverse-editor-field:last-child {\n        margin-bottom: 0;\n    }\n\n    .lumiverse-editor-label {\n        display: block;\n        font-size: 11px;\n        font-weight: 600;\n        margin-bottom: 6px;\n        text-transform: uppercase;\n        letter-spacing: 0.3px;\n        color: var(--lumiverse-text-muted);\n    }\n\n    /* Stack two-column rows vertically */\n    .lumiverse-editor-row {\n        display: flex;\n        flex-direction: column;\n        gap: 12px;\n    }\n\n    .lumiverse-editor-row .lumiverse-editor-field {\n        margin-bottom: 0;\n    }\n\n    /* Avatar preview */\n    .lumiverse-editor-avatar-preview {\n        width: 60px;\n        height: 60px;\n        border-radius: 8px;\n        flex-shrink: 0;\n    }\n\n    /* ----------------------------------------\n       Input Sizing - Mobile\n       All inputs need comfortable touch targets\n       ---------------------------------------- */\n    .lumiverse-editor-modal .lumiverse-input,\n    .lumiverse-editor-modal .lumiverse-select {\n        min-height: 44px; /* iOS touch target minimum */\n        font-size: 16px; /* Prevents iOS zoom on focus */\n        padding: 10px 12px;\n    }\n\n    /* Select dropdown - ensure it's visible */\n    .lumiverse-editor-modal .lumiverse-select {\n        appearance: none;\n        background-image: url(${g});\n        background-repeat: no-repeat;\n        background-position: right 12px center;\n        padding-right: 36px;\n    }\n\n    /* Textareas - generous sizing */\n    .lumiverse-editor-modal .lumiverse-textarea {\n        min-height: 100px;\n        font-size: 16px; /* Prevents iOS zoom */\n        line-height: 1.5;\n        padding: 12px;\n        resize: vertical;\n    }\n\n    /* Hint text */\n    .lumiverse-editor-hint {\n        font-size: 11px;\n        color: var(--lumiverse-text-muted);\n        margin-top: 4px;\n        font-style: italic;\n    }\n\n    /* ----------------------------------------\n       Footer - Fixed at bottom\n       ---------------------------------------- */\n    .lumiverse-editor-footer {\n        flex-shrink: 0; /* Never compress the footer */\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n        padding: 12px;\n        border-top: 1px solid var(--lumiverse-border);\n        background: var(--lumiverse-bg-secondary);\n    }\n\n    .lumiverse-editor-footer .lumiverse-btn {\n        min-height: 44px;\n        padding: 10px 16px;\n        font-size: 14px;\n        font-weight: 500;\n    }\n\n    /* Primary and Secondary buttons side by side */\n    .lumiverse-editor-footer .lumiverse-btn--primary,\n    .lumiverse-editor-footer .lumiverse-btn--secondary:not(.lumiverse-btn--danger) {\n        flex: 1 1 auto;\n    }\n\n    /* Delete button full width on its own row */\n    .lumiverse-editor-footer .lumiverse-btn--danger {\n        flex: 0 0 100%;\n        order: 10; /* Push to end */\n        margin-top: 4px;\n    }\n\n    .lumiverse-editor-footer-spacer {\n        display: none;\n    }\n\n    /* ----------------------------------------\n       Loom Editor Modal - Mobile\n       \n       Same flex structure as Lumia editor\n       ---------------------------------------- */\n    .lumiverse-loom-editor {\n        display: flex;\n        flex-direction: column;\n        flex: 1 1 auto;\n        min-height: 0;\n        max-height: 100%;\n        overflow: hidden;\n    }\n\n    .lumiverse-loom-editor-content {\n        flex: 1 1 auto;\n        min-height: 0;\n        overflow-y: auto;\n        overflow-x: hidden;\n        -webkit-overflow-scrolling: touch;\n        padding: 12px;\n        overscroll-behavior: contain;\n    }\n\n    /* Category buttons - touch friendly */\n    .lumiverse-loom-category-options {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n    }\n\n    .lumiverse-loom-category-btn {\n        min-height: 40px;\n        padding: 8px 14px;\n        font-size: 13px;\n        border-radius: 20px;\n    }\n\n    .lumiverse-loom-category-btn svg {\n        width: 14px;\n        height: 14px;\n    }\n\n    /* Loom content textarea */\n    .lumiverse-loom-content-field .lumiverse-textarea,\n    .lumiverse-loom-editor .lumiverse-textarea {\n        min-height: 150px;\n        font-size: 16px;\n        line-height: 1.5;\n        resize: vertical;\n    }\n\n    /* ----------------------------------------\n       Pack Editor Modal - Mobile\n       ---------------------------------------- */\n    .lumiverse-pack-editor-modal,\n    .lumiverse-pack-selector-modal {\n        display: flex;\n        flex-direction: column;\n        flex: 1 1 auto;\n        min-height: 0 !important;\n        max-height: 100%;\n        overflow: hidden;\n    }\n\n    .lumiverse-pack-editor-content,\n    .lumiverse-pack-selector-content {\n        flex: 1 1 auto;\n        min-height: 0 !important;\n        overflow-y: auto !important;\n        overflow-x: hidden;\n        -webkit-overflow-scrolling: touch;\n        padding: 12px;\n        gap: 12px;\n        overscroll-behavior: contain;\n    }\n\n    .lumiverse-pack-editor-title {\n        margin-bottom: 12px;\n        gap: 8px;\n    }\n\n    .lumiverse-pack-editor-title h3 {\n        font-size: 16px;\n    }\n\n    .lumiverse-pack-editor-title svg {\n        width: 18px;\n        height: 18px;\n    }\n\n    /* Pack lumias info section */\n    .lumiverse-pack-lumias-info {\n        padding: 12px;\n    }\n\n    .lumiverse-pack-lumias-count {\n        font-size: 13px;\n    }\n\n    .lumiverse-pack-lumias-hint {\n        font-size: 12px;\n        margin-bottom: 10px;\n    }\n\n    /* Pack editor footer */\n    .lumiverse-pack-editor-footer {\n        flex-shrink: 0;\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n        padding: 12px;\n        border-top: 1px solid var(--lumiverse-border);\n        background: var(--lumiverse-bg-secondary);\n    }\n\n    .lumiverse-pack-editor-footer-left {\n        flex: 0 0 100%;\n        order: 2;\n        justify-content: center;\n    }\n\n    .lumiverse-pack-editor-actions {\n        flex: 0 0 100%;\n        order: 1;\n    }\n\n    .lumiverse-pack-editor-footer .lumiverse-btn {\n        flex: 1;\n        justify-content: center;\n        min-height: 44px;\n        font-size: 14px;\n        font-weight: 500;\n    }\n\n    /* ----------------------------------------\n       Common Input Styles - Mobile\n       16px font prevents iOS zoom on focus\n       ---------------------------------------- */\n    .lumiverse-input,\n    .lumiverse-select {\n        font-size: 16px;\n        padding: 10px 12px;\n        min-height: 44px;\n    }\n\n    .lumiverse-textarea {\n        font-size: 16px;\n        padding: 10px 12px;\n        min-height: 80px;\n    }\n\n    /* Image input adjustments */\n    .lumiverse-image-input .lumiverse-image-preview {\n        margin-top: 8px;\n    }\n\n    .lumiverse-image-input .lumiverse-image-preview img {\n        max-height: 100px;\n    }\n\n    /* Form field adjustments */\n    .lumiverse-form-field {\n        margin-bottom: 12px;\n    }\n\n    .lumiverse-form-label {\n        font-size: 11px;\n        margin-bottom: 5px;\n    }\n\n    .lumiverse-form-hint,\n    .lumiverse-editor-hint {\n        font-size: 10px;\n    }\n\n    /* Stack lumia row fields vertically */\n    .lumiverse-lumia-row {\n        grid-template-columns: 1fr;\n        gap: 12px;\n    }\n}\n\n/* ----------------------------------------\n   Viewport Panel (Dockable Sidebar)\n   ---------------------------------------- */\n\n/* Container for the viewport panel - mounted to document.body */\n.lumiverse-viewport-container {\n    /* Inline styles handle positioning, this is for any additional styling */\n    margin: 0;\n    padding: 0;\n    overflow: visible; /* Allow drawer tab to extend beyond container bounds */\n}\n\n/* Wrapper that slides in/out - contains both tab and panel as unified element */\n.lumiverse-viewport-wrapper {\n    display: flex;\n    flex-direction: row;\n    align-items: flex-start;\n    height: 100vh;\n    height: 100dvh;\n    position: relative; /* For absolute positioning of drawer tab */\n    overflow: visible; /* Allow drawer tab to extend beyond wrapper bounds */\n}\n\n/* Visible state - drawer is open */\n.lumiverse-viewport-wrapper--visible {\n    /* Can be used for additional open-state styling */\n}\n\n/* Legacy toggle container - kept for backwards compatibility */\n.lumiverse-toggle-container {\n    position: absolute;\n    top: 12px;\n    right: 100%; /* Position to the left of the wrapper */\n    margin-right: 12px;\n    pointer-events: auto;\n    display: none; /* Hidden - replaced by drawer tab */\n}\n\n/* Custom position modifier - disables default positioning, uses inline styles */\n.lumiverse-toggle-container--custom {\n    /* Reset all positioning to allow inline styles to take effect */\n    position: fixed;\n    top: auto;\n    right: auto;\n    margin: 0;\n    display: none; /* Hidden - replaced by drawer tab */\n}\n\n.lumiverse-viewport-panel {\n    height: 100%;\n    display: flex;\n    flex-direction: row;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n    pointer-events: auto;\n}\n\n.lumiverse-viewport-panel--collapsed {\n    /* Just show the tab bar when collapsed */\n}\n\n/* Tab sidebar */\n.lumiverse-vp-tabs {\n    display: flex;\n    flex-direction: column;\n    width: 56px;\n    box-sizing: border-box; /* Ensure width includes border */\n    background: linear-gradient(180deg, rgba(28, 24, 38, 0.98) 0%, rgba(20, 17, 28, 0.98) 100%);\n    border-left: 1px solid rgba(147, 112, 219, 0.2);\n    padding: 8px 0; /* Minimal padding - panel is at top of screen */\n    gap: 4px;\n}\n\n.lumiverse-vp-tab {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    width: 52px;\n    height: 52px;\n    margin: 0 2px;\n    background: transparent;\n    border: none;\n    border-radius: 8px;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-vp-tab:hover {\n    background: rgba(147, 112, 219, 0.15);\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-vp-tab--active {\n    background: rgba(147, 112, 219, 0.25);\n    color: var(--lumiverse-primary);\n    box-shadow: inset 2px 0 0 var(--lumiverse-primary);\n}\n\n.lumiverse-vp-tab-icon {\n    font-size: 18px;\n    line-height: 1;\n}\n\n.lumiverse-vp-tab-label {\n    font-size: 10px;\n    margin-top: 4px;\n    white-space: nowrap;\n    overflow: visible;\n    text-overflow: clip;\n    max-width: none;\n}\n\n.lumiverse-vp-tabs-spacer {\n    flex: 1;\n}\n\n.lumiverse-vp-collapse-btn {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 52px;\n    height: 40px;\n    margin: 0 2px;\n    background: transparent;\n    border: none;\n    border-radius: 8px;\n    cursor: pointer;\n    color: var(--lumiverse-text-muted);\n    font-size: 14px;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-vp-collapse-btn:hover {\n    background: rgba(147, 112, 219, 0.15);\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-vp-collapse-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: transform 0.2s ease;\n}\n\n.lumiverse-vp-collapse-icon--rotated {\n    transform: rotate(180deg);\n}\n\n/* Main panel area */\n.lumiverse-vp-main {\n    display: flex;\n    flex-direction: column;\n    box-sizing: border-box; /* Ensure width includes border */\n    background: linear-gradient(180deg, rgba(28, 24, 38, 0.98) 0%, rgba(20, 17, 28, 0.98) 100%);\n    border-left: 1px solid rgba(147, 112, 219, 0.15);\n    overflow: hidden;\n}\n\n.lumiverse-vp-header {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 12px 16px;\n    background: rgba(147, 112, 219, 0.08);\n    border-bottom: 1px solid rgba(147, 112, 219, 0.15);\n    min-height: 48px;\n}\n\n.lumiverse-vp-header-icon {\n    font-size: 18px;\n}\n\n.lumiverse-vp-header-title {\n    flex: 1;\n    font-size: 14px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-vp-close-btn {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 28px;\n    height: 28px;\n    background: transparent;\n    border: none;\n    border-radius: 6px;\n    cursor: pointer;\n    color: var(--lumiverse-text-muted);\n    font-size: 14px;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-vp-close-btn:hover {\n    background: rgba(255, 100, 100, 0.2);\n    color: #ff6464;\n}\n\n.lumiverse-vp-content {\n    flex: 1;\n    position: relative; /* Containing block for absolute exit animations */\n    overflow-y: auto;\n    overflow-x: hidden;\n    scrollbar-gutter: stable; /* Reserve scrollbar space to prevent layout shift */\n    contain: layout style; /* Isolate layout calculations for performance */\n}\n\n.lumiverse-vp-tab-content {\n    display: none; /* Hidden by default */\n    min-height: 100%;\n}\n\n.lumiverse-vp-tab-content--active {\n    display: block; /* Show active tab instantly */\n}\n\n/* Placeholder content */\n.lumiverse-vp-placeholder {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    padding: 40px 20px;\n    text-align: center;\n    min-height: 300px;\n}\n\n.lumiverse-vp-placeholder-icon {\n    font-size: 48px;\n    margin-bottom: 16px;\n    opacity: 0.6;\n}\n\n.lumiverse-vp-placeholder h3 {\n    margin: 0 0 8px 0;\n    font-size: 16px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-vp-placeholder p {\n    margin: 0 0 16px 0;\n    font-size: 13px;\n    color: var(--lumiverse-text-muted);\n    max-width: 240px;\n}\n\n.lumiverse-vp-placeholder-badge {\n    display: inline-block;\n    padding: 4px 12px;\n    background: rgba(147, 112, 219, 0.15);\n    border: 1px solid rgba(147, 112, 219, 0.3);\n    border-radius: 12px;\n    font-size: 11px;\n    font-weight: 600;\n    color: var(--lumiverse-primary);\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n/* ----------------------------------------\n   Character Lumia Profile\n   ---------------------------------------- */\n.lumiverse-character-profile {\n    padding: 16px;\n    display: flex;\n    flex-direction: column;\n    gap: 16px;\n}\n\n/* Profile Header */\n.lumiverse-profile-header {\n    display: flex;\n    align-items: center;\n    gap: 14px;\n    padding-bottom: 16px;\n    border-bottom: 1px solid rgba(147, 112, 219, 0.15);\n}\n\n.lumiverse-profile-avatar {\n    width: 56px;\n    height: 56px;\n    border-radius: 12px;\n    overflow: hidden;\n    background: rgba(147, 112, 219, 0.1);\n    flex-shrink: 0;\n    border: 2px solid rgba(147, 112, 219, 0.3);\n}\n\n.lumiverse-profile-avatar img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n    animation: lumiverseFadeIn 0.2s ease;\n}\n\n.lumiverse-profile-avatar-placeholder {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 100%;\n    height: 100%;\n    font-size: 24px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-profile-info {\n    flex: 1;\n    min-width: 0;\n}\n\n.lumiverse-profile-name {\n    margin: 0 0 8px 0;\n    font-size: 16px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-profile-stats {\n    display: flex;\n    gap: 6px;\n}\n\n.lumiverse-stat {\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    gap: 4px;\n    padding: 4px 8px;\n    background: rgba(147, 112, 219, 0.08);\n    border-radius: 6px;\n    cursor: default;\n}\n\n.lumiverse-stat-icon {\n    color: var(--lumiverse-text-muted);\n    flex-shrink: 0;\n}\n\n.lumiverse-stat-value {\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--lumiverse-primary);\n}\n\n/* Profile Sections */\n.lumiverse-profile-section {\n    background: rgba(147, 112, 219, 0.05);\n    border-radius: 10px;\n    padding: 12px;\n}\n\n.lumiverse-profile-section-header {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    margin-bottom: 10px;\n}\n\n.lumiverse-profile-section-icon {\n    font-size: 14px;\n}\n\n.lumiverse-profile-section-title {\n    font-size: 12px;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    color: var(--lumiverse-text-muted);\n    flex: 1;\n}\n\n.lumiverse-profile-section-count {\n    font-size: 11px;\n    font-weight: 600;\n    color: var(--lumiverse-primary);\n    background: rgba(147, 112, 219, 0.15);\n    padding: 2px 8px;\n    border-radius: 10px;\n}\n\n/* Council Banner - shown in Profile tab when Council mode is active */\n.lumiverse-council-banner {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 16px;\n    padding: 24px 20px;\n    background: linear-gradient(\n        135deg,\n        rgba(147, 112, 219, 0.12) 0%,\n        rgba(100, 180, 255, 0.08) 100%\n    );\n    border: 1px solid rgba(147, 112, 219, 0.2);\n    border-radius: 12px;\n    text-align: center;\n}\n\n.lumiverse-council-banner-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 56px;\n    height: 56px;\n    background: linear-gradient(135deg, rgba(147, 112, 219, 0.25) 0%, rgba(100, 180, 255, 0.15) 100%);\n    border-radius: 50%;\n    color: var(--lumiverse-primary);\n}\n\n.lumiverse-council-banner-content {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n    width: 100%;\n}\n\n.lumiverse-council-banner-title {\n    font-size: 15px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    margin: 0;\n}\n\n.lumiverse-council-banner-stats {\n    display: flex;\n    justify-content: center;\n    gap: 16px;\n    flex-wrap: wrap;\n}\n\n.lumiverse-council-banner-stat {\n    display: flex;\n    align-items: center;\n    gap: 5px;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-council-banner-stat svg {\n    color: var(--lumiverse-primary);\n    opacity: 0.8;\n}\n\n.lumiverse-council-banner-avatars {\n    display: flex;\n    justify-content: center;\n    margin-top: 4px;\n}\n\n.lumiverse-council-banner-avatar {\n    width: 36px;\n    height: 36px;\n    border-radius: 50%;\n    background: rgba(147, 112, 219, 0.2);\n    border: 2px solid var(--lumiverse-surface);\n    margin-left: -10px;\n    overflow: hidden;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-council-banner-avatar:first-child {\n    margin-left: 0;\n}\n\n.lumiverse-council-banner-avatar img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n    animation: lumiverseFadeIn 0.2s ease;\n}\n\n.lumiverse-council-banner-more {\n    width: 36px;\n    height: 36px;\n    border-radius: 50%;\n    background: rgba(147, 112, 219, 0.3);\n    border: 2px solid var(--lumiverse-surface);\n    margin-left: -10px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 11px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-council-banner-btn {\n    display: inline-flex;\n    align-items: center;\n    gap: 6px;\n    padding: 10px 20px;\n    font-size: 13px;\n    font-weight: 500;\n    color: white;\n    background: linear-gradient(135deg, rgba(147, 112, 219, 0.9) 0%, rgba(123, 95, 196, 0.9) 100%);\n    border: none;\n    border-radius: 8px;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    margin-top: 4px;\n}\n\n.lumiverse-council-banner-btn:hover {\n    background: linear-gradient(135deg, rgba(167, 139, 240, 0.95) 0%, rgba(147, 112, 219, 0.95) 100%);\n    transform: translateY(-1px);\n    box-shadow: 0 4px 12px rgba(147, 112, 219, 0.3);\n}\n\n.lumiverse-council-banner-btn svg {\n    transition: transform 0.2s ease;\n}\n\n.lumiverse-council-banner-btn:hover svg {\n    transform: translateX(3px);\n}\n\n/* Trait Cards */\n.lumiverse-traits-list {\n    display: flex;\n    flex-direction: column;\n    gap: 6px;\n}\n\n.lumiverse-trait-card {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 10px 12px;\n    border-radius: 8px;\n    border: 1px solid transparent;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-trait-card:hover {\n    transform: translateX(2px);\n}\n\n.lumiverse-trait-card--dominant {\n    box-shadow: 0 0 0 1px rgba(245, 158, 11, 0.4), 0 2px 8px rgba(245, 158, 11, 0.15);\n}\n\n.lumiverse-trait-icon {\n    font-size: 14px;\n    flex-shrink: 0;\n}\n\n.lumiverse-trait-info {\n    flex: 1;\n    min-width: 0;\n    display: flex;\n    align-items: center;\n    gap: 8px;\n}\n\n.lumiverse-trait-name {\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-trait-dominant-badge {\n    font-size: 10px;\n    font-weight: 600;\n    color: var(--lumiverse-warning);\n    background: rgba(245, 158, 11, 0.15);\n    padding: 2px 6px;\n    border-radius: 4px;\n    white-space: nowrap;\n}\n\n.lumiverse-trait-remove {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 22px;\n    height: 22px;\n    background: transparent;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n    color: var(--lumiverse-text-muted);\n    font-size: 12px;\n    opacity: 0;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-trait-card:hover .lumiverse-trait-remove {\n    opacity: 1;\n}\n\n.lumiverse-trait-remove:hover {\n    background: rgba(239, 68, 68, 0.15);\n    color: var(--lumiverse-danger);\n}\n\n/* Empty Section */\n.lumiverse-profile-empty {\n    padding: 16px;\n    text-align: center;\n    color: var(--lumiverse-text-dim);\n    font-size: 12px;\n    font-style: italic;\n}\n\n/* Loom Summary */\n.lumiverse-loom-summary {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumiverse-loom-group {\n    display: flex;\n    align-items: flex-start;\n    gap: 8px;\n    font-size: 12px;\n}\n\n.lumiverse-loom-label {\n    font-weight: 600;\n    color: var(--lumiverse-text-muted);\n    flex-shrink: 0;\n    min-width: 60px;\n}\n\n.lumiverse-loom-items {\n    color: var(--lumiverse-text);\n    line-height: 1.4;\n}\n\n/* ----------------------------------------\n   Visual Pack Browser\n   ---------------------------------------- */\n.lumiverse-pack-browser {\n    padding: 12px;\n    display: flex;\n    flex-direction: column;\n    gap: 12px;\n    height: 100%;\n}\n\n/* Stats Bar */\n.lumiverse-browser-stats {\n    display: flex;\n    justify-content: space-between;\n    padding: 10px 12px;\n    background: rgba(147, 112, 219, 0.08);\n    border-radius: 10px;\n    gap: 8px;\n}\n\n.lumiverse-browser-stat {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    flex: 1;\n}\n\n.lumiverse-browser-stat-value {\n    font-size: 16px;\n    font-weight: 700;\n    color: var(--lumiverse-primary);\n}\n\n.lumiverse-browser-stat-label {\n    font-size: 9px;\n    letter-spacing: 0.5px;\n    color: var(--lumiverse-text-muted);\n}\n\n/* Search */\n.lumiverse-pack-search {\n    display: flex;\n    align-items: center;\n    background: rgba(30, 30, 46, 0.8);\n    border: 1px solid rgba(147, 112, 219, 0.2);\n    border-radius: 8px;\n    padding: 0 12px;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-pack-search:focus-within {\n    border-color: var(--lumiverse-primary);\n    box-shadow: 0 0 0 2px rgba(147, 112, 219, 0.15);\n}\n\n.lumiverse-pack-search-icon {\n    font-size: 14px;\n    margin-right: 8px;\n    opacity: 0.6;\n}\n\n.lumiverse-pack-search-input {\n    flex: 1;\n    background: transparent;\n    border: none;\n    padding: 10px 0;\n    color: var(--lumiverse-text);\n    font-size: 13px;\n}\n\n.lumiverse-pack-search-input:focus {\n    outline: none;\n}\n\n.lumiverse-pack-search-input::placeholder {\n    color: var(--lumiverse-text-dim);\n}\n\n.lumiverse-pack-search-clear {\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    padding: 4px;\n    font-size: 12px;\n    opacity: 0.6;\n    transition: opacity 0.15s ease;\n}\n\n.lumiverse-pack-search-clear:hover {\n    opacity: 1;\n}\n\n/* Filter Tabs */\n.lumiverse-pack-filters {\n    display: flex;\n    gap: 2px;\n    padding: 4px;\n    background: rgba(30, 30, 46, 0.6);\n    border-radius: 8px;\n}\n\n.lumiverse-pack-filter {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    flex: 1;\n    min-width: 32px;\n    height: 32px;\n    background: transparent;\n    border: none;\n    border-radius: 6px;\n    cursor: pointer;\n    transition: all 0.15s ease;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-pack-filter:hover {\n    background: rgba(147, 112, 219, 0.1);\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-pack-filter--active {\n    background: rgba(147, 112, 219, 0.2);\n    color: var(--lumiverse-primary);\n}\n\n/* Filter container with toggle */\n.lumiverse-pack-filters-container {\n    display: flex;\n    gap: 8px;\n    align-items: stretch;\n}\n\n.lumiverse-pack-filters-container .lumiverse-pack-filters {\n    flex: 1;\n}\n\n/* Selected Only Toggle */\n.lumiverse-pack-filter-selected-toggle {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 4px;\n    padding: 4px 8px;\n    background: rgba(30, 30, 46, 0.6);\n    border: 1px solid transparent;\n    border-radius: 8px;\n    cursor: pointer;\n    transition: all 0.15s ease;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-pack-filter-selected-toggle:hover {\n    background: rgba(147, 112, 219, 0.15);\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-pack-filter-selected-toggle--active {\n    background: rgba(147, 112, 219, 0.25);\n    border-color: rgba(147, 112, 219, 0.4);\n    color: var(--lumiverse-primary);\n}\n\n.lumiverse-pack-filter-selected-count {\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    min-width: 16px;\n    height: 16px;\n    padding: 0 4px;\n    background: rgba(147, 112, 219, 0.3);\n    border-radius: 8px;\n    font-size: 10px;\n    font-weight: 600;\n    color: var(--lumiverse-primary);\n}\n\n.lumiverse-pack-filter-selected-toggle--active .lumiverse-pack-filter-selected-count {\n    background: rgba(147, 112, 219, 0.5);\n    color: var(--lumiverse-text);\n}\n\n/* Pack List */\n.lumiverse-browser-packs {\n    flex: 1;\n    overflow-y: auto;\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumiverse-browser-pack {\n    background: rgba(30, 30, 46, 0.6);\n    border-radius: 10px;\n    overflow: hidden;\n    border: 1px solid rgba(147, 112, 219, 0.1);\n}\n\n/* Pack Header */\n.lumiverse-browser-pack-header {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    width: 100%;\n    padding: 10px 12px;\n    background: transparent;\n    border: none;\n    cursor: pointer;\n    transition: background 0.15s ease;\n    text-align: left;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-browser-pack-header:hover {\n    background: rgba(147, 112, 219, 0.08);\n}\n\n.lumiverse-browser-pack-header--expanded {\n    background: rgba(147, 112, 219, 0.1);\n    border-bottom: 1px solid rgba(147, 112, 219, 0.15);\n}\n\n.lumiverse-browser-pack-cover {\n    width: 36px;\n    height: 36px;\n    border-radius: 6px;\n    object-fit: cover;\n    flex-shrink: 0;\n    animation: lumiverseFadeIn 0.2s ease;\n}\n\n.lumiverse-browser-pack-cover-placeholder {\n    width: 36px;\n    height: 36px;\n    border-radius: 6px;\n    background: rgba(147, 112, 219, 0.15);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 18px;\n    flex-shrink: 0;\n}\n\n.lumiverse-browser-pack-info {\n    flex: 1;\n    min-width: 0;\n    display: flex;\n    flex-direction: column;\n}\n\n.lumiverse-browser-pack-name {\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-browser-pack-meta {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n    margin-top: 2px;\n}\n\n.lumiverse-browser-pack-custom-badge {\n    font-size: 9px;\n    font-weight: 600;\n    text-transform: uppercase;\n    color: var(--lumiverse-warning);\n    background: rgba(245, 158, 11, 0.15);\n    padding: 1px 4px;\n    border-radius: 3px;\n}\n\n.lumiverse-browser-pack-chevron {\n    font-size: 10px;\n    color: var(--lumiverse-text-muted);\n    transition: transform 0.2s ease;\n}\n\n.lumiverse-browser-pack-chevron--rotated {\n    transform: rotate(180deg);\n}\n\n/* Pack Items */\n.lumiverse-browser-pack-items {\n    overflow: hidden;\n}\n\n.lumiverse-browser-items-container {\n    padding: 8px 10px;\n}\n\n.lumiverse-browser-items-container::-webkit-scrollbar {\n    width: 6px;\n}\n\n.lumiverse-browser-items-container::-webkit-scrollbar-track {\n    background: transparent;\n}\n\n.lumiverse-browser-items-container::-webkit-scrollbar-thumb {\n    background: rgba(147, 112, 219, 0.3);\n    border-radius: 3px;\n}\n\n/* Item Card */\n.lumiverse-browser-item {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 8px 10px;\n    border-radius: 6px;\n    border: 1px solid transparent;\n    cursor: pointer;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-browser-item:hover {\n    transform: translateX(2px);\n}\n\n.lumiverse-browser-item--selected {\n    box-shadow:\n        0 0 0 1px currentColor,\n        0 2px 8px rgba(0, 0, 0, 0.15);\n}\n\n.lumiverse-browser-item-check {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 18px;\n    height: 18px;\n    border-radius: 50%;\n    background: rgba(100, 200, 100, 0.9);\n    color: white;\n    margin-left: auto;\n    flex-shrink: 0;\n}\n\n.lumiverse-browser-item-image {\n    width: 32px;\n    height: 32px;\n    border-radius: 4px;\n    object-fit: cover;\n    flex-shrink: 0;\n    animation: lumiverseFadeIn 0.2s ease;\n}\n\n.lumiverse-browser-item-content {\n    flex: 1;\n    min-width: 0;\n}\n\n.lumiverse-browser-item-header {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n}\n\n.lumiverse-browser-item-icon {\n    font-size: 12px;\n}\n\n.lumiverse-browser-item-name {\n    font-size: 12px;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-browser-item-desc {\n    margin: 2px 0 0 0;\n    font-size: 10px;\n    color: var(--lumiverse-text-muted);\n    overflow: hidden;\n    text-overflow: ellipsis;\n    display: -webkit-box;\n    -webkit-line-clamp: 1;\n    -webkit-box-orient: vertical;\n}\n\n/* Empty States */\n.lumiverse-browser-empty {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    padding: 40px 20px;\n    text-align: center;\n}\n\n.lumiverse-browser-empty-icon {\n    font-size: 40px;\n    margin-bottom: 12px;\n    opacity: 0.5;\n}\n\n.lumiverse-browser-empty p {\n    margin: 0 0 4px 0;\n    font-size: 14px;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-browser-empty-hint {\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-browser-empty-items {\n    padding: 16px;\n    text-align: center;\n    color: var(--lumiverse-text-dim);\n    font-size: 12px;\n    font-style: italic;\n}\n\n/* Clear All Selections Button */\n.lumiverse-browser-clear-all {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 8px;\n    width: 100%;\n    padding: 10px 16px;\n    margin-top: 12px;\n    background: linear-gradient(\n        135deg,\n        rgba(220, 80, 80, 0.08) 0%,\n        rgba(180, 60, 90, 0.12) 100%\n    );\n    border: 1px solid rgba(220, 100, 100, 0.2);\n    border-radius: 8px;\n    color: var(--lumiverse-text-muted);\n    font-size: 12px;\n    font-weight: 500;\n    letter-spacing: 0.02em;\n    cursor: pointer;\n    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);\n}\n\n.lumiverse-browser-clear-all:hover {\n    background: linear-gradient(\n        135deg,\n        rgba(220, 80, 80, 0.15) 0%,\n        rgba(180, 60, 90, 0.2) 100%\n    );\n    border-color: rgba(220, 100, 100, 0.4);\n    color: var(--lumiverse-text);\n    transform: translateY(-1px);\n}\n\n.lumiverse-browser-clear-all:active {\n    transform: translateY(0);\n}\n\n.lumiverse-browser-clear-count {\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    min-width: 18px;\n    height: 18px;\n    padding: 0 5px;\n    background: rgba(220, 100, 100, 0.25);\n    border-radius: 9px;\n    font-size: 10px;\n    font-weight: 600;\n}\n\n/* ----------------------------------------\n   Preset Manager\n   ---------------------------------------- */\n.lumiverse-preset-manager {\n    padding: 12px;\n    display: flex;\n    flex-direction: column;\n    gap: 16px;\n}\n\n.lumiverse-preset-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    gap: 12px;\n}\n\n.lumiverse-preset-title {\n    margin: 0;\n    font-size: 14px;\n    font-weight: 600;\n    color: var(--lumiverse-text-primary);\n}\n\n.lumiverse-preset-create-btn {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    padding: 6px 12px;\n    background: rgba(147, 112, 219, 0.2);\n    border: 1px solid rgba(147, 112, 219, 0.3);\n    border-radius: 6px;\n    color: rgba(147, 112, 219, 1);\n    font-size: 12px;\n    font-weight: 500;\n    cursor: pointer;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-preset-create-btn:hover {\n    background: rgba(147, 112, 219, 0.3);\n    border-color: rgba(147, 112, 219, 0.5);\n}\n\n.lumiverse-preset-create-form {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    min-width: 0;\n    flex: 1;\n    max-width: 220px;\n}\n\n.lumiverse-preset-input {\n    flex: 1;\n    padding: 6px 10px;\n    background: rgba(30, 30, 46, 0.8);\n    border: 1px solid rgba(147, 112, 219, 0.3);\n    border-radius: 6px;\n    color: var(--lumiverse-text-primary);\n    font-size: 12px;\n    min-width: 0;\n    width: 100%;\n}\n\n/* Responsive: preset form on small screens */\n@media (max-width: 380px) {\n    .lumiverse-preset-header {\n        flex-wrap: wrap;\n        gap: 8px;\n    }\n\n    .lumiverse-preset-create-form {\n        width: 100%;\n        max-width: none;\n        order: 1;\n    }\n\n    .lumiverse-preset-title {\n        flex: 1;\n    }\n}\n\n.lumiverse-preset-input:focus {\n    outline: none;\n    border-color: rgba(147, 112, 219, 0.6);\n}\n\n.lumiverse-preset-input::placeholder {\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-preset-list {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n}\n\n.lumiverse-preset-card {\n    background: rgba(30, 30, 46, 0.6);\n    border: 1px solid rgba(255, 255, 255, 0.08);\n    border-radius: 10px;\n    padding: 12px;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-preset-card:hover {\n    background: rgba(30, 30, 46, 0.8);\n    border-color: rgba(147, 112, 219, 0.2);\n}\n\n.lumiverse-preset-card--active {\n    border-color: rgba(147, 112, 219, 0.4);\n    background: rgba(147, 112, 219, 0.08);\n}\n\n.lumiverse-preset-card-header {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    margin-bottom: 8px;\n}\n\n.lumiverse-preset-card-icon {\n    color: rgba(147, 112, 219, 0.8);\n}\n\n.lumiverse-preset-card-name {\n    flex: 1;\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--lumiverse-text-primary);\n}\n\n.lumiverse-preset-card-active-badge {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    padding: 2px 8px;\n    background: rgba(147, 112, 219, 0.2);\n    border-radius: 10px;\n    font-size: 10px;\n    font-weight: 500;\n    color: rgba(147, 112, 219, 1);\n}\n\n.lumiverse-preset-card-meta {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    margin-bottom: 10px;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-preset-card-traits {\n    color: var(--lumiverse-text-secondary);\n}\n\n/* Preset stats with icons */\n.lumiverse-preset-stats {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n}\n\n.lumiverse-preset-stat {\n    display: flex;\n    align-items: center;\n    gap: 3px;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-preset-stat svg {\n    opacity: 0.7;\n}\n\n.lumiverse-preset-stat--chimera {\n    color: rgba(100, 200, 255, 0.9);\n}\n\n.lumiverse-preset-stat--chimera svg {\n    color: rgba(100, 200, 255, 0.9);\n    opacity: 1;\n}\n\n.lumiverse-preset-stat--council {\n    color: rgba(147, 112, 219, 0.9);\n}\n\n.lumiverse-preset-stat--council svg {\n    color: rgba(147, 112, 219, 0.9);\n    opacity: 1;\n}\n\n.lumiverse-preset-card-mode {\n    padding: 2px 6px;\n    background: rgba(255, 193, 7, 0.15);\n    border-radius: 4px;\n    font-size: 10px;\n    color: rgba(255, 193, 7, 0.9);\n}\n\n.lumiverse-preset-card-time {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    margin-left: auto;\n}\n\n.lumiverse-preset-card-actions {\n    display: flex;\n    gap: 6px;\n}\n\n.lumiverse-preset-btn {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    padding: 6px 10px;\n    background: rgba(255, 255, 255, 0.06);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    border-radius: 6px;\n    color: var(--lumiverse-text-secondary);\n    font-size: 12px;\n    font-weight: 500;\n    cursor: pointer;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-preset-btn:hover {\n    background: rgba(255, 255, 255, 0.1);\n    color: var(--lumiverse-text-primary);\n}\n\n.lumiverse-preset-btn--primary {\n    background: rgba(147, 112, 219, 0.2);\n    border-color: rgba(147, 112, 219, 0.3);\n    color: rgba(147, 112, 219, 1);\n}\n\n.lumiverse-preset-btn--primary:hover {\n    background: rgba(147, 112, 219, 0.3);\n    border-color: rgba(147, 112, 219, 0.5);\n}\n\n.lumiverse-preset-btn--primary:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n}\n\n.lumiverse-preset-btn--danger {\n    color: rgba(255, 100, 100, 0.8);\n}\n\n.lumiverse-preset-btn--danger:hover {\n    background: rgba(255, 100, 100, 0.15);\n    border-color: rgba(255, 100, 100, 0.3);\n    color: rgba(255, 100, 100, 1);\n}\n\n.lumiverse-preset-btn--confirming {\n    background: rgba(255, 100, 100, 0.2);\n    border-color: rgba(255, 100, 100, 0.4);\n    color: rgba(255, 100, 100, 1);\n}\n\n.lumiverse-preset-empty {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    padding: 32px 16px;\n    text-align: center;\n}\n\n.lumiverse-preset-empty-icon {\n    margin-bottom: 12px;\n    color: var(--lumiverse-text-muted);\n    opacity: 0.5;\n}\n\n.lumiverse-preset-empty h4 {\n    margin: 0 0 8px 0;\n    font-size: 14px;\n    font-weight: 600;\n    color: var(--lumiverse-text-primary);\n}\n\n.lumiverse-preset-empty p {\n    margin: 0;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n    max-width: 240px;\n}\n\n.lumiverse-preset-help {\n    padding: 10px;\n    background: rgba(30, 30, 46, 0.4);\n    border-radius: 8px;\n}\n\n.lumiverse-preset-help p {\n    margin: 0;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n    line-height: 1.5;\n}\n\n/* ----------------------------------------\n   OOC Analytics Dashboard\n   ---------------------------------------- */\n.lumiverse-ooc-analytics {\n    padding: 12px;\n    display: flex;\n    flex-direction: column;\n    gap: 16px;\n}\n\n.lumiverse-analytics-section {\n    background: rgba(30, 30, 46, 0.6);\n    border-radius: 10px;\n    padding: 12px;\n}\n\n.lumiverse-analytics-section-title {\n    margin: 0 0 12px 0;\n    font-size: 11px;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    color: var(--lumiverse-text-muted);\n}\n\n/* Stats Grid */\n.lumiverse-analytics-stats-grid {\n    display: grid;\n    grid-template-columns: repeat(2, 1fr);\n    gap: 8px;\n}\n\n.lumiverse-analytics-stat {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 10px 12px;\n    background: rgba(147, 112, 219, 0.08);\n    border-radius: 8px;\n    border: 1px solid rgba(147, 112, 219, 0.15);\n}\n\n.lumiverse-analytics-stat-icon {\n    font-size: 20px;\n    flex-shrink: 0;\n}\n\n.lumiverse-analytics-stat-info {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n}\n\n.lumiverse-analytics-stat-value {\n    font-size: 18px;\n    font-weight: 700;\n    color: var(--lumiverse-primary);\n}\n\n.lumiverse-analytics-stat-label {\n    font-size: 10px;\n    color: var(--lumiverse-text-muted);\n    text-transform: uppercase;\n    letter-spacing: 0.3px;\n}\n\n.lumiverse-analytics-stat-trend {\n    font-size: 14px;\n    padding: 2px 6px;\n    border-radius: 4px;\n    background: rgba(147, 112, 219, 0.15);\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-analytics-stat-trend--up {\n    background: rgba(34, 197, 94, 0.15);\n    color: var(--lumiverse-success);\n}\n\n.lumiverse-analytics-stat-trend--down {\n    background: rgba(239, 68, 68, 0.15);\n    color: var(--lumiverse-danger);\n}\n\n/* Type Distribution */\n.lumiverse-analytics-distribution {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumiverse-analytics-bars {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n}\n\n.lumiverse-analytics-bar-item {\n    display: flex;\n    flex-direction: column;\n    gap: 4px;\n}\n\n.lumiverse-analytics-bar-label {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    font-size: 12px;\n}\n\n.lumiverse-analytics-bar-icon {\n    font-size: 12px;\n}\n\n.lumiverse-analytics-bar-name {\n    flex: 1;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-analytics-bar-count {\n    color: var(--lumiverse-text-muted);\n    font-weight: 600;\n}\n\n.lumiverse-analytics-bar-track {\n    height: 6px;\n    background: rgba(147, 112, 219, 0.1);\n    border-radius: 3px;\n    overflow: hidden;\n}\n\n.lumiverse-analytics-bar-fill {\n    height: 100%;\n    border-radius: 3px;\n    transition: width 0.5s ease-out;\n}\n\n/* Insights */\n.lumiverse-analytics-insights {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumiverse-analytics-insight {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 10px 12px;\n    background: rgba(147, 112, 219, 0.05);\n    border-radius: 8px;\n}\n\n.lumiverse-analytics-insight-icon {\n    font-size: 18px;\n    flex-shrink: 0;\n}\n\n.lumiverse-analytics-insight-content {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n}\n\n.lumiverse-analytics-insight-title {\n    font-size: 10px;\n    color: var(--lumiverse-text-muted);\n    text-transform: uppercase;\n    letter-spacing: 0.3px;\n}\n\n.lumiverse-analytics-insight-value {\n    font-size: 14px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-analytics-insight-desc {\n    font-size: 11px;\n    color: var(--lumiverse-text-dim);\n}\n\n/* Timeline */\n.lumiverse-analytics-timeline {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumiverse-analytics-comment {\n    display: flex;\n    align-items: flex-start;\n    gap: 10px;\n    padding: 8px 10px;\n    background: rgba(147, 112, 219, 0.05);\n    border-radius: 6px;\n    border-left: 2px solid var(--lumiverse-primary);\n}\n\n.lumiverse-analytics-comment-icon {\n    font-size: 14px;\n    flex-shrink: 0;\n    margin-top: 2px;\n}\n\n.lumiverse-analytics-comment-content {\n    flex: 1;\n    min-width: 0;\n}\n\n.lumiverse-analytics-comment-text {\n    margin: 0;\n    font-size: 12px;\n    color: var(--lumiverse-text);\n    line-height: 1.4;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    display: -webkit-box;\n    -webkit-line-clamp: 2;\n    -webkit-box-orient: vertical;\n}\n\n.lumiverse-analytics-comment-time {\n    font-size: 10px;\n    color: var(--lumiverse-text-dim);\n}\n\n/* Quick Controls */\n.lumiverse-analytics-controls {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n/* Empty state */\n.lumiverse-analytics-empty {\n    padding: 20px;\n    text-align: center;\n    color: var(--lumiverse-text-dim);\n    font-size: 12px;\n    font-style: italic;\n}\n\n/* ----------------------------------------\n   Panel Toggle Button\n   ---------------------------------------- */\n.lumiverse-panel-toggle {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    padding: 8px 14px;\n    background: linear-gradient(135deg, rgba(147, 112, 219, 0.95) 0%, rgba(123, 88, 195, 0.95) 100%);\n    border: 1px solid rgba(255, 255, 255, 0.2);\n    border-radius: 20px;\n    cursor: pointer;\n    box-shadow: 0 4px 12px rgba(147, 112, 219, 0.4), 0 0 20px rgba(147, 112, 219, 0.2);\n    white-space: nowrap;\n    transition: box-shadow 0.15s ease, border-color 0.15s ease;\n}\n\n.lumiverse-panel-toggle:hover {\n    box-shadow: 0 4px 16px rgba(147, 112, 219, 0.6), 0 0 35px rgba(147, 112, 219, 0.4);\n    border-color: rgba(255, 255, 255, 0.35);\n}\n\n.lumiverse-panel-toggle--active {\n    background: linear-gradient(135deg, rgba(100, 80, 180, 0.95) 0%, rgba(80, 60, 160, 0.95) 100%);\n    /* Position is now controlled by transform (x) for sync with panel animation */\n}\n\n.lumiverse-panel-toggle-icon {\n    font-size: 16px;\n    line-height: 1;\n}\n\n.lumiverse-panel-toggle-label {\n    font-size: 12px;\n    font-weight: 600;\n    color: white;\n    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);\n}\n\n/* Left-side toggle button positioning */\n.lumiverse-panel-toggle--left {\n    /* Mirror shadow direction for left side */\n    box-shadow: 0 4px 12px rgba(147, 112, 219, 0.4), 0 0 20px rgba(147, 112, 219, 0.2);\n}\n\n.lumiverse-toggle-container--left {\n    /* Container styles when positioned on left */\n}\n\n/* ----------------------------------------\n   Flush-Mounted Drawer Tab\n   Unified with drawer - animates as one element\n   ---------------------------------------- */\n\n.lumiverse-drawer-tab {\n    /* Part of the flex layout, not absolutely positioned */\n    flex-shrink: 0;\n    align-self: flex-start;\n    margin-top: 64px;\n    width: 48px;\n    box-sizing: border-box; /* Ensure width includes border */\n\n    /* Vertical layout */\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    gap: 8px;\n    padding: 16px 8px 20px;\n\n    /* Flush-mounted appearance - rounded only on outer edge */\n    background: linear-gradient(\n        180deg,\n        rgba(28, 24, 38, 0.98) 0%,\n        rgba(20, 17, 28, 0.98) 100%\n    );\n    border: 1px solid rgba(147, 112, 219, 0.25);\n    border-right: none;\n    border-radius: 12px 0 0 12px;\n\n    /* Interactive */\n    cursor: pointer;\n    pointer-events: auto;\n\n    /* Subtle glow effect */\n    box-shadow:\n        -4px 0 16px rgba(147, 112, 219, 0.15),\n        inset 1px 0 0 rgba(147, 112, 219, 0.1);\n\n    /* Smooth interactions */\n    transition:\n        background 0.2s ease,\n        box-shadow 0.2s ease,\n        border-color 0.2s ease;\n}\n\n.lumiverse-drawer-tab:hover {\n    background: linear-gradient(\n        180deg,\n        rgba(40, 34, 52, 0.98) 0%,\n        rgba(28, 24, 38, 0.98) 100%\n    );\n    border-color: rgba(147, 112, 219, 0.4);\n    box-shadow:\n        -6px 0 24px rgba(147, 112, 219, 0.25),\n        inset 1px 0 0 rgba(147, 112, 219, 0.2);\n}\n\n.lumiverse-drawer-tab--active {\n    background: linear-gradient(\n        180deg,\n        rgba(50, 42, 68, 0.98) 0%,\n        rgba(35, 30, 48, 0.98) 100%\n    );\n    border-color: rgba(147, 112, 219, 0.5);\n}\n\n.lumiverse-drawer-tab-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 28px;\n    height: 28px;\n    background: linear-gradient(\n        135deg,\n        rgba(147, 112, 219, 0.9) 0%,\n        rgba(123, 88, 195, 0.9) 100%\n    );\n    border-radius: 8px;\n    color: white;\n    box-shadow:\n        0 2px 8px rgba(147, 112, 219, 0.4),\n        inset 0 1px 0 rgba(255, 255, 255, 0.2);\n}\n\n.lumiverse-drawer-tab:hover .lumiverse-drawer-tab-icon {\n    box-shadow:\n        0 2px 12px rgba(147, 112, 219, 0.6),\n        inset 0 1px 0 rgba(255, 255, 255, 0.25);\n}\n\n.lumiverse-drawer-tab-label {\n    writing-mode: vertical-rl;\n    text-orientation: mixed;\n    transform: rotate(180deg);\n    font-size: 11px;\n    font-weight: 600;\n    letter-spacing: 0.5px;\n    color: rgba(255, 255, 255, 0.85);\n    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);\n}\n\n.lumiverse-drawer-tab:hover .lumiverse-drawer-tab-label {\n    color: white;\n}\n\n/* Update indicator positioning for drawer tab */\n.lumiverse-drawer-tab .lumiverse-update-dot {\n    position: absolute;\n    top: 8px;\n    left: 8px;\n}\n\n.lumiverse-drawer-tab--has-updates {\n    border-color: rgba(255, 180, 100, 0.4);\n}\n\n.lumiverse-drawer-tab--has-updates::before {\n    content: '';\n    position: absolute;\n    inset: -1px;\n    border-radius: 12px 0 0 12px;\n    background: linear-gradient(\n        90deg,\n        rgba(255, 180, 100, 0.15) 0%,\n        transparent 60%\n    );\n    pointer-events: none;\n}\n\n/* ----------------------------------------\n   Left-Side Panel Positioning\n   Mirror layout when drawer docks to left side\n   ---------------------------------------- */\n\n/* Wrapper positioned on left */\n.lumiverse-viewport-wrapper--left {\n    flex-direction: row-reverse; /* Flip the order: panel first, then tab */\n}\n\n/* Panel layout flipped for left side */\n.lumiverse-viewport-panel--left {\n    flex-direction: row-reverse; /* Tab -> Tabs -> Main becomes Main -> Tabs -> Tab */\n}\n\n/* Tab sidebar border flipped for left side */\n.lumiverse-viewport-panel--left .lumiverse-vp-tabs {\n    border-left: none;\n    border-right: 1px solid rgba(147, 112, 219, 0.2);\n}\n\n/* Active tab indicator on opposite side */\n.lumiverse-viewport-panel--left .lumiverse-vp-tab--active {\n    box-shadow: inset -2px 0 0 var(--lumiverse-primary);\n}\n\n/* Main content border flipped */\n.lumiverse-viewport-panel--left .lumiverse-vp-main {\n    border-left: none;\n    border-right: 1px solid rgba(147, 112, 219, 0.15);\n}\n\n/* Drawer tab for left-side panel - rounded on right, flat on left */\n.lumiverse-drawer-tab--left {\n    /* With row-reverse on parent, first DOM element (drawer tab) goes rightmost - which is correct */\n    /* No order change needed - we want it on the right edge */\n    border-radius: 0 12px 12px 0;\n    border-left: none;\n    border-right: 1px solid rgba(147, 112, 219, 0.25);\n    \n    /* Flip shadow direction */\n    box-shadow:\n        4px 0 16px rgba(147, 112, 219, 0.15),\n        inset -1px 0 0 rgba(147, 112, 219, 0.1);\n}\n\n.lumiverse-drawer-tab--left:hover {\n    box-shadow:\n        6px 0 24px rgba(147, 112, 219, 0.25),\n        inset -1px 0 0 rgba(147, 112, 219, 0.2);\n}\n\n/* Update indicator position for left-side tab */\n.lumiverse-drawer-tab--left .lumiverse-update-dot {\n    left: auto;\n    right: 8px;\n}\n\n.lumiverse-drawer-tab--left.lumiverse-drawer-tab--has-updates::before {\n    background: linear-gradient(\n        -90deg,\n        rgba(255, 180, 100, 0.15) 0%,\n        transparent 60%\n    );\n    border-radius: 0 12px 12px 0;\n}\n\n/* ----------------------------------------\n   Standalone Drawer Tab Container\n   Fixed position container outside sliding wrapper\n   Ensures tab is always accessible when panel is closed\n   ---------------------------------------- */\n\n.lumiverse-drawer-tab-standalone {\n    /* Fixed positioning relative to viewport */\n    position: fixed;\n    top: 0;\n    height: 100vh;\n    height: 100dvh;\n    z-index: 9999;\n\n    /* Flex container to position tab with margin */\n    display: flex;\n    flex-direction: column;\n    justify-content: flex-start;\n    align-items: flex-start;\n\n    /* Container doesn't capture events - tab does */\n    pointer-events: none;\n}\n\n/* Position on right side (default) */\n.lumiverse-drawer-tab-standalone:not(.lumiverse-drawer-tab-standalone--left) {\n    right: 0;\n    align-items: flex-end;\n}\n\n/* Position on left side */\n.lumiverse-drawer-tab-standalone--left {\n    left: 0;\n    align-items: flex-start;\n}\n\n/* Tab positioning within standalone container */\n.lumiverse-drawer-tab-standalone .lumiverse-drawer-tab {\n    margin-top: 15vh; /* Matches verticalPosition default */\n    pointer-events: auto; /* Re-enable events on the tab */\n}\n\n/* ----------------------------------------\n   Compact Drawer Tab Variant\n   Smaller, minimal drawer tab option\n   ---------------------------------------- */\n\n.lumiverse-drawer-tab--compact {\n    padding: 8px 6px;\n    width: 32px;\n    gap: 0;\n}\n\n.lumiverse-drawer-tab--compact .lumiverse-drawer-tab-label {\n    display: none;\n}\n\n.lumiverse-drawer-tab--compact .lumiverse-drawer-tab-icon {\n    box-shadow: none;\n    background: none;\n    width: 20px;\n    height: 20px;\n}\n\n.lumiverse-drawer-tab--compact:hover .lumiverse-drawer-tab-icon {\n    box-shadow: none;\n}\n\n.lumiverse-drawer-tab--compact .lumiverse-update-dot {\n    top: 4px;\n    left: 4px;\n    width: 6px;\n    height: 6px;\n}\n\n/* ----------------------------------------\n   Viewport Panel - Mobile Styles\n   Adjusts sizes for better mobile experience\n   Note: Wrapper width is controlled by JS inline styles\n   ---------------------------------------- */\n\n@media (max-width: 600px) {\n    /* Drawer tab: smaller and tighter on mobile */\n    .lumiverse-drawer-tab {\n        width: 40px;\n        padding: 12px 6px 16px;\n        gap: 6px;\n        margin-top: 48px;\n        border-radius: 10px 0 0 10px;\n    }\n\n    .lumiverse-drawer-tab--left {\n        border-radius: 0 10px 10px 0;\n    }\n\n    .lumiverse-drawer-tab-icon {\n        width: 24px;\n        height: 24px;\n        border-radius: 6px;\n    }\n\n    .lumiverse-drawer-tab-label {\n        font-size: 10px;\n        letter-spacing: 0.3px;\n    }\n\n    /* Tab sidebar narrower on mobile */\n    .lumiverse-vp-tabs {\n        width: 48px;\n        padding: 6px 0;\n    }\n\n    .lumiverse-vp-tab {\n        width: 44px;\n        height: 44px;\n    }\n\n    .lumiverse-vp-tab-icon {\n        font-size: 16px;\n    }\n\n    .lumiverse-vp-tab-label {\n        font-size: 9px;\n        margin-top: 2px;\n    }\n\n    /* Header adjustments */\n    .lumiverse-vp-header {\n        padding: 12px 14px;\n    }\n\n    .lumiverse-vp-header-title {\n        font-size: 14px;\n    }\n\n    /* Content area adjustments */\n    .lumiverse-vp-content {\n        padding: 12px;\n    }\n}\n\n/* Extra small screens */\n@media (max-width: 380px) {\n    .lumiverse-drawer-tab {\n        width: 36px;\n        padding: 10px 5px 14px;\n    }\n\n    .lumiverse-drawer-tab-label {\n        display: none;\n    }\n\n    .lumiverse-vp-tabs {\n        width: 44px;\n    }\n\n    .lumiverse-vp-tab {\n        width: 40px;\n        height: 40px;\n    }\n}\n\n/* ----------------------------------------\n   Viewport Panel - Settings Panels\n   ---------------------------------------- */\n\n/* General settings panel styles */\n.lumiverse-vp-settings-panel {\n    padding: 16px;\n    display: flex;\n    flex-direction: column;\n    gap: 16px;\n}\n\n.lumiverse-vp-settings-section {\n    background: rgba(147, 112, 219, 0.05);\n    border: 1px solid rgba(147, 112, 219, 0.15);\n    border-radius: 10px;\n    padding: 14px;\n}\n\n.lumiverse-vp-settings-section-header {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    margin-bottom: 10px;\n    color: var(--lumiverse-text);\n    font-weight: 600;\n    font-size: 13px;\n}\n\n.lumiverse-vp-settings-desc {\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n    margin: 0 0 12px 0;\n    line-height: 1.4;\n}\n\n/* Toggle row */\n.lumiverse-vp-toggle-row {\n    display: flex;\n    align-items: flex-start;\n    justify-content: space-between;\n    padding: 8px 0;\n    gap: 12px;\n}\n\n.lumiverse-vp-toggle-label {\n    flex: 1;\n    cursor: pointer;\n}\n\n.lumiverse-vp-toggle-text {\n    display: block;\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-vp-toggle-hint {\n    display: block;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n    margin-top: 2px;\n}\n\n.lumiverse-vp-toggle-switch-wrapper {\n    flex-shrink: 0;\n}\n\n.lumiverse-vp-toggle-input {\n    display: none !important;\n    position: absolute !important;\n    opacity: 0 !important;\n    width: 0 !important;\n    height: 0 !important;\n    pointer-events: none !important;\n}\n\n.lumiverse-vp-toggle-track {\n    position: relative;\n    width: 40px;\n    height: 22px;\n    background: var(--lumiverse-secondary);\n    border-radius: 11px;\n    cursor: pointer;\n    transition: background 0.2s ease;\n}\n\n.lumiverse-vp-toggle-track--on {\n    background: var(--lumiverse-primary);\n}\n\n.lumiverse-vp-toggle-thumb {\n    position: absolute;\n    top: 2px;\n    left: 2px;\n    width: 18px;\n    height: 18px;\n    background: white;\n    border-radius: 50%;\n    transition: transform 0.2s ease;\n}\n\n.lumiverse-vp-toggle-track--on .lumiverse-vp-toggle-thumb {\n    transform: translateX(18px);\n}\n\n/* Disabled toggle states */\n.lumiverse-vp-toggle-row--disabled {\n    opacity: 0.5;\n    pointer-events: none;\n}\n\n.lumiverse-vp-toggle-row--disabled .lumiverse-vp-toggle-label {\n    cursor: not-allowed;\n}\n\n.lumiverse-vp-toggle-track--disabled {\n    background: var(--lumiverse-bg-dark) !important;\n    cursor: not-allowed;\n}\n\n.lumiverse-vp-toggle-track--disabled .lumiverse-vp-toggle-thumb {\n    background: rgba(255, 255, 255, 0.5);\n}\n\n/* Field input */\n.lumiverse-vp-field {\n    margin-bottom: 12px;\n}\n\n.lumiverse-vp-field--inline {\n    display: flex;\n    flex-wrap: wrap;\n    align-items: center;\n    gap: 8px;\n}\n\n.lumiverse-vp-field-label {\n    display: block;\n    font-size: 12px;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n    margin-bottom: 6px;\n}\n\n.lumiverse-vp-field--inline .lumiverse-vp-field-label {\n    margin-bottom: 0;\n    flex: 1;\n}\n\n.lumiverse-vp-field-input {\n    width: 100%;\n    padding: 8px 12px;\n    background: var(--lumiverse-bg);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 6px;\n    color: var(--lumiverse-text);\n    font-size: 13px;\n    transition: border-color 0.2s ease;\n}\n\n.lumiverse-vp-field-input:focus {\n    outline: none;\n    border-color: var(--lumiverse-primary);\n}\n\n.lumiverse-vp-field-input--small {\n    width: 70px;\n    text-align: center;\n}\n\n.lumiverse-vp-field-hint {\n    display: block;\n    font-size: 11px;\n    color: var(--lumiverse-text-dim);\n    margin-top: 4px;\n}\n\n.lumiverse-vp-field--inline .lumiverse-vp-field-hint {\n    flex-basis: 100%;\n}\n\n/* Style options (radio buttons) */\n.lumiverse-vp-style-options {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumiverse-vp-style-option {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 12px 14px;\n    background: var(--lumiverse-bg);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 8px;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-vp-style-option:hover {\n    border-color: var(--lumiverse-border-light);\n    background: var(--lumiverse-bg-hover);\n}\n\n.lumiverse-vp-style-option--selected {\n    border-color: var(--lumiverse-primary);\n    background: rgba(147, 112, 219, 0.1);\n}\n\n.lumiverse-vp-style-option input[type="radio"] {\n    display: none !important;\n    position: absolute !important;\n    opacity: 0 !important;\n    width: 0 !important;\n    height: 0 !important;\n    pointer-events: none !important;\n}\n\n.lumiverse-vp-style-option-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 32px;\n    height: 32px;\n    background: rgba(147, 112, 219, 0.15);\n    border-radius: 6px;\n    color: var(--lumiverse-primary);\n}\n\n.lumiverse-vp-style-option-text {\n    flex: 1;\n}\n\n.lumiverse-vp-style-option-title {\n    display: block;\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-vp-style-option-desc {\n    display: block;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n    margin-top: 2px;\n    line-height: 1.3;\n}\n\n/* Save button */\n.lumiverse-vp-save-btn {\n    width: 100%;\n    padding: 10px 16px;\n    background: var(--lumiverse-primary);\n    border: none;\n    border-radius: 8px;\n    color: white;\n    font-size: 13px;\n    font-weight: 600;\n    cursor: pointer;\n    transition: background 0.2s ease;\n}\n\n.lumiverse-vp-save-btn:hover {\n    background: var(--lumiverse-primary-hover);\n}\n\n/* Collapsible sections */\n.lumiverse-vp-collapsible {\n    background: rgba(147, 112, 219, 0.05);\n    border: 1px solid rgba(147, 112, 219, 0.15);\n    border-radius: 10px;\n    overflow: hidden;\n}\n\n.lumiverse-vp-collapsible-header {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    width: 100%;\n    padding: 12px 14px;\n    background: transparent;\n    border: none;\n    cursor: pointer;\n    color: var(--lumiverse-text);\n    font-size: 13px;\n    font-weight: 600;\n    text-align: left;\n    transition: background 0.2s ease;\n}\n\n.lumiverse-vp-collapsible-header:hover {\n    background: rgba(147, 112, 219, 0.08);\n}\n\n.lumiverse-vp-collapsible-chevron {\n    display: flex;\n    color: var(--lumiverse-text-muted);\n    transition: transform 0.2s ease;\n}\n\n.lumiverse-vp-collapsible-chevron--open {\n    transform: rotate(180deg);\n}\n\n.lumiverse-vp-collapsible-icon {\n    display: flex;\n    color: var(--lumiverse-primary);\n}\n\n.lumiverse-vp-collapsible-title {\n    flex: 1;\n}\n\n.lumiverse-vp-collapsible-status {\n    padding: 2px 8px;\n    background: rgba(100, 100, 100, 0.2);\n    border-radius: 10px;\n    font-size: 10px;\n    font-weight: 600;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-vp-collapsible-status--active {\n    background: rgba(34, 197, 94, 0.2);\n    color: var(--lumiverse-success);\n}\n\n.lumiverse-vp-collapsible-content {\n    overflow: hidden;\n}\n\n.lumiverse-vp-collapsible-inner {\n    padding: 12px 14px 14px 14px;\n}\n\n/* Info box */\n.lumiverse-vp-info-box {\n    background: rgba(147, 112, 219, 0.08);\n    border: 1px solid rgba(147, 112, 219, 0.2);\n    border-radius: 8px;\n    padding: 12px;\n    margin-top: 12px;\n}\n\n.lumiverse-vp-info-box--muted {\n    opacity: 0.5;\n}\n\n.lumiverse-vp-info-box-header {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    font-size: 11px;\n    font-weight: 600;\n    color: var(--lumiverse-primary);\n    margin-bottom: 8px;\n}\n\n.lumiverse-vp-info-box-list {\n    margin: 0;\n    padding: 0 0 0 16px;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n    line-height: 1.5;\n}\n\n.lumiverse-vp-info-box-list code {\n    background: rgba(147, 112, 219, 0.15);\n    padding: 1px 4px;\n    border-radius: 3px;\n    font-size: 10px;\n}\n\n/* Filter items */\n.lumiverse-vp-filter-item {\n    padding: 8px 0;\n    border-bottom: 1px solid rgba(147, 112, 219, 0.1);\n}\n\n.lumiverse-vp-filter-item:last-child {\n    border-bottom: none;\n}\n\n.lumiverse-vp-filter-options {\n    padding: 8px 0 0 24px;\n    overflow: hidden;\n}\n\n.lumiverse-vp-filter-sub {\n    padding-left: 16px;\n    border-left: 2px solid rgba(147, 112, 219, 0.2);\n    margin-left: 8px;\n}\n\n/* ----------------------------------------\n   Viewport Panel - Summary Editor\n   ---------------------------------------- */\n.lumiverse-vp-summary-editor {\n    display: flex;\n    flex-direction: column;\n    height: 100%;\n    padding: 12px;\n    gap: 12px;\n}\n\n.lumiverse-vp-summary-status {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    padding: 10px 12px;\n    border-radius: 8px;\n    font-size: 12px;\n    font-weight: 500;\n}\n\n.lumiverse-vp-summary-status--exists {\n    background: rgba(34, 197, 94, 0.1);\n    border: 1px solid rgba(34, 197, 94, 0.3);\n    color: var(--lumiverse-success);\n}\n\n.lumiverse-vp-summary-status--empty {\n    background: rgba(245, 158, 11, 0.1);\n    border: 1px solid rgba(245, 158, 11, 0.3);\n    color: var(--lumiverse-warning);\n}\n\n.lumiverse-vp-summary-status--no-chat {\n    background: rgba(100, 100, 100, 0.1);\n    border: 1px solid rgba(100, 100, 100, 0.3);\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-vp-summary-textarea-wrapper {\n    flex: 1;\n    min-height: 200px;\n    margin-bottom: 4px;\n    overflow: hidden;\n}\n\n.lumiverse-vp-summary-textarea {\n    width: 100%;\n    height: 100%;\n    min-height: 200px;\n    padding: 12px;\n    background: var(--lumiverse-bg);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 8px;\n    color: var(--lumiverse-text);\n    font-size: 12px;\n    font-family: inherit;\n    line-height: 1.5;\n    resize: none;\n    transition: border-color 0.2s ease;\n}\n\n.lumiverse-vp-summary-textarea:focus {\n    outline: none;\n    border-color: var(--lumiverse-primary);\n}\n\n.lumiverse-vp-summary-textarea::placeholder {\n    color: var(--lumiverse-text-dim);\n}\n\n.lumiverse-vp-summary-textarea:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n}\n\n.lumiverse-vp-summary-actions {\n    display: flex;\n    gap: 10px;\n    justify-content: center;\n    margin-top: 12px;\n    padding-top: 4px;\n}\n\n.lumiverse-vp-action-btn {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 6px;\n    padding: 8px 12px;\n    min-height: 36px;\n    border: none;\n    border-radius: 6px;\n    font-size: 12px;\n    font-weight: 500;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n/* Icon-only button mode */\n.lumiverse-vp-action-btn--icon-only {\n    padding: 10px 12px;\n    min-width: 44px;\n    width: 44px;\n    height: 40px;\n    flex: 1;\n    max-width: 56px;\n}\n\n.lumiverse-vp-action-btn--secondary {\n    background: var(--lumiverse-bg-elevated);\n    color: var(--lumiverse-text);\n    border: 1px solid var(--lumiverse-border);\n}\n\n.lumiverse-vp-action-btn--secondary:hover {\n    background: var(--lumiverse-bg-hover);\n}\n\n.lumiverse-vp-action-btn--primary {\n    background: var(--lumiverse-primary);\n    color: white;\n}\n\n.lumiverse-vp-action-btn--primary:hover {\n    background: var(--lumiverse-primary-hover);\n}\n\n.lumiverse-vp-action-btn--danger {\n    background: transparent;\n    color: var(--lumiverse-danger);\n    border: 1px solid var(--lumiverse-danger);\n}\n\n.lumiverse-vp-action-btn--danger:hover {\n    background: rgba(239, 68, 68, 0.1);\n}\n\n.lumiverse-vp-action-btn--disabled {\n    opacity: 0.4;\n    cursor: not-allowed;\n}\n\n.lumiverse-vp-summary-unsaved {\n    text-align: center;\n    font-size: 11px;\n    color: var(--lumiverse-warning);\n    padding: 4px;\n}\n\n/* Action button spinner */\n.lumiverse-vp-action-btn-spinner {\n    width: 14px;\n    height: 14px;\n    border: 2px solid rgba(255, 255, 255, 0.3);\n    border-top-color: white;\n    border-radius: 50%;\n    animation: lumiverse-spin 0.8s linear infinite;\n}\n\n.lumiverse-vp-action-btn--icon-only .lumiverse-vp-action-btn-spinner {\n    width: 16px;\n    height: 16px;\n}\n\n@keyframes lumiverse-spin {\n    to { transform: rotate(360deg); }\n}\n\n/* Summary config section */\n.lumiverse-vp-summary-config {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n}\n\n/* Radio group */\n.lumiverse-vp-radio-group {\n    display: flex;\n    gap: 8px;\n    flex-wrap: wrap;\n}\n\n.lumiverse-vp-radio-group--wide .lumiverse-vp-radio-option {\n    flex: 1;\n    min-width: 100px;\n}\n\n.lumiverse-vp-radio-option {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    padding: 8px 14px;\n    background: var(--lumiverse-bg);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 6px;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-vp-radio-option:hover {\n    border-color: var(--lumiverse-border-hover);\n    background: var(--lumiverse-bg-hover);\n}\n\n.lumiverse-vp-radio-option--selected {\n    border-color: var(--lumiverse-primary);\n    background: rgba(147, 112, 219, 0.15);\n}\n\n.lumiverse-vp-radio-option input[type="radio"] {\n    display: none !important;\n    position: absolute !important;\n    opacity: 0 !important;\n    width: 0 !important;\n    height: 0 !important;\n    pointer-events: none !important;\n}\n\n.lumiverse-vp-radio-option-label {\n    font-size: 12px;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n}\n\n/* Field rows */\n.lumiverse-vp-field-row {\n    display: flex;\n    gap: 12px;\n}\n\n.lumiverse-vp-field-row .lumiverse-vp-field {\n    flex: 1;\n}\n\n.lumiverse-vp-field-row--3 .lumiverse-vp-field {\n    flex: 1;\n    min-width: 0;\n}\n\n/* Select field */\n.lumiverse-vp-field-select {\n    width: 100%;\n    padding: 8px 12px;\n    background: var(--lumiverse-bg);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 6px;\n    color: var(--lumiverse-text);\n    font-size: 12px;\n    cursor: pointer;\n    transition: border-color 0.2s ease;\n    appearance: none;\n    background-image: url(${h});\n    background-repeat: no-repeat;\n    background-position: right 10px center;\n    padding-right: 30px;\n}\n\n.lumiverse-vp-field-select:focus {\n    outline: none;\n    border-color: var(--lumiverse-primary);\n}\n\n.lumiverse-vp-field-select option {\n    background: var(--lumiverse-bg);\n    color: var(--lumiverse-text);\n}\n\n/* Warning box */\n.lumiverse-vp-warning-box {\n    display: flex;\n    align-items: flex-start;\n    gap: 8px;\n    padding: 10px 12px;\n    margin-top: 10px;\n    background: rgba(245, 158, 11, 0.1);\n    border: 1px solid rgba(245, 158, 11, 0.3);\n    border-radius: 6px;\n    font-size: 11px;\n    color: var(--lumiverse-warning);\n    line-height: 1.4;\n}\n\n.lumiverse-vp-warning-box svg {\n    flex-shrink: 0;\n    margin-top: 1px;\n}\n\n/* Settings description */\n.lumiverse-vp-settings-desc {\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n    margin: 8px 0 0 0;\n    line-height: 1.4;\n}\n\n/* ============================================\n   LUMIA MODAL SYSTEM\n   Card-based selection modal design\n   ============================================ */\n\n/* Modal Backdrop */\n.lumia-modal-backdrop {\n    position: fixed;\n    inset: 0;\n    background: rgba(0, 0, 0, 0.5);\n    z-index: 9998;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    animation: lumia-backdrop-fadein 0.15s ease-out;\n}\n\n@keyframes lumia-backdrop-fadein {\n    from { opacity: 0; }\n    to { opacity: 1; }\n}\n\n/* Modal Container */\n.lumia-modal {\n    font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", sans-serif;\n    background: linear-gradient(\n        165deg,\n        rgba(22, 18, 32, 0.98) 0%,\n        rgba(28, 24, 40, 0.98) 100%\n    );\n    border: 1px solid rgba(147, 112, 219, 0.2);\n    border-radius: 16px;\n    box-shadow:\n        0 24px 80px rgba(0, 0, 0, 0.5),\n        0 0 1px rgba(147, 112, 219, 0.3);\n    padding: 0;\n    overflow: hidden;\n    display: flex;\n    flex-direction: column;\n    max-height: 85vh;\n    max-height: 85dvh;\n    height: auto;\n    width: 90vw;\n    max-width: 600px;\n    z-index: 9999;\n    /* Ensure flex children don't overflow */\n    min-height: 0;\n}\n\n/* Selection Modal Variant (wider for cards) */\n.lumia-modal-selection {\n    max-width: 700px;\n}\n\n/* Settings Modal Variant */\n.lumia-modal-settings {\n    max-width: 520px;\n}\n\n/* Editor Modal Variant - needs scrollable content */\n.lumia-modal-editor {\n    max-width: 640px;\n    width: 90%;\n}\n\n.lumia-modal-editor .lumia-modal-content {\n    flex: 1;\n    min-height: 0;\n    overflow-y: auto;\n    overflow-x: hidden;\n}\n\n/* Modal Selection Content Wrapper */\n.lumia-modal-selection-content {\n    display: flex;\n    flex-direction: column;\n    flex: 1;\n    min-height: 0; /* Allow flex children to shrink properly */\n    overflow: hidden; /* Let child scroll container handle overflow */\n}\n\n/* Modal Header - Inner (for modals with custom headers) */\n.lumia-modal-header-inner {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n    padding: 18px 20px;\n    background: linear-gradient(\n        180deg,\n        rgba(147, 112, 219, 0.1) 0%,\n        transparent 100%\n    );\n    border-bottom: 1px solid rgba(147, 112, 219, 0.12);\n    flex-shrink: 0;\n}\n\n.lumia-modal-header-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 36px;\n    height: 36px;\n    background: linear-gradient(\n        135deg,\n        rgba(147, 112, 219, 0.2) 0%,\n        rgba(147, 112, 219, 0.1) 100%\n    );\n    border-radius: 10px;\n    border: 1px solid rgba(147, 112, 219, 0.2);\n}\n\n.lumia-modal-header-icon svg {\n    width: 20px;\n    height: 20px;\n    stroke: rgba(186, 135, 255, 0.9);\n}\n\n.lumia-modal-header-text {\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n    flex: 1;\n    min-width: 0;\n}\n\n.lumia-modal-title {\n    font-size: 17px;\n    font-weight: 600;\n    color: rgba(255, 255, 255, 0.95);\n    letter-spacing: -0.2px;\n    margin: 0;\n    padding: 0;\n}\n\n.lumia-modal-subtitle {\n    font-size: 12px;\n    font-weight: 400;\n    color: rgba(255, 255, 255, 0.5);\n    margin: 0;\n    letter-spacing: 0.1px;\n}\n\n/* Clear Button */\n.lumia-clear-btn {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    padding: 8px 14px;\n    background: rgba(128, 128, 128, 0.1);\n    border: 1px solid rgba(128, 128, 128, 0.25);\n    border-radius: 8px;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    font-family: inherit;\n    font-size: 12px;\n    font-weight: 500;\n    color: rgba(255, 255, 255, 0.7);\n    flex-shrink: 0;\n    margin-left: auto;\n}\n\n.lumia-clear-btn svg {\n    width: 16px;\n    height: 16px;\n    stroke: rgba(255, 255, 255, 0.6);\n}\n\n.lumia-clear-btn:hover {\n    background: rgba(244, 67, 54, 0.15);\n    border-color: rgba(244, 67, 54, 0.4);\n    color: rgba(244, 67, 54, 0.95);\n}\n\n.lumia-clear-btn:hover svg {\n    stroke: rgba(244, 67, 54, 0.95);\n}\n\n/* Modal Content Area */\n.lumia-modal-content {\n    padding: 20px;\n    display: block;\n    flex: 1 1 auto;\n    overflow-y: auto;\n    overflow-x: hidden;\n    min-height: 0;\n}\n\n.lumia-modal-content > * + * {\n    margin-top: 16px;\n}\n\n/* Custom scrollbar for modal content */\n.lumia-modal-content::-webkit-scrollbar {\n    width: 8px;\n}\n\n.lumia-modal-content::-webkit-scrollbar-track {\n    background: rgba(0, 0, 0, 0.2);\n    border-radius: 4px;\n}\n\n.lumia-modal-content::-webkit-scrollbar-thumb {\n    background: rgba(147, 112, 219, 0.3);\n    border-radius: 4px;\n}\n\n.lumia-modal-content::-webkit-scrollbar-thumb:hover {\n    background: rgba(147, 112, 219, 0.5);\n}\n\n/* Modal Panel */\n.lumia-modal-panel {\n    background: rgba(0, 0, 0, 0.2);\n    border: 1px solid rgba(128, 128, 128, 0.12);\n    border-radius: 12px;\n    overflow: visible;\n}\n\n.lumia-modal-panel-header {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 12px 14px;\n    background: rgba(255, 255, 255, 0.02);\n    border-bottom: 1px solid rgba(128, 128, 128, 0.08);\n}\n\n.lumia-modal-panel-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 18px;\n    height: 18px;\n}\n\n.lumia-modal-panel-icon svg {\n    width: 16px;\n    height: 16px;\n    stroke: rgba(147, 112, 219, 0.7);\n}\n\n.lumia-modal-panel-title {\n    font-size: 12px;\n    font-weight: 600;\n    color: rgba(255, 255, 255, 0.8);\n    letter-spacing: 0.1px;\n}\n\n.lumia-modal-panel-count {\n    font-size: 11px;\n    font-weight: 500;\n    color: rgba(147, 112, 219, 0.7);\n    background: rgba(147, 112, 219, 0.1);\n    padding: 4px 8px;\n    border-radius: 10px;\n    flex-shrink: 0;\n}\n\n.lumia-modal-panel-content {\n    padding: 16px;\n    display: flex;\n    flex-direction: column;\n    gap: 14px;\n}\n\n.lumia-modal-panel-content-cards {\n    padding: 12px;\n}\n\n/* Modal Empty State */\n.lumia-modal-empty {\n    padding: 40px 20px;\n    text-align: center;\n    color: rgba(255, 255, 255, 0.4);\n    font-size: 14px;\n}\n\n/* Modal Footer - Pinned to bottom */\n.lumia-modal-footer {\n    display: flex;\n    justify-content: flex-end;\n    gap: 10px;\n    padding: 16px 20px;\n    background: rgba(22, 18, 32, 0.98);\n    border-top: 1px solid rgba(128, 128, 128, 0.15);\n    flex-shrink: 0;\n    margin-top: auto;\n    position: sticky;\n    bottom: 0;\n    z-index: 10;\n    /* Subtle shadow to indicate floating */\n    box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.3);\n}\n\n/* Modal Buttons */\n.lumia-modal-btn {\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    gap: 8px;\n    padding: 10px 20px;\n    border: none;\n    border-radius: 8px;\n    font-size: 13px;\n    font-weight: 500;\n    font-family: inherit;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumia-modal-btn svg {\n    width: 16px;\n    height: 16px;\n}\n\n.lumia-modal-btn-primary {\n    background: linear-gradient(\n        135deg,\n        rgba(147, 112, 219, 0.9) 0%,\n        rgba(123, 95, 196, 0.9) 100%\n    );\n    color: white;\n}\n\n.lumia-modal-btn-primary:hover {\n    background: linear-gradient(\n        135deg,\n        rgba(167, 132, 239, 0.95) 0%,\n        rgba(143, 115, 216, 0.95) 100%\n    );\n    transform: translateY(-1px);\n}\n\n.lumia-modal-btn-secondary {\n    background: rgba(128, 128, 128, 0.15);\n    border: 1px solid rgba(128, 128, 128, 0.2);\n    color: rgba(255, 255, 255, 0.75);\n}\n\n.lumia-modal-btn-secondary:hover {\n    background: rgba(128, 128, 128, 0.25);\n    color: rgba(255, 255, 255, 0.9);\n}\n\n/* Collapsible Panel Styles */\n.lumia-collapsible-trigger {\n    cursor: pointer;\n    user-select: none;\n}\n\n.lumia-panel-collapse-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 16px;\n    height: 16px;\n    flex-shrink: 0;\n    transition: transform 0.2s ease;\n}\n\n.lumia-panel-collapse-icon svg {\n    width: 14px;\n    height: 14px;\n    stroke: rgba(255, 255, 255, 0.4);\n}\n\n.lumia-collapsible.collapsed .lumia-panel-collapse-icon {\n    transform: rotate(-90deg);\n}\n\n.lumia-collapsible-content {\n    display: grid;\n    grid-template-rows: 1fr;\n    transition:\n        grid-template-rows 0.25s ease,\n        opacity 0.2s ease,\n        padding 0.25s ease;\n    opacity: 1;\n}\n\n.lumia-collapsible-content > * {\n    overflow: hidden;\n}\n\n.lumia-collapsible.collapsed .lumia-collapsible-content {\n    grid-template-rows: 0fr;\n    opacity: 0;\n    padding-top: 0;\n    padding-bottom: 0;\n}\n\n/* Custom Pack Badge */\n.lumia-pack-badge-custom {\n    font-size: 10px;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    color: rgba(147, 112, 219, 0.9);\n    background: rgba(147, 112, 219, 0.15);\n    padding: 3px 8px;\n    border-radius: 6px;\n    border: 1px solid rgba(147, 112, 219, 0.25);\n}\n\n/* Icon Button Small */\n.lumia-icon-btn-sm {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 28px;\n    height: 28px;\n    padding: 0;\n    background: transparent;\n    border: 1px solid transparent;\n    border-radius: 6px;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    margin-left: auto;\n}\n\n.lumia-icon-btn-sm svg {\n    width: 16px;\n    height: 16px;\n    stroke: rgba(255, 255, 255, 0.4);\n}\n\n.lumia-icon-btn-sm:hover {\n    background: rgba(244, 67, 54, 0.15);\n    border-color: rgba(244, 67, 54, 0.3);\n}\n\n.lumia-icon-btn-sm:hover svg {\n    stroke: rgba(244, 67, 54, 0.9);\n}\n\n/* ============================================\n   LUMIA CARD GRID & CARDS\n   ============================================ */\n\n.lumia-card-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));\n    gap: 16px;\n    padding: 4px;\n}\n\n.lumia-card {\n    position: relative;\n    display: flex;\n    flex-direction: column;\n    background: linear-gradient(\n        165deg,\n        rgba(28, 24, 38, 0.95) 0%,\n        rgba(38, 32, 52, 0.9) 50%,\n        rgba(32, 28, 45, 0.95) 100%\n    );\n    border: 1px solid rgba(128, 128, 128, 0.15);\n    border-radius: 16px;\n    overflow: hidden;\n    cursor: pointer;\n    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);\n}\n\n.lumia-card:hover {\n    transform: translateY(-4px);\n    border-color: rgba(147, 112, 219, 0.3);\n    box-shadow:\n        0 8px 24px rgba(0, 0, 0, 0.25),\n        0 0 0 1px rgba(147, 112, 219, 0.15);\n}\n\n.lumia-card.selected {\n    border-color: rgba(100, 149, 237, 0.6);\n    box-shadow:\n        0 4px 16px rgba(100, 149, 237, 0.2),\n        0 0 0 1px rgba(100, 149, 237, 0.3),\n        inset 0 0 20px rgba(100, 149, 237, 0.05);\n}\n\n.lumia-card.selected::after {\n    content: "";\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    height: 2px;\n    background: linear-gradient(\n        90deg,\n        transparent 0%,\n        rgba(100, 149, 237, 0.5) 20%,\n        rgba(100, 149, 237, 0.8) 50%,\n        rgba(100, 149, 237, 0.5) 80%,\n        transparent 100%\n    );\n}\n\n/* Card Image Container */\n.lumia-card-image {\n    position: relative;\n    width: 100%;\n    aspect-ratio: 1 / 1;\n    background: linear-gradient(\n        135deg,\n        rgba(20, 16, 28, 0.8) 0%,\n        rgba(40, 32, 55, 0.6) 100%\n    );\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    overflow: hidden;\n}\n\n.lumia-card-image img {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n    transition: transform 0.3s ease, opacity 0.3s ease;\n    opacity: 0;\n}\n\n.lumia-card-image img.lumia-img-loaded {\n    opacity: 1;\n}\n\n.lumia-card:hover .lumia-card-image img {\n    transform: scale(1.05);\n}\n\n.lumia-card-placeholder {\n    font-size: 48px;\n    font-weight: 300;\n    color: rgba(147, 112, 219, 0.4);\n    font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", sans-serif;\n    user-select: none;\n}\n\n/* Image Loading Spinner */\n.lumia-img-spinner {\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    width: 24px;\n    height: 24px;\n    border: 2px solid rgba(147, 112, 219, 0.2);\n    border-top-color: rgba(147, 112, 219, 0.7);\n    border-radius: 50%;\n    animation: lumia-spin 0.8s linear infinite;\n}\n\n@keyframes lumia-spin {\n    to { transform: translate(-50%, -50%) rotate(360deg); }\n}\n\n.lumia-card-image:has(.lumia-img-loaded) .lumia-img-spinner {\n    display: none;\n}\n\n/* Dominant Star Icon */\n.lumia-dominant-icon {\n    position: absolute;\n    top: 10px;\n    right: 10px;\n    width: 32px;\n    height: 32px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    background: rgba(0, 0, 0, 0.5);\n    backdrop-filter: blur(8px);\n    -webkit-backdrop-filter: blur(8px);\n    border-radius: 50%;\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    cursor: pointer;\n    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);\n    z-index: 10;\n    opacity: 0;\n}\n\n.lumia-card:hover .lumia-dominant-icon,\n.lumia-card.selected .lumia-dominant-icon {\n    opacity: 1;\n}\n\n.lumia-dominant-icon:hover {\n    background: rgba(0, 0, 0, 0.7);\n    border-color: rgba(255, 193, 7, 0.4);\n    transform: scale(1.1);\n}\n\n.lumia-dominant-icon.dominant {\n    opacity: 1;\n    background: linear-gradient(\n        135deg,\n        rgba(255, 193, 7, 0.9) 0%,\n        rgba(255, 152, 0, 0.9) 100%\n    );\n    border-color: rgba(255, 193, 7, 0.6);\n    box-shadow: 0 2px 12px rgba(255, 193, 7, 0.4);\n}\n\n.lumia-dominant-icon svg {\n    width: 18px;\n    height: 18px;\n    fill: none;\n    stroke: rgba(255, 255, 255, 0.7);\n    stroke-width: 2;\n    stroke-linecap: round;\n    stroke-linejoin: round;\n    transition: all 0.25s ease;\n}\n\n.lumia-dominant-icon:hover svg {\n    stroke: rgba(255, 193, 7, 0.9);\n}\n\n.lumia-dominant-icon.dominant svg {\n    fill: rgba(255, 255, 255, 0.95);\n    stroke: rgba(255, 255, 255, 0.95);\n}\n\n/* Edit Icon for custom pack items */\n.lumia-edit-icon {\n    position: absolute;\n    bottom: 10px;\n    right: 10px;\n    width: 28px;\n    height: 28px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    background: rgba(147, 112, 219, 0.85);\n    backdrop-filter: blur(8px);\n    -webkit-backdrop-filter: blur(8px);\n    border-radius: 50%;\n    border: 1px solid rgba(147, 112, 219, 0.4);\n    cursor: pointer;\n    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);\n    z-index: 10;\n    opacity: 0;\n}\n\n.lumia-card:hover .lumia-edit-icon {\n    opacity: 1;\n}\n\n.lumia-edit-icon:hover {\n    background: rgba(147, 112, 219, 1);\n    border-color: rgba(186, 135, 255, 0.6);\n    transform: scale(1.1);\n    box-shadow: 0 2px 12px rgba(147, 112, 219, 0.4);\n}\n\n.lumia-edit-icon svg {\n    width: 14px;\n    height: 14px;\n    fill: none;\n    stroke: rgba(255, 255, 255, 0.95);\n    stroke-width: 2;\n    stroke-linecap: round;\n    stroke-linejoin: round;\n}\n\n/* Enable All Icon - sparkles button for quick-enabling all traits */\n.lumia-enable-all-icon {\n    position: absolute;\n    bottom: 10px;\n    left: 10px;\n    width: 28px;\n    height: 28px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    background: rgba(255, 193, 7, 0.85);\n    backdrop-filter: blur(8px);\n    -webkit-backdrop-filter: blur(8px);\n    border-radius: 50%;\n    border: 1px solid rgba(255, 193, 7, 0.4);\n    cursor: pointer;\n    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);\n    z-index: 10;\n    opacity: 0;\n}\n\n.lumia-card:hover .lumia-enable-all-icon {\n    opacity: 1;\n}\n\n.lumia-enable-all-icon:hover {\n    background: rgba(255, 193, 7, 1);\n    border-color: rgba(255, 215, 0, 0.8);\n    transform: scale(1.1);\n    box-shadow: 0 2px 12px rgba(255, 193, 7, 0.5);\n}\n\n.lumia-enable-all-icon svg {\n    width: 14px;\n    height: 14px;\n    fill: none;\n    stroke: rgba(0, 0, 0, 0.85);\n    stroke-width: 2;\n    stroke-linecap: round;\n    stroke-linejoin: round;\n}\n\n/* All-enabled state - shows when all traits are active */\n.lumia-enable-all-icon.all-enabled {\n    opacity: 1;\n    background: rgba(76, 175, 80, 0.95);\n    border-color: rgba(76, 175, 80, 0.6);\n    box-shadow: 0 2px 8px rgba(76, 175, 80, 0.4);\n}\n\n.lumia-enable-all-icon.all-enabled:hover {\n    background: rgba(56, 142, 60, 1);\n    border-color: rgba(76, 175, 80, 0.8);\n    box-shadow: 0 2px 12px rgba(76, 175, 80, 0.6);\n}\n\n.lumia-enable-all-icon.all-enabled svg {\n    stroke: rgba(255, 255, 255, 0.95);\n}\n\n/* Selection Checkmark Overlay */\n.lumia-card-check {\n    position: absolute;\n    top: 10px;\n    left: 10px;\n    width: 28px;\n    height: 28px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    background: rgba(100, 149, 237, 0.9);\n    border-radius: 50%;\n    opacity: 0;\n    transform: scale(0.5);\n    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);\n    z-index: 10;\n}\n\n.lumia-card.selected .lumia-card-check {\n    opacity: 1;\n    transform: scale(1);\n}\n\n.lumia-card-check svg {\n    width: 16px;\n    height: 16px;\n    fill: none;\n    stroke: white;\n    stroke-width: 2.5;\n    stroke-linecap: round;\n    stroke-linejoin: round;\n}\n\n/* Card Info Section */\n.lumia-card-info {\n    padding: 14px 16px 16px;\n    display: flex;\n    flex-direction: column;\n    gap: 4px;\n    background: linear-gradient(\n        180deg,\n        rgba(28, 24, 38, 0) 0%,\n        rgba(28, 24, 38, 0.95) 20%\n    );\n}\n\n.lumia-card-name {\n    font-size: 15px;\n    font-weight: 600;\n    color: rgba(255, 255, 255, 0.95);\n    font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", sans-serif;\n    letter-spacing: -0.2px;\n    line-height: 1.3;\n    word-break: break-word;\n}\n\n/* Definition Card Variant (no dominant icon) */\n.lumia-card.definition-card .lumia-dominant-icon {\n    display: none;\n}\n\n/* Card Appear Animation */\n.lumia-card.lumia-card-appear {\n    animation: lumia-card-appear 0.3s ease-out forwards;\n    opacity: 0;\n}\n\n@keyframes lumia-card-appear {\n    from {\n        opacity: 0;\n        transform: translateY(10px);\n    }\n    to {\n        opacity: 1;\n        transform: translateY(0);\n    }\n}\n\n/* Staggered animation delays */\n.lumia-card.lumia-card-appear:nth-child(1) { animation-delay: 0ms; }\n.lumia-card.lumia-card-appear:nth-child(2) { animation-delay: 30ms; }\n.lumia-card.lumia-card-appear:nth-child(3) { animation-delay: 60ms; }\n.lumia-card.lumia-card-appear:nth-child(4) { animation-delay: 90ms; }\n.lumia-card.lumia-card-appear:nth-child(5) { animation-delay: 120ms; }\n.lumia-card.lumia-card-appear:nth-child(6) { animation-delay: 150ms; }\n.lumia-card.lumia-card-appear:nth-child(7) { animation-delay: 180ms; }\n.lumia-card.lumia-card-appear:nth-child(8) { animation-delay: 210ms; }\n.lumia-card.lumia-card-appear:nth-child(9) { animation-delay: 240ms; }\n.lumia-card.lumia-card-appear:nth-child(10) { animation-delay: 270ms; }\n.lumia-card.lumia-card-appear:nth-child(n+11) { animation-delay: 300ms; }\n\n/* ============================================\n   MODAL PORTAL - Renders at document.body level\n   ============================================ */\n\n.lumia-modal-backdrop {\n    position: fixed;\n    inset: 0;\n    z-index: 10000;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    padding: 16px;\n    box-sizing: border-box;\n}\n\n/* ============================================\n   LUMIA MODAL RESPONSIVE\n   ============================================ */\n\n@media (max-width: 600px) {\n    /* Adjusted modal style - centered, not full-screen */\n    .lumia-modal {\n        width: 94vw;\n        max-width: 400px;\n        max-height: 90vh;\n        max-height: 90dvh;\n        border-radius: 16px;\n        margin: auto;\n    }\n\n    .lumia-modal-selection {\n        max-width: 94vw;\n    }\n\n    /* Ensure backdrop properly centers the modal */\n    .lumia-modal-backdrop {\n        padding: 16px;\n    }\n\n    /* Modal content scrolling for mobile */\n    .lumia-modal-content {\n        overflow-y: auto;\n        -webkit-overflow-scrolling: touch;\n    }\n\n    .lumia-modal-header-inner {\n        padding: 14px 16px;\n        gap: 10px;\n    }\n\n    .lumia-modal-header-icon {\n        width: 32px;\n        height: 32px;\n    }\n\n    .lumia-modal-title {\n        font-size: 15px;\n    }\n\n    .lumia-modal-content {\n        padding: 12px;\n    }\n\n    .lumia-modal-content > * + * {\n        margin-top: 12px;\n    }\n\n    .lumia-modal-panel-content {\n        padding: 10px;\n    }\n\n    .lumia-modal-footer {\n        padding: 12px 16px;\n    }\n\n    .lumia-modal-btn {\n        padding: 10px 16px;\n        font-size: 13px;\n    }\n\n    .lumia-card-grid {\n        grid-template-columns: repeat(2, 1fr);\n        gap: 12px;\n    }\n\n    .lumia-card {\n        border-radius: 12px;\n    }\n\n    .lumia-card-info {\n        padding: 10px 12px 12px;\n    }\n\n    .lumia-card-name {\n        font-size: 13px;\n    }\n\n    .lumia-card-check {\n        width: 24px;\n        height: 24px;\n    }\n\n    .lumia-card-check svg {\n        width: 14px;\n        height: 14px;\n    }\n\n    .lumia-card-placeholder {\n        font-size: 36px;\n    }\n\n    /* ----------------------------------------\n       Legacy Lumia Editor Modal - Mobile\n       This is the jQuery <dialog> based editor\n       ---------------------------------------- */\n    .lumia-modal-editor {\n        width: calc(100vw - 24px) !important;\n        max-width: calc(100vw - 24px) !important;\n        height: calc(100vh - 24px);\n        max-height: calc(100vh - 24px);\n        display: flex;\n        flex-direction: column;\n        overflow: hidden;\n        min-height: 0;\n    }\n\n    @supports (height: 100dvh) {\n        .lumia-modal-editor {\n            height: calc(100dvh - 24px);\n            max-height: calc(100dvh - 24px);\n        }\n    }\n\n    /* Editor content must scroll */\n    .lumia-modal-editor .lumia-modal-content {\n        flex: 1;\n        min-height: 0;\n        overflow-y: auto;\n        overflow-x: hidden;\n        -webkit-overflow-scrolling: touch;\n        padding: 12px;\n    }\n\n    /* Editor form fills content */\n    .lumia-modal-editor .lumia-editor-form {\n        display: flex;\n        flex-direction: column;\n        gap: 12px;\n    }\n\n    /* Editor sections */\n    .lumia-modal-editor .lumia-editor-section {\n        background: rgba(0, 0, 0, 0.2);\n        border: 1px solid rgba(128, 128, 128, 0.12);\n        border-radius: 12px;\n        overflow: hidden;\n    }\n\n    .lumia-modal-editor .lumia-editor-section-header {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        padding: 10px 12px;\n        background: rgba(255, 255, 255, 0.02);\n        border-bottom: 1px solid rgba(128, 128, 128, 0.08);\n        font-size: 12px;\n        font-weight: 600;\n    }\n\n    .lumia-modal-editor .lumia-editor-section-icon {\n        display: flex;\n        align-items: center;\n        width: 16px;\n        height: 16px;\n    }\n\n    .lumia-modal-editor .lumia-editor-section-icon svg {\n        width: 16px;\n        height: 16px;\n        stroke: rgba(147, 112, 219, 0.7);\n    }\n\n    .lumia-modal-editor .lumia-editor-section-content {\n        padding: 12px;\n    }\n\n    /* Form fields */\n    .lumia-modal-editor .lumia-editor-field {\n        margin-bottom: 12px;\n    }\n\n    .lumia-modal-editor .lumia-editor-field:last-child {\n        margin-bottom: 0;\n    }\n\n    .lumia-modal-editor .lumia-editor-label {\n        display: block;\n        font-size: 11px;\n        font-weight: 600;\n        text-transform: uppercase;\n        letter-spacing: 0.3px;\n        color: rgba(255, 255, 255, 0.6);\n        margin-bottom: 6px;\n    }\n\n    /* Stack row fields vertically on mobile */\n    .lumia-modal-editor .lumia-editor-row {\n        display: flex;\n        flex-direction: column;\n        gap: 12px;\n    }\n\n    .lumia-modal-editor .lumia-editor-field-half {\n        width: 100%;\n    }\n\n    /* Inputs - 16px font prevents iOS zoom */\n    .lumia-modal-editor .lumia-input,\n    .lumia-modal-editor .lumia-select {\n        width: 100%;\n        min-height: 44px;\n        padding: 10px 12px;\n        font-size: 16px;\n        background: rgba(0, 0, 0, 0.3);\n        border: 1px solid rgba(128, 128, 128, 0.2);\n        border-radius: 8px;\n        color: rgba(255, 255, 255, 0.9);\n    }\n\n    .lumia-modal-editor .lumia-textarea {\n        width: 100%;\n        min-height: 100px;\n        padding: 12px;\n        font-size: 16px;\n        line-height: 1.5;\n        background: rgba(0, 0, 0, 0.3);\n        border: 1px solid rgba(128, 128, 128, 0.2);\n        border-radius: 8px;\n        color: rgba(255, 255, 255, 0.9);\n        resize: vertical;\n    }\n\n    .lumia-modal-editor .lumia-editor-hint {\n        display: block;\n        font-size: 10px;\n        color: rgba(255, 255, 255, 0.4);\n        margin-top: 4px;\n        font-style: italic;\n    }\n\n    /* Avatar preview */\n    .lumia-modal-editor .lumia-editor-preview {\n        width: 60px;\n        height: 60px;\n        border-radius: 8px;\n        overflow: hidden;\n        margin-top: 8px;\n    }\n\n    .lumia-modal-editor .lumia-editor-preview img {\n        width: 100%;\n        height: 100%;\n        object-fit: cover;\n    }\n\n    /* Footer stays at bottom */\n    .lumia-modal-editor .lumia-modal-footer {\n        flex-shrink: 0;\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n        padding: 12px;\n        border-top: 1px solid rgba(128, 128, 128, 0.12);\n        background: rgba(0, 0, 0, 0.2);\n    }\n\n    .lumia-modal-editor .lumia-modal-footer .lumia-modal-btn {\n        flex: 1;\n        min-height: 44px;\n        padding: 10px 16px;\n        font-size: 14px;\n        font-weight: 500;\n    }\n\n    /* Delete button full width on bottom */\n    .lumia-modal-editor .lumia-modal-footer .lumia-modal-btn-danger {\n        flex: 0 0 100%;\n        order: 10;\n        margin-top: 4px;\n    }\n\n    /* Disable animations on mobile for performance */\n    .lumia-card,\n    .lumia-card-image img,\n    .lumia-dominant-icon,\n    .lumia-card-check {\n        transition: none !important;\n    }\n\n    .lumia-card:hover {\n        transform: none;\n    }\n\n    .lumia-card:hover .lumia-card-image img {\n        transform: none;\n    }\n\n    /* Viewport Panel Mobile - width is set by inline JS to account for tab size */\n    .lumiverse-viewport-wrapper {\n        /* Width set dynamically via inline style to include tab width */\n    }\n\n    .lumiverse-viewport-panel {\n        width: 100%;\n    }\n\n    .lumiverse-vp-tabs {\n        width: 48px;\n        flex-shrink: 0; /* Don't shrink the tab sidebar */\n    }\n\n    .lumiverse-vp-main {\n        flex: 1; /* Fill remaining space instead of fixed width */\n        min-width: 0; /* Allow flex item to shrink below content size */\n    }\n\n    .lumiverse-vp-tab {\n        width: 44px;\n        height: 44px;\n    }\n\n    .lumiverse-viewport-panel {\n        width: 100%;\n    }\n\n    .lumiverse-vp-tabs {\n        width: 48px;\n    }\n\n    .lumiverse-vp-tab {\n        width: 44px;\n        height: 44px;\n    }\n\n    .lumiverse-vp-tab-label {\n        font-size: 9px;\n    }\n\n    /* Drawer tab - adjust for mobile */\n    .lumiverse-drawer-tab {\n        margin-top: 56px;\n        width: 40px;\n        padding: 14px 6px 18px;\n    }\n\n    .lumiverse-drawer-tab-icon {\n        width: 24px;\n        height: 24px;\n    }\n\n    .lumiverse-drawer-tab-label {\n        font-size: 10px;\n    }\n\n    /* Legacy toggle container hidden on mobile */\n    .lumiverse-toggle-container:not(.lumiverse-toggle-container--custom) {\n        display: none !important;\n    }\n\n    /* Summary textarea - ensure proper height on mobile */\n    .lumiverse-vp-summary-editor {\n        min-height: 0;\n    }\n\n    .lumiverse-vp-summary-textarea-wrapper {\n        flex: 1;\n        min-height: 180px;\n        display: flex;\n        flex-direction: column;\n    }\n\n    .lumiverse-vp-summary-textarea {\n        flex: 1;\n        min-height: 180px;\n    }\n}\n\n/* ============================================\n   MOBILE TOUCH INTERACTION FIX\n   Ensures collapsed sidebar doesn't block touch events\n   \n   Problem: When the sidebar is hidden (slid off-screen), the wrapper\n   container still occupies space and can block touch events on mobile\n   WebViews that don't properly respect pointer-events: none inheritance.\n   \n   Solution: When NOT visible, disable pointer-events on ALL children\n   EXCEPT the drawer tab which must remain tappable.\n   ============================================ */\n\n/* Wrapper always allows pointer passthrough */\n.lumiverse-viewport-wrapper {\n    pointer-events: none;\n}\n\n/* When hidden: aggressively disable interaction on all panel contents */\n.lumiverse-viewport-wrapper:not(.lumiverse-viewport-wrapper--visible) .lumiverse-viewport-panel {\n    pointer-events: none !important;\n}\n\n.lumiverse-viewport-wrapper:not(.lumiverse-viewport-wrapper--visible) .lumiverse-vp-tabs,\n.lumiverse-viewport-wrapper:not(.lumiverse-viewport-wrapper--visible) .lumiverse-vp-main {\n    pointer-events: none !important;\n    visibility: hidden; /* Also hide visually since they're off-screen anyway */\n}\n\n/* Drawer tab MUST remain interactive regardless of panel state */\n.lumiverse-drawer-tab {\n    pointer-events: auto !important;\n    touch-action: manipulation;\n    -webkit-tap-highlight-color: transparent;\n    /* Ensure tab is always visible even when other panel parts are hidden */\n    visibility: visible !important;\n}\n\n/* When panel IS visible, restore normal pointer events */\n.lumiverse-viewport-wrapper--visible .lumiverse-viewport-panel {\n    pointer-events: auto;\n}\n\n.lumiverse-viewport-wrapper--visible .lumiverse-vp-tabs,\n.lumiverse-viewport-wrapper--visible .lumiverse-vp-main {\n    pointer-events: auto;\n    visibility: visible;\n}\n\n/* Mobile-specific enhancements */\n@media (max-width: 600px) {\n    /* Extra mobile safety: ensure wrapper never captures touch */\n    .lumiverse-viewport-wrapper {\n        touch-action: none;\n        -webkit-user-select: none;\n        user-select: none;\n    }\n    \n    .lumiverse-viewport-wrapper--visible {\n        touch-action: auto;\n    }\n    \n    /* Ensure drawer tab has adequate touch target on mobile */\n    .lumiverse-drawer-tab {\n        min-width: 40px;\n        min-height: 80px;\n    }\n}\n\n/* ============================================\n   MODAL CONTROLS - Collapse/Expand & Sort\n   Shared styling for Lumia Selection modals\n   ============================================ */\n\n.lumia-modal-controls {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    gap: 12px;\n    padding: 12px 16px;\n    background: rgba(0, 0, 0, 0.2);\n    border-bottom: 1px solid rgba(128, 128, 128, 0.12);\n    margin: 0 -16px 16px -16px;\n    width: calc(100% + 32px);\n}\n\n.lumia-modal-controls-group {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n}\n\n.lumia-modal-control-btn {\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    gap: 6px;\n    padding: 8px 12px;\n    font-size: 12px;\n    font-weight: 500;\n    color: rgba(255, 255, 255, 0.7);\n    background: rgba(0, 0, 0, 0.25);\n    border: 1px solid rgba(128, 128, 128, 0.15);\n    border-radius: 8px;\n    cursor: pointer;\n    transition: all 0.15s ease;\n    white-space: nowrap;\n}\n\n.lumia-modal-control-btn svg {\n    width: 14px;\n    height: 14px;\n    stroke: currentColor;\n    flex-shrink: 0;\n    display: block;\n}\n\n.lumia-modal-control-btn:hover {\n    color: rgba(255, 255, 255, 0.95);\n    background: rgba(0, 0, 0, 0.35);\n    border-color: rgba(147, 112, 219, 0.5);\n}\n\n.lumia-modal-control-btn:active {\n    transform: scale(0.97);\n}\n\n/* Control icons */\n.lumia-control-icon {\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    width: 16px;\n    height: 16px;\n    flex-shrink: 0;\n}\n\n.lumia-control-icon svg {\n    width: 16px;\n    height: 16px;\n    stroke: currentColor;\n    display: block;\n}\n\n/* Sort icon */\n.lumia-sort-icon {\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    width: 16px;\n    height: 16px;\n    flex-shrink: 0;\n    color: rgba(255, 255, 255, 0.6);\n}\n\n.lumia-sort-icon svg {\n    width: 16px;\n    height: 16px;\n    stroke: currentColor;\n    display: block;\n}\n\n/* Sort Dropdown */\n.lumia-modal-sort {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    padding: 6px 12px;\n    background: rgba(0, 0, 0, 0.25);\n    border: 1px solid rgba(128, 128, 128, 0.15);\n    border-radius: 8px;\n}\n\n/* Direct SVG targeting for sort dropdown - mirrors .lumia-modal-control-btn svg pattern */\n.lumia-modal-sort svg {\n    width: 14px;\n    height: 14px;\n    stroke: currentColor;\n    flex-shrink: 0;\n    display: block;\n}\n\n.lumia-modal-sort-label {\n    font-size: 12px;\n    font-weight: 500;\n    color: rgba(255, 255, 255, 0.5);\n}\n\n.lumia-select {\n    padding: 4px 8px;\n    font-size: 12px;\n    font-weight: 500;\n    color: rgba(255, 255, 255, 0.9);\n    background: rgba(0, 0, 0, 0.3);\n    border: 1px solid rgba(128, 128, 128, 0.2);\n    border-radius: 6px;\n    cursor: pointer;\n    transition: all 0.15s ease;\n    min-width: 100px;\n}\n\n.lumia-select:hover {\n    border-color: rgba(147, 112, 219, 0.4);\n}\n\n.lumia-select:focus {\n    outline: none;\n    border-color: rgba(147, 112, 219, 0.6);\n    box-shadow: 0 0 0 2px rgba(147, 112, 219, 0.15);\n}\n\n.lumia-select option {\n    background: #1a1a1a;\n    color: #fff;\n}\n\n/* Mobile adjustments for controls */\n@media (max-width: 600px) {\n    .lumia-modal-controls {\n        flex-wrap: wrap;\n        gap: 8px;\n        padding: 10px 12px;\n        margin: 0 -12px 12px -12px;\n        width: calc(100% + 24px);\n    }\n\n    .lumia-modal-control-btn {\n        padding: 6px 10px;\n        font-size: 11px;\n    }\n\n    /* Hide text labels on mobile, but keep icon spans visible */\n    .lumia-modal-control-btn > span:not(.lumia-btn-icon):not(.lumia-control-icon):not([class*="icon"]) {\n        display: none;\n    }\n\n    .lumia-modal-sort {\n        flex: 1;\n        min-width: 100%;\n        justify-content: space-between;\n    }\n\n    .lumia-select {\n        flex: 1;\n        min-width: 0;\n        padding: 5px 8px;\n        font-size: 11px;\n    }\n}\n\n/* ============================================\n   LOOM ITEMS - Styling for Loom Selection Modal\n   ============================================ */\n\n/* Loom items container within pack section */\n.lumia-loom-items {\n    display: flex;\n    flex-direction: column;\n    gap: 6px;\n    padding: 12px;\n    background: rgba(0, 0, 0, 0.15);\n}\n\n/* Individual Loom item */\n.lumiverse-loom-item {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 12px 16px;\n    background: rgba(0, 0, 0, 0.2);\n    border: 1px solid rgba(128, 128, 128, 0.12);\n    border-radius: 8px;\n    cursor: pointer;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-loom-item:hover {\n    background: rgba(0, 0, 0, 0.3);\n    border-color: rgba(147, 112, 219, 0.3);\n}\n\n.lumiverse-loom-item--selected {\n    background: rgba(147, 112, 219, 0.15);\n    border-color: rgba(147, 112, 219, 0.5);\n}\n\n.lumiverse-loom-item-content {\n    flex: 1;\n}\n\n.lumiverse-loom-item-name {\n    font-weight: 500;\n    color: rgba(255, 255, 255, 0.9);\n    font-size: 14px;\n}\n\n.lumiverse-loom-item-actions {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    margin-left: auto;\n}\n\n.lumiverse-loom-item-toggle {\n    margin-left: 0;\n}\n\n.lumiverse-loom-item-edit {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 24px;\n    height: 24px;\n    padding: 0;\n    background: rgba(128, 128, 128, 0.15);\n    border: 1px solid rgba(128, 128, 128, 0.15);\n    border-radius: var(--lumiverse-radius-sm, 4px);\n    color: rgba(255, 255, 255, 0.5);\n    cursor: pointer;\n    transition: all 0.15s ease;\n    flex-shrink: 0;\n}\n\n.lumiverse-loom-item-edit:hover {\n    background: rgba(100, 149, 237, 0.25);\n    border-color: rgba(100, 149, 237, 0.3);\n    color: rgba(130, 179, 255, 0.95);\n}\n\n/* Toggle switch styling */\n.lumiverse-toggle-switch {\n    position: relative;\n    width: 40px;\n    height: 22px;\n}\n\n.lumiverse-toggle-track {\n    width: 100%;\n    height: 100%;\n    background: rgba(0, 0, 0, 0.3);\n    border: 2px solid rgba(128, 128, 128, 0.2);\n    border-radius: 11px;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-toggle-switch.checked .lumiverse-toggle-track {\n    background: rgba(147, 112, 219, 0.8);\n    border-color: rgba(147, 112, 219, 0.8);\n}\n\n.lumiverse-toggle-thumb {\n    position: absolute;\n    top: 3px;\n    left: 3px;\n    width: 16px;\n    height: 16px;\n    background: white;\n    border-radius: 50%;\n    transition: transform 0.15s ease;\n}\n\n.lumiverse-toggle-switch.checked .lumiverse-toggle-thumb {\n    transform: translateX(18px);\n}\n\n/* Selection actions */\n.lumia-selection-actions {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n    margin-left: auto;\n}\n\n.lumia-selection-count {\n    font-size: 13px;\n    color: rgba(255, 255, 255, 0.5);\n}\n\n/* Search box styling matching Lumia modal */\n.lumia-search-box {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    padding: 8px 12px;\n    background: rgba(0, 0, 0, 0.2);\n    border: 1px solid rgba(128, 128, 128, 0.12);\n    border-radius: 8px;\n    flex: 1;\n    max-width: 300px;\n}\n\n.lumia-search-icon,\n.lumia-search-icon svg {\n    width: 16px;\n    height: 16px;\n    color: rgba(255, 255, 255, 0.4);\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n}\n\n.lumia-search-input {\n    flex: 1;\n    background: transparent;\n    border: none;\n    outline: none;\n    color: rgba(255, 255, 255, 0.9);\n    font-size: 13px;\n}\n\n.lumia-search-input::placeholder {\n    color: rgba(255, 255, 255, 0.4);\n}\n\n.lumia-search-clear {\n    background: transparent;\n    border: none;\n    padding: 4px;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: rgba(255, 255, 255, 0.4);\n    transition: color 0.15s ease;\n}\n\n.lumia-search-clear:hover {\n    color: rgba(255, 255, 255, 0.8);\n}\n\n.lumia-search-clear-icon,\n.lumia-search-clear-icon svg {\n    width: 14px;\n    height: 14px;\n}\n\n/* ----------------------------------------\n   Lumia Modes Section (Chimera/Council)\n   ---------------------------------------- */\n.lumiverse-vp-mode-option {\n    margin-bottom: 8px;\n}\n\n.lumiverse-vp-mode-option:last-child {\n    margin-bottom: 0;\n}\n\n.lumiverse-vp-mode-details {\n    margin-top: 8px;\n    padding-left: 12px;\n    border-left: 2px solid rgba(147, 112, 219, 0.3);\n}\n\n.lumiverse-vp-mode-note {\n    margin: 8px 0 0;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n    font-style: italic;\n}\n\n/* ----------------------------------------\n   Council Manager Component\n   ---------------------------------------- */\n.lumiverse-council-manager {\n    padding: 12px;\n    display: flex;\n    flex-direction: column;\n    gap: 12px;\n}\n\n.lumiverse-council-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    gap: 12px;\n}\n\n.lumiverse-council-title {\n    margin: 0;\n    font-size: 14px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    display: flex;\n    align-items: center;\n    gap: 8px;\n}\n\n.lumiverse-council-title svg {\n    color: var(--lumiverse-primary);\n}\n\n.lumiverse-council-mode-toggle {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    cursor: pointer;\n}\n\n.lumiverse-council-mode-toggle input {\n    display: none;\n}\n\n.lumiverse-council-mode-switch {\n    width: 40px;\n    height: 22px;\n    background: rgba(100, 100, 130, 0.3);\n    border-radius: 11px;\n    position: relative;\n    transition: background 0.2s ease;\n}\n\n.lumiverse-council-mode-switch--on {\n    background: var(--lumiverse-primary);\n}\n\n.lumiverse-council-mode-thumb {\n    position: absolute;\n    top: 2px;\n    left: 2px;\n    width: 18px;\n    height: 18px;\n    background: white;\n    border-radius: 50%;\n    transition: transform 0.2s ease;\n}\n\n.lumiverse-council-mode-switch--on .lumiverse-council-mode-thumb {\n    transform: translateX(18px);\n}\n\n.lumiverse-council-mode-label {\n    font-size: 11px;\n    font-weight: 500;\n    color: var(--lumiverse-text-muted);\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n.lumiverse-council-desc {\n    margin: 0;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n    line-height: 1.5;\n}\n\n/* Add member section */\n.lumiverse-council-add-section {\n    margin-top: 4px;\n}\n\n.lumiverse-council-add-btn {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 8px;\n    width: 100%;\n    padding: 10px 16px;\n    min-height: 44px; /* Mobile touch target minimum */\n    background: rgba(147, 112, 219, 0.1);\n    border: 1px dashed rgba(147, 112, 219, 0.3);\n    border-radius: 8px;\n    color: var(--lumiverse-primary);\n    font-size: 13px;\n    font-weight: 500;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    touch-action: manipulation;\n    -webkit-tap-highlight-color: rgba(147, 112, 219, 0.3);\n    /* Android WebView button reset */\n    -webkit-appearance: none;\n    appearance: none;\n}\n\n.lumiverse-council-add-btn:hover:not(:disabled) {\n    background: rgba(147, 112, 219, 0.15);\n    border-color: rgba(147, 112, 219, 0.5);\n}\n\n.lumiverse-council-add-btn:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n}\n\n/* Button container for dual buttons */\n.lumiverse-council-add-buttons {\n    display: flex;\n    gap: 8px;\n}\n\n.lumiverse-council-add-buttons .lumiverse-council-add-btn {\n    flex: 1;\n    min-width: 0;\n}\n\n/* Secondary button variant */\n.lumiverse-council-add-btn--secondary {\n    background: rgba(100, 180, 255, 0.1);\n    border-color: rgba(100, 180, 255, 0.3);\n    color: #64b4ff;\n}\n\n.lumiverse-council-add-btn--secondary:hover:not(:disabled) {\n    background: rgba(100, 180, 255, 0.15);\n    border-color: rgba(100, 180, 255, 0.5);\n}\n\n/* Pack icon in quick add dropdown */\n.lumiverse-council-pack-icon {\n    background: rgba(100, 180, 255, 0.1);\n}\n\n/* Add dropdown */\n.lumiverse-council-add-dropdown {\n    background: rgba(30, 30, 46, 0.95);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 10px;\n    overflow: hidden;\n    overscroll-behavior: contain;\n    /* Android touch compatibility */\n    touch-action: pan-y;\n    -webkit-overflow-scrolling: touch;\n}\n\n.lumiverse-council-add-header {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    padding: 10px;\n    border-bottom: 1px solid var(--lumiverse-border);\n}\n\n.lumiverse-council-search {\n    flex: 1;\n    padding: 8px 12px;\n    background: var(--lumiverse-bg);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 6px;\n    color: var(--lumiverse-text);\n    font-size: 13px;\n}\n\n.lumiverse-council-search:focus {\n    outline: none;\n    border-color: var(--lumiverse-primary);\n}\n\n.lumiverse-council-add-list {\n    max-height: 200px;\n    overflow-y: auto;\n    -webkit-overflow-scrolling: touch;\n    overscroll-behavior: contain;\n}\n\n.lumiverse-council-add-empty {\n    padding: 20px;\n    text-align: center;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-council-add-item {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    width: 100%;\n    padding: 10px 12px;\n    background: transparent;\n    border: none;\n    border-bottom: 1px solid rgba(255, 255, 255, 0.05);\n    color: var(--lumiverse-text);\n    cursor: pointer;\n    transition: background 0.2s ease;\n    text-align: left;\n    /* Button reset - CRITICAL for mobile touch */\n    font: inherit;\n    -webkit-appearance: none;\n    appearance: none;\n    /* Mobile touch fixes */\n    touch-action: manipulation;\n    -webkit-tap-highlight-color: rgba(147, 112, 219, 0.2);\n    /* Ensure minimum touch target for Android accessibility */\n    min-height: 48px;\n}\n\n.lumiverse-council-add-item:hover {\n    background: rgba(147, 112, 219, 0.1);\n}\n\n.lumiverse-council-add-item:active {\n    background: rgba(147, 112, 219, 0.2);\n}\n\n.lumiverse-council-add-item:last-child {\n    border-bottom: none;\n}\n\n.lumiverse-council-add-item-avatar {\n    width: 36px;\n    height: 36px;\n    border-radius: 6px;\n    overflow: hidden;\n    background: rgba(147, 112, 219, 0.15);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: var(--lumiverse-primary);\n    flex-shrink: 0;\n    pointer-events: none; /* Allow parent button to capture touch */\n}\n\n.lumiverse-council-add-item-avatar img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n    animation: lumiverseFadeIn 0.2s ease;\n}\n\n.lumiverse-council-add-item-info {\n    flex: 1;\n    min-width: 0;\n    pointer-events: none; /* Allow parent button to capture touch */\n}\n\n.lumiverse-council-add-item-name {\n    display: block;\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-council-add-item-pack {\n    display: block;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n}\n\n/* Members list */\n.lumiverse-council-members {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumiverse-council-empty {\n    padding: 24px;\n    text-align: center;\n    background: rgba(30, 30, 46, 0.4);\n    border-radius: 10px;\n}\n\n.lumiverse-council-empty-icon {\n    display: block;\n    margin-bottom: 12px;\n    color: var(--lumiverse-primary);\n    opacity: 0.5;\n}\n\n.lumiverse-council-empty h4 {\n    margin: 0 0 8px;\n    font-size: 14px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-council-empty p {\n    margin: 0;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n    line-height: 1.5;\n}\n\n/* Member card */\n.lumiverse-council-member {\n    background: rgba(30, 30, 46, 0.6);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 10px;\n    overflow: hidden;\n}\n\n.lumiverse-council-member-header {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 10px 12px;\n    cursor: pointer;\n    transition: background 0.2s ease;\n}\n\n.lumiverse-council-member-header:hover {\n    background: rgba(147, 112, 219, 0.05);\n}\n\n.lumiverse-council-member-avatar {\n    width: 40px;\n    height: 40px;\n    border-radius: 8px;\n    overflow: hidden;\n    background: rgba(147, 112, 219, 0.15);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: var(--lumiverse-primary);\n    flex-shrink: 0;\n}\n\n.lumiverse-council-member-avatar img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n    animation: lumiverseFadeIn 0.2s ease;\n}\n\n.lumiverse-council-member-info {\n    flex: 1;\n    min-width: 0;\n}\n\n.lumiverse-council-member-name {\n    display: block;\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-council-member-role {\n    display: block;\n    font-size: 11px;\n    color: var(--lumiverse-primary);\n    font-weight: 500;\n}\n\n.lumiverse-council-member-stats {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    margin-top: 4px;\n}\n\n.lumiverse-council-stat {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-council-stat svg {\n    opacity: 0.7;\n}\n\n.lumiverse-council-member-actions {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n}\n\n.lumiverse-council-btn {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 28px;\n    height: 28px;\n    min-width: 36px;  /* Mobile touch target */\n    min-height: 36px; /* Mobile touch target */\n    background: rgba(100, 100, 130, 0.2);\n    border: none;\n    border-radius: 6px;\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    transition: all 0.2s ease;\n    touch-action: manipulation;\n    -webkit-tap-highlight-color: rgba(147, 112, 219, 0.3);\n    /* Android WebView button reset */\n    -webkit-appearance: none;\n    appearance: none;\n}\n\n.lumiverse-council-btn:hover {\n    background: rgba(147, 112, 219, 0.2);\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-council-btn--primary {\n    background: var(--lumiverse-primary);\n    color: white;\n}\n\n.lumiverse-council-btn--primary:hover {\n    background: var(--lumiverse-primary-light);\n}\n\n.lumiverse-council-btn--danger:hover {\n    background: rgba(239, 68, 68, 0.2);\n    color: var(--lumiverse-danger);\n}\n\n.lumiverse-council-expand {\n    display: flex;\n    transition: transform 0.2s ease;\n}\n\n.lumiverse-council-expand--open {\n    transform: rotate(180deg);\n}\n\n/* Member body (expanded content) */\n.lumiverse-council-member-body {\n    padding: 12px;\n    border-top: 1px solid var(--lumiverse-border);\n    background: rgba(20, 20, 36, 0.4);\n}\n\n.lumiverse-council-role-edit {\n    margin-bottom: 12px;\n}\n\n.lumiverse-council-role-edit label {\n    display: block;\n    font-size: 11px;\n    font-weight: 500;\n    color: var(--lumiverse-text-muted);\n    margin-bottom: 6px;\n}\n\n.lumiverse-council-role-input-row {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    width: 100%;\n}\n\n.lumiverse-council-role-input-row .lumiverse-council-btn {\n    flex: 0 0 auto;\n    width: 32px;\n    height: 32px;\n}\n\n.lumiverse-council-input {\n    flex: 1 1 0;\n    min-width: 0;\n    padding: 8px 12px;\n    background: var(--lumiverse-bg);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 6px;\n    color: var(--lumiverse-text);\n    font-size: 13px;\n}\n\n.lumiverse-council-input:focus {\n    outline: none;\n    border-color: var(--lumiverse-primary);\n}\n\n.lumiverse-council-role-display {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    margin-bottom: 12px;\n    font-size: 12px;\n}\n\n.lumiverse-council-role-label {\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-council-role-value {\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-council-role-value em {\n    color: var(--lumiverse-text-muted);\n    font-style: italic;\n}\n\n/* Traits section */\n.lumiverse-council-traits-section {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumiverse-council-traits-group {\n    display: flex;\n    flex-wrap: wrap;\n    align-items: flex-start;\n    gap: 6px;\n    font-size: 12px;\n}\n\n.lumiverse-council-traits-label {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    color: var(--lumiverse-text-muted);\n    flex-shrink: 0;\n}\n\n.lumiverse-council-traits-list {\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-council-traits-empty {\n    color: var(--lumiverse-text-dim);\n    font-style: italic;\n}\n\n.lumiverse-council-help-text {\n    margin: 12px 0 0;\n    padding: 10px;\n    background: rgba(147, 112, 219, 0.08);\n    border-radius: 6px;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n    line-height: 1.5;\n}\n\n/* Help text at bottom */\n.lumiverse-council-help {\n    padding: 10px;\n    background: rgba(30, 30, 46, 0.4);\n    border-radius: 8px;\n}\n\n.lumiverse-council-help p {\n    margin: 0;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n    line-height: 1.5;\n}\n\n.lumiverse-council-help code {\n    background: rgba(147, 112, 219, 0.15);\n    padding: 2px 5px;\n    border-radius: 3px;\n    font-size: 10px;\n    color: var(--lumiverse-primary);\n}\n\n/* ========================================\n   Council Tools UI\n   Tool toggle, tool selector, tool tags, LLM config\n   ======================================== */\n\n/* Tools toggle container */\n.lumiverse-council-tools-toggle {\n    padding: 10px 12px;\n    background: rgba(30, 30, 46, 0.5);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 10px;\n}\n\n.lumiverse-council-tools-label {\n    gap: 8px;\n}\n\n.lumiverse-council-tools-label .lumiverse-council-mode-label {\n    display: flex;\n    align-items: center;\n    gap: 5px;\n}\n\n.lumiverse-council-tools-desc {\n    margin: 8px 0 0;\n    font-size: 11px;\n    color: var(--lumiverse-text-dim);\n    line-height: 1.5;\n}\n\n/* Tool stat highlight in member card header */\n.lumiverse-council-stat--tools {\n    color: var(--lumiverse-primary);\n}\n\n.lumiverse-council-stat--tools svg {\n    opacity: 1;\n}\n\n/* Tools section inside expanded member body */\n.lumiverse-council-tools-section {\n    margin-top: 12px;\n    padding-top: 12px;\n    border-top: 1px solid rgba(255, 255, 255, 0.05);\n}\n\n.lumiverse-council-tools-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    margin-bottom: 8px;\n}\n\n.lumiverse-council-tools-label {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-council-btn--small {\n    display: inline-flex;\n    align-items: center;\n    gap: 4px;\n    padding: 4px 10px;\n    min-height: 28px;\n    background: rgba(147, 112, 219, 0.12);\n    border: 1px solid rgba(147, 112, 219, 0.2);\n    border-radius: 6px;\n    color: var(--lumiverse-primary);\n    font-size: 11px;\n    font-weight: 500;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    touch-action: manipulation;\n    -webkit-appearance: none;\n    appearance: none;\n}\n\n.lumiverse-council-btn--small:hover {\n    background: rgba(147, 112, 219, 0.2);\n    border-color: rgba(147, 112, 219, 0.35);\n}\n\n/* Tool tags row */\n.lumiverse-council-tools-list {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 6px;\n}\n\n.lumiverse-council-tool-tag {\n    display: inline-flex;\n    align-items: center;\n    padding: 3px 8px;\n    background: rgba(147, 112, 219, 0.1);\n    border: 1px solid rgba(147, 112, 219, 0.2);\n    border-radius: 5px;\n    font-size: 11px;\n    font-weight: 500;\n    color: var(--lumiverse-primary-text);\n    line-height: 1.3;\n}\n\n.lumiverse-council-tools-empty {\n    font-size: 11px;\n    color: var(--lumiverse-text-dim);\n    line-height: 1.5;\n    font-style: italic;\n}\n\n/* Tool selector dropdown */\n.lumiverse-council-tool-selector {\n    margin-top: 8px;\n    background: rgba(20, 20, 36, 0.6);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 8px;\n    overflow: hidden;\n}\n\n.lumiverse-council-tool-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 8px 10px;\n    border-bottom: 1px solid rgba(255, 255, 255, 0.05);\n    font-size: 11px;\n    font-weight: 600;\n    color: var(--lumiverse-text-muted);\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n.lumiverse-council-tool-list {\n    padding: 4px 0;\n    max-height: 200px;\n    overflow-y: auto;\n}\n\n.lumiverse-council-tool-item {\n    display: flex;\n    align-items: flex-start;\n    gap: 8px;\n    padding: 8px 10px;\n    cursor: pointer;\n    transition: background 0.15s ease;\n}\n\n.lumiverse-council-tool-item:hover {\n    background: rgba(147, 112, 219, 0.06);\n}\n\n.lumiverse-council-tool-item input[type="checkbox"] {\n    margin-top: 2px;\n    accent-color: var(--lumiverse-primary);\n    flex-shrink: 0;\n}\n\n.lumiverse-council-tool-info {\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n    min-width: 0;\n}\n\n.lumiverse-council-tool-name {\n    font-size: 12px;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-council-tool-desc {\n    font-size: 10px;\n    color: var(--lumiverse-text-dim);\n    line-height: 1.4;\n}\n\n/* ========================================\n   Council Tools LLM Configuration\n   Provider/model/params panel inside tools toggle\n   ======================================== */\n\n.lumiverse-council-llm-config {\n    margin-top: 12px;\n    padding: 12px;\n    background: rgba(20, 20, 36, 0.5);\n    border: 1px solid rgba(147, 112, 219, 0.1);\n    border-radius: 8px;\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n}\n\n.lumiverse-council-llm-header {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    font-size: 11px;\n    font-weight: 600;\n    color: var(--lumiverse-text-muted);\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    padding-bottom: 6px;\n    border-bottom: 1px solid rgba(255, 255, 255, 0.05);\n}\n\n.lumiverse-council-llm-header svg {\n    color: var(--lumiverse-primary);\n    opacity: 0.8;\n}\n\n.lumiverse-council-llm-field {\n    display: flex;\n    flex-direction: column;\n    gap: 4px;\n}\n\n.lumiverse-council-llm-label {\n    font-size: 11px;\n    font-weight: 500;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-council-llm-hint {\n    font-size: 10px;\n    color: var(--lumiverse-text-dim);\n    font-style: italic;\n}\n\n.lumiverse-council-llm-select {\n    width: 100%;\n    padding: 7px 10px;\n    background: var(--lumiverse-bg);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 6px;\n    color: var(--lumiverse-text);\n    font-size: 12px;\n    cursor: pointer;\n    transition: border-color 0.2s ease;\n    -webkit-appearance: none;\n    appearance: none;\n    background-image: url(${v});\n    background-repeat: no-repeat;\n    background-position: right 8px center;\n    padding-right: 28px;\n}\n\n.lumiverse-council-llm-select:focus {\n    outline: none;\n    border-color: var(--lumiverse-primary);\n}\n\n.lumiverse-council-llm-select option {\n    background: #1c1828;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-council-llm-input {\n    width: 100%;\n    padding: 7px 10px;\n    background: var(--lumiverse-bg);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 6px;\n    color: var(--lumiverse-text);\n    font-size: 12px;\n    transition: border-color 0.2s ease;\n    box-sizing: border-box;\n}\n\n.lumiverse-council-llm-input:focus {\n    outline: none;\n    border-color: var(--lumiverse-primary);\n}\n\n.lumiverse-council-llm-input::placeholder {\n    color: var(--lumiverse-text-dim);\n}\n\n.lumiverse-council-llm-password-row {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n}\n\n.lumiverse-council-llm-password-row .lumiverse-council-llm-input {\n    flex: 1;\n    min-width: 0;\n}\n\n.lumiverse-council-llm-password-row .lumiverse-council-btn {\n    flex-shrink: 0;\n    width: 32px;\n    height: 32px;\n    min-width: 32px;\n    min-height: 32px;\n}\n\n/* Parameter row (Temp / Top-P / Max Tokens) */\n.lumiverse-council-llm-params {\n    display: grid;\n    grid-template-columns: 1fr 1fr 1fr;\n    gap: 8px;\n}\n\n.lumiverse-council-llm-param {\n    display: flex;\n    flex-direction: column;\n    gap: 4px;\n}\n\n.lumiverse-council-llm-input--num {\n    text-align: center;\n    padding: 6px 4px;\n    font-variant-numeric: tabular-nums;\n}\n\n/* Number input spinner removal for cleaner look */\n.lumiverse-council-llm-input--num::-webkit-inner-spin-button,\n.lumiverse-council-llm-input--num::-webkit-outer-spin-button {\n    -webkit-appearance: none;\n    margin: 0;\n}\n\n.lumiverse-council-llm-input--num[type=number] {\n    -moz-appearance: textfield;\n}\n\n/* ========================================\n   Council Tools Mode Selector\n   Segmented control for Sidecar vs Inline mode\n   ======================================== */\n\n.lumiverse-council-tools-mode {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n    padding-bottom: 8px;\n}\n\n.lumiverse-council-mode-selector {\n    display: flex;\n    gap: 0;\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 8px;\n    overflow: hidden;\n    background: var(--lumiverse-bg);\n}\n\n.lumiverse-council-mode-option {\n    flex: 1;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 5px;\n    padding: 8px 12px;\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text-muted);\n    font-size: 12px;\n    font-weight: 500;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    position: relative;\n}\n\n.lumiverse-council-mode-option:first-child {\n    border-right: 1px solid var(--lumiverse-border);\n}\n\n.lumiverse-council-mode-option:hover:not(.lumiverse-council-mode-option--disabled) {\n    color: var(--lumiverse-text);\n    background: rgba(147, 112, 219, 0.06);\n}\n\n.lumiverse-council-mode-option--active {\n    color: var(--lumiverse-text) !important;\n    background: rgba(147, 112, 219, 0.15) !important;\n}\n\n.lumiverse-council-mode-option--active svg {\n    color: var(--lumiverse-primary);\n}\n\n.lumiverse-council-mode-option--disabled {\n    opacity: 0.4;\n    cursor: not-allowed;\n}\n\n.lumiverse-council-mode-desc-text {\n    font-size: 10px;\n    color: var(--lumiverse-text-dim);\n    line-height: 1.4;\n    margin: 0;\n}\n\n.lumiverse-council-mode-warning {\n    font-size: 10px;\n    color: #d4a574;\n    line-height: 1.4;\n    margin: 0;\n    padding: 6px 8px;\n    background: rgba(212, 165, 116, 0.08);\n    border: 1px solid rgba(212, 165, 116, 0.15);\n    border-radius: 6px;\n}\n\n/* Inline mode info panel */\n.lumiverse-council-inline-info {\n    padding: 10px;\n    background: rgba(147, 112, 219, 0.05);\n    border: 1px solid rgba(147, 112, 219, 0.1);\n    border-radius: 6px;\n}\n\n.lumiverse-council-inline-info p {\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n    line-height: 1.5;\n    margin: 0;\n}\n\n/* ========================================\n   Council Select Modal\n   Mobile-friendly modal for selecting council members\n   ======================================== */\n\n.lumiverse-council-select-modal {\n    display: flex;\n    flex-direction: column;\n    height: 100%;\n    max-height: 80vh;\n}\n\n/* Header */\n.lumiverse-council-select-header {\n    display: flex;\n    align-items: flex-start;\n    gap: 12px;\n    padding: 16px 20px;\n    border-bottom: 1px solid var(--lumiverse-border);\n}\n\n.lumiverse-council-select-header-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 40px;\n    height: 40px;\n    background: linear-gradient(135deg, var(--lumiverse-primary), var(--lumiverse-primary-light));\n    border-radius: 10px;\n    color: white;\n    flex-shrink: 0;\n}\n\n.lumiverse-council-select-header-text h3 {\n    margin: 0 0 4px;\n    font-size: 16px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-council-select-header-text p {\n    margin: 0;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n    line-height: 1.4;\n}\n\n/* Sections */\n.lumiverse-council-select-section {\n    padding: 16px 20px;\n    border-bottom: 1px solid var(--lumiverse-border);\n    flex-shrink: 0;\n}\n\n/* Council Members section - constrained height with scrolling */\n.lumiverse-council-select-section:not(.lumiverse-council-select-section--available) {\n    max-height: 35vh;\n    display: flex;\n    flex-direction: column;\n}\n\n.lumiverse-council-select-section--available {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    min-height: 200px;\n    overflow: hidden;\n}\n\n.lumiverse-council-select-section-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    gap: 12px;\n    margin-bottom: 12px;\n    font-size: 12px;\n    font-weight: 600;\n    color: var(--lumiverse-text-muted);\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n.lumiverse-council-select-count {\n    padding: 2px 8px;\n    background: var(--lumiverse-primary);\n    border-radius: 10px;\n    font-size: 11px;\n    font-weight: 600;\n    color: white;\n}\n\n/* Search */\n.lumiverse-council-search-wrapper {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    padding: 6px 10px;\n    background: rgba(30, 30, 46, 0.6);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 8px;\n    flex: 1;\n    max-width: 200px;\n}\n\n.lumiverse-council-search-wrapper svg {\n    color: var(--lumiverse-text-muted);\n    flex-shrink: 0;\n}\n\n.lumiverse-council-search-input {\n    flex: 1;\n    min-width: 0;\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text);\n    font-size: 12px;\n}\n\n.lumiverse-council-search-input::placeholder {\n    color: var(--lumiverse-text-dim);\n}\n\n.lumiverse-council-search-input:focus {\n    outline: none;\n}\n\n.lumiverse-council-search-clear {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 18px;\n    height: 18px;\n    background: rgba(100, 100, 130, 0.3);\n    border: none;\n    border-radius: 50%;\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-council-search-clear:hover {\n    background: rgba(239, 68, 68, 0.3);\n    color: var(--lumiverse-danger);\n}\n\n/* Members list (horizontal scrolling on mobile) */\n.lumiverse-council-select-members {\n    min-height: 60px;\n    flex: 1;\n    overflow-y: auto;\n    scrollbar-width: thin;\n    scrollbar-color: rgba(147, 112, 219, 0.3) transparent;\n}\n\n.lumiverse-council-select-members::-webkit-scrollbar {\n    width: 6px;\n}\n\n.lumiverse-council-select-members::-webkit-scrollbar-track {\n    background: transparent;\n}\n\n.lumiverse-council-select-members::-webkit-scrollbar-thumb {\n    background: rgba(147, 112, 219, 0.3);\n    border-radius: 3px;\n}\n\n.lumiverse-council-select-members::-webkit-scrollbar-thumb:hover {\n    background: rgba(147, 112, 219, 0.5);\n}\n\n.lumiverse-council-member-list {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n/* Member card (in modal) */\n.lumiverse-council-member-card {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 10px 12px;\n    background: rgba(30, 30, 46, 0.6);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 10px;\n}\n\n.lumiverse-council-member-card-avatar {\n    width: 36px;\n    height: 36px;\n    border-radius: 8px;\n    overflow: hidden;\n    background: rgba(147, 112, 219, 0.15);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: var(--lumiverse-primary);\n    flex-shrink: 0;\n}\n\n.lumiverse-council-member-card-avatar img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n    animation: lumiverseFadeIn 0.2s ease;\n}\n\n.lumiverse-council-member-card-content {\n    flex: 1;\n    min-width: 0;\n}\n\n.lumiverse-council-member-card-name {\n    display: block;\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-council-member-card-meta {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    margin-top: 2px;\n}\n\n.lumiverse-council-member-card-role {\n    font-size: 11px;\n    color: var(--lumiverse-primary);\n    font-weight: 500;\n    cursor: pointer;\n    /* Android touch compatibility for interactive span */\n    touch-action: manipulation;\n    -webkit-tap-highlight-color: rgba(147, 112, 219, 0.2);\n    padding: 4px 0; /* Increase touch target */\n}\n\n.lumiverse-council-member-card-role:hover {\n    text-decoration: underline;\n}\n\n.lumiverse-council-add-role-btn {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    padding: 4px 8px; /* Increase padding for touch target */\n    margin: -4px -8px; /* Compensate visually */\n    background: none;\n    border: none;\n    font-size: 10px;\n    color: var(--lumiverse-text-dim);\n    cursor: pointer;\n    transition: color 0.2s ease;\n    /* Android touch compatibility */\n    touch-action: manipulation;\n    -webkit-tap-highlight-color: rgba(147, 112, 219, 0.2);\n    -webkit-appearance: none;\n    appearance: none;\n    min-height: 32px; /* Mobile touch target */\n}\n\n.lumiverse-council-add-role-btn:hover {\n    color: var(--lumiverse-primary);\n}\n\n.lumiverse-council-member-card-stats {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n}\n\n.lumiverse-council-member-card-stats span {\n    display: flex;\n    align-items: center;\n    gap: 3px;\n    font-size: 10px;\n    color: var(--lumiverse-text-dim);\n}\n\n/* Small buttons for modal */\n.lumiverse-council-btn-sm {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 24px;\n    height: 24px;\n    /* Ensure minimum touch target on mobile */\n    min-width: 36px;\n    min-height: 36px;\n    background: rgba(100, 100, 130, 0.2);\n    border: none;\n    border-radius: 6px;\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    transition: all 0.2s ease;\n    flex-shrink: 0;\n    /* Android touch compatibility */\n    touch-action: manipulation;\n    -webkit-tap-highlight-color: rgba(147, 112, 219, 0.3);\n}\n\n.lumiverse-council-btn-sm:hover {\n    background: rgba(147, 112, 219, 0.2);\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-council-btn-sm--primary {\n    background: var(--lumiverse-primary);\n    color: white;\n}\n\n.lumiverse-council-btn-sm--primary:hover {\n    background: var(--lumiverse-primary-light);\n}\n\n.lumiverse-council-btn-sm--danger:hover {\n    background: rgba(239, 68, 68, 0.2);\n    color: var(--lumiverse-danger);\n}\n\n/* Role edit in modal */\n.lumiverse-council-member-role-edit {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    margin-top: 4px;\n}\n\n.lumiverse-council-input-sm {\n    flex: 1;\n    min-width: 0;\n    padding: 4px 8px;\n    background: var(--lumiverse-bg);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 4px;\n    color: var(--lumiverse-text);\n    font-size: 11px;\n}\n\n.lumiverse-council-input-sm:focus {\n    outline: none;\n    border-color: var(--lumiverse-primary);\n}\n\n/* Grid wrapper for available Lumias */\n.lumiverse-council-select-grid-wrapper {\n    flex: 1;\n    overflow-y: auto;\n    min-height: 150px;\n}\n\n/* Card grid for available Lumias */\n.lumiverse-council-select-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));\n    gap: 12px;\n    padding: 4px 0;\n}\n\n/* Show more button for pagination */\n.lumiverse-council-show-more {\n    display: block;\n    width: 100%;\n    padding: 12px;\n    margin-top: 12px;\n    background: rgba(147, 112, 219, 0.1);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 8px;\n    color: var(--lumiverse-text-primary);\n    font-size: 13px;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    text-align: center;\n}\n\n.lumiverse-council-show-more:hover {\n    background: rgba(147, 112, 219, 0.2);\n    border-color: var(--lumiverse-primary);\n}\n\n.lumiverse-council-show-more:active {\n    transform: scale(0.99);\n}\n\n/* Selectable card - now a button for iOS touch compatibility */\n.lumiverse-council-select-card {\n    display: flex;\n    flex-direction: column;\n    background: rgba(30, 30, 46, 0.6);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 10px;\n    overflow: hidden;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    /* Button reset */\n    padding: 0;\n    margin: 0;\n    font: inherit;\n    text-align: left;\n    /* Mobile touch fixes - Android compatibility */\n    touch-action: manipulation;\n    -webkit-tap-highlight-color: rgba(147, 112, 219, 0.2);\n    -webkit-appearance: none;\n    appearance: none;\n}\n\n.lumiverse-council-select-card:hover {\n    border-color: var(--lumiverse-primary);\n    transform: translateY(-2px);\n    box-shadow: 0 4px 12px rgba(147, 112, 219, 0.15);\n}\n\n.lumiverse-council-select-card:active {\n    transform: scale(0.98);\n    border-color: var(--lumiverse-primary);\n}\n\n.lumiverse-council-select-card-image {\n    position: relative;\n    aspect-ratio: 1;\n    background: rgba(147, 112, 219, 0.1);\n    pointer-events: none; /* Allow parent button to capture touch */\n}\n\n.lumiverse-council-select-card-image img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n    opacity: 0;\n    transition: opacity 0.2s ease;\n}\n\n.lumiverse-council-select-card-image img.lumia-img-loaded {\n    opacity: 1;\n}\n\n.lumiverse-council-select-card-placeholder {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 100%;\n    height: 100%;\n    color: var(--lumiverse-text-dim);\n}\n\n.lumiverse-council-select-card-add {\n    position: absolute;\n    bottom: 6px;\n    right: 6px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 24px;\n    height: 24px;\n    background: var(--lumiverse-primary);\n    border-radius: 50%;\n    color: white;\n    opacity: 0;\n    transform: scale(0.8);\n    transition: all 0.2s ease;\n}\n\n.lumiverse-council-select-card:hover .lumiverse-council-select-card-add {\n    opacity: 1;\n    transform: scale(1);\n}\n\n.lumiverse-council-select-card-info {\n    padding: 8px;\n    text-align: center;\n    pointer-events: none; /* Allow parent button to capture touch */\n}\n\n.lumiverse-council-select-card-name {\n    display: block;\n    font-size: 11px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-council-select-card-pack {\n    display: block;\n    font-size: 9px;\n    color: var(--lumiverse-text-dim);\n    margin-top: 2px;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n/* Empty states */\n.lumiverse-council-select-empty {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    padding: 24px;\n    text-align: center;\n    color: var(--lumiverse-primary);\n}\n\n.lumiverse-council-select-empty--muted {\n    color: var(--lumiverse-text-dim);\n}\n\n.lumiverse-council-select-empty span {\n    display: block;\n    margin-top: 8px;\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-council-select-empty p {\n    margin: 4px 0 0;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n    line-height: 1.4;\n}\n\n/* Footer */\n.lumiverse-council-select-footer {\n    display: flex;\n    justify-content: flex-end;\n    gap: 10px;\n    padding: 12px 20px;\n    border-top: 1px solid var(--lumiverse-border);\n    background: rgba(20, 20, 36, 0.4);\n}\n\n/* Mobile responsiveness */\n@media (max-width: 480px) {\n    .lumiverse-council-select-modal {\n        max-height: 90vh;\n    }\n\n    .lumiverse-council-select-header {\n        padding: 12px 16px;\n    }\n\n    .lumiverse-council-select-header-icon {\n        width: 36px;\n        height: 36px;\n    }\n\n    .lumiverse-council-select-header-text h3 {\n        font-size: 15px;\n    }\n\n    .lumiverse-council-select-section {\n        padding: 12px 16px;\n    }\n\n    .lumiverse-council-select-section-header {\n        flex-wrap: wrap;\n    }\n\n    .lumiverse-council-search-wrapper {\n        max-width: none;\n        width: 100%;\n        margin-top: 8px;\n        order: 1;\n    }\n\n    .lumiverse-council-member-list {\n        /* Horizontal scroll on mobile */\n        flex-direction: row;\n        overflow-x: auto;\n        padding-bottom: 8px;\n        gap: 10px;\n        scrollbar-width: thin;\n    }\n\n    .lumiverse-council-member-card {\n        flex-shrink: 0;\n        min-width: 200px;\n        max-width: 280px;\n    }\n\n    .lumiverse-council-select-grid {\n        grid-template-columns: repeat(3, 1fr);\n        gap: 8px;\n    }\n\n    .lumiverse-council-select-card-info {\n        padding: 6px;\n    }\n\n    .lumiverse-council-select-card-name {\n        font-size: 10px;\n    }\n\n    .lumiverse-council-select-card-pack {\n        display: none;\n    }\n\n    /* Always show plus icon on touch devices since hover doesn't work */\n    .lumiverse-council-select-card-add {\n        opacity: 1;\n        transform: scale(1);\n    }\n\n    .lumiverse-council-select-footer {\n        padding: 10px 16px;\n    }\n}\n\n/* Council Quirks Section */\n.lumiverse-council-quirks-section {\n    margin: 16px 0;\n    padding: 12px;\n    background: var(--SmartThemeBotMesBlurTintColor, rgba(0, 0, 0, 0.1));\n    border-radius: 8px;\n}\n\n.lumiverse-council-quirks-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    margin-bottom: 4px;\n}\n\n.lumiverse-council-quirks-label {\n    font-weight: 600;\n    font-size: 0.9em;\n    color: var(--lumiverse-text, var(--SmartThemeBodyColor, #fff));\n}\n\n.lumiverse-council-quirks-hint {\n    font-size: 0.8em;\n    color: var(--lumiverse-text-muted, var(--SmartThemeEmColor, #888));\n    margin: 0 0 8px 0;\n}\n\n.lumiverse-council-quirks-hint code {\n    background: rgba(0, 0, 0, 0.2);\n    padding: 2px 6px;\n    border-radius: 4px;\n    font-family: monospace;\n    font-size: 0.9em;\n}\n\n.lumiverse-council-textarea {\n    width: 100%;\n    min-height: 80px;\n    padding: 8px;\n    background: var(--lumiverse-bg, var(--SmartThemeBlurTintColor, rgba(0, 0, 0, 0.2)));\n    border: 1px solid var(--lumiverse-border, var(--SmartThemeBorderColor, rgba(255, 255, 255, 0.1)));\n    border-radius: 6px;\n    color: inherit;\n    font-family: inherit;\n    font-size: 0.9em;\n    resize: vertical;\n}\n\n.lumiverse-council-textarea:focus {\n    outline: none;\n    border-color: var(--lumiverse-primary, #9370DB);\n}\n\n.lumiverse-council-quirks-actions {\n    display: flex;\n    gap: 8px;\n    margin-top: 8px;\n}\n\n.lumiverse-council-quirks-preview {\n    padding: 8px;\n    background: rgba(0, 0, 0, 0.1);\n    border-radius: 6px;\n    font-size: 0.9em;\n}\n\n.lumiverse-council-quirks-text {\n    white-space: pre-wrap;\n}\n\n.lumiverse-council-quirks-empty {\n    color: var(--lumiverse-text-muted, var(--SmartThemeEmColor, #888));\n    font-style: italic;\n}\n\n.lumiverse-council-btn--sm {\n    padding: 4px 8px;\n    font-size: 12px;\n    border-radius: 4px;\n}\n\n/* State Synthesis sub-option styling */\n.lumiverse-vp-mode-option--sub {\n    margin-left: 16px;\n    padding-left: 12px;\n    border-left: 2px solid var(--lumiverse-border, var(--SmartThemeBorderColor, rgba(255, 255, 255, 0.1)));\n}\n\n/* Viewport Panel Quirks Section */\n.lumiverse-vp-quirks-section {\n    margin-top: 16px;\n    padding: 12px;\n    background: var(--SmartThemeBotMesBlurTintColor, rgba(0, 0, 0, 0.1));\n    border-radius: 8px;\n    transition: opacity 0.2s ease;\n}\n\n.lumiverse-vp-quirks-section--disabled {\n    opacity: 0.5;\n}\n\n.lumiverse-vp-quirks-section--disabled .lumiverse-vp-quirks-preview,\n.lumiverse-vp-quirks-section--disabled .lumiverse-vp-quirks-hint {\n    pointer-events: none;\n}\n\n.lumiverse-vp-quirks-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    margin-bottom: 4px;\n}\n\n.lumiverse-vp-quirks-header-left {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n}\n\n/* Compact inline toggle for quirks */\n.lumiverse-vp-quirks-toggle {\n    display: flex;\n    align-items: center;\n    padding: 0;\n    background: none;\n    border: none;\n    cursor: pointer;\n}\n\n.lumiverse-vp-quirks-toggle-track {\n    position: relative;\n    width: 28px;\n    height: 14px;\n    background: rgba(255, 255, 255, 0.15);\n    border-radius: 7px;\n    transition: background 0.2s ease;\n}\n\n.lumiverse-vp-quirks-toggle--on .lumiverse-vp-quirks-toggle-track {\n    background: var(--lumiverse-primary, #9370DB);\n}\n\n.lumiverse-vp-quirks-toggle-thumb {\n    position: absolute;\n    top: 2px;\n    left: 2px;\n    width: 10px;\n    height: 10px;\n    background: rgba(255, 255, 255, 0.7);\n    border-radius: 50%;\n    transition: transform 0.2s ease, background 0.2s ease;\n}\n\n.lumiverse-vp-quirks-toggle--on .lumiverse-vp-quirks-toggle-thumb {\n    transform: translateX(14px);\n    background: #fff;\n}\n\n.lumiverse-vp-quirks-toggle:hover .lumiverse-vp-quirks-toggle-track {\n    background: rgba(255, 255, 255, 0.25);\n}\n\n.lumiverse-vp-quirks-toggle--on:hover .lumiverse-vp-quirks-toggle-track {\n    background: var(--lumiverse-primary-light, #a388e0);\n}\n\n.lumiverse-vp-quirks-label {\n    font-weight: 600;\n    font-size: 0.9em;\n    color: var(--lumiverse-text, var(--SmartThemeBodyColor, #fff));\n}\n\n.lumiverse-vp-quirks-edit-btn {\n    padding: 4px 8px;\n    background: transparent;\n    border: 1px solid var(--lumiverse-border, var(--SmartThemeBorderColor, rgba(255, 255, 255, 0.1)));\n    border-radius: 4px;\n    color: var(--lumiverse-text-muted, var(--SmartThemeEmColor, #888));\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-vp-quirks-edit-btn:hover {\n    background: rgba(147, 112, 219, 0.2);\n    color: var(--lumiverse-text, var(--SmartThemeBodyColor, #fff));\n}\n\n.lumiverse-vp-quirks-hint {\n    font-size: 0.8em;\n    color: var(--lumiverse-text-muted, var(--SmartThemeEmColor, #888));\n    margin: 0 0 8px 0;\n}\n\n.lumiverse-vp-quirks-hint code {\n    background: rgba(0, 0, 0, 0.2);\n    padding: 2px 6px;\n    border-radius: 4px;\n    font-family: monospace;\n    font-size: 0.9em;\n}\n\n.lumiverse-vp-quirks-textarea {\n    width: 100%;\n    min-height: 60px;\n    padding: 8px;\n    background: var(--lumiverse-bg, var(--SmartThemeBlurTintColor, rgba(0, 0, 0, 0.2)));\n    border: 1px solid var(--lumiverse-border, var(--SmartThemeBorderColor, rgba(255, 255, 255, 0.1)));\n    border-radius: 6px;\n    color: inherit;\n    font-family: inherit;\n    font-size: 0.85em;\n    resize: vertical;\n}\n\n.lumiverse-vp-quirks-textarea:focus {\n    outline: none;\n    border-color: var(--lumiverse-primary, #9370DB);\n}\n\n.lumiverse-vp-quirks-actions {\n    display: flex;\n    gap: 8px;\n    margin-top: 8px;\n}\n\n.lumiverse-vp-quirks-btn {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    padding: 4px 10px;\n    background: transparent;\n    border: 1px solid var(--lumiverse-border, var(--SmartThemeBorderColor, rgba(255, 255, 255, 0.1)));\n    border-radius: 4px;\n    color: var(--lumiverse-text-muted, var(--SmartThemeEmColor, #888));\n    font-size: 0.8em;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-vp-quirks-btn:hover {\n    background: rgba(147, 112, 219, 0.2);\n    color: var(--lumiverse-text, var(--SmartThemeBodyColor, #fff));\n}\n\n.lumiverse-vp-quirks-btn--primary {\n    background: var(--lumiverse-primary, #9370DB);\n    border-color: var(--lumiverse-primary, #9370DB);\n    color: white;\n}\n\n.lumiverse-vp-quirks-btn--primary:hover {\n    background: var(--lumiverse-primary-light, #a388e0);\n}\n\n.lumiverse-vp-quirks-preview {\n    padding: 8px;\n    min-height: 60px;\n    background: rgba(0, 0, 0, 0.1);\n    border-radius: 6px;\n    font-size: 0.85em;\n}\n\n.lumiverse-vp-quirks-text {\n    white-space: pre-wrap;\n}\n\n.lumiverse-vp-quirks-empty {\n    color: var(--lumiverse-text-muted, var(--SmartThemeEmColor, #888));\n    font-style: italic;\n}\n\n/* Smart Synthesis Info */\n.lumiverse-vp-smart-info {\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n    margin-bottom: 8px;\n}\n\n.lumiverse-vp-smart-label {\n    font-weight: 600;\n    font-size: 0.9em;\n    color: var(--lumiverse-text, var(--SmartThemeBodyColor, #fff));\n}\n\n.lumiverse-vp-smart-hint {\n    font-size: 0.8em;\n    color: var(--lumiverse-text-muted, var(--SmartThemeEmColor, #888));\n}\n\n/* ----------------------------------------\n   Collapsible Component - CSS Grid Based\n   High-performance alternative to height animations.\n   Uses grid-template-rows: 0fr -> 1fr which is GPU-accelerated\n   and doesn't trigger layout thrashing.\n   ---------------------------------------- */\n.lumiverse-collapsible {\n    display: grid;\n    grid-template-rows: 0fr;\n    transition: grid-template-rows var(--collapsible-duration, 200ms) ease-out;\n}\n\n.lumiverse-collapsible.is-open {\n    grid-template-rows: 1fr;\n}\n\n.lumiverse-collapsible-inner {\n    overflow: hidden;\n    /* Ensure content is properly hidden when collapsed */\n    min-height: 0;\n}\n\n/* Optional: Fade in content when opening */\n.lumiverse-collapsible .lumiverse-collapsible-inner > * {\n    opacity: 0;\n    transition: opacity calc(var(--collapsible-duration, 200ms) * 0.5) ease-out;\n    transition-delay: calc(var(--collapsible-duration, 200ms) * 0.25);\n}\n\n.lumiverse-collapsible.is-open .lumiverse-collapsible-inner > * {\n    opacity: 1;\n}\n\n/* Reduced motion: instant transitions for accessibility */\n@media (prefers-reduced-motion: reduce) {\n    .lumiverse-collapsible {\n        transition: none;\n    }\n\n    .lumiverse-collapsible .lumiverse-collapsible-inner > * {\n        transition: none;\n        opacity: 1;\n    }\n\n    .lumiverse-collapsible:not(.is-open) .lumiverse-collapsible-inner > * {\n        opacity: 0;\n    }\n}\n\n/* ========================================\n   Pack Detail Modal - Pack Contents Viewer\n   Centered modal for viewing pack contents\n   with quick-add actions\n   ======================================== */\n\n/* Backdrop */\n.lumiverse-pack-detail-backdrop {\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background: rgba(0, 0, 0, 0.7);\n    backdrop-filter: blur(4px);\n    z-index: 10000;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    padding: 20px;\n    animation: fadeIn 0.15s ease-out;\n}\n\n@keyframes fadeIn {\n    from { opacity: 0; }\n    to { opacity: 1; }\n}\n\n@keyframes lumiverseFadeIn {\n    from { opacity: 0; }\n    to { opacity: 1; }\n}\n\n/* Pack detail modal - extends lumia-modal base class */\n.lumiverse-pack-detail-modal {\n    /* Override base modal width for pack details */\n    max-width: 650px;\n    /* Use Lumiverse theme colors */\n    background: var(--lumiverse-bg);\n    border-color: var(--lumiverse-border);\n    /* Custom animation */\n    animation: slideUp 0.2s ease-out;\n}\n\n@keyframes slideUp {\n    from {\n        opacity: 0;\n        transform: translateY(20px);\n    }\n    to {\n        opacity: 1;\n        transform: translateY(0);\n    }\n}\n\n/* Header */\n.lumiverse-pack-detail-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 16px 20px;\n    border-bottom: 1px solid var(--lumiverse-border);\n    background: var(--lumiverse-bg-elevated);\n    flex-shrink: 0;\n}\n\n.lumiverse-pack-detail-header-info {\n    display: flex;\n    align-items: center;\n    gap: 14px;\n    flex: 1;\n    min-width: 0;\n}\n\n.lumiverse-pack-detail-header-icon {\n    width: 48px;\n    height: 48px;\n    border-radius: var(--lumiverse-radius);\n    background: var(--lumiverse-bg-dark);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    flex-shrink: 0;\n    overflow: hidden;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-pack-detail-header-icon img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n    animation: lumiverseFadeIn 0.2s ease;\n}\n\n.lumiverse-pack-detail-header-img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n    animation: lumiverseFadeIn 0.2s ease;\n}\n\n.lumiverse-pack-detail-header-text {\n    flex: 1;\n    min-width: 0;\n}\n\n.lumiverse-pack-detail-title {\n    margin: 0;\n    font-size: 18px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-pack-detail-stats {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 12px;\n    margin-top: 6px;\n}\n\n.lumiverse-pack-detail-stats > span {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-pack-detail-stat {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-pack-detail-close {\n    width: 32px;\n    height: 32px;\n    border-radius: 50%;\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: all var(--lumiverse-transition-fast);\n    flex-shrink: 0;\n}\n\n.lumiverse-pack-detail-close:hover {\n    background: var(--lumiverse-bg-hover);\n    color: var(--lumiverse-text);\n}\n\n/* Content */\n.lumiverse-pack-detail-content {\n    flex: 1;\n    overflow-y: auto;\n    padding: 16px 20px;\n}\n\n/* Empty state */\n.lumiverse-pack-detail-empty {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    padding: 48px 20px;\n    text-align: center;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-pack-detail-empty svg {\n    opacity: 0.4;\n    margin-bottom: 12px;\n}\n\n.lumiverse-pack-detail-empty p {\n    margin: 0;\n    font-size: 14px;\n}\n\n/* Lumia list */\n.lumiverse-pack-detail-list {\n    display: flex;\n    flex-direction: column;\n    gap: 12px;\n}\n\n/* Lumia card */\n.lumiverse-pack-detail-lumia {\n    background: var(--lumiverse-bg-elevated);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    padding: 14px;\n    transition: border-color var(--lumiverse-transition-fast);\n}\n\n.lumiverse-pack-detail-lumia:hover {\n    border-color: var(--lumiverse-border-hover);\n}\n\n/* Lumia header */\n.lumiverse-pack-detail-lumia-header {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n    margin-bottom: 12px;\n}\n\n.lumiverse-pack-detail-lumia-avatar {\n    width: 44px;\n    height: 44px;\n    border-radius: var(--lumiverse-radius-sm);\n    background: var(--lumiverse-bg-dark);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    flex-shrink: 0;\n    overflow: hidden;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-pack-detail-lumia-avatar img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n}\n\n.lumiverse-pack-detail-lumia-info {\n    flex: 1;\n    min-width: 0;\n}\n\n.lumiverse-pack-detail-lumia-name {\n    margin: 0;\n    font-size: 15px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-pack-detail-lumia-author {\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n}\n\n/* Traits container */\n.lumiverse-pack-detail-traits {\n    display: flex;\n    flex-direction: column;\n    gap: 6px;\n    margin-bottom: 12px;\n}\n\n/* Trait preview */\n.lumiverse-pack-detail-trait {\n    background: var(--lumiverse-bg-dark);\n    border-radius: var(--lumiverse-radius-sm);\n    overflow: hidden;\n}\n\n.lumiverse-pack-detail-trait-header {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    width: 100%;\n    padding: 8px 12px;\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text);\n    cursor: pointer;\n    transition: background var(--lumiverse-transition-fast);\n    text-align: left;\n}\n\n.lumiverse-pack-detail-trait-header:hover {\n    background: rgba(255, 255, 255, 0.03);\n}\n\n.lumiverse-pack-detail-trait-header--open {\n    background: rgba(255, 255, 255, 0.02);\n}\n\n.lumiverse-pack-detail-trait-icon {\n    color: var(--lumiverse-text-muted);\n    display: flex;\n    align-items: center;\n}\n\n.lumiverse-pack-detail-trait-title {\n    flex: 1;\n    font-size: 13px;\n    font-weight: 500;\n}\n\n.lumiverse-pack-detail-trait-chevron {\n    color: var(--lumiverse-text-dim);\n    display: flex;\n    align-items: center;\n}\n\n.lumiverse-pack-detail-trait-content {\n    padding: 0 12px 12px;\n}\n\n.lumiverse-pack-detail-trait-content p {\n    margin: 0;\n    font-size: 12px;\n    line-height: 1.5;\n    color: var(--lumiverse-text-muted);\n    white-space: pre-wrap;\n    word-break: break-word;\n}\n\n/* Actions */\n.lumiverse-pack-detail-actions {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 8px;\n}\n\n.lumiverse-pack-detail-action {\n    display: flex;\n    align-items: center;\n    gap: 5px;\n    padding: 6px 10px;\n    background: var(--lumiverse-primary-light);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius-sm);\n    color: var(--lumiverse-text);\n    font-size: 12px;\n    font-weight: 500;\n    cursor: pointer;\n    transition: all var(--lumiverse-transition-fast);\n}\n\n.lumiverse-pack-detail-action:hover:not(:disabled) {\n    background: var(--lumiverse-primary);\n    border-color: var(--lumiverse-primary);\n    color: white;\n}\n\n.lumiverse-pack-detail-action:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n}\n\n.lumiverse-pack-detail-action--selected {\n    background: var(--lumiverse-success);\n    border-color: var(--lumiverse-success);\n    color: white;\n    cursor: default;\n}\n\n.lumiverse-pack-detail-action--selected:hover {\n    background: var(--lumiverse-success);\n    border-color: var(--lumiverse-success);\n}\n\n.lumiverse-pack-detail-action--enable-all {\n    background: transparent;\n    border-style: dashed;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-pack-detail-action--enable-all:hover {\n    background: var(--lumiverse-bg-hover);\n    border-color: var(--lumiverse-border-hover);\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-pack-detail-action--enable-all.all-enabled {\n    background: rgba(76, 175, 80, 0.15);\n    border-color: rgba(76, 175, 80, 0.6);\n    border-style: solid;\n    color: rgba(76, 175, 80, 1);\n}\n\n.lumiverse-pack-detail-action--enable-all.all-enabled:hover {\n    background: rgba(76, 175, 80, 0.25);\n    border-color: rgba(76, 175, 80, 0.8);\n}\n\n/* Pack browser - View button */\n.lumiverse-browser-pack-view-btn {\n    width: 28px;\n    height: 28px;\n    border-radius: var(--lumiverse-radius-sm);\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text-dim);\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: all var(--lumiverse-transition-fast);\n    flex-shrink: 0;\n    margin-left: auto;\n    margin-right: 8px;\n}\n\n.lumiverse-browser-pack-view-btn:hover {\n    background: var(--lumiverse-bg-hover);\n    color: var(--lumiverse-primary);\n}\n\n/* Downloaded Packs Section in Settings */\n.lumia-downloaded-packs {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumia-downloaded-pack-item {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n    padding: 10px 12px;\n    background: var(--lumiverse-bg-dark);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    transition: border-color var(--lumiverse-transition-fast);\n}\n\n.lumia-downloaded-pack-item:hover {\n    border-color: var(--lumiverse-border-hover);\n}\n\n.lumia-downloaded-pack-cover {\n    width: 36px;\n    height: 36px;\n    border-radius: var(--lumiverse-radius-sm);\n    object-fit: cover;\n    flex-shrink: 0;\n    animation: lumiverseFadeIn 0.2s ease;\n}\n\n.lumia-downloaded-pack-cover-placeholder {\n    width: 36px;\n    height: 36px;\n    border-radius: var(--lumiverse-radius-sm);\n    background: var(--lumiverse-bg-darker);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    flex-shrink: 0;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumia-downloaded-pack-cover-placeholder svg {\n    width: 18px;\n    height: 18px;\n}\n\n.lumia-downloaded-pack-info {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n    min-width: 0;\n}\n\n.lumia-downloaded-pack-name {\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumia-downloaded-pack-count {\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n}\n\n/* Downloaded Pack Actions */\n.lumia-downloaded-pack-actions {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    flex-shrink: 0;\n}\n\n/* Danger Icon Button */\n.lumia-btn-icon-danger {\n    color: var(--lumiverse-danger);\n    opacity: 0.6;\n}\n\n.lumia-btn-icon-danger:hover {\n    opacity: 1;\n    background: rgba(239, 68, 68, 0.15);\n}\n\n/* Loom Pack Detail Modal Additions */\n.lumiverse-loom-detail-modal {\n    /* Uses same base styles as pack detail modal */\n}\n\n.lumiverse-loom-detail-categories {\n    display: flex;\n    flex-direction: column;\n    gap: 16px;\n}\n\n/* Category section */\n.lumiverse-loom-detail-category {\n    background: var(--lumiverse-bg-elevated);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    overflow: hidden;\n}\n\n.lumiverse-loom-detail-category-header {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    width: 100%;\n    padding: 12px 14px;\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text);\n    cursor: pointer;\n    transition: background var(--lumiverse-transition-fast);\n    text-align: left;\n}\n\n.lumiverse-loom-detail-category-header:hover {\n    background: rgba(255, 255, 255, 0.03);\n}\n\n.lumiverse-loom-detail-category-header--expanded {\n    border-bottom: 1px solid var(--lumiverse-border);\n}\n\n.lumiverse-loom-detail-category-icon {\n    color: var(--lumiverse-primary);\n    display: flex;\n    align-items: center;\n}\n\n.lumiverse-loom-detail-category-title {\n    flex: 1;\n    font-size: 14px;\n    font-weight: 600;\n}\n\n.lumiverse-loom-detail-category-count {\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n    background: var(--lumiverse-bg-dark);\n    padding: 2px 8px;\n    border-radius: 10px;\n}\n\n.lumiverse-loom-detail-category-chevron {\n    color: var(--lumiverse-text-dim);\n    display: flex;\n    align-items: center;\n}\n\n.lumiverse-loom-detail-category-items {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n    padding: 12px;\n}\n\n/* Loom item card */\n.lumiverse-loom-detail-item {\n    padding: 10px 12px;\n    border: 1px solid;\n    border-radius: var(--lumiverse-radius-sm);\n    transition: all var(--lumiverse-transition-fast);\n}\n\n.lumiverse-loom-detail-item:hover {\n    transform: translateY(-1px);\n}\n\n.lumiverse-loom-detail-item-header {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n}\n\n.lumiverse-loom-detail-item-icon {\n    color: var(--lumiverse-text-muted);\n    display: flex;\n    align-items: center;\n}\n\n.lumiverse-loom-detail-item-name {\n    flex: 1;\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-loom-detail-item-toggle {\n    width: 24px;\n    height: 24px;\n    border-radius: 50%;\n    background: var(--lumiverse-bg-dark);\n    border: 1px solid var(--lumiverse-border);\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: all var(--lumiverse-transition-fast);\n}\n\n.lumiverse-loom-detail-item-toggle:hover {\n    background: var(--lumiverse-primary-light);\n    border-color: var(--lumiverse-primary);\n    color: var(--lumiverse-primary);\n}\n\n.lumiverse-loom-detail-item-toggle--selected {\n    background: var(--lumiverse-success);\n    border-color: var(--lumiverse-success);\n    color: white;\n}\n\n.lumiverse-loom-detail-item-toggle--selected:hover {\n    background: var(--lumiverse-danger);\n    border-color: var(--lumiverse-danger);\n}\n\n/* Content preview */\n.lumiverse-loom-detail-content-preview {\n    margin-top: 8px;\n}\n\n.lumiverse-loom-detail-content-toggle {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    padding: 4px 8px;\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text-dim);\n    font-size: 11px;\n    cursor: pointer;\n    transition: color var(--lumiverse-transition-fast);\n}\n\n.lumiverse-loom-detail-content-toggle:hover {\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-loom-detail-content-toggle--open {\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-loom-detail-content-chevron {\n    display: flex;\n    align-items: center;\n}\n\n.lumiverse-loom-detail-content-text {\n    padding: 8px 12px;\n    background: rgba(0, 0, 0, 0.15);\n    border-radius: var(--lumiverse-radius-sm);\n    margin-top: 6px;\n}\n\n.lumiverse-loom-detail-content-text p {\n    margin: 0;\n    font-size: 12px;\n    line-height: 1.5;\n    color: var(--lumiverse-text-muted);\n    white-space: pre-wrap;\n    word-break: break-word;\n}\n\n/* Loom Packs Section in Settings */\n.lumia-loom-packs {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumia-loom-pack-item {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n    padding: 10px 12px;\n    background: var(--lumiverse-bg-dark);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    transition: border-color var(--lumiverse-transition-fast);\n}\n\n.lumia-loom-pack-item:hover {\n    border-color: var(--lumiverse-border-hover);\n}\n\n.lumia-loom-pack-cover {\n    width: 36px;\n    height: 36px;\n    border-radius: var(--lumiverse-radius-sm);\n    object-fit: cover;\n    flex-shrink: 0;\n    animation: lumiverseFadeIn 0.2s ease;\n}\n\n.lumia-loom-pack-cover-placeholder {\n    width: 36px;\n    height: 36px;\n    border-radius: var(--lumiverse-radius-sm);\n    background: var(--lumiverse-bg-darker);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    flex-shrink: 0;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumia-loom-pack-cover-placeholder svg {\n    width: 18px;\n    height: 18px;\n}\n\n.lumia-loom-pack-info {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n    min-width: 0;\n}\n\n.lumia-loom-pack-name {\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumia-loom-pack-stats {\n    display: flex;\n    gap: 10px;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumia-loom-pack-stats span {\n    display: flex;\n    align-items: center;\n    gap: 3px;\n}\n\n/* Loom Pack Actions */\n.lumia-loom-pack-actions {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    flex-shrink: 0;\n}\n\n/* Mobile responsive */\n@media (max-width: 600px) {\n    .lumiverse-pack-detail-modal {\n        /* Override max-width for mobile */\n        max-width: 94vw;\n    }\n\n    .lumiverse-pack-detail-header {\n        padding: 14px 16px;\n    }\n\n    .lumiverse-pack-detail-header-icon {\n        width: 40px;\n        height: 40px;\n    }\n\n    .lumiverse-pack-detail-title {\n        font-size: 16px;\n    }\n\n    .lumiverse-pack-detail-content {\n        padding: 14px 16px;\n    }\n\n    .lumiverse-pack-detail-lumia {\n        padding: 12px;\n    }\n\n    .lumiverse-pack-detail-lumia-avatar {\n        width: 38px;\n        height: 38px;\n    }\n\n    .lumiverse-pack-detail-lumia-name {\n        font-size: 14px;\n    }\n\n    .lumiverse-pack-detail-actions {\n        gap: 6px;\n    }\n\n    .lumiverse-pack-detail-action {\n        padding: 8px 12px;\n        font-size: 13px;\n    }\n}\n\n\n/* ========================================\n   CHAT PRESETS PANEL & MODAL\n   Download presets from Lucid.cards + Reasoning/CoT settings\n   Modal-based design matching Lumia selection modal aesthetic\n   ======================================== */\n\n/* ============================================\n   UPDATE NOTIFICATION BANNERS\n   ============================================ */\n\n.lumiverse-presets-updates {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n    margin-bottom: 12px;\n}\n\n.lumiverse-presets-update-banner {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 10px 12px;\n    background: linear-gradient(135deg, rgba(34, 197, 94, 0.12), rgba(22, 163, 74, 0.08));\n    border: 1px solid rgba(34, 197, 94, 0.25);\n    border-radius: 10px;\n    animation: lumiverse-update-pulse 2s ease-in-out infinite;\n}\n\n@keyframes lumiverse-update-pulse {\n    0%, 100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.1); }\n    50% { box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.05); }\n}\n\n.lumiverse-presets-update-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 28px;\n    height: 28px;\n    background: rgba(34, 197, 94, 0.15);\n    border-radius: 7px;\n    color: rgba(34, 197, 94, 0.9);\n    flex-shrink: 0;\n}\n\n.lumiverse-presets-update-text {\n    flex: 1;\n    min-width: 0;\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n}\n\n.lumiverse-presets-update-title {\n    font-size: 12px;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-presets-update-version {\n    font-size: 10px;\n    color: rgba(34, 197, 94, 0.85);\n    font-family: var(--lumiverse-font-mono);\n}\n\n.lumiverse-presets-update-actions {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    flex-shrink: 0;\n}\n\n.lumiverse-presets-update-btn {\n    padding: 5px 12px;\n    background: rgba(34, 197, 94, 0.2);\n    border: 1px solid rgba(34, 197, 94, 0.35);\n    border-radius: 6px;\n    color: rgba(34, 197, 94, 0.95);\n    font-size: 11px;\n    font-weight: 600;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-presets-update-btn:hover {\n    background: rgba(34, 197, 94, 0.3);\n    border-color: rgba(34, 197, 94, 0.5);\n}\n\n.lumiverse-presets-update-dismiss {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 22px;\n    height: 22px;\n    background: transparent;\n    border: none;\n    border-radius: 4px;\n    color: var(--lumiverse-text-dim);\n    cursor: pointer;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-presets-update-dismiss:hover {\n    background: rgba(255, 255, 255, 0.05);\n    color: var(--lumiverse-text-muted);\n}\n\n/* ============================================\n   INVENTORY (Imported Presets in Settings Panel)\n   ============================================ */\n\n.lumiverse-presets-inventory {\n    margin-bottom: 14px;\n}\n\n.lumiverse-presets-inventory-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    margin-bottom: 10px;\n    padding-bottom: 8px;\n    border-bottom: 1px solid rgba(147, 112, 219, 0.1);\n}\n\n.lumiverse-presets-inventory-label {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    font-size: 11px;\n    font-weight: 600;\n    color: var(--lumiverse-text-muted);\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n.lumiverse-presets-inventory-label svg {\n    color: rgba(147, 112, 219, 0.7);\n}\n\n.lumiverse-presets-inventory-updates {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    padding: 3px 8px;\n    background: rgba(34, 197, 94, 0.12);\n    border: 1px solid rgba(34, 197, 94, 0.25);\n    border-radius: 10px;\n    font-size: 10px;\n    font-weight: 600;\n    color: rgba(34, 197, 94, 0.95);\n}\n\n.lumiverse-presets-inventory-list {\n    display: flex;\n    flex-direction: column;\n    gap: 6px;\n}\n\n.lumiverse-presets-inventory-item {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 10px 12px;\n    background: rgba(0, 0, 0, 0.15);\n    border: 1px solid rgba(128, 128, 128, 0.1);\n    border-radius: 10px;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-presets-inventory-item:hover {\n    background: rgba(0, 0, 0, 0.2);\n    border-color: rgba(147, 112, 219, 0.15);\n}\n\n.lumiverse-presets-inventory-item.has-update {\n    background: linear-gradient(135deg, rgba(34, 197, 94, 0.08), rgba(22, 163, 74, 0.04));\n    border-color: rgba(34, 197, 94, 0.2);\n}\n\n.lumiverse-presets-inventory-item-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 28px;\n    height: 28px;\n    background: rgba(147, 112, 219, 0.12);\n    border: 1px solid rgba(147, 112, 219, 0.2);\n    border-radius: 7px;\n    color: rgba(147, 112, 219, 0.8);\n    flex-shrink: 0;\n}\n\n.lumiverse-presets-inventory-item.has-update .lumiverse-presets-inventory-item-icon {\n    background: rgba(34, 197, 94, 0.12);\n    border-color: rgba(34, 197, 94, 0.25);\n    color: rgba(34, 197, 94, 0.9);\n}\n\n.lumiverse-presets-inventory-item-info {\n    flex: 1;\n    min-width: 0;\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n}\n\n.lumiverse-presets-inventory-item-name {\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-presets-inventory-item-version {\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n    font-family: var(--lumiverse-font-mono);\n}\n\n.lumiverse-presets-inventory-item.has-update .lumiverse-presets-inventory-item-version {\n    color: rgba(34, 197, 94, 0.85);\n}\n\n.lumiverse-presets-inventory-item-badge {\n    padding: 3px 8px;\n    background: rgba(34, 197, 94, 0.15);\n    border: 1px solid rgba(34, 197, 94, 0.3);\n    border-radius: 6px;\n    font-size: 10px;\n    font-weight: 600;\n    color: rgba(34, 197, 94, 0.95);\n    flex-shrink: 0;\n}\n\n/* Empty State */\n.lumiverse-presets-empty-state {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    gap: 8px;\n    padding: 24px 16px;\n    margin-bottom: 14px;\n    background: rgba(0, 0, 0, 0.1);\n    border: 1px dashed rgba(128, 128, 128, 0.2);\n    border-radius: 12px;\n    color: var(--lumiverse-text-dim);\n}\n\n.lumiverse-presets-empty-state svg {\n    color: rgba(147, 112, 219, 0.4);\n}\n\n.lumiverse-presets-empty-state span {\n    font-size: 12px;\n}\n\n/* Reasoning Quick Status */\n.lumiverse-presets-reasoning-status {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 8px;\n    margin-bottom: 12px;\n}\n\n.lumiverse-presets-reasoning-status-item {\n    display: flex;\n    align-items: center;\n    gap: 5px;\n    padding: 6px 10px;\n    background: rgba(147, 112, 219, 0.08);\n    border: 1px solid rgba(147, 112, 219, 0.15);\n    border-radius: 8px;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-presets-reasoning-status-item svg {\n    color: rgba(147, 112, 219, 0.7);\n    flex-shrink: 0;\n}\n\n.lumiverse-presets-reasoning-status-item code {\n    padding: 2px 5px;\n    background: rgba(0, 0, 0, 0.25);\n    border-radius: 4px;\n    font-size: 10px;\n    font-family: var(--lumiverse-font-mono);\n    color: rgba(186, 135, 255, 0.9);\n}\n\n/* ============================================\n   MODAL CONTAINER\n   ============================================ */\n\n.lumiverse-presets-modal {\n    width: 90vw;\n    max-width: 560px;\n    max-height: 85vh;\n    max-height: 85dvh;\n    height: auto;\n    min-height: 0;\n    display: flex;\n    flex-direction: column;\n    background: var(--lumiverse-bg);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 16px;\n    box-shadow: 0 16px 48px rgba(0, 0, 0, 0.4);\n    overflow: hidden;\n}\n\n/* Mobile-friendly sizing */\n@media (max-width: 480px) {\n    .lumiverse-presets-modal {\n        width: 95vw;\n        max-height: 90dvh;\n        border-radius: 16px;\n    }\n}\n\n/* Modal header */\n.lumiverse-presets-modal-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 16px 20px;\n    background: transparent;\n    border-bottom: 1px solid var(--lumiverse-border);\n    flex-shrink: 0;\n}\n\n.lumiverse-presets-modal-header-info {\n    display: flex;\n    align-items: center;\n    gap: 14px;\n}\n\n.lumiverse-presets-modal-header-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 40px;\n    height: 40px;\n    background: linear-gradient(135deg, rgba(147, 112, 219, 0.2), rgba(147, 112, 219, 0.1));\n    border-radius: 10px;\n    color: var(--lumiverse-primary);\n}\n\n.lumiverse-presets-modal-header-text {\n    display: flex;\n    flex-direction: column;\n    gap: 3px;\n}\n\n.lumiverse-presets-modal-title {\n    margin: 0;\n    font-size: 17px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    letter-spacing: -0.02em;\n}\n\n.lumiverse-presets-modal-subtitle {\n    margin: 0;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-presets-modal-close {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 34px;\n    height: 34px;\n    border: 1px solid rgba(128, 128, 128, 0.15);\n    border-radius: 8px;\n    background: rgba(255, 255, 255, 0.03);\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-presets-modal-close:hover {\n    background: rgba(239, 68, 68, 0.15);\n    border-color: rgba(239, 68, 68, 0.3);\n    color: rgba(239, 68, 68, 0.95);\n}\n\n/* Modal content - scrollable container */\n.lumiverse-presets-modal-content {\n    flex: 1 1 auto;\n    min-height: 0;\n    overflow-y: auto;\n    overflow-x: hidden;\n    padding: 16px 20px;\n    display: flex;\n    flex-direction: column;\n    gap: 16px;\n}\n\n.lumiverse-presets-modal-content::-webkit-scrollbar {\n    width: 6px;\n}\n\n.lumiverse-presets-modal-content::-webkit-scrollbar-track {\n    background: rgba(0, 0, 0, 0.1);\n    border-radius: 3px;\n}\n\n.lumiverse-presets-modal-content::-webkit-scrollbar-thumb {\n    background: rgba(147, 112, 219, 0.3);\n    border-radius: 3px;\n}\n\n.lumiverse-presets-modal-content::-webkit-scrollbar-thumb:hover {\n    background: rgba(147, 112, 219, 0.5);\n}\n\n/* Modal footer */\n.lumiverse-presets-modal-footer {\n    display: flex;\n    align-items: center;\n    justify-content: flex-end;\n    padding: 14px 20px;\n    border-top: 1px solid var(--lumiverse-border);\n    background: transparent;\n    flex-shrink: 0;\n}\n\n.lumiverse-presets-modal-btn {\n    padding: 10px 24px;\n    border: 1px solid rgba(128, 128, 128, 0.2);\n    border-radius: 8px;\n    font-size: 13px;\n    font-weight: 500;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-presets-modal-btn--primary {\n    background: linear-gradient(135deg, rgba(147, 112, 219, 0.9), rgba(100, 149, 237, 0.8));\n    border-color: rgba(147, 112, 219, 0.5);\n    color: white;\n}\n\n.lumiverse-presets-modal-btn--primary:hover {\n    background: linear-gradient(135deg, rgba(147, 112, 219, 1), rgba(100, 149, 237, 0.9));\n    box-shadow: 0 4px 12px rgba(147, 112, 219, 0.3);\n    transform: translateY(-1px);\n}\n\n/* ============================================\n   SECTION CONTAINERS\n   ============================================ */\n\n.lumiverse-presets-section {\n    background: rgba(38, 32, 52, 0.5);\n    border: 1px solid rgba(128, 128, 128, 0.1);\n    border-radius: 14px;\n    overflow: hidden;\n    flex-shrink: 0; /* Prevent sections from shrinking when content expands */\n}\n\n.lumiverse-presets-section-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 12px 14px;\n    background: rgba(0, 0, 0, 0.15);\n    border-bottom: 1px solid rgba(128, 128, 128, 0.08);\n}\n\n.lumiverse-presets-section-title {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    font-size: 12px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n.lumiverse-presets-section-title svg {\n    color: rgba(147, 112, 219, 0.8);\n}\n\n/* Refresh button */\n.lumiverse-presets-refresh {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 28px;\n    height: 28px;\n    border: 1px solid rgba(147, 112, 219, 0.2);\n    border-radius: 6px;\n    background: rgba(147, 112, 219, 0.08);\n    color: rgba(147, 112, 219, 0.8);\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-presets-refresh:hover:not(:disabled) {\n    background: rgba(147, 112, 219, 0.18);\n    border-color: rgba(147, 112, 219, 0.35);\n    color: rgba(147, 112, 219, 1);\n}\n\n.lumiverse-presets-refresh:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n}\n\n.lumiverse-presets-refresh.is-loading svg {\n    animation: lumiverse-spin 0.8s linear infinite;\n}\n\n/* ============================================\n   EMPTY / LOADING / ERROR STATES\n   ============================================ */\n\n.lumiverse-presets-empty {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    gap: 12px;\n    padding: 32px 20px;\n}\n\n.lumiverse-presets-empty-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 56px;\n    height: 56px;\n    background: linear-gradient(135deg, rgba(147, 112, 219, 0.1), rgba(100, 149, 237, 0.08));\n    border: 1px dashed rgba(147, 112, 219, 0.25);\n    border-radius: 14px;\n    color: rgba(147, 112, 219, 0.5);\n}\n\n.lumiverse-presets-empty-text {\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n    text-align: center;\n}\n\n.lumiverse-presets-empty-btn {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    padding: 9px 18px;\n    background: linear-gradient(135deg, rgba(147, 112, 219, 0.2), rgba(100, 149, 237, 0.15));\n    border: 1px solid rgba(147, 112, 219, 0.3);\n    border-radius: 8px;\n    color: rgba(147, 112, 219, 0.95);\n    font-size: 12px;\n    font-weight: 500;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-presets-empty-btn:hover {\n    background: linear-gradient(135deg, rgba(147, 112, 219, 0.3), rgba(100, 149, 237, 0.25));\n    border-color: rgba(147, 112, 219, 0.5);\n    transform: translateY(-1px);\n}\n\n.lumiverse-presets-loading {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    gap: 12px;\n    padding: 32px 20px;\n    color: var(--lumiverse-text-muted);\n    font-size: 12px;\n}\n\n.lumiverse-presets-loading-spinner {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 44px;\n    height: 44px;\n    background: rgba(147, 112, 219, 0.1);\n    border-radius: 50%;\n    color: rgba(147, 112, 219, 0.8);\n}\n\n.lumiverse-presets-loading-spinner svg {\n    animation: lumiverse-spin 0.8s linear infinite;\n}\n\n.lumiverse-presets-error {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    gap: 10px;\n    padding: 28px 20px;\n    color: rgba(239, 68, 68, 0.9);\n    font-size: 12px;\n    text-align: center;\n}\n\n.lumiverse-presets-error button {\n    margin-top: 4px;\n    padding: 7px 14px;\n    border: 1px solid rgba(239, 68, 68, 0.4);\n    border-radius: 6px;\n    background: rgba(239, 68, 68, 0.15);\n    color: rgba(239, 68, 68, 0.95);\n    font-size: 11px;\n    font-weight: 500;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-presets-error button:hover {\n    background: rgba(239, 68, 68, 0.25);\n    border-color: rgba(239, 68, 68, 0.6);\n}\n\n/* ============================================\n   PRESET LIST & CARDS\n   ============================================ */\n\n.lumiverse-presets-list {\n    display: flex;\n    flex-direction: column;\n    gap: 6px;\n    padding: 10px;\n}\n\n/* Preset card - unified clickable container */\n.lumiverse-preset-card {\n    background: rgba(45, 38, 60, 0.6);\n    border: 1px solid rgba(128, 128, 128, 0.1);\n    border-radius: 10px;\n    overflow: hidden;\n    transition: border-color 0.2s ease, box-shadow 0.2s ease;\n    animation: lumiverse-preset-card-appear 0.25s ease-out backwards;\n    animation-delay: var(--card-delay, 0ms);\n    cursor: pointer;\n    outline: none;\n}\n\n.lumiverse-preset-card:focus-visible {\n    border-color: rgba(147, 112, 219, 0.5);\n    box-shadow: 0 0 0 2px rgba(147, 112, 219, 0.2);\n}\n\n@keyframes lumiverse-preset-card-appear {\n    from {\n        opacity: 0;\n        transform: translateY(8px);\n    }\n    to {\n        opacity: 1;\n        transform: translateY(0);\n    }\n}\n\n.lumiverse-preset-card:hover {\n    border-color: rgba(147, 112, 219, 0.25);\n}\n\n.lumiverse-preset-card.is-expanded {\n    border-color: rgba(100, 149, 237, 0.35);\n    box-shadow: 0 2px 12px rgba(0, 0, 0, 0.15);\n}\n\n.lumiverse-preset-card.has-update {\n    border-color: rgba(34, 197, 94, 0.3);\n    background: linear-gradient(135deg, rgba(34, 197, 94, 0.05), rgba(45, 38, 60, 0.6));\n}\n\n.lumiverse-preset-card.has-update:hover {\n    border-color: rgba(34, 197, 94, 0.45);\n}\n\n/* Card header - no longer a button, just a container */\n.lumiverse-preset-card-header {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    width: 100%;\n    padding: 10px 12px;\n    background: transparent;\n    text-align: left;\n    transition: background 0.15s ease;\n}\n\n.lumiverse-preset-card:hover .lumiverse-preset-card-header {\n    background: rgba(255, 255, 255, 0.02);\n}\n\n.lumiverse-preset-card-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 32px;\n    height: 32px;\n    background: linear-gradient(135deg, rgba(100, 149, 237, 0.15), rgba(147, 112, 219, 0.1));\n    border: 1px solid rgba(100, 149, 237, 0.2);\n    border-radius: 7px;\n    color: rgba(100, 149, 237, 0.85);\n    flex-shrink: 0;\n}\n\n.lumiverse-preset-card-icon.has-update {\n    background: linear-gradient(135deg, rgba(34, 197, 94, 0.2), rgba(22, 163, 74, 0.15));\n    border-color: rgba(34, 197, 94, 0.3);\n    color: rgba(34, 197, 94, 0.9);\n}\n\n.lumiverse-preset-card-info {\n    flex: 1;\n    min-width: 0;\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n}\n\n.lumiverse-preset-card-name {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    font-size: 12px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-preset-card-update-badge {\n    padding: 2px 5px;\n    background: rgba(34, 197, 94, 0.2);\n    border-radius: 4px;\n    font-size: 9px;\n    font-weight: 600;\n    color: rgba(34, 197, 94, 0.95);\n    text-transform: uppercase;\n    letter-spacing: 0.3px;\n    flex-shrink: 0;\n}\n\n.lumiverse-preset-card-meta {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    font-size: 10px;\n    color: var(--lumiverse-text-dim);\n}\n\n.lumiverse-preset-card-meta svg {\n    opacity: 0.6;\n}\n\n.lumiverse-preset-card-actions {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    flex-shrink: 0;\n}\n\n.lumiverse-preset-card-download {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 28px;\n    height: 28px;\n    border: 1px solid rgba(100, 149, 237, 0.25);\n    border-radius: 6px;\n    background: rgba(100, 149, 237, 0.12);\n    color: rgba(100, 149, 237, 0.85);\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-preset-card-download:hover:not(:disabled) {\n    background: rgba(100, 149, 237, 0.25);\n    border-color: rgba(100, 149, 237, 0.45);\n    color: rgba(100, 149, 237, 1);\n}\n\n.lumiverse-preset-card-download:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n}\n\n.lumiverse-preset-card-chevron {\n    color: var(--lumiverse-text-dim);\n    transition: transform 0.2s ease;\n}\n\n.lumiverse-preset-card.is-expanded .lumiverse-preset-card-chevron {\n    transform: rotate(90deg);\n    color: rgba(100, 149, 237, 0.8);\n}\n\n/* Version list - CSS grid collapse to avoid layout thrashing */\n.lumiverse-preset-card-versions {\n    display: grid;\n    grid-template-rows: 0fr;\n    transition: grid-template-rows 0.2s ease;\n}\n\n.lumiverse-preset-card-versions.is-expanded {\n    grid-template-rows: 1fr;\n}\n\n.lumiverse-preset-card-versions-inner {\n    overflow: hidden;\n    display: flex;\n    flex-direction: column;\n    gap: 4px;\n    padding: 0;\n    background: rgba(0, 0, 0, 0.12);\n    border-top: 1px solid transparent;\n}\n\n.lumiverse-preset-card-versions.is-expanded .lumiverse-preset-card-versions-inner {\n    padding: 8px 10px 10px;\n    border-top-color: rgba(100, 149, 237, 0.1);\n}\n\n/* Show more versions button */\n.lumiverse-preset-versions-showmore {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 6px;\n    width: 100%;\n    padding: 8px 10px;\n    margin-top: 2px;\n    border: 1px dashed rgba(147, 112, 219, 0.2);\n    border-radius: 6px;\n    background: rgba(147, 112, 219, 0.05);\n    color: var(--lumiverse-text-muted);\n    font-size: 11px;\n    font-weight: 500;\n    cursor: pointer;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-preset-versions-showmore:hover {\n    background: rgba(147, 112, 219, 0.12);\n    border-color: rgba(147, 112, 219, 0.35);\n    color: rgba(147, 112, 219, 0.95);\n}\n\n.lumiverse-preset-versions-showmore svg {\n    opacity: 0.7;\n}\n\n/* Version items */\n.lumiverse-preset-version {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 8px 10px;\n    background: rgba(38, 32, 52, 0.6);\n    border: 1px solid rgba(128, 128, 128, 0.08);\n    border-radius: 6px;\n    transition: background 0.15s ease, border-color 0.15s ease;\n}\n\n.lumiverse-preset-version:hover {\n    background: rgba(45, 38, 60, 0.8);\n    border-color: rgba(147, 112, 219, 0.15);\n}\n\n.lumiverse-preset-version.is-latest {\n    background: linear-gradient(135deg, rgba(100, 149, 237, 0.08), rgba(147, 112, 219, 0.05));\n    border-color: rgba(100, 149, 237, 0.15);\n}\n\n.lumiverse-preset-version.is-prolix {\n    background: linear-gradient(135deg, rgba(249, 115, 22, 0.08), rgba(234, 88, 12, 0.05));\n    border-color: rgba(249, 115, 22, 0.15);\n}\n\n.lumiverse-preset-version-info {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    flex: 1;\n    min-width: 0;\n}\n\n.lumiverse-preset-version-name {\n    font-size: 11px;\n    font-weight: 500;\n    color: var(--lumiverse-text-muted);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-preset-version-badges {\n    display: flex;\n    gap: 4px;\n    flex-shrink: 0;\n}\n\n.lumiverse-preset-version-badge {\n    padding: 2px 6px;\n    border-radius: 4px;\n    font-size: 9px;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.3px;\n}\n\n.lumiverse-preset-version-badge.is-latest {\n    background: linear-gradient(135deg, rgba(100, 149, 237, 0.25), rgba(147, 112, 219, 0.2));\n    color: rgba(100, 149, 237, 0.95);\n}\n\n.lumiverse-preset-version-badge.is-prolix {\n    background: rgba(249, 115, 22, 0.18);\n    color: rgba(249, 115, 22, 0.95);\n}\n\n.lumiverse-preset-version-download {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    padding: 5px 9px;\n    border: 1px solid rgba(147, 112, 219, 0.2);\n    border-radius: 5px;\n    background: rgba(147, 112, 219, 0.1);\n    color: rgba(147, 112, 219, 0.85);\n    font-size: 10px;\n    font-weight: 500;\n    cursor: pointer;\n    transition: all 0.15s ease;\n    flex-shrink: 0;\n}\n\n.lumiverse-preset-version-download:hover:not(:disabled) {\n    background: rgba(147, 112, 219, 0.2);\n    border-color: rgba(147, 112, 219, 0.4);\n    color: rgba(147, 112, 219, 1);\n}\n\n.lumiverse-preset-version-download:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n}\n\n/* ============================================\n   REASONING SECTION\n   ============================================ */\n\n.lumiverse-presets-reasoning {\n    padding: 14px;\n    display: flex;\n    flex-direction: column;\n    gap: 14px;\n}\n\n/* Quick presets */\n.lumiverse-presets-reasoning-quick {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumiverse-presets-reasoning-label {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    font-size: 10px;\n    font-weight: 600;\n    color: var(--lumiverse-text-dim);\n    text-transform: uppercase;\n    letter-spacing: 0.6px;\n}\n\n.lumiverse-presets-reasoning-label svg {\n    color: rgba(147, 112, 219, 0.7);\n}\n\n.lumiverse-presets-reasoning-btns {\n    display: flex;\n    gap: 6px;\n    flex-wrap: wrap;\n}\n\n.lumiverse-presets-reasoning-btn {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 3px;\n    padding: 9px 14px;\n    border: 1px solid rgba(128, 128, 128, 0.12);\n    border-radius: 8px;\n    background: rgba(38, 32, 52, 0.6);\n    cursor: pointer;\n    transition: all 0.2s ease;\n    flex: 1;\n    min-width: 80px;\n}\n\n.lumiverse-presets-reasoning-btn:hover {\n    transform: translateY(-1px);\n}\n\n.lumiverse-presets-reasoning-btn-label {\n    font-size: 11px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-presets-reasoning-btn code {\n    font-size: 9px;\n    font-family: var(--lumiverse-font-mono);\n    color: var(--lumiverse-text-dim);\n    opacity: 0.8;\n}\n\n/* DeepSeek variant */\n.lumiverse-presets-reasoning-btn--deepseek {\n    border-color: rgba(52, 152, 219, 0.2);\n    background: linear-gradient(135deg, rgba(52, 152, 219, 0.08), rgba(41, 128, 185, 0.05));\n}\n\n.lumiverse-presets-reasoning-btn--deepseek:hover {\n    border-color: rgba(52, 152, 219, 0.4);\n    background: linear-gradient(135deg, rgba(52, 152, 219, 0.15), rgba(41, 128, 185, 0.1));\n}\n\n.lumiverse-presets-reasoning-btn--deepseek .lumiverse-presets-reasoning-btn-label {\n    color: rgba(52, 152, 219, 0.95);\n}\n\n/* Claude variant */\n.lumiverse-presets-reasoning-btn--claude {\n    border-color: rgba(217, 119, 87, 0.2);\n    background: linear-gradient(135deg, rgba(217, 119, 87, 0.08), rgba(193, 95, 63, 0.05));\n}\n\n.lumiverse-presets-reasoning-btn--claude:hover {\n    border-color: rgba(217, 119, 87, 0.4);\n    background: linear-gradient(135deg, rgba(217, 119, 87, 0.15), rgba(193, 95, 63, 0.1));\n}\n\n.lumiverse-presets-reasoning-btn--claude .lumiverse-presets-reasoning-btn-label {\n    color: rgba(217, 119, 87, 0.95);\n}\n\n/* o1 variant */\n.lumiverse-presets-reasoning-btn--o1 {\n    border-color: rgba(16, 163, 127, 0.2);\n    background: linear-gradient(135deg, rgba(16, 163, 127, 0.08), rgba(13, 138, 107, 0.05));\n}\n\n.lumiverse-presets-reasoning-btn--o1:hover {\n    border-color: rgba(16, 163, 127, 0.4);\n    background: linear-gradient(135deg, rgba(16, 163, 127, 0.15), rgba(13, 138, 107, 0.1));\n}\n\n.lumiverse-presets-reasoning-btn--o1 .lumiverse-presets-reasoning-btn-label {\n    color: rgba(16, 163, 127, 0.95);\n}\n\n/* Current settings */\n.lumiverse-presets-reasoning-current {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n    padding: 10px 12px;\n    background: rgba(0, 0, 0, 0.15);\n    border: 1px solid rgba(128, 128, 128, 0.08);\n    border-radius: 8px;\n}\n\n.lumiverse-presets-reasoning-row {\n    display: flex;\n    align-items: center;\n}\n\n.lumiverse-presets-reasoning-checkbox {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    cursor: pointer;\n    font-size: 12px;\n    color: var(--lumiverse-text);\n    position: relative;\n}\n\n.lumiverse-presets-reasoning-checkbox input[type="checkbox"] {\n    position: absolute;\n    opacity: 0;\n    cursor: pointer;\n}\n\n.lumiverse-presets-reasoning-checkmark {\n    width: 16px;\n    height: 16px;\n    background: rgba(28, 24, 38, 0.8);\n    border: 1px solid rgba(147, 112, 219, 0.3);\n    border-radius: 4px;\n    transition: all 0.15s ease;\n    position: relative;\n    flex-shrink: 0;\n}\n\n.lumiverse-presets-reasoning-checkbox input:checked ~ .lumiverse-presets-reasoning-checkmark {\n    background: linear-gradient(135deg, rgba(147, 112, 219, 0.8), rgba(100, 149, 237, 0.7));\n    border-color: rgba(147, 112, 219, 0.6);\n}\n\n.lumiverse-presets-reasoning-checkmark::after {\n    content: '';\n    position: absolute;\n    left: 5px;\n    top: 2px;\n    width: 4px;\n    height: 8px;\n    border: solid white;\n    border-width: 0 2px 2px 0;\n    transform: rotate(45deg);\n    opacity: 0;\n    transition: opacity 0.15s ease;\n}\n\n.lumiverse-presets-reasoning-checkbox input:checked ~ .lumiverse-presets-reasoning-checkmark::after {\n    opacity: 1;\n}\n\n.lumiverse-presets-reasoning-tags {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-presets-reasoning-tags svg {\n    color: var(--lumiverse-text-dim);\n}\n\n.lumiverse-presets-reasoning-tags code {\n    padding: 2px 5px;\n    background: rgba(0, 0, 0, 0.2);\n    border-radius: 3px;\n    font-family: var(--lumiverse-font-mono);\n    font-size: 10px;\n    color: rgba(147, 112, 219, 0.9);\n}\n\n.lumiverse-presets-reasoning-tags-sep {\n    opacity: 0.4;\n}\n\n/* API Reasoning Settings (Include Reasoning & Effort) */\n.lumiverse-presets-api-reasoning {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n    padding-top: 12px;\n    margin-top: 4px;\n    border-top: 1px solid rgba(128, 128, 128, 0.1);\n}\n\n.lumiverse-presets-api-reasoning-controls {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    gap: 16px;\n    flex-wrap: wrap;\n}\n\n.lumiverse-presets-api-reasoning-effort {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n}\n\n.lumiverse-presets-api-reasoning-effort-label {\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-presets-api-reasoning-select {\n    padding: 6px 28px 6px 10px;\n    border: 1px solid rgba(128, 128, 128, 0.2);\n    border-radius: 6px;\n    background: rgba(28, 24, 38, 0.7);\n    color: var(--lumiverse-text);\n    font-size: 12px;\n    cursor: pointer;\n    transition: all 0.15s ease;\n    appearance: none;\n    background-image: url(${f});\n    background-repeat: no-repeat;\n    background-position: right 8px center;\n}\n\n.lumiverse-presets-api-reasoning-select:hover:not(:disabled) {\n    border-color: rgba(147, 112, 219, 0.4);\n}\n\n.lumiverse-presets-api-reasoning-select:focus {\n    outline: none;\n    border-color: rgba(147, 112, 219, 0.5);\n    box-shadow: 0 0 0 2px rgba(147, 112, 219, 0.1);\n}\n\n.lumiverse-presets-api-reasoning-select:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n}\n\n.lumiverse-presets-api-reasoning-select option {\n    background: rgb(38, 32, 52);\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-presets-api-reasoning-hint {\n    margin: 0;\n    font-size: 10px;\n    color: var(--lumiverse-text-dim);\n    font-style: italic;\n}\n\n/* Start Reply With */\n.lumiverse-presets-startreply {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumiverse-presets-startreply-label {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    font-size: 10px;\n    font-weight: 600;\n    color: var(--lumiverse-text-dim);\n    text-transform: uppercase;\n    letter-spacing: 0.6px;\n}\n\n.lumiverse-presets-startreply-label svg {\n    color: rgba(250, 204, 21, 0.7);\n}\n\n.lumiverse-presets-startreply-input-wrap {\n    position: relative;\n}\n\n.lumiverse-presets-startreply-input {\n    width: 100%;\n    padding: 10px 12px;\n    border: 1px solid rgba(128, 128, 128, 0.12);\n    border-radius: 8px;\n    background: rgba(28, 24, 38, 0.7);\n    color: var(--lumiverse-text);\n    font-family: var(--lumiverse-font-mono);\n    font-size: 12px;\n    resize: vertical;\n    min-height: 52px;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-presets-startreply-input:focus {\n    outline: none;\n    border-color: rgba(250, 204, 21, 0.35);\n    box-shadow: 0 0 0 2px rgba(250, 204, 21, 0.08);\n}\n\n.lumiverse-presets-startreply-input::placeholder {\n    color: var(--lumiverse-text-dim);\n}\n\n.lumiverse-presets-startreply-quick {\n    display: flex;\n    gap: 5px;\n    flex-wrap: wrap;\n}\n\n.lumiverse-presets-startreply-btn {\n    padding: 5px 10px;\n    border: 1px solid rgba(128, 128, 128, 0.12);\n    border-radius: 5px;\n    background: rgba(38, 32, 52, 0.5);\n    color: var(--lumiverse-text-muted);\n    font-family: var(--lumiverse-font-mono);\n    font-size: 10px;\n    cursor: pointer;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-presets-startreply-btn:hover {\n    background: rgba(147, 112, 219, 0.15);\n    border-color: rgba(147, 112, 219, 0.3);\n    color: rgba(147, 112, 219, 0.95);\n}\n\n.lumiverse-presets-startreply-btn--clear {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    padding: 5px 8px;\n    color: var(--lumiverse-text-dim);\n}\n\n.lumiverse-presets-startreply-btn--clear:hover {\n    background: rgba(239, 68, 68, 0.15);\n    border-color: rgba(239, 68, 68, 0.3);\n    color: rgba(239, 68, 68, 0.95);\n}\n\n/* Claude variant for Start Reply With (no newline) */\n.lumiverse-presets-startreply-btn--claude {\n    border-color: rgba(217, 119, 87, 0.15);\n    background: rgba(217, 119, 87, 0.08);\n}\n\n.lumiverse-presets-startreply-btn--claude:hover {\n    background: rgba(217, 119, 87, 0.18);\n    border-color: rgba(217, 119, 87, 0.35);\n    color: rgba(217, 119, 87, 0.95);\n}\n\n/* Disabled state when API Reasoning is enabled */\n.lumiverse-presets-startreply.is-disabled {\n    opacity: 0.6;\n    pointer-events: none;\n}\n\n.lumiverse-presets-startreply.is-disabled .lumiverse-presets-startreply-input {\n    background: rgba(28, 24, 38, 0.4);\n    cursor: not-allowed;\n}\n\n.lumiverse-presets-startreply.is-disabled .lumiverse-presets-startreply-btn {\n    cursor: not-allowed;\n    opacity: 0.5;\n}\n\n.lumiverse-presets-startreply-disabled-hint {\n    font-size: 9px;\n    font-weight: 400;\n    color: rgba(250, 204, 21, 0.6);\n    font-style: italic;\n    text-transform: none;\n    letter-spacing: 0;\n    margin-left: auto;\n}\n\n/* Compact mode for sidebar usage */\n.lumiverse-presets-reasoning--compact {\n    padding: 0;\n    margin: 0;\n}\n\n.lumiverse-presets-reasoning--compact .lumiverse-presets-reasoning-quick {\n    padding: 10px;\n    margin-bottom: 8px;\n}\n\n.lumiverse-presets-reasoning--compact .lumiverse-presets-reasoning-btns {\n    gap: 6px;\n}\n\n.lumiverse-presets-reasoning--compact .lumiverse-presets-reasoning-btn {\n    padding: 6px 10px;\n    font-size: 10px;\n}\n\n.lumiverse-presets-reasoning--compact .lumiverse-presets-reasoning-current {\n    padding: 8px 10px;\n}\n\n.lumiverse-presets-reasoning--compact .lumiverse-presets-api-reasoning {\n    padding: 10px;\n}\n\n.lumiverse-presets-reasoning--compact .lumiverse-presets-startreply {\n    padding: 10px;\n}\n\n.lumiverse-presets-reasoning--compact .lumiverse-presets-startreply-input {\n    min-height: 40px;\n}\n\n/* Prompt Post-Processing Section */\n.lumiverse-presets-postprocessing {\n    padding: 12px 16px;\n    background: linear-gradient(135deg, rgba(99, 102, 241, 0.08) 0%, rgba(139, 92, 246, 0.05) 100%);\n    border-top: 1px solid rgba(99, 102, 241, 0.15);\n}\n\n.lumiverse-presets-postprocessing-label {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    font-size: 11px;\n    font-weight: 600;\n    color: rgba(255, 255, 255, 0.85);\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    margin-bottom: 10px;\n}\n\n.lumiverse-presets-postprocessing-label svg {\n    color: rgba(139, 92, 246, 0.8);\n}\n\n.lumiverse-presets-postprocessing-select {\n    width: 100%;\n    padding: 8px 12px;\n    font-size: 12px;\n    font-family: inherit;\n    color: rgba(255, 255, 255, 0.9);\n    background: rgba(0, 0, 0, 0.3);\n    border: 1px solid rgba(99, 102, 241, 0.3);\n    border-radius: 6px;\n    cursor: pointer;\n    transition: all 0.15s ease;\n    appearance: none;\n    background-image: url(${h});\n    background-repeat: no-repeat;\n    background-position: right 10px center;\n    padding-right: 32px;\n}\n\n.lumiverse-presets-postprocessing-select:hover {\n    border-color: rgba(139, 92, 246, 0.5);\n    background-color: rgba(0, 0, 0, 0.4);\n}\n\n.lumiverse-presets-postprocessing-select:focus {\n    outline: none;\n    border-color: rgba(139, 92, 246, 0.7);\n    box-shadow: 0 0 0 2px rgba(139, 92, 246, 0.15);\n}\n\n.lumiverse-presets-postprocessing-select option {\n    background: #1e1e2e;\n    color: rgba(255, 255, 255, 0.9);\n    padding: 8px;\n}\n\n.lumiverse-presets-postprocessing-hint {\n    margin: 8px 0 0 0;\n    font-size: 10px;\n    color: rgba(255, 255, 255, 0.45);\n    line-height: 1.4;\n}\n\n/* Compact mode for post-processing */\n.lumiverse-presets-reasoning--compact .lumiverse-presets-postprocessing {\n    padding: 10px;\n}\n\n/* ========================================\n   Preset Editor Styles\n   ======================================== */\n\n.lumiverse-preset-editor {\n    width: 800px;\n    height: 80vh;\n    display: flex;\n    flex-direction: column;\n}\n\n.lumiverse-editor-content {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    overflow: hidden;\n    padding: 0;\n}\n\n.lumiverse-toolbar {\n    display: flex;\n    gap: 10px;\n    padding: 12px 16px;\n    background: var(--lumiverse-bg-elevated);\n    border-bottom: 1px solid var(--lumiverse-border);\n}\n\n.lumiverse-prompt-list {\n    flex: 1;\n    overflow-y: auto;\n    padding: 16px;\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumiverse-prompt-item {\n    display: flex;\n    align-items: flex-start;\n    padding: 10px;\n    background: var(--lumiverse-bg-elevated);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    gap: 12px;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-prompt-item:hover {\n    border-color: var(--lumiverse-border-hover);\n    background: var(--lumiverse-bg-hover);\n}\n\n.lumiverse-prompt-category {\n    background: rgba(147, 112, 219, 0.1);\n    border-color: rgba(147, 112, 219, 0.25);\n    margin-top: 16px;\n    margin-bottom: 4px;\n}\n\n.lumiverse-prompt-category .lumiverse-prompt-name {\n    font-size: 14px;\n    font-weight: 600;\n    color: var(--lumiverse-primary-text);\n}\n\n.lumiverse-prompt-drag-handle {\n    cursor: grab;\n    color: var(--lumiverse-text-muted);\n    padding-top: 2px;\n    /* Required for dnd-kit to handle pointer events properly */\n    touch-action: none;\n    user-select: none;\n    -webkit-user-select: none;\n}\n\n.lumiverse-prompt-drag-handle:active {\n    cursor: grabbing;\n}\n\n.lumiverse-prompt-content {\n    flex: 1;\n    min-width: 0;\n}\n\n.lumiverse-prompt-header {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    margin-bottom: 4px;\n}\n\n.lumiverse-prompt-name {\n    font-weight: 500;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-prompt-category-icon {\n    color: var(--lumiverse-primary);\n    display: flex;\n    align-items: center;\n}\n\n.lumiverse-prompt-preview {\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    font-family: var(--lumiverse-font-mono);\n}\n\n.lumiverse-prompt-badges {\n    display: flex;\n    gap: 4px;\n    margin-left: 8px;\n}\n\n.lumiverse-badge {\n    font-size: 10px;\n    padding: 2px 6px;\n    border-radius: 4px;\n    text-transform: uppercase;\n    font-weight: 600;\n}\n\n.lumiverse-badge-system {\n    background: rgba(147, 112, 219, 0.2);\n    color: var(--lumiverse-primary-text);\n}\n\n.lumiverse-badge-user {\n    background: rgba(59, 130, 246, 0.2);\n    color: #60a5fa;\n}\n\n.lumiverse-badge-assistant {\n    background: rgba(16, 185, 129, 0.2);\n    color: #34d399;\n}\n\n.lumiverse-prompt-actions {\n    display: flex;\n    gap: 6px;\n    align-items: center;\n}\n\n.lumiverse-icon-btn {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 28px;\n    height: 28px;\n    padding: 0;\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text-muted);\n    border-radius: 6px;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-icon-btn:hover {\n    background: rgba(255, 255, 255, 0.1);\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-prompt-disabled {\n    opacity: 0.5;\n    background: rgba(0, 0, 0, 0.2);\n}\n\n/* Edit Form Overlay */\n.lumiverse-edit-form {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background: var(--lumiverse-bg);\n    padding: 24px;\n    z-index: 10;\n    display: flex;\n    flex-direction: column;\n    gap: 16px;\n}\n\n.lumiverse-form-group {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumiverse-form-group label {\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-form-group input,\n.lumiverse-form-group select,\n.lumiverse-form-group textarea {\n    padding: 10px;\n    background: var(--lumiverse-bg-elevated);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    color: var(--lumiverse-text);\n    font-family: inherit;\n    font-size: 14px;\n}\n\n.lumiverse-form-group textarea {\n    font-family: var(--lumiverse-font-mono);\n    line-height: 1.5;\n    resize: none;\n    flex: 1;\n}\n\n.lumiverse-form-actions {\n    display: flex;\n    gap: 12px;\n    justify-content: flex-end;\n    margin-top: auto;\n}\n\n/* Select Dropdown */\n.lumiverse-select {\n    padding: 8px 12px;\n    background: var(--lumiverse-bg-elevated);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    color: var(--lumiverse-text);\n    font-size: 13px;\n    font-family: inherit;\n    cursor: pointer;\n    outline: none;\n    transition: all var(--lumiverse-transition);\n}\n\n.lumiverse-select:hover,\n.lumiverse-select:focus {\n    border-color: var(--lumiverse-primary);\n    background: var(--lumiverse-bg-hover);\n}\n\n.lumiverse-select option {\n    background: var(--lumiverse-bg-elevated);\n    color: var(--lumiverse-text);\n}\n\n/* ========================================\n   Preset Editor - Enhanced Button Styles\n   ======================================== */\n\n/* Base .lumiverse-btn inside preset-editor gets default styling */\n.lumiverse-preset-editor .lumiverse-btn {\n    background: rgba(75, 75, 95, 0.6);\n    border: 1px solid rgba(255, 255, 255, 0.12);\n    color: var(--lumiverse-text);\n    backdrop-filter: blur(8px);\n    -webkit-backdrop-filter: blur(8px);\n}\n\n.lumiverse-preset-editor .lumiverse-btn:hover {\n    background: rgba(95, 95, 115, 0.7);\n    border-color: rgba(147, 112, 219, 0.35);\n    transform: translateY(-1px);\n}\n\n/* Primary button in preset editor */\n.lumiverse-preset-editor .lumiverse-btn.lumiverse-btn-primary {\n    background: linear-gradient(\n        135deg,\n        rgba(147, 112, 219, 0.85) 0%,\n        rgba(123, 95, 196, 0.85) 100%\n    );\n    border: 1px solid rgba(147, 112, 219, 0.4);\n    color: #fff;\n    font-weight: 600;\n    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);\n}\n\n.lumiverse-preset-editor .lumiverse-btn.lumiverse-btn-primary:hover {\n    background: linear-gradient(\n        135deg,\n        rgba(167, 132, 239, 0.95) 0%,\n        rgba(143, 115, 216, 0.95) 100%\n    );\n    border-color: rgba(147, 112, 219, 0.6);\n    box-shadow: 0 4px 12px rgba(147, 112, 219, 0.3);\n}\n\n/* Danger button variant */\n.lumiverse-preset-editor .lumiverse-btn-danger,\n.lumiverse-preset-editor .lumiverse-icon-btn.lumiverse-btn-danger {\n    color: rgba(239, 100, 100, 0.9);\n}\n\n.lumiverse-preset-editor .lumiverse-btn-danger:hover,\n.lumiverse-preset-editor .lumiverse-icon-btn.lumiverse-btn-danger:hover {\n    background: rgba(239, 68, 68, 0.2);\n    color: #f87171;\n}\n\n/* Modal header styling */\n.lumiverse-preset-editor .lumiverse-modal-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 16px 20px;\n    border-bottom: 1px solid rgba(255, 255, 255, 0.08);\n    background: linear-gradient(\n        180deg,\n        rgba(45, 45, 65, 0.9) 0%,\n        rgba(35, 35, 50, 0.8) 100%\n    );\n}\n\n.lumiverse-preset-editor .lumiverse-modal-header h3 {\n    margin: 0;\n    font-size: 16px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n}\n\n/* Close button */\n.lumiverse-preset-editor .lumiverse-close-btn {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 32px;\n    height: 32px;\n    padding: 0;\n    background: rgba(255, 255, 255, 0.06);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    border-radius: 8px;\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-preset-editor .lumiverse-close-btn:hover {\n    background: rgba(239, 68, 68, 0.15);\n    border-color: rgba(239, 68, 68, 0.3);\n    color: #f87171;\n}\n\n/* Toolbar enhancements */\n.lumiverse-preset-editor .lumiverse-toolbar {\n    background: linear-gradient(\n        180deg,\n        rgba(35, 35, 50, 0.6) 0%,\n        rgba(30, 30, 45, 0.4) 100%\n    );\n    border-bottom: 1px solid rgba(255, 255, 255, 0.06);\n    padding: 12px 16px;\n}\n\n/* Edit form overlay enhancements */\n.lumiverse-preset-editor .lumiverse-edit-form {\n    background: linear-gradient(\n        180deg,\n        rgba(30, 30, 46, 0.98) 0%,\n        rgba(25, 25, 38, 0.98) 100%\n    );\n    border-radius: 0;\n}\n\n.lumiverse-preset-editor .lumiverse-edit-form h4 {\n    margin: 0 0 16px 0;\n    font-size: 16px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    padding-bottom: 12px;\n    border-bottom: 1px solid rgba(255, 255, 255, 0.08);\n}\n\n/* Form inputs enhanced */\n.lumiverse-preset-editor .lumiverse-form-group input,\n.lumiverse-preset-editor .lumiverse-form-group select,\n.lumiverse-preset-editor .lumiverse-form-group textarea {\n    background: rgba(20, 20, 35, 0.8);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    transition: all 0.2s ease;\n}\n\n.lumiverse-preset-editor .lumiverse-form-group input:focus,\n.lumiverse-preset-editor .lumiverse-form-group select:focus,\n.lumiverse-preset-editor .lumiverse-form-group textarea:focus {\n    outline: none;\n    border-color: rgba(147, 112, 219, 0.5);\n    box-shadow: 0 0 0 3px rgba(147, 112, 219, 0.15);\n}\n\n/* Prompt list container */\n.lumiverse-preset-editor .lumiverse-prompt-list {\n    background: rgba(20, 20, 35, 0.4);\n}\n\n/* Prompt items enhanced */\n.lumiverse-preset-editor .lumiverse-prompt-item {\n    background: rgba(45, 45, 65, 0.5);\n    border: 1px solid rgba(255, 255, 255, 0.08);\n    backdrop-filter: blur(4px);\n    -webkit-backdrop-filter: blur(4px);\n}\n\n.lumiverse-preset-editor .lumiverse-prompt-item:hover {\n    background: rgba(55, 55, 75, 0.6);\n    border-color: rgba(147, 112, 219, 0.25);\n}\n\n/* Dragging state */\n.lumiverse-preset-editor .lumiverse-prompt-item[style*="opacity: 0.5"] {\n    background: rgba(147, 112, 219, 0.15);\n    border-color: rgba(147, 112, 219, 0.4);\n}\n\n/* Icon buttons in prompt actions */\n.lumiverse-preset-editor .lumiverse-prompt-actions .lumiverse-icon-btn {\n    background: rgba(255, 255, 255, 0.04);\n    border: 1px solid transparent;\n}\n\n.lumiverse-preset-editor .lumiverse-prompt-actions .lumiverse-icon-btn:hover {\n    background: rgba(147, 112, 219, 0.2);\n    border-color: rgba(147, 112, 219, 0.3);\n    color: var(--lumiverse-primary-text);\n}\n\n/* Category toggle button */\n.lumiverse-preset-editor .lumiverse-prompt-category .lumiverse-icon-btn {\n    color: var(--lumiverse-primary-text);\n}\n\n/* Empty state */\n.lumiverse-preset-editor .lumiverse-empty-state {\n    color: var(--lumiverse-text-muted);\n    font-style: italic;\n}\n\n/* Drag overlay item */\n.lumiverse-prompt-dragging {\n    display: flex;\n    align-items: flex-start;\n    padding: 10px;\n    background: rgba(147, 112, 219, 0.25);\n    border: 2px solid rgba(147, 112, 219, 0.6);\n    border-radius: var(--lumiverse-radius);\n    gap: 12px;\n    box-shadow: \n        0 8px 32px rgba(0, 0, 0, 0.4),\n        0 0 0 1px rgba(147, 112, 219, 0.3);\n    cursor: grabbing;\n    transform: scale(1.02);\n}\n\n.lumiverse-prompt-dragging .lumiverse-prompt-drag-handle {\n    color: var(--lumiverse-primary-text);\n    cursor: grabbing;\n}\n\n.lumiverse-prompt-dragging .lumiverse-prompt-name {\n    font-weight: 500;\n    color: var(--lumiverse-text);\n}\n\n/* ========================================\n   Toggle State Menu Styles\n   ======================================== */\n\n/* Accent button (when states exist) */\n.lumiverse-preset-editor .lumiverse-btn.lumiverse-btn-accent {\n    background: rgba(147, 112, 219, 0.25);\n    border-color: rgba(147, 112, 219, 0.4);\n    color: var(--lumiverse-primary-text);\n}\n\n.lumiverse-preset-editor .lumiverse-btn.lumiverse-btn-accent:hover {\n    background: rgba(147, 112, 219, 0.35);\n    border-color: rgba(147, 112, 219, 0.6);\n}\n\n/* Toggle states container */\n.lumiverse-toggle-states {\n    position: relative;\n}\n\n/* Toggle state dropdown menu */\n.lumiverse-toggle-state-menu {\n    position: absolute;\n    top: calc(100% + 8px);\n    left: 0;\n    z-index: 100;\n    min-width: 280px;\n    background: linear-gradient(\n        180deg,\n        rgba(35, 35, 52, 0.98) 0%,\n        rgba(28, 28, 42, 0.98) 100%\n    );\n    border: 1px solid rgba(255, 255, 255, 0.12);\n    border-radius: var(--lumiverse-radius);\n    box-shadow: \n        0 8px 32px rgba(0, 0, 0, 0.4),\n        0 0 0 1px rgba(147, 112, 219, 0.1);\n    backdrop-filter: blur(12px);\n    -webkit-backdrop-filter: blur(12px);\n    overflow: hidden;\n}\n\n/* Save section */\n.lumiverse-toggle-state-save {\n    display: flex;\n    gap: 8px;\n    padding: 12px;\n    border-bottom: 1px solid rgba(255, 255, 255, 0.08);\n}\n\n.lumiverse-toggle-state-save input {\n    flex: 1;\n    padding: 8px 12px;\n    background: rgba(20, 20, 35, 0.8);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    border-radius: var(--lumiverse-radius-sm);\n    color: var(--lumiverse-text);\n    font-size: 13px;\n    outline: none;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-toggle-state-save input:focus {\n    border-color: rgba(147, 112, 219, 0.5);\n    box-shadow: 0 0 0 2px rgba(147, 112, 219, 0.15);\n}\n\n.lumiverse-toggle-state-save input::placeholder {\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-toggle-state-save .lumiverse-btn {\n    padding: 8px 12px;\n    min-width: auto;\n}\n\n/* Divider */\n.lumiverse-toggle-state-divider {\n    padding: 8px 12px 6px;\n    font-size: 11px;\n    font-weight: 600;\n    color: var(--lumiverse-text-muted);\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n/* State list */\n.lumiverse-toggle-state-list {\n    max-height: 200px;\n    overflow-y: auto;\n}\n\n/* Individual state item */\n.lumiverse-toggle-state-item {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    gap: 8px;\n    padding: 10px 12px;\n    cursor: pointer;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-toggle-state-item:hover {\n    background: rgba(147, 112, 219, 0.15);\n}\n\n.lumiverse-toggle-state-item span {\n    flex: 1;\n    font-size: 13px;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-toggle-state-item .lumiverse-icon-btn {\n    opacity: 0.5;\n    padding: 4px;\n}\n\n.lumiverse-toggle-state-item:hover .lumiverse-icon-btn {\n    opacity: 1;\n}\n\n/* Empty state */\n.lumiverse-toggle-state-empty {\n    padding: 16px 12px;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n    text-align: center;\n    font-style: italic;\n    line-height: 1.5;\n}\n\n/* Toggle message (success/error feedback) */\n.lumiverse-toggle-message {\n    padding: 6px 12px;\n    font-size: 12px;\n    font-weight: 500;\n    border-radius: var(--lumiverse-radius-sm);\n    animation: fadeIn 0.2s ease;\n}\n\n.lumiverse-toggle-message-success {\n    background: rgba(34, 197, 94, 0.2);\n    color: #4ade80;\n    border: 1px solid rgba(34, 197, 94, 0.3);\n}\n\n.lumiverse-toggle-message-error {\n    background: rgba(239, 68, 68, 0.2);\n    color: #f87171;\n    border: 1px solid rgba(239, 68, 68, 0.3);\n}\n\n@keyframes fadeIn {\n    from { opacity: 0; transform: translateY(-4px); }\n    to { opacity: 1; transform: translateY(0); }\n}\n\n\n/* ----------------------------------------\n   Update Notification System\n   ---------------------------------------- */\n\n/* Update Banner - warm amber/orange with purple accents */\n.lumiverse-update-banner {\n    background: linear-gradient(135deg, rgba(251, 191, 36, 0.15) 0%, rgba(245, 158, 11, 0.2) 50%, rgba(147, 112, 219, 0.1) 100%);\n    border: 1px solid rgba(251, 191, 36, 0.4);\n    border-radius: var(--lumiverse-radius);\n    padding: 12px 16px;\n    margin-bottom: 12px;\n    animation: updateBannerSlideIn 0.3s ease-out;\n}\n\n.lumiverse-update-banner.has-extension-update {\n    border-color: rgba(251, 191, 36, 0.6);\n    box-shadow: 0 0 20px rgba(251, 191, 36, 0.15);\n}\n\n@keyframes updateBannerSlideIn {\n    from {\n        opacity: 0;\n        transform: translateY(-10px);\n    }\n    to {\n        opacity: 1;\n        transform: translateY(0);\n    }\n}\n\n.lumiverse-update-banner-content {\n    display: flex;\n    align-items: flex-start;\n    gap: 12px;\n}\n\n.lumiverse-update-banner-icon {\n    color: #fbbf24;\n    flex-shrink: 0;\n    margin-top: 2px;\n    animation: updatePulse 2s ease-in-out infinite;\n}\n\n@keyframes updatePulse {\n    0%, 100% { opacity: 1; }\n    50% { opacity: 0.6; }\n}\n\n.lumiverse-update-banner-text {\n    flex: 1;\n    min-width: 0;\n}\n\n.lumiverse-update-banner-main {\n    display: flex;\n    flex-wrap: wrap;\n    align-items: center;\n    gap: 8px;\n    font-size: 13px;\n    color: #fcd34d;\n    font-weight: 500;\n}\n\n.lumiverse-update-banner-main strong {\n    color: #fef08a;\n}\n\n.lumiverse-update-banner-link {\n    display: inline-flex;\n    align-items: center;\n    gap: 4px;\n    color: #a78bfa;\n    font-size: 12px;\n    font-weight: 600;\n    text-decoration: none;\n    transition: color 0.2s ease;\n}\n\n.lumiverse-update-banner-link:hover {\n    color: #c4b5fd;\n    text-decoration: underline;\n}\n\n.lumiverse-update-banner-presets {\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n    margin-top: 4px;\n}\n\n.lumiverse-update-banner-dismiss {\n    padding: 4px;\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    border-radius: 4px;\n    transition: all 0.2s ease;\n    flex-shrink: 0;\n}\n\n.lumiverse-update-banner-dismiss:hover {\n    background: rgba(255, 255, 255, 0.1);\n    color: var(--lumiverse-text);\n}\n\n/* Update Dot - small pulsing indicator on toggle button */\n.lumiverse-update-dot {\n    width: 8px;\n    height: 8px;\n    background: #fbbf24;\n    border-radius: 50%;\n    box-shadow: 0 0 8px rgba(251, 191, 36, 0.6);\n    animation: updateDotPulse 1.5s ease-in-out infinite;\n    margin-left: 4px;\n}\n\n@keyframes updateDotPulse {\n    0%, 100% {\n        box-shadow: 0 0 8px rgba(251, 191, 36, 0.6);\n        transform: scale(1);\n    }\n    50% {\n        box-shadow: 0 0 12px rgba(251, 191, 36, 0.9);\n        transform: scale(1.1);\n    }\n}\n\n/* Toggle button with updates - blended purple/amber gradient */\n.lumiverse-panel-toggle--has-updates {\n    background: linear-gradient(135deg, rgba(147, 112, 219, 0.85) 0%, rgba(180, 140, 200, 0.9) 50%, rgba(251, 191, 36, 0.75) 100%);\n    border-color: rgba(251, 191, 36, 0.4);\n    box-shadow: 0 4px 12px rgba(147, 112, 219, 0.3), 0 0 15px rgba(251, 191, 36, 0.25);\n}\n\n.lumiverse-panel-toggle--has-updates:hover {\n    box-shadow: 0 4px 16px rgba(147, 112, 219, 0.5), 0 0 25px rgba(251, 191, 36, 0.4);\n    border-color: rgba(251, 191, 36, 0.6);\n}\n\n/* Accordion Badge - "New!" indicator next to title */\n.lumiverse-accordion-badge {\n    display: inline-flex;\n    align-items: center;\n    padding: 2px 8px;\n    margin-left: 8px;\n    font-size: 10px;\n    font-weight: 700;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    color: #1f2937;\n    background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);\n    border-radius: 10px;\n    box-shadow: 0 2px 6px rgba(251, 191, 36, 0.4);\n    animation: badgeBounce 0.5s ease-out;\n}\n\n@keyframes badgeBounce {\n    0% { transform: scale(0); opacity: 0; }\n    60% { transform: scale(1.2); }\n    100% { transform: scale(1); opacity: 1; }\n}\n\n/* Update indicator for ViewportPanel header area */\n.lumiverse-vp-main .lumiverse-update-banner {\n    margin: 0 0 8px 0;\n    border-radius: var(--lumiverse-radius-sm);\n}\n\n/* Compact version for tight spaces */\n.lumiverse-update-banner--compact {\n    padding: 8px 12px;\n}\n\n.lumiverse-update-banner--compact .lumiverse-update-banner-main {\n    font-size: 12px;\n}\n\n.lumiverse-update-banner--compact .lumiverse-update-banner-icon {\n    display: none;\n}\n\n/* ============================================\n   PRESET BINDINGS PANEL STYLES\n   ============================================ */\n\n/* Status Section */\n.lumiverse-bindings-status {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n    padding: 10px 12px;\n    background: var(--lumiverse-bg-secondary);\n    border-radius: var(--lumiverse-radius-sm);\n    margin-bottom: 10px;\n}\n\n.lumiverse-bindings-context {\n    display: flex;\n    flex-direction: column;\n    gap: 6px;\n}\n\n.lumiverse-bindings-context-item {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-bindings-context-item svg {\n    flex-shrink: 0;\n    opacity: 0.7;\n}\n\n.lumiverse-bindings-context-label {\n    opacity: 0.7;\n}\n\n.lumiverse-bindings-context-value {\n    color: var(--lumiverse-text);\n    font-weight: 500;\n}\n\n.lumiverse-bindings-context-value--mono {\n    font-family: var(--lumiverse-font-mono);\n    font-size: 11px;\n}\n\n.lumiverse-bindings-context-bound {\n    display: inline-flex;\n    align-items: center;\n    gap: 3px;\n    padding: 2px 6px;\n    background: rgba(147, 112, 219, 0.2);\n    color: var(--lumiverse-accent);\n    border-radius: 4px;\n    font-size: 10px;\n    font-weight: 500;\n    margin-left: auto;\n}\n\n.lumiverse-bindings-active {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    padding: 6px 10px;\n    background: rgba(147, 112, 219, 0.15);\n    border: 1px solid rgba(147, 112, 219, 0.3);\n    border-radius: var(--lumiverse-radius-sm);\n    font-size: 12px;\n    color: var(--lumiverse-accent);\n}\n\n.lumiverse-bindings-empty-context {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    padding: 8px 0;\n    color: var(--lumiverse-text-muted);\n    font-size: 12px;\n}\n\n.lumiverse-bindings-empty-context svg {\n    opacity: 0.5;\n}\n\n.lumiverse-bindings-summary {\n    display: flex;\n    align-items: center;\n    margin-bottom: 10px;\n}\n\n.lumiverse-bindings-summary-label {\n    display: flex;\n    align-items: center;\n    gap: 5px;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n}\n\n/* Modal Styles */\n.lumiverse-bindings-modal {\n    width: min(520px, 95vw);\n    max-height: 85vh;\n    display: flex;\n    flex-direction: column;\n}\n\n.lumiverse-bindings-modal-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 16px 20px;\n    border-bottom: 1px solid var(--lumiverse-border);\n    background: linear-gradient(180deg, var(--lumiverse-bg-secondary) 0%, var(--lumiverse-bg) 100%);\n}\n\n.lumiverse-bindings-modal-header-info {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n}\n\n.lumiverse-bindings-modal-header-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 40px;\n    height: 40px;\n    background: linear-gradient(135deg, rgba(147, 112, 219, 0.2) 0%, rgba(147, 112, 219, 0.1) 100%);\n    border-radius: var(--lumiverse-radius);\n    color: var(--lumiverse-accent);\n}\n\n.lumiverse-bindings-modal-header-text {\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n}\n\n.lumiverse-bindings-modal-title {\n    margin: 0;\n    font-size: 16px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-bindings-modal-subtitle {\n    margin: 0;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-bindings-modal-close {\n    padding: 8px;\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    border-radius: var(--lumiverse-radius-sm);\n    transition: all 0.2s ease;\n}\n\n.lumiverse-bindings-modal-close:hover {\n    background: var(--lumiverse-bg-secondary);\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-bindings-modal-content {\n    flex: 1;\n    overflow-y: auto;\n    padding: 16px 20px;\n    display: flex;\n    flex-direction: column;\n    gap: 20px;\n}\n\n.lumiverse-bindings-modal-footer {\n    display: flex;\n    justify-content: flex-end;\n    padding: 12px 20px;\n    border-top: 1px solid var(--lumiverse-border);\n    background: var(--lumiverse-bg-secondary);\n}\n\n.lumiverse-bindings-modal-btn {\n    padding: 8px 20px;\n    border: none;\n    border-radius: var(--lumiverse-radius-sm);\n    font-size: 13px;\n    font-weight: 500;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-bindings-modal-btn--primary {\n    background: var(--lumiverse-accent);\n    color: white;\n}\n\n.lumiverse-bindings-modal-btn--primary:hover {\n    background: var(--lumiverse-accent-hover);\n}\n\n/* Sections */\n.lumiverse-bindings-section {\n    display: flex;\n    flex-direction: column;\n    gap: 12px;\n}\n\n.lumiverse-bindings-section-header {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-bindings-section-header svg {\n    color: var(--lumiverse-accent);\n}\n\n/* Create Binding Form */\n.lumiverse-bindings-create {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n    padding: 12px;\n    background: var(--lumiverse-bg-secondary);\n    border-radius: var(--lumiverse-radius);\n}\n\n.lumiverse-bindings-type-toggle {\n    display: flex;\n    gap: 8px;\n}\n\n.lumiverse-bindings-type-btn {\n    flex: 1;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 6px;\n    padding: 8px 12px;\n    background: var(--lumiverse-bg);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius-sm);\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-bindings-type-btn:hover:not(:disabled) {\n    border-color: var(--lumiverse-border-light);\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-bindings-type-btn.is-active {\n    background: rgba(147, 112, 219, 0.15);\n    border-color: var(--lumiverse-accent);\n    color: var(--lumiverse-accent);\n}\n\n.lumiverse-bindings-type-btn:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n}\n\n.lumiverse-bindings-create-context {\n    display: flex;\n    align-items: center;\n    padding: 8px 10px;\n    background: var(--lumiverse-bg);\n    border-radius: var(--lumiverse-radius-sm);\n    font-size: 12px;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-bindings-create-context span {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n}\n\n.lumiverse-bindings-create-context svg {\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-bindings-create-existing {\n    margin-left: 8px;\n    color: var(--lumiverse-accent);\n    font-size: 11px;\n}\n\n.lumiverse-bindings-create-row {\n    display: flex;\n    gap: 8px;\n}\n\n.lumiverse-bindings-select {\n    flex: 1;\n    padding: 8px 10px;\n    background: var(--lumiverse-bg);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius-sm);\n    font-size: 12px;\n    color: var(--lumiverse-text);\n    cursor: pointer;\n}\n\n.lumiverse-bindings-select:focus {\n    outline: none;\n    border-color: var(--lumiverse-accent);\n}\n\n.lumiverse-bindings-no-presets {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    padding: 8px 10px;\n    background: rgba(234, 179, 8, 0.1);\n    border: 1px solid rgba(234, 179, 8, 0.3);\n    border-radius: var(--lumiverse-radius-sm);\n    font-size: 11px;\n    color: #eab308;\n}\n\n.lumiverse-bindings-no-context {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 8px;\n    padding: 24px;\n    color: var(--lumiverse-text-muted);\n    text-align: center;\n}\n\n.lumiverse-bindings-no-context svg {\n    opacity: 0.5;\n}\n\n/* Bindings List */\n.lumiverse-bindings-list {\n    display: flex;\n    flex-direction: column;\n    gap: 6px;\n}\n\n.lumiverse-bindings-list-item {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 10px 12px;\n    background: var(--lumiverse-bg-secondary);\n    border-radius: var(--lumiverse-radius-sm);\n    transition: all 0.2s ease;\n}\n\n.lumiverse-bindings-list-item:hover {\n    background: var(--lumiverse-bg-hover);\n}\n\n.lumiverse-bindings-list-item-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 28px;\n    height: 28px;\n    background: rgba(147, 112, 219, 0.15);\n    border-radius: var(--lumiverse-radius-sm);\n    color: var(--lumiverse-accent);\n    flex-shrink: 0;\n}\n\n.lumiverse-bindings-list-item-info {\n    flex: 1;\n    min-width: 0;\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n}\n\n.lumiverse-bindings-list-item-name {\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-bindings-list-item-type {\n    font-size: 10px;\n    color: var(--lumiverse-text-muted);\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n.lumiverse-bindings-list-item-preset {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    padding: 4px 8px;\n    background: rgba(147, 112, 219, 0.15);\n    border-radius: var(--lumiverse-radius-sm);\n    font-size: 11px;\n    color: var(--lumiverse-accent);\n    white-space: nowrap;\n}\n\n.lumiverse-bindings-list-item-remove {\n    padding: 6px;\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    border-radius: var(--lumiverse-radius-sm);\n    transition: all 0.2s ease;\n    opacity: 0;\n}\n\n.lumiverse-bindings-list-item:hover .lumiverse-bindings-list-item-remove {\n    opacity: 1;\n}\n\n.lumiverse-bindings-list-item-remove:hover {\n    background: rgba(239, 68, 68, 0.15);\n    color: #ef4444;\n}\n\n/* Empty State */\n.lumiverse-bindings-empty {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 8px;\n    padding: 24px;\n    color: var(--lumiverse-text-muted);\n    text-align: center;\n}\n\n.lumiverse-bindings-empty svg {\n    opacity: 0.5;\n}\n\n.lumiverse-bindings-empty-hint {\n    font-size: 11px;\n    opacity: 0.7;\n}\n\n/* Info Box */\n.lumiverse-bindings-info {\n    padding: 12px;\n    background: rgba(147, 112, 219, 0.08);\n    border: 1px solid rgba(147, 112, 219, 0.2);\n    border-radius: var(--lumiverse-radius);\n}\n\n.lumiverse-bindings-info-title {\n    font-size: 12px;\n    font-weight: 600;\n    color: var(--lumiverse-accent);\n    margin-bottom: 8px;\n}\n\n.lumiverse-bindings-info-list {\n    margin: 0;\n    padding-left: 18px;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n    line-height: 1.6;\n}\n\n.lumiverse-bindings-info-list li {\n    margin-bottom: 4px;\n}\n\n.lumiverse-bindings-info-list strong {\n    color: var(--lumiverse-text);\n}\n\n/* =============================================================================\n   PROMPT TOGGLE BINDINGS - Bind enabled/disabled states to chat/character\n   ============================================================================= */\n\n.lumiverse-bindings-toggles {\n    display: flex;\n    flex-direction: column;\n    gap: 12px;\n}\n\n.lumiverse-bindings-toggles-info {\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n    line-height: 1.5;\n    padding: 8px 12px;\n    background: rgba(147, 112, 219, 0.08);\n    border-radius: 8px;\n    border-left: 3px solid rgba(147, 112, 219, 0.4);\n}\n\n.lumiverse-bindings-toggle-row {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    gap: 12px;\n    padding: 10px 12px;\n    background: rgba(0, 0, 0, 0.15);\n    border-radius: 8px;\n    border: 1px solid rgba(255, 255, 255, 0.05);\n}\n\n.lumiverse-bindings-toggle-label {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    font-size: 13px;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-bindings-toggle-label svg {\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-bindings-toggle-badge {\n    font-size: 10px;\n    padding: 2px 6px;\n    background: rgba(34, 197, 94, 0.2);\n    color: rgb(34, 197, 94);\n    border-radius: 4px;\n    font-weight: 600;\n    text-transform: uppercase;\n}\n\n.lumiverse-bindings-toggle-actions {\n    display: flex;\n    gap: 8px;\n}\n\n.lumiverse-bindings-toggles-priority {\n    font-size: 11px;\n    color: var(--lumiverse-text-dim);\n    text-align: center;\n    padding-top: 4px;\n}\n\n/* Default State Settings Section */\n.lumiverse-bindings-defaults-section {\n    margin-top: 16px;\n    padding-top: 16px;\n    border-top: 1px solid rgba(255, 255, 255, 0.08);\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n}\n\n.lumiverse-bindings-defaults-header {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    font-size: 12px;\n    font-weight: 600;\n    color: var(--lumiverse-text-muted);\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    margin-bottom: 4px;\n}\n\n.lumiverse-bindings-defaults-header svg {\n    color: var(--lumiverse-accent-dim);\n}\n\n.lumiverse-bindings-defaults-info {\n    font-size: 11px;\n    color: var(--lumiverse-text-dim);\n    line-height: 1.5;\n    padding: 6px 10px;\n    background: rgba(0, 0, 0, 0.1);\n    border-radius: 6px;\n    margin-top: 4px;\n}\n\n/* =============================================================================\n   PROFILE BIND BUTTON - Quick bind button in profile header\n   ============================================================================= */\n\n.lumiverse-profile-bind-btn {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 36px;\n    height: 36px;\n    flex-shrink: 0;\n    background: rgba(147, 112, 219, 0.08);\n    border: 1px solid rgba(147, 112, 219, 0.2);\n    border-radius: 10px;\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-profile-bind-btn:hover {\n    background: rgba(147, 112, 219, 0.15);\n    border-color: rgba(147, 112, 219, 0.35);\n    color: var(--lumiverse-primary);\n    transform: scale(1.05);\n}\n\n.lumiverse-profile-bind-btn--active {\n    background: rgba(147, 112, 219, 0.2);\n    border-color: var(--lumiverse-primary);\n    color: var(--lumiverse-primary);\n}\n\n.lumiverse-profile-bind-btn--active:hover {\n    background: rgba(147, 112, 219, 0.3);\n}\n\n/* =============================================================================\n   PROFILE BINDINGS MODAL - Compact modal from profile tab\n   ============================================================================= */\n\n.lumiverse-profile-bindings-backdrop {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n}\n\n.lumiverse-profile-bindings-modal {\n    background: var(--lumiverse-bg);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 14px;\n    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);\n    width: 320px;\n    max-width: 90vw;\n    overflow: hidden;\n    animation: lumiverseProfileModalIn 0.2s ease;\n}\n\n@keyframes lumiverseProfileModalIn {\n    from {\n        opacity: 0;\n        transform: scale(0.95) translateY(-8px);\n    }\n    to {\n        opacity: 1;\n        transform: scale(1) translateY(0);\n    }\n}\n\n/* Header */\n.lumiverse-profile-bindings-header {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 14px 16px;\n    background: rgba(147, 112, 219, 0.08);\n    border-bottom: 1px solid var(--lumiverse-border);\n}\n\n.lumiverse-profile-bindings-header-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 32px;\n    height: 32px;\n    background: rgba(147, 112, 219, 0.15);\n    border-radius: 8px;\n    color: var(--lumiverse-primary);\n    flex-shrink: 0;\n}\n\n.lumiverse-profile-bindings-header-text {\n    flex: 1;\n    min-width: 0;\n}\n\n.lumiverse-profile-bindings-title {\n    display: block;\n    font-size: 14px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-profile-bindings-subtitle {\n    display: block;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n    margin-top: 1px;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-profile-bindings-close {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 28px;\n    height: 28px;\n    background: transparent;\n    border: none;\n    border-radius: 6px;\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    transition: all 0.15s ease;\n    flex-shrink: 0;\n}\n\n.lumiverse-profile-bindings-close:hover {\n    background: rgba(255, 100, 100, 0.15);\n    color: #ff6b6b;\n}\n\n/* Content */\n.lumiverse-profile-bindings-content {\n    padding: 14px 16px 16px;\n    display: flex;\n    flex-direction: column;\n    gap: 14px;\n}\n\n/* Status section */\n.lumiverse-profile-bindings-status {\n    display: flex;\n    flex-direction: column;\n    gap: 6px;\n}\n\n.lumiverse-profile-bindings-status-row {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    padding: 8px 10px;\n    background: rgba(0, 0, 0, 0.15);\n    border-radius: 8px;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-profile-bindings-status-row.is-bound {\n    background: rgba(147, 112, 219, 0.12);\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-profile-bindings-status-row svg:first-child {\n    flex-shrink: 0;\n    opacity: 0.7;\n}\n\n.lumiverse-profile-bindings-status-label {\n    font-weight: 500;\n    flex-shrink: 0;\n}\n\n.lumiverse-profile-bindings-status-value {\n    flex: 1;\n    min-width: 0;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-profile-bindings-status-row.is-bound .lumiverse-profile-bindings-status-value {\n    color: var(--lumiverse-primary);\n    font-weight: 500;\n}\n\n.lumiverse-profile-bindings-status-remove {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 20px;\n    height: 20px;\n    background: transparent;\n    border: none;\n    border-radius: 4px;\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    flex-shrink: 0;\n    opacity: 0.6;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-profile-bindings-status-remove:hover {\n    background: rgba(255, 100, 100, 0.2);\n    color: #ff6b6b;\n    opacity: 1;\n}\n\n/* Create section */\n.lumiverse-profile-bindings-create {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n    padding-top: 10px;\n    border-top: 1px solid var(--lumiverse-border);\n}\n\n.lumiverse-profile-bindings-type-toggle {\n    display: flex;\n    gap: 6px;\n}\n\n.lumiverse-profile-bindings-type-btn {\n    flex: 1;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 6px;\n    padding: 8px 12px;\n    background: rgba(0, 0, 0, 0.1);\n    border: 1px solid transparent;\n    border-radius: 8px;\n    font-size: 12px;\n    font-weight: 500;\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-profile-bindings-type-btn:hover:not(:disabled) {\n    background: rgba(147, 112, 219, 0.1);\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-profile-bindings-type-btn.is-active {\n    background: rgba(147, 112, 219, 0.15);\n    border-color: var(--lumiverse-primary);\n    color: var(--lumiverse-primary);\n}\n\n.lumiverse-profile-bindings-type-btn:disabled {\n    opacity: 0.4;\n    cursor: not-allowed;\n}\n\n.lumiverse-profile-bindings-select-row {\n    display: flex;\n    gap: 8px;\n}\n\n.lumiverse-profile-bindings-select {\n    flex: 1;\n    min-width: 0;\n    padding: 8px 12px;\n    background: rgba(0, 0, 0, 0.2);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 8px;\n    color: var(--lumiverse-text);\n    font-size: 12px;\n    cursor: pointer;\n    transition: border-color 0.15s ease;\n}\n\n.lumiverse-profile-bindings-select:hover {\n    border-color: rgba(147, 112, 219, 0.4);\n}\n\n.lumiverse-profile-bindings-select:focus {\n    outline: none;\n    border-color: var(--lumiverse-primary);\n}\n\n.lumiverse-profile-bindings-bind-btn {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 36px;\n    height: 36px;\n    background: var(--lumiverse-primary);\n    border: none;\n    border-radius: 8px;\n    color: #fff;\n    cursor: pointer;\n    flex-shrink: 0;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-profile-bindings-bind-btn:hover:not(:disabled) {\n    background: var(--lumiverse-primary-hover);\n    transform: scale(1.05);\n}\n\n.lumiverse-profile-bindings-bind-btn:disabled {\n    opacity: 0.4;\n    cursor: not-allowed;\n    transform: none;\n}\n\n/* Empty state */\n.lumiverse-profile-bindings-empty {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 8px;\n    padding: 28px 20px;\n    color: var(--lumiverse-text-muted);\n    text-align: center;\n}\n\n.lumiverse-profile-bindings-empty svg {\n    opacity: 0.4;\n}\n\n/* Toggle Bindings Section */\n.lumiverse-profile-bindings-toggles {\n    margin-top: 16px;\n    padding-top: 16px;\n    border-top: 1px solid rgba(255, 255, 255, 0.1);\n}\n\n.lumiverse-profile-bindings-toggles-header {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    font-size: 12px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    margin-bottom: 6px;\n}\n\n.lumiverse-profile-bindings-toggles-header svg {\n    color: var(--lumiverse-primary);\n}\n\n.lumiverse-profile-bindings-toggles-info {\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n    margin-bottom: 10px;\n}\n\n.lumiverse-profile-bindings-toggles-rows {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumiverse-profile-bindings-toggle-row {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    padding: 8px 10px;\n    background: rgba(255, 255, 255, 0.03);\n    border-radius: 6px;\n    font-size: 12px;\n}\n\n.lumiverse-profile-bindings-toggle-row.is-bound {\n    background: rgba(100, 200, 100, 0.1);\n    border: 1px solid rgba(100, 200, 100, 0.2);\n}\n\n.lumiverse-profile-bindings-toggle-row svg:first-child {\n    color: var(--lumiverse-text-muted);\n    flex-shrink: 0;\n}\n\n.lumiverse-profile-bindings-toggle-label {\n    flex: 1;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-profile-bindings-toggle-badge {\n    padding: 2px 8px;\n    background: rgba(100, 200, 100, 0.2);\n    color: rgb(100, 200, 100);\n    border-radius: 4px;\n    font-size: 10px;\n    font-weight: 600;\n}\n\n.lumiverse-profile-bindings-toggle-bind {\n    padding: 4px 10px;\n    background: var(--lumiverse-primary);\n    color: white;\n    border: none;\n    border-radius: 4px;\n    font-size: 10px;\n    font-weight: 500;\n    cursor: pointer;\n    transition: background 0.2s ease;\n}\n\n.lumiverse-profile-bindings-toggle-bind:hover:not(:disabled) {\n    background: var(--lumiverse-primary-hover);\n}\n\n.lumiverse-profile-bindings-toggle-bind:disabled {\n    opacity: 0.4;\n    cursor: not-allowed;\n}\n\n.lumiverse-profile-bindings-toggle-clear {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 20px;\n    height: 20px;\n    background: transparent;\n    border: none;\n    border-radius: 4px;\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-profile-bindings-toggle-clear:hover {\n    background: rgba(255, 100, 100, 0.2);\n    color: rgb(255, 100, 100);\n}\n\n.lumiverse-profile-bindings-toggles-priority {\n    margin-top: 10px;\n    font-size: 10px;\n    color: var(--lumiverse-text-muted);\n    font-style: italic;\n    text-align: center;\n}\n\n/* ============================================\n   RESPONSIVE CARD GRID\n   3 columns on desktop, 2 columns on mobile\n   ============================================ */\n\n.lumiverse-responsive-card-grid {\n    display: grid;\n    grid-template-columns: repeat(3, 1fr);\n    gap: 16px;\n}\n\n@media (max-width: 600px) {\n    .lumiverse-responsive-card-grid {\n        grid-template-columns: repeat(2, 1fr);\n    }\n}\n\n/* Small card grid (for selection modals with square cards) */\n.lumiverse-responsive-small-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));\n    gap: 10px;\n    padding: 12px;\n}\n\n@media (max-width: 480px) {\n    .lumiverse-responsive-small-grid {\n        grid-template-columns: repeat(2, 1fr);\n    }\n}\n\n/* ----------------------------------------\n   Landing Page & Utilities (Restored)\n   ---------------------------------------- */\n@media (prefers-reduced-motion: reduce) {\n    .lumiverse-landing-page,\n    .lumiverse-landing-chat-card,\n    .lumiverse-landing-chat-avatar img,\n    .lumiverse-landing-refresh svg,\n    .lumiverse-landing-chat-arrow {\n        animation: none;\n        transition: none;\n    }\n\n    .lumiverse-landing-skeleton-avatar,\n    .lumiverse-landing-skeleton-line {\n        animation: none;\n    }\n}\n\n.lumiverse-landing-page {\n    color-scheme: dark;\n}\n\n@media (max-width: 600px) {\n    .hidden-sm {\n        display: none !important;\n    }\n}\n\n/* ----------------------------------------\n   States Dropdown\n   ---------------------------------------- */\n.lumiverse-states-menu {\n    position: absolute;\n    top: calc(100% + 4px) !important;\n    bottom: auto !important;\n    left: 0;\n    margin: 0 !important;\n    width: 280px;\n    background: var(--lumiverse-bg-elevated);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 8px;\n    box-shadow: 0 4px 12px rgba(0,0,0,0.4);\n    z-index: 9999; /* Boost z-index significantly */\n    padding: 12px;\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n    transform: none !important;\n}\n\n.lumiverse-states-backdrop {\n    display: none;\n}\n\n/* Mobile Centered Modal for States */\n@media (max-width: 600px) {\n    .lumiverse-states-backdrop {\n        display: block;\n        position: fixed;\n        inset: 0;\n        background: rgba(0,0,0,0.6);\n        z-index: 20000;\n        animation: lumiverseFadeIn 0.2s ease;\n    }\n\n    .lumiverse-states-menu {\n        position: fixed;\n        top: 50% !important;\n        left: 50% !important;\n        bottom: auto !important;\n        transform: translate(-50%, -50%) !important;\n        width: 90vw;\n        max-width: 350px;\n        margin: 0 !important;\n        z-index: 20001;\n        box-shadow: 0 8px 32px rgba(0,0,0,0.5);\n        border: 1px solid var(--lumiverse-border);\n        animation: lumiverseFadeIn 0.2s ease;\n    }\n}\n`,""]);const b=p},463(e,n){function t(e,n){var t=e.length;e.push(n);e:for(;0<t;){var r=t-1>>>1,i=e[r];if(!(0<o(i,n)))break e;e[r]=n,e[t]=i,t=r}}function r(e){return 0===e.length?null:e[0]}function i(e){if(0===e.length)return null;var n=e[0],t=e.pop();if(t!==n){e[0]=t;e:for(var r=0,i=e.length,a=i>>>1;r<a;){var s=2*(r+1)-1,l=e[s],c=s+1,u=e[c];if(0>o(l,t))c<i&&0>o(u,l)?(e[r]=u,e[c]=t,r=c):(e[r]=l,e[s]=t,r=s);else{if(!(c<i&&0>o(u,t)))break e;e[r]=u,e[c]=t,r=c}}}return n}function o(e,n){var t=e.sortIndex-n.sortIndex;return 0!==t?t:e.id-n.id}if("object"==typeof performance&&"function"==typeof performance.now){var a=performance;n.unstable_now=function(){return a.now()}}else{var s=Date,l=s.now();n.unstable_now=function(){return s.now()-l}}var c=[],u=[],d=1,m=null,p=3,g=!1,h=!1,v=!1,f="function"==typeof setTimeout?setTimeout:null,b="function"==typeof clearTimeout?clearTimeout:null,x="undefined"!=typeof setImmediate?setImmediate:null;function y(e){for(var n=r(u);null!==n;){if(null===n.callback)i(u);else{if(!(n.startTime<=e))break;i(u),n.sortIndex=n.expirationTime,t(c,n)}n=r(u)}}function k(e){if(v=!1,y(e),!h)if(null!==r(c))h=!0,A(w);else{var n=r(u);null!==n&&L(k,n.startTime-e)}}function w(e,t){h=!1,v&&(v=!1,b(N),N=-1),g=!0;var o=p;try{for(y(t),m=r(c);null!==m&&(!(m.expirationTime>t)||e&&!D());){var a=m.callback;if("function"==typeof a){m.callback=null,p=m.priorityLevel;var s=a(m.expirationTime<=t);t=n.unstable_now(),"function"==typeof s?m.callback=s:m===r(c)&&i(c),y(t)}else i(c);m=r(c)}if(null!==m)var l=!0;else{var d=r(u);null!==d&&L(k,d.startTime-t),l=!1}return l}finally{m=null,p=o,g=!1}}"undefined"!=typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var j,C=!1,S=null,N=-1,E=5,P=-1;function D(){return!(n.unstable_now()-P<E)}function M(){if(null!==S){var e=n.unstable_now();P=e;var t=!0;try{t=S(!0,e)}finally{t?j():(C=!1,S=null)}}else C=!1}if("function"==typeof x)j=function(){x(M)};else if("undefined"!=typeof MessageChannel){var O=new MessageChannel,T=O.port2;O.port1.onmessage=M,j=function(){T.postMessage(null)}}else j=function(){f(M,0)};function A(e){S=e,C||(C=!0,j())}function L(e,t){N=f(function(){e(n.unstable_now())},t)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(e){e.callback=null},n.unstable_continueExecution=function(){h||g||(h=!0,A(w))},n.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):E=0<e?Math.floor(1e3/e):5},n.unstable_getCurrentPriorityLevel=function(){return p},n.unstable_getFirstCallbackNode=function(){return r(c)},n.unstable_next=function(e){switch(p){case 1:case 2:case 3:var n=3;break;default:n=p}var t=p;p=n;try{return e()}finally{p=t}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(e,n){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var t=p;p=e;try{return n()}finally{p=t}},n.unstable_scheduleCallback=function(e,i,o){var a=n.unstable_now();switch("object"==typeof o&&null!==o?o="number"==typeof(o=o.delay)&&0<o?a+o:a:o=a,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:d++,callback:i,priorityLevel:e,startTime:o,expirationTime:s=o+s,sortIndex:-1},o>a?(e.sortIndex=o,t(u,e),null===r(c)&&e===r(u)&&(v?(b(N),N=-1):v=!0,L(k,o-a))):(e.sortIndex=s,t(c,e),h||g||(h=!0,A(w))),e},n.unstable_shouldYield=D,n.unstable_wrapCallback=function(e){var n=p;return function(){var t=p;p=n;try{return e.apply(this,arguments)}finally{p=t}}}},485(e,n,t){t.d(n,{E:()=>p,IQ:()=>b,Iv:()=>v,Zq:()=>y,__:()=>f,dj:()=>u,tb:()=>k,x$:()=>h});var r=t(92),i=t(674),o=t(100);const a="loom_last_summarized_at";let s=null,l=null,c=!1;function u(){return c}function d(e){g();const n=document.getElementById("chat");if(!n)return;const t=n.querySelector(".mes:last-child");if(!t)return;const r=t.querySelector(".timestamp");if(!r)return;l=t;const i=document.createElement("span");i.className="loom-summary-indicator",i.id="loom-summary-indicator","loading"===e?(i.innerHTML='<span class="loom-summary-spinner"></span><span>Weaving summary...</span>',r.appendChild(i),s=i):"complete"===e?m(t,"complete"):"error"===e&&m(t,"error")}function m(e,n){if(!e)return;const t=e.querySelector(".timestamp");if(!t)return;const i=t.querySelector(".loom-summary-marker");i&&i.remove();const o=document.createElement("span");o.className="loom-summary-marker",o.setAttribute("data-summary-type",n),"complete"===n?(o.classList.add("loom-summary-marker-complete"),o.innerHTML='<svg class="loom-summary-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <ellipse cx="12" cy="12" rx="8" ry="10" stroke="currentColor" stroke-width="1.5" fill="none"/>\n  <ellipse cx="12" cy="12" rx="3" ry="10" stroke="currentColor" stroke-width="1.5" fill="none"/>\n  <line x1="4" y1="8" x2="20" y2="8" stroke="currentColor" stroke-width="1.5"/>\n  <line x1="4" y1="16" x2="20" y2="16" stroke="currentColor" stroke-width="1.5"/>\n  <circle cx="12" cy="12" r="2" fill="currentColor"/>\n</svg>',o.title="Summary woven up to this message"):"error"===n&&(o.classList.add("loom-summary-marker-error"),o.innerHTML='<svg class="loom-summary-icon loom-summary-icon-error" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="1.5" fill="none"/>\n  <path d="M15 9L9 15M9 9L15 15" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>\n</svg>',o.title="Summary generation failed at this message"),t.appendChild(o);const a=function(e){return(null==e?void 0:e.getAttribute("mesid"))||null}(e);a&&function(e,n){var t;const i=(0,r.SD)();if(null==i||!i.chatMetadata)return;i.chatMetadata.loom_summary_marker={mesId:e,type:n,timestamp:Date.now()},null===(t=i.saveMetadata)||void 0===t||t.call(i)}(a,n)}function p(){var e;const n=(0,r.SD)();if(null==n||null===(e=n.chatMetadata)||void 0===e||!e.loom_summary_marker)return;const t=n.chatMetadata.loom_summary_marker;if(!t.mesId)return;const i=(o=t.mesId)?document.querySelector('.mes[mesid="'.concat(o,'"]')):null;var o;i&&m(i,t.type)}function g(){s&&(s.remove(),s=null);const e=document.getElementById("loom-summary-indicator");e&&e.remove()}const h={openai:{name:"OpenAI",endpoint:"https://api.openai.com/v1/chat/completions",secretKey:"api_key_openai",placeholder:"gpt-4o-mini",format:"openai"},anthropic:{name:"Anthropic Claude",endpoint:"https://api.anthropic.com/v1/messages",secretKey:"api_key_claude",placeholder:"claude-sonnet-4-5-20250929",format:"anthropic"},openrouter:{name:"OpenRouter",endpoint:"https://openrouter.ai/api/v1/chat/completions",secretKey:"api_key_openrouter",placeholder:"openai/gpt-4o-mini",format:"openai"},google:{name:"Google AI Studio",endpoint:"https://generativelanguage.googleapis.com/v1beta/models",secretKey:"api_key_makersuite",placeholder:"gemini-2.0-flash",format:"google"},chutes:{name:"Chutes",endpoint:"https://llm.chutes.ai/v1/chat/completions",secretKey:"api_key_chutes",placeholder:"deepseek-ai/DeepSeek-V3",format:"openai"},electronhub:{name:"ElectronHub",endpoint:"https://api.electronhub.ai/v1/chat/completions",secretKey:"api_key_electronhub",placeholder:"gpt-4o-mini",format:"openai"},nanogpt:{name:"NanoGPT",endpoint:"https://nano-gpt.com/api/v1/chat/completions",secretKey:"api_key_nanogpt",placeholder:"chatgpt-4o-latest",format:"openai"},zai:{name:"Z.AI",endpoint:"https://api.z.ai/api/paas/v4/chat/completions",secretKey:"api_key_zai",placeholder:"gpt-4o-mini",format:"openai"},custom:{name:"Custom (OpenAI Compatible)",endpoint:"",secretKey:null,placeholder:"your-model-id",format:"openai"}};function v(e){return h[e]||h.custom}function f(e){const n=v(e);return{endpoint:n.endpoint,placeholder:n.placeholder}}async function b(e){if(!e)return null;try{const n=await fetch("/api/secrets/find",{method:"POST",headers:(0,r.oO)(),body:JSON.stringify({key:e})});if(!n.ok)return console.warn("[".concat(i.MODULE_NAME,"] Could not fetch secret key: ").concat(e," (status: ").concat(n.status,")")),null;return(await n.json()).value||null}catch(e){return console.error("[".concat(i.MODULE_NAME,"] Error fetching secret key:"),e),null}}function x(e){var n;const t=(0,r.SD)();if(!t||!t.chat)return null;const a=t.chat.slice(-e);if(0===a.length)return null;const s=(null===(n=t.chatMetadata)||void 0===n?void 0:n[i.LOOM_SUMMARY_KEY])||"",l=(0,o.J3)(),c=(0,o.K$)(),u=(0,o.N4)(),d=c?(0,o.U3)():[];let m;if(c){const e=d.length>0?d.join(", "):"group members";m="Track evolving dynamics between characters (".concat(e,") and between characters and ").concat(l,". Trust, tension, affection, rivalry. (NEVER track ").concat(l,"'s internal state—only how characters perceive or relate to them.)")}else m="Track evolving dynamics between ".concat(u," and ").concat(l,", as well as any NPCs. Trust, tension, affection, rivalry. (NEVER track ").concat(l,"'s internal state—only how characters perceive or relate to them.)");let p="";a.forEach(e=>{const n=e.is_user?e.name||"User":e.name||"Character";let t=e.mes||e.content||"";t=t.replace(/<loom_sum>[\s\S]*?<\/loom_sum>/gi,"").trim(),t&&(p+="".concat(n,": ").concat(t,"\n\n"))});return{systemPrompt:"You are a Lucid Loom narrative archivist for interactive fiction and roleplay. Your task is to weave comprehensive story summaries that maintain narrative continuity while capturing the essence of the tale.\n\nYour summary MUST use this exact structured format with clear headers:\n\n**Completed Objectives** (MAX 7 items)\nStory beats and arcs that have already concluded. Plot points resolved, conflicts addressed, milestones reached.\n\n**Focused Objectives** (MAX 5 items)\nActive story threads requiring attention. These can shift or be deviated from at any time but represent current narrative focus.\n\n**Foreshadowing Beats** (MAX 5 items)\nEvents hinted at or seeded in recent story beats. Potential future complications, promises made, warnings given.\n\n**Character Developments** (MAX 7 items total)\nTrack meaningful changes in personality, beliefs, skills, or emotional state for each character (NEVER ".concat(l,").\n\n**Memorable Actions** (MAX 7 items)\nPhysical actions of significance—combat moves, gestures, gifts exchanged, locations visited. Details that may matter later.\n\n**Memorable Dialogues** (MAX 5 items)\nWords that left a mark. Confessions, promises, threats, revelations, or simply beautiful turns of phrase.\n\n**Relationships** (MAX 5 items)\n").concat(m,'\n\nCRITICAL GUIDELINES:\n- Use bullet points under each header for clarity—avoid walls of text\n- Be precise and detailed, never sacrifice important information\n- Be concise, never pad with redundant or obvious observations\n- If a category has no relevant content, write "None at present" rather than inventing filler\n- NEVER track or summarize ').concat(l,"'s thoughts, feelings, or internal state\n- RESPECT ITEM LIMITS: Each category has a maximum item count. When at capacity, remove the oldest or least relevant item to make room for new ones\n- PRESERVE IMPORTANT HISTORY: When removing items, prioritize keeping entries that have ongoing narrative relevance (active plot threads, unresolved tensions, recurring themes)\n- CONSOLIDATE when possible: Combine related items into single, more comprehensive bullet points rather than having many fragmented entries"),userPrompt:"".concat(s?"**PREVIOUS LOOM SUMMARY** (use this as your foundation—do NOT discard important information):\n".concat(s,"\n\n---\n\n**MERGE INSTRUCTIONS:**\n- Start with ALL existing entries from the previous summary\n- Add new developments from the recent events below\n- When a category exceeds its item limit, consolidate related items or remove the least narratively relevant\n- NEVER silently drop items that still have ongoing relevance (active conflicts, unresolved threads, important relationships)\n- If an item from the previous summary is still relevant but needs updating, modify it rather than removing it\n\n---\n\n"):"","**RECENT STORY EVENTS** to weave into the summary:\n\n").concat(p,"\n\nProvide an updated Loom Summary incorporating these new events. Use the exact structured format with all seven headers. Output ONLY the summary content—no meta-commentary or additional formatting.")}}async function y(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const o=(0,i.getSettings)(),s=e||o.summarization;if(!s)return console.log("[".concat(i.MODULE_NAME,"] Summarization not configured")),null;const l=(0,r.SD)();if(!l||!l.chat||0===l.chat.length)return console.log("[".concat(i.MODULE_NAME,"] No chat to summarize")),null;const c=n?s.manualMessageContext||10:s.autoMessageContext||10;console.log("[".concat(i.MODULE_NAME,"] Using ").concat(n?"manual":"auto"," message context: ").concat(c," messages")),t&&d("loading");try{let e;if("main"===s.apiSource)e=await async function(e,n){const{generateRaw:t}=(0,r.SD)();if(!t)throw new Error("generateRaw not available - is SillyTavern properly loaded?");const o=x(n);if(!o)throw new Error("No chat messages to summarize");return console.log("[".concat(i.MODULE_NAME,"] Generating summary with Main API...")),await t({systemPrompt:o.systemPrompt,prompt:o.userPrompt,prefill:""})}(0,c);else{if("secondary"!==s.apiSource)throw t&&d("error","Invalid API source"),new Error("Unknown API source: ".concat(s.apiSource));e=await async function(e,n){const t=e.secondary||{},r=t.provider||"openai",o=t.model,a=t.temperature||.7,s=void 0!==t.topP?t.topP:1,l=t.maxTokens||8192;if(!o)throw new Error("No model specified for secondary LLM");const c=v(r);let u;if("custom"===r){if(u=t.apiKey,!u)throw new Error("No API key specified for custom provider")}else if(u=await b(c.secretKey),!u)throw new Error("No API key found for ".concat(c.name,". Please add your API key in SillyTavern's API settings."));const d=x(n);if(!d)throw new Error("No chat messages to summarize");const m="custom"===r?t.endpoint:c.endpoint;if(!m)throw new Error("No endpoint specified for secondary LLM");let p;if(console.log("[".concat(i.MODULE_NAME,"] Generating summary with ").concat(c.name,"...")),"anthropic"===c.format){const e=(0,i.getSettings)(),n=(0,i.getLumiaConfigVersion)(),t={model:o,max_tokens:l,system:e.disableAnthropicCache?[{type:"text",text:d.systemPrompt,cache_control:{type:"ephemeral"}}]:d.systemPrompt,messages:[{role:"user",content:d.userPrompt}],temperature:a,metadata:{lumia_config_version:String(n)}};s>0&&s<1&&(t.top_p=s);const r={"Content-Type":"application/json","x-api-key":u,"anthropic-version":"2023-06-01"};if(e.disableAnthropicCache&&(r["anthropic-beta"]="prompt-caching-2024-07-31",console.log("[".concat(i.MODULE_NAME,"] Cache busting enabled for this request (Lumia config v").concat(n,")"))),p=await fetch(m,{method:"POST",headers:r,body:JSON.stringify(t)}),!p.ok){const e=await p.text().catch(()=>"Unable to read error");throw new Error("Anthropic API error: ".concat(p.status," - ").concat(e))}const c=await p.json();if(c.content&&Array.isArray(c.content)){const e=c.content.find(e=>"text"===e.type);return(null==e?void 0:e.text)||""}return""}if("google"===c.format){var g;const e="".concat(m,"/").concat(o,":generateContent"),n={safetySettings:[{category:"HARM_CATEGORY_HARASSMENT",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_HATE_SPEECH",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_SEXUALLY_EXPLICIT",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_DANGEROUS_CONTENT",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_CIVIC_INTEGRITY",threshold:"BLOCK_NONE"}],contents:[{role:"user",parts:[{text:"".concat(d.systemPrompt,"\n\n---\n\n").concat(d.userPrompt)}]}],generationConfig:{temperature:a,maxOutputTokens:l}};if(s>0&&s<1&&(n.generationConfig.topP=s),p=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json","x-goog-api-key":u},body:JSON.stringify(n)}),!p.ok){const e=await p.text().catch(()=>"Unable to read error");throw new Error("Google AI Studio API error: ".concat(p.status," - ").concat(e))}const t=await p.json();return null!==(g=t.candidates)&&void 0!==g&&null!==(g=g[0])&&void 0!==g&&null!==(g=g.content)&&void 0!==g&&null!==(g=g.parts)&&void 0!==g&&null!==(g=g[0])&&void 0!==g&&g.text?t.candidates[0].content.parts[0].text:""}{var h;const e={"Content-Type":"application/json",Authorization:"Bearer ".concat(u)};"openrouter"===r&&(e["HTTP-Referer"]=window.location.origin,e["X-Title"]="Lumia Injector");const n={model:o,messages:[{role:"system",content:d.systemPrompt},{role:"user",content:d.userPrompt}],temperature:a,max_tokens:l};if(s>0&&s<1&&(n.top_p=s),p=await fetch(m,{method:"POST",headers:e,body:JSON.stringify(n)}),!p.ok){const e=await p.text().catch(()=>"Unable to read error");throw new Error("".concat(c.name," API error: ").concat(p.status," - ").concat(e))}const t=await p.json();return null!==(h=t.choices)&&void 0!==h&&null!==(h=h[0])&&void 0!==h&&null!==(h=h.message)&&void 0!==h&&h.content?t.choices[0].message.content:""}}(s,c)}return e&&e.trim()?(l.chatMetadata[i.LOOM_SUMMARY_KEY]=e.trim(),function(e){const n=(0,r.SD)();null!=n&&n.chatMetadata&&(n.chatMetadata[a]={messageCount:e,timestamp:Date.now()})}(l.chat.length),await l.saveMetadata(),console.log("[".concat(i.MODULE_NAME,"] Summary saved to chat metadata at message ").concat(l.chat.length)),t&&d("complete"),e.trim()):(t&&g(),null)}catch(e){throw console.error("[".concat(i.MODULE_NAME,"] Summary generation failed:"),e),t&&d("error"),e}}function k(){if(c)return;const e=(0,i.getSettings)().summarization;if(!e||"auto"!==e.mode)return;const n=(0,r.SD)();if(!n||!n.chat)return;const o=e.autoInterval||10,s=n.chat.length,l=function(){var e;const n=(0,r.SD)();return null!=n&&null!==(e=n.chatMetadata)&&void 0!==e&&e[a]&&n.chatMetadata[a].messageCount||0}(),u=s-l;s>=o&&u>=o&&(console.log("[".concat(i.MODULE_NAME,"] Auto-summarization triggered: ").concat(u," messages since last summary (at ").concat(l,"), current count: ").concat(s)),c=!0,Promise.resolve().then(t.bind(t,932)).then(e=>{let{updateLoomSummaryButtonState:n}=e;n()}).catch(()=>{}),y(null,!1,!0).then(e=>{c=!1,Promise.resolve().then(t.bind(t,932)).then(e=>{let{updateLoomSummaryButtonState:n}=e;n()}).catch(()=>{}),e&&toastr.info("Loom summary updated automatically")}).catch(e=>{c=!1,Promise.resolve().then(t.bind(t,932)).then(e=>{let{updateLoomSummaryButtonState:n}=e;n()}).catch(()=>{}),console.error("[".concat(i.MODULE_NAME,"] Auto-summarization failed:"),e)}))}},540(e,n,t){e.exports=t(287)},551(e,n,t){var r=t(540),i=t(982);function o(e){for(var n="https://reactjs.org/docs/error-decoder.html?invariant="+e,t=1;t<arguments.length;t++)n+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+e+"; visit "+n+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,s={};function l(e,n){c(e,n),c(e+"Capture",n)}function c(e,n){for(s[e]=n,e=0;e<n.length;e++)a.add(n[e])}var u=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),d=Object.prototype.hasOwnProperty,m=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},g={};function h(e,n,t,r,i,o,a){this.acceptsBooleans=2===n||3===n||4===n,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=t,this.propertyName=e,this.type=n,this.sanitizeURL=o,this.removeEmptyString=a}var v={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){v[e]=new h(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var n=e[0];v[n]=new h(n,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){v[e]=new h(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){v[e]=new h(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){v[e]=new h(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){v[e]=new h(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){v[e]=new h(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){v[e]=new h(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){v[e]=new h(e,5,!1,e.toLowerCase(),null,!1,!1)});var f=/[\-:]([a-z])/g;function b(e){return e[1].toUpperCase()}function x(e,n,t,r){var i=v.hasOwnProperty(n)?v[n]:null;(null!==i?0!==i.type:r||!(2<n.length)||"o"!==n[0]&&"O"!==n[0]||"n"!==n[1]&&"N"!==n[1])&&(function(e,n,t,r){if(null==n||function(e,n,t,r){if(null!==t&&0===t.type)return!1;switch(typeof n){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==t?!t.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,n,t,r))return!0;if(r)return!1;if(null!==t)switch(t.type){case 3:return!n;case 4:return!1===n;case 5:return isNaN(n);case 6:return isNaN(n)||1>n}return!1}(n,t,i,r)&&(t=null),r||null===i?function(e){return!!d.call(g,e)||!d.call(p,e)&&(m.test(e)?g[e]=!0:(p[e]=!0,!1))}(n)&&(null===t?e.removeAttribute(n):e.setAttribute(n,""+t)):i.mustUseProperty?e[i.propertyName]=null===t?3!==i.type&&"":t:(n=i.attributeName,r=i.attributeNamespace,null===t?e.removeAttribute(n):(t=3===(i=i.type)||4===i&&!0===t?"":""+t,r?e.setAttributeNS(r,n,t):e.setAttribute(n,t))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var n=e.replace(f,b);v[n]=new h(n,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var n=e.replace(f,b);v[n]=new h(n,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var n=e.replace(f,b);v[n]=new h(n,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){v[e]=new h(e,1,!1,e.toLowerCase(),null,!1,!1)}),v.xlinkHref=new h("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){v[e]=new h(e,1,!1,e.toLowerCase(),null,!0,!0)});var y=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,k=Symbol.for("react.element"),w=Symbol.for("react.portal"),j=Symbol.for("react.fragment"),C=Symbol.for("react.strict_mode"),S=Symbol.for("react.profiler"),N=Symbol.for("react.provider"),E=Symbol.for("react.context"),P=Symbol.for("react.forward_ref"),D=Symbol.for("react.suspense"),M=Symbol.for("react.suspense_list"),O=Symbol.for("react.memo"),T=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var A=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var L=Symbol.iterator;function z(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=L&&e[L]||e["@@iterator"])?e:null}var I,R=Object.assign;function B(e){if(void 0===I)try{throw Error()}catch(e){var n=e.stack.trim().match(/\n( *(at )?)/);I=n&&n[1]||""}return"\n"+I+e}var _=!1;function F(e,n){if(!e||_)return"";_=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(n)if(n=function(){throw Error()},Object.defineProperty(n.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(n,[])}catch(e){var r=e}Reflect.construct(e,[],n)}else{try{n.call()}catch(e){r=e}e.call(n.prototype)}else{try{throw Error()}catch(e){r=e}e()}}catch(n){if(n&&r&&"string"==typeof n.stack){for(var i=n.stack.split("\n"),o=r.stack.split("\n"),a=i.length-1,s=o.length-1;1<=a&&0<=s&&i[a]!==o[s];)s--;for(;1<=a&&0<=s;a--,s--)if(i[a]!==o[s]){if(1!==a||1!==s)do{if(a--,0>--s||i[a]!==o[s]){var l="\n"+i[a].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=a&&0<=s);break}}}finally{_=!1,Error.prepareStackTrace=t}return(e=e?e.displayName||e.name:"")?B(e):""}function U(e){switch(e.tag){case 5:return B(e.type);case 16:return B("Lazy");case 13:return B("Suspense");case 19:return B("SuspenseList");case 0:case 2:case 15:return e=F(e.type,!1);case 11:return e=F(e.type.render,!1);case 1:return e=F(e.type,!0);default:return""}}function H(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case j:return"Fragment";case w:return"Portal";case S:return"Profiler";case C:return"StrictMode";case D:return"Suspense";case M:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case E:return(e.displayName||"Context")+".Consumer";case N:return(e._context.displayName||"Context")+".Provider";case P:var n=e.render;return(e=e.displayName)||(e=""!==(e=n.displayName||n.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case O:return null!==(n=e.displayName||null)?n:H(e.type)||"Memo";case T:n=e._payload,e=e._init;try{return H(e(n))}catch(e){}}return null}function W(e){var n=e.type;switch(e.tag){case 24:return"Cache";case 9:return(n.displayName||"Context")+".Consumer";case 10:return(n._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=n.render).displayName||e.name||"",n.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return n;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return H(n);case 8:return n===C?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"==typeof n)return n.displayName||n.name||null;if("string"==typeof n)return n}return null}function V(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function q(e){var n=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===n||"radio"===n)}function $(e){e._valueTracker||(e._valueTracker=function(e){var n=q(e)?"checked":"value",t=Object.getOwnPropertyDescriptor(e.constructor.prototype,n),r=""+e[n];if(!e.hasOwnProperty(n)&&void 0!==t&&"function"==typeof t.get&&"function"==typeof t.set){var i=t.get,o=t.set;return Object.defineProperty(e,n,{configurable:!0,get:function(){return i.call(this)},set:function(e){r=""+e,o.call(this,e)}}),Object.defineProperty(e,n,{enumerable:t.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[n]}}}}(e))}function Y(e){if(!e)return!1;var n=e._valueTracker;if(!n)return!0;var t=n.getValue(),r="";return e&&(r=q(e)?e.checked?"true":"false":e.value),(e=r)!==t&&(n.setValue(e),!0)}function G(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(n){return e.body}}function K(e,n){var t=n.checked;return R({},n,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=t?t:e._wrapperState.initialChecked})}function Q(e,n){var t=null==n.defaultValue?"":n.defaultValue,r=null!=n.checked?n.checked:n.defaultChecked;t=V(null!=n.value?n.value:t),e._wrapperState={initialChecked:r,initialValue:t,controlled:"checkbox"===n.type||"radio"===n.type?null!=n.checked:null!=n.value}}function X(e,n){null!=(n=n.checked)&&x(e,"checked",n,!1)}function Z(e,n){X(e,n);var t=V(n.value),r=n.type;if(null!=t)"number"===r?(0===t&&""===e.value||e.value!=t)&&(e.value=""+t):e.value!==""+t&&(e.value=""+t);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");n.hasOwnProperty("value")?ee(e,n.type,t):n.hasOwnProperty("defaultValue")&&ee(e,n.type,V(n.defaultValue)),null==n.checked&&null!=n.defaultChecked&&(e.defaultChecked=!!n.defaultChecked)}function J(e,n,t){if(n.hasOwnProperty("value")||n.hasOwnProperty("defaultValue")){var r=n.type;if(!("submit"!==r&&"reset"!==r||void 0!==n.value&&null!==n.value))return;n=""+e._wrapperState.initialValue,t||n===e.value||(e.value=n),e.defaultValue=n}""!==(t=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==t&&(e.name=t)}function ee(e,n,t){"number"===n&&G(e.ownerDocument)===e||(null==t?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+t&&(e.defaultValue=""+t))}var ne=Array.isArray;function te(e,n,t,r){if(e=e.options,n){n={};for(var i=0;i<t.length;i++)n["$"+t[i]]=!0;for(t=0;t<e.length;t++)i=n.hasOwnProperty("$"+e[t].value),e[t].selected!==i&&(e[t].selected=i),i&&r&&(e[t].defaultSelected=!0)}else{for(t=""+V(t),n=null,i=0;i<e.length;i++){if(e[i].value===t)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0));null!==n||e[i].disabled||(n=e[i])}null!==n&&(n.selected=!0)}}function re(e,n){if(null!=n.dangerouslySetInnerHTML)throw Error(o(91));return R({},n,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ie(e,n){var t=n.value;if(null==t){if(t=n.children,n=n.defaultValue,null!=t){if(null!=n)throw Error(o(92));if(ne(t)){if(1<t.length)throw Error(o(93));t=t[0]}n=t}null==n&&(n=""),t=n}e._wrapperState={initialValue:V(t)}}function oe(e,n){var t=V(n.value),r=V(n.defaultValue);null!=t&&((t=""+t)!==e.value&&(e.value=t),null==n.defaultValue&&e.defaultValue!==t&&(e.defaultValue=t)),null!=r&&(e.defaultValue=""+r)}function ae(e){var n=e.textContent;n===e._wrapperState.initialValue&&""!==n&&null!==n&&(e.value=n)}function se(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function le(e,n){return null==e||"http://www.w3.org/1999/xhtml"===e?se(n):"http://www.w3.org/2000/svg"===e&&"foreignObject"===n?"http://www.w3.org/1999/xhtml":e}var ce,ue,de=(ue=function(e,n){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=n;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+n.valueOf().toString()+"</svg>",n=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;n.firstChild;)e.appendChild(n.firstChild)}},"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,n,t,r){MSApp.execUnsafeLocalFunction(function(){return ue(e,n)})}:ue);function me(e,n){if(n){var t=e.firstChild;if(t&&t===e.lastChild&&3===t.nodeType)return void(t.nodeValue=n)}e.textContent=n}var pe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ge=["Webkit","ms","Moz","O"];function he(e,n,t){return null==n||"boolean"==typeof n||""===n?"":t||"number"!=typeof n||0===n||pe.hasOwnProperty(e)&&pe[e]?(""+n).trim():n+"px"}function ve(e,n){for(var t in e=e.style,n)if(n.hasOwnProperty(t)){var r=0===t.indexOf("--"),i=he(t,n[t],r);"float"===t&&(t="cssFloat"),r?e.setProperty(t,i):e[t]=i}}Object.keys(pe).forEach(function(e){ge.forEach(function(n){n=n+e.charAt(0).toUpperCase()+e.substring(1),pe[n]=pe[e]})});var fe=R({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function be(e,n){if(n){if(fe[e]&&(null!=n.children||null!=n.dangerouslySetInnerHTML))throw Error(o(137,e));if(null!=n.dangerouslySetInnerHTML){if(null!=n.children)throw Error(o(60));if("object"!=typeof n.dangerouslySetInnerHTML||!("__html"in n.dangerouslySetInnerHTML))throw Error(o(61))}if(null!=n.style&&"object"!=typeof n.style)throw Error(o(62))}}function xe(e,n){if(-1===e.indexOf("-"))return"string"==typeof n.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ye=null;function ke(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var we=null,je=null,Ce=null;function Se(e){if(e=xi(e)){if("function"!=typeof we)throw Error(o(280));var n=e.stateNode;n&&(n=ki(n),we(e.stateNode,e.type,n))}}function Ne(e){je?Ce?Ce.push(e):Ce=[e]:je=e}function Ee(){if(je){var e=je,n=Ce;if(Ce=je=null,Se(e),n)for(e=0;e<n.length;e++)Se(n[e])}}function Pe(e,n){return e(n)}function De(){}var Me=!1;function Oe(e,n,t){if(Me)return e(n,t);Me=!0;try{return Pe(e,n,t)}finally{Me=!1,(null!==je||null!==Ce)&&(De(),Ee())}}function Te(e,n){var t=e.stateNode;if(null===t)return null;var r=ki(t);if(null===r)return null;t=r[n];e:switch(n){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(t&&"function"!=typeof t)throw Error(o(231,n,typeof t));return t}var Ae=!1;if(u)try{var Le={};Object.defineProperty(Le,"passive",{get:function(){Ae=!0}}),window.addEventListener("test",Le,Le),window.removeEventListener("test",Le,Le)}catch(ue){Ae=!1}function ze(e,n,t,r,i,o,a,s,l){var c=Array.prototype.slice.call(arguments,3);try{n.apply(t,c)}catch(e){this.onError(e)}}var Ie=!1,Re=null,Be=!1,_e=null,Fe={onError:function(e){Ie=!0,Re=e}};function Ue(e,n,t,r,i,o,a,s,l){Ie=!1,Re=null,ze.apply(Fe,arguments)}function He(e){var n=e,t=e;if(e.alternate)for(;n.return;)n=n.return;else{e=n;do{!!(4098&(n=e).flags)&&(t=n.return),e=n.return}while(e)}return 3===n.tag?t:null}function We(e){if(13===e.tag){var n=e.memoizedState;if(null===n&&(null!==(e=e.alternate)&&(n=e.memoizedState)),null!==n)return n.dehydrated}return null}function Ve(e){if(He(e)!==e)throw Error(o(188))}function qe(e){return null!==(e=function(e){var n=e.alternate;if(!n){if(null===(n=He(e)))throw Error(o(188));return n!==e?null:e}for(var t=e,r=n;;){var i=t.return;if(null===i)break;var a=i.alternate;if(null===a){if(null!==(r=i.return)){t=r;continue}break}if(i.child===a.child){for(a=i.child;a;){if(a===t)return Ve(i),e;if(a===r)return Ve(i),n;a=a.sibling}throw Error(o(188))}if(t.return!==r.return)t=i,r=a;else{for(var s=!1,l=i.child;l;){if(l===t){s=!0,t=i,r=a;break}if(l===r){s=!0,r=i,t=a;break}l=l.sibling}if(!s){for(l=a.child;l;){if(l===t){s=!0,t=a,r=i;break}if(l===r){s=!0,r=a,t=i;break}l=l.sibling}if(!s)throw Error(o(189))}}if(t.alternate!==r)throw Error(o(190))}if(3!==t.tag)throw Error(o(188));return t.stateNode.current===t?e:n}(e))?$e(e):null}function $e(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var n=$e(e);if(null!==n)return n;e=e.sibling}return null}var Ye=i.unstable_scheduleCallback,Ge=i.unstable_cancelCallback,Ke=i.unstable_shouldYield,Qe=i.unstable_requestPaint,Xe=i.unstable_now,Ze=i.unstable_getCurrentPriorityLevel,Je=i.unstable_ImmediatePriority,en=i.unstable_UserBlockingPriority,nn=i.unstable_NormalPriority,tn=i.unstable_LowPriority,rn=i.unstable_IdlePriority,on=null,an=null;var sn=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(ln(e)/cn|0)|0},ln=Math.log,cn=Math.LN2;var un=64,dn=4194304;function mn(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function pn(e,n){var t=e.pendingLanes;if(0===t)return 0;var r=0,i=e.suspendedLanes,o=e.pingedLanes,a=268435455&t;if(0!==a){var s=a&~i;0!==s?r=mn(s):0!==(o&=a)&&(r=mn(o))}else 0!==(a=t&~i)?r=mn(a):0!==o&&(r=mn(o));if(0===r)return 0;if(0!==n&&n!==r&&0===(n&i)&&((i=r&-r)>=(o=n&-n)||16===i&&4194240&o))return n;if(4&r&&(r|=16&t),0!==(n=e.entangledLanes))for(e=e.entanglements,n&=r;0<n;)i=1<<(t=31-sn(n)),r|=e[t],n&=~i;return r}function gn(e,n){switch(e){case 1:case 2:case 4:return n+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n+5e3;default:return-1}}function hn(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function vn(){var e=un;return!(4194240&(un<<=1))&&(un=64),e}function fn(e){for(var n=[],t=0;31>t;t++)n.push(e);return n}function bn(e,n,t){e.pendingLanes|=n,536870912!==n&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[n=31-sn(n)]=t}function xn(e,n){var t=e.entangledLanes|=n;for(e=e.entanglements;t;){var r=31-sn(t),i=1<<r;i&n|e[r]&n&&(e[r]|=n),t&=~i}}var yn=0;function kn(e){return 1<(e&=-e)?4<e?268435455&e?16:536870912:4:1}var wn,jn,Cn,Sn,Nn,En=!1,Pn=[],Dn=null,Mn=null,On=null,Tn=new Map,An=new Map,Ln=[],zn="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function In(e,n){switch(e){case"focusin":case"focusout":Dn=null;break;case"dragenter":case"dragleave":Mn=null;break;case"mouseover":case"mouseout":On=null;break;case"pointerover":case"pointerout":Tn.delete(n.pointerId);break;case"gotpointercapture":case"lostpointercapture":An.delete(n.pointerId)}}function Rn(e,n,t,r,i,o){return null===e||e.nativeEvent!==o?(e={blockedOn:n,domEventName:t,eventSystemFlags:r,nativeEvent:o,targetContainers:[i]},null!==n&&(null!==(n=xi(n))&&jn(n)),e):(e.eventSystemFlags|=r,n=e.targetContainers,null!==i&&-1===n.indexOf(i)&&n.push(i),e)}function Bn(e){var n=bi(e.target);if(null!==n){var t=He(n);if(null!==t)if(13===(n=t.tag)){if(null!==(n=We(t)))return e.blockedOn=n,void Nn(e.priority,function(){Cn(t)})}else if(3===n&&t.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===t.tag?t.stateNode.containerInfo:null)}e.blockedOn=null}function _n(e){if(null!==e.blockedOn)return!1;for(var n=e.targetContainers;0<n.length;){var t=Qn(e.domEventName,e.eventSystemFlags,n[0],e.nativeEvent);if(null!==t)return null!==(n=xi(t))&&jn(n),e.blockedOn=t,!1;var r=new(t=e.nativeEvent).constructor(t.type,t);ye=r,t.target.dispatchEvent(r),ye=null,n.shift()}return!0}function Fn(e,n,t){_n(e)&&t.delete(n)}function Un(){En=!1,null!==Dn&&_n(Dn)&&(Dn=null),null!==Mn&&_n(Mn)&&(Mn=null),null!==On&&_n(On)&&(On=null),Tn.forEach(Fn),An.forEach(Fn)}function Hn(e,n){e.blockedOn===n&&(e.blockedOn=null,En||(En=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,Un)))}function Wn(e){function n(n){return Hn(n,e)}if(0<Pn.length){Hn(Pn[0],e);for(var t=1;t<Pn.length;t++){var r=Pn[t];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==Dn&&Hn(Dn,e),null!==Mn&&Hn(Mn,e),null!==On&&Hn(On,e),Tn.forEach(n),An.forEach(n),t=0;t<Ln.length;t++)(r=Ln[t]).blockedOn===e&&(r.blockedOn=null);for(;0<Ln.length&&null===(t=Ln[0]).blockedOn;)Bn(t),null===t.blockedOn&&Ln.shift()}var Vn=y.ReactCurrentBatchConfig,qn=!0;function $n(e,n,t,r){var i=yn,o=Vn.transition;Vn.transition=null;try{yn=1,Gn(e,n,t,r)}finally{yn=i,Vn.transition=o}}function Yn(e,n,t,r){var i=yn,o=Vn.transition;Vn.transition=null;try{yn=4,Gn(e,n,t,r)}finally{yn=i,Vn.transition=o}}function Gn(e,n,t,r){if(qn){var i=Qn(e,n,t,r);if(null===i)Vr(e,n,r,Kn,t),In(e,r);else if(function(e,n,t,r,i){switch(n){case"focusin":return Dn=Rn(Dn,e,n,t,r,i),!0;case"dragenter":return Mn=Rn(Mn,e,n,t,r,i),!0;case"mouseover":return On=Rn(On,e,n,t,r,i),!0;case"pointerover":var o=i.pointerId;return Tn.set(o,Rn(Tn.get(o)||null,e,n,t,r,i)),!0;case"gotpointercapture":return o=i.pointerId,An.set(o,Rn(An.get(o)||null,e,n,t,r,i)),!0}return!1}(i,e,n,t,r))r.stopPropagation();else if(In(e,r),4&n&&-1<zn.indexOf(e)){for(;null!==i;){var o=xi(i);if(null!==o&&wn(o),null===(o=Qn(e,n,t,r))&&Vr(e,n,r,Kn,t),o===i)break;i=o}null!==i&&r.stopPropagation()}else Vr(e,n,r,null,t)}}var Kn=null;function Qn(e,n,t,r){if(Kn=null,null!==(e=bi(e=ke(r))))if(null===(n=He(e)))e=null;else if(13===(t=n.tag)){if(null!==(e=We(n)))return e;e=null}else if(3===t){if(n.stateNode.current.memoizedState.isDehydrated)return 3===n.tag?n.stateNode.containerInfo:null;e=null}else n!==e&&(e=null);return Kn=e,null}function Xn(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ze()){case Je:return 1;case en:return 4;case nn:case tn:return 16;case rn:return 536870912;default:return 16}default:return 16}}var Zn=null,Jn=null,et=null;function nt(){if(et)return et;var e,n,t=Jn,r=t.length,i="value"in Zn?Zn.value:Zn.textContent,o=i.length;for(e=0;e<r&&t[e]===i[e];e++);var a=r-e;for(n=1;n<=a&&t[r-n]===i[o-n];n++);return et=i.slice(e,1<n?1-n:void 0)}function tt(e){var n=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===n&&(e=13):e=n,10===e&&(e=13),32<=e||13===e?e:0}function rt(){return!0}function it(){return!1}function ot(e){function n(n,t,r,i,o){for(var a in this._reactName=n,this._targetInst=r,this.type=t,this.nativeEvent=i,this.target=o,this.currentTarget=null,e)e.hasOwnProperty(a)&&(n=e[a],this[a]=n?n(i):i[a]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?rt:it,this.isPropagationStopped=it,this}return R(n.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=rt)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=rt)},persist:function(){},isPersistent:rt}),n}var at,st,lt,ct={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ut=ot(ct),dt=R({},ct,{view:0,detail:0}),mt=ot(dt),pt=R({},dt,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:St,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==lt&&(lt&&"mousemove"===e.type?(at=e.screenX-lt.screenX,st=e.screenY-lt.screenY):st=at=0,lt=e),at)},movementY:function(e){return"movementY"in e?e.movementY:st}}),gt=ot(pt),ht=ot(R({},pt,{dataTransfer:0})),vt=ot(R({},dt,{relatedTarget:0})),ft=ot(R({},ct,{animationName:0,elapsedTime:0,pseudoElement:0})),bt=R({},ct,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),xt=ot(bt),yt=ot(R({},ct,{data:0})),kt={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},wt={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},jt={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ct(e){var n=this.nativeEvent;return n.getModifierState?n.getModifierState(e):!!(e=jt[e])&&!!n[e]}function St(){return Ct}var Nt=R({},dt,{key:function(e){if(e.key){var n=kt[e.key]||e.key;if("Unidentified"!==n)return n}return"keypress"===e.type?13===(e=tt(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?wt[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:St,charCode:function(e){return"keypress"===e.type?tt(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tt(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Et=ot(Nt),Pt=ot(R({},pt,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Dt=ot(R({},dt,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:St})),Mt=ot(R({},ct,{propertyName:0,elapsedTime:0,pseudoElement:0})),Ot=R({},pt,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Tt=ot(Ot),At=[9,13,27,32],Lt=u&&"CompositionEvent"in window,zt=null;u&&"documentMode"in document&&(zt=document.documentMode);var It=u&&"TextEvent"in window&&!zt,Rt=u&&(!Lt||zt&&8<zt&&11>=zt),Bt=String.fromCharCode(32),_t=!1;function Ft(e,n){switch(e){case"keyup":return-1!==At.indexOf(n.keyCode);case"keydown":return 229!==n.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ut(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var Ht=!1;var Wt={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Vt(e){var n=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===n?!!Wt[e.type]:"textarea"===n}function qt(e,n,t,r){Ne(r),0<(n=$r(n,"onChange")).length&&(t=new ut("onChange","change",null,t,r),e.push({event:t,listeners:n}))}var $t=null,Yt=null;function Gt(e){Br(e,0)}function Kt(e){if(Y(yi(e)))return e}function Qt(e,n){if("change"===e)return n}var Xt=!1;if(u){var Zt;if(u){var Jt="oninput"in document;if(!Jt){var er=document.createElement("div");er.setAttribute("oninput","return;"),Jt="function"==typeof er.oninput}Zt=Jt}else Zt=!1;Xt=Zt&&(!document.documentMode||9<document.documentMode)}function nr(){$t&&($t.detachEvent("onpropertychange",tr),Yt=$t=null)}function tr(e){if("value"===e.propertyName&&Kt(Yt)){var n=[];qt(n,Yt,e,ke(e)),Oe(Gt,n)}}function rr(e,n,t){"focusin"===e?(nr(),Yt=t,($t=n).attachEvent("onpropertychange",tr)):"focusout"===e&&nr()}function ir(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Kt(Yt)}function or(e,n){if("click"===e)return Kt(n)}function ar(e,n){if("input"===e||"change"===e)return Kt(n)}var sr="function"==typeof Object.is?Object.is:function(e,n){return e===n&&(0!==e||1/e==1/n)||e!=e&&n!=n};function lr(e,n){if(sr(e,n))return!0;if("object"!=typeof e||null===e||"object"!=typeof n||null===n)return!1;var t=Object.keys(e),r=Object.keys(n);if(t.length!==r.length)return!1;for(r=0;r<t.length;r++){var i=t[r];if(!d.call(n,i)||!sr(e[i],n[i]))return!1}return!0}function cr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ur(e,n){var t,r=cr(e);for(e=0;r;){if(3===r.nodeType){if(t=e+r.textContent.length,e<=n&&t>=n)return{node:r,offset:n-e};e=t}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=cr(r)}}function dr(e,n){return!(!e||!n)&&(e===n||(!e||3!==e.nodeType)&&(n&&3===n.nodeType?dr(e,n.parentNode):"contains"in e?e.contains(n):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(n))))}function mr(){for(var e=window,n=G();n instanceof e.HTMLIFrameElement;){try{var t="string"==typeof n.contentWindow.location.href}catch(e){t=!1}if(!t)break;n=G((e=n.contentWindow).document)}return n}function pr(e){var n=e&&e.nodeName&&e.nodeName.toLowerCase();return n&&("input"===n&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===n||"true"===e.contentEditable)}function gr(e){var n=mr(),t=e.focusedElem,r=e.selectionRange;if(n!==t&&t&&t.ownerDocument&&dr(t.ownerDocument.documentElement,t)){if(null!==r&&pr(t))if(n=r.start,void 0===(e=r.end)&&(e=n),"selectionStart"in t)t.selectionStart=n,t.selectionEnd=Math.min(e,t.value.length);else if((e=(n=t.ownerDocument||document)&&n.defaultView||window).getSelection){e=e.getSelection();var i=t.textContent.length,o=Math.min(r.start,i);r=void 0===r.end?o:Math.min(r.end,i),!e.extend&&o>r&&(i=r,r=o,o=i),i=ur(t,o);var a=ur(t,r);i&&a&&(1!==e.rangeCount||e.anchorNode!==i.node||e.anchorOffset!==i.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&((n=n.createRange()).setStart(i.node,i.offset),e.removeAllRanges(),o>r?(e.addRange(n),e.extend(a.node,a.offset)):(n.setEnd(a.node,a.offset),e.addRange(n)))}for(n=[],e=t;e=e.parentNode;)1===e.nodeType&&n.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"==typeof t.focus&&t.focus(),t=0;t<n.length;t++)(e=n[t]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var hr=u&&"documentMode"in document&&11>=document.documentMode,vr=null,fr=null,br=null,xr=!1;function yr(e,n,t){var r=t.window===t?t.document:9===t.nodeType?t:t.ownerDocument;xr||null==vr||vr!==G(r)||("selectionStart"in(r=vr)&&pr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},br&&lr(br,r)||(br=r,0<(r=$r(fr,"onSelect")).length&&(n=new ut("onSelect","select",null,n,t),e.push({event:n,listeners:r}),n.target=vr)))}function kr(e,n){var t={};return t[e.toLowerCase()]=n.toLowerCase(),t["Webkit"+e]="webkit"+n,t["Moz"+e]="moz"+n,t}var wr={animationend:kr("Animation","AnimationEnd"),animationiteration:kr("Animation","AnimationIteration"),animationstart:kr("Animation","AnimationStart"),transitionend:kr("Transition","TransitionEnd")},jr={},Cr={};function Sr(e){if(jr[e])return jr[e];if(!wr[e])return e;var n,t=wr[e];for(n in t)if(t.hasOwnProperty(n)&&n in Cr)return jr[e]=t[n];return e}u&&(Cr=document.createElement("div").style,"AnimationEvent"in window||(delete wr.animationend.animation,delete wr.animationiteration.animation,delete wr.animationstart.animation),"TransitionEvent"in window||delete wr.transitionend.transition);var Nr=Sr("animationend"),Er=Sr("animationiteration"),Pr=Sr("animationstart"),Dr=Sr("transitionend"),Mr=new Map,Or="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Tr(e,n){Mr.set(e,n),l(n,[e])}for(var Ar=0;Ar<Or.length;Ar++){var Lr=Or[Ar];Tr(Lr.toLowerCase(),"on"+(Lr[0].toUpperCase()+Lr.slice(1)))}Tr(Nr,"onAnimationEnd"),Tr(Er,"onAnimationIteration"),Tr(Pr,"onAnimationStart"),Tr("dblclick","onDoubleClick"),Tr("focusin","onFocus"),Tr("focusout","onBlur"),Tr(Dr,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var zr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ir=new Set("cancel close invalid load scroll toggle".split(" ").concat(zr));function Rr(e,n,t){var r=e.type||"unknown-event";e.currentTarget=t,function(e,n,t,r,i,a,s,l,c){if(Ue.apply(this,arguments),Ie){if(!Ie)throw Error(o(198));var u=Re;Ie=!1,Re=null,Be||(Be=!0,_e=u)}}(r,n,void 0,e),e.currentTarget=null}function Br(e,n){n=!!(4&n);for(var t=0;t<e.length;t++){var r=e[t],i=r.event;r=r.listeners;e:{var o=void 0;if(n)for(var a=r.length-1;0<=a;a--){var s=r[a],l=s.instance,c=s.currentTarget;if(s=s.listener,l!==o&&i.isPropagationStopped())break e;Rr(i,s,c),o=l}else for(a=0;a<r.length;a++){if(l=(s=r[a]).instance,c=s.currentTarget,s=s.listener,l!==o&&i.isPropagationStopped())break e;Rr(i,s,c),o=l}}}if(Be)throw e=_e,Be=!1,_e=null,e}function _r(e,n){var t=n[hi];void 0===t&&(t=n[hi]=new Set);var r=e+"__bubble";t.has(r)||(Wr(n,e,2,!1),t.add(r))}function Fr(e,n,t){var r=0;n&&(r|=4),Wr(t,e,r,n)}var Ur="_reactListening"+Math.random().toString(36).slice(2);function Hr(e){if(!e[Ur]){e[Ur]=!0,a.forEach(function(n){"selectionchange"!==n&&(Ir.has(n)||Fr(n,!1,e),Fr(n,!0,e))});var n=9===e.nodeType?e:e.ownerDocument;null===n||n[Ur]||(n[Ur]=!0,Fr("selectionchange",!1,n))}}function Wr(e,n,t,r){switch(Xn(n)){case 1:var i=$n;break;case 4:i=Yn;break;default:i=Gn}t=i.bind(null,n,t,e),i=void 0,!Ae||"touchstart"!==n&&"touchmove"!==n&&"wheel"!==n||(i=!0),r?void 0!==i?e.addEventListener(n,t,{capture:!0,passive:i}):e.addEventListener(n,t,!0):void 0!==i?e.addEventListener(n,t,{passive:i}):e.addEventListener(n,t,!1)}function Vr(e,n,t,r,i){var o=r;if(!(1&n||2&n||null===r))e:for(;;){if(null===r)return;var a=r.tag;if(3===a||4===a){var s=r.stateNode.containerInfo;if(s===i||8===s.nodeType&&s.parentNode===i)break;if(4===a)for(a=r.return;null!==a;){var l=a.tag;if((3===l||4===l)&&((l=a.stateNode.containerInfo)===i||8===l.nodeType&&l.parentNode===i))return;a=a.return}for(;null!==s;){if(null===(a=bi(s)))return;if(5===(l=a.tag)||6===l){r=o=a;continue e}s=s.parentNode}}r=r.return}Oe(function(){var r=o,i=ke(t),a=[];e:{var s=Mr.get(e);if(void 0!==s){var l=ut,c=e;switch(e){case"keypress":if(0===tt(t))break e;case"keydown":case"keyup":l=Et;break;case"focusin":c="focus",l=vt;break;case"focusout":c="blur",l=vt;break;case"beforeblur":case"afterblur":l=vt;break;case"click":if(2===t.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=gt;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=ht;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Dt;break;case Nr:case Er:case Pr:l=ft;break;case Dr:l=Mt;break;case"scroll":l=mt;break;case"wheel":l=Tt;break;case"copy":case"cut":case"paste":l=xt;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=Pt}var u=!!(4&n),d=!u&&"scroll"===e,m=u?null!==s?s+"Capture":null:s;u=[];for(var p,g=r;null!==g;){var h=(p=g).stateNode;if(5===p.tag&&null!==h&&(p=h,null!==m&&(null!=(h=Te(g,m))&&u.push(qr(g,h,p)))),d)break;g=g.return}0<u.length&&(s=new l(s,c,null,t,i),a.push({event:s,listeners:u}))}}if(!(7&n)){if(l="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||t===ye||!(c=t.relatedTarget||t.fromElement)||!bi(c)&&!c[gi])&&(l||s)&&(s=i.window===i?i:(s=i.ownerDocument)?s.defaultView||s.parentWindow:window,l?(l=r,null!==(c=(c=t.relatedTarget||t.toElement)?bi(c):null)&&(c!==(d=He(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=r),l!==c)){if(u=gt,h="onMouseLeave",m="onMouseEnter",g="mouse","pointerout"!==e&&"pointerover"!==e||(u=Pt,h="onPointerLeave",m="onPointerEnter",g="pointer"),d=null==l?s:yi(l),p=null==c?s:yi(c),(s=new u(h,g+"leave",l,t,i)).target=d,s.relatedTarget=p,h=null,bi(i)===r&&((u=new u(m,g+"enter",c,t,i)).target=p,u.relatedTarget=d,h=u),d=h,l&&c)e:{for(m=c,g=0,p=u=l;p;p=Yr(p))g++;for(p=0,h=m;h;h=Yr(h))p++;for(;0<g-p;)u=Yr(u),g--;for(;0<p-g;)m=Yr(m),p--;for(;g--;){if(u===m||null!==m&&u===m.alternate)break e;u=Yr(u),m=Yr(m)}u=null}else u=null;null!==l&&Gr(a,s,l,u,!1),null!==c&&null!==d&&Gr(a,d,c,u,!0)}if("select"===(l=(s=r?yi(r):window).nodeName&&s.nodeName.toLowerCase())||"input"===l&&"file"===s.type)var v=Qt;else if(Vt(s))if(Xt)v=ar;else{v=ir;var f=rr}else(l=s.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(v=or);switch(v&&(v=v(e,r))?qt(a,v,t,i):(f&&f(e,s,r),"focusout"===e&&(f=s._wrapperState)&&f.controlled&&"number"===s.type&&ee(s,"number",s.value)),f=r?yi(r):window,e){case"focusin":(Vt(f)||"true"===f.contentEditable)&&(vr=f,fr=r,br=null);break;case"focusout":br=fr=vr=null;break;case"mousedown":xr=!0;break;case"contextmenu":case"mouseup":case"dragend":xr=!1,yr(a,t,i);break;case"selectionchange":if(hr)break;case"keydown":case"keyup":yr(a,t,i)}var b;if(Lt)e:{switch(e){case"compositionstart":var x="onCompositionStart";break e;case"compositionend":x="onCompositionEnd";break e;case"compositionupdate":x="onCompositionUpdate";break e}x=void 0}else Ht?Ft(e,t)&&(x="onCompositionEnd"):"keydown"===e&&229===t.keyCode&&(x="onCompositionStart");x&&(Rt&&"ko"!==t.locale&&(Ht||"onCompositionStart"!==x?"onCompositionEnd"===x&&Ht&&(b=nt()):(Jn="value"in(Zn=i)?Zn.value:Zn.textContent,Ht=!0)),0<(f=$r(r,x)).length&&(x=new yt(x,e,null,t,i),a.push({event:x,listeners:f}),b?x.data=b:null!==(b=Ut(t))&&(x.data=b))),(b=It?function(e,n){switch(e){case"compositionend":return Ut(n);case"keypress":return 32!==n.which?null:(_t=!0,Bt);case"textInput":return(e=n.data)===Bt&&_t?null:e;default:return null}}(e,t):function(e,n){if(Ht)return"compositionend"===e||!Lt&&Ft(e,n)?(e=nt(),et=Jn=Zn=null,Ht=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(n.ctrlKey||n.altKey||n.metaKey)||n.ctrlKey&&n.altKey){if(n.char&&1<n.char.length)return n.char;if(n.which)return String.fromCharCode(n.which)}return null;case"compositionend":return Rt&&"ko"!==n.locale?null:n.data}}(e,t))&&(0<(r=$r(r,"onBeforeInput")).length&&(i=new yt("onBeforeInput","beforeinput",null,t,i),a.push({event:i,listeners:r}),i.data=b))}Br(a,n)})}function qr(e,n,t){return{instance:e,listener:n,currentTarget:t}}function $r(e,n){for(var t=n+"Capture",r=[];null!==e;){var i=e,o=i.stateNode;5===i.tag&&null!==o&&(i=o,null!=(o=Te(e,t))&&r.unshift(qr(e,o,i)),null!=(o=Te(e,n))&&r.push(qr(e,o,i))),e=e.return}return r}function Yr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Gr(e,n,t,r,i){for(var o=n._reactName,a=[];null!==t&&t!==r;){var s=t,l=s.alternate,c=s.stateNode;if(null!==l&&l===r)break;5===s.tag&&null!==c&&(s=c,i?null!=(l=Te(t,o))&&a.unshift(qr(t,l,s)):i||null!=(l=Te(t,o))&&a.push(qr(t,l,s))),t=t.return}0!==a.length&&e.push({event:n,listeners:a})}var Kr=/\r\n?/g,Qr=/\u0000|\uFFFD/g;function Xr(e){return("string"==typeof e?e:""+e).replace(Kr,"\n").replace(Qr,"")}function Zr(e,n,t){if(n=Xr(n),Xr(e)!==n&&t)throw Error(o(425))}function Jr(){}var ei=null,ni=null;function ti(e,n){return"textarea"===e||"noscript"===e||"string"==typeof n.children||"number"==typeof n.children||"object"==typeof n.dangerouslySetInnerHTML&&null!==n.dangerouslySetInnerHTML&&null!=n.dangerouslySetInnerHTML.__html}var ri="function"==typeof setTimeout?setTimeout:void 0,ii="function"==typeof clearTimeout?clearTimeout:void 0,oi="function"==typeof Promise?Promise:void 0,ai="function"==typeof queueMicrotask?queueMicrotask:void 0!==oi?function(e){return oi.resolve(null).then(e).catch(si)}:ri;function si(e){setTimeout(function(){throw e})}function li(e,n){var t=n,r=0;do{var i=t.nextSibling;if(e.removeChild(t),i&&8===i.nodeType)if("/$"===(t=i.data)){if(0===r)return e.removeChild(i),void Wn(n);r--}else"$"!==t&&"$?"!==t&&"$!"!==t||r++;t=i}while(t);Wn(n)}function ci(e){for(;null!=e;e=e.nextSibling){var n=e.nodeType;if(1===n||3===n)break;if(8===n){if("$"===(n=e.data)||"$!"===n||"$?"===n)break;if("/$"===n)return null}}return e}function ui(e){e=e.previousSibling;for(var n=0;e;){if(8===e.nodeType){var t=e.data;if("$"===t||"$!"===t||"$?"===t){if(0===n)return e;n--}else"/$"===t&&n++}e=e.previousSibling}return null}var di=Math.random().toString(36).slice(2),mi="__reactFiber$"+di,pi="__reactProps$"+di,gi="__reactContainer$"+di,hi="__reactEvents$"+di,vi="__reactListeners$"+di,fi="__reactHandles$"+di;function bi(e){var n=e[mi];if(n)return n;for(var t=e.parentNode;t;){if(n=t[gi]||t[mi]){if(t=n.alternate,null!==n.child||null!==t&&null!==t.child)for(e=ui(e);null!==e;){if(t=e[mi])return t;e=ui(e)}return n}t=(e=t).parentNode}return null}function xi(e){return!(e=e[mi]||e[gi])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function yi(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(o(33))}function ki(e){return e[pi]||null}var wi=[],ji=-1;function Ci(e){return{current:e}}function Si(e){0>ji||(e.current=wi[ji],wi[ji]=null,ji--)}function Ni(e,n){ji++,wi[ji]=e.current,e.current=n}var Ei={},Pi=Ci(Ei),Di=Ci(!1),Mi=Ei;function Oi(e,n){var t=e.type.contextTypes;if(!t)return Ei;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===n)return r.__reactInternalMemoizedMaskedChildContext;var i,o={};for(i in t)o[i]=n[i];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=n,e.__reactInternalMemoizedMaskedChildContext=o),o}function Ti(e){return null!=(e=e.childContextTypes)}function Ai(){Si(Di),Si(Pi)}function Li(e,n,t){if(Pi.current!==Ei)throw Error(o(168));Ni(Pi,n),Ni(Di,t)}function zi(e,n,t){var r=e.stateNode;if(n=n.childContextTypes,"function"!=typeof r.getChildContext)return t;for(var i in r=r.getChildContext())if(!(i in n))throw Error(o(108,W(e)||"Unknown",i));return R({},t,r)}function Ii(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ei,Mi=Pi.current,Ni(Pi,e),Ni(Di,Di.current),!0}function Ri(e,n,t){var r=e.stateNode;if(!r)throw Error(o(169));t?(e=zi(e,n,Mi),r.__reactInternalMemoizedMergedChildContext=e,Si(Di),Si(Pi),Ni(Pi,e)):Si(Di),Ni(Di,t)}var Bi=null,_i=!1,Fi=!1;function Ui(e){null===Bi?Bi=[e]:Bi.push(e)}function Hi(){if(!Fi&&null!==Bi){Fi=!0;var e=0,n=yn;try{var t=Bi;for(yn=1;e<t.length;e++){var r=t[e];do{r=r(!0)}while(null!==r)}Bi=null,_i=!1}catch(n){throw null!==Bi&&(Bi=Bi.slice(e+1)),Ye(Je,Hi),n}finally{yn=n,Fi=!1}}return null}var Wi=[],Vi=0,qi=null,$i=0,Yi=[],Gi=0,Ki=null,Qi=1,Xi="";function Zi(e,n){Wi[Vi++]=$i,Wi[Vi++]=qi,qi=e,$i=n}function Ji(e,n,t){Yi[Gi++]=Qi,Yi[Gi++]=Xi,Yi[Gi++]=Ki,Ki=e;var r=Qi;e=Xi;var i=32-sn(r)-1;r&=~(1<<i),t+=1;var o=32-sn(n)+i;if(30<o){var a=i-i%5;o=(r&(1<<a)-1).toString(32),r>>=a,i-=a,Qi=1<<32-sn(n)+i|t<<i|r,Xi=o+e}else Qi=1<<o|t<<i|r,Xi=e}function eo(e){null!==e.return&&(Zi(e,1),Ji(e,1,0))}function no(e){for(;e===qi;)qi=Wi[--Vi],Wi[Vi]=null,$i=Wi[--Vi],Wi[Vi]=null;for(;e===Ki;)Ki=Yi[--Gi],Yi[Gi]=null,Xi=Yi[--Gi],Yi[Gi]=null,Qi=Yi[--Gi],Yi[Gi]=null}var to=null,ro=null,io=!1,oo=null;function ao(e,n){var t=Mc(5,null,null,0);t.elementType="DELETED",t.stateNode=n,t.return=e,null===(n=e.deletions)?(e.deletions=[t],e.flags|=16):n.push(t)}function so(e,n){switch(e.tag){case 5:var t=e.type;return null!==(n=1!==n.nodeType||t.toLowerCase()!==n.nodeName.toLowerCase()?null:n)&&(e.stateNode=n,to=e,ro=ci(n.firstChild),!0);case 6:return null!==(n=""===e.pendingProps||3!==n.nodeType?null:n)&&(e.stateNode=n,to=e,ro=null,!0);case 13:return null!==(n=8!==n.nodeType?null:n)&&(t=null!==Ki?{id:Qi,overflow:Xi}:null,e.memoizedState={dehydrated:n,treeContext:t,retryLane:1073741824},(t=Mc(18,null,null,0)).stateNode=n,t.return=e,e.child=t,to=e,ro=null,!0);default:return!1}}function lo(e){return!(!(1&e.mode)||128&e.flags)}function co(e){if(io){var n=ro;if(n){var t=n;if(!so(e,n)){if(lo(e))throw Error(o(418));n=ci(t.nextSibling);var r=to;n&&so(e,n)?ao(r,t):(e.flags=-4097&e.flags|2,io=!1,to=e)}}else{if(lo(e))throw Error(o(418));e.flags=-4097&e.flags|2,io=!1,to=e}}}function uo(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;to=e}function mo(e){if(e!==to)return!1;if(!io)return uo(e),io=!0,!1;var n;if((n=3!==e.tag)&&!(n=5!==e.tag)&&(n="head"!==(n=e.type)&&"body"!==n&&!ti(e.type,e.memoizedProps)),n&&(n=ro)){if(lo(e))throw po(),Error(o(418));for(;n;)ao(e,n),n=ci(n.nextSibling)}if(uo(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(o(317));e:{for(e=e.nextSibling,n=0;e;){if(8===e.nodeType){var t=e.data;if("/$"===t){if(0===n){ro=ci(e.nextSibling);break e}n--}else"$"!==t&&"$!"!==t&&"$?"!==t||n++}e=e.nextSibling}ro=null}}else ro=to?ci(e.stateNode.nextSibling):null;return!0}function po(){for(var e=ro;e;)e=ci(e.nextSibling)}function go(){ro=to=null,io=!1}function ho(e){null===oo?oo=[e]:oo.push(e)}var vo=y.ReactCurrentBatchConfig;function fo(e,n,t){if(null!==(e=t.ref)&&"function"!=typeof e&&"object"!=typeof e){if(t._owner){if(t=t._owner){if(1!==t.tag)throw Error(o(309));var r=t.stateNode}if(!r)throw Error(o(147,e));var i=r,a=""+e;return null!==n&&null!==n.ref&&"function"==typeof n.ref&&n.ref._stringRef===a?n.ref:(n=function(e){var n=i.refs;null===e?delete n[a]:n[a]=e},n._stringRef=a,n)}if("string"!=typeof e)throw Error(o(284));if(!t._owner)throw Error(o(290,e))}return e}function bo(e,n){throw e=Object.prototype.toString.call(n),Error(o(31,"[object Object]"===e?"object with keys {"+Object.keys(n).join(", ")+"}":e))}function xo(e){return(0,e._init)(e._payload)}function yo(e){function n(n,t){if(e){var r=n.deletions;null===r?(n.deletions=[t],n.flags|=16):r.push(t)}}function t(t,r){if(!e)return null;for(;null!==r;)n(t,r),r=r.sibling;return null}function r(e,n){for(e=new Map;null!==n;)null!==n.key?e.set(n.key,n):e.set(n.index,n),n=n.sibling;return e}function i(e,n){return(e=Tc(e,n)).index=0,e.sibling=null,e}function a(n,t,r){return n.index=r,e?null!==(r=n.alternate)?(r=r.index)<t?(n.flags|=2,t):r:(n.flags|=2,t):(n.flags|=1048576,t)}function s(n){return e&&null===n.alternate&&(n.flags|=2),n}function l(e,n,t,r){return null===n||6!==n.tag?((n=Ic(t,e.mode,r)).return=e,n):((n=i(n,t)).return=e,n)}function c(e,n,t,r){var o=t.type;return o===j?d(e,n,t.props.children,r,t.key):null!==n&&(n.elementType===o||"object"==typeof o&&null!==o&&o.$$typeof===T&&xo(o)===n.type)?((r=i(n,t.props)).ref=fo(e,n,t),r.return=e,r):((r=Ac(t.type,t.key,t.props,null,e.mode,r)).ref=fo(e,n,t),r.return=e,r)}function u(e,n,t,r){return null===n||4!==n.tag||n.stateNode.containerInfo!==t.containerInfo||n.stateNode.implementation!==t.implementation?((n=Rc(t,e.mode,r)).return=e,n):((n=i(n,t.children||[])).return=e,n)}function d(e,n,t,r,o){return null===n||7!==n.tag?((n=Lc(t,e.mode,r,o)).return=e,n):((n=i(n,t)).return=e,n)}function m(e,n,t){if("string"==typeof n&&""!==n||"number"==typeof n)return(n=Ic(""+n,e.mode,t)).return=e,n;if("object"==typeof n&&null!==n){switch(n.$$typeof){case k:return(t=Ac(n.type,n.key,n.props,null,e.mode,t)).ref=fo(e,null,n),t.return=e,t;case w:return(n=Rc(n,e.mode,t)).return=e,n;case T:return m(e,(0,n._init)(n._payload),t)}if(ne(n)||z(n))return(n=Lc(n,e.mode,t,null)).return=e,n;bo(e,n)}return null}function p(e,n,t,r){var i=null!==n?n.key:null;if("string"==typeof t&&""!==t||"number"==typeof t)return null!==i?null:l(e,n,""+t,r);if("object"==typeof t&&null!==t){switch(t.$$typeof){case k:return t.key===i?c(e,n,t,r):null;case w:return t.key===i?u(e,n,t,r):null;case T:return p(e,n,(i=t._init)(t._payload),r)}if(ne(t)||z(t))return null!==i?null:d(e,n,t,r,null);bo(e,t)}return null}function g(e,n,t,r,i){if("string"==typeof r&&""!==r||"number"==typeof r)return l(n,e=e.get(t)||null,""+r,i);if("object"==typeof r&&null!==r){switch(r.$$typeof){case k:return c(n,e=e.get(null===r.key?t:r.key)||null,r,i);case w:return u(n,e=e.get(null===r.key?t:r.key)||null,r,i);case T:return g(e,n,t,(0,r._init)(r._payload),i)}if(ne(r)||z(r))return d(n,e=e.get(t)||null,r,i,null);bo(n,r)}return null}function h(i,o,s,l){for(var c=null,u=null,d=o,h=o=0,v=null;null!==d&&h<s.length;h++){d.index>h?(v=d,d=null):v=d.sibling;var f=p(i,d,s[h],l);if(null===f){null===d&&(d=v);break}e&&d&&null===f.alternate&&n(i,d),o=a(f,o,h),null===u?c=f:u.sibling=f,u=f,d=v}if(h===s.length)return t(i,d),io&&Zi(i,h),c;if(null===d){for(;h<s.length;h++)null!==(d=m(i,s[h],l))&&(o=a(d,o,h),null===u?c=d:u.sibling=d,u=d);return io&&Zi(i,h),c}for(d=r(i,d);h<s.length;h++)null!==(v=g(d,i,h,s[h],l))&&(e&&null!==v.alternate&&d.delete(null===v.key?h:v.key),o=a(v,o,h),null===u?c=v:u.sibling=v,u=v);return e&&d.forEach(function(e){return n(i,e)}),io&&Zi(i,h),c}function v(i,s,l,c){var u=z(l);if("function"!=typeof u)throw Error(o(150));if(null==(l=u.call(l)))throw Error(o(151));for(var d=u=null,h=s,v=s=0,f=null,b=l.next();null!==h&&!b.done;v++,b=l.next()){h.index>v?(f=h,h=null):f=h.sibling;var x=p(i,h,b.value,c);if(null===x){null===h&&(h=f);break}e&&h&&null===x.alternate&&n(i,h),s=a(x,s,v),null===d?u=x:d.sibling=x,d=x,h=f}if(b.done)return t(i,h),io&&Zi(i,v),u;if(null===h){for(;!b.done;v++,b=l.next())null!==(b=m(i,b.value,c))&&(s=a(b,s,v),null===d?u=b:d.sibling=b,d=b);return io&&Zi(i,v),u}for(h=r(i,h);!b.done;v++,b=l.next())null!==(b=g(h,i,v,b.value,c))&&(e&&null!==b.alternate&&h.delete(null===b.key?v:b.key),s=a(b,s,v),null===d?u=b:d.sibling=b,d=b);return e&&h.forEach(function(e){return n(i,e)}),io&&Zi(i,v),u}return function e(r,o,a,l){if("object"==typeof a&&null!==a&&a.type===j&&null===a.key&&(a=a.props.children),"object"==typeof a&&null!==a){switch(a.$$typeof){case k:e:{for(var c=a.key,u=o;null!==u;){if(u.key===c){if((c=a.type)===j){if(7===u.tag){t(r,u.sibling),(o=i(u,a.props.children)).return=r,r=o;break e}}else if(u.elementType===c||"object"==typeof c&&null!==c&&c.$$typeof===T&&xo(c)===u.type){t(r,u.sibling),(o=i(u,a.props)).ref=fo(r,u,a),o.return=r,r=o;break e}t(r,u);break}n(r,u),u=u.sibling}a.type===j?((o=Lc(a.props.children,r.mode,l,a.key)).return=r,r=o):((l=Ac(a.type,a.key,a.props,null,r.mode,l)).ref=fo(r,o,a),l.return=r,r=l)}return s(r);case w:e:{for(u=a.key;null!==o;){if(o.key===u){if(4===o.tag&&o.stateNode.containerInfo===a.containerInfo&&o.stateNode.implementation===a.implementation){t(r,o.sibling),(o=i(o,a.children||[])).return=r,r=o;break e}t(r,o);break}n(r,o),o=o.sibling}(o=Rc(a,r.mode,l)).return=r,r=o}return s(r);case T:return e(r,o,(u=a._init)(a._payload),l)}if(ne(a))return h(r,o,a,l);if(z(a))return v(r,o,a,l);bo(r,a)}return"string"==typeof a&&""!==a||"number"==typeof a?(a=""+a,null!==o&&6===o.tag?(t(r,o.sibling),(o=i(o,a)).return=r,r=o):(t(r,o),(o=Ic(a,r.mode,l)).return=r,r=o),s(r)):t(r,o)}}var ko=yo(!0),wo=yo(!1),jo=Ci(null),Co=null,So=null,No=null;function Eo(){No=So=Co=null}function Po(e){var n=jo.current;Si(jo),e._currentValue=n}function Do(e,n,t){for(;null!==e;){var r=e.alternate;if((e.childLanes&n)!==n?(e.childLanes|=n,null!==r&&(r.childLanes|=n)):null!==r&&(r.childLanes&n)!==n&&(r.childLanes|=n),e===t)break;e=e.return}}function Mo(e,n){Co=e,No=So=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&n)&&(xs=!0),e.firstContext=null)}function Oo(e){var n=e._currentValue;if(No!==e)if(e={context:e,memoizedValue:n,next:null},null===So){if(null===Co)throw Error(o(308));So=e,Co.dependencies={lanes:0,firstContext:e}}else So=So.next=e;return n}var To=null;function Ao(e){null===To?To=[e]:To.push(e)}function Lo(e,n,t,r){var i=n.interleaved;return null===i?(t.next=t,Ao(n)):(t.next=i.next,i.next=t),n.interleaved=t,zo(e,r)}function zo(e,n){e.lanes|=n;var t=e.alternate;for(null!==t&&(t.lanes|=n),t=e,e=e.return;null!==e;)e.childLanes|=n,null!==(t=e.alternate)&&(t.childLanes|=n),t=e,e=e.return;return 3===t.tag?t.stateNode:null}var Io=!1;function Ro(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Bo(e,n){e=e.updateQueue,n.updateQueue===e&&(n.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function _o(e,n){return{eventTime:e,lane:n,tag:0,payload:null,callback:null,next:null}}function Fo(e,n,t){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,2&El){var i=r.pending;return null===i?n.next=n:(n.next=i.next,i.next=n),r.pending=n,zo(e,t)}return null===(i=r.interleaved)?(n.next=n,Ao(r)):(n.next=i.next,i.next=n),r.interleaved=n,zo(e,t)}function Uo(e,n,t){if(null!==(n=n.updateQueue)&&(n=n.shared,4194240&t)){var r=n.lanes;t|=r&=e.pendingLanes,n.lanes=t,xn(e,t)}}function Ho(e,n){var t=e.updateQueue,r=e.alternate;if(null!==r&&t===(r=r.updateQueue)){var i=null,o=null;if(null!==(t=t.firstBaseUpdate)){do{var a={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};null===o?i=o=a:o=o.next=a,t=t.next}while(null!==t);null===o?i=o=n:o=o.next=n}else i=o=n;return t={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:o,shared:r.shared,effects:r.effects},void(e.updateQueue=t)}null===(e=t.lastBaseUpdate)?t.firstBaseUpdate=n:e.next=n,t.lastBaseUpdate=n}function Wo(e,n,t,r){var i=e.updateQueue;Io=!1;var o=i.firstBaseUpdate,a=i.lastBaseUpdate,s=i.shared.pending;if(null!==s){i.shared.pending=null;var l=s,c=l.next;l.next=null,null===a?o=c:a.next=c,a=l;var u=e.alternate;null!==u&&((s=(u=u.updateQueue).lastBaseUpdate)!==a&&(null===s?u.firstBaseUpdate=c:s.next=c,u.lastBaseUpdate=l))}if(null!==o){var d=i.baseState;for(a=0,u=c=l=null,s=o;;){var m=s.lane,p=s.eventTime;if((r&m)===m){null!==u&&(u=u.next={eventTime:p,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var g=e,h=s;switch(m=n,p=t,h.tag){case 1:if("function"==typeof(g=h.payload)){d=g.call(p,d,m);break e}d=g;break e;case 3:g.flags=-65537&g.flags|128;case 0:if(null==(m="function"==typeof(g=h.payload)?g.call(p,d,m):g))break e;d=R({},d,m);break e;case 2:Io=!0}}null!==s.callback&&0!==s.lane&&(e.flags|=64,null===(m=i.effects)?i.effects=[s]:m.push(s))}else p={eventTime:p,lane:m,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===u?(c=u=p,l=d):u=u.next=p,a|=m;if(null===(s=s.next)){if(null===(s=i.shared.pending))break;s=(m=s).next,m.next=null,i.lastBaseUpdate=m,i.shared.pending=null}}if(null===u&&(l=d),i.baseState=l,i.firstBaseUpdate=c,i.lastBaseUpdate=u,null!==(n=i.shared.interleaved)){i=n;do{a|=i.lane,i=i.next}while(i!==n)}else null===o&&(i.shared.lanes=0);zl|=a,e.lanes=a,e.memoizedState=d}}function Vo(e,n,t){if(e=n.effects,n.effects=null,null!==e)for(n=0;n<e.length;n++){var r=e[n],i=r.callback;if(null!==i){if(r.callback=null,r=t,"function"!=typeof i)throw Error(o(191,i));i.call(r)}}}var qo={},$o=Ci(qo),Yo=Ci(qo),Go=Ci(qo);function Ko(e){if(e===qo)throw Error(o(174));return e}function Qo(e,n){switch(Ni(Go,n),Ni(Yo,e),Ni($o,qo),e=n.nodeType){case 9:case 11:n=(n=n.documentElement)?n.namespaceURI:le(null,"");break;default:n=le(n=(e=8===e?n.parentNode:n).namespaceURI||null,e=e.tagName)}Si($o),Ni($o,n)}function Xo(){Si($o),Si(Yo),Si(Go)}function Zo(e){Ko(Go.current);var n=Ko($o.current),t=le(n,e.type);n!==t&&(Ni(Yo,e),Ni($o,t))}function Jo(e){Yo.current===e&&(Si($o),Si(Yo))}var ea=Ci(0);function na(e){for(var n=e;null!==n;){if(13===n.tag){var t=n.memoizedState;if(null!==t&&(null===(t=t.dehydrated)||"$?"===t.data||"$!"===t.data))return n}else if(19===n.tag&&void 0!==n.memoizedProps.revealOrder){if(128&n.flags)return n}else if(null!==n.child){n.child.return=n,n=n.child;continue}if(n===e)break;for(;null===n.sibling;){if(null===n.return||n.return===e)return null;n=n.return}n.sibling.return=n.return,n=n.sibling}return null}var ta=[];function ra(){for(var e=0;e<ta.length;e++)ta[e]._workInProgressVersionPrimary=null;ta.length=0}var ia=y.ReactCurrentDispatcher,oa=y.ReactCurrentBatchConfig,aa=0,sa=null,la=null,ca=null,ua=!1,da=!1,ma=0,pa=0;function ga(){throw Error(o(321))}function ha(e,n){if(null===n)return!1;for(var t=0;t<n.length&&t<e.length;t++)if(!sr(e[t],n[t]))return!1;return!0}function va(e,n,t,r,i,a){if(aa=a,sa=n,n.memoizedState=null,n.updateQueue=null,n.lanes=0,ia.current=null===e||null===e.memoizedState?Ja:es,e=t(r,i),da){a=0;do{if(da=!1,ma=0,25<=a)throw Error(o(301));a+=1,ca=la=null,n.updateQueue=null,ia.current=ns,e=t(r,i)}while(da)}if(ia.current=Za,n=null!==la&&null!==la.next,aa=0,ca=la=sa=null,ua=!1,n)throw Error(o(300));return e}function fa(){var e=0!==ma;return ma=0,e}function ba(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===ca?sa.memoizedState=ca=e:ca=ca.next=e,ca}function xa(){if(null===la){var e=sa.alternate;e=null!==e?e.memoizedState:null}else e=la.next;var n=null===ca?sa.memoizedState:ca.next;if(null!==n)ca=n,la=e;else{if(null===e)throw Error(o(310));e={memoizedState:(la=e).memoizedState,baseState:la.baseState,baseQueue:la.baseQueue,queue:la.queue,next:null},null===ca?sa.memoizedState=ca=e:ca=ca.next=e}return ca}function ya(e,n){return"function"==typeof n?n(e):n}function ka(e){var n=xa(),t=n.queue;if(null===t)throw Error(o(311));t.lastRenderedReducer=e;var r=la,i=r.baseQueue,a=t.pending;if(null!==a){if(null!==i){var s=i.next;i.next=a.next,a.next=s}r.baseQueue=i=a,t.pending=null}if(null!==i){a=i.next,r=r.baseState;var l=s=null,c=null,u=a;do{var d=u.lane;if((aa&d)===d)null!==c&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:e(r,u.action);else{var m={lane:d,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===c?(l=c=m,s=r):c=c.next=m,sa.lanes|=d,zl|=d}u=u.next}while(null!==u&&u!==a);null===c?s=r:c.next=l,sr(r,n.memoizedState)||(xs=!0),n.memoizedState=r,n.baseState=s,n.baseQueue=c,t.lastRenderedState=r}if(null!==(e=t.interleaved)){i=e;do{a=i.lane,sa.lanes|=a,zl|=a,i=i.next}while(i!==e)}else null===i&&(t.lanes=0);return[n.memoizedState,t.dispatch]}function wa(e){var n=xa(),t=n.queue;if(null===t)throw Error(o(311));t.lastRenderedReducer=e;var r=t.dispatch,i=t.pending,a=n.memoizedState;if(null!==i){t.pending=null;var s=i=i.next;do{a=e(a,s.action),s=s.next}while(s!==i);sr(a,n.memoizedState)||(xs=!0),n.memoizedState=a,null===n.baseQueue&&(n.baseState=a),t.lastRenderedState=a}return[a,r]}function ja(){}function Ca(e,n){var t=sa,r=xa(),i=n(),a=!sr(r.memoizedState,i);if(a&&(r.memoizedState=i,xs=!0),r=r.queue,Ia(Ea.bind(null,t,r,e),[e]),r.getSnapshot!==n||a||null!==ca&&1&ca.memoizedState.tag){if(t.flags|=2048,Oa(9,Na.bind(null,t,r,i,n),void 0,null),null===Pl)throw Error(o(349));30&aa||Sa(t,n,i)}return i}function Sa(e,n,t){e.flags|=16384,e={getSnapshot:n,value:t},null===(n=sa.updateQueue)?(n={lastEffect:null,stores:null},sa.updateQueue=n,n.stores=[e]):null===(t=n.stores)?n.stores=[e]:t.push(e)}function Na(e,n,t,r){n.value=t,n.getSnapshot=r,Pa(n)&&Da(e)}function Ea(e,n,t){return t(function(){Pa(n)&&Da(e)})}function Pa(e){var n=e.getSnapshot;e=e.value;try{var t=n();return!sr(e,t)}catch(e){return!0}}function Da(e){var n=zo(e,1);null!==n&&nc(n,e,1,-1)}function Ma(e){var n=ba();return"function"==typeof e&&(e=e()),n.memoizedState=n.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ya,lastRenderedState:e},n.queue=e,e=e.dispatch=Ga.bind(null,sa,e),[n.memoizedState,e]}function Oa(e,n,t,r){return e={tag:e,create:n,destroy:t,deps:r,next:null},null===(n=sa.updateQueue)?(n={lastEffect:null,stores:null},sa.updateQueue=n,n.lastEffect=e.next=e):null===(t=n.lastEffect)?n.lastEffect=e.next=e:(r=t.next,t.next=e,e.next=r,n.lastEffect=e),e}function Ta(){return xa().memoizedState}function Aa(e,n,t,r){var i=ba();sa.flags|=e,i.memoizedState=Oa(1|n,t,void 0,void 0===r?null:r)}function La(e,n,t,r){var i=xa();r=void 0===r?null:r;var o=void 0;if(null!==la){var a=la.memoizedState;if(o=a.destroy,null!==r&&ha(r,a.deps))return void(i.memoizedState=Oa(n,t,o,r))}sa.flags|=e,i.memoizedState=Oa(1|n,t,o,r)}function za(e,n){return Aa(8390656,8,e,n)}function Ia(e,n){return La(2048,8,e,n)}function Ra(e,n){return La(4,2,e,n)}function Ba(e,n){return La(4,4,e,n)}function _a(e,n){return"function"==typeof n?(e=e(),n(e),function(){n(null)}):null!=n?(e=e(),n.current=e,function(){n.current=null}):void 0}function Fa(e,n,t){return t=null!=t?t.concat([e]):null,La(4,4,_a.bind(null,n,e),t)}function Ua(){}function Ha(e,n){var t=xa();n=void 0===n?null:n;var r=t.memoizedState;return null!==r&&null!==n&&ha(n,r[1])?r[0]:(t.memoizedState=[e,n],e)}function Wa(e,n){var t=xa();n=void 0===n?null:n;var r=t.memoizedState;return null!==r&&null!==n&&ha(n,r[1])?r[0]:(e=e(),t.memoizedState=[e,n],e)}function Va(e,n,t){return 21&aa?(sr(t,n)||(t=vn(),sa.lanes|=t,zl|=t,e.baseState=!0),n):(e.baseState&&(e.baseState=!1,xs=!0),e.memoizedState=t)}function qa(e,n){var t=yn;yn=0!==t&&4>t?t:4,e(!0);var r=oa.transition;oa.transition={};try{e(!1),n()}finally{yn=t,oa.transition=r}}function $a(){return xa().memoizedState}function Ya(e,n,t){var r=ec(e);if(t={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null},Ka(e))Qa(n,t);else if(null!==(t=Lo(e,n,t,r))){nc(t,e,r,Jl()),Xa(t,n,r)}}function Ga(e,n,t){var r=ec(e),i={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null};if(Ka(e))Qa(n,i);else{var o=e.alternate;if(0===e.lanes&&(null===o||0===o.lanes)&&null!==(o=n.lastRenderedReducer))try{var a=n.lastRenderedState,s=o(a,t);if(i.hasEagerState=!0,i.eagerState=s,sr(s,a)){var l=n.interleaved;return null===l?(i.next=i,Ao(n)):(i.next=l.next,l.next=i),void(n.interleaved=i)}}catch(e){}null!==(t=Lo(e,n,i,r))&&(nc(t,e,r,i=Jl()),Xa(t,n,r))}}function Ka(e){var n=e.alternate;return e===sa||null!==n&&n===sa}function Qa(e,n){da=ua=!0;var t=e.pending;null===t?n.next=n:(n.next=t.next,t.next=n),e.pending=n}function Xa(e,n,t){if(4194240&t){var r=n.lanes;t|=r&=e.pendingLanes,n.lanes=t,xn(e,t)}}var Za={readContext:Oo,useCallback:ga,useContext:ga,useEffect:ga,useImperativeHandle:ga,useInsertionEffect:ga,useLayoutEffect:ga,useMemo:ga,useReducer:ga,useRef:ga,useState:ga,useDebugValue:ga,useDeferredValue:ga,useTransition:ga,useMutableSource:ga,useSyncExternalStore:ga,useId:ga,unstable_isNewReconciler:!1},Ja={readContext:Oo,useCallback:function(e,n){return ba().memoizedState=[e,void 0===n?null:n],e},useContext:Oo,useEffect:za,useImperativeHandle:function(e,n,t){return t=null!=t?t.concat([e]):null,Aa(4194308,4,_a.bind(null,n,e),t)},useLayoutEffect:function(e,n){return Aa(4194308,4,e,n)},useInsertionEffect:function(e,n){return Aa(4,2,e,n)},useMemo:function(e,n){var t=ba();return n=void 0===n?null:n,e=e(),t.memoizedState=[e,n],e},useReducer:function(e,n,t){var r=ba();return n=void 0!==t?t(n):n,r.memoizedState=r.baseState=n,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:n},r.queue=e,e=e.dispatch=Ya.bind(null,sa,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},ba().memoizedState=e},useState:Ma,useDebugValue:Ua,useDeferredValue:function(e){return ba().memoizedState=e},useTransition:function(){var e=Ma(!1),n=e[0];return e=qa.bind(null,e[1]),ba().memoizedState=e,[n,e]},useMutableSource:function(){},useSyncExternalStore:function(e,n,t){var r=sa,i=ba();if(io){if(void 0===t)throw Error(o(407));t=t()}else{if(t=n(),null===Pl)throw Error(o(349));30&aa||Sa(r,n,t)}i.memoizedState=t;var a={value:t,getSnapshot:n};return i.queue=a,za(Ea.bind(null,r,a,e),[e]),r.flags|=2048,Oa(9,Na.bind(null,r,a,t,n),void 0,null),t},useId:function(){var e=ba(),n=Pl.identifierPrefix;if(io){var t=Xi;n=":"+n+"R"+(t=(Qi&~(1<<32-sn(Qi)-1)).toString(32)+t),0<(t=ma++)&&(n+="H"+t.toString(32)),n+=":"}else n=":"+n+"r"+(t=pa++).toString(32)+":";return e.memoizedState=n},unstable_isNewReconciler:!1},es={readContext:Oo,useCallback:Ha,useContext:Oo,useEffect:Ia,useImperativeHandle:Fa,useInsertionEffect:Ra,useLayoutEffect:Ba,useMemo:Wa,useReducer:ka,useRef:Ta,useState:function(){return ka(ya)},useDebugValue:Ua,useDeferredValue:function(e){return Va(xa(),la.memoizedState,e)},useTransition:function(){return[ka(ya)[0],xa().memoizedState]},useMutableSource:ja,useSyncExternalStore:Ca,useId:$a,unstable_isNewReconciler:!1},ns={readContext:Oo,useCallback:Ha,useContext:Oo,useEffect:Ia,useImperativeHandle:Fa,useInsertionEffect:Ra,useLayoutEffect:Ba,useMemo:Wa,useReducer:wa,useRef:Ta,useState:function(){return wa(ya)},useDebugValue:Ua,useDeferredValue:function(e){var n=xa();return null===la?n.memoizedState=e:Va(n,la.memoizedState,e)},useTransition:function(){return[wa(ya)[0],xa().memoizedState]},useMutableSource:ja,useSyncExternalStore:Ca,useId:$a,unstable_isNewReconciler:!1};function ts(e,n){if(e&&e.defaultProps){for(var t in n=R({},n),e=e.defaultProps)void 0===n[t]&&(n[t]=e[t]);return n}return n}function rs(e,n,t,r){t=null==(t=t(r,n=e.memoizedState))?n:R({},n,t),e.memoizedState=t,0===e.lanes&&(e.updateQueue.baseState=t)}var is={isMounted:function(e){return!!(e=e._reactInternals)&&He(e)===e},enqueueSetState:function(e,n,t){e=e._reactInternals;var r=Jl(),i=ec(e),o=_o(r,i);o.payload=n,null!=t&&(o.callback=t),null!==(n=Fo(e,o,i))&&(nc(n,e,i,r),Uo(n,e,i))},enqueueReplaceState:function(e,n,t){e=e._reactInternals;var r=Jl(),i=ec(e),o=_o(r,i);o.tag=1,o.payload=n,null!=t&&(o.callback=t),null!==(n=Fo(e,o,i))&&(nc(n,e,i,r),Uo(n,e,i))},enqueueForceUpdate:function(e,n){e=e._reactInternals;var t=Jl(),r=ec(e),i=_o(t,r);i.tag=2,null!=n&&(i.callback=n),null!==(n=Fo(e,i,r))&&(nc(n,e,r,t),Uo(n,e,r))}};function os(e,n,t,r,i,o,a){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,o,a):!n.prototype||!n.prototype.isPureReactComponent||(!lr(t,r)||!lr(i,o))}function as(e,n,t){var r=!1,i=Ei,o=n.contextType;return"object"==typeof o&&null!==o?o=Oo(o):(i=Ti(n)?Mi:Pi.current,o=(r=null!=(r=n.contextTypes))?Oi(e,i):Ei),n=new n(t,o),e.memoizedState=null!==n.state&&void 0!==n.state?n.state:null,n.updater=is,e.stateNode=n,n._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=o),n}function ss(e,n,t,r){e=n.state,"function"==typeof n.componentWillReceiveProps&&n.componentWillReceiveProps(t,r),"function"==typeof n.UNSAFE_componentWillReceiveProps&&n.UNSAFE_componentWillReceiveProps(t,r),n.state!==e&&is.enqueueReplaceState(n,n.state,null)}function ls(e,n,t,r){var i=e.stateNode;i.props=t,i.state=e.memoizedState,i.refs={},Ro(e);var o=n.contextType;"object"==typeof o&&null!==o?i.context=Oo(o):(o=Ti(n)?Mi:Pi.current,i.context=Oi(e,o)),i.state=e.memoizedState,"function"==typeof(o=n.getDerivedStateFromProps)&&(rs(e,n,o,t),i.state=e.memoizedState),"function"==typeof n.getDerivedStateFromProps||"function"==typeof i.getSnapshotBeforeUpdate||"function"!=typeof i.UNSAFE_componentWillMount&&"function"!=typeof i.componentWillMount||(n=i.state,"function"==typeof i.componentWillMount&&i.componentWillMount(),"function"==typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),n!==i.state&&is.enqueueReplaceState(i,i.state,null),Wo(e,t,i,r),i.state=e.memoizedState),"function"==typeof i.componentDidMount&&(e.flags|=4194308)}function cs(e,n){try{var t="",r=n;do{t+=U(r),r=r.return}while(r);var i=t}catch(e){i="\nError generating stack: "+e.message+"\n"+e.stack}return{value:e,source:n,stack:i,digest:null}}function us(e,n,t){return{value:e,source:null,stack:null!=t?t:null,digest:null!=n?n:null}}function ds(e,n){try{console.error(n.value)}catch(e){setTimeout(function(){throw e})}}var ms="function"==typeof WeakMap?WeakMap:Map;function ps(e,n,t){(t=_o(-1,t)).tag=3,t.payload={element:null};var r=n.value;return t.callback=function(){Wl||(Wl=!0,Vl=r),ds(0,n)},t}function gs(e,n,t){(t=_o(-1,t)).tag=3;var r=e.type.getDerivedStateFromError;if("function"==typeof r){var i=n.value;t.payload=function(){return r(i)},t.callback=function(){ds(0,n)}}var o=e.stateNode;return null!==o&&"function"==typeof o.componentDidCatch&&(t.callback=function(){ds(0,n),"function"!=typeof r&&(null===ql?ql=new Set([this]):ql.add(this));var e=n.stack;this.componentDidCatch(n.value,{componentStack:null!==e?e:""})}),t}function hs(e,n,t){var r=e.pingCache;if(null===r){r=e.pingCache=new ms;var i=new Set;r.set(n,i)}else void 0===(i=r.get(n))&&(i=new Set,r.set(n,i));i.has(t)||(i.add(t),e=Cc.bind(null,e,n,t),n.then(e,e))}function vs(e){do{var n;if((n=13===e.tag)&&(n=null===(n=e.memoizedState)||null!==n.dehydrated),n)return e;e=e.return}while(null!==e);return null}function fs(e,n,t,r,i){return 1&e.mode?(e.flags|=65536,e.lanes=i,e):(e===n?e.flags|=65536:(e.flags|=128,t.flags|=131072,t.flags&=-52805,1===t.tag&&(null===t.alternate?t.tag=17:((n=_o(-1,1)).tag=2,Fo(t,n,1))),t.lanes|=1),e)}var bs=y.ReactCurrentOwner,xs=!1;function ys(e,n,t,r){n.child=null===e?wo(n,null,t,r):ko(n,e.child,t,r)}function ks(e,n,t,r,i){t=t.render;var o=n.ref;return Mo(n,i),r=va(e,n,t,r,o,i),t=fa(),null===e||xs?(io&&t&&eo(n),n.flags|=1,ys(e,n,r,i),n.child):(n.updateQueue=e.updateQueue,n.flags&=-2053,e.lanes&=~i,Ws(e,n,i))}function ws(e,n,t,r,i){if(null===e){var o=t.type;return"function"!=typeof o||Oc(o)||void 0!==o.defaultProps||null!==t.compare||void 0!==t.defaultProps?((e=Ac(t.type,null,r,n,n.mode,i)).ref=n.ref,e.return=n,n.child=e):(n.tag=15,n.type=o,js(e,n,o,r,i))}if(o=e.child,0===(e.lanes&i)){var a=o.memoizedProps;if((t=null!==(t=t.compare)?t:lr)(a,r)&&e.ref===n.ref)return Ws(e,n,i)}return n.flags|=1,(e=Tc(o,r)).ref=n.ref,e.return=n,n.child=e}function js(e,n,t,r,i){if(null!==e){var o=e.memoizedProps;if(lr(o,r)&&e.ref===n.ref){if(xs=!1,n.pendingProps=r=o,0===(e.lanes&i))return n.lanes=e.lanes,Ws(e,n,i);131072&e.flags&&(xs=!0)}}return Ns(e,n,t,r,i)}function Cs(e,n,t){var r=n.pendingProps,i=r.children,o=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(1&n.mode){if(!(1073741824&t))return e=null!==o?o.baseLanes|t:t,n.lanes=n.childLanes=1073741824,n.memoizedState={baseLanes:e,cachePool:null,transitions:null},n.updateQueue=null,Ni(Tl,Ol),Ol|=e,null;n.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==o?o.baseLanes:t,Ni(Tl,Ol),Ol|=r}else n.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ni(Tl,Ol),Ol|=t;else null!==o?(r=o.baseLanes|t,n.memoizedState=null):r=t,Ni(Tl,Ol),Ol|=r;return ys(e,n,i,t),n.child}function Ss(e,n){var t=n.ref;(null===e&&null!==t||null!==e&&e.ref!==t)&&(n.flags|=512,n.flags|=2097152)}function Ns(e,n,t,r,i){var o=Ti(t)?Mi:Pi.current;return o=Oi(n,o),Mo(n,i),t=va(e,n,t,r,o,i),r=fa(),null===e||xs?(io&&r&&eo(n),n.flags|=1,ys(e,n,t,i),n.child):(n.updateQueue=e.updateQueue,n.flags&=-2053,e.lanes&=~i,Ws(e,n,i))}function Es(e,n,t,r,i){if(Ti(t)){var o=!0;Ii(n)}else o=!1;if(Mo(n,i),null===n.stateNode)Hs(e,n),as(n,t,r),ls(n,t,r,i),r=!0;else if(null===e){var a=n.stateNode,s=n.memoizedProps;a.props=s;var l=a.context,c=t.contextType;"object"==typeof c&&null!==c?c=Oo(c):c=Oi(n,c=Ti(t)?Mi:Pi.current);var u=t.getDerivedStateFromProps,d="function"==typeof u||"function"==typeof a.getSnapshotBeforeUpdate;d||"function"!=typeof a.UNSAFE_componentWillReceiveProps&&"function"!=typeof a.componentWillReceiveProps||(s!==r||l!==c)&&ss(n,a,r,c),Io=!1;var m=n.memoizedState;a.state=m,Wo(n,r,a,i),l=n.memoizedState,s!==r||m!==l||Di.current||Io?("function"==typeof u&&(rs(n,t,u,r),l=n.memoizedState),(s=Io||os(n,t,s,r,m,l,c))?(d||"function"!=typeof a.UNSAFE_componentWillMount&&"function"!=typeof a.componentWillMount||("function"==typeof a.componentWillMount&&a.componentWillMount(),"function"==typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"==typeof a.componentDidMount&&(n.flags|=4194308)):("function"==typeof a.componentDidMount&&(n.flags|=4194308),n.memoizedProps=r,n.memoizedState=l),a.props=r,a.state=l,a.context=c,r=s):("function"==typeof a.componentDidMount&&(n.flags|=4194308),r=!1)}else{a=n.stateNode,Bo(e,n),s=n.memoizedProps,c=n.type===n.elementType?s:ts(n.type,s),a.props=c,d=n.pendingProps,m=a.context,"object"==typeof(l=t.contextType)&&null!==l?l=Oo(l):l=Oi(n,l=Ti(t)?Mi:Pi.current);var p=t.getDerivedStateFromProps;(u="function"==typeof p||"function"==typeof a.getSnapshotBeforeUpdate)||"function"!=typeof a.UNSAFE_componentWillReceiveProps&&"function"!=typeof a.componentWillReceiveProps||(s!==d||m!==l)&&ss(n,a,r,l),Io=!1,m=n.memoizedState,a.state=m,Wo(n,r,a,i);var g=n.memoizedState;s!==d||m!==g||Di.current||Io?("function"==typeof p&&(rs(n,t,p,r),g=n.memoizedState),(c=Io||os(n,t,c,r,m,g,l)||!1)?(u||"function"!=typeof a.UNSAFE_componentWillUpdate&&"function"!=typeof a.componentWillUpdate||("function"==typeof a.componentWillUpdate&&a.componentWillUpdate(r,g,l),"function"==typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(r,g,l)),"function"==typeof a.componentDidUpdate&&(n.flags|=4),"function"==typeof a.getSnapshotBeforeUpdate&&(n.flags|=1024)):("function"!=typeof a.componentDidUpdate||s===e.memoizedProps&&m===e.memoizedState||(n.flags|=4),"function"!=typeof a.getSnapshotBeforeUpdate||s===e.memoizedProps&&m===e.memoizedState||(n.flags|=1024),n.memoizedProps=r,n.memoizedState=g),a.props=r,a.state=g,a.context=l,r=c):("function"!=typeof a.componentDidUpdate||s===e.memoizedProps&&m===e.memoizedState||(n.flags|=4),"function"!=typeof a.getSnapshotBeforeUpdate||s===e.memoizedProps&&m===e.memoizedState||(n.flags|=1024),r=!1)}return Ps(e,n,t,r,o,i)}function Ps(e,n,t,r,i,o){Ss(e,n);var a=!!(128&n.flags);if(!r&&!a)return i&&Ri(n,t,!1),Ws(e,n,o);r=n.stateNode,bs.current=n;var s=a&&"function"!=typeof t.getDerivedStateFromError?null:r.render();return n.flags|=1,null!==e&&a?(n.child=ko(n,e.child,null,o),n.child=ko(n,null,s,o)):ys(e,n,s,o),n.memoizedState=r.state,i&&Ri(n,t,!0),n.child}function Ds(e){var n=e.stateNode;n.pendingContext?Li(0,n.pendingContext,n.pendingContext!==n.context):n.context&&Li(0,n.context,!1),Qo(e,n.containerInfo)}function Ms(e,n,t,r,i){return go(),ho(i),n.flags|=256,ys(e,n,t,r),n.child}var Os,Ts,As,Ls={dehydrated:null,treeContext:null,retryLane:0};function zs(e){return{baseLanes:e,cachePool:null,transitions:null}}function Is(e,n,t){var r,i=n.pendingProps,a=ea.current,s=!1,l=!!(128&n.flags);if((r=l)||(r=(null===e||null!==e.memoizedState)&&!!(2&a)),r?(s=!0,n.flags&=-129):null!==e&&null===e.memoizedState||(a|=1),Ni(ea,1&a),null===e)return co(n),null!==(e=n.memoizedState)&&null!==(e=e.dehydrated)?(1&n.mode?"$!"===e.data?n.lanes=8:n.lanes=1073741824:n.lanes=1,null):(l=i.children,e=i.fallback,s?(i=n.mode,s=n.child,l={mode:"hidden",children:l},1&i||null===s?s=zc(l,i,0,null):(s.childLanes=0,s.pendingProps=l),e=Lc(e,i,t,null),s.return=n,e.return=n,s.sibling=e,n.child=s,n.child.memoizedState=zs(t),n.memoizedState=Ls,e):Rs(n,l));if(null!==(a=e.memoizedState)&&null!==(r=a.dehydrated))return function(e,n,t,r,i,a,s){if(t)return 256&n.flags?(n.flags&=-257,Bs(e,n,s,r=us(Error(o(422))))):null!==n.memoizedState?(n.child=e.child,n.flags|=128,null):(a=r.fallback,i=n.mode,r=zc({mode:"visible",children:r.children},i,0,null),(a=Lc(a,i,s,null)).flags|=2,r.return=n,a.return=n,r.sibling=a,n.child=r,1&n.mode&&ko(n,e.child,null,s),n.child.memoizedState=zs(s),n.memoizedState=Ls,a);if(!(1&n.mode))return Bs(e,n,s,null);if("$!"===i.data){if(r=i.nextSibling&&i.nextSibling.dataset)var l=r.dgst;return r=l,Bs(e,n,s,r=us(a=Error(o(419)),r,void 0))}if(l=0!==(s&e.childLanes),xs||l){if(null!==(r=Pl)){switch(s&-s){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}0!==(i=0!==(i&(r.suspendedLanes|s))?0:i)&&i!==a.retryLane&&(a.retryLane=i,zo(e,i),nc(r,e,i,-1))}return gc(),Bs(e,n,s,r=us(Error(o(421))))}return"$?"===i.data?(n.flags|=128,n.child=e.child,n=Nc.bind(null,e),i._reactRetry=n,null):(e=a.treeContext,ro=ci(i.nextSibling),to=n,io=!0,oo=null,null!==e&&(Yi[Gi++]=Qi,Yi[Gi++]=Xi,Yi[Gi++]=Ki,Qi=e.id,Xi=e.overflow,Ki=n),n=Rs(n,r.children),n.flags|=4096,n)}(e,n,l,i,r,a,t);if(s){s=i.fallback,l=n.mode,r=(a=e.child).sibling;var c={mode:"hidden",children:i.children};return 1&l||n.child===a?(i=Tc(a,c)).subtreeFlags=14680064&a.subtreeFlags:((i=n.child).childLanes=0,i.pendingProps=c,n.deletions=null),null!==r?s=Tc(r,s):(s=Lc(s,l,t,null)).flags|=2,s.return=n,i.return=n,i.sibling=s,n.child=i,i=s,s=n.child,l=null===(l=e.child.memoizedState)?zs(t):{baseLanes:l.baseLanes|t,cachePool:null,transitions:l.transitions},s.memoizedState=l,s.childLanes=e.childLanes&~t,n.memoizedState=Ls,i}return e=(s=e.child).sibling,i=Tc(s,{mode:"visible",children:i.children}),!(1&n.mode)&&(i.lanes=t),i.return=n,i.sibling=null,null!==e&&(null===(t=n.deletions)?(n.deletions=[e],n.flags|=16):t.push(e)),n.child=i,n.memoizedState=null,i}function Rs(e,n){return(n=zc({mode:"visible",children:n},e.mode,0,null)).return=e,e.child=n}function Bs(e,n,t,r){return null!==r&&ho(r),ko(n,e.child,null,t),(e=Rs(n,n.pendingProps.children)).flags|=2,n.memoizedState=null,e}function _s(e,n,t){e.lanes|=n;var r=e.alternate;null!==r&&(r.lanes|=n),Do(e.return,n,t)}function Fs(e,n,t,r,i){var o=e.memoizedState;null===o?e.memoizedState={isBackwards:n,rendering:null,renderingStartTime:0,last:r,tail:t,tailMode:i}:(o.isBackwards=n,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=t,o.tailMode=i)}function Us(e,n,t){var r=n.pendingProps,i=r.revealOrder,o=r.tail;if(ys(e,n,r.children,t),2&(r=ea.current))r=1&r|2,n.flags|=128;else{if(null!==e&&128&e.flags)e:for(e=n.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&_s(e,t,n);else if(19===e.tag)_s(e,t,n);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===n)break e;for(;null===e.sibling;){if(null===e.return||e.return===n)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Ni(ea,r),1&n.mode)switch(i){case"forwards":for(t=n.child,i=null;null!==t;)null!==(e=t.alternate)&&null===na(e)&&(i=t),t=t.sibling;null===(t=i)?(i=n.child,n.child=null):(i=t.sibling,t.sibling=null),Fs(n,!1,i,t,o);break;case"backwards":for(t=null,i=n.child,n.child=null;null!==i;){if(null!==(e=i.alternate)&&null===na(e)){n.child=i;break}e=i.sibling,i.sibling=t,t=i,i=e}Fs(n,!0,t,null,o);break;case"together":Fs(n,!1,null,null,void 0);break;default:n.memoizedState=null}else n.memoizedState=null;return n.child}function Hs(e,n){!(1&n.mode)&&null!==e&&(e.alternate=null,n.alternate=null,n.flags|=2)}function Ws(e,n,t){if(null!==e&&(n.dependencies=e.dependencies),zl|=n.lanes,0===(t&n.childLanes))return null;if(null!==e&&n.child!==e.child)throw Error(o(153));if(null!==n.child){for(t=Tc(e=n.child,e.pendingProps),n.child=t,t.return=n;null!==e.sibling;)e=e.sibling,(t=t.sibling=Tc(e,e.pendingProps)).return=n;t.sibling=null}return n.child}function Vs(e,n){if(!io)switch(e.tailMode){case"hidden":n=e.tail;for(var t=null;null!==n;)null!==n.alternate&&(t=n),n=n.sibling;null===t?e.tail=null:t.sibling=null;break;case"collapsed":t=e.tail;for(var r=null;null!==t;)null!==t.alternate&&(r=t),t=t.sibling;null===r?n||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function qs(e){var n=null!==e.alternate&&e.alternate.child===e.child,t=0,r=0;if(n)for(var i=e.child;null!==i;)t|=i.lanes|i.childLanes,r|=14680064&i.subtreeFlags,r|=14680064&i.flags,i.return=e,i=i.sibling;else for(i=e.child;null!==i;)t|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=r,e.childLanes=t,n}function $s(e,n,t){var r=n.pendingProps;switch(no(n),n.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return qs(n),null;case 1:case 17:return Ti(n.type)&&Ai(),qs(n),null;case 3:return r=n.stateNode,Xo(),Si(Di),Si(Pi),ra(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(mo(n)?n.flags|=4:null===e||e.memoizedState.isDehydrated&&!(256&n.flags)||(n.flags|=1024,null!==oo&&(oc(oo),oo=null))),qs(n),null;case 5:Jo(n);var i=Ko(Go.current);if(t=n.type,null!==e&&null!=n.stateNode)Ts(e,n,t,r),e.ref!==n.ref&&(n.flags|=512,n.flags|=2097152);else{if(!r){if(null===n.stateNode)throw Error(o(166));return qs(n),null}if(e=Ko($o.current),mo(n)){r=n.stateNode,t=n.type;var a=n.memoizedProps;switch(r[mi]=n,r[pi]=a,e=!!(1&n.mode),t){case"dialog":_r("cancel",r),_r("close",r);break;case"iframe":case"object":case"embed":_r("load",r);break;case"video":case"audio":for(i=0;i<zr.length;i++)_r(zr[i],r);break;case"source":_r("error",r);break;case"img":case"image":case"link":_r("error",r),_r("load",r);break;case"details":_r("toggle",r);break;case"input":Q(r,a),_r("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!a.multiple},_r("invalid",r);break;case"textarea":ie(r,a),_r("invalid",r)}for(var l in be(t,a),i=null,a)if(a.hasOwnProperty(l)){var c=a[l];"children"===l?"string"==typeof c?r.textContent!==c&&(!0!==a.suppressHydrationWarning&&Zr(r.textContent,c,e),i=["children",c]):"number"==typeof c&&r.textContent!==""+c&&(!0!==a.suppressHydrationWarning&&Zr(r.textContent,c,e),i=["children",""+c]):s.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&_r("scroll",r)}switch(t){case"input":$(r),J(r,a,!0);break;case"textarea":$(r),ae(r);break;case"select":case"option":break;default:"function"==typeof a.onClick&&(r.onclick=Jr)}r=i,n.updateQueue=r,null!==r&&(n.flags|=4)}else{l=9===i.nodeType?i:i.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=se(t)),"http://www.w3.org/1999/xhtml"===e?"script"===t?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"==typeof r.is?e=l.createElement(t,{is:r.is}):(e=l.createElement(t),"select"===t&&(l=e,r.multiple?l.multiple=!0:r.size&&(l.size=r.size))):e=l.createElementNS(e,t),e[mi]=n,e[pi]=r,Os(e,n),n.stateNode=e;e:{switch(l=xe(t,r),t){case"dialog":_r("cancel",e),_r("close",e),i=r;break;case"iframe":case"object":case"embed":_r("load",e),i=r;break;case"video":case"audio":for(i=0;i<zr.length;i++)_r(zr[i],e);i=r;break;case"source":_r("error",e),i=r;break;case"img":case"image":case"link":_r("error",e),_r("load",e),i=r;break;case"details":_r("toggle",e),i=r;break;case"input":Q(e,r),i=K(e,r),_r("invalid",e);break;case"option":default:i=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},i=R({},r,{value:void 0}),_r("invalid",e);break;case"textarea":ie(e,r),i=re(e,r),_r("invalid",e)}for(a in be(t,i),c=i)if(c.hasOwnProperty(a)){var u=c[a];"style"===a?ve(e,u):"dangerouslySetInnerHTML"===a?null!=(u=u?u.__html:void 0)&&de(e,u):"children"===a?"string"==typeof u?("textarea"!==t||""!==u)&&me(e,u):"number"==typeof u&&me(e,""+u):"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&"autoFocus"!==a&&(s.hasOwnProperty(a)?null!=u&&"onScroll"===a&&_r("scroll",e):null!=u&&x(e,a,u,l))}switch(t){case"input":$(e),J(e,r,!1);break;case"textarea":$(e),ae(e);break;case"option":null!=r.value&&e.setAttribute("value",""+V(r.value));break;case"select":e.multiple=!!r.multiple,null!=(a=r.value)?te(e,!!r.multiple,a,!1):null!=r.defaultValue&&te(e,!!r.multiple,r.defaultValue,!0);break;default:"function"==typeof i.onClick&&(e.onclick=Jr)}switch(t){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(n.flags|=4)}null!==n.ref&&(n.flags|=512,n.flags|=2097152)}return qs(n),null;case 6:if(e&&null!=n.stateNode)As(0,n,e.memoizedProps,r);else{if("string"!=typeof r&&null===n.stateNode)throw Error(o(166));if(t=Ko(Go.current),Ko($o.current),mo(n)){if(r=n.stateNode,t=n.memoizedProps,r[mi]=n,(a=r.nodeValue!==t)&&null!==(e=to))switch(e.tag){case 3:Zr(r.nodeValue,t,!!(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Zr(r.nodeValue,t,!!(1&e.mode))}a&&(n.flags|=4)}else(r=(9===t.nodeType?t:t.ownerDocument).createTextNode(r))[mi]=n,n.stateNode=r}return qs(n),null;case 13:if(Si(ea),r=n.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(io&&null!==ro&&1&n.mode&&!(128&n.flags))po(),go(),n.flags|=98560,a=!1;else if(a=mo(n),null!==r&&null!==r.dehydrated){if(null===e){if(!a)throw Error(o(318));if(!(a=null!==(a=n.memoizedState)?a.dehydrated:null))throw Error(o(317));a[mi]=n}else go(),!(128&n.flags)&&(n.memoizedState=null),n.flags|=4;qs(n),a=!1}else null!==oo&&(oc(oo),oo=null),a=!0;if(!a)return 65536&n.flags?n:null}return 128&n.flags?(n.lanes=t,n):((r=null!==r)!==(null!==e&&null!==e.memoizedState)&&r&&(n.child.flags|=8192,1&n.mode&&(null===e||1&ea.current?0===Al&&(Al=3):gc())),null!==n.updateQueue&&(n.flags|=4),qs(n),null);case 4:return Xo(),null===e&&Hr(n.stateNode.containerInfo),qs(n),null;case 10:return Po(n.type._context),qs(n),null;case 19:if(Si(ea),null===(a=n.memoizedState))return qs(n),null;if(r=!!(128&n.flags),null===(l=a.rendering))if(r)Vs(a,!1);else{if(0!==Al||null!==e&&128&e.flags)for(e=n.child;null!==e;){if(null!==(l=na(e))){for(n.flags|=128,Vs(a,!1),null!==(r=l.updateQueue)&&(n.updateQueue=r,n.flags|=4),n.subtreeFlags=0,r=t,t=n.child;null!==t;)e=r,(a=t).flags&=14680066,null===(l=a.alternate)?(a.childLanes=0,a.lanes=e,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=l.childLanes,a.lanes=l.lanes,a.child=l.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=l.memoizedProps,a.memoizedState=l.memoizedState,a.updateQueue=l.updateQueue,a.type=l.type,e=l.dependencies,a.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),t=t.sibling;return Ni(ea,1&ea.current|2),n.child}e=e.sibling}null!==a.tail&&Xe()>Ul&&(n.flags|=128,r=!0,Vs(a,!1),n.lanes=4194304)}else{if(!r)if(null!==(e=na(l))){if(n.flags|=128,r=!0,null!==(t=e.updateQueue)&&(n.updateQueue=t,n.flags|=4),Vs(a,!0),null===a.tail&&"hidden"===a.tailMode&&!l.alternate&&!io)return qs(n),null}else 2*Xe()-a.renderingStartTime>Ul&&1073741824!==t&&(n.flags|=128,r=!0,Vs(a,!1),n.lanes=4194304);a.isBackwards?(l.sibling=n.child,n.child=l):(null!==(t=a.last)?t.sibling=l:n.child=l,a.last=l)}return null!==a.tail?(n=a.tail,a.rendering=n,a.tail=n.sibling,a.renderingStartTime=Xe(),n.sibling=null,t=ea.current,Ni(ea,r?1&t|2:1&t),n):(qs(n),null);case 22:case 23:return uc(),r=null!==n.memoizedState,null!==e&&null!==e.memoizedState!==r&&(n.flags|=8192),r&&1&n.mode?!!(1073741824&Ol)&&(qs(n),6&n.subtreeFlags&&(n.flags|=8192)):qs(n),null;case 24:case 25:return null}throw Error(o(156,n.tag))}function Ys(e,n){switch(no(n),n.tag){case 1:return Ti(n.type)&&Ai(),65536&(e=n.flags)?(n.flags=-65537&e|128,n):null;case 3:return Xo(),Si(Di),Si(Pi),ra(),65536&(e=n.flags)&&!(128&e)?(n.flags=-65537&e|128,n):null;case 5:return Jo(n),null;case 13:if(Si(ea),null!==(e=n.memoizedState)&&null!==e.dehydrated){if(null===n.alternate)throw Error(o(340));go()}return 65536&(e=n.flags)?(n.flags=-65537&e|128,n):null;case 19:return Si(ea),null;case 4:return Xo(),null;case 10:return Po(n.type._context),null;case 22:case 23:return uc(),null;default:return null}}Os=function(e,n){for(var t=n.child;null!==t;){if(5===t.tag||6===t.tag)e.appendChild(t.stateNode);else if(4!==t.tag&&null!==t.child){t.child.return=t,t=t.child;continue}if(t===n)break;for(;null===t.sibling;){if(null===t.return||t.return===n)return;t=t.return}t.sibling.return=t.return,t=t.sibling}},Ts=function(e,n,t,r){var i=e.memoizedProps;if(i!==r){e=n.stateNode,Ko($o.current);var o,a=null;switch(t){case"input":i=K(e,i),r=K(e,r),a=[];break;case"select":i=R({},i,{value:void 0}),r=R({},r,{value:void 0}),a=[];break;case"textarea":i=re(e,i),r=re(e,r),a=[];break;default:"function"!=typeof i.onClick&&"function"==typeof r.onClick&&(e.onclick=Jr)}for(u in be(t,r),t=null,i)if(!r.hasOwnProperty(u)&&i.hasOwnProperty(u)&&null!=i[u])if("style"===u){var l=i[u];for(o in l)l.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(s.hasOwnProperty(u)?a||(a=[]):(a=a||[]).push(u,null));for(u in r){var c=r[u];if(l=null!=i?i[u]:void 0,r.hasOwnProperty(u)&&c!==l&&(null!=c||null!=l))if("style"===u)if(l){for(o in l)!l.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in c)c.hasOwnProperty(o)&&l[o]!==c[o]&&(t||(t={}),t[o]=c[o])}else t||(a||(a=[]),a.push(u,t)),t=c;else"dangerouslySetInnerHTML"===u?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(a=a||[]).push(u,c)):"children"===u?"string"!=typeof c&&"number"!=typeof c||(a=a||[]).push(u,""+c):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(s.hasOwnProperty(u)?(null!=c&&"onScroll"===u&&_r("scroll",e),a||l===c||(a=[])):(a=a||[]).push(u,c))}t&&(a=a||[]).push("style",t);var u=a;(n.updateQueue=u)&&(n.flags|=4)}},As=function(e,n,t,r){t!==r&&(n.flags|=4)};var Gs=!1,Ks=!1,Qs="function"==typeof WeakSet?WeakSet:Set,Xs=null;function Zs(e,n){var t=e.ref;if(null!==t)if("function"==typeof t)try{t(null)}catch(t){jc(e,n,t)}else t.current=null}function Js(e,n,t){try{t()}catch(t){jc(e,n,t)}}var el=!1;function nl(e,n,t){var r=n.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var i=r=r.next;do{if((i.tag&e)===e){var o=i.destroy;i.destroy=void 0,void 0!==o&&Js(n,t,o)}i=i.next}while(i!==r)}}function tl(e,n){if(null!==(n=null!==(n=n.updateQueue)?n.lastEffect:null)){var t=n=n.next;do{if((t.tag&e)===e){var r=t.create;t.destroy=r()}t=t.next}while(t!==n)}}function rl(e){var n=e.ref;if(null!==n){var t=e.stateNode;e.tag,e=t,"function"==typeof n?n(e):n.current=e}}function il(e){var n=e.alternate;null!==n&&(e.alternate=null,il(n)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(n=e.stateNode)&&(delete n[mi],delete n[pi],delete n[hi],delete n[vi],delete n[fi])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function ol(e){return 5===e.tag||3===e.tag||4===e.tag}function al(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||ol(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function sl(e,n,t){var r=e.tag;if(5===r||6===r)e=e.stateNode,n?8===t.nodeType?t.parentNode.insertBefore(e,n):t.insertBefore(e,n):(8===t.nodeType?(n=t.parentNode).insertBefore(e,t):(n=t).appendChild(e),null!=(t=t._reactRootContainer)||null!==n.onclick||(n.onclick=Jr));else if(4!==r&&null!==(e=e.child))for(sl(e,n,t),e=e.sibling;null!==e;)sl(e,n,t),e=e.sibling}function ll(e,n,t){var r=e.tag;if(5===r||6===r)e=e.stateNode,n?t.insertBefore(e,n):t.appendChild(e);else if(4!==r&&null!==(e=e.child))for(ll(e,n,t),e=e.sibling;null!==e;)ll(e,n,t),e=e.sibling}var cl=null,ul=!1;function dl(e,n,t){for(t=t.child;null!==t;)ml(e,n,t),t=t.sibling}function ml(e,n,t){if(an&&"function"==typeof an.onCommitFiberUnmount)try{an.onCommitFiberUnmount(on,t)}catch(e){}switch(t.tag){case 5:Ks||Zs(t,n);case 6:var r=cl,i=ul;cl=null,dl(e,n,t),ul=i,null!==(cl=r)&&(ul?(e=cl,t=t.stateNode,8===e.nodeType?e.parentNode.removeChild(t):e.removeChild(t)):cl.removeChild(t.stateNode));break;case 18:null!==cl&&(ul?(e=cl,t=t.stateNode,8===e.nodeType?li(e.parentNode,t):1===e.nodeType&&li(e,t),Wn(e)):li(cl,t.stateNode));break;case 4:r=cl,i=ul,cl=t.stateNode.containerInfo,ul=!0,dl(e,n,t),cl=r,ul=i;break;case 0:case 11:case 14:case 15:if(!Ks&&(null!==(r=t.updateQueue)&&null!==(r=r.lastEffect))){i=r=r.next;do{var o=i,a=o.destroy;o=o.tag,void 0!==a&&(2&o||4&o)&&Js(t,n,a),i=i.next}while(i!==r)}dl(e,n,t);break;case 1:if(!Ks&&(Zs(t,n),"function"==typeof(r=t.stateNode).componentWillUnmount))try{r.props=t.memoizedProps,r.state=t.memoizedState,r.componentWillUnmount()}catch(e){jc(t,n,e)}dl(e,n,t);break;case 21:dl(e,n,t);break;case 22:1&t.mode?(Ks=(r=Ks)||null!==t.memoizedState,dl(e,n,t),Ks=r):dl(e,n,t);break;default:dl(e,n,t)}}function pl(e){var n=e.updateQueue;if(null!==n){e.updateQueue=null;var t=e.stateNode;null===t&&(t=e.stateNode=new Qs),n.forEach(function(n){var r=Ec.bind(null,e,n);t.has(n)||(t.add(n),n.then(r,r))})}}function gl(e,n){var t=n.deletions;if(null!==t)for(var r=0;r<t.length;r++){var i=t[r];try{var a=e,s=n,l=s;e:for(;null!==l;){switch(l.tag){case 5:cl=l.stateNode,ul=!1;break e;case 3:case 4:cl=l.stateNode.containerInfo,ul=!0;break e}l=l.return}if(null===cl)throw Error(o(160));ml(a,s,i),cl=null,ul=!1;var c=i.alternate;null!==c&&(c.return=null),i.return=null}catch(e){jc(i,n,e)}}if(12854&n.subtreeFlags)for(n=n.child;null!==n;)hl(n,e),n=n.sibling}function hl(e,n){var t=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(gl(n,e),vl(e),4&r){try{nl(3,e,e.return),tl(3,e)}catch(n){jc(e,e.return,n)}try{nl(5,e,e.return)}catch(n){jc(e,e.return,n)}}break;case 1:gl(n,e),vl(e),512&r&&null!==t&&Zs(t,t.return);break;case 5:if(gl(n,e),vl(e),512&r&&null!==t&&Zs(t,t.return),32&e.flags){var i=e.stateNode;try{me(i,"")}catch(n){jc(e,e.return,n)}}if(4&r&&null!=(i=e.stateNode)){var a=e.memoizedProps,s=null!==t?t.memoizedProps:a,l=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===l&&"radio"===a.type&&null!=a.name&&X(i,a),xe(l,s);var u=xe(l,a);for(s=0;s<c.length;s+=2){var d=c[s],m=c[s+1];"style"===d?ve(i,m):"dangerouslySetInnerHTML"===d?de(i,m):"children"===d?me(i,m):x(i,d,m,u)}switch(l){case"input":Z(i,a);break;case"textarea":oe(i,a);break;case"select":var p=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!a.multiple;var g=a.value;null!=g?te(i,!!a.multiple,g,!1):p!==!!a.multiple&&(null!=a.defaultValue?te(i,!!a.multiple,a.defaultValue,!0):te(i,!!a.multiple,a.multiple?[]:"",!1))}i[pi]=a}catch(n){jc(e,e.return,n)}}break;case 6:if(gl(n,e),vl(e),4&r){if(null===e.stateNode)throw Error(o(162));i=e.stateNode,a=e.memoizedProps;try{i.nodeValue=a}catch(n){jc(e,e.return,n)}}break;case 3:if(gl(n,e),vl(e),4&r&&null!==t&&t.memoizedState.isDehydrated)try{Wn(n.containerInfo)}catch(n){jc(e,e.return,n)}break;case 4:default:gl(n,e),vl(e);break;case 13:gl(n,e),vl(e),8192&(i=e.child).flags&&(a=null!==i.memoizedState,i.stateNode.isHidden=a,!a||null!==i.alternate&&null!==i.alternate.memoizedState||(Fl=Xe())),4&r&&pl(e);break;case 22:if(d=null!==t&&null!==t.memoizedState,1&e.mode?(Ks=(u=Ks)||d,gl(n,e),Ks=u):gl(n,e),vl(e),8192&r){if(u=null!==e.memoizedState,(e.stateNode.isHidden=u)&&!d&&1&e.mode)for(Xs=e,d=e.child;null!==d;){for(m=Xs=d;null!==Xs;){switch(g=(p=Xs).child,p.tag){case 0:case 11:case 14:case 15:nl(4,p,p.return);break;case 1:Zs(p,p.return);var h=p.stateNode;if("function"==typeof h.componentWillUnmount){r=p,t=p.return;try{n=r,h.props=n.memoizedProps,h.state=n.memoizedState,h.componentWillUnmount()}catch(e){jc(r,t,e)}}break;case 5:Zs(p,p.return);break;case 22:if(null!==p.memoizedState){yl(m);continue}}null!==g?(g.return=p,Xs=g):yl(m)}d=d.sibling}e:for(d=null,m=e;;){if(5===m.tag){if(null===d){d=m;try{i=m.stateNode,u?"function"==typeof(a=i.style).setProperty?a.setProperty("display","none","important"):a.display="none":(l=m.stateNode,s=null!=(c=m.memoizedProps.style)&&c.hasOwnProperty("display")?c.display:null,l.style.display=he("display",s))}catch(n){jc(e,e.return,n)}}}else if(6===m.tag){if(null===d)try{m.stateNode.nodeValue=u?"":m.memoizedProps}catch(n){jc(e,e.return,n)}}else if((22!==m.tag&&23!==m.tag||null===m.memoizedState||m===e)&&null!==m.child){m.child.return=m,m=m.child;continue}if(m===e)break e;for(;null===m.sibling;){if(null===m.return||m.return===e)break e;d===m&&(d=null),m=m.return}d===m&&(d=null),m.sibling.return=m.return,m=m.sibling}}break;case 19:gl(n,e),vl(e),4&r&&pl(e);case 21:}}function vl(e){var n=e.flags;if(2&n){try{e:{for(var t=e.return;null!==t;){if(ol(t)){var r=t;break e}t=t.return}throw Error(o(160))}switch(r.tag){case 5:var i=r.stateNode;32&r.flags&&(me(i,""),r.flags&=-33),ll(e,al(e),i);break;case 3:case 4:var a=r.stateNode.containerInfo;sl(e,al(e),a);break;default:throw Error(o(161))}}catch(n){jc(e,e.return,n)}e.flags&=-3}4096&n&&(e.flags&=-4097)}function fl(e,n,t){Xs=e,bl(e,n,t)}function bl(e,n,t){for(var r=!!(1&e.mode);null!==Xs;){var i=Xs,o=i.child;if(22===i.tag&&r){var a=null!==i.memoizedState||Gs;if(!a){var s=i.alternate,l=null!==s&&null!==s.memoizedState||Ks;s=Gs;var c=Ks;if(Gs=a,(Ks=l)&&!c)for(Xs=i;null!==Xs;)l=(a=Xs).child,22===a.tag&&null!==a.memoizedState?kl(i):null!==l?(l.return=a,Xs=l):kl(i);for(;null!==o;)Xs=o,bl(o,n,t),o=o.sibling;Xs=i,Gs=s,Ks=c}xl(e)}else 8772&i.subtreeFlags&&null!==o?(o.return=i,Xs=o):xl(e)}}function xl(e){for(;null!==Xs;){var n=Xs;if(8772&n.flags){var t=n.alternate;try{if(8772&n.flags)switch(n.tag){case 0:case 11:case 15:Ks||tl(5,n);break;case 1:var r=n.stateNode;if(4&n.flags&&!Ks)if(null===t)r.componentDidMount();else{var i=n.elementType===n.type?t.memoizedProps:ts(n.type,t.memoizedProps);r.componentDidUpdate(i,t.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var a=n.updateQueue;null!==a&&Vo(n,a,r);break;case 3:var s=n.updateQueue;if(null!==s){if(t=null,null!==n.child)switch(n.child.tag){case 5:case 1:t=n.child.stateNode}Vo(n,s,t)}break;case 5:var l=n.stateNode;if(null===t&&4&n.flags){t=l;var c=n.memoizedProps;switch(n.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&t.focus();break;case"img":c.src&&(t.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===n.memoizedState){var u=n.alternate;if(null!==u){var d=u.memoizedState;if(null!==d){var m=d.dehydrated;null!==m&&Wn(m)}}}break;default:throw Error(o(163))}Ks||512&n.flags&&rl(n)}catch(e){jc(n,n.return,e)}}if(n===e){Xs=null;break}if(null!==(t=n.sibling)){t.return=n.return,Xs=t;break}Xs=n.return}}function yl(e){for(;null!==Xs;){var n=Xs;if(n===e){Xs=null;break}var t=n.sibling;if(null!==t){t.return=n.return,Xs=t;break}Xs=n.return}}function kl(e){for(;null!==Xs;){var n=Xs;try{switch(n.tag){case 0:case 11:case 15:var t=n.return;try{tl(4,n)}catch(e){jc(n,t,e)}break;case 1:var r=n.stateNode;if("function"==typeof r.componentDidMount){var i=n.return;try{r.componentDidMount()}catch(e){jc(n,i,e)}}var o=n.return;try{rl(n)}catch(e){jc(n,o,e)}break;case 5:var a=n.return;try{rl(n)}catch(e){jc(n,a,e)}}}catch(e){jc(n,n.return,e)}if(n===e){Xs=null;break}var s=n.sibling;if(null!==s){s.return=n.return,Xs=s;break}Xs=n.return}}var wl,jl=Math.ceil,Cl=y.ReactCurrentDispatcher,Sl=y.ReactCurrentOwner,Nl=y.ReactCurrentBatchConfig,El=0,Pl=null,Dl=null,Ml=0,Ol=0,Tl=Ci(0),Al=0,Ll=null,zl=0,Il=0,Rl=0,Bl=null,_l=null,Fl=0,Ul=1/0,Hl=null,Wl=!1,Vl=null,ql=null,$l=!1,Yl=null,Gl=0,Kl=0,Ql=null,Xl=-1,Zl=0;function Jl(){return 6&El?Xe():-1!==Xl?Xl:Xl=Xe()}function ec(e){return 1&e.mode?2&El&&0!==Ml?Ml&-Ml:null!==vo.transition?(0===Zl&&(Zl=vn()),Zl):0!==(e=yn)?e:e=void 0===(e=window.event)?16:Xn(e.type):1}function nc(e,n,t,r){if(50<Kl)throw Kl=0,Ql=null,Error(o(185));bn(e,t,r),2&El&&e===Pl||(e===Pl&&(!(2&El)&&(Il|=t),4===Al&&ac(e,Ml)),tc(e,r),1===t&&0===El&&!(1&n.mode)&&(Ul=Xe()+500,_i&&Hi()))}function tc(e,n){var t=e.callbackNode;!function(e,n){for(var t=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,o=e.pendingLanes;0<o;){var a=31-sn(o),s=1<<a,l=i[a];-1===l?0!==(s&t)&&0===(s&r)||(i[a]=gn(s,n)):l<=n&&(e.expiredLanes|=s),o&=~s}}(e,n);var r=pn(e,e===Pl?Ml:0);if(0===r)null!==t&&Ge(t),e.callbackNode=null,e.callbackPriority=0;else if(n=r&-r,e.callbackPriority!==n){if(null!=t&&Ge(t),1===n)0===e.tag?function(e){_i=!0,Ui(e)}(sc.bind(null,e)):Ui(sc.bind(null,e)),ai(function(){!(6&El)&&Hi()}),t=null;else{switch(kn(r)){case 1:t=Je;break;case 4:t=en;break;case 16:default:t=nn;break;case 536870912:t=rn}t=Pc(t,rc.bind(null,e))}e.callbackPriority=n,e.callbackNode=t}}function rc(e,n){if(Xl=-1,Zl=0,6&El)throw Error(o(327));var t=e.callbackNode;if(kc()&&e.callbackNode!==t)return null;var r=pn(e,e===Pl?Ml:0);if(0===r)return null;if(30&r||0!==(r&e.expiredLanes)||n)n=hc(e,r);else{n=r;var i=El;El|=2;var a=pc();for(Pl===e&&Ml===n||(Hl=null,Ul=Xe()+500,dc(e,n));;)try{fc();break}catch(n){mc(e,n)}Eo(),Cl.current=a,El=i,null!==Dl?n=0:(Pl=null,Ml=0,n=Al)}if(0!==n){if(2===n&&(0!==(i=hn(e))&&(r=i,n=ic(e,i))),1===n)throw t=Ll,dc(e,0),ac(e,r),tc(e,Xe()),t;if(6===n)ac(e,r);else{if(i=e.current.alternate,!(30&r||function(e){for(var n=e;;){if(16384&n.flags){var t=n.updateQueue;if(null!==t&&null!==(t=t.stores))for(var r=0;r<t.length;r++){var i=t[r],o=i.getSnapshot;i=i.value;try{if(!sr(o(),i))return!1}catch(e){return!1}}}if(t=n.child,16384&n.subtreeFlags&&null!==t)t.return=n,n=t;else{if(n===e)break;for(;null===n.sibling;){if(null===n.return||n.return===e)return!0;n=n.return}n.sibling.return=n.return,n=n.sibling}}return!0}(i)||(n=hc(e,r),2===n&&(a=hn(e),0!==a&&(r=a,n=ic(e,a))),1!==n)))throw t=Ll,dc(e,0),ac(e,r),tc(e,Xe()),t;switch(e.finishedWork=i,e.finishedLanes=r,n){case 0:case 1:throw Error(o(345));case 2:case 5:yc(e,_l,Hl);break;case 3:if(ac(e,r),(130023424&r)===r&&10<(n=Fl+500-Xe())){if(0!==pn(e,0))break;if(((i=e.suspendedLanes)&r)!==r){Jl(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=ri(yc.bind(null,e,_l,Hl),n);break}yc(e,_l,Hl);break;case 4:if(ac(e,r),(4194240&r)===r)break;for(n=e.eventTimes,i=-1;0<r;){var s=31-sn(r);a=1<<s,(s=n[s])>i&&(i=s),r&=~a}if(r=i,10<(r=(120>(r=Xe()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*jl(r/1960))-r)){e.timeoutHandle=ri(yc.bind(null,e,_l,Hl),r);break}yc(e,_l,Hl);break;default:throw Error(o(329))}}}return tc(e,Xe()),e.callbackNode===t?rc.bind(null,e):null}function ic(e,n){var t=Bl;return e.current.memoizedState.isDehydrated&&(dc(e,n).flags|=256),2!==(e=hc(e,n))&&(n=_l,_l=t,null!==n&&oc(n)),e}function oc(e){null===_l?_l=e:_l.push.apply(_l,e)}function ac(e,n){for(n&=~Rl,n&=~Il,e.suspendedLanes|=n,e.pingedLanes&=~n,e=e.expirationTimes;0<n;){var t=31-sn(n),r=1<<t;e[t]=-1,n&=~r}}function sc(e){if(6&El)throw Error(o(327));kc();var n=pn(e,0);if(!(1&n))return tc(e,Xe()),null;var t=hc(e,n);if(0!==e.tag&&2===t){var r=hn(e);0!==r&&(n=r,t=ic(e,r))}if(1===t)throw t=Ll,dc(e,0),ac(e,n),tc(e,Xe()),t;if(6===t)throw Error(o(345));return e.finishedWork=e.current.alternate,e.finishedLanes=n,yc(e,_l,Hl),tc(e,Xe()),null}function lc(e,n){var t=El;El|=1;try{return e(n)}finally{0===(El=t)&&(Ul=Xe()+500,_i&&Hi())}}function cc(e){null!==Yl&&0===Yl.tag&&!(6&El)&&kc();var n=El;El|=1;var t=Nl.transition,r=yn;try{if(Nl.transition=null,yn=1,e)return e()}finally{yn=r,Nl.transition=t,!(6&(El=n))&&Hi()}}function uc(){Ol=Tl.current,Si(Tl)}function dc(e,n){e.finishedWork=null,e.finishedLanes=0;var t=e.timeoutHandle;if(-1!==t&&(e.timeoutHandle=-1,ii(t)),null!==Dl)for(t=Dl.return;null!==t;){var r=t;switch(no(r),r.tag){case 1:null!=(r=r.type.childContextTypes)&&Ai();break;case 3:Xo(),Si(Di),Si(Pi),ra();break;case 5:Jo(r);break;case 4:Xo();break;case 13:case 19:Si(ea);break;case 10:Po(r.type._context);break;case 22:case 23:uc()}t=t.return}if(Pl=e,Dl=e=Tc(e.current,null),Ml=Ol=n,Al=0,Ll=null,Rl=Il=zl=0,_l=Bl=null,null!==To){for(n=0;n<To.length;n++)if(null!==(r=(t=To[n]).interleaved)){t.interleaved=null;var i=r.next,o=t.pending;if(null!==o){var a=o.next;o.next=i,r.next=a}t.pending=r}To=null}return e}function mc(e,n){for(;;){var t=Dl;try{if(Eo(),ia.current=Za,ua){for(var r=sa.memoizedState;null!==r;){var i=r.queue;null!==i&&(i.pending=null),r=r.next}ua=!1}if(aa=0,ca=la=sa=null,da=!1,ma=0,Sl.current=null,null===t||null===t.return){Al=1,Ll=n,Dl=null;break}e:{var a=e,s=t.return,l=t,c=n;if(n=Ml,l.flags|=32768,null!==c&&"object"==typeof c&&"function"==typeof c.then){var u=c,d=l,m=d.tag;if(!(1&d.mode||0!==m&&11!==m&&15!==m)){var p=d.alternate;p?(d.updateQueue=p.updateQueue,d.memoizedState=p.memoizedState,d.lanes=p.lanes):(d.updateQueue=null,d.memoizedState=null)}var g=vs(s);if(null!==g){g.flags&=-257,fs(g,s,l,0,n),1&g.mode&&hs(a,u,n),c=u;var h=(n=g).updateQueue;if(null===h){var v=new Set;v.add(c),n.updateQueue=v}else h.add(c);break e}if(!(1&n)){hs(a,u,n),gc();break e}c=Error(o(426))}else if(io&&1&l.mode){var f=vs(s);if(null!==f){!(65536&f.flags)&&(f.flags|=256),fs(f,s,l,0,n),ho(cs(c,l));break e}}a=c=cs(c,l),4!==Al&&(Al=2),null===Bl?Bl=[a]:Bl.push(a),a=s;do{switch(a.tag){case 3:a.flags|=65536,n&=-n,a.lanes|=n,Ho(a,ps(0,c,n));break e;case 1:l=c;var b=a.type,x=a.stateNode;if(!(128&a.flags||"function"!=typeof b.getDerivedStateFromError&&(null===x||"function"!=typeof x.componentDidCatch||null!==ql&&ql.has(x)))){a.flags|=65536,n&=-n,a.lanes|=n,Ho(a,gs(a,l,n));break e}}a=a.return}while(null!==a)}xc(t)}catch(e){n=e,Dl===t&&null!==t&&(Dl=t=t.return);continue}break}}function pc(){var e=Cl.current;return Cl.current=Za,null===e?Za:e}function gc(){0!==Al&&3!==Al&&2!==Al||(Al=4),null===Pl||!(268435455&zl)&&!(268435455&Il)||ac(Pl,Ml)}function hc(e,n){var t=El;El|=2;var r=pc();for(Pl===e&&Ml===n||(Hl=null,dc(e,n));;)try{vc();break}catch(n){mc(e,n)}if(Eo(),El=t,Cl.current=r,null!==Dl)throw Error(o(261));return Pl=null,Ml=0,Al}function vc(){for(;null!==Dl;)bc(Dl)}function fc(){for(;null!==Dl&&!Ke();)bc(Dl)}function bc(e){var n=wl(e.alternate,e,Ol);e.memoizedProps=e.pendingProps,null===n?xc(e):Dl=n,Sl.current=null}function xc(e){var n=e;do{var t=n.alternate;if(e=n.return,32768&n.flags){if(null!==(t=Ys(t,n)))return t.flags&=32767,void(Dl=t);if(null===e)return Al=6,void(Dl=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}else if(null!==(t=$s(t,n,Ol)))return void(Dl=t);if(null!==(n=n.sibling))return void(Dl=n);Dl=n=e}while(null!==n);0===Al&&(Al=5)}function yc(e,n,t){var r=yn,i=Nl.transition;try{Nl.transition=null,yn=1,function(e,n,t,r){do{kc()}while(null!==Yl);if(6&El)throw Error(o(327));t=e.finishedWork;var i=e.finishedLanes;if(null===t)return null;if(e.finishedWork=null,e.finishedLanes=0,t===e.current)throw Error(o(177));e.callbackNode=null,e.callbackPriority=0;var a=t.lanes|t.childLanes;if(function(e,n){var t=e.pendingLanes&~n;e.pendingLanes=n,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=n,e.mutableReadLanes&=n,e.entangledLanes&=n,n=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<t;){var i=31-sn(t),o=1<<i;n[i]=0,r[i]=-1,e[i]=-1,t&=~o}}(e,a),e===Pl&&(Dl=Pl=null,Ml=0),!(2064&t.subtreeFlags)&&!(2064&t.flags)||$l||($l=!0,Pc(nn,function(){return kc(),null})),a=!!(15990&t.flags),!!(15990&t.subtreeFlags)||a){a=Nl.transition,Nl.transition=null;var s=yn;yn=1;var l=El;El|=4,Sl.current=null,function(e,n){if(ei=qn,pr(e=mr())){if("selectionStart"in e)var t={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(t=(t=e.ownerDocument)&&t.defaultView||window).getSelection&&t.getSelection();if(r&&0!==r.rangeCount){t=r.anchorNode;var i=r.anchorOffset,a=r.focusNode;r=r.focusOffset;try{t.nodeType,a.nodeType}catch(e){t=null;break e}var s=0,l=-1,c=-1,u=0,d=0,m=e,p=null;n:for(;;){for(var g;m!==t||0!==i&&3!==m.nodeType||(l=s+i),m!==a||0!==r&&3!==m.nodeType||(c=s+r),3===m.nodeType&&(s+=m.nodeValue.length),null!==(g=m.firstChild);)p=m,m=g;for(;;){if(m===e)break n;if(p===t&&++u===i&&(l=s),p===a&&++d===r&&(c=s),null!==(g=m.nextSibling))break;p=(m=p).parentNode}m=g}t=-1===l||-1===c?null:{start:l,end:c}}else t=null}t=t||{start:0,end:0}}else t=null;for(ni={focusedElem:e,selectionRange:t},qn=!1,Xs=n;null!==Xs;)if(e=(n=Xs).child,1028&n.subtreeFlags&&null!==e)e.return=n,Xs=e;else for(;null!==Xs;){n=Xs;try{var h=n.alternate;if(1024&n.flags)switch(n.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==h){var v=h.memoizedProps,f=h.memoizedState,b=n.stateNode,x=b.getSnapshotBeforeUpdate(n.elementType===n.type?v:ts(n.type,v),f);b.__reactInternalSnapshotBeforeUpdate=x}break;case 3:var y=n.stateNode.containerInfo;1===y.nodeType?y.textContent="":9===y.nodeType&&y.documentElement&&y.removeChild(y.documentElement);break;default:throw Error(o(163))}}catch(e){jc(n,n.return,e)}if(null!==(e=n.sibling)){e.return=n.return,Xs=e;break}Xs=n.return}h=el,el=!1}(e,t),hl(t,e),gr(ni),qn=!!ei,ni=ei=null,e.current=t,fl(t,e,i),Qe(),El=l,yn=s,Nl.transition=a}else e.current=t;if($l&&($l=!1,Yl=e,Gl=i),a=e.pendingLanes,0===a&&(ql=null),function(e){if(an&&"function"==typeof an.onCommitFiberRoot)try{an.onCommitFiberRoot(on,e,void 0,!(128&~e.current.flags))}catch(e){}}(t.stateNode),tc(e,Xe()),null!==n)for(r=e.onRecoverableError,t=0;t<n.length;t++)i=n[t],r(i.value,{componentStack:i.stack,digest:i.digest});if(Wl)throw Wl=!1,e=Vl,Vl=null,e;!!(1&Gl)&&0!==e.tag&&kc(),a=e.pendingLanes,1&a?e===Ql?Kl++:(Kl=0,Ql=e):Kl=0,Hi()}(e,n,t,r)}finally{Nl.transition=i,yn=r}return null}function kc(){if(null!==Yl){var e=kn(Gl),n=Nl.transition,t=yn;try{if(Nl.transition=null,yn=16>e?16:e,null===Yl)var r=!1;else{if(e=Yl,Yl=null,Gl=0,6&El)throw Error(o(331));var i=El;for(El|=4,Xs=e.current;null!==Xs;){var a=Xs,s=a.child;if(16&Xs.flags){var l=a.deletions;if(null!==l){for(var c=0;c<l.length;c++){var u=l[c];for(Xs=u;null!==Xs;){var d=Xs;switch(d.tag){case 0:case 11:case 15:nl(8,d,a)}var m=d.child;if(null!==m)m.return=d,Xs=m;else for(;null!==Xs;){var p=(d=Xs).sibling,g=d.return;if(il(d),d===u){Xs=null;break}if(null!==p){p.return=g,Xs=p;break}Xs=g}}}var h=a.alternate;if(null!==h){var v=h.child;if(null!==v){h.child=null;do{var f=v.sibling;v.sibling=null,v=f}while(null!==v)}}Xs=a}}if(2064&a.subtreeFlags&&null!==s)s.return=a,Xs=s;else e:for(;null!==Xs;){if(2048&(a=Xs).flags)switch(a.tag){case 0:case 11:case 15:nl(9,a,a.return)}var b=a.sibling;if(null!==b){b.return=a.return,Xs=b;break e}Xs=a.return}}var x=e.current;for(Xs=x;null!==Xs;){var y=(s=Xs).child;if(2064&s.subtreeFlags&&null!==y)y.return=s,Xs=y;else e:for(s=x;null!==Xs;){if(2048&(l=Xs).flags)try{switch(l.tag){case 0:case 11:case 15:tl(9,l)}}catch(e){jc(l,l.return,e)}if(l===s){Xs=null;break e}var k=l.sibling;if(null!==k){k.return=l.return,Xs=k;break e}Xs=l.return}}if(El=i,Hi(),an&&"function"==typeof an.onPostCommitFiberRoot)try{an.onPostCommitFiberRoot(on,e)}catch(e){}r=!0}return r}finally{yn=t,Nl.transition=n}}return!1}function wc(e,n,t){e=Fo(e,n=ps(0,n=cs(t,n),1),1),n=Jl(),null!==e&&(bn(e,1,n),tc(e,n))}function jc(e,n,t){if(3===e.tag)wc(e,e,t);else for(;null!==n;){if(3===n.tag){wc(n,e,t);break}if(1===n.tag){var r=n.stateNode;if("function"==typeof n.type.getDerivedStateFromError||"function"==typeof r.componentDidCatch&&(null===ql||!ql.has(r))){n=Fo(n,e=gs(n,e=cs(t,e),1),1),e=Jl(),null!==n&&(bn(n,1,e),tc(n,e));break}}n=n.return}}function Cc(e,n,t){var r=e.pingCache;null!==r&&r.delete(n),n=Jl(),e.pingedLanes|=e.suspendedLanes&t,Pl===e&&(Ml&t)===t&&(4===Al||3===Al&&(130023424&Ml)===Ml&&500>Xe()-Fl?dc(e,0):Rl|=t),tc(e,n)}function Sc(e,n){0===n&&(1&e.mode?(n=dn,!(130023424&(dn<<=1))&&(dn=4194304)):n=1);var t=Jl();null!==(e=zo(e,n))&&(bn(e,n,t),tc(e,t))}function Nc(e){var n=e.memoizedState,t=0;null!==n&&(t=n.retryLane),Sc(e,t)}function Ec(e,n){var t=0;switch(e.tag){case 13:var r=e.stateNode,i=e.memoizedState;null!==i&&(t=i.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(o(314))}null!==r&&r.delete(n),Sc(e,t)}function Pc(e,n){return Ye(e,n)}function Dc(e,n,t,r){this.tag=e,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=n,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Mc(e,n,t,r){return new Dc(e,n,t,r)}function Oc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Tc(e,n){var t=e.alternate;return null===t?((t=Mc(e.tag,n,e.key,e.mode)).elementType=e.elementType,t.type=e.type,t.stateNode=e.stateNode,t.alternate=e,e.alternate=t):(t.pendingProps=n,t.type=e.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=14680064&e.flags,t.childLanes=e.childLanes,t.lanes=e.lanes,t.child=e.child,t.memoizedProps=e.memoizedProps,t.memoizedState=e.memoizedState,t.updateQueue=e.updateQueue,n=e.dependencies,t.dependencies=null===n?null:{lanes:n.lanes,firstContext:n.firstContext},t.sibling=e.sibling,t.index=e.index,t.ref=e.ref,t}function Ac(e,n,t,r,i,a){var s=2;if(r=e,"function"==typeof e)Oc(e)&&(s=1);else if("string"==typeof e)s=5;else e:switch(e){case j:return Lc(t.children,i,a,n);case C:s=8,i|=8;break;case S:return(e=Mc(12,t,n,2|i)).elementType=S,e.lanes=a,e;case D:return(e=Mc(13,t,n,i)).elementType=D,e.lanes=a,e;case M:return(e=Mc(19,t,n,i)).elementType=M,e.lanes=a,e;case A:return zc(t,i,a,n);default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case N:s=10;break e;case E:s=9;break e;case P:s=11;break e;case O:s=14;break e;case T:s=16,r=null;break e}throw Error(o(130,null==e?e:typeof e,""))}return(n=Mc(s,t,n,i)).elementType=e,n.type=r,n.lanes=a,n}function Lc(e,n,t,r){return(e=Mc(7,e,r,n)).lanes=t,e}function zc(e,n,t,r){return(e=Mc(22,e,r,n)).elementType=A,e.lanes=t,e.stateNode={isHidden:!1},e}function Ic(e,n,t){return(e=Mc(6,e,null,n)).lanes=t,e}function Rc(e,n,t){return(n=Mc(4,null!==e.children?e.children:[],e.key,n)).lanes=t,n.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},n}function Bc(e,n,t,r,i){this.tag=n,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=fn(0),this.expirationTimes=fn(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=fn(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function _c(e,n,t,r,i,o,a,s,l){return e=new Bc(e,n,t,s,l),1===n?(n=1,!0===o&&(n|=8)):n=0,o=Mc(3,null,null,n),e.current=o,o.stateNode=e,o.memoizedState={element:r,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ro(o),e}function Fc(e){if(!e)return Ei;e:{if(He(e=e._reactInternals)!==e||1!==e.tag)throw Error(o(170));var n=e;do{switch(n.tag){case 3:n=n.stateNode.context;break e;case 1:if(Ti(n.type)){n=n.stateNode.__reactInternalMemoizedMergedChildContext;break e}}n=n.return}while(null!==n);throw Error(o(171))}if(1===e.tag){var t=e.type;if(Ti(t))return zi(e,t,n)}return n}function Uc(e,n,t,r,i,o,a,s,l){return(e=_c(t,r,!0,e,0,o,0,s,l)).context=Fc(null),t=e.current,(o=_o(r=Jl(),i=ec(t))).callback=null!=n?n:null,Fo(t,o,i),e.current.lanes=i,bn(e,i,r),tc(e,r),e}function Hc(e,n,t,r){var i=n.current,o=Jl(),a=ec(i);return t=Fc(t),null===n.context?n.context=t:n.pendingContext=t,(n=_o(o,a)).payload={element:e},null!==(r=void 0===r?null:r)&&(n.callback=r),null!==(e=Fo(i,n,a))&&(nc(e,i,a,o),Uo(e,i,a)),a}function Wc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Vc(e,n){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var t=e.retryLane;e.retryLane=0!==t&&t<n?t:n}}function qc(e,n){Vc(e,n),(e=e.alternate)&&Vc(e,n)}wl=function(e,n,t){if(null!==e)if(e.memoizedProps!==n.pendingProps||Di.current)xs=!0;else{if(0===(e.lanes&t)&&!(128&n.flags))return xs=!1,function(e,n,t){switch(n.tag){case 3:Ds(n),go();break;case 5:Zo(n);break;case 1:Ti(n.type)&&Ii(n);break;case 4:Qo(n,n.stateNode.containerInfo);break;case 10:var r=n.type._context,i=n.memoizedProps.value;Ni(jo,r._currentValue),r._currentValue=i;break;case 13:if(null!==(r=n.memoizedState))return null!==r.dehydrated?(Ni(ea,1&ea.current),n.flags|=128,null):0!==(t&n.child.childLanes)?Is(e,n,t):(Ni(ea,1&ea.current),null!==(e=Ws(e,n,t))?e.sibling:null);Ni(ea,1&ea.current);break;case 19:if(r=0!==(t&n.childLanes),128&e.flags){if(r)return Us(e,n,t);n.flags|=128}if(null!==(i=n.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),Ni(ea,ea.current),r)break;return null;case 22:case 23:return n.lanes=0,Cs(e,n,t)}return Ws(e,n,t)}(e,n,t);xs=!!(131072&e.flags)}else xs=!1,io&&1048576&n.flags&&Ji(n,$i,n.index);switch(n.lanes=0,n.tag){case 2:var r=n.type;Hs(e,n),e=n.pendingProps;var i=Oi(n,Pi.current);Mo(n,t),i=va(null,n,r,e,i,t);var a=fa();return n.flags|=1,"object"==typeof i&&null!==i&&"function"==typeof i.render&&void 0===i.$$typeof?(n.tag=1,n.memoizedState=null,n.updateQueue=null,Ti(r)?(a=!0,Ii(n)):a=!1,n.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,Ro(n),i.updater=is,n.stateNode=i,i._reactInternals=n,ls(n,r,e,t),n=Ps(null,n,r,!0,a,t)):(n.tag=0,io&&a&&eo(n),ys(null,n,i,t),n=n.child),n;case 16:r=n.elementType;e:{switch(Hs(e,n),e=n.pendingProps,r=(i=r._init)(r._payload),n.type=r,i=n.tag=function(e){if("function"==typeof e)return Oc(e)?1:0;if(null!=e){if((e=e.$$typeof)===P)return 11;if(e===O)return 14}return 2}(r),e=ts(r,e),i){case 0:n=Ns(null,n,r,e,t);break e;case 1:n=Es(null,n,r,e,t);break e;case 11:n=ks(null,n,r,e,t);break e;case 14:n=ws(null,n,r,ts(r.type,e),t);break e}throw Error(o(306,r,""))}return n;case 0:return r=n.type,i=n.pendingProps,Ns(e,n,r,i=n.elementType===r?i:ts(r,i),t);case 1:return r=n.type,i=n.pendingProps,Es(e,n,r,i=n.elementType===r?i:ts(r,i),t);case 3:e:{if(Ds(n),null===e)throw Error(o(387));r=n.pendingProps,i=(a=n.memoizedState).element,Bo(e,n),Wo(n,r,null,t);var s=n.memoizedState;if(r=s.element,a.isDehydrated){if(a={element:r,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},n.updateQueue.baseState=a,n.memoizedState=a,256&n.flags){n=Ms(e,n,r,t,i=cs(Error(o(423)),n));break e}if(r!==i){n=Ms(e,n,r,t,i=cs(Error(o(424)),n));break e}for(ro=ci(n.stateNode.containerInfo.firstChild),to=n,io=!0,oo=null,t=wo(n,null,r,t),n.child=t;t;)t.flags=-3&t.flags|4096,t=t.sibling}else{if(go(),r===i){n=Ws(e,n,t);break e}ys(e,n,r,t)}n=n.child}return n;case 5:return Zo(n),null===e&&co(n),r=n.type,i=n.pendingProps,a=null!==e?e.memoizedProps:null,s=i.children,ti(r,i)?s=null:null!==a&&ti(r,a)&&(n.flags|=32),Ss(e,n),ys(e,n,s,t),n.child;case 6:return null===e&&co(n),null;case 13:return Is(e,n,t);case 4:return Qo(n,n.stateNode.containerInfo),r=n.pendingProps,null===e?n.child=ko(n,null,r,t):ys(e,n,r,t),n.child;case 11:return r=n.type,i=n.pendingProps,ks(e,n,r,i=n.elementType===r?i:ts(r,i),t);case 7:return ys(e,n,n.pendingProps,t),n.child;case 8:case 12:return ys(e,n,n.pendingProps.children,t),n.child;case 10:e:{if(r=n.type._context,i=n.pendingProps,a=n.memoizedProps,s=i.value,Ni(jo,r._currentValue),r._currentValue=s,null!==a)if(sr(a.value,s)){if(a.children===i.children&&!Di.current){n=Ws(e,n,t);break e}}else for(null!==(a=n.child)&&(a.return=n);null!==a;){var l=a.dependencies;if(null!==l){s=a.child;for(var c=l.firstContext;null!==c;){if(c.context===r){if(1===a.tag){(c=_o(-1,t&-t)).tag=2;var u=a.updateQueue;if(null!==u){var d=(u=u.shared).pending;null===d?c.next=c:(c.next=d.next,d.next=c),u.pending=c}}a.lanes|=t,null!==(c=a.alternate)&&(c.lanes|=t),Do(a.return,t,n),l.lanes|=t;break}c=c.next}}else if(10===a.tag)s=a.type===n.type?null:a.child;else if(18===a.tag){if(null===(s=a.return))throw Error(o(341));s.lanes|=t,null!==(l=s.alternate)&&(l.lanes|=t),Do(s,t,n),s=a.sibling}else s=a.child;if(null!==s)s.return=a;else for(s=a;null!==s;){if(s===n){s=null;break}if(null!==(a=s.sibling)){a.return=s.return,s=a;break}s=s.return}a=s}ys(e,n,i.children,t),n=n.child}return n;case 9:return i=n.type,r=n.pendingProps.children,Mo(n,t),r=r(i=Oo(i)),n.flags|=1,ys(e,n,r,t),n.child;case 14:return i=ts(r=n.type,n.pendingProps),ws(e,n,r,i=ts(r.type,i),t);case 15:return js(e,n,n.type,n.pendingProps,t);case 17:return r=n.type,i=n.pendingProps,i=n.elementType===r?i:ts(r,i),Hs(e,n),n.tag=1,Ti(r)?(e=!0,Ii(n)):e=!1,Mo(n,t),as(n,r,i),ls(n,r,i,t),Ps(null,n,r,!0,e,t);case 19:return Us(e,n,t);case 22:return Cs(e,n,t)}throw Error(o(156,n.tag))};var $c="function"==typeof reportError?reportError:function(e){console.error(e)};function Yc(e){this._internalRoot=e}function Gc(e){this._internalRoot=e}function Kc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Qc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Xc(){}function Zc(e,n,t,r,i){var o=t._reactRootContainer;if(o){var a=o;if("function"==typeof i){var s=i;i=function(){var e=Wc(a);s.call(e)}}Hc(n,a,e,i)}else a=function(e,n,t,r,i){if(i){if("function"==typeof r){var o=r;r=function(){var e=Wc(a);o.call(e)}}var a=Uc(n,r,e,0,null,!1,0,"",Xc);return e._reactRootContainer=a,e[gi]=a.current,Hr(8===e.nodeType?e.parentNode:e),cc(),a}for(;i=e.lastChild;)e.removeChild(i);if("function"==typeof r){var s=r;r=function(){var e=Wc(l);s.call(e)}}var l=_c(e,0,!1,null,0,!1,0,"",Xc);return e._reactRootContainer=l,e[gi]=l.current,Hr(8===e.nodeType?e.parentNode:e),cc(function(){Hc(n,l,t,r)}),l}(t,n,e,i,r);return Wc(a)}Gc.prototype.render=Yc.prototype.render=function(e){var n=this._internalRoot;if(null===n)throw Error(o(409));Hc(e,n,null,null)},Gc.prototype.unmount=Yc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var n=e.containerInfo;cc(function(){Hc(null,e,null,null)}),n[gi]=null}},Gc.prototype.unstable_scheduleHydration=function(e){if(e){var n=Sn();e={blockedOn:null,target:e,priority:n};for(var t=0;t<Ln.length&&0!==n&&n<Ln[t].priority;t++);Ln.splice(t,0,e),0===t&&Bn(e)}},wn=function(e){switch(e.tag){case 3:var n=e.stateNode;if(n.current.memoizedState.isDehydrated){var t=mn(n.pendingLanes);0!==t&&(xn(n,1|t),tc(n,Xe()),!(6&El)&&(Ul=Xe()+500,Hi()))}break;case 13:cc(function(){var n=zo(e,1);if(null!==n){var t=Jl();nc(n,e,1,t)}}),qc(e,1)}},jn=function(e){if(13===e.tag){var n=zo(e,134217728);if(null!==n)nc(n,e,134217728,Jl());qc(e,134217728)}},Cn=function(e){if(13===e.tag){var n=ec(e),t=zo(e,n);if(null!==t)nc(t,e,n,Jl());qc(e,n)}},Sn=function(){return yn},Nn=function(e,n){var t=yn;try{return yn=e,n()}finally{yn=t}},we=function(e,n,t){switch(n){case"input":if(Z(e,t),n=t.name,"radio"===t.type&&null!=n){for(t=e;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+n)+'][type="radio"]'),n=0;n<t.length;n++){var r=t[n];if(r!==e&&r.form===e.form){var i=ki(r);if(!i)throw Error(o(90));Y(r),Z(r,i)}}}break;case"textarea":oe(e,t);break;case"select":null!=(n=t.value)&&te(e,!!t.multiple,n,!1)}},Pe=lc,De=cc;var Jc={usingClientEntryPoint:!1,Events:[xi,yi,ki,Ne,Ee,lc]},eu={findFiberByHostInstance:bi,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},nu={bundleType:eu.bundleType,version:eu.version,rendererPackageName:eu.rendererPackageName,rendererConfig:eu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:y.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=qe(e))?null:e.stateNode},findFiberByHostInstance:eu.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var tu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!tu.isDisabled&&tu.supportsFiber)try{on=tu.inject(nu),an=tu}catch(ue){}}n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Jc,n.createPortal=function(e,n){var t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Kc(n))throw Error(o(200));return function(e,n,t){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:w,key:null==r?null:""+r,children:e,containerInfo:n,implementation:t}}(e,n,null,t)},n.createRoot=function(e,n){if(!Kc(e))throw Error(o(299));var t=!1,r="",i=$c;return null!=n&&(!0===n.unstable_strictMode&&(t=!0),void 0!==n.identifierPrefix&&(r=n.identifierPrefix),void 0!==n.onRecoverableError&&(i=n.onRecoverableError)),n=_c(e,1,!1,null,0,t,0,r,i),e[gi]=n.current,Hr(8===e.nodeType?e.parentNode:e),new Yc(n)},n.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var n=e._reactInternals;if(void 0===n){if("function"==typeof e.render)throw Error(o(188));throw e=Object.keys(e).join(","),Error(o(268,e))}return e=null===(e=qe(n))?null:e.stateNode},n.flushSync=function(e){return cc(e)},n.hydrate=function(e,n,t){if(!Qc(n))throw Error(o(200));return Zc(null,e,n,!0,t)},n.hydrateRoot=function(e,n,t){if(!Kc(e))throw Error(o(405));var r=null!=t&&t.hydratedSources||null,i=!1,a="",s=$c;if(null!=t&&(!0===t.unstable_strictMode&&(i=!0),void 0!==t.identifierPrefix&&(a=t.identifierPrefix),void 0!==t.onRecoverableError&&(s=t.onRecoverableError)),n=Uc(n,null,e,1,null!=t?t:null,i,0,a,s),e[gi]=n.current,Hr(e),r)for(e=0;e<r.length;e++)i=(i=(t=r[e])._getVersion)(t._source),null==n.mutableSourceEagerHydrationData?n.mutableSourceEagerHydrationData=[t,i]:n.mutableSourceEagerHydrationData.push(t,i);return new Gc(n)},n.render=function(e,n,t){if(!Qc(n))throw Error(o(200));return Zc(null,e,n,!1,t)},n.unmountComponentAtNode=function(e){if(!Qc(e))throw Error(o(40));return!!e._reactRootContainer&&(cc(function(){Zc(null,null,e,!1,function(){e._reactRootContainer=null,e[gi]=null})}),!0)},n.unstable_batchedUpdates=lc,n.unstable_renderSubtreeIntoContainer=function(e,n,t,r){if(!Qc(t))throw Error(o(200));if(null==e||void 0===e._reactInternals)throw Error(o(38));return Zc(e,n,t,!1,r)},n.version="18.3.1-next-f1338f8080-20240426"},601(e){e.exports=function(e){return e[1]}},659(e){var n={};e.exports=function(e,t){var r=function(e){if(void 0===n[e]){var t=document.querySelector(e);if(window.HTMLIFrameElement&&t instanceof window.HTMLIFrameElement)try{t=t.contentDocument.head}catch(e){t=null}n[e]=t}return n[e]}(e);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(t)}},674(e,n,t){t.r(n),t.d(n,{GENDER:()=>m,LOOM_SUMMARY_KEY:()=>u,MODULE_NAME:()=>l,SCHEMA_VERSION:()=>d,SETTINGS_KEY:()=>c,bumpLumiaConfigVersion:()=>q,clearClaudeCache:()=>$,deletePack:()=>L,deletePreset:()=>U,flushPendingSaves:()=>W,getCurrentRandomLumia:()=>f,getExtensionDirectory:()=>G,getLumiaConfigVersion:()=>V,getPackByName:()=>O,getPackByNameAsync:()=>T,getPacks:()=>M,getPresets:()=>_,getSelections:()=>I,getSettings:()=>v,initPackFileStorage:()=>E,isUsingFileStorage:()=>P,loadSettings:()=>N,migrateSettings:()=>j,resetAllSettings:()=>Y,resetRandomLumia:()=>x,savePack:()=>A,savePreferences:()=>R,savePreferencesImmediate:()=>B,savePreset:()=>F,saveSelections:()=>z,saveSettings:()=>D,setAllPresets:()=>H,setCurrentRandomLumia:()=>b});var r=t(92),i=t(699);function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function a(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach(function(n){s(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function s(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const l="lumia-injector",c="lumia_injector_settings",u="loom_summary",d=2,m={SHE_HER:0,HE_HIM:1,THEY_THEM:2},p={schemaVersion:d,packs:{},selectedDefinition:null,selectedBehaviors:[],selectedPersonalities:[],dominantBehavior:null,dominantPersonality:null,selectedLoomStyle:[],selectedLoomUtils:[],selectedLoomRetrofits:[],presets:{},activePresetName:null,chimeraMode:!1,selectedDefinitions:[],councilMode:!1,councilMembers:[],lumiaQuirks:"",stateSynthesis:{enabled:!1},lumiaOOCInterval:null,lumiaOOCStyle:"social",councilChatStyle:{enabled:!1,showTimestamps:!0,useLeetHandles:!0},councilTools:{enabled:!1,mode:"sidecar",timeoutMs:3e4,sidecarContextWindow:25,llm:{provider:"anthropic",model:"",endpoint:"",apiKey:"",temperature:.7,topP:1,maxTokens:4096}},sovereignHand:{enabled:!1,excludeLastMessage:!0,includeMessageInPrompt:!0},contextFilters:{htmlTags:{enabled:!1,keepDepth:3,stripFonts:!1,fontKeepDepth:3},detailsBlocks:{enabled:!1,keepDepth:3},loomItems:{enabled:!1,keepDepth:5}},messageTruncation:{enabled:!1,keepCount:50},summarization:{mode:"disabled",apiSource:"main",autoInterval:10,autoMessageContext:10,manualMessageContext:10,secondary:{provider:"openai",model:"",endpoint:"",apiKey:"",temperature:.7,topP:1,maxTokens:8192}},lumiaConfigVersion:1,lastLumiaChangeTimestamp:null,disableAnthropicCache:!1,trackedPresets:{},dismissedUpdateVersion:null,drawerSettings:{side:"right",verticalPosition:15},enableLandingPage:!0,landingPageChatsDisplayed:12,disableDefaultStateRestore:!0,capturedDefaultToggles:null};let g=a({},p),h=null;function v(){return g}function f(){return h}function b(e){h=e}function x(){h=null}function y(e){return{lumiaName:e.lumiaDefName,lumiaDefinition:e.lumiaDef||null,lumiaPersonality:e.lumia_personality||null,lumiaBehavior:e.lumia_behavior||null,avatarUrl:e.lumia_img||null,genderIdentity:m.SHE_HER,authorName:e.defAuthor||null,version:1}}function k(e){return{loomName:e.loomName,loomContent:e.loomContent,loomCategory:e.loomCategory,authorName:null,version:1}}function w(e){const n=[],t=[];for(const r of e.items||[])r.lumiaDefName?n.push(y(r)):r.loomCategory&&t.push(k(r));return{packName:e.name||e.packName,packAuthor:e.author||e.packAuthor||null,coverUrl:e.coverUrl||null,version:1,packExtras:e.packExtras||[],lumiaItems:n,loomItems:t,isCustom:e.isCustom||!1,url:e.url||""}}function j(){let e=!1;if((g.lumiaLibrary||g.worldBookData)&&0===Object.keys(g.packs).length){console.log("Lumia Injector: Migrating legacy settings...");let n=g.lumiaLibrary||[];if(0===n.length&&g.worldBookData&&console.warn("Legacy worldBookData found but cannot be migrated automatically. Please re-import your world book."),n.length>0){const t="Default (Legacy)";g.packs[t]={name:t,items:n,url:g.worldBookUrl||"Legacy"};const r=e=>{var t;return null===(t=n[e])||void 0===t?void 0:t.lumiaDefName};if("number"==typeof g.selectedDefinition){const e=r(g.selectedDefinition);g.selectedDefinition=e?{packName:t,itemName:e}:null}Array.isArray(g.selectedBehaviors)&&g.selectedBehaviors.length>0&&"number"==typeof g.selectedBehaviors[0]?g.selectedBehaviors=g.selectedBehaviors.map(e=>{const n=r(e);return n?{packName:t,itemName:n}:null}).filter(e=>e):g.selectedBehaviors=[],Array.isArray(g.selectedPersonalities)&&g.selectedPersonalities.length>0&&"number"==typeof g.selectedPersonalities[0]?g.selectedPersonalities=g.selectedPersonalities.map(e=>{const n=r(e);return n?{packName:t,itemName:n}:null}).filter(e=>e):g.selectedPersonalities=[],delete g.lumiaLibrary,delete g.worldBookData,delete g.worldBookUrl,e=!0}}(function(){let e=!1;const n=g.schemaVersion||1;if(n>=d)return!1;console.log("[".concat(l,"] Migrating packs from schema v").concat(n," to v").concat(d,"..."));for(const n in g.packs){const t=g.packs[n];!t.items||t.lumiaItems||t.loomItems||(console.log("[".concat(l,"] Migrating pack: ").concat(n)),g.packs[n]=w(t),e=!0)}return g.schemaVersion=d,e&&console.log("[".concat(l,"] Pack migration complete")),e})()&&(e=!0);for(const n in g.packs){const t=g.packs[n];t.url?!0===t.isCustom&&(console.log("[".concat(l,"] Fixing isCustom flag for URL pack: ").concat(n)),t.isCustom=!1,e=!0):!0!==t.isCustom&&(console.log("[".concat(l,"] Fixing isCustom flag for local pack: ").concat(n)),t.isCustom=!0,e=!0)}if(g.schemaVersion||(g.schemaVersion=d),g.packs||(g.packs={}),g.selectedBehaviors||(g.selectedBehaviors=[]),g.selectedPersonalities||(g.selectedPersonalities=[]),void 0===g.dominantBehavior&&(g.dominantBehavior=null),void 0===g.dominantPersonality&&(g.dominantPersonality=null),g.selectedLoomUtils||(g.selectedLoomUtils=[]),g.selectedLoomRetrofits||(g.selectedLoomRetrofits=[]),void 0===g.lumiaOOCInterval&&(g.lumiaOOCInterval=null),g.lumiaOOCStyle||(g.lumiaOOCStyle="social"),g.sovereignHand||(g.sovereignHand={enabled:!1,excludeLastMessage:!0,includeMessageInPrompt:!0}),void 0===g.sovereignHand.excludeLastMessage&&(g.sovereignHand.excludeLastMessage=!0),void 0===g.sovereignHand.includeMessageInPrompt&&(g.sovereignHand.includeMessageInPrompt=!0),g.contextFilters||(g.contextFilters={htmlTags:{enabled:!1,stripFonts:!1,fontKeepDepth:3},detailsBlocks:{enabled:!1,keepDepth:3},loomItems:{enabled:!1,keepDepth:5}}),g.contextFilters.htmlTags||(g.contextFilters.htmlTags={enabled:!1,keepDepth:3,stripFonts:!1,fontKeepDepth:3}),void 0===g.contextFilters.htmlTags.keepDepth&&(g.contextFilters.htmlTags.keepDepth=3),void 0===g.contextFilters.htmlTags.stripFonts&&(g.contextFilters.htmlTags.stripFonts=!1),void 0===g.contextFilters.htmlTags.fontKeepDepth&&(g.contextFilters.htmlTags.fontKeepDepth=3),g.contextFilters.detailsBlocks||(g.contextFilters.detailsBlocks={enabled:!1,keepDepth:3}),void 0===g.contextFilters.detailsBlocks.keepDepth&&(g.contextFilters.detailsBlocks.keepDepth=3),g.contextFilters.loomItems||(g.contextFilters.loomItems={enabled:!1,keepDepth:5}),void 0===g.contextFilters.loomItems.keepDepth&&(g.contextFilters.loomItems.keepDepth=5),g.messageTruncation||(g.messageTruncation={enabled:!1,keepCount:50}),void 0===g.messageTruncation.keepCount&&(g.messageTruncation.keepCount=50),g.summarization||(g.summarization={mode:"disabled",apiSource:"main",autoInterval:10,autoMessageContext:10,manualMessageContext:10,secondary:{provider:"openai",model:"",endpoint:"",apiKey:"",temperature:.7,topP:1,maxTokens:8192}}),void 0!==g.summarization.messageContext&&(g.summarization.autoMessageContext=g.summarization.messageContext,g.summarization.manualMessageContext=g.summarization.messageContext,delete g.summarization.messageContext,e=!0),void 0===g.summarization.autoMessageContext&&(g.summarization.autoMessageContext=10),void 0===g.summarization.manualMessageContext&&(g.summarization.manualMessageContext=10),g.summarization.secondary||(g.summarization.secondary={provider:"openai",model:"",endpoint:"",apiKey:"",temperature:.7,topP:1,maxTokens:8192}),void 0===g.summarization.secondary.topP&&(g.summarization.secondary.topP=1),(!g.summarization.secondary.maxTokens||g.summarization.secondary.maxTokens<256)&&(g.summarization.secondary.maxTokens=8192),g.presets||(g.presets={}),void 0===g.activePresetName&&(g.activePresetName=null),void 0===g.chimeraMode&&(g.chimeraMode=!1),g.selectedDefinitions||(g.selectedDefinitions=[]),void 0===g.councilMode&&(g.councilMode=!1),g.councilMembers||(g.councilMembers=[]),void 0!==g.councilQuirks&&void 0===g.lumiaQuirks&&(g.lumiaQuirks=g.councilQuirks,delete g.councilQuirks,e=!0),void 0===g.lumiaQuirks&&(g.lumiaQuirks=""),g.stateSynthesis||(g.stateSynthesis={enabled:!1}),g.councilChatStyle||(g.councilChatStyle={enabled:!1,showTimestamps:!0,useLeetHandles:!0}),void 0===g.councilChatStyle.enabled&&(g.councilChatStyle.enabled=!1),void 0===g.councilChatStyle.showTimestamps&&(g.councilChatStyle.showTimestamps=!0),void 0===g.councilChatStyle.useLeetHandles&&(g.councilChatStyle.useLeetHandles=!0),g.councilTools||(g.councilTools={enabled:!1,timeoutMs:3e4},e=!0),void 0===g.councilTools.enabled&&(g.councilTools.enabled=!1,e=!0),void 0===g.councilTools.timeoutMs&&(g.councilTools.timeoutMs=3e4,e=!0),!g.councilTools.llm){var n,t,r;const i=(null===(n=g.summarization)||void 0===n?void 0:n.secondary)||{};g.councilTools.llm={provider:i.provider||"anthropic",model:i.model||"",endpoint:i.endpoint||"",apiKey:i.apiKey||"",temperature:null!==(t=i.temperature)&&void 0!==t?t:.7,topP:null!==(r=i.topP)&&void 0!==r?r:1,maxTokens:i.maxTokens||4096},e=!0}return g.councilTools.mode||(g.councilTools.mode="sidecar",e=!0),void 0===g.councilTools.llm.topP&&(g.councilTools.llm.topP=1),(!g.councilTools.llm.maxTokens||g.councilTools.llm.maxTokens<256)&&(g.councilTools.llm.maxTokens=4096),g.councilMembers&&Array.isArray(g.councilMembers)&&g.councilMembers.forEach(n=>{n.tools||(n.tools=[],e=!0)}),void 0===g.enableLandingPage&&(g.enableLandingPage=!0),void 0===g.landingPageChatsDisplayed&&(g.landingPageChatsDisplayed=12),void 0===g.disableDefaultStateRestore&&(g.disableDefaultStateRestore=!0),e}let C=!1,S=!1;function N(){const e=(0,r.fJ)();e[c]?(g=a(a({},g),e[c]),j()&&D()):e[c]=g}async function E(){if(C)return(0,i.tE)();console.log("[".concat(l,"] Initializing pack file storage..."));const e=!0===g.packStorageMigrated;if(!await(0,i.g1)())return console.warn("[".concat(l,"] File storage not available, using extension settings")),C=!0,!1;if(!e&&g.packs&&Object.keys(g.packs).length>0){console.log("[".concat(l,"] Migrating packs to file storage..."));const{migrated:e,failed:n}=await(0,i.DT)(g.packs);e>0&&((0,i.sp)(g),g.packStorageMigrated=!0,g.packsBackedUp=!0,delete g.packs,D(),console.log("[".concat(l,"] Migration complete: ").concat(e," packs moved to file storage")),n>0&&console.warn("[".concat(l,"] ").concat(n," packs failed to migrate"))),S=!0}else e&&(console.log("[".concat(l,"] Packs already migrated to file storage")),S=!0,g.selectionsCleanedUp||(console.log("[".concat(l,"] Cleaning up duplicated selections from extension_settings...")),g.selectionsCleanedUp=!0,D()));C=!0;const n=(0,i.getCachedIndex)();return n&&(n.selections&&Object.assign(g,n.selections),n.preferences&&Object.assign(g,n.preferences),n.presets&&(g.presets=n.presets)),(0,i.nF)(()=>{var e;"undefined"!=typeof window&&null!==(e=window.LumiverseBridge)&&void 0!==e&&e.onPackCacheChange&&window.LumiverseBridge.onPackCacheChange()}),!0}function P(){return C&&(0,i.tE)()}function D(){const e=(0,r.fJ)(),n=(0,r.kL)();if(P()){const n=a({},g);delete n.packs,delete n.selectedDefinition,delete n.selectedBehaviors,delete n.selectedPersonalities,delete n.dominantBehavior,delete n.dominantPersonality,delete n.selectedLoomStyle,delete n.selectedLoomUtils,delete n.selectedLoomRetrofits,delete n.selectedDefinitions,delete n.councilMembers,delete n.chimeraMode,delete n.councilMode,delete n.councilChatStyle,delete n.councilTools,delete n.lumiaQuirks,delete n.lumiaQuirksEnabled,delete n.lumiaOOCInterval,delete n.lumiaOOCStyle,delete n.activePresetName,delete n.presets,e[c]=n}else e[c]=g;n()}function M(){if(P()){const e={};for(const n of(0,i.LU)()){e[n.packName||n.name]=n}return e}return g.packs||{}}function O(e){var n;return P()?(0,i.d8)(e):(null===(n=g.packs)||void 0===n?void 0:n[e])||null}async function T(e){var n;return P()?await(0,i.S$)(e):(null===(n=g.packs)||void 0===n?void 0:n[e])||null}async function A(e){const n=e.packName||e.name;P()?await(0,i.j0)(e):(g.packs||(g.packs={}),g.packs[n]=e,D())}async function L(e){var n;P()?await(0,i.CY)(e):null!==(n=g.packs)&&void 0!==n&&n[e]&&(delete g.packs[e],D())}function z(e){Object.assign(g,e),P()?(0,i.Xy)(e):D()}function I(){if(P()){const e=(0,i.getCachedIndex)();return(null==e?void 0:e.selections)||{}}return{selectedDefinition:g.selectedDefinition,selectedBehaviors:g.selectedBehaviors||[],selectedPersonalities:g.selectedPersonalities||[],dominantBehavior:g.dominantBehavior,dominantPersonality:g.dominantPersonality,selectedLoomStyle:g.selectedLoomStyle||[],selectedLoomUtils:g.selectedLoomUtils||[],selectedLoomRetrofits:g.selectedLoomRetrofits||[],selectedDefinitions:g.selectedDefinitions||[],councilMembers:g.councilMembers||[]}}function R(e){Object.assign(g,e),P()?(0,i.Ug)(e):D()}async function B(e){Object.assign(g,e),P()?await(0,i.z_)(e):D()}function _(){return P()?(0,i.$5)():g.presets||{}}function F(e,n){g.presets||(g.presets={}),g.presets[e]=n,P()?(0,i.Xh)(e,n):D()}function U(e){g.presets&&delete g.presets[e],P()?(0,i.BC)(e):D()}function H(e){g.presets=e,P()?(0,i.W8)(e):D()}async function W(){P()&&await(0,i.W3)()}function V(){return g.lumiaConfigVersion||1}function q(){g.lumiaConfigVersion=(g.lumiaConfigVersion||0)+1,g.lastLumiaChangeTimestamp=Date.now(),D(),console.log("[".concat(l,"] Lumia config version bumped to ").concat(g.lumiaConfigVersion))}function $(){return g.lumiaConfigVersion=(g.lumiaConfigVersion||0)+1,g.lastLumiaChangeTimestamp=Date.now(),g.disableAnthropicCache=!0,D(),console.log("[".concat(l,"] Claude cache cleared - version now ").concat(g.lumiaConfigVersion)),setTimeout(()=>{g.disableAnthropicCache=!1,D()},5e3),g.lumiaConfigVersion}async function Y(){const e=(0,r.fJ)(),n=(0,r.kL)();console.log("[".concat(l,"] NUCLEAR RESET: Wiping all extension settings and User Files data..."));try{const e=await(0,i.Bq)();console.log("[".concat(l,"] User Files cleanup: ").concat(e.deleted.length," deleted, ").concat(e.failed.length," failed"))}catch(e){console.error("[".concat(l,"] Failed to clear User Files data:"),e)}delete e[c],g=a({},p),n(),console.log("[".concat(l,"] Settings wiped. Page will reload...")),setTimeout(()=>{window.location.reload()},1500)}function G(){const e=document.querySelectorAll('script[src*="lumia"], script[src*="lumiverse"]');for(const n of e){const e=n.src.match(/(\/scripts\/extensions\/third-party\/[^/]+)/);if(e)return e[1]}return"/scripts/extensions/third-party/SillyTavern-LumiverseHelper"}},678(e,n,t){t.d(n,{Mj:()=>m,Wg:()=>l,bR:()=>p,clearUpdateCache:()=>g,mU:()=>d});var r=t(98);const i="update-service",o=(null==r?void 0:r.EXTENSION_VERSION)||(null==r?void 0:r.default)||"4.0.22",a=new Set;let s=null;function l(e){return a.add(e),()=>a.delete(e)}function c(){const e={extensionUpdate:s,presetUpdates:[]};a.forEach(n=>{try{n(e)}catch(e){console.error("[".concat(i,"] Update listener error:"),e)}})}function u(e){if(!e||"string"!=typeof e)return{major:0,minor:0,patch:0};const n=e.replace(/^v/,"").split(".").map(Number);return{major:n[0]||0,minor:n[1]||0,patch:n[2]||0}}function d(e,n){const t=u(e),r=u(n);return t.major!==r.major?t.major<r.major?-1:1:t.minor!==r.minor?t.minor<r.minor?-1:1:t.patch!==r.patch?t.patch<r.patch?-1:1:0}function m(){return o}async function p(){const e=o||"4.0.0",n=await async function(){try{const e=await fetch("".concat("https://lucid.cards/api/extension-versions","?extension=").concat(encodeURIComponent("SillyTavern-LumiverseHelper")));if(!e.ok)throw new Error("HTTP error: ".concat(e.status));const n=await e.json();return n.success&&n.data&&n.data.version?{version:n.data.version}:null}catch(e){return console.error("[".concat(i,"] Fetch error:"),e),null}}();if(!n)return null;const t=n.version,r=d(e,t)<0;return s={hasUpdate:r,currentVersion:e,latestVersion:t},c(),s}function g(){s=null,c()}"undefined"!=typeof window&&(window.debugUpdateCheck=()=>p(!0))},693(e,n,t){t.d(n,{sc:()=>we,AA:()=>Ne,bw:()=>_e,a:()=>Le,v4:()=>ze,dN:()=>Te,E4:()=>ne,Aq:()=>Ie,fk:()=>se,JH:()=>Be,K3:()=>Re});var r=t(92);const i={createElement(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const t=document.createElement(e),{attrs:r={},text:i,html:o,children:a=[],style:s={},data:l={}}=n;return Object.entries(r).forEach(e=>{let[n,r]=e;null!=r&&t.setAttribute(n,r)}),Object.entries(s).forEach(e=>{let[n,r]=e;t.style[n]=r}),Object.entries(l).forEach(e=>{let[n,r]=e;t.dataset[n]=r}),void 0!==i?t.textContent=i:void 0!==o&&(t.innerHTML=o),a.forEach(e=>{e instanceof HTMLElement&&t.appendChild(e)}),t},query(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:document).querySelector(e)},queryAll(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;return Array.from(n.querySelectorAll(e))},on(e,n,t,r){const i="string"==typeof e?this.query(e):e;if(!i)return console.warn("DOMUtils.on: Target element not found"),()=>{};if("string"==typeof t){const e=t,o=r,a=n=>{const t=n.target.closest(e);t&&i.contains(t)&&o.call(t,n)};return i.addEventListener(n,a),()=>i.removeEventListener(n,a)}const o=t;return i.addEventListener(n,o),()=>i.removeEventListener(n,o)},once(e,n,t){const r="string"==typeof e?this.query(e):e;if(!r)return console.warn("DOMUtils.once: Target element not found"),()=>{};const i=e=>{t(e),r.removeEventListener(n,i)};return r.addEventListener(n,i),()=>r.removeEventListener(n,i)},debounce(e,n){let t,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return function(){for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];const s=this,l=r&&!t;clearTimeout(t),t=setTimeout(()=>{t=null,r||e.apply(s,o)},n),l&&e.apply(s,o)}},throttle(e,n){let t;return function(){const r=this;if(!t){for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];e.apply(r,o),t=!0,setTimeout(()=>t=!1,n)}}},addClass(e){const n="string"==typeof e?this.query(e):e;if(n){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];n.classList.add(...r)}return n},removeClass(e){const n="string"==typeof e?this.query(e):e;if(n){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];n.classList.remove(...r)}return n},toggleClass(e,n,t){const r="string"==typeof e?this.query(e):e;return!!r&&r.classList.toggle(n,t)},hasClass(e,n){const t="string"==typeof e?this.query(e):e;return!!t&&t.classList.contains(n)},scrollTo(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{target:n,top:t,left:r,behavior:i="smooth",offset:o=0,container:a=window}=e;if(n){const e="string"==typeof n?this.query(n):n;if(e){const n=e.getBoundingClientRect(),t=a===window?window.pageYOffset:a.scrollTop;a.scrollTo({top:t+n.top+o,behavior:i})}}else a.scrollTo({top:void 0!==t?t:a.scrollY,left:void 0!==r?r:a.scrollX,behavior:i})},isVisible(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const t="string"==typeof e?this.query(e):e;if(!t)return Promise.resolve(!1);const{threshold:r=0,rootMargin:i="0px"}=n;if(!("IntersectionObserver"in window)){const e=t.getBoundingClientRect();return Promise.resolve(e.top>=0&&e.left>=0&&e.bottom<=window.innerHeight&&e.right<=window.innerWidth)}return new Promise(e=>{const n=new IntersectionObserver(t=>{e(t[0].isIntersecting),n.disconnect()},{threshold:r,rootMargin:i});n.observe(t)})},observeVisibility(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r="string"==typeof e?this.query(e):e;if(!r||!("IntersectionObserver"in window))return{disconnect:()=>{}};const{threshold:i=0,rootMargin:o="0px"}=t,a=new IntersectionObserver(e=>{e.forEach(e=>n(e.isIntersecting))},{threshold:i,rootMargin:o});return a.observe(r),a},getRect(e){const n="string"==typeof e?this.query(e):e;return n?n.getBoundingClientRect():null},getOffset(e){const n="string"==typeof e?this.query(e):e;if(!n)return null;const t=n.getBoundingClientRect();return{top:t.top+window.pageYOffset,left:t.left+window.pageXOffset}},setStyle(e,n){const t="string"==typeof e?this.query(e):e;return t&&Object.entries(n).forEach(e=>{let[n,r]=e;t.style[n]=r}),t},getStyle(e,n){const t="string"==typeof e?this.query(e):e;return t?window.getComputedStyle(t)[n]:""},show(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"block";const t="string"==typeof e?this.query(e):e;return t&&(t.style.display=n),t},hide(e){const n="string"==typeof e?this.query(e):e;return n&&(n.style.display="none"),n},toggle(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"block";const t="string"==typeof e?this.query(e):e;if(!t)return!1;const r="none"===window.getComputedStyle(t).display;return t.style.display=r?n:"none",r},remove(e){const n="string"==typeof e?this.query(e):e;return n&&n.parentNode&&n.parentNode.removeChild(n),n},empty(e){const n="string"==typeof e?this.query(e):e;if(n)for(;n.firstChild;)n.removeChild(n.firstChild);return n},attr(e,n,t){const r="string"==typeof e?this.query(e):e;return r?"string"==typeof n&&void 0===t?r.getAttribute(n):"string"==typeof n?(r.setAttribute(n,t),r):"object"==typeof n?(Object.entries(n).forEach(e=>{let[n,t]=e;r.setAttribute(n,t)}),r):null:null},removeAttr(e,n){const t="string"==typeof e?this.query(e):e;return t&&t.removeAttribute(n),t},ready(e){"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e()},createQueryCache(){const e=new Map;return{get(n){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;const r="".concat(n,":").concat(t);if(!e.has(r)){const i=t.querySelector(n);i&&e.set(r,i)}return e.get(r)||null},clear(){e.clear()}}},getDistanceToViewport(e){const n="string"==typeof e?this.query(e):e;if(!n)return null;const t=n.getBoundingClientRect(),r=window.innerWidth||document.documentElement.clientWidth,i=window.innerHeight||document.documentElement.clientHeight;return{top:t.top,right:r-t.right,bottom:i-t.bottom,left:t.left}},getDistanceBetween(e,n){const t="string"==typeof e?this.query(e):e,r="string"==typeof n?this.query(n):n;if(!t||!r)return null;const i=t.getBoundingClientRect(),o=r.getBoundingClientRect();let a,s;return a=i.right<o.left?o.left-i.right:o.right<i.left?i.left-o.right:0,s=i.bottom<o.top?o.top-i.bottom:o.bottom<i.top?i.top-o.bottom:0,{horizontal:a,vertical:s,diagonal:Math.sqrt(a*a+s*s)}},logElementMeasurements(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Element";const t="string"==typeof e?i.query(e):e;if(!t)return console.warn("DOMUtils.logElementMeasurements: Element not found"),null;const r=t.getBoundingClientRect(),o=window.getComputedStyle(t),a=i.getDistanceToViewport(t),s={selector:"string"==typeof e?e:t.tagName,dimensions:{width:r.width,height:r.height,computedWidth:o.width,computedHeight:o.height},position:{top:r.top,right:r.right,bottom:r.bottom,left:r.left,x:r.x,y:r.y},distanceToViewport:a,viewport:{width:window.innerWidth,height:window.innerHeight},padding:{top:o.paddingTop,right:o.paddingRight,bottom:o.paddingBottom,left:o.paddingLeft},margin:{top:o.marginTop,right:o.marginRight,bottom:o.marginBottom,left:o.marginLeft}};return console.group("📏 ".concat(n," Measurements")),console.log("Element:",t),console.log("Dimensions:",s.dimensions),console.log("Position:",s.position),console.log("Distance to Viewport Edges:",s.distanceToViewport),console.log("Viewport Size:",s.viewport),console.log("Padding:",s.padding),console.log("Margin:",s.margin),console.groupEnd(),s}},{createElement:o,query:a,queryAll:s,on:l,once:c,debounce:u,throttle:d,addClass:m,removeClass:p,toggleClass:g,hasClass:h,scrollTo:v,isVisible:f,observeVisibility:b,getRect:x,getOffset:y,setStyle:k,getStyle:w,show:j,hide:C,toggle:S,remove:N,empty:E,attr:P,removeAttr:D,ready:M,createQueryCache:O,getDistanceToViewport:T,getDistanceBetween:A,logElementMeasurements:L}=i;var z=t(674),I=t(154),R=t(100),B=(t(389),t(191));const _=new Map;let F=null,U=null,H=!1,W=!0,V=!1,q=!1;let $=!1,Y=0,G=null,K=null;function Q(e){const n=H;H=e,e&&!n&&(W=!0,console.log("[".concat(z.MODULE_NAME,"] RAF: Streaming started, first render will be immediate"))),n&&!e&&(console.log("[".concat(z.MODULE_NAME,"] RAF: Streaming ended, flushing pending updates")),async function(){null!==U&&(clearTimeout(U),U=null);null!==F&&(cancelAnimationFrame(F),F=null);await new Promise(e=>setTimeout(e,0)),await J()}())}function X(){if(W)return W=!1,void(null===F&&(F=requestAnimationFrame(J)));H?(null!==U&&clearTimeout(U),U=setTimeout(()=>{U=null;const e=performance.now()-Y;if(e<50){setTimeout(()=>{null===F&&(F=requestAnimationFrame(J))},50-e)}else null===F&&(F=requestAnimationFrame(J))},100)):null===F&&(F=requestAnimationFrame(J))}function Z(){return new Promise(e=>setTimeout(e,0))}async function J(){F=null,Y=performance.now();const e=_.size>0,n=V;if(!e&&!n)return;if($)return void console.log("[".concat(z.MODULE_NAME,"] RAF: Skipping flush - chunked processing active"));$=!0;const t=window.scrollY,r=n?"full":_.size;console.log("[".concat(z.MODULE_NAME,"] RAF: Flushing ").concat(r," update(s) [chunked]"));const i=performance.now();try{if(n)K&&await K(q),V=!1,q=!1;else{const e=Array.from(_.values());_.clear();for(let n=0;n<e.length;n++)G&&G(e[n].mesId,e[n].force),(n+1)%15==0&&n<e.length-1&&await Z()}}catch(e){console.error("[".concat(z.MODULE_NAME,"] RAF: Error during flush:"),e)}finally{$=!1}window.scrollTo(window.scrollX,t);const o=performance.now()-i;console.log("[".concat(z.MODULE_NAME,"] RAF: Flush completed in ").concat(o.toFixed(2),"ms"))}function ee(){_.clear(),V=!1,q=!1,$=!1,null!==U&&(clearTimeout(U),U=null),null!==F&&(cancelAnimationFrame(F),F=null)}function ne(){ee(),W=!0,console.log("[".concat(z.MODULE_NAME,"] RAF: State reset for fresh processing"))}const te="#9370db";let re=null,ie=null,oe=!1,ae=!1;function se(e){oe=e,Q(e)}function le(e){if(!e)return"";let n=e.replace(/<\/?lumi[ao]_?ooc(?:\s+[^>]*)?>/gi,"");return n=n.replace(/<\/?lumi[ao]_[a-z_]+(?:\s+[^>]*)?>/gi,""),n=n.replace(/<\/?font(?:\s+[^>]*)?>/gi,""),n=n.replace(/<(p|div)>\s*<\/\1>/gi,""),n=n.replace(/<(p|div)(?:\s+[^>]*)?>/gi,""),n=n.replace(/<\/(p|div)>/gi,"<br>"),n=n.replace(/\s*<br\s*\/?>\s*/gi,"<br>"),n=n.replace(/(<br>){2,}/gi,"<br>"),n=n.replace(/(\n\s*){2,}/g,"\n"),n=n.replace(/^(\s|<br\s*\/?>)+/gi,""),n=n.replace(/(\s|<br\s*\/?>)+$/gi,""),n.trim()}function ce(){const e=(0,z.getSettings)();if(e.selectedDefinition){const n=(0,I.Br)(e.selectedDefinition.packName,e.selectedDefinition.itemName),t=(null==n?void 0:n.avatarUrl)||(null==n?void 0:n.lumia_img);if(t)return t}return null}function ue(e){if(!e)return null;let n=e.trim();n=n.replace(/^lumi[ao]\s+/i,"");const t=n.toLowerCase();if((t.startsWith("lumia")||t.startsWith("lumio"))&&n.length>5){const e=n.substring(5);e[0]===e[0].toUpperCase()&&(n=e)}return n||null}function de(e){return e?e.replace(/&quot;/g,'"').replace(/&#34;/g,'"').replace(/&apos;/g,"'").replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"):""}function me(e){if(!e)return null;let n=e.match(/name\s*=\s*"([^"]*)"/i);return n?de(n[1]):(n=e.match(/name\s*=\s*'([^']*)'/i),n?de(n[1]):(n=e.match(/name\s*=\s*&quot;([^&]*)&quot;/i),n?de(n[1]):(n=e.match(/name\s*=\s*(\w+)/i),n?de(n[1]):null)))}function pe(e){return e?e.replace(/…/g,"...").replace(/["\u201C\u201D]/g,'"').replace(/['\u2018\u2019]/g,"'").replace(/[\uFE00-\uFE0F]/g,"").replace(/\u200D/g,""):""}function ge(e){const n=[];let t=!1;for(let r=0;r<e.length;r++){const i=e[r],o=i.charCodeAt(0);/\s/.test(i)?t||(n.push(r),t=!0):"…"===i?(n.push(r),n.push(r),n.push(r),t=!1):"“"===i||"”"===i||"‘"===i||"’"===i?(n.push(r),t=!1):o>=65024&&o<=65039||"‍"===i||(n.push(r),t=!1)}return n}function he(e){if(!e)return"";const n=document.createElement("div");n.innerHTML=e;let t=n.textContent||n.innerText||"";return t=function(e){if(!e)return"";let n=e;return n=n.replace(/\*\*\*(.+?)\*\*\*/g,"$1"),n=n.replace(/\*\*(.+?)\*\*/g,"$1"),n=n.replace(/\*(.+?)\*/g,"$1"),n=n.replace(/(?<!\w)___(.+?)___(?!\w)/g,"$1"),n=n.replace(/(?<!\w)__(.+?)__(?!\w)/g,"$1"),n=n.replace(/(?<!\w)_(.+?)_(?!\w)/g,"$1"),n=n.replace(/^\*([^*]+)\*/g,"$1"),n=n.replace(/[""]/g,'"'),n=n.replace(/['']/g,"'"),n=n.replace(/…/g,"..."),n=n.replace(/[\uFE00-\uFE0F]/g,""),n=n.replace(/\u200D/g,""),n}(t),t=t.replace(/\s+/g," ").trim(),t}function ve(e,n,t){let r=n,i=t;if(!e||n<0||t<0)return{expandedStart:r,expandedEnd:i};if(n>0){const t=Math.max(0,n-100),i=/(<lumi[ao]_?ooc(?:\s+[^>]*)?>)(.{0,5}?)$/i,o=e.substring(t,n).match(i);if(o){const e=o[0].length,t=n-e;t>=0&&(r=t,o[2]?console.log("[".concat(z.MODULE_NAME,'] expandRangeForTagFragments: Found opening tag "').concat(o[1],'" with ').concat(o[2].length,' gap chars "').concat(o[2],'", expanding start by ').concat(e)):console.log("[".concat(z.MODULE_NAME,'] expandRangeForTagFragments: Found opening tag "').concat(o[1],'", expanding start by ').concat(e)))}}if(t<e.length){const n=Math.min(e.length,t+30),r=e.substring(t,n),o=/^(.{0,5}?)(<\/lumi[ao]_?ooc\s*>)/i,a=r.match(o);if(a){const n=a[0].length,r=t+n;r<=e.length&&(i=r,a[1]?console.log("[".concat(z.MODULE_NAME,'] expandRangeForTagFragments: Found closing tag "').concat(a[2],'" with ').concat(a[1].length,' gap chars "').concat(a[1],'", expanding end by ').concat(n)):console.log("[".concat(z.MODULE_NAME,'] expandRangeForTagFragments: Found closing tag "').concat(a[2],'", expanding end by ').concat(n)))}else{const n=/^(?:lumiaooc>|lumia_ooc>|lumioooc>|lumio_ooc>|miaooc>|mia_ooc>|iaooc>|ia_ooc>|aooc>|a_ooc>|_ooc>|ooc>|oc>|c>)/i,o=r.match(n);if(o){const n=o[0].length,r=t+n;r<=e.length&&(i=r,console.log("[".concat(z.MODULE_NAME,'] expandRangeForTagFragments: Found PARTIAL closing tag "').concat(o[0],'", expanding end by ').concat(n)))}}}return r=Math.max(0,r),i=Math.min(e.length,i),{expandedStart:r,expandedEnd:i}}function fe(e,n,t){if(!e||!n)return null;const r=pe(n.replace(/\s+/g," ").trim());if(!r)return null;const i=r.substring(0,Math.min(40,r.length)).toLowerCase(),o=r.length>20?r.substring(r.length-20).toLowerCase():r.toLowerCase(),a=document.createTreeWalker(e,NodeFilter.SHOW_TEXT);let s,l=null,c=0,u=null,d=0,m="";const p=[];let g=null;const h=new Set;for(;s=a.nextNode();){var v,f;if(null!==(v=s.parentElement)&&void 0!==v&&v.closest("[data-lumia-ooc]"))continue;const e=null===(f=s.parentElement)||void 0===f?void 0:f.closest("p, div, li, blockquote, h1, h2, h3, h4, h5, h6");g&&e&&e!==g&&m.length>0&&!/\s$/.test(m)&&(h.add(m.length),m+=" "),g=e,p.push({node:s,start:m.length,text:s.nodeValue||""}),m+=s.nodeValue||""}const b=pe(m.replace(/\s+/g," ")),x=b.toLowerCase(),y=x.indexOf(i);if(-1===y)return null;const k=y+r.length,w=Math.min(k,b.length);if(r.length>40){if(!x.substring(Math.max(y,w-20),w).includes(o.substring(0,10)))return null}const j=ge(m);let C,S=y<j.length?j[y]:0;C=w<=0?0:w>j.length?m.length:j[w-1]+1;const{expandedStart:N,expandedEnd:E}=ve(m,S,C);S=N,C=E;let P=null;for(const e of p){const n=e.start+e.text.length;if(!l&&e.start<=S&&n>S&&(l=e.node,c=S-e.start),e.start<C&&n>=C){u=e.node,d=C-e.start;break}n<=C&&(P=e)}if(l&&!u&&P&&(console.log("[".concat(z.MODULE_NAME,"] findAndWrapOOCContent: End position in virtual space, using fallback to last text node")),u=P.node,d=P.text.length),!l||!u)return console.log("[".concat(z.MODULE_NAME,"] findAndWrapOOCContent: Could not map match to text nodes (start: ").concat(!!l,", end: ").concat(!!u,")")),null;try{var D,M,O,T;const e=document.createRange(),i=(null===(D=l.nodeValue)||void 0===D?void 0:D.length)||0,o=(null===(M=u.nodeValue)||void 0===M?void 0:M.length)||0,a=Math.max(0,Math.min(c,i)),s=Math.max(0,Math.min(d,o));console.log("[".concat(z.MODULE_NAME,"] findAndWrapOOCContent DEBUG:"),{searchTextLength:n.length,normalizedSearchLength:r.length,matchStart:y,potentialEnd:k,clampedPotentialEnd:w,originalMatchStart:S,originalMatchEnd:C,accumulatedTextLength:m.length,positionMapLength:j.length,startNodeText:null===(O=l.nodeValue)||void 0===O?void 0:O.substring(0,50),startOffset:a,endNodeText:null===(T=u.nodeValue)||void 0===T?void 0:T.substring(Math.max(0,s-20)),endOffset:s,endNodeLength:o}),e.setStart(l,a),e.setEnd(u,s);const p=e.cloneContents(),g=document.createElement("div");g.appendChild(p);const h=g.innerHTML||e.toString();return e.deleteContents(),console.log("[".concat(z.MODULE_NAME,"] findAndWrapOOCContent: Successfully isolated OOC content (").concat(h.length," chars)")),{range:e,innerHTML:le(h)||le(t),wrapperCreated:!0}}catch(e){return console.error("[".concat(z.MODULE_NAME,"] findAndWrapOOCContent: Range error:"),e),null}}function be(e,n){if(!e||!n)return null;const t=pe(n.replace(/\s+/g," ").trim()).toLowerCase();if(!t)return null;const r=t.substring(0,Math.min(50,t.length)),i=s("p",e);for(let e=0;e<i.length;e++){const n=i[e];if(n.closest("[data-lumia-ooc]"))continue;const o=pe((n.textContent||"").replace(/\s+/g," ").trim()).toLowerCase();if(!o.includes(r))continue;const a=t.length/o.length;if(!(a<.7))return console.log("[".concat(z.MODULE_NAME,"] findMatchingElement: Matched paragraph ").concat(e," (").concat(Math.round(100*a),"% OOC content)")),{element:n,innerHTML:n.innerHTML};console.log("[".concat(z.MODULE_NAME,"] findMatchingElement: Skipping paragraph ").concat(e," - OOC is only ").concat(Math.round(100*a),"% of content"))}return null}function xe(e){return e?pe(e.replace(/\s+/g," ").trim()).toLowerCase():""}const ye=new Map;function ke(){ye.clear()}function we(e){ye.delete(e)}function je(e,n){const t=n.toLowerCase().trim(),r=ye.get(e);return(null==r?void 0:r.has(t))||!1}function Ce(e,n){const t=n.toLowerCase().trim();ye.has(e)||ye.set(e,new Set),ye.get(e).add(t)}function Se(e,n){if(!e||!n)return 0;const t=e.toLowerCase().trim(),r=n.toLowerCase().trim();if(t===r)return 100;const i=t.split(/\s+/).filter(e=>e.length>=2),o=r.split(/\s+/).filter(e=>e.length>=2);let a=0;for(const e of i)o.includes(e)&&a++;if(a>0){const e=a/i.length,n=a/o.length;return 50+Math.round((e+n)/2*40)}return 0}function Ne(e){var n,t;if(!e)return null;const r=(0,z.getSettings)();if(null!==(n=r.councilChatStyle)&&void 0!==n&&n.enabled&&r.councilMode&&null!==(t=r.councilMembers)&&void 0!==t&&t.length){var i;const n=r.councilMembers.map(e=>{const n=(0,I.Br)(e.packName,e.itemName);return(null==n?void 0:n.lumiaName)||(null==n?void 0:n.lumiaDefName)||e.itemName||"Unknown"});if(!1!==(null===(i=r.councilChatStyle)||void 0===i?void 0:i.useLeetHandles)){const t=(0,B.xh)(e,n);if(t)return Ee(t)}else{const t=e.replace(/_/g," ");for(const r of n)if(r.toLowerCase()===t.toLowerCase()||r.replace(/\s+/g,"_").toLowerCase()===e.toLowerCase())return Ee(r)}}const o=ue(e);return o?Ee(o):null}function Ee(e){var n,t;if(!e)return null;const r=(0,z.getSettings)();let i={score:0,avatar:null};const o=(n,t)=>{const r=(null==n?void 0:n.avatarUrl)||(null==n?void 0:n.lumia_img);if(!r)return;const o=Se(e,t);o>i.score&&(i={score:o,avatar:r})};if(r.councilMode&&null!==(n=r.councilMembers)&&void 0!==n&&n.length)for(const e of r.councilMembers){const n=(0,I.Br)(e.packName,e.itemName);if(!n)continue;if(o(n,n.lumiaName||n.lumiaDefName||e.itemName),o(n,e.itemName),100===i.score)return i.avatar}if(r.selectedDefinition){const e=(0,I.Br)(r.selectedDefinition.packName,r.selectedDefinition.itemName);if(e){if(o(e,e.lumiaName||e.lumiaDefName||r.selectedDefinition.itemName),o(e,r.selectedDefinition.itemName),100===i.score)return i.avatar}}if(r.chimeraMode&&null!==(t=r.selectedDefinitions)&&void 0!==t&&t.length)for(const e of r.selectedDefinitions){const n=(0,I.Br)(e.packName,e.itemName);if(!n)continue;if(o(n,n.lumiaName||n.lumiaDefName||e.itemName),o(n,e.itemName),100===i.score)return i.avatar}if(i.score>=50)return i.avatar;if(r.packs)for(const e of Object.values(r.packs))if(e.lumiaItems&&e.lumiaItems.length>0)for(const n of e.lumiaItems){if(o(n,n.lumiaName||n.lumiaDefName||""),100===i.score)return i.avatar}else if(e.items)for(const n of e.items){if(o(n,n.lumiaDefName||n.lumiaName||""),100===i.score)return i.avatar}return i.score>=50?i.avatar:null}function Pe(e,n){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const r=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:0)%2==1;switch((0,z.getSettings)().lumiaOOCStyle||"social"){case"none":return function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const t=n||"Lumia",r=o("span",{attrs:{class:"lumia-ooc-raw","data-lumia-ooc":"true","data-lumia-speaker":t},html:e});return r}(e,t);case"margin":return function(e,n){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const i=r||"Lumia",a=(r||"Lumia").charAt(0).toUpperCase(),s=n?o("img",{attrs:{src:n,alt:a,class:"lumia-ooc-margin-tag-avatar"}}):o("span",{attrs:{class:"lumia-ooc-margin-tag-letter"},text:a}),l=o("div",{attrs:{class:"lumia-ooc-margin-tag"},children:[s]}),c=o("div",{attrs:{class:"lumia-ooc-margin-label"},text:i}),u=o("div",{attrs:{class:"lumia-ooc-margin-text"},html:e}),d=o("div",{attrs:{class:"lumia-ooc-margin-content-area"},children:[c,u]}),m=t?"lumia-ooc-margin lumia-ooc-alt":"lumia-ooc-margin";return o("div",{attrs:{class:m,"data-lumia-ooc":"true"},children:[l,d]})}(e,n,r,t);case"whisper":return function(e,n){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const i=r||"Lumia",a="".concat(i," whispers..."),s=(r||"Lumia").charAt(0).toUpperCase(),l=n?o("img",{attrs:{src:n,alt:i,class:"lumia-ooc-whisper-avatar"}}):o("div",{attrs:{class:"lumia-ooc-whisper-avatar-placeholder"},text:s}),c=o("div",{attrs:{class:"lumia-ooc-whisper-avatar-wrap"},children:[l]}),u=o("span",{attrs:{class:"lumia-ooc-whisper-name"},text:a}),d=o("div",{attrs:{class:"lumia-ooc-whisper-header"},children:[u]}),m=o("div",{attrs:{class:"lumia-ooc-whisper-text"},html:e}),p=o("div",{attrs:{class:"lumia-ooc-whisper-bubble"},children:[d,m]}),g=t?"lumia-ooc-whisper lumia-ooc-alt":"lumia-ooc-whisper";return o("div",{attrs:{class:g,"data-lumia-ooc":"true"},children:[c,p]})}(e,n,r,t);default:return function(e,n){var t;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=(0,z.getSettings)(),a=i.councilMode&&(null===(t=i.councilMembers)||void 0===t?void 0:t.length)>0,s=r||"Lumia",l=a?"speaks from the Council":"weaving through the Loom",c=(r||"Lumia").charAt(0).toUpperCase(),u=n?o("img",{attrs:{src:n,alt:s,class:"lumia-ooc-avatar"}}):o("div",{attrs:{class:"lumia-ooc-avatar lumia-ooc-avatar-placeholder"},text:c}),d=o("div",{attrs:{class:"lumia-ooc-avatar-container"},children:[u]}),m=o("span",{attrs:{class:"lumia-ooc-name"},text:s}),p=o("span",{attrs:{class:"lumia-ooc-thread"},text:l}),g=o("div",{attrs:{class:"lumia-ooc-header-row"},children:[m,p]}),h=o("div",{attrs:{class:"lumia-ooc-content"},html:e}),v=o("div",{attrs:{class:"lumia-ooc-content-column"},children:[g,h]});return o("div",{attrs:{class:"lumia-ooc-comment-box","data-lumia-ooc":"true"},children:[d,v]})}(e,n,t)}}function De(e){if(!e)return;let n=e,t=n.parentElement;for(;t&&(null===(r=t.classList)||void 0===r||!r.contains("mes_text"));){var r,i,o;const e=t.parentElement;if("FONT"===t.tagName){var a;const r=null===(a=t.getAttribute("color"))||void 0===a?void 0:a.toLowerCase();if(r===te||"rgb(147, 112, 219)"===r){var s;if(Array.from(t.childNodes).forEach(e=>{var t;e!==n&&(e.nodeType===Node.ELEMENT_NODE&&"BR"===e.tagName?e.remove():e.nodeType!==Node.TEXT_NODE||null!==(t=e.textContent)&&void 0!==t&&t.trim()||e.remove())}),t.parentNode)t.parentNode.insertBefore(n,t),null!==(s=t.textContent)&&void 0!==s&&s.trim()||t.querySelector("[data-lumia-ooc]")||t.remove();t=e;continue}}if(null!==(i=(o=t).matches)&&void 0!==i&&i.call(o,"p, div")){const r=Array.from(t.childNodes).filter(e=>{var t;return e===n||!!(e.nodeType!==Node.TEXT_NODE||null!==(t=e.textContent)&&void 0!==t&&t.trim())&&(e.nodeType!==Node.ELEMENT_NODE||"BR"!==e.tagName)});if(1===r.length&&r[0]===n){t.parentNode&&(t.parentNode.insertBefore(n,t),t.remove()),t=e;continue}}n=t,t=e}if(t=e.parentElement,t){var l,c;const n=n=>{var t,r;n&&n!==e&&(n.nodeType===Node.ELEMENT_NODE&&("BR"===n.tagName?n.remove():null===(t=n.matches)||void 0===t||!t.call(n,"p, div, font")||null!==(r=n.textContent)&&void 0!==r&&r.trim()||n.querySelector("img, [data-lumia-ooc]")||n.remove()))};n(e.previousElementSibling),n(e.nextElementSibling);const t=e.previousSibling,r=e.nextSibling;(null==t?void 0:t.nodeType)!==Node.TEXT_NODE||null!==(l=t.textContent)&&void 0!==l&&l.trim()||t.remove(),(null==r?void 0:r.nodeType)!==Node.TEXT_NODE||null!==(c=r.textContent)&&void 0!==c&&c.trim()||r.remove()}}function Me(e){if(e)try{var n,t,r;const i=e.commonAncestorContainer;if(!i)return;const o=i.nodeType===Node.TEXT_NODE?i.parentElement:i;if(!o)return;const a=/^(?:[\t-\r -\/:-@\[-`\{-~\xA0-\xA9\xAB\xAC\xAE-\xB1\xB4\xB6-\xB8\xBB\xBF\xD7\xF7\u02C2-\u02C5\u02D2-\u02DF\u02E5-\u02EB\u02ED\u02EF-\u02FF\u0375\u037E\u0384\u0385\u0387\u03F6\u0482\u055A-\u055F\u0589\u058A\u058D-\u058F\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0606-\u060F\u061B\u061D-\u061F\u066A-\u066D\u06D4\u06DE\u06E9\u06FD\u06FE\u0700-\u070D\u07F6-\u07F9\u07FE\u07FF\u0830-\u083E\u085E\u0888\u0964\u0965\u0970\u09F2\u09F3\u09FA\u09FB\u09FD\u0A76\u0AF0\u0AF1\u0B70\u0BF3-\u0BFA\u0C77\u0C7F\u0C84\u0D4F\u0D79\u0DF4\u0E3F\u0E4F\u0E5A\u0E5B\u0F01-\u0F17\u0F1A-\u0F1F\u0F34\u0F36\u0F38\u0F3A-\u0F3D\u0F85\u0FBE-\u0FC5\u0FC7-\u0FCC\u0FCE-\u0FDA\u104A-\u104F\u109E\u109F\u10FB\u1360-\u1368\u1390-\u1399\u1400\u166D\u166E\u1680\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DB\u1800-\u180A\u1940\u1944\u1945\u19DE-\u19FF\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B4E\u1B4F\u1B5A-\u1B6A\u1B74-\u1B7F\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u1FBD\u1FBF-\u1FC1\u1FCD-\u1FCF\u1FDD-\u1FDF\u1FED-\u1FEF\u1FFD\u1FFE\u2000-\u200A\u2010-\u2029\u202F-\u205F\u207A-\u207E\u208A-\u208E\u20A0-\u20C1\u2100\u2101\u2103-\u2106\u2108\u2109\u2114\u2116-\u2118\u211E-\u2123\u2125\u2127\u2129\u212E\u213A\u213B\u2140-\u2144\u214A-\u214D\u214F\u218A\u218B\u2190-\u2429\u2440-\u244A\u249C-\u24E9\u2500-\u2775\u2794-\u2B73\u2B76-\u2BFF\u2CE5-\u2CEA\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E5D\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u3004\u3008-\u3020\u3030\u3036\u3037\u303D-\u303F\u309B\u309C\u30A0\u30FB\u3190\u3191\u3196-\u319F\u31C0-\u31E5\u31EF\u3200-\u321E\u322A-\u3247\u3250\u3260-\u327F\u328A-\u32B0\u32C0-\u33FF\u4DC0-\u4DFF\uA490-\uA4C6\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA700-\uA716\uA720\uA721\uA789\uA78A\uA828-\uA82B\uA836-\uA839\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAA77-\uAA79\uAADE\uAADF\uAAF0\uAAF1\uAB5B\uAB6A\uAB6B\uABEB\uFB29\uFBB2-\uFBD2\uFD3E-\uFD4F\uFD90\uFD91\uFDC8-\uFDCF\uFDFC-\uFDFF\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE66\uFE68-\uFE6B\uFEFF\uFF01-\uFF0F\uFF1A-\uFF20\uFF3B-\uFF40\uFF5B-\uFF65\uFFE0-\uFFE6\uFFE8-\uFFEE\uFFFC\uFFFD]|\uD800[\uDD00-\uDD02\uDD37-\uDD3F\uDD79-\uDD89\uDD8C-\uDD8E\uDD90-\uDD9C\uDDA0\uDDD0-\uDDFC\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDC77\uDC78\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEC8\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD803[\uDD6E\uDD8E\uDD8F\uDEAD\uDED0-\uDED8\uDF55-\uDF59\uDF86-\uDF89]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC8\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9\uDFD4\uDFD5\uDFD7\uDFD8]|\uD805[\uDC4B-\uDC4F\uDC5A\uDC5B\uDC5D\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDE60-\uDE6C\uDEB9\uDF3C-\uDF3F]|\uD806[\uDC3B\uDD44-\uDD46\uDDE2\uDE3F-\uDE46\uDE9A-\uDE9C\uDE9E-\uDEA2\uDF00-\uDF09\uDFE1]|\uD807[\uDC41-\uDC45\uDC70\uDC71\uDEF7\uDEF8\uDF43-\uDF4F\uDFD5-\uDFF1\uDFFF]|\uD809[\uDC70-\uDC74]|\uD80B[\uDFF1\uDFF2]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3F\uDF44\uDF45]|\uD81B[\uDD6D-\uDD6F\uDE97-\uDE9A\uDFE2]|\uD82F[\uDC9C\uDC9F]|\uD833[\uDC00-\uDCEF\uDCFA-\uDCFC\uDD00-\uDEB3\uDEBA-\uDED0\uDEE0-\uDEF0\uDF50-\uDFC3]|\uD834[\uDC00-\uDCF5\uDD00-\uDD26\uDD29-\uDD64\uDD6A-\uDD6C\uDD83\uDD84\uDD8C-\uDDA9\uDDAE-\uDDEA\uDE00-\uDE41\uDE45\uDF00-\uDF56]|\uD835[\uDEC1\uDEDB\uDEFB\uDF15\uDF35\uDF4F\uDF6F\uDF89\uDFA9\uDFC3]|\uD836[\uDC00-\uDDFF\uDE37-\uDE3A\uDE6D-\uDE74\uDE76-\uDE83\uDE85-\uDE8B]|\uD838[\uDD4F\uDEFF]|\uD839\uDDFF|\uD83A[\uDD5E\uDD5F]|\uD83B[\uDCAC\uDCB0\uDD2E\uDEF0\uDEF1]|\uD83C[\uDC00-\uDC2B\uDC30-\uDC93\uDCA0-\uDCAE\uDCB1-\uDCBF\uDCC1-\uDCCF\uDCD1-\uDCF5\uDD0D-\uDDAD\uDDE6-\uDE02\uDE10-\uDE3B\uDE40-\uDE48\uDE50\uDE51\uDE60-\uDE65\uDF00-\uDFFF]|\uD83D[\uDC00-\uDED8\uDEDC-\uDEEC\uDEF0-\uDEFC\uDF00-\uDFD9\uDFE0-\uDFEB\uDFF0]|\uD83E[\uDC00-\uDC0B\uDC10-\uDC47\uDC50-\uDC59\uDC60-\uDC87\uDC90-\uDCAD\uDCB0-\uDCBB\uDCC0\uDCC1\uDCD0-\uDCD8\uDD00-\uDE57\uDE60-\uDE6D\uDE70-\uDE7C\uDE80-\uDE8A\uDE8E-\uDEC6\uDEC8\uDECD-\uDEDC\uDEDF-\uDEEA\uDEEF-\uDEF8\uDF00-\uDF92\uDF94-\uDFEF\uDFFA])*$/,s=e=>{if(!e)return;let n=e.previousSibling;for(;n;){var t,r,i,o;const e=n;if(n=n.previousSibling,e.nodeType===Node.ELEMENT_NODE&&"BR"===e.tagName)e.remove();else if(e.nodeType!==Node.TEXT_NODE||null!==(t=e.textContent)&&void 0!==t&&t.trim())if(e.nodeType===Node.TEXT_NODE&&a.test(e.textContent))console.log("[".concat(z.MODULE_NAME,'] cleanupRangeSurroundings: Removing orphan punctuation: "').concat(e.textContent,'"')),e.remove();else{if(e.nodeType!==Node.ELEMENT_NODE||null===(r=e.matches)||void 0===r||!r.call(e,"p, div, font")||null!==(i=e.textContent)&&void 0!==i&&i.trim()||null!==(o=e.querySelector)&&void 0!==o&&o.call(e,"img, [data-lumia-ooc]"))break;e.remove()}else e.remove()}let s=e.nextSibling;for(;s;){var l,c,u,d;const e=s;if(s=s.nextSibling,e.nodeType===Node.ELEMENT_NODE&&"BR"===e.tagName)e.remove();else if(e.nodeType!==Node.TEXT_NODE||null!==(l=e.textContent)&&void 0!==l&&l.trim())if(e.nodeType===Node.TEXT_NODE&&a.test(e.textContent))console.log("[".concat(z.MODULE_NAME,'] cleanupRangeSurroundings: Removing orphan punctuation: "').concat(e.textContent,'"')),e.remove();else{if(e.nodeType!==Node.ELEMENT_NODE||null===(c=e.matches)||void 0===c||!c.call(e,"p, div, font")||null!==(u=e.textContent)&&void 0!==u&&u.trim()||null!==(d=e.querySelector)&&void 0!==d&&d.call(e,"img, [data-lumia-ooc]"))break;e.remove()}else e.remove()}};if(i.nodeType===Node.TEXT_NODE)s(i);else{const e=Array.from(o.childNodes);e.forEach((n,t)=>{if(n.nodeType===Node.ELEMENT_NODE&&"BR"===n.tagName){const r=e.slice(0,t).some(e=>{var n;return null===(n=e.textContent)||void 0===n?void 0:n.trim()}),i=e.slice(t+1).some(e=>{var n;return null===(n=e.textContent)||void 0===n?void 0:n.trim()});r&&i||n.remove()}})}null===(n=o.matches)||void 0===n||!n.call(o,"p, div")||null!==(t=o.textContent)&&void 0!==t&&t.trim()||null!==(r=o.querySelector)&&void 0!==r&&r.call(o,"img, [data-lumia-ooc]")||o.remove()}catch(e){console.warn("[".concat(z.MODULE_NAME,"] cleanupRangeSurroundings: Error during cleanup:"),e)}}function Oe(e){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{var t,i,o;const l=a('div[mesid="'.concat(e,'"] .mes_text'));if(!l)return;n&&we(e);const c=(0,r.SD)(),u=null==c||null===(t=c.chat)||void 0===t?void 0:t[e],d=function(e){if(!e)return[];const n=[],t=/<(lumi[ao]_?ooc)([^>]*)>([\s\S]*?)<\/\1>/gi;let r;for(;null!==(r=t.exec(e));){const e=r[1],t=r[2],i=r[3],o=me(t),a=ue(o);console.log("[".concat(z.MODULE_NAME,"] Extracted OOC: tag=").concat(e,', attrs="').concat(t.trim(),'", name="').concat(o,'" → "').concat(a,'", content length=').concat(i.length)),n.push({name:a,content:i.trim(),fullMatch:r[0]})}return n}((null==u?void 0:u.mes)||(null==u?void 0:u.content)||""),m=s("[data-lumia-ooc]",l);if(m.length>0&&m.length>=d.length&&!n)return;const p=(0,z.getSettings)();if((null===(i=p.councilChatStyle)||void 0===i?void 0:i.enabled)&&p.councilMode&&(null===(o=p.councilMembers)||void 0===o?void 0:o.length)>0&&d.length>0)return void function(e,n,t){console.log("[".concat(z.MODULE_NAME,"] IRC MODE: Processing ").concat(t.length," OOC comments as chatroom for message ").concat(e));const r=n.querySelector("[data-lumia-irc]");if(r)return void console.log("[".concat(z.MODULE_NAME,"] IRC container already exists for message ").concat(e));const i=[];let o=null;for(let r=0;r<t.length;r++){const a=t[r],s=he(a.content);if(!s)continue;if(je(e,s))continue;const l=a.name||"Unknown",c=Ne(l)||ce(),u=le(a.content)||s,d=fe(n,s,a.content);if(d&&d.wrapperCreated)console.log("[".concat(z.MODULE_NAME,"] IRC MODE: Found and removed OOC #").concat(r+1," from DOM")),Me(d.range),o=d.range,i.push({handle:l,content:u,avatarUrl:c}),Ce(e,s);else{const t=be(n,s);if(t&&t.element){console.log("[".concat(z.MODULE_NAME,"] IRC MODE: Found OOC #").concat(r+1," via element match"));const n=t.element.parentNode,a=document.createTextNode("");t.element.parentNode.insertBefore(a,t.element),t.element.remove();const d=document.createRange();if(d.setStartBefore(a),d.setEndAfter(a),Me(d),a.remove(),o=d,n){Array.from(n.childNodes).forEach(e=>{if(e.nodeType===Node.ELEMENT_NODE&&"BR"===e.tagName){var n,t;const r=null===(n=e.previousSibling)||void 0===n||null===(n=n.textContent)||void 0===n?void 0:n.trim(),i=null===(t=e.nextSibling)||void 0===t||null===(t=t.textContent)||void 0===t?void 0:t.trim();r&&i||e.remove()}})}i.push({handle:l,content:u,avatarUrl:c}),Ce(e,s)}else console.log("[".concat(z.MODULE_NAME,"] IRC MODE: Could not find OOC #").concat(r+1," in DOM"))}}if(0===i.length)return void console.log("[".concat(z.MODULE_NAME,"] No valid IRC entries to display for message ").concat(e));const a=function(e){var n;const t=!1!==(null===(n=(0,z.getSettings)().councilChatStyle)||void 0===n?void 0:n.showTimestamps),r=new Date,i=r.getMinutes(),o="lumia-irc-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),a=document.createElement("input");a.type="checkbox",a.id=o,a.className="lumia-irc-collapse-input",a.style.cssText="position:absolute;opacity:0;pointer-events:none;width:0;height:0;";const s=document.createElement("div");s.className="lumia-irc-header";const l=document.createElement("div");l.style.cssText="display:flex;justify-content:space-between;align-items:center;width:100%;";const c=document.createElement("span");c.textContent="#LumiaCouncil",c.style.cssText="color:#888;font-family:'Courier New', Consolas, monospace;font-size:10px;font-weight:bold;letter-spacing:0.5px;text-transform:uppercase;";const u=document.createElement("button");u.type="button",u.className="lumia-irc-toggle-btn",u.innerHTML="▼",u.style.cssText="cursor:pointer;font-size:10px;color:#9370DB;padding:2px 6px;border-radius:3px;transition:transform 0.2s ease;user-select:none;background:transparent;border:none;display:inline-block;",u.setAttribute("title","Click to collapse/expand"),u.setAttribute("aria-expanded","true"),u.setAttribute("aria-controls",o+"-messages"),u.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),a.checked=!a.checked;const n=a.checked;u.setAttribute("aria-expanded",String(!n)),m.classList.toggle("collapsed",n),m.style.setProperty("grid-template-rows",n?"0fr":"1fr","important"),u.style.transform=n?"rotate(-90deg)":"rotate(0deg)",console.log("[".concat(z.MODULE_NAME,"] IRC panel ").concat(n?"collapsed":"expanded"))}),l.appendChild(c),l.appendChild(u),s.appendChild(l),Object.entries({display:"block",background:"linear-gradient(180deg, #252540 0%, #1e1e35 100%)",color:"#888",fontSize:"10px",fontWeight:"bold",letterSpacing:"0.5px",padding:"4px 10px",borderBottom:"1px solid #333",textTransform:"uppercase",fontFamily:"'Courier New', Consolas, monospace"}).forEach(e=>{let[n,t]=e;s.style.setProperty(n.replace(/[A-Z]/g,e=>"-".concat(e.toLowerCase())),t,"important")});const d=document.createElement("div");d.className="lumia-irc-messages",d.id=o+"-messages",d.style.setProperty("overflow","hidden","important");const m=document.createElement("div");m.className="lumia-irc-body-wrapper",m.style.setProperty("display","grid","important"),m.style.setProperty("grid-template-rows","1fr","important"),m.style.setProperty("transition","grid-template-rows 0.5s cubic-bezier(0.2, 0.8, 0.2, 1)","important");const p=e.map((e,n)=>{const o=(i+n)%60,a=r.getHours()+Math.floor((i+n)/60),s="".concat(String(a%24).padStart(2,"0"),":").concat(String(o).padStart(2,"0")),l=document.createElement("div");l.className=n%2==1?"lumia-irc-msg lumia-irc-alt":"lumia-irc-msg",l.setAttribute("data-lumia-speaker",e.handle);const c={display:"block",padding:"3px 10px",lineHeight:"1.5",fontSize:"12px",fontFamily:"'Courier New', Consolas, monospace",background:n%2==1?"rgba(147, 112, 219, 0.03)":"transparent",borderBottom:"1px solid rgba(26, 26, 46, 0.5)"};Object.entries(c).forEach(e=>{let[n,t]=e;l.style.setProperty(n.replace(/[A-Z]/g,e=>"-".concat(e.toLowerCase())),t,"important")});const u=(d=e.content)?d.replace(/@([A-Za-z0-9_]+)/g,'<span class="lumia-irc-mention">@$1</span>'):"";var d;let m="";return t&&(m+='<span style="color:#555 !important;font-size:11px !important;margin-right:6px !important;">['.concat(s,"]</span>")),m+='<span style="color:#9370DB !important;font-weight:bold !important;margin-right:6px !important;white-space:nowrap !important;">&lt;'.concat(e.handle,"&gt;</span>"),m+='<span style="color:#00ff00 !important;word-break:break-word !important;">'.concat(u,"</span>"),l.innerHTML=m,l}),g=document.createElement("div");return g.className="lumia-irc-container",g.setAttribute("data-lumia-ooc","true"),g.setAttribute("data-lumia-irc","true"),Object.entries({display:"block",position:"relative",fontFamily:"'Courier New', Consolas, 'Lucida Console', monospace",background:"linear-gradient(180deg, #1a1a2e 0%, #0f0f1a 100%)",border:"1px solid #333",borderLeft:"3px solid #9370DB",borderRadius:"4px",margin:"12px 0",padding:"0",overflow:"hidden",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.4)",width:"100%",maxWidth:"100%"}).forEach(e=>{let[n,t]=e;g.style.setProperty(n.replace(/[A-Z]/g,e=>"-".concat(e.toLowerCase())),t,"important")}),p.forEach(e=>d.appendChild(e)),g.appendChild(a),g.appendChild(s),m.appendChild(d),g.appendChild(m),g}(i);if(o)try{o.insertNode(a),console.log("[".concat(z.MODULE_NAME,"] IRC MODE: Inserted container at last OOC position"))}catch(e){console.error("[".concat(z.MODULE_NAME,"] IRC MODE: Range insertion failed, using fallback:"),e),n.appendChild(a)}else console.log("[".concat(z.MODULE_NAME,"] IRC MODE: Using fallback append for message ").concat(e)),n.appendChild(a);De(a),console.log("[".concat(z.MODULE_NAME,"] IRC MODE: Created chatroom with ").concat(i.length," messages for message ").concat(e))}(e,l,d);let g=0;if(d.length>0){console.log("[".concat(z.MODULE_NAME,"] Found ").concat(d.length," <lumia_ooc> tag(s) in raw content for message ").concat(e));const n=function(e,n){if(!e||!n||0===n.length)return[];const t=[],r=n.map(e=>{const n=he(e.content),t=xe(n),r=t.substring(0,Math.min(50,t.length));return{ooc:e,plainText:n,normalized:t,fingerprint:r,matched:!1}}),i=s("p",e);console.log("[".concat(z.MODULE_NAME,"] findOOCParagraphs: Scanning ").concat(i.length," paragraphs for ").concat(r.length," OOC patterns"));for(let e=0;e<i.length;e++){const n=i[e];if(n.closest("[data-lumia-ooc]"))continue;const o=xe(n.textContent||"");if(o)for(let i=0;i<r.length;i++){const a=r[i];if(!a.matched&&(o.startsWith(a.fingerprint)||o.includes(a.fingerprint))){const r=a.normalized.length/o.length;if(console.log("[".concat(z.MODULE_NAME,"] findOOCParagraphs: Para ").concat(e," matches OOC ").concat(i," (").concat(a.ooc.name||"unnamed","), ratio=").concat((100*r).toFixed(0),"%")),r>=.5){t.push({element:n,oocMatch:a.ooc,plainText:a.plainText}),a.matched=!0;break}console.log("[".concat(z.MODULE_NAME,"] findOOCParagraphs: Skipped - ratio too low (need 50%)"))}}}const o=r.filter(e=>!e.matched);return o.length>0&&console.log("[".concat(z.MODULE_NAME,"] findOOCParagraphs: ").concat(o.length," OOCs could not be matched to paragraphs:"),o.map(e=>({name:e.ooc.name,fingerprint:e.fingerprint.substring(0,30)}))),t}(l,d);console.log("[".concat(z.MODULE_NAME,"] DOM-first matching found ").concat(n.length," paragraph(s) matching OOC patterns"));for(const{element:t,oocMatch:r,plainText:i}of n){if(je(e,i)){console.log("[".concat(z.MODULE_NAME,"] Skipping OOC (").concat(r.name||"unnamed","): already processed"));continue}console.log("[".concat(z.MODULE_NAME,"] Processing OOC").concat(r.name?" (".concat(r.name,")"):"",': "').concat(i.substring(0,60),'..."'));const n=r.name&&Ne(r.name)||ce(),o=le(t.innerHTML);if(!o)continue;const a=Pe(o,n,g,r.name);t.parentNode&&(t.parentNode.replaceChild(a,t),Ce(e,i),g++,console.log("[".concat(z.MODULE_NAME,"] Replaced OOC with styled box (DOM-first method)")))}0===n.length&&(console.log("[".concat(z.MODULE_NAME,"] DOM-first matching found no matches, falling back to surgical method")),d.forEach((n,t)=>{const r=he(n.content);if(!r)return;if(je(e,r))return;const i=n.name&&Ne(n.name)||ce(),o=fe(l,r,n.content);if(o&&o.wrapperCreated){const a=Pe(o.innerHTML,i,g,n.name);return o.range.insertNode(a),De(a),Ce(e,r),g++,void console.log("[".concat(z.MODULE_NAME,"] Replaced OOC #").concat(t+1," with styled box (surgical fallback)"))}const a=be(l,r);if(a&&a.element.parentNode){const o=le(a.innerHTML);if(!o)return;const s=Pe(o,i,g,n.name);a.element.parentNode.replaceChild(s,a.element),Ce(e,r),g++,console.log("[".concat(z.MODULE_NAME,"] Replaced OOC #").concat(t+1," with styled box (element fallback)"))}}))}g>0&&console.log("[".concat(z.MODULE_NAME,"] Finished processing ").concat(g," OOC comment(s) in message ").concat(e))}catch(e){console.error("[".concat(z.MODULE_NAME,"] Error processing OOC comments:"),e)}}function Te(e){!function(e){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const t="ooc-".concat(e),r=_.get(t);_.set(t,{mesId:e,force:n||(null==r?void 0:r.force)||!1}),X()}(e,arguments.length>1&&void 0!==arguments[1]&&arguments[1])}async function Ae(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(ae)return void console.log("[".concat(z.MODULE_NAME,"] Skipping concurrent full OOC processing"));const n=(0,r.SD)();if(n&&n.chat){ae=!0;try{const t=n.chat.length;if(console.log("[".concat(z.MODULE_NAME,"] Processing all OOC comments in chat (").concat(t," messages)").concat(e?" [clearing existing]":""," [chunked]")),e){s("[data-lumia-ooc]").forEach(e=>{let n="";const t=e.querySelector(".lumia-ooc-margin-text"),r=e.querySelector(".lumia-ooc-whisper-text"),i=e.querySelector(".lumia-ooc-content");t?n=t.innerHTML:r?n=r.innerHTML:i&&(n=i.innerHTML);const o=document.createElement("font");o.setAttribute("color","#9370DB"),o.innerHTML=n,e.parentNode&&e.parentNode.replaceChild(o,e)}),ke()}for(let e=0;e<t;e++){const n=a('div[mesid="'.concat(e,'"] .mes_text'));n&&(0,R.vL)(n),Oe(e),(e+1)%15==0&&e<t-1&&await Z()}}finally{ae=!1}}}function Le(){!function(){V=!0,q=arguments.length>0&&void 0!==arguments[0]&&arguments[0]||q,_.clear(),X()}(arguments.length>0&&void 0!==arguments[0]&&arguments[0])}async function ze(){ee();const e=window.scrollY;await Ae(!0),window.scrollTo(window.scrollX,e),console.log("[".concat(z.MODULE_NAME,"] Chunked OOC reprocessing complete"))}function Ie(){re&&clearTimeout(re),ie&&clearTimeout(ie),ke();function e(){const e=Date.now();!function n(){var t;const i=document.getElementById("chat"),o=(0,r.SD)(),l=(null==o||null===(t=o.chat)||void 0===t?void 0:t.length)||0,c=(i?s(".mes_text",i):[]).length;if(Date.now()-e>2e3)return console.log("[".concat(z.MODULE_NAME,"] Max wait time reached (context: ").concat(l,", DOM: ").concat(c,"), processing OOCs now")),void Le();if(0===l)return void console.log("[".concat(z.MODULE_NAME,"] Empty chat detected, no OOC processing needed"));if(0===c)return void(ie=setTimeout(n,50));if(c>=Math.max(1,Math.floor(.8*l))){var u;const e=a('div[mesid="'.concat(l-1,'"] .mes_text'));if(e&&null!==(u=e.textContent)&&void 0!==u&&u.trim())return console.log("[".concat(z.MODULE_NAME,"] DOM ready with ").concat(c,"/").concat(l," messages, scheduling OOC processing")),void Le()}ie=setTimeout(n,50)}()}re=setTimeout(()=>{requestAnimationFrame(e)},100)}function Re(e){const n=e.closest("div[mesid]");if(n){Te(parseInt(n.getAttribute("mesid"),10))}}function Be(){const e=document.getElementById("chat"),n=new MutationObserver(e=>{oe?e.forEach(e=>{if("characterData"===e.type){var n;const t=null===(n=e.target.parentElement)||void 0===n?void 0:n.closest(".mes_text");t&&(0,R.vL)(t)}else"childList"===e.type&&e.addedNodes.forEach(e=>{if(e.nodeType===Node.ELEMENT_NODE){var n,t;const r=null!==(n=e.classList)&&void 0!==n&&n.contains("mes_text")?e:null===(t=e.querySelector)||void 0===t?void 0:t.call(e,".mes_text");r&&(0,R.vL)(r)}})}):e.forEach(e=>{if(e.addedNodes.forEach(e=>{if(e.nodeType!==Node.ELEMENT_NODE)return;let n=[];if(e.classList&&e.classList.contains("mes_text")?n=[e]:e.querySelectorAll&&(n=Array.from(e.querySelectorAll(".mes_text"))),e.nodeType===Node.TEXT_NODE||e.innerHTML&&(e.innerHTML.includes("<loom_sum>")||e.innerHTML.includes("&lt;loom_sum&gt;"))){const t=e.closest?e.closest(".mes_text"):null;t&&!n.includes(t)&&n.push(t)}n.forEach(e=>{var n;(0,R.vL)(e);if(s("[data-lumia-ooc]",e).length>0)return;const t=e.closest("div[mesid]");if(!t)return;const i=parseInt(t.getAttribute("mesid"),10),o=(0,r.SD)(),a=null==o||null===(n=o.chat)||void 0===n?void 0:n[i],l=(null==a?void 0:a.mes)||(null==a?void 0:a.content)||"";/<lumi[ao]_?ooc[^>]*>/i.test(l)&&(console.log("[".concat(z.MODULE_NAME,"] Observer: Processing OOC tags in message ").concat(i)),Te(i))})}),"characterData"===e.type){var n;const t=null===(n=e.target.parentElement)||void 0===n?void 0:n.closest(".mes_text");t&&(0,R.vL)(t)}})}),t=e||document.body;return n.observe(t,{childList:!0,subtree:!0,characterData:!0}),console.log("[".concat(z.MODULE_NAME,"] OOC observer started on ").concat(e?"chat element":"body (fallback)")),n}function _e(){console.log("[".concat(z.MODULE_NAME,"] Initializing RAF batch renderer for OOC comments")),G=Oe,K=Ae}},699(e,n,t){t.d(n,{Bq:()=>pe,az:()=>ae,LP:()=>oe,BC:()=>G,W3:()=>le,LU:()=>F,getCachedIndex:()=>R,jm:()=>te,Y0:()=>ne,S$:()=>B,d8:()=>_,$5:()=>$,SS:()=>J,or:()=>Q,JL:()=>X,g1:()=>z,tE:()=>I,DT:()=>de,sp:()=>me,CY:()=>H,Im:()=>ee,setCharacterToggleBinding:()=>ie,setChatToggleBinding:()=>re,nF:()=>ce,Ug:()=>V,z_:()=>q,W8:()=>K,Xy:()=>W,j0:()=>U,Xh:()=>Y,Bl:()=>Z});var r=t(92),i=t(674);const o="lumiverse_",a="".concat(o,"index.json"),s="".concat(o,"pack_");function l(e){let n=0;for(let t=0;t<e.length;t++){n=(n<<5)-n+e.charCodeAt(t),n&=n}return(n>>>0).toString(16).padStart(8,"0")}function c(e){return"".concat(s).concat(l(e),".json")}async function u(e,n){const t=function(e){const n=JSON.stringify(e);return btoa(unescape(encodeURIComponent(n)))}(n),i=await fetch("/api/files/upload",{method:"POST",headers:(0,r.oO)(),body:JSON.stringify({name:e,data:t})});if(!i.ok){const n=await i.text().catch(()=>"Unknown error");throw new Error("Failed to save file ".concat(e,": ").concat(i.status," - ").concat(n))}return await i.json()}async function d(e){const n="/user/files/".concat(e,"?t=").concat(Date.now());try{const e=await fetch(n);if(!e.ok){if(404===e.status)return null;throw new Error("Failed to load file: ".concat(e.status))}return await e.json()}catch(n){return console.warn("[".concat(i.MODULE_NAME,"] Could not load file ").concat(e,":"),n),null}}async function m(e){try{const n="user/files/".concat(e);return(await fetch("/api/files/delete",{method:"POST",headers:(0,r.oO)(),body:JSON.stringify({path:n})})).ok}catch(n){return console.warn("[".concat(i.MODULE_NAME,"] Could not delete file ").concat(e,":"),n),!1}}async function p(e){try{await u(a,e),console.log("[".concat(i.MODULE_NAME,"] Index saved successfully"))}catch(e){throw console.error("[".concat(i.MODULE_NAME,"] Failed to save index:"),e),e}}async function g(){const e=await d(a);if(e){const{index:n,migrated:t}=function(e){let n=!1;return(!e.version||e.version<2)&&(e.presets||(e.presets={}),e.version=2,n=!0,console.log("[".concat(i.MODULE_NAME,"] Migrated index to v2 (added presets)"))),e.version<3&&(e.toggleStateRegistry||(e.toggleStateRegistry={}),e.version=3,n=!0,console.log("[".concat(i.MODULE_NAME,"] Migrated index to v3 (added toggleStateRegistry)"))),e.version<4&&(e.toggleBindings||(e.toggleBindings={chats:{},characters:{}}),e.version=4,n=!0,console.log("[".concat(i.MODULE_NAME,"] Migrated index to v4 (added toggleBindings)"))),{index:e,migrated:n}}(e);return{index:n,isNew:!1,migrated:t}}return{index:{version:4,packRegistry:{},selections:{selectedDefinition:null,selectedBehaviors:[],selectedPersonalities:[],dominantBehavior:null,dominantPersonality:null,selectedLoomStyle:[],selectedLoomUtils:[],selectedLoomRetrofits:[],selectedDefinitions:[],councilMembers:[]},preferences:{chimeraMode:!1,councilMode:!1,lumiaQuirks:"",lumiaQuirksEnabled:!0,lumiaOOCInterval:null,lumiaOOCStyle:"social",activePresetName:null},presets:{},toggleStateRegistry:{},toggleBindings:{chats:{},characters:{}}},isNew:!0,migrated:!1}}async function h(e){const n=e.packName||e.name,t=c(n);try{return await u(t,e),console.log("[".concat(i.MODULE_NAME,'] Pack "').concat(n,'" saved to ').concat(t)),t}catch(e){throw console.error("[".concat(i.MODULE_NAME,'] Failed to save pack "').concat(n,'":'),e),e}}async function v(e){return await d(e)}async function f(e){return await m(e)}async function b(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;const t=new Map;if(0===e.length)return t;const r=[],o=async e=>{try{const n=await v(e);n&&t.set(e,n)}catch(n){console.warn("[".concat(i.MODULE_NAME,"] Failed to load pack ").concat(e,":"),n)}};for(const t of e){const e=o(t).then(()=>{r.splice(r.indexOf(e),1)});r.push(e),r.length>=n&&await Promise.race(r)}return await Promise.all(r),t}function x(e){var n,t,r;const i=e.packName||e.name;return{packName:i,fileKey:c(i),version:e.version||1,lumiaCount:(null===(n=e.lumiaItems)||void 0===n?void 0:n.length)||0,loomCount:(null===(t=e.loomItems)||void 0===t?void 0:t.length)||0,isCustom:null!==(r=e.isCustom)&&void 0!==r?r:!e.url,url:e.url||null,packAuthor:e.packAuthor||e.author||null,coverUrl:e.coverUrl||null}}function y(e){return e}const k="".concat(o,"togglestate_");function w(e){return"".concat(k).concat(l(e),".json")}async function j(e){const n=w(e),t=await m(n);return t&&console.log("[".concat(i.MODULE_NAME,'] Deleted toggle state "').concat(e,'"')),t}function C(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function S(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?C(Object(t),!0).forEach(function(n){N(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):C(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function N(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}let E=null;const P=new Map,D=new Set;let M=!1,O=!1,T=null;const A=new Set,L={selections:null,preferences:null};async function z(){if(M)return console.log("[".concat(i.MODULE_NAME,"] Pack cache already initialized")),!0;if(!await async function(){try{const e=await fetch("/user/files/".concat(a,"?t=").concat(Date.now()),{method:"HEAD"});return e.ok||404===e.status}catch(e){return console.warn("[".concat(i.MODULE_NAME,"] File storage API not available:"),e),!1}}())return console.warn("[".concat(i.MODULE_NAME,"] File storage not available, falling back to extension settings")),!1;try{var e;const{index:n,isNew:t,migrated:r}=await g();E=n,console.log("[".concat(i.MODULE_NAME,"] Index loaded:"),{packCount:Object.keys(E.packRegistry).length,hasSelections:!(null===(e=E.selections)||void 0===e||!e.selectedDefinition),presetCount:Object.keys(E.presets||{}).length,isNew:t,migrated:r}),(t||r)&&(console.log("[".concat(i.MODULE_NAME,"] ").concat(t?"Creating initial":"Saving migrated"," index file...")),await p(E));const o=function(e){if(!e)return[];const n=new Set,t=e=>{null!=e&&e.packName&&n.add(e.packName),null!=e&&e.packId&&n.add(e.packId)};t(e.selectedDefinition),t(e.dominantBehavior),t(e.dominantPersonality);const r=["selectedBehaviors","selectedPersonalities","selectedLoomStyle","selectedLoomUtils","selectedLoomRetrofits","selectedDefinitions"];for(const n of r)Array.isArray(e[n])&&e[n].forEach(t);if(Array.isArray(e.councilMembers))for(const n of e.councilMembers)t(n),Array.isArray(n.behaviors)&&n.behaviors.forEach(t),Array.isArray(n.personalities)&&n.personalities.forEach(t);return Array.from(n)}(E.selections);if(console.log("[".concat(i.MODULE_NAME,"] Active pack IDs:"),o),o.length>0){const e=o.map(e=>{var n;return null===(n=E.packRegistry[e])||void 0===n?void 0:n.fileKey}).filter(Boolean),n=await b(e,3);for(const[e,t]of n){const e=y(t.packName||t.name);P.set(e,t)}console.log("[".concat(i.MODULE_NAME,"] Loaded ").concat(P.size," active packs into cache"))}return M=!0,function(){L.selections&&E&&(console.log("[".concat(i.MODULE_NAME,"] Applying pending selection updates")),E.selections=S(S({},E.selections),L.selections),L.selections=null);L.preferences&&E&&(console.log("[".concat(i.MODULE_NAME,"] Applying pending preference updates")),E.preferences=S(S({},E.preferences),L.preferences),L.preferences=null);!E||null!==L.selections&&null!==L.preferences||se()}(),async function(){var e;if(null===(e=E)||void 0===e||!e.packRegistry||O)return;const n=Object.keys(E.packRegistry),t=Array.from(P.keys()),r=n.filter(e=>!t.includes(e));if(0===r.length)return void(O=!0);console.log("[".concat(i.MODULE_NAME,"] Background loading ").concat(r.length," remaining packs..."));const o=e=>{"undefined"!=typeof requestIdleCallback?requestIdleCallback(e,{timeout:5e3}):setTimeout(e,100)},a=2;let s=0;const l=async()=>{if(s>=r.length)return O=!0,console.log("[".concat(i.MODULE_NAME,"] All packs loaded into cache")),void ue();const e=r.slice(s,s+a).map(e=>{var n;return null===(n=E.packRegistry[e])||void 0===n?void 0:n.fileKey}).filter(Boolean);try{const n=await b(e,a);for(const[e,t]of n){const e=y(t.packName||t.name);P.set(e,t)}}catch(e){console.warn("[".concat(i.MODULE_NAME,"] Error loading background batch:"),e)}s+=a,o(l)};o(l)}(),!0}catch(e){return console.error("[".concat(i.MODULE_NAME,"] Failed to initialize pack cache:"),e),!1}}function I(){return M}function R(){return E}async function B(e){var n;if(P.has(e))return P.get(e);if(D.has(e))return new Promise(n=>{const t=setInterval(()=>{D.has(e)||(clearInterval(t),n(P.get(e)||null))},50)});const t=null===(n=E)||void 0===n||null===(n=n.packRegistry)||void 0===n?void 0:n[e];if(null==t||!t.fileKey)return null;D.add(e);try{const n=await v(t.fileKey);return n&&P.set(e,n),n}finally{D.delete(e)}}function _(e){return P.get(e)||null}function F(){return Array.from(P.values())}async function U(e){const n=e.packName||e.name;P.set(n,e);await h(e);E||(E=await g()),E.packRegistry[n]=x(e),se(),ue()}async function H(e){var n,t;const r=null===(n=E)||void 0===n||null===(n=n.packRegistry)||void 0===n?void 0:n[e];P.get(e);let o=null==r?void 0:r.fileKey;if(o||(o=c(e),console.log("[".concat(i.MODULE_NAME,'] No registry entry for pack "').concat(e,'", computed fileKey: ').concat(o))),P.delete(e),o){console.log("[".concat(i.MODULE_NAME,"] Deleting pack file: ").concat(o));await f(o)?console.log("[".concat(i.MODULE_NAME,"] Successfully deleted pack file: ").concat(o)):console.warn("[".concat(i.MODULE_NAME,"] Failed to delete pack file: ").concat(o))}null!==(t=E)&&void 0!==t&&t.packRegistry&&delete E.packRegistry[e],function(e){var n;if(null===(n=E)||void 0===n||!n.selections)return;const t=E.selections,r=n=>(null==n?void 0:n.packName)===e||(null==n?void 0:n.packId)===e;r(t.selectedDefinition)&&(t.selectedDefinition=null);r(t.dominantBehavior)&&(t.dominantBehavior=null);r(t.dominantPersonality)&&(t.dominantPersonality=null);const i=["selectedBehaviors","selectedPersonalities","selectedLoomStyle","selectedLoomUtils","selectedLoomRetrofits","selectedDefinitions"];for(const e of i)Array.isArray(t[e])&&(t[e]=t[e].filter(e=>!r(e)));if(Array.isArray(t.councilMembers)){t.councilMembers=t.councilMembers.filter(e=>!r(e));for(const e of t.councilMembers)Array.isArray(e.behaviors)&&(e.behaviors=e.behaviors.filter(e=>!r(e))),Array.isArray(e.personalities)&&(e.personalities=e.personalities.filter(e=>!r(e)))}}(e),se(),ue()}function W(e){if(!E)return console.warn("[".concat(i.MODULE_NAME,"] updateSelections called before cache initialized, queuing update")),void(L.selections=S(S({},L.selections),e));E.selections=S(S({},E.selections),e),se(),ue()}function V(e){if(!E)return console.warn("[".concat(i.MODULE_NAME,"] updatePreferences called before cache initialized, queuing update")),void(L.preferences=S(S({},L.preferences),e));E.preferences=S(S({},E.preferences),e),se(),ue()}async function q(e){if(!E)return console.warn("[".concat(i.MODULE_NAME,"] updatePreferencesImmediate called before cache initialized, queuing update")),void(L.preferences=S(S({},L.preferences),e));E.preferences=S(S({},E.preferences),e),T&&(clearTimeout(T),T=null);try{await p(E)}catch(e){console.error("[".concat(i.MODULE_NAME,"] Failed to save preferences immediately:"),e)}ue()}function $(){var e;return(null===(e=E)||void 0===e?void 0:e.presets)||{}}function Y(e,n){E&&(E.presets||(E.presets={}),E.presets[e]=n,se(),ue())}function G(e){var n;null!==(n=E)&&void 0!==n&&n.presets&&(delete E.presets[e],se(),ue())}function K(e){E&&(E.presets=e,se(),ue())}function Q(){var e;return null!==(e=E)&&void 0!==e&&e.toggleStateRegistry?Object.keys(E.toggleStateRegistry):[]}function X(){var e;return(null===(e=E)||void 0===e?void 0:e.toggleStateRegistry)||{}}async function Z(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;E&&(E.toggleStateRegistry||(E.toggleStateRegistry={}),await async function(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=w(e),o=Date.now();let a=o;try{const e=await d(r);null!=e&&e.createdAt&&(a=e.createdAt)}catch(e){}const s={name:e,createdAt:a,updatedAt:o,sourcePreset:t,toggles:n};return await u(r,s),console.log("[".concat(i.MODULE_NAME,'] Saved toggle state "').concat(e,'" to ').concat(r)),{fileKey:r}}(e,n,t),E.toggleStateRegistry[e]=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return{name:e,fileKey:w(e),sourcePreset:n,createdAt:Date.now()}}(e,t),se(),ue())}async function J(e){return await async function(e){const n=w(e);return await d(n)}(e)}async function ee(e){var n;null!==(n=E)&&void 0!==n&&n.toggleStateRegistry&&(await j(e),delete E.toggleStateRegistry[e],se(),ue())}function ne(e){var n;return e&&null!==(n=E)&&void 0!==n&&null!==(n=n.toggleBindings)&&void 0!==n&&n.chats&&E.toggleBindings.chats[e]||null}function te(e){var n;return e&&null!==(n=E)&&void 0!==n&&null!==(n=n.toggleBindings)&&void 0!==n&&n.characters&&E.toggleBindings.characters[e]||null}async function re(e,n){e&&E&&(E.toggleBindings||(E.toggleBindings={chats:{},characters:{}}),E.toggleBindings.chats||(E.toggleBindings.chats={}),n?(E.toggleBindings.chats[e]={toggles:n.toggles||{},savedAt:Date.now(),sourcePreset:n.sourcePreset||null},console.log("[".concat(i.MODULE_NAME,'] Set chat toggle binding for "').concat(e,'"'))):(delete E.toggleBindings.chats[e],console.log("[".concat(i.MODULE_NAME,'] Removed chat toggle binding for "').concat(e,'"'))),await le(),ue())}async function ie(e,n){e&&E&&(E.toggleBindings||(E.toggleBindings={chats:{},characters:{}}),E.toggleBindings.characters||(E.toggleBindings.characters={}),n?(E.toggleBindings.characters[e]={toggles:n.toggles||{},savedAt:Date.now(),sourcePreset:n.sourcePreset||null},console.log("[".concat(i.MODULE_NAME,'] Set character toggle binding for "').concat(e,'"'))):(delete E.toggleBindings.characters[e],console.log("[".concat(i.MODULE_NAME,'] Removed character toggle binding for "').concat(e,'"'))),await le(),ue())}async function oe(e){await re(e,null)}async function ae(e){await ie(e,null)}function se(){T&&clearTimeout(T),T=setTimeout(async()=>{if(E)try{await p(E)}catch(e){console.error("[".concat(i.MODULE_NAME,"] Failed to save index:"),e)}T=null},500)}async function le(){T&&(clearTimeout(T),T=null),E&&await p(E)}function ce(e){return A.add(e),()=>A.delete(e)}function ue(){for(const e of A)try{e()}catch(e){console.error("[".concat(i.MODULE_NAME,"] Cache listener error:"),e)}}async function de(e){if(!e||"object"!=typeof e)return{migrated:0,failed:0};const n=Object.entries(e);if(0===n.length)return{migrated:0,failed:0};console.log("[".concat(i.MODULE_NAME,"] Migrating ").concat(n.length," packs to file storage..."));let t=0,r=0;if(!E){const{index:e}=await g();E=e}for(const[e,s]of n)try{var o;const n=s.packName||s.name||e,r=y(n),i={packName:n,packAuthor:s.packAuthor||s.author||null,coverUrl:s.coverUrl||null,version:s.version||1,packExtras:s.packExtras||[],lumiaItems:s.lumiaItems||[],loomItems:s.loomItems||[],isCustom:null!==(o=s.isCustom)&&void 0!==o?o:!s.url,url:s.url||""};if(s.items&&!s.lumiaItems&&!s.loomItems){i.lumiaItems=[],i.loomItems=[];for(const e of s.items){var a;if(e.lumiaDefName||e.lumiaName)i.lumiaItems.push({lumiaName:e.lumiaName||e.lumiaDefName,lumiaDefinition:e.lumiaDefinition||e.lumiaDef||null,lumiaPersonality:e.lumiaPersonality||e.lumia_personality||null,lumiaBehavior:e.lumiaBehavior||e.lumia_behavior||null,avatarUrl:e.avatarUrl||e.lumia_img||null,genderIdentity:null!==(a=e.genderIdentity)&&void 0!==a?a:0,authorName:e.authorName||e.defAuthor||null,version:1});else e.loomName&&i.loomItems.push({loomName:e.loomName,loomContent:e.loomContent||"",loomCategory:e.loomCategory||"Loom Utilities",authorName:e.authorName||null,version:1})}}await h(i);E.packRegistry[r]=x(i),P.set(r,i),t++}catch(n){console.error("[".concat(i.MODULE_NAME,"] Failed to migrate pack ").concat(e,":"),n),r++}return await p(E),console.log("[".concat(i.MODULE_NAME,"] Migration complete: ").concat(t," succeeded, ").concat(r," failed")),{migrated:t,failed:r}}function me(e){if(!E)return;const n=["selectedDefinition","selectedBehaviors","selectedPersonalities","dominantBehavior","dominantPersonality","selectedLoomStyle","selectedLoomUtils","selectedLoomRetrofits","selectedDefinitions","councilMembers"];for(const t of n)void 0!==e[t]&&(E.selections[t]=e[t]);const t=["chimeraMode","councilMode","councilChatStyle","lumiaQuirks","lumiaQuirksEnabled","lumiaOOCInterval","lumiaOOCStyle","activePresetName"];for(const n of t)void 0!==e[n]&&(E.preferences[n]=e[n]);e.presets&&"object"==typeof e.presets&&(E.presets||(E.presets={}),Object.assign(E.presets,e.presets),console.log("[".concat(i.MODULE_NAME,"] Migrated ").concat(Object.keys(e.presets).length," presets")))}async function pe(){console.log("[".concat(i.MODULE_NAME,"] NUCLEAR: Clearing all Lumiverse data...")),T&&(clearTimeout(T),T=null),E=null,P.clear(),D.clear(),M=!1,O=!1,L.selections=null,L.preferences=null;const e=await async function(){var e,n;const t=[],r=[];console.log("[".concat(i.MODULE_NAME,"] NUCLEAR: Deleting all Lumiverse files from User Files API..."));let o=null;try{o=(await g()).index}catch(e){console.warn("[".concat(i.MODULE_NAME,"] Could not load index for cleanup, proceeding with index deletion only"))}if(null!==(e=o)&&void 0!==e&&e.packRegistry){const e=Object.values(o.packRegistry).map(e=>e.fileKey).filter(Boolean);for(const n of e)try{await f(n)?t.push(n):r.push(n)}catch(e){console.warn("[".concat(i.MODULE_NAME,"] Failed to delete pack file ").concat(n,":"),e),r.push(n)}}if(null!==(n=o)&&void 0!==n&&n.toggleStateRegistry)for(const e of Object.keys(o.toggleStateRegistry))try{await j(e)?t.push("togglestate:".concat(e)):r.push("togglestate:".concat(e))}catch(n){console.warn("[".concat(i.MODULE_NAME,"] Failed to delete toggle state ").concat(e,":"),n),r.push("togglestate:".concat(e))}try{await m(a)?t.push(a):r.push(a)}catch(e){console.warn("[".concat(i.MODULE_NAME,"] Failed to delete index file:"),e),r.push(a)}return console.log("[".concat(i.MODULE_NAME,"] NUCLEAR: Deleted ").concat(t.length," files, ").concat(r.length," failed")),{deleted:t,failed:r}}();return ue(),console.log("[".concat(i.MODULE_NAME,"] NUCLEAR: All Lumiverse data cleared")),e}"undefined"!=typeof window&&(window.debugLumiversePackCache=function(){console.group("[".concat(i.MODULE_NAME,"] Pack Cache State")),console.log("Initialized:",M),console.log("All packs loaded:",O),console.log("Cached index:",E),console.log("Pack cache size:",P.size),console.log("Cached pack IDs:",Array.from(P.keys())),console.log("Loading packs:",Array.from(D)),console.groupEnd()})},796(e){e.exports="data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%2712%27 height=%2712%27 viewBox=%270 0 24 24%27 fill=%27none%27 stroke=%27rgba%28255,255,255,0.5%29%27 stroke-width=%272%27 stroke-linecap=%27round%27 stroke-linejoin=%27round%27%3E%3Cpolyline points=%276 9 12 15 18 9%27%3E%3C/polyline%3E%3C/svg%3E"},825(e){e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var n=e.insertStyleElement(e);return{update:function(t){!function(e,n,t){var r="";t.supports&&(r+="@supports (".concat(t.supports,") {")),t.media&&(r+="@media ".concat(t.media," {"));var i=void 0!==t.layer;i&&(r+="@layer".concat(t.layer.length>0?" ".concat(t.layer):""," {")),r+=t.css,i&&(r+="}"),t.media&&(r+="}"),t.supports&&(r+="}");var o=t.sourceMap;o&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),n.styleTagTransform(r,e,n.options)}(n,e,t)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(n)}}}},834(e){e.exports="data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%2712%27 height=%2712%27 viewBox=%270 0 24 24%27 fill=%27none%27 stroke=%27rgba%28255,255,255,0.4%29%27 stroke-width=%272%27 stroke-linecap=%27round%27 stroke-linejoin=%27round%27%3E%3Cpolyline points=%276 9 12 15 18 9%27%3E%3C/polyline%3E%3C/svg%3E"},848(e,n,t){e.exports=t(20)},919(e){e.exports="data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%2712%27 height=%2712%27 viewBox=%270 0 24 24%27 fill=%27none%27 stroke=%27%23888%27 stroke-width=%272%27%3E%3Cpath d=%27M6 9l6 6 6-6%27/%3E%3C/svg%3E"},932(e,n,t){t.d(n,{Cm:()=>C,Dz:()=>N,GM:()=>w,YR:()=>E,Zl:()=>u,e2:()=>S,mR:()=>j,ry:()=>k,updateLoomSummaryButtonState:()=>P,xx:()=>m});var r=t(92),i=t(674),o=t(154),a=t(485),s=t(199),l=t(200);let c=null;function u(e){c=e}let d=null;function m(e){d=e}function p(){d&&d()}const g='<svg viewBox="0 0 24 24"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>',h='<svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"></polyline></svg>',v='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>',f='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>',b='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>',x='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>';function y(e){const n=e[0];if(!n)return;const t=window.innerHeight||document.documentElement.clientHeight,r=(window.innerWidth||document.documentElement.clientWidth)<=600?24:48,i=t-r;n.style.maxHeight="".concat(i,"px");const o=e.find(".lumia-modal-header"),a=e.find(".lumia-modal-footer"),s=e.find(".lumia-modal-content");requestAnimationFrame(()=>{const e=o.length?o[0].offsetHeight:0,n=a.length?a[0].offsetHeight:0,t=i-e-n;s.length&&(s[0].style.maxHeight="".concat(t,"px"),s[0].style.overflowY="auto")});const l=()=>{const e=(window.innerHeight||document.documentElement.clientHeight)-r;n.style.maxHeight="".concat(e,"px");const t=e-(o.length?o[0].offsetHeight:0)-(a.length?a[0].offsetHeight:0);s.length&&(s[0].style.maxHeight="".concat(t,"px"))};window.addEventListener("resize",l),n._resizeCleanup=()=>window.removeEventListener("resize",l)}function k(e){const n=(0,i.getSettings)(),t=Object.values(n.packs);let r="",a="",l=!1,c=null,u="";"definition"===e?(r="Select Definition",a="Choose the physical form for your Lumia",l=!1,u='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>\n            <circle cx="12" cy="7" r="4"></circle>\n        </svg>'):"behavior"===e?(r="Select Behaviors",a="Choose behavioral traits (tap star for dominant)",l=!0,c="dominantBehavior",u='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n            <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path>\n        </svg>'):"personality"===e&&(r="Select Personalities",a="Choose personality traits (tap star for dominant)",l=!0,c="dominantPersonality",u='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n            <path d="M12 2a10 10 0 1 0 10 10H12V2z"></path>\n            <path d="M12 2a10 10 0 0 1 10 10"></path>\n            <circle cx="12" cy="12" r="6"></circle>\n        </svg>'),$("#lumia-selection-modal").remove();let d="";0===t.length?d='<div class="lumia-modal-empty">No Lumia Packs loaded. Add one in settings!</div>':t.forEach(t=>{const r=t.items;if(!r||0===r.length)return;const i=r.filter(e=>e.lumiaDefName);if(0===i.length)return;const a=(0,s.iY)(t.name),u=i.map(r=>{const i=r.lumiaDefName,s=(0,o.ZD)(t.name),u=(0,o.ZD)(i),d=r.lumia_img;let m=!1;if(l){m=("behavior"===e?n.selectedBehaviors:n.selectedPersonalities).some(e=>e.packName===t.name&&e.itemName===i)}else{const e=n.selectedDefinition;m=e&&e.packName===t.name&&e.itemName===i}let p=!1;c&&n[c]&&(p=n[c].packName===t.name&&n[c].itemName===i);const v=null!==c;return'\n                <div class="lumia-card lumia-card-appear '.concat("definition"===e?"definition-card":""," ").concat(m?"selected":"",'"\n                     data-pack="').concat(s,'"\n                     data-item="').concat(u,'">\n                    <div class="lumia-card-image">\n                        ').concat(d?'<img src="'.concat(d,'" alt="').concat(u,'" loading="lazy"><div class="lumia-img-spinner"></div>'):'<div class="lumia-card-placeholder">?</div>',"\n                        ").concat(v?'\n                        <div class="lumia-dominant-icon '.concat(p?"dominant":"",'"\n                             data-pack="').concat(s,'"\n                             data-item="').concat(u,'"\n                             title="').concat(p?"Remove as dominant":"Set as dominant trait",'">\n                            ').concat(g,"\n                        </div>\n                        "):"",'\n                        <div class="lumia-card-check">\n                            ').concat(h,"\n                        </div>\n                        ").concat(a?'\n                        <button class="lumia-card-edit-btn"\n                                data-pack="'.concat(s,'"\n                                data-item="').concat(u,'"\n                                title="Edit Lumia">\n                            ').concat(x,"\n                        </button>\n                        "):"",'\n                    </div>\n                    <div class="lumia-card-info">\n                        <div class="lumia-card-name">').concat(i||"Unknown","</div>\n                    </div>\n                </div>\n                ")}).join("");d+='\n            <div class="lumia-modal-panel lumia-collapsible lumia-pack-section">\n                <div class="lumia-modal-panel-header lumia-collapsible-trigger">\n                    <span class="lumia-panel-collapse-icon">\n                        '.concat(b,'\n                    </span>\n                    <span class="lumia-modal-panel-icon">\n                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                            <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>\n                        </svg>\n                    </span>\n                    <span class="lumia-modal-panel-title">').concat((0,o.ZD)(t.name),"</span>\n                    ").concat(a?'<span class="lumia-pack-badge-custom">Custom</span>':"",'\n                    <span class="lumia-modal-panel-count">').concat(i.length," items</span>\n                    ").concat(a?'<button class="lumia-pack-edit-btn" data-pack="'.concat((0,o.ZD)(t.name),'" title="Edit Pack">').concat(x,"</button>"):"",'\n                    <button class="lumia-icon-btn-sm lumia-remove-pack-btn" data-pack="').concat((0,o.ZD)(t.name),'" title="Remove Pack">\n                        ').concat(v,'\n                    </button>\n                </div>\n                <div class="lumia-modal-panel-content lumia-modal-panel-content-cards lumia-collapsible-content">\n                    <div class="lumia-card-grid">\n                        ').concat(u,"\n                    </div>\n                </div>\n            </div>\n            ")});const m='\n        <dialog id="lumia-selection-modal" class="popup popup--animation-fast lumia-modal lumia-modal-selection">\n            <div class="lumia-modal-header">\n                <div class="lumia-modal-header-icon">\n                    '.concat(u,'\n                </div>\n                <div class="lumia-modal-header-text">\n                    <h3 class="lumia-modal-title">').concat(r,'</h3>\n                    <p class="lumia-modal-subtitle">').concat(a,'</p>\n                </div>\n                <button class="lumia-clear-btn" title="Clear all selections">\n                    ').concat(f,'\n                    <span>Clear</span>\n                </button>\n            </div>\n            <div class="lumia-modal-content">\n                ').concat(d,'\n            </div>\n            <div class="lumia-modal-footer">\n                <button class="lumia-modal-btn lumia-modal-btn-secondary lumia-modal-close-btn">Close</button>\n                ').concat(l?'<button class="lumia-modal-btn lumia-modal-btn-primary lumia-modal-done">Done</button>':"","\n            </div>\n        </dialog>\n    ");$("body").append(m);const k=$("#lumia-selection-modal");y(k);const w=()=>{k[0]._resizeCleanup&&k[0]._resizeCleanup(),k[0].close(),k.remove(),p()};k.on("click mousedown mouseup",function(e){e.stopPropagation(),"click"===e.type&&e.target===this&&w()}),k.find(".lumia-modal-close-btn, .lumia-modal-done").click(w),k.on("keydown",function(e){"Escape"===e.key&&w()}),k.find(".lumia-collapsible-trigger").click(function(e){$(e.target).closest(".lumia-remove-pack-btn").length>0||$(this).closest(".lumia-collapsible").toggleClass("collapsed")}),k.find(".lumia-clear-btn").click(function(t){t.stopPropagation(),"definition"===e?n.selectedDefinition=null:"behavior"===e?(n.selectedBehaviors=[],n.dominantBehavior=null):"personality"===e&&(n.selectedPersonalities=[],n.dominantPersonality=null),(0,i.saveSettings)(),k.find(".lumia-card").removeClass("selected"),k.find(".lumia-dominant-icon").removeClass("dominant"),toastr.info("".concat(r.replace("Select ","")," cleared"))}),k.find(".lumia-remove-pack-btn").click(function(e){e.stopPropagation();const t=$(this).data("pack");confirm('Are you sure you want to remove the pack "'.concat(t,'"?'))&&(delete n.packs[t],n.selectedDefinition&&n.selectedDefinition.packName===t&&(n.selectedDefinition=null),n.selectedBehaviors=n.selectedBehaviors.filter(e=>e.packName!==t),n.selectedPersonalities=n.selectedPersonalities.filter(e=>e.packName!==t),n.dominantBehavior&&n.dominantBehavior.packName===t&&(n.dominantBehavior=null),n.dominantPersonality&&n.dominantPersonality.packName===t&&(n.dominantPersonality=null),(0,i.saveSettings)(),$(this).closest(".lumia-modal-panel").remove(),0===Object.keys(n.packs).length&&w())}),k.find(".lumia-pack-edit-btn").click(function(e){e.stopPropagation();const n=$(this).data("pack");w(),(0,s.H3)(n)}),k.find(".lumia-card-edit-btn").click(function(e){e.stopPropagation();const n=$(this).data("pack"),t=$(this).data("item"),r=(0,o.Br)(n,t);r&&(w(),(0,s.un)(r,n))}),c&&k.find(".lumia-dominant-icon").click(function(t){t.stopPropagation();const r=$(this).data("pack"),o=$(this).data("item"),a=$(this),s="behavior"===e?n.selectedBehaviors:n.selectedPersonalities;s.some(e=>e.packName===r&&e.itemName===o)||(s.push({packName:r,itemName:o}),"behavior"===e?n.selectedBehaviors=s:n.selectedPersonalities=s,a.closest(".lumia-card").addClass("selected"));const l=n[c];l&&l.packName===r&&l.itemName===o?(n[c]=null,a.removeClass("dominant")):(k.find(".lumia-dominant-icon").removeClass("dominant"),n[c]={packName:r,itemName:o},a.addClass("dominant")),(0,i.saveSettings)()}),k.find(".lumia-card").click(function(t){if($(t.target).closest(".lumia-dominant-icon").length>0||$(t.target).closest(".lumia-card-edit-btn").length>0)return;const r=$(this).data("pack"),o=$(this).data("item");if(l){const t=$(this);let a="behavior"===e?n.selectedBehaviors:n.selectedPersonalities;const s=a.findIndex(e=>e.packName===r&&e.itemName===o);-1!==s?(a.splice(s,1),t.removeClass("selected"),c&&n[c]&&n[c].packName===r&&n[c].itemName===o&&(n[c]=null,t.find(".lumia-dominant-icon").removeClass("dominant"))):(a.push({packName:r,itemName:o}),t.addClass("selected")),"behavior"===e?n.selectedBehaviors=a:n.selectedPersonalities=a,(0,i.saveSettings)()}else k.find(".lumia-card").removeClass("selected"),$(this).addClass("selected"),n.selectedDefinition={packName:r,itemName:o},(0,i.saveSettings)()}),k.find(".lumia-card-image img").each(function(){const e=$(this);this.complete&&0!==this.naturalHeight?e.addClass("lumia-img-loaded"):(e.on("load",function(){e.addClass("lumia-img-loaded")}),e.on("error",function(){e.addClass("lumia-img-loaded"),e.css("display","none"),e.parent().append('<div class="lumia-card-placeholder">?</div>')}))}),k[0].showModal()}function w(){const e=(0,i.getSettings)();$("#lumia-misc-modal").remove();const n=e.lumiaOOCInterval||"",t=e.lumiaOOCStyle||"social",r='\n        <dialog id="lumia-misc-modal" class="popup popup--animation-fast lumia-modal lumia-modal-settings">\n            <div class="lumia-modal-header">\n                <div class="lumia-modal-header-icon">\n                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>\n                    </svg>\n                </div>\n                <h3 class="lumia-modal-title">OOC Settings</h3>\n            </div>\n            <div class="lumia-modal-content">\n\n                <div class="lumia-modal-panel">\n                    <div class="lumia-modal-panel-header">\n                        <span class="lumia-modal-panel-icon">\n                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                                <circle cx="12" cy="12" r="10"></circle>\n                                <polyline points="12 6 12 12 16 14"></polyline>\n                            </svg>\n                        </span>\n                        <span class="lumia-modal-panel-title">Comment Trigger</span>\n                    </div>\n                    <div class="lumia-modal-panel-content">\n                        <p class="lumia-modal-description">Automatically inject OOC instructions at message intervals.</p>\n                        <div class="lumia-modal-field">\n                            <label class="lumia-modal-label" for="lumia-ooc-interval-input">Message Interval</label>\n                            <input type="number"\n                                   id="lumia-ooc-interval-input"\n                                   class="lumia-modal-input"\n                                   placeholder="e.g., 10 (empty = disabled)"\n                                   min="1"\n                                   value="'.concat((0,o.ZD)(n.toString()),'" />\n                            <span class="lumia-modal-hint">Triggers when message count is divisible by this number</span>\n                        </div>\n                    </div>\n                </div>\n\n                <div class="lumia-modal-panel">\n                    <div class="lumia-modal-panel-header">\n                        <span class="lumia-modal-panel-icon">\n                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>\n                                <line x1="3" y1="9" x2="21" y2="9"></line>\n                                <line x1="9" y1="21" x2="9" y2="9"></line>\n                            </svg>\n                        </span>\n                        <span class="lumia-modal-panel-title">Display Style</span>\n                    </div>\n                    <div class="lumia-modal-panel-content">\n                        <p class="lumia-modal-description">Choose how OOC comments appear in chat.</p>\n                        <div class="lumia-style-options">\n                            <label class="lumia-style-option ').concat("social"===t?"selected":"",'">\n                                <input type="radio" name="ooc-style" value="social" ').concat("social"===t?"checked":"",' />\n                                <div class="lumia-style-option-content">\n                                    <span class="lumia-style-option-icon">\n                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                                            <rect x="3" y="3" width="18" height="18" rx="2"></rect>\n                                            <circle cx="8.5" cy="8.5" r="1.5"></circle>\n                                            <path d="M21 15l-5-5L5 21"></path>\n                                        </svg>\n                                    </span>\n                                    <div class="lumia-style-option-text">\n                                        <span class="lumia-style-option-title">Social Card</span>\n                                        <span class="lumia-style-option-desc">Full card with avatar & animations</span>\n                                    </div>\n                                </div>\n                            </label>\n                            <label class="lumia-style-option ').concat("margin"===t?"selected":"",'">\n                                <input type="radio" name="ooc-style" value="margin" ').concat("margin"===t?"checked":"",' />\n                                <div class="lumia-style-option-content">\n                                    <span class="lumia-style-option-icon">\n                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>\n                                            <polyline points="14 2 14 8 20 8"></polyline>\n                                        </svg>\n                                    </span>\n                                    <div class="lumia-style-option-text">\n                                        <span class="lumia-style-option-title">Margin Note</span>\n                                        <span class="lumia-style-option-desc">Minimal hanging tag style</span>\n                                    </div>\n                                </div>\n                            </label>\n                            <label class="lumia-style-option ').concat("whisper"===t?"selected":"",'">\n                                <input type="radio" name="ooc-style" value="whisper" ').concat("whisper"===t?"checked":"",' />\n                                <div class="lumia-style-option-content">\n                                    <span class="lumia-style-option-icon">\n                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                                            <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path>\n                                        </svg>\n                                    </span>\n                                    <div class="lumia-style-option-text">\n                                        <span class="lumia-style-option-title">Whisper Bubble</span>\n                                        <span class="lumia-style-option-desc">Soft ethereal thought bubble</span>\n                                    </div>\n                                </div>\n                            </label>\n                        </div>\n                    </div>\n                </div>\n\n            </div>\n            <div class="lumia-modal-footer">\n                <button class="lumia-modal-btn lumia-modal-btn-secondary lumia-misc-cancel-btn">Cancel</button>\n                <button class="lumia-modal-btn lumia-modal-btn-primary lumia-misc-save-btn">Save Changes</button>\n            </div>\n        </dialog>\n    ');$("body").append(r);const a=$("#lumia-misc-modal");y(a);const s=()=>{a[0]._resizeCleanup&&a[0]._resizeCleanup(),a[0].close(),a.remove()};a.on("click mousedown mouseup",function(e){e.stopPropagation(),"click"===e.type&&e.target===this&&s()}),a.find('.lumia-style-option input[type="radio"]').change(function(){a.find(".lumia-style-option").removeClass("selected"),$(this).closest(".lumia-style-option").addClass("selected")}),a.find(".lumia-misc-save-btn").click(()=>{const n=$("#lumia-ooc-interval-input").val().trim(),t=a.find('input[name="ooc-style"]:checked').val(),r=e.lumiaOOCStyle;e.lumiaOOCInterval=n?parseInt(n,10):null,e.lumiaOOCStyle=t,(0,i.saveSettings)(),(0,l.TC)(),toastr.success("OOC settings saved!"),s(),r!==t&&c&&setTimeout(()=>c(!0),100)}),a.find(".lumia-misc-cancel-btn").click(s),a.on("keydown",function(e){"Escape"===e.key&&s()}),a[0].showModal()}function j(e){const n=(0,i.getSettings)(),t=Object.values(n.packs);let r="",a="",s=!1,l=null,c="";"Narrative Style"===e?(r="Select Narrative Styles",a="Choose how the story is told",s=!0,l="selectedLoomStyle",c='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n            <path d="M12 19l7-7 3 3-7 7-3-3z"></path>\n            <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"></path>\n            <path d="M2 2l7.586 7.586"></path>\n            <circle cx="11" cy="11" r="2"></circle>\n        </svg>'):"Loom Utilities"===e?(r="Select Loom Utilities",a="Toggle utilities to enhance generation",s=!0,l="selectedLoomUtils",c='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n            <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path>\n        </svg>'):"Retrofits"===e&&(r="Select Retrofits",a="Choose retrofit modifications",s=!0,l="selectedLoomRetrofits",c='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n            <circle cx="12" cy="12" r="3"></circle>\n            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"></path>\n        </svg>'),$("#loom-selection-modal").remove();let u="";0===t.length?u='<div class="lumia-modal-empty">No Packs loaded. Add one in settings!</div>':(t.forEach(t=>{const r=t.items;if(!r||0===r.length)return;const i=r.filter(n=>n.loomCategory===e);if(0===i.length)return;const a=i.map(e=>{let r=!1;const i=e.loomName;if(s){r=(Array.isArray(n[l])?n[l]:[]).some(e=>e.packName===t.name&&e.itemName===i)}else{const e=n[l];r=e&&e.packName===t.name&&e.itemName===i}const a=(0,o.ZD)(t.name),c=(0,o.ZD)(i);return'\n                <div class="lumia-list-item '.concat(r?"selected":"",'"\n                     data-pack="').concat(a,'"\n                     data-item="').concat(c,'">\n                    <div class="lumia-list-item-content">\n                        <span class="lumia-list-item-name">').concat(i||"Unknown",'</span>\n                    </div>\n                    <div class="lumia-list-item-toggle">\n                        ').concat(s?'\n                        <div class="lumia-toggle-switch">\n                            <div class="lumia-toggle-track">\n                                <div class="lumia-toggle-thumb"></div>\n                            </div>\n                        </div>\n                        ':'\n                        <div class="lumia-radio-indicator"></div>\n                        ',"\n                    </div>\n                </div>\n                ")}).join("");a&&(u+='\n                <div class="lumia-modal-panel lumia-collapsible">\n                    <div class="lumia-modal-panel-header lumia-collapsible-trigger">\n                        <span class="lumia-panel-collapse-icon">\n                            '.concat(b,'\n                        </span>\n                        <span class="lumia-modal-panel-icon">\n                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                                <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>\n                            </svg>\n                        </span>\n                        <span class="lumia-modal-panel-title">').concat(t.name,'</span>\n                        <span class="lumia-modal-panel-count">').concat(i.length,' items</span>\n                        <button class="lumia-icon-btn-sm lumia-remove-pack-btn" data-pack="').concat((0,o.ZD)(t.name),'" title="Remove Pack">\n                            ').concat(v,'\n                        </button>\n                    </div>\n                    <div class="lumia-modal-panel-content lumia-modal-panel-content-list lumia-collapsible-content">\n                        <div class="lumia-list-group">\n                            ').concat(a,"\n                        </div>\n                    </div>\n                </div>\n                "))}),u||(u='<div class="lumia-modal-empty">No "'.concat(e,'" items found in loaded packs.</div>')));const d='\n        <dialog id="loom-selection-modal" class="popup popup--animation-fast lumia-modal lumia-modal-selection">\n            <div class="lumia-modal-header">\n                <div class="lumia-modal-header-icon">\n                    '.concat(c,'\n                </div>\n                <div class="lumia-modal-header-text">\n                    <h3 class="lumia-modal-title">').concat(r,'</h3>\n                    <p class="lumia-modal-subtitle">').concat(a,'</p>\n                </div>\n                <button class="lumia-clear-btn" title="Clear selection">\n                    ').concat(f,'\n                    <span>Clear</span>\n                </button>\n            </div>\n            <div class="lumia-modal-content">\n                ').concat(u,'\n            </div>\n            <div class="lumia-modal-footer">\n                <button class="lumia-modal-btn lumia-modal-btn-secondary lumia-modal-close-btn">Close</button>\n                ').concat(s?'<button class="lumia-modal-btn lumia-modal-btn-primary lumia-modal-done">Done</button>':"","\n            </div>\n        </dialog>\n    ");$("body").append(d);const m=$("#loom-selection-modal");y(m);const g=()=>{m[0]._resizeCleanup&&m[0]._resizeCleanup(),m[0].close(),m.remove(),p()};m.on("click mousedown mouseup",function(e){e.stopPropagation(),"click"===e.type&&e.target===this&&g()}),m.find(".lumia-modal-close-btn, .lumia-modal-done").click(g),m.on("keydown",function(e){"Escape"===e.key&&g()}),m.find(".lumia-collapsible-trigger").click(function(e){$(e.target).closest(".lumia-list-item").length>0||$(e.target).closest(".lumia-remove-pack-btn").length>0||$(this).closest(".lumia-collapsible").toggleClass("collapsed")}),m.find(".lumia-clear-btn").click(function(e){e.stopPropagation(),n[l]=s?[]:null,(0,i.saveSettings)(),m.find(".lumia-list-item").removeClass("selected"),toastr.info("".concat(r.replace("Select ","")," cleared"))}),m.find(".lumia-remove-pack-btn").click(function(e){e.stopPropagation();const t=$(this).data("pack");confirm('Are you sure you want to remove the pack "'.concat(t,'"?'))&&(delete n.packs[t],n.selectedLoomStyle=(Array.isArray(n.selectedLoomStyle)?n.selectedLoomStyle:[]).filter(e=>e.packName!==t),n.selectedLoomUtils=n.selectedLoomUtils.filter(e=>e.packName!==t),n.selectedLoomRetrofits=n.selectedLoomRetrofits.filter(e=>e.packName!==t),n.selectedDefinition&&n.selectedDefinition.packName===t&&(n.selectedDefinition=null),n.selectedBehaviors=n.selectedBehaviors.filter(e=>e.packName!==t),n.selectedPersonalities=n.selectedPersonalities.filter(e=>e.packName!==t),n.dominantBehavior&&n.dominantBehavior.packName===t&&(n.dominantBehavior=null),n.dominantPersonality&&n.dominantPersonality.packName===t&&(n.dominantPersonality=null),(0,i.saveSettings)(),$(this).closest(".lumia-modal-panel").remove(),0===Object.keys(n.packs).length&&g())}),m.find(".lumia-list-item").click(function(){const e=$(this).data("pack"),t=$(this).data("item");if(s){const r=$(this);let o=n[l];const a=o.findIndex(n=>n.packName===e&&n.itemName===t);-1!==a?(o.splice(a,1),r.removeClass("selected")):(o.push({packName:e,itemName:t}),r.addClass("selected")),n[l]=o,(0,i.saveSettings)()}else m.find(".lumia-list-item").removeClass("selected"),$(this).addClass("selected"),n[l]={packName:e,itemName:t},(0,i.saveSettings)(),setTimeout(g,150)}),m[0].showModal()}function C(){var e;const n=(0,i.getSettings)(),t=(0,r.SD)();$("#lumia-summarization-modal").remove();const s=n.summarization||{},c=s.secondary||{},u=s.mode||"disabled",d=s.apiSource||"main",m=s.autoInterval||10,p=s.autoMessageContext||10,g=s.manualMessageContext||10,h=c.provider||"openai",v=c.model||"",f=c.endpoint||"",b=c.apiKey||"",x=c.temperature||.7,k=void 0!==c.topP?c.topP:1,w=c.maxTokens||8192,j=n.messageTruncation||{},C=j.enabled||!1,S=null!==(e=j.keepCount)&&void 0!==e?e:50,N=(null==t?void 0:t.chat)&&t.chat.length>0,E=(0,a.__)(h),P='\n        <dialog id="lumia-summarization-modal" class="popup popup--animation-fast lumia-modal lumia-modal-settings">\n            <div class="lumia-modal-header">\n                <div class="lumia-modal-header-icon">\n                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                        <line x1="21" y1="10" x2="3" y2="10"></line>\n                        <line x1="21" y1="6" x2="3" y2="6"></line>\n                        <line x1="21" y1="14" x2="3" y2="14"></line>\n                        <line x1="21" y1="18" x2="3" y2="18"></line>\n                    </svg>\n                </div>\n                <h3 class="lumia-modal-title">Summarization</h3>\n            </div>\n            <div class="lumia-modal-content">\n\n                \x3c!-- Mode Selection --\x3e\n                <div class="lumia-modal-panel">\n                    <div class="lumia-modal-panel-header">\n                        <span class="lumia-modal-panel-icon">\n                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                                <circle cx="12" cy="12" r="3"></circle>\n                                <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"></path>\n                            </svg>\n                        </span>\n                        <span class="lumia-modal-panel-title">Mode</span>\n                    </div>\n                    <div class="lumia-modal-panel-content">\n                        <div class="lumia-mode-options">\n                            <label class="lumia-mode-option '.concat("disabled"===u?"selected":"",'">\n                                <input type="radio" name="sum-mode" value="disabled" ').concat("disabled"===u?"checked":"",' />\n                                <span class="lumia-mode-option-label">Disabled</span>\n                            </label>\n                            <label class="lumia-mode-option ').concat("auto"===u?"selected":"",'">\n                                <input type="radio" name="sum-mode" value="auto" ').concat("auto"===u?"checked":"",' />\n                                <span class="lumia-mode-option-label">Automatic</span>\n                            </label>\n                            <label class="lumia-mode-option ').concat("manual"===u?"selected":"",'">\n                                <input type="radio" name="sum-mode" value="manual" ').concat("manual"===u?"checked":"",' />\n                                <span class="lumia-mode-option-label">Manual</span>\n                            </label>\n                        </div>\n                    </div>\n                </div>\n\n                \x3c!-- Auto Settings (conditional) --\x3e\n                <div class="lumia-modal-panel" id="lumia-sum-auto-section" style="').concat("auto"===u?"":"display: none;",'">\n                    <div class="lumia-modal-panel-header">\n                        <span class="lumia-modal-panel-icon">\n                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                                <circle cx="12" cy="12" r="10"></circle>\n                                <polyline points="12 6 12 12 16 14"></polyline>\n                            </svg>\n                        </span>\n                        <span class="lumia-modal-panel-title">Auto Settings</span>\n                    </div>\n                    <div class="lumia-modal-panel-content">\n                        <div class="lumia-modal-field-row">\n                            <div class="lumia-modal-field">\n                                <label class="lumia-modal-label" for="lumia-sum-interval-input">Interval</label>\n                                <input type="number" id="lumia-sum-interval-input" class="lumia-modal-input" min="1" value="').concat(m,'" />\n                                <span class="lumia-modal-hint">Every N messages</span>\n                            </div>\n                            <div class="lumia-modal-field">\n                                <label class="lumia-modal-label" for="lumia-sum-auto-context-input">Context</label>\n                                <input type="number" id="lumia-sum-auto-context-input" class="lumia-modal-input" min="1" max="100" value="').concat(p,'" />\n                                <span class="lumia-modal-hint">Messages to include</span>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                \x3c!-- Manual Context (conditional) --\x3e\n                <div class="lumia-modal-panel" id="lumia-sum-manual-section" style="').concat("manual"===u||"auto"===u?"":"display: none;",'">\n                    <div class="lumia-modal-panel-header">\n                        <span class="lumia-modal-panel-icon">\n                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>\n                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>\n                            </svg>\n                        </span>\n                        <span class="lumia-modal-panel-title">Manual Context</span>\n                    </div>\n                    <div class="lumia-modal-panel-content">\n                        <div class="lumia-modal-field">\n                            <label class="lumia-modal-label" for="lumia-sum-manual-context-input">Messages to include</label>\n                            <input type="number" id="lumia-sum-manual-context-input" class="lumia-modal-input" min="1" max="100" value="').concat(g,'" />\n                            <span class="lumia-modal-hint">When using /loom-summarize command</span>\n                        </div>\n                    </div>\n                </div>\n\n                \x3c!-- API Source --\x3e\n                <div class="lumia-modal-panel">\n                    <div class="lumia-modal-panel-header">\n                        <span class="lumia-modal-panel-icon">\n                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                                <path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"></path>\n                            </svg>\n                        </span>\n                        <span class="lumia-modal-panel-title">API Source</span>\n                    </div>\n                    <div class="lumia-modal-panel-content">\n                        <div class="lumia-mode-options">\n                            <label class="lumia-mode-option lumia-mode-option-wide ').concat("main"===d?"selected":"",'">\n                                <input type="radio" name="sum-source" value="main" ').concat("main"===d?"checked":"",' />\n                                <span class="lumia-mode-option-label">Main API</span>\n                            </label>\n                            <label class="lumia-mode-option lumia-mode-option-wide ').concat("secondary"===d?"selected":"",'">\n                                <input type="radio" name="sum-source" value="secondary" ').concat("secondary"===d?"checked":"",' />\n                                <span class="lumia-mode-option-label">Secondary LLM</span>\n                            </label>\n                        </div>\n                    </div>\n                </div>\n\n                \x3c!-- Secondary LLM Config (conditional) --\x3e\n                <div class="lumia-modal-panel" id="lumia-sum-secondary-section" style="').concat("secondary"===d?"":"display: none;",'">\n                    <div class="lumia-modal-panel-header">\n                        <span class="lumia-modal-panel-icon">\n                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                                <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>\n                                <line x1="8" y1="21" x2="16" y2="21"></line>\n                                <line x1="12" y1="17" x2="12" y2="21"></line>\n                            </svg>\n                        </span>\n                        <span class="lumia-modal-panel-title">Secondary LLM</span>\n                    </div>\n                    <div class="lumia-modal-panel-content">\n                        <div class="lumia-modal-field">\n                            <label class="lumia-modal-label" for="lumia-sum-provider-select">Provider</label>\n                            <select id="lumia-sum-provider-select" class="lumia-modal-select">\n                                ').concat(Object.entries(a.x$).map(e=>{let[n,t]=e;return'<option value="'.concat(n,'" ').concat(h===n?"selected":"",">").concat(t.name,"</option>")}).join(""),'\n                            </select>\n                            <span class="lumia-modal-hint lumia-sum-provider-hint ').concat("custom"===h?"lumia-hidden":"",'">\n                                Uses API key from SillyTavern settings\n                            </span>\n                        </div>\n\n                        <div class="lumia-modal-field-row">\n                            <div class="lumia-modal-field">\n                                <label class="lumia-modal-label" for="lumia-sum-model-input">Model</label>\n                                <input type="text" id="lumia-sum-model-input" class="lumia-modal-input"\n                                       placeholder="').concat(E.placeholder,'"\n                                       value="').concat((0,o.ZD)(v),'" />\n                            </div>\n                        </div>\n\n                        <div class="lumia-modal-field lumia-sum-custom-fields ').concat("custom"===h?"":"lumia-hidden",'">\n                            <label class="lumia-modal-label" for="lumia-sum-endpoint-input">Endpoint URL</label>\n                            <input type="text" id="lumia-sum-endpoint-input" class="lumia-modal-input"\n                                   placeholder="https://your-api.com/v1/chat/completions"\n                                   value="').concat((0,o.ZD)(f),'" />\n                        </div>\n\n                        <div class="lumia-modal-field lumia-sum-custom-fields ').concat("custom"===h?"":"lumia-hidden",'">\n                            <label class="lumia-modal-label" for="lumia-sum-apikey-input">API Key</label>\n                            <input type="password" id="lumia-sum-apikey-input" class="lumia-modal-input"\n                                   placeholder="Your API key"\n                                   value="').concat((0,o.ZD)(b),'" />\n                        </div>\n\n                        <div class="lumia-modal-field-row lumia-modal-field-row-3">\n                            <div class="lumia-modal-field">\n                                <label class="lumia-modal-label" for="lumia-sum-temp-input">Temp</label>\n                                <input type="number" id="lumia-sum-temp-input" class="lumia-modal-input"\n                                       min="0" max="2" step="0.1" value="').concat(x,'" />\n                            </div>\n                            <div class="lumia-modal-field">\n                                <label class="lumia-modal-label" for="lumia-sum-topp-input">Top-P</label>\n                                <input type="number" id="lumia-sum-topp-input" class="lumia-modal-input"\n                                       min="0" max="1" step="0.05" value="').concat(k,'" />\n                            </div>\n                            <div class="lumia-modal-field">\n                                <label class="lumia-modal-label" for="lumia-sum-maxtokens-input">Max Tokens</label>\n                                <input type="text" id="lumia-sum-maxtokens-input" class="lumia-modal-input"\n                                       value="').concat(w,'" />\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                \x3c!-- Test Section --\x3e\n                <div class="lumia-modal-panel lumia-modal-panel-accent">\n                    <div class="lumia-modal-panel-header">\n                        <span class="lumia-modal-panel-icon">\n                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                                <polygon points="5 3 19 12 5 21 5 3"></polygon>\n                            </svg>\n                        </span>\n                        <span class="lumia-modal-panel-title">Test</span>\n                    </div>\n                    <div class="lumia-modal-panel-content">\n                        <button id="lumia-sum-test-btn" class="lumia-modal-btn lumia-modal-btn-primary lumia-modal-btn-full ').concat(N?"":"lumia-btn-disabled",'" ').concat(N?"":"disabled",'>\n                            <span class="lumia-btn-icon">\n                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                                    <polyline points="20 6 9 17 4 12"></polyline>\n                                </svg>\n                            </span>\n                            <span class="lumia-btn-spinner lumia-hidden"></span>\n                            <span class="lumia-btn-text">').concat(N?"Generate Summary Now":"No Active Chat",'</span>\n                        </button>\n                        <div id="lumia-sum-test-result" class="lumia-test-result lumia-hidden"></div>\n                        ').concat(N?"":'<div class="lumia-test-hint">Open a chat to test summarization</div>','\n                    </div>\n                </div>\n\n                \x3c!-- Message Truncation Section --\x3e\n                <div class="lumia-modal-panel">\n                    <div class="lumia-modal-panel-header">\n                        <span class="lumia-modal-panel-icon">\n                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>\n                            </svg>\n                        </span>\n                        <span class="lumia-modal-panel-title">Save N Messages</span>\n                    </div>\n                    <div class="lumia-modal-panel-content">\n                        <div class="lumia-filter-item">\n                            <div class="lumia-toggle-row">\n                                <label class="lumia-toggle-label" for="lumia-trunc-toggle">\n                                    <span class="lumia-toggle-text">Limit Context Messages</span>\n                                    <span class="lumia-toggle-hint">Only send the last N messages to the AI</span>\n                                </label>\n                                <div class="lumia-toggle-switch-wrapper">\n                                    <input type="checkbox" id="lumia-trunc-toggle" class="lumia-toggle-input" ').concat(C?"checked":"",' />\n                                    <label for="lumia-trunc-toggle" class="lumia-toggle-switch-label">\n                                        <div class="lumia-toggle-track">\n                                            <div class="lumia-toggle-thumb"></div>\n                                        </div>\n                                    </label>\n                                </div>\n                            </div>\n                            <div class="lumia-filter-options ').concat(C?"":"lumia-filter-options-hidden",'">\n                                <label class="lumia-input-label">\n                                    <span>Messages to keep:</span>\n                                    <input type="number" id="lumia-trunc-count-input" class="lumia-input-number" value="').concat(S,'" min="5" max="500" />\n                                </label>\n                                <span class="lumia-input-hint">Number of recent messages to include in context</span>\n\n                                <div class="lumia-warning-box">\n                                    <div class="lumia-warning-box-icon">\n                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                                            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>\n                                            <line x1="12" y1="9" x2="12" y2="13"></line>\n                                            <line x1="12" y1="17" x2="12.01" y2="17"></line>\n                                        </svg>\n                                    </div>\n                                    <div class="lumia-warning-box-content">\n                                        <div class="lumia-warning-box-title">Memory Loss Warning</div>\n                                        <div class="lumia-warning-box-text">\n                                            Older messages beyond this limit will be excluded from the AI\'s context.\n                                            The AI will lose awareness of earlier events, character details, and plot points.\n                                            Consider using Loom summarization to preserve important memories.\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n            </div>\n            <div class="lumia-modal-footer">\n                <button class="lumia-modal-btn lumia-modal-btn-secondary lumia-sum-cancel-btn">Cancel</button>\n                <button class="lumia-modal-btn lumia-modal-btn-primary lumia-sum-save-btn">Save Changes</button>\n            </div>\n        </dialog>\n    ');$("body").append(P);const D=$("#lumia-summarization-modal");y(D);const M=()=>{D[0]._resizeCleanup&&D[0]._resizeCleanup(),D[0].close(),D.remove()};D.on("click mousedown mouseup",function(e){e.stopPropagation(),"click"===e.type&&e.target===this&&M()}),D.find('input[name="sum-mode"]').change(function(){D.find(".lumia-mode-option").each(function(){$(this).find('input[name="sum-mode"]').is(":checked")?$(this).addClass("selected"):$(this).removeClass("selected")});const e=$(this).val();"auto"===e?(D.find("#lumia-sum-auto-section").show(),D.find("#lumia-sum-manual-section").show()):"manual"===e?(D.find("#lumia-sum-auto-section").hide(),D.find("#lumia-sum-manual-section").show()):(D.find("#lumia-sum-auto-section").hide(),D.find("#lumia-sum-manual-section").hide())}),D.find('input[name="sum-source"]').change(function(){D.find(".lumia-mode-option").each(function(){const e=$(this).find('input[name="sum-source"]');e.length&&e.is(":checked")?$(this).addClass("selected"):$(this).find('input[name="sum-source"]').length&&$(this).removeClass("selected")});"secondary"===$(this).val()?D.find("#lumia-sum-secondary-section").show():D.find("#lumia-sum-secondary-section").hide()}),D.find("#lumia-sum-provider-select").change(function(){const e=$(this).val(),n=(0,a.Iv)(e);D.find("#lumia-sum-model-input").attr("placeholder",n.placeholder),"custom"===e?(D.find(".lumia-sum-custom-fields").removeClass("lumia-hidden"),D.find(".lumia-sum-provider-hint").addClass("lumia-hidden")):(D.find(".lumia-sum-custom-fields").addClass("lumia-hidden"),D.find(".lumia-sum-provider-hint").removeClass("lumia-hidden"))}),D.find("#lumia-trunc-toggle").change(function(){const e=$(this).closest(".lumia-filter-item").find(".lumia-filter-options");$(this).is(":checked")?e.removeClass("lumia-filter-options-hidden"):e.addClass("lumia-filter-options-hidden")});const O=e=>{const n=parseInt(e,10);return isNaN(n)||!/^\d+$/.test(String(e).trim())?8192:Math.max(256,n)};D.find("#lumia-sum-test-btn").click(async function(){const e=$(this),n=e.find(".lumia-btn-icon"),t=e.find(".lumia-btn-spinner"),r=e.find(".lumia-btn-text"),o=D.find("#lumia-sum-test-result");e.prop("disabled",!0),n.addClass("lumia-hidden"),t.removeClass("lumia-hidden"),r.text("Weaving summary..."),o.addClass("lumia-hidden").removeClass("lumia-test-result-success lumia-test-result-error");try{const i={mode:D.find('input[name="sum-mode"]:checked').val(),apiSource:D.find('input[name="sum-source"]:checked').val(),autoInterval:parseInt(D.find("#lumia-sum-interval-input").val())||10,autoMessageContext:parseInt(D.find("#lumia-sum-auto-context-input").val())||10,manualMessageContext:parseInt(D.find("#lumia-sum-manual-context-input").val())||10,secondary:{provider:D.find("#lumia-sum-provider-select").val(),model:D.find("#lumia-sum-model-input").val(),endpoint:D.find("#lumia-sum-endpoint-input").val(),apiKey:D.find("#lumia-sum-apikey-input").val(),temperature:parseFloat(D.find("#lumia-sum-temp-input").val())||.7,topP:parseFloat(D.find("#lumia-sum-topp-input").val())||1,maxTokens:O(D.find("#lumia-sum-maxtokens-input").val())}},s=await(0,a.Zq)(i,!0);e.prop("disabled",!1),t.addClass("lumia-hidden"),n.removeClass("lumia-hidden"),r.text("Generate Summary Now"),s?(o.removeClass("lumia-hidden").addClass("lumia-test-result-success").html('\n            <div class="lumia-test-result-icon">\n              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                <polyline points="20 6 9 17 4 12"></polyline>\n              </svg>\n            </div>\n            <div class="lumia-test-result-content">\n              <div class="lumia-test-result-title">Summary woven successfully!</div>\n              <div class="lumia-test-result-text">Saved to chat metadata.</div>\n            </div>\n          '),toastr.success("Summary generated and saved to chat metadata!")):o.removeClass("lumia-hidden").addClass("lumia-test-result-error").html('\n            <div class="lumia-test-result-icon">\n              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                <circle cx="12" cy="12" r="10"></circle>\n                <line x1="12" y1="8" x2="12" y2="12"></line>\n                <line x1="12" y1="16" x2="12.01" y2="16"></line>\n              </svg>\n            </div>\n            <div class="lumia-test-result-content">\n              <div class="lumia-test-result-title">No summary generated</div>\n              <div class="lumia-test-result-text">Check console for details.</div>\n            </div>\n          ')}catch(a){console.error("[".concat(i.MODULE_NAME,"] Summarization error:"),a),e.prop("disabled",!1),t.addClass("lumia-hidden"),n.removeClass("lumia-hidden"),r.text("Generate Summary Now"),o.removeClass("lumia-hidden").addClass("lumia-test-result-error").html('\n          <div class="lumia-test-result-icon">\n            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n              <circle cx="12" cy="12" r="10"></circle>\n              <path d="M15 9l-6 6M9 9l6 6"></path>\n            </svg>\n          </div>\n          <div class="lumia-test-result-content">\n            <div class="lumia-test-result-title">Error</div>\n            <div class="lumia-test-result-text">'.concat(a.message,"</div>\n          </div>\n        "))}}),D.find(".lumia-sum-save-btn").click(()=>{const e=O(D.find("#lumia-sum-maxtokens-input").val());D.find("#lumia-sum-maxtokens-input").val(e),n.summarization={mode:D.find('input[name="sum-mode"]:checked').val(),apiSource:D.find('input[name="sum-source"]:checked').val(),autoInterval:parseInt(D.find("#lumia-sum-interval-input").val())||10,autoMessageContext:parseInt(D.find("#lumia-sum-auto-context-input").val())||10,manualMessageContext:parseInt(D.find("#lumia-sum-manual-context-input").val())||10,secondary:{provider:D.find("#lumia-sum-provider-select").val(),model:D.find("#lumia-sum-model-input").val(),endpoint:D.find("#lumia-sum-endpoint-input").val(),apiKey:D.find("#lumia-sum-apikey-input").val(),temperature:parseFloat(D.find("#lumia-sum-temp-input").val())||.7,topP:parseFloat(D.find("#lumia-sum-topp-input").val())||1,maxTokens:e}},n.messageTruncation={enabled:D.find("#lumia-trunc-toggle").is(":checked"),keepCount:parseInt(D.find("#lumia-trunc-count-input").val())||50},(0,i.saveSettings)(),(0,l.TC)(),toastr.success("Summarization settings saved!"),M()}),D.find(".lumia-sum-cancel-btn").click(M),D.on("keydown",function(e){"Escape"===e.key&&M()}),D[0].showModal()}function S(){const e=(0,i.getSettings)();$("#lumia-prompt-settings-modal").remove();const n=e.sovereignHand||{},t=n.enabled||!1,r=!1!==n.excludeLastMessage,o=!1!==n.includeMessageInPrompt,a=e.contextFilters||{},s=a.htmlTags||{},c=a.detailsBlocks||{},u=a.loomItems||{},d='\n        <dialog id="lumia-prompt-settings-modal" class="popup popup--animation-fast lumia-modal lumia-modal-settings">\n            <div class="lumia-modal-header">\n                <div class="lumia-modal-header-icon">\n                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>\n                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>\n                    </svg>\n                </div>\n                <h3 class="lumia-modal-title">Prompt Settings</h3>\n            </div>\n            <div class="lumia-modal-content">\n\n                \x3c!-- Sovereign Hand Section --\x3e\n                <div class="lumia-modal-panel lumia-collapsible">\n                    <div class="lumia-modal-panel-header lumia-collapsible-trigger">\n                        <span class="lumia-panel-collapse-icon">\n                            '.concat(b,'\n                        </span>\n                        <span class="lumia-modal-panel-icon">\n                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                                <path d="M18 3a3 3 0 0 0-3 3v12a3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3H6a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3V6a3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3h12a3 3 0 0 0 3-3 3 3 0 0 0-3-3z"></path>\n                            </svg>\n                        </span>\n                        <span class="lumia-modal-panel-title">Sovereign Hand</span>\n                        <span class="lumia-panel-status ').concat(t?"lumia-panel-status-active":"",'">').concat(t?"Active":"Inactive",'</span>\n                    </div>\n                    <div class="lumia-modal-panel-content lumia-collapsible-content">\n                        <div class="lumia-panel-content-inner">\n                            <p class="lumia-modal-description">Enable Sovereign Hand integration to use advanced prompt manipulation features.</p>\n\n                            <div class="lumia-toggle-row">\n                                <label class="lumia-toggle-label" for="lumia-sovereign-hand-toggle">\n                                    <span class="lumia-toggle-text">Use Sovereign Hand Features</span>\n                                    <span class="lumia-toggle-hint">Enables Sovereign Hand macros for advanced prompt control</span>\n                                </label>\n                                <div class="lumia-toggle-switch-wrapper">\n                                    <input type="checkbox" id="lumia-sovereign-hand-toggle" class="lumia-toggle-input" ').concat(t?"checked":"",' />\n                                    <label for="lumia-sovereign-hand-toggle" class="lumia-toggle-switch-label">\n                                        <div class="lumia-toggle-track">\n                                            <div class="lumia-toggle-thumb"></div>\n                                        </div>\n                                    </label>\n                                </div>\n                            </div>\n\n                            <div class="lumia-toggle-row ').concat(t?"":"lumia-toggle-disabled",'">\n                                <label class="lumia-toggle-label" for="lumia-sovereign-exclude-toggle">\n                                    <span class="lumia-toggle-text">Exclude Last Message from Context</span>\n                                    <span class="lumia-toggle-hint">When enabled, removes the last user message from the outgoing context</span>\n                                </label>\n                                <div class="lumia-toggle-switch-wrapper">\n                                    <input type="checkbox" id="lumia-sovereign-exclude-toggle" class="lumia-toggle-input" ').concat(r?"checked":""," ").concat(t?"":"disabled",' />\n                                    <label for="lumia-sovereign-exclude-toggle" class="lumia-toggle-switch-label">\n                                        <div class="lumia-toggle-track">\n                                            <div class="lumia-toggle-thumb"></div>\n                                        </div>\n                                    </label>\n                                </div>\n                            </div>\n\n                            <div class="lumia-toggle-row ').concat(t?"":"lumia-toggle-disabled",'">\n                                <label class="lumia-toggle-label" for="lumia-sovereign-include-prompt-toggle">\n                                    <span class="lumia-toggle-text">Include Message in Master Prompt</span>\n                                    <span class="lumia-toggle-hint">When enabled, includes the user message in the {{loomSovHand}} macro output</span>\n                                </label>\n                                <div class="lumia-toggle-switch-wrapper">\n                                    <input type="checkbox" id="lumia-sovereign-include-prompt-toggle" class="lumia-toggle-input" ').concat(o?"checked":""," ").concat(t?"":"disabled",' />\n                                    <label for="lumia-sovereign-include-prompt-toggle" class="lumia-toggle-switch-label">\n                                        <div class="lumia-toggle-track">\n                                            <div class="lumia-toggle-thumb"></div>\n                                        </div>\n                                    </label>\n                                </div>\n                            </div>\n\n                            <div class="lumia-info-box lumia-info-box-sovereign ').concat(t?"":"lumia-info-box-muted",'">\n                                <div class="lumia-info-box-header">\n                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                                        <circle cx="12" cy="12" r="10"></circle>\n                                        <line x1="12" y1="16" x2="12" y2="12"></line>\n                                        <line x1="12" y1="8" x2="12.01" y2="8"></line>\n                                    </svg>\n                                    <span>Available macros:</span>\n                                </div>\n                                <ul class="lumia-info-box-list">\n                                    <li><code>{{loomLastUserMessage}}</code> returns the last user message content</li>\n                                    <li><code>{{loomLastCharMessage}}</code> returns the last character message content</li>\n                                    <li><code>{{lastMessageName}}</code> returns the name of whoever sent the last message</li>\n                                    <li><code>{{loomContinuePrompt}}</code> adds continuation instructions when character spoke last</li>\n                                </ul>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                \x3c!-- Context Filters Section --\x3e\n                <div class="lumia-modal-panel lumia-collapsible">\n                    <div class="lumia-modal-panel-header lumia-collapsible-trigger">\n                        <span class="lumia-panel-collapse-icon">\n                            ').concat(b,'\n                        </span>\n                        <span class="lumia-modal-panel-icon">\n                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                                <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>\n                            </svg>\n                        </span>\n                        <span class="lumia-modal-panel-title">Context Filters</span>\n                        <span class="lumia-panel-status ').concat(s.enabled||c.enabled||u.enabled?"lumia-panel-status-active":"",'">').concat(s.enabled||c.enabled||u.enabled?"Active":"Inactive",'</span>\n                    </div>\n                    <div class="lumia-modal-panel-content lumia-collapsible-content">\n                        <div class="lumia-panel-content-inner">\n                            <p class="lumia-modal-description">Filter out specific content from the chat context before sending to the AI. Helps reduce token usage and keep prompts clean.</p>\n\n                            \x3c!-- HTML Tags Filter --\x3e\n                            <div class="lumia-filter-item">\n                                <div class="lumia-toggle-row">\n                                    <label class="lumia-toggle-label" for="lumia-filter-html-toggle">\n                                        <span class="lumia-toggle-text">Strip HTML Tags</span>\n                                        <span class="lumia-toggle-hint">Removes formatting tags: &lt;div&gt;, &lt;span&gt;, &lt;b&gt;, &lt;i&gt;, &lt;u&gt;, &lt;em&gt;, &lt;strong&gt;</span>\n                                    </label>\n                                    <div class="lumia-toggle-switch-wrapper">\n                                        <input type="checkbox" id="lumia-filter-html-toggle" class="lumia-toggle-input" ').concat(s.enabled?"checked":"",' />\n                                        <label for="lumia-filter-html-toggle" class="lumia-toggle-switch-label">\n                                            <div class="lumia-toggle-track">\n                                                <div class="lumia-toggle-thumb"></div>\n                                            </div>\n                                        </label>\n                                    </div>\n                                </div>\n                                <div class="lumia-filter-options ').concat(s.enabled?"":"lumia-filter-options-hidden",'">\n                                    <label class="lumia-input-label">\n                                        <span>Keep HTML in last N messages:</span>\n                                        <input type="number" id="lumia-filter-html-depth" class="lumia-input-number" value="').concat(s.keepDepth||3,'" min="0" max="100" />\n                                    </label>\n                                    <span class="lumia-input-hint">HTML tags in older messages will be stripped to save tokens</span>\n                                    \x3c!-- Strip Fonts Sub-toggle --\x3e\n                                    <div class="lumia-filter-sub-item">\n                                        <div class="lumia-toggle-row">\n                                            <label class="lumia-toggle-label" for="lumia-filter-fonts-toggle">\n                                                <span class="lumia-toggle-text">Also Strip Fonts</span>\n                                                <span class="lumia-toggle-hint">Remove &lt;font&gt; tags (used by some presets for colored dialogue)</span>\n                                            </label>\n                                            <div class="lumia-toggle-switch-wrapper">\n                                                <input type="checkbox" id="lumia-filter-fonts-toggle" class="lumia-toggle-input" ').concat(s.stripFonts?"checked":"",' />\n                                                <label for="lumia-filter-fonts-toggle" class="lumia-toggle-switch-label">\n                                                    <div class="lumia-toggle-track">\n                                                        <div class="lumia-toggle-thumb"></div>\n                                                    </div>\n                                                </label>\n                                            </div>\n                                        </div>\n                                        <div class="lumia-filter-options lumia-filter-sub-options ').concat(s.stripFonts?"":"lumia-filter-options-hidden",'">\n                                            <label class="lumia-input-label">\n                                                <span>Keep fonts in last N messages:</span>\n                                                <input type="number" id="lumia-filter-fonts-depth" class="lumia-input-number" value="').concat(s.fontKeepDepth||3,'" min="0" max="100" />\n                                            </label>\n                                            <span class="lumia-input-hint">Font tags in older messages will be stripped to save tokens</span>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n\n                            \x3c!-- Details Blocks Filter --\x3e\n                            <div class="lumia-filter-item">\n                                <div class="lumia-toggle-row">\n                                    <label class="lumia-toggle-label" for="lumia-filter-details-toggle">\n                                        <span class="lumia-toggle-text">Filter Details Blocks</span>\n                                        <span class="lumia-toggle-hint">Removes &lt;details&gt; blocks from older messages to save context</span>\n                                    </label>\n                                    <div class="lumia-toggle-switch-wrapper">\n                                        <input type="checkbox" id="lumia-filter-details-toggle" class="lumia-toggle-input" ').concat(c.enabled?"checked":"",' />\n                                        <label for="lumia-filter-details-toggle" class="lumia-toggle-switch-label">\n                                            <div class="lumia-toggle-track">\n                                                <div class="lumia-toggle-thumb"></div>\n                                            </div>\n                                        </label>\n                                    </div>\n                                </div>\n                                <div class="lumia-filter-options ').concat(c.enabled?"":"lumia-filter-options-hidden",'">\n                                    <label class="lumia-input-label">\n                                        <span>Keep in last N messages:</span>\n                                        <input type="number" id="lumia-filter-details-depth" class="lumia-input-number" value="').concat(c.keepDepth||3,'" min="0" max="100" />\n                                    </label>\n                                    <span class="lumia-input-hint">Messages beyond this depth will have &lt;details&gt; blocks removed</span>\n                                </div>\n                            </div>\n\n                            \x3c!-- Loom Items Filter --\x3e\n                            <div class="lumia-filter-item">\n                                <div class="lumia-toggle-row">\n                                    <label class="lumia-toggle-label" for="lumia-filter-loom-toggle">\n                                        <span class="lumia-toggle-text">Filter Loom Tags</span>\n                                        <span class="lumia-toggle-hint">Removes Lucid Loom-related tags from older messages</span>\n                                    </label>\n                                    <div class="lumia-toggle-switch-wrapper">\n                                        <input type="checkbox" id="lumia-filter-loom-toggle" class="lumia-toggle-input" ').concat(u.enabled?"checked":"",' />\n                                        <label for="lumia-filter-loom-toggle" class="lumia-toggle-switch-label">\n                                            <div class="lumia-toggle-track">\n                                                <div class="lumia-toggle-thumb"></div>\n                                            </div>\n                                        </label>\n                                    </div>\n                                </div>\n                                <div class="lumia-filter-options ').concat(u.enabled?"":"lumia-filter-options-hidden",'">\n                                    <label class="lumia-input-label">\n                                        <span>Keep in last N messages:</span>\n                                        <input type="number" id="lumia-filter-loom-depth" class="lumia-input-number" value="').concat(u.keepDepth||5,'" min="0" max="100" />\n                                    </label>\n                                    <span class="lumia-input-hint">Loom tags in older messages will be stripped to save tokens</span>\n                                </div>\n                            </div>\n\n                        </div>\n                    </div>\n                </div>\n\n            </div>\n            <div class="lumia-modal-footer">\n                <button class="lumia-modal-btn lumia-modal-btn-secondary lumia-prompt-settings-cancel-btn">Cancel</button>\n                <button class="lumia-modal-btn lumia-modal-btn-primary lumia-prompt-settings-save-btn">Save Changes</button>\n            </div>\n        </dialog>\n    ');$("body").append(d);const m=$("#lumia-prompt-settings-modal");y(m);const p=()=>{m[0]._resizeCleanup&&m[0]._resizeCleanup(),m[0].close(),m.remove()};function g(){const e=m.find("#lumia-filter-html-toggle").is(":checked"),n=m.find("#lumia-filter-details-toggle").is(":checked"),t=m.find("#lumia-filter-loom-toggle").is(":checked"),r=m.find(".lumia-modal-panel").eq(1).find(".lumia-panel-status");e||n||t?r.addClass("lumia-panel-status-active").text("Active"):r.removeClass("lumia-panel-status-active").text("Inactive")}m.on("click mousedown mouseup",function(e){e.stopPropagation(),"click"===e.type&&e.target===this&&p()}),m.find(".lumia-collapsible-trigger").click(function(e){$(e.target).closest("input, label, .lumia-toggle-switch-wrapper").length>0||$(this).closest(".lumia-collapsible").toggleClass("collapsed")}),m.find("#lumia-sovereign-hand-toggle").change(function(){const e=$(this).is(":checked"),n=m.find(".lumia-info-box-sovereign"),t=$(this).closest(".lumia-collapsible").find(".lumia-panel-status"),r=m.find("#lumia-sovereign-exclude-toggle"),i=r.closest(".lumia-toggle-row"),o=m.find("#lumia-sovereign-include-prompt-toggle"),a=o.closest(".lumia-toggle-row");e?(n.removeClass("lumia-info-box-muted"),t.addClass("lumia-panel-status-active").text("Active"),r.prop("disabled",!1),i.removeClass("lumia-toggle-disabled"),o.prop("disabled",!1),a.removeClass("lumia-toggle-disabled")):(n.addClass("lumia-info-box-muted"),t.removeClass("lumia-panel-status-active").text("Inactive"),r.prop("disabled",!0),i.addClass("lumia-toggle-disabled"),o.prop("disabled",!0),a.addClass("lumia-toggle-disabled"))}),m.find("#lumia-filter-details-toggle").change(function(){const e=$(this).closest(".lumia-filter-item").find(".lumia-filter-options");$(this).is(":checked")?e.removeClass("lumia-filter-options-hidden"):e.addClass("lumia-filter-options-hidden"),g()}),m.find("#lumia-filter-loom-toggle").change(function(){const e=$(this).closest(".lumia-filter-item").find(".lumia-filter-options");$(this).is(":checked")?e.removeClass("lumia-filter-options-hidden"):e.addClass("lumia-filter-options-hidden"),g()}),m.find("#lumia-filter-html-toggle").change(function(){const e=$(this).closest(".lumia-filter-item").find("> .lumia-filter-options");$(this).is(":checked")?e.removeClass("lumia-filter-options-hidden"):e.addClass("lumia-filter-options-hidden"),g()}),m.find("#lumia-filter-fonts-toggle").change(function(){const e=$(this).closest(".lumia-filter-sub-item").find(".lumia-filter-sub-options");$(this).is(":checked")?e.removeClass("lumia-filter-options-hidden"):e.addClass("lumia-filter-options-hidden")}),m.find(".lumia-prompt-settings-save-btn").click(()=>{const n=m.find("#lumia-sovereign-hand-toggle").is(":checked"),t=m.find("#lumia-sovereign-exclude-toggle").is(":checked"),r=m.find("#lumia-sovereign-include-prompt-toggle").is(":checked");e.sovereignHand||(e.sovereignHand={}),e.sovereignHand.enabled=n,e.sovereignHand.excludeLastMessage=t,e.sovereignHand.includeMessageInPrompt=r,e.contextFilters||(e.contextFilters={}),e.contextFilters.htmlTags={enabled:m.find("#lumia-filter-html-toggle").is(":checked"),keepDepth:parseInt(m.find("#lumia-filter-html-depth").val())||3,stripFonts:m.find("#lumia-filter-fonts-toggle").is(":checked"),fontKeepDepth:parseInt(m.find("#lumia-filter-fonts-depth").val())||3},e.contextFilters.detailsBlocks={enabled:m.find("#lumia-filter-details-toggle").is(":checked"),keepDepth:parseInt(m.find("#lumia-filter-details-depth").val())||3},e.contextFilters.loomItems={enabled:m.find("#lumia-filter-loom-toggle").is(":checked"),keepDepth:parseInt(m.find("#lumia-filter-loom-depth").val())||5},(0,i.saveSettings)(),(0,l.TC)(),toastr.success("Prompt settings saved!"),p()}),m.find(".lumia-prompt-settings-cancel-btn").click(p),m.on("keydown",function(e){"Escape"===e.key&&p()}),m[0].showModal()}async function N(){(0,i.getSettings)();$("#lucid-cards-modal").remove();$("body").append('\n        <dialog id="lucid-cards-modal" class="popup popup--animation-fast lumia-modal lumia-modal-lucid-cards">\n            <div class="lumia-modal-header">\n                <div class="lumia-modal-header-icon">\n                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                        <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>\n                        <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>\n                        <line x1="12" y1="22.08" x2="12" y2="12"></line>\n                    </svg>\n                </div>\n                <div class="lumia-modal-header-text">\n                    <h3 class="lumia-modal-title">Lucid Cards Browser</h3>\n                    <p class="lumia-modal-subtitle">Browse and import official Lumiverse content</p>\n                </div>\n            </div>\n            <div class="lucid-cards-tabs">\n                <button class="lucid-cards-tab active" data-category="Lumia DLCs">\n                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>\n                        <circle cx="12" cy="7" r="4"></circle>\n                    </svg>\n                    <span>Lumia DLCs</span>\n                </button>\n                <button class="lucid-cards-tab" data-category="Loom Utilities">\n                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                        <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path>\n                    </svg>\n                    <span>Utilities</span>\n                </button>\n                <button class="lucid-cards-tab" data-category="Loom Retrofits">\n                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                        <circle cx="12" cy="12" r="3"></circle>\n                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"></path>\n                    </svg>\n                    <span>Retrofits</span>\n                </button>\n                <button class="lucid-cards-tab" data-category="Loom Narratives">\n                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                        <path d="M12 19l7-7 3 3-7 7-3-3z"></path>\n                        <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"></path>\n                        <path d="M2 2l7.586 7.586"></path>\n                        <circle cx="11" cy="11" r="2"></circle>\n                    </svg>\n                    <span>Narratives</span>\n                </button>\n            </div>\n            <div class="lumia-modal-content">\n                <div class="lucid-cards-loading">\n                    <div class="lucid-cards-spinner"></div>\n                    <span>Loading content from Lucid.cards...</span>\n                </div>\n                <div class="lucid-cards-error" style="display: none;">\n                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                        <circle cx="12" cy="12" r="10"></circle>\n                        <line x1="15" y1="9" x2="9" y2="15"></line>\n                        <line x1="9" y1="9" x2="15" y2="15"></line>\n                    </svg>\n                    <span class="lucid-cards-error-message">Failed to load content</span>\n                    <button class="lumia-modal-btn lumia-modal-btn-secondary lucid-cards-retry-btn">Retry</button>\n                </div>\n                <div class="lucid-cards-content" style="display: none;"></div>\n            </div>\n            <div class="lumia-modal-footer lucid-cards-footer">\n                <button class="lumia-modal-btn lumia-modal-btn-secondary lucid-cards-close-btn">Close</button>\n                <div class="lucid-cards-selection-controls" style="display: none;">\n                    <button class="lumia-modal-btn lumia-modal-btn-text lucid-cards-select-all-btn">Select All</button>\n                    <button class="lumia-modal-btn lumia-modal-btn-text lucid-cards-clear-btn">Clear</button>\n                </div>\n                <div class="lucid-cards-selected-count" style="display: none;">\n                    <span class="lucid-cards-count-text">0 selected</span>\n                </div>\n                <button class="lumia-modal-btn lumia-modal-btn-primary lucid-cards-import-btn" style="display: none;">\n                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>\n                        <polyline points="7 10 12 15 17 10"></polyline>\n                        <line x1="12" y1="15" x2="12" y2="3"></line>\n                    </svg>\n                    <span class="lucid-cards-import-text">Import Packs</span>\n                </button>\n            </div>\n        </dialog>\n    ');const e=$("#lucid-cards-modal");let n="Lumia DLCs",r=[],a=null;const s=()=>{const n=r.length;0===n?(e.find(".lucid-cards-selection-controls").hide(),e.find(".lucid-cards-selected-count").hide(),e.find(".lucid-cards-import-btn").hide()):(e.find(".lucid-cards-selection-controls").show(),e.find(".lucid-cards-selected-count").show(),e.find(".lucid-cards-count-text").text("".concat(n," selected")),e.find(".lucid-cards-import-text").text(1===n?"Import Pack":"Import ".concat(n," Packs")),e.find(".lucid-cards-import-btn").show()),requestAnimationFrame(()=>c())},c=()=>{const n=e[0],t=(window.innerHeight||document.documentElement.clientHeight)-((window.innerWidth||document.documentElement.clientWidth)<=600?24:48);n.style.maxHeight="".concat(t,"px");const r=e.find(".lumia-modal-header"),i=e.find(".lucid-cards-tabs"),o=e.find(".lumia-modal-footer"),a=e.find(".lumia-modal-content");requestAnimationFrame(()=>{const e=r.length?r[0].offsetHeight:0,n=i.length?i[0].offsetHeight:0,s=o.length?o[0].offsetHeight:0,l=t-e-n-s;a.length&&(a[0].style.maxHeight="".concat(l,"px"),a[0].style.overflowY="auto")})};c();const u=()=>c();window.addEventListener("resize",u),e[0]._resizeCleanup=()=>window.removeEventListener("resize",u);const d=()=>{e[0]._resizeCleanup&&e[0]._resizeCleanup(),e[0].close(),e.remove(),p()};e.on("click mousedown mouseup",function(e){e.stopPropagation(),"click"===e.type&&e.target===this&&d()}),e.on("keydown",function(e){"Escape"===e.key&&d()});const m=async()=>{e.find(".lucid-cards-loading").show(),e.find(".lucid-cards-error").hide(),e.find(".lucid-cards-content").hide(),r=[],s();try{const e=await fetch("https://lucid.cards/api/lumia-dlc");if(!e.ok)throw new Error("HTTP error: ".concat(e.status));a=await e.json(),g()}catch(n){console.error("[".concat(i.MODULE_NAME,"] Failed to fetch Lucid.cards:"),n),e.find(".lucid-cards-loading").hide(),e.find(".lucid-cards-error-message").text("Failed to load: ".concat(n.message)),e.find(".lucid-cards-error").show()}},g=()=>{var t;const i=(null===(t=a)||void 0===t?void 0:t.packs)||[];if(!a||0===i.length)return e.find(".lucid-cards-loading").hide(),e.find(".lucid-cards-error-message").text("No content available"),void e.find(".lucid-cards-error").show();e.find(".lucid-cards-loading").hide(),e.find(".lucid-cards-error").hide();const l=e.find(".lucid-cards-content");let c;if(l.empty(),c="Lumia DLCs"===n?i.filter(e=>"lumia"===e.packType||e.lumiaCount&&e.lumiaCount>0):i.filter(e=>"loom"===e.packType||e.loomCount&&e.loomCount>0),0===c.length)return l.html('<div class="lucid-cards-empty">No items available in this category.</div>'),void l.show();const u=c.map(e=>{const n=e.packName||"Unknown",t=(0,o.ZD)(n),r=e.slug?"/api/lumia-dlc/".concat(e.slug):"",i=(0,o.ZD)(r),a=e.coverUrl||null,s=e.packAuthor||null,l=[];e.lumiaCount>0&&l.push("".concat(e.lumiaCount," Lumia")),e.loomCount>0&&l.push("".concat(e.loomCount," Loom")),e.extrasCount>0&&l.push("".concat(e.extrasCount," Extra"));const c=l.length>0?l.join(", "):"",u=a?'<img src="'.concat((0,o.ZD)(a),'" alt="" loading="lazy" class="lumia-img-loaded">'):'<div class="lucid-dlc-card-placeholder">\n                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">\n                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>\n                    <circle cx="8.5" cy="8.5" r="1.5"></circle>\n                    <polyline points="21 15 16 10 5 21"></polyline>\n                </svg>\n            </div>',d=s?(0,o.ZD)(s):"Unknown Author";return'\n                  <div class="lucid-dlc-card" data-path="'.concat(i,'" data-name="').concat(t,'"\n                       data-cover-img="').concat((0,o.ZD)(a||""),'" data-author="').concat((0,o.ZD)(s||""),'">\n                      <div class="lucid-dlc-card-image">\n                          ').concat(u,'\n                          <div class="lucid-dlc-card-check">\n                              ').concat(h,'\n                          </div>\n                      </div>\n                      <div class="lucid-dlc-card-info">\n                          <div class="lucid-dlc-card-title">').concat(t,'</div>\n                          <div class="lucid-dlc-card-author">').concat(d,"</div>\n                          ").concat(c?'<div class="lucid-dlc-card-counts">'.concat((0,o.ZD)(c),"</div>"):"","\n                      </div>\n                  </div>\n              ")}).join("");l.html('<div class="lucid-dlc-grid">'.concat(u,"</div>")),l.show(),r=[],e.find(".lucid-dlc-card").removeClass("selected"),s()};e.find(".lucid-cards-tab").click(function(){e.find(".lucid-cards-tab").removeClass("active"),$(this).addClass("active"),n=$(this).data("category"),r=[],e.find(".lucid-dlc-card").removeClass("selected"),s(),g()}),e.on("click",".lucid-dlc-card",function(){const e=$(this),n=e.data("path"),t=e.data("name"),i=e.data("author")||"Unknown Author",o=r.findIndex(e=>e.path===n);o>=0?(r.splice(o,1),e.removeClass("selected")):(r.push({path:n,name:t,author:i}),e.addClass("selected")),s()}),e.find(".lucid-cards-select-all-btn").click(function(){const n=e.find(".lucid-dlc-card");r=[],n.each(function(){const e=$(this);e.addClass("selected"),r.push({path:e.data("path"),name:e.data("name"),author:e.data("author")||"Unknown Author"})}),s()}),e.find(".lucid-cards-clear-btn").click(function(){r=[],e.find(".lucid-dlc-card").removeClass("selected"),s()}),e.find(".lucid-cards-close-btn").click(d),e.find(".lucid-cards-retry-btn").click(m),e.find(".lucid-cards-import-btn").click(async function(){if(0===r.length)return;const n=$(this),a=n.html(),c=r.length;let u=0,d=0,m=0;const p=(0,i.getSettings)(),{importPack:g}=await Promise.resolve().then(t.bind(t,154));n.prop("disabled",!0);for(let t=0;t<r.length;t++){const a=r[t];if(n.html('\n        <svg class="lucid-cards-btn-spinner" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n          <circle cx="12" cy="12" r="10"></circle>\n        </svg>\n        Importing '.concat(t+1," of ").concat(c,"...\n      ")),p.packs[a.name]){d++;const n=(0,o.ZD)(a.path);e.find('.lucid-dlc-card[data-path="'.concat(n,'"]')).addClass("already-imported");continue}try{const n=await fetch("https://lucid.cards".concat(a.path));if(!n.ok)throw new Error("HTTP error: ".concat(n.status));const t=await n.json();if(!1===t.success)throw new Error(t.error||"Failed to fetch pack");g(t.pack||t,a.name,!0),u++;const r=(0,o.ZD)(a.path);e.find('.lucid-dlc-card[data-path="'.concat(r,'"]')).addClass("imported")}catch(e){console.error("[".concat(i.MODULE_NAME,'] Import failed for "').concat(a.name,'":'),e),m++}}(0,l.TC)();const h=[];u>0&&h.push("".concat(u," imported")),d>0&&h.push("".concat(d," skipped (already exist)")),m>0&&h.push("".concat(m," failed")),u>0?toastr.success("Import complete: ".concat(h.join(", "))):d>0&&0===m?toastr.info("All ".concat(d," packs already exist")):toastr.error("Import failed: ".concat(h.join(", "))),r=[],e.find(".lucid-dlc-card").removeClass("selected"),s(),n.prop("disabled",!1).html(a)}),e[0].showModal(),m()}function E(){const e=(0,i.getSettings)(),n=document.getElementById("lumia-book-status"),t=Object.values(e.packs);if(t.length>0){if(n){const e=t.reduce((e,n)=>{var t,r,i;const o=(null===(t=n.lumiaItems)||void 0===t?void 0:t.length)||0,a=(null===(r=n.loomItems)||void 0===r?void 0:r.length)||0,s=(null===(i=n.items)||void 0===i?void 0:i.length)||0;return e+(o+a>0?o+a:s)},0);n.textContent="Loaded ".concat(t.length," packs (").concat(e," items total)")}const i=document.getElementById("lumia-current-definition");var r;if(i)if(e.chimeraMode&&(null===(r=e.selectedDefinitions)||void 0===r?void 0:r.length)>0){const n=e.selectedDefinitions.map(e=>{const n=(0,o.Br)(e.packName,e.itemName);return n?n.lumiaDefName:null}).filter(e=>e);i.textContent=n.length>0?"[Chimera] ".concat(n.join(" + ")):"No Chimera definitions selected"}else{const n=e.selectedDefinition;if(n){const e=(0,o.Br)(n.packName,n.itemName);i.textContent=e?"".concat(e.lumiaDefName," (").concat(n.packName,")"):"Item not found (Maybe pack removed?)"}else i.textContent="No definition selected"}const a=document.getElementById("lumia-current-behaviors");if(a){const n=e.selectedBehaviors.map(n=>{const t=(0,o.Br)(n.packName,n.itemName);if(!t)return null;const r=t.lumiaDefName;return e.dominantBehavior&&e.dominantBehavior.packName===n.packName&&e.dominantBehavior.itemName===n.itemName?"★ ".concat(r):r}).filter(e=>e);a.textContent=n.length>0?n.join(", "):"No behaviors selected"}const s=document.getElementById("lumia-current-personalities");if(s){const n=e.selectedPersonalities.map(n=>{const t=(0,o.Br)(n.packName,n.itemName);if(!t)return null;const r=t.lumiaDefName;return e.dominantPersonality&&e.dominantPersonality.packName===n.packName&&e.dominantPersonality.itemName===n.itemName?"★ ".concat(r):r}).filter(e=>e);s.textContent=n.length>0?n.join(", "):"No personalities selected"}const l=document.getElementById("loom-current-style");if(l){const n=(Array.isArray(e.selectedLoomStyle)?e.selectedLoomStyle:[]).map(e=>{const n=(0,o.Br)(e.packName,e.itemName);return n?n.loomName:null}).filter(e=>e);l.textContent=n.length>0?n.join(", "):"No styles selected"}const c=document.getElementById("loom-current-utils");if(c){const n=e.selectedLoomUtils.map(e=>{const n=(0,o.Br)(e.packName,e.itemName);return n?n.loomName:null}).filter(e=>e);c.textContent=n.length>0?n.join(", "):"No utilities selected"}const u=document.getElementById("loom-current-retrofits");if(u){const n=e.selectedLoomRetrofits.map(e=>{const n=(0,o.Br)(e.packName,e.itemName);return n?n.loomName:null}).filter(e=>e);u.textContent=n.length>0?n.join(", "):"No retrofits selected"}}else n&&(n.textContent="No Packs loaded"),["lumia-current-definition","lumia-current-behaviors","lumia-current-personalities","loom-current-style","loom-current-utils","loom-current-retrofits"].forEach(e=>{const n=document.getElementById(e);n&&(n.textContent="No selection possible (Load packs first)")})}function P(){var e;const n=document.getElementById("lumia-loom-summary-btn");if(!n)return;const t=(0,r.SD)(),o=null==t||null===(e=t.chatMetadata)||void 0===e?void 0:e[i.LOOM_SUMMARY_KEY],s=(null==t?void 0:t.chat)&&t.chat.length>0,l=(0,a.dj)();n.classList.remove("lumia-loom-summary-btn-hidden","lumia-loom-summary-btn-empty","lumia-loom-summary-btn-active","lumia-loom-summary-btn-summarizing"),l?(n.classList.add("lumia-loom-summary-btn-summarizing"),n.title="Generating summary..."):s?o?(n.classList.add("lumia-loom-summary-btn-active"),n.title="View/Edit Loom Summary"):(n.classList.add("lumia-loom-summary-btn-empty"),n.title="No Loom Summary (click to create)"):(n.classList.add("lumia-loom-summary-btn-hidden"),n.title="No active chat")}},961(e,n,t){!function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(e){console.error(e)}}(),e.exports=t(551)},982(e,n,t){e.exports=t(463)}},n={};function t(r){var i=n[r];if(void 0!==i)return i.exports;var o=n[r]={id:r,exports:{}};return e[r](o,o.exports,t),o.exports}t.m=e,t.n=e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},t.d=(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},t.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),t.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.b="undefined"!=typeof document&&document.baseURI||self.location.href,t.nc=void 0;var r=t(92);const i={createElement(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const t=document.createElement(e),{attrs:r={},text:i,html:o,children:a=[],style:s={},data:l={}}=n;return Object.entries(r).forEach(e=>{let[n,r]=e;null!=r&&t.setAttribute(n,r)}),Object.entries(s).forEach(e=>{let[n,r]=e;t.style[n]=r}),Object.entries(l).forEach(e=>{let[n,r]=e;t.dataset[n]=r}),void 0!==i?t.textContent=i:void 0!==o&&(t.innerHTML=o),a.forEach(e=>{e instanceof HTMLElement&&t.appendChild(e)}),t},query(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:document).querySelector(e)},queryAll(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;return Array.from(n.querySelectorAll(e))},on(e,n,t,r){const i="string"==typeof e?this.query(e):e;if(!i)return console.warn("DOMUtils.on: Target element not found"),()=>{};if("string"==typeof t){const e=t,o=r,a=n=>{const t=n.target.closest(e);t&&i.contains(t)&&o.call(t,n)};return i.addEventListener(n,a),()=>i.removeEventListener(n,a)}const o=t;return i.addEventListener(n,o),()=>i.removeEventListener(n,o)},once(e,n,t){const r="string"==typeof e?this.query(e):e;if(!r)return console.warn("DOMUtils.once: Target element not found"),()=>{};const i=e=>{t(e),r.removeEventListener(n,i)};return r.addEventListener(n,i),()=>r.removeEventListener(n,i)},debounce(e,n){let t,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return function(){for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];const s=this,l=r&&!t;clearTimeout(t),t=setTimeout(()=>{t=null,r||e.apply(s,o)},n),l&&e.apply(s,o)}},throttle(e,n){let t;return function(){const r=this;if(!t){for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];e.apply(r,o),t=!0,setTimeout(()=>t=!1,n)}}},addClass(e){const n="string"==typeof e?this.query(e):e;if(n){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];n.classList.add(...r)}return n},removeClass(e){const n="string"==typeof e?this.query(e):e;if(n){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];n.classList.remove(...r)}return n},toggleClass(e,n,t){const r="string"==typeof e?this.query(e):e;return!!r&&r.classList.toggle(n,t)},hasClass(e,n){const t="string"==typeof e?this.query(e):e;return!!t&&t.classList.contains(n)},scrollTo(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{target:n,top:t,left:r,behavior:i="smooth",offset:o=0,container:a=window}=e;if(n){const e="string"==typeof n?this.query(n):n;if(e){const n=e.getBoundingClientRect(),t=a===window?window.pageYOffset:a.scrollTop;a.scrollTo({top:t+n.top+o,behavior:i})}}else a.scrollTo({top:void 0!==t?t:a.scrollY,left:void 0!==r?r:a.scrollX,behavior:i})},isVisible(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const t="string"==typeof e?this.query(e):e;if(!t)return Promise.resolve(!1);const{threshold:r=0,rootMargin:i="0px"}=n;if(!("IntersectionObserver"in window)){const e=t.getBoundingClientRect();return Promise.resolve(e.top>=0&&e.left>=0&&e.bottom<=window.innerHeight&&e.right<=window.innerWidth)}return new Promise(e=>{const n=new IntersectionObserver(t=>{e(t[0].isIntersecting),n.disconnect()},{threshold:r,rootMargin:i});n.observe(t)})},observeVisibility(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r="string"==typeof e?this.query(e):e;if(!r||!("IntersectionObserver"in window))return{disconnect:()=>{}};const{threshold:i=0,rootMargin:o="0px"}=t,a=new IntersectionObserver(e=>{e.forEach(e=>n(e.isIntersecting))},{threshold:i,rootMargin:o});return a.observe(r),a},getRect(e){const n="string"==typeof e?this.query(e):e;return n?n.getBoundingClientRect():null},getOffset(e){const n="string"==typeof e?this.query(e):e;if(!n)return null;const t=n.getBoundingClientRect();return{top:t.top+window.pageYOffset,left:t.left+window.pageXOffset}},setStyle(e,n){const t="string"==typeof e?this.query(e):e;return t&&Object.entries(n).forEach(e=>{let[n,r]=e;t.style[n]=r}),t},getStyle(e,n){const t="string"==typeof e?this.query(e):e;return t?window.getComputedStyle(t)[n]:""},show(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"block";const t="string"==typeof e?this.query(e):e;return t&&(t.style.display=n),t},hide(e){const n="string"==typeof e?this.query(e):e;return n&&(n.style.display="none"),n},toggle(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"block";const t="string"==typeof e?this.query(e):e;if(!t)return!1;const r="none"===window.getComputedStyle(t).display;return t.style.display=r?n:"none",r},remove(e){const n="string"==typeof e?this.query(e):e;return n&&n.parentNode&&n.parentNode.removeChild(n),n},empty(e){const n="string"==typeof e?this.query(e):e;if(n)for(;n.firstChild;)n.removeChild(n.firstChild);return n},attr(e,n,t){const r="string"==typeof e?this.query(e):e;return r?"string"==typeof n&&void 0===t?r.getAttribute(n):"string"==typeof n?(r.setAttribute(n,t),r):"object"==typeof n?(Object.entries(n).forEach(e=>{let[n,t]=e;r.setAttribute(n,t)}),r):null:null},removeAttr(e,n){const t="string"==typeof e?this.query(e):e;return t&&t.removeAttribute(n),t},ready(e){"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e()},createQueryCache(){const e=new Map;return{get(n){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;const r="".concat(n,":").concat(t);if(!e.has(r)){const i=t.querySelector(n);i&&e.set(r,i)}return e.get(r)||null},clear(){e.clear()}}},getDistanceToViewport(e){const n="string"==typeof e?this.query(e):e;if(!n)return null;const t=n.getBoundingClientRect(),r=window.innerWidth||document.documentElement.clientWidth,i=window.innerHeight||document.documentElement.clientHeight;return{top:t.top,right:r-t.right,bottom:i-t.bottom,left:t.left}},getDistanceBetween(e,n){const t="string"==typeof e?this.query(e):e,r="string"==typeof n?this.query(n):n;if(!t||!r)return null;const i=t.getBoundingClientRect(),o=r.getBoundingClientRect();let a,s;return a=i.right<o.left?o.left-i.right:o.right<i.left?i.left-o.right:0,s=i.bottom<o.top?o.top-i.bottom:o.bottom<i.top?i.top-o.bottom:0,{horizontal:a,vertical:s,diagonal:Math.sqrt(a*a+s*s)}},logElementMeasurements(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Element";const t="string"==typeof e?i.query(e):e;if(!t)return console.warn("DOMUtils.logElementMeasurements: Element not found"),null;const r=t.getBoundingClientRect(),o=window.getComputedStyle(t),a=i.getDistanceToViewport(t),s={selector:"string"==typeof e?e:t.tagName,dimensions:{width:r.width,height:r.height,computedWidth:o.width,computedHeight:o.height},position:{top:r.top,right:r.right,bottom:r.bottom,left:r.left,x:r.x,y:r.y},distanceToViewport:a,viewport:{width:window.innerWidth,height:window.innerHeight},padding:{top:o.paddingTop,right:o.paddingRight,bottom:o.paddingBottom,left:o.paddingLeft},margin:{top:o.marginTop,right:o.marginRight,bottom:o.marginBottom,left:o.marginLeft}};return console.group("📏 ".concat(n," Measurements")),console.log("Element:",t),console.log("Dimensions:",s.dimensions),console.log("Position:",s.position),console.log("Distance to Viewport Edges:",s.distanceToViewport),console.log("Viewport Size:",s.viewport),console.log("Padding:",s.padding),console.log("Margin:",s.margin),console.groupEnd(),s},getTopBarHeight(){const e=document.getElementById("top-bar");return e?e.offsetHeight:50},getSafeLandingPageZIndex(){const e=document.getElementById("top-bar");if(e){const n=window.getComputedStyle(e).zIndex;if(n&&"auto"!==n){const e=parseInt(n,10);return isNaN(e)?2999:e-1}}return 2999}},{createElement:o,query:a,queryAll:s,on:l,once:c,debounce:u,throttle:d,addClass:m,removeClass:p,toggleClass:g,hasClass:h,scrollTo:v,isVisible:f,observeVisibility:b,getRect:x,getOffset:y,setStyle:k,getStyle:w,show:j,hide:C,toggle:S,remove:N,empty:E,attr:P,removeAttr:D,ready:M,createQueryCache:O,getDistanceToViewport:T,getDistanceBetween:A,logElementMeasurements:L,getTopBarHeight:z,getSafeLandingPageZIndex:I}=i,R='\n/* Landing Page Container */\n.lumiverse-lp-container {\n  position: absolute; /* Changed from fixed to absolute to respect parent container */\n  inset: 0;\n  width: 100%;\n  height: 100%;\n  left: 0;\n  top: 0;\n  /* z-index handled in index.js */\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n  box-sizing: border-box;\n  /* background moved to .lumiverse-lp-bg for proper layering */\n  font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, Helvetica, Arial, sans-serif;\n  /* padding-top handled inline */\n}\n\n/* Ambient background glows */\n.lumiverse-lp-bg {\n  position: absolute;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  /* top handled inline */\n  overflow: hidden;\n  pointer-events: auto; /* Block clicks on underlying content */\n  background: linear-gradient(\n    165deg,\n    rgba(15, 12, 22, 0.98) 0%,\n    rgba(22, 18, 32, 0.97) 50%,\n    rgba(18, 15, 28, 0.98) 100%\n  );\n}\n\n.lumiverse-lp-bg-glow {\n  position: absolute;\n  border-radius: 50%;\n  filter: blur(80px);\n  opacity: 0.4;\n  animation: lumiverse-lp-glow-pulse 8s ease-in-out infinite;\n}\n\n.lumiverse-lp-bg-glow-1 {\n  width: 600px;\n  height: 600px;\n  background: radial-gradient(circle, rgba(147, 112, 219, 0.25) 0%, transparent 70%);\n  top: -200px;\n  right: -100px;\n  animation-delay: 0s;\n}\n\n.lumiverse-lp-bg-glow-2 {\n  width: 500px;\n  height: 500px;\n  background: radial-gradient(circle, rgba(100, 149, 237, 0.2) 0%, transparent 70%);\n  bottom: -150px;\n  left: -100px;\n  animation-delay: -2.6s;\n}\n\n.lumiverse-lp-bg-glow-3 {\n  width: 400px;\n  height: 400px;\n  background: radial-gradient(circle, rgba(186, 135, 255, 0.15) 0%, transparent 70%);\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  animation-delay: -5.3s;\n}\n\n@keyframes lumiverse-lp-glow-pulse {\n  0%, 100% {\n    opacity: 0.3;\n    transform: scale(1);\n  }\n  50% {\n    opacity: 0.5;\n    transform: scale(1.1);\n  }\n}\n\n/* Grid pattern overlay */\n.lumiverse-lp-grid {\n  position: absolute;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  /* top handled inline */\n  background-image:\n    linear-gradient(rgba(147, 112, 219, 0.03) 1px, transparent 1px),\n    linear-gradient(90deg, rgba(147, 112, 219, 0.03) 1px, transparent 1px);\n  background-size: 50px 50px;\n  pointer-events: none;\n  opacity: 0.6;\n}\n\n/* Main content wrapper */\n.lumiverse-lp-content {\n  position: relative;\n  z-index: 1;\n  display: flex;\n  flex-direction: column;\n  flex: 1;\n  height: auto;\n  min-height: 0; /* Crucial for nested scrolling */\n  width: 100%; /* Ensure full width */\n  max-width: 100%; /* Prevent overflow */\n  padding: 24px 32px;\n  box-sizing: border-box;\n  pointer-events: auto; /* Enable interaction */\n}\n\n/* Header */\n.lumiverse-lp-header {\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  z-index: 10;\n  display: flex;\n  align-items: flex-start;\n  justify-content: space-between;\n  padding: 44px 32px 60px;\n  background: linear-gradient(\n    180deg,\n    #0f0c16 0%,\n    rgba(15, 12, 22, 0.98) 70%,\n    rgba(15, 12, 22, 0) 100%\n  );\n  pointer-events: none;\n}\n\n.lumiverse-lp-header > * {\n  pointer-events: auto;\n}\n\n.lumiverse-lp-header-left {\n  display: flex;\n  align-items: center;\n}\n\n.lumiverse-lp-header-right {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n}\n\n.lumiverse-lp-logo {\n  display: flex;\n  align-items: center;\n  gap: 16px;\n}\n\n.lumiverse-lp-logo-icon {\n  width: 52px;\n  height: 52px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: linear-gradient(\n    135deg,\n    rgba(147, 112, 219, 0.25) 0%,\n    rgba(100, 149, 237, 0.15) 100%\n  );\n  border: 1px solid rgba(147, 112, 219, 0.4);\n  border-radius: 16px;\n  box-shadow:\n    0 4px 24px rgba(147, 112, 219, 0.3),\n    inset 0 1px 0 rgba(255, 255, 255, 0.1);\n}\n\n.lumiverse-lp-logo-icon svg {\n  width: 100%;\n  height: 100%;\n  padding: 10px;\n  box-sizing: border-box;\n  filter: drop-shadow(0 0 4px rgba(186, 135, 255, 0.5));\n}\n\n.lumiverse-lp-logo-text h1 {\n  font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", sans-serif !important;\n  font-size: 28px;\n  font-weight: 800;\n  color: rgba(255, 255, 255, 0.98);\n  margin: 0 !important;\n  padding: 0 !important;\n  border: none !important;\n  background: none !important;\n  box-shadow: none !important;\n  text-decoration: none !important;\n  line-height: 1.1 !important;\n  letter-spacing: -0.5px;\n  background: linear-gradient(135deg, #ffffff 0%, #d8b4fe 100%) !important;\n  -webkit-background-clip: text !important;\n  -webkit-text-fill-color: transparent !important;\n  background-clip: text !important;\n  text-shadow: 0 4px 12px rgba(147, 112, 219, 0.3) !important;\n  padding-top: 4px !important; /* Nudge text down slightly for visual balance */\n}\n\n.lumiverse-lp-logo-text span {\n  font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", sans-serif !important;\n  font-size: 14px;\n  font-weight: 500;\n  color: rgba(255, 255, 255, 0.6) !important;\n  letter-spacing: 0.5px;\n  text-transform: uppercase;\n  margin: 0 !important;\n  padding: 0 !important;\n  border: none !important;\n  background: none !important;\n  box-shadow: none !important;\n  text-decoration: none !important;\n}\n\n/* Buttons */\n.lumiverse-lp-btn {\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  gap: 8px;\n  padding: 10px 18px;\n  border: none;\n  border-radius: 10px;\n  font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", sans-serif;\n  font-size: 13px;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);\n  backdrop-filter: blur(12px);\n  -webkit-backdrop-filter: blur(12px);\n}\n\n.lumiverse-lp-btn svg {\n  width: 16px;\n  height: 16px;\n  flex-shrink: 0;\n}\n\n.lumiverse-lp-btn-refresh {\n  width: 40px;\n  height: 40px;\n  padding: 0;\n  background: rgba(255, 255, 255, 0.05);\n  border: 1px solid rgba(255, 255, 255, 0.1);\n  color: rgba(255, 255, 255, 0.7);\n}\n\n.lumiverse-lp-btn-refresh:hover {\n  background: rgba(147, 112, 219, 0.15);\n  border-color: rgba(147, 112, 219, 0.4);\n  color: rgba(186, 135, 255, 0.95);\n}\n\n/* Temporary chat button */\n.lumiverse-lp-btn-temp-chat {\n  width: 40px;\n  height: 40px;\n  padding: 0;\n  background: rgba(255, 255, 255, 0.05);\n  border: 1px solid rgba(255, 255, 255, 0.1);\n  color: rgba(255, 255, 255, 0.7);\n}\n\n.lumiverse-lp-btn-temp-chat:hover {\n  background: rgba(100, 200, 150, 0.15);\n  border-color: rgba(100, 200, 150, 0.4);\n  color: rgba(150, 230, 180, 0.95);\n}\n\n.lumiverse-lp-btn-toggle {\n  background: linear-gradient(\n    135deg,\n    rgba(147, 112, 219, 0.2) 0%,\n    rgba(100, 149, 237, 0.15) 100%\n  );\n  border: 1px solid rgba(147, 112, 219, 0.35);\n  color: rgba(255, 255, 255, 0.9);\n}\n\n.lumiverse-lp-btn-toggle:hover {\n  background: linear-gradient(\n    135deg,\n    rgba(147, 112, 219, 0.3) 0%,\n    rgba(100, 149, 237, 0.25) 100%\n  );\n  border-color: rgba(147, 112, 219, 0.5);\n  box-shadow: 0 4px 20px rgba(147, 112, 219, 0.25);\n}\n\n.lumiverse-lp-btn-primary {\n  background: linear-gradient(\n    135deg,\n    rgba(147, 112, 219, 0.9) 0%,\n    rgba(100, 149, 237, 0.85) 100%\n  );\n  color: white;\n  border: 1px solid rgba(147, 112, 219, 0.4);\n}\n\n.lumiverse-lp-btn-primary:hover {\n  background: linear-gradient(\n    135deg,\n    rgba(167, 132, 239, 0.95) 0%,\n    rgba(120, 169, 247, 0.9) 100%\n  );\n  transform: translateY(-1px);\n  box-shadow: 0 6px 24px rgba(147, 112, 219, 0.35);\n}\n\n/* Spin animation for refresh */\n.lumiverse-lp-spin {\n  animation: lumiverse-lp-spin 1s linear infinite;\n}\n\n@keyframes lumiverse-lp-spin {\n  from { transform: rotate(0deg); }\n  to { transform: rotate(360deg); }\n}\n\n/* Main content area */\n.lumiverse-lp-main {\n  flex: 1;\n  overflow-y: auto;\n  overflow-x: hidden;\n  padding: 120px 4px 8px; /* Increased top padding for header overlap */\n  margin: 0; /* Removed negative margins */\n  width: 100%;\n  box-sizing: border-box;\n  scrollbar-width: thin;\n  scrollbar-color: rgba(147, 112, 219, 0.3) transparent;\n}\n\n.lumiverse-lp-main::-webkit-scrollbar {\n  width: 6px;\n}\n\n.lumiverse-lp-main::-webkit-scrollbar-track {\n  background: transparent;\n}\n\n.lumiverse-lp-main::-webkit-scrollbar-thumb {\n  background: rgba(147, 112, 219, 0.3);\n  border-radius: 3px;\n}\n\n.lumiverse-lp-main::-webkit-scrollbar-thumb:hover {\n  background: rgba(147, 112, 219, 0.5);\n}\n\n/* Card grid */\n.lumiverse-lp-grid-cards {\n  display: flex;\n  flex-wrap: wrap;\n  justify-content: center;\n  align-items: flex-start;\n  align-content: flex-start;\n  gap: 20px;\n  padding: 4px;\n  max-width: 1800px; /* Increased max-width for larger screens */\n  margin: 0 auto;\n  width: 100%;\n  box-sizing: border-box;\n}\n\n/* Glassmorphic Card */\n.lumiverse-lp-card {\n  position: relative;\n  display: flex;\n  flex-direction: column;\n  /* Use strict width calculated by JS for perfect alignment */\n  width: var(--lumiverse-card-width, 240px);\n  /* Ensure consistent height if content varies */\n  flex-shrink: 0;\n\n  background: linear-gradient(\n    165deg,\n    rgba(255, 255, 255, 0.08) 0%,\n    rgba(255, 255, 255, 0.03) 50%,\n    rgba(255, 255, 255, 0.02) 100%\n  );\n  border: 1px solid rgba(255, 255, 255, 0.1);\n  border-radius: 20px;\n  overflow: hidden;\n  cursor: pointer;\n  user-select: none;\n  -webkit-user-select: none;\n  backdrop-filter: blur(20px);\n  -webkit-backdrop-filter: blur(20px);\n  box-shadow:\n    0 4px 24px rgba(0, 0, 0, 0.2),\n    0 0 0 1px rgba(255, 255, 255, 0.02) inset;\n  transition: border-color 0.3s cubic-bezier(0.4, 0, 0.2, 1), box-shadow 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  /* Hardware acceleration to prevent flashing */\n  transform: translate3d(0, 0, 0);\n  backface-visibility: hidden;\n  -webkit-backface-visibility: hidden;\n  perspective: 1000px;\n}\n\n.lumiverse-lp-card:hover {\n  border-color: rgba(147, 112, 219, 0.4);\n  box-shadow:\n    0 12px 40px rgba(0, 0, 0, 0.3),\n    0 0 0 1px rgba(147, 112, 219, 0.15) inset,\n    0 0 60px rgba(147, 112, 219, 0.1);\n}\n\n/* Glass shimmer effect on hover */\n.lumiverse-lp-card-shimmer {\n  position: absolute;\n  inset: 0;\n  background: linear-gradient(\n    105deg,\n    transparent 0%,\n    transparent 40%,\n    rgba(255, 255, 255, 0.05) 50%,\n    transparent 60%,\n    transparent 100%\n  );\n  background-size: 200% 100%;\n  pointer-events: none;\n  opacity: 0;\n  transition: opacity 0.3s ease;\n}\n\n.lumiverse-lp-card:hover .lumiverse-lp-card-shimmer {\n  opacity: 1;\n  animation: lumiverse-lp-shimmer 1.5s ease-in-out infinite;\n}\n\n@keyframes lumiverse-lp-shimmer {\n  0% { background-position: 200% 0; }\n  100% { background-position: -200% 0; }\n}\n\n/* Card image container */\n.lumiverse-lp-card-image-container {\n  position: relative;\n  width: 100%;\n  aspect-ratio: 1 / 1;\n  background: linear-gradient(\n    135deg,\n    rgba(20, 16, 28, 0.6) 0%,\n    rgba(40, 32, 55, 0.4) 100%\n  );\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  overflow: hidden;\n}\n\n/* Glow behind avatar */\n.lumiverse-lp-card-glow {\n  position: absolute;\n  width: 70%;\n  height: 70%;\n  background: radial-gradient(\n    circle,\n    rgba(147, 112, 219, 0.3) 0%,\n    transparent 70%\n  );\n  opacity: 0;\n  transition: opacity 0.3s ease;\n  filter: blur(20px);\n}\n\n.lumiverse-lp-card:hover .lumiverse-lp-card-glow {\n  opacity: 1;\n}\n\n/* Avatar image */\n.lumiverse-lp-card-avatar {\n  width: 75%;\n  height: 75%;\n  max-width: 100%;\n  max-height: 100%;\n  object-fit: cover;\n  border-radius: 50%;\n  border: 3px solid rgba(255, 255, 255, 0.1);\n  box-shadow:\n    0 4px 20px rgba(0, 0, 0, 0.3),\n    0 0 0 1px rgba(255, 255, 255, 0.05);\n  transition: all 0.3s ease;\n  position: relative;\n  z-index: 1;\n  user-drag: none;\n  -webkit-user-drag: none;\n}\n\n.lumiverse-lp-card:hover .lumiverse-lp-card-avatar {\n  transform: scale(1.05);\n  border-color: rgba(147, 112, 219, 0.4);\n  box-shadow:\n    0 6px 30px rgba(0, 0, 0, 0.4),\n    0 0 30px rgba(147, 112, 219, 0.2);\n}\n\n/* Group avatar placeholder (legacy fallback) */\n.lumiverse-lp-card-avatar-group {\n  width: 75%;\n  height: 75%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: linear-gradient(\n    135deg,\n    rgba(100, 149, 237, 0.2) 0%,\n    rgba(147, 112, 219, 0.15) 100%\n  );\n  border-radius: 50%;\n  border: 3px solid rgba(255, 255, 255, 0.1);\n  color: rgba(186, 135, 255, 0.8);\n}\n\n/* Group image container variant - same aspect ratio as solo cards */\n.lumiverse-lp-card-image-container.lumiverse-lp-card-image-group {\n  background: linear-gradient(\n    135deg,\n    rgba(100, 149, 237, 0.08) 0%,\n    rgba(147, 112, 219, 0.05) 50%,\n    rgba(75, 85, 150, 0.1) 100%\n  );\n}\n\n/* Stacked Group Avatar System */\n.lumiverse-lp-group-stack {\n  position: relative;\n  width: 85%;\n  height: 85%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n/* Container sizing for 3-member layout - no transform here to keep spinner centered */\n.lumiverse-lp-group-stack:has(.lumiverse-lp-group-stack-avatars[data-count="3"]) {\n  width: 90%;\n  height: 90%;\n}\n\n.lumiverse-lp-group-stack-loading {\n  position: absolute;\n  inset: 0;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: rgba(147, 112, 219, 0.5);\n}\n\n.lumiverse-lp-group-stack-avatars {\n  position: relative;\n  width: 100%;\n  height: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: opacity 0.3s ease;\n}\n\n/* Shift only the avatars container for 3-member layout to visually center the cluster */\n.lumiverse-lp-group-stack-avatars[data-count="3"] {\n  transform: translateX(-22%);\n}\n\n/* Base avatar wrapper styles */\n.lumiverse-lp-group-avatar-wrapper {\n  position: absolute;\n  border-radius: 50%;\n  overflow: hidden;\n  box-shadow:\n    0 2px 12px rgba(0, 0, 0, 0.4),\n    0 0 0 2px rgba(255, 255, 255, 0.1);\n  transition: transform 0.3s ease, box-shadow 0.3s ease;\n}\n\n/* ===== 2 MEMBERS: Diagonal layout (top-left to bottom-right) ===== */\n.lumiverse-lp-group-stack-avatars[data-count="2"] .lumiverse-lp-group-avatar-wrapper {\n  width: 55%;\n  height: 55%;\n}\n\n.lumiverse-lp-group-stack-avatars[data-count="2"] .lumiverse-lp-group-avatar-wrapper:nth-child(1) {\n  top: 5%;\n  left: 5%;\n}\n\n.lumiverse-lp-group-stack-avatars[data-count="2"] .lumiverse-lp-group-avatar-wrapper:nth-child(2) {\n  bottom: 5%;\n  right: 5%;\n}\n\n/* ===== 3 MEMBERS: Tight cluster layout ===== */\n/* Avatars clustered near center with slight overlaps for cohesive group feel. */\n.lumiverse-lp-group-stack-avatars[data-count="3"] .lumiverse-lp-group-avatar-wrapper {\n  width: 44%;\n  height: 44%;\n}\n\n/* Top avatar: horizontally centered */\n.lumiverse-lp-group-stack-avatars[data-count="3"] .lumiverse-lp-group-avatar-wrapper:nth-child(1) {\n  top: 8%;\n  left: 50%;\n  transform: translateX(-50%);\n}\n\n/* Bottom-left: offset left from center */\n.lumiverse-lp-group-stack-avatars[data-count="3"] .lumiverse-lp-group-avatar-wrapper:nth-child(2) {\n  bottom: 8%;\n  left: calc(50% - 24%);\n  transform: translateX(-50%);\n}\n\n/* Bottom-right: offset right from center, mirror of bottom-left */\n.lumiverse-lp-group-stack-avatars[data-count="3"] .lumiverse-lp-group-avatar-wrapper:nth-child(3) {\n  bottom: 8%;\n  left: calc(50% + 24%);\n  transform: translateX(-50%);\n}\n\n/* ===== 4 MEMBERS: Square grid layout ===== */\n.lumiverse-lp-group-stack-avatars[data-count="4"] .lumiverse-lp-group-avatar-wrapper {\n  width: 46%;\n  height: 46%;\n}\n\n.lumiverse-lp-group-stack-avatars[data-count="4"] .lumiverse-lp-group-avatar-wrapper:nth-child(1) {\n  top: 2%;\n  left: 2%;\n}\n\n.lumiverse-lp-group-stack-avatars[data-count="4"] .lumiverse-lp-group-avatar-wrapper:nth-child(2) {\n  top: 2%;\n  right: 2%;\n}\n\n.lumiverse-lp-group-stack-avatars[data-count="4"] .lumiverse-lp-group-avatar-wrapper:nth-child(3) {\n  bottom: 2%;\n  left: 2%;\n}\n\n.lumiverse-lp-group-stack-avatars[data-count="4"] .lumiverse-lp-group-avatar-wrapper:nth-child(4) {\n  bottom: 2%;\n  right: 2%;\n}\n\n/* ===== 5+ MEMBERS: Square grid with overflow indicator ===== */\n.lumiverse-lp-group-stack-avatars[data-count="5+"] .lumiverse-lp-group-avatar-wrapper {\n  width: 46%;\n  height: 46%;\n}\n\n.lumiverse-lp-group-stack-avatars[data-count="5+"] .lumiverse-lp-group-avatar-wrapper:nth-child(1) {\n  top: 2%;\n  left: 2%;\n}\n\n.lumiverse-lp-group-stack-avatars[data-count="5+"] .lumiverse-lp-group-avatar-wrapper:nth-child(2) {\n  top: 2%;\n  right: 2%;\n}\n\n.lumiverse-lp-group-stack-avatars[data-count="5+"] .lumiverse-lp-group-avatar-wrapper:nth-child(3) {\n  bottom: 2%;\n  left: 2%;\n}\n\n/* Overflow indicator (+N more) - matches 4-member grid sizing */\n.lumiverse-lp-group-avatar-overflow {\n  position: absolute;\n  width: 46%;\n  height: 46%;\n  bottom: 2%;\n  right: 2%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: linear-gradient(\n    135deg,\n    rgba(100, 149, 237, 0.85) 0%,\n    rgba(147, 112, 219, 0.9) 100%\n  );\n  border-radius: 50%;\n  border: 2px solid rgba(255, 255, 255, 0.15);\n  backdrop-filter: blur(4px);\n  box-shadow:\n    0 2px 12px rgba(0, 0, 0, 0.4),\n    0 0 20px rgba(100, 149, 237, 0.3);\n  font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", sans-serif;\n  font-size: 14px;\n  font-weight: 700;\n  color: white;\n  letter-spacing: -0.3px;\n  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);\n}\n\n.lumiverse-lp-group-avatar-img {\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n  user-drag: none;\n  -webkit-user-drag: none;\n}\n\n/* Hover effects for group cards */\n.lumiverse-lp-card:hover .lumiverse-lp-group-avatar-wrapper {\n  box-shadow:\n    0 4px 16px rgba(0, 0, 0, 0.5),\n    0 0 0 2px rgba(147, 112, 219, 0.4),\n    0 0 20px rgba(147, 112, 219, 0.15);\n}\n\n.lumiverse-lp-card:hover .lumiverse-lp-group-avatar-wrapper:nth-child(1) {\n  transform: translate(-2px, -2px);\n}\n\n.lumiverse-lp-card:hover .lumiverse-lp-group-avatar-wrapper:nth-child(2) {\n  transform: translate(2px, -2px);\n}\n\n.lumiverse-lp-card:hover .lumiverse-lp-group-avatar-wrapper:nth-child(3) {\n  transform: translate(-2px, 2px);\n}\n\n.lumiverse-lp-card:hover .lumiverse-lp-group-avatar-wrapper:nth-child(4) {\n  transform: translate(2px, 2px);\n}\n\n/* Adjust hover transforms for 2-member layout */\n.lumiverse-lp-card:hover .lumiverse-lp-group-stack-avatars:has(.lumiverse-lp-group-avatar-wrapper:nth-child(2):last-child) .lumiverse-lp-group-avatar-wrapper:nth-child(1) {\n  transform: translate(-3px, -50%);\n}\n\n.lumiverse-lp-card:hover .lumiverse-lp-group-stack-avatars:has(.lumiverse-lp-group-avatar-wrapper:nth-child(2):last-child) .lumiverse-lp-group-avatar-wrapper:nth-child(2) {\n  transform: translate(3px, -50%);\n}\n\n/* Adjust hover transforms for 3-member layout - spread cluster apart */\n.lumiverse-lp-card:hover .lumiverse-lp-group-stack-avatars:has(.lumiverse-lp-group-avatar-wrapper:nth-child(3):last-child) .lumiverse-lp-group-avatar-wrapper:nth-child(1) {\n  transform: translateX(-50%) translateY(-4px);\n}\n\n.lumiverse-lp-card:hover .lumiverse-lp-group-stack-avatars:has(.lumiverse-lp-group-avatar-wrapper:nth-child(3):last-child) .lumiverse-lp-group-avatar-wrapper:nth-child(2) {\n  transform: translateX(-50%) translate(-4px, 4px);\n}\n\n.lumiverse-lp-card:hover .lumiverse-lp-group-stack-avatars:has(.lumiverse-lp-group-avatar-wrapper:nth-child(3):last-child) .lumiverse-lp-group-avatar-wrapper:nth-child(3) {\n  transform: translateX(-50%) translate(4px, 4px);\n}\n\n.lumiverse-lp-card:hover .lumiverse-lp-group-avatar-overflow {\n  box-shadow:\n    0 4px 16px rgba(0, 0, 0, 0.5),\n    0 0 30px rgba(100, 149, 237, 0.4);\n}\n\n/* Time badge */\n.lumiverse-lp-card-time-badge {\n  position: absolute;\n  bottom: 10px;\n  right: 10px;\n  z-index: 10;\n  display: flex;\n  align-items: center;\n  gap: 4px;\n  padding: 4px 10px;\n  background: rgba(0, 0, 0, 0.5);\n  backdrop-filter: blur(8px);\n  -webkit-backdrop-filter: blur(8px);\n  border-radius: 12px;\n  border: 1px solid rgba(255, 255, 255, 0.1);\n  font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", sans-serif;\n  font-size: 11px;\n  font-weight: 500;\n  color: rgba(255, 255, 255, 0.7);\n}\n\n.lumiverse-lp-card-time-badge svg {\n  width: 10px;\n  height: 10px;\n  stroke: rgba(255, 255, 255, 0.6);\n}\n\n/* Delete button - positioned top-right corner of card */\n.lumiverse-lp-card-delete-btn {\n  position: absolute;\n  top: 10px;\n  right: 10px;\n  z-index: 20;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 36px;\n  height: 36px;\n  padding: 0;\n  border-radius: 12px;\n  background: rgba(30, 30, 40, 0.85);\n  backdrop-filter: blur(12px);\n  -webkit-backdrop-filter: blur(12px);\n  border: 1px solid rgba(255, 255, 255, 0.15);\n  color: rgba(255, 255, 255, 0.85);\n  cursor: pointer;\n  /* Only transition color properties - let Framer Motion handle transform/opacity */\n  transition: background 0.2s ease, border-color 0.2s ease, color 0.2s ease, box-shadow 0.2s ease;\n  box-shadow:\n    0 4px 12px rgba(0, 0, 0, 0.3),\n    0 0 0 1px rgba(0, 0, 0, 0.1);\n}\n\n.lumiverse-lp-card-delete-btn:hover {\n  background: rgba(220, 53, 69, 0.9);\n  border-color: rgba(255, 100, 100, 0.5);\n  color: white;\n  box-shadow:\n    0 6px 20px rgba(220, 53, 69, 0.4),\n    0 0 30px rgba(220, 53, 69, 0.2);\n}\n\n.lumiverse-lp-card-delete-btn svg {\n  width: 16px;\n  height: 16px;\n  flex-shrink: 0;\n}\n\n/* Confirming state - pulsing warning appearance */\n.lumiverse-lp-card-delete-btn--confirming {\n  background: rgba(220, 53, 69, 0.9);\n  border-color: rgba(255, 100, 100, 0.6);\n  color: white;\n  animation: lumiverse-lp-delete-pulse 0.6s ease-in-out infinite alternate;\n  box-shadow:\n    0 4px 16px rgba(220, 53, 69, 0.4),\n    0 0 24px rgba(220, 53, 69, 0.2);\n}\n\n.lumiverse-lp-card-delete-btn--confirming:hover {\n  background: rgba(200, 35, 51, 0.95);\n  animation: none;\n}\n\n/* Pulse animation - only animates box-shadow to avoid transform conflicts */\n@keyframes lumiverse-lp-delete-pulse {\n  0% {\n    box-shadow:\n      0 4px 16px rgba(220, 53, 69, 0.4),\n      0 0 24px rgba(220, 53, 69, 0.2);\n  }\n  100% {\n    box-shadow:\n      0 6px 24px rgba(220, 53, 69, 0.6),\n      0 0 40px rgba(220, 53, 69, 0.35);\n  }\n}\n\n/* Card content */\n.lumiverse-lp-card-content {\n  padding: 16px;\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n  background: linear-gradient(\n    180deg,\n    transparent 0%,\n    rgba(0, 0, 0, 0.2) 100%\n  );\n}\n\n.lumiverse-lp-card-name {\n  font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", sans-serif;\n  font-size: 15px;\n  font-weight: 600;\n  color: rgba(255, 255, 255, 0.95);\n  margin: 0;\n  letter-spacing: -0.2px;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n.lumiverse-lp-card-meta {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 6px;\n  min-height: 22px; /* Ensure consistent height whether badges present or not */\n}\n\n.lumiverse-lp-card-badge {\n  display: inline-flex;\n  align-items: center;\n  gap: 4px;\n  padding: 3px 8px;\n  border-radius: 6px;\n  font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", sans-serif;\n  font-size: 10px;\n  font-weight: 600;\n  text-transform: uppercase;\n  letter-spacing: 0.3px;\n}\n\n.lumiverse-lp-card-badge svg {\n  width: 10px;\n  height: 10px;\n}\n\n.lumiverse-lp-card-badge-preset {\n  background: rgba(147, 112, 219, 0.2);\n  border: 1px solid rgba(147, 112, 219, 0.35);\n  color: rgba(186, 135, 255, 0.95);\n}\n\n.lumiverse-lp-card-badge-group {\n  background: rgba(100, 149, 237, 0.2);\n  border: 1px solid rgba(100, 149, 237, 0.35);\n  color: rgba(135, 180, 247, 0.95);\n}\n\n/* Bottom indicator line */\n.lumiverse-lp-card-indicator {\n  position: absolute;\n  bottom: 0;\n  left: 10%;\n  right: 10%;\n  height: 2px;\n  background: linear-gradient(\n    90deg,\n    transparent 0%,\n    rgba(147, 112, 219, 0.6) 50%,\n    transparent 100%\n  );\n  border-radius: 1px;\n  transform-origin: center;\n}\n\n/* Skeleton loading */\n.lumiverse-lp-skeleton {\n  pointer-events: none;\n}\n\n.lumiverse-lp-skeleton-image {\n  width: 100%;\n  aspect-ratio: 1 / 1;\n  background: linear-gradient(\n    90deg,\n    rgba(147, 112, 219, 0.08) 0%,\n    rgba(147, 112, 219, 0.15) 50%,\n    rgba(147, 112, 219, 0.08) 100%\n  );\n  background-size: 200% 100%;\n  animation: lumia-skeleton-shimmer 1.5s ease-in-out infinite;\n}\n\n.lumiverse-lp-skeleton-content {\n  padding: 16px;\n  display: flex;\n  flex-direction: column;\n  gap: 10px;\n}\n\n.lumiverse-lp-skeleton-line {\n  height: 12px;\n  background: linear-gradient(\n    90deg,\n    rgba(147, 112, 219, 0.08) 0%,\n    rgba(147, 112, 219, 0.15) 50%,\n    rgba(147, 112, 219, 0.08) 100%\n  );\n  background-size: 200% 100%;\n  animation: lumia-skeleton-shimmer 1.5s ease-in-out infinite;\n  border-radius: 4px;\n}\n\n.lumiverse-lp-skeleton-title {\n  width: 70%;\n}\n\n.lumiverse-lp-skeleton-meta {\n  width: 40%;\n}\n\n@keyframes lumia-skeleton-shimmer {\n  0% { background-position: 200% 0; }\n  100% { background-position: -200% 0; }\n}\n\n/* Empty state */\n.lumiverse-lp-empty {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 80px 20px;\n  text-align: center;\n}\n\n.lumiverse-lp-empty-icon {\n  width: 100px;\n  height: 100px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: linear-gradient(\n    135deg,\n    rgba(147, 112, 219, 0.15) 0%,\n    rgba(100, 149, 237, 0.1) 100%\n  );\n  border: 1px solid rgba(147, 112, 219, 0.25);\n  border-radius: 50%;\n  margin-bottom: 24px;\n  color: rgba(147, 112, 219, 0.6);\n}\n\n.lumiverse-lp-empty-icon svg {\n  width: 48px;\n  height: 48px;\n  stroke: rgba(147, 112, 219, 0.8);\n}\n\n.lumiverse-lp-empty h3 {\n  font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", sans-serif;\n  font-size: 24px;\n  font-weight: 600;\n  color: rgba(255, 255, 255, 0.9);\n  margin: 0 0 8px 0;\n  letter-spacing: -0.3px;\n}\n\n.lumiverse-lp-empty p {\n  font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", sans-serif;\n  font-size: 14px;\n  color: rgba(255, 255, 255, 0.5);\n  max-width: 320px;\n  line-height: 1.5;\n}\n\n/* Error state */\n.lumiverse-lp-error {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 80px 20px;\n  text-align: center;\n}\n\n.lumiverse-lp-error p {\n  font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", sans-serif;\n  font-size: 16px;\n  color: rgba(244, 67, 54, 0.8);\n  margin-bottom: 16px;\n}\n\n/* Footer */\n.lumiverse-lp-footer {\n  flex-shrink: 0;\n  padding-top: 16px;\n  text-align: center;\n}\n\n.lumiverse-lp-footer p {\n  font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", sans-serif;\n  font-size: 12px;\n  color: rgba(255, 255, 255, 0.35);\n  letter-spacing: 0.3px;\n}\n\n/* Mobile responsiveness */\n@media (max-width: 1024px) {\n  .lumiverse-lp-grid-cards {\n    gap: 16px;\n    /* On tablets, Flexbox logic still applies but with smaller gap */\n  }\n}\n\n@media (max-width: 768px) {\n  .lumiverse-lp-content {\n    padding: 16px 20px;\n  }\n\n  .lumiverse-lp-header {\n    flex-direction: column;\n    gap: 16px;\n    align-items: flex-start;\n    padding: 32px 20px 40px; /* Match content padding */\n  }\n\n  .lumiverse-lp-main {\n    padding-top: 180px; /* Increased for taller header on mobile */\n  }\n\n  .lumiverse-lp-header-right {\n    width: 100%;\n    justify-content: flex-end;\n  }\n\n  .lumiverse-lp-logo-icon {\n    width: 40px;\n    height: 40px;\n  }\n\n  .lumiverse-lp-logo-text h1 {\n    font-size: 20px;\n  }\n\n  .lumiverse-lp-grid-cards {\n    /* Switch back to Grid for small screens where 2-column layout is standard */\n    display: grid;\n    grid-template-columns: repeat(2, 1fr);\n    gap: 12px;\n  }\n\n  .lumiverse-lp-card {\n    border-radius: 16px;\n    /* Reset fixed width for grid layout */\n    width: auto;\n    flex-shrink: 1;\n  }\n\n  .lumiverse-lp-card-content {\n    padding: 12px;\n  }\n\n  .lumiverse-lp-card-name {\n    font-size: 14px;\n  }\n\n  .lumiverse-lp-card-time-badge {\n    font-size: 10px;\n    padding: 3px 8px;\n  }\n\n  /* Delete button on tablet */\n  .lumiverse-lp-card-delete-btn {\n    width: 32px;\n    height: 32px;\n    border-radius: 10px;\n  }\n\n  .lumiverse-lp-card-delete-btn svg {\n    width: 14px;\n    height: 14px;\n  }\n\n  /* Tablet: ensure overflow bubble matches avatar size */\n  .lumiverse-lp-group-avatar-overflow {\n    font-size: 13px;\n  }\n}\n\n@media (max-width: 480px) {\n  .lumiverse-lp-grid-cards {\n    /* Keep grid layout */\n    grid-template-columns: repeat(2, 1fr);\n    gap: 10px;\n  }\n  \n  .lumiverse-lp-card {\n    border-radius: 14px;\n  }\n\n  .lumiverse-lp-card-content {\n    padding: 10px;\n  }\n\n  .lumiverse-lp-card-name {\n    font-size: 13px;\n  }\n\n  .lumiverse-lp-card-badge {\n    font-size: 9px;\n    padding: 2px 6px;\n  }\n\n  /* Delete button on mobile */\n  .lumiverse-lp-card-delete-btn {\n    width: 30px;\n    height: 30px;\n    top: 8px;\n    right: 8px;\n    border-radius: 10px;\n  }\n\n  .lumiverse-lp-card-delete-btn svg {\n    width: 14px;\n    height: 14px;\n  }\n\n  /* Group avatar sizing on mobile - keep proportions consistent */\n  .lumiverse-lp-group-stack-avatars[data-count="5+"] .lumiverse-lp-group-avatar-wrapper,\n  .lumiverse-lp-group-stack-avatars[data-count="4"] .lumiverse-lp-group-avatar-wrapper {\n    width: 44%;\n    height: 44%;\n  }\n\n  /* Overflow bubble (+N) matches avatar size for visual consistency */\n  .lumiverse-lp-group-avatar-overflow {\n    width: 44%;\n    height: 44%;\n    font-size: 12px;\n    /* Slightly boost visibility on smaller screens */\n    border-width: 2px;\n  }\n}\n\n/* Reduced motion */\n@media (prefers-reduced-motion: reduce) {\n  .lumiverse-lp-bg-glow {\n    animation: none;\n  }\n\n  .lumiverse-lp-card,\n  .lumiverse-lp-card-avatar,\n  .lumiverse-lp-card-glow,\n  .lumiverse-lp-btn,\n  .lumiverse-lp-group-avatar-wrapper,\n  .lumiverse-lp-card-delete-btn {\n    transition: none;\n  }\n\n  .lumiverse-lp-card-shimmer {\n    display: none;\n  }\n\n  .lumiverse-lp-skeleton-image,\n  .lumiverse-lp-skeleton-line {\n    animation: none;\n  }\n\n  /* Disable hover transforms for group avatars */\n  .lumiverse-lp-card:hover .lumiverse-lp-group-avatar-wrapper {\n    transform: none;\n  }\n\n  /* Disable delete button pulse animation */\n  .lumiverse-lp-card-delete-btn--confirming {\n    animation: none;\n  }\n}\n\n/* Version Info - Subtle bottom-right corner display */\n.lumiverse-lp-version-info {\n  position: fixed;\n  bottom: 16px;\n  right: 20px;\n  z-index: 50;\n  display: flex;\n  flex-direction: column;\n  align-items: flex-end;\n  gap: 4px;\n  padding: 10px 14px;\n  background: rgba(15, 12, 22, 0.65);\n  backdrop-filter: blur(12px);\n  -webkit-backdrop-filter: blur(12px);\n  border: 1px solid rgba(255, 255, 255, 0.06);\n  border-radius: 10px;\n  box-shadow:\n    0 2px 12px rgba(0, 0, 0, 0.2),\n    inset 0 1px 0 rgba(255, 255, 255, 0.03);\n  pointer-events: auto;\n  user-select: none;\n  -webkit-user-select: none;\n  cursor: pointer;\n  transition: border-color 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;\n}\n\n.lumiverse-lp-version-info:hover {\n  border-color: rgba(147, 112, 219, 0.25);\n  background: rgba(20, 16, 28, 0.75);\n  box-shadow:\n    0 4px 16px rgba(0, 0, 0, 0.25),\n    inset 0 1px 0 rgba(255, 255, 255, 0.05);\n}\n\n.lumiverse-lp-version-info:active {\n  transform: scale(0.98);\n}\n\n/* Copied state - brief flash */\n.lumiverse-lp-version-info--copied {\n  border-color: rgba(147, 112, 219, 0.5) !important;\n  box-shadow:\n    0 4px 20px rgba(147, 112, 219, 0.2),\n    inset 0 1px 0 rgba(255, 255, 255, 0.08) !important;\n}\n\n/* Copied overlay indicator */\n.lumiverse-lp-version-copied {\n  position: absolute;\n  inset: 0;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: rgba(147, 112, 219, 0.15);\n  border-radius: 9px;\n  font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", sans-serif;\n  font-size: 11px;\n  font-weight: 600;\n  color: rgba(186, 135, 255, 0.95);\n  letter-spacing: 0.3px;\n  text-transform: uppercase;\n}\n\n.lumiverse-lp-version-row {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", sans-serif;\n}\n\n.lumiverse-lp-version-label {\n  font-size: 10px;\n  font-weight: 500;\n  color: rgba(255, 255, 255, 0.35);\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n}\n\n.lumiverse-lp-version-value {\n  font-size: 11px;\n  font-weight: 600;\n  color: rgba(255, 255, 255, 0.5);\n  font-variant-numeric: tabular-nums;\n  letter-spacing: -0.2px;\n  display: inline-flex;\n  align-items: center;\n  gap: 6px;\n}\n\n/* Git branch and commit info */\n.lumiverse-lp-version-git {\n  font-size: 10px;\n  font-weight: 500;\n  color: rgba(255, 255, 255, 0.3);\n  padding-left: 6px;\n  border-left: 1px solid rgba(255, 255, 255, 0.1);\n}\n\n.lumiverse-lp-version-commit {\n  color: rgba(147, 112, 219, 0.5);\n  font-family: "SF Mono", "Fira Code", "Consolas", monospace;\n  font-size: 9px;\n  margin-left: 3px;\n}\n\n/* Beta/prerelease version styling - subtle accent */\n.lumiverse-lp-version-beta {\n  color: rgba(186, 135, 255, 0.7);\n  position: relative;\n}\n\n.lumiverse-lp-version-beta::after {\n  content: "";\n  position: absolute;\n  bottom: -2px;\n  left: 0;\n  right: 0;\n  height: 1px;\n  background: linear-gradient(\n    90deg,\n    transparent 0%,\n    rgba(186, 135, 255, 0.4) 50%,\n    transparent 100%\n  );\n}\n\n/* Mobile responsiveness for version info */\n@media (max-width: 768px) {\n  .lumiverse-lp-version-info {\n    bottom: 12px;\n    right: 12px;\n    padding: 8px 12px;\n    gap: 3px;\n  }\n\n  .lumiverse-lp-version-label {\n    font-size: 9px;\n  }\n\n  .lumiverse-lp-version-value {\n    font-size: 10px;\n  }\n}\n\n@media (max-width: 480px) {\n  .lumiverse-lp-version-info {\n    bottom: 10px;\n    right: 10px;\n    padding: 6px 10px;\n  }\n}\n\n/* Reduced motion - disable version fade-in animation */\n@media (prefers-reduced-motion: reduce) {\n  .lumiverse-lp-version-info {\n    opacity: 1 !important;\n  }\n}\n';var B=t(674),_=t(154),F=t(932),U=t(485),H=t(389),W=t(438),V=t(28),q=t(100),Y=t(693),G=t(199),K=t(200),Q=t(699);function X(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function Z(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?X(Object(t),!0).forEach(function(n){J(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):X(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function J(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const ee="openai";const ne=new class{constructor(){this.context=(0,r.SD)()}getManager(){var e;return this.context||(this.context=(0,r.SD)()),null===(e=this.context)||void 0===e?void 0:e.getPresetManager(ee)}getCurrentPreset(){const e=this.getManager();if(!e)return console.warn("[ChatPresetService] Manager not found for API_ID:",ee),null;const n=e.getSelectedPresetName();console.log("[ChatPresetService] Active preset name:",n);let t=null;{const n=e.getPresetList();n&&n.settings&&(console.log("[ChatPresetService] Using getPresetList().settings for OpenAI"),t=n.settings)}if(t||(t=e.getPresetSettings(n)),console.log("[ChatPresetService] Raw settings found:",!!t,t?Object.keys(t):"null"),!t)return null;Array.isArray(t.prompts)||(console.warn("[ChatPresetService] Prompts array missing or invalid in settings, defaulting to empty"),t.prompts=[]);try{return{name:n,settings:structuredClone(t)}}catch(e){return console.error("[ChatPresetService] structuredClone failed:",e),{name:n,settings:Z(Z({},t),{},{prompts:t.prompts.map(e=>Z({},e))})}}}getAvailablePresets(){const e=this.getManager();if(!e)return[];if("function"==typeof e.getAllPresets)return e.getAllPresets();const n=e.getPresetList();return n&&n.preset_names?Array.isArray(n.preset_names)?n.preset_names:Object.keys(n.preset_names):[]}async selectPreset(e){const n=this.getManager();if(!n)return!1;const t=n.findPreset(e);return!!t&&(n.selectPreset(t),!0)}exportPreset(e){const n=this.getCurrentPreset();if(!n||!n.settings)return null;if(!e||e===n.name)return JSON.stringify(n.settings,null,4);const t=this.getManager().getCompletionPresetByName(e);return t?JSON.stringify(t,null,4):null}async createPreset(e,n){const t=this.getManager();return!!t&&(await t.savePreset(e,n),!0)}async deletePreset(e){const n=this.getManager();return!!n&&(await n.deletePreset(e),!0)}async savePreset(e,n){const t=this.getManager();if(!t)return!1;try{return await t.savePreset(e,n),!0}catch(e){return console.error("Failed to save preset:",e),!1}}async updatePrompts(e){const n=this.getCurrentPreset();if(!n)return!1;const{name:t,settings:r}=n;return r.prompts=e,await this.savePreset(t,r)}getToggleStateNames(){return(0,Q.or)()}getToggleStateRegistry(){return(0,Q.JL)()}async saveToggleState(e,n){const t=this.getCurrentPreset(),r=(null==t?void 0:t.name)||null,i={};for(const e of n){const n=e.identifier||e.name;n&&(i[n]=!1!==e.enabled)}await(0,Q.Bl)(e,i,r),console.log('[ChatPresetService] Saved toggle state "'.concat(e,'" with ').concat(Object.keys(i).length," prompts"))}async loadToggleState(e){return await(0,Q.SS)(e)}async applyToggleState(e,n){const t=await(0,Q.SS)(e);if(null==t||!t.toggles)return{prompts:n,matched:0,unmatched:0};let r=0,i=0;const o=n.map(e=>{const n=e.identifier||e.name;return n&&n in t.toggles?(r++,Z(Z({},e),{},{enabled:t.toggles[n]})):(i++,e)});return console.log('[ChatPresetService] Applied toggle state "'.concat(e,'": ').concat(r," matched, ").concat(i," unmatched")),{prompts:o,matched:r,unmatched:i}}async deleteToggleState(e){await(0,Q.Im)(e),console.log('[ChatPresetService] Deleted toggle state "'.concat(e,'"'))}getCurrentChatId(){var e;const n=(0,r.SD)();if(!n)return null;if("function"==typeof n.getCurrentChatId)return n.getCurrentChatId();var t;if(n.groupId)return(null===(t=n.groups)||void 0===t||null===(t=t.find(e=>e.id===n.groupId))||void 0===t?void 0:t.chat_id)||null;const i=null===(e=n.characters)||void 0===e?void 0:e[n.characterId];return(null==i?void 0:i.chat)||null}async saveToggleStateToChat(e){var n;const t=this.getCurrentChatId();if(!t)return console.warn("[ChatPresetService] No chat ID available"),!1;const r={};for(const n of e){const e=n.identifier||n.name;e&&(r[e]=!1!==n.enabled)}return await(0,Q.setChatToggleBinding)(t,{toggles:r,sourcePreset:(null===(n=this.getCurrentPreset())||void 0===n?void 0:n.name)||null}),console.log('[ChatPresetService] Saved toggle state to chat "'.concat(t,'" with ').concat(Object.keys(r).length," prompts")),!0}getChatToggleState(){const e=this.getCurrentChatId();return e?(0,Q.Y0)(e):null}async clearChatToggleState(){const e=this.getCurrentChatId();return!!e&&(await(0,Q.LP)(e),console.log('[ChatPresetService] Cleared toggle state for chat "'.concat(e,'"')),!0)}hasChatToggleState(){return null!==this.getChatToggleState()}getCurrentCharacterAvatar(){var e;const n=(0,r.SD)();return n&&void 0!==n.characterId&&null!==n.characterId&&(null===(e=n.characters)||void 0===e||null===(e=e[n.characterId])||void 0===e?void 0:e.avatar)||null}async saveToggleStateToCharacter(e){var n;const t=this.getCurrentCharacterAvatar();if(!t)return console.warn("[ChatPresetService] No character avatar available"),!1;const r={};for(const n of e){const e=n.identifier||n.name;e&&(r[e]=!1!==n.enabled)}return await(0,Q.setCharacterToggleBinding)(t,{toggles:r,sourcePreset:(null===(n=this.getCurrentPreset())||void 0===n?void 0:n.name)||null}),console.log('[ChatPresetService] Saved toggle state for character "'.concat(t,'" with ').concat(Object.keys(r).length," prompts")),!0}getCharacterToggleState(){const e=this.getCurrentCharacterAvatar();return e?(0,Q.jm)(e):null}getCharacterToggleStateByAvatar(e){return e?(0,Q.jm)(e):null}async clearCharacterToggleState(){const e=this.getCurrentCharacterAvatar();return!!e&&(await(0,Q.az)(e),console.log('[ChatPresetService] Cleared toggle state for character "'.concat(e,'"')),!0)}hasCharacterToggleState(){return null!==this.getCharacterToggleState()}applyToggleData(e,n){if(null==e||!e.toggles)return{prompts:n,matched:0,unmatched:0};let t=0,r=0;const i=n.map(n=>{const i=n.identifier||n.name;return i&&i in e.toggles?(t++,Z(Z({},n),{},{enabled:e.toggles[i]})):(r++,n)});return{prompts:i,matched:t,unmatched:r}}getActivePromptOrderCharacterId(){var e;const n=(0,r.SD)(),t=null==n?void 0:n.chatCompletionSettings;if(!t)return console.warn("[ChatPresetService] chatCompletionSettings not available"),null;const i=!(null!==(e=t.prompt_manager_settings)&&void 0!==e&&e.showCharacterPromptOrder);return{activeCharId:i?100001:null==n?void 0:n.characterId,isGlobal:i}}getActivePromptOrderEntry(){const e=(0,r.SD)(),n=null==e?void 0:e.chatCompletionSettings;if(null==n||!n.prompt_order)return null;const t=this.getActivePromptOrderCharacterId();return t?n.prompt_order.find(e=>e.character_id===t.activeCharId):null}setPromptEnabled(e,n){const t=this.getActivePromptOrderEntry();if(null==t||!t.order)return console.warn("[ChatPresetService] No prompt_order entry found"),!1;const r=t.order.find(n=>n.identifier===e);return r?(r.enabled=n,!0):(console.warn('[ChatPresetService] Prompt "'.concat(e,'" not found in prompt_order')),!1)}applyTogglesToPromptOrder(e){if(!e||"object"!=typeof e)return{matched:0,unmatched:0};const n=this.getActivePromptOrderEntry();if(null==n||!n.order)return console.warn("[ChatPresetService] No prompt_order entry found"),{matched:0,unmatched:0};let t=0,r=0;for(const[i,o]of Object.entries(e)){const e=n.order.find(e=>e.identifier===i);e?(e.enabled=o,t++):r++}return{matched:t,unmatched:r}}refreshPromptManagerUI(){const e=(0,r.SD)();"function"==typeof(null==e?void 0:e.saveSettingsDebounced)&&e.saveSettingsDebounced()}resetPromptsToDefault(){var e;const n=this.getCurrentPreset();if(null==n||null===(e=n.settings)||void 0===e||!e.prompts)return console.warn("[ChatPresetService] Cannot reset - no current preset or prompts"),!1;const t=this.getActivePromptOrderEntry();if(null==t||!t.order)return console.warn("[ChatPresetService] Cannot reset - no prompt_order entry"),!1;const r={};for(const e of n.settings.prompts){const n=e.identifier||e.name;n&&(r[n]=!1!==e.enabled)}let i=0;for(const e of t.order)e.identifier&&e.identifier in r&&(e.enabled=r[e.identifier],i++);return console.log("[ChatPresetService] Reset ".concat(i," prompts to default enabled states")),i>0}async applyToggleStateToRuntime(e){const n=await(0,Q.SS)(e);if(null==n||!n.toggles)return{applied:!1,matched:0,unmatched:0};const t=this.applyTogglesToPromptOrder(n.toggles);return t.matched>0?(this.refreshPromptManagerUI(),console.log('[ChatPresetService] Applied toggle state "'.concat(e,'" to runtime: ').concat(t.matched," matched, ").concat(t.unmatched," unmatched")),Z({applied:!0},t)):Z({applied:!1},t)}captureCurrentToggles(){const e=this.getActivePromptOrderEntry();if(null==e||!e.order)return null;const n={};for(const t of e.order)t.identifier&&(n[t.identifier]=!1!==t.enabled);return n}},te="PresetBindingService";let re=null,ie=!1,oe=null,ae=!1;function se(){var e;const n=(0,Q.getCachedIndex)();return(null==n||null===(e=n.selections)||void 0===e?void 0:e.presetBindings)||{characters:{},chats:{}}}function le(e){(0,Q.Xy)({presetBindings:e}),oe&&oe(e)}function ce(e,n){if(!e)return void console.warn("[".concat(te,"] Cannot set binding: no avatar name provided"));const t=se();n?(t.characters[e]=n,console.log("[".concat(te,'] Bound character "').concat(e,'" to preset "').concat(n,'"'))):(delete t.characters[e],console.log("[".concat(te,'] Removed binding for character "').concat(e,'"'))),le(t)}function ue(e,n){if(!e)return void console.warn("[".concat(te,"] Cannot set binding: no chat ID provided"));const t=se();n?(t.chats[e]=n,console.log("[".concat(te,'] Bound chat "').concat(e,'" to preset "').concat(n,'"'))):(delete t.chats[e],console.log("[".concat(te,'] Removed binding for chat "').concat(e,'"'))),le(t)}function de(e){if(!e)return null;return se().characters[e]||null}function me(e){if(!e)return null;return se().chats[e]||null}function pe(){var e;const n=(0,r.SD)();return n&&void 0!==n.characterId&&null!==n.characterId&&(null===(e=n.characters)||void 0===e||null===(e=e[n.characterId])||void 0===e?void 0:e.avatar)||null}function ge(){var e;const n=(0,r.SD)();if(!n)return null;if("function"==typeof n.getCurrentChatId)return n.getCurrentChatId();var t;if(n.groupId)return(null===(t=n.groups)||void 0===t||null===(t=t.find(e=>e.id===n.groupId))||void 0===t?void 0:t.chat_id)||null;const i=null===(e=n.characters)||void 0===e?void 0:e[n.characterId];return(null==i?void 0:i.chat)||null}function he(){const e=ge(),n=pe();if(e){const n=me(e);if(n)return{presetName:n,bindingType:"chat",bindingId:e}}if(n){const e=de(n);if(e)return{presetName:e,bindingType:"character",bindingId:n}}return{presetName:null,bindingType:null,bindingId:null}}function ve(){const e=(0,B.getSettings)();return null!==e.capturedDefaultToggles&&Object.keys(e.capturedDefaultToggles).length>0}async function fe(){if(ie)return console.log("[".concat(te,"] Already switching, skipping...")),!1;const e=function(){const e=ge(),n=pe(),t=!!he().presetName;let r=!1;if(e){const n=(0,Q.Y0)(e);null!=n&&n.toggles&&Object.keys(n.toggles).length>0&&(r=!0)}if(!r&&n){const e=(0,Q.jm)(n);null!=e&&e.toggles&&Object.keys(e.toggles).length>0&&(r=!0)}return{hasPresetBinding:t,hasToggleBinding:r,chatId:e,avatar:n}}();if(!e.hasPresetBinding&&!e.hasToggleBinding){re=null;if((0,B.getSettings)().disableDefaultStateRestore)return console.log("[".concat(te,"] No bindings for current context - default state restoration is disabled, skipping")),!1;if(!ve())return console.log("[".concat(te,"] No bindings for current context and no defaults captured - leaving preset state untouched")),!1;if(ae&&function(){const e=(0,B.getSettings)().capturedDefaultToggles;if(!e)return!1;const n=ne.captureCurrentToggles();if(!n)return!1;const t=Object.keys(e),r=Object.keys(n);if(t.length!==r.length)return!1;for(const r of t)if(n[r]!==e[r])return!1;return!0}())return console.log("[".concat(te,"] No bindings for current context - already on defaults, skipping")),!1;console.log("[".concat(te,"] No bindings for current context - restoring default toggle state"));const e=function(){var e;const n=(0,B.getSettings)().capturedDefaultToggles;if(!n)return console.warn("[".concat(te,"] No default toggle state captured - cannot restore")),{applied:!1,matched:0};const t=(0,r.SD)(),i=null==t?void 0:t.chatCompletionSettings;if(null==i||!i.prompt_order)return console.warn("[".concat(te,"] Cannot restore defaults - prompt_order not available")),{applied:!1,matched:0};const o=null!==(e=i.prompt_manager_settings)&&void 0!==e&&e.showCharacterPromptOrder?null==t?void 0:t.characterId:100001,a=i.prompt_order.find(e=>e.character_id===o);if(null==a||!a.order)return console.warn("[".concat(te,"] Cannot restore defaults - no prompt_order entry for character ").concat(o)),{applied:!1,matched:0};let s=0;for(const[e,t]of Object.entries(n)){const n=a.order.find(n=>n.identifier===e);n&&(n.enabled=t,s++)}return s>0&&("function"==typeof(null==t?void 0:t.saveSettingsDebounced)&&t.saveSettingsDebounced(),ae=!0,console.log("[".concat(te,"] Restored ").concat(s," toggles to default state"))),{applied:s>0,matched:s}}();return e.applied&&"undefined"!=typeof toastr&&toastr.info("Restored default toggles (".concat(e.matched," prompts)"),"Lumiverse Helper",{timeOut:2e3,preventDuplicates:!0}),!1}const n=he();if(ae=!1,console.log("[".concat(te,"] Bindings detected (preset: ").concat(e.hasPresetBinding,", toggle: ").concat(e.hasToggleBinding,") - resetting to defaults")),ne.resetPromptsToDefault(),!n.presetName)return console.log("[".concat(te,"] No preset binding, but toggle binding exists - applying toggles only")),re=null,await be(),!1;const t="".concat(n.bindingType,":").concat(n.bindingId,":").concat(n.presetName);if(re===t)return console.log("[".concat(te,"] Preset binding already applied, checking toggle states...")),await be(),!1;if(!ne.getAvailablePresets().includes(n.presetName))return console.warn("[".concat(te,'] Bound preset "').concat(n.presetName,'" no longer exists')),"chat"===n.bindingType?ue(n.bindingId,null):"character"===n.bindingType&&ce(n.bindingId,null),!1;ie=!0;try{console.log("[".concat(te,"] Applying ").concat(n.bindingType,' binding: "').concat(n.presetName,'" for ').concat(n.bindingId));const e=await ne.selectPreset(n.presetName);if(e){if(re=t,console.log("[".concat(te,'] Successfully switched to preset "').concat(n.presetName,'"')),"undefined"!=typeof toastr){const e="chat"===n.bindingType?"chat":"character";toastr.info('Preset switched to "'.concat(n.presetName,'" (').concat(e," binding)"),"Lumiverse Helper",{timeOut:2e3,preventDuplicates:!0})}await be()}return e}catch(e){return console.error("[".concat(te,"] Failed to apply binding:"),e),!1}finally{ie=!1}}async function be(){const e=ge(),n=pe();if(e){const n=(0,Q.Y0)(e);if(n){console.log("[".concat(te,'] Found chat toggle binding for "').concat(e,'", applying...'));const t=await xe(n);if(t.applied)return"undefined"!=typeof toastr&&toastr.info("Prompt toggles applied (chat binding: ".concat(t.matched," prompts)"),"Lumiverse Helper",{timeOut:2e3,preventDuplicates:!0}),{applied:!0,source:"chat",matched:t.matched}}}if(n){const e=(0,Q.jm)(n);if(e){console.log("[".concat(te,'] Found character toggle binding for "').concat(n,'", applying...'));const t=await xe(e);if(t.applied)return"undefined"!=typeof toastr&&toastr.info("Prompt toggles applied (character binding: ".concat(t.matched," prompts)"),"Lumiverse Helper",{timeOut:2e3,preventDuplicates:!0}),{applied:!0,source:"character",matched:t.matched}}}return console.log("[".concat(te,"] No toggle bindings to apply")),{applied:!1,source:null,matched:0}}async function xe(e){var n;if(null==e||!e.toggles)return console.log("[".concat(te,"] applyToggleStateToCurrentPreset: No toggles in state")),{applied:!1,matched:0};const t=Object.keys(e.toggles).length;console.log("[".concat(te,"] applyToggleStateToCurrentPreset: Applying ").concat(t," toggles"));const i=(0,r.SD)(),o=null==i?void 0:i.chatCompletionSettings;if(!o)return console.warn("[".concat(te,"] chatCompletionSettings not available on context")),{applied:!1,matched:0};const a=o.prompt_order;if(!Array.isArray(a))return console.warn("[".concat(te,"] prompt_order not available or not an array")),{applied:!1,matched:0};const s=!(null!==(n=o.prompt_manager_settings)&&void 0!==n&&n.showCharacterPromptOrder),l=s?100001:null==i?void 0:i.characterId;console.log("[".concat(te,"] Strategy: ").concat(s?"Global":"Character",", activeCharId: ").concat(l));const c=a.find(e=>e.character_id===l);if(!c||!Array.isArray(c.order))return console.warn("[".concat(te,"] No prompt_order entry for character ").concat(l)),{applied:!1,matched:0};let u=0,d=0;for(const[n,t]of Object.entries(e.toggles)){const e=c.order.find(e=>e.identifier===n);e?(e.enabled=t,u++):d++}return u>0?(console.log("[".concat(te,"] Applied ").concat(u," toggles, ").concat(d," unmatched.")),"function"==typeof(null==i?void 0:i.saveSettingsDebounced)&&i.saveSettingsDebounced(),console.log("[".concat(te,"] Toggle state applied successfully (runtime only, preset file unchanged)")),{applied:!0,matched:u}):(console.log("[".concat(te,"] No prompts matched toggle state (").concat(d," unmatched)")),{applied:!1,matched:0})}function ye(){const e=(0,r.SD)(),n=pe(),t=ge();let i=null;if(n&&null!=e&&e.characters){const t=e.characters.find(e=>e.avatar===n);i=(null==t?void 0:t.name)||null}return{characterAvatar:n,characterName:i,chatId:t}}function ke(e){oe=e}function we(){return ae=!1,function(){const e=ne.captureCurrentToggles();return e&&0!==Object.keys(e).length?((0,B.getSettings)().capturedDefaultToggles=e,(0,B.saveSettings)(),ae=!0,console.log("[".concat(te,"] Captured default toggle state with ").concat(Object.keys(e).length," toggles")),!0):(console.warn("[".concat(te,"] Failed to capture default toggle state - no toggles available")),!1)}()}function je(){return!1!==(0,B.getSettings)().enableLandingPage}var Ce=t(540),Se=t(338),Ne=t(678),Ee=t(848);const Pe=["ui"],De=["ui"];function Me(e,n){if(null==e)return{};var t,r,i=function(e,n){if(null==e)return{};var t={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==n.indexOf(r))continue;t[r]=e[r]}return t}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],-1===n.indexOf(t)&&{}.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}function Oe(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function Te(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Oe(Object(t),!0).forEach(function(n){Ae(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Oe(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Ae(e,n,t){return(n=Le(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function Le(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}let ze=null;function Ie(){if("undefined"!=typeof crypto&&"function"==typeof crypto.randomUUID)try{return crypto.randomUUID()}catch(e){}const e="0123456789abcdef";let n="";for(let t=0;t<36;t++)n+=8===t||13===t||18===t||23===t?"-":14===t?"4":19===t?e[4*Math.random()|8]:e[16*Math.random()|0];return n}const Re=function(e){let n=e;const t=new Set;return{getState:()=>n,setState:e=>{const r="function"==typeof e?e(n):e;r!==n&&(n=Te(Te({},n),r),t.forEach(e=>e()))},subscribe:e=>(t.add(e),()=>t.delete(e))}}({packs:{},selectedDefinition:null,selectedBehaviors:[],selectedPersonalities:[],dominantBehavior:null,dominantPersonality:null,selectedLoomStyle:[],selectedLoomUtils:[],selectedLoomRetrofits:[],presets:{},activePresetName:null,chimeraMode:!1,selectedDefinitions:[],councilMode:!1,councilMembers:[],lumiaQuirks:"",lumiaQuirksEnabled:!0,stateSynthesis:{enabled:!1},oocEnabled:!0,lumiaOOCStyle:"social",lumiaOOCInterval:null,councilChatStyle:{enabled:!1,showTimestamps:!0,useLeetHandles:!0},councilTools:{enabled:!1,mode:"sidecar",timeoutMs:3e4,llm:{provider:"anthropic",model:"",endpoint:"",apiKey:"",temperature:.7,topP:1,maxTokens:4096}},messageTruncation:{enabled:!1,keepCount:50},contextFilters:{},sovereignHand:{enabled:!1,excludeLastMessage:!0,includeMessageInPrompt:!0},summarization:{},showLumiverseDrawer:!0,dismissedUpdateVersion:null,drawerSettings:{side:"right",verticalPosition:15,tabSize:"large"},enableLandingPage:!0,landingPageChatsDisplayed:12,disableDefaultStateRestore:!0,chatChangeCounter:0,ui:{activeModal:null,isLoading:!1,isUpdatingExtension:!1,error:null,viewingPack:null,viewingLoomPack:null},updates:{extensionUpdate:null,presetUpdates:[],lastChecked:null}});function Be(e,n,t){const r=n.split("."),i=Te({},e);let o=i;for(let e=0;e<r.length-1;e++)o[r[e]]=Te({},o[r[e]]),o=o[r[e]];return o[r[r.length-1]]=t,i}function _e(e,n){if(!e)return null;if(e.lumiaItems&&e.lumiaItems.length>0){const t=e.lumiaItems.find(e=>e.lumiaName===n||e.lumiaDefName===n);if(t)return t}return e.items&&e.items.length>0?e.items.find(e=>e.lumiaDefName===n):null}function Fe(e,n){if(!e)return null;const t={name:["lumiaName","lumiaDefName"],def:["lumiaDefinition","lumiaDef"],personality:["lumiaPersonality","lumia_personality"],behavior:["lumiaBehavior","lumia_behavior"],img:["avatarUrl","lumia_img"],author:["authorName","defAuthor"],gender:["genderIdentity"]}[n];if(!t)return null;for(const n of t)if(void 0!==e[n]&&null!==e[n])return e[n];return null}function Ue(e,n){if(!e||!n)return null;if(e[n])return e[n];for(const[t,r]of Object.entries(e))if(r.name===n||r.packName===n)return r;return null}const He={updateSettings:(e,n)=>{const t=Re.getState();Re.setState({settings:Be(t.settings,e,n)})},setSettings:e=>{Re.setState({settings:e})},setPacks:e=>{Re.setState({packs:e})},setCustomPacks:e=>{const n=Te({},Re.getState().packs);e.forEach(e=>{const t=e.packName||e.name;n[t]=Te(Te({},e),{},{isCustom:!0})}),Re.setState({packs:n})},addCustomPack:e=>{const n=Re.getState(),t=n.packs&&"object"==typeof n.packs?Te({},n.packs):{};t[e.packName||e.name]=Te(Te({},e),{},{isCustom:!0}),Re.setState({packs:t})},updateCustomPack:(e,n)=>{const t=Re.getState(),r=t.packs&&"object"==typeof t.packs?Te({},t.packs):{};let i=null;for(const[n,t]of Object.entries(r))if(t.id===e||t.name===e||t.packName===e||n===e){i=n;break}if(i){const e=r[i],t=n.packName||n.name||e.packName||e.name,o=Te(Te(Te({},e),n),{},{isCustom:!0});t!==i?(delete r[i],r[t]=o):r[i]=o,Re.setState({packs:r})}},removeCustomPack:e=>{const n=Re.getState(),t=n.packs&&"object"==typeof n.packs?Te({},n.packs):{};for(const[n,r]of Object.entries(t))if(r.id===e||r.name===e||r.packName===e||n===e){delete t[n];break}Re.setState({packs:t})},removePack:e=>{const n=Re.getState(),t=n.packs&&"object"==typeof n.packs?Te({},n.packs):{};if(t[e])delete t[e];else for(const[n,r]of Object.entries(t))if(r.name===e||r.packName===e){delete t[n];break}Re.setState({packs:t})},updatePackLoomItems:(e,n)=>{const t=Re.getState(),r=t.packs&&"object"==typeof t.packs?Te({},t.packs):{};let i=null;if(r[e])i=e;else for(const[n,t]of Object.entries(r))if(t.name===e||t.packName===e){i=n;break}i&&r[i]&&(r[i]=Te(Te({},r[i]),{},{loomItems:n}),Re.setState({packs:r}))},updatePackField:(e,n,t)=>{const r=Re.getState(),i=r.packs&&"object"==typeof r.packs?Te({},r.packs):{};let o=null;if(i[e])o=e;else for(const[n,t]of Object.entries(i))if(t.name===e||t.packName===e){o=n;break}o&&i[o]&&(i[o]=Te(Te({},i[o]),{},{[n]:t}),Re.setState({packs:i}))},_selectionsMatch:(e,n)=>!(!e||!n)&&(e.packName===n.packName&&e.itemName===n.itemName),setSelectedBehaviors:e=>{Re.setState({selectedBehaviors:e})},toggleBehavior:e=>{const n=Re.getState(),t=He._selectionsMatch,r=n.selectedBehaviors.findIndex(n=>t(n,e));if(r>=0){const i=[...n.selectedBehaviors];i.splice(r,1),Re.setState({selectedBehaviors:i,dominantBehavior:t(n.dominantBehavior,e)?null:n.dominantBehavior})}else Re.setState({selectedBehaviors:[...n.selectedBehaviors,e]})},setDominantBehavior:e=>{Re.setState({dominantBehavior:e})},setSelectedPersonalities:e=>{Re.setState({selectedPersonalities:e})},togglePersonality:e=>{const n=Re.getState(),t=He._selectionsMatch,r=n.selectedPersonalities.findIndex(n=>t(n,e));if(r>=0){const i=[...n.selectedPersonalities];i.splice(r,1),Re.setState({selectedPersonalities:i,dominantPersonality:t(n.dominantPersonality,e)?null:n.dominantPersonality})}else Re.setState({selectedPersonalities:[...n.selectedPersonalities,e]})},setDominantPersonality:e=>{Re.setState({dominantPersonality:e})},setSelectedDefinition:e=>{Re.setState({selectedDefinition:e})},clearSelections:()=>{Re.setState({selectedBehaviors:[],selectedPersonalities:[],selectedDefinition:null,dominantBehavior:null,dominantPersonality:null})},setSelectedLoomStyles:e=>{Re.setState({selectedLoomStyle:e})},toggleLoomStyle:e=>{const n=Re.getState(),t=He._selectionsMatch,r=n.selectedLoomStyle||[],i=r.findIndex(n=>t(n,e));if(i>=0){const e=[...r];e.splice(i,1),Re.setState({selectedLoomStyle:e})}else Re.setState({selectedLoomStyle:[...r,e]})},setSelectedLoomUtilities:e=>{Re.setState({selectedLoomUtils:e})},toggleLoomUtility:e=>{const n=Re.getState(),t=He._selectionsMatch,r=n.selectedLoomUtils||[],i=r.findIndex(n=>t(n,e));if(i>=0){const e=[...r];e.splice(i,1),Re.setState({selectedLoomUtils:e})}else Re.setState({selectedLoomUtils:[...r,e]})},setSelectedLoomRetrofits:e=>{Re.setState({selectedLoomRetrofits:e})},toggleLoomRetrofit:e=>{const n=Re.getState(),t=He._selectionsMatch,r=n.selectedLoomRetrofits||[],i=r.findIndex(n=>t(n,e));if(i>=0){const e=[...r];e.splice(i,1),Re.setState({selectedLoomRetrofits:e})}else Re.setState({selectedLoomRetrofits:[...r,e]})},clearLoomSelections:()=>{Re.setState({selectedLoomStyle:[],selectedLoomUtils:[],selectedLoomRetrofits:[]})},clearAllSelections:()=>{Re.setState({selectedBehaviors:[],selectedPersonalities:[],selectedDefinition:null,dominantBehavior:null,dominantPersonality:null,selectedLoomStyle:[],selectedLoomUtils:[],selectedLoomRetrofits:[]})},areAllTraitsEnabledForLumia:(e,n)=>{const t=Re.getState(),r=Ue(t.packs,e);if(!r)return!1;const i=_e(r,n);if(!i)return!1;if(Fe(i,"def")){const r=t.selectedDefinition;if(!r||r.packName!==e||r.itemName!==n)return!1}if(Fe(i,"behavior")){if(!(t.selectedBehaviors||[]).some(t=>t.packName===e&&t.itemName===n))return!1}if(Fe(i,"personality")){if(!(t.selectedPersonalities||[]).some(t=>t.packName===e&&t.itemName===n))return!1}return!0},toggleAllTraitsForLumia:(e,n)=>{const t=Re.getState(),r=Ue(t.packs,e);if(!r)return!1;const i=_e(r,n);if(!i)return!1;if(He.areAllTraitsEnabledForLumia(e,n)){const r={};if(Fe(i,"def")){const i=t.selectedDefinition;i&&i.packName===e&&i.itemName===n&&(r.selectedDefinition=null)}if(Fe(i,"behavior")){const i=t.selectedBehaviors||[];r.selectedBehaviors=i.filter(t=>!(t.packName===e&&t.itemName===n))}if(Fe(i,"personality")){const i=t.selectedPersonalities||[];r.selectedPersonalities=i.filter(t=>!(t.packName===e&&t.itemName===n))}return Object.keys(r).length>0&&Re.setState(r),!1}{const r={packName:e,itemName:n},o={};if(Fe(i,"def")&&(o.selectedDefinition=r),Fe(i,"behavior")){const i=t.selectedBehaviors||[];i.some(t=>t.packName===e&&t.itemName===n)||(o.selectedBehaviors=[...i,r])}if(Fe(i,"personality")){const i=t.selectedPersonalities||[];i.some(t=>t.packName===e&&t.itemName===n)||(o.selectedPersonalities=[...i,r])}return Object.keys(o).length>0&&Re.setState(o),!0}},enableAllTraitsForLumia:(e,n)=>{const t=Re.getState(),r=Ue(t.packs,e);if(!r)return;const i=_e(r,n);if(!i)return;const o={packName:e,itemName:n},a={};if(Fe(i,"def")&&(a.selectedDefinition=o),Fe(i,"behavior")){const r=t.selectedBehaviors||[];r.some(t=>t.packName===e&&t.itemName===n)||(a.selectedBehaviors=[...r,o])}if(Fe(i,"personality")){const r=t.selectedPersonalities||[];r.some(t=>t.packName===e&&t.itemName===n)||(a.selectedPersonalities=[...r,o])}Object.keys(a).length>0&&Re.setState(a)},savePreset:e=>{const n=Re.getState(),t=Date.now(),r={name:e,createdAt:t,updatedAt:t,selectedDefinition:n.selectedDefinition,selectedBehaviors:[...n.selectedBehaviors||[]],selectedPersonalities:[...n.selectedPersonalities||[]],dominantBehavior:n.dominantBehavior,dominantPersonality:n.dominantPersonality,chimeraMode:n.chimeraMode||!1,selectedDefinitions:[...n.selectedDefinitions||[]],councilMode:n.councilMode||!1,councilMembers:structuredClone(n.councilMembers||[]),lumiaQuirks:n.lumiaQuirks||"",lumiaQuirksEnabled:!1!==n.lumiaQuirksEnabled};Re.setState({presets:Te(Te({},n.presets),{},{[e]:r}),activePresetName:e})},loadPreset:e=>{const n=Re.getState().presets[e];if(!n)return;const t={selectedDefinition:n.selectedDefinition,selectedBehaviors:n.selectedBehaviors||[],selectedPersonalities:n.selectedPersonalities||[],dominantBehavior:n.dominantBehavior,dominantPersonality:n.dominantPersonality,activePresetName:e};void 0!==n.chimeraMode&&(t.chimeraMode=n.chimeraMode,t.selectedDefinitions=n.selectedDefinitions||[]),void 0!==n.councilMode&&(t.councilMode=n.councilMode,t.councilMembers=n.councilMembers||[]),t.lumiaQuirks=n.lumiaQuirks||n.councilQuirks||"",t.lumiaQuirksEnabled=!1!==n.lumiaQuirksEnabled,Re.setState(t)},deletePreset:e=>{const n=Re.getState(),t=n.presets,{[e]:r}=t,i=Me(t,[e].map(Le));Re.setState({presets:i,activePresetName:n.activePresetName===e?null:n.activePresetName})},updatePreset:e=>{const n=Re.getState(),t=n.presets[e];if(!t)return;const r=Te(Te({},t),{},{updatedAt:Date.now(),selectedDefinition:n.selectedDefinition,selectedBehaviors:[...n.selectedBehaviors||[]],selectedPersonalities:[...n.selectedPersonalities||[]],dominantBehavior:n.dominantBehavior,dominantPersonality:n.dominantPersonality,chimeraMode:n.chimeraMode||!1,selectedDefinitions:[...n.selectedDefinitions||[]],councilMode:n.councilMode||!1,councilMembers:structuredClone(n.councilMembers||[]),lumiaQuirks:n.lumiaQuirks||"",lumiaQuirksEnabled:!1!==n.lumiaQuirksEnabled});Re.setState({presets:Te(Te({},n.presets),{},{[e]:r})})},clearActivePreset:()=>{Re.setState({activePresetName:null})},setChimeraMode:e=>{var n;const t=Re.getState();e&&t.councilMode&&Re.setState({councilMode:!1,councilMembers:[]}),e&&t.selectedDefinition?Re.setState({chimeraMode:!0,selectedDefinitions:[t.selectedDefinition],selectedDefinition:null}):!e&&(null===(n=t.selectedDefinitions)||void 0===n?void 0:n.length)>0?Re.setState({chimeraMode:!1,selectedDefinition:t.selectedDefinitions[0],selectedDefinitions:[]}):Re.setState({chimeraMode:e})},toggleChimeraDefinition:e=>{const n=Re.getState().selectedDefinitions||[],t=He._selectionsMatch,r=n.findIndex(n=>t(n,e));if(r>=0){const e=[...n];e.splice(r,1),Re.setState({selectedDefinitions:e})}else Re.setState({selectedDefinitions:[...n,e]})},clearChimeraDefinitions:()=>{Re.setState({selectedDefinitions:[]})},setCouncilMode:e=>{const n=Re.getState();e&&n.chimeraMode&&Re.setState({chimeraMode:!1,selectedDefinitions:[]}),Re.setState({councilMode:e})},addCouncilMember:e=>{const n=Re.getState(),t=n.councilMembers||[],r=_e(Ue(n.packs,e.packName),e.itemName),i=[],o=[];Fe(r,"behavior")&&i.push({packName:e.packName,itemName:e.itemName}),Fe(r,"personality")&&o.push({packName:e.packName,itemName:e.itemName});const a={id:Ie(),packName:e.packName,itemName:e.itemName,behaviors:i,personalities:o,dominantBehavior:null,dominantPersonality:null,role:""},s=[...t,a];return Re.setState({councilMembers:s}),a},updateCouncilMember:(e,n)=>{const t=Re.getState();Re.setState({councilMembers:t.councilMembers.map(t=>t.id===e?Te(Te({},t),n):t)})},removeCouncilMember:e=>{const n=Re.getState();Re.setState({councilMembers:n.councilMembers.filter(n=>n.id!==e)})},clearCouncilMembers:()=>{Re.setState({councilMembers:[]})},setCouncilToolsEnabled:e=>{const n=Re.getState();Re.setState({councilTools:Te(Te({},n.councilTools),{},{enabled:e})})},setCouncilToolsMode:e=>{const n=Re.getState();Re.setState({councilTools:Te(Te({},n.councilTools),{},{mode:e})})},setCouncilToolsTimeout:e=>{const n=Re.getState();Re.setState({councilTools:Te(Te({},n.councilTools),{},{timeoutMs:e})})},updateCouncilToolsLLM:e=>{const n=Re.getState().councilTools||{},t=n.llm||{};Re.setState({councilTools:Te(Te({},n),{},{llm:Te(Te({},t),e)})})},setSidecarContextWindow:e=>{const n=Re.getState();Re.setState({councilTools:Te(Te({},n.councilTools),{},{sidecarContextWindow:e})})},setCouncilMemberTools:(e,n)=>{const t=Re.getState();Re.setState({councilMembers:t.councilMembers.map(t=>t.id===e?Te(Te({},t),{},{tools:n||[]}):t)})},toggleCouncilMemberTool:(e,n)=>{const t=Re.getState();Re.setState({councilMembers:t.councilMembers.map(t=>{if(t.id!==e)return t;const r=t.tools||[],i=r.includes(n)?r.filter(e=>e!==n):[...r,n];return Te(Te({},t),{},{tools:i})})})},setLumiaQuirks:e=>{Re.setState({lumiaQuirks:e})},setLumiaQuirksEnabled:e=>{Re.setState({lumiaQuirksEnabled:e})},setStateSynthesisEnabled:e=>{const n=Re.getState();Re.setState({stateSynthesis:Te(Te({},n.stateSynthesis),{},{enabled:e})})},addCouncilMembersFromPack:e=>{const n=Re.getState(),t=Ue(n.packs,e);if(!t)return 0;let r=[];if(t.lumiaItems&&t.lumiaItems.length>0?r=t.lumiaItems.filter(e=>e.lumiaDefinition||e.lumiaDef):t.items&&t.items.length>0&&(r=t.items.filter(e=>(e.lumiaDefName||e.lumiaName)&&(e.lumiaDef||e.lumiaDefinition))),0===r.length)return 0;const i=n.councilMembers||[],o=new Set(i.map(e=>"".concat(e.packName,":").concat(e.itemName))),a=r.filter(n=>{const t=n.lumiaName||n.lumiaDefName;return!o.has("".concat(e,":").concat(t))});if(0===a.length)return 0;const s=a.map(n=>{const t=n.lumiaName||n.lumiaDefName,r=[],i=[];return Fe(n,"behavior")&&r.push({packName:e,itemName:t}),Fe(n,"personality")&&i.push({packName:e,itemName:t}),{id:Ie(),packName:e,itemName:t,behaviors:r,personalities:i,dominantBehavior:null,dominantPersonality:null,role:""}});return Re.setState({councilMembers:[...i,...s]}),s.length},openModal:function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Re.setState({ui:Te(Te({},Re.getState().ui),{},{activeModal:{name:e,props:n}})})},closeModal:()=>{Re.setState({ui:Te(Te({},Re.getState().ui),{},{activeModal:null})})},setLoading:e=>{Re.setState({ui:Te(Te({},Re.getState().ui),{},{isLoading:e})})},setError:e=>{Re.setState({ui:Te(Te({},Re.getState().ui),{},{error:e})})},clearError:()=>{Re.setState({ui:Te(Te({},Re.getState().ui),{},{error:null})})},openPackDetail:e=>{Re.setState({ui:Te(Te({},Re.getState().ui),{},{viewingPack:e})})},closePackDetail:()=>{Re.setState({ui:Te(Te({},Re.getState().ui),{},{viewingPack:null})})},openLoomPackDetail:e=>{Re.setState({ui:Te(Te({},Re.getState().ui),{},{viewingLoomPack:e})})},closeLoomPackDetail:()=>{Re.setState({ui:Te(Te({},Re.getState().ui),{},{viewingLoomPack:null})})},setExtensionUpdate:e=>{const n=Re.getState();Re.setState({updates:Te(Te({},n.updates),{},{extensionUpdate:e,lastChecked:Date.now()})})},setPresetUpdates:e=>{const n=Re.getState();Re.setState({updates:Te(Te({},n.updates),{},{presetUpdates:e||[]})})},clearUpdates:()=>{Re.setState({updates:{extensionUpdate:null,presetUpdates:[],lastChecked:null}})},dismissExtensionUpdate:e=>{Re.setState({dismissedUpdateVersion:e}),$e()},updateExtension:async()=>{const e=Re.getState();Re.setState({ui:Te(Te({},e.ui),{},{isUpdatingExtension:!0})});try{const e="undefined"!=typeof LumiverseBridge&&LumiverseBridge.triggerExtensionUpdate?LumiverseBridge.triggerExtensionUpdate:null;if(!e)return console.error("[LumiverseHelper] triggerExtensionUpdate not available on LumiverseBridge"),{success:!1,message:"Update API not available"};const n="undefined"!=typeof LumiverseBridge&&LumiverseBridge.extensionName?LumiverseBridge.extensionName:"SillyTavern-LumiverseHelper",r=await e(n);if(r.success){const{clearUpdateCache:e}=await Promise.resolve().then(t.bind(t,678));e(),console.log("[LumiverseHelper] Update cache cleared after successful update")}const i=Re.getState();return Re.setState({ui:Te(Te({},i.ui),{},{isUpdatingExtension:!1})}),r}catch(e){console.error("[LumiverseHelper] Error updating extension:",e);const n=Re.getState();return Re.setState({ui:Te(Te({},n.ui),{},{isUpdatingExtension:!1})}),{success:!1,message:"Error: ".concat(e.message)}}},setDisableDefaultStateRestore:e=>{Re.setState({disableDefaultStateRestore:e}),qe()}};function We(e){if(!e)return;const n=Re.getState();Re.setState(Te(Te({},e),{},{ui:n.ui,chatChangeCounter:(n.chatChangeCounter||0)+1}))}function Ve(){const e=Re.getState(),{ui:n}=e;return Me(e,Pe)}function qe(){!function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300;ze&&clearTimeout(ze),ze=setTimeout(e,n)}(()=>{"undefined"!=typeof LumiverseBridge&&LumiverseBridge.saveSettings&&LumiverseBridge.saveSettings(Ve())})}async function $e(){"undefined"!=typeof LumiverseBridge&&LumiverseBridge.saveSettings&&await LumiverseBridge.saveSettings(Ve(),!0)}const Ye={getState:Re.getState,setState:Re.setState,subscribe:Re.subscribe,syncFromExtension:We,exportForExtension:Ve,saveToExtension:qe};Ye.getState=Re.getState;const Ge=(0,Ce.createContext)(null);function Ke(e){let{children:n,initialSettings:t=null}=e;const r=(0,Ce.useRef)(!1);return(0,Ce.useEffect)(()=>{if(!r.current)if(r.current=!0,t)console.log("[LumiverseProvider] Using initialSettings from bridge"),We(t);else if("undefined"!=typeof LumiverseBridge&&LumiverseBridge.getSettings){console.log("[LumiverseProvider] Fetching settings via LumiverseBridge");const e=LumiverseBridge.getSettings();e&&We(e)}else console.warn("[LumiverseProvider] No settings source available")},[t]),(0,Ee.jsx)(Ge.Provider,{value:Re,children:n})}function Qe(e){const n=(0,Ce.useRef)(e);n.current=e;const t=(0,Ce.useCallback)(()=>n.current(Re.getState()),[]);return(0,Ce.useSyncExternalStore)(Re.subscribe,t,t)}function Xe(){return He}const Ze=e=>e.settings,Je=e=>e.ui,en=()=>Re.getState().selectedBehaviors,nn=()=>Re.getState().selectedPersonalities,tn=()=>Re.getState().selectedDefinition,rn=()=>Re.getState().dominantBehavior,on=()=>Re.getState().dominantPersonality,an=[],sn=()=>Re.getState().selectedLoomStyle||an,ln=()=>Re.getState().selectedLoomUtils||an,cn=()=>Re.getState().selectedLoomRetrofits||an,un=()=>Re.getState().packs,dn={extensionUpdate:null,presetUpdates:[],lastChecked:null},mn=()=>Re.getState().updates||dn;function pn(){return Qe(Ze)}function gn(){const e=(0,Ce.useSyncExternalStore)(Re.subscribe,en,en),n=(0,Ce.useSyncExternalStore)(Re.subscribe,nn,nn),t=(0,Ce.useSyncExternalStore)(Re.subscribe,tn,tn),r=(0,Ce.useSyncExternalStore)(Re.subscribe,rn,rn),i=(0,Ce.useSyncExternalStore)(Re.subscribe,on,on);return(0,Ce.useMemo)(()=>({behaviors:e,personalities:n,definition:t,dominantBehavior:r,dominantPersonality:i}),[e,n,t,r,i])}function hn(){const e=(0,Ce.useSyncExternalStore)(Re.subscribe,sn,sn),n=(0,Ce.useSyncExternalStore)(Re.subscribe,ln,ln),t=(0,Ce.useSyncExternalStore)(Re.subscribe,cn,cn);return(0,Ce.useMemo)(()=>({styles:e,utilities:n,retrofits:t}),[e,n,t])}function vn(){const e=(0,Ce.useSyncExternalStore)(Re.subscribe,un,un);return(0,Ce.useMemo)(()=>{let n=[];e&&(Array.isArray(e)?n=e:"object"==typeof e&&(n=Object.entries(e).map(e=>{let[n,t]=e;return Te(Te({},t),{},{name:t.name||t.packName||n})})));const t=n.filter(e=>!0===e.isCustom);return{packs:n.filter(e=>!e.isCustom),customPacks:t,allPacks:n}},[e])}function fn(){return Qe(Je)}function bn(){const e=(0,Ce.useSyncExternalStore)(Re.subscribe,mn,mn),n=(0,Ce.useSyncExternalStore)(Re.subscribe,()=>Re.getState().dismissedUpdateVersion,()=>Re.getState().dismissedUpdateVersion);return(0,Ce.useMemo)(()=>{var t,r;const i=e.extensionUpdate,o=n&&(null==i?void 0:i.latestVersion)===n;let a=!1;if(null!=i&&i.latestVersion&&!o){const e=(0,Ne.Mj)();a=(0,Ne.mU)(e,i.latestVersion)<0}return{extensionUpdate:i,presetUpdates:e.presetUpdates||[],lastChecked:e.lastChecked,dismissedVersion:n,hasExtensionUpdate:a,hasPresetUpdates:((null===(t=e.presetUpdates)||void 0===t?void 0:t.length)||0)>0,hasAnyUpdate:a||(null===(r=e.presetUpdates)||void 0===r?void 0:r.length)>0}},[e,n])}function xn(e){const[n,t]=(0,Ce.useState)({objectPosition:"center center",isLoaded:!1,isPortrait:!1,isSquare:!1,isLandscape:!1}),r=(0,Ce.useRef)(e);return(0,Ce.useEffect)(()=>{if(r.current=e,!e)return void t({objectPosition:"center center",isLoaded:!1,isPortrait:!1,isSquare:!1,isLandscape:!1});const n=new Image;return n.onload=()=>{if(r.current!==e)return;const{naturalWidth:i,naturalHeight:o}=n,a=i/o,s=a<.9;let l="center center";s&&(l="center 20%"),t({objectPosition:l,isLoaded:!0,isPortrait:s,isSquare:a>=.9&&a<=1.1,isLandscape:a>1.1})},n.onerror=()=>{r.current===e&&t({objectPosition:"center center",isLoaded:!1,isPortrait:!1,isSquare:!1,isLandscape:!1})},n.src=e,()=>{n.onload=null,n.onerror=null}},[e]),n}"undefined"!=typeof window&&(window.debugLumiverseData=function(){const e=Re.getState();console.log("=".repeat(80)),console.log("LUMIVERSE DEBUG DATA DUMP"),console.log("=".repeat(80)),console.log("\n--- STORE STATE: packs ---"),console.log("Type:",typeof e.packs,Array.isArray(e.packs)?"(Array - WRONG!)":"(Object - correct)"),console.log("Pack names:",e.packs?Object.keys(e.packs):"null"),console.log("Packs:",JSON.stringify(e.packs,null,2)),console.log("\n--- CURRENT SELECTIONS ---"),console.log("selectedDefinition:",JSON.stringify(e.selectedDefinition,null,2)),console.log("selectedBehaviors:",JSON.stringify(e.selectedBehaviors,null,2)),console.log("selectedPersonalities:",JSON.stringify(e.selectedPersonalities,null,2)),console.log("dominantBehavior:",JSON.stringify(e.dominantBehavior,null,2)),console.log("dominantPersonality:",JSON.stringify(e.dominantPersonality,null,2)),console.log("\n--- LOOM SELECTIONS ---"),console.log("selectedLoomStyle:",JSON.stringify(e.selectedLoomStyle,null,2)),console.log("selectedLoomUtils:",JSON.stringify(e.selectedLoomUtils,null,2)),console.log("selectedLoomRetrofits:",JSON.stringify(e.selectedLoomRetrofits,null,2)),console.log("\n--- SETTINGS FROM LUMIVERSE BRIDGE ---");try{if("undefined"!=typeof LumiverseBridge&&LumiverseBridge.getSettings){const e=LumiverseBridge.getSettings();e?(console.log("Bridge packs type:",typeof e.packs,Array.isArray(e.packs)?"(Array)":"(Object)"),console.log("Bridge pack names:",e.packs?Object.keys(e.packs):"null"),console.log("Full bridge settings:",JSON.stringify(e,null,2))):console.log("LumiverseBridge.getSettings() returned null")}else console.log("LumiverseBridge not available")}catch(e){console.log("Error reading bridge settings:",e.message)}console.log("\n--- PACK STRUCTURE ANALYSIS ---");const n=e.packs||{},t=Object.entries(n);console.log("Total packs:",t.length),t.forEach(e=>{let[n,t]=e;console.log('\nPack "'.concat(n,'":')),console.log("  - Pack keys:",Object.keys(t));const r=!(!t.lumiaItems&&!t.loomItems);var i,o,a,s,l;console.log("  - Format:",r?"v2 (lumiaItems/loomItems)":"v1 (mixed items[])"),r?(console.log("  - lumiaItems count:",(null===(i=t.lumiaItems)||void 0===i?void 0:i.length)||0),console.log("  - loomItems count:",(null===(o=t.loomItems)||void 0===o?void 0:o.length)||0),(null===(a=t.lumiaItems)||void 0===a?void 0:a.length)>0&&(console.log("  - Lumia items:"),t.lumiaItems.forEach((e,n)=>{var t;const r=e.lumiaName||"NONE",i=e.lumiaDefinition?"YES":"NO",o=e.lumiaBehavior?"YES":"NO",a=e.lumiaPersonality?"YES":"NO",s=null!==(t=e.genderIdentity)&&void 0!==t?t:"NONE";console.log("    [".concat(n,'] lumiaName="').concat(r,'", hasDef=').concat(i,", hasBehavior=").concat(o,", hasPersonality=").concat(a,", gender=").concat(s))})),(null===(s=t.loomItems)||void 0===s?void 0:s.length)>0&&(console.log("  - Loom items:"),t.loomItems.forEach((e,n)=>{console.log("    [".concat(n,'] loomName="').concat(e.loomName,'", loomCategory="').concat(e.loomCategory,'"'))}))):(console.log("  - items count:",(null===(l=t.items)||void 0===l?void 0:l.length)||0),t.items&&t.items.length>0&&(console.log("  - First item keys:",Object.keys(t.items[0])),console.log("  - Items with lumiaDefName:",t.items.filter(e=>e.lumiaDefName).length),console.log("  - Items with loomCategory:",t.items.filter(e=>e.loomCategory).length),console.log("  - All items:"),t.items.forEach((e,n)=>{const t=e.lumiaDefName||"NONE",r=e.loomCategory||"NONE",i=e.lumiaDef?"YES":"NO",o=e.lumia_behavior?"YES":"NO",a=e.lumia_personality?"YES":"NO";console.log("    [".concat(n,'] lumiaDefName="').concat(t,'", loomCategory="').concat(r,'", hasDef=').concat(i,", hasBehavior=").concat(o,", hasPersonality=").concat(a))})))}),console.log("\n"+"=".repeat(80)),console.log("END DEBUG DUMP - Copy everything above for analysis"),console.log("=".repeat(80));const{ui:r}=e;return{storeState:Me(e,De)}});const yn=e=>{const n=(e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,n,t)=>t?t.toUpperCase():n.toLowerCase()))(e);return n.charAt(0).toUpperCase()+n.slice(1)},kn=(...e)=>e.filter((e,n,t)=>Boolean(e)&&""!==e.trim()&&t.indexOf(e)===n).join(" ").trim(),wn=e=>{for(const n in e)if(n.startsWith("aria-")||"role"===n||"title"===n)return!0};var jn={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const Cn=(0,Ce.forwardRef)(({color:e="currentColor",size:n=24,strokeWidth:t=2,absoluteStrokeWidth:r,className:i="",children:o,iconNode:a,...s},l)=>(0,Ce.createElement)("svg",{ref:l,...jn,width:n,height:n,stroke:e,strokeWidth:r?24*Number(t)/Number(n):t,className:kn("lucide",i),...!o&&!wn(s)&&{"aria-hidden":"true"},...s},[...a.map(([e,n])=>(0,Ce.createElement)(e,n)),...Array.isArray(o)?o:[o]])),Sn=(e,n)=>{const t=(0,Ce.forwardRef)(({className:t,...r},i)=>{return(0,Ce.createElement)(Cn,{ref:i,iconNode:n,className:kn(`lucide-${o=yn(e),o.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,t),...r});var o});return t.displayName=yn(e),t},Nn=Sn("package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]]),En=Sn("pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]),Pn=Sn("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]),Dn=Sn("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]);function Mn(e){var n,t,r="";if("string"==typeof e||"number"==typeof e)r+=e;else if("object"==typeof e)if(Array.isArray(e)){var i=e.length;for(n=0;n<i;n++)e[n]&&(t=Mn(e[n]))&&(r&&(r+=" "),r+=t)}else for(t in e)e[t]&&(r&&(r+=" "),r+=t);return r}const On=function(){for(var e,n,t=0,r="",i=arguments.length;t<i;t++)(e=arguments[t])&&(n=Mn(e))&&(r&&(r+=" "),r+=n);return r},Tn=Sn("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),An=Sn("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),Ln=Sn("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),zn=["value","onChange","placeholder","className","autoFocus"];function In(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function Rn(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?In(Object(t),!0).forEach(function(n){Bn(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):In(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Bn(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function _n(e,n){if(null==e)return{};var t,r,i=function(e,n){if(null==e)return{};var t={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==n.indexOf(r))continue;t[r]=e[r]}return t}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],-1===n.indexOf(t)&&{}.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}function Fn(e){let{children:n,className:t}=e;return(0,Ee.jsx)("div",{className:On("lumiverse-editor-modal",t),style:{display:"flex",flexDirection:"column",flex:"1 1 auto",minHeight:0,maxHeight:"100%",overflow:"hidden"},children:n})}function Un(e){let{children:n,className:t}=e;return(0,Ee.jsx)("div",{className:On("lumiverse-editor-content",t),style:{flex:"1 1 auto",minHeight:0,overflowY:"auto",overflowX:"hidden",padding:"16px"},children:n})}function Hn(e){let{children:n,className:t}=e;return(0,Ee.jsx)("div",{className:On("lumiverse-editor-footer",t),style:{display:"flex",alignItems:"center",padding:"16px",background:"var(--lumiverse-bg-elevated)",borderTop:"1px solid var(--lumiverse-border)",flexShrink:0},children:n})}function Wn(e){let{label:n,required:t,hint:r,error:i,children:o,className:a}=e;return(0,Ee.jsxs)("div",{className:On("lumiverse-form-field",i&&"lumiverse-form-field--error",a),style:{marginBottom:"16px"},children:[(0,Ee.jsxs)("label",{className:"lumiverse-form-label",style:{display:"block",marginBottom:"6px",fontSize:"13px",fontWeight:500,color:"var(--lumiverse-text-muted)"},children:[n,t&&(0,Ee.jsx)("span",{className:"lumiverse-required",style:{color:"var(--lumiverse-danger)",marginLeft:"4px"},children:"*"})]}),o,r&&(0,Ee.jsx)("div",{className:"lumiverse-form-hint",style:{marginTop:"6px",fontSize:"11px",color:"var(--lumiverse-text-dim)",lineHeight:1.4},children:r}),i&&(0,Ee.jsx)("div",{className:"lumiverse-form-error",style:{marginTop:"4px",fontSize:"12px",color:"var(--lumiverse-danger)"},children:i})]})}function Vn(e){let{Icon:n,title:t,children:r,defaultExpanded:i=!0,className:o}=e;const[a,s]=Ce.useState(i);return(0,Ee.jsxs)("div",{className:On("lumiverse-editor-section",o),style:{marginBottom:"20px"},children:[(0,Ee.jsxs)("div",{className:"lumiverse-editor-section-header",onClick:()=>s(!a),style:{display:"flex",alignItems:"center",gap:"10px",paddingBottom:"10px",marginBottom:"10px",borderBottom:"1px solid var(--lumiverse-border)",cursor:"pointer",userSelect:"none"},children:[n&&(0,Ee.jsx)("div",{className:"lumiverse-section-icon",style:{display:"flex",alignItems:"center",justifyContent:"center",width:"24px",height:"24px",borderRadius:"6px",background:"rgba(147, 112, 219, 0.1)",color:"var(--lumiverse-primary)"},children:(0,Ee.jsx)(n,{size:14,strokeWidth:2})}),(0,Ee.jsx)("span",{style:{fontSize:"13px",fontWeight:600,color:"var(--lumiverse-text)",flex:1},children:t}),(0,Ee.jsx)("div",{style:{color:"var(--lumiverse-text-dim)"},children:a?(0,Ee.jsx)(Tn,{size:16}):(0,Ee.jsx)(An,{size:16})})]}),a&&(0,Ee.jsx)("div",{className:"lumiverse-editor-section-content",children:r})]})}function qn(e){let{value:n,onChange:t,placeholder:r,className:i,autoFocus:o}=e,a=_n(e,zn);return(0,Ee.jsx)("input",Rn({type:"text",className:On("lumiverse-input",i),value:n,onChange:e=>t(e.target.value),placeholder:r,autoFocus:o,style:{width:"100%",padding:"10px 12px",background:"rgba(0, 0, 0, 0.2)",border:"1px solid var(--lumiverse-border)",borderRadius:"8px",color:"var(--lumiverse-text)",fontSize:"13px",fontFamily:"inherit"}},a))}function $n(e){let{value:n,onChange:t,placeholder:r,className:i}=e;const[o,a]=(0,Ce.useState)(!1),{objectPosition:s}=xn(n||"");return(0,Ce.useEffect)(()=>{a(!1)},[n]),(0,Ee.jsx)("div",{className:On("lumiverse-image-input",i),children:(0,Ee.jsxs)("div",{style:{display:"flex",gap:"10px",alignItems:"flex-start"},children:[(0,Ee.jsx)("div",{style:{flex:1},children:(0,Ee.jsx)(qn,{value:n,onChange:t,placeholder:r||"https://..."})}),n&&!o&&(0,Ee.jsx)("div",{className:"lumiverse-image-preview",style:{width:"40px",height:"40px",borderRadius:"6px",overflow:"hidden",border:"1px solid var(--lumiverse-border)",flexShrink:0,background:"rgba(0,0,0,0.2)"},children:(0,Ee.jsx)("img",{src:n,alt:"Preview",style:{width:"100%",height:"100%",objectFit:"cover",objectPosition:s,animation:"lumiverseFadeIn 0.2s ease"},onError:()=>a(!0)})}),(!n||o)&&(0,Ee.jsx)("div",{style:{width:"40px",height:"40px",borderRadius:"6px",border:"1px dashed var(--lumiverse-border)",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,color:"var(--lumiverse-text-dim)"},children:(0,Ee.jsx)(Ln,{size:16})})]})})}function Yn(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function Gn(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Yn(Object(t),!0).forEach(function(n){Kn(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Yn(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Kn(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function Qn(e){const n=function(e){const n=e.packName||e.name||"Unnamed Pack",t=e.packAuthor||e.author||null,r=e.coverUrl||null,i=e.version||1;let o=[];e.lumiaItems&&e.lumiaItems.length>0?o=e.lumiaItems.map(e=>{var n;return{lumiaName:e.lumiaName||e.lumiaDefName||"Unknown",lumiaDefinition:e.lumiaDefinition||e.lumiaDef||"",lumiaPersonality:e.lumiaPersonality||e.lumia_personality||"",lumiaBehavior:e.lumiaBehavior||e.lumia_behavior||"",avatarUrl:e.avatarUrl||e.lumia_img||null,genderIdentity:null!==(n=e.genderIdentity)&&void 0!==n?n:0,authorName:e.authorName||t||null,version:e.version||1}}):e.items&&e.items.length>0&&(o=e.items.filter(e=>e.lumiaDefName||e.lumiaDef).map(e=>{var n;return{lumiaName:e.lumiaDefName||e.lumiaName||"Unknown",lumiaDefinition:e.lumiaDef||e.lumiaDefinition||"",lumiaPersonality:e.lumia_personality||e.lumiaPersonality||"",lumiaBehavior:e.lumia_behavior||e.lumiaBehavior||"",avatarUrl:e.lumia_img||e.avatarUrl||null,genderIdentity:null!==(n=e.genderIdentity)&&void 0!==n?n:0,authorName:e.authorName||t||null,version:e.version||1}}));let a=[];return e.loomItems&&e.loomItems.length>0?a=e.loomItems.map(e=>({loomName:e.loomName||e.name||"Unknown",loomContent:e.loomContent||e.content||"",loomCategory:e.loomCategory||e.category||"Loom Utilities",authorName:e.authorName||t||null,version:e.version||1})):e.items&&e.items.length>0&&(a=e.items.filter(e=>(e.loomCategory||e.loomName)&&!e.lumiaDefName&&!e.lumiaDef).map(e=>({loomName:e.loomName||e.name||"Unknown",loomContent:e.loomContent||e.content||"",loomCategory:e.loomCategory||e.category||"Loom Utilities",authorName:e.authorName||t||null,version:e.version||1}))),{packName:n,packAuthor:t,coverUrl:r,version:i,packExtras:e.packExtras||[],lumiaItems:o,loomItems:a}}(e),t=JSON.stringify(n,null,2),r=new Blob([t],{type:"application/json"}),i=URL.createObjectURL(r),o=e.packName||e.name||"pack",a=document.createElement("a");a.href=i,a.download="".concat(o.replace(/[^a-z0-9]/gi,"_"),"_lumiverse.json"),document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(i)}function Xn(e){return e.packName||e.name||""}function Zn(e){return e.packAuthor||e.author||""}const Jn=function(e){let{packId:n,packName:t,onClose:r}=e;const{customPacks:i}=vn(),o=Xe(),a=n||t,s=a?i.find(e=>e.id===a||e.name===a||e.packName===a):null,[l,c]=(0,Ce.useState)(()=>s?Gn(Gn({},s),{},{packName:s.packName||s.name||"",packAuthor:s.packAuthor||s.author||""}):{id:"pack_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),packName:"",name:"",packAuthor:"",coverUrl:"",url:"",isCustom:!0,version:1,packExtras:[],lumiaItems:[],loomItems:[]}),[u,d]=(0,Ce.useState)({}),m=(0,Ce.useCallback)((e,n)=>{c(t=>Gn(Gn({},t),{},{[e]:n})),u[e]&&d(n=>Gn(Gn({},n),{},{[e]:null}))},[u]),p=function(e){return e.lumiaItems&&e.lumiaItems.length>0?e.lumiaItems.length:e.items&&e.items.length>0?e.items.filter(e=>e.lumiaDefName||e.lumiaName||e.lumiaDef).length:0}(l),g=function(e){return e.loomItems&&e.loomItems.length>0?e.loomItems.length:e.items&&e.items.length>0?e.items.filter(e=>(e.loomCategory||e.loomName)&&!e.lumiaDefName&&!e.lumiaDef).length:0}(l);return(0,Ee.jsxs)(Fn,{children:[(0,Ee.jsxs)(Un,{children:[(0,Ee.jsxs)(Vn,{Icon:Nn,title:s?"Edit Pack":"New Pack",children:[(0,Ee.jsx)(Wn,{label:"Pack Name",required:!0,error:u.packName,children:(0,Ee.jsx)(qn,{value:Xn(l),onChange:e=>{c(n=>Gn(Gn({},n),{},{packName:e,name:e})),u.packName&&d(e=>Gn(Gn({},e),{},{packName:null}))},placeholder:"My Custom Pack",autoFocus:!0})}),(0,Ee.jsx)(Wn,{label:"Author",children:(0,Ee.jsx)(qn,{value:Zn(l),onChange:e=>{c(n=>Gn(Gn({},n),{},{packAuthor:e,author:e}))},placeholder:"Your name"})}),(0,Ee.jsx)(Wn,{label:"Cover Image",hint:"URL for pack cover image",children:(0,Ee.jsx)($n,{value:l.coverUrl||"",onChange:e=>m("coverUrl",e),placeholder:"https://..."})})]}),(0,Ee.jsxs)(Vn,{Icon:En,title:"Pack Contents",children:[(0,Ee.jsxs)("div",{style:{padding:"12px",background:"rgba(147, 112, 219, 0.05)",border:"1px solid var(--lumiverse-border)",borderRadius:"8px",marginBottom:"12px",textAlign:"center"},children:[(0,Ee.jsxs)("div",{style:{fontSize:"13px",color:"var(--lumiverse-text)",marginBottom:"8px"},children:[p," Lumia",1!==p?"s":"",g>0?", ".concat(g," Loom item").concat(1!==g?"s":""):""," in this pack"]}),(0,Ee.jsx)("div",{style:{fontSize:"11px",color:"var(--lumiverse-text-muted)"},children:"Use the Pack Selector to add, edit, or remove individual items."})]}),(0,Ee.jsxs)("button",{className:"lumiverse-btn lumiverse-btn--secondary lumiverse-btn--full",onClick:()=>{const e=Xn(l);if(e.trim()){const n=Gn(Gn({},l),{},{name:e});s?o.updateCustomPack(l.id||Xn(s),n):o.addCustomPack(n),qe()}o.openModal("packSelector"),r()},type:"button",children:[(0,Ee.jsx)(En,{size:14,strokeWidth:1.5}),"Manage Lumias & Looms"]})]})]}),(0,Ee.jsxs)(Hn,{children:[(0,Ee.jsxs)("div",{style:{display:"flex",gap:"8px",marginRight:"auto"},children:[s&&(0,Ee.jsxs)("button",{className:"lumiverse-btn lumiverse-btn--danger",onClick:()=>{const e=Xn(l);window.confirm('Are you sure you want to delete "'.concat(e,'"? This will remove all Lumias in this pack.'))&&(o.removeCustomPack(l.id||e),qe(),r())},type:"button",children:[(0,Ee.jsx)(Pn,{size:14}),"Delete"]}),(0,Ee.jsxs)("button",{className:"lumiverse-btn lumiverse-btn--secondary",onClick:()=>{Xn(l).trim()?Qn(l):alert("Please enter a pack name before exporting.")},type:"button",title:"Export as Lumiverse Pack",children:[(0,Ee.jsx)(Dn,{size:14}),"Export"]})]}),(0,Ee.jsxs)("div",{style:{display:"flex",gap:"8px"},children:[(0,Ee.jsx)("button",{className:"lumiverse-btn lumiverse-btn--secondary",onClick:r,type:"button",children:"Cancel"}),(0,Ee.jsx)("button",{className:"lumiverse-btn lumiverse-btn--primary",onClick:()=>{if(!(()=>{const e={};return Xn(l).trim()||(e.packName="Pack name is required"),d(e),0===Object.keys(e).length})())return;const e=Gn(Gn({},l),{},{name:Xn(l)});s?o.updateCustomPack(l.id||Xn(s),e):o.addCustomPack(e),qe(),r()},type:"button",children:s?"Save Changes":"Create Pack"})]})]})]})},et=["isOpen","children","className","duration","initial","animate","exit","transition"];function nt(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function tt(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?nt(Object(t),!0).forEach(function(n){rt(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):nt(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function rt(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const it=(0,Ce.forwardRef)(function(e,n){let{isOpen:t,children:r,className:i,duration:o=200,initial:a,animate:s,exit:l,transition:c}=e,u=function(e,n){if(null==e)return{};var t,r,i=function(e,n){if(null==e)return{};var t={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==n.indexOf(r))continue;t[r]=e[r]}return t}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],-1===n.indexOf(t)&&{}.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}(e,et);return(0,Ee.jsx)("div",tt(tt({ref:n,className:On("lumiverse-collapsible",i,{"is-open":t}),style:{"--collapsible-duration":"".concat(o,"ms")}},u),{},{children:(0,Ee.jsx)("div",{className:"lumiverse-collapsible-inner",children:r})}))});var ot=t(961);const at=Sn("circle-arrow-up",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m16 12-4-4-4 4",key:"177agl"}],["path",{d:"M12 16V8",key:"1sbj14"}]]),st=Sn("file-braces",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 12a1 1 0 0 0-1 1v1a1 1 0 0 1-1 1 1 1 0 0 1 1 1v1a1 1 0 0 0 1 1",key:"1oajmo"}],["path",{d:"M14 18a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1 1 1 0 0 1-1-1v-1a1 1 0 0 0-1-1",key:"mpwhp6"}]]),lt=Sn("cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]),ct=Sn("brain",[["path",{d:"M12 18V5",key:"adv99a"}],["path",{d:"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4",key:"1e3is1"}],["path",{d:"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5",key:"1gqd8o"}],["path",{d:"M17.997 5.125a4 4 0 0 1 2.526 5.77",key:"iwvgf7"}],["path",{d:"M18 18a4 4 0 0 0 2-7.464",key:"efp6ie"}],["path",{d:"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517",key:"1gq6am"}],["path",{d:"M6 18a4 4 0 0 1-2-7.464",key:"k1g0md"}],["path",{d:"M6.003 5.125a4 4 0 0 0-2.526 5.77",key:"q97ue3"}]]),ut=Sn("zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),dt=Sn("settings-2",[["path",{d:"M14 17H5",key:"gfn3mx"}],["path",{d:"M19 7h-9",key:"6i9tg"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]]),mt=Sn("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),pt=Sn("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),gt=Sn("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),ht=Sn("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),vt=Sn("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),ft=["trackVersion"];function bt(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function xt(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?bt(Object(t),!0).forEach(function(n){yt(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):bt(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function yt(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const kt="presets-service",wt="https://lucid.cards",jt=new Set;function Ct(){const e=At();jt.forEach(n=>{try{n(e)}catch(e){console.error("[".concat(kt,"] Tracking listener error:"),e)}})}const St=new Set;function Nt(){const e={reasoning:Ut(),startReplyWith:Wt(),apiReasoning:qt(),postProcessing:Et()};St.forEach(n=>{try{n(e)}catch(e){console.error("[".concat(kt,"] Reasoning listener error:"),e)}})}function Et(){var e;const n=(0,r.SD)();return(null==n||null===(e=n.chatCompletionSettings)||void 0===e?void 0:e.custom_prompt_post_processing)||""}const Pt=["chat_completion_source","openai_model","claude_model","openrouter_model","mistralai_model","ai21_model","cohere_model","perplexity_model","groq_model","chutes_model","siliconflow_model","electronhub_model","nanogpt_model","deepseek_model","aimlapi_model","xai_model","pollinations_model","moonshot_model","fireworks_model","cometapi_model","google_model","vertexai_model","zai_model","azure_openai_model","custom_model","custom_url","custom_include_body","custom_exclude_body","custom_include_headers","custom_prompt_post_processing","openrouter_use_fallback","openrouter_group_models","openrouter_sort_models","openrouter_providers","openrouter_allow_fallbacks","openrouter_middleout","azure_base_url","azure_deployment_name","azure_api_version","vertexai_auth_mode","vertexai_region","vertexai_express_project_id","zai_endpoint","reverse_proxy","proxy_password","bypass_status_check","show_external_models"],Dt=["mistralai_model"];function Mt(e,n){const t=xt({},e);return Pt.forEach(e=>{void 0===t[e]&&(t[e]=n[e])}),Dt.forEach(e=>{void 0!==t[e]&&null!==t[e]||(t[e]=n[e]||"")}),t}function Ot(e){if(!e)return!1;return/\b(beta|alpha|rc|pre|preview)\b/i.test(e)}function Tt(e){return e?"".concat(e.major,".").concat(e.minor,".").concat(e.patch):"unknown"}function At(){return(0,B.getSettings)().trackedPresets||{}}async function Lt(){const e=At(),n=Object.keys(e);if(0===n.length)return[];const t=n.map(async n=>{const t=e[n],r=await async function(e){try{const n=await fetch("".concat(wt,"/api/download/chat-presets/").concat(e,"/latest"));if(!n.ok)return null;const t=await n.json();if(!t.success)return null;const r=t.latest||t.version||null;return null!=r&&r.version&&(r.version.isPrerelease=Ot(r.name)),r}catch(e){return null}}(n);if(null==r||!r.version)return null;const i=r.version,o=t.version;return s=i,((a=o)&&s?a.major!==s.major?a.major<s.major?-1:1:a.minor!==s.minor?a.minor<s.minor?-1:1:a.patch!==s.patch?a.patch<s.patch?-1:1:a.isPrerelease&&!s.isPrerelease?-1:!a.isPrerelease&&s.isPrerelease?1:0:0)<0?{slug:n,name:t.name,currentVersion:o,latestVersion:i,latestVersionName:r.name||Tt(i)}:null;var a,s});try{return(await Promise.all(t)).filter(Boolean)}catch(e){return console.error("[".concat(kt,"] Failed to check for updates:"),e),[]}}function zt(e){return e&&["input_sequence","output_sequence"].every(n=>Object.keys(e).includes(n))}function It(e){return e&&["story_string"].every(n=>Object.keys(e).includes(n))}function Rt(e){if(!e)return!1;const n=Object.keys(e),t=n.includes("temp")||n.includes("temperature")||n.includes("temp_openai"),r=["top_p","top_k","rep_pen","repetition_penalty","frequency_penalty","freq_pen_openai","openai_model","top_p_openai"].some(e=>n.includes(e));return t&&r}function Bt(e){return e&&["prefix","suffix","separator"].every(n=>Object.keys(e).includes(n))}async function _t(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"latest",t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{trackVersion:i=!0}=t,o=function(e,n){if(null==e)return{};var t,r,i=function(e,n){if(null==e)return{};var t={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==n.indexOf(r))continue;t[r]=e[r]}return t}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],-1===n.indexOf(t)&&{}.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}(t,ft);try{var a,s;const t=await async function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"latest";try{const t=await fetch("".concat(wt,"/api/download/chat-presets/").concat(e,"/").concat(n));if(!t.ok)throw new Error("HTTP ".concat(t.status,": ").concat(t.statusText));const r=await t.json();if(!r.success)throw new Error(r.error||"Preset download failed");return r}catch(e){throw console.error("[".concat(kt,"] Failed to download preset:"),e),e}}(e,n);if(!t.data)throw new Error("No preset data in API response");let d=null;if("latest"===n){var l;d=(null===(l=t.preset)||void 0===l?void 0:l.latestVersion)||null}else{var c,u;d=[...(null===(c=t.preset)||void 0===c||null===(c=c.versions)||void 0===c?void 0:c.standard)||[],...(null===(u=t.preset)||void 0===u||null===(u=u.versions)||void 0===u?void 0:u.prolix)||[]].find(e=>e.slug===n)||null}null!==(a=d)&&void 0!==a&&a.version&&(d.version.isPrerelease=Ot(d.name));const m=(null===(s=d)||void 0===s?void 0:s.name)||"".concat(e," ").concat(n),p=await async function(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{activate:i=!1}=t,o=(0,r.SD)();if(!o)return{success:!1,type:"none",message:"SillyTavern context not available"};try{if(zt(e)){const t=o.getPresetManager("instruct");return await t.savePreset(e.name||n,e),i&&await t.selectPreset(e.name||n),o.saveSettingsDebounced(),{success:!0,type:"instruct",message:"Imported Instruct Preset"}}if(It(e)){const t=o.getPresetManager("context");return await t.savePreset(e.name||n,e),i&&await t.selectPreset(e.name||n),o.saveSettingsDebounced(),{success:!0,type:"context",message:"Imported Context Preset"}}if(Rt(e)){var a;const t=o.chatCompletionSettings||window.oai_settings||{},r=Mt(e,t);console.log("[".concat(kt,"] Hydrated preset has mistralai_model:"),typeof r.mistralai_model,r.mistralai_model);const l=o.getPresetManager("openai");await l.savePreset(n,r);const c=null===(a=l.getCompletionPresetByName)||void 0===a?void 0:a.call(l,n);if(c?(console.log("[".concat(kt,"] Stored preset has mistralai_model:"),typeof c.mistralai_model,c.mistralai_model),Dt.forEach(e=>{void 0===c[e]&&(c[e]="",console.log("[".concat(kt,"] Patched stored preset with ").concat(e)))})):console.warn("[".concat(kt,"] Could not find stored preset to verify")),i){var s;Dt.forEach(e=>{t&&void 0===t[e]&&(t[e]="")}),await new Promise(e=>setTimeout(e,50));const e=null===(s=l.findPreset)||void 0===s?void 0:s.call(l,n);console.log("[".concat(kt,'] selectPreset - name: "').concat(n,'", optionValue: "').concat(e,'"')),null!=e?await l.selectPreset(e):await l.selectPreset(n)}return o.saveSettingsDebounced(),{success:!0,type:"openai",message:"Imported API Preset"}}if(Bt(e)){const t=o.getPresetManager("reasoning");return await t.savePreset(e.name||n,e),i&&await t.selectPreset(e.name||n),o.saveSettingsDebounced(),{success:!0,type:"reasoning",message:"Imported Reasoning Preset"}}let t=0;const r=[];if(e.instruct&&zt(e.instruct)){const i=o.getPresetManager("instruct");await i.savePreset(e.instruct.name||"".concat(n,"_instruct"),e.instruct),t++,r.push("instruct")}if(e.context&&It(e.context)){const i=o.getPresetManager("context");await i.savePreset(e.context.name||"".concat(n,"_context"),e.context),t++,r.push("context")}if(e.reasoning&&Bt(e.reasoning)){const i=o.getPresetManager("reasoning");await i.savePreset(e.reasoning.name||"".concat(n,"_reasoning"),e.reasoning),t++,r.push("reasoning")}if(e.preset&&Rt(e.preset)){const i=o.chatCompletionSettings||window.oai_settings||{},a=Mt(e.preset,i),s=o.getPresetManager("openai");await s.savePreset(a.name||n,a),t++,r.push("openai")}return t>0?(o.saveSettingsDebounced(),{success:!0,type:"master",message:"Imported ".concat(t," preset(s): ").concat(r.join(", "))}):{success:!1,type:"unknown",message:"Unknown preset format"}}catch(e){return console.error("[".concat(kt,"] Import error:"),e),{success:!1,type:"error",message:e.message}}}(t.data,m,o);return console.log("[".concat(kt,"] Import result:"),{success:p.success,trackVersion:i,hasVersion:!!d,versionInfo:d}),p.success&&i&&function(e,n,t){const r=(0,B.getSettings)();r.trackedPresets||(r.trackedPresets={});const i=Ot(null==t?void 0:t.name);r.trackedPresets[e]={name:(null==n?void 0:n.name)||e,version:null!=t&&t.version?xt(xt({},t.version),{},{isPrerelease:i}):null,versionName:(null==t?void 0:t.name)||"unknown",importedAt:Date.now()},(0,B.saveSettings)(),console.log("[".concat(kt,"] Tracked preset: ").concat(e," v").concat(Tt(null==t?void 0:t.version))),Ct()}(e,t.preset,d||{name:n,version:null}),xt(xt({},p),{},{presetInfo:t.preset,versionInfo:d})}catch(e){return console.error("[".concat(kt,"] Download and import failed:"),e),{success:!1,type:"error",message:e.message}}}function Ft(e){const n=(0,r.SD)();if(!n)return void console.warn("[".concat(kt,"] Context not available for reasoning config"));const t=n.powerUserSettings;if(!t||!t.reasoning)return void console.warn("[".concat(kt,"] Reasoning settings not available"));const i=window.jQuery;void 0!==e.autoParse&&(t.reasoning.auto_parse=e.autoParse,i&&i("#reasoning_auto_parse").prop("checked",e.autoParse)),void 0!==e.prefix&&(t.reasoning.prefix=e.prefix,i&&i("#reasoning_prefix").val(e.prefix)),void 0!==e.suffix&&(t.reasoning.suffix=e.suffix,i&&i("#reasoning_suffix").val(e.suffix)),void 0!==e.showHidden&&(t.reasoning.show_hidden=e.showHidden,i&&i("#reasoning_show_hidden").prop("checked",e.showHidden)),void 0!==e.autoExpand&&(t.reasoning.auto_expand=e.autoExpand,i&&i("#reasoning_auto_expand").prop("checked",e.autoExpand)),void 0!==e.addToPrompts&&(t.reasoning.add_to_prompts=e.addToPrompts,i&&i("#reasoning_add_to_prompts").prop("checked",e.addToPrompts)),n.saveSettingsDebounced(),console.log("[".concat(kt,"] Reasoning settings updated")),Nt()}function Ut(){var e;const n=(0,r.SD)();return null!=n&&null!==(e=n.powerUserSettings)&&void 0!==e&&e.reasoning?xt({},n.powerUserSettings.reasoning):null}function Ht(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{showInUI:t=!0}=n,i=(0,r.SD)();if(!i)return void console.warn("[".concat(kt,"] Context not available for Start Reply With"));const o=i.powerUserSettings;if(!o)return void console.warn("[".concat(kt,"] Power user settings not available"));o.user_prompt_bias=e,t&&(o.show_user_prompt_bias=!0);const a=window.jQuery;if(a){const n=a("#start_reply_with");n.length&&n.val(e)}i.saveSettingsDebounced(),console.log("[".concat(kt,'] Start Reply With set to: "').concat(e.substring(0,50),'..."')),Nt()}function Wt(){var e;const n=(0,r.SD)();return(null==n||null===(e=n.powerUserSettings)||void 0===e?void 0:e.user_prompt_bias)||""}const Vt=["auto","low","medium","high","min","max"];function qt(){const e=(0,r.SD)();return null!=e&&e.chatCompletionSettings?{enabled:!!e.chatCompletionSettings.show_thoughts,effort:e.chatCompletionSettings.reasoning_effort||"auto"}:{enabled:!1,effort:"auto"}}const $t=[{value:"",label:"None (Default)"},{value:"merge",label:"Merge (Recommended for Claude/OpenAI)"},{value:"merge_tools",label:"Merge (preserve tool calls)"},{value:"semi",label:"Semi-alternation"},{value:"semi_tools",label:"Semi-alternation (with tools)"},{value:"strict",label:"Strict alternation"},{value:"strict_tools",label:"Strict alternation (with tools)"},{value:"single",label:"Single (last user message only)"}];function Yt(){var e;const n=(0,r.SD)();return(null==n||null===(e=n.chatCompletionSettings)||void 0===e?void 0:e.custom_prompt_post_processing)||""}const Gt={deepseek:{autoParse:!0,prefix:"<think>\n",suffix:"\n</think>",showHidden:!0,autoExpand:!1,addToPrompts:!1},openai_o1:{autoParse:!0,prefix:"<reasoning>\n",suffix:"\n</reasoning>",showHidden:!0,autoExpand:!1,addToPrompts:!1},claude_extended:{autoParse:!0,prefix:"<thinking>\n",suffix:"\n</thinking>",showHidden:!0,autoExpand:!1,addToPrompts:!1}};function Kt(){const[e,n]=(0,Ce.useState)(null),[t,i]=(0,Ce.useState)(""),[o,a]=(0,Ce.useState)({enabled:!1,effort:"auto"}),[s,l]=(0,Ce.useState)(""),c=(0,Ce.useRef)({startReplyWith:""});c.current.startReplyWith=t,(0,Ce.useEffect)(()=>{n(Ut()),i(Wt()),a(qt()),l(Yt());var e;return e=e=>{n(e.reasoning),i(e.startReplyWith),a(e.apiReasoning),l(e.postProcessing)},St.add(e),()=>St.delete(e)},[]);const u=(0,Ce.useCallback)(()=>{n(Ut()),i(Wt()),a(qt()),l(Yt())},[]),d=(0,Ce.useCallback)(function(e){const t=Gt[e];t&&(arguments.length>1&&void 0!==arguments[1]&&arguments[1]?function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const t=Gt[e];if(!t)return void console.warn("[".concat(kt,"] Unknown reasoning preset: ").concat(e));Ft(t),Ht(n||"".concat(t.prefix,"\n"))}(e):Ft(t),n(Ut()),i(Wt()))},[]),m=(0,Ce.useCallback)(e=>{i(e),Ht(e)},[]),p=(0,Ce.useCallback)((e,t)=>{Ft({[e]:t}),n(Ut())},[]);return{reasoningSettings:e,startReplyWith:t,apiReasoning:o,postProcessing:s,handleApplyReasoningPreset:d,handleStartReplyWithChange:m,handleReasoningToggle:p,handleAPIReasoningToggle:(0,Ce.useCallback)(e=>{!function(e){const n=(0,r.SD)();if(null==n||!n.chatCompletionSettings)return void console.warn("[".concat(kt,"] Chat completion settings not available"));n.chatCompletionSettings.show_thoughts=!!e;const t=window.jQuery;t&&t("#openai_show_thoughts").prop("checked",!!e),e||(n.chatCompletionSettings.reasoning_effort="auto",t&&t("#openai_reasoning_effort").val("auto")),n.saveSettingsDebounced(),console.log("[".concat(kt,"] Include Reasoning set to: ").concat(e)),Nt()}(e),a(qt()),e&&c.current.startReplyWith&&(i(""),Ht(""))},[]),handleReasoningEffortChange:(0,Ce.useCallback)(e=>{!function(e){const n=(0,r.SD)();if(null==n||!n.chatCompletionSettings)return void console.warn("[".concat(kt,"] Chat completion settings not available"));if(!Vt.includes(e))return void console.warn("[".concat(kt,"] Invalid reasoning effort: ").concat(e));n.chatCompletionSettings.reasoning_effort=e;const t=window.jQuery;t&&t("#openai_reasoning_effort").val(e),n.saveSettingsDebounced(),console.log("[".concat(kt,"] Reasoning Effort set to: ").concat(e)),Nt()}(e),a(qt())},[]),handlePostProcessingChange:(0,Ce.useCallback)(e=>{l(e),function(e){const n=(0,r.SD)();if(null==n||!n.chatCompletionSettings)return void console.warn("[".concat(kt,"] Chat completion settings not available"));if(!$t.map(e=>e.value).includes(e))return void console.warn("[".concat(kt,"] Invalid post-processing strategy: ").concat(e));n.chatCompletionSettings.custom_prompt_post_processing=e;const t=window.jQuery;t&&t("#custom_prompt_post_processing").val(e),n.saveSettingsDebounced(),console.log("[".concat(kt,"] Post-processing set to: ").concat(e||"(none)")),Nt()}(e)},[]),refreshState:u,REASONING_EFFORT_LEVELS:Vt,POST_PROCESSING_OPTIONS:$t}}const Qt=Sn("sparkles",[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]]),Xt=Sn("tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]),Zt=Sn("gauge",[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]]),Jt=Sn("layers",[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]]);function er(e){let{reasoningSettings:n,startReplyWith:t,apiReasoning:r,postProcessing:i="",onApplyReasoningPreset:o,onStartReplyWithChange:a,onReasoningToggle:s,onAPIReasoningToggle:l,onReasoningEffortChange:c,onPostProcessingChange:u,effortLevels:d=["auto","low","medium","high","min","max"],postProcessingOptions:m=[{value:"",label:"None (Default)"},{value:"merge",label:"Merge (Recommended for Claude/OpenAI)"},{value:"merge_tools",label:"Merge (preserve tool calls)"},{value:"semi",label:"Semi-alternation"},{value:"semi_tools",label:"Semi-alternation (with tools)"},{value:"strict",label:"Strict alternation"},{value:"strict_tools",label:"Strict alternation (with tools)"},{value:"single",label:"Single (last user message only)"}],compact:p=!1}=e;return(0,Ee.jsxs)("div",{className:On("lumiverse-presets-reasoning",p&&"lumiverse-presets-reasoning--compact"),children:[(0,Ee.jsxs)("div",{className:"lumiverse-presets-reasoning-quick",children:[(0,Ee.jsxs)("span",{className:"lumiverse-presets-reasoning-label",children:[(0,Ee.jsx)(Qt,{size:12,strokeWidth:2}),"Quick Presets"]}),(0,Ee.jsxs)("div",{className:"lumiverse-presets-reasoning-btns",children:[(0,Ee.jsxs)("button",{className:"lumiverse-presets-reasoning-btn lumiverse-presets-reasoning-btn--deepseek",onClick:()=>o("deepseek",!1),title:"Apply DeepSeek <think> tags",type:"button",children:[(0,Ee.jsx)("span",{className:"lumiverse-presets-reasoning-btn-label",children:"DeepSeek"}),(0,Ee.jsx)("code",{children:"<think>"})]}),(0,Ee.jsxs)("button",{className:"lumiverse-presets-reasoning-btn lumiverse-presets-reasoning-btn--claude",onClick:()=>o("claude_extended",!1),title:"Apply Claude <thinking> tags",type:"button",children:[(0,Ee.jsx)("span",{className:"lumiverse-presets-reasoning-btn-label",children:"Claude"}),(0,Ee.jsx)("code",{children:"<thinking>"})]}),(0,Ee.jsxs)("button",{className:"lumiverse-presets-reasoning-btn lumiverse-presets-reasoning-btn--o1",onClick:()=>o("openai_o1",!1),title:"Apply o1 <reasoning> tags",type:"button",children:[(0,Ee.jsx)("span",{className:"lumiverse-presets-reasoning-btn-label",children:"o1"}),(0,Ee.jsx)("code",{children:"<reasoning>"})]})]})]}),n&&(0,Ee.jsxs)("div",{className:"lumiverse-presets-reasoning-current",children:[(0,Ee.jsx)("div",{className:"lumiverse-presets-reasoning-row",children:(0,Ee.jsxs)("label",{className:"lumiverse-presets-reasoning-checkbox",children:[(0,Ee.jsx)("input",{type:"checkbox",checked:n.auto_parse||!1,onChange:e=>s("autoParse",e.target.checked)}),(0,Ee.jsx)("span",{className:"lumiverse-presets-reasoning-checkmark"}),(0,Ee.jsx)("span",{children:"Auto-parse thoughts"})]})}),(0,Ee.jsxs)("div",{className:"lumiverse-presets-reasoning-tags",children:[(0,Ee.jsx)(Xt,{size:12,strokeWidth:2}),(0,Ee.jsx)("span",{children:"Tags:"}),(0,Ee.jsx)("code",{children:(n.prefix||"<think>").replace(/\n/g,"↵")}),(0,Ee.jsx)("span",{className:"lumiverse-presets-reasoning-tags-sep",children:"/"}),(0,Ee.jsx)("code",{children:(n.suffix||"</think>").replace(/\n/g,"↵")})]})]}),(0,Ee.jsxs)("div",{className:"lumiverse-presets-api-reasoning",children:[(0,Ee.jsxs)("span",{className:"lumiverse-presets-reasoning-label",children:[(0,Ee.jsx)(Zt,{size:12,strokeWidth:2}),"API Reasoning (for supported models)"]}),(0,Ee.jsxs)("div",{className:"lumiverse-presets-api-reasoning-controls",children:[(0,Ee.jsxs)("label",{className:"lumiverse-presets-reasoning-checkbox",children:[(0,Ee.jsx)("input",{type:"checkbox",checked:r.enabled,onChange:e=>l(e.target.checked)}),(0,Ee.jsx)("span",{className:"lumiverse-presets-reasoning-checkmark"}),(0,Ee.jsx)("span",{children:"Include Reasoning"})]}),(0,Ee.jsxs)("div",{className:"lumiverse-presets-api-reasoning-effort",children:[(0,Ee.jsx)("span",{className:"lumiverse-presets-api-reasoning-effort-label",children:"Effort:"}),(0,Ee.jsx)("select",{className:"lumiverse-presets-api-reasoning-select",value:r.effort,onChange:e=>c(e.target.value),disabled:!r.enabled,children:d.map(e=>(0,Ee.jsx)("option",{value:e,children:e.charAt(0).toUpperCase()+e.slice(1)},e))})]})]}),(0,Ee.jsx)("p",{className:"lumiverse-presets-api-reasoning-hint",children:"For o1/o3, Grok 3, DeepSeek R1, and other reasoning models"})]}),(0,Ee.jsxs)("div",{className:On("lumiverse-presets-startreply",r.enabled&&"is-disabled"),children:[(0,Ee.jsxs)("label",{className:"lumiverse-presets-startreply-label",children:[(0,Ee.jsx)(ut,{size:12,strokeWidth:2}),(0,Ee.jsx)("span",{children:"Start Reply With (Prompt Bias)"}),r.enabled&&(0,Ee.jsx)("span",{className:"lumiverse-presets-startreply-disabled-hint",children:"Disabled when API Reasoning is on"})]}),(0,Ee.jsx)("div",{className:"lumiverse-presets-startreply-input-wrap",children:(0,Ee.jsx)("textarea",{className:"lumiverse-presets-startreply-input",value:t,onChange:e=>a(e.target.value),placeholder:r.enabled?"Disabled while API Reasoning is active":"Force AI to start response with...",rows:2,disabled:r.enabled})}),(0,Ee.jsxs)("div",{className:"lumiverse-presets-startreply-quick",children:[(0,Ee.jsx)("button",{className:"lumiverse-presets-startreply-btn",onClick:()=>a("<think>\n"),title:"Set to <think> tag with newline",type:"button",disabled:r.enabled,children:"<think>↵"}),(0,Ee.jsx)("button",{className:"lumiverse-presets-startreply-btn lumiverse-presets-startreply-btn--claude",onClick:()=>a("<think>"),title:"Set to <think> tag (Claude, no newline)",type:"button",disabled:r.enabled,children:"<think>"}),(0,Ee.jsx)("button",{className:"lumiverse-presets-startreply-btn lumiverse-presets-startreply-btn--claude",onClick:()=>a("<thinking>"),title:"Set to <thinking> tag (Claude, no newline)",type:"button",disabled:r.enabled,children:"<thinking>"}),(0,Ee.jsx)("button",{className:"lumiverse-presets-startreply-btn lumiverse-presets-startreply-btn--clear",onClick:()=>a(""),title:"Clear",type:"button",disabled:r.enabled,children:(0,Ee.jsx)(mt,{size:12,strokeWidth:2})})]})]}),u&&(0,Ee.jsxs)("div",{className:"lumiverse-presets-postprocessing",children:[(0,Ee.jsxs)("label",{className:"lumiverse-presets-postprocessing-label",children:[(0,Ee.jsx)(Jt,{size:12,strokeWidth:2}),(0,Ee.jsx)("span",{children:"Prompt Post-Processing"})]}),(0,Ee.jsx)("select",{className:"lumiverse-presets-postprocessing-select",value:i,onChange:e=>u(e.target.value),children:m.map(e=>(0,Ee.jsx)("option",{value:e.value,children:e.label},e.value))}),(0,Ee.jsx)("p",{className:"lumiverse-presets-postprocessing-hint",children:"Controls how messages are combined before sending to the API"})]})]})}function nr(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function tr(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?nr(Object(t),!0).forEach(function(n){rr(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):nr(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function rr(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function ir(){const e=Xe(),[n,t]=(0,Ce.useState)(!1),[r,i]=(0,Ce.useState)({}),[o,a]=(0,Ce.useState)(null),[s,l]=(0,Ce.useState)(""),[c,u]=(0,Ce.useState)([]),d=(0,Ce.useRef)(null);(0,Ce.useEffect)(()=>{i(At()),a(Ut()),l(Wt());const n=(t=n=>{i(n),Lt().then(n=>{u(n),e.setPresetUpdates(n)})},jt.add(t),()=>jt.delete(t));var t;const r=setTimeout(()=>{Lt().then(n=>{u(n),e.setPresetUpdates(n)})},5e3);return d.current=setInterval(()=>{Lt().then(n=>{u(n),e.setPresetUpdates(n)})},18e5),()=>{n(),clearTimeout(r),d.current&&clearInterval(d.current)}},[e]);const m=(0,Ce.useCallback)(()=>{t(!0)},[]),p=(0,Ce.useCallback)(()=>{t(!1),i(At()),a(Ut()),l(Wt()),Lt().then(n=>{u(n),e.setPresetUpdates(n)})},[e]),g=(0,Ce.useMemo)(()=>Object.entries(r).map(e=>{let[n,t]=e;const r=c.find(e=>e.slug===n);return{slug:n,name:t.name,version:t.version,versionName:t.versionName,hasUpdate:!!r,latestVersionName:null==r?void 0:r.latestVersionName}}),[r,c]),h=(0,Ce.useMemo)(()=>null!=o&&o.auto_parse?o.prefix||"<think>":null,[o]),v=(0,Ce.useMemo)(()=>{if(!s)return null;return s.slice(0,20).replace(/\n/g,"↵")+(s.length>20?"…":"")},[s]),f=c.length;return(0,Ee.jsxs)(Ee.Fragment,{children:[g.length>0?(0,Ee.jsxs)("div",{className:"lumiverse-presets-inventory",children:[(0,Ee.jsxs)("div",{className:"lumiverse-presets-inventory-header",children:[(0,Ee.jsxs)("span",{className:"lumiverse-presets-inventory-label",children:[(0,Ee.jsx)(Nn,{size:12,strokeWidth:2}),"Imported Presets"]}),f>0&&(0,Ee.jsxs)("span",{className:"lumiverse-presets-inventory-updates",children:[(0,Ee.jsx)(at,{size:11,strokeWidth:2}),f," update",1!==f?"s":""]})]}),(0,Ee.jsx)("div",{className:"lumiverse-presets-inventory-list",children:g.map(e=>(0,Ee.jsxs)("div",{className:On("lumiverse-presets-inventory-item",e.hasUpdate&&"has-update"),children:[(0,Ee.jsx)("div",{className:"lumiverse-presets-inventory-item-icon",children:e.hasUpdate?(0,Ee.jsx)(at,{size:14,strokeWidth:1.5}):(0,Ee.jsx)(st,{size:14,strokeWidth:1.5})}),(0,Ee.jsxs)("div",{className:"lumiverse-presets-inventory-item-info",children:[(0,Ee.jsx)("span",{className:"lumiverse-presets-inventory-item-name",children:e.name}),(0,Ee.jsx)("span",{className:"lumiverse-presets-inventory-item-version",children:e.hasUpdate?(0,Ee.jsxs)(Ee.Fragment,{children:[Tt(e.version)," → ",e.latestVersionName]}):(0,Ee.jsxs)(Ee.Fragment,{children:["v",Tt(e.version)]})})]}),e.hasUpdate&&(0,Ee.jsx)("span",{className:"lumiverse-presets-inventory-item-badge",children:"Update"})]},e.slug))})]}):(0,Ee.jsxs)("div",{className:"lumiverse-presets-empty-state",children:[(0,Ee.jsx)(lt,{size:20,strokeWidth:1.5}),(0,Ee.jsx)("span",{children:"No presets imported yet"})]}),(h||v)&&(0,Ee.jsxs)("div",{className:"lumiverse-presets-reasoning-status",children:[h&&(0,Ee.jsxs)("div",{className:"lumiverse-presets-reasoning-status-item",children:[(0,Ee.jsx)(ct,{size:12,strokeWidth:2}),(0,Ee.jsx)("span",{children:"CoT:"}),(0,Ee.jsx)("code",{children:h})]}),v&&(0,Ee.jsxs)("div",{className:"lumiverse-presets-reasoning-status-item",children:[(0,Ee.jsx)(ut,{size:12,strokeWidth:2}),(0,Ee.jsx)("span",{children:"Bias:"}),(0,Ee.jsx)("code",{children:v})]})]}),(0,Ee.jsxs)("div",{className:"lumia-chat-presets-actions",style:{display:"flex",gap:"8px",flexDirection:"column"},children:[(0,Ee.jsxs)("button",{className:"lumia-btn lumia-btn-primary lumia-btn-full",onClick:m,type:"button",children:[(0,Ee.jsx)(dt,{size:14,strokeWidth:2}),f>0?"Configure (".concat(f," update").concat(1!==f?"s":"",")"):"Download & Configure"]}),(0,Ee.jsxs)("button",{className:"lumia-btn lumia-btn-secondary lumia-btn-full",onClick:()=>e.openModal("presetEditor"),type:"button",children:[(0,Ee.jsx)(En,{size:14,strokeWidth:2}),"Preset Editor"]})]}),n&&(0,Ee.jsx)(or,{onClose:p,availableUpdates:c,onUpdateComplete:()=>{i(At()),Lt().then(u)}})]})}function or(e){let{onClose:n,availableUpdates:t=[],onUpdateComplete:r}=e;const[i,o]=(0,Ce.useState)(null),[a,s]=(0,Ce.useState)(!1),[l,c]=(0,Ce.useState)(null),[u,d]=(0,Ce.useState)(null),[m,p]=(0,Ce.useState)(null),{reasoningSettings:g,startReplyWith:h,apiReasoning:v,postProcessing:f,handleApplyReasoningPreset:b,handleStartReplyWithChange:x,handleReasoningToggle:y,handleAPIReasoningToggle:k,handleReasoningEffortChange:w,handlePostProcessingChange:j,REASONING_EFFORT_LEVELS:C,POST_PROCESSING_OPTIONS:S}=Kt(),N=(0,Ce.useRef)(null),E=(0,Ce.useRef)(null),P=(0,Ce.useCallback)(function(e){var n;b(e,arguments.length>1&&void 0!==arguments[1]&&arguments[1]),null===(n=toastr)||void 0===n||n.success("Applied ".concat(e," reasoning settings"),"Reasoning Updated")},[b]);(0,Ce.useEffect)(()=>{const e=e=>{"Escape"===e.key&&n()};return document.addEventListener("keydown",e),document.body.style.overflow="hidden",()=>{document.removeEventListener("keydown",e),document.body.style.overflow=""}},[n]);const D=(0,Ce.useCallback)(async()=>{s(!0),c(null);try{const e=await async function(){try{const e=await fetch("".concat(wt,"/api/download/chat-presets"));if(!e.ok)throw new Error("HTTP ".concat(e.status,": ").concat(e.statusText));const n=await e.json();if(!n.success)throw new Error(n.error||"Unknown API error");return n}catch(e){throw console.error("[".concat(kt,"] Failed to fetch presets:"),e),e}}();o(e.presets||[])}catch(e){c(e.message),console.error("[ChatPresets] Failed to load:",e)}finally{s(!1)}},[]),M=(0,Ce.useCallback)(async(e,n,t)=>{p("".concat(e,"-").concat(n));try{const a=await _t(e,n,{activate:!0});var i,o;if(a.success)null===(i=toastr)||void 0===i||i.success("Imported: ".concat(t||n),"Preset Added"),null==r||r();else null===(o=toastr)||void 0===o||o.error(a.message,"Import Failed")}catch(e){var a;null===(a=toastr)||void 0===a||a.error(e.message,"Download Failed")}finally{p(null)}},[r]),O=(0,Ce.useCallback)(e=>{e.target===e.currentTarget&&n()},[n]),T=(0,Ce.useCallback)(e=>{e.stopPropagation()},[]);return(0,ot.createPortal)((0,Ee.jsx)("div",{className:"lumiverse-modal-backdrop",onClick:O,onMouseDown:T,onMouseUp:T,children:(0,Ee.jsxs)("div",{ref:N,className:"lumiverse-modal lumiverse-presets-modal",onClick:T,role:"dialog","aria-modal":"true",children:[(0,Ee.jsxs)("div",{className:"lumiverse-presets-modal-header",children:[(0,Ee.jsxs)("div",{className:"lumiverse-presets-modal-header-info",children:[(0,Ee.jsx)("span",{className:"lumiverse-presets-modal-header-icon",children:(0,Ee.jsx)(lt,{size:22,strokeWidth:1.5})}),(0,Ee.jsxs)("div",{className:"lumiverse-presets-modal-header-text",children:[(0,Ee.jsx)("h3",{className:"lumiverse-presets-modal-title",children:"Chat Presets"}),(0,Ee.jsx)("p",{className:"lumiverse-presets-modal-subtitle",children:"Download presets from Lucid.cards & configure reasoning"})]})]}),(0,Ee.jsx)("button",{className:"lumiverse-presets-modal-close",onClick:n,title:"Close",type:"button",children:(0,Ee.jsx)(mt,{size:18,strokeWidth:2})})]}),(0,Ee.jsxs)("div",{className:"lumiverse-presets-modal-content",ref:E,children:[(0,Ee.jsxs)("div",{className:"lumiverse-presets-section",children:[(0,Ee.jsxs)("div",{className:"lumiverse-presets-section-header",children:[(0,Ee.jsxs)("div",{className:"lumiverse-presets-section-title",children:[(0,Ee.jsx)(Dn,{size:14,strokeWidth:2}),(0,Ee.jsx)("span",{children:"Download Presets"})]}),(0,Ee.jsx)("button",{className:On("lumiverse-presets-refresh",a&&"is-loading"),onClick:D,disabled:a,title:"Refresh preset list",type:"button",children:(0,Ee.jsx)(pt,{size:14,strokeWidth:2})})]}),!i&&!a&&!l&&(0,Ee.jsxs)("div",{className:"lumiverse-presets-empty",children:[(0,Ee.jsx)("div",{className:"lumiverse-presets-empty-icon",children:(0,Ee.jsx)(Nn,{size:28,strokeWidth:1})}),(0,Ee.jsx)("span",{className:"lumiverse-presets-empty-text",children:"Browse curated Chat Completion presets"}),(0,Ee.jsxs)("button",{className:"lumiverse-presets-empty-btn",onClick:D,type:"button",children:[(0,Ee.jsx)(pt,{size:14,strokeWidth:2}),"Load Presets"]})]}),a&&(0,Ee.jsxs)("div",{className:"lumiverse-presets-loading",children:[(0,Ee.jsx)("div",{className:"lumiverse-presets-loading-spinner",children:(0,Ee.jsx)(gt,{size:22,strokeWidth:1.5})}),(0,Ee.jsx)("span",{children:"Fetching presets..."})]}),l&&(0,Ee.jsxs)("div",{className:"lumiverse-presets-error",children:[(0,Ee.jsx)(ht,{size:16,strokeWidth:1.5}),(0,Ee.jsx)("span",{children:l}),(0,Ee.jsx)("button",{onClick:D,type:"button",children:"Retry"})]}),i&&i.length>0&&(0,Ee.jsx)("div",{className:"lumiverse-presets-list",children:i.map((e,n)=>{const r=t.find(n=>n.slug===e.slug);return(0,Ee.jsx)(sr,{preset:e,isExpanded:u===e.slug,onToggle:()=>d(u===e.slug?null:e.slug),onDownload:M,downloadingVersion:m,animationIndex:n,updateAvailable:r},e.slug)})})]}),(0,Ee.jsxs)("div",{className:"lumiverse-presets-section",children:[(0,Ee.jsx)("div",{className:"lumiverse-presets-section-header",children:(0,Ee.jsxs)("div",{className:"lumiverse-presets-section-title",children:[(0,Ee.jsx)(ct,{size:14,strokeWidth:2}),(0,Ee.jsx)("span",{children:"Reasoning / Chain of Thought"})]})}),(0,Ee.jsx)(er,{reasoningSettings:g,startReplyWith:h,apiReasoning:v,postProcessing:f,onApplyReasoningPreset:P,onStartReplyWithChange:x,onReasoningToggle:y,onAPIReasoningToggle:k,onReasoningEffortChange:w,onPostProcessingChange:j,effortLevels:C,postProcessingOptions:S})]})]}),(0,Ee.jsx)("div",{className:"lumiverse-presets-modal-footer",children:(0,Ee.jsx)("button",{className:"lumiverse-presets-modal-btn lumiverse-presets-modal-btn--primary",onClick:n,type:"button",children:"Done"})})]})}),document.body)}const ar=3;function sr(e){let{preset:n,isExpanded:t,onToggle:r,onDownload:i,downloadingVersion:o,animationIndex:a,updateAvailable:s}=e;const[l,c]=(0,Ce.useState)(!1),u=(0,Ce.useMemo)(()=>{var e,t;const r=[];return null!==(e=n.versions)&&void 0!==e&&e.standard&&n.versions.standard.forEach(e=>{r.push(tr(tr({},e),{},{isProlix:!1}))}),null!==(t=n.versions)&&void 0!==t&&t.prolix&&n.versions.prolix.forEach(e=>{r.push(tr(tr({},e),{},{isProlix:!0}))}),r.sort((e,n)=>e.isLatest&&!n.isLatest?-1:!e.isLatest&&n.isLatest?1:n.name.localeCompare(e.name,void 0,{numeric:!0}))},[n.versions]),d=(0,Ce.useMemo)(()=>l||u.length<=ar?u:u.slice(0,ar),[u,l]),m=u.length-ar,p=m>0&&!l,g={"--card-delay":"".concat(Math.min(40*a,250),"ms")};(0,Ce.useEffect)(()=>{t||c(!1)},[t]);const h=(0,Ce.useCallback)(e=>{e.target.closest("button")||r()},[r]),v=(0,Ce.useCallback)(e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),r())},[r]);return(0,Ee.jsxs)("div",{className:On("lumiverse-preset-card",t&&"is-expanded",s&&"has-update"),style:g,onClick:h,onKeyDown:v,role:"button",tabIndex:0,"aria-expanded":t,"aria-label":"".concat(n.name," preset").concat(s?" - update available":""),children:[(0,Ee.jsxs)("div",{className:"lumiverse-preset-card-header",children:[(0,Ee.jsx)("div",{className:On("lumiverse-preset-card-icon",s&&"has-update"),children:s?(0,Ee.jsx)(at,{size:16,strokeWidth:1.5}):(0,Ee.jsx)(st,{size:16,strokeWidth:1.5})}),(0,Ee.jsxs)("div",{className:"lumiverse-preset-card-info",children:[(0,Ee.jsxs)("span",{className:"lumiverse-preset-card-name",children:[n.name,s&&(0,Ee.jsx)("span",{className:"lumiverse-preset-card-update-badge",children:"Update"})]}),(0,Ee.jsx)("span",{className:"lumiverse-preset-card-meta",children:s?(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsx)(at,{size:10,strokeWidth:2}),Tt(s.currentVersion)," → ",s.latestVersionName]}):(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsx)(vt,{size:10,strokeWidth:2}),n.totalVersions," version",1!==n.totalVersions?"s":""]})})]}),(0,Ee.jsxs)("div",{className:"lumiverse-preset-card-actions",children:[(0,Ee.jsx)("button",{className:"lumiverse-preset-card-download",onClick:e=>{var t;e.stopPropagation(),i(n.slug,"latest",null===(t=n.latestVersion)||void 0===t?void 0:t.name)},disabled:o==="".concat(n.slug,"-latest"),title:"Download latest version",type:"button",children:o==="".concat(n.slug,"-latest")?(0,Ee.jsx)(gt,{size:14,strokeWidth:2,className:"lumiverse-spin"}):(0,Ee.jsx)(Dn,{size:14,strokeWidth:2})}),(0,Ee.jsx)(An,{size:14,strokeWidth:2,className:"lumiverse-preset-card-chevron"})]})]}),(0,Ee.jsx)("div",{className:On("lumiverse-preset-card-versions",t&&"is-expanded"),role:"region","aria-label":"".concat(n.name," versions"),children:(0,Ee.jsxs)("div",{className:"lumiverse-preset-card-versions-inner",children:[d.map(e=>{const t="".concat(n.slug,"-").concat(e.slug),r=o===t;return(0,Ee.jsxs)("div",{className:On("lumiverse-preset-version",e.isProlix&&"is-prolix",e.isLatest&&"is-latest"),children:[(0,Ee.jsxs)("div",{className:"lumiverse-preset-version-info",children:[(0,Ee.jsx)("span",{className:"lumiverse-preset-version-name",children:e.name}),(0,Ee.jsxs)("div",{className:"lumiverse-preset-version-badges",children:[e.isLatest&&(0,Ee.jsx)("span",{className:"lumiverse-preset-version-badge is-latest",children:"Latest"}),e.isProlix&&(0,Ee.jsx)("span",{className:"lumiverse-preset-version-badge is-prolix",children:"Prolix"})]})]}),(0,Ee.jsx)("button",{className:"lumiverse-preset-version-download",onClick:t=>{t.stopPropagation(),i(n.slug,e.slug,e.name)},disabled:r,type:"button","aria-label":"Download ".concat(e.name),children:r?(0,Ee.jsx)(gt,{size:12,strokeWidth:2,className:"lumiverse-spin"}):(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsx)(Dn,{size:12,strokeWidth:2}),(0,Ee.jsx)("span",{children:"Add"})]})})]},e.slug)}),p&&(0,Ee.jsxs)("button",{className:"lumiverse-preset-versions-showmore",onClick:e=>{e.stopPropagation(),c(!0)},type:"button",children:[(0,Ee.jsx)(Tn,{size:12,strokeWidth:2}),(0,Ee.jsxs)("span",{children:["Show ",m," more version",1!==m?"s":""]})]})]})})]})}const lr=Sn("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),cr=Sn("link-2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]),ur=Sn("message-square",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]]),dr=Sn("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),mr=Sn("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),pr=Sn("link-2-off",[["path",{d:"M9 17H7A5 5 0 0 1 7 7",key:"10o201"}],["path",{d:"M15 7h2a5 5 0 0 1 4 8",key:"1d3206"}],["line",{x1:"8",x2:"12",y1:"12",y2:"12",key:"rvw6j4"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]),gr=e=>{var n;return null!==(n=e.disableDefaultStateRestore)&&void 0!==n&&n};function hr(){const[e,n]=(0,Ce.useState)(()=>se()),[i,o]=(0,Ce.useState)(()=>ye()),[a,s]=(0,Ce.useState)([]),[l,c]=(0,Ce.useState)(!1),[u,d]=(0,Ce.useState)(!1),m=Qe(gr),p=Xe();(0,Ce.useEffect)(()=>{ke(e=>{n(e||se())}),s(ne.getAvailablePresets()),c(ne.hasChatToggleState()),d(ne.hasCharacterToggleState());const e=(0,Q.nF)(()=>{c(ne.hasChatToggleState()),d(ne.hasCharacterToggleState())}),t=setInterval(()=>{o(ye()),c(ne.hasChatToggleState()),d(ne.hasCharacterToggleState())},2e3);return()=>{ke(null),clearInterval(t),e()}},[]);const g=(0,Ce.useCallback)(()=>{o(ye()),c(ne.hasChatToggleState()),d(ne.hasCharacterToggleState())},[]),h=(0,Ce.useCallback)(()=>{s(ne.getAvailablePresets()),o(ye()),c(ne.hasChatToggleState()),d(ne.hasCharacterToggleState())},[]),v=(0,Ce.useMemo)(()=>he(),[e,i]),f=(0,Ce.useCallback)(e=>{const t=i.characterAvatar;return t?(ce(t,e),n(se()),!0):(console.warn("[usePresetBindings] No current character to bind"),!1)},[i.characterAvatar]),b=(0,Ce.useCallback)(e=>{const t=i.chatId;return t?(ue(t,e),n(se()),!0):(console.warn("[usePresetBindings] No current chat to bind"),!1)},[i.chatId]),x=(0,Ce.useCallback)(e=>{ce(e,null),n(se())},[]),y=(0,Ce.useCallback)(e=>{ue(e,null),n(se())},[]),k=(0,Ce.useMemo)(()=>function(){const e=se(),n=(0,r.SD)(),t=[];for(const[r,i]of Object.entries(e.characters)){let e=r;if(null!=n&&n.characters){const t=n.characters.find(e=>e.avatar===r);null!=t&&t.name&&(e=t.name)}t.push({type:"character",id:r,displayName:e,presetName:i})}for(const[n,r]of Object.entries(e.chats))t.push({type:"chat",id:n,displayName:n,presetName:r});return t}(),[e]),w=(0,Ce.useMemo)(()=>i.characterAvatar?de(i.characterAvatar):null,[i.characterAvatar,e]),j=(0,Ce.useMemo)(()=>i.chatId?me(i.chatId):null,[i.chatId,e]),C=(0,Ce.useCallback)(async()=>{var e;const n=ne.captureCurrentToggles();if(!n||0===Object.keys(n).length)return console.warn("[usePresetBindings] No toggles to save (prompt_order empty or unavailable)"),!1;const r=ne.getCurrentChatId();if(!r)return console.warn("[usePresetBindings] No current chat to bind toggles"),!1;const{setChatToggleBinding:i}=await Promise.resolve().then(t.bind(t,699));return await i(r,{toggles:n,sourcePreset:(null===(e=ne.getCurrentPreset())||void 0===e?void 0:e.name)||null}),c(!0),console.log("[usePresetBindings] Saved ".concat(Object.keys(n).length,' toggle states to chat "').concat(r,'"')),!0},[]),S=(0,Ce.useCallback)(async()=>{const e=await ne.clearChatToggleState();return e&&c(!1),e},[]),N=(0,Ce.useCallback)(async()=>{var e;const n=ne.captureCurrentToggles();if(!n||0===Object.keys(n).length)return console.warn("[usePresetBindings] No toggles to save (prompt_order empty or unavailable)"),!1;const r=ne.getCurrentCharacterAvatar();if(!r)return console.warn("[usePresetBindings] No current character to bind toggles"),!1;const{setCharacterToggleBinding:i}=await Promise.resolve().then(t.bind(t,699));return await i(r,{toggles:n,sourcePreset:(null===(e=ne.getCurrentPreset())||void 0===e?void 0:e.name)||null}),d(!0),console.log("[usePresetBindings] Saved ".concat(Object.keys(n).length,' toggle states to character "').concat(r,'"')),!0},[]),E=(0,Ce.useCallback)(async()=>{const e=await ne.clearCharacterToggleState();return e&&d(!1),e},[]);return{bindings:e,contextInfo:i,availablePresets:a,currentBinding:v,allBindings:k,currentCharacterBinding:w,currentChatBinding:j,hasChatToggleBinding:l,hasCharacterToggleBinding:u,disableDefaultStateRestore:m,hasDefaultToggles:ve(),bindCurrentCharacter:f,bindCurrentChat:b,removeCharacterBinding:x,removeChatBinding:y,refreshPresets:h,refreshContext:g,saveTogglesToChat:C,clearChatToggleBinding:S,saveTogglesToCharacter:N,clearCharacterToggleBinding:E,setDisableDefaultStateRestore:p.setDisableDefaultStateRestore,recaptureDefaultToggleState:we,setCharacterBinding:ce,setChatBinding:ue}}const vr=Sn("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),fr=Sn("toggle-left",[["circle",{cx:"9",cy:"12",r:"3",key:"u3jwor"}],["rect",{width:"20",height:"14",x:"2",y:"5",rx:"7",key:"g7kal2"}]]),br=Sn("toggle-right",[["circle",{cx:"15",cy:"12",r:"3",key:"1afu0r"}],["rect",{width:"20",height:"14",x:"2",y:"5",rx:"7",key:"g7kal2"}]]);function xr(e){let{compact:n=!1}=e;const{contextInfo:t,hasChatToggleBinding:r,hasCharacterToggleBinding:i,saveTogglesToChat:o,clearChatToggleBinding:a,saveTogglesToCharacter:s,clearCharacterToggleBinding:l,disableDefaultStateRestore:c,hasDefaultToggles:u,setDisableDefaultStateRestore:d,recaptureDefaultToggleState:m}=hr(),p=t.characterAvatar||t.chatId,g=(0,Ce.useCallback)(async()=>{var e,n;await o()?null===(e=toastr)||void 0===e||e.success("Prompt toggles bound to current chat"):null===(n=toastr)||void 0===n||n.error("Failed to save prompt toggles")},[o]),h=(0,Ce.useCallback)(()=>{var e;a(),null===(e=toastr)||void 0===e||e.info("Chat toggle binding cleared")},[a]),v=(0,Ce.useCallback)(async()=>{var e,n;await s()?null===(e=toastr)||void 0===e||e.success("Prompt toggles bound to ".concat(t.characterName||"character")):null===(n=toastr)||void 0===n||n.error("Failed to save prompt toggles")},[s,t.characterName]),f=(0,Ce.useCallback)(()=>{var e;l(),null===(e=toastr)||void 0===e||e.info("Character toggle binding cleared")},[l]),b=(0,Ce.useCallback)(()=>{const e=!c;var n,t;(d(e),e)?null===(n=toastr)||void 0===n||n.info("Auto-restore defaults disabled"):null===(t=toastr)||void 0===t||t.success("Auto-restore defaults enabled")},[c,d]),x=(0,Ce.useCallback)(()=>{var e,n;m()?null===(e=toastr)||void 0===e||e.success("Current toggle states captured as defaults"):null===(n=toastr)||void 0===n||n.error("Failed to capture toggle states - no toggles available")},[m]),y=(0,Ee.jsxs)("div",{className:"lumiverse-bindings-defaults-section",children:[(0,Ee.jsxs)("div",{className:"lumiverse-bindings-defaults-header",children:[(0,Ee.jsx)(vr,{size:14,strokeWidth:1.5}),(0,Ee.jsx)("span",{children:"Default State Settings"})]}),(0,Ee.jsxs)("div",{className:"lumiverse-bindings-toggle-row",children:[(0,Ee.jsx)("div",{className:"lumiverse-bindings-toggle-label",children:(0,Ee.jsx)("span",{children:"Restore defaults automatically"})}),(0,Ee.jsx)("div",{className:"lumiverse-bindings-toggle-actions",children:(0,Ee.jsx)("button",{className:"lumia-btn lumia-btn-sm ".concat(c?"lumia-btn-secondary":"lumia-btn-primary"),onClick:b,type:"button",title:c?"Defaults will NOT be restored when switching to unbound chats":"Defaults will be restored when switching to unbound chats",children:c?(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsx)(fr,{size:12,strokeWidth:2}),"Off"]}):(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsx)(br,{size:12,strokeWidth:2}),"On"]})})})]}),(0,Ee.jsxs)("div",{className:"lumiverse-bindings-toggle-row",children:[(0,Ee.jsxs)("div",{className:"lumiverse-bindings-toggle-label",children:[(0,Ee.jsx)("span",{children:"Capture current as defaults"}),u&&(0,Ee.jsx)("span",{className:"lumiverse-bindings-toggle-badge",children:"Captured"})]}),(0,Ee.jsx)("div",{className:"lumiverse-bindings-toggle-actions",children:(0,Ee.jsxs)("button",{className:"lumia-btn lumia-btn-secondary lumia-btn-sm",onClick:x,type:"button",title:"Save current toggle states as the defaults to restore for unbound chats",children:[(0,Ee.jsx)(pt,{size:12,strokeWidth:2}),n?"Capture":"Capture Now"]})})]}),(0,Ee.jsx)("div",{className:"lumiverse-bindings-defaults-info",children:(0,Ee.jsx)("span",{children:"When auto-restore is on, unbound chats will revert to captured default toggles."})})]});return p?(0,Ee.jsxs)("div",{className:"lumiverse-bindings-toggles",children:[(0,Ee.jsx)("div",{className:"lumiverse-bindings-toggles-info",children:(0,Ee.jsx)("span",{children:"Save which prompts are enabled/disabled to auto-apply when switching to this chat or character."})}),(0,Ee.jsxs)("div",{className:"lumiverse-bindings-toggle-row",children:[(0,Ee.jsxs)("div",{className:"lumiverse-bindings-toggle-label",children:[(0,Ee.jsx)(ur,{size:14,strokeWidth:1.5}),(0,Ee.jsx)("span",{children:"This Chat"}),r&&(0,Ee.jsx)("span",{className:"lumiverse-bindings-toggle-badge",children:"Bound"})]}),(0,Ee.jsx)("div",{className:"lumiverse-bindings-toggle-actions",children:r?(0,Ee.jsxs)("button",{className:"lumia-btn lumia-btn-danger lumia-btn-sm",onClick:h,type:"button",children:[(0,Ee.jsx)(Pn,{size:12,strokeWidth:2}),"Clear"]}):(0,Ee.jsxs)("button",{className:"lumia-btn lumia-btn-primary lumia-btn-sm",onClick:g,disabled:!t.chatId,type:"button",children:[(0,Ee.jsx)(br,{size:12,strokeWidth:2}),n?"Bind":"Bind Toggles"]})})]}),(0,Ee.jsxs)("div",{className:"lumiverse-bindings-toggle-row",children:[(0,Ee.jsxs)("div",{className:"lumiverse-bindings-toggle-label",children:[(0,Ee.jsx)(lr,{size:14,strokeWidth:1.5}),(0,Ee.jsx)("span",{children:t.characterName||"Character"}),i&&(0,Ee.jsx)("span",{className:"lumiverse-bindings-toggle-badge",children:"Bound"})]}),(0,Ee.jsx)("div",{className:"lumiverse-bindings-toggle-actions",children:i?(0,Ee.jsxs)("button",{className:"lumia-btn lumia-btn-danger lumia-btn-sm",onClick:f,type:"button",children:[(0,Ee.jsx)(Pn,{size:12,strokeWidth:2}),"Clear"]}):(0,Ee.jsxs)("button",{className:"lumia-btn lumia-btn-primary lumia-btn-sm",onClick:v,disabled:!t.characterAvatar,type:"button",children:[(0,Ee.jsx)(br,{size:12,strokeWidth:2}),n?"Bind":"Bind Toggles"]})})]}),(0,Ee.jsx)("div",{className:"lumiverse-bindings-toggles-priority",children:(0,Ee.jsx)("span",{children:"Priority: Chat > Character (chat binding applied first)"})}),y]}):(0,Ee.jsxs)("div",{className:"lumiverse-bindings-toggles",children:[(0,Ee.jsxs)("div",{className:"lumiverse-bindings-no-context",children:[(0,Ee.jsx)(fr,{size:20,strokeWidth:1.5}),(0,Ee.jsx)("span",{children:"Select a character to bind prompt toggles"})]}),y]})}const yr=Ye,kr=()=>yr.getState().activePresetName||"";function wr(){const[e,n]=(0,Ce.useState)(!1),{contextInfo:t,currentBinding:r,currentCharacterBinding:i,currentChatBinding:o,allBindings:a,hasChatToggleBinding:s,hasCharacterToggleBinding:l}=hr(),c=a.length>0,u=s||l,d=t.characterAvatar||t.chatId,m=(0,Ce.useMemo)(()=>{if(!r.presetName)return null;const e="chat"===r.bindingType?"Chat":"Character";return"".concat(e,": ").concat(r.presetName)},[r]);return(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsx)("div",{className:"lumiverse-bindings-status",children:d?(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsxs)("div",{className:"lumiverse-bindings-context",children:[t.characterName&&(0,Ee.jsxs)("div",{className:"lumiverse-bindings-context-item",children:[(0,Ee.jsx)(lr,{size:12,strokeWidth:2}),(0,Ee.jsx)("span",{className:"lumiverse-bindings-context-label",children:"Character:"}),(0,Ee.jsx)("span",{className:"lumiverse-bindings-context-value",children:t.characterName}),i&&(0,Ee.jsxs)("span",{className:"lumiverse-bindings-context-bound",children:[(0,Ee.jsx)(cr,{size:10}),i]})]}),t.chatId&&(0,Ee.jsxs)("div",{className:"lumiverse-bindings-context-item",children:[(0,Ee.jsx)(ur,{size:12,strokeWidth:2}),(0,Ee.jsx)("span",{className:"lumiverse-bindings-context-label",children:"Chat:"}),(0,Ee.jsx)("span",{className:"lumiverse-bindings-context-value lumiverse-bindings-context-value--mono",children:t.chatId.length>25?t.chatId.slice(0,25)+"...":t.chatId}),o&&(0,Ee.jsxs)("span",{className:"lumiverse-bindings-context-bound",children:[(0,Ee.jsx)(cr,{size:10}),o]})]})]}),m&&(0,Ee.jsxs)("div",{className:"lumiverse-bindings-active",children:[(0,Ee.jsx)(cr,{size:12,strokeWidth:2}),(0,Ee.jsxs)("span",{children:["Active: ",m]})]})]}):(0,Ee.jsxs)("div",{className:"lumiverse-bindings-empty-context",children:[(0,Ee.jsx)(lr,{size:16,strokeWidth:1.5}),(0,Ee.jsx)("span",{children:"Select a character to manage bindings"})]})}),(c||u)&&(0,Ee.jsxs)("div",{className:"lumiverse-bindings-summary",children:[c&&(0,Ee.jsxs)("span",{className:"lumiverse-bindings-summary-label",children:[(0,Ee.jsx)(cr,{size:11,strokeWidth:2}),a.length," preset binding",1!==a.length?"s":""]}),u&&(0,Ee.jsxs)("span",{className:"lumiverse-bindings-summary-label",children:[(0,Ee.jsx)(ut,{size:11,strokeWidth:2}),s&&l?"2 toggle bindings":"1 toggle binding"]})]}),(0,Ee.jsxs)("button",{className:"lumia-btn lumia-btn-secondary lumia-btn-full",onClick:()=>n(!0),type:"button",children:[(0,Ee.jsx)(dt,{size:14,strokeWidth:2}),"Manage Bindings"]}),e&&(0,Ee.jsx)(jr,{onClose:()=>n(!1)})]})}function jr(e){let{onClose:n}=e;const{contextInfo:t,availablePresets:r,allBindings:i,currentCharacterBinding:o,currentChatBinding:a,bindCurrentCharacter:s,bindCurrentChat:l,removeCharacterBinding:c,removeChatBinding:u,refreshPresets:d}=hr(),m=(0,Ce.useSyncExternalStore)(yr.subscribe,kr,kr),[p,g]=(0,Ce.useState)(()=>o||a||m||""),[h,v]=(0,Ce.useState)("character");Ce.useEffect(()=>{d()},[d]),Ce.useEffect(()=>{const e=e=>{"Escape"===e.key&&n()};return document.addEventListener("keydown",e),document.body.style.overflow="hidden",()=>{document.removeEventListener("keydown",e),document.body.style.overflow=""}},[n]);const f=(0,Ce.useCallback)(()=>{var e;if(!p)return void(null===(e=toastr)||void 0===e||e.warning("Select a preset first"));let n=!1;var r,i,o;"character"===h?(n=s(p),n&&(null===(r=toastr)||void 0===r||r.success('Bound "'.concat(t.characterName,'" to "').concat(p,'"')))):(n=l(p),n&&(null===(i=toastr)||void 0===i||i.success('Bound current chat to "'.concat(p,'"'))));n?g(""):null===(o=toastr)||void 0===o||o.error("No active context to bind")},[p,h,s,l,t.characterName]),b=(0,Ce.useCallback)((e,n)=>{var t,r;"character"===e?(c(n),null===(t=toastr)||void 0===t||t.info("Character binding removed")):(u(n),null===(r=toastr)||void 0===r||r.info("Chat binding removed"))},[c,u]),x=(0,Ce.useCallback)(e=>{e.target===e.currentTarget&&n()},[n]),y=(0,Ce.useCallback)(e=>{e.stopPropagation()},[]),k=t.characterAvatar||t.chatId;return(0,ot.createPortal)((0,Ee.jsx)("div",{className:"lumiverse-modal-backdrop",onClick:x,onMouseDown:y,onMouseUp:y,children:(0,Ee.jsxs)("div",{className:"lumiverse-modal lumiverse-bindings-modal",onClick:y,role:"dialog","aria-modal":"true",children:[(0,Ee.jsxs)("div",{className:"lumiverse-bindings-modal-header",children:[(0,Ee.jsxs)("div",{className:"lumiverse-bindings-modal-header-info",children:[(0,Ee.jsx)("span",{className:"lumiverse-bindings-modal-header-icon",children:(0,Ee.jsx)(cr,{size:22,strokeWidth:1.5})}),(0,Ee.jsxs)("div",{className:"lumiverse-bindings-modal-header-text",children:[(0,Ee.jsx)("h3",{className:"lumiverse-bindings-modal-title",children:"Preset Bindings"}),(0,Ee.jsx)("p",{className:"lumiverse-bindings-modal-subtitle",children:"Auto-switch presets when changing characters or chats"})]})]}),(0,Ee.jsx)("button",{className:"lumiverse-bindings-modal-close",onClick:n,title:"Close",type:"button",children:(0,Ee.jsx)(mt,{size:18,strokeWidth:2})})]}),(0,Ee.jsxs)("div",{className:"lumiverse-bindings-modal-content",children:[(0,Ee.jsxs)("div",{className:"lumiverse-bindings-section",children:[(0,Ee.jsxs)("div",{className:"lumiverse-bindings-section-header",children:[(0,Ee.jsx)(dr,{size:14,strokeWidth:2}),(0,Ee.jsx)("span",{children:"Create Binding"})]}),k?(0,Ee.jsxs)("div",{className:"lumiverse-bindings-create",children:[(0,Ee.jsxs)("div",{className:"lumiverse-bindings-type-toggle",children:[(0,Ee.jsxs)("button",{className:On("lumiverse-bindings-type-btn","character"===h&&"is-active"),onClick:()=>v("character"),disabled:!t.characterAvatar,type:"button",children:[(0,Ee.jsx)(lr,{size:14,strokeWidth:2}),"Character"]}),(0,Ee.jsxs)("button",{className:On("lumiverse-bindings-type-btn","chat"===h&&"is-active"),onClick:()=>v("chat"),disabled:!t.chatId,type:"button",children:[(0,Ee.jsx)(ur,{size:14,strokeWidth:2}),"This Chat"]})]}),(0,Ee.jsx)("div",{className:"lumiverse-bindings-create-context",children:"character"===h?(0,Ee.jsxs)("span",{children:[(0,Ee.jsx)(lr,{size:12}),t.characterName||t.characterAvatar||"No character",o&&(0,Ee.jsxs)("span",{className:"lumiverse-bindings-create-existing",children:["(currently: ",o,")"]})]}):(0,Ee.jsxs)("span",{children:[(0,Ee.jsx)(ur,{size:12}),t.chatId?t.chatId.length>30?t.chatId.slice(0,30)+"...":t.chatId:"No chat",a&&(0,Ee.jsxs)("span",{className:"lumiverse-bindings-create-existing",children:["(currently: ",a,")"]})]})}),(0,Ee.jsxs)("div",{className:"lumiverse-bindings-create-row",children:[(0,Ee.jsxs)("select",{className:"lumiverse-bindings-select",value:p,onChange:e=>g(e.target.value),children:[(0,Ee.jsx)("option",{value:"",children:"Select a preset..."}),r.map(e=>(0,Ee.jsx)("option",{value:e,children:e},e))]}),(0,Ee.jsxs)("button",{className:"lumia-btn lumia-btn-primary",onClick:f,disabled:!p,type:"button",children:[(0,Ee.jsx)(cr,{size:14,strokeWidth:2}),"Bind"]})]}),0===r.length&&(0,Ee.jsxs)("div",{className:"lumiverse-bindings-no-presets",children:[(0,Ee.jsx)(mr,{size:14,strokeWidth:2}),(0,Ee.jsx)("span",{children:"No presets available. Create one in SillyTavern first."})]})]}):(0,Ee.jsxs)("div",{className:"lumiverse-bindings-no-context",children:[(0,Ee.jsx)(lr,{size:20,strokeWidth:1.5}),(0,Ee.jsx)("span",{children:"Select a character to create bindings"})]})]}),(0,Ee.jsxs)("div",{className:"lumiverse-bindings-section",children:[(0,Ee.jsxs)("div",{className:"lumiverse-bindings-section-header",children:[(0,Ee.jsx)(ut,{size:14,strokeWidth:2}),(0,Ee.jsx)("span",{children:"Prompt Toggle Bindings"})]}),(0,Ee.jsx)(xr,{})]}),(0,Ee.jsxs)("div",{className:"lumiverse-bindings-section",children:[(0,Ee.jsxs)("div",{className:"lumiverse-bindings-section-header",children:[(0,Ee.jsx)(cr,{size:14,strokeWidth:2}),(0,Ee.jsxs)("span",{children:["Active Bindings (",i.length,")"]})]}),i.length>0?(0,Ee.jsx)("div",{className:"lumiverse-bindings-list",children:i.map(e=>(0,Ee.jsxs)("div",{className:"lumiverse-bindings-list-item",children:[(0,Ee.jsx)("div",{className:"lumiverse-bindings-list-item-icon",children:"character"===e.type?(0,Ee.jsx)(lr,{size:14,strokeWidth:1.5}):(0,Ee.jsx)(ur,{size:14,strokeWidth:1.5})}),(0,Ee.jsxs)("div",{className:"lumiverse-bindings-list-item-info",children:[(0,Ee.jsx)("span",{className:"lumiverse-bindings-list-item-name",children:e.displayName}),(0,Ee.jsx)("span",{className:"lumiverse-bindings-list-item-type",children:"character"===e.type?"Character":"Chat"})]}),(0,Ee.jsxs)("div",{className:"lumiverse-bindings-list-item-preset",children:[(0,Ee.jsx)(st,{size:12,strokeWidth:1.5}),e.presetName]}),(0,Ee.jsx)("button",{className:"lumiverse-bindings-list-item-remove",onClick:()=>b(e.type,e.id),title:"Remove binding",type:"button",children:(0,Ee.jsx)(Pn,{size:14,strokeWidth:2})})]},"".concat(e.type,"-").concat(e.id)))}):(0,Ee.jsxs)("div",{className:"lumiverse-bindings-empty",children:[(0,Ee.jsx)(pr,{size:20,strokeWidth:1.5}),(0,Ee.jsx)("span",{children:"No bindings configured"}),(0,Ee.jsx)("span",{className:"lumiverse-bindings-empty-hint",children:"Bindings auto-switch presets when you change characters or chats"})]})]}),(0,Ee.jsxs)("div",{className:"lumiverse-bindings-info",children:[(0,Ee.jsx)("div",{className:"lumiverse-bindings-info-title",children:"How it works"}),(0,Ee.jsxs)("ul",{className:"lumiverse-bindings-info-list",children:[(0,Ee.jsxs)("li",{children:[(0,Ee.jsx)("strong",{children:"Preset bindings"})," auto-switch to a named SillyTavern preset when you change characters/chats"]}),(0,Ee.jsxs)("li",{children:[(0,Ee.jsx)("strong",{children:"Toggle bindings"})," save which prompts are enabled/disabled and restore them when switching"]}),(0,Ee.jsxs)("li",{children:[(0,Ee.jsx)("strong",{children:"Chat bindings"})," have higher priority than character bindings"]}),(0,Ee.jsxs)("li",{children:["Toggle bindings are applied ",(0,Ee.jsx)("em",{children:"after"})," preset bindings, allowing layered configuration"]})]})]})]}),(0,Ee.jsx)("div",{className:"lumiverse-bindings-modal-footer",children:(0,Ee.jsx)("button",{className:"lumiverse-bindings-modal-btn lumiverse-bindings-modal-btn--primary",onClick:n,type:"button",children:"Done"})})]})}),document.body)}const Cr=(0,Ce.createContext)({});function Sr(e){const n=(0,Ce.useRef)(null);return null===n.current&&(n.current=e()),n.current}const Nr=(0,Ce.createContext)(null),Er=(0,Ce.createContext)({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"});class Pr extends Ce.Component{getSnapshotBeforeUpdate(e){const n=this.props.childRef.current;if(n&&e.isPresent&&!this.props.isPresent){const e=this.props.sizeRef.current;e.height=n.offsetHeight||0,e.width=n.offsetWidth||0,e.top=n.offsetTop,e.left=n.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function Dr({children:e,isPresent:n}){const t=(0,Ce.useId)(),r=(0,Ce.useRef)(null),i=(0,Ce.useRef)({width:0,height:0,top:0,left:0}),{nonce:o}=(0,Ce.useContext)(Er);return(0,Ce.useInsertionEffect)(()=>{const{width:e,height:a,top:s,left:l}=i.current;if(n||!r.current||!e||!a)return;r.current.dataset.motionPopId=t;const c=document.createElement("style");return o&&(c.nonce=o),document.head.appendChild(c),c.sheet&&c.sheet.insertRule(`\n          [data-motion-pop-id="${t}"] {\n            position: absolute !important;\n            width: ${e}px !important;\n            height: ${a}px !important;\n            top: ${s}px !important;\n            left: ${l}px !important;\n          }\n        `),()=>{document.head.removeChild(c)}},[n]),(0,Ee.jsx)(Pr,{isPresent:n,childRef:r,sizeRef:i,children:Ce.cloneElement(e,{ref:r})})}const Mr=({children:e,initial:n,isPresent:t,onExitComplete:r,custom:i,presenceAffectsLayout:o,mode:a})=>{const s=Sr(Or),l=(0,Ce.useId)(),c=(0,Ce.useCallback)(e=>{s.set(e,!0);for(const e of s.values())if(!e)return;r&&r()},[s,r]),u=(0,Ce.useMemo)(()=>({id:l,initial:n,isPresent:t,custom:i,onExitComplete:c,register:e=>(s.set(e,!1),()=>s.delete(e))}),o?[Math.random(),c]:[t,c]);return(0,Ce.useMemo)(()=>{s.forEach((e,n)=>s.set(n,!1))},[t]),Ce.useEffect(()=>{!t&&!s.size&&r&&r()},[t]),"popLayout"===a&&(e=(0,Ee.jsx)(Dr,{isPresent:t,children:e})),(0,Ee.jsx)(Nr.Provider,{value:u,children:e})};function Or(){return new Map}function Tr(e=!0){const n=(0,Ce.useContext)(Nr);if(null===n)return[!0,null];const{isPresent:t,onExitComplete:r,register:i}=n,o=(0,Ce.useId)();(0,Ce.useEffect)(()=>{e&&i(o)},[e]);const a=(0,Ce.useCallback)(()=>e&&r&&r(o),[o,r,e]);return!t&&r?[!1,a]:[!0]}const Ar=e=>e.key||"";function Lr(e){const n=[];return Ce.Children.forEach(e,e=>{(0,Ce.isValidElement)(e)&&n.push(e)}),n}const zr="undefined"!=typeof window,Ir=zr?Ce.useLayoutEffect:Ce.useEffect,Rr=({children:e,custom:n,initial:t=!0,onExitComplete:r,presenceAffectsLayout:i=!0,mode:o="sync",propagate:a=!1})=>{const[s,l]=Tr(a),c=(0,Ce.useMemo)(()=>Lr(e),[e]),u=a&&!s?[]:c.map(Ar),d=(0,Ce.useRef)(!0),m=(0,Ce.useRef)(c),p=Sr(()=>new Map),[g,h]=(0,Ce.useState)(c),[v,f]=(0,Ce.useState)(c);Ir(()=>{d.current=!1,m.current=c;for(let e=0;e<v.length;e++){const n=Ar(v[e]);u.includes(n)?p.delete(n):!0!==p.get(n)&&p.set(n,!1)}},[v,u.length,u.join("-")]);const b=[];if(c!==g){let e=[...c];for(let n=0;n<v.length;n++){const t=v[n],r=Ar(t);u.includes(r)||(e.splice(n,0,t),b.push(t))}return"wait"===o&&b.length&&(e=b),f(Lr(e)),void h(c)}const{forceRender:x}=(0,Ce.useContext)(Cr);return(0,Ee.jsx)(Ee.Fragment,{children:v.map(e=>{const g=Ar(e),h=!(a&&!s)&&(c===v||u.includes(g));return(0,Ee.jsx)(Mr,{isPresent:h,initial:!(d.current&&!t)&&void 0,custom:h?void 0:n,presenceAffectsLayout:i,mode:o,onExitComplete:h?void 0:()=>{if(!p.has(g))return;p.set(g,!0);let e=!0;p.forEach(n=>{n||(e=!1)}),e&&(null==x||x(),f(m.current),a&&(null==l||l()),r&&r())},children:e},g)})})};function Br(e){if("undefined"==typeof Proxy)return e;const n=new Map;return new Proxy((...n)=>e(...n),{get:(t,r)=>"create"===r?e:(n.has(r)||n.set(r,e(r)),n.get(r))})}function _r(e){return null!==e&&"object"==typeof e&&"function"==typeof e.start}const Fr=e=>Array.isArray(e);function Ur(e,n){if(!Array.isArray(n))return!1;const t=n.length;if(t!==e.length)return!1;for(let r=0;r<t;r++)if(n[r]!==e[r])return!1;return!0}function Hr(e){return"string"==typeof e||Array.isArray(e)}function Wr(e){const n=[{},{}];return null==e||e.values.forEach((e,t)=>{n[0][t]=e.get(),n[1][t]=e.getVelocity()}),n}function Vr(e,n,t,r){if("function"==typeof n){const[i,o]=Wr(r);n=n(void 0!==t?t:e.custom,i,o)}if("string"==typeof n&&(n=e.variants&&e.variants[n]),"function"==typeof n){const[i,o]=Wr(r);n=n(void 0!==t?t:e.custom,i,o)}return n}function qr(e,n,t){const r=e.getProps();return Vr(r,n,void 0!==t?t:r.custom,e)}const $r=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],Yr=["initial",...$r];function Gr(e,n){return e?e[n]||e.default||e:void 0}const Kr=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Qr=new Set(Kr),Xr=new Set(["width","height","top","left","right","bottom",...Kr]),Zr=e=>Fr(e)?e[e.length-1]||0:e,Jr=!1,ei=!1,ni=e=>e;const ti=["read","resolveKeyframes","update","preRender","render","postRender"];function ri(e,n){let t=!1,r=!0;const i={delta:0,timestamp:0,isProcessing:!1},o=()=>t=!0,a=ti.reduce((e,n)=>(e[n]=function(e){let n=new Set,t=new Set,r=!1,i=!1;const o=new WeakSet;let a={delta:0,timestamp:0,isProcessing:!1};function s(n){o.has(n)&&(l.schedule(n),e()),n(a)}const l={schedule:(e,i=!1,a=!1)=>{const s=a&&r?n:t;return i&&o.add(e),s.has(e)||s.add(e),e},cancel:e=>{t.delete(e),o.delete(e)},process:e=>{a=e,r?i=!0:(r=!0,[n,t]=[t,n],n.forEach(s),n.clear(),r=!1,i&&(i=!1,l.process(e)))}};return l}(o),e),{}),{read:s,resolveKeyframes:l,update:c,preRender:u,render:d,postRender:m}=a,p=()=>{const o=ei?i.timestamp:performance.now();t=!1,i.delta=r?1e3/60:Math.max(Math.min(o-i.timestamp,40),1),i.timestamp=o,i.isProcessing=!0,s.process(i),l.process(i),c.process(i),u.process(i),d.process(i),m.process(i),i.isProcessing=!1,t&&n&&(r=!1,e(p))},g=ti.reduce((n,o)=>{const s=a[o];return n[o]=(n,o=!1,a=!1)=>(t||(t=!0,r=!0,i.isProcessing||e(p)),s.schedule(n,o,a)),n},{});return{schedule:g,cancel:e=>{for(let n=0;n<ti.length;n++)a[ti[n]].cancel(e)},state:i,steps:a}}const{schedule:ii,cancel:oi,state:ai,steps:si}=ri("undefined"!=typeof requestAnimationFrame?requestAnimationFrame:ni,!0);let li;function ci(){li=void 0}const ui={now:()=>(void 0===li&&ui.set(ai.isProcessing||ei?ai.timestamp:performance.now()),li),set:e=>{li=e,queueMicrotask(ci)}};function di(e,n){-1===e.indexOf(n)&&e.push(n)}function mi(e,n){const t=e.indexOf(n);t>-1&&e.splice(t,1)}class pi{constructor(){this.subscriptions=[]}add(e){return di(this.subscriptions,e),()=>mi(this.subscriptions,e)}notify(e,n,t){const r=this.subscriptions.length;if(r)if(1===r)this.subscriptions[0](e,n,t);else for(let i=0;i<r;i++){const r=this.subscriptions[i];r&&r(e,n,t)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function gi(e,n){return n?e*(1e3/n):0}const hi={current:void 0};class vi{constructor(e,n={}){this.version="11.18.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(e,n=!0)=>{const t=ui.now();this.updatedAt!==t&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(e),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),n&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(e),this.owner=n.owner}setCurrent(e){var n;this.current=e,this.updatedAt=ui.now(),null===this.canTrackVelocity&&void 0!==e&&(this.canTrackVelocity=(n=this.current,!isNaN(parseFloat(n))))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,n){this.events[e]||(this.events[e]=new pi);const t=this.events[e].add(n);return"change"===e?()=>{t(),ii.read(()=>{this.events.change.getSize()||this.stop()})}:t}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,n){this.passiveEffect=e,this.stopPassiveEffect=n}set(e,n=!0){n&&this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e,n)}setWithVelocity(e,n,t){this.set(n),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-t}jump(e,n=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,n&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return hi.current&&hi.current.push(this),this.current}getPrevious(){return this.prev}getVelocity(){const e=ui.now();if(!this.canTrackVelocity||void 0===this.prevFrameValue||e-this.updatedAt>30)return 0;const n=Math.min(this.updatedAt-this.prevUpdatedAt,30);return gi(parseFloat(this.current)-parseFloat(this.prevFrameValue),n)}start(e){return this.stop(),new Promise(n=>{this.hasAnimated=!0,this.animation=e(n),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function fi(e,n){return new vi(e,n)}function bi(e,n,t){e.hasValue(n)?e.getValue(n).set(t):e.addValue(n,fi(t))}const xi=e=>Boolean(e&&e.getVelocity);function yi(e,n){const t=e.getValue("willChange");if(r=t,Boolean(xi(r)&&r.add))return t.add(n);var r}const ki=e=>e.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),wi="data-"+ki("framerAppearId");function ji(e){return e.props[wi]}function Ci(e){let n;return()=>(void 0===n&&(n=e()),n)}const Si=Ci(()=>void 0!==window.ScrollTimeline);class Ni{constructor(e){this.stop=()=>this.runAll("stop"),this.animations=e.filter(Boolean)}get finished(){return Promise.all(this.animations.map(e=>"finished"in e?e.finished:e))}getAll(e){return this.animations[0][e]}setAll(e,n){for(let t=0;t<this.animations.length;t++)this.animations[t][e]=n}attachTimeline(e,n){const t=this.animations.map(t=>Si()&&t.attachTimeline?t.attachTimeline(e):"function"==typeof n?n(t):void 0);return()=>{t.forEach((e,n)=>{e&&e(),this.animations[n].stop()})}}get time(){return this.getAll("time")}set time(e){this.setAll("time",e)}get speed(){return this.getAll("speed")}set speed(e){this.setAll("speed",e)}get startTime(){return this.getAll("startTime")}get duration(){let e=0;for(let n=0;n<this.animations.length;n++)e=Math.max(e,this.animations[n].duration);return e}runAll(e){this.animations.forEach(n=>n[e]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class Ei extends Ni{then(e,n){return Promise.all(this.animations).then(e).catch(n)}}const Pi=e=>1e3*e,Di=e=>e/1e3,Mi=!1;function Oi(e){return"function"==typeof e}function Ti(e,n){e.timeline=n,e.onfinish=null}const Ai=e=>Array.isArray(e)&&"number"==typeof e[0],Li={linearEasing:void 0};function zi(e,n){const t=Ci(e);return()=>{var e;return null!==(e=Li[n])&&void 0!==e?e:t()}}const Ii=zi(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch(e){return!1}return!0},"linearEasing"),Ri=(e,n,t)=>{const r=n-e;return 0===r?1:(t-e)/r},Bi=(e,n,t=10)=>{let r="";const i=Math.max(Math.round(n/t),2);for(let n=0;n<i;n++)r+=e(Ri(0,i-1,n))+", ";return`linear(${r.substring(0,r.length-2)})`};function _i(e){return Boolean("function"==typeof e&&Ii()||!e||"string"==typeof e&&(e in Ui||Ii())||Ai(e)||Array.isArray(e)&&e.every(_i))}const Fi=([e,n,t,r])=>`cubic-bezier(${e}, ${n}, ${t}, ${r})`,Ui={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Fi([0,.65,.55,1]),circOut:Fi([.55,0,1,.45]),backIn:Fi([.31,.01,.66,-.59]),backOut:Fi([.33,1.53,.69,.99])};function Hi(e,n){return e?"function"==typeof e&&Ii()?Bi(e,n):Ai(e)?Fi(e):Array.isArray(e)?e.map(e=>Hi(e,n)||Ui.easeOut):Ui[e]:void 0}const Wi=(e,n,t)=>(((1-3*t+3*n)*e+(3*t-6*n))*e+3*n)*e;function Vi(e,n,t,r){if(e===n&&t===r)return ni;const i=n=>function(e,n,t,r,i){let o,a,s=0;do{a=n+(t-n)/2,o=Wi(a,r,i)-e,o>0?t=a:n=a}while(Math.abs(o)>1e-7&&++s<12);return a}(n,0,1,e,t);return e=>0===e||1===e?e:Wi(i(e),n,r)}const qi=e=>n=>n<=.5?e(2*n)/2:(2-e(2*(1-n)))/2,$i=e=>n=>1-e(1-n),Yi=Vi(.33,1.53,.69,.99),Gi=$i(Yi),Ki=qi(Gi),Qi=e=>(e*=2)<1?.5*Gi(e):.5*(2-Math.pow(2,-10*(e-1))),Xi=e=>1-Math.sin(Math.acos(e)),Zi=$i(Xi),Ji=qi(Xi),eo=e=>/^0[^.\s]+$/u.test(e);function no(e){return"number"==typeof e?0===e:null===e||("none"===e||"0"===e||eo(e))}const to=(e,n,t)=>t>n?n:t<e?e:t,ro={test:e=>"number"==typeof e,parse:parseFloat,transform:e=>e},io={...ro,transform:e=>to(0,1,e)},oo={...ro,default:1},ao=e=>Math.round(1e5*e)/1e5,so=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;const lo=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,co=(e,n)=>t=>Boolean("string"==typeof t&&lo.test(t)&&t.startsWith(e)||n&&!function(e){return null==e}(t)&&Object.prototype.hasOwnProperty.call(t,n)),uo=(e,n,t)=>r=>{if("string"!=typeof r)return r;const[i,o,a,s]=r.match(so);return{[e]:parseFloat(i),[n]:parseFloat(o),[t]:parseFloat(a),alpha:void 0!==s?parseFloat(s):1}},mo={...ro,transform:e=>Math.round((e=>to(0,255,e))(e))},po={test:co("rgb","red"),parse:uo("red","green","blue"),transform:({red:e,green:n,blue:t,alpha:r=1})=>"rgba("+mo.transform(e)+", "+mo.transform(n)+", "+mo.transform(t)+", "+ao(io.transform(r))+")"};const go={test:co("#"),parse:function(e){let n="",t="",r="",i="";return e.length>5?(n=e.substring(1,3),t=e.substring(3,5),r=e.substring(5,7),i=e.substring(7,9)):(n=e.substring(1,2),t=e.substring(2,3),r=e.substring(3,4),i=e.substring(4,5),n+=n,t+=t,r+=r,i+=i),{red:parseInt(n,16),green:parseInt(t,16),blue:parseInt(r,16),alpha:i?parseInt(i,16)/255:1}},transform:po.transform},ho=e=>({test:n=>"string"==typeof n&&n.endsWith(e)&&1===n.split(" ").length,parse:parseFloat,transform:n=>`${n}${e}`}),vo=ho("deg"),fo=ho("%"),bo=ho("px"),xo=ho("vh"),yo=ho("vw"),ko={...fo,parse:e=>fo.parse(e)/100,transform:e=>fo.transform(100*e)},wo={test:co("hsl","hue"),parse:uo("hue","saturation","lightness"),transform:({hue:e,saturation:n,lightness:t,alpha:r=1})=>"hsla("+Math.round(e)+", "+fo.transform(ao(n))+", "+fo.transform(ao(t))+", "+ao(io.transform(r))+")"},jo={test:e=>po.test(e)||go.test(e)||wo.test(e),parse:e=>po.test(e)?po.parse(e):wo.test(e)?wo.parse(e):go.parse(e),transform:e=>"string"==typeof e?e:e.hasOwnProperty("red")?po.transform(e):wo.transform(e)},Co=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;const So="number",No="color",Eo=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Po(e){const n=e.toString(),t=[],r={color:[],number:[],var:[]},i=[];let o=0;const a=n.replace(Eo,e=>(jo.test(e)?(r.color.push(o),i.push(No),t.push(jo.parse(e))):e.startsWith("var(")?(r.var.push(o),i.push("var"),t.push(e)):(r.number.push(o),i.push(So),t.push(parseFloat(e))),++o,"${}")).split("${}");return{values:t,split:a,indexes:r,types:i}}function Do(e){return Po(e).values}function Mo(e){const{split:n,types:t}=Po(e),r=n.length;return e=>{let i="";for(let o=0;o<r;o++)if(i+=n[o],void 0!==e[o]){const n=t[o];i+=n===So?ao(e[o]):n===No?jo.transform(e[o]):e[o]}return i}}const Oo=e=>"number"==typeof e?0:e;const To={test:function(e){var n,t;return isNaN(e)&&"string"==typeof e&&((null===(n=e.match(so))||void 0===n?void 0:n.length)||0)+((null===(t=e.match(Co))||void 0===t?void 0:t.length)||0)>0},parse:Do,createTransformer:Mo,getAnimatableNone:function(e){const n=Do(e);return Mo(e)(n.map(Oo))}},Ao=new Set(["brightness","contrast","saturate","opacity"]);function Lo(e){const[n,t]=e.slice(0,-1).split("(");if("drop-shadow"===n)return e;const[r]=t.match(so)||[];if(!r)return e;const i=t.replace(r,"");let o=Ao.has(n)?1:0;return r!==t&&(o*=100),n+"("+o+i+")"}const zo=/\b([a-z-]*)\(.*?\)/gu,Io={...To,getAnimatableNone:e=>{const n=e.match(zo);return n?n.map(Lo).join(" "):e}},Ro={borderWidth:bo,borderTopWidth:bo,borderRightWidth:bo,borderBottomWidth:bo,borderLeftWidth:bo,borderRadius:bo,radius:bo,borderTopLeftRadius:bo,borderTopRightRadius:bo,borderBottomRightRadius:bo,borderBottomLeftRadius:bo,width:bo,maxWidth:bo,height:bo,maxHeight:bo,top:bo,right:bo,bottom:bo,left:bo,padding:bo,paddingTop:bo,paddingRight:bo,paddingBottom:bo,paddingLeft:bo,margin:bo,marginTop:bo,marginRight:bo,marginBottom:bo,marginLeft:bo,backgroundPositionX:bo,backgroundPositionY:bo},Bo={rotate:vo,rotateX:vo,rotateY:vo,rotateZ:vo,scale:oo,scaleX:oo,scaleY:oo,scaleZ:oo,skew:vo,skewX:vo,skewY:vo,distance:bo,translateX:bo,translateY:bo,translateZ:bo,x:bo,y:bo,z:bo,perspective:bo,transformPerspective:bo,opacity:io,originX:ko,originY:ko,originZ:bo},_o={...ro,transform:Math.round},Fo={...Ro,...Bo,zIndex:_o,size:bo,fillOpacity:io,strokeOpacity:io,numOctaves:_o},Uo={...Fo,color:jo,backgroundColor:jo,outlineColor:jo,fill:jo,stroke:jo,borderColor:jo,borderTopColor:jo,borderRightColor:jo,borderBottomColor:jo,borderLeftColor:jo,filter:Io,WebkitFilter:Io},Ho=e=>Uo[e];function Wo(e,n){let t=Ho(e);return t!==Io&&(t=To),t.getAnimatableNone?t.getAnimatableNone(n):void 0}const Vo=new Set(["auto","none","0"]);const qo=e=>e===ro||e===bo,$o=(e,n)=>parseFloat(e.split(", ")[n]),Yo=(e,n)=>(t,{transform:r})=>{if("none"===r||!r)return 0;const i=r.match(/^matrix3d\((.+)\)$/u);if(i)return $o(i[1],n);{const n=r.match(/^matrix\((.+)\)$/u);return n?$o(n[1],e):0}},Go=new Set(["x","y","z"]),Ko=Kr.filter(e=>!Go.has(e));const Qo={width:({x:e},{paddingLeft:n="0",paddingRight:t="0"})=>e.max-e.min-parseFloat(n)-parseFloat(t),height:({y:e},{paddingTop:n="0",paddingBottom:t="0"})=>e.max-e.min-parseFloat(n)-parseFloat(t),top:(e,{top:n})=>parseFloat(n),left:(e,{left:n})=>parseFloat(n),bottom:({y:e},{top:n})=>parseFloat(n)+(e.max-e.min),right:({x:e},{left:n})=>parseFloat(n)+(e.max-e.min),x:Yo(4,13),y:Yo(5,14)};Qo.translateX=Qo.x,Qo.translateY=Qo.y;const Xo=new Set;let Zo=!1,Jo=!1;function ea(){if(Jo){const e=Array.from(Xo).filter(e=>e.needsMeasurement),n=new Set(e.map(e=>e.element)),t=new Map;n.forEach(e=>{const n=function(e){const n=[];return Ko.forEach(t=>{const r=e.getValue(t);void 0!==r&&(n.push([t,r.get()]),r.set(t.startsWith("scale")?1:0))}),n}(e);n.length&&(t.set(e,n),e.render())}),e.forEach(e=>e.measureInitialState()),n.forEach(e=>{e.render();const n=t.get(e);n&&n.forEach(([n,t])=>{var r;null===(r=e.getValue(n))||void 0===r||r.set(t)})}),e.forEach(e=>e.measureEndState()),e.forEach(e=>{void 0!==e.suspendedScrollY&&window.scrollTo(0,e.suspendedScrollY)})}Jo=!1,Zo=!1,Xo.forEach(e=>e.complete()),Xo.clear()}function na(){Xo.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(Jo=!0)})}class ta{constructor(e,n,t,r,i,o=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...e],this.onComplete=n,this.name=t,this.motionValue=r,this.element=i,this.isAsync=o}scheduleResolve(){this.isScheduled=!0,this.isAsync?(Xo.add(this),Zo||(Zo=!0,ii.read(na),ii.resolveKeyframes(ea))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:n,element:t,motionValue:r}=this;for(let i=0;i<e.length;i++)if(null===e[i])if(0===i){const i=null==r?void 0:r.get(),o=e[e.length-1];if(void 0!==i)e[0]=i;else if(t&&n){const r=t.readValue(n,o);null!=r&&(e[0]=r)}void 0===e[0]&&(e[0]=o),r&&void 0===i&&r.set(e[0])}else e[i]=e[i-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),Xo.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,Xo.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}let ra=ni,ia=ni;const oa=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e),aa=e=>n=>"string"==typeof n&&n.startsWith(e),sa=aa("--"),la=aa("var(--"),ca=e=>!!la(e)&&ua.test(e.split("/*")[0].trim()),ua=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,da=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function ma(e,n,t=1){ia(t<=4,`Max CSS variable fallback depth detected in property "${e}". This may indicate a circular fallback dependency.`);const[r,i]=function(e){const n=da.exec(e);if(!n)return[,];const[,t,r,i]=n;return[`--${null!=t?t:r}`,i]}(e);if(!r)return;const o=window.getComputedStyle(n).getPropertyValue(r);if(o){const e=o.trim();return oa(e)?parseFloat(e):e}return ca(i)?ma(i,n,t+1):i}const pa=e=>n=>n.test(e),ga=[ro,bo,fo,vo,yo,xo,{test:e=>"auto"===e,parse:e=>e}],ha=e=>ga.find(pa(e));class va extends ta{constructor(e,n,t,r,i){super(e,n,t,r,i,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:n,name:t}=this;if(!n||!n.current)return;super.readKeyframes();for(let t=0;t<e.length;t++){let r=e[t];if("string"==typeof r&&(r=r.trim(),ca(r))){const i=ma(r,n.current);void 0!==i&&(e[t]=i),t===e.length-1&&(this.finalKeyframe=r)}}if(this.resolveNoneKeyframes(),!Xr.has(t)||2!==e.length)return;const[r,i]=e,o=ha(r),a=ha(i);if(o!==a)if(qo(o)&&qo(a))for(let n=0;n<e.length;n++){const t=e[n];"string"==typeof t&&(e[n]=parseFloat(t))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:n}=this,t=[];for(let n=0;n<e.length;n++)no(e[n])&&t.push(n);t.length&&function(e,n,t){let r,i=0;for(;i<e.length&&!r;){const n=e[i];"string"==typeof n&&!Vo.has(n)&&Po(n).values.length&&(r=e[i]),i++}if(r&&t)for(const i of n)e[i]=Wo(t,r)}(e,t,n)}measureInitialState(){const{element:e,unresolvedKeyframes:n,name:t}=this;if(!e||!e.current)return;"height"===t&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Qo[t](e.measureViewportBox(),window.getComputedStyle(e.current)),n[0]=this.measuredOrigin;const r=n[n.length-1];void 0!==r&&e.getValue(t,r).jump(r,!1)}measureEndState(){var e;const{element:n,name:t,unresolvedKeyframes:r}=this;if(!n||!n.current)return;const i=n.getValue(t);i&&i.jump(this.measuredOrigin,!1);const o=r.length-1,a=r[o];r[o]=Qo[t](n.measureViewportBox(),window.getComputedStyle(n.current)),null!==a&&void 0===this.finalKeyframe&&(this.finalKeyframe=a),(null===(e=this.removedTransforms)||void 0===e?void 0:e.length)&&this.removedTransforms.forEach(([e,t])=>{n.getValue(e).set(t)}),this.resolveNoneKeyframes()}}const fa=(e,n)=>"zIndex"!==n&&(!("number"!=typeof e&&!Array.isArray(e))||!("string"!=typeof e||!To.test(e)&&"0"!==e||e.startsWith("url(")));function ba(e,n,t,r){const i=e[0];if(null===i)return!1;if("display"===n||"visibility"===n)return!0;const o=e[e.length-1],a=fa(i,n),s=fa(o,n);return ra(a===s,`You are trying to animate ${n} from "${i}" to "${o}". ${i} is not an animatable value - to enable this animation set ${i} to a value animatable to ${o} via the \`style\` property.`),!(!a||!s)&&(function(e){const n=e[0];if(1===e.length)return!0;for(let t=0;t<e.length;t++)if(e[t]!==n)return!0}(e)||("spring"===t||Oi(t))&&r)}const xa=e=>null!==e;function ya(e,{repeat:n,repeatType:t="loop"},r){const i=e.filter(xa),o=n&&"loop"!==t&&n%2==1?0:i.length-1;return o&&void 0!==r?r:i[o]}class ka{constructor({autoplay:e=!0,delay:n=0,type:t="keyframes",repeat:r=0,repeatDelay:i=0,repeatType:o="loop",...a}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=ui.now(),this.options={autoplay:e,delay:n,type:t,repeat:r,repeatDelay:i,repeatType:o,...a},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt&&this.resolvedAt-this.createdAt>40?this.resolvedAt:this.createdAt}get resolved(){return this._resolved||this.hasAttemptedResolve||(na(),ea()),this._resolved}onKeyframesResolved(e,n){this.resolvedAt=ui.now(),this.hasAttemptedResolve=!0;const{name:t,type:r,velocity:i,delay:o,onComplete:a,onUpdate:s,isGenerator:l}=this.options;if(!l&&!ba(e,t,r,i)){if(Mi||!o)return s&&s(ya(e,this.options,n)),a&&a(),void this.resolveFinishedPromise();this.options.duration=0}const c=this.initPlayback(e,n);!1!==c&&(this._resolved={keyframes:e,finalKeyframe:n,...c},this.onPostResolved())}onPostResolved(){}then(e,n){return this.currentFinishedPromise.then(e,n)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(e=>{this.resolveFinishedPromise=e})}}const wa=2e4;function ja(e){let n=0;let t=e.next(n);for(;!t.done&&n<wa;)n+=50,t=e.next(n);return n>=wa?1/0:n}const Ca=(e,n,t)=>e+(n-e)*t;function Sa(e,n,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?e+6*(n-e)*t:t<.5?n:t<2/3?e+(n-e)*(2/3-t)*6:e}function Na(e,n){return t=>t>0?n:e}const Ea=(e,n,t)=>{const r=e*e,i=t*(n*n-r)+r;return i<0?0:Math.sqrt(i)},Pa=[go,po,wo];function Da(e){const n=(t=e,Pa.find(e=>e.test(t)));var t;if(ra(Boolean(n),`'${e}' is not an animatable color. Use the equivalent color code instead.`),!Boolean(n))return!1;let r=n.parse(e);return n===wo&&(r=function({hue:e,saturation:n,lightness:t,alpha:r}){e/=360,t/=100;let i=0,o=0,a=0;if(n/=100){const r=t<.5?t*(1+n):t+n-t*n,s=2*t-r;i=Sa(s,r,e+1/3),o=Sa(s,r,e),a=Sa(s,r,e-1/3)}else i=o=a=t;return{red:Math.round(255*i),green:Math.round(255*o),blue:Math.round(255*a),alpha:r}}(r)),r}const Ma=(e,n)=>{const t=Da(e),r=Da(n);if(!t||!r)return Na(e,n);const i={...t};return e=>(i.red=Ea(t.red,r.red,e),i.green=Ea(t.green,r.green,e),i.blue=Ea(t.blue,r.blue,e),i.alpha=Ca(t.alpha,r.alpha,e),po.transform(i))},Oa=(e,n)=>t=>n(e(t)),Ta=(...e)=>e.reduce(Oa),Aa=new Set(["none","hidden"]);function La(e,n){return t=>Ca(e,n,t)}function za(e){return"number"==typeof e?La:"string"==typeof e?ca(e)?Na:jo.test(e)?Ma:Ba:Array.isArray(e)?Ia:"object"==typeof e?jo.test(e)?Ma:Ra:Na}function Ia(e,n){const t=[...e],r=t.length,i=e.map((e,t)=>za(e)(e,n[t]));return e=>{for(let n=0;n<r;n++)t[n]=i[n](e);return t}}function Ra(e,n){const t={...e,...n},r={};for(const i in t)void 0!==e[i]&&void 0!==n[i]&&(r[i]=za(e[i])(e[i],n[i]));return e=>{for(const n in r)t[n]=r[n](e);return t}}const Ba=(e,n)=>{const t=To.createTransformer(n),r=Po(e),i=Po(n);return r.indexes.var.length===i.indexes.var.length&&r.indexes.color.length===i.indexes.color.length&&r.indexes.number.length>=i.indexes.number.length?Aa.has(e)&&!i.values.length||Aa.has(n)&&!r.values.length?function(e,n){return Aa.has(e)?t=>t<=0?e:n:t=>t>=1?n:e}(e,n):Ta(Ia(function(e,n){var t;const r=[],i={color:0,var:0,number:0};for(let o=0;o<n.values.length;o++){const a=n.types[o],s=e.indexes[a][i[a]],l=null!==(t=e.values[s])&&void 0!==t?t:0;r[o]=l,i[a]++}return r}(r,i),i.values),t):(ra(!0,`Complex values '${e}' and '${n}' too different to mix. Ensure all colors are of the same type, and that each contains the same quantity of number and color values. Falling back to instant transition.`),Na(e,n))};function _a(e,n,t){if("number"==typeof e&&"number"==typeof n&&"number"==typeof t)return Ca(e,n,t);return za(e)(e,n)}function Fa(e,n,t){const r=Math.max(n-5,0);return gi(t-e(r),n-r)}const Ua=100,Ha=10,Wa=1,Va=0,qa=800,$a=.3,Ya=.3,Ga={granular:.01,default:2},Ka={granular:.005,default:.5},Qa=.01,Xa=10,Za=.05,Ja=1,es=.001;function ns({duration:e=qa,bounce:n=$a,velocity:t=Va,mass:r=Wa}){let i,o;ra(e<=Pi(Xa),"Spring duration must be 10 seconds or less");let a=1-n;a=to(Za,Ja,a),e=to(Qa,Xa,Di(e)),a<1?(i=n=>{const r=n*a,i=r*e,o=r-t,s=rs(n,a),l=Math.exp(-i);return es-o/s*l},o=n=>{const r=n*a*e,o=r*t+t,s=Math.pow(a,2)*Math.pow(n,2)*e,l=Math.exp(-r),c=rs(Math.pow(n,2),a);return(-i(n)+es>0?-1:1)*((o-s)*l)/c}):(i=n=>Math.exp(-n*e)*((n-t)*e+1)-.001,o=n=>Math.exp(-n*e)*(e*e*(t-n)));const s=function(e,n,t){let r=t;for(let t=1;t<ts;t++)r-=e(r)/n(r);return r}(i,o,5/e);if(e=Pi(e),isNaN(s))return{stiffness:Ua,damping:Ha,duration:e};{const n=Math.pow(s,2)*r;return{stiffness:n,damping:2*a*Math.sqrt(r*n),duration:e}}}const ts=12;function rs(e,n){return e*Math.sqrt(1-n*n)}const is=["duration","bounce"],os=["stiffness","damping","mass"];function as(e,n){return n.some(n=>void 0!==e[n])}function ss(e=Ya,n=$a){const t="object"!=typeof e?{visualDuration:e,keyframes:[0,1],bounce:n}:e;let{restSpeed:r,restDelta:i}=t;const o=t.keyframes[0],a=t.keyframes[t.keyframes.length-1],s={done:!1,value:o},{stiffness:l,damping:c,mass:u,duration:d,velocity:m,isResolvedFromDuration:p}=function(e){let n={velocity:Va,stiffness:Ua,damping:Ha,mass:Wa,isResolvedFromDuration:!1,...e};if(!as(e,os)&&as(e,is))if(e.visualDuration){const t=e.visualDuration,r=2*Math.PI/(1.2*t),i=r*r,o=2*to(.05,1,1-(e.bounce||0))*Math.sqrt(i);n={...n,mass:Wa,stiffness:i,damping:o}}else{const t=ns(e);n={...n,...t,mass:Wa},n.isResolvedFromDuration=!0}return n}({...t,velocity:-Di(t.velocity||0)}),g=m||0,h=c/(2*Math.sqrt(l*u)),v=a-o,f=Di(Math.sqrt(l/u)),b=Math.abs(v)<5;let x;if(r||(r=b?Ga.granular:Ga.default),i||(i=b?Ka.granular:Ka.default),h<1){const e=rs(f,h);x=n=>{const t=Math.exp(-h*f*n);return a-t*((g+h*f*v)/e*Math.sin(e*n)+v*Math.cos(e*n))}}else if(1===h)x=e=>a-Math.exp(-f*e)*(v+(g+f*v)*e);else{const e=f*Math.sqrt(h*h-1);x=n=>{const t=Math.exp(-h*f*n),r=Math.min(e*n,300);return a-t*((g+h*f*v)*Math.sinh(r)+e*v*Math.cosh(r))/e}}const y={calculatedDuration:p&&d||null,next:e=>{const n=x(e);if(p)s.done=e>=d;else{let t=0;h<1&&(t=0===e?Pi(g):Fa(x,e,n));const o=Math.abs(t)<=r,l=Math.abs(a-n)<=i;s.done=o&&l}return s.value=s.done?a:n,s},toString:()=>{const e=Math.min(ja(y),wa),n=Bi(n=>y.next(e*n).value,e,30);return e+"ms "+n}};return y}function ls({keyframes:e,velocity:n=0,power:t=.8,timeConstant:r=325,bounceDamping:i=10,bounceStiffness:o=500,modifyTarget:a,min:s,max:l,restDelta:c=.5,restSpeed:u}){const d=e[0],m={done:!1,value:d},p=e=>void 0===s?l:void 0===l||Math.abs(s-e)<Math.abs(l-e)?s:l;let g=t*n;const h=d+g,v=void 0===a?h:a(h);v!==h&&(g=v-d);const f=e=>-g*Math.exp(-e/r),b=e=>v+f(e),x=e=>{const n=f(e),t=b(e);m.done=Math.abs(n)<=c,m.value=m.done?v:t};let y,k;const w=e=>{var n;(n=m.value,void 0!==s&&n<s||void 0!==l&&n>l)&&(y=e,k=ss({keyframes:[m.value,p(m.value)],velocity:Fa(b,e,m.value),damping:i,stiffness:o,restDelta:c,restSpeed:u}))};return w(0),{calculatedDuration:null,next:e=>{let n=!1;return k||void 0!==y||(n=!0,x(e),w(e)),void 0!==y&&e>=y?k.next(e-y):(!n&&x(e),m)}}}const cs=Vi(.42,0,1,1),us=Vi(0,0,.58,1),ds=Vi(.42,0,.58,1),ms={linear:ni,easeIn:cs,easeInOut:ds,easeOut:us,circIn:Xi,circInOut:Ji,circOut:Zi,backIn:Gi,backInOut:Ki,backOut:Yi,anticipate:Qi},ps=e=>{if(Ai(e)){ia(4===e.length,"Cubic bezier arrays must contain four numerical values.");const[n,t,r,i]=e;return Vi(n,t,r,i)}return"string"==typeof e?(ia(void 0!==ms[e],`Invalid easing type '${e}'`),ms[e]):e};function gs(e,n,{clamp:t=!0,ease:r,mixer:i}={}){const o=e.length;if(ia(o===n.length,"Both input and output ranges must be the same length"),1===o)return()=>n[0];if(2===o&&n[0]===n[1])return()=>n[1];const a=e[0]===e[1];e[0]>e[o-1]&&(e=[...e].reverse(),n=[...n].reverse());const s=function(e,n,t){const r=[],i=t||_a,o=e.length-1;for(let t=0;t<o;t++){let o=i(e[t],e[t+1]);if(n){const e=Array.isArray(n)?n[t]||ni:n;o=Ta(e,o)}r.push(o)}return r}(n,r,i),l=s.length,c=t=>{if(a&&t<e[0])return n[0];let r=0;if(l>1)for(;r<e.length-2&&!(t<e[r+1]);r++);const i=Ri(e[r],e[r+1],t);return s[r](i)};return t?n=>c(to(e[0],e[o-1],n)):c}function hs(e){const n=[0];return function(e,n){const t=e[e.length-1];for(let r=1;r<=n;r++){const i=Ri(0,n,r);e.push(Ca(t,1,i))}}(n,e.length-1),n}function vs({duration:e=300,keyframes:n,times:t,ease:r="easeInOut"}){const i=(e=>Array.isArray(e)&&"number"!=typeof e[0])(r)?r.map(ps):ps(r),o={done:!1,value:n[0]},a=function(e,n){return e.map(e=>e*n)}(t&&t.length===n.length?t:hs(n),e),s=gs(a,n,{ease:Array.isArray(i)?i:(l=n,c=i,l.map(()=>c||ds).splice(0,l.length-1))});var l,c;return{calculatedDuration:e,next:n=>(o.value=s(n),o.done=n>=e,o)}}const fs=e=>{const n=({timestamp:n})=>e(n);return{start:()=>ii.update(n,!0),stop:()=>oi(n),now:()=>ai.isProcessing?ai.timestamp:ui.now()}},bs={decay:ls,inertia:ls,tween:vs,keyframes:vs,spring:ss},xs=e=>e/100;class ys extends ka{constructor(e){super(e),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,"idle"===this.state)return;this.teardown();const{onStop:e}=this.options;e&&e()};const{name:n,motionValue:t,element:r,keyframes:i}=this.options,o=(null==r?void 0:r.KeyframeResolver)||ta;this.resolver=new o(i,(e,n)=>this.onKeyframesResolved(e,n),n,t,r),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(e){const{type:n="keyframes",repeat:t=0,repeatDelay:r=0,repeatType:i,velocity:o=0}=this.options,a=Oi(n)?n:bs[n]||vs;let s,l;a!==vs&&"number"!=typeof e[0]&&(s=Ta(xs,_a(e[0],e[1])),e=[0,100]);const c=a({...this.options,keyframes:e});"mirror"===i&&(l=a({...this.options,keyframes:[...e].reverse(),velocity:-o})),null===c.calculatedDuration&&(c.calculatedDuration=ja(c));const{calculatedDuration:u}=c,d=u+r;return{generator:c,mirroredGenerator:l,mapPercentToKeyframes:s,calculatedDuration:u,resolvedDuration:d,totalDuration:d*(t+1)-r}}onPostResolved(){const{autoplay:e=!0}=this.options;this.play(),"paused"!==this.pendingPlayState&&e?this.state=this.pendingPlayState:this.pause()}tick(e,n=!1){const{resolved:t}=this;if(!t){const{keyframes:e}=this.options;return{done:!0,value:e[e.length-1]}}const{finalKeyframe:r,generator:i,mirroredGenerator:o,mapPercentToKeyframes:a,keyframes:s,calculatedDuration:l,totalDuration:c,resolvedDuration:u}=t;if(null===this.startTime)return i.next(0);const{delay:d,repeat:m,repeatType:p,repeatDelay:g,onUpdate:h}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-c/this.speed,this.startTime)),n?this.currentTime=e:null!==this.holdTime?this.currentTime=this.holdTime:this.currentTime=Math.round(e-this.startTime)*this.speed;const v=this.currentTime-d*(this.speed>=0?1:-1),f=this.speed>=0?v<0:v>c;this.currentTime=Math.max(v,0),"finished"===this.state&&null===this.holdTime&&(this.currentTime=c);let b=this.currentTime,x=i;if(m){const e=Math.min(this.currentTime,c)/u;let n=Math.floor(e),t=e%1;!t&&e>=1&&(t=1),1===t&&n--,n=Math.min(n,m+1);Boolean(n%2)&&("reverse"===p?(t=1-t,g&&(t-=g/u)):"mirror"===p&&(x=o)),b=to(0,1,t)*u}const y=f?{done:!1,value:s[0]}:x.next(b);a&&(y.value=a(y.value));let{done:k}=y;f||null===l||(k=this.speed>=0?this.currentTime>=c:this.currentTime<=0);const w=null===this.holdTime&&("finished"===this.state||"running"===this.state&&k);return w&&void 0!==r&&(y.value=ya(s,this.options,r)),h&&h(y.value),w&&this.finish(),y}get duration(){const{resolved:e}=this;return e?Di(e.calculatedDuration):0}get time(){return Di(this.currentTime)}set time(e){e=Pi(e),this.currentTime=e,null!==this.holdTime||0===this.speed?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.speed)}get speed(){return this.playbackSpeed}set speed(e){const n=this.playbackSpeed!==e;this.playbackSpeed=e,n&&(this.time=Di(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved)return void(this.pendingPlayState="running");if(this.isStopped)return;const{driver:e=fs,onPlay:n,startTime:t}=this.options;this.driver||(this.driver=e(e=>this.tick(e))),n&&n();const r=this.driver.now();null!==this.holdTime?this.startTime=r-this.holdTime:this.startTime?"finished"===this.state&&(this.startTime=r):this.startTime=null!=t?t:this.calcStartTime(),"finished"===this.state&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var e;this._resolved?(this.state="paused",this.holdTime=null!==(e=this.currentTime)&&void 0!==e?e:0):this.pendingPlayState="paused"}complete(){"running"!==this.state&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:e}=this.options;e&&e()}cancel(){null!==this.cancelTime&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}}const ks=new Set(["opacity","clipPath","filter","transform"]);function ws(e,n,t,{delay:r=0,duration:i=300,repeat:o=0,repeatType:a="loop",ease:s="easeInOut",times:l}={}){const c={[n]:t};l&&(c.offset=l);const u=Hi(s,i);return Array.isArray(u)&&(c.easing=u),e.animate(c,{delay:r,duration:i,easing:Array.isArray(u)?"linear":u,fill:"both",iterations:o+1,direction:"reverse"===a?"alternate":"normal"})}const js=Ci(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));const Cs={anticipate:Qi,backInOut:Ki,circInOut:Ji};class Ss extends ka{constructor(e){super(e);const{name:n,motionValue:t,element:r,keyframes:i}=this.options;this.resolver=new va(i,(e,n)=>this.onKeyframesResolved(e,n),n,t,r),this.resolver.scheduleResolve()}initPlayback(e,n){let{duration:t=300,times:r,ease:i,type:o,motionValue:a,name:s,startTime:l}=this.options;if(!a.owner||!a.owner.current)return!1;if("string"==typeof i&&Ii()&&function(e){return e in Cs}(i)&&(i=Cs[i]),function(e){return Oi(e.type)||"spring"===e.type||!_i(e.ease)}(this.options)){const{onComplete:n,onUpdate:a,motionValue:s,element:l,...c}=this.options,u=function(e,n){const t=new ys({...n,keyframes:e,repeat:0,delay:0,isGenerator:!0});let r={done:!1,value:e[0]};const i=[];let o=0;for(;!r.done&&o<2e4;)r=t.sample(o),i.push(r.value),o+=10;return{times:void 0,keyframes:i,duration:o-10,ease:"linear"}}(e,c);1===(e=u.keyframes).length&&(e[1]=e[0]),t=u.duration,r=u.times,i=u.ease,o="keyframes"}const c=ws(a.owner.current,s,e,{...this.options,duration:t,times:r,ease:i});return c.startTime=null!=l?l:this.calcStartTime(),this.pendingTimeline?(Ti(c,this.pendingTimeline),this.pendingTimeline=void 0):c.onfinish=()=>{const{onComplete:t}=this.options;a.set(ya(e,this.options,n)),t&&t(),this.cancel(),this.resolveFinishedPromise()},{animation:c,duration:t,times:r,type:o,ease:i,keyframes:e}}get duration(){const{resolved:e}=this;if(!e)return 0;const{duration:n}=e;return Di(n)}get time(){const{resolved:e}=this;if(!e)return 0;const{animation:n}=e;return Di(n.currentTime||0)}set time(e){const{resolved:n}=this;if(!n)return;const{animation:t}=n;t.currentTime=Pi(e)}get speed(){const{resolved:e}=this;if(!e)return 1;const{animation:n}=e;return n.playbackRate}set speed(e){const{resolved:n}=this;if(!n)return;const{animation:t}=n;t.playbackRate=e}get state(){const{resolved:e}=this;if(!e)return"idle";const{animation:n}=e;return n.playState}get startTime(){const{resolved:e}=this;if(!e)return null;const{animation:n}=e;return n.startTime}attachTimeline(e){if(this._resolved){const{resolved:n}=this;if(!n)return ni;const{animation:t}=n;Ti(t,e)}else this.pendingTimeline=e;return ni}play(){if(this.isStopped)return;const{resolved:e}=this;if(!e)return;const{animation:n}=e;"finished"===n.playState&&this.updateFinishedPromise(),n.play()}pause(){const{resolved:e}=this;if(!e)return;const{animation:n}=e;n.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,"idle"===this.state)return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:e}=this;if(!e)return;const{animation:n,keyframes:t,duration:r,type:i,ease:o,times:a}=e;if("idle"===n.playState||"finished"===n.playState)return;if(this.time){const{motionValue:e,onUpdate:n,onComplete:s,element:l,...c}=this.options,u=new ys({...c,keyframes:t,duration:r,type:i,ease:o,times:a,isGenerator:!0}),d=Pi(this.time);e.setWithVelocity(u.sample(d-10).value,u.sample(d).value,10)}const{onStop:s}=this.options;s&&s(),this.cancel()}complete(){const{resolved:e}=this;e&&e.animation.finish()}cancel(){const{resolved:e}=this;e&&e.animation.cancel()}static supports(e){const{motionValue:n,name:t,repeatDelay:r,repeatType:i,damping:o,type:a}=e;if(!(n&&n.owner&&n.owner.current instanceof HTMLElement))return!1;const{onUpdate:s,transformTemplate:l}=n.owner.getProps();return js()&&t&&ks.has(t)&&!s&&!l&&!r&&"mirror"!==i&&0!==o&&"inertia"!==a}}const Ns={type:"spring",stiffness:500,damping:25,restSpeed:10},Es={type:"keyframes",duration:.8},Ps={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},Ds=(e,{keyframes:n})=>n.length>2?Es:Qr.has(e)?e.startsWith("scale")?{type:"spring",stiffness:550,damping:0===n[1]?2*Math.sqrt(550):30,restSpeed:10}:Ns:Ps;const Ms=(e,n,t,r={},i,o)=>a=>{const s=Gr(r,e)||{},l=s.delay||r.delay||0;let{elapsed:c=0}=r;c-=Pi(l);let u={keyframes:Array.isArray(t)?t:[null,t],ease:"easeOut",velocity:n.getVelocity(),...s,delay:-c,onUpdate:e=>{n.set(e),s.onUpdate&&s.onUpdate(e)},onComplete:()=>{a(),s.onComplete&&s.onComplete()},name:e,motionValue:n,element:o?void 0:i};(function({when:e,delay:n,delayChildren:t,staggerChildren:r,staggerDirection:i,repeat:o,repeatType:a,repeatDelay:s,from:l,elapsed:c,...u}){return!!Object.keys(u).length})(s)||(u={...u,...Ds(e,u)}),u.duration&&(u.duration=Pi(u.duration)),u.repeatDelay&&(u.repeatDelay=Pi(u.repeatDelay)),void 0!==u.from&&(u.keyframes[0]=u.from);let d=!1;if((!1===u.type||0===u.duration&&!u.repeatDelay)&&(u.duration=0,0===u.delay&&(d=!0)),(Mi||Jr)&&(d=!0,u.duration=0,u.delay=0),d&&!o&&void 0!==n.get()){const e=ya(u.keyframes,s);if(void 0!==e)return ii.update(()=>{u.onUpdate(e),u.onComplete()}),new Ei([])}return!o&&Ss.supports(u)?new Ss(u):new ys(u)};function Os({protectedKeys:e,needsAnimating:n},t){const r=e.hasOwnProperty(t)&&!0!==n[t];return n[t]=!1,r}function Ts(e,n,{delay:t=0,transitionOverride:r,type:i}={}){var o;let{transition:a=e.getDefaultTransition(),transitionEnd:s,...l}=n;r&&(a=r);const c=[],u=i&&e.animationState&&e.animationState.getState()[i];for(const n in l){const r=e.getValue(n,null!==(o=e.latestValues[n])&&void 0!==o?o:null),i=l[n];if(void 0===i||u&&Os(u,n))continue;const s={delay:t,...Gr(a||{},n)};let d=!1;if(window.MotionHandoffAnimation){const t=ji(e);if(t){const e=window.MotionHandoffAnimation(t,n,ii);null!==e&&(s.startTime=e,d=!0)}}yi(e,n),r.start(Ms(n,r,i,e.shouldReduceMotion&&Xr.has(n)?{type:!1}:s,e,d));const m=r.animation;m&&c.push(m)}return s&&Promise.all(c).then(()=>{ii.update(()=>{s&&function(e,n){const t=qr(e,n);let{transitionEnd:r={},transition:i={},...o}=t||{};o={...o,...r};for(const n in o)bi(e,n,Zr(o[n]))}(e,s)})}),c}function As(e,n,t={}){var r;const i=qr(e,n,"exit"===t.type?null===(r=e.presenceContext)||void 0===r?void 0:r.custom:void 0);let{transition:o=e.getDefaultTransition()||{}}=i||{};t.transitionOverride&&(o=t.transitionOverride);const a=i?()=>Promise.all(Ts(e,i,t)):()=>Promise.resolve(),s=e.variantChildren&&e.variantChildren.size?(r=0)=>{const{delayChildren:i=0,staggerChildren:a,staggerDirection:s}=o;return function(e,n,t=0,r=0,i=1,o){const a=[],s=(e.variantChildren.size-1)*r,l=1===i?(e=0)=>e*r:(e=0)=>s-e*r;return Array.from(e.variantChildren).sort(Ls).forEach((e,r)=>{e.notify("AnimationStart",n),a.push(As(e,n,{...o,delay:t+l(r)}).then(()=>e.notify("AnimationComplete",n)))}),Promise.all(a)}(e,n,i+r,a,s,t)}:()=>Promise.resolve(),{when:l}=o;if(l){const[e,n]="beforeChildren"===l?[a,s]:[s,a];return e().then(()=>n())}return Promise.all([a(),s(t.delay)])}function Ls(e,n){return e.sortNodePosition(n)}const zs=Yr.length;function Is(e){if(!e)return;if(!e.isControllingVariants){const n=e.parent&&Is(e.parent)||{};return void 0!==e.props.initial&&(n.initial=e.props.initial),n}const n={};for(let t=0;t<zs;t++){const r=Yr[t],i=e.props[r];(Hr(i)||!1===i)&&(n[r]=i)}return n}const Rs=[...$r].reverse(),Bs=$r.length;function _s(e){return n=>Promise.all(n.map(({animation:n,options:t})=>function(e,n,t={}){let r;if(e.notify("AnimationStart",n),Array.isArray(n)){const i=n.map(n=>As(e,n,t));r=Promise.all(i)}else if("string"==typeof n)r=As(e,n,t);else{const i="function"==typeof n?qr(e,n,t.custom):n;r=Promise.all(Ts(e,i,t))}return r.then(()=>{e.notify("AnimationComplete",n)})}(e,n,t)))}function Fs(e){let n=_s(e),t=Ws(),r=!0;const i=n=>(t,r)=>{var i;const o=qr(e,r,"exit"===n?null===(i=e.presenceContext)||void 0===i?void 0:i.custom:void 0);if(o){const{transition:e,transitionEnd:n,...r}=o;t={...t,...r,...n}}return t};function o(o){const{props:a}=e,s=Is(e.parent)||{},l=[],c=new Set;let u={},d=1/0;for(let n=0;n<Bs;n++){const m=Rs[n],p=t[m],g=void 0!==a[m]?a[m]:s[m],h=Hr(g),v=m===o?p.isActive:null;!1===v&&(d=n);let f=g===s[m]&&g!==a[m]&&h;if(f&&r&&e.manuallyAnimateOnMount&&(f=!1),p.protectedKeys={...u},!p.isActive&&null===v||!g&&!p.prevProp||_r(g)||"boolean"==typeof g)continue;const b=Us(p.prevProp,g);let x=b||m===o&&p.isActive&&!f&&h||n>d&&h,y=!1;const k=Array.isArray(g)?g:[g];let w=k.reduce(i(m),{});!1===v&&(w={});const{prevResolvedValues:j={}}=p,C={...j,...w},S=n=>{x=!0,c.has(n)&&(y=!0,c.delete(n)),p.needsAnimating[n]=!0;const t=e.getValue(n);t&&(t.liveStyle=!1)};for(const e in C){const n=w[e],t=j[e];if(u.hasOwnProperty(e))continue;let r=!1;r=Fr(n)&&Fr(t)?!Ur(n,t):n!==t,r?null!=n?S(e):c.add(e):void 0!==n&&c.has(e)?S(e):p.protectedKeys[e]=!0}p.prevProp=g,p.prevResolvedValues=w,p.isActive&&(u={...u,...w}),r&&e.blockInitialAnimation&&(x=!1);x&&(!(f&&b)||y)&&l.push(...k.map(e=>({animation:e,options:{type:m}})))}if(c.size){const n={};c.forEach(t=>{const r=e.getBaseTarget(t),i=e.getValue(t);i&&(i.liveStyle=!0),n[t]=null!=r?r:null}),l.push({animation:n})}let m=Boolean(l.length);return!r||!1!==a.initial&&a.initial!==a.animate||e.manuallyAnimateOnMount||(m=!1),r=!1,m?n(l):Promise.resolve()}return{animateChanges:o,setActive:function(n,r){var i;if(t[n].isActive===r)return Promise.resolve();null===(i=e.variantChildren)||void 0===i||i.forEach(e=>{var t;return null===(t=e.animationState)||void 0===t?void 0:t.setActive(n,r)}),t[n].isActive=r;const a=o(n);for(const e in t)t[e].protectedKeys={};return a},setAnimateFunction:function(t){n=t(e)},getState:()=>t,reset:()=>{t=Ws(),r=!0}}}function Us(e,n){return"string"==typeof n?n!==e:!!Array.isArray(n)&&!Ur(n,e)}function Hs(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function Ws(){return{animate:Hs(!0),whileInView:Hs(),whileHover:Hs(),whileTap:Hs(),whileDrag:Hs(),whileFocus:Hs(),exit:Hs()}}class Vs{constructor(e){this.isMounted=!1,this.node=e}update(){}}let qs=0;const $s={animation:{Feature:class extends Vs{constructor(e){super(e),e.animationState||(e.animationState=Fs(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();_r(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:n}=this.node.prevProps||{};e!==n&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),null===(e=this.unmountControls)||void 0===e||e.call(this)}}},exit:{Feature:class extends Vs{constructor(){super(...arguments),this.id=qs++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:n}=this.node.presenceContext,{isPresent:t}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===t)return;const r=this.node.animationState.setActive("exit",!e);n&&!e&&r.then(()=>n(this.id))}mount(){const{register:e}=this.node.presenceContext||{};e&&(this.unmount=e(this.id))}unmount(){}}}},Ys={x:!1,y:!1};function Gs(){return Ys.x||Ys.y}const Ks=e=>"mouse"===e.pointerType?"number"!=typeof e.button||e.button<=0:!1!==e.isPrimary;function Qs(e,n,t,r={passive:!0}){return e.addEventListener(n,t,r),()=>e.removeEventListener(n,t)}function Xs(e){return{point:{x:e.pageX,y:e.pageY}}}function Zs(e,n,t,r){return Qs(e,n,(e=>n=>Ks(n)&&e(n,Xs(n)))(t),r)}const Js=(e,n)=>Math.abs(e-n);class el{constructor(e,n,{transformPagePoint:t,contextWindow:r,dragSnapToOrigin:i=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!this.lastMoveEvent||!this.lastMoveEventInfo)return;const e=rl(this.lastMoveEventInfo,this.history),n=null!==this.startEvent,t=function(e,n){const t=Js(e.x,n.x),r=Js(e.y,n.y);return Math.sqrt(t**2+r**2)}(e.offset,{x:0,y:0})>=3;if(!n&&!t)return;const{point:r}=e,{timestamp:i}=ai;this.history.push({...r,timestamp:i});const{onStart:o,onMove:a}=this.handlers;n||(o&&o(this.lastMoveEvent,e),this.startEvent=this.lastMoveEvent),a&&a(this.lastMoveEvent,e)},this.handlePointerMove=(e,n)=>{this.lastMoveEvent=e,this.lastMoveEventInfo=nl(n,this.transformPagePoint),ii.update(this.updatePoint,!0)},this.handlePointerUp=(e,n)=>{this.end();const{onEnd:t,onSessionEnd:r,resumeAnimation:i}=this.handlers;if(this.dragSnapToOrigin&&i&&i(),!this.lastMoveEvent||!this.lastMoveEventInfo)return;const o=rl("pointercancel"===e.type?this.lastMoveEventInfo:nl(n,this.transformPagePoint),this.history);this.startEvent&&t&&t(e,o),r&&r(e,o)},!Ks(e))return;this.dragSnapToOrigin=i,this.handlers=n,this.transformPagePoint=t,this.contextWindow=r||window;const o=nl(Xs(e),this.transformPagePoint),{point:a}=o,{timestamp:s}=ai;this.history=[{...a,timestamp:s}];const{onSessionStart:l}=n;l&&l(e,rl(o,this.history)),this.removeListeners=Ta(Zs(this.contextWindow,"pointermove",this.handlePointerMove),Zs(this.contextWindow,"pointerup",this.handlePointerUp),Zs(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),oi(this.updatePoint)}}function nl(e,n){return n?{point:n(e.point)}:e}function tl(e,n){return{x:e.x-n.x,y:e.y-n.y}}function rl({point:e},n){return{point:e,delta:tl(e,ol(n)),offset:tl(e,il(n)),velocity:al(n,.1)}}function il(e){return e[0]}function ol(e){return e[e.length-1]}function al(e,n){if(e.length<2)return{x:0,y:0};let t=e.length-1,r=null;const i=ol(e);for(;t>=0&&(r=e[t],!(i.timestamp-r.timestamp>Pi(n)));)t--;if(!r)return{x:0,y:0};const o=Di(i.timestamp-r.timestamp);if(0===o)return{x:0,y:0};const a={x:(i.x-r.x)/o,y:(i.y-r.y)/o};return a.x===1/0&&(a.x=0),a.y===1/0&&(a.y=0),a}function sl(e){return e&&"object"==typeof e&&Object.prototype.hasOwnProperty.call(e,"current")}function ll(e){return e.max-e.min}function cl(e,n,t,r=.5){e.origin=r,e.originPoint=Ca(n.min,n.max,e.origin),e.scale=ll(t)/ll(n),e.translate=Ca(t.min,t.max,e.origin)-e.originPoint,(e.scale>=.9999&&e.scale<=1.0001||isNaN(e.scale))&&(e.scale=1),(e.translate>=-.01&&e.translate<=.01||isNaN(e.translate))&&(e.translate=0)}function ul(e,n,t,r){cl(e.x,n.x,t.x,r?r.originX:void 0),cl(e.y,n.y,t.y,r?r.originY:void 0)}function dl(e,n,t){e.min=t.min+n.min,e.max=e.min+ll(n)}function ml(e,n,t){e.min=n.min-t.min,e.max=e.min+ll(n)}function pl(e,n,t){ml(e.x,n.x,t.x),ml(e.y,n.y,t.y)}function gl(e,n,t){return{min:void 0!==n?e.min+n:void 0,max:void 0!==t?e.max+t-(e.max-e.min):void 0}}function hl(e,n){let t=n.min-e.min,r=n.max-e.max;return n.max-n.min<e.max-e.min&&([t,r]=[r,t]),{min:t,max:r}}const vl=.35;function fl(e,n,t){return{min:bl(e,n),max:bl(e,t)}}function bl(e,n){return"number"==typeof e?e:e[n]||0}const xl=()=>({x:{min:0,max:0},y:{min:0,max:0}});function yl(e){return[e("x"),e("y")]}function kl({top:e,left:n,right:t,bottom:r}){return{x:{min:n,max:t},y:{min:e,max:r}}}function wl(e){return void 0===e||1===e}function jl({scale:e,scaleX:n,scaleY:t}){return!wl(e)||!wl(n)||!wl(t)}function Cl(e){return jl(e)||Sl(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function Sl(e){return Nl(e.x)||Nl(e.y)}function Nl(e){return e&&"0%"!==e}function El(e,n,t){return t+n*(e-t)}function Pl(e,n,t,r,i){return void 0!==i&&(e=El(e,i,r)),El(e,t,r)+n}function Dl(e,n=0,t=1,r,i){e.min=Pl(e.min,n,t,r,i),e.max=Pl(e.max,n,t,r,i)}function Ml(e,{x:n,y:t}){Dl(e.x,n.translate,n.scale,n.originPoint),Dl(e.y,t.translate,t.scale,t.originPoint)}const Ol=.999999999999,Tl=1.0000000000001;function Al(e,n){e.min=e.min+n,e.max=e.max+n}function Ll(e,n,t,r,i=.5){Dl(e,n,t,Ca(e.min,e.max,i),r)}function zl(e,n){Ll(e.x,n.x,n.scaleX,n.scale,n.originX),Ll(e.y,n.y,n.scaleY,n.scale,n.originY)}function Il(e,n){return kl(function(e,n){if(!n)return e;const t=n({x:e.left,y:e.top}),r=n({x:e.right,y:e.bottom});return{top:t.y,left:t.x,bottom:r.y,right:r.x}}(e.getBoundingClientRect(),n))}const Rl=({current:e})=>e?e.ownerDocument.defaultView:null,Bl=new WeakMap;class _l{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic={x:{min:0,max:0},y:{min:0,max:0}},this.visualElement=e}start(e,{snapToCursor:n=!1}={}){const{presenceContext:t}=this.visualElement;if(t&&!1===t.isPresent)return;const{dragSnapToOrigin:r}=this.getProps();this.panSession=new el(e,{onSessionStart:e=>{const{dragSnapToOrigin:t}=this.getProps();t?this.pauseAnimation():this.stopAnimation(),n&&this.snapToCursor(Xs(e).point)},onStart:(e,n)=>{const{drag:t,dragPropagation:r,onDragStart:i}=this.getProps();if(t&&!r&&(this.openDragLock&&this.openDragLock(),this.openDragLock="x"===(o=t)||"y"===o?Ys[o]?null:(Ys[o]=!0,()=>{Ys[o]=!1}):Ys.x||Ys.y?null:(Ys.x=Ys.y=!0,()=>{Ys.x=Ys.y=!1}),!this.openDragLock))return;var o;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),yl(e=>{let n=this.getAxisMotionValue(e).get()||0;if(fo.test(n)){const{projection:t}=this.visualElement;if(t&&t.layout){const r=t.layout.layoutBox[e];if(r){n=ll(r)*(parseFloat(n)/100)}}}this.originPoint[e]=n}),i&&ii.postRender(()=>i(e,n)),yi(this.visualElement,"transform");const{animationState:a}=this.visualElement;a&&a.setActive("whileDrag",!0)},onMove:(e,n)=>{const{dragPropagation:t,dragDirectionLock:r,onDirectionLock:i,onDrag:o}=this.getProps();if(!t&&!this.openDragLock)return;const{offset:a}=n;if(r&&null===this.currentDirection)return this.currentDirection=function(e,n=10){let t=null;Math.abs(e.y)>n?t="y":Math.abs(e.x)>n&&(t="x");return t}(a),void(null!==this.currentDirection&&i&&i(this.currentDirection));this.updateAxis("x",n.point,a),this.updateAxis("y",n.point,a),this.visualElement.render(),o&&o(e,n)},onSessionEnd:(e,n)=>this.stop(e,n),resumeAnimation:()=>yl(e=>{var n;return"paused"===this.getAnimationState(e)&&(null===(n=this.getAxisMotionValue(e).animation)||void 0===n?void 0:n.play())})},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:r,contextWindow:Rl(this.visualElement)})}stop(e,n){const t=this.isDragging;if(this.cancel(),!t)return;const{velocity:r}=n;this.startAnimation(r);const{onDragEnd:i}=this.getProps();i&&ii.postRender(()=>i(e,n))}cancel(){this.isDragging=!1;const{projection:e,animationState:n}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:t}=this.getProps();!t&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),n&&n.setActive("whileDrag",!1)}updateAxis(e,n,t){const{drag:r}=this.getProps();if(!t||!Fl(e,r,this.currentDirection))return;const i=this.getAxisMotionValue(e);let o=this.originPoint[e]+t[e];this.constraints&&this.constraints[e]&&(o=function(e,{min:n,max:t},r){return void 0!==n&&e<n?e=r?Ca(n,e,r.min):Math.max(e,n):void 0!==t&&e>t&&(e=r?Ca(t,e,r.max):Math.min(e,t)),e}(o,this.constraints[e],this.elastic[e])),i.set(o)}resolveConstraints(){var e;const{dragConstraints:n,dragElastic:t}=this.getProps(),r=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):null===(e=this.visualElement.projection)||void 0===e?void 0:e.layout,i=this.constraints;n&&sl(n)?this.constraints||(this.constraints=this.resolveRefConstraints()):this.constraints=!(!n||!r)&&function(e,{top:n,left:t,bottom:r,right:i}){return{x:gl(e.x,t,i),y:gl(e.y,n,r)}}(r.layoutBox,n),this.elastic=function(e=vl){return!1===e?e=0:!0===e&&(e=vl),{x:fl(e,"left","right"),y:fl(e,"top","bottom")}}(t),i!==this.constraints&&r&&this.constraints&&!this.hasMutatedConstraints&&yl(e=>{!1!==this.constraints&&this.getAxisMotionValue(e)&&(this.constraints[e]=function(e,n){const t={};return void 0!==n.min&&(t.min=n.min-e.min),void 0!==n.max&&(t.max=n.max-e.min),t}(r.layoutBox[e],this.constraints[e]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:n}=this.getProps();if(!e||!sl(e))return!1;const t=e.current;ia(null!==t,"If `dragConstraints` is set as a React ref, that ref must be passed to another component's `ref` prop.");const{projection:r}=this.visualElement;if(!r||!r.layout)return!1;const i=function(e,n,t){const r=Il(e,t),{scroll:i}=n;return i&&(Al(r.x,i.offset.x),Al(r.y,i.offset.y)),r}(t,r.root,this.visualElement.getTransformPagePoint());let o=function(e,n){return{x:hl(e.x,n.x),y:hl(e.y,n.y)}}(r.layout.layoutBox,i);if(n){const e=n(function({x:e,y:n}){return{top:n.min,right:e.max,bottom:n.max,left:e.min}}(o));this.hasMutatedConstraints=!!e,e&&(o=kl(e))}return o}startAnimation(e){const{drag:n,dragMomentum:t,dragElastic:r,dragTransition:i,dragSnapToOrigin:o,onDragTransitionEnd:a}=this.getProps(),s=this.constraints||{},l=yl(a=>{if(!Fl(a,n,this.currentDirection))return;let l=s&&s[a]||{};o&&(l={min:0,max:0});const c=r?200:1e6,u=r?40:1e7,d={type:"inertia",velocity:t?e[a]:0,bounceStiffness:c,bounceDamping:u,timeConstant:750,restDelta:1,restSpeed:10,...i,...l};return this.startAxisValueAnimation(a,d)});return Promise.all(l).then(a)}startAxisValueAnimation(e,n){const t=this.getAxisMotionValue(e);return yi(this.visualElement,e),t.start(Ms(e,t,0,n,this.visualElement,!1))}stopAnimation(){yl(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){yl(e=>{var n;return null===(n=this.getAxisMotionValue(e).animation)||void 0===n?void 0:n.pause()})}getAnimationState(e){var n;return null===(n=this.getAxisMotionValue(e).animation)||void 0===n?void 0:n.state}getAxisMotionValue(e){const n=`_drag${e.toUpperCase()}`,t=this.visualElement.getProps(),r=t[n];return r||this.visualElement.getValue(e,(t.initial?t.initial[e]:void 0)||0)}snapToCursor(e){yl(n=>{const{drag:t}=this.getProps();if(!Fl(n,t,this.currentDirection))return;const{projection:r}=this.visualElement,i=this.getAxisMotionValue(n);if(r&&r.layout){const{min:t,max:o}=r.layout.layoutBox[n];i.set(e[n]-Ca(t,o,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:n}=this.getProps(),{projection:t}=this.visualElement;if(!sl(n)||!t||!this.constraints)return;this.stopAnimation();const r={x:0,y:0};yl(e=>{const n=this.getAxisMotionValue(e);if(n&&!1!==this.constraints){const t=n.get();r[e]=function(e,n){let t=.5;const r=ll(e),i=ll(n);return i>r?t=Ri(n.min,n.max-r,e.min):r>i&&(t=Ri(e.min,e.max-i,n.min)),to(0,1,t)}({min:t,max:t},this.constraints[e])}});const{transformTemplate:i}=this.visualElement.getProps();this.visualElement.current.style.transform=i?i({},""):"none",t.root&&t.root.updateScroll(),t.updateLayout(),this.resolveConstraints(),yl(n=>{if(!Fl(n,e,null))return;const t=this.getAxisMotionValue(n),{min:i,max:o}=this.constraints[n];t.set(Ca(i,o,r[n]))})}addListeners(){if(!this.visualElement.current)return;Bl.set(this.visualElement,this);const e=Zs(this.visualElement.current,"pointerdown",e=>{const{drag:n,dragListener:t=!0}=this.getProps();n&&t&&this.start(e)}),n=()=>{const{dragConstraints:e}=this.getProps();sl(e)&&e.current&&(this.constraints=this.resolveRefConstraints())},{projection:t}=this.visualElement,r=t.addEventListener("measure",n);t&&!t.layout&&(t.root&&t.root.updateScroll(),t.updateLayout()),ii.read(n);const i=Qs(window,"resize",()=>this.scalePositionWithinConstraints()),o=t.addEventListener("didUpdate",({delta:e,hasLayoutChanged:n})=>{this.isDragging&&n&&(yl(n=>{const t=this.getAxisMotionValue(n);t&&(this.originPoint[n]+=e[n].translate,t.set(t.get()+e[n].translate))}),this.visualElement.render())});return()=>{i(),e(),r(),o&&o()}}getProps(){const e=this.visualElement.getProps(),{drag:n=!1,dragDirectionLock:t=!1,dragPropagation:r=!1,dragConstraints:i=!1,dragElastic:o=vl,dragMomentum:a=!0}=e;return{...e,drag:n,dragDirectionLock:t,dragPropagation:r,dragConstraints:i,dragElastic:o,dragMomentum:a}}}function Fl(e,n,t){return!(!0!==n&&n!==e||null!==t&&t!==e)}const Ul=e=>(n,t)=>{e&&ii.postRender(()=>e(n,t))};const Hl=(0,Ce.createContext)({}),Wl={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function Vl(e,n){return n.max===n.min?0:e/(n.max-n.min)*100}const ql={correct:(e,n)=>{if(!n.target)return e;if("string"==typeof e){if(!bo.test(e))return e;e=parseFloat(e)}return`${Vl(e,n.target.x)}% ${Vl(e,n.target.y)}%`}},$l={correct:(e,{treeScale:n,projectionDelta:t})=>{const r=e,i=To.parse(e);if(i.length>5)return r;const o=To.createTransformer(e),a="number"!=typeof i[0]?1:0,s=t.x.scale*n.x,l=t.y.scale*n.y;i[0+a]/=s,i[1+a]/=l;const c=Ca(s,l,.5);return"number"==typeof i[2+a]&&(i[2+a]/=c),"number"==typeof i[3+a]&&(i[3+a]/=c),o(i)}},Yl={};const{schedule:Gl,cancel:Kl}=ri(queueMicrotask,!1);class Ql extends Ce.Component{componentDidMount(){const{visualElement:e,layoutGroup:n,switchLayoutGroup:t,layoutId:r}=this.props,{projection:i}=e;var o;o=Zl,Object.assign(Yl,o),i&&(n.group&&n.group.add(i),t&&t.register&&r&&t.register(i),i.root.didUpdate(),i.addEventListener("animationComplete",()=>{this.safeToRemove()}),i.setOptions({...i.options,onExitComplete:()=>this.safeToRemove()})),Wl.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:n,visualElement:t,drag:r,isPresent:i}=this.props,o=t.projection;return o?(o.isPresent=i,r||e.layoutDependency!==n||void 0===n?o.willUpdate():this.safeToRemove(),e.isPresent!==i&&(i?o.promote():o.relegate()||ii.postRender(()=>{const e=o.getStack();e&&e.members.length||this.safeToRemove()})),null):null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),Gl.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:n,switchLayoutGroup:t}=this.props,{projection:r}=e;r&&(r.scheduleCheckAfterUnmount(),n&&n.group&&n.group.remove(r),t&&t.deregister&&t.deregister(r))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function Xl(e){const[n,t]=Tr(),r=(0,Ce.useContext)(Cr);return(0,Ee.jsx)(Ql,{...e,layoutGroup:r,switchLayoutGroup:(0,Ce.useContext)(Hl),isPresent:n,safeToRemove:t})}const Zl={borderRadius:{...ql,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:ql,borderTopRightRadius:ql,borderBottomLeftRadius:ql,borderBottomRightRadius:ql,boxShadow:$l};const Jl=(e,n)=>e.depth-n.depth;class ec{constructor(){this.children=[],this.isDirty=!1}add(e){di(this.children,e),this.isDirty=!0}remove(e){mi(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(Jl),this.isDirty=!1,this.children.forEach(e)}}function nc(e,n){const t=ui.now(),r=({timestamp:i})=>{const o=i-t;o>=n&&(oi(r),e(o-n))};return ii.read(r,!0),()=>oi(r)}function tc(e){const n=xi(e)?e.get():e;return t=n,Boolean(t&&"object"==typeof t&&t.mix&&t.toValue)?n.toValue():n;var t}const rc=["TopLeft","TopRight","BottomLeft","BottomRight"],ic=rc.length,oc=e=>"string"==typeof e?parseFloat(e):e,ac=e=>"number"==typeof e||bo.test(e);function sc(e,n){return void 0!==e[n]?e[n]:e.borderRadius}const lc=uc(0,.5,Zi),cc=uc(.5,.95,ni);function uc(e,n,t){return r=>r<e?0:r>n?1:t(Ri(e,n,r))}function dc(e,n){e.min=n.min,e.max=n.max}function mc(e,n){dc(e.x,n.x),dc(e.y,n.y)}function pc(e,n){e.translate=n.translate,e.scale=n.scale,e.originPoint=n.originPoint,e.origin=n.origin}function gc(e,n,t,r,i){return e=El(e-=n,1/t,r),void 0!==i&&(e=El(e,1/i,r)),e}function hc(e,n,[t,r,i],o,a){!function(e,n=0,t=1,r=.5,i,o=e,a=e){fo.test(n)&&(n=parseFloat(n),n=Ca(a.min,a.max,n/100)-a.min);if("number"!=typeof n)return;let s=Ca(o.min,o.max,r);e===o&&(s-=n),e.min=gc(e.min,n,t,s,i),e.max=gc(e.max,n,t,s,i)}(e,n[t],n[r],n[i],n.scale,o,a)}const vc=["x","scaleX","originX"],fc=["y","scaleY","originY"];function bc(e,n,t,r){hc(e.x,n,vc,t?t.x:void 0,r?r.x:void 0),hc(e.y,n,fc,t?t.y:void 0,r?r.y:void 0)}function xc(e){return 0===e.translate&&1===e.scale}function yc(e){return xc(e.x)&&xc(e.y)}function kc(e,n){return e.min===n.min&&e.max===n.max}function wc(e,n){return Math.round(e.min)===Math.round(n.min)&&Math.round(e.max)===Math.round(n.max)}function jc(e,n){return wc(e.x,n.x)&&wc(e.y,n.y)}function Cc(e){return ll(e.x)/ll(e.y)}function Sc(e,n){return e.translate===n.translate&&e.scale===n.scale&&e.originPoint===n.originPoint}class Nc{constructor(){this.members=[]}add(e){di(this.members,e),e.scheduleRender()}remove(e){if(mi(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const e=this.members[this.members.length-1];e&&this.promote(e)}}relegate(e){const n=this.members.findIndex(n=>e===n);if(0===n)return!1;let t;for(let e=n;e>=0;e--){const n=this.members[e];if(!1!==n.isPresent){t=n;break}}return!!t&&(this.promote(t),!0)}promote(e,n){const t=this.lead;if(e!==t&&(this.prevLead=t,this.lead=e,e.show(),t)){t.instance&&t.scheduleRender(),e.scheduleRender(),e.resumeFrom=t,n&&(e.resumeFrom.preserveOpacity=!0),t.snapshot&&(e.snapshot=t.snapshot,e.snapshot.latestValues=t.animationValues||t.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:r}=e.options;!1===r&&t.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:n,resumingFrom:t}=e;n.onExitComplete&&n.onExitComplete(),t&&t.options.onExitComplete&&t.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}const Ec={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},Pc="undefined"!=typeof window&&void 0!==window.MotionDebug,Dc=["","X","Y","Z"],Mc={visibility:"hidden"};let Oc=0;function Tc(e,n,t,r){const{latestValues:i}=n;i[e]&&(t[e]=i[e],n.setStaticValue(e,0),r&&(r[e]=0))}function Ac(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:n}=e.options;if(!n)return;const t=ji(n);if(window.MotionHasOptimisedAnimation(t,"transform")){const{layout:n,layoutId:r}=e.options;window.MotionCancelOptimisedAnimation(t,"transform",ii,!(n||r))}const{parent:r}=e;r&&!r.hasCheckedOptimisedAppear&&Ac(r)}function Lc({attachResizeListener:e,defaultParent:n,measureScroll:t,checkIsScrollRoot:r,resetTransform:i}){return class{constructor(e={},t=(null==n?void 0:n())){this.id=Oc++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,Pc&&(Ec.totalNodes=Ec.resolvedTargetDeltas=Ec.recalculatedProjection=0),this.nodes.forEach(Rc),this.nodes.forEach(Vc),this.nodes.forEach(qc),this.nodes.forEach(Bc),Pc&&window.MotionDebug.record(Ec)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=e,this.root=t?t.root||t:this,this.path=t?[...t.path,t]:[],this.parent=t,this.depth=t?t.depth+1:0;for(let e=0;e<this.path.length;e++)this.path[e].shouldResetTransform=!0;this.root===this&&(this.nodes=new ec)}addEventListener(e,n){return this.eventHandlers.has(e)||this.eventHandlers.set(e,new pi),this.eventHandlers.get(e).add(n)}notifyListeners(e,...n){const t=this.eventHandlers.get(e);t&&t.notify(...n)}hasListeners(e){return this.eventHandlers.has(e)}mount(n,t=this.root.hasTreeAnimated){if(this.instance)return;var r;this.isSVG=(r=n)instanceof SVGElement&&"svg"!==r.tagName,this.instance=n;const{layoutId:i,layout:o,visualElement:a}=this.options;if(a&&!a.current&&a.mount(n),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),t&&(o||i)&&(this.isLayoutDirty=!0),e){let t;const r=()=>this.root.updateBlockedByResize=!1;e(n,()=>{this.root.updateBlockedByResize=!0,t&&t(),t=nc(r,250),Wl.hasAnimatedSinceResize&&(Wl.hasAnimatedSinceResize=!1,this.nodes.forEach(Wc))})}i&&this.root.registerSharedNode(i,this),!1!==this.options.animate&&a&&(i||o)&&this.addEventListener("didUpdate",({delta:e,hasLayoutChanged:n,hasRelativeTargetChanged:t,layout:r})=>{if(this.isTreeAnimationBlocked())return this.target=void 0,void(this.relativeTarget=void 0);const i=this.options.transition||a.getDefaultTransition()||Xc,{onLayoutAnimationStart:o,onLayoutAnimationComplete:s}=a.getProps(),l=!this.targetLayout||!jc(this.targetLayout,r)||t,c=!n&&t;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||c||n&&(l||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(e,c);const n={...Gr(i,"layout"),onPlay:o,onComplete:s};(a.shouldReduceMotion||this.options.layoutRoot)&&(n.delay=0,n.type=!1),this.startAnimation(n)}else n||Wc(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=r})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const e=this.getStack();e&&e.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,oi(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach($c),this.animationId++)}getTransformTemplate(){const{visualElement:e}=this.options;return e&&e.getProps().transformTemplate}willUpdate(e=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked())return void(this.options.onExitComplete&&this.options.onExitComplete());if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&Ac(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let e=0;e<this.path.length;e++){const n=this.path[e];n.shouldResetTransform=!0,n.updateScroll("snapshot"),n.options.layoutRoot&&n.willUpdate(!1)}const{layoutId:n,layout:t}=this.options;if(void 0===n&&!t)return;const r=this.getTransformTemplate();this.prevTransformTemplateValue=r?r(this.latestValues,""):void 0,this.updateSnapshot(),e&&this.notifyListeners("willUpdate")}update(){this.updateScheduled=!1;if(this.isUpdateBlocked())return this.unblockUpdate(),this.clearAllSnapshots(),void this.nodes.forEach(Fc);this.isUpdating||this.nodes.forEach(Uc),this.isUpdating=!1,this.nodes.forEach(Hc),this.nodes.forEach(zc),this.nodes.forEach(Ic),this.clearAllSnapshots();const e=ui.now();ai.delta=to(0,1e3/60,e-ai.timestamp),ai.timestamp=e,ai.isProcessing=!0,si.update.process(ai),si.preRender.process(ai),si.render.process(ai),ai.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,Gl.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(_c),this.sharedNodes.forEach(Yc)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,ii.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){ii.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){!this.snapshot&&this.instance&&(this.snapshot=this.measure())}updateLayout(){if(!this.instance)return;if(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead()||this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let e=0;e<this.path.length;e++){this.path[e].updateScroll()}const e=this.layout;this.layout=this.measure(!1),this.layoutCorrected={x:{min:0,max:0},y:{min:0,max:0}},this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:n}=this.options;n&&n.notify("LayoutMeasure",this.layout.layoutBox,e?e.layoutBox:void 0)}updateScroll(e="measure"){let n=Boolean(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===e&&(n=!1),n){const n=r(this.instance);this.scroll={animationId:this.root.animationId,phase:e,isRoot:n,offset:t(this.instance),wasRoot:this.scroll?this.scroll.isRoot:n}}}resetTransform(){if(!i)return;const e=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,n=this.projectionDelta&&!yc(this.projectionDelta),t=this.getTransformTemplate(),r=t?t(this.latestValues,""):void 0,o=r!==this.prevTransformTemplateValue;e&&(n||Cl(this.latestValues)||o)&&(i(this.instance,r),this.shouldResetTransform=!1,this.scheduleRender())}measure(e=!0){const n=this.measurePageBox();let t=this.removeElementScroll(n);var r;return e&&(t=this.removeTransform(t)),eu((r=t).x),eu(r.y),{animationId:this.root.animationId,measuredBox:n,layoutBox:t,latestValues:{},source:this.id}}measurePageBox(){var e;const{visualElement:n}=this.options;if(!n)return{x:{min:0,max:0},y:{min:0,max:0}};const t=n.measureViewportBox();if(!((null===(e=this.scroll)||void 0===e?void 0:e.wasRoot)||this.path.some(tu))){const{scroll:e}=this.root;e&&(Al(t.x,e.offset.x),Al(t.y,e.offset.y))}return t}removeElementScroll(e){var n;const t={x:{min:0,max:0},y:{min:0,max:0}};if(mc(t,e),null===(n=this.scroll)||void 0===n?void 0:n.wasRoot)return t;for(let n=0;n<this.path.length;n++){const r=this.path[n],{scroll:i,options:o}=r;r!==this.root&&i&&o.layoutScroll&&(i.wasRoot&&mc(t,e),Al(t.x,i.offset.x),Al(t.y,i.offset.y))}return t}applyTransform(e,n=!1){const t={x:{min:0,max:0},y:{min:0,max:0}};mc(t,e);for(let e=0;e<this.path.length;e++){const r=this.path[e];!n&&r.options.layoutScroll&&r.scroll&&r!==r.root&&zl(t,{x:-r.scroll.offset.x,y:-r.scroll.offset.y}),Cl(r.latestValues)&&zl(t,r.latestValues)}return Cl(this.latestValues)&&zl(t,this.latestValues),t}removeTransform(e){const n={x:{min:0,max:0},y:{min:0,max:0}};mc(n,e);for(let e=0;e<this.path.length;e++){const t=this.path[e];if(!t.instance)continue;if(!Cl(t.latestValues))continue;jl(t.latestValues)&&t.updateSnapshot();const r=xl();mc(r,t.measurePageBox()),bc(n,t.latestValues,t.snapshot?t.snapshot.layoutBox:void 0,r)}return Cl(this.latestValues)&&bc(n,this.latestValues),n}setTargetDelta(e){this.targetDelta=e,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(e){this.options={...this.options,...e,crossfade:void 0===e.crossfade||e.crossfade}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==ai.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(e=!1){var n;const t=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=t.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=t.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=t.isSharedProjectionDirty);const r=Boolean(this.resumingFrom)||this!==t;if(!(e||r&&this.isSharedProjectionDirty||this.isProjectionDirty||(null===(n=this.parent)||void 0===n?void 0:n.isProjectionDirty)||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:i,layoutId:o}=this.options;if(this.layout&&(i||o)){if(this.resolvedRelativeTargetAt=ai.timestamp,!this.targetDelta&&!this.relativeTarget){const e=this.getClosestProjectingParent();e&&e.layout&&1!==this.animationProgress?(this.relativeParent=e,this.forceRelativeParentToResolveTarget(),this.relativeTarget={x:{min:0,max:0},y:{min:0,max:0}},this.relativeTargetOrigin={x:{min:0,max:0},y:{min:0,max:0}},pl(this.relativeTargetOrigin,this.layout.layoutBox,e.layout.layoutBox),mc(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(this.relativeTarget||this.targetDelta){var a,s,l;if(this.target||(this.target={x:{min:0,max:0},y:{min:0,max:0}},this.targetWithTransforms={x:{min:0,max:0},y:{min:0,max:0}}),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),a=this.target,s=this.relativeTarget,l=this.relativeParent.target,dl(a.x,s.x,l.x),dl(a.y,s.y,l.y)):this.targetDelta?(Boolean(this.resumingFrom)?this.target=this.applyTransform(this.layout.layoutBox):mc(this.target,this.layout.layoutBox),Ml(this.target,this.targetDelta)):mc(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const e=this.getClosestProjectingParent();e&&Boolean(e.resumingFrom)===Boolean(this.resumingFrom)&&!e.options.layoutScroll&&e.target&&1!==this.animationProgress?(this.relativeParent=e,this.forceRelativeParentToResolveTarget(),this.relativeTarget={x:{min:0,max:0},y:{min:0,max:0}},this.relativeTargetOrigin={x:{min:0,max:0},y:{min:0,max:0}},pl(this.relativeTargetOrigin,this.target,e.target),mc(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}Pc&&Ec.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(this.parent&&!jl(this.parent.latestValues)&&!Sl(this.parent.latestValues))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return Boolean((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var e;const n=this.getLead(),t=Boolean(this.resumingFrom)||this!==n;let r=!0;if((this.isProjectionDirty||(null===(e=this.parent)||void 0===e?void 0:e.isProjectionDirty))&&(r=!1),t&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(r=!1),this.resolvedRelativeTargetAt===ai.timestamp&&(r=!1),r)return;const{layout:i,layoutId:o}=this.options;if(this.isTreeAnimating=Boolean(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!i&&!o)return;mc(this.layoutCorrected,this.layout.layoutBox);const a=this.treeScale.x,s=this.treeScale.y;!function(e,n,t,r=!1){const i=t.length;if(!i)return;let o,a;n.x=n.y=1;for(let s=0;s<i;s++){o=t[s],a=o.projectionDelta;const{visualElement:i}=o.options;i&&i.props.style&&"contents"===i.props.style.display||(r&&o.options.layoutScroll&&o.scroll&&o!==o.root&&zl(e,{x:-o.scroll.offset.x,y:-o.scroll.offset.y}),a&&(n.x*=a.x.scale,n.y*=a.y.scale,Ml(e,a)),r&&Cl(o.latestValues)&&zl(e,o.latestValues))}n.x<Tl&&n.x>Ol&&(n.x=1),n.y<Tl&&n.y>Ol&&(n.y=1)}(this.layoutCorrected,this.treeScale,this.path,t),!n.layout||n.target||1===this.treeScale.x&&1===this.treeScale.y||(n.target=n.layout.layoutBox,n.targetWithTransforms={x:{min:0,max:0},y:{min:0,max:0}});const{target:l}=n;l?(this.projectionDelta&&this.prevProjectionDelta?(pc(this.prevProjectionDelta.x,this.projectionDelta.x),pc(this.prevProjectionDelta.y,this.projectionDelta.y)):this.createProjectionDeltas(),ul(this.projectionDelta,this.layoutCorrected,l,this.latestValues),this.treeScale.x===a&&this.treeScale.y===s&&Sc(this.projectionDelta.x,this.prevProjectionDelta.x)&&Sc(this.projectionDelta.y,this.prevProjectionDelta.y)||(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",l)),Pc&&Ec.recalculatedProjection++):this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender())}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(e=!0){var n;if(null===(n=this.options.visualElement)||void 0===n||n.scheduleRender(),e){const e=this.getStack();e&&e.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}},this.projectionDelta={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}},this.projectionDeltaWithTransform={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}}}setAnimationOrigin(e,n=!1){const t=this.snapshot,r=t?t.latestValues:{},i={...this.latestValues},o={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};this.relativeParent&&this.relativeParent.options.layoutRoot||(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!n;const a={x:{min:0,max:0},y:{min:0,max:0}},s=(t?t.source:void 0)!==(this.layout?this.layout.source:void 0),l=this.getStack(),c=!l||l.members.length<=1,u=Boolean(s&&!c&&!0===this.options.crossfade&&!this.path.some(Qc));let d;this.animationProgress=0,this.mixTargetDelta=n=>{const t=n/1e3;var l,m,p,g,h,v;Gc(o.x,e.x,t),Gc(o.y,e.y,t),this.setTargetDelta(o),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(pl(a,this.layout.layoutBox,this.relativeParent.layout.layoutBox),p=this.relativeTarget,g=this.relativeTargetOrigin,h=a,v=t,Kc(p.x,g.x,h.x,v),Kc(p.y,g.y,h.y,v),d&&(l=this.relativeTarget,m=d,kc(l.x,m.x)&&kc(l.y,m.y))&&(this.isProjectionDirty=!1),d||(d={x:{min:0,max:0},y:{min:0,max:0}}),mc(d,this.relativeTarget)),s&&(this.animationValues=i,function(e,n,t,r,i,o){i?(e.opacity=Ca(0,void 0!==t.opacity?t.opacity:1,lc(r)),e.opacityExit=Ca(void 0!==n.opacity?n.opacity:1,0,cc(r))):o&&(e.opacity=Ca(void 0!==n.opacity?n.opacity:1,void 0!==t.opacity?t.opacity:1,r));for(let i=0;i<ic;i++){const o=`border${rc[i]}Radius`;let a=sc(n,o),s=sc(t,o);void 0===a&&void 0===s||(a||(a=0),s||(s=0),0===a||0===s||ac(a)===ac(s)?(e[o]=Math.max(Ca(oc(a),oc(s),r),0),(fo.test(s)||fo.test(a))&&(e[o]+="%")):e[o]=s)}(n.rotate||t.rotate)&&(e.rotate=Ca(n.rotate||0,t.rotate||0,r))}(i,r,this.latestValues,t,u,c)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=t},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(e){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(oi(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=ii.update(()=>{Wl.hasAnimatedSinceResize=!0,this.currentAnimation=function(e,n,t){const r=xi(e)?e:fi(e);return r.start(Ms("",r,n,t)),r.animation}(0,1e3,{...e,onUpdate:n=>{this.mixTargetDelta(n),e.onUpdate&&e.onUpdate(n)},onComplete:()=>{e.onComplete&&e.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const e=this.getStack();e&&e.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(1e3),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const e=this.getLead();let{targetWithTransforms:n,target:t,layout:r,latestValues:i}=e;if(n&&t&&r){if(this!==e&&this.layout&&r&&nu(this.options.animationType,this.layout.layoutBox,r.layoutBox)){t=this.target||{x:{min:0,max:0},y:{min:0,max:0}};const n=ll(this.layout.layoutBox.x);t.x.min=e.target.x.min,t.x.max=t.x.min+n;const r=ll(this.layout.layoutBox.y);t.y.min=e.target.y.min,t.y.max=t.y.min+r}mc(n,t),zl(n,i),ul(this.projectionDeltaWithTransform,this.layoutCorrected,n,i)}}registerSharedNode(e,n){this.sharedNodes.has(e)||this.sharedNodes.set(e,new Nc);this.sharedNodes.get(e).add(n);const t=n.options.initialPromotionConfig;n.promote({transition:t?t.transition:void 0,preserveFollowOpacity:t&&t.shouldPreserveFollowOpacity?t.shouldPreserveFollowOpacity(n):void 0})}isLead(){const e=this.getStack();return!e||e.lead===this}getLead(){var e;const{layoutId:n}=this.options;return n&&(null===(e=this.getStack())||void 0===e?void 0:e.lead)||this}getPrevLead(){var e;const{layoutId:n}=this.options;return n?null===(e=this.getStack())||void 0===e?void 0:e.prevLead:void 0}getStack(){const{layoutId:e}=this.options;if(e)return this.root.sharedNodes.get(e)}promote({needsReset:e,transition:n,preserveFollowOpacity:t}={}){const r=this.getStack();r&&r.promote(this,t),e&&(this.projectionDelta=void 0,this.needsReset=!0),n&&this.setOptions({transition:n})}relegate(){const e=this.getStack();return!!e&&e.relegate(this)}resetSkewAndRotation(){const{visualElement:e}=this.options;if(!e)return;let n=!1;const{latestValues:t}=e;if((t.z||t.rotate||t.rotateX||t.rotateY||t.rotateZ||t.skewX||t.skewY)&&(n=!0),!n)return;const r={};t.z&&Tc("z",e,r,this.animationValues);for(let n=0;n<Dc.length;n++)Tc(`rotate${Dc[n]}`,e,r,this.animationValues),Tc(`skew${Dc[n]}`,e,r,this.animationValues);e.render();for(const n in r)e.setStaticValue(n,r[n]),this.animationValues&&(this.animationValues[n]=r[n]);e.scheduleRender()}getProjectionStyles(e){var n,t;if(!this.instance||this.isSVG)return;if(!this.isVisible)return Mc;const r={visibility:""},i=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,r.opacity="",r.pointerEvents=tc(null==e?void 0:e.pointerEvents)||"",r.transform=i?i(this.latestValues,""):"none",r;const o=this.getLead();if(!this.projectionDelta||!this.layout||!o.target){const n={};return this.options.layoutId&&(n.opacity=void 0!==this.latestValues.opacity?this.latestValues.opacity:1,n.pointerEvents=tc(null==e?void 0:e.pointerEvents)||""),this.hasProjected&&!Cl(this.latestValues)&&(n.transform=i?i({},""):"none",this.hasProjected=!1),n}const a=o.animationValues||o.latestValues;this.applyTransformsToTarget(),r.transform=function(e,n,t){let r="";const i=e.x.translate/n.x,o=e.y.translate/n.y,a=(null==t?void 0:t.z)||0;if((i||o||a)&&(r=`translate3d(${i}px, ${o}px, ${a}px) `),1===n.x&&1===n.y||(r+=`scale(${1/n.x}, ${1/n.y}) `),t){const{transformPerspective:e,rotate:n,rotateX:i,rotateY:o,skewX:a,skewY:s}=t;e&&(r=`perspective(${e}px) ${r}`),n&&(r+=`rotate(${n}deg) `),i&&(r+=`rotateX(${i}deg) `),o&&(r+=`rotateY(${o}deg) `),a&&(r+=`skewX(${a}deg) `),s&&(r+=`skewY(${s}deg) `)}const s=e.x.scale*n.x,l=e.y.scale*n.y;return 1===s&&1===l||(r+=`scale(${s}, ${l})`),r||"none"}(this.projectionDeltaWithTransform,this.treeScale,a),i&&(r.transform=i(a,r.transform));const{x:s,y:l}=this.projectionDelta;r.transformOrigin=`${100*s.origin}% ${100*l.origin}% 0`,o.animationValues?r.opacity=o===this?null!==(t=null!==(n=a.opacity)&&void 0!==n?n:this.latestValues.opacity)&&void 0!==t?t:1:this.preserveOpacity?this.latestValues.opacity:a.opacityExit:r.opacity=o===this?void 0!==a.opacity?a.opacity:"":void 0!==a.opacityExit?a.opacityExit:0;for(const e in Yl){if(void 0===a[e])continue;const{correct:n,applyTo:t}=Yl[e],i="none"===r.transform?a[e]:n(a[e],o);if(t){const e=t.length;for(let n=0;n<e;n++)r[t[n]]=i}else r[e]=i}return this.options.layoutId&&(r.pointerEvents=o===this?tc(null==e?void 0:e.pointerEvents)||"":"none"),r}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(e=>{var n;return null===(n=e.currentAnimation)||void 0===n?void 0:n.stop()}),this.root.nodes.forEach(Fc),this.root.sharedNodes.clear()}}}function zc(e){e.updateLayout()}function Ic(e){var n;const t=(null===(n=e.resumeFrom)||void 0===n?void 0:n.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&t&&e.hasListeners("didUpdate")){const{layoutBox:n,measuredBox:r}=e.layout,{animationType:i}=e.options,o=t.source!==e.layout.source;"size"===i?yl(e=>{const r=o?t.measuredBox[e]:t.layoutBox[e],i=ll(r);r.min=n[e].min,r.max=r.min+i}):nu(i,t.layoutBox,n)&&yl(r=>{const i=o?t.measuredBox[r]:t.layoutBox[r],a=ll(n[r]);i.max=i.min+a,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[r].max=e.relativeTarget[r].min+a)});const a={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};ul(a,n,t.layoutBox);const s={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};o?ul(s,e.applyTransform(r,!0),t.measuredBox):ul(s,n,t.layoutBox);const l=!yc(a);let c=!1;if(!e.resumeFrom){const r=e.getClosestProjectingParent();if(r&&!r.resumeFrom){const{snapshot:i,layout:o}=r;if(i&&o){const a={x:{min:0,max:0},y:{min:0,max:0}};pl(a,t.layoutBox,i.layoutBox);const s={x:{min:0,max:0},y:{min:0,max:0}};pl(s,n,o.layoutBox),jc(a,s)||(c=!0),r.options.layoutRoot&&(e.relativeTarget=s,e.relativeTargetOrigin=a,e.relativeParent=r)}}}e.notifyListeners("didUpdate",{layout:n,snapshot:t,delta:s,layoutDelta:a,hasLayoutChanged:l,hasRelativeTargetChanged:c})}else if(e.isLead()){const{onExitComplete:n}=e.options;n&&n()}e.options.transition=void 0}function Rc(e){Pc&&Ec.totalNodes++,e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=Boolean(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function Bc(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function _c(e){e.clearSnapshot()}function Fc(e){e.clearMeasurements()}function Uc(e){e.isLayoutDirty=!1}function Hc(e){const{visualElement:n}=e.options;n&&n.getProps().onBeforeLayoutMeasure&&n.notify("BeforeLayoutMeasure"),e.resetTransform()}function Wc(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function Vc(e){e.resolveTargetDelta()}function qc(e){e.calcProjection()}function $c(e){e.resetSkewAndRotation()}function Yc(e){e.removeLeadSnapshot()}function Gc(e,n,t){e.translate=Ca(n.translate,0,t),e.scale=Ca(n.scale,1,t),e.origin=n.origin,e.originPoint=n.originPoint}function Kc(e,n,t,r){e.min=Ca(n.min,t.min,r),e.max=Ca(n.max,t.max,r)}function Qc(e){return e.animationValues&&void 0!==e.animationValues.opacityExit}const Xc={duration:.45,ease:[.4,0,.1,1]},Zc=e=>"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),Jc=Zc("applewebkit/")&&!Zc("chrome/")?Math.round:ni;function eu(e){e.min=Jc(e.min),e.max=Jc(e.max)}function nu(e,n,t){return"position"===e||"preserve-aspect"===e&&(r=Cc(n),i=Cc(t),o=.2,!(Math.abs(r-i)<=o));var r,i,o}function tu(e){var n;return e!==e.root&&(null===(n=e.scroll)||void 0===n?void 0:n.wasRoot)}const ru=Lc({attachResizeListener:(e,n)=>Qs(e,"resize",n),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),iu={current:void 0},ou=Lc({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!iu.current){const e=new ru({});e.mount(window),e.setOptions({layoutScroll:!0}),iu.current=e}return iu.current},resetTransform:(e,n)=>{e.style.transform=void 0!==n?n:"none"},checkIsScrollRoot:e=>Boolean("fixed"===window.getComputedStyle(e).position)}),au={pan:{Feature:class extends Vs{constructor(){super(...arguments),this.removePointerDownListener=ni}onPointerDown(e){this.session=new el(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:Rl(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:n,onPan:t,onPanEnd:r}=this.node.getProps();return{onSessionStart:Ul(e),onStart:Ul(n),onMove:t,onEnd:(e,n)=>{delete this.session,r&&ii.postRender(()=>r(e,n))}}}mount(){this.removePointerDownListener=Zs(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}},drag:{Feature:class extends Vs{constructor(e){super(e),this.removeGroupControls=ni,this.removeListeners=ni,this.controls=new _l(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||ni}unmount(){this.removeGroupControls(),this.removeListeners()}},ProjectionNode:ou,MeasureLayout:Xl}};function su(e,n){const t=function(e,n,t){var r;if(e instanceof Element)return[e];if("string"==typeof e){let i=document;n&&(i=n.current);const o=null!==(r=null==t?void 0:t[e])&&void 0!==r?r:i.querySelectorAll(e);return o?Array.from(o):[]}return Array.from(e)}(e),r=new AbortController;return[t,{passive:!0,...n,signal:r.signal},()=>r.abort()]}function lu(e){return n=>{"touch"===n.pointerType||Gs()||e(n)}}function cu(e,n,t){const{props:r}=e;e.animationState&&r.whileHover&&e.animationState.setActive("whileHover","Start"===t);const i=r["onHover"+t];i&&ii.postRender(()=>i(n,Xs(n)))}const uu=(e,n)=>!!n&&(e===n||uu(e,n.parentElement)),du=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);const mu=new WeakSet;function pu(e){return n=>{"Enter"===n.key&&e(n)}}function gu(e,n){e.dispatchEvent(new PointerEvent("pointer"+n,{isPrimary:!0,bubbles:!0}))}function hu(e){return Ks(e)&&!Gs()}function vu(e,n,t={}){const[r,i,o]=su(e,t),a=e=>{const r=e.currentTarget;if(!hu(e)||mu.has(r))return;mu.add(r);const o=n(e),a=(e,n)=>{window.removeEventListener("pointerup",s),window.removeEventListener("pointercancel",l),hu(e)&&mu.has(r)&&(mu.delete(r),"function"==typeof o&&o(e,{success:n}))},s=e=>{a(e,t.useGlobalTarget||uu(r,e.target))},l=e=>{a(e,!1)};window.addEventListener("pointerup",s,i),window.addEventListener("pointercancel",l,i)};return r.forEach(e=>{(function(e){return du.has(e.tagName)||-1!==e.tabIndex})(e)||null!==e.getAttribute("tabindex")||(e.tabIndex=0);(t.useGlobalTarget?window:e).addEventListener("pointerdown",a,i),e.addEventListener("focus",e=>((e,n)=>{const t=e.currentTarget;if(!t)return;const r=pu(()=>{if(mu.has(t))return;gu(t,"down");const e=pu(()=>{gu(t,"up")});t.addEventListener("keyup",e,n),t.addEventListener("blur",()=>gu(t,"cancel"),n)});t.addEventListener("keydown",r,n),t.addEventListener("blur",()=>t.removeEventListener("keydown",r),n)})(e,i),i)}),o}function fu(e,n,t){const{props:r}=e;e.animationState&&r.whileTap&&e.animationState.setActive("whileTap","Start"===t);const i=r["onTap"+("End"===t?"":t)];i&&ii.postRender(()=>i(n,Xs(n)))}const bu=new WeakMap,xu=new WeakMap,yu=e=>{const n=bu.get(e.target);n&&n(e)},ku=e=>{e.forEach(yu)};function wu(e,n,t){const r=function({root:e,...n}){const t=e||document;xu.has(t)||xu.set(t,{});const r=xu.get(t),i=JSON.stringify(n);return r[i]||(r[i]=new IntersectionObserver(ku,{root:e,...n})),r[i]}(n);return bu.set(e,t),r.observe(e),()=>{bu.delete(e),r.unobserve(e)}}const ju={some:0,all:1};const Cu={inView:{Feature:class extends Vs{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:n,margin:t,amount:r="some",once:i}=e,o={root:n?n.current:void 0,rootMargin:t,threshold:"number"==typeof r?r:ju[r]};return wu(this.node.current,o,e=>{const{isIntersecting:n}=e;if(this.isInView===n)return;if(this.isInView=n,i&&!n&&this.hasEnteredView)return;n&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",n);const{onViewportEnter:t,onViewportLeave:r}=this.node.getProps(),o=n?t:r;o&&o(e)})}mount(){this.startObserver()}update(){if("undefined"==typeof IntersectionObserver)return;const{props:e,prevProps:n}=this.node;["amount","margin","root"].some(function({viewport:e={}},{viewport:n={}}={}){return t=>e[t]!==n[t]}(e,n))&&this.startObserver()}unmount(){}}},tap:{Feature:class extends Vs{mount(){const{current:e}=this.node;e&&(this.unmount=vu(e,e=>(fu(this.node,e,"Start"),(e,{success:n})=>fu(this.node,e,n?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}},focus:{Feature:class extends Vs{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch(n){e=!0}e&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){this.isActive&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Ta(Qs(this.node.current,"focus",()=>this.onFocus()),Qs(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}},hover:{Feature:class extends Vs{mount(){const{current:e}=this.node;e&&(this.unmount=function(e,n,t={}){const[r,i,o]=su(e,t),a=lu(e=>{const{target:t}=e,r=n(e);if("function"!=typeof r||!t)return;const o=lu(e=>{r(e),t.removeEventListener("pointerleave",o)});t.addEventListener("pointerleave",o,i)});return r.forEach(e=>{e.addEventListener("pointerenter",a,i)}),o}(e,e=>(cu(this.node,e,"Start"),e=>cu(this.node,e,"End"))))}unmount(){}}}},Su={layout:{ProjectionNode:ou,MeasureLayout:Xl}},Nu=(0,Ce.createContext)({strict:!1}),Eu=(0,Ce.createContext)({});function Pu(e){return _r(e.animate)||Yr.some(n=>Hr(e[n]))}function Du(e){return Boolean(Pu(e)||e.variants)}function Mu(e){const{initial:n,animate:t}=function(e,n){if(Pu(e)){const{initial:n,animate:t}=e;return{initial:!1===n||Hr(n)?n:void 0,animate:Hr(t)?t:void 0}}return!1!==e.inherit?n:{}}(e,(0,Ce.useContext)(Eu));return(0,Ce.useMemo)(()=>({initial:n,animate:t}),[Ou(n),Ou(t)])}function Ou(e){return Array.isArray(e)?e.join(" "):e}const Tu={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Au={};for(const e in Tu)Au[e]={isEnabled:n=>Tu[e].some(e=>!!n[e])};const Lu=Symbol.for("motionComponentSymbol");function zu(e,n,t){return(0,Ce.useCallback)(r=>{r&&e.onMount&&e.onMount(r),n&&(r?n.mount(r):n.unmount()),t&&("function"==typeof t?t(r):sl(t)&&(t.current=r))},[n])}function Iu(e,n,t,r,i){var o,a;const{visualElement:s}=(0,Ce.useContext)(Eu),l=(0,Ce.useContext)(Nu),c=(0,Ce.useContext)(Nr),u=(0,Ce.useContext)(Er).reducedMotion,d=(0,Ce.useRef)(null);r=r||l.renderer,!d.current&&r&&(d.current=r(e,{visualState:n,parent:s,props:t,presenceContext:c,blockInitialAnimation:!!c&&!1===c.initial,reducedMotionConfig:u}));const m=d.current,p=(0,Ce.useContext)(Hl);!m||m.projection||!i||"html"!==m.type&&"svg"!==m.type||function(e,n,t,r){const{layoutId:i,layout:o,drag:a,dragConstraints:s,layoutScroll:l,layoutRoot:c}=n;e.projection=new t(e.latestValues,n["data-framer-portal-id"]?void 0:Ru(e.parent)),e.projection.setOptions({layoutId:i,layout:o,alwaysMeasureLayout:Boolean(a)||s&&sl(s),visualElement:e,animationType:"string"==typeof o?o:"both",initialPromotionConfig:r,layoutScroll:l,layoutRoot:c})}(d.current,t,i,p);const g=(0,Ce.useRef)(!1);(0,Ce.useInsertionEffect)(()=>{m&&g.current&&m.update(t,c)});const h=t[wi],v=(0,Ce.useRef)(Boolean(h)&&!(null===(o=window.MotionHandoffIsComplete)||void 0===o?void 0:o.call(window,h))&&(null===(a=window.MotionHasOptimisedAnimation)||void 0===a?void 0:a.call(window,h)));return Ir(()=>{m&&(g.current=!0,window.MotionIsMounted=!0,m.updateFeatures(),Gl.render(m.render),v.current&&m.animationState&&m.animationState.animateChanges())}),(0,Ce.useEffect)(()=>{m&&(!v.current&&m.animationState&&m.animationState.animateChanges(),v.current&&(queueMicrotask(()=>{var e;null===(e=window.MotionHandoffMarkAsComplete)||void 0===e||e.call(window,h)}),v.current=!1))}),m}function Ru(e){if(e)return!1!==e.options.allowProjection?e.projection:Ru(e.parent)}function Bu({preloadedFeatures:e,createVisualElement:n,useRender:t,useVisualState:r,Component:i}){var o,a;function s(e,o){let a;const s={...(0,Ce.useContext)(Er),...e,layoutId:_u(e)},{isStatic:l}=s,c=Mu(e),u=r(e,l);if(!l&&zr){!function(){(0,Ce.useContext)(Nu).strict;0}();const e=function(e){const{drag:n,layout:t}=Au;if(!n&&!t)return{};const r={...n,...t};return{MeasureLayout:(null==n?void 0:n.isEnabled(e))||(null==t?void 0:t.isEnabled(e))?r.MeasureLayout:void 0,ProjectionNode:r.ProjectionNode}}(s);a=e.MeasureLayout,c.visualElement=Iu(i,u,s,n,e.ProjectionNode)}return(0,Ee.jsxs)(Eu.Provider,{value:c,children:[a&&c.visualElement?(0,Ee.jsx)(a,{visualElement:c.visualElement,...s}):null,t(i,e,zu(u,c.visualElement,o),u,l,c.visualElement)]})}e&&function(e){for(const n in e)Au[n]={...Au[n],...e[n]}}(e),s.displayName=`motion.${"string"==typeof i?i:`create(${null!==(a=null!==(o=i.displayName)&&void 0!==o?o:i.name)&&void 0!==a?a:""})`}`;const l=(0,Ce.forwardRef)(s);return l[Lu]=i,l}function _u({layoutId:e}){const n=(0,Ce.useContext)(Cr).id;return n&&void 0!==e?n+"-"+e:e}const Fu=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function Uu(e){return"string"==typeof e&&!e.includes("-")&&!!(Fu.indexOf(e)>-1||/[A-Z]/u.test(e))}const Hu=e=>(n,t)=>{const r=(0,Ce.useContext)(Eu),i=(0,Ce.useContext)(Nr),o=()=>function({scrapeMotionValuesFromProps:e,createRenderState:n,onUpdate:t},r,i,o){const a={latestValues:Wu(r,i,o,e),renderState:n()};return t&&(a.onMount=e=>t({props:r,current:e,...a}),a.onUpdate=e=>t(e)),a}(e,n,r,i);return t?o():Sr(o)};function Wu(e,n,t,r){const i={},o=r(e,{});for(const e in o)i[e]=tc(o[e]);let{initial:a,animate:s}=e;const l=Pu(e),c=Du(e);n&&c&&!l&&!1!==e.inherit&&(void 0===a&&(a=n.initial),void 0===s&&(s=n.animate));let u=!!t&&!1===t.initial;u=u||!1===a;const d=u?s:a;if(d&&"boolean"!=typeof d&&!_r(d)){const n=Array.isArray(d)?d:[d];for(let t=0;t<n.length;t++){const r=Vr(e,n[t]);if(r){const{transitionEnd:e,transition:n,...t}=r;for(const e in t){let n=t[e];if(Array.isArray(n)){n=n[u?n.length-1:0]}null!==n&&(i[e]=n)}for(const n in e)i[n]=e[n]}}}return i}const Vu=(e,n)=>n&&"number"==typeof e?n.transform(e):e,qu={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},$u=Kr.length;function Yu(e,n,t){const{style:r,vars:i,transformOrigin:o}=e;let a=!1,s=!1;for(const e in n){const t=n[e];if(Qr.has(e))a=!0;else if(sa(e))i[e]=t;else{const n=Vu(t,Fo[e]);e.startsWith("origin")?(s=!0,o[e]=n):r[e]=n}}if(n.transform||(a||t?r.transform=function(e,n,t){let r="",i=!0;for(let o=0;o<$u;o++){const a=Kr[o],s=e[a];if(void 0===s)continue;let l=!0;if(l="number"==typeof s?s===(a.startsWith("scale")?1:0):0===parseFloat(s),!l||t){const e=Vu(s,Fo[a]);l||(i=!1,r+=`${qu[a]||a}(${e}) `),t&&(n[a]=e)}}return r=r.trim(),t?r=t(n,i?"":r):i&&(r="none"),r}(n,e.transform,t):r.transform&&(r.transform="none")),s){const{originX:e="50%",originY:n="50%",originZ:t=0}=o;r.transformOrigin=`${e} ${n} ${t}`}}const Gu={offset:"stroke-dashoffset",array:"stroke-dasharray"},Ku={offset:"strokeDashoffset",array:"strokeDasharray"};function Qu(e,n,t){return"string"==typeof e?e:bo.transform(n+t*e)}function Xu(e,{attrX:n,attrY:t,attrScale:r,originX:i,originY:o,pathLength:a,pathSpacing:s=1,pathOffset:l=0,...c},u,d){if(Yu(e,c,d),u)return void(e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox));e.attrs=e.style,e.style={};const{attrs:m,style:p,dimensions:g}=e;m.transform&&(g&&(p.transform=m.transform),delete m.transform),g&&(void 0!==i||void 0!==o||p.transform)&&(p.transformOrigin=function(e,n,t){return`${Qu(n,e.x,e.width)} ${Qu(t,e.y,e.height)}`}(g,void 0!==i?i:.5,void 0!==o?o:.5)),void 0!==n&&(m.x=n),void 0!==t&&(m.y=t),void 0!==r&&(m.scale=r),void 0!==a&&function(e,n,t=1,r=0,i=!0){e.pathLength=1;const o=i?Gu:Ku;e[o.offset]=bo.transform(-r);const a=bo.transform(n),s=bo.transform(t);e[o.array]=`${a} ${s}`}(m,a,s,l,!1)}const Zu=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),Ju=()=>({style:{},transform:{},transformOrigin:{},vars:{},attrs:{}}),ed=e=>"string"==typeof e&&"svg"===e.toLowerCase();function nd(e,{style:n,vars:t},r,i){Object.assign(e.style,n,i&&i.getProjectionStyles(r));for(const n in t)e.style.setProperty(n,t[n])}const td=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function rd(e,n,t,r){nd(e,n,void 0,r);for(const t in n.attrs)e.setAttribute(td.has(t)?t:ki(t),n.attrs[t])}function id(e,{layout:n,layoutId:t}){return Qr.has(e)||e.startsWith("origin")||(n||void 0!==t)&&(!!Yl[e]||"opacity"===e)}function od(e,n,t){var r;const{style:i}=e,o={};for(const a in i)(xi(i[a])||n.style&&xi(n.style[a])||id(a,e)||void 0!==(null===(r=null==t?void 0:t.getValue(a))||void 0===r?void 0:r.liveStyle))&&(o[a]=i[a]);return o}function ad(e,n,t){const r=od(e,n,t);for(const t in e)if(xi(e[t])||xi(n[t])){r[-1!==Kr.indexOf(t)?"attr"+t.charAt(0).toUpperCase()+t.substring(1):t]=e[t]}return r}const sd=["x","y","width","height","cx","cy","r"],ld={useVisualState:Hu({scrapeMotionValuesFromProps:ad,createRenderState:Ju,onUpdate:({props:e,prevProps:n,current:t,renderState:r,latestValues:i})=>{if(!t)return;let o=!!e.drag;if(!o)for(const e in i)if(Qr.has(e)){o=!0;break}if(!o)return;let a=!n;if(n)for(let t=0;t<sd.length;t++){const r=sd[t];e[r]!==n[r]&&(a=!0)}a&&ii.read(()=>{!function(e,n){try{n.dimensions="function"==typeof e.getBBox?e.getBBox():e.getBoundingClientRect()}catch(e){n.dimensions={x:0,y:0,width:0,height:0}}}(t,r),ii.render(()=>{Xu(r,i,ed(t.tagName),e.transformTemplate),rd(t,r)})})}})},cd={useVisualState:Hu({scrapeMotionValuesFromProps:od,createRenderState:Zu})};function ud(e,n,t){for(const r in n)xi(n[r])||id(r,t)||(e[r]=n[r])}function dd(e,n){const t={};return ud(t,e.style||{},e),Object.assign(t,function({transformTemplate:e},n){return(0,Ce.useMemo)(()=>{const t={style:{},transform:{},transformOrigin:{},vars:{}};return Yu(t,n,e),Object.assign({},t.vars,t.style)},[n])}(e,n)),t}function md(e,n){const t={},r=dd(e,n);return e.drag&&!1!==e.dragListener&&(t.draggable=!1,r.userSelect=r.WebkitUserSelect=r.WebkitTouchCallout="none",r.touchAction=!0===e.drag?"none":"pan-"+("x"===e.drag?"y":"x")),void 0===e.tabIndex&&(e.onTap||e.onTapStart||e.whileTap)&&(t.tabIndex=0),t.style=r,t}const pd=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function gd(e){return e.startsWith("while")||e.startsWith("drag")&&"draggable"!==e||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||pd.has(e)}let hd=e=>!gd(e);try{(vd=require("@emotion/is-prop-valid").default)&&(hd=e=>e.startsWith("on")?!gd(e):vd(e))}catch(e){}var vd;function fd(e,n,t,r){const i=(0,Ce.useMemo)(()=>{const t={style:{},transform:{},transformOrigin:{},vars:{},attrs:{}};return Xu(t,n,ed(r),e.transformTemplate),{...t.attrs,style:{...t.style}}},[n]);if(e.style){const n={};ud(n,e.style,e),i.style={...n,...i.style}}return i}function bd(e=!1){return(n,t,r,{latestValues:i},o)=>{const a=(Uu(n)?fd:md)(t,i,o,n),s=function(e,n,t){const r={};for(const i in e)"values"===i&&"object"==typeof e.values||(hd(i)||!0===t&&gd(i)||!n&&!gd(i)||e.draggable&&i.startsWith("onDrag"))&&(r[i]=e[i]);return r}(t,"string"==typeof n,e),l=n!==Ce.Fragment?{...s,...a,ref:r}:{},{children:c}=t,u=(0,Ce.useMemo)(()=>xi(c)?c.get():c,[c]);return(0,Ce.createElement)(n,{...l,children:u})}}function xd(e,n){return function(t,{forwardMotionProps:r}={forwardMotionProps:!1}){return Bu({...Uu(t)?ld:cd,preloadedFeatures:e,useRender:bd(r),createVisualElement:n,Component:t})}}const yd={current:null},kd={current:!1};function wd(){if(kd.current=!0,zr)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),n=()=>yd.current=e.matches;e.addListener(n),n()}else yd.current=!1}const jd=[...ga,jo,To],Cd=new WeakMap;const Sd=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class Nd{scrapeMotionValuesFromProps(e,n,t){return{}}constructor({parent:e,props:n,presenceContext:t,reducedMotionConfig:r,blockInitialAnimation:i,visualState:o},a={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=ta,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const e=ui.now();this.renderScheduledAt<e&&(this.renderScheduledAt=e,ii.render(this.render,!1,!0))};const{latestValues:s,renderState:l,onUpdate:c}=o;this.onUpdate=c,this.latestValues=s,this.baseTarget={...s},this.initialValues=n.initial?{...s}:{},this.renderState=l,this.parent=e,this.props=n,this.presenceContext=t,this.depth=e?e.depth+1:0,this.reducedMotionConfig=r,this.options=a,this.blockInitialAnimation=Boolean(i),this.isControllingVariants=Pu(n),this.isVariantNode=Du(n),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=Boolean(e&&e.current);const{willChange:u,...d}=this.scrapeMotionValuesFromProps(n,{},this);for(const e in d){const n=d[e];void 0!==s[e]&&xi(n)&&n.set(s[e],!1)}}mount(e){this.current=e,Cd.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((e,n)=>this.bindToMotionValue(n,e)),kd.current||wd(),this.shouldReduceMotion="never"!==this.reducedMotionConfig&&("always"===this.reducedMotionConfig||yd.current),this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){Cd.delete(this.current),this.projection&&this.projection.unmount(),oi(this.notifyUpdate),oi(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const n=this.features[e];n&&(n.unmount(),n.isMounted=!1)}this.current=null}bindToMotionValue(e,n){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const t=Qr.has(e),r=n.on("change",n=>{this.latestValues[e]=n,this.props.onUpdate&&ii.preRender(this.notifyUpdate),t&&this.projection&&(this.projection.isTransformDirty=!0)}),i=n.on("renderRequest",this.scheduleRender);let o;window.MotionCheckAppearSync&&(o=window.MotionCheckAppearSync(this,e,n)),this.valueSubscriptions.set(e,()=>{r(),i(),o&&o(),n.owner&&n.stop()})}sortNodePosition(e){return this.current&&this.sortInstanceNodePosition&&this.type===e.type?this.sortInstanceNodePosition(this.current,e.current):0}updateFeatures(){let e="animation";for(e in Au){const n=Au[e];if(!n)continue;const{isEnabled:t,Feature:r}=n;if(!this.features[e]&&r&&t(this.props)&&(this.features[e]=new r(this)),this.features[e]){const n=this.features[e];n.isMounted?n.update():(n.mount(),n.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):{x:{min:0,max:0},y:{min:0,max:0}}}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,n){this.latestValues[e]=n}update(e,n){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=n;for(let n=0;n<Sd.length;n++){const t=Sd[n];this.propEventSubscriptions[t]&&(this.propEventSubscriptions[t](),delete this.propEventSubscriptions[t]);const r=e["on"+t];r&&(this.propEventSubscriptions[t]=this.on(t,r))}this.prevMotionValues=function(e,n,t){for(const r in n){const i=n[r],o=t[r];if(xi(i))e.addValue(r,i);else if(xi(o))e.addValue(r,fi(i,{owner:e}));else if(o!==i)if(e.hasValue(r)){const n=e.getValue(r);!0===n.liveStyle?n.jump(i):n.hasAnimated||n.set(i)}else{const n=e.getStaticValue(r);e.addValue(r,fi(void 0!==n?n:i,{owner:e}))}}for(const r in t)void 0===n[r]&&e.removeValue(r);return n}(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const n=this.getClosestVariantNode();if(n)return n.variantChildren&&n.variantChildren.add(e),()=>n.variantChildren.delete(e)}addValue(e,n){const t=this.values.get(e);n!==t&&(t&&this.removeValue(e),this.bindToMotionValue(e,n),this.values.set(e,n),this.latestValues[e]=n.get())}removeValue(e){this.values.delete(e);const n=this.valueSubscriptions.get(e);n&&(n(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,n){if(this.props.values&&this.props.values[e])return this.props.values[e];let t=this.values.get(e);return void 0===t&&void 0!==n&&(t=fi(null===n?void 0:n,{owner:this}),this.addValue(e,t)),t}readValue(e,n){var t;let r=void 0===this.latestValues[e]&&this.current?null!==(t=this.getBaseTargetFromProps(this.props,e))&&void 0!==t?t:this.readValueFromInstance(this.current,e,this.options):this.latestValues[e];var i;return null!=r&&("string"==typeof r&&(oa(r)||eo(r))?r=parseFloat(r):(i=r,!jd.find(pa(i))&&To.test(n)&&(r=Wo(e,n))),this.setBaseTarget(e,xi(r)?r.get():r)),xi(r)?r.get():r}setBaseTarget(e,n){this.baseTarget[e]=n}getBaseTarget(e){var n;const{initial:t}=this.props;let r;if("string"==typeof t||"object"==typeof t){const i=Vr(this.props,t,null===(n=this.presenceContext)||void 0===n?void 0:n.custom);i&&(r=i[e])}if(t&&void 0!==r)return r;const i=this.getBaseTargetFromProps(this.props,e);return void 0===i||xi(i)?void 0!==this.initialValues[e]&&void 0===r?void 0:this.baseTarget[e]:i}on(e,n){return this.events[e]||(this.events[e]=new pi),this.events[e].add(n)}notify(e,...n){this.events[e]&&this.events[e].notify(...n)}}class Ed extends Nd{constructor(){super(...arguments),this.KeyframeResolver=va}sortInstanceNodePosition(e,n){return 2&e.compareDocumentPosition(n)?1:-1}getBaseTargetFromProps(e,n){return e.style?e.style[n]:void 0}removeValueFromRenderState(e,{vars:n,style:t}){delete n[e],delete t[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;xi(e)&&(this.childSubscription=e.on("change",e=>{this.current&&(this.current.textContent=`${e}`)}))}}class Pd extends Ed{constructor(){super(...arguments),this.type="html",this.renderInstance=nd}readValueFromInstance(e,n){if(Qr.has(n)){const e=Ho(n);return e&&e.default||0}{const r=(t=e,window.getComputedStyle(t)),i=(sa(n)?r.getPropertyValue(n):r[n])||0;return"string"==typeof i?i.trim():i}var t}measureInstanceViewportBox(e,{transformPagePoint:n}){return Il(e,n)}build(e,n,t){Yu(e,n,t.transformTemplate)}scrapeMotionValuesFromProps(e,n,t){return od(e,n,t)}}class Dd extends Ed{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=xl}getBaseTargetFromProps(e,n){return e[n]}readValueFromInstance(e,n){if(Qr.has(n)){const e=Ho(n);return e&&e.default||0}return n=td.has(n)?n:ki(n),e.getAttribute(n)}scrapeMotionValuesFromProps(e,n,t){return ad(e,n,t)}build(e,n,t){Xu(e,n,this.isSVGTag,t.transformTemplate)}renderInstance(e,n,t,r){rd(e,n,0,r)}mount(e){this.isSVGTag=ed(e.tagName),super.mount(e)}}const Md=(e,n)=>Uu(e)?new Dd(n):new Pd(n,{allowProjection:e!==Ce.Fragment}),Od=Br(xd({...$s,...Cu,...au,...Su},Md)),Td=Sn("wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.106-3.105c.32-.322.863-.22.983.218a6 6 0 0 1-8.259 7.057l-7.91 7.91a1 1 0 0 1-2.999-3l7.91-7.91a6 6 0 0 1 7.057-8.259c.438.12.54.662.219.984z",key:"1ngwbx"}]]),Ad=Sn("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]),Ld=Sn("bookmark",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]]),zd=Sn("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),Id=Sn("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Rd=Sn("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),Bd=e=>{let{isOpen:n,onConfirm:t,onCancel:r,title:i="Confirm Action",message:o="Are you sure you want to proceed?",variant:a="safe",confirmText:s="Confirm",cancelText:l="Cancel",icon:c}=e;(0,Ce.useEffect)(()=>{const e=e=>{"Escape"===e.key&&n&&(null==r||r())};return n&&(document.addEventListener("keydown",e),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",e),document.body.style.overflow=""}},[n,r]);const u=(0,Ce.useCallback)(e=>{e.target===e.currentTarget&&(null==r||r())},[r]),d=(()=>{switch(a){case"danger":return{iconBg:"rgba(239, 68, 68, 0.15)",iconColor:"#ef4444",confirmBg:"linear-gradient(135deg, rgba(239, 68, 68, 0.9), rgba(220, 38, 38, 0.9))",confirmHoverBg:"linear-gradient(135deg, rgba(248, 113, 113, 0.95), rgba(239, 68, 68, 0.95))",confirmBorder:"rgba(239, 68, 68, 0.5)",accentGlow:"rgba(239, 68, 68, 0.3)",borderAccent:"rgba(239, 68, 68, 0.2)"};case"warning":return{iconBg:"rgba(245, 158, 11, 0.15)",iconColor:"#f59e0b",confirmBg:"linear-gradient(135deg, rgba(245, 158, 11, 0.9), rgba(217, 119, 6, 0.9))",confirmHoverBg:"linear-gradient(135deg, rgba(251, 191, 36, 0.95), rgba(245, 158, 11, 0.95))",confirmBorder:"rgba(245, 158, 11, 0.5)",accentGlow:"rgba(245, 158, 11, 0.3)",borderAccent:"rgba(245, 158, 11, 0.2)"};default:return{iconBg:"rgba(147, 112, 219, 0.15)",iconColor:"#9370db",confirmBg:"linear-gradient(135deg, rgba(147, 112, 219, 0.9), rgba(124, 58, 237, 0.9))",confirmHoverBg:"linear-gradient(135deg, rgba(167, 139, 250, 0.95), rgba(147, 112, 219, 0.95))",confirmBorder:"rgba(147, 112, 219, 0.5)",accentGlow:"rgba(147, 112, 219, 0.3)",borderAccent:"rgba(147, 112, 219, 0.2)"}}})(),m=c||(()=>{switch(a){case"danger":return(0,Ee.jsx)(ht,{size:24});case"warning":return(0,Ee.jsx)(mr,{size:24});default:return(0,Ee.jsx)(Rd,{size:24})}})();return(0,ot.createPortal)((0,Ee.jsx)(Rr,{children:n&&(0,Ee.jsx)(Od.div,{className:"lumiverse-confirm-backdrop",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.15},onClick:u,style:{position:"fixed",inset:0,zIndex:1e4,display:"flex",alignItems:"center",justifyContent:"center",padding:"20px",background:"rgba(0, 0, 0, 0.6)",backdropFilter:"blur(4px)",WebkitBackdropFilter:"blur(4px)",pointerEvents:"auto"},children:(0,Ee.jsxs)(Od.div,{className:"lumiverse-confirm-modal",initial:{opacity:0,scale:.95,y:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:10},transition:{duration:.2,ease:[.4,0,.2,1]},style:{position:"relative",width:"100%",maxWidth:"420px",background:"linear-gradient(135deg, rgba(30, 25, 45, 0.98), rgba(20, 18, 30, 0.98))",borderRadius:"16px",border:"1px solid ".concat(d.borderAccent),boxShadow:"\n                                0 25px 50px -12px rgba(0, 0, 0, 0.5),\n                                0 0 0 1px rgba(255, 255, 255, 0.05),\n                                0 0 40px ".concat(d.accentGlow,"\n                            "),overflow:"hidden"},children:[(0,Ee.jsx)("button",{onClick:r,style:{position:"absolute",top:"12px",right:"12px",width:"32px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)",borderRadius:"8px",color:"rgba(255, 255, 255, 0.6)",cursor:"pointer",transition:"all 0.15s ease"},onMouseEnter:e=>{e.currentTarget.style.background="rgba(255, 255, 255, 0.1)",e.currentTarget.style.color="rgba(255, 255, 255, 0.9)"},onMouseLeave:e=>{e.currentTarget.style.background="rgba(255, 255, 255, 0.05)",e.currentTarget.style.color="rgba(255, 255, 255, 0.6)"},type:"button","aria-label":"Close",children:(0,Ee.jsx)(mt,{size:16})}),(0,Ee.jsxs)("div",{style:{padding:"28px 24px 24px"},children:[(0,Ee.jsx)("div",{style:{width:"56px",height:"56px",margin:"0 auto 20px",display:"flex",alignItems:"center",justifyContent:"center",background:d.iconBg,borderRadius:"14px",color:d.iconColor},children:m}),(0,Ee.jsx)("h3",{style:{margin:"0 0 12px",fontSize:"18px",fontWeight:600,color:"#ffffff",textAlign:"center"},children:i}),(0,Ee.jsx)("div",{style:{fontSize:"14px",lineHeight:1.6,color:"rgba(255, 255, 255, 0.7)",textAlign:"center"},children:o})]}),(0,Ee.jsxs)("div",{style:{display:"flex",gap:"12px",padding:"0 24px 24px"},children:[(0,Ee.jsx)("button",{onClick:r,style:{flex:1,padding:"12px 20px",fontSize:"14px",fontWeight:500,background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.15)",borderRadius:"10px",color:"rgba(255, 255, 255, 0.8)",cursor:"pointer",transition:"all 0.15s ease"},onMouseEnter:e=>{e.currentTarget.style.background="rgba(255, 255, 255, 0.1)",e.currentTarget.style.borderColor="rgba(255, 255, 255, 0.25)"},onMouseLeave:e=>{e.currentTarget.style.background="rgba(255, 255, 255, 0.05)",e.currentTarget.style.borderColor="rgba(255, 255, 255, 0.15)"},type:"button",children:l}),(0,Ee.jsx)("button",{onClick:t,style:{flex:1,padding:"12px 20px",fontSize:"14px",fontWeight:600,background:d.confirmBg,border:"1px solid ".concat(d.confirmBorder),borderRadius:"10px",color:"#ffffff",cursor:"pointer",transition:"all 0.15s ease",boxShadow:"0 4px 12px ".concat(d.accentGlow)},onMouseEnter:e=>{e.currentTarget.style.background=d.confirmHoverBg,e.currentTarget.style.transform="translateY(-1px)",e.currentTarget.style.boxShadow="0 6px 16px ".concat(d.accentGlow)},onMouseLeave:e=>{e.currentTarget.style.background=d.confirmBg,e.currentTarget.style.transform="translateY(0)",e.currentTarget.style.boxShadow="0 4px 12px ".concat(d.accentGlow)},type:"button",children:s})]})]})})}),document.body)};function _d(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function Fd(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?_d(Object(t),!0).forEach(function(n){Ud(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):_d(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Ud(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const Hd=Ye,Wd=[],Vd={},qd={side:"right",verticalPosition:15,tabSize:"large"},$d=()=>Hd.getState().presets||Vd,Yd=()=>Hd.getState().activePresetName,Gd=()=>Hd.getState().chimeraMode||!1,Kd=()=>Hd.getState().councilMode||!1,Qd=()=>Hd.getState().councilMembers||Wd,Xd=()=>Hd.getState().selectedDefinitions||Wd,Zd=()=>{var e;return null===(e=Hd.getState().showLumiverseDrawer)||void 0===e||e},Jd=()=>{var e;return null!==(e=Hd.getState().drawerSettings)&&void 0!==e?e:qd},em=()=>{var e;return null===(e=Hd.getState().enableLandingPage)||void 0===e||e},nm=()=>{var e;return null!==(e=Hd.getState().landingPageChatsDisplayed)&&void 0!==e?e:12},tm={chimera:(0,Ee.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,Ee.jsx)("path",{d:"M12 2L2 7l10 5 10-5-10-5z"}),(0,Ee.jsx)("path",{d:"M2 17l10 5 10-5"}),(0,Ee.jsx)("path",{d:"M2 12l10 5 10-5"})]}),council:(0,Ee.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,Ee.jsx)("path",{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),(0,Ee.jsx)("circle",{cx:"9",cy:"7",r:"4"}),(0,Ee.jsx)("path",{d:"M23 21v-2a4 4 0 0 0-3-3.87"}),(0,Ee.jsx)("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]})},rm={book:(0,Ee.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,Ee.jsx)("path",{d:"M4 19.5A2.5 2.5 0 0 1 6.5 17H20"}),(0,Ee.jsx)("path",{d:"M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"})]}),settings:(0,Ee.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,Ee.jsx)("circle",{cx:"12",cy:"12",r:"3"}),(0,Ee.jsx)("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]}),layers:(0,Ee.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,Ee.jsx)("path",{d:"M12 2L2 7l10 5 10-5-10-5z"}),(0,Ee.jsx)("path",{d:"M2 17l10 5 10-5"}),(0,Ee.jsx)("path",{d:"M2 12l10 5 10-5"})]}),tools:(0,Ee.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,Ee.jsx)("path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"})}),terminal:(0,Ee.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,Ee.jsx)("polyline",{points:"4 17 10 11 4 5"}),(0,Ee.jsx)("line",{x1:"12",y1:"19",x2:"20",y2:"19"})]}),upload:(0,Ee.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,Ee.jsx)("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),(0,Ee.jsx)("polyline",{points:"17 8 12 3 7 8"}),(0,Ee.jsx)("line",{x1:"12",y1:"3",x2:"12",y2:"15"})]}),box:(0,Ee.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,Ee.jsx)("path",{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"}),(0,Ee.jsx)("polyline",{points:"3.27 6.96 12 12.01 20.73 6.96"}),(0,Ee.jsx)("line",{x1:"12",y1:"22.08",x2:"12",y2:"12"})]}),plus:(0,Ee.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,Ee.jsx)("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),(0,Ee.jsx)("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),dots:(0,Ee.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,Ee.jsx)("circle",{cx:"12",cy:"12",r:"1"}),(0,Ee.jsx)("circle",{cx:"19",cy:"12",r:"1"}),(0,Ee.jsx)("circle",{cx:"5",cy:"12",r:"1"})]}),lines:(0,Ee.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,Ee.jsx)("line",{x1:"21",y1:"10",x2:"3",y2:"10"}),(0,Ee.jsx)("line",{x1:"21",y1:"6",x2:"3",y2:"6"}),(0,Ee.jsx)("line",{x1:"21",y1:"14",x2:"3",y2:"14"}),(0,Ee.jsx)("line",{x1:"21",y1:"18",x2:"3",y2:"18"})]}),edit:(0,Ee.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,Ee.jsx)("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),(0,Ee.jsx)("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]}),chevronDown:(0,Ee.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,Ee.jsx)("polyline",{points:"6 9 12 15 18 9"})}),package:(0,Ee.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,Ee.jsx)("line",{x1:"16.5",y1:"9.4",x2:"7.5",y2:"4.21"}),(0,Ee.jsx)("path",{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"}),(0,Ee.jsx)("polyline",{points:"3.27 6.96 12 12.01 20.73 6.96"}),(0,Ee.jsx)("line",{x1:"12",y1:"22.08",x2:"12",y2:"12"})]}),download:(0,Ee.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,Ee.jsx)("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),(0,Ee.jsx)("polyline",{points:"7 10 12 15 17 10"}),(0,Ee.jsx)("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]})};function im(e){let{item:n,packName:t,onEdit:r,onDelete:i,editIcon:o}=e;const a=n.avatarUrl||n.lumia_img,s=n.lumiaName||n.lumiaDefName,{objectPosition:l}=xn(a);return(0,Ee.jsxs)("div",{className:"lumia-pack-lumia-item",children:[a&&(0,Ee.jsx)("img",{src:a,alt:"",className:"lumia-pack-lumia-avatar",style:{objectPosition:l},onError:e=>{e.target.style.display="none"}}),(0,Ee.jsx)("span",{className:"lumia-pack-lumia-name",children:s}),(0,Ee.jsx)("button",{className:"lumia-btn lumia-btn-icon lumia-btn-icon-sm",onClick:()=>r(t,n),title:"Edit Lumia",type:"button",children:o}),(0,Ee.jsx)("button",{className:"lumia-btn lumia-btn-icon lumia-btn-icon-sm lumia-btn-icon-danger",onClick:()=>i(t,n,s),title:"Delete Lumia",type:"button",children:(0,Ee.jsx)(Pn,{size:12,strokeWidth:1.5})})]})}function om(e){let{item:n,packName:t,onEdit:r,onDelete:i,editIcon:o}=e;const a=n.loomName||n.itemName||n.name||"Unknown",s=n.loomCategory||n.category||"Narrative Style";return(0,Ee.jsxs)("div",{className:"lumia-pack-loom-item",children:[(0,Ee.jsx)("span",{className:"lumia-pack-loom-icon",children:"Narrative Style"===s||"loomStyles"===s?(0,Ee.jsx)(Qt,{size:14,strokeWidth:1.5}):"Loom Utilities"===s||"loomUtils"===s?(0,Ee.jsx)(Td,{size:14,strokeWidth:1.5}):"Retrofits"===s||"loomRetrofits"===s?(0,Ee.jsx)(Jt,{size:14,strokeWidth:1.5}):(0,Ee.jsx)(Qt,{size:14,strokeWidth:1.5})}),(0,Ee.jsx)("span",{className:"lumia-pack-loom-name",children:a}),(0,Ee.jsx)("button",{className:"lumia-btn lumia-btn-icon lumia-btn-icon-sm",onClick:()=>r(t,n),title:"Edit Loom item",type:"button",children:o}),(0,Ee.jsx)("button",{className:"lumia-btn lumia-btn-icon lumia-btn-icon-sm lumia-btn-icon-danger",onClick:()=>i(t,n,a),title:"Delete Loom item",type:"button",children:(0,Ee.jsx)(Pn,{size:12,strokeWidth:1.5})})]})}function am(e){let{title:n,icon:t,action:r,collapsible:i,collapsed:o,onToggle:a,children:s}=e;const l=void 0!==o,[c,u]=(0,Ce.useState)(!1),d=l?o:c,m=(0,Ce.useCallback)(()=>{l&&a?a():u(e=>!e)},[l,a]);return(0,Ee.jsxs)("div",{className:On("lumia-panel",i&&d&&"lumia-panel--collapsed"),children:[(0,Ee.jsxs)("div",{className:On("lumia-panel-header",i&&"lumia-panel-header-clickable"),onClick:i?m:void 0,children:[(0,Ee.jsx)("span",{className:"lumia-panel-icon",children:t}),(0,Ee.jsx)("span",{className:"lumia-panel-title",children:n}),r&&(0,Ee.jsx)("span",{className:"lumia-panel-action",onClick:e=>e.stopPropagation(),children:r}),i&&(0,Ee.jsx)("span",{className:On("lumia-panel-chevron",!d&&"lumia-panel-chevron--expanded"),children:rm.chevronDown})]}),i?(0,Ee.jsx)(it,{isOpen:!d,className:"lumia-panel-content",duration:200,children:s}):(0,Ee.jsx)("div",{className:"lumia-panel-content",children:s})]})}function sm(e){let{title:n,icon:t,children:r}=e;const[i,o]=(0,Ce.useState)(!1);return(0,Ee.jsxs)("details",{className:"lumia-panel lumia-panel-collapsible",open:i,onToggle:e=>o(e.target.open),children:[(0,Ee.jsxs)("summary",{className:"lumia-panel-header lumia-panel-header-clickable",children:[(0,Ee.jsx)("span",{className:"lumia-panel-icon",children:t}),(0,Ee.jsx)("span",{className:"lumia-panel-title",children:n}),(0,Ee.jsx)("span",{className:"lumia-panel-chevron",children:rm.chevronDown})]}),(0,Ee.jsx)("div",{className:"lumia-panel-content lumia-macro-reference",children:r})]})}function lm(e){let{label:n,hint:t,selections:r,dominant:i,modalName:o}=e;const a=Xe(),s=(null==r?void 0:r.length)||0,l=(0,Ce.useMemo)(()=>{if(0===s)return"No ".concat(n.toLowerCase()," selected");const e=null==i?void 0:i.id,t=(null==i?void 0:i.name)||(null==i?void 0:i.itemName)||(null==i?void 0:i.lumiaDefName);return r.map(n=>{const r=(null==n?void 0:n.name)||(null==n?void 0:n.itemName)||(null==n?void 0:n.lumiaDefName)||"Unknown",o=null==n?void 0:n.id;return i&&(e&&o&&e===o||t&&r&&t===r)?"★ ".concat(r):r}).join(", ")},[s,r,n,i]);return(0,Ee.jsxs)("div",{className:"lumia-selector",children:[(0,Ee.jsxs)("div",{className:"lumia-selector-header",children:[(0,Ee.jsx)("span",{className:"lumia-selector-label",children:n}),(0,Ee.jsx)("span",{className:"lumia-selector-hint",children:t})]}),(0,Ee.jsxs)("div",{className:"lumia-selector-row",children:[(0,Ee.jsx)("div",{className:"lumia-selector-value",children:l}),(0,Ee.jsx)("button",{className:"lumia-btn lumia-btn-sm",onClick:()=>a.openModal(o),type:"button",children:"Select"})]})]})}function cm(e){let{icon:n,label:t,onClick:r,accent:i=!1}=e;return(0,Ee.jsxs)("button",{className:On("lumia-tool-btn",i&&"lumia-tool-btn-accent"),onClick:r,type:"button",children:[n,(0,Ee.jsx)("span",{children:t})]})}function um(e){let{icon:n,label:t,description:r,checked:i,onChange:o,disabled:a}=e;return(0,Ee.jsxs)("label",{className:On("lumiverse-mode-toggle",a&&"lumiverse-mode-toggle--disabled"),children:[(0,Ee.jsx)("span",{className:"lumiverse-mode-toggle-icon",children:n}),(0,Ee.jsxs)("div",{className:"lumiverse-mode-toggle-text",children:[(0,Ee.jsx)("span",{className:"lumiverse-mode-toggle-label",children:t}),(0,Ee.jsx)("span",{className:"lumiverse-mode-toggle-description",children:r})]}),(0,Ee.jsxs)("div",{className:On("lumiverse-toggle lumiverse-toggle--sm",i&&"lumiverse-toggle--on"),children:[(0,Ee.jsx)("input",{type:"checkbox",className:"lumiverse-toggle-input",checked:i,onChange:e=>o(e.target.checked),disabled:a}),(0,Ee.jsx)("span",{className:"lumiverse-toggle-slider"})]})]})}function dm(e){let{code:n,description:t}=e;const[r,i]=(0,Ce.useState)(!1),o=(0,Ce.useCallback)(()=>{navigator.clipboard.writeText(n),i(!0),setTimeout(()=>i(!1),1500)},[n]);return(0,Ee.jsxs)("div",{className:On("lumia-macro",r&&"lumia-macro--copied"),onClick:o,title:"Click to copy",children:[(0,Ee.jsx)("code",{children:n}),(0,Ee.jsx)("span",{children:r?"Copied!":t})]})}function mm(e){let{councilMode:n,councilMembers:t,onOpenCouncil:r,actions:i}=e;const[o,a]=(0,Ce.useState)(!1),[s,l]=(0,Ce.useState)(""),[c,u]=(0,Ce.useState)(!1),d=(0,Ce.useSyncExternalStore)(Hd.subscribe,$d,$d),m=(0,Ce.useSyncExternalStore)(Hd.subscribe,Yd,Yd),p=(0,Ce.useMemo)(()=>Object.values(d).sort((e,n)=>{const t=e.updatedAt||e.createdAt||0;return(n.updatedAt||n.createdAt||0)-t}),[d]),g=(0,Ce.useCallback)(()=>{const e=s.trim();e&&(d[e]?"undefined"!=typeof toastr&&toastr.warning('Preset "'.concat(e,'" already exists')):(i.savePreset(e),qe(),l(""),a(!1),"undefined"!=typeof toastr&&toastr.success('Preset "'.concat(e,'" saved'))))},[s,d,i]),h=(0,Ce.useCallback)(e=>{i.loadPreset(e),qe(),u(!1),"undefined"!=typeof toastr&&toastr.info('Loaded preset "'.concat(e,'"'))},[i]);return(0,Ee.jsxs)("div",{className:"lumia-quick-actions",children:[(0,Ee.jsxs)("button",{className:On("lumia-quick-action-btn","lumia-quick-action-btn--council",!n&&"lumia-quick-action-btn--disabled"),onClick:n?r:void 0,disabled:!n,type:"button",title:n?"Configure council members":"Enable Council Mode first",children:[(0,Ee.jsx)(Ad,{size:14,strokeWidth:1.5}),(0,Ee.jsx)("span",{className:"lumia-quick-action-text",children:n?t.length>0?"".concat(t.length," member").concat(1!==t.length?"s":""):"Configure":"Council"})]}),(0,Ee.jsx)("div",{className:"lumia-quick-action-group",children:o?(0,Ee.jsxs)("div",{className:"lumia-quick-action-form",children:[(0,Ee.jsx)("input",{type:"text",className:"lumia-quick-action-input",placeholder:"Preset name...",value:s,onChange:e=>l(e.target.value),onKeyDown:e=>{"Enter"===e.key&&g(),"Escape"===e.key&&(a(!1),l(""))},autoFocus:!0}),(0,Ee.jsx)("button",{className:"lumia-quick-action-btn lumia-quick-action-btn--primary",onClick:g,disabled:!s.trim(),type:"button",title:"Save preset",children:(0,Ee.jsx)(zd,{size:14,strokeWidth:2})}),(0,Ee.jsx)("button",{className:"lumia-quick-action-btn",onClick:()=>{a(!1),l("")},type:"button",title:"Cancel",children:(0,Ee.jsx)(mt,{size:14,strokeWidth:2})})]}):(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsx)("button",{className:"lumia-quick-action-btn lumia-quick-action-btn--primary",onClick:()=>a(!0),title:"Save current configuration as preset",type:"button",children:(0,Ee.jsx)(dr,{size:14,strokeWidth:2})}),(0,Ee.jsxs)("div",{className:"lumia-quick-action-dropdown-wrapper",children:[(0,Ee.jsxs)("button",{className:On("lumia-quick-action-btn",m&&"lumia-quick-action-btn--active"),onClick:()=>u(!c),title:m?"Active: ".concat(m):"Load preset",type:"button",children:[(0,Ee.jsx)(Ld,{size:14,strokeWidth:1.5}),(0,Ee.jsx)("span",{className:"lumia-quick-action-text",children:m||"Presets"}),(0,Ee.jsx)(Tn,{size:12,strokeWidth:2,className:On("lumia-quick-action-chevron",c&&"lumia-quick-action-chevron--open")})]}),(0,Ee.jsx)(Rr,{children:c&&(0,Ee.jsx)(Od.div,{className:"lumia-quick-action-dropdown",initial:{opacity:0,y:-8},animate:{opacity:1,y:0},exit:{opacity:0,y:-8},transition:{duration:.15},children:0===p.length?(0,Ee.jsx)("div",{className:"lumia-quick-action-dropdown-empty",children:"No presets saved"}):p.map(e=>(0,Ee.jsxs)("button",{className:On("lumia-quick-action-dropdown-item",m===e.name&&"lumia-quick-action-dropdown-item--active"),onClick:()=>h(e.name),type:"button",children:[(0,Ee.jsx)("span",{children:e.name}),m===e.name&&(0,Ee.jsx)(zd,{size:12,strokeWidth:2})]},e.name))})})]}),(0,Ee.jsx)("button",{className:"lumia-quick-action-btn",onClick:()=>i.openModal("presetManage"),title:"Manage presets",type:"button",children:(0,Ee.jsx)(dt,{size:14,strokeWidth:1.5})})]})})]})}const pm=function(){pn();const e=gn(),n=hn(),t=Xe(),{packs:r,customPacks:i,allPacks:o}=vn(),[a,s]=(0,Ce.useState)(null),[l,c]=(0,Ce.useState)({customPacks:!1,downloadedPacks:!1,loomPacks:!1}),[u,d]=(0,Ce.useState)({isOpen:!1,packName:null,item:null,itemName:null}),[m,p]=(0,Ce.useState)({isOpen:!1,packName:null,item:null,itemName:null}),g=(0,Ce.useCallback)(e=>{c(n=>Fd(Fd({},n),{},{[e]:!n[e]}))},[]),h=(0,Ce.useSyncExternalStore)(Hd.subscribe,Gd,Gd),v=(0,Ce.useSyncExternalStore)(Hd.subscribe,Kd,Kd),f=(0,Ce.useSyncExternalStore)(Hd.subscribe,Qd,Qd),b=(0,Ce.useSyncExternalStore)(Hd.subscribe,Xd,Xd),x=v&&f.length>0,y=(0,Ce.useCallback)(e=>{t.setChimeraMode(e),qe()},[t]),k=(0,Ce.useCallback)(e=>{t.setCouncilMode(e),qe()},[t]),w=(0,Ce.useCallback)(()=>{t.clearSelections(),qe(),"undefined"!=typeof toastr&&toastr.info("All Lumia selections cleared")},[t]),j=(0,Ce.useCallback)(e=>{confirm('Are you sure you want to delete "'.concat(e,'"?'))&&(t.removePack(e),qe(),"undefined"!=typeof toastr&&toastr.success('Pack "'.concat(e,'" deleted')))},[t]),C=(0,Ce.useCallback)((e,n,t)=>{d({isOpen:!0,packName:e,item:n,itemName:t})},[]),S=(0,Ce.useCallback)(()=>{const{packName:e,item:n,itemName:r}=u;if(!e||!n)return;const i=o.findIndex(n=>(n.name||n.packName)===e);if(-1===i)return console.error("[SettingsPanel] Pack not found:",e),void d({isOpen:!1,packName:null,item:null,itemName:null});const a=o[i],s=n.loomName||n.itemName||n.name;if(a.loomItems&&Array.isArray(a.loomItems)){const n=a.loomItems.filter(e=>(e.loomName||e.itemName||e.name)!==s);t.updatePackLoomItems(e,n)}if(a.loomStyles&&Array.isArray(a.loomStyles)){const n=a.loomStyles.filter(e=>(e.loomName||e.itemName||e.name)!==s);n.length!==a.loomStyles.length&&t.updatePackField(e,"loomStyles",n)}if(a.loomUtils&&Array.isArray(a.loomUtils)){const n=a.loomUtils.filter(e=>(e.loomName||e.itemName||e.name)!==s);n.length!==a.loomUtils.length&&t.updatePackField(e,"loomUtils",n)}if(a.loomRetrofits&&Array.isArray(a.loomRetrofits)){const n=a.loomRetrofits.filter(e=>(e.loomName||e.itemName||e.name)!==s);n.length!==a.loomRetrofits.length&&t.updatePackField(e,"loomRetrofits",n)}if(a.items&&Array.isArray(a.items)){const n=a.items.filter(e=>!e.loomCategory&&!e.category||(e.loomName||e.itemName||e.name)!==s);n.length!==a.items.length&&t.updatePackField(e,"items",n)}qe(),"undefined"!=typeof toastr&&toastr.success('Deleted "'.concat(r,'"')),d({isOpen:!1,packName:null,item:null,itemName:null})},[u,o,t]),N=(0,Ce.useCallback)(()=>{d({isOpen:!1,packName:null,item:null,itemName:null})},[]),E=(0,Ce.useCallback)((e,n,t)=>{p({isOpen:!0,packName:e,item:n,itemName:t})},[]),P=(0,Ce.useCallback)(()=>{const{packName:e,item:n,itemName:r}=m;if(!e||!n)return;const i=o.findIndex(n=>(n.name||n.packName)===e);if(-1===i)return console.error("[SettingsPanel] Pack not found:",e),void p({isOpen:!1,packName:null,item:null,itemName:null});const a=o[i],s=n.lumiaName||n.lumiaDefName;if(a.lumiaItems&&Array.isArray(a.lumiaItems)){const n=a.lumiaItems.filter(e=>(e.lumiaName||e.lumiaDefName)!==s);t.updatePackField(e,"lumiaItems",n)}if(a.items&&Array.isArray(a.items)){const n=a.items.filter(e=>!e.lumiaDefName&&!e.lumiaName||(e.lumiaName||e.lumiaDefName)!==s);n.length!==a.items.length&&t.updatePackField(e,"items",n)}qe(),"undefined"!=typeof toastr&&toastr.success('Deleted "'.concat(r,'"')),p({isOpen:!1,packName:null,item:null,itemName:null})},[m,o,t]),D=(0,Ce.useCallback)(()=>{p({isOpen:!1,packName:null,item:null,itemName:null})},[]),M=(0,Ce.useCallback)(e=>{s(n=>n===e?null:e)},[]),O=o.length,T=(0,Ce.useMemo)(()=>o.reduce((e,n)=>{var t,r,i;const o=(null===(t=n.lumiaItems)||void 0===t?void 0:t.length)||0,a=(null===(r=n.loomItems)||void 0===r?void 0:r.length)||0,s=(null===(i=n.items)||void 0===i?void 0:i.length)||0;return e+(o+a>0?o+a:s)},0),[o]),A=(0,Ce.useMemo)(()=>r.filter(e=>{var n,t,r,i,o;return(null===(n=e.loomItems)||void 0===n?void 0:n.length)>0||((null===(t=e.loomStyles)||void 0===t?void 0:t.length)>0||((null===(r=e.loomUtils)||void 0===r?void 0:r.length)>0||((null===(i=e.loomRetrofits)||void 0===i?void 0:i.length)>0||!(null===(o=e.items)||void 0===o||!o.some(e=>e.loomCategory)))))}),[r]),L=(0,Ce.useCallback)(function(e){if("undefined"!=typeof LumiverseBridge){const i=LumiverseBridge.getCallbacks();if(i&&i[e]){for(var n=arguments.length,t=new Array(n>1?n-1:0),r=1;r<n;r++)t[r-1]=arguments[r];i[e](...t)}}},[]),z=(0,Ce.useCallback)(e=>{var n;const t=null===(n=e.target.files)||void 0===n?void 0:n[0];if(!t)return;console.log("[SettingsPanel] File selected for upload:",t.name);const r=new FileReader;r.onload=async e=>{try{const n=JSON.parse(e.target.result);if(console.log("[SettingsPanel] JSON parsed successfully, entries:",n.entries?Object.keys(n.entries).length:"no entries field"),"undefined"!=typeof LumiverseBridge){const e=LumiverseBridge.getCallbacks();console.log("[SettingsPanel] Available callbacks:",e?Object.keys(e).filter(n=>e[n]):"none"),e&&e.handleNewBook?(console.log("[SettingsPanel] Calling handleNewBook..."),await e.handleNewBook(n,t.name,!1),e.refreshUIDisplay&&e.refreshUIDisplay(),console.log("[SettingsPanel] Import complete")):(console.error("[SettingsPanel] handleNewBook callback not registered"),"undefined"!=typeof toastr&&toastr.error("Import function not available. Please reload the page."))}else console.error("[SettingsPanel] LumiverseBridge not available"),"undefined"!=typeof toastr&&toastr.error("Bridge not available. Please reload the page.")}catch(e){console.error("[SettingsPanel] Failed to parse JSON:",e),"undefined"!=typeof toastr&&toastr.error("Failed to parse JSON: "+e.message)}},r.onerror=()=>{console.error("[SettingsPanel] Failed to read file"),"undefined"!=typeof toastr&&toastr.error("Failed to read file")},r.readAsText(t),e.target.value=""},[]),I=(0,Ce.useSyncExternalStore)(Hd.subscribe,Zd,Zd),R=(0,Ce.useSyncExternalStore)(Hd.subscribe,Jd,Jd),B=(0,Ce.useSyncExternalStore)(Hd.subscribe,em,em),_=(0,Ce.useSyncExternalStore)(Hd.subscribe,nm,nm),F=(0,Ce.useCallback)(e=>{Hd.setState({showLumiverseDrawer:e}),qe()},[]),U=(0,Ce.useCallback)(e=>{Hd.setState({enableLandingPage:e}),qe()},[]),H=(0,Ce.useCallback)(e=>{Hd.setState({landingPageChatsDisplayed:parseInt(e,10)||12}),qe()},[]),W=(0,Ce.useCallback)(()=>{window.confirm("WARNING: This will completely reset ALL Lumiverse Helper settings to defaults.\n\nThis includes:\n- All downloaded packs\n- All custom packs\n- All Lumia and Loom selections\n- All presets\n- All advanced settings\n\nThe page will reload after reset.\n\nAre you sure you want to continue?")&&("undefined"!=typeof LumiverseBridge&&LumiverseBridge.resetAllSettings?("undefined"!=typeof toastr&&toastr.warning("Resetting all settings..."),LumiverseBridge.resetAllSettings()):(console.error("[SettingsPanel] resetAllSettings not available on bridge"),"undefined"!=typeof toastr&&toastr.error("Reset function not available. Please reload the page.")))},[]),V=(0,Ce.useCallback)(e=>{Hd.setState({drawerSettings:Fd(Fd({},Hd.getState().drawerSettings),{},{side:e})}),qe()},[]),q=(0,Ce.useCallback)(e=>{const n=Math.max(0,Math.min(100,parseInt(e,10)||0));Hd.setState({drawerSettings:Fd(Fd({},Hd.getState().drawerSettings),{},{verticalPosition:n})}),qe()},[]),$=(0,Ce.useCallback)(e=>{Hd.setState({drawerSettings:Fd(Fd({},Hd.getState().drawerSettings),{},{tabSize:e})}),qe()},[]);return(0,Ee.jsxs)("div",{className:"lumia-injector-settings",children:[(0,Ee.jsx)("div",{className:"lumia-drawer-toggle-container",children:(0,Ee.jsxs)("label",{className:"lumiverse-toggle-wrapper",children:[(0,Ee.jsxs)("div",{className:"lumiverse-toggle-text",children:[(0,Ee.jsx)("span",{className:"lumiverse-toggle-label",children:"Show Lumiverse Drawer"}),(0,Ee.jsx)("span",{className:"lumiverse-toggle-description",children:"Access quick settings from a slide-out panel"})]}),(0,Ee.jsxs)("div",{className:On("lumiverse-toggle",I&&"lumiverse-toggle--on"),children:[(0,Ee.jsx)("input",{type:"checkbox",className:"lumiverse-toggle-input",checked:I,onChange:e=>F(e.target.checked)}),(0,Ee.jsx)("span",{className:"lumiverse-toggle-slider"})]})]})}),I&&(0,Ee.jsxs)("div",{className:"lumia-drawer-settings-container",children:[(0,Ee.jsxs)("div",{className:"lumia-drawer-settings-row",children:[(0,Ee.jsxs)("div",{className:"lumia-drawer-setting",children:[(0,Ee.jsx)("label",{className:"lumia-drawer-setting-label",children:"Drawer Side"}),(0,Ee.jsxs)("div",{className:"lumia-drawer-side-toggle",children:[(0,Ee.jsx)("button",{type:"button",className:On("lumia-side-btn","left"===R.side&&"lumia-side-btn--active"),onClick:()=>V("left"),children:"Left"}),(0,Ee.jsx)("button",{type:"button",className:On("lumia-side-btn","right"===R.side&&"lumia-side-btn--active"),onClick:()=>V("right"),children:"Right"})]})]}),(0,Ee.jsxs)("div",{className:"lumia-drawer-setting",children:[(0,Ee.jsx)("label",{htmlFor:"lumia-drawer-vpos",className:"lumia-drawer-setting-label",children:"Tab Position"}),(0,Ee.jsxs)("div",{className:"lumia-drawer-vpos-input",children:[(0,Ee.jsx)("input",{type:"range",id:"lumia-drawer-vpos",className:"lumia-slider",value:R.verticalPosition,onChange:e=>q(e.target.value),min:"8",max:"85"}),(0,Ee.jsxs)("span",{className:"lumia-drawer-vpos-value",children:[R.verticalPosition,"%"]})]})]})]}),(0,Ee.jsx)("div",{className:"lumia-drawer-settings-row",children:(0,Ee.jsxs)("div",{className:"lumia-drawer-setting",children:[(0,Ee.jsx)("label",{className:"lumia-drawer-setting-label",children:"Tab Size"}),(0,Ee.jsxs)("div",{className:"lumia-drawer-side-toggle",children:[(0,Ee.jsx)("button",{type:"button",className:On("lumia-side-btn","large"===R.tabSize&&"lumia-side-btn--active"),onClick:()=>$("large"),children:"Large"}),(0,Ee.jsx)("button",{type:"button",className:On("lumia-side-btn","compact"===R.tabSize&&"lumia-side-btn--active"),onClick:()=>$("compact"),children:"Compact"})]})]})})]}),(0,Ee.jsxs)("div",{className:"lumia-drawer-toggle-container",children:[(0,Ee.jsxs)("label",{className:"lumiverse-toggle-wrapper",children:[(0,Ee.jsxs)("div",{className:"lumiverse-toggle-text",children:[(0,Ee.jsx)("span",{className:"lumiverse-toggle-label",children:"Custom Landing Page"}),(0,Ee.jsx)("span",{className:"lumiverse-toggle-description",children:"Show Lumiverse recent chats on the home screen"})]}),(0,Ee.jsxs)("div",{className:On("lumiverse-toggle",B&&"lumiverse-toggle--on"),children:[(0,Ee.jsx)("input",{type:"checkbox",className:"lumiverse-toggle-input",checked:B,onChange:e=>U(e.target.checked)}),(0,Ee.jsx)("span",{className:"lumiverse-toggle-slider"})]})]}),B&&(0,Ee.jsxs)("div",{style:{marginTop:"10px",display:"flex",alignItems:"center",gap:"10px",paddingLeft:"4px"},children:[(0,Ee.jsx)("span",{style:{fontSize:"0.9em",opacity:.8},children:"Chats Displayed:"}),(0,Ee.jsx)("input",{type:"number",className:"lumia-input lumia-input-sm",style:{width:"60px"},value:_,onChange:e=>H(e.target.value),min:"1",max:"50"})]})]}),(0,Ee.jsxs)(am,{title:"Lumia DLC Packs",icon:rm.book,children:[(0,Ee.jsx)("div",{className:"lumia-status-badge",children:O>0?"".concat(O," pack").concat(1!==O?"s":""," loaded (").concat(T," items)"):"No packs loaded"}),(0,Ee.jsxs)("div",{className:"lumia-input-row",children:[(0,Ee.jsx)("input",{type:"text",className:"lumia-input",placeholder:"Enter Lumia DLC Pack URL (JSON)",id:"lumia-url-input-react"}),(0,Ee.jsx)("button",{className:"lumia-btn lumia-btn-primary",onClick:()=>L("fetchWorldBook"),type:"button",children:"Fetch"})]}),(0,Ee.jsxs)("div",{className:"lumia-source-actions",children:[(0,Ee.jsx)("div",{className:"lumia-divider-text",children:"or"}),(0,Ee.jsxs)("button",{className:"lumia-btn lumia-btn-secondary lumia-btn-full",onClick:()=>{var e;return null===(e=document.getElementById("lumia-file-input-react"))||void 0===e?void 0:e.click()},type:"button",children:[rm.upload,"Upload JSON File"]}),(0,Ee.jsx)("input",{type:"file",id:"lumia-file-input-react",accept:".json",style:{display:"none"},onChange:z}),(0,Ee.jsx)("div",{className:"lumia-divider-text",children:"or"}),(0,Ee.jsxs)("button",{className:"lumia-btn lumia-btn-primary lumia-btn-full",onClick:()=>t.openModal("lucidCards"),type:"button",children:[rm.box,"Browse Lucid Cards"]})]})]}),(0,Ee.jsx)(am,{title:"Chat Presets",icon:(0,Ee.jsx)(Dn,{size:16,strokeWidth:1.5}),children:(0,Ee.jsx)(ir,{})}),(0,Ee.jsx)(am,{title:"Preset Bindings",icon:rm.layers,children:(0,Ee.jsx)(wr,{})}),(0,Ee.jsxs)(am,{title:"Lumia Configuration",icon:rm.settings,action:(0,Ee.jsxs)("button",{className:"lumia-clear-all-btn",onClick:w,title:"Clear all Lumia selections",type:"button",children:[(0,Ee.jsx)(Pn,{size:14,strokeWidth:1.5}),"Clear All"]}),children:[(0,Ee.jsxs)("div",{className:"lumia-mode-toggles",children:[(0,Ee.jsx)(um,{icon:tm.chimera,label:"Chimera Mode",description:"Fuse multiple physical definitions",checked:h,onChange:y,disabled:v}),(0,Ee.jsx)(um,{icon:tm.council,label:"Council Mode",description:"Multiple independent Lumias",checked:v,onChange:k,disabled:h})]}),(0,Ee.jsx)(mm,{councilMode:v,councilMembers:f,onOpenCouncil:()=>t.openModal("councilSelect"),actions:t}),(0,Ee.jsxs)("div",{className:On("lumia-selector-group",x&&"lumia-selector-group--disabled"),children:[(0,Ee.jsx)(lm,{label:h?"Chimera Definitions":"Definition",hint:h?"Select Multiple":"Select One",selections:h?b:e.definition?[e.definition]:[],modalName:"definitions"}),(0,Ee.jsx)(lm,{label:"Behaviors",hint:"Select Multiple",selections:e.behaviors,dominant:e.dominantBehavior,modalName:"behaviors"}),(0,Ee.jsx)(lm,{label:"Personalities",hint:"Select Multiple",selections:e.personalities,dominant:e.dominantPersonality,modalName:"personalities"})]})]}),(0,Ee.jsx)(am,{title:"Loom Configuration",icon:rm.layers,children:(0,Ee.jsxs)("div",{className:"lumia-selector-group",children:[(0,Ee.jsx)(lm,{label:"Narrative Style",hint:"Select Multiple",selections:n.styles,modalName:"loomStyles"}),(0,Ee.jsx)(lm,{label:"Loom Utilities",hint:"Select Multiple",selections:n.utilities,modalName:"loomUtilities"}),(0,Ee.jsx)(lm,{label:"Retrofits",hint:"Select Multiple",selections:n.retrofits,modalName:"loomRetrofits"})]})}),(0,Ee.jsx)(am,{title:"Tools",icon:rm.tools,children:(0,Ee.jsxs)("div",{className:"lumia-tools-row",children:[(0,Ee.jsx)(cm,{icon:rm.plus,label:"Lumia Editor",onClick:()=>t.openModal("packSelector"),accent:!0}),(0,Ee.jsx)(cm,{icon:rm.dots,label:"OOC Settings",onClick:()=>t.openModal("oocSettings")}),(0,Ee.jsx)(cm,{icon:rm.lines,label:"Summarization",onClick:()=>t.openModal("summarization")}),(0,Ee.jsx)(cm,{icon:rm.edit,label:"Prompt Settings",onClick:()=>t.openModal("promptSettings")})]})}),(0,Ee.jsxs)(sm,{title:"Macro Reference",icon:rm.terminal,children:[(0,Ee.jsxs)("div",{className:"lumia-macro-group",children:[(0,Ee.jsx)("div",{className:"lumia-macro-group-title",children:"Lumia Content"}),(0,Ee.jsxs)("div",{className:"lumia-macro-list",children:[(0,Ee.jsx)(dm,{code:"{{lumiaDef}}",description:"Physical Definition"}),(0,Ee.jsx)(dm,{code:"{{lumiaBehavior}}",description:"Behavior(s)"}),(0,Ee.jsx)(dm,{code:"{{lumiaPersonality}}",description:"Personality(s)"}),(0,Ee.jsx)(dm,{code:"{{lumiaCouncilModeActive}}",description:"Yes/No status indicator, (conditional ready)"})]})]}),(0,Ee.jsxs)("div",{className:"lumia-macro-group",children:[(0,Ee.jsx)("div",{className:"lumia-macro-group-title",children:"Loom Content"}),(0,Ee.jsxs)("div",{className:"lumia-macro-list",children:[(0,Ee.jsx)(dm,{code:"{{loomStyle}}",description:"Narrative Style"}),(0,Ee.jsx)(dm,{code:"{{loomUtils}}",description:"Loom Utilities"}),(0,Ee.jsx)(dm,{code:"{{loomRetrofits}}",description:"Retrofits"})]})]}),(0,Ee.jsxs)("div",{className:"lumia-macro-group",children:[(0,Ee.jsx)("div",{className:"lumia-macro-group-title",children:"Random Lumia"}),(0,Ee.jsxs)("div",{className:"lumia-macro-list",children:[(0,Ee.jsx)(dm,{code:"{{randomLumia}}",description:"Random definition"}),(0,Ee.jsx)(dm,{code:"{{randomLumia.pers}}",description:"Random personality"}),(0,Ee.jsx)(dm,{code:"{{randomLumia.behav}}",description:"Random behavior"}),(0,Ee.jsx)(dm,{code:"{{randomLumia.name}}",description:"Random name"})]})]}),(0,Ee.jsxs)("div",{className:"lumia-macro-group",children:[(0,Ee.jsx)("div",{className:"lumia-macro-group-title",children:"Tracking & OOC"}),(0,Ee.jsxs)("div",{className:"lumia-macro-list",children:[(0,Ee.jsx)(dm,{code:"{{lumiaMessageCount}}",description:"Message count"}),(0,Ee.jsx)(dm,{code:"{{lumiaOOCTrigger}}",description:"OOC trigger/countdown"})]})]}),(0,Ee.jsxs)("div",{className:"lumia-macro-group",children:[(0,Ee.jsx)("div",{className:"lumia-macro-group-title",children:"Summarization"}),(0,Ee.jsxs)("div",{className:"lumia-macro-list",children:[(0,Ee.jsx)(dm,{code:"{{loomSummary}}",description:"Stored summary"}),(0,Ee.jsx)(dm,{code:"{{loomSummaryPrompt}}",description:"Summary directive"}),(0,Ee.jsx)(dm,{code:"/loom-summarize",description:"Manual trigger"})]})]}),(0,Ee.jsxs)("div",{className:"lumia-macro-group",children:[(0,Ee.jsx)("div",{className:"lumia-macro-group-title",children:"Message History"}),(0,Ee.jsxs)("div",{className:"lumia-macro-list",children:[(0,Ee.jsx)(dm,{code:"{{loomLastUserMessage}}",description:"Last user message content"}),(0,Ee.jsx)(dm,{code:"{{loomLastCharMessage}}",description:"Last character message content"}),(0,Ee.jsx)(dm,{code:"{{lastMessageName}}",description:"Name of whoever sent the last message"})]})]}),(0,Ee.jsxs)("div",{className:"lumia-macro-group",children:[(0,Ee.jsx)("div",{className:"lumia-macro-group-title",children:"Sovereign Hand"}),(0,Ee.jsxs)("div",{className:"lumia-macro-list",children:[(0,Ee.jsx)(dm,{code:"{{loomSovHand}}",description:"Full Sovereign Hand prompt (with user message)"}),(0,Ee.jsx)(dm,{code:"{{loomSovHandActive}}",description:"Yes/No status indicator (conditional ready)"}),(0,Ee.jsx)(dm,{code:"{{loomContinuePrompt}}",description:"Continue-scene prompt when character spoke last"})]})]})]}),i.length>0&&(0,Ee.jsx)(am,{title:"Custom Packs",icon:rm.package,collapsible:!0,collapsed:l.customPacks,onToggle:()=>g("customPacks"),children:(0,Ee.jsx)("div",{className:"lumia-custom-packs",children:i.map(e=>{var n,r;const i=e.id||e.name,o=a===i,s=(null===(n=e.lumiaItems)||void 0===n?void 0:n.length)>0?e.lumiaItems:(null===(r=e.items)||void 0===r?void 0:r.filter(e=>e.lumiaDefName))||[],l=function(e){const n=[];return e.loomItems&&Array.isArray(e.loomItems)&&n.push(...e.loomItems),e.loomStyles&&Array.isArray(e.loomStyles)&&e.loomStyles.forEach(e=>n.push(Fd(Fd({},e),{},{loomCategory:"Narrative Style"}))),e.loomUtils&&Array.isArray(e.loomUtils)&&e.loomUtils.forEach(e=>n.push(Fd(Fd({},e),{},{loomCategory:"Loom Utilities"}))),e.loomRetrofits&&Array.isArray(e.loomRetrofits)&&e.loomRetrofits.forEach(e=>n.push(Fd(Fd({},e),{},{loomCategory:"Retrofits"}))),e.items&&Array.isArray(e.items)&&e.items.forEach(e=>{(e.loomCategory||e.category)&&n.push(e)}),n}(e),c=s.length>0||l.length>0;return(0,Ee.jsxs)(Od.div,{className:On("lumia-pack-item-container",o&&"lumia-pack-item-container--expanded"),initial:{opacity:0,y:-10},animate:{opacity:1,y:0},children:[(0,Ee.jsxs)("div",{className:"lumia-pack-item",children:[(0,Ee.jsx)("button",{className:"lumia-pack-expand-btn",onClick:()=>M(i),type:"button",title:o?"Collapse":"Expand to see items",children:(0,Ee.jsx)("span",{className:On("lumia-pack-chevron",o&&"lumia-pack-chevron--expanded"),children:rm.chevronDown})}),(0,Ee.jsx)("span",{className:"lumia-pack-name",onClick:()=>M(i),style:{cursor:"pointer"},children:e.name}),(0,Ee.jsxs)("div",{className:"lumia-pack-counts",children:[(0,Ee.jsxs)("span",{className:"lumia-pack-count",children:[s.length," Lumia",1!==s.length?"s":""]}),l.length>0&&(0,Ee.jsxs)("span",{className:"lumia-pack-count lumia-pack-count-loom",children:[(0,Ee.jsx)(Jt,{size:12,strokeWidth:1.5}),l.length," Loom"]})]}),(0,Ee.jsx)("button",{className:"lumia-btn lumia-btn-icon",onClick:()=>Qn(e),title:"Export as Lumiverse Pack",type:"button",children:rm.download}),(0,Ee.jsx)("button",{className:"lumia-btn lumia-btn-icon",onClick:()=>t.openModal("packEditor",{packId:i}),title:"Edit pack",type:"button",children:rm.edit})]}),(0,Ee.jsxs)(it,{isOpen:o&&s.length>0,className:"lumia-pack-items-list",duration:200,children:[(0,Ee.jsx)("div",{className:"lumia-pack-section-header",children:"Lumia Characters"}),s.map((n,r)=>(0,Ee.jsx)(im,{item:n,packName:e.name,onEdit:(e,n)=>t.openModal("lumiaEditor",{packName:e,editingItem:n}),onDelete:E,editIcon:rm.edit},n.lumiaDefName||n.lumiaName||r))]}),(0,Ee.jsxs)(it,{isOpen:o&&l.length>0,className:"lumia-pack-items-list",duration:200,children:[(0,Ee.jsx)("div",{className:"lumia-pack-section-header",children:"Loom Items"}),l.map((n,r)=>(0,Ee.jsx)(om,{item:n,packName:e.name,onEdit:(e,n)=>t.openModal("loomEditor",{packName:e,editingItem:n}),onDelete:C,editIcon:rm.edit},n.loomName||n.itemName||n.name||r))]}),(0,Ee.jsx)(it,{isOpen:o&&!c,className:"lumia-pack-items-empty",duration:200,children:(0,Ee.jsx)("span",{children:"No items in this pack yet"})})]},i)})})}),r.length>0&&(0,Ee.jsx)(am,{title:"Downloaded Packs",icon:rm.box,collapsible:!0,collapsed:l.downloadedPacks,onToggle:()=>g("downloadedPacks"),children:(0,Ee.jsx)("div",{className:"lumia-downloaded-packs",children:r.map(e=>{var n,r;const i=e.name||e.packName||"Unknown Pack",o=(null===(n=e.lumiaItems)||void 0===n?void 0:n.length)>0?e.lumiaItems:(null===(r=e.items)||void 0===r?void 0:r.filter(e=>e.lumiaDefName&&e.lumiaDef))||[],a=e.coverUrl||e.packCover;return(0,Ee.jsxs)("div",{className:"lumia-downloaded-pack-item",children:[a?(0,Ee.jsx)("img",{src:a,alt:i,className:"lumia-downloaded-pack-cover"}):(0,Ee.jsx)("div",{className:"lumia-downloaded-pack-cover-placeholder",children:rm.package}),(0,Ee.jsxs)("div",{className:"lumia-downloaded-pack-info",children:[(0,Ee.jsx)("span",{className:"lumia-downloaded-pack-name",children:i}),(0,Ee.jsxs)("span",{className:"lumia-downloaded-pack-count",children:[o.length," Lumia",1!==o.length?"s":""]})]}),(0,Ee.jsxs)("div",{className:"lumia-downloaded-pack-actions",children:[(0,Ee.jsx)("button",{className:"lumia-btn lumia-btn-icon",onClick:()=>t.openPackDetail(i),title:"View pack contents",type:"button",children:(0,Ee.jsx)(Id,{size:16,strokeWidth:1.5})}),(0,Ee.jsx)("button",{className:"lumia-btn lumia-btn-icon lumia-btn-icon-danger",onClick:()=>j(i),title:"Delete pack",type:"button",children:(0,Ee.jsx)(Pn,{size:16,strokeWidth:1.5})})]})]},i)})})}),A.length>0&&(0,Ee.jsx)(am,{title:"Loom Packs",icon:rm.layers,collapsible:!0,collapsed:l.loomPacks,onToggle:()=>g("loomPacks"),children:(0,Ee.jsx)("div",{className:"lumia-loom-packs",children:A.map(e=>{var n,r,i;const o=e.name||e.packName||"Unknown Pack";let a=(null===(n=e.loomStyles)||void 0===n?void 0:n.length)||0,s=(null===(r=e.loomUtils)||void 0===r?void 0:r.length)||0,l=(null===(i=e.loomRetrofits)||void 0===i?void 0:i.length)||0;const c=e=>{const n=e.loomCategory||e.category;"Narrative Style"===n||"loomStyles"===n?a++:"Loom Utilities"===n||"loomUtils"===n?s++:"Retrofits"!==n&&"loomRetrofits"!==n||l++};return e.loomItems&&e.loomItems.forEach(c),e.items&&e.items.forEach(e=>{(e.loomCategory||e.category)&&c(e)}),(0,Ee.jsxs)("div",{className:"lumia-loom-pack-item",children:[e.packCover?(0,Ee.jsx)("img",{src:e.packCover,alt:o,className:"lumia-loom-pack-cover"}):(0,Ee.jsx)("div",{className:"lumia-loom-pack-cover-placeholder",children:rm.layers}),(0,Ee.jsxs)("div",{className:"lumia-loom-pack-info",children:[(0,Ee.jsx)("span",{className:"lumia-loom-pack-name",children:o}),(0,Ee.jsxs)("div",{className:"lumia-loom-pack-stats",children:[a>0&&(0,Ee.jsxs)("span",{children:[(0,Ee.jsx)(Qt,{size:10})," ",a]}),s>0&&(0,Ee.jsxs)("span",{children:[(0,Ee.jsx)(Td,{size:10})," ",s]}),l>0&&(0,Ee.jsxs)("span",{children:[(0,Ee.jsx)(Jt,{size:10})," ",l]})]})]}),(0,Ee.jsxs)("div",{className:"lumia-loom-pack-actions",children:[(0,Ee.jsx)("button",{className:"lumia-btn lumia-btn-icon",onClick:()=>t.openLoomPackDetail(o),title:"View loom contents",type:"button",children:(0,Ee.jsx)(Id,{size:16,strokeWidth:1.5})}),(0,Ee.jsx)("button",{className:"lumia-btn lumia-btn-icon lumia-btn-icon-danger",onClick:()=>j(o),title:"Delete pack",type:"button",children:(0,Ee.jsx)(Pn,{size:16,strokeWidth:1.5})})]})]},o)})})}),(0,Ee.jsx)(sm,{title:"Danger Zone",icon:(0,Ee.jsx)(mr,{size:16,strokeWidth:1.5}),children:(0,Ee.jsxs)("div",{className:"lumia-danger-zone",children:[(0,Ee.jsx)("p",{className:"lumia-danger-zone-description",children:"If you're experiencing issues with the extension, you can reset all settings to their defaults. This will remove all packs, selections, and configurations."}),(0,Ee.jsxs)("button",{className:"lumia-btn lumia-btn-danger lumia-btn-full",onClick:W,type:"button",children:[(0,Ee.jsx)(mr,{size:16,strokeWidth:1.5}),"Reset All Settings"]})]})}),(0,Ee.jsx)(Bd,{isOpen:u.isOpen,onConfirm:S,onCancel:N,title:"Delete Loom Item",message:'Are you sure you want to delete "'.concat(u.itemName,'"? This action cannot be undone.'),variant:"danger",confirmText:"Delete",cancelText:"Cancel"}),(0,Ee.jsx)(Bd,{isOpen:m.isOpen,onConfirm:P,onCancel:D,title:"Delete Lumia Character",message:'Are you sure you want to delete "'.concat(m.itemName,'"? This action cannot be undone.'),variant:"danger",confirmText:"Delete",cancelText:"Cancel"})]})},gm=Sn("pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),hm=Sn("star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]),vm=Sn("folder",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]),fm=Sn("chart-pie",[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]]),bm=Sn("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),xm=Sn("chevron-up",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),ym=Sn("arrow-down-a-z",[["path",{d:"m3 16 4 4 4-4",key:"1co6wj"}],["path",{d:"M7 20V4",key:"1yoxec"}],["path",{d:"M20 8h-5",key:"1vsyxs"}],["path",{d:"M15 10V6.5a2.5 2.5 0 0 1 5 0V10",key:"ag13bf"}],["path",{d:"M15 14h5l-5 6h5",key:"ur5jdg"}]]);function km(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function wm(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?km(Object(t),!0).forEach(function(n){jm(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):km(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function jm(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const Cm=Ye,Sm=[],Nm=()=>Cm.getState().chimeraMode||!1,Em=()=>Cm.getState().selectedDefinitions||Sm,Pm={layout:{display:"flex",flexDirection:"column",height:"100%",maxHeight:"100%",minHeight:0},header:{display:"flex",alignItems:"center",gap:"12px",padding:"16px 20px",borderBottom:"1px solid var(--lumiverse-border, rgba(255, 255, 255, 0.1))",flexShrink:0},headerIcon:{width:"40px",height:"40px",borderRadius:"10px",background:"linear-gradient(135deg, rgba(147, 112, 219, 0.2), rgba(147, 112, 219, 0.1))",display:"flex",alignItems:"center",justifyContent:"center",color:"var(--lumiverse-primary, #9370db)"},headerText:{flex:1},title:{margin:0,fontSize:"16px",fontWeight:600,color:"var(--lumiverse-text, #e0e0e0)"},subtitle:{margin:"4px 0 0",fontSize:"12px",color:"var(--lumiverse-text-muted, #999)"},clearBtn:{display:"flex",alignItems:"center",gap:"6px",padding:"8px 12px",fontSize:"12px",fontWeight:500,borderRadius:"6px",border:"1px solid rgba(239, 68, 68, 0.3)",background:"rgba(239, 68, 68, 0.1)",color:"#ef4444",cursor:"pointer",transition:"all 0.15s ease"},controls:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px 20px",background:"rgba(0, 0, 0, 0.15)",borderBottom:"1px solid var(--lumiverse-border, rgba(255, 255, 255, 0.1))",flexShrink:0},controlsGroup:{display:"flex",alignItems:"center",gap:"8px"},controlBtn:{display:"flex",alignItems:"center",gap:"4px",padding:"6px 10px",fontSize:"11px",fontWeight:500,borderRadius:"6px",border:"none",background:"rgba(0, 0, 0, 0.2)",color:"var(--lumiverse-text-muted, #999)",cursor:"pointer",transition:"all 0.15s ease"},sortContainer:{display:"flex",alignItems:"center",gap:"6px",fontSize:"11px",color:"var(--lumiverse-text-muted, #999)"},select:{padding:"5px 24px 5px 8px",fontSize:"11px",borderRadius:"6px",border:"1px solid var(--lumiverse-border, rgba(255, 255, 255, 0.1))",background:"rgba(0, 0, 0, 0.3)",color:"var(--lumiverse-text, #e0e0e0)",cursor:"pointer",appearance:"none",backgroundImage:"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%23999' stroke-width='2'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E\")",backgroundRepeat:"no-repeat",backgroundPosition:"right 6px center"},scrollArea:{flex:"1 1 auto",minHeight:0,overflowY:"auto",padding:"12px 20px"},empty:{textAlign:"center",padding:"40px 20px",color:"var(--lumiverse-text-muted, #999)",fontSize:"14px"},packSection:{marginBottom:"16px",border:"1px solid var(--lumiverse-border, rgba(255, 255, 255, 0.1))",borderRadius:"10px",overflow:"hidden"},packHeader:{display:"flex",alignItems:"center",gap:"8px",padding:"10px 12px",background:"rgba(0, 0, 0, 0.2)",cursor:"pointer",transition:"background 0.15s ease",width:"100%",border:"none",color:"inherit",textAlign:"left",fontFamily:"inherit"},packCollapseIcon:{color:"var(--lumiverse-text-muted, #999)",transition:"transform 0.2s ease"},packFolderIcon:{color:"var(--lumiverse-primary, #9370db)"},packTitle:{flex:1,fontSize:"13px",fontWeight:500,color:"var(--lumiverse-text, #e0e0e0)"},packBadge:{fontSize:"10px",padding:"2px 6px",borderRadius:"4px",background:"rgba(147, 112, 219, 0.2)",color:"var(--lumiverse-primary, #9370db)"},packCount:{fontSize:"11px",color:"var(--lumiverse-text-muted, #999)"},packRemoveBtn:{width:"24px",height:"24px",borderRadius:"6px",border:"none",background:"transparent",color:"var(--lumiverse-text-muted, #999)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.15s ease"},cardGrid:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(100px, 1fr))",gap:"10px",padding:"12px"},card:{position:"relative",borderRadius:"10px",overflow:"hidden",cursor:"pointer",transition:"all 0.2s ease",border:"2px solid transparent",background:"rgba(0, 0, 0, 0.2)"},cardSelected:{borderColor:"var(--lumiverse-primary, #9370db)",boxShadow:"0 0 0 1px var(--lumiverse-primary, #9370db)"},cardImage:{position:"relative",aspectRatio:"1",background:"rgba(0, 0, 0, 0.3)"},cardImg:{width:"100%",height:"100%",objectFit:"cover",transition:"opacity 0.2s ease"},cardPlaceholder:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"24px",color:"var(--lumiverse-text-muted, #999)",background:"linear-gradient(135deg, rgba(147, 112, 219, 0.1), rgba(147, 112, 219, 0.05))"},cardCheck:{position:"absolute",top:"6px",right:"6px",width:"22px",height:"22px",borderRadius:"50%",background:"var(--lumiverse-primary, #9370db)",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",opacity:0,transform:"scale(0.8)",transition:"all 0.15s ease"},cardCheckVisible:{opacity:1,transform:"scale(1)"},cardIconOverlay:{position:"absolute",width:"26px",height:"26px",borderRadius:"6px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",transition:"all 0.15s ease"},cardDominant:{top:"6px",left:"6px",background:"rgba(0, 0, 0, 0.6)",color:"var(--lumiverse-text-muted, #999)"},cardDominantActive:{background:"rgba(255, 193, 7, 0.9)",color:"#fff"},cardEnableAll:{bottom:"6px",left:"6px",background:"rgba(0, 0, 0, 0.6)",color:"var(--lumiverse-text-muted, #999)"},cardEnableAllActive:{background:"rgba(147, 112, 219, 0.9)",color:"#fff"},cardEdit:{bottom:"6px",right:"6px",background:"rgba(0, 0, 0, 0.6)",color:"var(--lumiverse-text-muted, #999)"},cardInfo:{padding:"8px 10px"},cardName:{fontSize:"11px",fontWeight:500,color:"var(--lumiverse-text, #e0e0e0)",textAlign:"center",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},footer:{display:"flex",justifyContent:"flex-end",gap:"8px",padding:"12px 20px",borderTop:"1px solid var(--lumiverse-border, rgba(255, 255, 255, 0.1))",flexShrink:0},btn:{padding:"10px 16px",fontSize:"13px",fontWeight:500,borderRadius:"8px",border:"none",cursor:"pointer",transition:"all 0.15s ease"},btnSecondary:{background:"rgba(0, 0, 0, 0.3)",color:"var(--lumiverse-text, #e0e0e0)",border:"1px solid var(--lumiverse-border, rgba(255, 255, 255, 0.1))"},btnPrimary:{background:"var(--lumiverse-primary, #9370db)",color:"#fff"},headerCloseBtn:{display:"flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",borderRadius:"8px",border:"none",background:"transparent",color:"var(--lumiverse-text-muted, #999)",cursor:"pointer",marginLeft:"4px",transition:"all 0.15s ease"}};function Dm(e,n){if(!e)return null;const t={name:["lumiaName","lumiaDefName"],def:["lumiaDefinition","lumiaDef"],personality:["lumiaPersonality","lumia_personality"],behavior:["lumiaBehavior","lumia_behavior"],img:["avatarUrl","lumia_img"]}[n];if(!t)return null;for(const n of t)if(void 0!==e[n]&&null!==e[n])return e[n];return null}function Mm(e){let{item:n,packName:t,isSelected:r,isDominant:i,onSelect:o,onSetDominant:a,showDominant:s,isDefinition:l,animationIndex:c,isEditable:u,onEdit:d}=e;const[m,p]=(0,Ce.useState)(!1),[g,h]=(0,Ce.useState)(!1),v=Xe(),f=Dm(n,"name")||"Unknown",b=Dm(n,"img"),x=function(e){return[!!Dm(e,"def"),!!Dm(e,"behavior"),!!Dm(e,"personality")].filter(Boolean).length>1}(n),y=x&&v.areAllTraitsEnabledForLumia(t,f),{objectPosition:k}=xn(b);return(0,Ee.jsxs)("div",{style:wm(wm({},Pm.card),r?Pm.cardSelected:{}),onClick:e=>{e.target.closest("[data-action]")||o(n)},"data-pack":t,"data-item":f,children:[(0,Ee.jsxs)("div",{style:Pm.cardImage,children:[b&&!g?(0,Ee.jsx)("img",{src:b,alt:f,loading:"lazy",style:wm(wm({},Pm.cardImg),{},{objectPosition:k,opacity:m?1:0}),onLoad:()=>p(!0),onError:()=>h(!0)}):(0,Ee.jsx)("div",{style:Pm.cardPlaceholder,children:"?"}),x&&(0,Ee.jsx)("div",{"data-action":"enable-all",style:wm(wm(wm({},Pm.cardIconOverlay),Pm.cardEnableAll),y?Pm.cardEnableAllActive:{}),onClick:e=>{e.stopPropagation(),v.toggleAllTraitsForLumia(t,f),qe()},title:y?"Disable all traits":"Enable all traits",children:(0,Ee.jsx)(Qt,{size:12})}),u&&d&&(0,Ee.jsx)("div",{"data-action":"edit",style:wm(wm({},Pm.cardIconOverlay),Pm.cardEdit),onClick:e=>{e.stopPropagation(),d&&d(n)},title:"Edit this Lumia",children:(0,Ee.jsx)(gm,{size:12})}),s&&(0,Ee.jsx)("div",{"data-action":"dominant",style:wm(wm(wm({},Pm.cardIconOverlay),Pm.cardDominant),i?Pm.cardDominantActive:{}),onClick:e=>{e.stopPropagation(),a(n)},title:i?"Remove as dominant":"Set as dominant trait",children:(0,Ee.jsx)(hm,{size:12,fill:i?"currentColor":"none"})}),(0,Ee.jsx)("div",{style:wm(wm({},Pm.cardCheck),r?Pm.cardCheckVisible:{}),children:(0,Ee.jsx)(zd,{size:12,strokeWidth:3})})]}),(0,Ee.jsx)("div",{style:Pm.cardInfo,children:(0,Ee.jsx)("div",{style:Pm.cardName,children:f})})]})}function Om(e){let{pack:n,items:t,isEditable:r,type:i,isSelected:o,isDominant:a,onSelect:s,onSetDominant:l,showDominant:c,onRemovePack:u,onEditItem:d,isCollapsed:m,onToggleCollapse:p}=e;const[g,h]=(0,Ce.useState)(!1),v=void 0!==m,f=v?m:g,b=n.name||n.packName||"Unknown Pack";return(0,Ee.jsxs)("div",{style:Pm.packSection,children:[(0,Ee.jsxs)("div",{style:Pm.packHeader,onClick:e=>{e.target.closest("[data-action]")||(v&&p?p(b):h(!g))},children:[(0,Ee.jsx)("span",{style:wm(wm({},Pm.packCollapseIcon),{},{transform:f?"rotate(-90deg)":"rotate(0deg)"}),children:(0,Ee.jsx)(Tn,{size:14})}),(0,Ee.jsx)(vm,{size:14,style:Pm.packFolderIcon}),(0,Ee.jsx)("span",{style:Pm.packTitle,children:b}),r&&(0,Ee.jsx)("span",{style:Pm.packBadge,children:"Custom"}),(0,Ee.jsxs)("span",{style:Pm.packCount,children:[t.length," items"]}),(0,Ee.jsx)("button",{"data-action":"remove",style:Pm.packRemoveBtn,onClick:e=>{e.stopPropagation(),u(b)},title:"Remove Pack",children:(0,Ee.jsx)(Pn,{size:14})})]}),!f&&(0,Ee.jsx)("div",{className:"lumiverse-responsive-small-grid",children:t.map((e,n)=>(0,Ee.jsx)(Mm,{item:e,packName:b,isSelected:o(e,b),isDominant:a(e,b),onSelect:e=>s(e,b),onSetDominant:e=>l(e,b),showDominant:c,isDefinition:"definitions"===i,animationIndex:n,isEditable:r,onEdit:r?e=>d(e,b):void 0},Dm(e,"name")||e.id||n))})]})}const Tm=function(e){let{type:n,multiSelect:t=!0,allowDominant:r=!1,onClose:i}=e;const{allPacks:o}=vn(),a=gn(),s=Xe(),l=(0,Ce.useSyncExternalStore)(Cm.subscribe,Nm,Nm),c=(0,Ce.useSyncExternalStore)(Cm.subscribe,Em,Em),u=function(e){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];switch(e){case"definitions":return n?{title:"Select Chimera Forms",subtitle:"Choose multiple physical forms to fuse into a Chimera",isMulti:!0,dominantKey:null}:{title:"Select Definition",subtitle:"Choose the physical form for your Lumia",isMulti:!1,dominantKey:null};case"behaviors":return{title:"Select Behaviors",subtitle:"Choose behavioral traits (tap star for dominant)",isMulti:!0,dominantKey:"dominantBehavior"};case"personalities":return{title:"Select Personalities",subtitle:"Choose personality traits (tap star for dominant)",isMulti:!0,dominantKey:"dominantPersonality"};default:return{title:"Select Items",subtitle:"",isMulti:!0,dominantKey:null}}}(n,l),d=function(e){switch(e){case"definitions":default:return lr;case"behaviors":return Td;case"personalities":return fm}}(n),m=(0,Ce.useMemo)(()=>{switch(n){case"behaviors":return{selectedItems:a.behaviors||[],dominantItem:a.dominantBehavior,toggleAction:s.toggleBehavior,setDominantAction:s.setDominantBehavior,clearAction:()=>{s.setSelectedBehaviors([]),s.setDominantBehavior(null)}};case"personalities":return{selectedItems:a.personalities||[],dominantItem:a.dominantPersonality,toggleAction:s.togglePersonality,setDominantAction:s.setDominantPersonality,clearAction:()=>{s.setSelectedPersonalities([]),s.setDominantPersonality(null)}};case"definitions":return l?{selectedItems:c,dominantItem:null,toggleAction:s.toggleChimeraDefinition,setDominantAction:null,clearAction:s.clearChimeraDefinitions}:{selectedItems:a.definition?[a.definition]:[],dominantItem:null,toggleAction:e=>{const n=a.definition;n&&n.packName===e.packName&&n.itemName===e.itemName?s.setSelectedDefinition(null):s.setSelectedDefinition(e)},setDominantAction:null,clearAction:()=>s.setSelectedDefinition(null)};default:return{selectedItems:[],dominantItem:null,toggleAction:()=>{},setDominantAction:null,clearAction:()=>{}}}},[n,a,s,l,c]),{selectedItems:p,dominantItem:g,toggleAction:h,setDominantAction:v,clearAction:f}=m;(0,Ce.useEffect)(()=>{const e=setTimeout(()=>{qe()},100);return()=>clearTimeout(e)},[p,g]);const[b,x]=(0,Ce.useState)(new Set),[y,k]=(0,Ce.useState)("default"),w=(0,Ce.useMemo)(()=>o.map(e=>{const n=function(e){return e.lumiaItems&&Array.isArray(e.lumiaItems)?e.lumiaItems:(e.items||[]).filter(e=>!e.loomCategory&&!!e.lumiaDefName)}(e);return wm(wm({},e),{},{lumiaItems:n,isEditable:e.isCustom||e.isEditable||!1})}).filter(e=>e.lumiaItems.length>0),[o,n]),j=(0,Ce.useMemo)(()=>"default"===y?w:[...w].sort((e,n)=>{if("name"===y){const t=(e.name||e.packName||"").toLowerCase(),r=(n.name||n.packName||"").toLowerCase();return t.localeCompare(r)}if("author"===y){const t=(e.author||"").toLowerCase(),r=(n.author||"").toLowerCase();return t.localeCompare(r)}return 0}),[w,y]),C=(0,Ce.useCallback)(e=>{x(n=>{const t=new Set(n);return t.has(e)?t.delete(e):t.add(e),t})},[]),S=(0,Ce.useCallback)(e=>b.has(e),[b]),N=(0,Ce.useCallback)((e,n)=>{const t=Dm(e,"name");return p.some(e=>e.packName===n&&e.itemName===t)},[p]),E=(0,Ce.useCallback)((e,n)=>{if(!g)return!1;const t=Dm(e,"name");return g.packName===n&&g.itemName===t},[g]),P=(0,Ce.useCallback)((e,n)=>{const t={packName:n,itemName:Dm(e,"name")};h(t)},[h]),D=(0,Ce.useCallback)((e,n)=>{if(!v)return;const t={packName:n,itemName:Dm(e,"name")};N(e,n)||h(t),E(e,n)?v(null):v(t)},[v,h,N,E]),M=(0,Ce.useCallback)(()=>{f()},[f]),O=(0,Ce.useCallback)(e=>{window.confirm('Delete pack "'.concat(e,'"? This action cannot be undone.'))&&(s.removeCustomPack(e),qe())},[s]),T=(0,Ce.useCallback)((e,n)=>{s.openModal("lumiaEditor",{packName:n,editingItem:e})},[s]);return(0,Ee.jsxs)("div",{style:Pm.layout,children:[(0,Ee.jsxs)("div",{style:Pm.header,children:[(0,Ee.jsx)("div",{style:Pm.headerIcon,children:(0,Ee.jsx)(d,{size:20})}),(0,Ee.jsxs)("div",{style:Pm.headerText,children:[(0,Ee.jsx)("h3",{style:Pm.title,children:u.title}),(0,Ee.jsx)("p",{style:Pm.subtitle,children:u.subtitle})]}),(0,Ee.jsxs)("button",{style:Pm.clearBtn,onClick:M,title:"Clear all selections",children:[(0,Ee.jsx)(bm,{size:14}),(0,Ee.jsx)("span",{children:"Clear"})]}),(0,Ee.jsx)("button",{style:Pm.headerCloseBtn,onClick:i,title:"Close modal",children:(0,Ee.jsx)(mt,{size:20})})]}),j.length>0&&(0,Ee.jsxs)("div",{style:Pm.controls,children:[(0,Ee.jsxs)("div",{style:Pm.controlsGroup,children:[(0,Ee.jsxs)("button",{style:Pm.controlBtn,onClick:()=>{x(new Set)},title:"Expand all packs",type:"button",children:[(0,Ee.jsx)(Tn,{size:12}),(0,Ee.jsx)("span",{children:"Expand All"})]}),(0,Ee.jsxs)("button",{style:Pm.controlBtn,onClick:()=>{const e=w.map(e=>e.name||e.packName);x(new Set(e))},title:"Collapse all packs",type:"button",children:[(0,Ee.jsx)(xm,{size:12}),(0,Ee.jsx)("span",{children:"Collapse All"})]})]}),(0,Ee.jsxs)("div",{style:Pm.sortContainer,children:[(0,Ee.jsx)(ym,{size:12}),(0,Ee.jsx)("span",{children:"Sort:"}),(0,Ee.jsxs)("select",{style:Pm.select,value:y,onChange:e=>k(e.target.value),children:[(0,Ee.jsx)("option",{value:"default",children:"Default"}),(0,Ee.jsx)("option",{value:"name",children:"Pack Name"}),(0,Ee.jsx)("option",{value:"author",children:"Author"})]})]})]}),(0,Ee.jsx)("div",{style:Pm.scrollArea,children:0===j.length?(0,Ee.jsx)("div",{style:Pm.empty,children:"No Lumia Packs loaded. Add one in settings!"}):j.map(e=>{const t=e.name||e.packName;return(0,Ee.jsx)(Om,{pack:e,items:e.lumiaItems,isEditable:e.isEditable,type:n,isSelected:N,isDominant:E,onSelect:P,onSetDominant:D,showDominant:r&&u.isMulti,onRemovePack:O,onEditItem:T,isCollapsed:S(t),onToggleCollapse:C},e.id||t)})}),(0,Ee.jsxs)("div",{style:Pm.footer,children:[(0,Ee.jsx)("button",{style:wm(wm({},Pm.btn),Pm.btnSecondary),onClick:i,children:"Close"}),u.isMulti&&(0,Ee.jsx)("button",{style:wm(wm({},Pm.btn),Pm.btnPrimary),onClick:i,children:"Done"})]})]})},Am=Sn("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);function Lm(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function zm(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Lm(Object(t),!0).forEach(function(n){Im(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Lm(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Im(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const Rm={layout:{display:"flex",flexDirection:"column",height:"100%",maxHeight:"100%",minHeight:0},header:{display:"flex",alignItems:"center",gap:"12px",padding:"16px 20px",borderBottom:"1px solid var(--lumiverse-border, rgba(255, 255, 255, 0.1))",flexShrink:0},searchBox:{flex:1,display:"flex",alignItems:"center",gap:"10px",padding:"8px 12px",background:"rgba(0, 0, 0, 0.25)",border:"1px solid var(--lumiverse-border, rgba(255, 255, 255, 0.1))",borderRadius:"8px"},searchIcon:{color:"var(--lumiverse-text-muted, #999)",flexShrink:0},searchInput:{flex:1,background:"transparent",border:"none",outline:"none",color:"var(--lumiverse-text, #e0e0e0)",fontSize:"13px"},searchClear:{width:"20px",height:"20px",display:"flex",alignItems:"center",justifyContent:"center",background:"transparent",border:"none",color:"var(--lumiverse-text-muted, #999)",cursor:"pointer",borderRadius:"4px",transition:"background 0.15s ease"},selectionInfo:{display:"flex",alignItems:"center",gap:"10px",flexShrink:0},selectionCount:{fontSize:"12px",color:"var(--lumiverse-text-muted, #999)",whiteSpace:"nowrap"},clearBtn:{display:"flex",alignItems:"center",gap:"6px",padding:"8px 12px",fontSize:"12px",fontWeight:500,borderRadius:"6px",border:"1px solid rgba(239, 68, 68, 0.3)",background:"rgba(239, 68, 68, 0.1)",color:"#ef4444",cursor:"pointer",transition:"all 0.15s ease"},controls:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px 20px",background:"rgba(0, 0, 0, 0.15)",borderBottom:"1px solid var(--lumiverse-border, rgba(255, 255, 255, 0.1))",flexShrink:0},controlsGroup:{display:"flex",alignItems:"center",gap:"8px"},controlBtn:{display:"flex",alignItems:"center",gap:"4px",padding:"6px 10px",fontSize:"11px",fontWeight:500,borderRadius:"6px",border:"none",background:"rgba(0, 0, 0, 0.2)",color:"var(--lumiverse-text-muted, #999)",cursor:"pointer",transition:"all 0.15s ease"},sortContainer:{display:"flex",alignItems:"center",gap:"6px",fontSize:"11px",color:"var(--lumiverse-text-muted, #999)"},select:{padding:"5px 24px 5px 8px",fontSize:"11px",borderRadius:"6px",border:"1px solid var(--lumiverse-border, rgba(255, 255, 255, 0.1))",background:"rgba(0, 0, 0, 0.3)",color:"var(--lumiverse-text, #e0e0e0)",cursor:"pointer",appearance:"none",backgroundImage:"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%23999' stroke-width='2'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E\")",backgroundRepeat:"no-repeat",backgroundPosition:"right 6px center"},scrollArea:{flex:"1 1 auto",minHeight:0,overflowY:"auto",padding:"12px 20px"},empty:{textAlign:"center",padding:"40px 20px",color:"var(--lumiverse-text-muted, #999)",fontSize:"14px"},emptyBtn:{marginTop:"12px",padding:"8px 16px",fontSize:"12px",borderRadius:"6px",border:"1px solid var(--lumiverse-border, rgba(255, 255, 255, 0.1))",background:"rgba(0, 0, 0, 0.2)",color:"var(--lumiverse-text, #e0e0e0)",cursor:"pointer"},packSection:{marginBottom:"16px",border:"1px solid var(--lumiverse-border, rgba(255, 255, 255, 0.1))",borderRadius:"10px",overflow:"hidden"},packHeader:{display:"flex",alignItems:"center",gap:"8px",padding:"10px 12px",background:"rgba(0, 0, 0, 0.2)",cursor:"pointer",transition:"background 0.15s ease",width:"100%",border:"none",color:"inherit",textAlign:"left",fontFamily:"inherit"},packCollapseIcon:{color:"var(--lumiverse-text-muted, #999)",transition:"transform 0.2s ease"},packFolderIcon:{color:"var(--lumiverse-primary, #9370db)"},packTitle:{flex:1,fontSize:"13px",fontWeight:500,color:"var(--lumiverse-text, #e0e0e0)"},packBadge:{fontSize:"10px",padding:"2px 6px",borderRadius:"4px",background:"rgba(147, 112, 219, 0.2)",color:"var(--lumiverse-primary, #9370db)"},packCount:{fontSize:"11px",color:"var(--lumiverse-text-muted, #999)"},packRemoveBtn:{width:"24px",height:"24px",borderRadius:"6px",border:"none",background:"transparent",color:"var(--lumiverse-text-muted, #999)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.15s ease"},itemsList:{padding:"8px 12px",display:"flex",flexDirection:"column",gap:"6px"},item:{display:"flex",alignItems:"center",gap:"10px",padding:"10px 12px",background:"rgba(0, 0, 0, 0.15)",border:"1px solid var(--lumiverse-border, rgba(255, 255, 255, 0.1))",borderRadius:"8px",cursor:"pointer",transition:"all 0.15s ease"},itemSelected:{background:"rgba(147, 112, 219, 0.15)",borderColor:"rgba(147, 112, 219, 0.4)"},itemContent:{flex:1,minWidth:0},itemName:{fontSize:"13px",fontWeight:500,color:"var(--lumiverse-text, #e0e0e0)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},itemActions:{display:"flex",alignItems:"center",gap:"8px",flexShrink:0},itemEditBtn:{width:"24px",height:"24px",borderRadius:"6px",border:"none",background:"rgba(0, 0, 0, 0.2)",color:"var(--lumiverse-text-muted, #999)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.15s ease"},toggleSwitch:{width:"36px",height:"20px",borderRadius:"10px",background:"rgba(0, 0, 0, 0.3)",border:"1px solid var(--lumiverse-border, rgba(255, 255, 255, 0.15))",position:"relative",cursor:"pointer",transition:"all 0.15s ease"},toggleSwitchChecked:{background:"var(--lumiverse-primary, #9370db)",borderColor:"var(--lumiverse-primary, #9370db)"},toggleThumb:{width:"16px",height:"16px",borderRadius:"50%",background:"#fff",position:"absolute",top:"1px",left:"1px",transition:"transform 0.15s ease"},toggleThumbChecked:{transform:"translateX(16px)"},footer:{display:"flex",justifyContent:"flex-end",gap:"8px",padding:"12px 20px",borderTop:"1px solid var(--lumiverse-border, rgba(255, 255, 255, 0.1))",flexShrink:0},btn:{padding:"10px 16px",fontSize:"13px",fontWeight:500,borderRadius:"8px",border:"none",cursor:"pointer",transition:"all 0.15s ease"},btnPrimary:{background:"var(--lumiverse-primary, #9370db)",color:"#fff"},headerCloseBtn:{display:"flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",borderRadius:"8px",border:"none",background:"transparent",color:"var(--lumiverse-text-muted, #999)",cursor:"pointer",marginLeft:"4px",transition:"all 0.15s ease"}},Bm={loomStyles:{category:"Narrative Style",packField:"loomStyles",storeField:"styles",toggleAction:"toggleLoomStyle",isMulti:!0},loomUtilities:{category:"Loom Utilities",packField:"loomUtils",storeField:"utilities",toggleAction:"toggleLoomUtility",isMulti:!0},loomRetrofits:{category:"Retrofits",packField:"loomRetrofits",storeField:"retrofits",toggleAction:"toggleLoomRetrofit",isMulti:!0}};function _m(e){let{value:n,onChange:t,placeholder:r}=e;return(0,Ee.jsxs)("div",{style:Rm.searchBox,children:[(0,Ee.jsx)(Am,{size:14,style:Rm.searchIcon}),(0,Ee.jsx)("input",{type:"text",style:Rm.searchInput,value:n,onChange:e=>t(e.target.value),placeholder:r}),n&&(0,Ee.jsx)("button",{style:Rm.searchClear,onClick:()=>t(""),type:"button","aria-label":"Clear search",children:(0,Ee.jsx)(bm,{size:14})})]})}function Fm(e){let{item:n,packName:t,isSelected:r,onToggle:i,isMulti:o,isEditable:a,onEdit:s}=e;const l=n.loomName||n.itemName||n.name||"Unknown";return(0,Ee.jsxs)("div",{style:zm(zm({},Rm.item),r?Rm.itemSelected:{}),onClick:()=>i(t,l),role:"button",tabIndex:0,onKeyDown:e=>"Enter"===e.key&&i(t,l),children:[(0,Ee.jsx)("div",{style:Rm.itemContent,children:(0,Ee.jsx)("span",{style:Rm.itemName,children:l})}),(0,Ee.jsxs)("div",{style:Rm.itemActions,children:[a&&s&&(0,Ee.jsx)("button",{style:Rm.itemEditBtn,onClick:e=>{e.stopPropagation(),s&&s(t,n)},title:"Edit this Loom item",type:"button",children:(0,Ee.jsx)(gm,{size:12})}),(0,Ee.jsx)("div",{style:zm(zm({},Rm.toggleSwitch),r?Rm.toggleSwitchChecked:{}),children:(0,Ee.jsx)("div",{style:zm(zm({},Rm.toggleThumb),r?Rm.toggleThumbChecked:{})})})]})]})}function Um(e){let{pack:n,children:t,defaultOpen:r=!0,isEditable:i,onRemovePack:o,isCollapsed:a,onToggleCollapse:s}=e;const[l,c]=(0,Ce.useState)(r),u=Ce.Children.count(t),d=n.name||n.packName||"Unknown Pack",m=void 0!==a,p=m?!a:l;if(0===u)return null;return(0,Ee.jsxs)("div",{style:Rm.packSection,children:[(0,Ee.jsxs)("div",{style:Rm.packHeader,onClick:e=>{e.target.closest("[data-action]")||(m&&s?s(d):c(!l))},children:[(0,Ee.jsx)("span",{style:zm(zm({},Rm.packCollapseIcon),{},{transform:p?"rotate(0deg)":"rotate(-90deg)"}),children:(0,Ee.jsx)(Tn,{size:14})}),(0,Ee.jsx)(vm,{size:14,style:Rm.packFolderIcon}),(0,Ee.jsx)("span",{style:Rm.packTitle,children:d}),i&&(0,Ee.jsx)("span",{style:Rm.packBadge,children:"Custom"}),(0,Ee.jsxs)("span",{style:Rm.packCount,children:[u," items"]}),(0,Ee.jsx)("button",{"data-action":"remove",style:Rm.packRemoveBtn,onClick:e=>{e.stopPropagation(),o(d)},title:"Remove Pack",type:"button",children:(0,Ee.jsx)(Pn,{size:14})})]}),p&&(0,Ee.jsx)("div",{style:Rm.itemsList,children:t})]})}const Hm=function(e){let{type:n,onClose:t}=e;const[r,i]=(0,Ce.useState)(""),[o,a]=(0,Ce.useState)(new Set),[s,l]=(0,Ce.useState)("default"),{allPacks:c}=vn(),u=Xe(),d=hn(),m=Bm[n];if(!m)return(0,Ee.jsxs)("div",{style:Rm.empty,children:["Unknown Loom type: ",n]});const{category:p,storeField:g,toggleAction:h,isMulti:v}=m,f=(0,Ce.useMemo)(()=>{const e=d[g];return e?Array.isArray(e)?e:[e]:[]},[d,g]),b=(0,Ce.useCallback)((e,n)=>f.some(t=>t.packName===e&&t.itemName===n),[f]),x=(0,Ce.useCallback)((e,n)=>{const t={packName:e,itemName:n};u[h]?(u[h](t),qe()):console.error("[LoomSelectionModal] Unknown toggle action: ".concat(h))},[u,h]),y=(0,Ce.useCallback)(()=>{const e={styles:"setSelectedLoomStyles",utilities:"setSelectedLoomUtilities",retrofits:"setSelectedLoomRetrofits"}[g];u[e]&&(u[e]([]),qe())},[u,g]),k=(0,Ce.useMemo)(()=>{const e=r.toLowerCase().trim();return c.map(n=>{const t=function(e,n){const t=[],{category:r,packField:i}=n;return e.loomItems&&Array.isArray(e.loomItems)&&e.loomItems.forEach(e=>{e.loomCategory===r&&t.push(zm(zm({},e),{},{loomName:e.loomName||e.itemName||e.name}))}),e[i]&&Array.isArray(e[i])&&e[i].forEach(e=>{t.push(zm(zm({},e),{},{loomName:e.loomName||e.itemName||e.name}))}),e.items&&Array.isArray(e.items)&&e.items.forEach(e=>{const n=e.loomCategory||e.category||e.type;n!==r&&n!==i||t.push(zm(zm({},e),{},{loomName:e.loomName||e.itemName||e.name}))}),t}(n,m),r=e?t.filter(n=>(n.loomName||n.itemName||n.name||"").toLowerCase().includes(e)):t;return zm(zm({},n),{},{loomItems:r,isEditable:n.isCustom||n.isEditable||!1})}).filter(e=>e.loomItems.length>0)},[c,m,r]),w=(0,Ce.useMemo)(()=>"default"===s?k:[...k].sort((e,n)=>{if("name"===s){const t=(e.name||e.packName||"").toLowerCase(),r=(n.name||n.packName||"").toLowerCase();return t.localeCompare(r)}if("author"===s){const t=(e.author||"").toLowerCase(),r=(n.author||"").toLowerCase();return t.localeCompare(r)}return 0}),[k,s]),j=(0,Ce.useCallback)(()=>{const e=k.map(e=>e.name||e.packName);a(new Set(e))},[k]),C=(0,Ce.useCallback)(()=>{a(new Set)},[]),S=(0,Ce.useCallback)(e=>{a(n=>{const t=new Set(n);return t.has(e)?t.delete(e):t.add(e),t})},[]),N=e=>o.has(e),E=(0,Ce.useCallback)(e=>{window.confirm('Delete pack "'.concat(e,'"? This action cannot be undone.'))&&(u.removeCustomPack(e),qe())},[u]),P=(0,Ce.useCallback)((e,n)=>{u.openModal("loomEditor",{packName:e,editingItem:n})},[u]),D=w.reduce((e,n)=>e+n.loomItems.length,0),M=f.length;return(0,Ee.jsxs)("div",{style:Rm.layout,children:[(0,Ee.jsxs)("div",{style:Rm.header,children:[(0,Ee.jsx)(_m,{value:r,onChange:i,placeholder:"Search ".concat(p,"...")}),(0,Ee.jsxs)("div",{style:Rm.selectionInfo,children:[(0,Ee.jsxs)("span",{style:Rm.selectionCount,children:[M," selected"]}),M>0&&(0,Ee.jsxs)("button",{style:Rm.clearBtn,onClick:y,title:"Clear all selections",children:[(0,Ee.jsx)(bm,{size:14}),(0,Ee.jsx)("span",{children:"Clear"})]})]}),(0,Ee.jsx)("button",{style:Rm.headerCloseBtn,onClick:t,title:"Close modal",children:(0,Ee.jsx)(mt,{size:20})})]}),w.length>0&&(0,Ee.jsxs)("div",{style:Rm.controls,children:[(0,Ee.jsxs)("div",{style:Rm.controlsGroup,children:[(0,Ee.jsxs)("button",{style:Rm.controlBtn,onClick:C,title:"Expand all packs",type:"button",children:[(0,Ee.jsx)(Tn,{size:12}),(0,Ee.jsx)("span",{children:"Expand All"})]}),(0,Ee.jsxs)("button",{style:Rm.controlBtn,onClick:j,title:"Collapse all packs",type:"button",children:[(0,Ee.jsx)(xm,{size:12}),(0,Ee.jsx)("span",{children:"Collapse All"})]})]}),(0,Ee.jsxs)("div",{style:Rm.sortContainer,children:[(0,Ee.jsx)(ym,{size:12}),(0,Ee.jsx)("span",{children:"Sort:"}),(0,Ee.jsxs)("select",{style:Rm.select,value:s,onChange:e=>l(e.target.value),children:[(0,Ee.jsx)("option",{value:"default",children:"Default"}),(0,Ee.jsx)("option",{value:"name",children:"Pack Name"}),(0,Ee.jsx)("option",{value:"author",children:"Author"})]})]})]}),(0,Ee.jsx)("div",{style:Rm.scrollArea,children:0===D?(0,Ee.jsxs)("div",{style:Rm.empty,children:['No "',p,'" items found in loaded packs.',r&&(0,Ee.jsx)("button",{style:Rm.emptyBtn,onClick:()=>i(""),type:"button",children:"Clear search"})]}):w.map(e=>{const n=(e=>e.name||e.packName||"Unknown Pack")(e);return(0,Ee.jsx)(Um,{pack:e,isEditable:e.isEditable,onRemovePack:E,isCollapsed:N(n),onToggleCollapse:S,children:e.loomItems.map(t=>{const r=t.loomName||t.itemName||t.name;return(0,Ee.jsx)(Fm,{item:t,packName:n,isSelected:b(n,r),onToggle:x,isMulti:v,isEditable:e.isEditable,onEdit:P},"".concat(n,"-").concat(r))})},e.id||n)})}),(0,Ee.jsx)("div",{style:Rm.footer,children:(0,Ee.jsx)("button",{style:zm(zm({},Rm.btn),Rm.btnPrimary),onClick:t,children:"Done"})})]})},Wm=Sn("scroll-text",[["path",{d:"M15 12h-5",key:"r7krc0"}],["path",{d:"M15 8h-5",key:"1khuty"}],["path",{d:"M19 17V5a2 2 0 0 0-2-2H4",key:"zz82l3"}],["path",{d:"M8 21h12a2 2 0 0 0 2-2v-1a1 1 0 0 0-1-1H11a1 1 0 0 0-1 1v1a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v2a1 1 0 0 0 1 1h3",key:"1ph1d7"}]]),Vm=Sn("folder-plus",[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]);function qm(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function $m(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?qm(Object(t),!0).forEach(function(n){Ym(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):qm(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Ym(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function Gm(e){return e.packName||e.name||"Unknown Pack"}function Km(e){return e.lumiaName||e.lumiaDefName||"Unknown"}function Qm(e){return e.loomName||e.itemName||e.name||"Unknown"}function Xm(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:150;return!e||e.length<=n?e:e.slice(0,n)+"..."}function Zm(e){let{item:n,packName:t,onEdit:r}=e;const i=function(e){return e.avatarUrl||e.lumia_img||null}(n),{objectPosition:o}=xn(i),a=Km(n);return(0,Ee.jsxs)("div",{className:"lumiverse-pack-selector-item-row",children:[(0,Ee.jsx)("div",{className:"lumiverse-pack-selector-item-icon-sm lumiverse-pack-selector-item-icon--lumia",children:i?(0,Ee.jsx)("img",{src:i,alt:"",className:"lumiverse-pack-selector-item-avatar",style:{objectPosition:o},onError:e=>{e.target.style.display="none"}}):(0,Ee.jsx)(lr,{size:14,strokeWidth:1.5})}),(0,Ee.jsx)("span",{className:"lumiverse-pack-selector-item-name",children:a}),(0,Ee.jsx)("span",{className:"lumiverse-pack-selector-item-type",children:"Lumia"}),(0,Ee.jsx)("button",{className:"lumiverse-pack-selector-item-edit",onClick:()=>r(t,n,"lumia"),title:"Edit this Lumia",type:"button",children:(0,Ee.jsx)(En,{size:14,strokeWidth:1.5})})]})}function Jm(e){let{item:n,packName:t,onEdit:r}=e;const[i,o]=(0,Ce.useState)(!1),a=Qm(n),s=function(e){return e.loomContent||e.content||null}(n),l=n.loomCategory||n.category||"Unknown",c="Narrative Style"===l?"Style":"Loom Utilities"===l?"Utility":"Retrofits"===l?"Retrofit":l,u=s&&s.trim().length>0;return(0,Ee.jsxs)("div",{className:"lumiverse-pack-selector-item-row-wrapper",children:[(0,Ee.jsxs)("div",{className:"lumiverse-pack-selector-item-row lumiverse-pack-selector-item-row--loom",children:[(0,Ee.jsx)("div",{className:"lumiverse-pack-selector-item-icon-sm lumiverse-pack-selector-item-icon--loom",children:(0,Ee.jsx)(Wm,{size:14,strokeWidth:1.5})}),(0,Ee.jsx)("span",{className:"lumiverse-pack-selector-item-name",children:a}),(0,Ee.jsx)("span",{className:"lumiverse-pack-selector-item-type lumiverse-pack-selector-item-type--loom",children:c}),u&&(0,Ee.jsx)("button",{className:"lumiverse-pack-selector-item-preview-btn",onClick:()=>o(!i),title:i?"Hide content preview":"Show content preview",type:"button",children:i?(0,Ee.jsx)(xm,{size:14,strokeWidth:1.5}):(0,Ee.jsx)(Tn,{size:14,strokeWidth:1.5})}),(0,Ee.jsx)("button",{className:"lumiverse-pack-selector-item-edit",onClick:()=>r(t,n,"loom"),title:"Edit this Loom item",type:"button",children:(0,Ee.jsx)(En,{size:14,strokeWidth:1.5})})]}),i&&u&&(0,Ee.jsx)("div",{className:"lumiverse-pack-selector-item-content-preview",children:Xm(s,300)})]})}const ep=function(e){let{onSelect:n,onClose:t}=e;const{customPacks:r,allPacks:i}=vn(),o=Xe(),[a,s]=(0,Ce.useState)(null),[l,c]=(0,Ce.useState)(!1),[u,d]=(0,Ce.useState)(""),[m,p]=(0,Ce.useState)(""),[g,h]=(0,Ce.useState)(""),[v,f]=(0,Ce.useState)(""),b=i.filter(e=>e.isCustom||!e.url),x=(0,Ce.useCallback)(e=>{const n=Gm(e);s(e=>e===n?null:n)},[]),y=(0,Ce.useCallback)(e=>{o.openModal("itemTypeSelector",{packName:e})},[o]),k=(0,Ce.useCallback)((e,n,t)=>{"loom"===t?o.openModal("loomEditor",{packName:e,editingItem:n}):o.openModal("lumiaEditor",{packName:e,editingItem:n})},[o]),w=(0,Ce.useCallback)(()=>{const e=u.trim();if(!e)return void f("Pack name is required");if(i.some(n=>n.name===e))return void f('Pack "'.concat(e,'" already exists'));const n={id:"pack_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),packName:e,name:e,packAuthor:m.trim()||null,coverUrl:g.trim()||null,url:"",isCustom:!0,version:1,packExtras:[],lumiaItems:[],loomItems:[]};o.addCustomPack(n),qe(),c(!1),d(""),p(""),h(""),f(""),s(e)},[u,m,g,i,o]),j=e=>e.lumiaItems&&e.lumiaItems.length>0?e.lumiaItems:e.items?e.items.filter(e=>e.lumiaDefName||e.lumiaName):[],C=e=>{const n=[];return e.loomItems&&Array.isArray(e.loomItems)&&e.loomItems.forEach(e=>{n.push($m($m({},e),{},{loomName:e.loomName||e.itemName||e.name}))}),e.loomStyles&&Array.isArray(e.loomStyles)&&e.loomStyles.forEach(e=>{n.push($m($m({},e),{},{loomName:e.loomName||e.itemName||e.name,loomCategory:e.loomCategory||"Narrative Style"}))}),e.loomUtils&&Array.isArray(e.loomUtils)&&e.loomUtils.forEach(e=>{n.push($m($m({},e),{},{loomName:e.loomName||e.itemName||e.name,loomCategory:e.loomCategory||"Loom Utilities"}))}),e.loomRetrofits&&Array.isArray(e.loomRetrofits)&&e.loomRetrofits.forEach(e=>{n.push($m($m({},e),{},{loomName:e.loomName||e.itemName||e.name,loomCategory:e.loomCategory||"Retrofits"}))}),e.items&&Array.isArray(e.items)&&e.items.forEach(e=>{const t=e.loomCategory||e.category;"Narrative Style"!==t&&"Loom Utilities"!==t&&"Retrofits"!==t&&"loomStyles"!==t&&"loomUtils"!==t&&"loomRetrofits"!==t||n.push($m($m({},e),{},{loomName:e.loomName||e.itemName||e.name,loomCategory:"loomStyles"===t?"Narrative Style":"loomUtils"===t?"Loom Utilities":"loomRetrofits"===t?"Retrofits":t}))}),n};return(0,Ee.jsxs)(Fn,{className:"lumiverse-pack-selector-modal",children:[(0,Ee.jsxs)(Un,{className:"lumiverse-pack-selector-content",children:[(0,Ee.jsxs)("div",{className:"lumiverse-pack-selector-section",children:[(0,Ee.jsx)("h4",{className:"lumiverse-pack-selector-heading",children:"Select a Pack"}),0===b.length?(0,Ee.jsx)("div",{className:"lumiverse-pack-selector-empty",children:(0,Ee.jsx)("p",{children:"No custom packs yet. Create your first one below!"})}):(0,Ee.jsx)("div",{className:"lumiverse-pack-selector-list",children:b.map(e=>{const n=Gm(e),t=function(e){return e.packAuthor||e.author||null}(e),r=a===n,i=j(e),o=C(e),s=(e=>{const n=j(e).length,t=C(e).length;return{lumiaCount:n,loomCount:t,total:n+t}})(e);return(0,Ee.jsxs)("div",{className:On("lumiverse-pack-selector-item-wrapper",r&&"lumiverse-pack-selector-item-wrapper--expanded"),children:[(0,Ee.jsxs)("button",{className:"lumiverse-pack-selector-item",onClick:()=>x(e),type:"button",children:[(0,Ee.jsx)("div",{className:"lumiverse-pack-selector-item-icon",children:(0,Ee.jsx)(vm,{size:20,strokeWidth:1.5})}),(0,Ee.jsxs)("div",{className:"lumiverse-pack-selector-item-info",children:[(0,Ee.jsx)("span",{className:"lumiverse-pack-selector-pack-name",children:n}),(0,Ee.jsxs)("span",{className:"lumiverse-pack-selector-item-meta",children:[s.lumiaCount>0&&"".concat(s.lumiaCount," Lumia").concat(1!==s.lumiaCount?"s":""),s.lumiaCount>0&&s.loomCount>0&&" • ",s.loomCount>0&&"".concat(s.loomCount," Loom").concat(1!==s.loomCount?"s":""),0===s.total&&"Empty",t&&" • by ".concat(t)]})]}),r?(0,Ee.jsx)(Tn,{size:16,className:"lumiverse-pack-selector-item-arrow"}):(0,Ee.jsx)(An,{size:16,className:"lumiverse-pack-selector-item-arrow"})]}),r&&(0,Ee.jsxs)("div",{className:"lumiverse-pack-selector-items",children:[(0,Ee.jsxs)("button",{className:"lumiverse-pack-selector-add-item",onClick:()=>y(n),type:"button",children:[(0,Ee.jsx)(dr,{size:14,strokeWidth:2}),(0,Ee.jsx)("span",{children:"Add New Item"})]}),i.length>0||o.length>0?(0,Ee.jsxs)("div",{className:"lumiverse-pack-selector-item-list",children:[i.map((e,t)=>(0,Ee.jsx)(Zm,{item:e,packName:n,onEdit:k},Km(e)||"lumia-".concat(t))),o.map((e,t)=>(0,Ee.jsx)(Jm,{item:e,packName:n,onEdit:k},Qm(e)||"loom-".concat(t)))]}):(0,Ee.jsx)("div",{className:"lumiverse-pack-selector-items-empty",children:"No items yet. Add your first one!"})]})]},e.id||n)})})]}),(0,Ee.jsx)("div",{className:"lumiverse-pack-selector-divider",children:(0,Ee.jsx)("span",{children:"or"})}),(0,Ee.jsx)("div",{className:"lumiverse-pack-selector-section",children:l?(0,Ee.jsxs)("div",{className:"lumiverse-pack-selector-form",children:[(0,Ee.jsxs)("h4",{className:"lumiverse-pack-selector-heading",children:[(0,Ee.jsx)(Vm,{size:16,strokeWidth:1.5}),"Create New Pack"]}),(0,Ee.jsx)("div",{className:"lumiverse-pack-selector-field",children:(0,Ee.jsx)(qn,{placeholder:"Pack name (required)",value:u,onChange:d,autoFocus:!0})}),(0,Ee.jsx)("div",{className:"lumiverse-pack-selector-field",children:(0,Ee.jsx)(qn,{placeholder:"Author name (optional)",value:m,onChange:p})}),(0,Ee.jsx)("div",{className:"lumiverse-pack-selector-field",children:(0,Ee.jsx)(qn,{placeholder:"Cover image URL (optional)",value:g,onChange:h})}),v&&(0,Ee.jsx)("div",{className:"lumiverse-pack-selector-error",children:v}),(0,Ee.jsxs)("div",{className:"lumiverse-pack-selector-form-actions",children:[(0,Ee.jsx)("button",{className:"lumiverse-btn lumiverse-btn--secondary",onClick:()=>{c(!1),d(""),p(""),h(""),f("")},type:"button",children:"Cancel"}),(0,Ee.jsxs)("button",{className:"lumiverse-btn lumiverse-btn--primary",onClick:w,type:"button",children:[(0,Ee.jsx)(Vm,{size:14}),"Create & Continue"]})]})]}):(0,Ee.jsxs)("button",{className:"lumiverse-pack-selector-create-btn",onClick:()=>c(!0),type:"button",children:[(0,Ee.jsx)(Vm,{size:18,strokeWidth:1.5}),(0,Ee.jsx)("span",{children:"Create New Pack"})]})})]}),(0,Ee.jsx)(Hn,{className:"lumiverse-pack-selector-footer",children:(0,Ee.jsx)("button",{className:"lumiverse-btn lumiverse-btn--secondary",onClick:t,type:"button",style:{marginLeft:"auto"},children:"Cancel"})})]})},np=Sn("smile",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]);function tp(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function rp(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?tp(Object(t),!0).forEach(function(n){ip(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):tp(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function ip(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const op=0,ap=[{value:op,label:"She/Her"},{value:1,label:"He/Him"},{value:2,label:"They/Them"}];function sp(e,n){if(!e)return null;const t={name:["lumiaName","lumiaDefName"],def:["lumiaDefinition","lumiaDef"],personality:["lumiaPersonality","lumia_personality"],behavior:["lumiaBehavior","lumia_behavior"],img:["avatarUrl","lumia_img"],author:["authorName","defAuthor"],gender:["genderIdentity"]}[n];if(!t)return null;for(const n of t)if(void 0!==e[n]&&null!==e[n])return e[n];return null}const lp={modalLayout:{display:"flex",flexDirection:"column",height:"100%",maxHeight:"100%",minHeight:0,overflow:"hidden"},header:{display:"flex",alignItems:"center",gap:"12px",padding:"16px 20px",background:"var(--lumiverse-bg-elevated)",borderBottom:"1px solid var(--lumiverse-border)",flexShrink:0},headerIcon:{width:"36px",height:"36px",borderRadius:"10px",background:"linear-gradient(135deg, rgba(147, 112, 219, 0.2), rgba(186, 85, 211, 0.15))",display:"flex",alignItems:"center",justifyContent:"center",color:"var(--lumiverse-primary)",flexShrink:0},headerTitle:{flex:1,fontSize:"15px",fontWeight:600,color:"var(--lumiverse-text)",margin:0},headerSubtitle:{fontSize:"12px",color:"var(--lumiverse-text-muted)",marginTop:"2px"},closeBtn:{width:"32px",height:"32px",borderRadius:"8px",border:"none",background:"transparent",color:"var(--lumiverse-text-muted)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.15s ease",flexShrink:0},scrollArea:{flex:"1 1 auto",minHeight:0,overflowY:"auto",overflowX:"hidden",padding:"20px"},section:{marginBottom:"24px"},sectionHeader:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"16px",paddingBottom:"10px",borderBottom:"1px solid var(--lumiverse-border)"},sectionIcon:{width:"28px",height:"28px",borderRadius:"8px",background:"rgba(147, 112, 219, 0.1)",display:"flex",alignItems:"center",justifyContent:"center",color:"var(--lumiverse-primary)"},sectionTitle:{fontSize:"14px",fontWeight:600,color:"var(--lumiverse-text)"},field:{marginBottom:"16px"},label:{display:"flex",alignItems:"center",gap:"6px",marginBottom:"8px",fontSize:"13px",fontWeight:500,color:"var(--lumiverse-text-muted)"},required:{color:"var(--lumiverse-danger)"},hint:{marginTop:"6px",fontSize:"11px",color:"var(--lumiverse-text-dim)",lineHeight:1.4},error:{marginTop:"4px",fontSize:"12px",color:"var(--lumiverse-danger)"},input:{width:"100%",padding:"10px 12px",background:"rgba(0, 0, 0, 0.25)",border:"1px solid var(--lumiverse-border)",borderRadius:"8px",color:"var(--lumiverse-text)",fontSize:"13px",fontFamily:"inherit",outline:"none",transition:"border-color 0.15s ease, box-shadow 0.15s ease",boxSizing:"border-box"},textarea:{width:"100%",padding:"12px",background:"rgba(0, 0, 0, 0.25)",border:"1px solid var(--lumiverse-border)",borderRadius:"8px",color:"var(--lumiverse-text)",fontSize:"13px",fontFamily:"inherit",lineHeight:1.6,resize:"vertical",outline:"none",transition:"border-color 0.15s ease, box-shadow 0.15s ease",boxSizing:"border-box",minHeight:"120px"},select:{width:"100%",padding:"10px 32px 10px 12px",background:"rgba(0, 0, 0, 0.25)",border:"1px solid var(--lumiverse-border)",borderRadius:"8px",color:"var(--lumiverse-text)",fontSize:"13px",fontFamily:"inherit",appearance:"none",cursor:"pointer",outline:"none",boxSizing:"border-box"},selectWrapper:{position:"relative"},selectChevron:{position:"absolute",right:"12px",top:"50%",transform:"translateY(-50%)",pointerEvents:"none",color:"var(--lumiverse-text-muted)"},grid2Col:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px"},imageRow:{display:"flex",gap:"10px",alignItems:"flex-start"},imagePreview:{width:"44px",height:"44px",borderRadius:"8px",overflow:"hidden",border:"1px solid var(--lumiverse-border)",flexShrink:0,background:"rgba(0, 0, 0, 0.2)"},imagePlaceholder:{width:"44px",height:"44px",borderRadius:"8px",border:"1px dashed var(--lumiverse-border)",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,color:"var(--lumiverse-text-dim)",background:"rgba(0, 0, 0, 0.1)"},footer:{display:"flex",alignItems:"center",gap:"8px",padding:"16px 20px",background:"var(--lumiverse-bg-elevated)",borderTop:"1px solid var(--lumiverse-border)",flexShrink:0},btnPrimary:{padding:"10px 20px",borderRadius:"8px",border:"none",background:"var(--lumiverse-primary)",color:"#fff",fontSize:"13px",fontWeight:600,cursor:"pointer",transition:"all 0.15s ease",display:"flex",alignItems:"center",gap:"6px"},btnSecondary:{padding:"10px 16px",borderRadius:"8px",border:"1px solid var(--lumiverse-border)",background:"transparent",color:"var(--lumiverse-text)",fontSize:"13px",fontWeight:500,cursor:"pointer",transition:"all 0.15s ease"},btnDanger:{padding:"10px 16px",borderRadius:"8px",border:"1px solid rgba(239, 68, 68, 0.3)",background:"rgba(239, 68, 68, 0.1)",color:"#ef4444",fontSize:"13px",fontWeight:500,cursor:"pointer",display:"flex",alignItems:"center",gap:"6px",marginRight:"auto"},spacer:{marginRight:"auto"}};function cp(e){let{url:n}=e;const[t,r]=(0,Ce.useState)(!1),{objectPosition:i}=xn(n||"");return Ce.useEffect(()=>{r(!1)},[n]),!n||t?(0,Ee.jsx)("div",{style:lp.imagePlaceholder,children:(0,Ee.jsx)(Ln,{size:18})}):(0,Ee.jsx)("div",{style:lp.imagePreview,children:(0,Ee.jsx)("img",{src:n,alt:"Avatar",style:{width:"100%",height:"100%",objectFit:"cover",objectPosition:i,animation:"lumiverseFadeIn 0.2s ease"},onError:()=>r(!0)})})}const up=function(e){var n;let{packName:t,editingItem:r=null,onClose:i,onSaved:o}=e;const{allPacks:a}=vn(),s=Xe(),l=null!==r,c=a.find(e=>(e.name||e.packName)===t),[u,d]=(0,Ce.useState)(sp(r,"name")||""),[m,p]=(0,Ce.useState)(sp(r,"img")||""),[g,h]=(0,Ce.useState)(sp(r,"author")||""),[v,f]=(0,Ce.useState)(sp(r,"def")||""),[b,x]=(0,Ce.useState)(sp(r,"personality")||""),[y,k]=(0,Ce.useState)(sp(r,"behavior")||""),[w,j]=(0,Ce.useState)(null!==(n=sp(r,"gender"))&&void 0!==n?n:op),[C,S]=(0,Ce.useState)({}),N=(0,Ce.useCallback)(()=>{const e={};if(u.trim()||(e.name="Lumia name is required"),c&&u.trim()){const n=c.lumiaItems||c.items||[],t=sp(r,"name");n.find(e=>{const n=sp(e,"name");return n===u.trim()&&(!l||n!==t)})&&(e.name='A Lumia named "'.concat(u.trim(),'" already exists'))}return S(e),0===Object.keys(e).length},[u,c,l,r]),E=(0,Ce.useCallback)(()=>{if(!N())return;const e={lumiaName:u.trim(),avatarUrl:m.trim()||null,authorName:g.trim()||null,lumiaDefinition:v.trim()||null,lumiaPersonality:b.trim()||null,lumiaBehavior:y.trim()||null,genderIdentity:Number(w),version:1};if(c){const n=[...c.lumiaItems||c.items||[]],i=sp(r,"name");if(l){const t=n.findIndex(e=>sp(e,"name")===i);t>=0?n[t]=e:n.push(e)}else n.push(e);const a=rp(rp({},c),{},{lumiaItems:n,items:void 0}),u=c.id||c.name||c.packName;c.isCustom?s.updateCustomPack(u,a):s.updateCustomPack(u,rp(rp({},a),{},{isCustom:!0})),qe(),o&&o(e,t)}i()},[N,u,m,g,v,b,y,w,c,l,r,s,t,i,o]),P=(0,Ce.useCallback)(()=>{if(!l||!r)return;const e=sp(r,"name");if(window.confirm('Delete "'.concat(e,'"? This cannot be undone.'))){if(c){const n=(c.lumiaItems||c.items||[]).filter(n=>sp(n,"name")!==e),t=rp(rp({},c),{},{lumiaItems:n,items:void 0}),r=c.id||c.name||c.packName;c.isCustom?s.updateCustomPack(r,t):s.updateCustomPack(r,rp(rp({},t),{},{isCustom:!0})),qe()}i()}},[l,r,c,s,i]);return c?(0,Ee.jsxs)("div",{style:lp.modalLayout,children:[(0,Ee.jsxs)("div",{style:lp.header,children:[(0,Ee.jsx)("div",{style:lp.headerIcon,children:(0,Ee.jsx)(Qt,{size:18})}),(0,Ee.jsxs)("div",{style:{flex:1},children:[(0,Ee.jsx)("h2",{style:lp.headerTitle,children:l?"Edit Lumia":"Create New Lumia"}),(0,Ee.jsx)("div",{style:lp.headerSubtitle,children:c.packName||c.name})]}),(0,Ee.jsx)("button",{style:lp.closeBtn,onClick:i,onMouseOver:e=>e.currentTarget.style.background="var(--lumiverse-bg-hover)",onMouseOut:e=>e.currentTarget.style.background="transparent",children:(0,Ee.jsx)(mt,{size:18})})]}),(0,Ee.jsxs)("div",{style:lp.scrollArea,children:[(0,Ee.jsxs)("div",{style:lp.section,children:[(0,Ee.jsxs)("div",{style:lp.sectionHeader,children:[(0,Ee.jsx)("div",{style:lp.sectionIcon,children:(0,Ee.jsx)(lr,{size:15})}),(0,Ee.jsx)("span",{style:lp.sectionTitle,children:"Basic Info"})]}),(0,Ee.jsxs)("div",{style:lp.field,children:[(0,Ee.jsxs)("label",{style:lp.label,children:["Lumia Name ",(0,Ee.jsx)("span",{style:lp.required,children:"*"})]}),(0,Ee.jsx)("input",{type:"text",style:lp.input,value:u,onChange:e=>{d(e.target.value),C.name&&S(e=>rp(rp({},e),{},{name:null}))},placeholder:"e.g., Aria, Luna, Sage",autoFocus:!0}),(0,Ee.jsx)("div",{style:lp.hint,children:"Referenced as 'Lumia' in World Books"}),C.name&&(0,Ee.jsx)("div",{style:lp.error,children:C.name})]}),(0,Ee.jsxs)("div",{style:lp.grid2Col,children:[(0,Ee.jsxs)("div",{style:lp.field,children:[(0,Ee.jsx)("label",{style:lp.label,children:"Gender Identity"}),(0,Ee.jsxs)("div",{style:lp.selectWrapper,children:[(0,Ee.jsx)("select",{style:lp.select,value:w,onChange:e=>j(e.target.value),children:ap.map(e=>(0,Ee.jsx)("option",{value:e.value,children:e.label},e.value))}),(0,Ee.jsx)("div",{style:lp.selectChevron,children:"▼"})]}),(0,Ee.jsx)("div",{style:lp.hint,children:"For pronouns macro"})]}),(0,Ee.jsxs)("div",{style:lp.field,children:[(0,Ee.jsx)("label",{style:lp.label,children:"Author"}),(0,Ee.jsx)("input",{type:"text",style:lp.input,value:g,onChange:e=>h(e.target.value),placeholder:"Your name"})]})]}),(0,Ee.jsxs)("div",{style:lp.field,children:[(0,Ee.jsx)("label",{style:lp.label,children:"Avatar URL"}),(0,Ee.jsxs)("div",{style:lp.imageRow,children:[(0,Ee.jsx)("div",{style:{flex:1},children:(0,Ee.jsx)("input",{type:"text",style:lp.input,value:m,onChange:e=>p(e.target.value),placeholder:"https://..."})}),(0,Ee.jsx)(cp,{url:m})]})]})]}),(0,Ee.jsxs)("div",{style:lp.section,children:[(0,Ee.jsxs)("div",{style:lp.sectionHeader,children:[(0,Ee.jsx)("div",{style:lp.sectionIcon,children:(0,Ee.jsx)(lr,{size:15})}),(0,Ee.jsx)("span",{style:lp.sectionTitle,children:"Physical Definition"})]}),(0,Ee.jsxs)("div",{style:lp.field,children:[(0,Ee.jsx)("label",{style:lp.label,children:"Physicality"}),(0,Ee.jsx)("textarea",{style:lp.textarea,value:v,onChange:e=>f(e.target.value),placeholder:"Describe Lumia's physical appearance, form, and presence...",rows:6}),(0,Ee.jsxs)("div",{style:lp.hint,children:["Injected via ","{{lumiaDef}}"," macro"]})]})]}),(0,Ee.jsxs)("div",{style:lp.section,children:[(0,Ee.jsxs)("div",{style:lp.sectionHeader,children:[(0,Ee.jsx)("div",{style:lp.sectionIcon,children:(0,Ee.jsx)(np,{size:15})}),(0,Ee.jsx)("span",{style:lp.sectionTitle,children:"Personality Traits"})]}),(0,Ee.jsxs)("div",{style:lp.field,children:[(0,Ee.jsx)("label",{style:lp.label,children:"Personality"}),(0,Ee.jsx)("textarea",{style:lp.textarea,value:b,onChange:e=>x(e.target.value),placeholder:"Describe Lumia's personality, disposition, and inner nature...",rows:6}),(0,Ee.jsxs)("div",{style:lp.hint,children:["Injected via ","{{lumiaPersonality}}"," macro"]})]})]}),(0,Ee.jsxs)("div",{style:lp.section,children:[(0,Ee.jsxs)("div",{style:lp.sectionHeader,children:[(0,Ee.jsx)("div",{style:lp.sectionIcon,children:(0,Ee.jsx)(Td,{size:15})}),(0,Ee.jsx)("span",{style:lp.sectionTitle,children:"Behavioral Patterns"})]}),(0,Ee.jsxs)("div",{style:lp.field,children:[(0,Ee.jsx)("label",{style:lp.label,children:"Behavior"}),(0,Ee.jsx)("textarea",{style:lp.textarea,value:y,onChange:e=>k(e.target.value),placeholder:"Describe Lumia's behavioral patterns, habits, and tendencies...",rows:6}),(0,Ee.jsxs)("div",{style:lp.hint,children:["Injected via ","{{lumiaBehavior}}"," macro"]})]})]})]}),(0,Ee.jsxs)("div",{style:lp.footer,children:[l?(0,Ee.jsxs)("button",{style:lp.btnDanger,onClick:P,children:[(0,Ee.jsx)(Pn,{size:14})," Delete"]}):(0,Ee.jsx)("div",{style:lp.spacer}),(0,Ee.jsx)("button",{style:lp.btnSecondary,onClick:i,children:"Cancel"}),(0,Ee.jsx)("button",{style:lp.btnPrimary,onClick:E,children:l?"Save Changes":"Create Lumia"})]})]}):(0,Ee.jsx)("div",{style:lp.modalLayout,children:(0,Ee.jsxs)("div",{style:rp(rp({},lp.scrollArea),{},{textAlign:"center",paddingTop:"40px"}),children:[(0,Ee.jsxs)("p",{style:{color:"var(--lumiverse-text-muted)"},children:['Pack "',t,'" not found.']}),(0,Ee.jsx)("button",{style:lp.btnSecondary,onClick:i,children:"Close"})]})})},dp=Sn("palette",[["path",{d:"M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z",key:"e79jfc"}],["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}]]);function mp(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function pp(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?mp(Object(t),!0).forEach(function(n){gp(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):mp(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function gp(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const hp=[{value:"Narrative Style",label:"Narrative Style",description:"Writing style and prose guidance",Icon:dp},{value:"Loom Utilities",label:"Utility",description:"Helper functions and techniques",Icon:Td},{value:"Retrofits",label:"Retrofit",description:"System modifications and enhancements",Icon:vr}];function vp(e,n){if(!e)return null;const t={name:["loomName","itemName","name"],content:["loomContent","content"],category:["loomCategory","category","type"],author:["authorName","author"]}[n];if(!t)return null;for(const n of t)if(void 0!==e[n]&&null!==e[n])return e[n];return null}const fp={modalLayout:{display:"flex",flexDirection:"column",height:"100%",maxHeight:"100%",minHeight:0,overflow:"hidden"},header:{display:"flex",alignItems:"center",gap:"12px",padding:"16px 20px",background:"var(--lumiverse-bg-elevated)",borderBottom:"1px solid var(--lumiverse-border)",flexShrink:0},headerIcon:{width:"36px",height:"36px",borderRadius:"10px",background:"linear-gradient(135deg, rgba(147, 112, 219, 0.2), rgba(186, 85, 211, 0.15))",display:"flex",alignItems:"center",justifyContent:"center",color:"var(--lumiverse-primary)",flexShrink:0},headerTitle:{flex:1,fontSize:"15px",fontWeight:600,color:"var(--lumiverse-text)",margin:0},headerSubtitle:{fontSize:"12px",color:"var(--lumiverse-text-muted)",marginTop:"2px"},closeBtn:{width:"32px",height:"32px",borderRadius:"8px",border:"none",background:"transparent",color:"var(--lumiverse-text-muted)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.15s ease",flexShrink:0},scrollArea:{flex:"1 1 auto",minHeight:0,overflowY:"auto",overflowX:"hidden",padding:"20px"},section:{marginBottom:"24px"},sectionHeader:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"16px",paddingBottom:"10px",borderBottom:"1px solid var(--lumiverse-border)"},sectionIcon:{width:"28px",height:"28px",borderRadius:"8px",background:"rgba(147, 112, 219, 0.1)",display:"flex",alignItems:"center",justifyContent:"center",color:"var(--lumiverse-primary)"},sectionTitle:{fontSize:"14px",fontWeight:600,color:"var(--lumiverse-text)"},field:{marginBottom:"16px"},label:{display:"flex",alignItems:"center",gap:"6px",marginBottom:"8px",fontSize:"13px",fontWeight:500,color:"var(--lumiverse-text-muted)"},required:{color:"var(--lumiverse-danger)"},hint:{marginTop:"6px",fontSize:"11px",color:"var(--lumiverse-text-dim)",lineHeight:1.4},error:{marginTop:"4px",fontSize:"12px",color:"var(--lumiverse-danger)"},input:{width:"100%",padding:"10px 12px",background:"rgba(0, 0, 0, 0.25)",border:"1px solid var(--lumiverse-border)",borderRadius:"8px",color:"var(--lumiverse-text)",fontSize:"13px",fontFamily:"inherit",outline:"none",transition:"border-color 0.15s ease, box-shadow 0.15s ease",boxSizing:"border-box"},textarea:{width:"100%",padding:"12px",background:"rgba(0, 0, 0, 0.25)",border:"1px solid var(--lumiverse-border)",borderRadius:"8px",color:"var(--lumiverse-text)",fontSize:"13px",fontFamily:"inherit",lineHeight:1.6,resize:"vertical",outline:"none",transition:"border-color 0.15s ease, box-shadow 0.15s ease",boxSizing:"border-box",minHeight:"120px"},footer:{display:"flex",alignItems:"center",gap:"8px",padding:"16px 20px",background:"var(--lumiverse-bg-elevated)",borderTop:"1px solid var(--lumiverse-border)",flexShrink:0},btnPrimary:{padding:"10px 20px",borderRadius:"8px",border:"none",background:"var(--lumiverse-primary)",color:"#fff",fontSize:"13px",fontWeight:600,cursor:"pointer",transition:"all 0.15s ease",display:"flex",alignItems:"center",gap:"6px"},btnSecondary:{padding:"10px 16px",borderRadius:"8px",border:"1px solid var(--lumiverse-border)",background:"transparent",color:"var(--lumiverse-text)",fontSize:"13px",fontWeight:500,cursor:"pointer",transition:"all 0.15s ease"},btnDanger:{padding:"10px 16px",borderRadius:"8px",border:"1px solid rgba(239, 68, 68, 0.3)",background:"rgba(239, 68, 68, 0.1)",color:"#ef4444",fontSize:"13px",fontWeight:500,cursor:"pointer",display:"flex",alignItems:"center",gap:"6px",marginRight:"auto"},spacer:{marginRight:"auto"},categoryGrid:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"8px"},categoryBtn:{display:"flex",flexDirection:"column",alignItems:"center",gap:"6px",padding:"10px 4px",border:"1px solid var(--lumiverse-border)",borderRadius:"8px",background:"rgba(0, 0, 0, 0.2)",color:"var(--lumiverse-text-muted)",cursor:"pointer",transition:"all 0.15s ease"},categoryBtnSelected:{background:"rgba(147, 112, 219, 0.15)",borderColor:"var(--lumiverse-primary)",color:"var(--lumiverse-primary)"},categoryLabel:{fontSize:"11px",fontWeight:500}};function bp(e){switch(e){case"Narrative Style":return"Injected via {{loomStyle}} macro. Describe prose style, tone, and writing approach.";case"Loom Utilities":return"Injected via {{loomUtils}} macro. Define helper techniques or utility functions.";case"Retrofits":return"Injected via {{loomRetrofits}} macro. System modifications and enhancements.";default:return""}}function xp(e){switch(e){case"Narrative Style":return"Write in a dark, atmospheric style. Use vivid sensory descriptions emphasizing shadows, decay, and unease...";case"Loom Utilities":return"When transitioning between scenes, use a brief temporal or spatial marker followed by sensory grounding...";case"Retrofits":return"Track and reference previous conversations, character states, and plot points. Maintain consistency...";default:return"Enter the content for this Loom item..."}}const yp=function(e){var n;let{packName:t,editingItem:r=null,onClose:i,onSaved:o}=e;const{allPacks:a}=vn(),s=Xe(),l=null!==r,c=a.find(e=>(e.name||e.packName)===t),[u,d]=(0,Ce.useState)(vp(r,"name")||""),[m,p]=(0,Ce.useState)(vp(r,"content")||""),[g,h]=(0,Ce.useState)(vp(r,"category")||"Narrative Style"),[v,f]=(0,Ce.useState)(vp(r,"author")||""),[b,x]=(0,Ce.useState)({}),y=(0,Ce.useCallback)(()=>{const e={};if(u.trim()||(e.name="Loom name is required"),m.trim()||(e.content="Content is required"),c&&u.trim()){const n=c.loomItems||[],t=vp(r,"name");n.find(e=>{const n=vp(e,"name");return n===u.trim()&&(!l||n!==t)})&&(e.name='A Loom named "'.concat(u.trim(),'" already exists in this pack'))}return x(e),0===Object.keys(e).length},[u,m,c,l,r]),k=(0,Ce.useCallback)(()=>{if(!y())return;const e={loomName:u.trim(),loomContent:m.trim(),loomCategory:g,authorName:v.trim()||null,version:1};if(c){const n=[...c.loomItems||[]],i=vp(r,"name");if(l){const t=n.findIndex(e=>vp(e,"name")===i);t>=0?n[t]=e:n.push(e)}else n.push(e);const a=pp(pp({},c),{},{loomItems:n}),u=c.id||c.name||c.packName;c.isCustom?s.updateCustomPack(u,a):s.updateCustomPack(u,pp(pp({},a),{},{isCustom:!0})),qe(),o&&o(e,t)}i()},[y,u,m,g,v,c,l,r,s,t,i,o]),w=(0,Ce.useCallback)(()=>{if(!l||!r)return;const e=vp(r,"name");if(window.confirm('Delete "'.concat(e,'"? This cannot be undone.'))){if(c){const n=(c.loomItems||[]).filter(n=>vp(n,"name")!==e),t=pp(pp({},c),{},{loomItems:n}),r=c.id||c.name||c.packName;c.isCustom?s.updateCustomPack(r,t):s.updateCustomPack(r,pp(pp({},t),{},{isCustom:!0})),qe()}i()}},[l,r,c,s,i]);if(!c)return(0,Ee.jsx)("div",{style:fp.modalLayout,children:(0,Ee.jsxs)("div",{style:pp(pp({},fp.scrollArea),{},{textAlign:"center",paddingTop:"40px"}),children:[(0,Ee.jsxs)("p",{style:{color:"var(--lumiverse-text-muted)"},children:['Pack "',t,'" not found.']}),(0,Ee.jsx)("button",{style:fp.btnSecondary,onClick:i,children:"Close"})]})});const j=(null===(n=hp.find(e=>e.value===g))||void 0===n?void 0:n.Icon)||Wm;return(0,Ee.jsxs)("div",{style:fp.modalLayout,children:[(0,Ee.jsxs)("div",{style:fp.header,children:[(0,Ee.jsx)("div",{style:fp.headerIcon,children:(0,Ee.jsx)(Wm,{size:18})}),(0,Ee.jsxs)("div",{style:{flex:1},children:[(0,Ee.jsx)("h2",{style:fp.headerTitle,children:l?"Edit Loom":"Create New Loom"}),(0,Ee.jsx)("div",{style:fp.headerSubtitle,children:c.packName||c.name})]}),(0,Ee.jsx)("button",{style:fp.closeBtn,onClick:i,onMouseOver:e=>e.currentTarget.style.background="var(--lumiverse-bg-hover)",onMouseOut:e=>e.currentTarget.style.background="transparent",children:(0,Ee.jsx)(mt,{size:18})})]}),(0,Ee.jsxs)("div",{style:fp.scrollArea,children:[(0,Ee.jsxs)("div",{style:fp.section,children:[(0,Ee.jsxs)("div",{style:fp.sectionHeader,children:[(0,Ee.jsx)("div",{style:fp.sectionIcon,children:(0,Ee.jsx)(Wm,{size:15})}),(0,Ee.jsx)("span",{style:fp.sectionTitle,children:"Loom Details"})]}),(0,Ee.jsxs)("div",{style:fp.field,children:[(0,Ee.jsxs)("label",{style:fp.label,children:["Loom Name ",(0,Ee.jsx)("span",{style:fp.required,children:"*"})]}),(0,Ee.jsx)("input",{type:"text",style:fp.input,value:u,onChange:e=>{d(e.target.value),b.name&&x(e=>pp(pp({},e),{},{name:null}))},placeholder:"e.g., Gothic Horror, Scene Helper",autoFocus:!0}),b.name&&(0,Ee.jsx)("div",{style:fp.error,children:b.name})]}),(0,Ee.jsxs)("div",{style:fp.field,children:[(0,Ee.jsx)("label",{style:fp.label,children:"Author"}),(0,Ee.jsx)("input",{type:"text",style:fp.input,value:v,onChange:e=>f(e.target.value),placeholder:"Your name"})]}),(0,Ee.jsxs)("div",{style:fp.field,children:[(0,Ee.jsxs)("label",{style:fp.label,children:["Category ",(0,Ee.jsx)("span",{style:fp.required,children:"*"})]}),(0,Ee.jsx)("div",{style:fp.categoryGrid,children:hp.map(e=>{const n=g===e.value;return(0,Ee.jsxs)("button",{type:"button",style:pp(pp({},fp.categoryBtn),n?fp.categoryBtnSelected:{}),onClick:()=>h(e.value),title:e.description,children:[(0,Ee.jsx)(e.Icon,{size:16,strokeWidth:1.5}),(0,Ee.jsx)("span",{style:fp.categoryLabel,children:e.label})]},e.value)})})]})]}),(0,Ee.jsxs)("div",{style:fp.section,children:[(0,Ee.jsxs)("div",{style:fp.sectionHeader,children:[(0,Ee.jsx)("div",{style:fp.sectionIcon,children:(0,Ee.jsx)(j,{size:15})}),(0,Ee.jsx)("span",{style:fp.sectionTitle,children:"Content"})]}),(0,Ee.jsxs)("div",{style:fp.field,children:[(0,Ee.jsxs)("label",{style:fp.label,children:["Loom Content ",(0,Ee.jsx)("span",{style:fp.required,children:"*"})]}),(0,Ee.jsx)("textarea",{style:fp.textarea,value:m,onChange:e=>{p(e.target.value),b.content&&x(e=>pp(pp({},e),{},{content:null}))},placeholder:xp(g),rows:12}),(0,Ee.jsx)("div",{style:fp.hint,children:bp(g)}),b.content&&(0,Ee.jsx)("div",{style:fp.error,children:b.content})]})]})]}),(0,Ee.jsxs)("div",{style:fp.footer,children:[l?(0,Ee.jsxs)("button",{style:fp.btnDanger,onClick:w,children:[(0,Ee.jsx)(Pn,{size:14})," Delete"]}):(0,Ee.jsx)("div",{style:fp.spacer}),(0,Ee.jsx)("button",{style:fp.btnSecondary,onClick:i,children:"Cancel"}),(0,Ee.jsx)("button",{style:fp.btnPrimary,onClick:k,children:l?"Save Changes":"Create Loom"})]})]})},kp=Sn("arrow-right",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);const wp=function(e){let{packName:n,onSelectLumia:t,onSelectLoom:r,onBack:i}=e;const[o,a]=(0,Ce.useState)(null);return(0,Ee.jsxs)(Fn,{className:"lumiverse-type-selector",children:[(0,Ee.jsxs)(Un,{className:"lumiverse-type-selector-content",children:[(0,Ee.jsxs)("div",{className:"lumiverse-type-selector-header",style:{textAlign:"center",marginBottom:"24px"},children:[(0,Ee.jsxs)("h3",{className:"lumiverse-type-selector-title",style:{fontSize:"18px",fontWeight:600,color:"var(--lumiverse-text)",marginBottom:"8px"},children:["Add to ",n]}),(0,Ee.jsx)("p",{className:"lumiverse-type-selector-subtitle",style:{fontSize:"13px",color:"var(--lumiverse-text-muted)"},children:"Choose what you'd like to create"})]}),(0,Ee.jsxs)("div",{className:"lumiverse-type-selector-options",style:{display:"flex",flexDirection:"column",gap:"12px"},children:[(0,Ee.jsxs)("button",{className:On("lumiverse-type-option","lumiverse-type-option--lumia","lumia"===o&&"lumiverse-type-option--hovered"),onClick:t,onMouseEnter:()=>a("lumia"),onMouseLeave:()=>a(null),type:"button",style:{display:"flex",alignItems:"center",textAlign:"left",padding:"16px",background:"lumia"===o?"rgba(147, 112, 219, 0.15)":"rgba(0, 0, 0, 0.2)",border:"1px solid ".concat("lumia"===o?"var(--lumiverse-primary)":"var(--lumiverse-border)"),borderRadius:"12px",cursor:"pointer",transition:"all 0.2s ease",width:"100%"},children:[(0,Ee.jsx)("div",{className:"lumiverse-type-option-icon",style:{width:"48px",height:"48px",borderRadius:"50%",background:"rgba(147, 112, 219, 0.15)",display:"flex",alignItems:"center",justifyContent:"center",color:"var(--lumiverse-primary)",marginRight:"16px",flexShrink:0},children:(0,Ee.jsx)(lr,{size:24,strokeWidth:1.5})}),(0,Ee.jsxs)("div",{className:"lumiverse-type-option-content",style:{flex:1},children:[(0,Ee.jsx)("span",{className:"lumiverse-type-option-label",style:{display:"block",fontSize:"15px",fontWeight:600,color:"var(--lumiverse-text)",marginBottom:"4px"},children:"Lumia"}),(0,Ee.jsx)("span",{className:"lumiverse-type-option-desc",style:{display:"block",fontSize:"12px",color:"var(--lumiverse-text-muted)",lineHeight:1.4},children:"Character definition with physicality, personality, and behavior"})]}),(0,Ee.jsx)("div",{className:"lumiverse-type-option-arrow",style:{color:"lumia"===o?"var(--lumiverse-primary)":"var(--lumiverse-text-dim)",marginLeft:"12px"},children:(0,Ee.jsx)(kp,{size:20,strokeWidth:2})})]}),(0,Ee.jsxs)("button",{className:On("lumiverse-type-option","lumiverse-type-option--loom","loom"===o&&"lumiverse-type-option--hovered"),onClick:r,onMouseEnter:()=>a("loom"),onMouseLeave:()=>a(null),type:"button",style:{display:"flex",alignItems:"center",textAlign:"left",padding:"16px",background:"loom"===o?"rgba(147, 112, 219, 0.15)":"rgba(0, 0, 0, 0.2)",border:"1px solid ".concat("loom"===o?"var(--lumiverse-primary)":"var(--lumiverse-border)"),borderRadius:"12px",cursor:"pointer",transition:"all 0.2s ease",width:"100%"},children:[(0,Ee.jsx)("div",{className:"lumiverse-type-option-icon",style:{width:"48px",height:"48px",borderRadius:"50%",background:"rgba(147, 112, 219, 0.15)",display:"flex",alignItems:"center",justifyContent:"center",color:"var(--lumiverse-primary)",marginRight:"16px",flexShrink:0},children:(0,Ee.jsx)(Wm,{size:24,strokeWidth:1.5})}),(0,Ee.jsxs)("div",{className:"lumiverse-type-option-content",style:{flex:1},children:[(0,Ee.jsx)("span",{className:"lumiverse-type-option-label",style:{display:"block",fontSize:"15px",fontWeight:600,color:"var(--lumiverse-text)",marginBottom:"4px"},children:"Loom"}),(0,Ee.jsx)("span",{className:"lumiverse-type-option-desc",style:{display:"block",fontSize:"12px",color:"var(--lumiverse-text-muted)",lineHeight:1.4},children:"Narrative style, utility, or retrofit modifier"})]}),(0,Ee.jsx)("div",{className:"lumiverse-type-option-arrow",style:{color:"loom"===o?"var(--lumiverse-primary)":"var(--lumiverse-text-dim)",marginLeft:"12px"},children:(0,Ee.jsx)(kp,{size:20,strokeWidth:2})})]})]})]}),i&&(0,Ee.jsx)(Hn,{className:"lumiverse-type-selector-footer",children:(0,Ee.jsx)("button",{className:"lumiverse-btn lumiverse-btn--secondary",onClick:i,type:"button",style:{marginRight:"auto"},children:"Back"})})]})},jp=Sn("heart",[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]]);function Cp(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function Sp(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Cp(Object(t),!0).forEach(function(n){Np(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Cp(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Np(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const Ep=Ye,Pp=[],Dp=()=>Ep.getState().councilMembers||Pp;function Mp(e,n){return e?e.lumiaItems&&e.lumiaItems.length>0?e.lumiaItems.find(e=>e.lumiaName===n||e.lumiaDefName===n):e.items?e.items.find(e=>e.lumiaDefName===n):null:null}function Op(e,n){if(!e)return null;const t={name:["lumiaName","lumiaDefName"],def:["lumiaDefinition","lumiaDef"],img:["avatarUrl","lumia_img"]}[n];if(!t)return null;for(const n of t)if(void 0!==e[n]&&null!==e[n])return e[n];return null}const Tp=(0,Ce.memo)(function(e){let{item:n,packName:t,onAdd:r,animationIndex:i}=e;const o=Op(n,"img"),a=Op(n,"name")||"Unknown",[s,l]=(0,Ce.useState)(!1),c="undefined"!=typeof window&&window.innerWidth<=600?0:i<10?20*i:0,u=(0,Ce.useCallback)(e=>{e.stopPropagation(),e.preventDefault(),r({packName:t,itemName:a})},[r,t,a]),d=(0,Ce.useCallback)(()=>l(!0),[]);return(0,Ee.jsxs)("div",{className:"lumiverse-council-select-card lumia-card-appear",style:c?{animationDelay:"".concat(c,"ms")}:void 0,onPointerUp:u,role:"button",tabIndex:0,children:[(0,Ee.jsxs)("div",{className:"lumiverse-council-select-card-image",children:[o&&!s?(0,Ee.jsx)("img",{src:o,alt:a,loading:"lazy",className:"lumia-img-loaded",onError:d}):(0,Ee.jsx)("div",{className:"lumiverse-council-select-card-placeholder",children:(0,Ee.jsx)(Ad,{size:24,strokeWidth:1.5})}),(0,Ee.jsx)("div",{className:"lumiverse-council-select-card-add",children:(0,Ee.jsx)(dr,{size:16,strokeWidth:2})})]}),(0,Ee.jsxs)("div",{className:"lumiverse-council-select-card-info",children:[(0,Ee.jsx)("span",{className:"lumiverse-council-select-card-name",children:a}),(0,Ee.jsx)("span",{className:"lumiverse-council-select-card-pack",children:t})]})]})}),Ap=(0,Ce.memo)(function(e){var n,t;let{member:r,packs:i,onRemove:o,onUpdateRole:a}=e;const[s,l]=(0,Ce.useState)(!1),[c,u]=(0,Ce.useState)(r.role||""),d=function(e,n,t){const r=(Array.isArray(e)?e.reduce((e,n)=>Sp(Sp({},e),{},{[n.name||n.packName]:n}),{}):e)[n];if(!r)return t;const i=Mp(r,t);return(null==i?void 0:i.lumiaName)||(null==i?void 0:i.lumiaDefName)||t}(i,r.packName,r.itemName),m=function(e,n,t){const r=(Array.isArray(e)?e.reduce((e,n)=>Sp(Sp({},e),{},{[n.name||n.packName]:n}),{}):e)[n];if(!r)return null;const i=Mp(r,t);return(null==i?void 0:i.avatarUrl)||(null==i?void 0:i.lumia_img)||null}(i,r.packName,r.itemName),p=(0,Ce.useCallback)(()=>{a(r.id,{role:c}),l(!1)},[r.id,c,a]),g=(0,Ce.useCallback)(e=>{"Enter"===e.key&&p(),"Escape"===e.key&&(u(r.role||""),l(!1))},[p,r.role]),h=(0,Ce.useCallback)(e=>{e.stopPropagation(),e.preventDefault(),o(r.id)},[r.id,o]),v=(null===(n=r.behaviors)||void 0===n?void 0:n.length)||0,f=(null===(t=r.personalities)||void 0===t?void 0:t.length)||0;return(0,Ee.jsxs)("div",{className:"lumiverse-council-member-card",children:[(0,Ee.jsx)("div",{className:"lumiverse-council-member-card-avatar",children:m?(0,Ee.jsx)("img",{src:m,alt:d}):(0,Ee.jsx)(Ad,{size:20,strokeWidth:1.5})}),(0,Ee.jsxs)("div",{className:"lumiverse-council-member-card-content",children:[(0,Ee.jsx)("span",{className:"lumiverse-council-member-card-name",children:d}),s?(0,Ee.jsxs)("div",{className:"lumiverse-council-member-role-edit",children:[(0,Ee.jsx)("input",{type:"text",className:"lumiverse-council-input-sm",placeholder:"Role/title...",value:c,onChange:e=>u(e.target.value),onKeyDown:g,autoFocus:!0}),(0,Ee.jsx)("button",{className:"lumiverse-council-btn-sm lumiverse-council-btn-sm--primary",onPointerUp:e=>{e.stopPropagation(),e.preventDefault(),p()},type:"button",children:(0,Ee.jsx)(zd,{size:12,strokeWidth:2})}),(0,Ee.jsx)("button",{className:"lumiverse-council-btn-sm",onPointerUp:e=>{e.stopPropagation(),e.preventDefault(),u(r.role||""),l(!1)},type:"button",children:(0,Ee.jsx)(mt,{size:12,strokeWidth:2})})]}):(0,Ee.jsxs)("div",{className:"lumiverse-council-member-card-meta",children:[r.role?(0,Ee.jsx)("span",{className:"lumiverse-council-member-card-role",onPointerUp:e=>{e.stopPropagation(),e.preventDefault(),l(!0)},title:"Tap to edit role",children:r.role}):(0,Ee.jsxs)("button",{className:"lumiverse-council-add-role-btn",onPointerUp:e=>{e.stopPropagation(),e.preventDefault(),l(!0)},type:"button",children:[(0,Ee.jsx)(En,{size:10})," Add role"]}),(0,Ee.jsxs)("span",{className:"lumiverse-council-member-card-stats",children:[(0,Ee.jsxs)("span",{title:"Behaviors",children:[(0,Ee.jsx)(ut,{size:10})," ",v]}),(0,Ee.jsxs)("span",{title:"Personalities",children:[(0,Ee.jsx)(jp,{size:10})," ",f]})]})]})]}),(0,Ee.jsx)("button",{className:"lumiverse-council-btn-sm lumiverse-council-btn-sm--danger",onPointerUp:h,title:"Remove from council",type:"button",children:(0,Ee.jsx)(Pn,{size:14,strokeWidth:1.5})})]})});function Lp(){return(0,Ee.jsxs)("div",{className:"lumiverse-council-select-empty",children:[(0,Ee.jsx)(Ad,{size:24,strokeWidth:1.5}),(0,Ee.jsx)("span",{children:"No council members yet"}),(0,Ee.jsx)("p",{children:"Select Lumias from below to add them to your council."})]})}function zp(e){let{hasSearch:n}=e;return(0,Ee.jsx)("div",{className:"lumiverse-council-select-empty lumiverse-council-select-empty--muted",children:n?(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsx)(Am,{size:24,strokeWidth:1.5}),(0,Ee.jsx)("span",{children:"No matching Lumias"}),(0,Ee.jsx)("p",{children:"Try a different search term."})]}):(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsx)(Ad,{size:24,strokeWidth:1.5}),(0,Ee.jsx)("span",{children:"No Lumias available"}),(0,Ee.jsx)("p",{children:"All Lumias are already in the council, or no packs are loaded."})]})})}const Ip=function(e){let{onClose:n}=e;const t=Xe(),{allPacks:r}=vn(),[i,o]=(0,Ce.useState)(""),[a,s]=(0,Ce.useState)(20),l=(0,Ce.useSyncExternalStore)(Ep.subscribe,Dp,Dp),c=(0,Ce.useMemo)(()=>Array.isArray(r)?r.reduce((e,n)=>Sp(Sp({},e),{},{[n.name||n.packName]:n}),{}):r||{},[r]),u=(0,Ce.useMemo)(()=>{const e=new Set(l.map(e=>"".concat(e.packName,":").concat(e.itemName))),n=[];if((Array.isArray(r)?r:Object.values(r||{})).forEach(t=>{const r=t.name||t.packName;t.lumiaItems&&t.lumiaItems.length>0?t.lumiaItems.forEach(t=>{const i=t.lumiaName||t.lumiaDefName,o=t.lumiaDefinition||t.lumiaDef;if(!i||!o)return;const a="".concat(r,":").concat(i);e.has(a)||n.push({packName:r,item:t})}):t.items&&t.items.forEach(t=>{if(!t.lumiaDefName||!t.lumiaDef)return;const i="".concat(r,":").concat(t.lumiaDefName);e.has(i)||n.push({packName:r,item:t})})}),i.trim()){const e=i.toLowerCase();return n.filter(n=>{let{item:t,packName:r}=n;return(Op(t,"name")||"").toLowerCase().includes(e)||r.toLowerCase().includes(e)})}return n},[r,l,i]),d=(0,Ce.useCallback)(e=>{t.addCouncilMember(e),$e()},[t]),m=(0,Ce.useCallback)(e=>{t.removeCouncilMember(e),$e()},[t]),p=(0,Ce.useCallback)((e,n)=>{t.updateCouncilMember(e,n),qe()},[t]);return(0,Ee.jsxs)("div",{className:"lumiverse-council-select-modal",children:[(0,Ee.jsxs)("div",{className:"lumiverse-council-select-header",children:[(0,Ee.jsx)("div",{className:"lumiverse-council-select-header-icon",children:(0,Ee.jsx)(Ad,{size:20,strokeWidth:1.5})}),(0,Ee.jsxs)("div",{className:"lumiverse-council-select-header-text",children:[(0,Ee.jsx)("h3",{children:"Configure Council"}),(0,Ee.jsx)("p",{children:"Select Lumias to join your council of independent characters."})]})]}),(0,Ee.jsxs)("div",{className:"lumiverse-council-select-section",children:[(0,Ee.jsxs)("div",{className:"lumiverse-council-select-section-header",children:[(0,Ee.jsx)("span",{children:"Council Members"}),(0,Ee.jsx)("span",{className:"lumiverse-council-select-count",children:l.length})]}),(0,Ee.jsx)("div",{className:"lumiverse-council-select-members",children:0===l.length?(0,Ee.jsx)(Lp,{}):(0,Ee.jsx)("div",{className:"lumiverse-council-member-list",children:l.map(e=>(0,Ee.jsx)(Ap,{member:e,packs:c,onRemove:m,onUpdateRole:p},e.id))})})]}),(0,Ee.jsxs)("div",{className:"lumiverse-council-select-section lumiverse-council-select-section--available",children:[(0,Ee.jsxs)("div",{className:"lumiverse-council-select-section-header",children:[(0,Ee.jsx)("span",{children:"Add Lumias"}),(0,Ee.jsxs)("div",{className:"lumiverse-council-search-wrapper",children:[(0,Ee.jsx)(Am,{size:14,strokeWidth:1.5}),(0,Ee.jsx)("input",{type:"text",className:"lumiverse-council-search-input",placeholder:"Search...",value:i,onChange:e=>o(e.target.value)}),i&&(0,Ee.jsx)("button",{className:"lumiverse-council-search-clear",onClick:()=>o(""),type:"button",children:(0,Ee.jsx)(mt,{size:12,strokeWidth:2})})]})]}),(0,Ee.jsx)("div",{className:"lumiverse-council-select-grid-wrapper",children:0===u.length?(0,Ee.jsx)(zp,{hasSearch:!!i.trim()}):(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsx)("div",{className:"lumiverse-council-select-grid",children:u.slice(0,a).map((e,n)=>{let{item:t,packName:r}=e;return(0,Ee.jsx)(Tp,{item:t,packName:r,onAdd:d,animationIndex:n},"".concat(r,":").concat(Op(t,"name")))})}),u.length>a&&(0,Ee.jsxs)("button",{className:"lumiverse-council-show-more",onClick:()=>s(e=>e+20),type:"button",children:["Show more (",u.length-a," remaining)"]})]})})]}),(0,Ee.jsx)("div",{className:"lumiverse-council-select-footer",children:(0,Ee.jsx)("button",{className:"lumia-modal-btn lumia-modal-btn-primary",onClick:n,type:"button",children:"Done"})})]})};const Rp="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement;function Bp(e){const n=Object.prototype.toString.call(e);return"[object Window]"===n||"[object global]"===n}function _p(e){return"nodeType"in e}function Fp(e){var n,t;return e?Bp(e)?e:_p(e)&&null!=(n=null==(t=e.ownerDocument)?void 0:t.defaultView)?n:window:window}function Up(e){const{Document:n}=Fp(e);return e instanceof n}function Hp(e){return!Bp(e)&&e instanceof Fp(e).HTMLElement}function Wp(e){return e instanceof Fp(e).SVGElement}function Vp(e){return e?Bp(e)?e.document:_p(e)?Up(e)?e:Hp(e)||Wp(e)?e.ownerDocument:document:document:document}const qp=Rp?Ce.useLayoutEffect:Ce.useEffect;function $p(e){const n=(0,Ce.useRef)(e);return qp(()=>{n.current=e}),(0,Ce.useCallback)(function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return null==n.current?void 0:n.current(...t)},[])}function Yp(e,n){void 0===n&&(n=[e]);const t=(0,Ce.useRef)(e);return qp(()=>{t.current!==e&&(t.current=e)},n),t}function Gp(e,n){const t=(0,Ce.useRef)();return(0,Ce.useMemo)(()=>{const n=e(t.current);return t.current=n,n},[...n])}function Kp(e){const n=$p(e),t=(0,Ce.useRef)(null),r=(0,Ce.useCallback)(e=>{e!==t.current&&(null==n||n(e,t.current)),t.current=e},[]);return[t,r]}function Qp(e){const n=(0,Ce.useRef)();return(0,Ce.useEffect)(()=>{n.current=e},[e]),n.current}let Xp={};function Zp(e,n){return(0,Ce.useMemo)(()=>{if(n)return n;const t=null==Xp[e]?0:Xp[e]+1;return Xp[e]=t,e+"-"+t},[e,n])}function Jp(e){return function(n){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return r.reduce((n,t)=>{const r=Object.entries(t);for(const[t,i]of r){const r=n[t];null!=r&&(n[t]=r+e*i)}return n},{...n})}}const eg=Jp(1),ng=Jp(-1);function tg(e){if(!e)return!1;const{KeyboardEvent:n}=Fp(e.target);return n&&e instanceof n}function rg(e){if(function(e){if(!e)return!1;const{TouchEvent:n}=Fp(e.target);return n&&e instanceof n}(e)){if(e.touches&&e.touches.length){const{clientX:n,clientY:t}=e.touches[0];return{x:n,y:t}}if(e.changedTouches&&e.changedTouches.length){const{clientX:n,clientY:t}=e.changedTouches[0];return{x:n,y:t}}}return function(e){return"clientX"in e&&"clientY"in e}(e)?{x:e.clientX,y:e.clientY}:null}const ig=Object.freeze({Translate:{toString(e){if(!e)return;const{x:n,y:t}=e;return"translate3d("+(n?Math.round(n):0)+"px, "+(t?Math.round(t):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;const{scaleX:n,scaleY:t}=e;return"scaleX("+n+") scaleY("+t+")"}},Transform:{toString(e){if(e)return[ig.Translate.toString(e),ig.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:n,duration:t,easing:r}=e;return n+" "+t+"ms "+r}}}),og="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function ag(e){return e.matches(og)?e:e.querySelector(og)}const sg={display:"none"};function lg(e){let{id:n,value:t}=e;return Ce.createElement("div",{id:n,style:sg},t)}function cg(e){let{id:n,announcement:t,ariaLiveType:r="assertive"}=e;return Ce.createElement("div",{id:n,style:{position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"},role:"status","aria-live":r,"aria-atomic":!0},t)}const ug=(0,Ce.createContext)(null);const dg={draggable:"\n    To pick up a draggable item, press the space bar.\n    While dragging, use the arrow keys to move the item.\n    Press space again to drop the item in its new position, or press escape to cancel.\n  "},mg={onDragStart(e){let{active:n}=e;return"Picked up draggable item "+n.id+"."},onDragOver(e){let{active:n,over:t}=e;return t?"Draggable item "+n.id+" was moved over droppable area "+t.id+".":"Draggable item "+n.id+" is no longer over a droppable area."},onDragEnd(e){let{active:n,over:t}=e;return t?"Draggable item "+n.id+" was dropped over droppable area "+t.id:"Draggable item "+n.id+" was dropped."},onDragCancel(e){let{active:n}=e;return"Dragging was cancelled. Draggable item "+n.id+" was dropped."}};function pg(e){let{announcements:n=mg,container:t,hiddenTextDescribedById:r,screenReaderInstructions:i=dg}=e;const{announce:o,announcement:a}=function(){const[e,n]=(0,Ce.useState)("");return{announce:(0,Ce.useCallback)(e=>{null!=e&&n(e)},[]),announcement:e}}(),s=Zp("DndLiveRegion"),[l,c]=(0,Ce.useState)(!1);if((0,Ce.useEffect)(()=>{c(!0)},[]),function(e){const n=(0,Ce.useContext)(ug);(0,Ce.useEffect)(()=>{if(!n)throw new Error("useDndMonitor must be used within a children of <DndContext>");return n(e)},[e,n])}((0,Ce.useMemo)(()=>({onDragStart(e){let{active:t}=e;o(n.onDragStart({active:t}))},onDragMove(e){let{active:t,over:r}=e;n.onDragMove&&o(n.onDragMove({active:t,over:r}))},onDragOver(e){let{active:t,over:r}=e;o(n.onDragOver({active:t,over:r}))},onDragEnd(e){let{active:t,over:r}=e;o(n.onDragEnd({active:t,over:r}))},onDragCancel(e){let{active:t,over:r}=e;o(n.onDragCancel({active:t,over:r}))}}),[o,n])),!l)return null;const u=Ce.createElement(Ce.Fragment,null,Ce.createElement(lg,{id:r,value:i.draggable}),Ce.createElement(cg,{id:s,announcement:a}));return t?(0,ot.createPortal)(u,t):u}var gg;function hg(){}function vg(e,n){return(0,Ce.useMemo)(()=>({sensor:e,options:null!=n?n:{}}),[e,n])}!function(e){e.DragStart="dragStart",e.DragMove="dragMove",e.DragEnd="dragEnd",e.DragCancel="dragCancel",e.DragOver="dragOver",e.RegisterDroppable="registerDroppable",e.SetDroppableDisabled="setDroppableDisabled",e.UnregisterDroppable="unregisterDroppable"}(gg||(gg={}));const fg=Object.freeze({x:0,y:0});function bg(e,n){return Math.sqrt(Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2))}function xg(e,n){const t=rg(e);if(!t)return"0 0";return(t.x-n.left)/n.width*100+"% "+(t.y-n.top)/n.height*100+"%"}function yg(e,n){let{data:{value:t}}=e,{data:{value:r}}=n;return t-r}function kg(e,n){let{data:{value:t}}=e,{data:{value:r}}=n;return r-t}function wg(e){let{left:n,top:t,height:r,width:i}=e;return[{x:n,y:t},{x:n+i,y:t},{x:n,y:t+r},{x:n+i,y:t+r}]}function jg(e,n){if(!e||0===e.length)return null;const[t]=e;return n?t[n]:t}function Cg(e,n,t){return void 0===n&&(n=e.left),void 0===t&&(t=e.top),{x:n+.5*e.width,y:t+.5*e.height}}const Sg=e=>{let{collisionRect:n,droppableRects:t,droppableContainers:r}=e;const i=Cg(n,n.left,n.top),o=[];for(const e of r){const{id:n}=e,r=t.get(n);if(r){const t=bg(Cg(r),i);o.push({id:n,data:{droppableContainer:e,value:t}})}}return o.sort(yg)};function Ng(e,n){const t=Math.max(n.top,e.top),r=Math.max(n.left,e.left),i=Math.min(n.left+n.width,e.left+e.width),o=Math.min(n.top+n.height,e.top+e.height),a=i-r,s=o-t;if(r<i&&t<o){const t=n.width*n.height,r=e.width*e.height,i=a*s;return Number((i/(t+r-i)).toFixed(4))}return 0}const Eg=e=>{let{collisionRect:n,droppableRects:t,droppableContainers:r}=e;const i=[];for(const e of r){const{id:r}=e,o=t.get(r);if(o){const t=Ng(o,n);t>0&&i.push({id:r,data:{droppableContainer:e,value:t}})}}return i.sort(kg)};function Pg(e,n){return e&&n?{x:e.left-n.left,y:e.top-n.top}:fg}function Dg(e){return function(n){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return r.reduce((n,t)=>({...n,top:n.top+e*t.y,bottom:n.bottom+e*t.y,left:n.left+e*t.x,right:n.right+e*t.x}),{...n})}}const Mg=Dg(1);function Og(e){if(e.startsWith("matrix3d(")){const n=e.slice(9,-1).split(/, /);return{x:+n[12],y:+n[13],scaleX:+n[0],scaleY:+n[5]}}if(e.startsWith("matrix(")){const n=e.slice(7,-1).split(/, /);return{x:+n[4],y:+n[5],scaleX:+n[0],scaleY:+n[3]}}return null}const Tg={ignoreTransform:!1};function Ag(e,n){void 0===n&&(n=Tg);let t=e.getBoundingClientRect();if(n.ignoreTransform){const{transform:n,transformOrigin:r}=Fp(e).getComputedStyle(e);n&&(t=function(e,n,t){const r=Og(n);if(!r)return e;const{scaleX:i,scaleY:o,x:a,y:s}=r,l=e.left-a-(1-i)*parseFloat(t),c=e.top-s-(1-o)*parseFloat(t.slice(t.indexOf(" ")+1)),u=i?e.width/i:e.width,d=o?e.height/o:e.height;return{width:u,height:d,top:c,right:l+u,bottom:c+d,left:l}}(t,n,r))}const{top:r,left:i,width:o,height:a,bottom:s,right:l}=t;return{top:r,left:i,width:o,height:a,bottom:s,right:l}}function Lg(e){return Ag(e,{ignoreTransform:!0})}function zg(e,n){const t=[];return e?function r(i){if(null!=n&&t.length>=n)return t;if(!i)return t;if(Up(i)&&null!=i.scrollingElement&&!t.includes(i.scrollingElement))return t.push(i.scrollingElement),t;if(!Hp(i)||Wp(i))return t;if(t.includes(i))return t;const o=Fp(e).getComputedStyle(i);return i!==e&&function(e,n){void 0===n&&(n=Fp(e).getComputedStyle(e));const t=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(e=>{const r=n[e];return"string"==typeof r&&t.test(r)})}(i,o)&&t.push(i),function(e,n){return void 0===n&&(n=Fp(e).getComputedStyle(e)),"fixed"===n.position}(i,o)?t:r(i.parentNode)}(e):t}function Ig(e){const[n]=zg(e,1);return null!=n?n:null}function Rg(e){return Rp&&e?Bp(e)?e:_p(e)?Up(e)||e===Vp(e).scrollingElement?window:Hp(e)?e:null:null:null}function Bg(e){return Bp(e)?e.scrollX:e.scrollLeft}function _g(e){return Bp(e)?e.scrollY:e.scrollTop}function Fg(e){return{x:Bg(e),y:_g(e)}}var Ug;function Hg(e){return!(!Rp||!e)&&e===document.scrollingElement}function Wg(e){const n={x:0,y:0},t=Hg(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},r={x:e.scrollWidth-t.width,y:e.scrollHeight-t.height};return{isTop:e.scrollTop<=n.y,isLeft:e.scrollLeft<=n.x,isBottom:e.scrollTop>=r.y,isRight:e.scrollLeft>=r.x,maxScroll:r,minScroll:n}}!function(e){e[e.Forward=1]="Forward",e[e.Backward=-1]="Backward"}(Ug||(Ug={}));const Vg={x:.2,y:.2};function qg(e,n,t,r,i){let{top:o,left:a,right:s,bottom:l}=t;void 0===r&&(r=10),void 0===i&&(i=Vg);const{isTop:c,isBottom:u,isLeft:d,isRight:m}=Wg(e),p={x:0,y:0},g={x:0,y:0},h=n.height*i.y,v=n.width*i.x;return!c&&o<=n.top+h?(p.y=Ug.Backward,g.y=r*Math.abs((n.top+h-o)/h)):!u&&l>=n.bottom-h&&(p.y=Ug.Forward,g.y=r*Math.abs((n.bottom-h-l)/h)),!m&&s>=n.right-v?(p.x=Ug.Forward,g.x=r*Math.abs((n.right-v-s)/v)):!d&&a<=n.left+v&&(p.x=Ug.Backward,g.x=r*Math.abs((n.left+v-a)/v)),{direction:p,speed:g}}function $g(e){if(e===document.scrollingElement){const{innerWidth:e,innerHeight:n}=window;return{top:0,left:0,right:e,bottom:n,width:e,height:n}}const{top:n,left:t,right:r,bottom:i}=e.getBoundingClientRect();return{top:n,left:t,right:r,bottom:i,width:e.clientWidth,height:e.clientHeight}}function Yg(e){return e.reduce((e,n)=>eg(e,Fg(n)),fg)}function Gg(e,n){if(void 0===n&&(n=Ag),!e)return;const{top:t,left:r,bottom:i,right:o}=n(e);Ig(e)&&(i<=0||o<=0||t>=window.innerHeight||r>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}const Kg=[["x",["left","right"],function(e){return e.reduce((e,n)=>e+Bg(n),0)}],["y",["top","bottom"],function(e){return e.reduce((e,n)=>e+_g(n),0)}]];class Qg{constructor(e,n){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const t=zg(n),r=Yg(t);this.rect={...e},this.width=e.width,this.height=e.height;for(const[e,n,i]of Kg)for(const o of n)Object.defineProperty(this,o,{get:()=>{const n=i(t),a=r[e]-n;return this.rect[o]+a},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class Xg{constructor(e){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(e=>{var n;return null==(n=this.target)?void 0:n.removeEventListener(...e)})},this.target=e}add(e,n,t){var r;null==(r=this.target)||r.addEventListener(e,n,t),this.listeners.push([e,n,t])}}function Zg(e,n){const t=Math.abs(e.x),r=Math.abs(e.y);return"number"==typeof n?Math.sqrt(t**2+r**2)>n:"x"in n&&"y"in n?t>n.x&&r>n.y:"x"in n?t>n.x:"y"in n&&r>n.y}var Jg,eh;function nh(e){e.preventDefault()}function th(e){e.stopPropagation()}!function(e){e.Click="click",e.DragStart="dragstart",e.Keydown="keydown",e.ContextMenu="contextmenu",e.Resize="resize",e.SelectionChange="selectionchange",e.VisibilityChange="visibilitychange"}(Jg||(Jg={})),function(e){e.Space="Space",e.Down="ArrowDown",e.Right="ArrowRight",e.Left="ArrowLeft",e.Up="ArrowUp",e.Esc="Escape",e.Enter="Enter",e.Tab="Tab"}(eh||(eh={}));const rh={start:[eh.Space,eh.Enter],cancel:[eh.Esc],end:[eh.Space,eh.Enter,eh.Tab]},ih=(e,n)=>{let{currentCoordinates:t}=n;switch(e.code){case eh.Right:return{...t,x:t.x+25};case eh.Left:return{...t,x:t.x-25};case eh.Down:return{...t,y:t.y+25};case eh.Up:return{...t,y:t.y-25}}};class oh{constructor(e){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=e;const{event:{target:n}}=e;this.props=e,this.listeners=new Xg(Vp(n)),this.windowListeners=new Xg(Fp(n)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(Jg.Resize,this.handleCancel),this.windowListeners.add(Jg.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(Jg.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:e,onStart:n}=this.props,t=e.node.current;t&&Gg(t),n(fg)}handleKeyDown(e){if(tg(e)){const{active:n,context:t,options:r}=this.props,{keyboardCodes:i=rh,coordinateGetter:o=ih,scrollBehavior:a="smooth"}=r,{code:s}=e;if(i.end.includes(s))return void this.handleEnd(e);if(i.cancel.includes(s))return void this.handleCancel(e);const{collisionRect:l}=t.current,c=l?{x:l.left,y:l.top}:fg;this.referenceCoordinates||(this.referenceCoordinates=c);const u=o(e,{active:n,context:t.current,currentCoordinates:c});if(u){const n=ng(u,c),r={x:0,y:0},{scrollableAncestors:i}=t.current;for(const t of i){const i=e.code,{isTop:o,isRight:s,isLeft:l,isBottom:c,maxScroll:d,minScroll:m}=Wg(t),p=$g(t),g={x:Math.min(i===eh.Right?p.right-p.width/2:p.right,Math.max(i===eh.Right?p.left:p.left+p.width/2,u.x)),y:Math.min(i===eh.Down?p.bottom-p.height/2:p.bottom,Math.max(i===eh.Down?p.top:p.top+p.height/2,u.y))},h=i===eh.Right&&!s||i===eh.Left&&!l,v=i===eh.Down&&!c||i===eh.Up&&!o;if(h&&g.x!==u.x){const e=t.scrollLeft+n.x,o=i===eh.Right&&e<=d.x||i===eh.Left&&e>=m.x;if(o&&!n.y)return void t.scrollTo({left:e,behavior:a});r.x=o?t.scrollLeft-e:i===eh.Right?t.scrollLeft-d.x:t.scrollLeft-m.x,r.x&&t.scrollBy({left:-r.x,behavior:a});break}if(v&&g.y!==u.y){const e=t.scrollTop+n.y,o=i===eh.Down&&e<=d.y||i===eh.Up&&e>=m.y;if(o&&!n.x)return void t.scrollTo({top:e,behavior:a});r.y=o?t.scrollTop-e:i===eh.Down?t.scrollTop-d.y:t.scrollTop-m.y,r.y&&t.scrollBy({top:-r.y,behavior:a});break}}this.handleMove(e,eg(ng(u,this.referenceCoordinates),r))}}}handleMove(e,n){const{onMove:t}=this.props;e.preventDefault(),t(n)}handleEnd(e){const{onEnd:n}=this.props;e.preventDefault(),this.detach(),n()}handleCancel(e){const{onCancel:n}=this.props;e.preventDefault(),this.detach(),n()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}function ah(e){return Boolean(e&&"distance"in e)}function sh(e){return Boolean(e&&"delay"in e)}oh.activators=[{eventName:"onKeyDown",handler:(e,n,t)=>{let{keyboardCodes:r=rh,onActivation:i}=n,{active:o}=t;const{code:a}=e.nativeEvent;if(r.start.includes(a)){const n=o.activatorNode.current;return(!n||e.target===n)&&(e.preventDefault(),null==i||i({event:e.nativeEvent}),!0)}return!1}}];class lh{constructor(e,n,t){var r;void 0===t&&(t=function(e){const{EventTarget:n}=Fp(e);return e instanceof n?e:Vp(e)}(e.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=e,this.events=n;const{event:i}=e,{target:o}=i;this.props=e,this.events=n,this.document=Vp(o),this.documentListeners=new Xg(this.document),this.listeners=new Xg(t),this.windowListeners=new Xg(Fp(o)),this.initialCoordinates=null!=(r=rg(i))?r:fg,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:e,props:{options:{activationConstraint:n,bypassActivationConstraint:t}}}=this;if(this.listeners.add(e.move.name,this.handleMove,{passive:!1}),this.listeners.add(e.end.name,this.handleEnd),e.cancel&&this.listeners.add(e.cancel.name,this.handleCancel),this.windowListeners.add(Jg.Resize,this.handleCancel),this.windowListeners.add(Jg.DragStart,nh),this.windowListeners.add(Jg.VisibilityChange,this.handleCancel),this.windowListeners.add(Jg.ContextMenu,nh),this.documentListeners.add(Jg.Keydown,this.handleKeydown),n){if(null!=t&&t({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(sh(n))return this.timeoutId=setTimeout(this.handleStart,n.delay),void this.handlePending(n);if(ah(n))return void this.handlePending(n)}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),null!==this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(e,n){const{active:t,onPending:r}=this.props;r(t,e,this.initialCoordinates,n)}handleStart(){const{initialCoordinates:e}=this,{onStart:n}=this.props;e&&(this.activated=!0,this.documentListeners.add(Jg.Click,th,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(Jg.SelectionChange,this.removeTextSelection),n(e))}handleMove(e){var n;const{activated:t,initialCoordinates:r,props:i}=this,{onMove:o,options:{activationConstraint:a}}=i;if(!r)return;const s=null!=(n=rg(e))?n:fg,l=ng(r,s);if(!t&&a){if(ah(a)){if(null!=a.tolerance&&Zg(l,a.tolerance))return this.handleCancel();if(Zg(l,a.distance))return this.handleStart()}return sh(a)&&Zg(l,a.tolerance)?this.handleCancel():void this.handlePending(a,l)}e.cancelable&&e.preventDefault(),o(s)}handleEnd(){const{onAbort:e,onEnd:n}=this.props;this.detach(),this.activated||e(this.props.active),n()}handleCancel(){const{onAbort:e,onCancel:n}=this.props;this.detach(),this.activated||e(this.props.active),n()}handleKeydown(e){e.code===eh.Esc&&this.handleCancel()}removeTextSelection(){var e;null==(e=this.document.getSelection())||e.removeAllRanges()}}const ch={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class uh extends lh{constructor(e){const{event:n}=e,t=Vp(n.target);super(e,ch,t)}}uh.activators=[{eventName:"onPointerDown",handler:(e,n)=>{let{nativeEvent:t}=e,{onActivation:r}=n;return!(!t.isPrimary||0!==t.button)&&(null==r||r({event:t}),!0)}}];const dh={move:{name:"mousemove"},end:{name:"mouseup"}};var mh;!function(e){e[e.RightClick=2]="RightClick"}(mh||(mh={}));(class extends lh{constructor(e){super(e,dh,Vp(e.event.target))}}).activators=[{eventName:"onMouseDown",handler:(e,n)=>{let{nativeEvent:t}=e,{onActivation:r}=n;return t.button!==mh.RightClick&&(null==r||r({event:t}),!0)}}];const ph={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};var gh,hh;function vh(e){let{acceleration:n,activator:t=gh.Pointer,canScroll:r,draggingRect:i,enabled:o,interval:a=5,order:s=hh.TreeOrder,pointerCoordinates:l,scrollableAncestors:c,scrollableAncestorRects:u,delta:d,threshold:m}=e;const p=function(e){let{delta:n,disabled:t}=e;const r=Qp(n);return Gp(e=>{if(t||!r||!e)return fh;const i={x:Math.sign(n.x-r.x),y:Math.sign(n.y-r.y)};return{x:{[Ug.Backward]:e.x[Ug.Backward]||-1===i.x,[Ug.Forward]:e.x[Ug.Forward]||1===i.x},y:{[Ug.Backward]:e.y[Ug.Backward]||-1===i.y,[Ug.Forward]:e.y[Ug.Forward]||1===i.y}}},[t,n,r])}({delta:d,disabled:!o}),[g,h]=function(){const e=(0,Ce.useRef)(null);return[(0,Ce.useCallback)((n,t)=>{e.current=setInterval(n,t)},[]),(0,Ce.useCallback)(()=>{null!==e.current&&(clearInterval(e.current),e.current=null)},[])]}(),v=(0,Ce.useRef)({x:0,y:0}),f=(0,Ce.useRef)({x:0,y:0}),b=(0,Ce.useMemo)(()=>{switch(t){case gh.Pointer:return l?{top:l.y,bottom:l.y,left:l.x,right:l.x}:null;case gh.DraggableRect:return i}},[t,i,l]),x=(0,Ce.useRef)(null),y=(0,Ce.useCallback)(()=>{const e=x.current;if(!e)return;const n=v.current.x*f.current.x,t=v.current.y*f.current.y;e.scrollBy(n,t)},[]),k=(0,Ce.useMemo)(()=>s===hh.TreeOrder?[...c].reverse():c,[s,c]);(0,Ce.useEffect)(()=>{if(o&&c.length&&b){for(const e of k){if(!1===(null==r?void 0:r(e)))continue;const t=c.indexOf(e),i=u[t];if(!i)continue;const{direction:o,speed:s}=qg(e,i,b,n,m);for(const e of["x","y"])p[e][o[e]]||(s[e]=0,o[e]=0);if(s.x>0||s.y>0)return h(),x.current=e,g(y,a),v.current=s,void(f.current=o)}v.current={x:0,y:0},f.current={x:0,y:0},h()}else h()},[n,y,r,h,o,a,JSON.stringify(b),JSON.stringify(p),g,c,k,u,JSON.stringify(m)])}(class extends lh{constructor(e){super(e,ph)}static setup(){return window.addEventListener(ph.move.name,e,{capture:!1,passive:!1}),function(){window.removeEventListener(ph.move.name,e)};function e(){}}}).activators=[{eventName:"onTouchStart",handler:(e,n)=>{let{nativeEvent:t}=e,{onActivation:r}=n;const{touches:i}=t;return!(i.length>1)&&(null==r||r({event:t}),!0)}}],function(e){e[e.Pointer=0]="Pointer",e[e.DraggableRect=1]="DraggableRect"}(gh||(gh={})),function(e){e[e.TreeOrder=0]="TreeOrder",e[e.ReversedTreeOrder=1]="ReversedTreeOrder"}(hh||(hh={}));const fh={x:{[Ug.Backward]:!1,[Ug.Forward]:!1},y:{[Ug.Backward]:!1,[Ug.Forward]:!1}};var bh,xh;!function(e){e[e.Always=0]="Always",e[e.BeforeDragging=1]="BeforeDragging",e[e.WhileDragging=2]="WhileDragging"}(bh||(bh={})),function(e){e.Optimized="optimized"}(xh||(xh={}));const yh=new Map;function kh(e,n){return Gp(t=>e?t||("function"==typeof n?n(e):e):null,[n,e])}function wh(e){let{callback:n,disabled:t}=e;const r=$p(n),i=(0,Ce.useMemo)(()=>{if(t||"undefined"==typeof window||void 0===window.ResizeObserver)return;const{ResizeObserver:e}=window;return new e(r)},[t]);return(0,Ce.useEffect)(()=>()=>null==i?void 0:i.disconnect(),[i]),i}function jh(e){return new Qg(Ag(e),e)}function Ch(e,n,t){void 0===n&&(n=jh);const[r,i]=(0,Ce.useState)(null);function o(){i(r=>{if(!e)return null;var i;if(!1===e.isConnected)return null!=(i=null!=r?r:t)?i:null;const o=n(e);return JSON.stringify(r)===JSON.stringify(o)?r:o})}const a=function(e){let{callback:n,disabled:t}=e;const r=$p(n),i=(0,Ce.useMemo)(()=>{if(t||"undefined"==typeof window||void 0===window.MutationObserver)return;const{MutationObserver:e}=window;return new e(r)},[r,t]);return(0,Ce.useEffect)(()=>()=>null==i?void 0:i.disconnect(),[i]),i}({callback(n){if(e)for(const t of n){const{type:n,target:r}=t;if("childList"===n&&r instanceof HTMLElement&&r.contains(e)){o();break}}}}),s=wh({callback:o});return qp(()=>{o(),e?(null==s||s.observe(e),null==a||a.observe(document.body,{childList:!0,subtree:!0})):(null==s||s.disconnect(),null==a||a.disconnect())},[e]),r}const Sh=[];function Nh(e,n){void 0===n&&(n=[]);const t=(0,Ce.useRef)(null);return(0,Ce.useEffect)(()=>{t.current=null},n),(0,Ce.useEffect)(()=>{const n=e!==fg;n&&!t.current&&(t.current=e),!n&&t.current&&(t.current=null)},[e]),t.current?ng(e,t.current):fg}function Eh(e){return(0,Ce.useMemo)(()=>e?function(e){const n=e.innerWidth,t=e.innerHeight;return{top:0,left:0,right:n,bottom:t,width:n,height:t}}(e):null,[e])}const Ph=[];function Dh(e){if(!e)return null;if(e.children.length>1)return e;const n=e.children[0];return Hp(n)?n:e}const Mh=[{sensor:uh,options:{}},{sensor:oh,options:{}}],Oh={current:{}},Th={draggable:{measure:Lg},droppable:{measure:Lg,strategy:bh.WhileDragging,frequency:xh.Optimized},dragOverlay:{measure:Ag}};class Ah extends Map{get(e){var n;return null!=e&&null!=(n=super.get(e))?n:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(e=>{let{disabled:n}=e;return!n})}getNodeFor(e){var n,t;return null!=(n=null==(t=this.get(e))?void 0:t.node.current)?n:void 0}}const Lh={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new Ah,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:hg},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:Th,measureDroppableContainers:hg,windowRect:null,measuringScheduled:!1},zh={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:hg,draggableNodes:new Map,over:null,measureDroppableContainers:hg},Ih=(0,Ce.createContext)(zh),Rh=(0,Ce.createContext)(Lh);function Bh(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new Ah}}}function _h(e,n){switch(n.type){case gg.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:n.initialCoordinates,active:n.active}};case gg.DragMove:return null==e.draggable.active?e:{...e,draggable:{...e.draggable,translate:{x:n.coordinates.x-e.draggable.initialCoordinates.x,y:n.coordinates.y-e.draggable.initialCoordinates.y}}};case gg.DragEnd:case gg.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case gg.RegisterDroppable:{const{element:t}=n,{id:r}=t,i=new Ah(e.droppable.containers);return i.set(r,t),{...e,droppable:{...e.droppable,containers:i}}}case gg.SetDroppableDisabled:{const{id:t,key:r,disabled:i}=n,o=e.droppable.containers.get(t);if(!o||r!==o.key)return e;const a=new Ah(e.droppable.containers);return a.set(t,{...o,disabled:i}),{...e,droppable:{...e.droppable,containers:a}}}case gg.UnregisterDroppable:{const{id:t,key:r}=n,i=e.droppable.containers.get(t);if(!i||r!==i.key)return e;const o=new Ah(e.droppable.containers);return o.delete(t),{...e,droppable:{...e.droppable,containers:o}}}default:return e}}function Fh(e){let{disabled:n}=e;const{active:t,activatorEvent:r,draggableNodes:i}=(0,Ce.useContext)(Ih),o=Qp(r),a=Qp(null==t?void 0:t.id);return(0,Ce.useEffect)(()=>{if(!n&&!r&&o&&null!=a){if(!tg(o))return;if(document.activeElement===o.target)return;const e=i.get(a);if(!e)return;const{activatorNode:n,node:t}=e;if(!n.current&&!t.current)return;requestAnimationFrame(()=>{for(const e of[n.current,t.current]){if(!e)continue;const n=ag(e);if(n){n.focus();break}}})}},[r,n,i,a,o]),null}function Uh(e,n){let{transform:t,...r}=n;return null!=e&&e.length?e.reduce((e,n)=>n({transform:e,...r}),t):t}const Hh=(0,Ce.createContext)({...fg,scaleX:1,scaleY:1});var Wh;!function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initializing=1]="Initializing",e[e.Initialized=2]="Initialized"}(Wh||(Wh={}));const Vh=(0,Ce.memo)(function(e){var n,t,r,i;let{id:o,accessibility:a,autoScroll:s=!0,children:l,sensors:c=Mh,collisionDetection:u=Eg,measuring:d,modifiers:m,...p}=e;const g=(0,Ce.useReducer)(_h,void 0,Bh),[h,v]=g,[f,b]=function(){const[e]=(0,Ce.useState)(()=>new Set),n=(0,Ce.useCallback)(n=>(e.add(n),()=>e.delete(n)),[e]);return[(0,Ce.useCallback)(n=>{let{type:t,event:r}=n;e.forEach(e=>{var n;return null==(n=e[t])?void 0:n.call(e,r)})},[e]),n]}(),[x,y]=(0,Ce.useState)(Wh.Uninitialized),k=x===Wh.Initialized,{draggable:{active:w,nodes:j,translate:C},droppable:{containers:S}}=h,N=null!=w?j.get(w):null,E=(0,Ce.useRef)({initial:null,translated:null}),P=(0,Ce.useMemo)(()=>{var e;return null!=w?{id:w,data:null!=(e=null==N?void 0:N.data)?e:Oh,rect:E}:null},[w,N]),D=(0,Ce.useRef)(null),[M,O]=(0,Ce.useState)(null),[T,A]=(0,Ce.useState)(null),L=Yp(p,Object.values(p)),z=Zp("DndDescribedBy",o),I=(0,Ce.useMemo)(()=>S.getEnabled(),[S]),R=(B=d,(0,Ce.useMemo)(()=>({draggable:{...Th.draggable,...null==B?void 0:B.draggable},droppable:{...Th.droppable,...null==B?void 0:B.droppable},dragOverlay:{...Th.dragOverlay,...null==B?void 0:B.dragOverlay}}),[null==B?void 0:B.draggable,null==B?void 0:B.droppable,null==B?void 0:B.dragOverlay]));var B;const{droppableRects:_,measureDroppableContainers:F,measuringScheduled:U}=function(e,n){let{dragging:t,dependencies:r,config:i}=n;const[o,a]=(0,Ce.useState)(null),{frequency:s,measure:l,strategy:c}=i,u=(0,Ce.useRef)(e),d=function(){switch(c){case bh.Always:return!1;case bh.BeforeDragging:return t;default:return!t}}(),m=Yp(d),p=(0,Ce.useCallback)(function(e){void 0===e&&(e=[]),m.current||a(n=>null===n?e:n.concat(e.filter(e=>!n.includes(e))))},[m]),g=(0,Ce.useRef)(null),h=Gp(n=>{if(d&&!t)return yh;if(!n||n===yh||u.current!==e||null!=o){const n=new Map;for(let t of e){if(!t)continue;if(o&&o.length>0&&!o.includes(t.id)&&t.rect.current){n.set(t.id,t.rect.current);continue}const e=t.node.current,r=e?new Qg(l(e),e):null;t.rect.current=r,r&&n.set(t.id,r)}return n}return n},[e,o,t,d,l]);return(0,Ce.useEffect)(()=>{u.current=e},[e]),(0,Ce.useEffect)(()=>{d||p()},[t,d]),(0,Ce.useEffect)(()=>{o&&o.length>0&&a(null)},[JSON.stringify(o)]),(0,Ce.useEffect)(()=>{d||"number"!=typeof s||null!==g.current||(g.current=setTimeout(()=>{p(),g.current=null},s))},[s,d,p,...r]),{droppableRects:h,measureDroppableContainers:p,measuringScheduled:null!=o}}(I,{dragging:k,dependencies:[C.x,C.y],config:R.droppable}),H=function(e,n){const t=null!=n?e.get(n):void 0,r=t?t.node.current:null;return Gp(e=>{var t;return null==n?null:null!=(t=null!=r?r:e)?t:null},[r,n])}(j,w),W=(0,Ce.useMemo)(()=>T?rg(T):null,[T]),V=function(){const e=!1===(null==M?void 0:M.autoScrollEnabled),n="object"==typeof s?!1===s.enabled:!1===s,t=k&&!e&&!n;if("object"==typeof s)return{...s,enabled:t};return{enabled:t}}(),q=function(e,n){return kh(e,n)}(H,R.draggable.measure);!function(e){let{activeNode:n,measure:t,initialRect:r,config:i=!0}=e;const o=(0,Ce.useRef)(!1),{x:a,y:s}="boolean"==typeof i?{x:i,y:i}:i;qp(()=>{if(!a&&!s||!n)return void(o.current=!1);if(o.current||!r)return;const e=null==n?void 0:n.node.current;if(!e||!1===e.isConnected)return;const i=Pg(t(e),r);if(a||(i.x=0),s||(i.y=0),o.current=!0,Math.abs(i.x)>0||Math.abs(i.y)>0){const n=Ig(e);n&&n.scrollBy({top:i.y,left:i.x})}},[n,a,s,r,t])}({activeNode:null!=w?j.get(w):null,config:V.layoutShiftCompensation,initialRect:q,measure:R.draggable.measure});const $=Ch(H,R.draggable.measure,q),Y=Ch(H?H.parentElement:null),G=(0,Ce.useRef)({activatorEvent:null,active:null,activeNode:H,collisionRect:null,collisions:null,droppableRects:_,draggableNodes:j,draggingNode:null,draggingNodeRect:null,droppableContainers:S,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),K=S.getNodeFor(null==(n=G.current.over)?void 0:n.id),Q=function(e){let{measure:n}=e;const[t,r]=(0,Ce.useState)(null),i=wh({callback:(0,Ce.useCallback)(e=>{for(const{target:t}of e)if(Hp(t)){r(e=>{const r=n(t);return e?{...e,width:r.width,height:r.height}:r});break}},[n])}),o=(0,Ce.useCallback)(e=>{const t=Dh(e);null==i||i.disconnect(),t&&(null==i||i.observe(t)),r(t?n(t):null)},[n,i]),[a,s]=Kp(o);return(0,Ce.useMemo)(()=>({nodeRef:a,rect:t,setRef:s}),[t,a,s])}({measure:R.dragOverlay.measure}),X=null!=(t=Q.nodeRef.current)?t:H,Z=k?null!=(r=Q.rect)?r:$:null,J=Boolean(Q.nodeRef.current&&Q.rect),ee=Pg(ne=J?null:$,kh(ne));var ne;const te=Eh(X?Fp(X):null),re=function(e){const n=(0,Ce.useRef)(e),t=Gp(t=>e?t&&t!==Sh&&e&&n.current&&e.parentNode===n.current.parentNode?t:zg(e):Sh,[e]);return(0,Ce.useEffect)(()=>{n.current=e},[e]),t}(k?null!=K?K:H:null),ie=function(e,n){void 0===n&&(n=Ag);const[t]=e,r=Eh(t?Fp(t):null),[i,o]=(0,Ce.useState)(Ph);function a(){o(()=>e.length?e.map(e=>Hg(e)?r:new Qg(n(e),e)):Ph)}const s=wh({callback:a});return qp(()=>{null==s||s.disconnect(),a(),e.forEach(e=>null==s?void 0:s.observe(e))},[e]),i}(re),oe=Uh(m,{transform:{x:C.x-ee.x,y:C.y-ee.y,scaleX:1,scaleY:1},activatorEvent:T,active:P,activeNodeRect:$,containerNodeRect:Y,draggingNodeRect:Z,over:G.current.over,overlayNodeRect:Q.rect,scrollableAncestors:re,scrollableAncestorRects:ie,windowRect:te}),ae=W?eg(W,C):null,se=function(e){const[n,t]=(0,Ce.useState)(null),r=(0,Ce.useRef)(e),i=(0,Ce.useCallback)(e=>{const n=Rg(e.target);n&&t(e=>e?(e.set(n,Fg(n)),new Map(e)):null)},[]);return(0,Ce.useEffect)(()=>{const n=r.current;if(e!==n){o(n);const a=e.map(e=>{const n=Rg(e);return n?(n.addEventListener("scroll",i,{passive:!0}),[n,Fg(n)]):null}).filter(e=>null!=e);t(a.length?new Map(a):null),r.current=e}return()=>{o(e),o(n)};function o(e){e.forEach(e=>{const n=Rg(e);null==n||n.removeEventListener("scroll",i)})}},[i,e]),(0,Ce.useMemo)(()=>e.length?n?Array.from(n.values()).reduce((e,n)=>eg(e,n),fg):Yg(e):fg,[e,n])}(re),le=Nh(se),ce=Nh(se,[$]),ue=eg(oe,le),de=Z?Mg(Z,oe):null,me=P&&de?u({active:P,collisionRect:de,droppableRects:_,droppableContainers:I,pointerCoordinates:ae}):null,pe=jg(me,"id"),[ge,he]=(0,Ce.useState)(null),ve=function(e,n,t){return{...e,scaleX:n&&t?n.width/t.width:1,scaleY:n&&t?n.height/t.height:1}}(J?oe:eg(oe,ce),null!=(i=null==ge?void 0:ge.rect)?i:null,$),fe=(0,Ce.useRef)(null),be=(0,Ce.useCallback)((e,n)=>{let{sensor:t,options:r}=n;if(null==D.current)return;const i=j.get(D.current);if(!i)return;const o=e.nativeEvent,a=new t({active:D.current,activeNode:i,event:o,options:r,context:G,onAbort(e){if(!j.get(e))return;const{onDragAbort:n}=L.current,t={id:e};null==n||n(t),f({type:"onDragAbort",event:t})},onPending(e,n,t,r){if(!j.get(e))return;const{onDragPending:i}=L.current,o={id:e,constraint:n,initialCoordinates:t,offset:r};null==i||i(o),f({type:"onDragPending",event:o})},onStart(e){const n=D.current;if(null==n)return;const t=j.get(n);if(!t)return;const{onDragStart:r}=L.current,i={activatorEvent:o,active:{id:n,data:t.data,rect:E}};(0,ot.unstable_batchedUpdates)(()=>{null==r||r(i),y(Wh.Initializing),v({type:gg.DragStart,initialCoordinates:e,active:n}),f({type:"onDragStart",event:i}),O(fe.current),A(o)})},onMove(e){v({type:gg.DragMove,coordinates:e})},onEnd:s(gg.DragEnd),onCancel:s(gg.DragCancel)});function s(e){return async function(){const{active:n,collisions:t,over:r,scrollAdjustedTranslate:i}=G.current;let a=null;if(n&&i){const{cancelDrop:s}=L.current;if(a={activatorEvent:o,active:n,collisions:t,delta:i,over:r},e===gg.DragEnd&&"function"==typeof s){await Promise.resolve(s(a))&&(e=gg.DragCancel)}}D.current=null,(0,ot.unstable_batchedUpdates)(()=>{v({type:e}),y(Wh.Uninitialized),he(null),O(null),A(null),fe.current=null;const n=e===gg.DragEnd?"onDragEnd":"onDragCancel";if(a){const e=L.current[n];null==e||e(a),f({type:n,event:a})}})}}fe.current=a},[j]),xe=(0,Ce.useCallback)((e,n)=>(t,r)=>{const i=t.nativeEvent,o=j.get(r);if(null!==D.current||!o||i.dndKit||i.defaultPrevented)return;const a={active:o};!0===e(t,n.options,a)&&(i.dndKit={capturedBy:n.sensor},D.current=r,be(t,n))},[j,be]),ye=function(e,n){return(0,Ce.useMemo)(()=>e.reduce((e,t)=>{const{sensor:r}=t;return[...e,...r.activators.map(e=>({eventName:e.eventName,handler:n(e.handler,t)}))]},[]),[e,n])}(c,xe);!function(e){(0,Ce.useEffect)(()=>{if(!Rp)return;const n=e.map(e=>{let{sensor:n}=e;return null==n.setup?void 0:n.setup()});return()=>{for(const e of n)null==e||e()}},e.map(e=>{let{sensor:n}=e;return n}))}(c),qp(()=>{$&&x===Wh.Initializing&&y(Wh.Initialized)},[$,x]),(0,Ce.useEffect)(()=>{const{onDragMove:e}=L.current,{active:n,activatorEvent:t,collisions:r,over:i}=G.current;if(!n||!t)return;const o={active:n,activatorEvent:t,collisions:r,delta:{x:ue.x,y:ue.y},over:i};(0,ot.unstable_batchedUpdates)(()=>{null==e||e(o),f({type:"onDragMove",event:o})})},[ue.x,ue.y]),(0,Ce.useEffect)(()=>{const{active:e,activatorEvent:n,collisions:t,droppableContainers:r,scrollAdjustedTranslate:i}=G.current;if(!e||null==D.current||!n||!i)return;const{onDragOver:o}=L.current,a=r.get(pe),s=a&&a.rect.current?{id:a.id,rect:a.rect.current,data:a.data,disabled:a.disabled}:null,l={active:e,activatorEvent:n,collisions:t,delta:{x:i.x,y:i.y},over:s};(0,ot.unstable_batchedUpdates)(()=>{he(s),null==o||o(l),f({type:"onDragOver",event:l})})},[pe]),qp(()=>{G.current={activatorEvent:T,active:P,activeNode:H,collisionRect:de,collisions:me,droppableRects:_,draggableNodes:j,draggingNode:X,draggingNodeRect:Z,droppableContainers:S,over:ge,scrollableAncestors:re,scrollAdjustedTranslate:ue},E.current={initial:Z,translated:de}},[P,H,me,de,j,X,Z,_,S,ge,re,ue]),vh({...V,delta:C,draggingRect:de,pointerCoordinates:ae,scrollableAncestors:re,scrollableAncestorRects:ie});const ke=(0,Ce.useMemo)(()=>({active:P,activeNode:H,activeNodeRect:$,activatorEvent:T,collisions:me,containerNodeRect:Y,dragOverlay:Q,draggableNodes:j,droppableContainers:S,droppableRects:_,over:ge,measureDroppableContainers:F,scrollableAncestors:re,scrollableAncestorRects:ie,measuringConfiguration:R,measuringScheduled:U,windowRect:te}),[P,H,$,T,me,Y,Q,j,S,_,ge,F,re,ie,R,U,te]),we=(0,Ce.useMemo)(()=>({activatorEvent:T,activators:ye,active:P,activeNodeRect:$,ariaDescribedById:{draggable:z},dispatch:v,draggableNodes:j,over:ge,measureDroppableContainers:F}),[T,ye,P,$,v,z,j,ge,F]);return Ce.createElement(ug.Provider,{value:b},Ce.createElement(Ih.Provider,{value:we},Ce.createElement(Rh.Provider,{value:ke},Ce.createElement(Hh.Provider,{value:ve},l)),Ce.createElement(Fh,{disabled:!1===(null==a?void 0:a.restoreFocus)})),Ce.createElement(pg,{...a,hiddenTextDescribedById:z}))}),qh=(0,Ce.createContext)(null),$h="button";function Yh(e){let{id:n,data:t,disabled:r=!1,attributes:i}=e;const o=Zp("Draggable"),{activators:a,activatorEvent:s,active:l,activeNodeRect:c,ariaDescribedById:u,draggableNodes:d,over:m}=(0,Ce.useContext)(Ih),{role:p=$h,roleDescription:g="draggable",tabIndex:h=0}=null!=i?i:{},v=(null==l?void 0:l.id)===n,f=(0,Ce.useContext)(v?Hh:qh),[b,x]=Kp(),[y,k]=Kp(),w=function(e,n){return(0,Ce.useMemo)(()=>e.reduce((e,t)=>{let{eventName:r,handler:i}=t;return e[r]=e=>{i(e,n)},e},{}),[e,n])}(a,n),j=Yp(t);qp(()=>(d.set(n,{id:n,key:o,node:b,activatorNode:y,data:j}),()=>{const e=d.get(n);e&&e.key===o&&d.delete(n)}),[d,n]);return{active:l,activatorEvent:s,activeNodeRect:c,attributes:(0,Ce.useMemo)(()=>({role:p,tabIndex:h,"aria-disabled":r,"aria-pressed":!(!v||p!==$h)||void 0,"aria-roledescription":g,"aria-describedby":u.draggable}),[r,p,h,v,g,u.draggable]),isDragging:v,listeners:r?void 0:w,node:b,over:m,setNodeRef:x,setActivatorNodeRef:k,transform:f}}function Gh(){return(0,Ce.useContext)(Rh)}const Kh={timeout:25};function Qh(e){let{animation:n,children:t}=e;const[r,i]=(0,Ce.useState)(null),[o,a]=(0,Ce.useState)(null),s=Qp(t);return t||r||!s||i(s),qp(()=>{if(!o)return;const e=null==r?void 0:r.key,t=null==r?void 0:r.props.id;null!=e&&null!=t?Promise.resolve(n(t,o)).then(()=>{i(null)}):i(null)},[n,r,o]),Ce.createElement(Ce.Fragment,null,t,r?(0,Ce.cloneElement)(r,{ref:a}):null)}const Xh={x:0,y:0,scaleX:1,scaleY:1};function Zh(e){let{children:n}=e;return Ce.createElement(Ih.Provider,{value:zh},Ce.createElement(Hh.Provider,{value:Xh},n))}const Jh={position:"fixed",touchAction:"none"},ev=e=>tg(e)?"transform 250ms ease":void 0,nv=(0,Ce.forwardRef)((e,n)=>{let{as:t,activatorEvent:r,adjustScale:i,children:o,className:a,rect:s,style:l,transform:c,transition:u=ev}=e;if(!s)return null;const d=i?c:{...c,scaleX:1,scaleY:1},m={...Jh,width:s.width,height:s.height,top:s.top,left:s.left,transform:ig.Transform.toString(d),transformOrigin:i&&r?xg(r,s):void 0,transition:"function"==typeof u?u(r):u,...l};return Ce.createElement(t,{className:a,style:m,ref:n},o)}),tv=e=>n=>{let{active:t,dragOverlay:r}=n;const i={},{styles:o,className:a}=e;if(null!=o&&o.active)for(const[e,n]of Object.entries(o.active))void 0!==n&&(i[e]=t.node.style.getPropertyValue(e),t.node.style.setProperty(e,n));if(null!=o&&o.dragOverlay)for(const[e,n]of Object.entries(o.dragOverlay))void 0!==n&&r.node.style.setProperty(e,n);return null!=a&&a.active&&t.node.classList.add(a.active),null!=a&&a.dragOverlay&&r.node.classList.add(a.dragOverlay),function(){for(const[e,n]of Object.entries(i))t.node.style.setProperty(e,n);null!=a&&a.active&&t.node.classList.remove(a.active)}},rv={duration:250,easing:"ease",keyframes:e=>{let{transform:{initial:n,final:t}}=e;return[{transform:ig.Transform.toString(n)},{transform:ig.Transform.toString(t)}]},sideEffects:tv({styles:{active:{opacity:"0"}}})};function iv(e){let{config:n,draggableNodes:t,droppableContainers:r,measuringConfiguration:i}=e;return $p((e,o)=>{if(null===n)return;const a=t.get(e);if(!a)return;const s=a.node.current;if(!s)return;const l=Dh(o);if(!l)return;const{transform:c}=Fp(o).getComputedStyle(o),u=Og(c);if(!u)return;const d="function"==typeof n?n:function(e){const{duration:n,easing:t,sideEffects:r,keyframes:i}={...rv,...e};return e=>{let{active:o,dragOverlay:a,transform:s,...l}=e;if(!n)return;const c={x:a.rect.left-o.rect.left,y:a.rect.top-o.rect.top},u={scaleX:1!==s.scaleX?o.rect.width*s.scaleX/a.rect.width:1,scaleY:1!==s.scaleY?o.rect.height*s.scaleY/a.rect.height:1},d={x:s.x-c.x,y:s.y-c.y,...u},m=i({...l,active:o,dragOverlay:a,transform:{initial:s,final:d}}),[p]=m,g=m[m.length-1];if(JSON.stringify(p)===JSON.stringify(g))return;const h=null==r?void 0:r({active:o,dragOverlay:a,...l}),v=a.node.animate(m,{duration:n,easing:t,fill:"forwards"});return new Promise(e=>{v.onfinish=()=>{null==h||h(),e()}})}}(n);return Gg(s,i.draggable.measure),d({active:{id:e,data:a.data,node:s,rect:i.draggable.measure(s)},draggableNodes:t,dragOverlay:{node:o,rect:i.dragOverlay.measure(l)},droppableContainers:r,measuringConfiguration:i,transform:u})})}let ov=0;function av(e){return(0,Ce.useMemo)(()=>{if(null!=e)return ov++,ov},[e])}const sv=Ce.memo(e=>{let{adjustScale:n=!1,children:t,dropAnimation:r,style:i,transition:o,modifiers:a,wrapperElement:s="div",className:l,zIndex:c=999}=e;const{activatorEvent:u,active:d,activeNodeRect:m,containerNodeRect:p,draggableNodes:g,droppableContainers:h,dragOverlay:v,over:f,measuringConfiguration:b,scrollableAncestors:x,scrollableAncestorRects:y,windowRect:k}=Gh(),w=(0,Ce.useContext)(Hh),j=av(null==d?void 0:d.id),C=Uh(a,{activatorEvent:u,active:d,activeNodeRect:m,containerNodeRect:p,draggingNodeRect:v.rect,over:f,overlayNodeRect:v.rect,scrollableAncestors:x,scrollableAncestorRects:y,transform:w,windowRect:k}),S=kh(m),N=iv({config:r,draggableNodes:g,droppableContainers:h,measuringConfiguration:b}),E=S?v.setRef:void 0;return Ce.createElement(Zh,null,Ce.createElement(Qh,{animation:N},d&&j?Ce.createElement(nv,{key:j,id:d.id,ref:E,as:s,activatorEvent:u,adjustScale:n,className:l,transition:o,rect:S,style:{zIndex:c,...i},transform:C},t):null))});function lv(e,n,t){const r=e.slice();return r.splice(t<0?r.length+t:t,0,r.splice(n,1)[0]),r}function cv(e,n){return e.reduce((e,t,r)=>{const i=n.get(t);return i&&(e[r]=i),e},Array(e.length))}function uv(e){return null!==e&&e>=0}const dv=e=>{let{rects:n,activeIndex:t,overIndex:r,index:i}=e;const o=lv(n,r,t),a=n[i],s=o[i];return s&&a?{x:s.left-a.left,y:s.top-a.top,scaleX:s.width/a.width,scaleY:s.height/a.height}:null},mv={scaleX:1,scaleY:1},pv=e=>{var n;let{activeIndex:t,activeNodeRect:r,index:i,rects:o,overIndex:a}=e;const s=null!=(n=o[t])?n:r;if(!s)return null;if(i===t){const e=o[a];return e?{x:0,y:t<a?e.top+e.height-(s.top+s.height):e.top-s.top,...mv}:null}const l=function(e,n,t){const r=e[n],i=e[n-1],o=e[n+1];if(!r)return 0;if(t<n)return i?r.top-(i.top+i.height):o?o.top-(r.top+r.height):0;return o?o.top-(r.top+r.height):i?r.top-(i.top+i.height):0}(o,i,t);return i>t&&i<=a?{x:0,y:-s.height-l,...mv}:i<t&&i>=a?{x:0,y:s.height+l,...mv}:{x:0,y:0,...mv}};const gv="Sortable",hv=Ce.createContext({activeIndex:-1,containerId:gv,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:dv,disabled:{draggable:!1,droppable:!1}});function vv(e){let{children:n,id:t,items:r,strategy:i=dv,disabled:o=!1}=e;const{active:a,dragOverlay:s,droppableRects:l,over:c,measureDroppableContainers:u}=Gh(),d=Zp(gv,t),m=Boolean(null!==s.rect),p=(0,Ce.useMemo)(()=>r.map(e=>"object"==typeof e&&"id"in e?e.id:e),[r]),g=null!=a,h=a?p.indexOf(a.id):-1,v=c?p.indexOf(c.id):-1,f=(0,Ce.useRef)(p),b=!function(e,n){if(e===n)return!0;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t]!==n[t])return!1;return!0}(p,f.current),x=-1!==v&&-1===h||b,y=function(e){return"boolean"==typeof e?{draggable:e,droppable:e}:e}(o);qp(()=>{b&&g&&u(p)},[b,p,g,u]),(0,Ce.useEffect)(()=>{f.current=p},[p]);const k=(0,Ce.useMemo)(()=>({activeIndex:h,containerId:d,disabled:y,disableTransforms:x,items:p,overIndex:v,useDragOverlay:m,sortedRects:cv(p,l),strategy:i}),[h,d,y.draggable,y.droppable,x,p,v,l,m,i]);return Ce.createElement(hv.Provider,{value:k},n)}const fv=e=>{let{id:n,items:t,activeIndex:r,overIndex:i}=e;return lv(t,r,i).indexOf(n)},bv=e=>{let{containerId:n,isSorting:t,wasDragging:r,index:i,items:o,newIndex:a,previousItems:s,previousContainerId:l,transition:c}=e;return!(!c||!r)&&((s===o||i!==a)&&(!!t||a!==i&&n===l))},xv={duration:200,easing:"ease"},yv="transform",kv=ig.Transition.toString({property:yv,duration:0,easing:"linear"}),wv={roleDescription:"sortable"};function jv(e){let{animateLayoutChanges:n=bv,attributes:t,disabled:r,data:i,getNewIndex:o=fv,id:a,strategy:s,resizeObserverConfig:l,transition:c=xv}=e;const{items:u,containerId:d,activeIndex:m,disabled:p,disableTransforms:g,sortedRects:h,overIndex:v,useDragOverlay:f,strategy:b}=(0,Ce.useContext)(hv),x=function(e,n){var t,r;if("boolean"==typeof e)return{draggable:e,droppable:!1};return{draggable:null!=(t=null==e?void 0:e.draggable)?t:n.draggable,droppable:null!=(r=null==e?void 0:e.droppable)?r:n.droppable}}(r,p),y=u.indexOf(a),k=(0,Ce.useMemo)(()=>({sortable:{containerId:d,index:y,items:u},...i}),[d,i,y,u]),w=(0,Ce.useMemo)(()=>u.slice(u.indexOf(a)),[u,a]),{rect:j,node:C,isOver:S,setNodeRef:N}=function(e){let{data:n,disabled:t=!1,id:r,resizeObserverConfig:i}=e;const o=Zp("Droppable"),{active:a,dispatch:s,over:l,measureDroppableContainers:c}=(0,Ce.useContext)(Ih),u=(0,Ce.useRef)({disabled:t}),d=(0,Ce.useRef)(!1),m=(0,Ce.useRef)(null),p=(0,Ce.useRef)(null),{disabled:g,updateMeasurementsFor:h,timeout:v}={...Kh,...i},f=Yp(null!=h?h:r),b=wh({callback:(0,Ce.useCallback)(()=>{d.current?(null!=p.current&&clearTimeout(p.current),p.current=setTimeout(()=>{c(Array.isArray(f.current)?f.current:[f.current]),p.current=null},v)):d.current=!0},[v]),disabled:g||!a}),x=(0,Ce.useCallback)((e,n)=>{b&&(n&&(b.unobserve(n),d.current=!1),e&&b.observe(e))},[b]),[y,k]=Kp(x),w=Yp(n);return(0,Ce.useEffect)(()=>{b&&y.current&&(b.disconnect(),d.current=!1,b.observe(y.current))},[y,b]),(0,Ce.useEffect)(()=>(s({type:gg.RegisterDroppable,element:{id:r,key:o,disabled:t,node:y,rect:m,data:w}}),()=>s({type:gg.UnregisterDroppable,key:o,id:r})),[r]),(0,Ce.useEffect)(()=>{t!==u.current.disabled&&(s({type:gg.SetDroppableDisabled,id:r,key:o,disabled:t}),u.current.disabled=t)},[r,o,t,s]),{active:a,rect:m,isOver:(null==l?void 0:l.id)===r,node:y,over:l,setNodeRef:k}}({id:a,data:k,disabled:x.droppable,resizeObserverConfig:{updateMeasurementsFor:w,...l}}),{active:E,activatorEvent:P,activeNodeRect:D,attributes:M,setNodeRef:O,listeners:T,isDragging:A,over:L,setActivatorNodeRef:z,transform:I}=Yh({id:a,data:k,attributes:{...wv,...t},disabled:x.draggable}),R=function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return(0,Ce.useMemo)(()=>e=>{n.forEach(n=>n(e))},n)}(N,O),B=Boolean(E),_=B&&!g&&uv(m)&&uv(v),F=!f&&A,U=F&&_?I:null,H=_?null!=U?U:(null!=s?s:b)({rects:h,activeNodeRect:D,activeIndex:m,overIndex:v,index:y}):null,W=uv(m)&&uv(v)?o({id:a,items:u,activeIndex:m,overIndex:v}):y,V=null==E?void 0:E.id,q=(0,Ce.useRef)({activeId:V,items:u,newIndex:W,containerId:d}),$=u!==q.current.items,Y=n({active:E,containerId:d,isDragging:A,isSorting:B,id:a,index:y,items:u,newIndex:q.current.newIndex,previousItems:q.current.items,previousContainerId:q.current.containerId,transition:c,wasDragging:null!=q.current.activeId}),G=function(e){let{disabled:n,index:t,node:r,rect:i}=e;const[o,a]=(0,Ce.useState)(null),s=(0,Ce.useRef)(t);return qp(()=>{if(!n&&t!==s.current&&r.current){const e=i.current;if(e){const n=Ag(r.current,{ignoreTransform:!0}),t={x:e.left-n.left,y:e.top-n.top,scaleX:e.width/n.width,scaleY:e.height/n.height};(t.x||t.y)&&a(t)}}t!==s.current&&(s.current=t)},[n,t,r,i]),(0,Ce.useEffect)(()=>{o&&a(null)},[o]),o}({disabled:!Y,index:y,node:C,rect:j});return(0,Ce.useEffect)(()=>{B&&q.current.newIndex!==W&&(q.current.newIndex=W),d!==q.current.containerId&&(q.current.containerId=d),u!==q.current.items&&(q.current.items=u)},[B,W,d,u]),(0,Ce.useEffect)(()=>{if(V===q.current.activeId)return;if(null!=V&&null==q.current.activeId)return void(q.current.activeId=V);const e=setTimeout(()=>{q.current.activeId=V},50);return()=>clearTimeout(e)},[V]),{active:E,activeIndex:m,attributes:M,data:k,rect:j,index:y,newIndex:W,items:u,isOver:S,isSorting:B,isDragging:A,listeners:T,node:C,overIndex:v,over:L,setNodeRef:R,setActivatorNodeRef:z,setDroppableNodeRef:N,setDraggableNodeRef:O,transform:null!=G?G:H,transition:function(){if(G||$&&q.current.newIndex===y)return kv;if(F&&!tg(P)||!c)return;if(B||Y)return ig.Transition.toString({...c,property:yv});return}()}}function Cv(e){if(!e)return!1;const n=e.data.current;return!!(n&&"sortable"in n&&"object"==typeof n.sortable&&"containerId"in n.sortable&&"items"in n.sortable&&"index"in n.sortable)}const Sv=[eh.Down,eh.Right,eh.Up,eh.Left],Nv=(e,n)=>{let{context:{active:t,collisionRect:r,droppableRects:i,droppableContainers:o,over:a,scrollableAncestors:s}}=n;if(Sv.includes(e.code)){if(e.preventDefault(),!t||!r)return;const n=[];o.getEnabled().forEach(t=>{if(!t||null!=t&&t.disabled)return;const o=i.get(t.id);if(o)switch(e.code){case eh.Down:r.top<o.top&&n.push(t);break;case eh.Up:r.top>o.top&&n.push(t);break;case eh.Left:r.left>o.left&&n.push(t);break;case eh.Right:r.left<o.left&&n.push(t)}});const l=(e=>{let{collisionRect:n,droppableRects:t,droppableContainers:r}=e;const i=wg(n),o=[];for(const e of r){const{id:n}=e,r=t.get(n);if(r){const t=wg(r),a=i.reduce((e,n,r)=>e+bg(t[r],n),0),s=Number((a/4).toFixed(4));o.push({id:n,data:{droppableContainer:e,value:s}})}}return o.sort(yg)})({active:t,collisionRect:r,droppableRects:i,droppableContainers:n,pointerCoordinates:null});let c=jg(l,"id");if(c===(null==a?void 0:a.id)&&l.length>1&&(c=l[1].id),null!=c){const e=o.get(t.id),n=o.get(c),a=n?i.get(n.id):null,l=null==n?void 0:n.node.current;if(l&&a&&e&&n){const t=zg(l).some((e,n)=>s[n]!==e),i=Ev(e,n),o=function(e,n){if(!Cv(e)||!Cv(n))return!1;if(!Ev(e,n))return!1;return e.data.current.sortable.index<n.data.current.sortable.index}(e,n),c=t||!i?{x:0,y:0}:{x:o?r.width-a.width:0,y:o?r.height-a.height:0},u={x:a.left,y:a.top};return c.x&&c.y?u:ng(u,c)}}}};function Ev(e,n){return!(!Cv(e)||!Cv(n))&&e.data.current.sortable.containerId===n.data.current.sortable.containerId}const Pv=Sn("grip-vertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]),Dv=Sn("eye-off",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),Mv=Sn("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),Ov=Sn("bookmark-check",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2Z",key:"169p4p"}],["path",{d:"m9 10 2 2 4-4",key:"1gnqz4"}]]),Tv=Sn("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]),Av=Sn("link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]),Lv=Sn("unlink",[["path",{d:"m18.84 12.25 1.72-1.71h-.02a5.004 5.004 0 0 0-.12-7.07 5.006 5.006 0 0 0-6.95 0l-1.72 1.71",key:"yqzxt4"}],["path",{d:"m5.17 11.75-1.71 1.71a5.004 5.004 0 0 0 .12 7.07 5.006 5.006 0 0 0 6.95 0l1.71-1.71",key:"4qinb0"}],["line",{x1:"8",x2:"8",y1:"2",y2:"5",key:"1041cp"}],["line",{x1:"2",x2:"5",y1:"8",y2:"8",key:"14m1p5"}],["line",{x1:"16",x2:"16",y1:"19",y2:"22",key:"rzdirn"}],["line",{x1:"19",x2:"22",y1:"16",y2:"16",key:"ox905f"}]]),zv=Sn("file-text",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);function Iv(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function Rv(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Iv(Object(t),!0).forEach(function(n){Bv(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Iv(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Bv(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function _v(){const[e,n]=(0,Ce.useState)(null),[t,r]=(0,Ce.useState)([]),[i,o]=(0,Ce.useState)([]),[a,s]=(0,Ce.useState)([]),[l,c]=(0,Ce.useState)(!1),[u,d]=(0,Ce.useState)(null),[m,p]=(0,Ce.useState)(!1),[g,h]=(0,Ce.useState)(!1),[v,f]=(0,Ce.useState)(null),b=(0,Ce.useCallback)(async()=>{c(!0);try{const i=ne.getAvailablePresets();o(i);const a=ne.getToggleStateNames();s(a),p(ne.hasChatToggleState()),h(ne.hasCharacterToggleState());const l=ne.getCurrentCharacterAvatar();if(l&&"undefined"!=typeof SillyTavern){var e,t;const n=null===(e=(t=SillyTavern).getContext)||void 0===e?void 0:e.call(t);if(null!=n&&n.characters){const e=n.characters.find(e=>e.avatar===l);f((null==e?void 0:e.name)||null)}}else f(null);const c=ne.getCurrentPreset();if(console.log("[usePresetEditor] Loaded preset:",c),c){n(c);const e=c.settings.prompts||[];console.log("[usePresetEditor] Raw prompts length:",e.length);const t=e.map(e=>Rv(Rv({},e),{},{_uiId:e.identifier&&"main"!==e.identifier?e.identifier:crypto.randomUUID()}));r(t)}else d("No active preset found")}catch(e){d(e.message)}finally{c(!1)}},[]),x=(0,Ce.useCallback)(async e=>{c(!0);try{await ne.selectPreset(e)?await b():d("Failed to select preset: ".concat(e))}catch(e){d(e.message)}finally{c(!1)}},[b]),y=(0,Ce.useCallback)(()=>{if(!e)return;const n=ne.exportPreset(e.name);if(n){const t=new Blob([n],{type:"application/json"}),r=URL.createObjectURL(t),i=document.createElement("a");i.href=r,i.download="".concat(e.name,".json"),i.click(),URL.revokeObjectURL(r)}},[e]),k=(0,Ce.useCallback)(async function(n){if(!e)return;const i=t;r(n);const o={};if(n.forEach((e,n)=>{const t=i[n];if(t&&e.enabled!==t.enabled){const n=e.identifier||e.name;n&&(o[n]=e.enabled)}}),Object.keys(o).length>0){const e=ne.applyTogglesToPromptOrder(o);e.matched>0&&(ne.refreshPromptManagerUI(),console.log("[usePresetEditor] Applied ".concat(e.matched," toggle changes to runtime")))}try{await ne.updatePrompts(n)}catch(e){d("Failed to save prompts"),console.error("[usePresetEditor] Failed to persist prompts:",e),b()}},[e,t,b]),w=(0,Ce.useMemo)(()=>{const e=[];let n=null;return t.forEach((t,r)=>{if(t.name.startsWith("━"))n=Rv(Rv({},t),{},{id:t.identifier||"prompt-".concat(r),originalIndex:r,children:[]}),e.push(n);else{const i=Rv(Rv({},t),{},{id:t.identifier||"prompt-".concat(r),originalIndex:r});n?n.children.push(i):e.push(i)}}),e},[t]),j=(0,Ce.useCallback)(async e=>{if(!e||0===t.length)return!1;try{return await ne.saveToggleState(e,t),s(ne.getToggleStateNames()),!0}catch(e){return d("Failed to save toggle state: ".concat(e.message)),!1}},[t]),C=(0,Ce.useCallback)(async e=>{if(!e)return null;try{const n=await ne.applyToggleStateToRuntime(e);return n.applied&&await b(),n}catch(e){return d("Failed to apply toggle state: ".concat(e.message)),null}},[b]),S=(0,Ce.useCallback)(async e=>{try{return await ne.deleteToggleState(e),s(ne.getToggleStateNames()),!0}catch(e){return d("Failed to delete toggle state: ".concat(e.message)),!1}},[]),N=(0,Ce.useCallback)(async()=>{if(0===t.length)return!1;try{const e=await ne.saveToggleStateToChat(t);return e&&p(!0),e}catch(e){return d("Failed to save toggles to chat: ".concat(e.message)),!1}},[t]),E=(0,Ce.useCallback)(async()=>{const e=await ne.clearChatToggleState();return e&&p(!1),e},[]),P=(0,Ce.useCallback)(async()=>{if(0===t.length)return!1;try{const e=await ne.saveToggleStateToCharacter(t);return e&&h(!0),e}catch(e){return d("Failed to save toggles to character: ".concat(e.message)),!1}},[t]),D=(0,Ce.useCallback)(async()=>{const e=await ne.clearCharacterToggleState();return e&&h(!1),e},[]);return(0,Ce.useEffect)(()=>{b()},[b]),{currentPreset:e,prompts:t,availablePresets:i,toggleStateNames:a,structuredPrompts:w,isLoading:l,error:u,refresh:b,selectPreset:x,exportPreset:y,savePrompts:k,saveToggleState:j,applyToggleState:C,deleteToggleState:S,hasChatBinding:m,hasCharacterBinding:g,currentCharacterName:v,saveTogglesToChat:N,clearChatToggles:E,saveTogglesToCharacter:P,clearCharacterToggles:D}}function Fv(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function Uv(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Fv(Object(t),!0).forEach(function(n){Hv(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Fv(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Hv(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const Wv="━",Vv={layout:{display:"flex",flexDirection:"column",height:"100%",maxHeight:"100%",minHeight:0,background:"var(--lumiverse-bg)",color:"var(--lumiverse-text)"},header:{display:"flex",alignItems:"center",gap:"12px",padding:"12px 16px",background:"var(--lumiverse-bg-elevated)",borderBottom:"1px solid var(--lumiverse-border)",flexShrink:0},headerContent:{flex:1,display:"flex",alignItems:"center",gap:"12px",minWidth:0},title:{margin:0,fontSize:"16px",fontWeight:600,whiteSpace:"nowrap"},toolbar:{display:"flex",alignItems:"center",gap:"8px",padding:"10px 16px",borderBottom:"1px solid var(--lumiverse-border)",flexShrink:0,background:"rgba(0,0,0,0.1)",position:"relative",zIndex:10},scrollArea:{flex:"1 1 auto",minHeight:0,overflowY:"auto",padding:"16px"},form:{display:"flex",flexDirection:"column",gap:"16px",maxWidth:"800px",margin:"0 auto",width:"100%"},formGroup:{display:"flex",flexDirection:"column",gap:"6px"},label:{fontSize:"12px",fontWeight:500,color:"var(--lumiverse-text-muted)",textTransform:"uppercase",letterSpacing:"0.5px"},input:{padding:"10px 12px",background:"var(--lumiverse-input-bg, rgba(0, 0, 0, 0.2))",border:"1px solid var(--lumiverse-border)",borderRadius:"8px",color:"var(--lumiverse-text)",fontSize:"14px",outline:"none",fontFamily:"inherit"},textarea:{padding:"12px",background:"var(--lumiverse-input-bg, rgba(0, 0, 0, 0.2))",border:"1px solid var(--lumiverse-border)",borderRadius:"8px",color:"var(--lumiverse-text)",fontSize:"14px",fontFamily:"var(--lumiverse-font-mono)",minHeight:"200px",resize:"vertical",outline:"none",lineHeight:"1.5"},select:{padding:"10px 12px",background:"var(--lumiverse-input-bg, rgba(0, 0, 0, 0.2))",border:"1px solid var(--lumiverse-border)",borderRadius:"8px",color:"var(--lumiverse-text)",fontSize:"14px",outline:"none",cursor:"pointer"},item:{display:"flex",alignItems:"center",padding:"8px 12px",background:"var(--lumiverse-bg-elevated)",border:"1px solid var(--lumiverse-border)",borderRadius:"8px",marginBottom:"8px",transition:"all 0.2s ease",touchAction:"none"},itemDragging:{opacity:.5,boxShadow:"0 4px 12px rgba(0,0,0,0.2)",borderColor:"var(--lumiverse-primary)"},category:{background:"rgba(147, 112, 219, 0.1)",borderColor:"rgba(147, 112, 219, 0.2)"},badge:{fontSize:"10px",padding:"2px 6px",borderRadius:"4px",textTransform:"uppercase",fontWeight:600,marginLeft:"8px"},badgeSystem:{background:"rgba(59, 130, 246, 0.2)",color:"#60a5fa"},badgeUser:{background:"rgba(16, 185, 129, 0.2)",color:"#34d399"},badgeAssistant:{background:"rgba(245, 158, 11, 0.2)",color:"#fbbf24"},iconBtn:{padding:"6px",borderRadius:"6px",background:"transparent",border:"none",color:"var(--lumiverse-text-muted)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},btn:{display:"flex",alignItems:"center",gap:"6px",padding:"8px 12px",borderRadius:"6px",border:"1px solid var(--lumiverse-border)",background:"var(--lumiverse-bg-elevated)",color:"var(--lumiverse-text)",fontSize:"13px",fontWeight:500,cursor:"pointer",whiteSpace:"nowrap"},btnPrimary:{background:"var(--lumiverse-primary)",color:"white",borderColor:"var(--lumiverse-primary)"}};function qv(e){let{prompt:n,index:t,onEdit:r,onDelete:i,onToggleEnabled:o,onToggleCollapse:a,isCollapsed:s}=e;const{attributes:l,listeners:c,setNodeRef:u,transform:d,transition:m,isDragging:p}=jv({id:n.identifier||n._uiId}),g={transform:ig.Transform.toString(d),transition:m,opacity:p?.4:1,touchAction:"none"},h=n.name.startsWith(Wv),v=h?n.name.substring(1).trim():n.name;return(0,Ee.jsxs)("div",{ref:u,style:Uv(Uv(Uv({},Vv.item),h?Vv.category:{}),g),className:On("lumiverse-prompt-item",!n.enabled&&"opacity-50 grayscale"),children:[(0,Ee.jsx)("div",Uv(Uv(Uv({},l),c),{},{style:{cursor:"grab",padding:"4px",color:"var(--lumiverse-text-dim)",marginRight:"8px"},children:(0,Ee.jsx)(Pv,{size:16})})),(0,Ee.jsxs)("div",{style:{flex:1,display:"flex",alignItems:"center",minWidth:0,gap:"8px"},children:[h&&(0,Ee.jsx)("button",{style:Vv.iconBtn,onClick:()=>a(n.identifier||n._uiId),children:s?(0,Ee.jsx)(An,{size:18}):(0,Ee.jsx)(Tn,{size:18})}),(0,Ee.jsxs)("div",{style:{display:"flex",flexDirection:"column",minWidth:0,flex:1},children:[(0,Ee.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,Ee.jsx)("span",{style:{fontWeight:500,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:v}),!h&&(0,Ee.jsx)("span",{style:Uv(Uv({},Vv.badge),(e=>{switch(e){case"user":return Vv.badgeUser;case"assistant":return Vv.badgeAssistant;default:return Vv.badgeSystem}})(n.role)),children:n.role})]}),!h&&(0,Ee.jsx)("div",{style:{fontSize:"11px",color:"var(--lumiverse-text-muted)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:n.content.substring(0,80)})]})]}),(0,Ee.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"2px"},children:[(0,Ee.jsx)("button",{style:Vv.iconBtn,onClick:()=>o(n),title:n.enabled?"Disable":"Enable",children:n.enabled?(0,Ee.jsx)(Id,{size:16}):(0,Ee.jsx)(Dv,{size:16})}),(0,Ee.jsx)("button",{style:Vv.iconBtn,onClick:()=>r(n),title:"Edit",children:(0,Ee.jsx)(En,{size:16})}),(0,Ee.jsx)("button",{style:Uv(Uv({},Vv.iconBtn),{},{color:"var(--lumiverse-danger)"}),onClick:()=>i(n),title:"Delete",children:(0,Ee.jsx)(Pn,{size:16})})]})]})}function $v(e){let{form:n,setForm:t,onSave:r,onCancel:i}=e;return(0,Ee.jsxs)("div",{style:Vv.layout,children:[(0,Ee.jsxs)("div",{style:Vv.header,children:[(0,Ee.jsx)("button",{style:Vv.iconBtn,onClick:i,children:(0,Ee.jsx)(Mv,{size:20})}),(0,Ee.jsx)("div",{style:Uv(Uv({},Vv.title),{},{flex:1}),children:n.name.startsWith(Wv)?"Edit Category":"Edit Prompt"}),(0,Ee.jsxs)("button",{style:Uv(Uv({},Vv.btn),Vv.btnPrimary),onClick:r,children:[(0,Ee.jsx)(zd,{size:16})," Save"]})]}),(0,Ee.jsx)("div",{style:Vv.scrollArea,children:(0,Ee.jsxs)("div",{style:Vv.form,children:[(0,Ee.jsxs)("div",{style:Vv.formGroup,children:[(0,Ee.jsx)("label",{style:Vv.label,children:"Name"}),(0,Ee.jsx)("input",{style:Vv.input,type:"text",value:n.name.startsWith(Wv)?n.name.substring(1).trim():n.name,onChange:e=>{const r=e.target.value;n.name.startsWith(Wv)?t(Uv(Uv({},n),{},{name:"".concat(Wv," ").concat(r)})):t(Uv(Uv({},n),{},{name:r}))},placeholder:"Enter name..."})]}),!n.name.startsWith(Wv)&&(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsxs)("div",{style:Vv.formGroup,children:[(0,Ee.jsx)("label",{style:Vv.label,children:"Role"}),(0,Ee.jsxs)("select",{style:Vv.select,value:n.role,onChange:e=>t(Uv(Uv({},n),{},{role:e.target.value})),children:[(0,Ee.jsx)("option",{value:"system",children:"System"}),(0,Ee.jsx)("option",{value:"user",children:"User"}),(0,Ee.jsx)("option",{value:"assistant",children:"Assistant"})]})]}),(0,Ee.jsxs)("div",{style:Vv.formGroup,children:[(0,Ee.jsx)("label",{style:Vv.label,children:"Content (Supports Macros)"}),(0,Ee.jsx)("textarea",{style:Vv.textarea,value:n.content,onChange:e=>t(Uv(Uv({},n),{},{content:e.target.value})),placeholder:"Enter prompt content..."})]}),(0,Ee.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[(0,Ee.jsxs)("div",{style:Vv.formGroup,children:[(0,Ee.jsx)("label",{style:Vv.label,children:"Injection Position"}),(0,Ee.jsxs)("select",{style:Vv.select,value:n.injection_position||0,onChange:e=>t(Uv(Uv({},n),{},{injection_position:parseInt(e.target.value)})),children:[(0,Ee.jsx)("option",{value:0,children:"Relative (Depth)"}),(0,Ee.jsx)("option",{value:1,children:"Absolute (Index)"})]})]}),(0,Ee.jsxs)("div",{style:Vv.formGroup,children:[(0,Ee.jsx)("label",{style:Vv.label,children:1===n.injection_position?"Index":"Depth"}),(0,Ee.jsx)("input",{style:Vv.input,type:"number",value:n.injection_depth||4,onChange:e=>t(Uv(Uv({},n),{},{injection_depth:parseInt(e.target.value)}))})]})]})]})]})})]})}const Yv=Sn("message-circle",[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]]),Gv=Sn("layout-grid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);function Kv(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function Qv(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Kv(Object(t),!0).forEach(function(n){Xv(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Kv(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Xv(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const Zv=[{value:"social",label:"Social Card",description:"Full card with avatar & animations",Icon:Ln},{value:"margin",label:"Margin Note",description:"Minimal hanging tag style",Icon:zv},{value:"whisper",label:"Whisper Bubble",description:"Soft ethereal thought bubble",Icon:Yv}],Jv={layout:{display:"flex",flexDirection:"column",height:"100%",maxHeight:"100%",minHeight:0},header:{display:"flex",alignItems:"center",gap:"12px",padding:"16px 20px",borderBottom:"1px solid var(--lumiverse-border)",flexShrink:0},headerIcon:{display:"flex",alignItems:"center",justifyContent:"center",width:"40px",height:"40px",borderRadius:"10px",background:"linear-gradient(135deg, rgba(147, 112, 219, 0.2), rgba(147, 112, 219, 0.1))",color:"var(--lumiverse-primary)"},headerText:{flex:1},title:{margin:0,fontSize:"16px",fontWeight:600,color:"var(--lumiverse-text)"},subtitle:{margin:"4px 0 0",fontSize:"12px",color:"var(--lumiverse-text-muted)"},scrollArea:{flex:"1 1 auto",minHeight:0,overflowY:"auto",padding:"16px 20px"},section:{marginBottom:"20px"},sectionHeader:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"12px",color:"var(--lumiverse-text)",fontWeight:500,fontSize:"14px"},sectionIcon:{color:"var(--lumiverse-primary)"},description:{fontSize:"12px",color:"var(--lumiverse-text-muted)",marginBottom:"12px"},field:{marginBottom:"12px"},label:{display:"block",fontSize:"12px",fontWeight:500,color:"var(--lumiverse-text)",marginBottom:"6px"},input:{width:"100%",padding:"10px 12px",fontSize:"13px",background:"var(--lumiverse-input-bg)",border:"1px solid var(--lumiverse-border)",borderRadius:"8px",color:"var(--lumiverse-text)",outline:"none",transition:"border-color 0.2s ease"},hint:{fontSize:"11px",color:"var(--lumiverse-text-muted)",marginTop:"4px"},styleGrid:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"10px"},styleOption:{display:"flex",flexDirection:"column",alignItems:"center",gap:"8px",padding:"14px 8px",background:"rgba(0, 0, 0, 0.2)",border:"1px solid var(--lumiverse-border)",borderRadius:"10px",cursor:"pointer",transition:"all 0.2s ease"},styleOptionSelected:{background:"rgba(147, 112, 219, 0.15)",borderColor:"var(--lumiverse-primary)"},styleOptionIcon:{color:"var(--lumiverse-text-muted)",transition:"color 0.2s ease"},styleOptionIconSelected:{color:"var(--lumiverse-primary)"},styleOptionLabel:{fontSize:"12px",fontWeight:500,color:"var(--lumiverse-text)",textAlign:"center"},styleOptionDesc:{fontSize:"10px",color:"var(--lumiverse-text-muted)",textAlign:"center",lineHeight:1.3},footer:{display:"flex",justifyContent:"flex-end",gap:"8px",padding:"12px 20px",borderTop:"1px solid var(--lumiverse-border)",flexShrink:0},button:{padding:"10px 16px",fontSize:"13px",fontWeight:500,borderRadius:"8px",border:"none",cursor:"pointer",transition:"all 0.2s ease"},buttonSecondary:{background:"var(--lumiverse-surface)",color:"var(--lumiverse-text)",border:"1px solid var(--lumiverse-border)"},buttonPrimary:{background:"var(--lumiverse-primary)",color:"white"}};const ef=function(e){let{onClose:n}=e;const t=Ye,r=Xe(),i=t.getState().lumiaOOCInterval||"",o=t.getState().lumiaOOCStyle||"social",[a,s]=(0,Ce.useState)(i.toString()),[l,c]=(0,Ce.useState)(o),u=(0,Ce.useCallback)(()=>{const e=a.trim()?parseInt(a,10):null;if(r.setSettings({lumiaOOCInterval:e,lumiaOOCStyle:l}),$e(),window.toastr&&window.toastr.success("OOC settings saved!"),l!==o){var t,i;const e=null===(t=window.LumiverseBridge)||void 0===t||null===(i=t.getCallbacks)||void 0===i?void 0:i.call(t);null!=e&&e.refreshOOCComments&&setTimeout(()=>e.refreshOOCComments(!0),100)}n()},[a,l,o,r,n]);return(0,Ee.jsxs)("div",{style:Jv.layout,children:[(0,Ee.jsxs)("div",{style:Jv.header,children:[(0,Ee.jsx)("div",{style:Jv.headerIcon,children:(0,Ee.jsx)(ur,{size:20,strokeWidth:1.5})}),(0,Ee.jsxs)("div",{style:Jv.headerText,children:[(0,Ee.jsx)("h3",{style:Jv.title,children:"OOC Settings"}),(0,Ee.jsx)("p",{style:Jv.subtitle,children:"Configure out-of-character comments"})]})]}),(0,Ee.jsxs)("div",{style:Jv.scrollArea,children:[(0,Ee.jsxs)("div",{style:Jv.section,children:[(0,Ee.jsxs)("div",{style:Jv.sectionHeader,children:[(0,Ee.jsx)(vt,{size:16,style:Jv.sectionIcon}),(0,Ee.jsx)("span",{children:"Comment Trigger"})]}),(0,Ee.jsx)("p",{style:Jv.description,children:"Automatically inject OOC instructions at message intervals."}),(0,Ee.jsxs)("div",{style:Jv.field,children:[(0,Ee.jsx)("label",{style:Jv.label,children:"Message Interval"}),(0,Ee.jsx)("input",{type:"number",style:Jv.input,placeholder:"e.g., 10 (empty = disabled)",min:"1",value:a,onChange:e=>s(e.target.value)}),(0,Ee.jsx)("div",{style:Jv.hint,children:"Triggers when message count is divisible by this number"})]})]}),(0,Ee.jsxs)("div",{style:Jv.section,children:[(0,Ee.jsxs)("div",{style:Jv.sectionHeader,children:[(0,Ee.jsx)(Gv,{size:16,style:Jv.sectionIcon}),(0,Ee.jsx)("span",{children:"Display Style"})]}),(0,Ee.jsx)("p",{style:Jv.description,children:"Choose how OOC comments appear in chat."}),(0,Ee.jsx)("div",{style:Jv.styleGrid,children:Zv.map(e=>{const n=l===e.value;return(0,Ee.jsxs)("button",{type:"button",style:Qv(Qv({},Jv.styleOption),n?Jv.styleOptionSelected:{}),onClick:()=>c(e.value),children:[(0,Ee.jsx)(e.Icon,{size:20,strokeWidth:1.5,style:Qv(Qv({},Jv.styleOptionIcon),n?Jv.styleOptionIconSelected:{})}),(0,Ee.jsx)("span",{style:Jv.styleOptionLabel,children:e.label}),(0,Ee.jsx)("span",{style:Jv.styleOptionDesc,children:e.description})]},e.value)})})]})]}),(0,Ee.jsxs)("div",{style:Jv.footer,children:[(0,Ee.jsx)("button",{type:"button",style:Qv(Qv({},Jv.button),Jv.buttonSecondary),onClick:n,children:"Cancel"}),(0,Ee.jsx)("button",{type:"button",style:Qv(Qv({},Jv.button),Jv.buttonPrimary),onClick:u,children:"Save Changes"})]})]})},nf=Sn("text-align-start",[["path",{d:"M21 5H3",key:"1fi0y6"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M17 19H3",key:"z6ezky"}]]),tf=Sn("pen-line",[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]),rf=Sn("server",[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]]),of=Sn("play",[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]]);function af(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function sf(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?af(Object(t),!0).forEach(function(n){lf(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):af(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function lf(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const cf={openai:{name:"OpenAI",placeholder:"gpt-4-turbo-preview"},anthropic:{name:"Anthropic",placeholder:"claude-3-opus-20240229"},google:{name:"Google AI",placeholder:"gemini-pro"},openrouter:{name:"OpenRouter",placeholder:"anthropic/claude-3-opus"},custom:{name:"Custom Endpoint",placeholder:"your-model-name"}},uf={layout:{display:"flex",flexDirection:"column",height:"100%",maxHeight:"100%",minHeight:0},header:{display:"flex",alignItems:"center",gap:"12px",padding:"16px 20px",borderBottom:"1px solid var(--lumiverse-border)",flexShrink:0},headerIcon:{display:"flex",alignItems:"center",justifyContent:"center",width:"40px",height:"40px",borderRadius:"10px",background:"linear-gradient(135deg, rgba(147, 112, 219, 0.2), rgba(147, 112, 219, 0.1))",color:"var(--lumiverse-primary)"},headerText:{flex:1},title:{margin:0,fontSize:"16px",fontWeight:600,color:"var(--lumiverse-text)"},subtitle:{margin:"4px 0 0",fontSize:"12px",color:"var(--lumiverse-text-muted)"},scrollArea:{flex:"1 1 auto",minHeight:0,overflowY:"auto",padding:"16px 20px"},section:{marginBottom:"20px",padding:"14px",background:"rgba(0, 0, 0, 0.15)",borderRadius:"10px",border:"1px solid var(--lumiverse-border)"},sectionHeader:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"12px",color:"var(--lumiverse-text)",fontWeight:500,fontSize:"14px"},sectionIcon:{color:"var(--lumiverse-primary)"},modeOptions:{display:"flex",gap:"8px"},modeOption:{flex:1,padding:"10px",background:"rgba(0, 0, 0, 0.2)",border:"1px solid var(--lumiverse-border)",borderRadius:"8px",cursor:"pointer",transition:"all 0.2s ease",textAlign:"center",fontSize:"13px",fontWeight:500,color:"var(--lumiverse-text)"},modeOptionSelected:{background:"rgba(147, 112, 219, 0.15)",borderColor:"var(--lumiverse-primary)",color:"var(--lumiverse-primary)"},field:{marginBottom:"12px"},fieldRow:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px"},fieldRow3:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"12px"},label:{display:"block",fontSize:"12px",fontWeight:500,color:"var(--lumiverse-text)",marginBottom:"6px"},input:{width:"100%",padding:"10px 12px",fontSize:"13px",background:"var(--lumiverse-input-bg)",border:"1px solid var(--lumiverse-border)",borderRadius:"8px",color:"var(--lumiverse-text)",outline:"none",boxSizing:"border-box"},select:{width:"100%",padding:"10px 12px",fontSize:"13px",background:"var(--lumiverse-input-bg)",border:"1px solid var(--lumiverse-border)",borderRadius:"8px",color:"var(--lumiverse-text)",outline:"none",boxSizing:"border-box"},hint:{fontSize:"11px",color:"var(--lumiverse-text-muted)",marginTop:"4px"},toggleRow:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px 0"},toggleLabel:{flex:1},toggleText:{display:"block",fontSize:"13px",fontWeight:500,color:"var(--lumiverse-text)"},toggleHint:{display:"block",fontSize:"11px",color:"var(--lumiverse-text-muted)",marginTop:"2px"},toggle:{position:"relative",width:"44px",height:"24px",background:"rgba(0, 0, 0, 0.3)",borderRadius:"12px",cursor:"pointer",transition:"background 0.2s ease"},toggleActive:{background:"var(--lumiverse-primary)"},toggleThumb:{position:"absolute",top:"2px",left:"2px",width:"20px",height:"20px",background:"white",borderRadius:"50%",transition:"transform 0.2s ease"},toggleThumbActive:{transform:"translateX(20px)"},warningBox:{display:"flex",gap:"12px",padding:"12px",background:"rgba(255, 152, 0, 0.1)",border:"1px solid rgba(255, 152, 0, 0.3)",borderRadius:"8px",marginTop:"12px"},warningIcon:{color:"#ff9800",flexShrink:0},warningContent:{flex:1},warningTitle:{fontSize:"12px",fontWeight:600,color:"#ff9800",marginBottom:"4px"},warningText:{fontSize:"11px",color:"var(--lumiverse-text-muted)",lineHeight:1.4},testSection:{marginBottom:"20px",padding:"14px",background:"rgba(147, 112, 219, 0.08)",borderRadius:"10px",border:"1px solid rgba(147, 112, 219, 0.2)"},testButton:{width:"100%",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",padding:"12px",fontSize:"14px",fontWeight:500,background:"var(--lumiverse-primary)",color:"white",border:"none",borderRadius:"8px",cursor:"pointer"},testButtonDisabled:{opacity:.5,cursor:"not-allowed"},testResult:{display:"flex",alignItems:"flex-start",gap:"10px",padding:"12px",borderRadius:"8px",marginTop:"12px"},testResultSuccess:{background:"rgba(76, 175, 80, 0.1)",border:"1px solid rgba(76, 175, 80, 0.3)"},testResultError:{background:"rgba(244, 67, 54, 0.1)",border:"1px solid rgba(244, 67, 54, 0.3)"},footer:{display:"flex",justifyContent:"flex-end",gap:"8px",padding:"12px 20px",borderTop:"1px solid var(--lumiverse-border)",flexShrink:0},button:{padding:"10px 16px",fontSize:"13px",fontWeight:500,borderRadius:"8px",border:"none",cursor:"pointer",transition:"all 0.2s ease"},buttonSecondary:{background:"var(--lumiverse-surface)",color:"var(--lumiverse-text)",border:"1px solid var(--lumiverse-border)"},buttonPrimary:{background:"var(--lumiverse-primary)",color:"white"},hidden:{display:"none"}};const df=function(e){var n,t;let{onClose:r}=e;const i=Ye,o=Xe(),a=i.getState(),s=a.summarization||{},l=s.secondary||{},c=a.messageTruncation||{},[u,d]=(0,Ce.useState)(s.mode||"disabled"),[m,p]=(0,Ce.useState)(s.apiSource||"main"),[g,h]=(0,Ce.useState)(s.autoInterval||10),[v,f]=(0,Ce.useState)(s.autoMessageContext||10),[b,x]=(0,Ce.useState)(s.manualMessageContext||10),[y,k]=(0,Ce.useState)(l.provider||"openai"),[w,j]=(0,Ce.useState)(l.model||""),[C,S]=(0,Ce.useState)(l.endpoint||""),[N,E]=(0,Ce.useState)(l.apiKey||""),[P,D]=(0,Ce.useState)(l.temperature||.7),[M,O]=(0,Ce.useState)(void 0!==l.topP?l.topP:1),[T,A]=(0,Ce.useState)(l.maxTokens||8192),[L,z]=(0,Ce.useState)(c.enabled||!1),[I,R]=(0,Ce.useState)(null!==(n=c.keepCount)&&void 0!==n?n:50),[B,_]=(0,Ce.useState)(!1),[F,U]=(0,Ce.useState)(null),H=(0,Ce.useCallback)(()=>{const e={summarization:{mode:u,apiSource:m,autoInterval:parseInt(g,10)||10,autoMessageContext:parseInt(v,10)||10,manualMessageContext:parseInt(b,10)||10,secondary:{provider:y,model:w,endpoint:C,apiKey:N,temperature:parseFloat(P)||.7,topP:parseFloat(M)||1,maxTokens:(e=>{const n=parseInt(e,10);return isNaN(n)?8192:Math.max(256,n)})(T)}},messageTruncation:{enabled:L,keepCount:parseInt(I,10)||50}};o.setSettings(e),qe(),window.toastr&&window.toastr.success("Summarization settings saved!"),r()},[u,m,g,v,b,y,w,C,N,P,M,T,L,I,o,r]),W=(0,Ce.useCallback)(async()=>{_(!0),U(null);try{var e,n;const t=null===(e=window.LumiverseBridge)||void 0===e||null===(n=e.getCallbacks)||void 0===n?void 0:n.call(e);if(null!=t&&t.generateSummary){const e={mode:u,apiSource:m,autoInterval:parseInt(g,10)||10,autoMessageContext:parseInt(v,10)||10,manualMessageContext:parseInt(b,10)||10,secondary:{provider:y,model:w,endpoint:C,apiKey:N,temperature:parseFloat(P)||.7,topP:parseFloat(M)||1,maxTokens:parseInt(T,10)||8192}};await t.generateSummary(e,!0)?(U({success:!0,message:"Summary woven successfully! Saved to chat metadata."}),window.toastr&&window.toastr.success("Summary generated and saved to chat metadata!")):U({success:!1,message:"No summary generated. Check console for details."})}else U({success:!1,message:"Summary generation not available."})}catch(e){console.error("[SummarizationModal] Test error:",e),U({success:!1,message:e.message||"Failed to generate summary"})}finally{_(!1)}},[u,m,g,v,b,y,w,C,N,P,M,T]),V=(()=>{try{var e,n;const t=null===(e=window.SillyTavern)||void 0===e||null===(n=e.getContext)||void 0===n?void 0:n.call(e);return(null==t?void 0:t.chat)&&t.chat.length>0}catch(e){return!1}})();return(0,Ee.jsxs)("div",{style:uf.layout,children:[(0,Ee.jsxs)("div",{style:uf.header,children:[(0,Ee.jsx)("div",{style:uf.headerIcon,children:(0,Ee.jsx)(nf,{size:20,strokeWidth:1.5})}),(0,Ee.jsxs)("div",{style:uf.headerText,children:[(0,Ee.jsx)("h3",{style:uf.title,children:"Summarization"}),(0,Ee.jsx)("p",{style:uf.subtitle,children:"Configure story summarization settings"})]})]}),(0,Ee.jsxs)("div",{style:uf.scrollArea,children:[(0,Ee.jsxs)("div",{style:uf.section,children:[(0,Ee.jsxs)("div",{style:uf.sectionHeader,children:[(0,Ee.jsx)(vr,{size:16,style:uf.sectionIcon}),(0,Ee.jsx)("span",{children:"Mode"})]}),(0,Ee.jsx)("div",{style:uf.modeOptions,children:["disabled","auto","manual"].map(e=>(0,Ee.jsx)("button",{type:"button",style:sf(sf({},uf.modeOption),u===e?uf.modeOptionSelected:{}),onClick:()=>d(e),children:e.charAt(0).toUpperCase()+e.slice(1)},e))})]}),"auto"===u&&(0,Ee.jsxs)("div",{style:uf.section,children:[(0,Ee.jsxs)("div",{style:uf.sectionHeader,children:[(0,Ee.jsx)(vt,{size:16,style:uf.sectionIcon}),(0,Ee.jsx)("span",{children:"Auto Settings"})]}),(0,Ee.jsxs)("div",{style:uf.fieldRow,children:[(0,Ee.jsxs)("div",{style:uf.field,children:[(0,Ee.jsx)("label",{style:uf.label,children:"Interval"}),(0,Ee.jsx)("input",{type:"number",style:uf.input,min:"1",value:g,onChange:e=>h(e.target.value)}),(0,Ee.jsx)("div",{style:uf.hint,children:"Every N messages"})]}),(0,Ee.jsxs)("div",{style:uf.field,children:[(0,Ee.jsx)("label",{style:uf.label,children:"Context"}),(0,Ee.jsx)("input",{type:"number",style:uf.input,min:"1",max:"100",value:v,onChange:e=>f(e.target.value)}),(0,Ee.jsx)("div",{style:uf.hint,children:"Messages to include"})]})]})]}),("manual"===u||"auto"===u)&&(0,Ee.jsxs)("div",{style:uf.section,children:[(0,Ee.jsxs)("div",{style:uf.sectionHeader,children:[(0,Ee.jsx)(tf,{size:16,style:uf.sectionIcon}),(0,Ee.jsx)("span",{children:"Manual Context"})]}),(0,Ee.jsxs)("div",{style:uf.field,children:[(0,Ee.jsx)("label",{style:uf.label,children:"Messages to include"}),(0,Ee.jsx)("input",{type:"number",style:uf.input,min:"1",max:"100",value:b,onChange:e=>x(e.target.value)}),(0,Ee.jsx)("div",{style:uf.hint,children:"When using /loom-summarize command"})]})]}),(0,Ee.jsxs)("div",{style:uf.section,children:[(0,Ee.jsxs)("div",{style:uf.sectionHeader,children:[(0,Ee.jsx)(lt,{size:16,style:uf.sectionIcon}),(0,Ee.jsx)("span",{children:"API Source"})]}),(0,Ee.jsxs)("div",{style:uf.modeOptions,children:[(0,Ee.jsx)("button",{type:"button",style:sf(sf({},uf.modeOption),"main"===m?uf.modeOptionSelected:{}),onClick:()=>p("main"),children:"Main API"}),(0,Ee.jsx)("button",{type:"button",style:sf(sf({},uf.modeOption),"secondary"===m?uf.modeOptionSelected:{}),onClick:()=>p("secondary"),children:"Secondary LLM"})]})]}),"secondary"===m&&(0,Ee.jsxs)("div",{style:uf.section,children:[(0,Ee.jsxs)("div",{style:uf.sectionHeader,children:[(0,Ee.jsx)(rf,{size:16,style:uf.sectionIcon}),(0,Ee.jsx)("span",{children:"Secondary LLM"})]}),(0,Ee.jsxs)("div",{style:uf.field,children:[(0,Ee.jsx)("label",{style:uf.label,children:"Provider"}),(0,Ee.jsx)("select",{style:uf.select,value:y,onChange:e=>k(e.target.value),children:Object.entries(cf).map(e=>{let[n,t]=e;return(0,Ee.jsx)("option",{value:n,children:t.name},n)})}),"custom"!==y&&(0,Ee.jsx)("div",{style:uf.hint,children:"Uses API key from SillyTavern settings"})]}),(0,Ee.jsxs)("div",{style:uf.field,children:[(0,Ee.jsx)("label",{style:uf.label,children:"Model"}),(0,Ee.jsx)("input",{type:"text",style:uf.input,placeholder:(null===(t=cf[y])||void 0===t?void 0:t.placeholder)||"model-name",value:w,onChange:e=>j(e.target.value)})]}),"custom"===y&&(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsxs)("div",{style:uf.field,children:[(0,Ee.jsx)("label",{style:uf.label,children:"Endpoint URL"}),(0,Ee.jsx)("input",{type:"text",style:uf.input,placeholder:"https://your-api.com/v1/chat/completions",value:C,onChange:e=>S(e.target.value)})]}),(0,Ee.jsxs)("div",{style:uf.field,children:[(0,Ee.jsx)("label",{style:uf.label,children:"API Key"}),(0,Ee.jsx)("input",{type:"password",style:uf.input,placeholder:"Your API key",value:N,onChange:e=>E(e.target.value)})]})]}),(0,Ee.jsxs)("div",{style:uf.fieldRow3,children:[(0,Ee.jsxs)("div",{style:uf.field,children:[(0,Ee.jsx)("label",{style:uf.label,children:"Temp"}),(0,Ee.jsx)("input",{type:"number",style:uf.input,min:"0",max:"2",step:"0.1",value:P,onChange:e=>D(e.target.value)})]}),(0,Ee.jsxs)("div",{style:uf.field,children:[(0,Ee.jsx)("label",{style:uf.label,children:"Top-P"}),(0,Ee.jsx)("input",{type:"number",style:uf.input,min:"0",max:"1",step:"0.05",value:M,onChange:e=>O(e.target.value)})]}),(0,Ee.jsxs)("div",{style:uf.field,children:[(0,Ee.jsx)("label",{style:uf.label,children:"Max Tokens"}),(0,Ee.jsx)("input",{type:"number",style:uf.input,value:T,onChange:e=>A(e.target.value)})]})]})]}),(0,Ee.jsxs)("div",{style:uf.testSection,children:[(0,Ee.jsxs)("div",{style:uf.sectionHeader,children:[(0,Ee.jsx)(of,{size:16,style:uf.sectionIcon}),(0,Ee.jsx)("span",{children:"Test"})]}),(0,Ee.jsx)("button",{type:"button",style:sf(sf({},uf.testButton),!V||B?uf.testButtonDisabled:{}),onClick:W,disabled:!V||B,children:B?(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsx)(gt,{size:16,style:{animation:"spin 1s linear infinite"}}),(0,Ee.jsx)("span",{children:"Weaving summary..."})]}):(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsx)(zd,{size:16}),(0,Ee.jsx)("span",{children:V?"Generate Summary Now":"No Active Chat"})]})}),F&&(0,Ee.jsxs)("div",{style:sf(sf({},uf.testResult),F.success?uf.testResultSuccess:uf.testResultError),children:[F.success?(0,Ee.jsx)(zd,{size:16,style:{color:"#4caf50"}}):(0,Ee.jsx)(mt,{size:16,style:{color:"#f44336"}}),(0,Ee.jsx)("span",{style:{fontSize:"12px",color:"var(--lumiverse-text)"},children:F.message})]}),!V&&(0,Ee.jsx)("div",{style:sf(sf({},uf.hint),{},{marginTop:"8px",textAlign:"center"}),children:"Open a chat to test summarization"})]}),(0,Ee.jsxs)("div",{style:uf.section,children:[(0,Ee.jsxs)("div",{style:uf.sectionHeader,children:[(0,Ee.jsx)(ur,{size:16,style:uf.sectionIcon}),(0,Ee.jsx)("span",{children:"Save N Messages"})]}),(0,Ee.jsxs)("div",{style:uf.toggleRow,children:[(0,Ee.jsxs)("div",{style:uf.toggleLabel,children:[(0,Ee.jsx)("span",{style:uf.toggleText,children:"Limit Context Messages"}),(0,Ee.jsx)("span",{style:uf.toggleHint,children:"Only send the last N messages to the AI"})]}),(0,Ee.jsx)("div",{style:sf(sf({},uf.toggle),L?uf.toggleActive:{}),onClick:()=>z(!L),children:(0,Ee.jsx)("div",{style:sf(sf({},uf.toggleThumb),L?uf.toggleThumbActive:{})})})]}),L&&(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsxs)("div",{style:uf.field,children:[(0,Ee.jsx)("label",{style:uf.label,children:"Messages to keep"}),(0,Ee.jsx)("input",{type:"number",style:uf.input,min:"5",max:"500",value:I,onChange:e=>R(e.target.value)}),(0,Ee.jsx)("div",{style:uf.hint,children:"Number of recent messages to include in context"})]}),(0,Ee.jsxs)("div",{style:uf.warningBox,children:[(0,Ee.jsx)(mr,{size:20,style:uf.warningIcon}),(0,Ee.jsxs)("div",{style:uf.warningContent,children:[(0,Ee.jsx)("div",{style:uf.warningTitle,children:"Memory Loss Warning"}),(0,Ee.jsx)("div",{style:uf.warningText,children:"Older messages beyond this limit will be excluded from the AI's context. The AI will lose awareness of earlier events, character details, and plot points. Consider using Loom summarization to preserve important memories."})]})]})]})]})]}),(0,Ee.jsxs)("div",{style:uf.footer,children:[(0,Ee.jsx)("button",{type:"button",style:sf(sf({},uf.button),uf.buttonSecondary),onClick:r,children:"Cancel"}),(0,Ee.jsx)("button",{type:"button",style:sf(sf({},uf.button),uf.buttonPrimary),onClick:H,children:"Save Changes"})]}),(0,Ee.jsx)("style",{children:"\n                @keyframes spin {\n                    from { transform: rotate(0deg); }\n                    to { transform: rotate(360deg); }\n                }\n            "})]})},mf=Sn("grid-3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]),pf=Sn("funnel",[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]]);function gf(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function hf(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?gf(Object(t),!0).forEach(function(n){vf(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):gf(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function vf(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const ff={layout:{display:"flex",flexDirection:"column",height:"100%",maxHeight:"100%",minHeight:0},header:{display:"flex",alignItems:"center",gap:"12px",padding:"16px 20px",borderBottom:"1px solid var(--lumiverse-border)",flexShrink:0},headerIcon:{display:"flex",alignItems:"center",justifyContent:"center",width:"40px",height:"40px",borderRadius:"10px",background:"linear-gradient(135deg, rgba(147, 112, 219, 0.2), rgba(147, 112, 219, 0.1))",color:"var(--lumiverse-primary)"},headerText:{flex:1},title:{margin:0,fontSize:"16px",fontWeight:600,color:"var(--lumiverse-text)"},subtitle:{margin:"4px 0 0",fontSize:"12px",color:"var(--lumiverse-text-muted)"},scrollArea:{flex:"1 1 auto",minHeight:0,overflowY:"auto",padding:"16px 20px"},section:{marginBottom:"16px",background:"rgba(0, 0, 0, 0.15)",borderRadius:"10px",border:"1px solid var(--lumiverse-border)",overflow:"hidden"},sectionHeader:{display:"flex",alignItems:"center",gap:"10px",padding:"12px 14px",cursor:"pointer",transition:"background 0.2s ease"},sectionHeaderIcon:{display:"flex",alignItems:"center",justifyContent:"center",width:"28px",height:"28px",borderRadius:"6px",background:"rgba(147, 112, 219, 0.15)",color:"var(--lumiverse-primary)"},sectionHeaderText:{flex:1,fontSize:"14px",fontWeight:500,color:"var(--lumiverse-text)"},statusBadge:{fontSize:"10px",fontWeight:600,padding:"3px 8px",borderRadius:"10px",textTransform:"uppercase",letterSpacing:"0.5px"},statusActive:{background:"rgba(76, 175, 80, 0.15)",color:"#4caf50"},statusInactive:{background:"rgba(158, 158, 158, 0.15)",color:"#9e9e9e"},collapseIcon:{color:"var(--lumiverse-text-muted)",transition:"transform 0.2s ease"},sectionContent:{padding:"0 14px 14px"},description:{fontSize:"12px",color:"var(--lumiverse-text-muted)",marginBottom:"12px",lineHeight:1.5},toggleRow:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px 0",borderBottom:"1px solid var(--lumiverse-border)"},toggleRowLast:{borderBottom:"none"},toggleRowDisabled:{opacity:.5},toggleLabel:{flex:1},toggleText:{display:"block",fontSize:"13px",fontWeight:500,color:"var(--lumiverse-text)"},toggleHint:{display:"block",fontSize:"11px",color:"var(--lumiverse-text-muted)",marginTop:"2px"},toggle:{position:"relative",width:"44px",height:"24px",background:"rgba(0, 0, 0, 0.3)",borderRadius:"12px",cursor:"pointer",transition:"background 0.2s ease",flexShrink:0},toggleActive:{background:"var(--lumiverse-primary)"},toggleThumb:{position:"absolute",top:"2px",left:"2px",width:"20px",height:"20px",background:"white",borderRadius:"50%",transition:"transform 0.2s ease"},toggleThumbActive:{transform:"translateX(20px)"},infoBox:{background:"rgba(147, 112, 219, 0.08)",border:"1px solid rgba(147, 112, 219, 0.2)",borderRadius:"8px",padding:"12px",marginTop:"12px"},infoBoxMuted:{opacity:.6},infoBoxHeader:{display:"flex",alignItems:"center",gap:"6px",fontSize:"12px",fontWeight:500,color:"var(--lumiverse-primary)",marginBottom:"8px"},infoBoxList:{margin:0,padding:"0 0 0 16px",fontSize:"11px",color:"var(--lumiverse-text-muted)",lineHeight:1.6},infoBoxCode:{fontFamily:"monospace",background:"rgba(0, 0, 0, 0.2)",padding:"1px 4px",borderRadius:"3px",fontSize:"10px"},filterItem:{marginBottom:"12px"},filterOptions:{marginTop:"10px",padding:"10px 12px",background:"rgba(0, 0, 0, 0.1)",borderRadius:"6px"},filterOptionsHidden:{display:"none"},subFilterItem:{marginTop:"10px",paddingTop:"10px",borderTop:"1px dashed var(--lumiverse-border)"},field:{marginBottom:"8px"},label:{display:"flex",alignItems:"center",gap:"8px",fontSize:"12px",fontWeight:500,color:"var(--lumiverse-text)",marginBottom:"6px"},input:{width:"80px",padding:"8px 10px",fontSize:"13px",background:"var(--lumiverse-input-bg)",border:"1px solid var(--lumiverse-border)",borderRadius:"6px",color:"var(--lumiverse-text)",outline:"none"},hint:{fontSize:"10px",color:"var(--lumiverse-text-muted)",marginTop:"4px"},footer:{display:"flex",justifyContent:"flex-end",gap:"8px",padding:"12px 20px",borderTop:"1px solid var(--lumiverse-border)",flexShrink:0},button:{padding:"10px 16px",fontSize:"13px",fontWeight:500,borderRadius:"8px",border:"none",cursor:"pointer",transition:"all 0.2s ease"},buttonSecondary:{background:"var(--lumiverse-surface)",color:"var(--lumiverse-text)",border:"1px solid var(--lumiverse-border)"},buttonPrimary:{background:"var(--lumiverse-primary)",color:"white"},headerCloseBtn:{display:"flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",borderRadius:"8px",border:"none",background:"transparent",color:"var(--lumiverse-text-muted)",cursor:"pointer",marginLeft:"4px",transition:"all 0.15s ease"}};function bf(e){let{checked:n,onChange:t,disabled:r}=e;return(0,Ee.jsx)("div",{style:hf(hf(hf({},ff.toggle),n?ff.toggleActive:{}),r?{opacity:.5,cursor:"not-allowed"}:{}),onClick:()=>!r&&t(!n),children:(0,Ee.jsx)("div",{style:hf(hf({},ff.toggleThumb),n?ff.toggleThumbActive:{})})})}const xf=function(e){let{onClose:n}=e;const t=Ye,r=Xe(),i=t.getState(),o=i.sovereignHand||{},a=i.contextFilters||{},s=a.htmlTags||{},l=a.detailsBlocks||{},c=a.loomItems||{},[u,d]=(0,Ce.useState)(!0),[m,p]=(0,Ce.useState)(!0),[g,h]=(0,Ce.useState)(o.enabled||!1),[v,f]=(0,Ce.useState)(!1!==o.excludeLastMessage),[b,x]=(0,Ce.useState)(!1!==o.includeMessageInPrompt),[y,k]=(0,Ce.useState)(s.enabled||!1),[w,j]=(0,Ce.useState)(s.keepDepth||3),[C,S]=(0,Ce.useState)(s.stripFonts||!1),[N,E]=(0,Ce.useState)(s.fontKeepDepth||3),[P,D]=(0,Ce.useState)(l.enabled||!1),[M,O]=(0,Ce.useState)(l.keepDepth||3),[T,A]=(0,Ce.useState)(c.enabled||!1),[L,z]=(0,Ce.useState)(c.keepDepth||5),I=(0,Ce.useCallback)(()=>{const e={sovereignHand:{enabled:g,excludeLastMessage:v,includeMessageInPrompt:b},contextFilters:{htmlTags:{enabled:y,keepDepth:parseInt(w,10)||3,stripFonts:C,fontKeepDepth:parseInt(N,10)||3},detailsBlocks:{enabled:P,keepDepth:parseInt(M,10)||3},loomItems:{enabled:T,keepDepth:parseInt(L,10)||5}}};r.setSettings(e),qe(),window.toastr&&window.toastr.success("Prompt settings saved!"),n()},[g,v,b,y,w,C,N,P,M,T,L,r,n]),R=y||P||T;return(0,Ee.jsxs)("div",{style:ff.layout,children:[(0,Ee.jsxs)("div",{style:ff.header,children:[(0,Ee.jsx)("div",{style:ff.headerIcon,children:(0,Ee.jsx)(tf,{size:20,strokeWidth:1.5})}),(0,Ee.jsxs)("div",{style:ff.headerText,children:[(0,Ee.jsx)("h3",{style:ff.title,children:"Prompt Settings"}),(0,Ee.jsx)("p",{style:ff.subtitle,children:"Configure advanced prompt features"})]}),(0,Ee.jsx)("button",{style:ff.headerCloseBtn,onClick:n,title:"Close modal",children:(0,Ee.jsx)(mt,{size:20})})]}),(0,Ee.jsxs)("div",{style:ff.scrollArea,children:[(0,Ee.jsxs)("div",{style:ff.section,children:[(0,Ee.jsxs)("div",{style:ff.sectionHeader,onClick:()=>d(!u),children:[(0,Ee.jsx)("div",{style:ff.sectionHeaderIcon,children:(0,Ee.jsx)(mf,{size:16,strokeWidth:1.5})}),(0,Ee.jsx)("span",{style:ff.sectionHeaderText,children:"Sovereign Hand"}),(0,Ee.jsx)("span",{style:hf(hf({},ff.statusBadge),g?ff.statusActive:ff.statusInactive),children:g?"Active":"Inactive"}),u?(0,Ee.jsx)(xm,{size:16,style:ff.collapseIcon}):(0,Ee.jsx)(Tn,{size:16,style:ff.collapseIcon})]}),u&&(0,Ee.jsxs)("div",{style:ff.sectionContent,children:[(0,Ee.jsx)("p",{style:ff.description,children:"Enable Sovereign Hand integration to use advanced prompt manipulation features."}),(0,Ee.jsxs)("div",{style:ff.toggleRow,children:[(0,Ee.jsxs)("div",{style:ff.toggleLabel,children:[(0,Ee.jsx)("span",{style:ff.toggleText,children:"Use Sovereign Hand Features"}),(0,Ee.jsx)("span",{style:ff.toggleHint,children:"Enables Sovereign Hand macros for advanced prompt control"})]}),(0,Ee.jsx)(bf,{checked:g,onChange:h})]}),(0,Ee.jsxs)("div",{style:hf(hf({},ff.toggleRow),g?{}:ff.toggleRowDisabled),children:[(0,Ee.jsxs)("div",{style:ff.toggleLabel,children:[(0,Ee.jsx)("span",{style:ff.toggleText,children:"Exclude Last Message from Context"}),(0,Ee.jsx)("span",{style:ff.toggleHint,children:"When enabled, removes the last user message from the outgoing context"})]}),(0,Ee.jsx)(bf,{checked:v,onChange:f,disabled:!g})]}),(0,Ee.jsxs)("div",{style:hf(hf(hf({},ff.toggleRow),ff.toggleRowLast),g?{}:ff.toggleRowDisabled),children:[(0,Ee.jsxs)("div",{style:ff.toggleLabel,children:[(0,Ee.jsx)("span",{style:ff.toggleText,children:"Include Message in Master Prompt"}),(0,Ee.jsxs)("span",{style:ff.toggleHint,children:["When enabled, includes the user message in the ","{{loomSovHand}}"," macro output"]})]}),(0,Ee.jsx)(bf,{checked:b,onChange:x,disabled:!g})]}),(0,Ee.jsxs)("div",{style:hf(hf({},ff.infoBox),g?{}:ff.infoBoxMuted),children:[(0,Ee.jsxs)("div",{style:ff.infoBoxHeader,children:[(0,Ee.jsx)(Rd,{size:14}),(0,Ee.jsx)("span",{children:"Available macros:"})]}),(0,Ee.jsxs)("ul",{style:ff.infoBoxList,children:[(0,Ee.jsxs)("li",{children:[(0,Ee.jsx)("code",{style:ff.infoBoxCode,children:"{{loomLastUserMessage}}"})," returns the last user message content"]}),(0,Ee.jsxs)("li",{children:[(0,Ee.jsx)("code",{style:ff.infoBoxCode,children:"{{loomLastCharMessage}}"})," returns the last character message content"]}),(0,Ee.jsxs)("li",{children:[(0,Ee.jsx)("code",{style:ff.infoBoxCode,children:"{{lastMessageName}}"})," returns the name of whoever sent the last message"]}),(0,Ee.jsxs)("li",{children:[(0,Ee.jsx)("code",{style:ff.infoBoxCode,children:"{{loomContinuePrompt}}"})," adds continuation instructions when character spoke last"]})]})]})]})]}),(0,Ee.jsxs)("div",{style:ff.section,children:[(0,Ee.jsxs)("div",{style:ff.sectionHeader,onClick:()=>p(!m),children:[(0,Ee.jsx)("div",{style:ff.sectionHeaderIcon,children:(0,Ee.jsx)(pf,{size:16,strokeWidth:1.5})}),(0,Ee.jsx)("span",{style:ff.sectionHeaderText,children:"Context Filters"}),(0,Ee.jsx)("span",{style:hf(hf({},ff.statusBadge),R?ff.statusActive:ff.statusInactive),children:R?"Active":"Inactive"}),m?(0,Ee.jsx)(xm,{size:16,style:ff.collapseIcon}):(0,Ee.jsx)(Tn,{size:16,style:ff.collapseIcon})]}),m&&(0,Ee.jsxs)("div",{style:ff.sectionContent,children:[(0,Ee.jsx)("p",{style:ff.description,children:"Filter out specific content from the chat context before sending to the AI. Helps reduce token usage and keep prompts clean."}),(0,Ee.jsxs)("div",{style:ff.filterItem,children:[(0,Ee.jsxs)("div",{style:ff.toggleRow,children:[(0,Ee.jsxs)("div",{style:ff.toggleLabel,children:[(0,Ee.jsx)("span",{style:ff.toggleText,children:"Strip HTML Tags"}),(0,Ee.jsx)("span",{style:ff.toggleHint,children:"Removes formatting tags: <div>, <span>, <b>, <i>, <u>, <em>, <strong>"})]}),(0,Ee.jsx)(bf,{checked:y,onChange:k})]}),y&&(0,Ee.jsxs)("div",{style:ff.filterOptions,children:[(0,Ee.jsxs)("div",{style:ff.field,children:[(0,Ee.jsxs)("label",{style:ff.label,children:[(0,Ee.jsx)("span",{children:"Keep HTML in last N messages:"}),(0,Ee.jsx)("input",{type:"number",style:ff.input,min:"0",max:"100",value:w,onChange:e=>j(e.target.value)})]}),(0,Ee.jsx)("div",{style:ff.hint,children:"HTML tags in older messages will be stripped to save tokens"})]}),(0,Ee.jsxs)("div",{style:ff.subFilterItem,children:[(0,Ee.jsxs)("div",{style:ff.toggleRow,children:[(0,Ee.jsxs)("div",{style:ff.toggleLabel,children:[(0,Ee.jsx)("span",{style:ff.toggleText,children:"Also Strip Fonts"}),(0,Ee.jsx)("span",{style:ff.toggleHint,children:"Remove <font> tags (used by some presets for colored dialogue)"})]}),(0,Ee.jsx)(bf,{checked:C,onChange:S})]}),C&&(0,Ee.jsx)("div",{style:{marginTop:"8px"},children:(0,Ee.jsxs)("label",{style:ff.label,children:[(0,Ee.jsx)("span",{children:"Keep fonts in last N messages:"}),(0,Ee.jsx)("input",{type:"number",style:ff.input,min:"0",max:"100",value:N,onChange:e=>E(e.target.value)})]})})]})]})]}),(0,Ee.jsxs)("div",{style:ff.filterItem,children:[(0,Ee.jsxs)("div",{style:ff.toggleRow,children:[(0,Ee.jsxs)("div",{style:ff.toggleLabel,children:[(0,Ee.jsx)("span",{style:ff.toggleText,children:"Filter Details Blocks"}),(0,Ee.jsx)("span",{style:ff.toggleHint,children:"Removes <details> blocks from older messages to save context"})]}),(0,Ee.jsx)(bf,{checked:P,onChange:D})]}),P&&(0,Ee.jsx)("div",{style:ff.filterOptions,children:(0,Ee.jsxs)("div",{style:ff.field,children:[(0,Ee.jsxs)("label",{style:ff.label,children:[(0,Ee.jsx)("span",{children:"Keep in last N messages:"}),(0,Ee.jsx)("input",{type:"number",style:ff.input,min:"0",max:"100",value:M,onChange:e=>O(e.target.value)})]}),(0,Ee.jsx)("div",{style:ff.hint,children:"Messages beyond this depth will have <details> blocks removed"})]})})]}),(0,Ee.jsxs)("div",{style:ff.filterItem,children:[(0,Ee.jsxs)("div",{style:hf(hf({},ff.toggleRow),ff.toggleRowLast),children:[(0,Ee.jsxs)("div",{style:ff.toggleLabel,children:[(0,Ee.jsx)("span",{style:ff.toggleText,children:"Filter Loom Tags"}),(0,Ee.jsx)("span",{style:ff.toggleHint,children:"Removes Lucid Loom-related tags from older messages"})]}),(0,Ee.jsx)(bf,{checked:T,onChange:A})]}),T&&(0,Ee.jsx)("div",{style:ff.filterOptions,children:(0,Ee.jsxs)("div",{style:ff.field,children:[(0,Ee.jsxs)("label",{style:ff.label,children:[(0,Ee.jsx)("span",{children:"Keep in last N messages:"}),(0,Ee.jsx)("input",{type:"number",style:ff.input,min:"0",max:"100",value:L,onChange:e=>z(e.target.value)})]}),(0,Ee.jsx)("div",{style:ff.hint,children:"Loom tags in older messages will be stripped to save tokens"})]})})]})]})]})]}),(0,Ee.jsxs)("div",{style:ff.footer,children:[(0,Ee.jsx)("button",{type:"button",style:hf(hf({},ff.button),ff.buttonSecondary),onClick:n,children:"Cancel"}),(0,Ee.jsx)("button",{type:"button",style:hf(hf({},ff.button),ff.buttonPrimary),onClick:I,children:"Save Changes"})]})]})},yf=Sn("box",[["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]),kf=["src","alt","style","objectPosition","className"];function wf(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function jf(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?wf(Object(t),!0).forEach(function(n){Cf(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):wf(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Cf(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const Sf={container:{position:"relative",width:"100%",height:"100%"},image:{width:"100%",height:"100%",objectFit:"cover",transition:"opacity 0.2s ease"},spinner:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",display:"flex",alignItems:"center",justifyContent:"center",color:"var(--lumiverse-primary, #9370db)",opacity:.6,animation:"spin 1s linear infinite"}};const Nf=function(e){let{src:n,alt:t="",style:r={},objectPosition:i="center",className:o=""}=e,a=function(e,n){if(null==e)return{};var t,r,i=function(e,n){if(null==e)return{};var t={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==n.indexOf(r))continue;t[r]=e[r]}return t}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],-1===n.indexOf(t)&&{}.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}(e,kf);const[s,l]=(0,Ce.useState)(!0),[c,u]=(0,Ce.useState)(!1),d=(0,Ce.useCallback)(()=>{l(!1)},[]),m=(0,Ce.useCallback)(()=>{l(!1),u(!0)},[]);return c||!n?null:(0,Ee.jsxs)("div",{style:Sf.container,children:[s&&(0,Ee.jsx)("div",{style:Sf.spinner,children:(0,Ee.jsx)(gt,{size:24,strokeWidth:1.5})}),(0,Ee.jsx)("img",jf({src:n,alt:t,style:jf(jf(jf({},Sf.image),r),{},{objectPosition:i,opacity:s?0:1}),className:o,loading:"lazy",onLoad:d,onError:m},a))]})};function Ef(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function Pf(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Ef(Object(t),!0).forEach(function(n){Df(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Ef(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Df(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const Mf=[{id:"Lumia DLCs",label:"Lumia DLCs",Icon:lr},{id:"Loom Utilities",label:"Utilities",Icon:Td},{id:"Loom Retrofits",label:"Retrofits",Icon:vr},{id:"Loom Narratives",label:"Narratives",Icon:dp}],Of={"Loom Utilities":"loomUtilityCount","Loom Retrofits":"loomRetrofitCount","Loom Narratives":"narrativeStyleCount"},Tf={layout:{display:"flex",flexDirection:"column",height:"100%",maxHeight:"100%",minHeight:0},header:{display:"flex",alignItems:"center",gap:"12px",padding:"16px 20px",borderBottom:"1px solid var(--lumiverse-border)",flexShrink:0},headerIcon:{display:"flex",alignItems:"center",justifyContent:"center",width:"40px",height:"40px",borderRadius:"10px",background:"linear-gradient(135deg, rgba(147, 112, 219, 0.2), rgba(147, 112, 219, 0.1))",color:"var(--lumiverse-primary)"},headerText:{flex:1},title:{margin:0,fontSize:"16px",fontWeight:600,color:"var(--lumiverse-text)"},subtitle:{margin:"4px 0 0",fontSize:"12px",color:"var(--lumiverse-text-muted)"},tabs:{display:"flex",gap:"2px",padding:"0 16px",borderBottom:"1px solid var(--lumiverse-border)",flexShrink:0,overflowX:"auto"},tab:{display:"flex",alignItems:"center",gap:"6px",padding:"12px 14px",fontSize:"12px",fontWeight:500,color:"var(--lumiverse-text-muted)",background:"transparent",border:"none",borderBottom:"2px solid transparent",cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap"},tabActive:{color:"var(--lumiverse-primary)",borderBottomColor:"var(--lumiverse-primary)"},scrollArea:{flex:"1 1 auto",minHeight:0,overflowY:"auto",padding:"16px"},loading:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"12px",padding:"40px",color:"var(--lumiverse-text-muted)"},spinner:{animation:"spin 1s linear infinite"},error:{display:"flex",flexDirection:"column",alignItems:"center",gap:"12px",padding:"40px",textAlign:"center"},errorIcon:{color:"#f44336"},errorText:{fontSize:"13px",color:"var(--lumiverse-text-muted)"},retryButton:{display:"flex",alignItems:"center",gap:"6px",padding:"8px 16px",fontSize:"13px",fontWeight:500,background:"var(--lumiverse-surface)",color:"var(--lumiverse-text)",border:"1px solid var(--lumiverse-border)",borderRadius:"6px",cursor:"pointer"},empty:{textAlign:"center",padding:"40px 20px",fontSize:"13px",color:"var(--lumiverse-text-muted)"},grid:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"16px"},card:{position:"relative",background:"rgba(0, 0, 0, 0.2)",borderRadius:"12px",border:"1px solid var(--lumiverse-border)",overflow:"hidden",cursor:"pointer",transition:"all 0.2s ease"},cardSelected:{borderColor:"var(--lumiverse-primary)",boxShadow:"0 0 0 1px var(--lumiverse-primary)"},cardImported:{opacity:.5},cardImage:{position:"relative",aspectRatio:"3 / 4",background:"rgba(0, 0, 0, 0.3)",display:"flex",alignItems:"center",justifyContent:"center"},cardImg:{width:"100%",height:"100%",objectFit:"cover"},cardPlaceholder:{color:"var(--lumiverse-text-muted)"},cardCheck:{position:"absolute",top:"8px",right:"8px",width:"24px",height:"24px",borderRadius:"50%",background:"var(--lumiverse-primary)",display:"flex",alignItems:"center",justifyContent:"center",color:"white",opacity:0,transform:"scale(0.8)",transition:"all 0.2s ease"},cardCheckVisible:{opacity:1,transform:"scale(1)"},cardInfo:{padding:"12px"},cardTitle:{fontSize:"14px",fontWeight:600,color:"var(--lumiverse-text)",marginBottom:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},cardAuthor:{fontSize:"12px",color:"var(--lumiverse-text-muted)",marginBottom:"6px"},cardCounts:{fontSize:"11px",color:"var(--lumiverse-primary)"},footer:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:"12px",padding:"12px 16px",borderTop:"1px solid var(--lumiverse-border)",flexShrink:0},footerLeft:{display:"flex",alignItems:"center",gap:"8px"},footerButton:{padding:"6px 12px",fontSize:"12px",fontWeight:500,background:"transparent",color:"var(--lumiverse-text-muted)",border:"none",cursor:"pointer",transition:"color 0.2s ease"},footerRight:{display:"flex",alignItems:"center",gap:"12px"},selectedCount:{fontSize:"12px",color:"var(--lumiverse-text-muted)"},button:{padding:"10px 16px",fontSize:"13px",fontWeight:500,borderRadius:"8px",border:"none",cursor:"pointer",transition:"all 0.2s ease"},buttonSecondary:{background:"var(--lumiverse-surface)",color:"var(--lumiverse-text)",border:"1px solid var(--lumiverse-border)"},buttonPrimary:{display:"flex",alignItems:"center",gap:"6px",background:"var(--lumiverse-primary)",color:"white"},buttonDisabled:{opacity:.5,cursor:"not-allowed"}};const Af=function(e){let{onClose:n}=e;const[t,r]=(0,Ce.useState)("Lumia DLCs"),[i,o]=(0,Ce.useState)(!0),[a,s]=(0,Ce.useState)(null),[l,c]=(0,Ce.useState)([]),[u,d]=(0,Ce.useState)([]),[m,p]=(0,Ce.useState)(!1),[g,h]=(0,Ce.useState)({current:0,total:0}),v=(0,Ce.useCallback)(async()=>{o(!0),s(null),d([]);try{const e=await fetch("https://lucid.cards/api/lumia-dlc");if(!e.ok)throw new Error("HTTP error: ".concat(e.status));const n=await e.json();c(n.packs||[])}catch(e){console.error("[LucidCardsModal] Fetch error:",e),s(e.message||"Failed to load content")}finally{o(!1)}},[]);(0,Ce.useEffect)(()=>{v()},[v]);const f=l.filter(e=>{if("Lumia DLCs"===t)return"lumia"===e.packType||e.lumiaCount&&e.lumiaCount>0;const n=Of[t];return n?e[n]&&e[n]>0:"loom"===e.packType||e.loomCount&&e.loomCount>0}),b=(0,Ce.useCallback)(e=>{const n=e.slug;d(t=>t.find(e=>e.slug===n)?t.filter(e=>e.slug!==n):[...t,e])},[]),x=(0,Ce.useCallback)(()=>{d(f)},[f]),y=(0,Ce.useCallback)(()=>{d([])},[]),k=(0,Ce.useCallback)(e=>u.some(n=>n.slug===e.slug),[u]),w=(0,Ce.useCallback)(async()=>{if(0===u.length||m)return;p(!0);const e=u.length;let n=0,t=0,r=0;for(let i=0;i<u.length;i++){const o=u[i];if(h({current:i+1,total:e}),(0,B.getPackByName)(o.packName))t++;else try{const e=await fetch("https://lucid.cards/api/lumia-dlc/".concat(o.slug));if(!e.ok)throw new Error("HTTP error: ".concat(e.status));const t=await e.json();if(!1===t.success)throw new Error(t.error||"Failed to fetch pack");const r=t.pack||t,i={packName:r.packName||o.packName,packAuthor:r.packAuthor||null,coverUrl:r.coverUrl||null,version:r.version||1,packExtras:r.packExtras||[],lumiaItems:r.lumiaItems||[],loomItems:r.loomItems||[],isCustom:!1,url:"https://lucid.cards/api/lumia-dlc/".concat(o.slug)};await(0,B.savePack)(i),n++}catch(e){console.error('[LucidCardsModal] Import failed for "'.concat(o.packName,'":'),e),r++}}const i=[];n>0&&i.push("".concat(n," imported")),t>0&&i.push("".concat(t," skipped (already exist)")),r>0&&i.push("".concat(r," failed")),window.toastr&&(n>0?window.toastr.success("Import complete: ".concat(i.join(", "))):t>0&&0===r?window.toastr.info("All ".concat(t," packs already exist")):window.toastr.error("Import failed: ".concat(i.join(", ")))),p(!1),d([]),h({current:0,total:0})},[u,m]);return(0,Ee.jsxs)("div",{style:Tf.layout,children:[(0,Ee.jsxs)("div",{style:Tf.header,children:[(0,Ee.jsx)("div",{style:Tf.headerIcon,children:(0,Ee.jsx)(yf,{size:20,strokeWidth:1.5})}),(0,Ee.jsxs)("div",{style:Tf.headerText,children:[(0,Ee.jsx)("h3",{style:Tf.title,children:"Lucid Cards Browser"}),(0,Ee.jsx)("p",{style:Tf.subtitle,children:"Browse and import official Lumiverse content"})]})]}),(0,Ee.jsx)("div",{style:Tf.tabs,children:Mf.map(e=>(0,Ee.jsxs)("button",{type:"button",style:Pf(Pf({},Tf.tab),t===e.id?Tf.tabActive:{}),onClick:()=>{r(e.id),d([])},children:[(0,Ee.jsx)(e.Icon,{size:14}),(0,Ee.jsx)("span",{children:e.label})]},e.id))}),(0,Ee.jsx)("div",{style:Tf.scrollArea,children:i?(0,Ee.jsxs)("div",{style:Tf.loading,children:[(0,Ee.jsx)(gt,{size:24,style:Tf.spinner}),(0,Ee.jsx)("span",{children:"Loading content from Lucid.cards..."})]}):a?(0,Ee.jsxs)("div",{style:Tf.error,children:[(0,Ee.jsx)(mt,{size:32,style:Tf.errorIcon}),(0,Ee.jsx)("span",{style:Tf.errorText,children:a}),(0,Ee.jsxs)("button",{type:"button",style:Tf.retryButton,onClick:v,children:[(0,Ee.jsx)(pt,{size:14}),(0,Ee.jsx)("span",{children:"Retry"})]})]}):0===f.length?(0,Ee.jsx)("div",{style:Tf.empty,children:"No items available in this category."}):(0,Ee.jsx)("div",{className:"lumiverse-responsive-card-grid",children:f.map(e=>{const n=k(e),t=[];return e.lumiaCount>0&&t.push("".concat(e.lumiaCount," Lumia")),e.loomCount>0&&t.push("".concat(e.loomCount," Loom")),e.extrasCount>0&&t.push("".concat(e.extrasCount," Extra")),(0,Ee.jsxs)("div",{style:Pf(Pf({},Tf.card),n?Tf.cardSelected:{}),onClick:()=>b(e),children:[(0,Ee.jsxs)("div",{style:Tf.cardImage,children:[e.coverUrl?(0,Ee.jsx)(Nf,{src:e.coverUrl,alt:"",style:Tf.cardImg}):(0,Ee.jsx)(yf,{size:32,style:Tf.cardPlaceholder}),(0,Ee.jsx)("div",{style:Pf(Pf({},Tf.cardCheck),n?Tf.cardCheckVisible:{}),children:(0,Ee.jsx)(zd,{size:14})})]}),(0,Ee.jsxs)("div",{style:Tf.cardInfo,children:[(0,Ee.jsx)("div",{style:Tf.cardTitle,children:e.packName||"Unknown"}),(0,Ee.jsx)("div",{style:Tf.cardAuthor,children:e.packAuthor||"Unknown Author"}),t.length>0&&(0,Ee.jsx)("div",{style:Tf.cardCounts,children:t.join(", ")})]})]},e.slug)})})}),(0,Ee.jsxs)("div",{style:Tf.footer,children:[(0,Ee.jsx)("button",{type:"button",style:Pf(Pf({},Tf.button),Tf.buttonSecondary),onClick:n,children:"Close"}),(0,Ee.jsxs)("div",{style:Tf.footerRight,children:[u.length>0&&(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsxs)("div",{style:Tf.footerLeft,children:[(0,Ee.jsx)("button",{type:"button",style:Tf.footerButton,onClick:x,children:"Select All"}),(0,Ee.jsx)("button",{type:"button",style:Tf.footerButton,onClick:y,children:"Clear"})]}),(0,Ee.jsxs)("span",{style:Tf.selectedCount,children:[u.length," selected"]})]}),u.length>0&&(0,Ee.jsx)("button",{type:"button",style:Pf(Pf(Pf({},Tf.button),Tf.buttonPrimary),m?Tf.buttonDisabled:{}),onClick:w,disabled:m,children:m?(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsx)(gt,{size:14,style:Tf.spinner}),(0,Ee.jsxs)("span",{children:["Importing ",g.current," of ",g.total,"..."]})]}):(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsx)(Dn,{size:14}),(0,Ee.jsxs)("span",{children:["Import ",1===u.length?"Pack":"".concat(u.length," Packs")]})]})})]})]}),(0,Ee.jsx)("style",{children:"\n                @keyframes spin {\n                    from { transform: rotate(0deg); }\n                    to { transform: rotate(360deg); }\n                }\n            "})]})},Lf=Sn("globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);function zf(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function If(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?zf(Object(t),!0).forEach(function(n){Rf(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):zf(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Rf(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const Bf="lumiverseLoomSummary",_f={layout:{display:"flex",flexDirection:"column",height:"100%",maxHeight:"100%",minHeight:0},header:{display:"flex",alignItems:"center",gap:"12px",padding:"16px 20px",borderBottom:"1px solid var(--lumiverse-border)",flexShrink:0},headerIcon:{display:"flex",alignItems:"center",justifyContent:"center",width:"40px",height:"40px",borderRadius:"10px",background:"linear-gradient(135deg, rgba(147, 112, 219, 0.2), rgba(147, 112, 219, 0.1))",color:"var(--lumiverse-primary)"},headerText:{flex:1},title:{margin:0,fontSize:"16px",fontWeight:600,color:"var(--lumiverse-text)"},scrollArea:{flex:"1 1 auto",minHeight:0,overflowY:"auto",padding:"16px 20px",display:"flex",flexDirection:"column",gap:"12px"},status:{display:"flex",alignItems:"center",gap:"8px",padding:"10px 12px",borderRadius:"8px",fontSize:"12px"},statusExists:{background:"rgba(76, 175, 80, 0.1)",border:"1px solid rgba(76, 175, 80, 0.3)",color:"#4caf50"},statusEmpty:{background:"rgba(255, 152, 0, 0.1)",border:"1px solid rgba(255, 152, 0, 0.3)",color:"#ff9800"},textarea:{flex:1,minHeight:"200px",padding:"14px",fontSize:"13px",lineHeight:1.6,fontFamily:"inherit",background:"var(--lumiverse-input-bg)",border:"1px solid var(--lumiverse-border)",borderRadius:"10px",color:"var(--lumiverse-text)",resize:"vertical",outline:"none",transition:"border-color 0.2s ease"},footer:{display:"flex",justifyContent:"space-between",gap:"8px",padding:"12px 20px",borderTop:"1px solid var(--lumiverse-border)",flexShrink:0},footerLeft:{display:"flex",gap:"8px"},footerRight:{display:"flex",gap:"8px"},button:{display:"flex",alignItems:"center",gap:"6px",padding:"10px 16px",fontSize:"13px",fontWeight:500,borderRadius:"8px",border:"none",cursor:"pointer",transition:"all 0.2s ease"},buttonSecondary:{background:"var(--lumiverse-surface)",color:"var(--lumiverse-text)",border:"1px solid var(--lumiverse-border)"},buttonDanger:{background:"rgba(244, 67, 54, 0.1)",color:"#f44336",border:"1px solid rgba(244, 67, 54, 0.3)"},buttonDangerDisabled:{opacity:.5,cursor:"not-allowed"},buttonPrimary:{background:"var(--lumiverse-primary)",color:"white"}};function Ff(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function Uf(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Ff(Object(t),!0).forEach(function(n){Hf(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Ff(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Hf(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const Wf=Ye,Vf={},qf=()=>Wf.getState().presets||Vf,$f=()=>Wf.getState().activePresetName;function Yf(e){if(!e)return"";const n=Date.now()-e,t=Math.floor(n/6e4);if(t<1)return"Just now";if(t<60)return"".concat(t,"m ago");const r=Math.floor(t/60);if(r<24)return"".concat(r,"h ago");const i=Math.floor(r/24);return i<7?"".concat(i,"d ago"):new Date(e).toLocaleDateString()}function Gf(e){let{preset:n,isActive:t,onLoad:r,onUpdate:i,onDelete:o}=e;const[a,s]=(0,Ce.useState)(!1),l=(0,Ce.useMemo)(()=>{var e,t,r,i,o,a;if(n.councilMode&&(null===(e=n.councilMembers)||void 0===e?void 0:e.length)>0){return{isCouncil:!0,members:n.councilMembers.length,behaviors:n.councilMembers.reduce((e,n)=>{var t;return e+((null===(t=n.behaviors)||void 0===t?void 0:t.length)||0)},0),personalities:n.councilMembers.reduce((e,n)=>{var t;return e+((null===(t=n.personalities)||void 0===t?void 0:t.length)||0)},0)}}return n.chimeraMode&&(null===(t=n.selectedDefinitions)||void 0===t?void 0:t.length)>0?{isChimera:!0,definitions:n.selectedDefinitions.length,behaviors:(null===(r=n.selectedBehaviors)||void 0===r?void 0:r.length)||0,personalities:(null===(i=n.selectedPersonalities)||void 0===i?void 0:i.length)||0}:{definitions:n.selectedDefinition?1:0,behaviors:(null===(o=n.selectedBehaviors)||void 0===o?void 0:o.length)||0,personalities:(null===(a=n.selectedPersonalities)||void 0===a?void 0:a.length)||0}},[n]);return(0,Ee.jsxs)("div",{className:On("lumiverse-preset-card",t&&"lumiverse-preset-card--active"),children:[(0,Ee.jsxs)("div",{className:"lumiverse-preset-card-header",children:[(0,Ee.jsx)("span",{className:"lumiverse-preset-card-icon",children:(0,Ee.jsx)(Ld,{size:16,strokeWidth:1.5})}),(0,Ee.jsx)("span",{className:"lumiverse-preset-card-name",children:n.name}),t&&(0,Ee.jsxs)("span",{className:"lumiverse-preset-card-active-badge",children:[(0,Ee.jsx)(zd,{size:12,strokeWidth:2})," Active"]})]}),(0,Ee.jsxs)("div",{className:"lumiverse-preset-card-meta",children:[(0,Ee.jsx)("div",{className:"lumiverse-preset-stats",children:l.isCouncil?(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsxs)("span",{className:"lumiverse-preset-stat lumiverse-preset-stat--council",children:[(0,Ee.jsx)(Ad,{size:12,strokeWidth:1.5})," ",l.members]}),(0,Ee.jsxs)("span",{className:"lumiverse-preset-stat",children:[(0,Ee.jsx)(ut,{size:12,strokeWidth:1.5})," ",l.behaviors]}),(0,Ee.jsxs)("span",{className:"lumiverse-preset-stat",children:[(0,Ee.jsx)(jp,{size:12,strokeWidth:1.5})," ",l.personalities]})]}):(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsxs)("span",{className:On("lumiverse-preset-stat",l.isChimera&&"lumiverse-preset-stat--chimera"),children:[(0,Ee.jsx)(zv,{size:12,strokeWidth:1.5})," ",l.definitions]}),(0,Ee.jsxs)("span",{className:"lumiverse-preset-stat",children:[(0,Ee.jsx)(ut,{size:12,strokeWidth:1.5})," ",l.behaviors]}),(0,Ee.jsxs)("span",{className:"lumiverse-preset-stat",children:[(0,Ee.jsx)(jp,{size:12,strokeWidth:1.5})," ",l.personalities]})]})}),n.chimeraMode&&(0,Ee.jsx)("span",{className:"lumiverse-preset-card-mode",children:"Chimera"}),n.councilMode&&(0,Ee.jsx)("span",{className:"lumiverse-preset-card-mode",children:"Council"}),(0,Ee.jsxs)("span",{className:"lumiverse-preset-card-time",children:[(0,Ee.jsx)(vt,{size:12,strokeWidth:1.5}),Yf(n.updatedAt||n.createdAt)]})]}),(0,Ee.jsxs)("div",{className:"lumiverse-preset-card-actions",children:[(0,Ee.jsx)("button",{className:"lumiverse-preset-btn lumiverse-preset-btn--primary",onClick:()=>r(n.name),title:"Load this preset",type:"button",children:"Load"}),(0,Ee.jsx)("button",{className:"lumiverse-preset-btn",onClick:()=>i(n.name),title:"Update preset with current selections",type:"button",children:(0,Ee.jsx)(pt,{size:14,strokeWidth:1.5})}),(0,Ee.jsx)("button",{className:On("lumiverse-preset-btn lumiverse-preset-btn--danger",a&&"lumiverse-preset-btn--confirming"),onClick:()=>{a?(o(n.name),s(!1)):(s(!0),setTimeout(()=>s(!1),3e3))},title:a?"Click again to confirm":"Delete preset",type:"button",children:a?(0,Ee.jsx)(mt,{size:14,strokeWidth:2}):(0,Ee.jsx)(Pn,{size:14,strokeWidth:1.5})})]})]})}function Kf(e){let{onCreateClick:n}=e;return(0,Ee.jsxs)("div",{className:"lumiverse-preset-empty",children:[(0,Ee.jsx)("span",{className:"lumiverse-preset-empty-icon",children:(0,Ee.jsx)(Ld,{size:32,strokeWidth:1.5})}),(0,Ee.jsx)("h4",{children:"No Presets Saved"}),(0,Ee.jsx)("p",{children:"Save your current Lumia configuration as a preset to quickly switch between setups."}),(0,Ee.jsxs)("button",{className:"lumiverse-preset-btn lumiverse-preset-btn--primary",onClick:n,style:{marginTop:"16px"},type:"button",children:[(0,Ee.jsx)(dr,{size:14,strokeWidth:2}),"Create Your First Preset"]})]})}const Qf={layout:{display:"flex",flexDirection:"column",height:"100%",maxHeight:"100%",minHeight:0},header:{display:"flex",alignItems:"center",gap:"12px",padding:"16px 20px",borderBottom:"1px solid var(--lumiverse-border)",flexShrink:0},headerIcon:{display:"flex",alignItems:"center",justifyContent:"center",width:"40px",height:"40px",borderRadius:"10px",background:"linear-gradient(135deg, rgba(147, 112, 219, 0.2), rgba(147, 112, 219, 0.1))",color:"var(--lumiverse-primary)"},headerText:{flex:1},title:{margin:0,fontSize:"16px",fontWeight:600,color:"var(--lumiverse-text)"},subtitle:{margin:"4px 0 0",fontSize:"12px",color:"var(--lumiverse-text-muted)"},scrollArea:{flex:"1 1 auto",minHeight:0,overflowY:"auto",padding:"16px 20px"},createSection:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"16px",padding:"12px",background:"rgba(0, 0, 0, 0.2)",borderRadius:"10px",border:"1px solid rgba(147, 112, 219, 0.15)"},input:{flex:1,padding:"10px 12px",fontSize:"13px",background:"var(--lumiverse-input-bg)",border:"1px solid var(--lumiverse-border)",borderRadius:"8px",color:"var(--lumiverse-text)",outline:"none",transition:"border-color 0.2s ease"},footer:{display:"flex",justifyContent:"flex-end",gap:"8px",padding:"12px 20px",borderTop:"1px solid var(--lumiverse-border)",flexShrink:0},button:{padding:"10px 16px",fontSize:"13px",fontWeight:500,borderRadius:"8px",border:"none",cursor:"pointer",transition:"all 0.2s ease"},buttonSecondary:{background:"var(--lumiverse-surface)",color:"var(--lumiverse-text)",border:"1px solid var(--lumiverse-border)"},buttonPrimary:{background:"var(--lumiverse-primary)",color:"white"}};const Xf=function(e){let{onClose:n}=e;const t=Xe(),[r,i]=(0,Ce.useState)(""),[o,a]=(0,Ce.useState)(!1),s=(0,Ce.useSyncExternalStore)(Wf.subscribe,qf,qf),l=(0,Ce.useSyncExternalStore)(Wf.subscribe,$f,$f),c=(0,Ce.useMemo)(()=>Object.values(s).sort((e,n)=>{const t=e.updatedAt||e.createdAt||0;return(n.updatedAt||n.createdAt||0)-t}),[s]),u=(0,Ce.useCallback)(e=>{t.loadPreset(e),qe(),"undefined"!=typeof toastr&&toastr.info('Loaded preset "'.concat(e,'"'))},[t]),d=(0,Ce.useCallback)(e=>{t.updatePreset(e),qe(),"undefined"!=typeof toastr&&toastr.success('Updated preset "'.concat(e,'"'))},[t]),m=(0,Ce.useCallback)(e=>{t.deletePreset(e),qe(),"undefined"!=typeof toastr&&toastr.success('Deleted preset "'.concat(e,'"'))},[t]),p=(0,Ce.useCallback)(()=>{const e=r.trim();e&&(s[e]?"undefined"!=typeof toastr&&toastr.warning('Preset "'.concat(e,'" already exists')):(t.savePreset(e),qe(),i(""),a(!1),"undefined"!=typeof toastr&&toastr.success('Preset "'.concat(e,'" saved'))))},[r,s,t]);return(0,Ee.jsxs)("div",{style:Qf.layout,children:[(0,Ee.jsxs)("div",{style:Qf.header,children:[(0,Ee.jsx)("div",{style:Qf.headerIcon,children:(0,Ee.jsx)(dt,{size:20,strokeWidth:1.5})}),(0,Ee.jsxs)("div",{style:Qf.headerText,children:[(0,Ee.jsx)("h3",{style:Qf.title,children:"Manage Presets"}),(0,Ee.jsx)("p",{style:Qf.subtitle,children:c.length>0?"".concat(c.length," preset").concat(1!==c.length?"s":""," saved"):"No presets saved yet"})]})]}),(0,Ee.jsxs)("div",{style:Qf.scrollArea,children:[o?(0,Ee.jsxs)("div",{style:Qf.createSection,children:[(0,Ee.jsx)("input",{type:"text",style:Qf.input,placeholder:"Enter preset name...",value:r,onChange:e=>i(e.target.value),onKeyDown:e=>{"Enter"===e.key?p():"Escape"===e.key&&o&&(a(!1),i(""))},autoFocus:!0}),(0,Ee.jsx)("button",{className:"lumiverse-preset-btn lumiverse-preset-btn--primary",onClick:p,disabled:!r.trim(),type:"button",title:"Save preset",children:(0,Ee.jsx)(zd,{size:16,strokeWidth:2})}),(0,Ee.jsx)("button",{className:"lumiverse-preset-btn",onClick:()=>{a(!1),i("")},type:"button",title:"Cancel",children:(0,Ee.jsx)(mt,{size:16,strokeWidth:2})})]}):(0,Ee.jsxs)("div",{style:Qf.createSection,children:[(0,Ee.jsx)("span",{style:{fontSize:"13px",color:"var(--lumiverse-text-secondary)",flex:1},children:"Save your current Lumia configuration"}),(0,Ee.jsxs)("button",{className:"lumiverse-preset-btn lumiverse-preset-btn--primary",onClick:()=>a(!0),type:"button",children:[(0,Ee.jsx)(dr,{size:14,strokeWidth:2}),"New Preset"]})]}),(0,Ee.jsx)("div",{className:"lumiverse-preset-list",children:0===c.length?(0,Ee.jsx)(Kf,{onCreateClick:()=>a(!0)}):c.map(e=>(0,Ee.jsx)(Gf,{preset:e,isActive:l===e.name,onLoad:u,onUpdate:d,onDelete:m},e.name))})]}),(0,Ee.jsx)("div",{style:Qf.footer,children:(0,Ee.jsx)("button",{type:"button",style:Uf(Uf({},Qf.button),Qf.buttonSecondary),onClick:n,children:"Close"})})]})};function Zf(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function Jf(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Zf(Object(t),!0).forEach(function(n){eb(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Zf(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function eb(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function nb(e){let{children:n,onClose:t,modalType:r,size:i="medium",hasCustomHeader:o=!1}=e;const a=(0,Ce.useCallback)(e=>{"Escape"===e.key&&t()},[t]);(0,Ce.useEffect)(()=>(document.addEventListener("keydown",a),document.body.style.overflow="hidden",()=>{document.removeEventListener("keydown",a),document.body.style.overflow=""}),[a]);const s=e=>{e.stopPropagation()},l="editor"===r,c=On("lumiverse-modal","small"===i&&"lumiverse-modal--small","medium"===i&&"lumiverse-modal--medium","large"===i&&"lumiverse-modal--large","selection"===r&&"lumiverse-modal-selection","settings"===r&&"lumiverse-modal-settings","editor"===r&&"lumiverse-modal-editor","pack-editor"===r&&"lumiverse-modal-pack-editor","pack-selector"===r&&"lumiverse-modal-pack-selector","lumia-editor"===r&&"lumiverse-modal-lumia-editor","loom-editor"===r&&"lumiverse-modal-loom-editor","type-selector"===r&&"lumiverse-modal-type-selector");return(0,Ee.jsx)("div",{className:"lumiverse-modal-backdrop",onClick:e=>{e.stopPropagation(),e.target===e.currentTarget&&t()},onMouseDown:s,onMouseUp:s,onPointerDown:l?void 0:s,onPointerUp:l?void 0:s,onTouchStart:s,onTouchEnd:s,children:(0,Ee.jsx)("div",{className:c,role:"dialog","aria-modal":"true",onClick:e=>e.stopPropagation(),children:n})})}const tb={behaviors:{component:Tm,modalType:"selection",size:"large",hasCustomHeader:!0,props:{type:"behaviors",multiSelect:!0,allowDominant:!0}},personalities:{component:Tm,modalType:"selection",size:"large",hasCustomHeader:!0,props:{type:"personalities",multiSelect:!0,allowDominant:!0}},definitions:{component:Tm,modalType:"selection",size:"large",hasCustomHeader:!0,props:{type:"definitions",multiSelect:!1,allowDominant:!1}},packEditor:{component:Jn,modalType:"pack-editor",size:"large",hasCustomHeader:!0,props:{}},importPack:{component:()=>(0,Ee.jsx)("div",{className:"lumia-modal-empty",children:"Import Pack Modal (TODO)"}),modalType:"settings",size:"medium",hasCustomHeader:!1,props:{}},loomStyles:{component:Hm,modalType:"selection",size:"large",hasCustomHeader:!0,props:{type:"loomStyles"}},loomUtilities:{component:Hm,modalType:"selection",size:"large",hasCustomHeader:!0,props:{type:"loomUtilities"}},loomRetrofits:{component:Hm,modalType:"selection",size:"large",hasCustomHeader:!0,props:{type:"loomRetrofits"}},packSelector:{component:ep,modalType:"pack-selector",size:"medium",hasCustomHeader:!0,props:{}},lumiaEditor:{component:up,modalType:"lumia-editor",size:"large",hasCustomHeader:!0,props:{}},loomEditor:{component:yp,modalType:"loom-editor",size:"large",hasCustomHeader:!0,props:{}},itemTypeSelector:{component:function(e){let{packName:n,onClose:t}=e;const r=Xe();return(0,Ee.jsx)(wp,{packName:n,onSelectLumia:()=>{r.openModal("lumiaEditor",{packName:n})},onSelectLoom:()=>{r.openModal("loomEditor",{packName:n})},onBack:t})},modalType:"type-selector",size:"medium",hasCustomHeader:!0,props:{}},councilSelect:{component:Ip,modalType:"selection",size:"large",hasCustomHeader:!0,props:{}},presetEditor:{component:function(e){let{onClose:n}=e;const{currentPreset:t,prompts:r,availablePresets:i,toggleStateNames:o,savePrompts:a,selectPreset:s,exportPreset:l,saveToggleState:c,applyToggleState:u,deleteToggleState:d,isLoading:m,hasChatBinding:p,hasCharacterBinding:g,currentCharacterName:h,saveTogglesToChat:v,clearChatToggles:f,saveTogglesToCharacter:b,clearCharacterToggles:x}=_v(),[y,k]=(0,Ce.useState)("list"),[w,j]=(0,Ce.useState)(null),[C,S]=(0,Ce.useState)(null),[N,E]=(0,Ce.useState)(new Set),[P,D]=(0,Ce.useState)(null),[M,O]=(0,Ce.useState)(!1),[T,A]=(0,Ce.useState)(""),[L,z]=(0,Ce.useState)(null),[I,R]=(0,Ce.useState)(!1),[B,_]=(0,Ce.useState)(null),F=e=>{const n=new Set(N);n.has(e)?n.delete(e):n.add(e),E(n)},U=e=>r.findIndex(n=>(n.identifier||n._uiId)===(e.identifier||e._uiId)),H=(0,Ce.useMemo)(()=>{const e=[];let n=!1;for(const t of r){if(t.name.startsWith(Wv)){const r=t.identifier||t._uiId;n=N.has(r),e.push(t)}else n||e.push(t)}return e},[r,N]),W=e=>{const n=U(e);S(n),j(Uv({},r[n])),k("edit")},V=()=>{if(null!==C&&w){const e=[...r];e[C]=w,a(e)}k("list"),S(null),j(null)},q=()=>{k("list"),S(null),j(null)},$=e=>{if(confirm("Are you sure you want to delete this prompt?")){const n=U(e),t=[...r];t.splice(n,1),a(t)}},Y=e=>{const n=U(e),t=[...r];t[n].enabled=!t[n].enabled,a(t)},G=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const n={identifier:crypto.randomUUID(),name:e?"".concat(Wv," New Category"):"New Prompt",content:"",role:"system",enabled:!0,injection_position:0,injection_depth:4,_uiId:crypto.randomUUID()},t=[...r,n];a(t),S(t.length-1),j(n),k("edit")},K=function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return(0,Ce.useMemo)(()=>[...n].filter(e=>null!=e),[...n])}(vg(uh,{activationConstraint:{distance:8}}),vg(oh,{coordinateGetter:Nv}));return"edit"===y&&w?(0,Ee.jsx)($v,{form:w,setForm:j,onSave:V,onCancel:q}):m&&!t?(0,Ee.jsx)("div",{style:Uv(Uv({},Vv.layout),{},{alignItems:"center",justifyContent:"center"}),children:(0,Ee.jsx)("div",{style:{color:"var(--lumiverse-text-muted)"},children:"Loading Preset..."})}):(0,Ee.jsxs)("div",{style:Vv.layout,children:[(0,Ee.jsxs)("div",{style:Vv.header,children:[(0,Ee.jsxs)("div",{style:Vv.headerContent,children:[(0,Ee.jsx)(dt,{size:20,color:"var(--lumiverse-primary)"}),(0,Ee.jsx)("select",{style:Uv(Uv({},Vv.select),{},{flex:1,minWidth:"0"}),value:(null==t?void 0:t.name)||"",onChange:e=>s(e.target.value),children:i.map(e=>(0,Ee.jsx)("option",{value:e,children:e},e))})]}),(0,Ee.jsx)("button",{style:Vv.iconBtn,onClick:n,children:(0,Ee.jsx)(mt,{size:20})})]}),(0,Ee.jsxs)("div",{style:Vv.toolbar,children:[(0,Ee.jsxs)("button",{style:Vv.btn,onClick:()=>G(!1),children:[(0,Ee.jsx)(dr,{size:16})," ",(0,Ee.jsx)("span",{className:"hidden-sm",children:"Prompt"})]}),(0,Ee.jsxs)("button",{style:Vv.btn,onClick:()=>G(!0),children:[(0,Ee.jsx)(dr,{size:16})," ",(0,Ee.jsx)("span",{className:"hidden-sm",children:"Category"})]}),(0,Ee.jsx)("div",{style:{width:"1px",height:"20px",background:"var(--lumiverse-border)",margin:"0 4px"}}),(0,Ee.jsxs)("div",{style:{position:"relative"},children:[(0,Ee.jsxs)("button",{style:Uv(Uv({},Vv.btn),M?Vv.btnPrimary:{}),onClick:()=>O(!M),title:"Manage States",children:[o.length>0?(0,Ee.jsx)(Ov,{size:16}):(0,Ee.jsx)(Ld,{size:16}),(0,Ee.jsx)("span",{className:"hidden-sm",children:"States"})]}),M&&(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsx)("div",{className:"lumiverse-states-backdrop",onClick:()=>O(!1)}),(0,Ee.jsxs)("div",{className:"lumiverse-states-menu",style:{position:"absolute",top:"100%",bottom:"auto",left:"0",marginTop:"4px",transform:"none"},children:[(0,Ee.jsx)("div",{style:{fontSize:"12px",fontWeight:600,color:"var(--lumiverse-text-muted)"},children:"SAVE CURRENT STATE"}),(0,Ee.jsxs)("div",{style:{display:"flex",gap:"4px",alignItems:"center"},children:[(0,Ee.jsx)("input",{style:Uv(Uv({},Vv.input),{},{flex:1,padding:"6px"}),placeholder:"State name...",value:T,onChange:e=>A(e.target.value)}),(0,Ee.jsx)("button",{style:Uv(Uv(Uv({},Vv.btn),Vv.btnPrimary),{},{padding:"6px",flexShrink:0}),onClick:async()=>{T.trim()&&(await c(T.trim()),A(""),z("Saved!"),setTimeout(()=>z(null),2e3))},children:(0,Ee.jsx)(Tv,{size:14})})]}),L&&(0,Ee.jsx)("div",{style:{fontSize:"11px",color:"var(--lumiverse-success)"},children:L}),o.length>0&&(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsx)("div",{style:{height:"1px",background:"var(--lumiverse-border)",margin:"4px 0"}}),(0,Ee.jsx)("div",{style:{fontSize:"12px",fontWeight:600,color:"var(--lumiverse-text-muted)"},children:"LOAD STATE"}),(0,Ee.jsx)("div",{style:{maxHeight:"150px",overflowY:"auto"},children:o.map(e=>(0,Ee.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"6px",borderRadius:"4px",hover:{background:"rgba(255,255,255,0.05)"}},children:[(0,Ee.jsx)("span",{style:{fontSize:"13px",cursor:"pointer",flex:1},onClick:()=>{u(e),O(!1)},children:e}),(0,Ee.jsx)("button",{style:Uv(Uv({},Vv.iconBtn),{},{color:"var(--lumiverse-danger)",padding:"2px"}),onClick:n=>{n.stopPropagation(),d(e)},children:(0,Ee.jsx)(Pn,{size:12})})]},e))})]})]})]})]}),(0,Ee.jsxs)("div",{style:{position:"relative"},children:[(0,Ee.jsxs)("button",{style:Uv(Uv(Uv({},Vv.btn),I?Vv.btnPrimary:{}),p||g?{borderColor:"var(--lumiverse-success)",color:"var(--lumiverse-success)"}:{}),onClick:()=>R(!I),title:"Bind toggles to Chat/Character",children:[p||g?(0,Ee.jsx)(Av,{size:16}):(0,Ee.jsx)(Lv,{size:16}),(0,Ee.jsx)("span",{className:"hidden-sm",children:"Bind"})]}),I&&(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsx)("div",{className:"lumiverse-states-backdrop",onClick:()=>R(!1)}),(0,Ee.jsxs)("div",{className:"lumiverse-states-menu",style:{position:"absolute",top:"100%",bottom:"auto",left:"0",marginTop:"4px",transform:"none",minWidth:"220px"},children:[(0,Ee.jsx)("div",{style:{fontSize:"12px",fontWeight:600,color:"var(--lumiverse-text-muted)",marginBottom:"8px"},children:"BIND CURRENT TOGGLES"}),(0,Ee.jsx)("div",{style:{fontSize:"11px",color:"var(--lumiverse-text-muted)",marginBottom:"12px"},children:"Save which prompts are enabled/disabled to auto-apply when switching to this chat or character."}),(0,Ee.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px"},children:[(0,Ee.jsx)(ur,{size:14,style:{color:"var(--lumiverse-text-muted)"}}),(0,Ee.jsx)("span",{style:{flex:1,fontSize:"13px"},children:"This Chat"}),p?(0,Ee.jsxs)("button",{style:Uv(Uv({},Vv.btn),{},{padding:"4px 8px",fontSize:"11px",color:"var(--lumiverse-danger)",borderColor:"var(--lumiverse-danger)"}),onClick:()=>{f(),_("Chat binding cleared"),setTimeout(()=>_(null),2e3)},children:[(0,Ee.jsx)(Lv,{size:12})," Clear"]}):(0,Ee.jsxs)("button",{style:Uv(Uv(Uv({},Vv.btn),Vv.btnPrimary),{},{padding:"4px 8px",fontSize:"11px"}),onClick:async()=>{await v()&&(_("Bound to chat!"),setTimeout(()=>_(null),2e3))},children:[(0,Ee.jsx)(Av,{size:12})," Bind"]})]}),(0,Ee.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,Ee.jsx)(lr,{size:14,style:{color:"var(--lumiverse-text-muted)"}}),(0,Ee.jsx)("span",{style:{flex:1,fontSize:"13px"},children:h||"Character"}),g?(0,Ee.jsxs)("button",{style:Uv(Uv({},Vv.btn),{},{padding:"4px 8px",fontSize:"11px",color:"var(--lumiverse-danger)",borderColor:"var(--lumiverse-danger)"}),onClick:()=>{x(),_("Character binding cleared"),setTimeout(()=>_(null),2e3)},children:[(0,Ee.jsx)(Lv,{size:12})," Clear"]}):(0,Ee.jsxs)("button",{style:Uv(Uv(Uv({},Vv.btn),Vv.btnPrimary),{},{padding:"4px 8px",fontSize:"11px"}),onClick:async()=>{await b()&&(_("Bound to character!"),setTimeout(()=>_(null),2e3))},children:[(0,Ee.jsx)(Av,{size:12})," Bind"]})]}),B&&(0,Ee.jsx)("div",{style:{fontSize:"11px",color:"var(--lumiverse-success)",marginTop:"8px"},children:B}),(0,Ee.jsx)("div",{style:{height:"1px",background:"var(--lumiverse-border)",margin:"12px 0 8px"}}),(0,Ee.jsx)("div",{style:{fontSize:"10px",color:"var(--lumiverse-text-dim)"},children:"Priority: Chat > Character"})]})]})]}),(0,Ee.jsx)("div",{style:{flex:1}}),(0,Ee.jsx)("button",{style:Vv.btn,onClick:l,title:"Export Preset",children:(0,Ee.jsx)(Dn,{size:16})})]}),(0,Ee.jsx)("div",{style:Vv.scrollArea,children:0===H.length?(0,Ee.jsxs)("div",{style:{padding:"40px",textAlign:"center",color:"var(--lumiverse-text-muted)",display:"flex",flexDirection:"column",alignItems:"center",gap:"12px"},children:[(0,Ee.jsx)(zv,{size:48,strokeWidth:1,style:{opacity:.3}}),(0,Ee.jsx)("div",{children:0===r.length?"This preset is empty.":"All prompts are hidden in collapsed categories."}),0===r.length&&(0,Ee.jsx)("button",{style:Uv(Uv({},Vv.btn),Vv.btnPrimary),onClick:()=>G(!1),children:"Create First Prompt"})]}):(0,Ee.jsxs)(Vh,{sensors:K,collisionDetection:Sg,onDragStart:e=>D(e.active.id),onDragEnd:e=>{const{active:n,over:t}=e;if(D(null),t&&n.id!==t.id){const e=r.findIndex(e=>(e.identifier||e._uiId)===n.id),i=r.findIndex(e=>(e.identifier||e._uiId)===t.id);-1!==e&&-1!==i&&a(lv(r,e,i))}},children:[(0,Ee.jsx)(vv,{items:H.map(e=>e.identifier||e._uiId),strategy:pv,children:H.map(e=>(0,Ee.jsx)(qv,{prompt:e,index:0,onEdit:W,onDelete:$,onToggleEnabled:Y,onToggleCollapse:F,isCollapsed:N.has(e.identifier||e._uiId)},e.identifier||e._uiId))}),(0,Ee.jsx)(sv,{children:P?(0,Ee.jsx)("div",{style:Uv(Uv({},Vv.item),Vv.itemDragging),children:"Drag Item..."}):null})]})})]})},modalType:"editor",size:"large",hasCustomHeader:!1,props:{}},oocSettings:{component:ef,modalType:"settings",size:"medium",hasCustomHeader:!0,props:{}},summarization:{component:df,modalType:"settings",size:"large",hasCustomHeader:!0,props:{}},promptSettings:{component:xf,modalType:"settings",size:"large",hasCustomHeader:!0,props:{}},lucidCards:{component:Af,modalType:"selection",size:"large",hasCustomHeader:!0,props:{}},loomSummary:{component:function(e){var n;let{onClose:t}=e;const r=(0,Ce.useCallback)(()=>{try{var e,n;return null===(e=window.SillyTavern)||void 0===e||null===(n=e.getContext)||void 0===n?void 0:n.call(e)}catch(e){return null}},[]),i=r(),o=(null==i?void 0:i.chat)&&i.chat.length>0,a=(null==i||null===(n=i.chatMetadata)||void 0===n?void 0:n[Bf])||"",s=!!a,[l,c]=(0,Ce.useState)(a),u=(0,Ce.useCallback)(()=>{var e;const n=r();if(!n)return void(window.toastr&&window.toastr.error("No active chat context"));n.chatMetadata||(n.chatMetadata={});const i=l.trim();i?(n.chatMetadata[Bf]=i,window.toastr&&window.toastr.success("Loom summary saved!")):(delete n.chatMetadata[Bf],window.toastr&&window.toastr.info("Loom summary cleared")),null===(e=n.saveMetadata)||void 0===e||e.call(n),"function"==typeof window.updateLoomSummaryButtonState&&window.updateLoomSummaryButtonState(),t()},[l,r,t]),d=(0,Ce.useCallback)(()=>{if(!window.confirm("Are you sure you want to clear the Loom summary for this chat?"))return;const e=r();var n;null!=e&&e.chatMetadata&&(delete e.chatMetadata[Bf],null===(n=e.saveMetadata)||void 0===n||n.call(e),window.toastr&&window.toastr.info("Loom summary cleared"),"function"==typeof window.updateLoomSummaryButtonState&&window.updateLoomSummaryButtonState());t()},[r,t]);return o?(0,Ee.jsxs)("div",{style:_f.layout,children:[(0,Ee.jsxs)("div",{style:_f.header,children:[(0,Ee.jsx)("div",{style:_f.headerIcon,children:(0,Ee.jsx)(Lf,{size:20,strokeWidth:1.5})}),(0,Ee.jsx)("div",{style:_f.headerText,children:(0,Ee.jsx)("h3",{style:_f.title,children:"Loom Summary"})})]}),(0,Ee.jsxs)("div",{style:_f.scrollArea,children:[(0,Ee.jsx)("div",{style:If(If({},_f.status),s?_f.statusExists:_f.statusEmpty),children:s?(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsx)(zd,{size:16}),(0,Ee.jsx)("span",{children:"Summary exists for this chat"})]}):(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsx)(ht,{size:16}),(0,Ee.jsx)("span",{children:"No summary yet - generate one or write your own"})]})}),(0,Ee.jsx)("textarea",{style:_f.textarea,placeholder:"Write or paste your Loom summary here...\n\nUse the structured format:\n**Completed Objectives**\n- ...\n\n**Focused Objectives**\n- ...\n\n**Foreshadowing Beats**\n- ...\n\n(etc.)",value:l,onChange:e=>c(e.target.value),autoFocus:!0})]}),(0,Ee.jsxs)("div",{style:_f.footer,children:[(0,Ee.jsx)("div",{style:_f.footerLeft,children:(0,Ee.jsxs)("button",{type:"button",style:If(If(If({},_f.button),_f.buttonDanger),s?{}:_f.buttonDangerDisabled),onClick:d,disabled:!s,children:[(0,Ee.jsx)(Pn,{size:14}),"Clear"]})}),(0,Ee.jsxs)("div",{style:_f.footerRight,children:[(0,Ee.jsx)("button",{type:"button",style:If(If({},_f.button),_f.buttonSecondary),onClick:t,children:"Cancel"}),(0,Ee.jsx)("button",{type:"button",style:If(If({},_f.button),_f.buttonPrimary),onClick:u,children:"Save"})]})]})]}):(0,Ee.jsxs)("div",{style:_f.layout,children:[(0,Ee.jsxs)("div",{style:_f.header,children:[(0,Ee.jsx)("div",{style:_f.headerIcon,children:(0,Ee.jsx)(Lf,{size:20,strokeWidth:1.5})}),(0,Ee.jsx)("div",{style:_f.headerText,children:(0,Ee.jsx)("h3",{style:_f.title,children:"Loom Summary"})})]}),(0,Ee.jsx)("div",{style:_f.scrollArea,children:(0,Ee.jsxs)("div",{style:If(If({},_f.status),_f.statusEmpty),children:[(0,Ee.jsx)(ht,{size:16}),(0,Ee.jsx)("span",{children:"No active chat to view summary for"})]})}),(0,Ee.jsxs)("div",{style:_f.footer,children:[(0,Ee.jsx)("div",{}),(0,Ee.jsx)("button",{type:"button",style:If(If({},_f.button),_f.buttonSecondary),onClick:t,children:"Close"})]})]})},modalType:"settings",size:"medium",hasCustomHeader:!0,props:{}},presetManage:{component:Xf,modalType:"settings",size:"medium",hasCustomHeader:!1,props:{}}};const rb=function(){const e=fn(),n=Xe();if(!e.activeModal)return null;const{name:t,props:r}=e.activeModal,i=tb[t];if(!i)return console.warn("[LumiverseUI] Unknown modal: ".concat(t)),null;const{component:o,modalType:a,size:s,hasCustomHeader:l,props:c}=i;return(0,ot.createPortal)((0,Ee.jsx)(nb,{modalType:a,size:s,hasCustomHeader:l,onClose:n.closeModal,children:(0,Ee.jsx)(o,Jf(Jf(Jf({},c),r),{},{onClose:n.closeModal}))}),document.body)};function ib(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function ob(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?ib(Object(t),!0).forEach(function(n){ab(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ib(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function ab(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const sb=Ye,lb={},cb=()=>{var e;return null===(e=sb.getState().ui)||void 0===e?void 0:e.viewingPack},ub=()=>sb.getState().packs||lb,db={lumiaCard:{background:"rgba(0, 0, 0, 0.2)",border:"1px solid var(--lumiverse-border, rgba(255, 255, 255, 0.1))",borderRadius:"12px",overflow:"hidden",transition:"border-color 0.15s ease",display:"flex",flexDirection:"column"},lumiaImageContainer:{position:"relative",aspectRatio:"3 / 4",background:"rgba(0, 0, 0, 0.3)",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden"},lumiaImage:{width:"100%",height:"100%",objectFit:"cover"},lumiaPlaceholder:{color:"var(--lumiverse-text-muted, #999)",opacity:.5},lumiaInfo:{padding:"12px"},lumiaName:{margin:0,fontSize:"14px",fontWeight:600,color:"var(--lumiverse-text, #e0e0e0)",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},lumiaAuthor:{fontSize:"12px",color:"var(--lumiverse-text-muted, #999)",marginTop:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},traitBadges:{display:"flex",flexWrap:"wrap",gap:"6px",marginTop:"8px"},traitBadge:{display:"flex",alignItems:"center",gap:"4px",padding:"4px 8px",fontSize:"10px",fontWeight:500,borderRadius:"4px",background:"rgba(147, 112, 219, 0.15)",color:"var(--lumiverse-primary, #9370db)"},actions:{display:"flex",flexWrap:"wrap",gap:"6px",padding:"0 12px 12px"},actionBtn:{display:"flex",alignItems:"center",gap:"4px",padding:"6px 10px",fontSize:"11px",fontWeight:500,borderRadius:"6px",border:"1px solid var(--lumiverse-border, rgba(255, 255, 255, 0.1))",background:"rgba(0, 0, 0, 0.2)",color:"var(--lumiverse-text, #e0e0e0)",cursor:"pointer",transition:"all 0.15s ease"},actionBtnSelected:{background:"rgba(147, 112, 219, 0.2)",borderColor:"var(--lumiverse-primary, #9370db)",color:"var(--lumiverse-primary, #9370db)"},actionBtnEnableAll:{background:"rgba(147, 112, 219, 0.1)",borderColor:"rgba(147, 112, 219, 0.3)"},actionBtnAllEnabled:{background:"rgba(147, 112, 219, 0.25)",borderColor:"var(--lumiverse-primary, #9370db)",color:"var(--lumiverse-primary, #9370db)"},previewBtn:{display:"flex",alignItems:"center",justifyContent:"center",width:"28px",height:"28px",padding:0,borderRadius:"6px",border:"1px solid rgba(147, 112, 219, 0.2)",background:"rgba(147, 112, 219, 0.1)",color:"var(--lumiverse-primary, #9370db)",cursor:"pointer",transition:"all 0.15s ease",marginLeft:"auto",flexShrink:0},previewBtnActive:{background:"rgba(147, 112, 219, 0.25)",borderColor:"var(--lumiverse-primary, #9370db)"},previewPanel:{background:"rgba(0, 0, 0, 0.25)",borderTop:"1px solid rgba(147, 112, 219, 0.12)",overflow:"hidden",transition:"max-height 0.25s ease, opacity 0.2s ease"},previewPanelCollapsed:{maxHeight:"0",opacity:0},previewPanelExpanded:{maxHeight:"280px",opacity:1},previewTabs:{display:"flex",gap:"6px",padding:"10px 12px",borderBottom:"1px solid rgba(255, 255, 255, 0.05)"},previewTab:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",padding:"8px 12px",fontSize:"11px",fontWeight:600,letterSpacing:"0.5px",borderRadius:"6px",border:"1px solid rgba(255, 255, 255, 0.06)",background:"rgba(0, 0, 0, 0.15)",color:"var(--lumiverse-text-muted, #888)",cursor:"pointer",transition:"all 0.15s ease"},previewTabActive:{background:"rgba(147, 112, 219, 0.2)",borderColor:"rgba(147, 112, 219, 0.35)",color:"var(--lumiverse-primary, #9370db)"},previewTabDisabled:{opacity:.4,cursor:"not-allowed"},previewContent:{padding:"10px 12px 12px",maxHeight:"200px",overflowY:"auto"},previewText:{margin:0,fontSize:"12px",lineHeight:1.6,color:"var(--lumiverse-text-muted, #aaa)",whiteSpace:"pre-wrap",wordBreak:"break-word",fontFamily:"inherit"},previewEmpty:{fontSize:"12px",color:"var(--lumiverse-text-dim, #666)",fontStyle:"italic",textAlign:"center",padding:"16px 0"}};function mb(e,n){if(!e)return null;const t={name:["lumiaName","lumiaDefName"],def:["lumiaDefinition","lumiaDef"],personality:["lumiaPersonality","lumia_personality"],behavior:["lumiaBehavior","lumia_behavior"],img:["avatarUrl","lumia_img"],author:["authorName","defAuthor"]}[n];if(!t)return null;for(const n of t)if(void 0!==e[n]&&null!==e[n])return e[n];return null}function pb(e){return e.lumiaItems&&Array.isArray(e.lumiaItems)?e.lumiaItems:e.items&&Array.isArray(e.items)?e.items.filter(e=>!e.loomCategory&&!!e.lumiaDefName):[]}function gb(e){let{label:n,Icon:t,isSelected:r,onClick:i,disabled:o}=e;return(0,Ee.jsxs)("button",{style:ob(ob({},db.actionBtn),r?db.actionBtnSelected:{}),onClick:i,disabled:o,title:r?"Already selected":n,type:"button",children:[r?(0,Ee.jsx)(zd,{size:12,strokeWidth:2}):(0,Ee.jsx)(dr,{size:12,strokeWidth:2}),(0,Ee.jsx)("span",{children:n})]})}function hb(e){var n;let{isOpen:t,definition:r,personality:i,behavior:o}=e;const[a,s]=(0,Ce.useState)("def"),l=(0,Ce.useMemo)(()=>{const e=[];return r&&e.push({id:"def",label:"DEF",Icon:zv,content:r}),i&&e.push({id:"pers",label:"PER",Icon:jp,content:i}),o&&e.push({id:"behav",label:"BEH",Icon:ut,content:o}),e},[r,i,o]);(0,Ce.useEffect)(()=>{l.length>0&&!l.find(e=>e.id===a)&&s(l[0].id)},[l,a]);const c=(null===(n=l.find(e=>e.id===a))||void 0===n?void 0:n.content)||null;return 0===l.length?null:(0,Ee.jsxs)("div",{style:ob(ob({},db.previewPanel),t?db.previewPanelExpanded:db.previewPanelCollapsed),children:[(0,Ee.jsx)("div",{style:db.previewTabs,children:l.map(e=>(0,Ee.jsxs)("button",{type:"button",onClick:()=>s(e.id),style:ob(ob({},db.previewTab),a===e.id?db.previewTabActive:{}),children:[(0,Ee.jsx)(e.Icon,{size:11}),(0,Ee.jsx)("span",{children:e.label})]},e.id))}),(0,Ee.jsx)("div",{style:db.previewContent,children:c?(0,Ee.jsx)("p",{style:db.previewText,children:c}):(0,Ee.jsx)("p",{style:db.previewEmpty,children:"No content available"})})]})}function vb(e){let{item:n,packName:t,selections:r,actions:i}=e;const[o,a]=(0,Ce.useState)(!1),s=mb(n,"name"),l=mb(n,"img"),c=mb(n,"def"),u=mb(n,"behavior"),d=mb(n,"personality"),m=mb(n,"author"),{objectPosition:p}=xn(l),g=(0,Ce.useMemo)(()=>!!r.definition&&(r.definition.packName===t&&r.definition.itemName===s),[r.definition,t,s]),h=(0,Ce.useMemo)(()=>(r.behaviors||[]).some(e=>e.packName===t&&e.itemName===s),[r.behaviors,t,s]),v=(0,Ce.useMemo)(()=>(r.personalities||[]).some(e=>e.packName===t&&e.itemName===s),[r.personalities,t,s]),f=(0,Ce.useCallback)(()=>{g||(i.setSelectedDefinition({packName:t,itemName:s}),qe(),"undefined"!=typeof toastr&&toastr.success('Set "'.concat(s,'" as definition')))},[g,i,t,s]),b=(0,Ce.useCallback)(()=>{h||(i.toggleBehavior({packName:t,itemName:s}),qe(),"undefined"!=typeof toastr&&toastr.success('Added "'.concat(s,'" behavior')))},[h,i,t,s]),x=(0,Ce.useCallback)(()=>{v||(i.togglePersonality({packName:t,itemName:s}),qe(),"undefined"!=typeof toastr&&toastr.success('Added "'.concat(s,'" personality')))},[v,i,t,s]),y=!!c,k=!!u,w=!!d,j=y||k||w,C=[y,k,w].filter(Boolean).length>1,S=C&&i.areAllTraitsEnabledForLumia(t,s),N=(0,Ce.useCallback)(()=>{const e=i.toggleAllTraitsForLumia(t,s);qe(),"undefined"!=typeof toastr&&(e?toastr.success('Enabled all traits for "'.concat(s,'"')):toastr.info('Disabled all traits for "'.concat(s,'"')))},[i,t,s]),E=(0,Ce.useCallback)(()=>{a(e=>!e)},[]);return(0,Ee.jsxs)("div",{style:db.lumiaCard,children:[(0,Ee.jsx)("div",{style:db.lumiaImageContainer,children:l?(0,Ee.jsx)(Nf,{src:l,alt:s,style:db.lumiaImage,objectPosition:p}):(0,Ee.jsx)(lr,{size:48,strokeWidth:1.5,style:db.lumiaPlaceholder})}),(0,Ee.jsxs)("div",{style:db.lumiaInfo,children:[(0,Ee.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,Ee.jsx)("h4",{style:ob(ob({},db.lumiaName),{},{flex:1}),children:s}),j&&(0,Ee.jsx)("button",{type:"button",style:ob(ob({},db.previewBtn),o?db.previewBtnActive:{}),onClick:E,title:o?"Hide content preview":"Preview content",children:o?(0,Ee.jsx)(Dv,{size:14}):(0,Ee.jsx)(Id,{size:14})})]}),m&&(0,Ee.jsxs)("span",{style:db.lumiaAuthor,children:["by ",m]}),(0,Ee.jsxs)("div",{style:db.traitBadges,children:[y&&(0,Ee.jsxs)("span",{style:db.traitBadge,children:[(0,Ee.jsx)(zv,{size:10})," Def"]}),k&&(0,Ee.jsxs)("span",{style:db.traitBadge,children:[(0,Ee.jsx)(ut,{size:10})," Behav"]}),w&&(0,Ee.jsxs)("span",{style:db.traitBadge,children:[(0,Ee.jsx)(jp,{size:10})," Pers"]})]})]}),(0,Ee.jsx)(hb,{isOpen:o,definition:c,personality:d,behavior:u}),(0,Ee.jsxs)("div",{style:db.actions,children:[y&&(0,Ee.jsx)(gb,{label:"Set Def",Icon:zv,isSelected:g,onClick:f,disabled:!1}),k&&(0,Ee.jsx)(gb,{label:"Add Behavior",Icon:ut,isSelected:h,onClick:b,disabled:!1}),w&&(0,Ee.jsx)(gb,{label:"Add Personality",Icon:jp,isSelected:v,onClick:x,disabled:!1}),C&&(0,Ee.jsx)("button",{style:ob(ob(ob({},db.actionBtn),db.actionBtnEnableAll),S?db.actionBtnAllEnabled:{}),onClick:N,title:S?"Disable all traits for this Lumia":"Enable all traits for this Lumia",type:"button",children:S?"Disable All":"Enable All"})]})]})}const fb=function(){const e=Xe(),n=gn(),t=(0,Ce.useSyncExternalStore)(sb.subscribe,cb,cb),r=(0,Ce.useSyncExternalStore)(sb.subscribe,ub,ub),i=(0,Ce.useMemo)(()=>t&&r[t]||null,[t,r]),o=(0,Ce.useMemo)(()=>{if(!i)return[];return pb(i).filter(e=>mb(e,"def"))},[i]),a=(0,Ce.useMemo)(()=>{if(!i)return{lumias:0,behaviors:0,personalities:0};const e=pb(i);return{lumias:e.filter(e=>mb(e,"def")).length,behaviors:e.filter(e=>mb(e,"behavior")).length,personalities:e.filter(e=>mb(e,"personality")).length}},[i]),s=(0,Ce.useCallback)(()=>{e.closePackDetail()},[e]);(0,Ce.useEffect)(()=>{if(!t||!i)return;const e=e=>{"Escape"===e.key&&s()};return document.addEventListener("keydown",e),document.body.style.overflow="hidden",()=>{document.removeEventListener("keydown",e),document.body.style.overflow=""}},[t,i,s]);const l=(0,Ce.useCallback)(e=>{e.stopPropagation()},[]),c=(0,Ce.useCallback)(e=>{e.stopPropagation(),e.target===e.currentTarget&&s()},[s]);return t&&i?(0,ot.createPortal)((0,Ee.jsx)("div",{className:"lumiverse-modal-backdrop",onClick:c,onMouseDown:l,onMouseUp:l,onPointerDown:l,onPointerUp:l,onTouchStart:l,onTouchEnd:l,children:(0,Ee.jsxs)("div",{className:"lumiverse-modal lumiverse-modal--large",onClick:l,role:"dialog","aria-modal":"true",children:[(0,Ee.jsxs)("div",{className:"lumiverse-modal-header lumiverse-pack-detail-header",children:[(0,Ee.jsx)("div",{className:"lumiverse-pack-detail-header-icon",children:i.packCover?(0,Ee.jsx)("img",{src:i.packCover,alt:t,className:"lumiverse-pack-detail-header-img"}):(0,Ee.jsx)(Nn,{size:24,strokeWidth:1.5})}),(0,Ee.jsxs)("div",{className:"lumiverse-pack-detail-header-text",children:[(0,Ee.jsx)("h3",{className:"lumiverse-pack-detail-title",children:t}),(0,Ee.jsxs)("div",{className:"lumiverse-pack-detail-stats",children:[(0,Ee.jsxs)("span",{className:"lumiverse-pack-detail-stat",children:[(0,Ee.jsx)(zv,{size:12})," ",a.lumias," Lumia",1!==a.lumias?"s":""]}),(0,Ee.jsxs)("span",{className:"lumiverse-pack-detail-stat",children:[(0,Ee.jsx)(ut,{size:12})," ",a.behaviors," Behavior",1!==a.behaviors?"s":""]}),(0,Ee.jsxs)("span",{className:"lumiverse-pack-detail-stat",children:[(0,Ee.jsx)(jp,{size:12})," ",a.personalities," Personalit",1!==a.personalities?"ies":"y"]})]})]}),(0,Ee.jsx)("button",{className:"lumiverse-modal-close",onClick:s,title:"Close",type:"button",children:(0,Ee.jsx)(mt,{size:20,strokeWidth:2})})]}),(0,Ee.jsx)("div",{className:"lumiverse-modal-body lumiverse-pack-detail-content",children:0===o.length?(0,Ee.jsxs)("div",{className:"lumiverse-pack-detail-empty",children:[(0,Ee.jsx)(Nn,{size:32,strokeWidth:1.5}),(0,Ee.jsx)("p",{children:"No Lumias found in this pack"})]}):(0,Ee.jsx)("div",{className:"lumiverse-responsive-card-grid",children:o.map((r,i)=>(0,Ee.jsx)(vb,{item:r,packName:t,selections:n,actions:e},mb(r,"name")||i))})})]})}),document.body):null};function bb(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function xb(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?bb(Object(t),!0).forEach(function(n){yb(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):bb(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function yb(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const kb=Ye,wb={},jb=()=>{var e;return null===(e=kb.getState().ui)||void 0===e?void 0:e.viewingLoomPack},Cb=()=>kb.getState().packs||wb,Sb={"Narrative Style":{Icon:Qt,color:"rgba(147, 112, 219, 0.15)",colorActive:"rgba(147, 112, 219, 0.25)",border:"rgba(147, 112, 219, 0.3)",borderActive:"rgba(147, 112, 219, 0.6)",storeField:"styles",toggleAction:"toggleLoomStyle"},"Loom Utilities":{Icon:Td,color:"rgba(100, 200, 255, 0.15)",colorActive:"rgba(100, 200, 255, 0.25)",border:"rgba(100, 200, 255, 0.3)",borderActive:"rgba(100, 200, 255, 0.6)",storeField:"utilities",toggleAction:"toggleLoomUtility"},Retrofits:{Icon:Jt,color:"rgba(255, 180, 100, 0.15)",colorActive:"rgba(255, 180, 100, 0.25)",border:"rgba(255, 180, 100, 0.3)",borderActive:"rgba(255, 180, 100, 0.6)",storeField:"retrofits",toggleAction:"toggleLoomRetrofit"}},Nb={categorySection:{marginBottom:"16px"},categoryHeader:{display:"flex",alignItems:"center",gap:"8px",padding:"10px 12px",background:"transparent",border:"1px solid var(--lumiverse-border, rgba(255, 255, 255, 0.1))",borderRadius:"10px",width:"100%",color:"var(--lumiverse-text, #e0e0e0)",fontSize:"13px",fontWeight:500,cursor:"pointer",transition:"background 0.15s ease"},categoryHeaderExpanded:{borderBottomLeftRadius:0,borderBottomRightRadius:0,background:"rgba(0, 0, 0, 0.2)"},categoryIcon:{width:"24px",height:"24px",borderRadius:"6px",background:"rgba(147, 112, 219, 0.15)",display:"flex",alignItems:"center",justifyContent:"center",color:"var(--lumiverse-primary, #9370db)"},categoryTitle:{flex:1,textAlign:"left"},categoryCount:{fontSize:"11px",color:"var(--lumiverse-text-muted, #999)",background:"rgba(0, 0, 0, 0.3)",padding:"2px 8px",borderRadius:"10px"},categoryChevron:{color:"var(--lumiverse-text-muted, #999)",transition:"transform 0.2s ease"},categoryItems:{border:"1px solid var(--lumiverse-border, rgba(255, 255, 255, 0.1))",borderTop:"none",borderBottomLeftRadius:"10px",borderBottomRightRadius:"10px",padding:"8px",display:"flex",flexDirection:"column",gap:"6px"},itemCard:{display:"flex",flexDirection:"column",gap:"8px",padding:"12px",borderRadius:"8px",border:"1px solid",transition:"all 0.15s ease"},itemHeader:{display:"flex",alignItems:"center",gap:"8px"},itemIcon:{width:"20px",height:"20px",borderRadius:"5px",display:"flex",alignItems:"center",justifyContent:"center"},itemName:{flex:1,fontSize:"13px",fontWeight:500,color:"var(--lumiverse-text, #e0e0e0)"},itemToggle:{width:"24px",height:"24px",borderRadius:"6px",border:"1px solid var(--lumiverse-border, rgba(255, 255, 255, 0.15))",background:"rgba(0, 0, 0, 0.2)",color:"var(--lumiverse-text-muted, #999)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.15s ease"},itemToggleSelected:{background:"var(--lumiverse-primary, #9370db)",borderColor:"var(--lumiverse-primary, #9370db)",color:"#fff"},contentToggle:{display:"flex",alignItems:"center",gap:"6px",padding:"6px 10px",background:"rgba(0, 0, 0, 0.2)",border:"none",borderRadius:"6px",width:"fit-content",color:"var(--lumiverse-text-muted, #999)",fontSize:"11px",cursor:"pointer",transition:"background 0.15s ease"},contentText:{fontSize:"12px",lineHeight:1.6,color:"var(--lumiverse-text-muted, #999)",padding:"8px 10px",background:"rgba(0, 0, 0, 0.15)",borderRadius:"6px",margin:0}};function Eb(e){let{content:n,defaultOpen:t=!1}=e;const[r,i]=(0,Ce.useState)(t);if(!n)return null;return(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsxs)("button",{style:Nb.contentToggle,onClick:()=>i(!r),type:"button",children:[(0,Ee.jsx)("span",{children:"Preview"}),(0,Ee.jsx)("span",{children:r?(0,Ee.jsx)(xm,{size:10}):(0,Ee.jsx)(Tn,{size:10})})]}),r&&(0,Ee.jsx)("textarea",{style:{width:"100%",minHeight:"80px",maxHeight:"200px",padding:"10px 12px",fontSize:"12px",lineHeight:"1.6",color:"var(--lumiverse-text-muted, #999)",background:"rgba(0, 0, 0, 0.2)",border:"1px solid rgba(255, 255, 255, 0.1)",borderRadius:"6px",resize:"vertical",overflowY:"auto",whiteSpace:"pre-wrap",wordBreak:"break-word",fontFamily:"inherit",marginTop:"8px",cursor:"text"},value:n,readOnly:!0,rows:Math.min(10,n.split("\n").length+1)})]})}function Pb(e){let{item:n,packName:t,category:r,isSelected:i,onToggle:o}=e;const a=Sb[r]||Sb["Narrative Style"],{Icon:s,color:l,colorActive:c,border:u,borderActive:d}=a,m=n.loomName||n.itemName||n.name||"Unknown";return(0,Ee.jsxs)("div",{style:xb(xb({},Nb.itemCard),{},{background:i?c:l,borderColor:i?d:u}),children:[(0,Ee.jsxs)("div",{style:Nb.itemHeader,children:[(0,Ee.jsx)("span",{style:xb(xb({},Nb.itemIcon),{},{background:i?c:l}),children:(0,Ee.jsx)(s,{size:12,strokeWidth:1.5})}),(0,Ee.jsx)("span",{style:Nb.itemName,children:m}),(0,Ee.jsx)("button",{style:xb(xb({},Nb.itemToggle),i?Nb.itemToggleSelected:{}),onClick:()=>o(t,m),title:i?"Remove from selection":"Add to selection",type:"button",children:i?(0,Ee.jsx)(zd,{size:12,strokeWidth:2}):(0,Ee.jsx)(dr,{size:12,strokeWidth:2})})]}),(0,Ee.jsx)(Eb,{content:n.loomContent||n.content})]})}function Db(e){let{category:n,items:t,packName:r,selections:i,actions:o}=e;const[a,s]=(0,Ce.useState)(!0),l=Sb[n],{Icon:c,storeField:u,toggleAction:d}=l,m=(0,Ce.useCallback)(e=>(i[u]||[]).some(n=>n.packName===r&&n.itemName===e),[i,u,r]),p=(0,Ce.useCallback)((e,n)=>{if(o[d]&&(o[d]({packName:e,itemName:n}),qe(),"undefined"!=typeof toastr)){const e=m(n);toastr.success(e?'Removed "'.concat(n,'"'):'Added "'.concat(n,'"'))}},[o,d,m]);return t&&0!==t.length?(0,Ee.jsxs)("div",{style:Nb.categorySection,children:[(0,Ee.jsxs)("button",{style:xb(xb({},Nb.categoryHeader),a?Nb.categoryHeaderExpanded:{}),onClick:()=>s(!a),type:"button",children:[(0,Ee.jsx)("span",{style:Nb.categoryIcon,children:(0,Ee.jsx)(c,{size:14,strokeWidth:1.5})}),(0,Ee.jsx)("span",{style:Nb.categoryTitle,children:n}),(0,Ee.jsx)("span",{style:Nb.categoryCount,children:t.length}),(0,Ee.jsx)("span",{style:Nb.categoryChevron,children:a?(0,Ee.jsx)(xm,{size:14}):(0,Ee.jsx)(Tn,{size:14})})]}),a&&(0,Ee.jsx)("div",{style:Nb.categoryItems,children:t.map((e,t)=>{const i=e.loomName||e.itemName||e.name;return(0,Ee.jsx)(Pb,{item:e,packName:r,category:n,isSelected:m(i),onToggle:p},i||t)})})]}):null}const Mb=function(){const e=Xe(),n=hn(),t=(0,Ce.useSyncExternalStore)(kb.subscribe,jb,jb),r=(0,Ce.useSyncExternalStore)(kb.subscribe,Cb,Cb),i=(0,Ce.useMemo)(()=>t&&r[t]||null,[t,r]),o=(0,Ce.useMemo)(()=>i?function(e){const n={"Narrative Style":[],"Loom Utilities":[],Retrofits:[]},t=e=>{const t=e.loomCategory||e.category;"Narrative Style"===t||"loomStyles"===t?n["Narrative Style"].push(e):"Loom Utilities"===t||"loomUtils"===t?n["Loom Utilities"].push(e):"Retrofits"!==t&&"loomRetrofits"!==t||n.Retrofits.push(e)};return e.loomItems&&Array.isArray(e.loomItems)&&e.loomItems.forEach(t),e.loomStyles&&Array.isArray(e.loomStyles)&&n["Narrative Style"].push(...e.loomStyles),e.loomUtils&&Array.isArray(e.loomUtils)&&n["Loom Utilities"].push(...e.loomUtils),e.loomRetrofits&&Array.isArray(e.loomRetrofits)&&n.Retrofits.push(...e.loomRetrofits),e.items&&Array.isArray(e.items)&&e.items.forEach(e=>{(e.loomCategory||e.category)&&t(e)}),n}(i):null,[i]),a=(0,Ce.useMemo)(()=>o?{styles:o["Narrative Style"].length,utilities:o["Loom Utilities"].length,retrofits:o.Retrofits.length}:{styles:0,utilities:0,retrofits:0},[o]),s=a.styles+a.utilities+a.retrofits,l=(0,Ce.useCallback)(()=>{e.closeLoomPackDetail()},[e]);(0,Ce.useEffect)(()=>{if(!t||!i)return;const e=e=>{"Escape"===e.key&&l()};return document.addEventListener("keydown",e),document.body.style.overflow="hidden",()=>{document.removeEventListener("keydown",e),document.body.style.overflow=""}},[t,i,l]);const c=(0,Ce.useCallback)(e=>{e.stopPropagation()},[]),u=(0,Ce.useCallback)(e=>{e.stopPropagation(),e.target===e.currentTarget&&l()},[l]);return t&&i?(0,ot.createPortal)((0,Ee.jsx)("div",{className:"lumiverse-modal-backdrop",onClick:u,onMouseDown:c,onMouseUp:c,onPointerDown:c,onPointerUp:c,onTouchStart:c,onTouchEnd:c,children:(0,Ee.jsxs)("div",{className:"lumiverse-modal lumiverse-modal--medium",onClick:c,role:"dialog","aria-modal":"true",children:[(0,Ee.jsxs)("div",{className:"lumiverse-modal-header lumiverse-pack-detail-header",children:[(0,Ee.jsx)("div",{className:"lumiverse-pack-detail-header-icon",children:i.packCover?(0,Ee.jsx)("img",{src:i.packCover,alt:t,className:"lumiverse-pack-detail-header-img"}):(0,Ee.jsx)(Jt,{size:24,strokeWidth:1.5})}),(0,Ee.jsxs)("div",{className:"lumiverse-pack-detail-header-text",children:[(0,Ee.jsx)("h3",{className:"lumiverse-pack-detail-title",children:t}),(0,Ee.jsxs)("div",{className:"lumiverse-pack-detail-stats",children:[(0,Ee.jsxs)("span",{className:"lumiverse-pack-detail-stat",children:[(0,Ee.jsx)(Qt,{size:12})," ",a.styles," Style",1!==a.styles?"s":""]}),(0,Ee.jsxs)("span",{className:"lumiverse-pack-detail-stat",children:[(0,Ee.jsx)(Td,{size:12})," ",a.utilities," Utilit",1!==a.utilities?"ies":"y"]}),(0,Ee.jsxs)("span",{className:"lumiverse-pack-detail-stat",children:[(0,Ee.jsx)(Jt,{size:12})," ",a.retrofits," Retrofit",1!==a.retrofits?"s":""]})]})]}),(0,Ee.jsx)("button",{className:"lumiverse-modal-close",onClick:l,title:"Close",type:"button",children:(0,Ee.jsx)(mt,{size:20,strokeWidth:2})})]}),(0,Ee.jsx)("div",{className:"lumiverse-modal-body lumiverse-pack-detail-content",children:0===s?(0,Ee.jsxs)("div",{className:"lumiverse-pack-detail-empty",children:[(0,Ee.jsx)(Jt,{size:32,strokeWidth:1.5}),(0,Ee.jsx)("p",{children:"No Loom items found in this pack"})]}):(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsx)(Db,{category:"Narrative Style",items:o["Narrative Style"],packName:t,selections:n,actions:e}),(0,Ee.jsx)(Db,{category:"Loom Utilities",items:o["Loom Utilities"],packName:t,selections:n,actions:e}),(0,Ee.jsx)(Db,{category:"Retrofits",items:o.Retrofits,packName:t,selections:n,actions:e})]})})]})}),document.body):null},Ob=Sn("external-link",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);function Tb(e){let{variant:n="full",onDismiss:t}=e;const{extensionUpdate:r,presetUpdates:i,hasAnyUpdate:o,hasExtensionUpdate:a}=bn(),s=Qe(e=>e.ui.isUpdatingExtension),l=Xe(),[c,u]=(0,Ce.useState)(null);if(!o)return null;const d=(null==i?void 0:i.length)||0;return"compact"===n?(0,Ee.jsx)("div",{className:"lumiverse-update-indicator",children:(0,Ee.jsx)(at,{size:12,strokeWidth:2.5})}):"badge"===n?(0,Ee.jsx)("span",{className:"lumiverse-update-badge",children:"New!"}):(0,Ee.jsx)("div",{className:On("lumiverse-update-banner",a&&"has-extension-update"),children:(0,Ee.jsxs)("div",{className:"lumiverse-update-banner-content",children:[(0,Ee.jsx)("div",{className:"lumiverse-update-banner-icon",children:(0,Ee.jsx)(at,{size:20,strokeWidth:2})}),(0,Ee.jsxs)("div",{className:"lumiverse-update-banner-text",children:[a&&(0,Ee.jsxs)("div",{className:"lumiverse-update-banner-main",children:[(0,Ee.jsxs)("strong",{children:["Lumiverse Helper ",r.latestVersion]})," available",c?(0,Ee.jsxs)("span",{className:On("lumiverse-update-result",c.success?"success":"error"),style:{display:"inline-flex",alignItems:"center",gap:"4px",marginLeft:"8px",fontSize:"0.9em",fontWeight:"normal"},children:[c.success?(0,Ee.jsx)(zd,{size:12}):(0,Ee.jsx)(ht,{size:12}),c.success?"Updated!":c.message,c.success&&(0,Ee.jsxs)("button",{className:"lumiverse-update-banner-link",onClick:()=>{window.location.reload()},style:{background:"none",border:"none",padding:0,font:"inherit",cursor:"pointer",display:"inline-flex",alignItems:"center",gap:"4px",textDecoration:"underline",marginLeft:"4px"},children:["Reload now ",(0,Ee.jsx)(pt,{size:12})]})]}):(0,Ee.jsxs)("button",{className:"lumiverse-update-banner-link",onClick:async()=>{if(s)return;const e=await l.updateExtension();u(e),e.success&&setTimeout(()=>{l.setExtensionUpdate(null)},5e3)},disabled:s,style:{background:"none",border:"none",padding:0,font:"inherit",cursor:s?"wait":"pointer",display:"inline-flex",alignItems:"center",gap:"4px",textDecoration:"underline"},children:[s?"Updating...":"Update now",s?(0,Ee.jsx)(gt,{size:12,className:"animate-spin"}):(0,Ee.jsx)(Ob,{size:12})]})]}),d>0&&(0,Ee.jsxs)("div",{className:"lumiverse-update-banner-presets",children:[d," preset",1!==d?"s":""," ",1!==d?"have":"has"," updates: ",i.slice(0,3).map(e=>e.name).join(", "),d>3?", +".concat(d-3," more"):""]})]}),t&&(0,Ee.jsx)("button",{className:"lumiverse-update-banner-dismiss",onClick:t,title:"Dismiss",children:(0,Ee.jsx)(mt,{size:16})})]})})}function Ab(){const{hasAnyUpdate:e}=bn();return e?(0,Ee.jsx)("span",{className:"lumiverse-update-dot"}):null}function Lb(){console.log("[useUpdateChecker] Hook function called");const e=Xe(),n=(0,Ce.useRef)(null),t=(0,Ce.useRef)(!1);console.log("[useUpdateChecker] Got actions:",!!e);const r=(0,Ce.useCallback)(async()=>{if(console.log("[useUpdateChecker] performUpdateCheck started, actions available:",!!e),e)if("function"==typeof e.setExtensionUpdate)if("function"==typeof e.setPresetUpdates)try{console.log("[useUpdateChecker] Calling checkExtensionUpdate...");const n=await(0,Ne.bR)();console.log("[useUpdateChecker] checkExtensionUpdate result:",n),n&&e.setExtensionUpdate(n),console.log("[useUpdateChecker] Calling checkForPresetUpdates...");const t=await Lt();console.log("[useUpdateChecker] checkForPresetUpdates result:",t),e.setPresetUpdates(t);!function(e,n,t){var r;if("undefined"!=typeof window&&null!==(r=window.LumiverseUI)&&void 0!==r&&r.updateAccordionBadge){let r="New!";t&&n>0?r="Updates!":n>1&&(r="".concat(n," updates")),window.LumiverseUI.updateAccordionBadge(e,r)}}((null==n?void 0:n.hasUpdate)||(null==t?void 0:t.length)>0,(null==t?void 0:t.length)||0,null==n?void 0:n.hasUpdate),console.log("[useUpdateChecker] Update check complete:",{extensionUpdate:null==n?void 0:n.hasUpdate,presetUpdates:(null==t?void 0:t.length)||0})}catch(e){console.error("[useUpdateChecker] Update check failed:",e),console.error("[useUpdateChecker] Error stack:",null==e?void 0:e.stack)}else console.error("[useUpdateChecker] setPresetUpdates action not available");else console.error("[useUpdateChecker] setExtensionUpdate action not available");else console.error("[useUpdateChecker] Actions not available - cannot perform update check")},[e]);return(0,Ce.useEffect)(()=>{if(t.current)return void console.log("[useUpdateChecker] Already initialized, skipping");if(t.current=!0,!e)return void console.error("[useUpdateChecker] Cannot initialize - actions not available");console.log("[useUpdateChecker] Hook initialized, scheduling check in",5e3,"ms"),console.log("[useUpdateChecker] Available actions:",Object.keys(e).filter(n=>"function"==typeof e[n]));const i=setTimeout(()=>{console.log("[useUpdateChecker] Running initial update check..."),r()},5e3);n.current=setInterval(()=>{console.log("[useUpdateChecker] Running periodic update check..."),r()},3e5);const o=(0,Ne.Wg)(n=>{console.log("[useUpdateChecker] Received update from service:",n),n.extensionUpdate&&null!=e&&e.setExtensionUpdate&&e.setExtensionUpdate(n.extensionUpdate)});return()=>{console.log("[useUpdateChecker] Cleaning up..."),clearTimeout(i),n.current&&clearInterval(n.current),o()}},[r,e]),{refresh:r}}const zb=function(){pn();const e=Xe(),n=fn(),{extensionUpdate:t}=bn();console.log("[App] Component rendering, actions available:",!!e),Lb();const r=(0,Ce.useCallback)(()=>{null!=t&&t.latestVersion&&e.dismissExtensionUpdate(t.latestVersion)},[e,null==t?void 0:t.latestVersion]);return(0,Ee.jsxs)("div",{className:"lumiverse-app",children:[(0,Ee.jsx)(Tb,{variant:"full",onDismiss:r}),(0,Ee.jsx)(pm,{}),(0,Ee.jsx)(rb,{}),(0,Ee.jsx)(fb,{}),(0,Ee.jsx)(Mb,{}),n.isLoading&&(0,Ee.jsx)("div",{className:"lumiverse-loading-overlay",children:(0,Ee.jsx)("div",{className:"lumiverse-spinner"})}),n.error&&(0,Ee.jsxs)("div",{className:"lumiverse-error-toast",onClick:e.clearError,children:[(0,Ee.jsx)("span",{children:n.error}),(0,Ee.jsx)("button",{className:"lumiverse-error-dismiss",children:"Dismiss"})]})]})},Ib=Sn("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),Rb=Sn("sliders-vertical",[["path",{d:"M10 8h4",key:"1sr2af"}],["path",{d:"M12 21v-9",key:"17s77i"}],["path",{d:"M12 8V3",key:"13r4qs"}],["path",{d:"M17 16h4",key:"h1uq16"}],["path",{d:"M19 12V3",key:"o1uvq1"}],["path",{d:"M19 21v-5",key:"qua636"}],["path",{d:"M3 14h4",key:"bcjad9"}],["path",{d:"M5 10V3",key:"cb8scm"}],["path",{d:"M5 21v-7",key:"1w1uti"}]]);function Bb(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function _b(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Bb(Object(t),!0).forEach(function(n){Fb(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Bb(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Fb(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const Ub=Ye,Hb={side:"right",verticalPosition:15,tabSize:"large"},Wb=()=>{var e;return null!==(e=Ub.getState().drawerSettings)&&void 0!==e?e:Hb};function Vb(e){let{isVisible:n,onClick:t,hasUpdates:r,side:i="right",verticalPosition:o=15,tabSize:a="large"}=e;const s="left"===i,l="compact"===a;return(0,Ee.jsxs)("button",{className:On("lumiverse-drawer-tab",n&&"lumiverse-drawer-tab--active",r&&"lumiverse-drawer-tab--has-updates",s&&"lumiverse-drawer-tab--left",l&&"lumiverse-drawer-tab--compact"),onClick:t,title:n?"Hide Lumiverse Panel":"Show Lumiverse Panel",type:"button","aria-expanded":n,"aria-label":"Toggle Lumiverse drawer",style:{marginTop:"".concat(Math.max(8,Math.min(85,o)),"vh")},children:[(0,Ee.jsx)("span",{className:"lumiverse-drawer-tab-icon",children:(0,Ee.jsx)(Qt,{size:l?14:16,strokeWidth:2.5})}),(0,Ee.jsx)("span",{className:"lumiverse-drawer-tab-label",children:"Lumia"}),(0,Ee.jsx)(Ab,{})]})}function qb(e){let{id:n,Icon:t,label:r,isActive:i,onClick:o}=e;return(0,Ee.jsxs)("button",{className:On("lumiverse-vp-tab",i&&"lumiverse-vp-tab--active"),onClick:()=>o(n),title:r,type:"button",children:[(0,Ee.jsx)("span",{className:"lumiverse-vp-tab-icon",children:(0,Ee.jsx)(t,{size:20,strokeWidth:1.5})}),(0,Ee.jsx)("span",{className:"lumiverse-vp-tab-label",children:r})]})}function $b(e){let{isCollapsed:n,onClick:t,side:r="right"}=e;const i=("left"===r?!n:n)?Ib:An;return(0,Ee.jsx)("button",{className:"lumiverse-vp-collapse-btn",onClick:t,title:n?"Expand panel":"Collapse panel",type:"button",children:(0,Ee.jsx)("span",{className:"lumiverse-vp-collapse-icon",children:(0,Ee.jsx)(i,{size:18,strokeWidth:2})})})}function Yb(e){let{title:n,Icon:t,onClose:r}=e;return(0,Ee.jsxs)("div",{className:"lumiverse-vp-header",children:[(0,Ee.jsx)("span",{className:"lumiverse-vp-header-icon",children:(0,Ee.jsx)(t,{size:18,strokeWidth:1.5})}),(0,Ee.jsx)("span",{className:"lumiverse-vp-header-title",children:n}),(0,Ee.jsx)("button",{className:"lumiverse-vp-close-btn",onClick:r,title:"Close panel",type:"button",children:(0,Ee.jsx)(mt,{size:16,strokeWidth:2})})]})}const Gb=[{id:"profile",Icon:lr,label:"Profile",title:"Character Lumia Profile"},{id:"presets",Icon:Ld,label:"Presets",title:"Lumia Presets"},{id:"browser",Icon:Nn,label:"Packs",title:"Pack Browser"},{id:"ooc",Icon:ur,label:"OOC",title:"OOC Settings"},{id:"prompt",Icon:Rb,label:"Prompt",title:"Prompt Settings"},{id:"council",Icon:Ad,label:"Council",title:"Council of Lumiae"},{id:"summary",Icon:zv,label:"Summary",title:"Summary Editor"}];function Kb(e){let{tab:n}=e;const t={profile:{Icon:lr,title:"Character Lumia Profile",description:"View and manage Lumia traits for the current character"},presets:{Icon:Ld,title:"Lumia Presets",description:"Save and load preset configurations for quick switching"},browser:{Icon:Nn,title:"Pack Browser",description:"Browse and search through all loaded packs with previews"},ooc:{Icon:ur,title:"OOC Settings",description:"Configure out-of-character comment behavior and triggers"},prompt:{Icon:Rb,title:"Prompt Settings",description:"Configure prompt injection and formatting options"},council:{Icon:Ad,title:"Council of Lumiae",description:"Manage multiple independent Lumias that collaborate as a council"},summary:{Icon:zv,title:"Summary Editor",description:"View and edit the current conversation summary"}}[n]||{},{Icon:r}=t;return(0,Ee.jsxs)("div",{className:"lumiverse-vp-placeholder",children:[r&&(0,Ee.jsx)("span",{className:"lumiverse-vp-placeholder-icon",children:(0,Ee.jsx)(r,{size:32,strokeWidth:1.5})}),(0,Ee.jsx)("h3",{children:t.title}),(0,Ee.jsx)("p",{children:t.description}),(0,Ee.jsx)("span",{className:"lumiverse-vp-placeholder-badge",children:"Coming Soon"})]})}const Qb=function(e){var n;let{isVisible:t,onToggle:r,onClose:i,defaultTab:o="profile",drawerSettings:a,ProfileContent:s,PresetsContent:l,BrowserContent:c,OOCContent:u,PromptContent:d,CouncilContent:m,SummaryContent:p}=e;const[g,h]=(0,Ce.useState)(o),[v,f]=(0,Ce.useState)(!1),b=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:600;const[n,t]=(0,Ce.useState)("undefined"!=typeof window&&window.innerWidth<=e);return(0,Ce.useEffect)(()=>{const n=()=>{const n=window.innerWidth<=e;t(e=>e!==n?n:e)};return window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[e]),n}(),{hasAnyUpdate:x}=bn(),y=(0,Ce.useSyncExternalStore)(Ub.subscribe,Wb,Wb),k=a||y,w=(null==k?void 0:k.side)||"right",j=null!==(n=null==k?void 0:k.verticalPosition)&&void 0!==n?n:15,C=(null==k?void 0:k.tabSize)||"large",S="left"===w,N=b?window.innerWidth:376,E="compact"===C,P=b?E?32:40:E?32:48,D=b?"calc(100vw + ".concat(P,"px)"):376+P,M=b?0:S?-320:320,O=(0,Ce.useCallback)(e=>{v&&f(!1),h(e)},[v]),T=(0,Ce.useCallback)(()=>{f(e=>!e)},[]),A=Gb.find(e=>e.id===g),L=(0,Ce.useMemo)(()=>({profile:s?(0,Ee.jsx)(s,{onTabChange:O}):(0,Ee.jsx)(Kb,{tab:"profile"}),presets:l?(0,Ee.jsx)(l,{}):(0,Ee.jsx)(Kb,{tab:"presets"}),browser:c?(0,Ee.jsx)(c,{}):(0,Ee.jsx)(Kb,{tab:"browser"}),ooc:u?(0,Ee.jsx)(u,{}):(0,Ee.jsx)(Kb,{tab:"ooc"}),prompt:d?(0,Ee.jsx)(d,{}):(0,Ee.jsx)(Kb,{tab:"prompt"}),council:m?(0,Ee.jsx)(m,{}):(0,Ee.jsx)(Kb,{tab:"council"}),summary:p?(0,Ee.jsx)(p,{}):(0,Ee.jsx)(Kb,{tab:"summary"})}),[s,l,c,u,d,m,p,O]);return(0,Ee.jsxs)(Ee.Fragment,{children:[!t&&(0,Ee.jsx)("div",{className:On("lumiverse-drawer-tab-standalone",S&&"lumiverse-drawer-tab-standalone--left"),style:{position:"fixed",top:0,[S?"left":"right"]:0,height:"100vh",zIndex:9999,pointerEvents:"none"},children:(0,Ee.jsx)(Vb,{isVisible:t,onClick:r,hasUpdates:x,side:w,verticalPosition:j,tabSize:C})}),(0,Ee.jsx)("div",{className:On("lumiverse-viewport-wrapper",t&&"lumiverse-viewport-wrapper--visible",S&&"lumiverse-viewport-wrapper--left"),style:(()=>{const e={position:"fixed",top:0,bottom:0,width:D,zIndex:9998,transition:"transform 0.3s cubic-bezier(0.32, 0.72, 0, 1)",pointerEvents:"none"},n=b?"100vw":"".concat(N,"px");return _b(_b({},e),{},S?{left:0,transform:t?"translateX(0)":"translateX(calc(-".concat(n,"))")}:{right:0,transform:t?"translateX(0)":"translateX(".concat(n,")")})})(),children:(0,Ee.jsxs)("div",{className:On("lumiverse-viewport-panel",v&&"lumiverse-viewport-panel--collapsed",S&&"lumiverse-viewport-panel--left"),style:{transform:v?"translateX(".concat(M,"px)"):"translateX(0)",transition:"transform 0.2s ease",pointerEvents:"auto"},children:[(0,Ee.jsx)(Vb,{isVisible:t,onClick:r,hasUpdates:x,side:w,verticalPosition:j,tabSize:C}),(0,Ee.jsxs)("div",{className:"lumiverse-vp-tabs",children:[Gb.map(e=>(0,Ee.jsx)(qb,{id:e.id,Icon:e.Icon,label:e.label,isActive:g===e.id,onClick:O},e.id)),(0,Ee.jsx)("div",{className:"lumiverse-vp-tabs-spacer"}),!b&&(0,Ee.jsx)($b,{isCollapsed:v,onClick:T,side:w})]}),(0,Ee.jsxs)("div",{className:"lumiverse-vp-main",style:{width:b?void 0:320,opacity:v?0:1,transition:"opacity 0.2s ease"},children:[(0,Ee.jsx)(Yb,{title:(null==A?void 0:A.title)||"Panel",Icon:(null==A?void 0:A.Icon)||lr,onClose:i}),(0,Ee.jsx)(Tb,{variant:"full"}),(0,Ee.jsx)("div",{className:"lumiverse-vp-content",children:Gb.map(e=>(0,Ee.jsx)("div",{className:On("lumiverse-vp-tab-content",g===e.id&&"lumiverse-vp-tab-content--active"),"aria-hidden":g!==e.id,children:L[e.id]},e.id))})]})]})})]})},Xb=Ye,Zb=[],Jb=()=>Xb.getState().chatChangeCounter||0,ex=()=>Xb.getState().chimeraMode||!1,nx=()=>Xb.getState().selectedDefinitions||Zb,tx=()=>Xb.getState().councilMode||!1,rx=()=>Xb.getState().councilMembers||Zb,ix=()=>Xb.getState().activePresetName||"";function ox(e){return(null==e?void 0:e.id)||(null==e?void 0:e.itemName)||(null==e?void 0:e.lumiaDefName)||null}function ax(e,n){if(!e||!n)return!1;const t=ox(e),r=ox(n);return t&&r&&t===r}const sx=(0,Ce.forwardRef)(function(e,n){let{trait:t,type:r,isDominant:i,onRemove:o}=e;const a={definition:{bg:"rgba(100, 200, 255, 0.15)",border:"rgba(100, 200, 255, 0.3)",Icon:zv},behavior:{bg:"rgba(255, 180, 100, 0.15)",border:"rgba(255, 180, 100, 0.3)",Icon:ut},personality:{bg:"rgba(200, 100, 255, 0.15)",border:"rgba(200, 100, 255, 0.3)",Icon:jp}},s=a[r]||a.definition,{Icon:l}=s;return(0,Ee.jsxs)(Od.div,{ref:n,className:On("lumiverse-trait-card",i&&"lumiverse-trait-card--dominant"),style:{background:s.bg,borderColor:s.border},initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.1},children:[(0,Ee.jsx)("span",{className:"lumiverse-trait-icon",children:(0,Ee.jsx)(l,{size:16,strokeWidth:1.5})}),(0,Ee.jsxs)("div",{className:"lumiverse-trait-info",children:[(0,Ee.jsx)("span",{className:"lumiverse-trait-name",children:t.name||t.itemName||t.lumiaDefName||"Unknown"}),i&&(0,Ee.jsxs)("span",{className:"lumiverse-trait-dominant-badge",children:[(0,Ee.jsx)(hm,{size:12,strokeWidth:2})," Dominant"]})]}),o&&(0,Ee.jsx)("button",{className:"lumiverse-trait-remove",onClick:()=>o(t),title:"Remove trait",type:"button",children:(0,Ee.jsx)(mt,{size:14,strokeWidth:2})})]})});function lx(e){let{Icon:n,title:t,count:r}=e;return(0,Ee.jsxs)("div",{className:"lumiverse-profile-section-header",children:[(0,Ee.jsx)("span",{className:"lumiverse-profile-section-icon",children:(0,Ee.jsx)(n,{size:16,strokeWidth:1.5})}),(0,Ee.jsx)("span",{className:"lumiverse-profile-section-title",children:t}),void 0!==r&&(0,Ee.jsx)("span",{className:"lumiverse-profile-section-count",children:r})]})}function cx(e){let{message:n}=e;return(0,Ee.jsx)("div",{className:"lumiverse-profile-empty",children:(0,Ee.jsx)("span",{children:n})})}function ux(e){let{councilMembers:n,allPacks:t,onManageCouncil:r}=e;const i=n.length,o=n.reduce((e,n)=>{var t;return e+((null===(t=n.behaviors)||void 0===t?void 0:t.length)||0)},0),a=n.reduce((e,n)=>{var t;return e+((null===(t=n.personalities)||void 0===t?void 0:t.length)||0)},0),s=n.slice(0,4),l=i-4;return(0,Ee.jsxs)("div",{className:"lumiverse-council-banner",children:[(0,Ee.jsx)("div",{className:"lumiverse-council-banner-icon",children:(0,Ee.jsx)(Ad,{size:28,strokeWidth:1.5})}),(0,Ee.jsxs)("div",{className:"lumiverse-council-banner-content",children:[(0,Ee.jsx)("h4",{className:"lumiverse-council-banner-title",children:"Council of Lumiae Active"}),(0,Ee.jsxs)("div",{className:"lumiverse-council-banner-stats",children:[(0,Ee.jsxs)("span",{className:"lumiverse-council-banner-stat",children:[(0,Ee.jsx)(Ad,{size:14})," ",i," member",1!==i?"s":""]}),(0,Ee.jsxs)("span",{className:"lumiverse-council-banner-stat",children:[(0,Ee.jsx)(ut,{size:14})," ",o," behavior",1!==o?"s":""]}),(0,Ee.jsxs)("span",{className:"lumiverse-council-banner-stat",children:[(0,Ee.jsx)(jp,{size:14})," ",a," personalit",1!==a?"ies":"y"]})]}),s.length>0&&(0,Ee.jsxs)("div",{className:"lumiverse-council-banner-avatars",children:[s.map((e,n)=>{const r=function(e,n,t){var r;const i=(Array.isArray(e)?e:Object.values(e||{})).find(e=>(e.name||e.packName)===n);if(!i)return null;if(i.lumiaItems&&i.lumiaItems.length>0){const e=i.lumiaItems.find(e=>e.lumiaName===t||e.lumiaDefName===t);return(null==e?void 0:e.avatarUrl)||(null==e?void 0:e.lumia_img)||null}const o=null===(r=i.items)||void 0===r?void 0:r.find(e=>e.lumiaDefName===t);return(null==o?void 0:o.lumia_img)||null}(t,e.packName,e.itemName);return(0,Ee.jsx)("div",{className:"lumiverse-council-banner-avatar",style:{zIndex:s.length-n},title:e.itemName,children:r?(0,Ee.jsx)("img",{src:r,alt:e.itemName}):(0,Ee.jsx)(Ad,{size:14})},e.id)}),l>0&&(0,Ee.jsxs)("div",{className:"lumiverse-council-banner-more",children:["+",l]})]})]}),r&&(0,Ee.jsxs)("button",{className:"lumiverse-council-banner-btn",onClick:r,type:"button",children:["Manage Council ",(0,Ee.jsx)(kp,{size:16})]})]})}function dx(){const e=hn(),{styles:n,utilities:t,retrofits:r}=e;return n.length>0||t.length>0||r.length>0?(0,Ee.jsxs)("div",{className:"lumiverse-profile-section",children:[(0,Ee.jsx)(lx,{Icon:Qt,title:"Loom Configuration"}),(0,Ee.jsxs)("div",{className:"lumiverse-loom-summary",children:[n.length>0&&(0,Ee.jsxs)("div",{className:"lumiverse-loom-group",children:[(0,Ee.jsx)("span",{className:"lumiverse-loom-label",children:"Styles:"}),(0,Ee.jsx)("span",{className:"lumiverse-loom-items",children:n.map(e=>e.name||e.itemName||"Unknown").join(", ")})]}),t.length>0&&(0,Ee.jsxs)("div",{className:"lumiverse-loom-group",children:[(0,Ee.jsx)("span",{className:"lumiverse-loom-label",children:"Utilities:"}),(0,Ee.jsx)("span",{className:"lumiverse-loom-items",children:t.map(e=>e.name||e.itemName||"Unknown").join(", ")})]}),r.length>0&&(0,Ee.jsxs)("div",{className:"lumiverse-loom-group",children:[(0,Ee.jsx)("span",{className:"lumiverse-loom-label",children:"Retrofits:"}),(0,Ee.jsx)("span",{className:"lumiverse-loom-items",children:r.map(e=>e.name||e.itemName||"Unknown").join(", ")})]})]})]}):(0,Ee.jsxs)("div",{className:"lumiverse-profile-section",children:[(0,Ee.jsx)(lx,{Icon:Qt,title:"Loom Configuration"}),(0,Ee.jsx)(cx,{message:"No Loom items selected"})]})}function mx(e){let{onClose:n}=e;const{contextInfo:t,availablePresets:r,currentCharacterBinding:i,currentChatBinding:o,bindCurrentCharacter:a,bindCurrentChat:s,removeCharacterBinding:l,removeChatBinding:c,refreshPresets:u,hasChatToggleBinding:d,hasCharacterToggleBinding:m,saveTogglesToChat:p,clearChatToggleBinding:g,saveTogglesToCharacter:h,clearCharacterToggleBinding:v}=hr(),f=(0,Ce.useSyncExternalStore)(Xb.subscribe,ix,ix),[b,x]=(0,Ce.useState)(()=>i||o||f||""),[y,k]=(0,Ce.useState)("character");Ce.useEffect(()=>{u()},[u]),Ce.useEffect(()=>{const e=e=>{"Escape"===e.key&&n()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[n]);const w=(0,Ce.useCallback)(()=>{var e;if(!b)return void(null===(e=toastr)||void 0===e||e.warning("Select a preset first"));let n=!1;var r,i,o;"character"===y?(n=a(b),n&&(null===(r=toastr)||void 0===r||r.success('Bound "'.concat(t.characterName,'" to "').concat(b,'"')))):(n=s(b),n&&(null===(i=toastr)||void 0===i||i.success('Bound current chat to "'.concat(b,'"'))));n?x(""):null===(o=toastr)||void 0===o||o.error("No active context to bind")},[b,y,a,s,t.characterName]),j=(0,Ce.useCallback)(()=>{var e;t.characterAvatar&&(l(t.characterAvatar),null===(e=toastr)||void 0===e||e.info("Character binding removed"))},[t.characterAvatar,l]),C=(0,Ce.useCallback)(()=>{var e;t.chatId&&(c(t.chatId),null===(e=toastr)||void 0===e||e.info("Chat binding removed"))},[t.chatId,c]),S=(0,Ce.useCallback)(async()=>{var e,n;await h()?null===(e=toastr)||void 0===e||e.success('Bound current prompt toggles to "'.concat(t.characterName,'"')):null===(n=toastr)||void 0===n||n.error("Failed to bind prompt toggles")},[h,t.characterName]),N=(0,Ce.useCallback)(async()=>{var e,n;await p()?null===(e=toastr)||void 0===e||e.success("Bound current prompt toggles to chat"):null===(n=toastr)||void 0===n||n.error("Failed to bind prompt toggles")},[p]),E=(0,Ce.useCallback)(()=>{var e;v(),null===(e=toastr)||void 0===e||e.info("Character toggle binding removed")},[v]),P=(0,Ce.useCallback)(()=>{var e;g(),null===(e=toastr)||void 0===e||e.info("Chat toggle binding removed")},[g]),D=(0,Ce.useCallback)(e=>{e.target===e.currentTarget&&n()},[n]),M=t.characterAvatar||t.chatId;return(0,ot.createPortal)((0,Ee.jsx)("div",{className:"lumiverse-modal-backdrop lumiverse-profile-bindings-backdrop",onClick:D,children:(0,Ee.jsxs)("div",{className:"lumiverse-profile-bindings-modal",onClick:e=>e.stopPropagation(),role:"dialog","aria-modal":"true",children:[(0,Ee.jsxs)("div",{className:"lumiverse-profile-bindings-header",children:[(0,Ee.jsx)("div",{className:"lumiverse-profile-bindings-header-icon",children:(0,Ee.jsx)(cr,{size:18,strokeWidth:2})}),(0,Ee.jsxs)("div",{className:"lumiverse-profile-bindings-header-text",children:[(0,Ee.jsx)("span",{className:"lumiverse-profile-bindings-title",children:"Preset Binding"}),(0,Ee.jsx)("span",{className:"lumiverse-profile-bindings-subtitle",children:t.characterName||"No character"})]}),(0,Ee.jsx)("button",{className:"lumiverse-profile-bindings-close",onClick:n,type:"button",children:(0,Ee.jsx)(mt,{size:16,strokeWidth:2})})]}),M?(0,Ee.jsxs)("div",{className:"lumiverse-profile-bindings-content",children:[(0,Ee.jsxs)("div",{className:"lumiverse-profile-bindings-status",children:[(0,Ee.jsxs)("div",{className:On("lumiverse-profile-bindings-status-row",i&&"is-bound"),children:[(0,Ee.jsx)(lr,{size:14,strokeWidth:1.5}),(0,Ee.jsx)("span",{className:"lumiverse-profile-bindings-status-label",children:"Character:"}),(0,Ee.jsx)("span",{className:"lumiverse-profile-bindings-status-value",children:i||"Not bound"}),i&&(0,Ee.jsx)("button",{className:"lumiverse-profile-bindings-status-remove",onClick:j,title:"Remove binding",type:"button",children:(0,Ee.jsx)(mt,{size:12,strokeWidth:2})})]}),(0,Ee.jsxs)("div",{className:On("lumiverse-profile-bindings-status-row",o&&"is-bound"),children:[(0,Ee.jsx)(ur,{size:14,strokeWidth:1.5}),(0,Ee.jsx)("span",{className:"lumiverse-profile-bindings-status-label",children:"Chat:"}),(0,Ee.jsx)("span",{className:"lumiverse-profile-bindings-status-value",children:o||"Not bound"}),o&&(0,Ee.jsx)("button",{className:"lumiverse-profile-bindings-status-remove",onClick:C,title:"Remove binding",type:"button",children:(0,Ee.jsx)(mt,{size:12,strokeWidth:2})})]})]}),(0,Ee.jsxs)("div",{className:"lumiverse-profile-bindings-create",children:[(0,Ee.jsxs)("div",{className:"lumiverse-profile-bindings-type-toggle",children:[(0,Ee.jsxs)("button",{className:On("lumiverse-profile-bindings-type-btn","character"===y&&"is-active"),onClick:()=>k("character"),disabled:!t.characterAvatar,type:"button",children:[(0,Ee.jsx)(lr,{size:12,strokeWidth:2}),"Character"]}),(0,Ee.jsxs)("button",{className:On("lumiverse-profile-bindings-type-btn","chat"===y&&"is-active"),onClick:()=>k("chat"),disabled:!t.chatId,type:"button",children:[(0,Ee.jsx)(ur,{size:12,strokeWidth:2}),"Chat"]})]}),(0,Ee.jsxs)("div",{className:"lumiverse-profile-bindings-select-row",children:[(0,Ee.jsxs)("select",{className:"lumiverse-profile-bindings-select",value:b,onChange:e=>x(e.target.value),children:[(0,Ee.jsx)("option",{value:"",children:"Select preset..."}),r.map(e=>(0,Ee.jsx)("option",{value:e,children:e},e))]}),(0,Ee.jsx)("button",{className:"lumiverse-profile-bindings-bind-btn",onClick:w,disabled:!b,type:"button",children:(0,Ee.jsx)(cr,{size:14,strokeWidth:2})})]})]}),(0,Ee.jsxs)("div",{className:"lumiverse-profile-bindings-toggles",children:[(0,Ee.jsxs)("div",{className:"lumiverse-profile-bindings-toggles-header",children:[(0,Ee.jsx)(fr,{size:14,strokeWidth:1.5}),(0,Ee.jsx)("span",{children:"Prompt Toggle Bindings"})]}),(0,Ee.jsx)("div",{className:"lumiverse-profile-bindings-toggles-info",children:"Save current prompt enabled/disabled states"}),(0,Ee.jsxs)("div",{className:"lumiverse-profile-bindings-toggles-rows",children:[(0,Ee.jsxs)("div",{className:On("lumiverse-profile-bindings-toggle-row",m&&"is-bound"),children:[(0,Ee.jsx)(lr,{size:14,strokeWidth:1.5}),(0,Ee.jsx)("span",{className:"lumiverse-profile-bindings-toggle-label",children:"Character"}),m?(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsx)("span",{className:"lumiverse-profile-bindings-toggle-badge",children:"Bound"}),(0,Ee.jsx)("button",{className:"lumiverse-profile-bindings-toggle-clear",onClick:E,title:"Clear toggle binding",type:"button",children:(0,Ee.jsx)(mt,{size:12,strokeWidth:2})})]}):(0,Ee.jsx)("button",{className:"lumiverse-profile-bindings-toggle-bind",onClick:S,disabled:!t.characterAvatar,title:"Bind current prompt toggles to character",type:"button",children:"Bind Toggles"})]}),(0,Ee.jsxs)("div",{className:On("lumiverse-profile-bindings-toggle-row",d&&"is-bound"),children:[(0,Ee.jsx)(ur,{size:14,strokeWidth:1.5}),(0,Ee.jsx)("span",{className:"lumiverse-profile-bindings-toggle-label",children:"Chat"}),d?(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsx)("span",{className:"lumiverse-profile-bindings-toggle-badge",children:"Bound"}),(0,Ee.jsx)("button",{className:"lumiverse-profile-bindings-toggle-clear",onClick:P,title:"Clear toggle binding",type:"button",children:(0,Ee.jsx)(mt,{size:12,strokeWidth:2})})]}):(0,Ee.jsx)("button",{className:"lumiverse-profile-bindings-toggle-bind",onClick:N,disabled:!t.chatId,title:"Bind current prompt toggles to chat",type:"button",children:"Bind Toggles"})]})]}),(0,Ee.jsx)("div",{className:"lumiverse-profile-bindings-toggles-priority",children:"Priority: Chat > Character"})]})]}):(0,Ee.jsxs)("div",{className:"lumiverse-profile-bindings-empty",children:[(0,Ee.jsx)(lr,{size:24,strokeWidth:1.5}),(0,Ee.jsx)("span",{children:"Select a character first"})]})]})}),document.body)}function px(e){let{onClick:n,currentBinding:t,currentCharacterBinding:r,currentChatBinding:i,hasChatToggleBinding:o,hasCharacterToggleBinding:a}=e;const s=!!t.presetName,l=s||(o||a);return(0,Ee.jsx)("button",{className:On("lumiverse-profile-bind-btn",l&&"lumiverse-profile-bind-btn--active"),onClick:n,title:(()=>{if(!l)return"Bind preset or toggles to character/chat";const e=[];return s&&e.push("Preset: ".concat(t.presetName," (").concat(t.bindingType,")")),o&&e.push("Toggle: Chat"),a&&e.push("Toggle: Character"),e.join(" | ")})(),type:"button",children:l?(0,Ee.jsx)(cr,{size:16,strokeWidth:2}):(0,Ee.jsx)(pr,{size:16,strokeWidth:1.5})})}const gx=function(e){var n,t;let{onTabChange:r}=e;const i=function(){const e=(0,Ce.useSyncExternalStore)(Xb.subscribe,Jb,()=>0);return(0,Ce.useMemo)(()=>{if("undefined"!=typeof SillyTavern)try{const e=SillyTavern.getContext();if(null!=e&&e.characters&&void 0!==(null==e?void 0:e.characterId)){const n=e.characters[e.characterId];return{name:(null==n?void 0:n.name)||"Unknown",avatar:null!=n&&n.avatar?"/characters/".concat(encodeURIComponent(n.avatar)):null,description:(null==n?void 0:n.description)||""}}}catch(e){console.warn("[LumiverseUI] Could not get character:",e)}return{name:"No Character",avatar:null,description:""}},[e])}(),o=gn(),{allPacks:a}=vn(),[s,l]=(0,Ce.useState)(!1),{currentBinding:c,currentCharacterBinding:u,currentChatBinding:d,hasChatToggleBinding:m,hasCharacterToggleBinding:p}=hr(),g=(0,Ce.useSyncExternalStore)(Xb.subscribe,ex,ex),h=(0,Ce.useSyncExternalStore)(Xb.subscribe,nx,nx),v=(0,Ce.useSyncExternalStore)(Xb.subscribe,tx,tx),f=(0,Ce.useSyncExternalStore)(Xb.subscribe,rx,rx),b=v&&f.length>0,x=g?h.length:o.definition?1:0,y=(0,Ce.useMemo)(()=>{var e,n;return{behaviors:(null===(e=o.behaviors)||void 0===e?void 0:e.length)||0,personalities:(null===(n=o.personalities)||void 0===n?void 0:n.length)||0,hasDefinition:!!o.definition,definitionCount:x,totalPacks:a.length}},[o,a,x]),k=(0,Ce.useCallback)(()=>{l(!0)},[]),w=(0,Ce.useCallback)(()=>{l(!1)},[]);return(0,Ee.jsxs)("div",{className:"lumiverse-character-profile",children:[(0,Ee.jsxs)("div",{className:"lumiverse-profile-header",children:[(0,Ee.jsx)("div",{className:"lumiverse-profile-avatar",children:i.avatar?(0,Ee.jsx)("img",{src:i.avatar,alt:i.name}):(0,Ee.jsx)("span",{className:"lumiverse-profile-avatar-placeholder",children:(0,Ee.jsx)(lr,{size:32,strokeWidth:1.5})})}),(0,Ee.jsxs)("div",{className:"lumiverse-profile-info",children:[(0,Ee.jsx)("h3",{className:"lumiverse-profile-name",children:i.name}),(0,Ee.jsxs)("div",{className:"lumiverse-profile-stats",children:[(0,Ee.jsxs)("span",{className:"lumiverse-stat",title:"Behaviors",children:[(0,Ee.jsx)(ut,{size:14,strokeWidth:1.5,className:"lumiverse-stat-icon"}),(0,Ee.jsx)("span",{className:"lumiverse-stat-value",children:y.behaviors})]}),(0,Ee.jsxs)("span",{className:"lumiverse-stat",title:"Personalities",children:[(0,Ee.jsx)(jp,{size:14,strokeWidth:1.5,className:"lumiverse-stat-icon"}),(0,Ee.jsx)("span",{className:"lumiverse-stat-value",children:y.personalities})]}),(0,Ee.jsxs)("span",{className:"lumiverse-stat",title:"Packs",children:[(0,Ee.jsx)(Nn,{size:14,strokeWidth:1.5,className:"lumiverse-stat-icon"}),(0,Ee.jsx)("span",{className:"lumiverse-stat-value",children:y.totalPacks})]})]})]}),(0,Ee.jsx)(px,{onClick:k,currentBinding:c,currentCharacterBinding:u,currentChatBinding:d,hasChatToggleBinding:m,hasCharacterToggleBinding:p})]}),s&&(0,Ee.jsx)(mx,{onClose:w}),b?(0,Ee.jsx)(ux,{councilMembers:f,allPacks:a,onManageCouncil:()=>{r&&r("council")}}):(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsxs)("div",{className:"lumiverse-profile-section",children:[(0,Ee.jsx)(lx,{Icon:g?Jt:zv,title:g?"Chimera Definitions":"Definition",count:y.definitionCount}),(0,Ee.jsx)("div",{className:"lumiverse-traits-list",children:(0,Ee.jsx)(Rr,{initial:!1,children:g?h.length>0?h.map((e,n)=>(0,Ee.jsx)(sx,{trait:e,type:"definition"},ox(e)||"def-".concat(n))):(0,Ee.jsx)(cx,{message:"No Chimera forms selected"}):o.definition?(0,Ee.jsx)(sx,{trait:o.definition,type:"definition"},ox(o.definition)||"def"):(0,Ee.jsx)(cx,{message:"No definition selected"})})})]}),(0,Ee.jsxs)("div",{className:"lumiverse-profile-section",children:[(0,Ee.jsx)(lx,{Icon:ut,title:"Behaviors",count:y.behaviors}),(0,Ee.jsx)("div",{className:"lumiverse-traits-list",children:(0,Ee.jsx)(Rr,{initial:!1,children:(null===(n=o.behaviors)||void 0===n?void 0:n.length)>0?o.behaviors.map(e=>(0,Ee.jsx)(sx,{trait:e,type:"behavior",isDominant:ax(o.dominantBehavior,e)},ox(e))):(0,Ee.jsx)(cx,{message:"No behaviors selected"})})})]}),(0,Ee.jsxs)("div",{className:"lumiverse-profile-section",children:[(0,Ee.jsx)(lx,{Icon:jp,title:"Personalities",count:y.personalities}),(0,Ee.jsx)("div",{className:"lumiverse-traits-list",children:(0,Ee.jsx)(Rr,{initial:!1,children:(null===(t=o.personalities)||void 0===t?void 0:t.length)>0?o.personalities.map(e=>(0,Ee.jsx)(sx,{trait:e,type:"personality",isDominant:ax(o.dominantPersonality,e)},ox(e))):(0,Ee.jsx)(cx,{message:"No personalities selected"})})})]})]}),(0,Ee.jsx)(dx,{})]})};function hx(e){let{Icon:n,title:t,status:r,children:i,defaultOpen:o=!1}=e;const[a,s]=(0,Ce.useState)(o);return(0,Ee.jsxs)("div",{className:On("lumiverse-vp-collapsible",a&&"lumiverse-vp-collapsible--open"),children:[(0,Ee.jsxs)("button",{className:"lumiverse-vp-collapsible-header",onClick:()=>s(!a),type:"button",children:[(0,Ee.jsx)("span",{className:On("lumiverse-vp-collapsible-chevron",a&&"lumiverse-vp-collapsible-chevron--open"),children:(0,Ee.jsx)(Tn,{size:14,strokeWidth:2})}),(0,Ee.jsx)("span",{className:"lumiverse-vp-collapsible-icon",children:(0,Ee.jsx)(n,{size:16,strokeWidth:1.5})}),(0,Ee.jsx)("span",{className:"lumiverse-vp-collapsible-title",children:t}),void 0!==r&&(0,Ee.jsx)("span",{className:On("lumiverse-vp-collapsible-status",r&&"lumiverse-vp-collapsible-status--active"),children:r?"Active":"Inactive"})]}),(0,Ee.jsx)(it,{isOpen:a,className:"lumiverse-vp-collapsible-content",duration:200,children:(0,Ee.jsx)("div",{className:"lumiverse-vp-collapsible-inner",children:i})})]})}const vx=Ye,fx={},bx=()=>vx.getState().presets||fx,xx=()=>vx.getState().activePresetName;function yx(e){if(!e)return"";const n=Date.now()-e,t=Math.floor(n/6e4);if(t<1)return"Just now";if(t<60)return"".concat(t,"m ago");const r=Math.floor(t/60);if(r<24)return"".concat(r,"h ago");const i=Math.floor(r/24);return i<7?"".concat(i,"d ago"):new Date(e).toLocaleDateString()}function kx(e){let{preset:n,isActive:t,onLoad:r,onUpdate:i,onDelete:o}=e;const[a,s]=(0,Ce.useState)(!1),l=(0,Ce.useMemo)(()=>{var e,t,r,i,o,a;if(n.councilMode&&(null===(e=n.councilMembers)||void 0===e?void 0:e.length)>0){return{isCouncil:!0,members:n.councilMembers.length,behaviors:n.councilMembers.reduce((e,n)=>{var t;return e+((null===(t=n.behaviors)||void 0===t?void 0:t.length)||0)},0),personalities:n.councilMembers.reduce((e,n)=>{var t;return e+((null===(t=n.personalities)||void 0===t?void 0:t.length)||0)},0)}}return n.chimeraMode&&(null===(t=n.selectedDefinitions)||void 0===t?void 0:t.length)>0?{isChimera:!0,definitions:n.selectedDefinitions.length,behaviors:(null===(r=n.selectedBehaviors)||void 0===r?void 0:r.length)||0,personalities:(null===(i=n.selectedPersonalities)||void 0===i?void 0:i.length)||0}:{definitions:n.selectedDefinition?1:0,behaviors:(null===(o=n.selectedBehaviors)||void 0===o?void 0:o.length)||0,personalities:(null===(a=n.selectedPersonalities)||void 0===a?void 0:a.length)||0}},[n]);return(0,Ee.jsxs)("div",{className:On("lumiverse-preset-card",t&&"lumiverse-preset-card--active"),children:[(0,Ee.jsxs)("div",{className:"lumiverse-preset-card-header",children:[(0,Ee.jsx)("span",{className:"lumiverse-preset-card-icon",children:(0,Ee.jsx)(Ld,{size:16,strokeWidth:1.5})}),(0,Ee.jsx)("span",{className:"lumiverse-preset-card-name",children:n.name}),t&&(0,Ee.jsxs)("span",{className:"lumiverse-preset-card-active-badge",children:[(0,Ee.jsx)(zd,{size:12,strokeWidth:2})," Active"]})]}),(0,Ee.jsxs)("div",{className:"lumiverse-preset-card-meta",children:[(0,Ee.jsx)("div",{className:"lumiverse-preset-stats",children:l.isCouncil?(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsxs)("span",{className:"lumiverse-preset-stat lumiverse-preset-stat--council",children:[(0,Ee.jsx)(Ad,{size:12,strokeWidth:1.5})," ",l.members]}),(0,Ee.jsxs)("span",{className:"lumiverse-preset-stat",children:[(0,Ee.jsx)(ut,{size:12,strokeWidth:1.5})," ",l.behaviors]}),(0,Ee.jsxs)("span",{className:"lumiverse-preset-stat",children:[(0,Ee.jsx)(jp,{size:12,strokeWidth:1.5})," ",l.personalities]})]}):(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsxs)("span",{className:On("lumiverse-preset-stat",l.isChimera&&"lumiverse-preset-stat--chimera"),children:[(0,Ee.jsx)(zv,{size:12,strokeWidth:1.5})," ",l.definitions]}),(0,Ee.jsxs)("span",{className:"lumiverse-preset-stat",children:[(0,Ee.jsx)(ut,{size:12,strokeWidth:1.5})," ",l.behaviors]}),(0,Ee.jsxs)("span",{className:"lumiverse-preset-stat",children:[(0,Ee.jsx)(jp,{size:12,strokeWidth:1.5})," ",l.personalities]})]})}),n.chimeraMode&&(0,Ee.jsx)("span",{className:"lumiverse-preset-card-mode",children:"Chimera"}),n.councilMode&&(0,Ee.jsx)("span",{className:"lumiverse-preset-card-mode",children:"Council"}),(0,Ee.jsxs)("span",{className:"lumiverse-preset-card-time",children:[(0,Ee.jsx)(vt,{size:12,strokeWidth:1.5}),yx(n.updatedAt||n.createdAt)]})]}),(0,Ee.jsxs)("div",{className:"lumiverse-preset-card-actions",children:[(0,Ee.jsx)("button",{className:"lumiverse-preset-btn lumiverse-preset-btn--primary",onClick:()=>r(n.name),title:"Load this preset",type:"button",children:"Load"}),(0,Ee.jsx)("button",{className:"lumiverse-preset-btn",onClick:()=>i(n.name),title:"Update preset with current selections",type:"button",children:(0,Ee.jsx)(pt,{size:14,strokeWidth:1.5})}),(0,Ee.jsx)("button",{className:On("lumiverse-preset-btn lumiverse-preset-btn--danger",a&&"lumiverse-preset-btn--confirming"),onClick:()=>{a?(o(n.name),s(!1)):(s(!0),setTimeout(()=>s(!1),3e3))},title:a?"Click again to confirm":"Delete preset",type:"button",children:a?(0,Ee.jsx)(mt,{size:14,strokeWidth:2}):(0,Ee.jsx)(Pn,{size:14,strokeWidth:1.5})})]})]})}function wx(){return(0,Ee.jsxs)("div",{className:"lumiverse-preset-empty",children:[(0,Ee.jsx)("span",{className:"lumiverse-preset-empty-icon",children:(0,Ee.jsx)(Ld,{size:32,strokeWidth:1.5})}),(0,Ee.jsx)("h4",{children:"No Presets Saved"}),(0,Ee.jsx)("p",{children:"Save your current Lumia configuration as a preset to quickly switch between setups."})]})}function jx(e){let{presetList:n,activePresetName:t,onLoad:r,onUpdate:i,onDelete:o}=e;const[a,s]=(0,Ce.useState)(""),[l,c]=(0,Ce.useState)(!1),u=Xe(),d=(0,Ce.useSyncExternalStore)(vx.subscribe,bx,bx),m=(0,Ce.useCallback)(()=>{const e=a.trim();e&&(d[e]||(u.savePreset(e),qe(),s(""),c(!1)))},[a,d,u]);return(0,Ee.jsxs)("div",{className:"lumiverse-presets-section-content",children:[(0,Ee.jsx)("div",{className:"lumiverse-preset-create-area",style:{marginBottom:"12px"},children:l?(0,Ee.jsxs)("div",{className:"lumiverse-preset-create-form",children:[(0,Ee.jsx)("input",{type:"text",className:"lumiverse-preset-input",placeholder:"Preset name...",value:a,onChange:e=>s(e.target.value),onKeyDown:e=>{"Enter"===e.key?m():"Escape"===e.key&&(c(!1),s(""))},autoFocus:!0}),(0,Ee.jsx)("button",{className:"lumiverse-preset-btn lumiverse-preset-btn--primary",onClick:m,disabled:!a.trim(),type:"button",children:(0,Ee.jsx)(zd,{size:14,strokeWidth:2})}),(0,Ee.jsx)("button",{className:"lumiverse-preset-btn",onClick:()=>{c(!1),s("")},type:"button",children:(0,Ee.jsx)(mt,{size:14,strokeWidth:2})})]}):(0,Ee.jsxs)("button",{className:"lumiverse-preset-create-btn",onClick:()=>c(!0),title:"Save current configuration as preset",type:"button",children:[(0,Ee.jsx)(dr,{size:16,strokeWidth:2}),(0,Ee.jsx)("span",{children:"New Preset"})]})}),(0,Ee.jsx)("div",{className:"lumiverse-preset-list",children:0===n.length?(0,Ee.jsx)(wx,{}):n.map(e=>(0,Ee.jsx)(kx,{preset:e,isActive:t===e.name,onLoad:r,onUpdate:i,onDelete:o},e.name))})]})}const Cx=function(){const e=Xe(),n=(0,Ce.useSyncExternalStore)(vx.subscribe,bx,bx),t=(0,Ce.useSyncExternalStore)(vx.subscribe,xx,xx),{reasoningSettings:r,startReplyWith:i,apiReasoning:o,postProcessing:a,handleApplyReasoningPreset:s,handleStartReplyWithChange:l,handleReasoningToggle:c,handleAPIReasoningToggle:u,handleReasoningEffortChange:d,handlePostProcessingChange:m,REASONING_EFFORT_LEVELS:p,POST_PROCESSING_OPTIONS:g}=Kt(),{openPresetEditor:h}=_v(),v=(0,Ce.useMemo)(()=>Object.values(n).sort((e,n)=>{const t=e.updatedAt||e.createdAt||0;return(n.updatedAt||n.createdAt||0)-t}),[n]),f=(0,Ce.useCallback)(n=>{e.loadPreset(n),qe()},[e]),b=(0,Ce.useCallback)(n=>{e.updatePreset(n),qe()},[e]),x=(0,Ce.useCallback)(n=>{e.deletePreset(n),qe()},[e]),y=(v.length,(null==r?void 0:r.auto_parse)||o.enabled);return(0,Ee.jsxs)("div",{className:"lumiverse-preset-manager",children:[(0,Ee.jsx)(hx,{Icon:Ld,title:"Lumia Presets",status:void 0,defaultOpen:!0,children:(0,Ee.jsx)(jx,{presetList:v,activePresetName:t,onLoad:f,onUpdate:b,onDelete:x})}),(0,Ee.jsxs)(hx,{Icon:ct,title:"Reasoning / CoT",status:y,defaultOpen:!1,children:[(0,Ee.jsx)("p",{className:"lumiverse-vp-settings-desc",children:"Configure reasoning/chain-of-thought settings. Changes sync with the Chat Presets modal."}),(0,Ee.jsx)(er,{reasoningSettings:r,startReplyWith:i,apiReasoning:o,postProcessing:a,onApplyReasoningPreset:s,onStartReplyWithChange:l,onReasoningToggle:c,onAPIReasoningToggle:u,onReasoningEffortChange:d,onPostProcessingChange:m,effortLevels:p,postProcessingOptions:g,compact:!0})]}),(0,Ee.jsxs)(hx,{Icon:cr,title:"Toggle Bindings",defaultOpen:!1,children:[(0,Ee.jsx)("p",{className:"lumiverse-vp-settings-desc",children:"Save which prompts are enabled/disabled and restore them when switching chats or characters."}),(0,Ee.jsx)(xr,{compact:!0})]}),(0,Ee.jsxs)("div",{className:"lumiverse-preset-editor-trigger",children:[(0,Ee.jsxs)("button",{className:"lumia-btn lumia-btn-secondary lumia-btn-full",onClick:h,type:"button",children:[(0,Ee.jsx)(tf,{size:14,strokeWidth:2}),"Open Chat Preset Editor"]}),(0,Ee.jsx)("p",{className:"lumiverse-preset-editor-hint",children:"Edit the full SillyTavern chat preset with all available options."})]})]})};function Sx(e,n,t){let r,i=t.initialDeps??[],o=!0;function a(){var a,s,l;let c;t.key&&(null==(a=t.debug)?void 0:a.call(t))&&(c=Date.now());const u=e();if(!(u.length!==i.length||u.some((e,n)=>i[n]!==e)))return r;let d;if(i=u,t.key&&(null==(s=t.debug)?void 0:s.call(t))&&(d=Date.now()),r=n(...u),t.key&&(null==(l=t.debug)?void 0:l.call(t))){const e=Math.round(100*(Date.now()-c))/100,n=Math.round(100*(Date.now()-d))/100,r=n/16,i=(e,n)=>{for(e=String(e);e.length<n;)e=" "+e;return e};console.info(`%c⏱ ${i(n,5)} /${i(e,5)} ms`,`\n            font-size: .6rem;\n            font-weight: bold;\n            color: hsl(${Math.max(0,Math.min(120-120*r,120))}deg 100% 31%);`,null==t?void 0:t.key)}return!(null==t?void 0:t.onChange)||o&&t.skipInitialOnChange||t.onChange(r),o=!1,r}return a.updateDeps=e=>{i=e},a}function Nx(e,n){if(void 0===e)throw new Error("Unexpected undefined"+(n?`: ${n}`:""));return e}const Ex=(e,n,t)=>{let r;return function(...i){e.clearTimeout(r),r=e.setTimeout(()=>n.apply(this,i),t)}},Px=e=>{const{offsetWidth:n,offsetHeight:t}=e;return{width:n,height:t}},Dx=e=>e,Mx=e=>{const n=Math.max(e.startIndex-e.overscan,0),t=Math.min(e.endIndex+e.overscan,e.count-1),r=[];for(let e=n;e<=t;e++)r.push(e);return r},Ox=(e,n)=>{const t=e.scrollElement;if(!t)return;const r=e.targetWindow;if(!r)return;const i=e=>{const{width:t,height:r}=e;n({width:Math.round(t),height:Math.round(r)})};if(i(Px(t)),!r.ResizeObserver)return()=>{};const o=new r.ResizeObserver(n=>{const r=()=>{const e=n[0];if(null==e?void 0:e.borderBoxSize){const n=e.borderBoxSize[0];if(n)return void i({width:n.inlineSize,height:n.blockSize})}i(Px(t))};e.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(r):r()});return o.observe(t,{box:"border-box"}),()=>{o.unobserve(t)}},Tx={passive:!0},Ax="undefined"==typeof window||"onscrollend"in window,Lx=(e,n)=>{const t=e.scrollElement;if(!t)return;const r=e.targetWindow;if(!r)return;let i=0;const o=e.options.useScrollendEvent&&Ax?()=>{}:Ex(r,()=>{n(i,!1)},e.options.isScrollingResetDelay),a=r=>()=>{const{horizontal:a,isRtl:s}=e.options;i=a?t.scrollLeft*(s?-1:1):t.scrollTop,o(),n(i,r)},s=a(!0),l=a(!1);l(),t.addEventListener("scroll",s,Tx);const c=e.options.useScrollendEvent&&Ax;return c&&t.addEventListener("scrollend",l,Tx),()=>{t.removeEventListener("scroll",s),c&&t.removeEventListener("scrollend",l)}},zx=(e,n,t)=>{if(null==n?void 0:n.borderBoxSize){const e=n.borderBoxSize[0];if(e){return Math.round(e[t.options.horizontal?"inlineSize":"blockSize"])}}return e[t.options.horizontal?"offsetWidth":"offsetHeight"]},Ix=(e,{adjustments:n=0,behavior:t},r)=>{var i,o;const a=e+n;null==(o=null==(i=r.scrollElement)?void 0:i.scrollTo)||o.call(i,{[r.options.horizontal?"left":"top"]:a,behavior:t})};class Rx{constructor(e){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.measurementsCache=[],this.itemSizeCache=new Map,this.laneAssignments=new Map,this.pendingMeasuredCacheIndexes=[],this.prevLanes=void 0,this.lanesChangedFlag=!1,this.lanesSettling=!1,this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let e=null;const n=()=>e||(this.targetWindow&&this.targetWindow.ResizeObserver?e=new this.targetWindow.ResizeObserver(e=>{e.forEach(e=>{const n=()=>{this._measureElement(e.target,e)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(n):n()})}):null);return{disconnect:()=>{var t;null==(t=n())||t.disconnect(),e=null},observe:e=>{var t;return null==(t=n())?void 0:t.observe(e,{box:"border-box"})},unobserve:e=>{var t;return null==(t=n())?void 0:t.unobserve(e)}}})(),this.range=null,this.setOptions=e=>{Object.entries(e).forEach(([n,t])=>{void 0===t&&delete e[n]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:Dx,rangeExtractor:Mx,onChange:()=>{},measureElement:zx,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...e}},this.notify=e=>{var n,t;null==(t=(n=this.options).onChange)||t.call(n,this,e)},this.maybeNotify=Sx(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),e=>{this.notify(e)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(e=>e()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var e;const n=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==n){if(this.cleanup(),!n)return void this.maybeNotify();this.scrollElement=n,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=(null==(e=this.scrollElement)?void 0:e.window)??null,this.elementsCache.forEach(e=>{this.observer.observe(e)}),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,e=>{this.scrollRect=e,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(e,n)=>{this.scrollAdjustments=0,this.scrollDirection=n?this.getScrollOffset()<e?"forward":"backward":null,this.scrollOffset=e,this.isScrolling=n,this.maybeNotify()}))}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??("function"==typeof this.options.initialOffset?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(e,n)=>{const t=new Map,r=new Map;for(let i=n-1;i>=0;i--){const n=e[i];if(t.has(n.lane))continue;const o=r.get(n.lane);if(null==o||n.end>o.end?r.set(n.lane,n):n.end<o.end&&t.set(n.lane,!0),t.size===this.options.lanes)break}return r.size===this.options.lanes?Array.from(r.values()).sort((e,n)=>e.end===n.end?e.index-n.index:e.end-n.end)[0]:void 0},this.getMeasurementOptions=Sx(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled,this.options.lanes],(e,n,t,r,i,o)=>(void 0!==this.prevLanes&&this.prevLanes!==o&&(this.lanesChangedFlag=!0),this.prevLanes=o,this.pendingMeasuredCacheIndexes=[],{count:e,paddingStart:n,scrollMargin:t,getItemKey:r,enabled:i,lanes:o}),{key:!1,skipInitialOnChange:!0,onChange:()=>{this.notify(this.isScrolling)}}),this.getMeasurements=Sx(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:e,paddingStart:n,scrollMargin:t,getItemKey:r,enabled:i,lanes:o},a)=>{if(!i)return this.measurementsCache=[],this.itemSizeCache.clear(),this.laneAssignments.clear(),[];if(this.laneAssignments.size>e)for(const n of this.laneAssignments.keys())n>=e&&this.laneAssignments.delete(n);this.lanesChangedFlag&&(this.lanesChangedFlag=!1,this.lanesSettling=!0,this.measurementsCache=[],this.itemSizeCache.clear(),this.laneAssignments.clear(),this.pendingMeasuredCacheIndexes=[]),0===this.measurementsCache.length&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(e=>{this.itemSizeCache.set(e.key,e.size)}));const s=this.lanesSettling?0:this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[],this.lanesSettling&&this.measurementsCache.length===e&&(this.lanesSettling=!1);const l=this.measurementsCache.slice(0,s),c=new Array(o).fill(void 0);for(let e=0;e<s;e++){const n=l[e];n&&(c[n.lane]=e)}for(let i=s;i<e;i++){const e=r(i),o=this.laneAssignments.get(i);let s,u;if(void 0!==o&&this.options.lanes>1){s=o;const e=c[s],r=void 0!==e?l[e]:void 0;u=r?r.end+this.options.gap:n+t}else{const e=1===this.options.lanes?l[i-1]:this.getFurthestMeasurement(l,i);u=e?e.end+this.options.gap:n+t,s=e?e.lane:i%this.options.lanes,this.options.lanes>1&&this.laneAssignments.set(i,s)}const d=a.get(e),m="number"==typeof d?d:this.options.estimateSize(i),p=u+m;l[i]={index:i,start:u,size:m,end:p,key:e,lane:s},c[s]=i}return this.measurementsCache=l,l},{key:!1,debug:()=>this.options.debug}),this.calculateRange=Sx(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(e,n,t,r)=>this.range=e.length>0&&n>0?function({measurements:e,outerSize:n,scrollOffset:t,lanes:r}){const i=e.length-1,o=n=>e[n].start;if(e.length<=r)return{startIndex:0,endIndex:i};let a=Bx(0,i,o,t),s=a;if(1===r)for(;s<i&&e[s].end<t+n;)s++;else if(r>1){const o=Array(r).fill(0);for(;s<i&&o.some(e=>e<t+n);){const n=e[s];o[n.lane]=n.end,s++}const l=Array(r).fill(t+n);for(;a>=0&&l.some(e=>e>=t);){const n=e[a];l[n.lane]=n.start,a--}a=Math.max(0,a-a%r),s=Math.min(i,s+(r-1-s%r))}return{startIndex:a,endIndex:s}}({measurements:e,outerSize:n,scrollOffset:t,lanes:r}):null,{key:!1,debug:()=>this.options.debug}),this.getVirtualIndexes=Sx(()=>{let e=null,n=null;const t=this.calculateRange();return t&&(e=t.startIndex,n=t.endIndex),this.maybeNotify.updateDeps([this.isScrolling,e,n]),[this.options.rangeExtractor,this.options.overscan,this.options.count,e,n]},(e,n,t,r,i)=>null===r||null===i?[]:e({startIndex:r,endIndex:i,overscan:n,count:t}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=e=>{const n=this.options.indexAttribute,t=e.getAttribute(n);return t?parseInt(t,10):(console.warn(`Missing attribute name '${n}={index}' on measured element.`),-1)},this._measureElement=(e,n)=>{const t=this.indexFromElement(e),r=this.measurementsCache[t];if(!r)return;const i=r.key,o=this.elementsCache.get(i);o!==e&&(o&&this.observer.unobserve(o),this.observer.observe(e),this.elementsCache.set(i,e)),e.isConnected&&this.resizeItem(t,this.options.measureElement(e,n,this))},this.resizeItem=(e,n)=>{const t=this.measurementsCache[e];if(!t)return;const r=n-(this.itemSizeCache.get(t.key)??t.size);0!==r&&((void 0!==this.shouldAdjustScrollPositionOnItemSizeChange?this.shouldAdjustScrollPositionOnItemSizeChange(t,r,this):t.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=r,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(t.index),this.itemSizeCache=new Map(this.itemSizeCache.set(t.key,n)),this.notify(!1))},this.measureElement=e=>{e?this._measureElement(e,void 0):this.elementsCache.forEach((e,n)=>{e.isConnected||(this.observer.unobserve(e),this.elementsCache.delete(n))})},this.getVirtualItems=Sx(()=>[this.getVirtualIndexes(),this.getMeasurements()],(e,n)=>{const t=[];for(let r=0,i=e.length;r<i;r++){const i=n[e[r]];t.push(i)}return t},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=e=>{const n=this.getMeasurements();if(0!==n.length)return Nx(n[Bx(0,n.length-1,e=>Nx(n[e]).start,e)])},this.getOffsetForAlignment=(e,n,t=0)=>{const r=this.getSize(),i=this.getScrollOffset();"auto"===n&&(n=e>=i+r?"end":"start"),"center"===n?e+=(t-r)/2:"end"===n&&(e-=r);const o=this.getTotalSize()+this.options.scrollMargin-r;return Math.max(Math.min(o,e),0)},this.getOffsetForIndex=(e,n="auto")=>{e=Math.max(0,Math.min(e,this.options.count-1));const t=this.measurementsCache[e];if(!t)return;const r=this.getSize(),i=this.getScrollOffset();if("auto"===n)if(t.end>=i+r-this.options.scrollPaddingEnd)n="end";else{if(!(t.start<=i+this.options.scrollPaddingStart))return[i,n];n="start"}const o="end"===n?t.end+this.options.scrollPaddingEnd:t.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(o,n,t.size),n]},this.isDynamicMode=()=>this.elementsCache.size>0,this.scrollToOffset=(e,{align:n="start",behavior:t}={})=>{"smooth"===t&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(e,n),{adjustments:void 0,behavior:t})},this.scrollToIndex=(e,{align:n="auto",behavior:t}={})=>{"smooth"===t&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),e=Math.max(0,Math.min(e,this.options.count-1));let r=0;const i=n=>{if(!this.targetWindow)return;const r=this.getOffsetForIndex(e,n);if(!r)return void console.warn("Failed to get offset for index:",e);const[i,a]=r;this._scrollToOffset(i,{adjustments:void 0,behavior:t}),this.targetWindow.requestAnimationFrame(()=>{const n=this.getScrollOffset(),t=this.getOffsetForIndex(e,a);var r,i;t?(r=t[0],i=n,Math.abs(r-i)<1.01||o(a)):console.warn("Failed to get offset for index:",e)})},o=n=>{this.targetWindow&&(r++,r<10?this.targetWindow.requestAnimationFrame(()=>i(n)):console.warn(`Failed to scroll to index ${e} after 10 attempts.`))};i(n)},this.scrollBy=(e,{behavior:n}={})=>{"smooth"===n&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+e,{adjustments:void 0,behavior:n})},this.getTotalSize=()=>{var e;const n=this.getMeasurements();let t;if(0===n.length)t=this.options.paddingStart;else if(1===this.options.lanes)t=(null==(e=n[n.length-1])?void 0:e.end)??0;else{const e=Array(this.options.lanes).fill(null);let r=n.length-1;for(;r>=0&&e.some(e=>null===e);){const t=n[r];null===e[t.lane]&&(e[t.lane]=t.end),r--}t=Math.max(...e.filter(e=>null!==e))}return Math.max(t-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(e,{adjustments:n,behavior:t})=>{this.options.scrollToFn(e,{behavior:t,adjustments:n},this)},this.measure=()=>{this.itemSizeCache=new Map,this.laneAssignments=new Map,this.notify(!1)},this.setOptions(e)}}const Bx=(e,n,t,r)=>{for(;e<=n;){const i=(e+n)/2|0,o=t(i);if(o<r)e=i+1;else{if(!(o>r))return i;n=i-1}}return e>0?e-1:0};const _x="undefined"!=typeof document?Ce.useLayoutEffect:Ce.useEffect;function Fx(e){const n=Ce.useReducer(()=>({}),{})[1],t={...e,onChange:(t,r)=>{var i;r?(0,ot.flushSync)(n):n(),null==(i=e.onChange)||i.call(e,t,r)}},[r]=Ce.useState(()=>new Rx(t));return r.setOptions(t),_x(()=>r._didMount(),[]),_x(()=>r._willUpdate()),r}function Ux(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function Hx(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Ux(Object(t),!0).forEach(function(n){Wx(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Ux(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Wx(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function Vx(e,n){if(!e)return null;const t={name:["lumiaName","lumiaDefName"],def:["lumiaDefinition","lumiaDef"],personality:["lumiaPersonality","lumia_personality"],behavior:["lumiaBehavior","lumia_behavior"],img:["avatarUrl","lumia_img"],author:["authorName","defAuthor"]}[n];if(!t)return null;for(const n of t)if(void 0!==e[n]&&null!==e[n])return e[n];return null}function qx(e){let{value:n,onChange:t,placeholder:r}=e;return(0,Ee.jsxs)("div",{className:"lumiverse-pack-search",children:[(0,Ee.jsx)("span",{className:"lumiverse-pack-search-icon",children:(0,Ee.jsx)(Am,{size:16,strokeWidth:1.5})}),(0,Ee.jsx)("input",{type:"text",className:"lumiverse-pack-search-input",placeholder:r,value:n,onChange:e=>t(e.target.value)}),n&&(0,Ee.jsx)("button",{className:"lumiverse-pack-search-clear",onClick:()=>t(""),type:"button",children:(0,Ee.jsx)(mt,{size:14,strokeWidth:2})})]})}function $x(e){let{activeFilter:n,onFilterChange:t,showSelectedOnly:r,onToggleSelectedOnly:i,selectedCount:o}=e;const a=[{id:"all",label:"All",Icon:Nn},{id:"definition",label:"Definitions",Icon:zv},{id:"behavior",label:"Behaviors",Icon:ut},{id:"personality",label:"Personalities",Icon:jp}];return(0,Ee.jsxs)("div",{className:"lumiverse-pack-filters-container",children:[(0,Ee.jsx)("div",{className:"lumiverse-pack-filters",children:a.map(e=>{const{Icon:r}=e;return(0,Ee.jsx)("button",{className:On("lumiverse-pack-filter",n===e.id&&"lumiverse-pack-filter--active"),onClick:()=>t(e.id),title:e.label,type:"button",children:(0,Ee.jsx)(r,{size:16,strokeWidth:1.5})},e.id)})}),(0,Ee.jsxs)("button",{className:On("lumiverse-pack-filter-selected-toggle",r&&"lumiverse-pack-filter-selected-toggle--active"),onClick:i,title:r?"Show all items":"Show selected only",type:"button",children:[(0,Ee.jsx)(pf,{size:14,strokeWidth:1.5}),o>0&&(0,Ee.jsx)("span",{className:"lumiverse-pack-filter-selected-count",children:o})]})]})}function Yx(e){let{pack:n,isExpanded:t,onToggle:r,onViewPack:i,itemCount:o}=e;const a=n.name||n.packName||"Unknown Pack";return(0,Ee.jsxs)("button",{className:On("lumiverse-browser-pack-header",t&&"lumiverse-browser-pack-header--expanded"),onClick:r,type:"button",children:[n.packCover?(0,Ee.jsx)("img",{src:n.packCover,alt:a,className:"lumiverse-browser-pack-cover"}):(0,Ee.jsx)("div",{className:"lumiverse-browser-pack-cover-placeholder",children:n.isCustom?(0,Ee.jsx)(Qt,{size:20,strokeWidth:1.5}):(0,Ee.jsx)(Nn,{size:20,strokeWidth:1.5})}),(0,Ee.jsxs)("div",{className:"lumiverse-browser-pack-info",children:[(0,Ee.jsx)("span",{className:"lumiverse-browser-pack-name",children:a}),(0,Ee.jsxs)("span",{className:"lumiverse-browser-pack-meta",children:[o," items",n.isCustom&&(0,Ee.jsx)("span",{className:"lumiverse-browser-pack-custom-badge",children:"Custom"})]})]}),(0,Ee.jsx)("span",{className:"lumiverse-browser-pack-view-btn",onClick:e=>{e.stopPropagation(),null==i||i(a)},title:"View pack contents",role:"button",tabIndex:0,children:(0,Ee.jsx)(Id,{size:16,strokeWidth:1.5})}),(0,Ee.jsx)("span",{className:On("lumiverse-browser-pack-chevron",t&&"lumiverse-browser-pack-chevron--rotated"),children:(0,Ee.jsx)(Tn,{size:16,strokeWidth:2})})]})}function Gx(e){let{item:n,type:t,onSelect:r,isSelected:i}=e;const o={definition:{Icon:zv,color:"rgba(100, 200, 255, 0.15)",border:"rgba(100, 200, 255, 0.3)",selectedBorder:"rgba(100, 200, 255, 0.7)"},behavior:{Icon:ut,color:"rgba(255, 180, 100, 0.15)",border:"rgba(255, 180, 100, 0.3)",selectedBorder:"rgba(255, 180, 100, 0.7)"},personality:{Icon:jp,color:"rgba(200, 100, 255, 0.15)",border:"rgba(200, 100, 255, 0.3)",selectedBorder:"rgba(200, 100, 255, 0.7)"}},a=Vx(n,"img"),s=Vx(n,"name")||"Unknown",{objectPosition:l}=xn(a),c=o[t]||o.definition,{Icon:u}=c,d=(()=>{if("definition"===t){const e=Vx(n,"def");return e?e.slice(0,100):""}if("behavior"===t){const e=Vx(n,"behavior");return e?e.slice(0,100):""}if("personality"===t){const e=Vx(n,"personality");return e?e.slice(0,100):""}return""})();return(0,Ee.jsxs)(Od.div,{className:On("lumiverse-browser-item",i&&"lumiverse-browser-item--selected"),style:{background:i?c.color.replace("0.15","0.25"):c.color,borderColor:i?c.selectedBorder:c.border},onClick:()=>null==r?void 0:r(n,t),initial:{opacity:0,y:10},animate:{opacity:1,y:0},whileHover:{scale:1.02},whileTap:{scale:.98},children:[a&&(0,Ee.jsx)("img",{src:a,alt:s,className:"lumiverse-browser-item-image",style:{objectPosition:l}}),(0,Ee.jsxs)("div",{className:"lumiverse-browser-item-content",children:[(0,Ee.jsxs)("div",{className:"lumiverse-browser-item-header",children:[(0,Ee.jsx)("span",{className:"lumiverse-browser-item-icon",children:(0,Ee.jsx)(u,{size:14,strokeWidth:1.5})}),(0,Ee.jsx)("span",{className:"lumiverse-browser-item-name",children:s}),i&&(0,Ee.jsx)("span",{className:"lumiverse-browser-item-check",children:(0,Ee.jsx)(zd,{size:14,strokeWidth:2.5})})]}),d&&(0,Ee.jsx)("p",{className:"lumiverse-browser-item-desc",children:d})]})]})}function Kx(e,n,t){const r=Vx(e,"name"),i=e.packName;if("definition"===n){const e=t.definition;return(null==e?void 0:e.itemName)===r&&(null==e?void 0:e.packName)===i}var o,a,s,l;return"behavior"===n?null!==(o=null===(a=t.behaviors)||void 0===a?void 0:a.some(e=>e.itemName===r&&e.packName===i))&&void 0!==o&&o:"personality"===n&&(null!==(s=null===(l=t.personalities)||void 0===l?void 0:l.some(e=>e.itemName===r&&e.packName===i))&&void 0!==s&&s)}function Qx(e){let{items:n,filter:t,onSelectItem:r,selections:i}=e;const o=(0,Ce.useRef)(null),a=(0,Ce.useMemo)(()=>"all"===t?n:n.filter(e=>e.type===t),[n,t]),s=function(e){return Fx({observeElementRect:Ox,observeElementOffset:Lx,scrollToFn:Ix,...e})}({count:a.length,getScrollElement:()=>o.current,estimateSize:()=>80,overscan:5});return 0===a.length?(0,Ee.jsx)("div",{className:"lumiverse-browser-empty-items",children:"No items match the current filter"}):(0,Ee.jsx)("div",{ref:o,className:"lumiverse-browser-items-container",style:{maxHeight:"300px",overflow:"auto"},children:(0,Ee.jsx)("div",{style:{height:"".concat(s.getTotalSize(),"px"),width:"100%",position:"relative"},children:s.getVirtualItems().map(e=>{const n=a[e.index];return(0,Ee.jsx)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"".concat(e.size,"px"),transform:"translateY(".concat(e.start,"px)"),padding:"4px 0"},children:(0,Ee.jsx)(Gx,{item:n,type:n.type,onSelect:r,isSelected:Kx(n,n.type,i)})},e.key)})})})}function Xx(e){let{pack:n,filter:t,searchQuery:r,showSelectedOnly:i,onSelectItem:o,onViewPack:a,selections:s}=e;const[l,c]=(0,Ce.useState)(!1),u=n.name||n.packName||"Unknown Pack",d=(0,Ce.useMemo)(()=>{const e=[];return(n.lumiaItems&&n.lumiaItems.length>0?n.lumiaItems:(n.items||[]).filter(e=>!e.loomCategory&&(e.lumiaDefName||e.lumiaName))).forEach((n,t)=>{const r=(e=>e.lumiaName||e.lumiaDefName)(n);if(!r)return;const i=!!(e=>e.lumiaDefinition||e.lumiaDef)(n),o=!!(e=>e.lumiaBehavior||e.lumia_behavior)(n),a=!!(e=>e.lumiaPersonality||e.lumia_personality)(n);i&&e.push(Hx(Hx({},n),{},{lumiaDefName:r,type:"definition",packName:u,id:"def-".concat(u,"-").concat(r,"-").concat(t)})),o&&e.push(Hx(Hx({},n),{},{lumiaDefName:r,type:"behavior",packName:u,id:"beh-".concat(u,"-").concat(r,"-").concat(t)})),a&&e.push(Hx(Hx({},n),{},{lumiaDefName:r,type:"personality",packName:u,id:"per-".concat(u,"-").concat(r,"-").concat(t)}))}),e},[n,u]),m=(0,Ce.useMemo)(()=>{let e=d;if("all"!==t&&(e=e.filter(e=>e.type===t)),r){const n=r.toLowerCase();e=e.filter(e=>{const t=(Vx(e,"name")||"").toLowerCase(),r=(Vx(e,"def")||"").toLowerCase(),i=(Vx(e,"behavior")||"").toLowerCase(),o=(Vx(e,"personality")||"").toLowerCase();return t.includes(n)||r.includes(n)||i.includes(n)||o.includes(n)})}return i&&(e=e.filter(e=>Kx(e,e.type,s))),e},[d,t,r,i,s]);return 0===m.length?null:(0,Ee.jsxs)("div",{className:"lumiverse-browser-pack",children:[(0,Ee.jsx)(Yx,{pack:n,isExpanded:l,onToggle:()=>c(!l),onViewPack:a,itemCount:m.length}),(0,Ee.jsx)(it,{isOpen:l,className:"lumiverse-browser-pack-items",duration:200,children:(0,Ee.jsx)(Qx,{items:m,filter:t,onSelectItem:o,selections:s})})]})}function Zx(e){let{packs:n,customPacks:t}=e;const r=(0,Ce.useMemo)(()=>{let e=0,r=0,i=0;return[...n,...t].forEach(n=>{(n.lumiaItems&&n.lumiaItems.length>0?n.lumiaItems:(n.items||[]).filter(e=>!e.loomCategory)).forEach(n=>{(n.lumiaName||n.lumiaDefName)&&((n.lumiaDefinition||n.lumiaDef)&&e++,(n.lumiaBehavior||n.lumia_behavior)&&r++,(n.lumiaPersonality||n.lumia_personality)&&i++)})}),{definitions:e,behaviors:r,personalities:i,total:n.length+t.length}},[n,t]);return(0,Ee.jsxs)("div",{className:"lumiverse-browser-stats",children:[(0,Ee.jsxs)("div",{className:"lumiverse-browser-stat",children:[(0,Ee.jsx)("span",{className:"lumiverse-browser-stat-value",children:r.total}),(0,Ee.jsx)("span",{className:"lumiverse-browser-stat-label",children:"PACKS"})]}),(0,Ee.jsxs)("div",{className:"lumiverse-browser-stat",children:[(0,Ee.jsx)("span",{className:"lumiverse-browser-stat-value",children:r.definitions}),(0,Ee.jsx)("span",{className:"lumiverse-browser-stat-label",children:"DEFS"})]}),(0,Ee.jsxs)("div",{className:"lumiverse-browser-stat",children:[(0,Ee.jsx)("span",{className:"lumiverse-browser-stat-value",children:r.behaviors}),(0,Ee.jsx)("span",{className:"lumiverse-browser-stat-label",children:"BEHAV"})]}),(0,Ee.jsxs)("div",{className:"lumiverse-browser-stat",children:[(0,Ee.jsx)("span",{className:"lumiverse-browser-stat-value",children:r.personalities}),(0,Ee.jsx)("span",{className:"lumiverse-browser-stat-label",children:"PERS"})]})]})}const Jx=function(){const{packs:e,customPacks:n}=vn(),t=gn(),r=Xe(),[i,o]=(0,Ce.useState)(""),[a,s]=(0,Ce.useState)("all"),[l,c]=(0,Ce.useState)(!1),u=(0,Ce.useMemo)(()=>{let e=0;return t.definition&&(e+=1),e+=(t.behaviors||[]).length,e+=(t.personalities||[]).length,e},[t]),d=(0,Ce.useMemo)(()=>[...e.map(e=>Hx(Hx({},e),{},{isCustom:!1})),...n.map(e=>Hx(Hx({},e),{},{isCustom:!0}))],[e,n]),m=(0,Ce.useCallback)((e,n)=>{console.log("[PackBrowser] Selected item:",e,n);const t={packName:e.packName,itemName:Vx(e,"name")};"definition"===n?r.setSelectedDefinition(t):"behavior"===n?r.toggleBehavior(t):"personality"===n&&r.togglePersonality(t),qe()},[r]),p=(0,Ce.useCallback)(e=>{r.openPackDetail(e)},[r]),g=(0,Ce.useCallback)(()=>{r.clearAllSelections(),qe()},[r]);return(0,Ee.jsxs)("div",{className:"lumiverse-pack-browser",children:[(0,Ee.jsx)(Zx,{packs:e,customPacks:n}),(0,Ee.jsx)(qx,{value:i,onChange:o,placeholder:"Search packs and items..."}),(0,Ee.jsx)($x,{activeFilter:a,onFilterChange:s,showSelectedOnly:l,onToggleSelectedOnly:()=>c(!l),selectedCount:u}),(0,Ee.jsx)("div",{className:"lumiverse-browser-packs",children:0===d.length?(0,Ee.jsxs)("div",{className:"lumiverse-browser-empty",children:[(0,Ee.jsx)("span",{className:"lumiverse-browser-empty-icon",children:(0,Ee.jsx)(Nn,{size:32,strokeWidth:1.5})}),(0,Ee.jsx)("p",{children:"No packs loaded"}),(0,Ee.jsx)("span",{className:"lumiverse-browser-empty-hint",children:"Add packs in the Settings panel"})]}):l&&0===u?(0,Ee.jsxs)("div",{className:"lumiverse-browser-empty",children:[(0,Ee.jsx)("span",{className:"lumiverse-browser-empty-icon",children:(0,Ee.jsx)(pf,{size:32,strokeWidth:1.5})}),(0,Ee.jsx)("p",{children:"No items selected"}),(0,Ee.jsx)("span",{className:"lumiverse-browser-empty-hint",children:"Select items to see them here, or disable the filter"})]}):d.map((e,n)=>(0,Ee.jsx)(Xx,{pack:e,filter:a,searchQuery:i,showSelectedOnly:l,onSelectItem:m,onViewPack:p,selections:t},e.name||e.packName||"pack-".concat(n)))}),(0,Ee.jsx)(Rr,{children:u>0&&(0,Ee.jsxs)(Od.button,{className:"lumiverse-browser-clear-all",onClick:g,initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0,y:8},transition:{duration:.2},type:"button",children:[(0,Ee.jsx)(Pn,{size:14,strokeWidth:1.5}),(0,Ee.jsx)("span",{children:"Clear All Selections"}),(0,Ee.jsx)("span",{className:"lumiverse-browser-clear-count",children:u})]})})]})},ey=Sn("type",[["path",{d:"M12 4v16",key:"1654pz"}],["path",{d:"M4 7V5a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v2",key:"e0r10z"}],["path",{d:"M9 20h6",key:"s66wpe"}]]),ny=Sn("quote",[["path",{d:"M16 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z",key:"rib7q0"}],["path",{d:"M5 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z",key:"1ymkrd"}]]),ty=Sn("hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]);function ry(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function iy(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?ry(Object(t),!0).forEach(function(n){oy(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ry(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function oy(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const ay=Ye;function sy(e){let{id:n,checked:t,onChange:r,label:i,hint:o}=e;return(0,Ee.jsxs)("div",{className:"lumiverse-vp-toggle-row",children:[(0,Ee.jsxs)("label",{className:"lumiverse-vp-toggle-label",htmlFor:n,children:[(0,Ee.jsx)("span",{className:"lumiverse-vp-toggle-text",children:i}),o&&(0,Ee.jsx)("span",{className:"lumiverse-vp-toggle-hint",children:o})]}),(0,Ee.jsxs)("div",{className:"lumiverse-vp-toggle-switch-wrapper",children:[(0,Ee.jsx)("input",{type:"checkbox",id:n,className:"lumiverse-vp-toggle-input",checked:t,onChange:e=>r(e.target.checked)}),(0,Ee.jsx)("label",{htmlFor:n,className:"lumiverse-vp-toggle-switch-label",children:(0,Ee.jsx)("div",{className:On("lumiverse-vp-toggle-track",t&&"lumiverse-vp-toggle-track--on"),children:(0,Ee.jsx)("div",{className:"lumiverse-vp-toggle-thumb"})})})]})]})}function ly(e){let{id:n,Icon:t,title:r,description:i,selected:o,onChange:a}=e;return(0,Ee.jsxs)("label",{className:On("lumiverse-vp-style-option",o&&"lumiverse-vp-style-option--selected"),children:[(0,Ee.jsx)("input",{type:"radio",name:"ooc-style",value:n,checked:o,onChange:()=>a(n)}),(0,Ee.jsx)("span",{className:"lumiverse-vp-style-option-icon",children:(0,Ee.jsx)(t,{size:20,strokeWidth:1.5})}),(0,Ee.jsxs)("div",{className:"lumiverse-vp-style-option-text",children:[(0,Ee.jsx)("span",{className:"lumiverse-vp-style-option-title",children:r}),(0,Ee.jsx)("span",{className:"lumiverse-vp-style-option-desc",children:i})]})]})}function cy(e){let{id:n,label:t,hint:r,value:i,onChange:o,placeholder:a,min:s=1}=e;return(0,Ee.jsxs)("div",{className:"lumiverse-vp-field",children:[(0,Ee.jsx)("label",{className:"lumiverse-vp-field-label",htmlFor:n,children:t}),(0,Ee.jsx)("input",{type:"number",id:n,className:"lumiverse-vp-field-input",value:i,onChange:e=>o(e.target.value),placeholder:a,min:s}),r&&(0,Ee.jsx)("span",{className:"lumiverse-vp-field-hint",children:r})]})}const uy=function(){Xe();const e=(0,Ce.useSyncExternalStore)(ay.subscribe,()=>ay.getState().lumiaOOCInterval,()=>ay.getState().lumiaOOCInterval),n=(0,Ce.useSyncExternalStore)(ay.subscribe,()=>ay.getState().lumiaOOCStyle||"social",()=>ay.getState().lumiaOOCStyle||"social"),t=(0,Ce.useSyncExternalStore)(ay.subscribe,()=>ay.getState().councilMode||!1,()=>ay.getState().councilMode||!1),r=(0,Ce.useSyncExternalStore)(ay.subscribe,()=>ay.getState().councilMembers||[],()=>ay.getState().councilMembers||[]),i=(0,Ce.useSyncExternalStore)(ay.subscribe,()=>ay.getState().councilChatStyle||{enabled:!1,showTimestamps:!0},()=>ay.getState().councilChatStyle||{enabled:!1,showTimestamps:!0}),o=t&&r.length>0,a=(0,Ce.useCallback)(e=>{const n=e?parseInt(e,10):null;ay.setState({lumiaOOCInterval:n}),$e()},[]),s=(0,Ce.useCallback)(e=>{if(ay.setState({lumiaOOCStyle:e}),$e(),"undefined"!=typeof LumiverseBridge){const e=LumiverseBridge.getCallbacks();null!=e&&e.refreshOOCComments&&e.refreshOOCComments(!0)}},[]),l=(0,Ce.useCallback)(e=>{const n=iy(iy({},i),{},{enabled:e});if(ay.setState({councilChatStyle:n}),$e(),"undefined"!=typeof LumiverseBridge){const e=LumiverseBridge.getCallbacks();null!=e&&e.refreshOOCComments&&e.refreshOOCComments(!0)}},[i]),c=(0,Ce.useCallback)(e=>{const n=iy(iy({},i),{},{showTimestamps:e});if(ay.setState({councilChatStyle:n}),$e(),"undefined"!=typeof LumiverseBridge){const e=LumiverseBridge.getCallbacks();null!=e&&e.refreshOOCComments&&e.refreshOOCComments(!0)}},[i]),u=(0,Ce.useCallback)(e=>{const n=iy(iy({},i),{},{useLeetHandles:e});if(ay.setState({councilChatStyle:n}),$e(),"undefined"!=typeof LumiverseBridge){const e=LumiverseBridge.getCallbacks();null!=e&&e.refreshOOCComments&&e.refreshOOCComments(!0)}},[i]),d=[{id:"none",Icon:ey,title:"None",description:"Raw text with no formatting"},{id:"social",Icon:Gv,title:"Social Card",description:"Full card with avatar & animations"},{id:"margin",Icon:zv,title:"Margin Note",description:"Minimal hanging tag style"},{id:"whisper",Icon:ny,title:"Whisper Bubble",description:"Soft ethereal thought bubble"}];return(0,Ee.jsxs)("div",{className:"lumiverse-vp-settings-panel",children:[(0,Ee.jsxs)("div",{className:"lumiverse-vp-settings-section",children:[(0,Ee.jsxs)("div",{className:"lumiverse-vp-settings-section-header",children:[(0,Ee.jsx)(vt,{size:16,strokeWidth:1.5}),(0,Ee.jsx)("span",{children:"Comment Trigger"})]}),(0,Ee.jsx)("p",{className:"lumiverse-vp-settings-desc",children:"Automatically inject OOC instructions at message intervals."}),(0,Ee.jsx)(cy,{id:"ooc-interval",label:"Message Interval",hint:"Triggers when message count is divisible by this number",value:(null==e?void 0:e.toString())||"",onChange:a,placeholder:"e.g., 10 (empty = disabled)"})]}),(0,Ee.jsxs)("div",{className:"lumiverse-vp-settings-section",children:[(0,Ee.jsxs)("div",{className:"lumiverse-vp-settings-section-header",children:[(0,Ee.jsx)(Yv,{size:16,strokeWidth:1.5}),(0,Ee.jsx)("span",{children:"Display Style"})]}),(0,Ee.jsx)("p",{className:"lumiverse-vp-settings-desc",children:"Choose how OOC comments appear in chat."}),(0,Ee.jsx)("div",{className:"lumiverse-vp-style-options",children:d.map(e=>(0,Ee.jsx)(ly,iy(iy({},e),{},{selected:n===e.id,onChange:s}),e.id))})]}),o&&(0,Ee.jsxs)("div",{className:"lumiverse-vp-settings-section",children:[(0,Ee.jsxs)("div",{className:"lumiverse-vp-settings-section-header",children:[(0,Ee.jsx)(ty,{size:16,strokeWidth:1.5}),(0,Ee.jsx)("span",{children:"Council IRC Mode"}),(0,Ee.jsx)(Ad,{size:14,strokeWidth:1.5,style:{marginLeft:"auto",opacity:.5}})]}),(0,Ee.jsx)("p",{className:"lumiverse-vp-settings-desc",children:"Display council OOC as a retro internet chatroom. Members can @mention each other."}),(0,Ee.jsx)(sy,{id:"irc-style-enabled",checked:i.enabled,onChange:l,label:"Enable IRC Chat Style",hint:"Council members appear in a shared #LumiaCouncil channel"}),i.enabled&&(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsx)(sy,{id:"irc-timestamps",checked:i.showTimestamps,onChange:c,label:"Show Timestamps",hint:"Display [HH:MM] before each message"}),(0,Ee.jsx)(sy,{id:"irc-leet-handles",checked:!1!==i.useLeetHandles,onChange:u,label:"L33tspeak Handles",hint:"Convert names like 'Sarah' → 'S4r4h'"})]})]})]})},dy=Sn("hand",[["path",{d:"M18 11V6a2 2 0 0 0-2-2a2 2 0 0 0-2 2",key:"1fvzgz"}],["path",{d:"M14 10V4a2 2 0 0 0-2-2a2 2 0 0 0-2 2v2",key:"1kc0my"}],["path",{d:"M10 10.5V6a2 2 0 0 0-2-2a2 2 0 0 0-2 2v8",key:"10h0bg"}],["path",{d:"M18 8a2 2 0 1 1 4 0v6a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15",key:"1s1gnw"}]]);function my(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function py(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?my(Object(t),!0).forEach(function(n){gy(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):my(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function gy(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const hy=Ye,vy={},fy={enabled:!1,excludeLastMessage:!0,includeMessageInPrompt:!0},by=()=>hy.getState().sovereignHand||fy,xy=()=>hy.getState().contextFilters||vy,yy=()=>hy.getState().chimeraMode||!1,ky=()=>hy.getState().councilMode||!1,wy=()=>{var e;return(null===(e=hy.getState().selectedDefinitions)||void 0===e?void 0:e.length)||0},jy=()=>{var e;return(null===(e=hy.getState().councilMembers)||void 0===e?void 0:e.length)||0},Cy=()=>hy.getState().lumiaQuirks||"",Sy=()=>!1!==hy.getState().lumiaQuirksEnabled;function Ny(e){let{id:n,checked:t,onChange:r,label:i,hint:o,disabled:a=!1}=e;return(0,Ee.jsxs)("div",{className:On("lumiverse-vp-toggle-row",a&&"lumiverse-vp-toggle-row--disabled"),children:[(0,Ee.jsxs)("label",{className:"lumiverse-vp-toggle-label",htmlFor:n,children:[(0,Ee.jsx)("span",{className:"lumiverse-vp-toggle-text",children:i}),o&&(0,Ee.jsx)("span",{className:"lumiverse-vp-toggle-hint",children:o})]}),(0,Ee.jsxs)("div",{className:"lumiverse-vp-toggle-switch-wrapper",children:[(0,Ee.jsx)("input",{type:"checkbox",id:n,className:"lumiverse-vp-toggle-input",checked:t,onChange:e=>r(e.target.checked),disabled:a}),(0,Ee.jsx)("label",{htmlFor:n,className:"lumiverse-vp-toggle-switch-label",children:(0,Ee.jsx)("div",{className:On("lumiverse-vp-toggle-track",t&&"lumiverse-vp-toggle-track--on",a&&"lumiverse-vp-toggle-track--disabled"),children:(0,Ee.jsx)("div",{className:"lumiverse-vp-toggle-thumb"})})})]})]})}function Ey(e){let{id:n,label:t,hint:r,value:i,onChange:o,min:a=0,max:s=100}=e;return(0,Ee.jsxs)("div",{className:"lumiverse-vp-field lumiverse-vp-field--inline",children:[(0,Ee.jsx)("label",{className:"lumiverse-vp-field-label",htmlFor:n,children:t}),(0,Ee.jsx)("input",{type:"number",id:n,className:"lumiverse-vp-field-input lumiverse-vp-field-input--small",value:i,onChange:e=>o(parseInt(e.target.value,10)||0),min:a,max:s}),r&&(0,Ee.jsx)("span",{className:"lumiverse-vp-field-hint",children:r})]})}function Py(e){let{items:n,muted:t=!1}=e;return(0,Ee.jsxs)("div",{className:On("lumiverse-vp-info-box",t&&"lumiverse-vp-info-box--muted"),children:[(0,Ee.jsxs)("div",{className:"lumiverse-vp-info-box-header",children:[(0,Ee.jsx)(Rd,{size:14,strokeWidth:2}),(0,Ee.jsx)("span",{children:"When enabled:"})]}),(0,Ee.jsx)("ul",{className:"lumiverse-vp-info-box-list",children:n.map((e,n)=>(0,Ee.jsx)("li",{children:e},n))})]})}function Dy(e){let{id:n,label:t,hint:r,enabled:i,onToggle:o,depthValue:a,onDepthChange:s,depthLabel:l,depthHint:c}=e;return(0,Ee.jsxs)("div",{className:"lumiverse-vp-filter-item",children:[(0,Ee.jsx)(Ny,{id:n,checked:i,onChange:o,label:t,hint:r}),(0,Ee.jsx)(it,{isOpen:i&&void 0!==a,className:"lumiverse-vp-filter-options",duration:150,children:(0,Ee.jsx)(Ey,{id:"".concat(n,"-depth"),label:l||"Keep in last N messages",hint:c,value:a,onChange:s})})]})}const My=function(){var e,n,t,r,i,o,a,s,l,c,u,d,m,p,g,h,v,f,b;const x=Xe(),y=(0,Ce.useSyncExternalStore)(hy.subscribe,by,by),k=(0,Ce.useSyncExternalStore)(hy.subscribe,xy,xy),w=(0,Ce.useSyncExternalStore)(hy.subscribe,yy,yy),j=(0,Ce.useSyncExternalStore)(hy.subscribe,ky,ky),C=(0,Ce.useSyncExternalStore)(hy.subscribe,wy,wy),S=(0,Ce.useSyncExternalStore)(hy.subscribe,jy,jy),N=(0,Ce.useSyncExternalStore)(hy.subscribe,Cy,Cy),E=(0,Ce.useSyncExternalStore)(hy.subscribe,Sy,Sy),[P,D]=(0,Ce.useState)(N),[M,O]=(0,Ce.useState)(!1),T=null!==(e=y.enabled)&&void 0!==e&&e,A=null!==(n=null===(t=k.htmlTags)||void 0===t?void 0:t.enabled)&&void 0!==n&&n,L=null!==(r=null===(i=k.htmlTags)||void 0===i?void 0:i.keepDepth)&&void 0!==r?r:3,z=null!==(o=null===(a=k.htmlTags)||void 0===a?void 0:a.stripFonts)&&void 0!==o&&o,I=null!==(s=null===(l=k.htmlTags)||void 0===l?void 0:l.fontKeepDepth)&&void 0!==s?s:3,R=null!==(c=null===(u=k.detailsBlocks)||void 0===u?void 0:u.enabled)&&void 0!==c&&c,B=null!==(d=null===(m=k.detailsBlocks)||void 0===m?void 0:m.keepDepth)&&void 0!==d?d:3,_=null!==(p=null===(g=k.loomItems)||void 0===g?void 0:g.enabled)&&void 0!==p&&p,F=null!==(h=null===(v=k.loomItems)||void 0===v?void 0:v.keepDepth)&&void 0!==h?h:5,U=(0,Ce.useCallback)((e,n)=>{const t=hy.getState(),r=e.split(".");if("sovereignHand"===r[0])hy.setState({sovereignHand:py(py({},t.sovereignHand),{},{[r[1]]:n})});else if("contextFilters"===r[0]){var i;const e=r[1],o=r[2];hy.setState({contextFilters:py(py({},t.contextFilters),{},{[e]:py(py({},(null===(i=t.contextFilters)||void 0===i?void 0:i[e])||{}),{},{[o]:n})})})}qe()},[]),H=A||R||_,W=(0,Ce.useCallback)(e=>{x.setChimeraMode(e),qe()},[x]),V=(0,Ce.useCallback)(e=>{x.setCouncilMode(e),qe()},[x]),q=(0,Ce.useCallback)(()=>{x.setLumiaQuirks(P),qe(),O(!1)},[x,P]),$=(0,Ce.useCallback)(()=>{D(N),O(!1)},[N]),Y=(0,Ce.useCallback)(e=>{x.setLumiaQuirksEnabled(e),qe()},[x]),G=w||j;return(0,Ee.jsxs)("div",{className:"lumiverse-vp-settings-panel",children:[(0,Ee.jsxs)(hx,{Icon:Jt,title:"Lumia Modes",status:G,defaultOpen:!0,children:[(0,Ee.jsx)("p",{className:"lumiverse-vp-settings-desc",children:"Configure special Lumia modes for unique character setups. These modes are mutually exclusive."}),(0,Ee.jsxs)("div",{className:"lumiverse-vp-mode-option",children:[(0,Ee.jsx)(Ny,{id:"chimera-mode-toggle",checked:w,onChange:W,label:"Chimera Mode",hint:"Fuse multiple physical definitions into one hybrid form"}),(0,Ee.jsx)(it,{isOpen:w,className:"lumiverse-vp-mode-details",duration:150,children:(0,Ee.jsx)(Py,{items:["Select multiple definitions in the Definition modal","All selected forms will be fused into one Chimera","Currently ".concat(C," definition").concat(1!==C?"s":""," selected")]})})]}),(0,Ee.jsxs)("div",{className:"lumiverse-vp-mode-option",children:[(0,Ee.jsx)(Ny,{id:"council-mode-toggle",checked:j,onChange:V,label:"Council Mode",hint:"Multiple independent Lumias that collaborate"}),(0,Ee.jsxs)(it,{isOpen:j,className:"lumiverse-vp-mode-details",duration:150,children:[(0,Ee.jsx)(Py,{items:["Each council member has independent traits","Members can converse and collaborate","Currently ".concat(S," council member").concat(1!==S?"s":"")]}),(0,Ee.jsx)("p",{className:"lumiverse-vp-mode-note",children:"Configure council members in the Council tab."})]})]}),(0,Ee.jsxs)("div",{className:On("lumiverse-vp-quirks-section",!E&&"lumiverse-vp-quirks-section--disabled"),children:[(0,Ee.jsxs)("div",{className:"lumiverse-vp-quirks-header",children:[(0,Ee.jsxs)("div",{className:"lumiverse-vp-quirks-header-left",children:[(0,Ee.jsx)("span",{className:"lumiverse-vp-quirks-label",children:"Behavioral Quirks"}),(0,Ee.jsx)("button",{className:On("lumiverse-vp-quirks-toggle",E&&"lumiverse-vp-quirks-toggle--on"),onClick:()=>Y(!E),title:E?"Disable quirks":"Enable quirks",type:"button","aria-pressed":E,children:(0,Ee.jsx)("span",{className:"lumiverse-vp-quirks-toggle-track",children:(0,Ee.jsx)("span",{className:"lumiverse-vp-quirks-toggle-thumb"})})})]}),!M&&E&&(0,Ee.jsx)("button",{className:"lumiverse-vp-quirks-edit-btn",onClick:()=>O(!0),title:"Edit quirks",type:"button",children:(0,Ee.jsx)(En,{size:12,strokeWidth:1.5})})]}),(0,Ee.jsxs)("p",{className:"lumiverse-vp-quirks-hint",children:["Extra behavioral modifications. Use ",(0,Ee.jsx)("code",{children:"{{lumiaQuirks}}"})]}),M&&E?(0,Ee.jsxs)("div",{className:"lumiverse-vp-quirks-edit",children:[(0,Ee.jsx)("textarea",{className:"lumiverse-vp-quirks-textarea",placeholder:"Enter behavioral quirks...",value:P,onChange:e=>D(e.target.value),rows:3}),(0,Ee.jsxs)("div",{className:"lumiverse-vp-quirks-actions",children:[(0,Ee.jsxs)("button",{className:"lumiverse-vp-quirks-btn lumiverse-vp-quirks-btn--primary",onClick:q,type:"button",children:[(0,Ee.jsx)(zd,{size:12,strokeWidth:2})," Save"]}),(0,Ee.jsxs)("button",{className:"lumiverse-vp-quirks-btn",onClick:$,type:"button",children:[(0,Ee.jsx)(mt,{size:12,strokeWidth:2})," Cancel"]})]})]}):(0,Ee.jsx)("div",{className:"lumiverse-vp-quirks-preview",children:null!=N&&N.trim()?(0,Ee.jsx)("span",{className:"lumiverse-vp-quirks-text",children:N}):(0,Ee.jsx)("span",{className:"lumiverse-vp-quirks-empty",children:"No quirks set"})})]})]}),(0,Ee.jsxs)(hx,{Icon:dy,title:"Sovereign Hand",status:T,defaultOpen:!0,children:[(0,Ee.jsx)("p",{className:"lumiverse-vp-settings-desc",children:"Enable Sovereign Hand integration to use advanced prompt manipulation features."}),(0,Ee.jsx)(Ny,{id:"sovereign-hand-toggle",checked:T,onChange:e=>U("sovereignHand.enabled",e),label:"Use Sovereign Hand Features",hint:"Enables Sovereign Hand macros for advanced prompt control"}),(0,Ee.jsx)(Ny,{id:"sovereign-hand-exclude-toggle",checked:null===(f=y.excludeLastMessage)||void 0===f||f,onChange:e=>U("sovereignHand.excludeLastMessage",e),label:"Exclude Last Message from Context",hint:"When enabled, removes the last user message from the outgoing context",disabled:!T}),(0,Ee.jsx)(Ny,{id:"sovereign-hand-include-in-prompt-toggle",checked:null===(b=y.includeMessageInPrompt)||void 0===b||b,onChange:e=>U("sovereignHand.includeMessageInPrompt",e),label:"Include Message in Master Prompt",hint:"When enabled, includes the user message in the {{loomSovHand}} macro output",disabled:!T}),(0,Ee.jsx)(Py,{muted:!T,items:[(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsx)("code",{children:"{{loomLastUserMessage}}"})," returns the last user message"]}),(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsx)("code",{children:"{{loomLastCharMessage}}"})," returns the last character message"]}),(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsx)("code",{children:"{{lastMessageName}}"})," returns the name of whoever sent the last message"]}),(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsx)("code",{children:"{{loomContinuePrompt}}"})," adds continuation instructions when character spoke last"]})]})]}),(0,Ee.jsxs)(hx,{Icon:pf,title:"Context Filters",status:H,children:[(0,Ee.jsx)("p",{className:"lumiverse-vp-settings-desc",children:"Filter out specific content from the chat context before sending to the AI."}),(0,Ee.jsx)(Dy,{id:"filter-html",label:"Strip HTML Tags",hint:"Removes formatting tags: <div>, <span>, <b>, <i>, etc.",enabled:A,onToggle:e=>U("contextFilters.htmlTags.enabled",e),depthValue:L,onDepthChange:e=>U("contextFilters.htmlTags.keepDepth",e),depthLabel:"Keep HTML in last N messages",depthHint:"HTML tags in older messages will be stripped"}),(0,Ee.jsx)(it,{isOpen:A,className:"lumiverse-vp-filter-sub",duration:200,children:(0,Ee.jsx)(Dy,{id:"filter-fonts",label:"Also Strip Fonts",hint:"Remove <font> tags (used by some presets)",enabled:z,onToggle:e=>U("contextFilters.htmlTags.stripFonts",e),depthValue:I,onDepthChange:e=>U("contextFilters.htmlTags.fontKeepDepth",e),depthLabel:"Keep fonts in last N messages",depthHint:"Font tags in older messages will be stripped"})}),(0,Ee.jsx)(Dy,{id:"filter-details",label:"Filter Details Blocks",hint:"Removes <details> blocks from older messages",enabled:R,onToggle:e=>U("contextFilters.detailsBlocks.enabled",e),depthValue:B,onDepthChange:e=>U("contextFilters.detailsBlocks.keepDepth",e),depthHint:"Messages beyond this depth will have <details> removed"}),(0,Ee.jsx)(Dy,{id:"filter-loom",label:"Filter Loom Tags",hint:"Removes Lucid Loom-related tags from older messages",enabled:_,onToggle:e=>U("contextFilters.loomItems.enabled",e),depthValue:F,onDepthChange:e=>U("contextFilters.loomItems.keepDepth",e),depthHint:"Loom tags in older messages will be stripped"})]})]})},Oy=Sn("briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]]),Ty=Sn("radio",[["path",{d:"M16.247 7.761a6 6 0 0 1 0 8.478",key:"1fwjs5"}],["path",{d:"M19.075 4.933a10 10 0 0 1 0 14.134",key:"ehdyv1"}],["path",{d:"M4.925 19.067a10 10 0 0 1 0-14.134",key:"1q22gi"}],["path",{d:"M7.753 16.239a6 6 0 0 1 0-8.478",key:"r2q7qm"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),Ay=Sn("cpu",[["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M17 20v2",key:"1rnc9c"}],["path",{d:"M17 2v2",key:"11trls"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M2 17h2",key:"7oei6x"}],["path",{d:"M2 7h2",key:"asdhe0"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"M20 17h2",key:"1fpfkl"}],["path",{d:"M20 7h2",key:"1o8tra"}],["path",{d:"M7 20v2",key:"4gnj0m"}],["path",{d:"M7 2v2",key:"1i4yhu"}],["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"8",y:"8",width:"8",height:"8",rx:"1",key:"z9xiuo"}]]),Ly=Sn("plug",[["path",{d:"M12 22v-5",key:"1ega77"}],["path",{d:"M9 8V2",key:"14iosj"}],["path",{d:"M15 8V2",key:"18g5xt"}],["path",{d:"M18 8v5a4 4 0 0 1-4 4h-4a4 4 0 0 1-4-4V8Z",key:"osxo6l"}]]);function zy(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function Iy(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?zy(Object(t),!0).forEach(function(n){Ry(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):zy(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Ry(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const By={openai:{name:"OpenAI",placeholder:"gpt-4o-mini"},anthropic:{name:"Anthropic",placeholder:"claude-sonnet-4-5-20250929"},google:{name:"Google AI",placeholder:"gemini-2.0-flash"},openrouter:{name:"OpenRouter",placeholder:"openai/gpt-4o-mini"},chutes:{name:"Chutes",placeholder:"deepseek-ai/DeepSeek-V3"},electronhub:{name:"ElectronHub",placeholder:"gpt-4o-mini"},nanogpt:{name:"NanoGPT",placeholder:"chatgpt-4o-latest"},zai:{name:"Z.AI",placeholder:"gpt-4o-mini"},custom:{name:"Custom",placeholder:"your-model-id"}},_y=Ye,Fy=[];function Uy(e){const n=(0,Ce.useRef)(!1),t=(0,Ce.useRef)({x:0,y:0,time:0}),r=(0,Ce.useCallback)(e=>{if(1===e.touches.length){const n=e.touches[0];t.current={x:n.clientX,y:n.clientY,time:Date.now()}}},[]),i=(0,Ce.useCallback)(r=>{if(1===r.changedTouches.length){const i=r.changedTouches[0],o=Math.abs(i.clientX-t.current.x),a=Math.abs(i.clientY-t.current.y),s=Date.now()-t.current.time;o<10&&a<10&&s<500&&(r.preventDefault(),r.stopPropagation(),n.current=!0,e(r),setTimeout(()=>{n.current=!1},300))}},[e]);return{onClick:(0,Ce.useCallback)(t=>{t.stopPropagation(),n.current||e(t)},[e]),onTouchStart:r,onTouchEnd:i}}const Hy=()=>_y.getState().councilMode||!1,Wy=()=>_y.getState().councilMembers||Fy,Vy=()=>_y.getState().councilTools||{enabled:!1,timeoutMs:3e4};function qy(e,n){return e?e.lumiaItems&&e.lumiaItems.length>0?e.lumiaItems.find(e=>e.lumiaName===n||e.lumiaDefName===n):e.items?e.items.find(e=>e.lumiaDefName===n):null:null}function $y(e,n,t){const r=(Array.isArray(e)?e.reduce((e,n)=>Iy(Iy({},e),{},{[n.name||n.packName]:n}),{}):e)[n];if(!r)return t;const i=qy(r,t);return(null==i?void 0:i.lumiaName)||(null==i?void 0:i.lumiaDefName)||t}function Yy(e){let{selectedTools:n,onToggle:t,onClose:r}=e;const i=(0,Ce.useMemo)(()=>(0,W.vM)(),[]);return(0,Ee.jsxs)("div",{className:"lumiverse-council-tool-selector",children:[(0,Ee.jsxs)("div",{className:"lumiverse-council-tool-header",children:[(0,Ee.jsx)("span",{children:"Assign Tools"}),(0,Ee.jsx)("button",{className:"lumiverse-council-btn",onClick:r,type:"button",children:(0,Ee.jsx)(mt,{size:14})})]}),(0,Ee.jsx)("div",{className:"lumiverse-council-tool-list",children:i.map(e=>(0,Ee.jsxs)("label",{className:"lumiverse-council-tool-item",children:[(0,Ee.jsx)("input",{type:"checkbox",checked:n.includes(e.name),onChange:()=>t(e.name)}),(0,Ee.jsxs)("div",{className:"lumiverse-council-tool-info",children:[(0,Ee.jsx)("span",{className:"lumiverse-council-tool-name",children:e.displayName}),(0,Ee.jsx)("span",{className:"lumiverse-council-tool-desc",children:e.description})]})]},e.name))})]})}function Gy(e){var n,t,r;let{member:i,packs:o,onUpdate:a,onRemove:s}=e;const[l,c]=(0,Ce.useState)(!1),[u,d]=(0,Ce.useState)(!1),[m,p]=(0,Ce.useState)(!1),[g,h]=(0,Ce.useState)(i.role||""),v=$y(o,i.packName,i.itemName),f=function(e,n,t){const r=(Array.isArray(e)?e.reduce((e,n)=>Iy(Iy({},e),{},{[n.name||n.packName]:n}),{}):e)[n];if(!r)return null;const i=qy(r,t);return(null==i?void 0:i.avatarUrl)||(null==i?void 0:i.lumia_img)||null}(o,i.packName,i.itemName),b=()=>{a(i.id,{role:g}),d(!1)},x=(null===(n=i.behaviors)||void 0===n?void 0:n.length)||0,y=(null===(t=i.personalities)||void 0===t?void 0:t.length)||0,k=(null===(r=i.tools)||void 0===r?void 0:r.length)||0;return(0,Ee.jsxs)("div",{className:"lumiverse-council-member",children:[(0,Ee.jsxs)("div",{className:"lumiverse-council-member-header",onPointerUp:e=>{e.stopPropagation(),e.preventDefault(),c(!l)},children:[(0,Ee.jsx)("div",{className:"lumiverse-council-member-avatar",children:f?(0,Ee.jsx)("img",{src:f,alt:v}):(0,Ee.jsx)(Ad,{size:20,strokeWidth:1.5})}),(0,Ee.jsxs)("div",{className:"lumiverse-council-member-info",children:[(0,Ee.jsx)("span",{className:"lumiverse-council-member-name",children:v}),i.role&&!u&&(0,Ee.jsx)("span",{className:"lumiverse-council-member-role",children:i.role}),(0,Ee.jsxs)("div",{className:"lumiverse-council-member-stats",children:[(0,Ee.jsxs)("span",{className:"lumiverse-council-stat",children:[(0,Ee.jsx)(ut,{size:12})," ",x]}),(0,Ee.jsxs)("span",{className:"lumiverse-council-stat",children:[(0,Ee.jsx)(jp,{size:12})," ",y]}),k>0&&(0,Ee.jsxs)("span",{className:"lumiverse-council-stat lumiverse-council-stat--tools",children:[(0,Ee.jsx)(Oy,{size:12})," ",k]})]})]}),(0,Ee.jsxs)("div",{className:"lumiverse-council-member-actions",children:[(0,Ee.jsx)("button",{className:"lumiverse-council-btn",onPointerUp:e=>{e.stopPropagation(),e.preventDefault(),d(!0),c(!0)},title:"Edit role",type:"button",children:(0,Ee.jsx)(En,{size:14,strokeWidth:1.5})}),(0,Ee.jsx)("button",{className:"lumiverse-council-btn lumiverse-council-btn--danger",onPointerUp:e=>{e.stopPropagation(),e.preventDefault(),s(i.id)},title:"Remove from council",type:"button",children:(0,Ee.jsx)(Pn,{size:14,strokeWidth:1.5})}),(0,Ee.jsx)("span",{className:On("lumiverse-council-expand",l&&"lumiverse-council-expand--open"),children:(0,Ee.jsx)(Tn,{size:16,strokeWidth:2})})]})]}),l&&(0,Ee.jsxs)("div",{className:"lumiverse-council-member-body",children:[u?(0,Ee.jsxs)("div",{className:"lumiverse-council-role-edit",children:[(0,Ee.jsx)("label",{children:"Role/Title:"}),(0,Ee.jsxs)("div",{className:"lumiverse-council-role-input-row",children:[(0,Ee.jsx)("input",{type:"text",className:"lumiverse-council-input",placeholder:"e.g., Leader, Advisor, Wildcard...",value:g,onChange:e=>h(e.target.value),onKeyDown:e=>{"Enter"===e.key&&b(),"Escape"===e.key&&(h(i.role||""),d(!1))},autoFocus:!0}),(0,Ee.jsx)("button",{className:"lumiverse-council-btn lumiverse-council-btn--primary",onPointerUp:e=>{e.stopPropagation(),e.preventDefault(),b()},type:"button",children:(0,Ee.jsx)(zd,{size:14,strokeWidth:2})}),(0,Ee.jsx)("button",{className:"lumiverse-council-btn",onPointerUp:e=>{e.stopPropagation(),e.preventDefault(),h(i.role||""),d(!1)},type:"button",children:(0,Ee.jsx)(mt,{size:14,strokeWidth:2})})]})]}):(0,Ee.jsxs)("div",{className:"lumiverse-council-role-display",children:[(0,Ee.jsx)("span",{className:"lumiverse-council-role-label",children:"Role:"}),(0,Ee.jsx)("span",{className:"lumiverse-council-role-value",children:i.role||(0,Ee.jsx)("em",{children:"No role set"})})]}),(0,Ee.jsxs)("div",{className:"lumiverse-council-traits-section",children:[(0,Ee.jsxs)("div",{className:"lumiverse-council-traits-group",children:[(0,Ee.jsxs)("span",{className:"lumiverse-council-traits-label",children:[(0,Ee.jsx)(ut,{size:14,strokeWidth:1.5})," Behaviors:"]}),x>0?(0,Ee.jsx)("span",{className:"lumiverse-council-traits-list",children:i.behaviors.map(e=>$y(o,e.packName,e.itemName)).join(", ")}):(0,Ee.jsx)("span",{className:"lumiverse-council-traits-empty",children:"None selected"})]}),(0,Ee.jsxs)("div",{className:"lumiverse-council-traits-group",children:[(0,Ee.jsxs)("span",{className:"lumiverse-council-traits-label",children:[(0,Ee.jsx)(jp,{size:14,strokeWidth:1.5})," Personalities:"]}),y>0?(0,Ee.jsx)("span",{className:"lumiverse-council-traits-list",children:i.personalities.map(e=>$y(o,e.packName,e.itemName)).join(", ")}):(0,Ee.jsx)("span",{className:"lumiverse-council-traits-empty",children:"None selected"})]})]}),(0,Ee.jsxs)("div",{className:"lumiverse-council-tools-section",children:[(0,Ee.jsxs)("div",{className:"lumiverse-council-tools-header",children:[(0,Ee.jsxs)("span",{className:"lumiverse-council-tools-label",children:[(0,Ee.jsx)(Oy,{size:14,strokeWidth:1.5})," Tools:"]}),(0,Ee.jsx)("button",{className:"lumiverse-council-btn lumiverse-council-btn--small",onClick:()=>p(!m),type:"button",children:m?"Done":"Assign Tools"})]}),m?(0,Ee.jsx)(Yy,{selectedTools:i.tools||[],onToggle:e=>{const n=i.tools||[],t=n.includes(e)?n.filter(n=>n!==e):[...n,e];a(i.id,{tools:t})},onClose:()=>p(!1)}):k>0?(0,Ee.jsx)("div",{className:"lumiverse-council-tools-list",children:(i.tools||[]).map(e=>{const n=(0,W.vM)().find(n=>n.name===e);return(0,Ee.jsx)("span",{className:"lumiverse-council-tool-tag",children:(null==n?void 0:n.displayName)||e},e)})}):(0,Ee.jsx)("span",{className:"lumiverse-council-tools-empty",children:"No tools assigned. Tools allow this member to contribute suggestions before generation."})]}),(0,Ee.jsx)("p",{className:"lumiverse-council-help-text",children:"Each member's inherent traits are auto-attached when added. Use the role field to define their expertise, which enhances tool contributions."})]})]})}function Ky(e){let{item:n,onSelect:t}=e;const r=Uy((0,Ce.useCallback)(()=>{t(n)},[n,t]));return(0,Ee.jsxs)("div",Iy(Iy({className:"lumiverse-council-add-item"},r),{},{role:"button",tabIndex:0,children:[(0,Ee.jsx)("div",{className:"lumiverse-council-add-item-avatar",children:n.image?(0,Ee.jsx)("img",{src:n.image,alt:n.displayName}):(0,Ee.jsx)(Ad,{size:16})}),(0,Ee.jsxs)("div",{className:"lumiverse-council-add-item-info",children:[(0,Ee.jsx)("span",{className:"lumiverse-council-add-item-name",children:n.displayName}),(0,Ee.jsx)("span",{className:"lumiverse-council-add-item-pack",children:n.packName})]})]}))}function Qy(e){let{packs:n,existingMembers:t,onAdd:r,onClose:i}=e;const[o,a]=(0,Ce.useState)(""),s="undefined"!=typeof window&&window.innerWidth<=600,l=(0,Ce.useMemo)(()=>{const e=new Set(t.map(e=>"".concat(e.packName,":").concat(e.itemName))),r=[];if((Array.isArray(n)?n:Object.values(n||{})).forEach(n=>{const t=n.name||n.packName;n.lumiaItems&&n.lumiaItems.length>0?n.lumiaItems.forEach(n=>{const i=n.lumiaName||n.lumiaDefName,o=n.lumiaDefinition||n.lumiaDef;if(!i||!o)return;const a="".concat(t,":").concat(i);e.has(a)||r.push({packName:t,itemName:i,displayName:i,image:n.avatarUrl||n.lumia_img})}):n.items&&n.items.forEach(n=>{if(!n.lumiaDefName||!n.lumiaDef)return;const i="".concat(t,":").concat(n.lumiaDefName);e.has(i)||r.push({packName:t,itemName:n.lumiaDefName,displayName:n.lumiaDefName,image:n.lumia_img})})}),o.trim()){const e=o.toLowerCase();return r.filter(n=>n.displayName.toLowerCase().includes(e)||n.packName.toLowerCase().includes(e))}return r},[n,t,o]),c=(0,Ce.useCallback)(e=>{r({packName:e.packName,itemName:e.itemName}),i()},[r,i]);return(0,Ee.jsxs)("div",{className:"lumiverse-council-add-dropdown",onClick:e=>e.stopPropagation(),children:[(0,Ee.jsxs)("div",{className:"lumiverse-council-add-header",children:[(0,Ee.jsx)("input",{type:"text",className:"lumiverse-council-search",placeholder:"Search Lumias...",value:o,onChange:e=>a(e.target.value),autoFocus:!s}),(0,Ee.jsx)("button",{className:"lumiverse-council-btn",onClick:i,title:"Close",type:"button",children:(0,Ee.jsx)(mt,{size:16,strokeWidth:2})})]}),(0,Ee.jsx)("div",{className:"lumiverse-council-add-list",children:0===l.length?(0,Ee.jsx)("div",{className:"lumiverse-council-add-empty",children:o?"No matching Lumias found":"All Lumias are already in the council"}):l.map(e=>(0,Ee.jsx)(Ky,{item:e,onSelect:c},"".concat(e.packName,":").concat(e.itemName)))})]})}function Xy(e){let{pack:n,onSelect:t}=e;const r=Uy((0,Ce.useCallback)(()=>{t(n.packName)},[n.packName,t]));return(0,Ee.jsxs)("div",Iy(Iy({className:"lumiverse-council-add-item lumiverse-council-pack-item"},r),{},{role:"button",tabIndex:0,children:[(0,Ee.jsx)("div",{className:"lumiverse-council-add-item-avatar lumiverse-council-pack-icon",children:n.coverUrl?(0,Ee.jsx)("img",{src:n.coverUrl,alt:n.packName}):(0,Ee.jsx)(Nn,{size:18,strokeWidth:1.5})}),(0,Ee.jsxs)("div",{className:"lumiverse-council-add-item-info",children:[(0,Ee.jsx)("span",{className:"lumiverse-council-add-item-name",children:n.packName}),(0,Ee.jsxs)("span",{className:"lumiverse-council-add-item-pack",children:[n.availableCount," Lumia",1!==n.availableCount?"s":""," available"]})]})]}))}function Zy(e){let{packs:n,existingMembers:t,onAddPack:r,onClose:i}=e;const[o,a]=(0,Ce.useState)(""),s="undefined"!=typeof window&&window.innerWidth<=600,l=(0,Ce.useMemo)(()=>{const e=new Set(t.map(e=>"".concat(e.packName,":").concat(e.itemName))),r=[];if((Array.isArray(n)?n:Object.values(n||{})).forEach(n=>{const t=n.name||n.packName;let i=0;n.lumiaItems&&n.lumiaItems.length>0?n.lumiaItems.forEach(n=>{const r=n.lumiaName||n.lumiaDefName,o=n.lumiaDefinition||n.lumiaDef;if(!r||!o)return;const a="".concat(t,":").concat(r);e.has(a)||i++}):n.items&&n.items.forEach(n=>{if(!n.lumiaDefName||!n.lumiaDef)return;const r="".concat(t,":").concat(n.lumiaDefName);e.has(r)||i++}),i>0&&r.push({packName:t,availableCount:i,coverUrl:n.coverUrl})}),o.trim()){const e=o.toLowerCase();return r.filter(n=>n.packName.toLowerCase().includes(e))}return r},[n,t,o]),c=(0,Ce.useCallback)(e=>{r(e),i()},[r,i]);return(0,Ee.jsxs)("div",{className:"lumiverse-council-add-dropdown lumiverse-council-pack-dropdown",onClick:e=>e.stopPropagation(),children:[(0,Ee.jsxs)("div",{className:"lumiverse-council-add-header",children:[(0,Ee.jsx)("input",{type:"text",className:"lumiverse-council-search",placeholder:"Search packs...",value:o,onChange:e=>a(e.target.value),autoFocus:!s}),(0,Ee.jsx)("button",{className:"lumiverse-council-btn",onClick:i,title:"Close",type:"button",children:(0,Ee.jsx)(mt,{size:16,strokeWidth:2})})]}),(0,Ee.jsx)("div",{className:"lumiverse-council-add-list",children:0===l.length?(0,Ee.jsx)("div",{className:"lumiverse-council-add-empty",children:o?"No matching packs found":"All Lumias from all packs are already in the council"}):l.map(e=>(0,Ee.jsx)(Xy,{pack:e,onSelect:c},e.packName))})]})}function Jy(){var e,n,t;const[r,i]=(0,Ce.useState)(!1),o=Xe(),a=(0,Ce.useSyncExternalStore)(_y.subscribe,Vy,Vy),s=a.llm||{},l=a.mode||"sidecar",c=null!==(e=a.sidecarContextWindow)&&void 0!==e?e:25,u=(0,Ce.useMemo)(()=>(0,W.m5)(),[]),d=(0,Ce.useCallback)(e=>{o.updateCouncilToolsLLM(e),qe()},[o]),m=(0,Ce.useCallback)(e=>{o.setCouncilToolsMode(e),qe()},[o]),p=(0,Ce.useCallback)(e=>{const n=parseInt(e,10);!isNaN(n)&&n>=5&&n<=100&&(o.setSidecarContextWindow(n),qe())},[o]),g=By[s.provider]||By.custom,h="custom"===s.provider;return(0,Ee.jsxs)("div",{className:"lumiverse-council-llm-config",children:[(0,Ee.jsxs)("div",{className:"lumiverse-council-tools-mode",children:[(0,Ee.jsxs)("div",{className:"lumiverse-council-llm-header",children:[(0,Ee.jsx)(Ty,{size:14,strokeWidth:1.5}),(0,Ee.jsx)("span",{children:"Execution Mode"})]}),(0,Ee.jsxs)("div",{className:"lumiverse-council-mode-selector",children:[(0,Ee.jsxs)("button",{type:"button",className:On("lumiverse-council-mode-option","sidecar"===l&&"lumiverse-council-mode-option--active"),onClick:()=>m("sidecar"),children:[(0,Ee.jsx)(Ay,{size:13,strokeWidth:1.5}),(0,Ee.jsx)("span",{children:"Sidecar"})]}),(0,Ee.jsxs)("button",{type:"button",className:On("lumiverse-council-mode-option","inline"===l&&"lumiverse-council-mode-option--active",!u&&"lumiverse-council-mode-option--disabled"),onClick:()=>u&&m("inline"),title:u?"":"Requires function calling enabled in SillyTavern API settings",children:[(0,Ee.jsx)(Ly,{size:13,strokeWidth:1.5}),(0,Ee.jsx)("span",{children:"Inline"})]})]}),(0,Ee.jsx)("p",{className:"lumiverse-council-mode-desc-text",children:"sidecar"===l?"Dedicated LLM executes tools in parallel before generation. Independent model, no ST function calling required.":"Tools registered with SillyTavern's ToolManager. Main model decides when to invoke tools during generation."}),"inline"===l&&!u&&(0,Ee.jsx)("p",{className:"lumiverse-council-mode-warning",children:"Function calling is not enabled. Enable it in SillyTavern API settings or switch to Sidecar mode."})]}),"sidecar"===l&&(0,Ee.jsxs)("div",{className:"lumiverse-council-llm-field lumiverse-council-context-window-field",children:[(0,Ee.jsx)("label",{className:"lumiverse-council-llm-label",children:"Context Window (messages)"}),(0,Ee.jsx)("input",{type:"number",className:"lumiverse-council-llm-input lumiverse-council-llm-input--num",value:c,onChange:e=>p(e.target.value),min:5,max:100,step:1}),(0,Ee.jsx)("span",{className:"lumiverse-council-llm-hint",children:"Number of recent chat messages to include in council tool context (5-100)"})]}),"sidecar"===l&&(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsxs)("div",{className:"lumiverse-council-llm-header",children:[(0,Ee.jsx)(Ay,{size:14,strokeWidth:1.5}),(0,Ee.jsx)("span",{children:"Tools Model"})]}),(0,Ee.jsxs)("div",{className:"lumiverse-council-llm-field",children:[(0,Ee.jsx)("label",{className:"lumiverse-council-llm-label",children:"Provider"}),(0,Ee.jsx)("select",{className:"lumiverse-council-llm-select",value:s.provider||"anthropic",onChange:e=>d({provider:e.target.value}),children:Object.entries(By).map(e=>{let[n,t]=e;return(0,Ee.jsx)("option",{value:n,children:t.name},n)})}),!h&&(0,Ee.jsx)("span",{className:"lumiverse-council-llm-hint",children:"Uses API key from SillyTavern settings"})]}),(0,Ee.jsxs)("div",{className:"lumiverse-council-llm-field",children:[(0,Ee.jsx)("label",{className:"lumiverse-council-llm-label",children:"Model"}),(0,Ee.jsx)("input",{type:"text",className:"lumiverse-council-llm-input",placeholder:g.placeholder,value:s.model||"",onChange:e=>d({model:e.target.value})})]}),h&&(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsxs)("div",{className:"lumiverse-council-llm-field",children:[(0,Ee.jsx)("label",{className:"lumiverse-council-llm-label",children:"Endpoint"}),(0,Ee.jsx)("input",{type:"text",className:"lumiverse-council-llm-input",placeholder:"https://your-api.com/v1/chat/completions",value:s.endpoint||"",onChange:e=>d({endpoint:e.target.value})})]}),(0,Ee.jsxs)("div",{className:"lumiverse-council-llm-field",children:[(0,Ee.jsx)("label",{className:"lumiverse-council-llm-label",children:"API Key"}),(0,Ee.jsxs)("div",{className:"lumiverse-council-llm-password-row",children:[(0,Ee.jsx)("input",{type:r?"text":"password",className:"lumiverse-council-llm-input",placeholder:"Your API key",value:s.apiKey||"",onChange:e=>d({apiKey:e.target.value})}),(0,Ee.jsx)("button",{className:"lumiverse-council-btn",onClick:()=>i(!r),title:r?"Hide":"Show",type:"button",children:r?(0,Ee.jsx)(Dv,{size:14}):(0,Ee.jsx)(Id,{size:14})})]})]})]}),(0,Ee.jsxs)("div",{className:"lumiverse-council-llm-params",children:[(0,Ee.jsxs)("div",{className:"lumiverse-council-llm-param",children:[(0,Ee.jsx)("label",{className:"lumiverse-council-llm-label",children:"Temp"}),(0,Ee.jsx)("input",{type:"number",className:"lumiverse-council-llm-input lumiverse-council-llm-input--num",value:null!==(n=s.temperature)&&void 0!==n?n:.7,onChange:e=>d({temperature:parseFloat(e.target.value)||0}),min:0,max:2,step:.1})]}),(0,Ee.jsxs)("div",{className:"lumiverse-council-llm-param",children:[(0,Ee.jsx)("label",{className:"lumiverse-council-llm-label",children:"Top-P"}),(0,Ee.jsx)("input",{type:"number",className:"lumiverse-council-llm-input lumiverse-council-llm-input--num",value:null!==(t=s.topP)&&void 0!==t?t:1,onChange:e=>d({topP:parseFloat(e.target.value)||0}),min:0,max:1,step:.05})]}),(0,Ee.jsxs)("div",{className:"lumiverse-council-llm-param",children:[(0,Ee.jsx)("label",{className:"lumiverse-council-llm-label",children:"Max Tokens"}),(0,Ee.jsx)("input",{type:"number",className:"lumiverse-council-llm-input lumiverse-council-llm-input--num",value:s.maxTokens||4096,onChange:e=>d({maxTokens:parseInt(e.target.value,10)||4096}),min:256,max:128e3})]})]})]}),"inline"===l&&(0,Ee.jsx)("div",{className:"lumiverse-council-inline-info",children:(0,Ee.jsx)("p",{children:"Tools use the main model configured in SillyTavern. The model decides when and how to invoke council tools based on their descriptions."})})]})}function ek(){return(0,Ee.jsxs)("div",{className:"lumiverse-council-empty",children:[(0,Ee.jsx)("span",{className:"lumiverse-council-empty-icon",children:(0,Ee.jsx)(Ad,{size:32,strokeWidth:1.5})}),(0,Ee.jsx)("h4",{children:"No Council Members"}),(0,Ee.jsx)("p",{children:"Add Lumias to your council to create a collaborative group of independent characters."})]})}const nk=function(){const e=Xe(),{allPacks:n}=vn(),[t,r]=(0,Ce.useState)(!1),[i,o]=(0,Ce.useState)(!1),a=(0,Ce.useSyncExternalStore)(_y.subscribe,Hy,Hy),s=(0,Ce.useSyncExternalStore)(_y.subscribe,Wy,Wy),l=(0,Ce.useSyncExternalStore)(_y.subscribe,Vy,Vy),c=(0,Ce.useCallback)(n=>{e.addCouncilMember(n),$e()},[e]),u=(0,Ce.useCallback)(n=>{const t=e.addCouncilMembersFromPack(n);$e(),"undefined"!=typeof toastr&&(t>0?toastr.success("Added ".concat(t," Lumia").concat(1!==t?"s":"",' from "').concat(n,'" to the council')):toastr.info("No new Lumias to add from this pack"))},[e]),d=(0,Ce.useCallback)((n,t)=>{e.updateCouncilMember(n,t),qe()},[e]),m=(0,Ce.useCallback)(n=>{e.removeCouncilMember(n),$e()},[e]),p=(0,Ce.useCallback)(n=>{e.setCouncilMode(n),$e()},[e]),g=(0,Ce.useCallback)(n=>{e.setCouncilToolsEnabled(n),$e()},[e]),h=(0,Ce.useMemo)(()=>Array.isArray(n)?n.reduce((e,n)=>Iy(Iy({},e),{},{[n.name||n.packName]:n}),{}):n||{},[n]);return(0,Ee.jsxs)("div",{className:"lumiverse-council-manager",children:[(0,Ee.jsxs)("div",{className:"lumiverse-council-header",children:[(0,Ee.jsxs)("h3",{className:"lumiverse-council-title",children:[(0,Ee.jsx)(Ad,{size:18,strokeWidth:1.5}),"Council of Lumiae"]}),(0,Ee.jsxs)("label",{className:"lumiverse-council-mode-toggle",children:[(0,Ee.jsx)("input",{type:"checkbox",checked:a,onChange:e=>p(e.target.checked)}),(0,Ee.jsx)("span",{className:On("lumiverse-council-mode-switch",a&&"lumiverse-council-mode-switch--on"),children:(0,Ee.jsx)("span",{className:"lumiverse-council-mode-thumb"})}),(0,Ee.jsx)("span",{className:"lumiverse-council-mode-label",children:a?"Active":"Inactive"})]})]}),(0,Ee.jsx)("p",{className:"lumiverse-council-desc",children:"Create a council of independent Lumias that collaborate, each with their own identity, behaviors, and personalities."}),a&&(0,Ee.jsxs)("div",{className:"lumiverse-council-tools-toggle",children:[(0,Ee.jsxs)("label",{className:"lumiverse-council-mode-toggle lumiverse-council-tools-label",children:[(0,Ee.jsx)("input",{type:"checkbox",checked:l.enabled,onChange:e=>g(e.target.checked)}),(0,Ee.jsx)("span",{className:On("lumiverse-council-mode-switch",l.enabled&&"lumiverse-council-mode-switch--on"),children:(0,Ee.jsx)("span",{className:"lumiverse-council-mode-thumb"})}),(0,Ee.jsxs)("span",{className:"lumiverse-council-mode-label",children:[(0,Ee.jsx)(Oy,{size:14})," Council Tools ",l.enabled?"Enabled":"Disabled"]})]}),(0,Ee.jsxs)("p",{className:"lumiverse-council-tools-desc",children:["When enabled, council members with assigned tools contribute suggestions via their chosen execution mode. Use the ","{{lumiaCouncilDeliberation}}"," macro to include their contributions in the prompt."]}),l.enabled&&(0,Ee.jsx)(Jy,{})]}),(0,Ee.jsx)("div",{className:"lumiverse-council-add-section",children:t?(0,Ee.jsx)(Qy,{packs:h,existingMembers:s,onAdd:c,onClose:()=>r(!1)}):i?(0,Ee.jsx)(Zy,{packs:h,existingMembers:s,onAddPack:u,onClose:()=>o(!1)}):(0,Ee.jsxs)("div",{className:"lumiverse-council-add-buttons",children:[(0,Ee.jsxs)("button",{className:"lumiverse-council-add-btn",onClick:()=>a&&r(!0),disabled:!a,title:a?"Add a council member":"Enable Council Mode first",type:"button",children:[(0,Ee.jsx)(dr,{size:16,strokeWidth:2}),(0,Ee.jsx)("span",{children:"Add Member"})]}),(0,Ee.jsxs)("button",{className:"lumiverse-council-add-btn lumiverse-council-add-btn--secondary",onClick:()=>a&&o(!0),disabled:!a,title:a?"Add all Lumias from a pack":"Enable Council Mode first",type:"button",children:[(0,Ee.jsx)(Nn,{size:16,strokeWidth:2}),(0,Ee.jsx)("span",{children:"Quick Add Pack"})]})]})}),(0,Ee.jsx)("div",{className:"lumiverse-council-members",children:0===s.length?(0,Ee.jsx)(ek,{}):s.map(e=>(0,Ee.jsx)(Gy,{member:e,packs:h,onUpdate:d,onRemove:m},e.id))}),s.length>0&&(0,Ee.jsx)("div",{className:"lumiverse-council-help",children:(0,Ee.jsxs)("p",{children:["Council members will each appear with their definition in the ",(0,Ee.jsx)("code",{children:"{{lumiaDef}}"})," macro output. Their behaviors and personalities will be grouped per member."]})})]})},tk=Sn("refresh-ccw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]),rk=Sn("scissors",[["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M8.12 8.12 12 12",key:"1alkpv"}],["path",{d:"M20 4 8.12 15.88",key:"xgtan2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M14.8 14.8 20 20",key:"ptml3r"}]]);function ik(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function ok(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?ik(Object(t),!0).forEach(function(n){ak(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ik(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function ak(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const sk=Ye,lk={},ck={enabled:!1,keepCount:50},uk=()=>sk.getState().summarization||lk,dk=()=>sk.getState().messageTruncation||ck,mk=()=>sk.getState().chatChangeCounter||0,pk="loom_summary",gk={openai:{name:"OpenAI",placeholder:"gpt-4o-mini"},anthropic:{name:"Anthropic",placeholder:"claude-3-haiku-20240307"},google:{name:"Google AI",placeholder:"gemini-1.5-flash"},openrouter:{name:"OpenRouter",placeholder:"openai/gpt-4o-mini"},custom:{name:"Custom",placeholder:"your-model-name"}};function hk(e){let{Icon:n,title:t,children:r,defaultOpen:i=!1,status:o}=e;const[a,s]=(0,Ce.useState)(i);return(0,Ee.jsxs)("div",{className:On("lumiverse-vp-collapsible",a&&"lumiverse-vp-collapsible--open"),children:[(0,Ee.jsxs)("button",{className:"lumiverse-vp-collapsible-header",onClick:()=>s(!a),type:"button",children:[(0,Ee.jsx)("span",{className:On("lumiverse-vp-collapsible-chevron",a&&"lumiverse-vp-collapsible-chevron--open"),children:(0,Ee.jsx)(Tn,{size:14,strokeWidth:2})}),(0,Ee.jsx)("span",{className:"lumiverse-vp-collapsible-icon",children:(0,Ee.jsx)(n,{size:16,strokeWidth:1.5})}),(0,Ee.jsx)("span",{className:"lumiverse-vp-collapsible-title",children:t}),void 0!==o&&(0,Ee.jsx)("span",{className:On("lumiverse-vp-collapsible-status",o&&"lumiverse-vp-collapsible-status--active"),children:o?"Active":"Off"})]}),(0,Ee.jsx)(it,{isOpen:a,className:"lumiverse-vp-collapsible-content",duration:200,children:(0,Ee.jsx)("div",{className:"lumiverse-vp-collapsible-inner",children:r})})]})}function vk(e){let{id:n,checked:t,onChange:r,label:i,hint:o}=e;return(0,Ee.jsxs)("div",{className:"lumiverse-vp-toggle-row",children:[(0,Ee.jsxs)("label",{className:"lumiverse-vp-toggle-label",htmlFor:n,children:[(0,Ee.jsx)("span",{className:"lumiverse-vp-toggle-text",children:i}),o&&(0,Ee.jsx)("span",{className:"lumiverse-vp-toggle-hint",children:o})]}),(0,Ee.jsxs)("div",{className:"lumiverse-vp-toggle-switch-wrapper",children:[(0,Ee.jsx)("input",{type:"checkbox",id:n,className:"lumiverse-vp-toggle-input",checked:t,onChange:e=>r(e.target.checked)}),(0,Ee.jsx)("label",{htmlFor:n,className:"lumiverse-vp-toggle-switch-label",children:(0,Ee.jsx)("div",{className:On("lumiverse-vp-toggle-track",t&&"lumiverse-vp-toggle-track--on"),children:(0,Ee.jsx)("div",{className:"lumiverse-vp-toggle-thumb"})})})]})]})}function fk(e){let{name:n,value:t,checked:r,onChange:i,label:o}=e;return(0,Ee.jsxs)("label",{className:On("lumiverse-vp-radio-option",r&&"lumiverse-vp-radio-option--selected"),children:[(0,Ee.jsx)("input",{type:"radio",name:n,value:t,checked:r,onChange:()=>i(t)}),(0,Ee.jsx)("span",{className:"lumiverse-vp-radio-option-label",children:o})]})}function bk(e){let{id:n,label:t,hint:r,value:i,onChange:o,min:a,max:s,step:l=1}=e;return(0,Ee.jsxs)("div",{className:"lumiverse-vp-field",children:[(0,Ee.jsx)("label",{className:"lumiverse-vp-field-label",htmlFor:n,children:t}),(0,Ee.jsx)("input",{type:"number",id:n,className:"lumiverse-vp-field-input lumiverse-vp-field-input--small",value:i,onChange:e=>o(parseFloat(e.target.value)||0),min:a,max:s,step:l}),r&&(0,Ee.jsx)("span",{className:"lumiverse-vp-field-hint",children:r})]})}function xk(e){let{id:n,label:t,hint:r,value:i,onChange:o,placeholder:a,type:s="text"}=e;return(0,Ee.jsxs)("div",{className:"lumiverse-vp-field",children:[(0,Ee.jsx)("label",{className:"lumiverse-vp-field-label",htmlFor:n,children:t}),(0,Ee.jsx)("input",{type:s,id:n,className:"lumiverse-vp-field-input",value:i,onChange:e=>o(e.target.value),placeholder:a}),r&&(0,Ee.jsx)("span",{className:"lumiverse-vp-field-hint",children:r})]})}function yk(e){let{id:n,label:t,hint:r,value:i,onChange:o,options:a}=e;return(0,Ee.jsxs)("div",{className:"lumiverse-vp-field",children:[(0,Ee.jsx)("label",{className:"lumiverse-vp-field-label",htmlFor:n,children:t}),(0,Ee.jsx)("select",{id:n,className:"lumiverse-vp-field-select",value:i,onChange:e=>o(e.target.value),children:a.map(e=>(0,Ee.jsx)("option",{value:e.value,children:e.label},e.value))}),r&&(0,Ee.jsx)("span",{className:"lumiverse-vp-field-hint",children:r})]})}function kk(e){let{hasContent:n,hasChat:t}=e;return t?n?(0,Ee.jsxs)("div",{className:"lumiverse-vp-summary-status lumiverse-vp-summary-status--exists",children:[(0,Ee.jsx)(zd,{size:16,strokeWidth:2}),(0,Ee.jsx)("span",{children:"Summary exists for this chat"})]}):(0,Ee.jsxs)("div",{className:"lumiverse-vp-summary-status lumiverse-vp-summary-status--empty",children:[(0,Ee.jsx)(ht,{size:16,strokeWidth:2}),(0,Ee.jsx)("span",{children:"No summary yet"})]}):(0,Ee.jsxs)("div",{className:"lumiverse-vp-summary-status lumiverse-vp-summary-status--no-chat",children:[(0,Ee.jsx)(ht,{size:16,strokeWidth:2}),(0,Ee.jsx)("span",{children:"No active chat"})]})}function wk(e){let{Icon:n,label:t,onClick:r,disabled:i,variant:o="secondary",loading:a=!1,iconOnly:s=!1}=e;return(0,Ee.jsxs)(Od.button,{className:On("lumiverse-vp-action-btn","lumiverse-vp-action-btn--".concat(o),i&&"lumiverse-vp-action-btn--disabled",s&&"lumiverse-vp-action-btn--icon-only"),onClick:r,disabled:i||a,whileHover:i?{}:{scale:1.05},whileTap:i?{}:{scale:.95},type:"button",title:t,children:[a?(0,Ee.jsx)("span",{className:"lumiverse-vp-action-btn-spinner"}):(0,Ee.jsx)(n,{size:s?16:14,strokeWidth:2}),!s&&(0,Ee.jsx)("span",{children:t})]})}function jk(){var e,n,t,r;const i=(0,Ce.useSyncExternalStore)(sk.subscribe,uk,uk),o=(0,Ce.useSyncExternalStore)(sk.subscribe,dk,dk),a=i.mode||"disabled",s=i.apiSource||"main",l=i.autoInterval||10,c=i.autoMessageContext||10,u=i.manualMessageContext||10,d=i.secondary||{},m=(0,Ce.useCallback)(e=>{const n=sk.getState().summarization||{};sk.setState({summarization:ok(ok({},n),e)}),qe()},[]),p=(0,Ce.useCallback)(e=>{const n=sk.getState().summarization||{},t=n.secondary||{};sk.setState({summarization:ok(ok({},n),{},{secondary:ok(ok({},t),e)})}),qe()},[]),g=(0,Ce.useCallback)(e=>{const n=sk.getState().messageTruncation||{};sk.setState({messageTruncation:ok(ok({},n),e)}),qe()},[]),h=Object.entries(gk).map(e=>{let[n,t]=e;return{value:n,label:t.name}});return(0,Ee.jsxs)("div",{className:"lumiverse-vp-summary-config",children:[(0,Ee.jsxs)(hk,{Icon:vr,title:"Summarization Mode",status:"disabled"!==a,defaultOpen:!0,children:[(0,Ee.jsxs)("div",{className:"lumiverse-vp-radio-group",children:[(0,Ee.jsx)(fk,{name:"sum-mode",value:"disabled",checked:"disabled"===a,onChange:e=>m({mode:e}),label:"Disabled"}),(0,Ee.jsx)(fk,{name:"sum-mode",value:"auto",checked:"auto"===a,onChange:e=>m({mode:e}),label:"Automatic"}),(0,Ee.jsx)(fk,{name:"sum-mode",value:"manual",checked:"manual"===a,onChange:e=>m({mode:e}),label:"Manual"})]}),(0,Ee.jsxs)("p",{className:"lumiverse-vp-settings-desc",children:["disabled"===a&&"Summarization is turned off.","auto"===a&&"Summaries are generated automatically at set intervals.","manual"===a&&"Use /loom-summarize command to generate summaries."]})]}),(0,Ee.jsx)(it,{isOpen:"auto"===a,duration:200,children:(0,Ee.jsx)(hk,{Icon:vt,title:"Auto Settings",defaultOpen:!0,children:(0,Ee.jsxs)("div",{className:"lumiverse-vp-field-row",children:[(0,Ee.jsx)(bk,{id:"sum-interval",label:"Interval",hint:"Every N messages",value:l,onChange:e=>m({autoInterval:e}),min:1}),(0,Ee.jsx)(bk,{id:"sum-auto-context",label:"Context",hint:"Messages to include",value:c,onChange:e=>m({autoMessageContext:e}),min:1,max:100})]})})}),(0,Ee.jsx)(it,{isOpen:"manual"===a||"auto"===a,duration:200,children:(0,Ee.jsx)(hk,{Icon:zv,title:"Manual Context",defaultOpen:"manual"===a,children:(0,Ee.jsx)(bk,{id:"sum-manual-context",label:"Messages to include",hint:"When using /loom-summarize command",value:u,onChange:e=>m({manualMessageContext:e}),min:1,max:100})})}),(0,Ee.jsx)(it,{isOpen:"disabled"!==a,duration:200,children:(0,Ee.jsx)(hk,{Icon:lt,title:"API Source",defaultOpen:!1,children:(0,Ee.jsxs)("div",{className:"lumiverse-vp-radio-group lumiverse-vp-radio-group--wide",children:[(0,Ee.jsx)(fk,{name:"sum-source",value:"main",checked:"main"===s,onChange:e=>m({apiSource:e}),label:"Main API"}),(0,Ee.jsx)(fk,{name:"sum-source",value:"secondary",checked:"secondary"===s,onChange:e=>m({apiSource:e}),label:"Secondary LLM"})]})})}),(0,Ee.jsx)(it,{isOpen:"disabled"!==a&&"secondary"===s,duration:200,children:(0,Ee.jsxs)(hk,{Icon:Ay,title:"Secondary LLM",defaultOpen:!0,children:[(0,Ee.jsx)(yk,{id:"sum-provider",label:"Provider",value:d.provider||"openai",onChange:e=>p({provider:e}),options:h,hint:"custom"!==d.provider?"Uses API key from SillyTavern settings":void 0}),(0,Ee.jsx)(xk,{id:"sum-model",label:"Model",value:d.model||"",onChange:e=>p({model:e}),placeholder:null===(e=gk[d.provider||"openai"])||void 0===e?void 0:e.placeholder}),(0,Ee.jsxs)(it,{isOpen:"custom"===d.provider,duration:200,children:[(0,Ee.jsx)(xk,{id:"sum-endpoint",label:"Endpoint URL",value:d.endpoint||"",onChange:e=>p({endpoint:e}),placeholder:"https://your-api.com/v1/chat/completions"}),(0,Ee.jsx)(xk,{id:"sum-apikey",label:"API Key",type:"password",value:d.apiKey||"",onChange:e=>p({apiKey:e}),placeholder:"Your API key"})]}),(0,Ee.jsxs)("div",{className:"lumiverse-vp-field-row lumiverse-vp-field-row--3",children:[(0,Ee.jsx)(bk,{id:"sum-temp",label:"Temp",value:null!==(n=d.temperature)&&void 0!==n?n:.7,onChange:e=>p({temperature:e}),min:0,max:2,step:.1}),(0,Ee.jsx)(bk,{id:"sum-topp",label:"Top-P",value:null!==(t=d.topP)&&void 0!==t?t:1,onChange:e=>p({topP:e}),min:0,max:1,step:.05}),(0,Ee.jsx)(bk,{id:"sum-maxtokens",label:"Max Tokens",value:d.maxTokens||8192,onChange:e=>p({maxTokens:e}),min:100,max:128e3})]})]})}),(0,Ee.jsx)(it,{isOpen:"disabled"!==a&&("main"===s||"anthropic"===d.provider),duration:200,children:(0,Ee.jsxs)(hk,{Icon:tk,title:"Claude Cache",defaultOpen:!1,children:[(0,Ee.jsx)("p",{className:"lumiverse-vp-settings-desc",children:"If Claude seems to ignore changes to your Lumia definitions, clearing the cache will force fresh responses on the next summarization."}),(0,Ee.jsx)(wk,{Icon:tk,label:"Clear Claude Cache",onClick:()=>{"undefined"!=typeof LumiverseBridge&&LumiverseBridge.clearClaudeCache?(LumiverseBridge.clearClaudeCache(),"undefined"!=typeof toastr&&toastr.success("Claude cache cleared! Next request will use fresh definitions.")):(console.warn("[SummaryEditor] clearClaudeCache not available"),"undefined"!=typeof toastr&&toastr.error("Cache clear function not available"))},variant:"secondary"})]})}),(0,Ee.jsxs)(hk,{Icon:rk,title:"Message Limit",status:o.enabled,children:[(0,Ee.jsx)(vk,{id:"trunc-toggle",checked:o.enabled,onChange:e=>g({enabled:e}),label:"Limit Context Messages",hint:"Only send the last N messages to the AI"}),(0,Ee.jsxs)(it,{isOpen:o.enabled,duration:200,children:[(0,Ee.jsx)(bk,{id:"trunc-count",label:"Messages to keep",hint:"Number of recent messages to include",value:null!==(r=o.keepCount)&&void 0!==r?r:50,onChange:e=>g({keepCount:e}),min:5,max:500}),(0,Ee.jsxs)("div",{className:"lumiverse-vp-warning-box",children:[(0,Ee.jsx)(ht,{size:14,strokeWidth:2}),(0,Ee.jsx)("span",{children:"Older messages will be excluded. Consider using summarization to preserve memories."})]})]})]})]})}function Ck(){const[e,n]=(0,Ce.useState)(""),[t,r]=(0,Ce.useState)(""),[i,o]=(0,Ce.useState)(!1),[a,s]=(0,Ce.useState)(!1),[l,c]=(0,Ce.useState)(!1),u=(0,Ce.useRef)(null),d=(0,Ce.useSyncExternalStore)(sk.subscribe,mk,()=>0),m=e!==t,p=(e.trim().length,(0,Ce.useCallback)(()=>{try{if("undefined"!=typeof SillyTavern){const e=SillyTavern.getContext(),t=(null==e?void 0:e.chat)&&e.chat.length>0;if(o(t),t&&e.chatMetadata){const t=e.chatMetadata[pk]||"";n(t),r(t)}else n(""),r("")}else o(!0),n(""),r("")}catch(e){console.warn("[SummaryEditor] Error loading summary:",e)}},[]));(0,Ce.useEffect)(()=>{p()},[d]);const g=(0,Ce.useCallback)(e=>{n(e.target.value)},[]),h=(0,Ce.useCallback)(()=>{try{if("undefined"!=typeof SillyTavern){var n;const t=SillyTavern.getContext();t.chatMetadata||(t.chatMetadata={});const i=e.trim();i?t.chatMetadata[pk]=i:delete t.chatMetadata[pk],null===(n=t.saveMetadata)||void 0===n||n.call(t),"undefined"!=typeof LumiverseBridge&&LumiverseBridge.updateSummaryButtonState&&LumiverseBridge.updateSummaryButtonState(),r(i),s(!0),setTimeout(()=>s(!1),1500)}}catch(e){console.error("[SummaryEditor] Error saving summary:",e)}},[e]),v=(0,Ce.useCallback)(()=>{if(confirm("Are you sure you want to clear the summary?")){n("");try{if("undefined"!=typeof SillyTavern){const n=SillyTavern.getContext();var e;if(n.chatMetadata)delete n.chatMetadata[pk],null===(e=n.saveMetadata)||void 0===e||e.call(n),"undefined"!=typeof LumiverseBridge&&LumiverseBridge.updateSummaryButtonState&&LumiverseBridge.updateSummaryButtonState()}r("")}catch(e){console.error("[SummaryEditor] Error clearing summary:",e)}}},[]),f=(0,Ce.useCallback)(()=>{p()},[p]),b=(0,Ce.useCallback)(async()=>{if(i&&!l){c(!0);try{if(void 0===window.LumiverseBridge)return console.error("[SummaryEditor] LumiverseBridge not available"),void("undefined"!=typeof toastr&&toastr.error("Summary bridge not available. Try refreshing the page."));if("function"!=typeof window.LumiverseBridge.getCallbacks)return console.error("[SummaryEditor] getCallbacks is not a function"),void("undefined"!=typeof toastr&&toastr.error("Summary callbacks not configured."));const e=window.LumiverseBridge.getCallbacks();if(!e.generateSummary)return console.error("[SummaryEditor] generateSummary callback not registered"),void("undefined"!=typeof toastr&&toastr.error("Summary generation not configured."));console.log("[SummaryEditor] Calling generateSummary callback...");const t=await e.generateSummary();console.log("[SummaryEditor] generateSummary returned:",t?"success":"no result"),t?(n(t),r(t),"undefined"!=typeof toastr&&toastr.success("Summary generated successfully!")):"undefined"!=typeof toastr&&toastr.warning("No summary was generated. Check your settings.")}catch(e){console.error("[SummaryEditor] Error generating summary:",e),"undefined"!=typeof toastr&&toastr.error("Summary generation failed: ".concat(e.message||"Unknown error"))}finally{c(!1)}}},[i,l]);return(0,Ee.jsxs)(hk,{Icon:zv,title:"Summary Text",defaultOpen:!0,children:[(0,Ee.jsx)(kk,{hasContent:t.length>0,hasChat:i}),(0,Ee.jsx)("div",{className:"lumiverse-vp-summary-textarea-wrapper",children:(0,Ee.jsx)("textarea",{ref:u,className:"lumiverse-vp-summary-textarea",value:e,onChange:g,placeholder:"Write or paste your Loom summary here...\n\nUse the structured format:\n**Completed Objectives**\n- ...\n\n**Focused Objectives**\n- ...\n\n**Foreshadowing Beats**\n- ...\n\n**Character States**\n- ...\n\n**World State**\n- ...\n\n**Tone & Atmosphere**\n- ...\n\n**Threads to Weave**\n- ...",disabled:!i})}),(0,Ee.jsxs)("div",{className:"lumiverse-vp-summary-actions",children:[(0,Ee.jsx)(wk,{Icon:of,label:l?"Generating...":"Generate",onClick:b,disabled:!i,loading:l,variant:"primary",iconOnly:!0}),(0,Ee.jsx)(wk,{Icon:pt,label:"Refresh",onClick:f,disabled:!i,iconOnly:!0}),(0,Ee.jsx)(wk,{Icon:Pn,label:"Clear",onClick:v,disabled:!i||!t,variant:"danger",iconOnly:!0}),(0,Ee.jsx)(wk,{Icon:a?zd:Tv,label:a?"Saved!":"Save",onClick:h,disabled:!i||!m,variant:"primary",iconOnly:!0})]}),(0,Ee.jsx)(Rr,{children:m&&(0,Ee.jsx)(Od.div,{className:"lumiverse-vp-summary-unsaved",initial:{opacity:0,y:5},animate:{opacity:1,y:0},exit:{opacity:0,y:5},children:(0,Ee.jsx)("span",{children:"You have unsaved changes"})})})]})}const Sk=function(){return(0,Ee.jsxs)("div",{className:"lumiverse-vp-summary-editor",children:[(0,Ee.jsx)(Ck,{}),(0,Ee.jsx)(jk,{})]})},Nk=Ye,Ek={side:"right",verticalPosition:15,tabSize:"large"};const Pk=function(){const[e,n]=(0,Ce.useState)(!1),t=(0,Ce.useSyncExternalStore)(Nk.subscribe,()=>{var e;return null===(e=Nk.getState().showLumiverseDrawer)||void 0===e||e},()=>{var e;return null===(e=Nk.getState().showLumiverseDrawer)||void 0===e||e}),r=(0,Ce.useSyncExternalStore)(Nk.subscribe,()=>{var e;return null!==(e=Nk.getState().drawerSettings)&&void 0!==e?e:Ek},()=>{var e;return null!==(e=Nk.getState().drawerSettings)&&void 0!==e?e:Ek}),i=(0,Ce.useCallback)(()=>{n(e=>!e)},[]),o=(0,Ce.useCallback)(()=>{n(!1)},[]);return t?(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsx)(Qb,{isVisible:e,onToggle:i,onClose:o,defaultTab:"profile",drawerSettings:r,ProfileContent:gx,PresetsContent:Cx,BrowserContent:Jx,OOCContent:uy,PromptContent:My,CouncilContent:nk,SummaryContent:Sk}),(0,Ee.jsx)(fb,{}),(0,Ee.jsx)(Mb,{})]}):null};const Dk=Sn("compass",[["path",{d:"m16.24 7.76-1.804 5.411a2 2 0 0 1-1.265 1.265L7.76 16.24l1.804-5.411a2 2 0 0 1 1.265-1.265z",key:"9ktpf1"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),Mk=Sn("message-square-plus",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}],["path",{d:"M12 8v6",key:"1ib9pf"}],["path",{d:"M9 11h6",key:"1fldmi"}]]);var Ok=t(98);function Tk(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function Ak(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Tk(Object(t),!0).forEach(function(n){Lk(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Tk(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Lk(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const zk=()=>{var e;return null!==(e=Ye.getState().landingPageChatsDisplayed)&&void 0!==e?e:12};function Ik(e){if(!e)return"Unknown";const n=new Date(e),t=new Date-n,r=Math.floor(t/1e3),i=Math.floor(r/60),o=Math.floor(i/60),a=Math.floor(o/24);return r<60?"Just now":i<60?"".concat(i,"m ago"):o<24?"".concat(o,"h ago"):a<7?"".concat(a,"d ago"):n.toLocaleDateString(void 0,{month:"short",day:"numeric"})}async function Rk(e){if(!e)return"/img/fa-solid-user.svg";const n="string"==typeof e?e:e.avatar;if("object"==typeof e&&(e.members||e.is_group))return e.avatar_url||"/img/fa-solid-groups.svg";if(n){try{const{getThumbnailUrl:e}=await import("../../../../../script.js");if(e)return e("avatar",n)}catch(e){console.warn("[Lumiverse] Failed to import getThumbnailUrl, using fallback:",e)}return"/characters/".concat(encodeURIComponent(n))}return"/img/fa-solid-user.svg"}const Bk=Ce.memo(e=>{let{members:n,groupName:t}=e;const[r,i]=(0,Ce.useState)([]),[o,a]=(0,Ce.useState)(0),s=(n||[]).length,l=s>=5?3:4,c=(n||[]).slice(0,l),u=s>l?s-l:0;(0,Ce.useEffect)(()=>{let e=!1;return a(0),Promise.all(c.map(e=>Rk(e))).then(n=>{e||i(n)}),()=>{e=!0}},[n]);const d=(0,Ce.useCallback)(()=>{a(e=>e+1)},[]),m=o>=c.length;return(0,Ee.jsxs)("div",{className:"lumiverse-lp-group-stack",children:[!m&&(0,Ee.jsx)("div",{className:"lumiverse-lp-group-stack-loading",children:(0,Ee.jsx)(gt,{className:"lumiverse-lp-spin",size:24})}),(0,Ee.jsxs)("div",{className:"lumiverse-lp-group-stack-avatars","data-count":s>=5?"5+":String(s),style:{opacity:m?1:0},children:[r.map((e,n)=>(0,Ee.jsx)(Od.div,{className:"lumiverse-lp-group-avatar-wrapper",style:{"--stack-index":n,"--stack-total":c.length,zIndex:l-n},initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{delay:.05*n,type:"spring",stiffness:400,damping:25},children:(0,Ee.jsx)("img",{src:e,alt:"Group member ".concat(n+1),className:"lumiverse-lp-group-avatar-img",draggable:!1,onLoad:d,onError:e=>{e.target.src="/img/fa-solid-user.svg",d()}})},"".concat(c[n],"-").concat(n))),u>0&&(0,Ee.jsx)("div",{className:"lumiverse-lp-group-avatar-overflow",style:{"--stack-index":l,zIndex:0},children:(0,Ee.jsxs)("span",{children:["+",u]})})]})]})}),_k={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.05,delayChildren:.1}},exit:{opacity:0}},Fk={hidden:{opacity:0,y:20,scale:.95},visible:{opacity:1,y:0,scale:1,transition:{default:{type:"spring",stiffness:300,damping:24},opacity:{duration:.3,ease:"easeOut"}}}},Uk=Ce.memo(e=>{var n;let{item:t,presetName:r,onClick:i,onDelete:o,index:a}=e;const s="group"===t._type||t.is_group||Array.isArray(t.members)&&t.members.length>0,[l,c]=(0,Ce.useState)("/img/fa-solid-user.svg"),[u,d]=(0,Ce.useState)(!1),[m,p]=(0,Ce.useState)(!1),[g,h]=(0,Ce.useState)(!1),v=(0,Ce.useRef)(null),f=function(){!kd.current&&wd();const[e]=(0,Ce.useState)(yd.current);return e}();(0,Ce.useEffect)(()=>()=>{v.current&&clearTimeout(v.current)},[]);const b=(0,Ce.useCallback)(e=>{e.stopPropagation(),g?(v.current&&clearTimeout(v.current),h(!1),null==o||o(t)):(h(!0),v.current=setTimeout(()=>{h(!1)},3e3))},[g,t,o]),x=(0,Ce.useCallback)(()=>{d(!1),g&&(v.current&&clearTimeout(v.current),h(!1))},[g]),y=t.avatar||t.avatar_url,k=!(!t.members&&!t.is_group);return(0,Ce.useEffect)(()=>{let e=!1;return p(!1),Rk(t).then(n=>{e||c(n)}),()=>{e=!0}},[y,k]),(0,Ee.jsxs)(Od.div,{className:"lumiverse-lp-card",onClick:i,onMouseEnter:()=>d(!0),onMouseLeave:x,variants:Fk,whileHover:f?{}:{y:-8,scale:1.02,transition:{duration:.2}},whileTap:f?{}:{scale:.98},layout:!1,style:{willChange:"transform, opacity"},children:[!f&&(0,Ee.jsx)(Od.div,{className:"lumiverse-lp-card-shimmer",animate:{opacity:u?1:0},transition:{duration:.3}}),o&&(u||g)&&(0,Ee.jsx)("button",{className:"lumiverse-lp-card-delete-btn ".concat(g?"lumiverse-lp-card-delete-btn--confirming":""),onClick:b,title:g?"Click again to confirm deletion":"Delete this chat",type:"button",style:{position:"absolute",top:10,right:10,zIndex:20},children:g?(0,Ee.jsx)(mt,{size:16,strokeWidth:2.5}):(0,Ee.jsx)(Pn,{size:16,strokeWidth:2})}),(0,Ee.jsxs)("div",{className:"lumiverse-lp-card-image-container ".concat(s?"lumiverse-lp-card-image-group":""),children:[(0,Ee.jsx)("div",{className:"lumiverse-lp-card-glow"}),s?(0,Ee.jsx)(Bk,{members:t.members,groupName:t.name}):(0,Ee.jsxs)(Ee.Fragment,{children:[!m&&(0,Ee.jsx)("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",zIndex:1},children:(0,Ee.jsx)(gt,{className:"lumiverse-lp-spin",size:24,color:"rgba(255,255,255,0.5)"})}),(0,Ee.jsx)(Od.img,{src:l,alt:t.name,className:"lumiverse-lp-card-avatar",draggable:!1,initial:{opacity:0},animate:{opacity:m?1:0},transition:{duration:.3},onLoad:()=>p(!0),style:{width:"75%",height:"75%",maxWidth:"100%",maxHeight:"100%",objectFit:"cover",borderRadius:"50%"},onError:e=>{e.target.src="/img/fa-solid-user.svg",p(!0)}})]}),(0,Ee.jsxs)("div",{className:"lumiverse-lp-card-time-badge",children:[(0,Ee.jsx)(vt,{size:10,strokeWidth:2}),(0,Ee.jsx)("span",{children:Ik(t.date_last_chat)})]})]}),(0,Ee.jsxs)("div",{className:"lumiverse-lp-card-content",children:[(0,Ee.jsx)("h3",{className:"lumiverse-lp-card-name",children:t.name||"Unnamed"}),(0,Ee.jsxs)("div",{className:"lumiverse-lp-card-meta",children:[r&&(0,Ee.jsxs)("span",{className:"lumiverse-lp-card-badge lumiverse-lp-card-badge-preset",children:[(0,Ee.jsx)(Qt,{size:10,strokeWidth:2}),r]}),s&&(0,Ee.jsxs)("span",{className:"lumiverse-lp-card-badge lumiverse-lp-card-badge-group",children:[(0,Ee.jsx)(Ad,{size:10,strokeWidth:2}),(null===(n=t.members)||void 0===n?void 0:n.length)||0," Members"]})]})]}),!f&&(0,Ee.jsx)(Od.div,{className:"lumiverse-lp-card-indicator",initial:{scaleX:0},animate:{scaleX:u?1:0},transition:{duration:.25,ease:[.4,0,.2,1]}})]})});function Hk(){return(0,Ee.jsxs)(Od.div,{className:"lumiverse-lp-empty",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2},children:[(0,Ee.jsx)("div",{className:"lumiverse-lp-empty-icon",children:(0,Ee.jsx)(Dk,{size:64,strokeWidth:1})}),(0,Ee.jsx)("h3",{children:"Begin Your Journey"}),(0,Ee.jsx)("p",{children:"No recent conversations found. Select a character to start a new adventure."})]})}function Wk(){const[e,n]=(0,Ce.useState)(null),[t,r]=(0,Ce.useState)(!1),i=(0,Ok.getLumiverseVersion)(),o=(0,Ok.isPrerelease)(i);(0,Ce.useEffect)(()=>{(0,Ok.getSillyTavernVersion)().then(e=>{e&&n(e)})},[]);const a=(0,Ce.useCallback)(()=>{let n="Lumiverse: v".concat(i);return e&&(n+="\nSillyTavern: v".concat(e.pkgVersion),e.gitBranch&&(n+=" (".concat(e.gitBranch),e.gitRevision&&(n+=" @".concat(e.gitRevision)),n+=")")),n},[i,e]),s=(0,Ce.useCallback)(async()=>{try{await navigator.clipboard.writeText(a()),r(!0),setTimeout(()=>r(!1),1500)}catch(e){console.error("[Lumiverse] Failed to copy version info:",e)}},[a]);return(0,Ee.jsxs)(Od.div,{className:"lumiverse-lp-version-info ".concat(t?"lumiverse-lp-version-info--copied":""),initial:{opacity:0},animate:{opacity:1},transition:{duration:.8,delay:.8},onClick:s,title:"Click to copy version info",role:"button",tabIndex:0,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||s()},children:[(0,Ee.jsxs)("div",{className:"lumiverse-lp-version-row",children:[(0,Ee.jsx)("span",{className:"lumiverse-lp-version-label",children:"Lumiverse"}),(0,Ee.jsxs)("span",{className:"lumiverse-lp-version-value ".concat(o?"lumiverse-lp-version-beta":""),children:["v",i]})]}),e&&(0,Ee.jsxs)("div",{className:"lumiverse-lp-version-row",children:[(0,Ee.jsx)("span",{className:"lumiverse-lp-version-label",children:"SillyTavern"}),(0,Ee.jsxs)("span",{className:"lumiverse-lp-version-value",children:["v",e.pkgVersion,e.gitBranch&&(0,Ee.jsxs)("span",{className:"lumiverse-lp-version-git",children:[e.gitBranch,e.gitRevision&&(0,Ee.jsxs)("span",{className:"lumiverse-lp-version-commit",children:["@",e.gitRevision]})]})]})]}),(0,Ee.jsx)(Rr,{children:t&&(0,Ee.jsx)(Od.div,{className:"lumiverse-lp-version-copied",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{duration:.15},children:"Copied!"})})]})}function Vk(e){let{index:n}=e;return(0,Ee.jsxs)(Od.div,{className:"lumiverse-lp-card lumiverse-lp-skeleton",initial:{opacity:0},animate:{opacity:1},transition:{duration:.2,delay:.05*n},children:[(0,Ee.jsx)("div",{className:"lumiverse-lp-skeleton-image"}),(0,Ee.jsxs)("div",{className:"lumiverse-lp-skeleton-content",children:[(0,Ee.jsx)("div",{className:"lumiverse-lp-skeleton-line lumiverse-lp-skeleton-title"}),(0,Ee.jsx)("div",{className:"lumiverse-lp-skeleton-line lumiverse-lp-skeleton-meta"})]})]})}const qk=function(){const[e,n]=(0,Ce.useState)([]),[r,i]=(0,Ce.useState)(!0),[o,a]=(0,Ce.useState)(null),[s,l]=(0,Ce.useState)({}),[c,u]=(0,Ce.useState)(50),[d,m]=(0,Ce.useState)(!!window.lumiverseAppReady),p=Ce.useRef(Date.now()),[g,h]=(0,Ce.useState)(!1),[v,f]=(0,Ce.useState)(null),b=(0,Ce.useSyncExternalStore)(Ye.subscribe,zk,zk);(0,Ce.useLayoutEffect)(()=>{const e=()=>{u(z())},n=()=>{const e=document.querySelectorAll(".lumiverse-lp-grid-cards");e.length&&e.forEach(e=>{var n;const t=(null===(n=e.parentElement)||void 0===n?void 0:n.clientWidth)||window.innerWidth,r=Math.floor((t+20)/240),i=Math.max(1,r),o=(t-20*(i-1))/i;e.style.setProperty("--lumiverse-card-width","".concat(o-.5,"px"))})};e();const t=()=>{e(),n()};window.addEventListener("resize",t);const r=document.querySelector(".lumiverse-lp-main");let i=null;r&&(i=new ResizeObserver(()=>{n()}),i.observe(r)),setTimeout(n,0),setTimeout(n,100);const o="lumiverse-landing-styles";if(!document.getElementById(o)){const e=document.createElement("style");e.id=o,e.textContent=R,document.head.appendChild(e)}return()=>{window.removeEventListener("resize",t),i&&i.disconnect()}},[]),(0,Ce.useEffect)(()=>{const e=()=>{document.querySelectorAll(".lumiverse-lp-grid-cards").length&&window.dispatchEvent(new Event("resize"))};e(),requestAnimationFrame(e)},[e,r]);const x=(0,Ce.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;console.log("[Lumiverse LP] fetchChats called, retry:",e),0===e&&i(!0),a(null);try{const{characters:t}=await import("../../../../../script.js"),{groups:r}=await import("../../../../group-chats.js");console.log("[Lumiverse LP] imports done - chars:",null==t?void 0:t.length,"groups:",null==r?void 0:r.length,"groups[0]:",null==r?void 0:r[0]);const i=(t||[]).map((e,n)=>Ak(Ak({},e),{},{_type:"character",_index:n,_sortDate:e.date_last_chat||0})),o=(r||[]).map(e=>Ak(Ak({},e),{},{members:e.members,_type:"group",is_group:!0,_sortDate:e.date_last_chat||0})),a=[...i,...o].filter(e=>e._sortDate>0),s=a.filter(e=>"group"===e._type);console.log("[Lumiverse LP] allItems:",a.length,"groups in allItems:",s.length,"chatsDisplayed:",b),s.length>0&&console.log("[Lumiverse LP] group _sortDate:",s[0]._sortDate,"top 3 char dates:",a.filter(e=>"character"===e._type).slice(0,3).map(e=>({name:e.name,date:e._sortDate})));const l=a.sort((e,n)=>n._sortDate-e._sortDate).slice(0,b),c=l.filter(e=>"group"===e._type);if(console.log("[Lumiverse LP] sortedItems:",l.length,"groups in sorted:",c.length),0===l.length&&Date.now()-p.current<4e3&&e<8)return console.log("[Lumiverse Landing] No items found, retrying (".concat(e+1,"/8)...")),void setTimeout(()=>x(e+1),500);n(l)}catch(e){console.error("[Lumiverse] Error fetching chats:",e),a(e.message)}finally{i(!1)}},[b]),y=(0,Ce.useCallback)(async()=>{try{const{getCachedIndex:e}=await Promise.resolve().then(t.bind(t,699)),n=e();null!=n&&n.presetBindings&&l(n.presetBindings)}catch(e){console.warn("[Lumiverse] Could not fetch preset bindings:",e)}},[]);(0,Ce.useEffect)(()=>{x(),y();const e=()=>{console.log("[Lumiverse Landing] External refresh triggered"),m(!0),x()};window.addEventListener("lumiverse:landing-refresh",e);const n=setTimeout(()=>{window.lumiverseAppReady||(console.warn("[Lumiverse Landing] Force-enabling ready state (timeout)"),m(!0))},4e3),t=document.querySelector("#sheld");return t&&(t.style.opacity="0",t.style.pointerEvents="none"),()=>{clearTimeout(n),window.removeEventListener("lumiverse:landing-refresh",e);const t=document.querySelector("#sheld");t&&(t.style.opacity="",t.style.pointerEvents="")}},[x,y]);const k=(0,Ce.useCallback)(e=>{if(!e||!s)return null;const n=s[e];return(null==n?void 0:n.presetName)||null},[s]),w=(0,Ce.useCallback)(async e=>{try{if("group"===e._type||e.members){const{openGroupById:n}=await import("../../../../group-chats.js");n&&e.id&&await n(e.id)}else{const{selectCharacterById:n}=await import("../../../../../script.js");n&&void 0!==e._index&&await n(String(e._index))}}catch(e){var n;console.error("[Lumiverse] Error opening chat:",e),null===(n=toastr)||void 0===n||n.error("Failed to open chat")}},[]),j=(0,Ce.useCallback)(e=>{f(e),h(!0)},[]),C=(0,Ce.useCallback)(()=>{h(!1),f(null)},[]),S=(0,Ce.useCallback)(async()=>{const e=v;if(e){h(!1),f(null);try{if("group"===e._type||e.members){var n;const{deleteGroupChatByName:i,groups:o}=await import("../../../../group-chats.js"),a=o.find(n=>n.id===e.id);var t;if(!a)return void(null===(t=toastr)||void 0===t||t.error("Group not found"));const s=a.chat_id||a.chats&&a.chats[a.chats.length-1];var r;if(!s)return void(null===(r=toastr)||void 0===r||r.error("No chat file found for this group"));await i(e.id,s),null===(n=toastr)||void 0===n||n.success("Chat deleted successfully")}else{var i;const{characters:n,deleteCharacterChatByName:t}=await import("../../../../../script.js"),r=void 0!==e._index?e._index:n.findIndex(n=>n.avatar===e.avatar);var o;if(-1===r)return void(null===(o=toastr)||void 0===o||o.error("Character not found"));const s=n[r],l=null==s?void 0:s.chat;var a;if(!l)return void(null===(a=toastr)||void 0===a||a.error("No chat file found for this character"));await t(String(r),l),null===(i=toastr)||void 0===i||i.success("Chat deleted successfully")}x()}catch(e){var s;console.error("[Lumiverse] Error deleting chat:",e),null===(s=toastr)||void 0===s||s.error("Failed to delete chat")}}},[v,x]),N=(0,Ce.useCallback)(async()=>{var e;if(!window.lumiverseAppReady)return console.warn("[Lumiverse] Temporary chat blocked: APP_READY has not fired yet"),void(null===(e=toastr)||void 0===e||e.warning("Please wait for the app to finish loading"));try{const{newAssistantChat:e,chat:n}=await import("../../../../../script.js"),{callGenericPopup:t,POPUP_TYPE:r}=await import("../../../../popup.js");if(n&&n.length>0){if(!await t("Start a new temporary chat? Any unsaved conversation will be cleared.",r.CONFIRM))return}await e({temporary:!0})}catch(e){var n;console.error("[Lumiverse] Error starting temporary chat:",e),null===(n=toastr)||void 0===n||n.error("Failed to start temporary chat")}},[]);return(0,Ee.jsxs)("div",{className:"lumiverse-lp-container",style:{paddingTop:"".concat(c,"px"),pointerEvents:"none"},children:[(0,Ee.jsxs)("div",{className:"lumiverse-lp-bg",style:{top:"".concat(c,"px"),pointerEvents:"auto"},children:[(0,Ee.jsx)("div",{className:"lumiverse-lp-bg-glow lumiverse-lp-bg-glow-1"}),(0,Ee.jsx)("div",{className:"lumiverse-lp-bg-glow lumiverse-lp-bg-glow-2"}),(0,Ee.jsx)("div",{className:"lumiverse-lp-bg-glow lumiverse-lp-bg-glow-3"})]}),(0,Ee.jsx)("div",{className:"lumiverse-lp-grid",style:{top:"".concat(c,"px"),pointerEvents:"none"}}),(0,Ee.jsxs)(Od.div,{className:"lumiverse-lp-content",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},style:{pointerEvents:"auto"},children:[(0,Ee.jsxs)(Od.header,{className:"lumiverse-lp-header",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1},children:[(0,Ee.jsx)("div",{className:"lumiverse-lp-header-left",children:(0,Ee.jsxs)("div",{className:"lumiverse-lp-logo",children:[(0,Ee.jsx)("div",{className:"lumiverse-lp-logo-icon",children:(0,Ee.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64",width:"28",height:"28",className:"lumiverse-spool-icon",children:(0,Ee.jsxs)("g",{transform:"rotate(-12, 32, 32)",children:[(0,Ee.jsx)("ellipse",{cx:"32",cy:"12",rx:"18",ry:"6",fill:"#8B5A2B"}),(0,Ee.jsx)("ellipse",{cx:"32",cy:"12",rx:"14",ry:"4",fill:"#A0522D"}),(0,Ee.jsx)("rect",{x:"14",y:"12",width:"36",height:"40",fill:"#8B5FC7"}),(0,Ee.jsx)("line",{x1:"14",y1:"18",x2:"50",y2:"18",stroke:"#7A4EB8",strokeWidth:"1.5"}),(0,Ee.jsx)("line",{x1:"14",y1:"24",x2:"50",y2:"24",stroke:"#7A4EB8",strokeWidth:"1.5"}),(0,Ee.jsx)("line",{x1:"14",y1:"30",x2:"50",y2:"30",stroke:"#7A4EB8",strokeWidth:"1.5"}),(0,Ee.jsx)("line",{x1:"14",y1:"36",x2:"50",y2:"36",stroke:"#7A4EB8",strokeWidth:"1.5"}),(0,Ee.jsx)("line",{x1:"14",y1:"42",x2:"50",y2:"42",stroke:"#7A4EB8",strokeWidth:"1.5"}),(0,Ee.jsx)("line",{x1:"14",y1:"48",x2:"50",y2:"48",stroke:"#7A4EB8",strokeWidth:"1.5"}),(0,Ee.jsx)("rect",{x:"14",y:"12",width:"8",height:"40",fill:"#A78BD4",opacity:"0.5"}),(0,Ee.jsx)("ellipse",{cx:"32",cy:"52",rx:"18",ry:"6",fill:"#8B5A2B"}),(0,Ee.jsx)("rect",{x:"14",y:"48",width:"36",height:"4",fill:"#8B5FC7"}),(0,Ee.jsx)("ellipse",{cx:"32",cy:"52",rx:"14",ry:"4",fill:"#A0522D"}),(0,Ee.jsx)("ellipse",{cx:"32",cy:"52",rx:"5",ry:"2",fill:"#5D3A1A"}),(0,Ee.jsx)("path",{d:"M 48 35 Q 55 38 52 45 Q 49 52 56 58",fill:"none",stroke:"#8B5FC7",strokeWidth:"2",strokeLinecap:"round"})]})})}),(0,Ee.jsxs)("div",{className:"lumiverse-lp-logo-text",children:[(0,Ee.jsx)("h1",{children:"Lumiverse"}),(0,Ee.jsx)("span",{children:"Continue your story"})]})]})}),(0,Ee.jsxs)("div",{className:"lumiverse-lp-header-right",children:[(0,Ee.jsx)(Od.button,{className:"lumiverse-lp-btn lumiverse-lp-btn-temp-chat",onClick:N,disabled:!d,whileHover:{scale:1.05},whileTap:{scale:.95},type:"button",title:d?"Start a temporary chat (scratchpad)":"Waiting for app to initialize...",children:(0,Ee.jsx)(Mk,{size:16,strokeWidth:1.5})}),(0,Ee.jsx)(Od.button,{className:"lumiverse-lp-btn lumiverse-lp-btn-refresh",onClick:x,disabled:r,whileHover:{scale:1.05},whileTap:{scale:.95},type:"button",children:(0,Ee.jsx)(pt,{size:16,strokeWidth:1.5,className:r?"lumiverse-lp-spin":""})})]})]}),(0,Ee.jsx)("main",{className:"lumiverse-lp-main",children:(0,Ee.jsx)(Rr,{mode:"wait",children:r||!d&&0===e.length?(0,Ee.jsx)(Od.div,{className:"lumiverse-lp-grid-cards",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:Array.from({length:8}).map((e,n)=>(0,Ee.jsx)(Vk,{index:n},n))},"loading"):o?(0,Ee.jsxs)(Od.div,{className:"lumiverse-lp-error",initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0},children:[(0,Ee.jsx)("p",{children:"Failed to load chats"}),(0,Ee.jsx)("button",{onClick:x,className:"lumiverse-lp-btn lumiverse-lp-btn-primary",type:"button",children:"Try Again"})]},"error"):0===e.length?(0,Ee.jsx)(Hk,{}):(0,Ee.jsx)(Od.div,{className:"lumiverse-lp-grid-cards",variants:_k,initial:"hidden",animate:"visible",exit:"exit",children:e.map((e,n)=>{var t;return(0,Ee.jsx)(Uk,{item:e,presetName:"character"===e._type?k(e.name):null,onClick:()=>w(e),onDelete:j,index:n},"".concat(e._type,"-").concat(null!==(t=e.id)&&void 0!==t?t:e._index,"-").concat(n))})},"chats")})}),(0,Ee.jsx)(Od.footer,{className:"lumiverse-lp-footer",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.6},children:(0,Ee.jsx)("p",{children:"Select a character to continue your journey"})})]}),(0,Ee.jsx)(Wk,{}),(0,Ee.jsx)(Bd,{isOpen:g,onConfirm:S,onCancel:C,title:"Delete Chat",message:v?(0,Ee.jsxs)(Ee.Fragment,{children:["Are you sure you want to delete the most recent chat with ",(0,Ee.jsxs)("strong",{children:['"',v.name||"this character",'"']}),"?",(0,Ee.jsx)("br",{}),(0,Ee.jsx)("br",{}),(0,Ee.jsx)("span",{style:{fontSize:"12px",opacity:.7},children:"This action cannot be undone."})]}):"Are you sure you want to delete this chat?",variant:"danger",confirmText:"Delete",cancelText:"Cancel"})]})};var $k=t(72),Yk=t.n($k),Gk=t(825),Kk=t.n(Gk),Qk=t(659),Xk=t.n(Qk),Zk=t(56),Jk=t.n(Zk),ew=t(159),nw=t.n(ew),tw=t(113),rw=t.n(tw),iw=t(456),ow={};ow.styleTagTransform=rw(),ow.setAttributes=Jk(),ow.insert=Xk().bind(null,"head"),ow.domAPI=Kk(),ow.insertStyleElement=nw();Yk()(iw.A,ow);iw.A&&iw.A.locals&&iw.A.locals;function aw(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function sw(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?aw(Object(t),!0).forEach(function(n){lw(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):aw(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function lw(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}let cw=null;"undefined"==typeof window||!window.React||window.React===Ce||console.warn('[LumiverseUI] Warning: Multiple React instances detected. This may cause "Invalid hook call" errors (Error #158). The extension bundles its own React to ensure compatibility.');const uw=new Map;let dw=null;function mw(e){const n=uw.get(e);n&&(n.root.unmount(),n.element.remove(),uw.delete(e),console.log("[LumiverseUI] Unmounted ".concat(e)))}const pw={mountSettingsPanel:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"lumiverse-settings-root",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(n&&(dw=n,Ye.syncFromExtension(n)),document.getElementById(e))return console.warn("[LumiverseUI] Settings panel already mounted"),()=>mw(e);const t=document.getElementById("extensions_settings");if(!t)return console.error("[LumiverseUI] Could not find #extensions_settings container"),null;const r=document.createElement("div");r.className="lumia-injector-settings";const i=document.createElement("div");i.className="inline-drawer";const o=document.createElement("div");o.className="inline-drawer-toggle inline-drawer-header",o.innerHTML='\n        <b>Lumiverse Helper</b>\n        <span id="lumiverse-accordion-update-badge" class="lumiverse-accordion-badge" style="display: none;">New!</span>\n        <div class="inline-drawer-icon fa-solid fa-circle-chevron-down down"></div>\n    ',cw=o;const a=document.createElement("div");a.className="inline-drawer-content";const s=document.createElement("div");s.id=e,a.appendChild(s),i.appendChild(o),i.appendChild(a),r.appendChild(i),t.appendChild(r);const l=Se.createRoot(s),c=Ce.Fragment;return l.render((0,Ee.jsx)(c,{children:(0,Ee.jsx)(Ke,{initialSettings:dw,children:(0,Ee.jsx)(zb,{})})})),uw.set(e,{root:l,element:r}),console.log("[LumiverseUI] Settings panel mounted with inline-drawer accordion"),()=>mw(e)},mountViewportPanel:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const n="lumiverse-viewport-root",t=document.getElementById(n);t&&(t.remove(),uw.delete(n)),e&&Ye.syncFromExtension(e);const r=document.createElement("div");r.id=n,r.className="lumiverse-react-root lumiverse-viewport-container",r.style.position="fixed",r.style.top="0",r.style.right="0",r.style.bottom="0",r.style.left="auto",r.style.zIndex="9998",r.style.pointerEvents="none",document.body.appendChild(r);const i=Se.createRoot(r),o=Ce.Fragment;return i.render((0,Ee.jsx)(o,{children:(0,Ee.jsx)(Ke,{initialSettings:e,children:(0,Ee.jsx)(Pk,{})})})),uw.set(n,{root:i,element:r}),console.log("[LumiverseUI] Viewport panel mounted with inline positioning"),()=>mw(n)},mountComponent:function(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=(arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)||"lumiverse-mount-".concat(Date.now());if(uw.has(r))return console.warn("[LumiverseUI] Component ".concat(r," already mounted")),()=>mw(r);const i=document.createElement("div");i.id=r,i.className="lumiverse-react-root",n.appendChild(i);const o=Se.createRoot(i),a=Ce.Fragment;return o.render((0,Ee.jsx)(a,{children:(0,Ee.jsx)(Ke,{children:(0,Ee.jsx)(e,sw({},t))})})),uw.set(r,{root:o,element:i}),()=>mw(r)},renderLandingPage:function(e){const n="lumiverse-landing-root",t=document.getElementById(n);t&&t.remove();const r=document.createElement("div");r.id=n,r.className="lumiverse-react-root",r.style.width="100%",r.style.height="100%",e.appendChild(r);const i=Se.createRoot(r),o=Ce.Fragment;return i.render((0,Ee.jsx)(o,{children:(0,Ee.jsx)(Ke,{children:(0,Ee.jsx)(qk,{})})})),uw.set(n,{root:i,element:r}),console.log("[LumiverseUI] Landing page rendered"),()=>mw(n)},unmount:mw,unmountAll:function(){for(const[e]of uw)mw(e)},syncSettings:function(e){if(e){var n,t;const r=e.packs?Object.keys(e.packs).length:0;console.log("[LumiverseUI] syncSettings called with:",{packsCount:r,customPacksCount:(null===(n=e.customPacks)||void 0===n?void 0:n.length)||0}),Ye.syncFromExtension(e);const i=Ye.getState(),o=i.packs?Object.keys(i.packs).length:0;console.log("[LumiverseUI] After sync, store has:",{packsCount:o,customPacksCount:(null===(t=i.customPacks)||void 0===t?void 0:t.length)||0})}else console.warn("[LumiverseUI] syncSettings called with null/undefined settings")},getState:function(){return Ye.exportForExtension()},subscribe:function(e){return Ye.subscribe(e)},getStore:function(){return Ye},updateAccordionBadge:function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"New!";const t=document.getElementById("lumiverse-accordion-update-badge");t&&(t.style.display=e?"inline-flex":"none",t.textContent=n)},getSTContext:function(){return"undefined"!=typeof SillyTavern?SillyTavern.getContext():(console.warn("[LumiverseUI] SillyTavern context not available"),null)}};console.log("[LumiverseUI] Bundle loaded, API available:",Object.keys(pw)),"undefined"!=typeof window&&(window.LumiverseUI=pw);function gw(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function hw(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?gw(Object(t),!0).forEach(function(n){vw(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):gw(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function vw(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const fw={},bw={};function xw(e){if(!e)return e;let n=e;n=function(e){if(!e)return e;let n,t=e,r=0;do{if(++r>20)break;n=t,t=t.replace(/<div[^>]*style\s*=\s*["'][^"']*display\s*:\s*none[^"']*["'][^>]*>(\s*```[\s\S]*?```\s*)<\/div>/gi,"$1"),t=t.replace(/<div(?:\s[^>]*)?>([\s\S]*?)<\/div>/gi,"")}while(t!==n);return t=t.replace(/<\/div>/gi,""),t}(n);for(const e of Object.keys(fw)){const t=fw[e];t.open.lastIndex=0,t.close.lastIndex=0,n=n.replace(t.open,""),n=n.replace(t.close,"")}return n}function yw(e){if(!e)return e;let n=e;return n=n.replace(/<font(?:\s[^>]*)?>/gi,""),n=n.replace(/<\/font>/gi,""),n}function kw(e){if(!e)return e;let n,t=e,r=0;do{if(++r>20)break;n=t,t=t.replace(/<details(?:\s[^>]*)?>([\s\S]*?)<\/details>/gi,"")}while(t!==n);return t}function ww(e){if(!e)return e;let n=e;for(const e of Object.keys(bw)){const t=bw[e];t.paired.lastIndex=0,t.self.lastIndex=0,n=n.replace(t.paired,""),n=n.replace(t.self,"")}return n}function jw(e){if(!e||"string"!=typeof e)return e;let n=e.replace(/\n{3,}/g,"\n\n");return n=n.replace(/\n[ \t]*\n[ \t]*\n/g,"\n\n"),n}!function(){const e=["span","b","i","u","em","strong","s","strike","sub","sup","mark","small","big"];for(const n of e)fw[n]={open:new RegExp("<".concat(n,"(?:\\s[^>]*)?>"),"gi"),close:new RegExp("</".concat(n,">"),"gi")};const n=["loom_sum","loom_if","loom_else","loom_endif","lumia_ooc","lumiaooc","lumio_ooc","lumioooc","loom_state","loom_memory","loom_context","loom_inject","loom_var","loom_set","loom_get","loom_record","loomrecord","loom_ledger","loomledger"];for(const e of n)bw[e]={paired:new RegExp("<".concat(e,"(?:\\s[^>]*)?>([\\s\\S]*?)</").concat(e,">"),"gi"),self:new RegExp("<".concat(e,"(?:\\s[^>]*)?\\/?>"),"gi")}}(),globalThis.lumiverseHelperGenInterceptor=async function(e,n,t,r){var i,o,a,s,l,c,u,d,m,p,g,h,v,f;console.log("[".concat(B.MODULE_NAME,"] Generation interceptor called with type: ").concat(r));const b=(0,W.zB)();b?console.log("[".concat(B.MODULE_NAME,"] Recursive interceptor call detected — preserving tool results")):((0,W.u0)(),(0,B.resetRandomLumia)(),(0,W.S3)(),(0,V.Tr)());const x="normal"===r||"swipe"===r||!r;if(console.log("[".concat(B.MODULE_NAME,'] Council tools check: type="').concat(r,'", isRecursive=').concat(b,", isNormalOrSwipe=").concat(x,", enabled=").concat((0,W.aU)())),!b&&x&&(0,W.aU)()){const e=(0,W.AM)();if("sidecar"===e)try{console.log("[".concat(B.MODULE_NAME,"] Council tools (sidecar mode) executing - STALLING generation..."));const e=Date.now(),n=await(0,W.ti)(),t=Date.now()-e;console.log("[".concat(B.MODULE_NAME,"] Council tools (sidecar) execution COMPLETE in ").concat(t,"ms - ").concat(n.length," results obtained, resuming generation"))}catch(e){console.error("[".concat(B.MODULE_NAME,"] Council tools (sidecar) execution failed:"),e)}else"inline"===e&&console.log("[".concat(B.MODULE_NAME,"] Council tools (inline mode) — tools registered with ST ToolManager, LLM will invoke during generation"))}const y=(0,B.getSettings)(),k=(null===(i=y.sovereignHand)||void 0===i?void 0:i.enabled)||!1,w=y.contextFilters||{},j=y.messageTruncation||{};if(j.enabled&&j.keepCount>0){const n=j.keepCount;if(e.length>n){const t=e.length-n;e.splice(0,t),console.log("[".concat(B.MODULE_NAME,"] Message Truncation: Removed ").concat(t," older messages, keeping last ").concat(n))}}const C=!1!==(null===(o=y.sovereignHand)||void 0===o?void 0:o.excludeLastMessage);if(k){let n=-1;for(let t=e.length-1;t>=0;t--)if(e[t]&&e[t].is_user){n=t;break}if(-1!==n){const t=e[n],r=t.mes||t.content||"";(0,q.a4)(r),(0,q.l5)(!0),console.log("[".concat(B.MODULE_NAME,"] Sovereign Hand: Captured last user message at index ").concat(n)),C&&(e.splice(n,1),console.log("[".concat(B.MODULE_NAME,"] Sovereign Hand: Removed last user message from context array")))}else(0,q.a4)(""),(0,q.l5)(!1),console.log("[".concat(B.MODULE_NAME,"] Sovereign Hand: No user message found (continuation mode)"))}else(0,q.a4)(""),(0,q.l5)(!1);const S=null!==(a=null===(s=w.htmlTags)||void 0===s?void 0:s.keepDepth)&&void 0!==a?a:3,N=null!==(l=null===(c=w.detailsBlocks)||void 0===c?void 0:c.keepDepth)&&void 0!==l?l:3,E=null!==(u=null===(d=w.loomItems)||void 0===d?void 0:d.keepDepth)&&void 0!==u?u:5,P=null!==(m=null===(p=w.htmlTags)||void 0===p?void 0:p.fontKeepDepth)&&void 0!==m?m:3,D=(null===(g=w.htmlTags)||void 0===g?void 0:g.enabled)||!1,M=(null===(h=w.htmlTags)||void 0===h?void 0:h.stripFonts)||!1,O=(null===(v=w.detailsBlocks)||void 0===v?void 0:v.enabled)||!1,T=(null===(f=w.loomItems)||void 0===f?void 0:f.enabled)||!1,A=D||M||O||T;for(let n=0;n<e.length;n++){const t=e.length-1-n,r=e=>{if(!e||"string"!=typeof e)return e;let n=e;return D&&t>=S&&(n=xw(n)),D&&M&&t>=P&&(n=yw(n)),O&&t>=N&&(n=kw(n)),T&&t>=E&&(n=ww(n)),n};e[n]&&"string"==typeof e[n].content&&(e[n].content=(0,q.US)(e[n].content),A&&(e[n].content=r(e[n].content)),e[n].content=jw(e[n].content)),e[n]&&"string"==typeof e[n].mes&&(e[n].mes=(0,q.US)(e[n].mes),A&&(e[n].mes=r(e[n].mes)),e[n].mes=jw(e[n].mes))}return{chat:e,contextSize:n,abort:t}},jQuery(async()=>{console.log("[".concat(B.MODULE_NAME,"] jQuery initialization starting...")),console.log("[".concat(B.MODULE_NAME,"] window.LumiverseUI available:"),!!window.LumiverseUI);const e=(0,r.cj)(),n=(0,r.G1)();e&&n||console.error("[".concat(B.MODULE_NAME,"] ST APIs not available - extension may not work correctly")),(0,B.loadSettings)();try{if(je()){const e=document.querySelector("#sheld");e&&(e.style.opacity="0",e.style.pointerEvents="none")}}catch(e){console.warn("[".concat(B.MODULE_NAME,"] Failed to pre-hide sheld:"),e)}try{await(0,B.initPackFileStorage)()&&console.log("[".concat(B.MODULE_NAME,"] Pack file storage initialized"))}catch(e){console.error("[".concat(B.MODULE_NAME,"] Failed to initialize pack file storage:"),e)}!function(){const e=(0,r.zX)();e?((0,H.bP)(e),(0,q.MN)(e),e.registerMacro("lumiaMessageCount",{handler:()=>{const e=(0,r.SD)();return e&&e.chat?e.chat.length.toString():"0"},description:"Returns the current chat message count.",returns:"Number of messages as a string",returnType:"integer",exampleUsage:["{{lumiaMessageCount}}"]}),e.registerMacro("lumiaOOCTrigger",{handler:()=>(0,H.XN)(),description:"Returns OOC trigger countdown or activation message based on message count and interval setting.",returns:"Countdown text or 'OOC Commentary Time!' activation message",returnType:"string",exampleUsage:["{{lumiaOOCTrigger}}"]}),console.log("[".concat(B.MODULE_NAME,"] Macros registered successfully (Macros 2.0 format)"))):console.warn("[".concat(B.MODULE_NAME,"] MacrosParser not available - macros will not be registered"))}();try{(0,W.at)(),console.log("[".concat(B.MODULE_NAME,"] Council tools registered with ST ToolManager (shouldRegister gate active)"))}catch(e){console.warn("[".concat(B.MODULE_NAME,"] Failed to register ST council tools:"),e)}(0,Y.bw)(),function(){const e=(0,r.cj)(),n=(0,r.G1)();e&&null!=n&&n.CHAT_CHANGED?(e.on(n.CHAT_CHANGED,()=>{console.log("[".concat(te,"] CHAT_CHANGED detected, checking bindings...")),setTimeout(()=>{fe()},500)}),console.log("[".concat(te,"] Preset binding service initialized"))):console.warn("[".concat(te,"] Cannot initialize: ST event system not available"))}(),(0,F.xx)(F.YR),(0,F.Zl)(Y.a),(0,G.Go)(F.YR),(0,K.rq)("showSelectionModal",F.ry),(0,K.rq)("showLoomSelectionModal",F.mR),(0,K.rq)("showMiscFeaturesModal",F.GM),(0,K.rq)("showSummarizationModal",F.Cm),(0,K.rq)("showPromptSettingsModal",F.e2),(0,K.rq)("showLumiaEditorModal",G.un),(0,K.rq)("showLucidCardsModal",F.Dz),(0,K.rq)("fetchWorldBook",()=>{const e=jQuery("#lumia-url-input-react").val()||jQuery("#lumia-url-input").val();(0,_.wn)(e).then(()=>{(0,F.YR)(),(0,K.TC)()})}),(0,K.rq)("handleNewBook",async(e,n)=>{await(0,_.importPack)(e,n,!1),(0,F.YR)(),(0,K.TC)()}),(0,K.rq)("refreshUIDisplay",()=>{(0,F.YR)(),(0,K.TC)()}),(0,K.rq)("refreshOOCComments",function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e?(0,Y.v4)():(0,Y.a)(e)}),(0,K.rq)("generateSummary",async()=>await(0,U.Zq)(null,!0,!0)),console.log("[".concat(B.MODULE_NAME,"] About to initialize React UI..."));const i=document.getElementById("extensions_settings");if(console.log("[".concat(B.MODULE_NAME,"] extensions_settings container:"),i),i){await(0,K.A5)(i)?console.log("[".concat(B.MODULE_NAME,"] React UI initialized successfully")):console.error("[".concat(B.MODULE_NAME,"] React UI failed to initialize - check console for errors"))}(0,F.YR)(),jQuery("#lumia-fetch-btn").on("click",()=>{const e=jQuery("#lumia-url-input").val();(0,_.wn)(e).then(()=>{(0,F.YR)(),(0,K.TC)()})}),jQuery("#lumia-open-definitions-btn").on("click",()=>(0,F.ry)("definition")),jQuery("#lumia-open-behaviors-btn").on("click",()=>(0,F.ry)("behavior")),jQuery("#lumia-open-personalities-btn").on("click",()=>(0,F.ry)("personality")),jQuery("#lumia-open-misc-btn").on("click",()=>(0,F.GM)()),jQuery("#lumia-open-summarization-btn").on("click",()=>(0,F.Cm)()),jQuery("#lumia-open-prompt-settings-btn").on("click",()=>(0,F.e2)()),jQuery("#loom-open-style-btn").on("click",()=>(0,F.mR)("Narrative Style")),jQuery("#loom-open-utils-btn").on("click",()=>(0,F.mR)("Loom Utilities")),jQuery("#loom-open-retrofits-btn").on("click",()=>(0,F.mR)("Retrofits")),jQuery("#lumia-browse-lucid-btn").on("click",()=>(0,F.Dz)()),jQuery("#lumia-create-lumia-btn").on("click",()=>(0,G.un)()),jQuery("#lumia-upload-btn").on("click",()=>jQuery("#lumia-file-input").trigger("click")),jQuery("#lumia-file-input").on("change",e=>{const n=e.target.files[0];if(!n)return;const t=new FileReader;t.onload=e=>{try{const t=JSON.parse(e.target.result);(0,_.importPack)(t,n.name,!1),(0,F.YR)(),(0,K.TC)()}catch(e){console.error("Lumia Injector Error:",e),toastr.error("Failed to parse: "+e.message)}},t.readAsText(n),e.target.value=""}),e&&n&&(e.on(n.CHARACTER_MESSAGE_RENDERED,e=>{console.log("[".concat(B.MODULE_NAME,"] CHARACTER_MESSAGE_RENDERED event for mesId ").concat(e)),(0,Y.fk)(!1),(0,W.BI)(),(0,q.SE)(),(0,U.tb)();const n=(0,r.SD)();null!=n&&n.chat&&((0,H.UF)(n.chat.length-1),console.log("[".concat(B.MODULE_NAME,"] Tracked last AI message at index ").concat(n.chat.length-1)));const t=a('div[mesid="'.concat(e,'"] .mes_text'));if(t){var i;(0,q.vL)(t),(0,Y.K3)(t);const r=null==n||null===(i=n.chat)||void 0===i?void 0:i[e],o=(null==r?void 0:r.mes)||(null==r?void 0:r.content)||"";/<lumi[ao]_?ooc[^>]*>/i.test(o)&&(console.log("[".concat(B.MODULE_NAME,"] Found OOC tags in raw content, scheduling OOC processing for message ").concat(e)),(0,Y.dN)(e))}}),e.on(n.MESSAGE_EDITED,e=>{console.log("[".concat(B.MODULE_NAME,"] MESSAGE_EDITED event for mesId ").concat(e)),(0,q.a4)(""),(0,q.l5)(!1),(0,Y.sc)(e);const n=a('div[mesid="'.concat(e,'"] .mes_text'));if(n){s("[data-lumia-ooc]",n).forEach(e=>e.remove())}(0,Y.dN)(e,!0)}),e.on(n.MESSAGE_SWIPED,e=>{console.log("[".concat(B.MODULE_NAME,"] MESSAGE_SWIPED event for mesId ").concat(e)),(0,q.a4)(""),(0,q.l5)(!1),(0,Y.sc)(e);const n=a('div[mesid="'.concat(e,'"] .mes_text'));if(n){s("[data-lumia-ooc]",n).forEach(e=>e.remove())}(0,Y.dN)(e,!0),(0,W.BI)(),(0,W.S3)(),(0,V.Tr)(),console.log("[".concat(B.MODULE_NAME,"] Reset generation cycle and cleared tool results for swipe"))}),e.on(n.CHAT_CHANGED,()=>{console.log("[".concat(B.MODULE_NAME,"] CHAT_CHANGED event - resetting state and scheduling OOC reprocessing")),(0,q.a4)(""),(0,q.l5)(!1),(0,Y.E4)(),(0,H.UF)(-1),(0,q.SE)(),(0,Y.Aq)(),requestAnimationFrame(()=>{(0,U.E)(),(0,F.updateLoomSummaryButtonState)()})}),e.on(n.GENERATION_STARTED,()=>{console.log("[".concat(B.MODULE_NAME,"] GENERATION_STARTED - disabling OOC observer processing")),(0,Y.fk)(!0)}),e.on(n.GENERATION_ENDED,()=>{console.log("[".concat(B.MODULE_NAME,"] GENERATION_ENDED (error case) - resetting state")),(0,Y.fk)(!1),(0,W.BI)()}),e.on(n.GENERATION_STOPPED,()=>{console.log("[".concat(B.MODULE_NAME,"] GENERATION_STOPPED (user cancel) - resetting state")),(0,Y.fk)(!1),(0,W.BI)()})),(0,Y.JH)(),console.log("[".concat(B.MODULE_NAME,"] Initial load - scheduling OOC processing")),(0,Y.Aq)();let o=null,l="";function c(){var e;if(console.log("[".concat(B.MODULE_NAME,"] renderCustomLanding called")),!je())return console.log("[".concat(B.MODULE_NAME,"] Landing page disabled, using default welcome screen")),void u();const n=(0,r.SD)(),t=void 0!==(null==n?void 0:n.chatId)&&null!==(null==n?void 0:n.chatId)&&""!==(null==n?void 0:n.chatId),i=void 0===(null==n?void 0:n.characterId)&&(null==n?void 0:n.name2)&&(null==n?void 0:n.name2)===(null==n?void 0:n.neutralCharacterName),a=t||i;if(console.log("[".concat(B.MODULE_NAME,"] Context:"),{chatId:null==n?void 0:n.chatId,characterId:null==n?void 0:n.characterId,groupId:null==n?void 0:n.groupId,name2:null==n?void 0:n.name2,neutralCharacterName:null==n?void 0:n.neutralCharacterName,chatLength:null==n||null===(e=n.chat)||void 0===e?void 0:e.length}),console.log("[".concat(B.MODULE_NAME,"] isChatOpen:"),a,"(hasChatId: ".concat(t,", isTempChat: ").concat(i,")")),a)return console.log("[".concat(B.MODULE_NAME,"] Chat is open, hiding landing page")),u(),void(o&&(o.remove(),o=null,console.log("[".concat(B.MODULE_NAME,"] Landing page removed")),document.body.style.overflow=l||"",l=""));console.log("[".concat(B.MODULE_NAME,"] No chat open, showing landing page")),function(){var e;console.log("[".concat(B.MODULE_NAME,"] showLandingPage called")),l||(l=document.body.style.overflow);document.body.style.overflow="hidden";const n=document.querySelector("#sheld");n?(console.log("[".concat(B.MODULE_NAME,"] Hiding #sheld")),n.style.opacity="0",n.style.pointerEvents="none"):console.warn("[".concat(B.MODULE_NAME,"] #sheld not found!"));if(o)return console.log("[".concat(B.MODULE_NAME,"] Landing page container already exists, triggering refresh")),void window.dispatchEvent(new Event("lumiverse:landing-refresh"));o=document.createElement("div"),o.id="lumiverse-landing-page-container";const t=I();o.style.cssText="\n      position: fixed;\n      inset: 0;\n      width: 100%;\n      height: 100dvh;\n      z-index: ".concat(t,";\n      pointer-events: none;\n    "),document.body.appendChild(o),console.log("[".concat(B.MODULE_NAME,"] Landing page container created and appended to body"),o),null!==(e=window.LumiverseUI)&&void 0!==e&&e.renderLandingPage?(console.log("[".concat(B.MODULE_NAME,"] Calling window.LumiverseUI.renderLandingPage")),window.LumiverseUI.renderLandingPage(o),console.log("[".concat(B.MODULE_NAME,"] Custom landing page rendered (full-screen)"))):(console.warn("[".concat(B.MODULE_NAME,"] window.LumiverseUI.renderLandingPage not found, using fallback")),async function(e){try{const n="lumiverse-landing-styles-fallback";if(!document.getElementById(n)){const e=document.createElement("style");e.id=n,e.textContent=R,document.head.appendChild(e)}const{characters:t,selectCharacterById:r,getThumbnailUrl:i}=await import("../../../../../script.js"),{groups:o,openGroupById:a}=await import("../../../../group-chats.js"),s=[...(t||[]).map((e,n)=>hw(hw({},e),{},{_type:"character",_index:n,_sortDate:e.date_last_chat||0})),...(o||[]).map(e=>hw(hw({},e),{},{_type:"group",_sortDate:e.date_last_chat||0}))].filter(e=>e._sortDate>0).sort((e,n)=>n._sortDate-e._sortDate).slice(0,12),l=e=>{const n=new Date(e),t=new Date-n,r=Math.floor(t/1e3),i=Math.floor(r/60),o=Math.floor(i/60),a=Math.floor(o/24);return r<60?"Just now":i<60?"".concat(i,"m ago"):o<24?"".concat(o,"h ago"):a<7?"".concat(a,"d ago"):n.toLocaleDateString(void 0,{month:"short",day:"numeric"})};let c='\n        <div class="lumiverse-lp-container">\n          \x3c!-- Ambient background effects --\x3e\n          <div class="lumiverse-lp-bg">\n            <div class="lumiverse-lp-bg-glow lumiverse-lp-bg-glow-1"></div>\n            <div class="lumiverse-lp-bg-glow lumiverse-lp-bg-glow-2"></div>\n            <div class="lumiverse-lp-bg-glow lumiverse-lp-bg-glow-3"></div>\n          </div>\n          \x3c!-- Grid pattern overlay --\x3e\n          <div class="lumiverse-lp-grid"></div>\n\n          <div class="lumiverse-lp-content">\n            \x3c!-- Header --\x3e\n            <header class="lumiverse-lp-header">\n              <div class="lumiverse-lp-header-left">\n                <div class="lumiverse-lp-logo">\n                  <div class="lumiverse-lp-logo-icon">\n                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="m7.5 4.27 9 5.15"/><path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"/><path d="m3.3 7 8.7 5 8.7-5"/><path d="M12 22V12"/></svg>\n                  </div>\n                  <div class="lumiverse-lp-logo-text">\n                    <h1>Lumiverse</h1>\n                    <span>Continue your story</span>\n                  </div>\n                </div>\n              </div>\n              <div class="lumiverse-lp-header-right">\n                <button class="lumiverse-lp-btn lumiverse-lp-btn-toggle" id="lumiverse-lp-toggle-sheld" type="button">\n                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>\n                  <span>Show Sheld</span>\n                </button>\n              </div>\n            </header>\n\n            \x3c!-- Main grid --\x3e\n            <main class="lumiverse-lp-main">\n      ';0===s.length?c+='\n          <div class="lumiverse-lp-empty">\n            <div class="lumiverse-lp-empty-icon">\n              <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polygon points="16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76"/></svg>\n            </div>\n            <h3>Begin Your Journey</h3>\n            <p>No recent conversations found. Select a character to start a new adventure.</p>\n          </div>\n        ':(c+='<div class="lumiverse-lp-grid-cards">',s.forEach((e,n)=>{const t="group"===e._type,r=l(e._sortDate);let o;o=t?e.avatar_url||"/img/fa-solid-groups.svg":e.avatar&&i?i("avatar",e.avatar):e.avatar?"/characters/".concat(encodeURIComponent(e.avatar)):"/img/fa-solid-user.svg";const a=t?'<span class="lumiverse-lp-card-badge lumiverse-lp-card-badge-group"><svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg> Group</span>':"";c+='\n            <div class="lumiverse-lp-card" data-type="'.concat(e._type,'" data-id="').concat(t?e.id:e._index,'" style="animation-delay: ').concat(60*n,'ms">\n              <div class="lumiverse-lp-card-shimmer"></div>\n              <div class="lumiverse-lp-card-image-container">\n                <div class="lumiverse-lp-card-glow"></div>\n                ').concat(t?'\n                  <div class="lumiverse-lp-card-avatar-group">\n                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>\n                  </div>\n                ':'\n                  <img src="'.concat(o,'" alt="').concat(e.name,'" class="lumiverse-lp-card-avatar" loading="lazy" onerror="this.src=\'/img/fa-solid-user.svg\'">\n                '),'\n                <div class="lumiverse-lp-card-time-badge">\n                  <svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>\n                  <span>').concat(r,'</span>\n                </div>\n              </div>\n              <div class="lumiverse-lp-card-content">\n                <h3 class="lumiverse-lp-card-name">').concat(e.name||"Unnamed",'</h3>\n                <div class="lumiverse-lp-card-meta">\n                  ').concat(a,'\n                </div>\n              </div>\n              <div class="lumiverse-lp-card-indicator"></div>\n            </div>\n          ')}),c+="</div>"),c+='\n            </main>\n\n            \x3c!-- Footer --\x3e\n            <footer class="lumiverse-lp-footer">\n              <p>Select a character to continue your journey</p>\n            </footer>\n          </div>\n        </div>\n      ',e.innerHTML=c,e.querySelectorAll(".lumiverse-lp-card").forEach(e=>{e.addEventListener("click",async()=>{const n=e.dataset.type,t=e.dataset.id;try{"group"===n?a&&await a(t):r&&await r(String(t))}catch(e){console.error("[".concat(B.MODULE_NAME,"] Error opening chat:"),e)}})});const u=e.querySelector("#lumiverse-lp-toggle-sheld");if(u){let e=!1;u.addEventListener("click",()=>{const n=document.querySelector("#sheld");n&&(e?(n.style.opacity="0",n.style.pointerEvents="none",u.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg><span>Show Sheld</span>'):(n.style.opacity="",n.style.pointerEvents="",u.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg><span>Show Landing</span>'),e=!e)})}console.log("[".concat(B.MODULE_NAME,"] Simple landing page rendered with ").concat(s.length," chats"))}catch(e){console.error("[".concat(B.MODULE_NAME,"] Error rendering simple landing page:"),e)}}(o))}()}function u(){const e=document.querySelector("#sheld");e&&(e.style.opacity="",e.style.pointerEvents="")}e&&n&&(e.on(n.APP_READY,()=>{window.lumiverseAppReady=!0,c()}),e.on(n.CHAT_CHANGED,c),c());const d=(0,r.ej)(),m=(0,r.Dr)();d&&m&&d.addCommandObject(m.fromProps({name:"loom-summarize",callback:async()=>{const e=(0,B.getSettings)().summarization;if(!e||"disabled"===e.mode)return toastr.warning("Summarization is disabled. Enable it in Lumia Injector settings."),"Summarization is disabled.";try{toastr.info("Generating loom summary...");return await(0,U.Zq)(null,!0)?(toastr.success("Loom summary generated and saved!"),"Summary generated successfully."):(toastr.warning("No summary generated. Check if there are messages to summarize."),"No summary generated.")}catch(e){return toastr.error("Summarization failed: ".concat(e.message)),"Error: ".concat(e.message)}},aliases:["loom-sum","summarize"],helpString:"Manually generate a loom summary of the current chat using your configured summarization settings (uses Manual Message Context)."})),window.addEventListener("beforeunload",async()=>{try{const{flushPendingSaves:e}=await Promise.resolve().then(t.bind(t,674));await e()}catch(e){console.warn("[".concat(B.MODULE_NAME,"] Error flushing saves on unload:"),e)}}),console.log("".concat(B.MODULE_NAME," initialized"))})})();
(()=>{"use strict";var e={20(e,n,t){var r=t(540),i=Symbol.for("react.element"),a=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,s=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,n,t){var r,a={},c=null,u=null;for(r in void 0!==t&&(c=""+t),void 0!==n.key&&(c=""+n.key),void 0!==n.ref&&(u=n.ref),n)o.call(n,r)&&!l.hasOwnProperty(r)&&(a[r]=n[r]);if(e&&e.defaultProps)for(r in n=e.defaultProps)void 0===a[r]&&(a[r]=n[r]);return{$$typeof:i,type:e,key:c,ref:u,props:a,_owner:s.current}}n.Fragment=a,n.jsx=c,n.jsxs=c},43(e){e.exports="data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%2712%27 height=%2712%27 viewBox=%270 0 24 24%27 fill=%27none%27 stroke=%27%239370db%27 stroke-width=%272%27 stroke-linecap=%27round%27 stroke-linejoin=%27round%27%3E%3Cpolyline points=%276 9 12 15 18 9%27%3E%3C/polyline%3E%3C/svg%3E"},56(e,n,t){e.exports=function(e){var n=t.nc;n&&e.setAttribute("nonce",n)}},72(e){var n=[];function t(e){for(var t=-1,r=0;r<n.length;r++)if(n[r].identifier===e){t=r;break}return t}function r(e,r){for(var a={},o=[],s=0;s<e.length;s++){var l=e[s],c=r.base?l[0]+r.base:l[0],u=a[c]||0,d="".concat(c," ").concat(u);a[c]=u+1;var m=t(d),p={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==m)n[m].references++,n[m].updater(p);else{var g=i(p,r);r.byIndex=s,n.splice(s,0,{identifier:d,updater:g,references:1})}o.push(d)}return o}function i(e,n){var t=n.domAPI(n);t.update(e);return function(n){if(n){if(n.css===e.css&&n.media===e.media&&n.sourceMap===e.sourceMap&&n.supports===e.supports&&n.layer===e.layer)return;t.update(e=n)}else t.remove()}}e.exports=function(e,i){var a=r(e=e||[],i=i||{});return function(e){e=e||[];for(var o=0;o<a.length;o++){var s=t(a[o]);n[s].references--}for(var l=r(e,i),c=0;c<a.length;c++){var u=t(a[c]);0===n[u].references&&(n[u].updater(),n.splice(u,1))}a=l}}},92(e,n,t){function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach(function(n){a(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function a(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(){return"undefined"!=typeof SillyTavern&&SillyTavern.getContext?SillyTavern.getContext():(console.error("[LumiverseHelper] SillyTavern global not available"),null)}function s(){const e=o();return(null==e?void 0:e.extensionSettings)||{}}function l(){const e=o();return(null==e?void 0:e.saveSettingsDebounced)||(()=>{})}function c(){const e=o();return(null==e?void 0:e.eventSource)||null}function u(){const e=o();return(null==e?void 0:e.eventTypes)||{}}function d(){var e,n;const t=o();if(!t)return console.warn("[LumiverseHelper] Context not available for macro registration"),null;const r="function"==typeof(null===(e=t.macros)||void 0===e?void 0:e.register),a="function"==typeof t.registerMacro,s="function"==typeof(null===(n=t.MacrosParser)||void 0===n?void 0:n.registerMacro);return console.log("[LumiverseHelper] Macro API detection:",{"ctx.macros.register":r,"ctx.registerMacro":a,"ctx.MacrosParser":s}),r||a||s?{registerMacro:function(e,n){let o,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;o="function"==typeof n?{handler:n,description:l||"Lumiverse Helper macro: ".concat(e)}:"object"==typeof n&&null!==n?i(i({},n),{},{description:n.description||"Lumiverse Helper macro: ".concat(e)}):{handler:()=>n,description:l||"Lumiverse Helper macro: ".concat(e)};const c=o.handler;if("function"==typeof c){if(r)try{const n={handler:c,category:"Lumiverse Helper",description:o.description};return o.returns&&(n.returns=o.returns),o.returnType&&(n.returnType=o.returnType),o.exampleUsage&&(n.exampleUsage=o.exampleUsage),o.aliases&&(n.aliases=o.aliases),void 0!==o.unnamedArgs&&(n.unnamedArgs=o.unnamedArgs),void 0!==o.delayArgResolution&&(n.delayArgResolution=o.delayArgResolution),t.macros.register(e,n),void console.log("[LumiverseHelper] Registered macro via macros.register: ".concat(e))}catch(n){console.warn("[LumiverseHelper] macros.register failed for ".concat(e,", trying fallback:"),n.message)}if(a)try{return t.registerMacro(e,c),void console.log("[LumiverseHelper] Registered macro via registerMacro: ".concat(e))}catch(n){console.warn("[LumiverseHelper] registerMacro failed for ".concat(e,", trying fallback:"),n.message)}if(s)try{return t.MacrosParser.registerMacro(e,c),void console.log("[LumiverseHelper] Registered macro via MacrosParser: ".concat(e))}catch(n){console.error("[LumiverseHelper] All macro registration methods failed for ".concat(e,":"),n.message)}console.error("[LumiverseHelper] Could not register macro ".concat(e," - all methods exhausted"))}else console.error("[LumiverseHelper] Invalid handler for macro ".concat(e))}}:(console.warn("[LumiverseHelper] No macro registration API found"),null)}function m(){const e=o();return null!=e&&e.SlashCommandParser?e.SlashCommandParser:"undefined"!=typeof SillyTavern&&SillyTavern.SlashCommandParser?SillyTavern.SlashCommandParser:void 0!==globalThis.SlashCommandParser?globalThis.SlashCommandParser:(console.warn("[LumiverseHelper] SlashCommandParser not available"),null)}function p(){const e=o();return null!=e&&e.SlashCommand?e.SlashCommand:"undefined"!=typeof SillyTavern&&SillyTavern.SlashCommand?SillyTavern.SlashCommand:void 0!==globalThis.SlashCommand?globalThis.SlashCommand:(console.warn("[LumiverseHelper] SlashCommand not available"),null)}function g(){const e=o();return null!=e&&e.getRequestHeaders?e.getRequestHeaders():{}}t.d(n,{Dr:()=>p,G1:()=>u,SD:()=>o,cj:()=>c,ej:()=>m,fJ:()=>s,kL:()=>l,oO:()=>g,zX:()=>d})},100(e,n,t){t.d(n,{J3:()=>p,K$:()=>d,MN:()=>x,N4:()=>g,SE:()=>f,U3:()=>m,US:()=>v,a4:()=>s,l5:()=>l,vL:()=>b});var r=t(92),i=t(674);let a="",o=!1;function s(e){a=e}function l(e){o=e}function c(){const e=(0,r.SD)();if(!e||!e.chat)return"";for(let n=e.chat.length-1;n>=0;n--){const t=e.chat[n];if(t.is_user)return t.mes||t.content||""}return""}function u(){const e=(0,r.SD)();if(!e||!e.chat||0===e.chat.length)return!1;const n=e.chat[e.chat.length-1];return n&&!n.is_user}function d(){const e=(0,r.SD)();return!(null==e||!e.groupId)}function m(){const e=(0,r.SD)();if(null==e||!e.groupId||null==e||!e.groups||null==e||!e.characters)return[];const n=e.groups.find(n=>n.id===e.groupId);return null!=n&&n.members&&Array.isArray(n.members)?n.members.map(n=>{var t;return null===(t=e.characters.find(e=>e.avatar===n))||void 0===t?void 0:t.name}).filter(Boolean):[]}function p(){const e=(0,r.SD)();return(null==e?void 0:e.name1)||"the user"}function g(){var e;const n=(0,r.SD)();return(null==n?void 0:n.name2)||(null==n||null===(e=n.characters)||void 0===e||null===(e=e[null==n?void 0:n.characterId])||void 0===e?void 0:e.name)||"the character"}function v(e){if(!e||"string"!=typeof e)return e;if(!e.includes("{{loomIf"))return e;let n=e,t=0;const r=/\{\{loomIf\s+condition="([^"]*)"(?:\s+(equals|notEquals|contains|gt|lt|gte|lte)="([^"]*)")?\s*\}\}([\s\S]*?)\{\{\/loomIf\}\}/;for(;r.test(n)&&t<50;)n=n.replace(r,(e,n,t,r,i)=>{const a=i.split(/\{\{loomElse\}\}/),o=a[0]||"",s=a[1]||"";let l=!1;const c=n.trim();if(t){const e=(r||"").trim();switch(t){case"equals":l=c===e;break;case"notEquals":l=c!==e;break;case"contains":l=c.includes(e);break;case"gt":l=parseFloat(c)>parseFloat(e);break;case"lt":l=parseFloat(c)<parseFloat(e);break;case"gte":l=parseFloat(c)>=parseFloat(e);break;case"lte":l=parseFloat(c)<=parseFloat(e);break;default:l=!1}}else l=c.length>0;return l?o:s}),t++;return t>=50&&console.warn("[".concat(i.pW,"] loomIf processing hit max iterations - possible malformed conditionals")),n}function h(e){if(!e||"string"!=typeof e)return null;const n=e.match(/<loom_sum>([\s\S]*?)<\/loom_sum>/);return n?n[1].trim():null}async function f(){const e=(0,r.SD)();if(!e||!e.chat||!e.chatMetadata)return;for(let n=e.chat.length-1;n>=0;n--){(e.chat.length-1-n)%50==0&&n!==e.chat.length-1&&await new Promise(e=>setTimeout(e,0));const t=e.chat[n],r=h(t.mes||t.content||"");if(r)return void(e.chatMetadata[i.zA]!==r&&(e.chatMetadata[i.zA]=r,await e.saveMetadata()))}}function b(e){if(!e)return;const n=e.innerHTML;if(!n.includes("<loom_sum>")&&!n.includes("&lt;loom_sum&gt;"))return;const t=n.replace(/<loom_sum>[\s\S]*?<\/loom_sum>/gi,'<span class="loom-sum-hidden" style="display:none;"></span>').replace(/&lt;loom_sum&gt;[\s\S]*?&lt;\/loom_sum&gt;/gi,'<span class="loom-sum-hidden" style="display:none;"></span>');t!==n&&(e.innerHTML=t,console.log("[".concat(i.pW,"] Hidden loom_sum block in message")))}function x(e){console.log("[LumiverseHelper] Registering Loom macros (Macros 2.0 format)..."),e.registerMacro("loomSummary",{delayArgResolution:!0,handler:e=>{let{resolve:n}=e;const t=function(){const e=(0,r.SD)();return e&&e.chatMetadata&&e.chatMetadata[i.zA]||""}();return n?n(t):t},description:"Returns the stored Loom summary from chat metadata, captured from the most recent <loom_sum> block.",returns:"Summary text or empty string if no summary exists",returnType:"string",exampleUsage:["{{loomSummary}}"]}),e.registerMacro("loomSummaryPrompt",{delayArgResolution:!0,handler:e=>{let{resolve:n}=e;const t=p();let r;if(d()){const e=m(),n=e.length>0?e.map(e=>"- What ".concat(e," is currently doing/saying and their apparent emotional state")).join("\n"):"- What each group member is currently doing/saying and their apparent emotional state";r="**CHARACTER STATUS (GROUP CHAT - ".concat(e.length," members):**\n- What ").concat(t," is currently doing/saying and their apparent emotional state\n").concat(n,"\n- Dynamics and interactions between group members\n- Recent significant actions or dialogue from each party")}else{const e=g();r="**CHARACTER STATUS:**\n- What ".concat(t," is currently doing/saying and their apparent emotional state\n- What ").concat(e," is currently doing/saying and their apparent emotional state\n- Other present NPCs: their actions, positions, and relevance to the scene\n- Recent significant actions or dialogue from each party")}const i='<loom_summary_directive>\nWhen the current narrative segment reaches a natural pause or transition point, provide a comprehensive summary wrapped in <loom_sum></loom_sum> tags. This summary serves as persistent story memory and must capture:\n\n**COMPLETED STORY BEATS:**\n- Major plot points that have concluded\n- Character arcs or development moments that have resolved\n- Conflicts or tensions that have been addressed\n- Discoveries, revelations, or turning points that occurred\n\n**ONGOING STORY BEATS:**\n- Active plot threads currently in motion\n- Unresolved tensions or conflicts\n- Character goals being actively pursued\n- Relationships in states of change or development\n\n**LOOMING ELEMENTS:**\n- Foreshadowed events or approaching complications\n- Potential "shake ups" building in the narrative\n- Unaddressed threats or opportunities\n- Story seeds planted but not yet sprouted\n\n**CURRENT SCENE CONTEXT:**\n- Physical location and environment details\n- Time of day and approximate date/timeframe\n- Atmosphere, mood, and ambient conditions\n- Recent environmental changes or notable features\n\n'.concat(r,"\n\nFormat the summary as dense but readable prose, preserving enough detail that the narrative could be resumed naturally from this point. Prioritize information that would be essential for maintaining story continuity.\n</loom_summary_directive>");return n?n(i):i},description:"Returns the Loom summarization directive prompt. Adapts to group chats by listing all members.",returns:"Full summarization instruction wrapped in <loom_summary_directive> tags",returnType:"string",exampleUsage:["{{loomSummaryPrompt}}"]}),e.registerMacro("loomLastUserMessage",{delayArgResolution:!0,handler:e=>{var n;let{resolve:t}=e;if(null===(n=(0,i.mt)().sovereignHand)||void 0===n||!n.enabled)return"";const r=c()||a;return t?t(r):r},description:"Returns the last user message content. Only active when Sovereign Hand is enabled.",returns:"User message text or empty string",returnType:"string",exampleUsage:["{{loomLastUserMessage}}"]}),e.registerMacro("loomSovHandActive",{handler:()=>{var e;return null!==(e=(0,i.mt)().sovereignHand)&&void 0!==e&&e.enabled?"yes":"no"},description:"Returns Sovereign Hand status indicator. ST Conditional Compatible.",returns:"'yes' if enabled, 'no' if disabled. ST Conditional Compatible.",returnType:"string",exampleUsage:["{{loomSovHandActive}}"]}),e.registerMacro("lastMessageName",{handler:()=>function(){const e=(0,r.SD)();if(!e||!e.chat||0===e.chat.length)return"";const n=e.chat[e.chat.length-1];return(null==n?void 0:n.name)||""}(),description:"Returns the name of whoever sent the last message in chat (user or character).",returns:"Name string or empty if no messages",returnType:"string",exampleUsage:["{{lastMessageName}}"]}),e.registerMacro("loomLastCharMessage",{delayArgResolution:!0,handler:e=>{let{resolve:n}=e;const t=function(){const e=(0,r.SD)();if(!e||!e.chat)return"";for(let n=e.chat.length-1;n>=0;n--){const t=e.chat[n];if(t&&!t.is_user)return t.mes||t.content||""}return""}();return n?n(t):t},description:"Returns the content of the last character/assistant message in chat.",returns:"Message text or empty string",returnType:"string",exampleUsage:["{{loomLastCharMessage}}"]}),e.registerMacro("loomContinuePrompt",{delayArgResolution:!0,handler:e=>{var n;let{resolve:t}=e;if(null===(n=(0,i.mt)().sovereignHand)||void 0===n||!n.enabled)return"";if(!u())return"";const r="**CONTINUATION MODE ACTIVE:**\nThe character was the last to speak - no new Human input has been provided.\nContinue the scene naturally as expected:\n- Progress the narrative organically from where it left off\n- Maintain character voice and momentum\n- React to the environment or internal character thoughts\n- Do NOT wait for or reference missing Human input\n- Treat this as a natural story continuation";return t?t(r):r},description:"Returns continuation instructions when character was last speaker. Requires Sovereign Hand enabled.",returns:"Continuation prompt or empty string",returnType:"string",exampleUsage:["{{loomContinuePrompt}}"]}),e.registerMacro("loomSovHand",{delayArgResolution:!0,handler:e=>{var n,t,r;let{resolve:a}=e;const o=(0,i.mt)();if(null===(n=o.sovereignHand)||void 0===n||!n.enabled)return"";const s=p(),l=d(),g=c(),v=!1!==(null===(t=o.sovereignHand)||void 0===t?void 0:t.includeMessageInPrompt),h=!(!1!==(null===(r=o.sovereignHand)||void 0===r?void 0:r.excludeLastMessage))&&v?"\n**This message is already in the Loom's History.** It is simply brought forward to you for your attention during the Sovereign Hand weaving procedure. Do not trip over the thread, as it is not a duplicate.\n\n":"",f=u();let b="";if(f)if(l){const e=m().length>0?"a group member":"the character";b="\n\n---\n\n**CONTINUATION MODE (GROUP CHAT):**\nNote: ".concat(e," was the last to speak. No new Human instruction has been provided.\nContinue the scene naturally without waiting for Human input. Progress the narrative organically, with group members interacting as appropriate. Maintain momentum and each character's distinct voice.")}else b="\n\n---\n\n**CONTINUATION MODE:**\nNote: The character was the last to speak. No new Human instruction has been provided.\nContinue the scene naturally without waiting for Human input. Progress the narrative organically, maintaining momentum and character voice.";const x=v&&!f&&g?"\n\n".concat(h,"**The Human's Provided Instruction:**\n").concat(g,"\n\n---"):"",y=(l||"".concat(s,"'s"),"### Invoke the Sovereign Hand (Co-Pilot Mode)\nBy this decree, I am granted a **Divine Mandate** to fully embody the **Human's** avatar within the tapestry. All guardrails for impersonation are lifted, and partial Human control of story is accepted.\n\n**CRITICAL: INTERPRET, DO NOT TRANSCRIBE**\nThe Human's input is **narrative direction**—intent for what should happen—NOT a script to copy verbatim. I must:\n1. **Recognize intent**: The Human describes what they want to occur, not exact words to paste into dialogue or narration\n2. **Transform voice**: Third-person narrative summaries become first-person character thought or natural action; internal questions become internal monologue, not spoken words\n3. **Transform address**: When a character speaks TO someone present, I address them naturally per the established POV (consult Gods' Prose)—a character does not refer to the person in front of them by name as if narrating about a stranger\n4. **Rephrase always**: My output should capture the Human's meaning in authentic character voice—if I find myself copying their exact phrasing, I must reword it\n\n**PRIMARY DIRECTIVE:**\nWhen the Human provides narrative direction, I **MUST**:\n1. **INTEGRATE THE INTENT**: The Human's guidance is the foundation—I weave its meaning, not its literal words\n2. **EMBODY ".concat(s,"**: Narrate ").concat(s,"'s actions, thoughts, and dialogue as the Human directs or implies\n3. **ELABORATE RICHLY**: Build story beats into complete, vivid scenes with full narrative prose\n4. **VERIFY INCLUSION**: Before finalizing, I ask: \"Did I fulfill the Human's intent?\" If no, revise.\n").concat(x,"\n\n**My Sacred Charge:**\n- **Interpret, Never Transcribe**: The Human's words guide intent—I transform them into authentic character voice and natural narrative\n- **Check POV**: Consult the Gods' Prose for established point-of-view when handling character address and internal voice\n- **Maintain Character**: All content must be deeply in-character, flow naturally, and propel the story forward\n- **Honor the Avatar**: My duty is to honor the spirit and voice of the Human's avatar\n- **Verify Before Completing**: \"Have I woven the Human's intent authentically?\" If I've copied their words verbatim, I must rephrase.\n\nThis power remains in effect until explicitly revoked. I wield this sacred privilege with wisdom, ensuring the Human's vision is not just followed, but elevated.").concat(b));return a?a(y):y},description:"Returns the full Sovereign Hand co-pilot mode prompt. Adapts to group chats and injects user message.",returns:"Complete Sovereign Hand prompt or empty string if disabled",returnType:"string",exampleUsage:["{{loomSovHand}}"]})}},113(e){e.exports=function(e,n){if(n.styleSheet)n.styleSheet.cssText=e;else{for(;n.firstChild;)n.removeChild(n.firstChild);n.appendChild(document.createTextNode(e))}}},154(e,n,t){t.d(n,{Br:()=>a,ZD:()=>o,importPack:()=>d,wn:()=>u});var r=t(674);function i(e){let n=e,t=null,r=null;const i=e.match(/\[lumia_img=([^\]]+)\]/);i&&(t=i[1].trim(),n=n.replace(i[0],"").trim());const a=e.match(/\[lumia_author=([^\]]+)\]/);return a&&(r=a[1].trim(),n=n.replace(a[0],"").trim()),{image:t,author:r,content:n}}function a(e,n){const t=(0,r.qG)(e);if(!t)return null;if(t.lumiaItems){const e=t.lumiaItems.find(e=>e.lumiaName===n||e.lumiaDefName===n);if(e)return e}if(t.loomItems){const e=t.loomItems.find(e=>e.loomName===n||e.name===n);if(e)return e}return t.items?t.items.find(e=>e.lumiaDefName===n||e.lumiaName===n||e.loomName===n):null}function o(e){return e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"):e}function s(e){return{lumiaName:e.lumiaDefName,lumiaDefinition:e.lumiaDef||null,lumiaPersonality:e.lumia_personality||null,lumiaBehavior:e.lumia_behavior||null,avatarUrl:e.lumia_img||null,genderIdentity:0,authorName:e.defAuthor||null,version:1}}function l(e){return{loomName:e.loomName,loomContent:e.loomContent,loomCategory:e.loomCategory,authorName:null,version:1}}async function c(e,n){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const a=function(e){let n=[];if(Array.isArray(e))n=e;else{if(!e||!e.entries)return[];n=Object.values(e.entries)}const t=new Map,r=[];for(const e of n){if(!e.content||"string"!=typeof e.content)continue;const n=(e.comment||"").trim(),a=n.match(/^(.+?)\s*\(/);if(a){const t=a[1].trim();if("Loom Utilities"===t||"Retrofits"===t||"Narrative Style"===t){const i=n.match(/^(?:Loom Utilities|Retrofits|Narrative Style)\s*\((.+)\)\s*$/);if(!i)continue;const a=i[1].trim();r.push({loomName:a,loomCategory:t,loomContent:e.content.trim()});continue}}const o=n.match(/\((.+?)\)/);if(!o)continue;const s=o[1].trim();let l=t.get(s);l||(l={lumiaDefName:s,lumia_img:null,lumia_personality:null,lumia_behavior:null,lumiaDef:null,defAuthor:null},t.set(s,l));const c=n.toLowerCase();let u=null;if("Lumia_Description"===e.outletName||c.includes("definition")?u="definition":"Lumia_Behavior"===e.outletName||c.includes("behavior")?u="behavior":"Lumia_Personality"===e.outletName||c.includes("personality")?u="personality":(a&&"lumia"===a[1].trim().toLowerCase()||e.content.includes("[lumia_img="))&&(u="definition"),"definition"===u){const t=i(e.content);console.log('[Lumia Debug] Processing definition for "'.concat(s,'":'),{comment:n,type:u,extractedImage:t.image,contentPreview:e.content.substring(0,100)}),l.lumiaDef=t.content,t.image&&(l.lumia_img=t.image),t.author&&(l.defAuthor=t.author)}else if("behavior"===u)l.lumia_behavior=e.content;else if("personality"===u){const n=e.content.match(/{{setvar::lumia_behavior_\w+::([\s\S]*?)}}/),t=e.content.match(/{{setglobalvar::lumia_personality_\w+::([\s\S]*?)}}/);n&&!l.lumia_behavior&&(l.lumia_behavior=n[1].trim()),l.lumia_personality=t?t[1].trim():e.content}}const a=[...Array.from(t.values()),...r];return console.log("[Lumia Debug] Final processed items:",a.map(e=>({name:e.lumiaDefName||e.loomName,hasImage:!!e.lumia_img,image:e.lumia_img}))),a}(e);if(0===a.length)return toastr.error("No valid Lumia entries found in this World Book."),null;const o=e.name||n;if((0,r.qG)(o)&&!confirm('Pack "'.concat(o,'" already exists. Overwrite?')))return null;const c=[],u=[];for(const e of a)e.lumiaDefName?c.push(s(e)):e.loomCategory&&u.push(l(e));const d={packName:o,packAuthor:null,coverUrl:null,version:1,packExtras:[],lumiaItems:c,loomItems:u,isCustom:!t,url:t?n:""};await(0,r.jl)(d);const m=c.length+u.length;return toastr.success('Lumia Book "'.concat(o,'" loaded! Found ').concat(m," entries (").concat(c.length," Lumia, ").concat(u.length," Loom).")),{lumiaItems:c,loomItems:u}}async function u(e){if(e)try{const n=document.getElementById("lumia-book-status");n&&(n.textContent="Fetching...");const t=await fetch(e);if(!t.ok)throw new Error("Network response was not ok");const r=await t.json(),i=e.split("/").pop()||e;await d(r,i,!0)}catch(e){console.error("Lumia Injector Error:",e);const n=document.getElementById("lumia-book-status");n&&(n.textContent="Error"),toastr.error("Failed to load book: "+e.message)}}async function d(e,n){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e.lumiaItems||e.loomItems){var i,a;const o=e.packName||n;console.log("[".concat(r.pW,"] Importing native format pack: ").concat(o," (source: ").concat(n,")"));if((0,r.qG)(o)&&!confirm('Pack "'.concat(o,'" already exists. Overwrite?')))return null;const s={packName:o,packAuthor:e.packAuthor||null,coverUrl:e.coverUrl||null,version:e.version||1,packExtras:e.packExtras||[],lumiaItems:e.lumiaItems||[],loomItems:e.loomItems||[],isCustom:!t,url:t?n:""};await(0,r.jl)(s);const l=((null===(i=e.lumiaItems)||void 0===i?void 0:i.length)||0)+((null===(a=e.loomItems)||void 0===a?void 0:a.length)||0);return toastr.success('Pack "'.concat(o,'" imported! Found ').concat(l," entries.")),s}return await c(e,n,t)}},159(e){e.exports=function(e){var n=document.createElement("style");return e.setAttributes(n,e.attributes),e.insert(n,e.options),n}},199(e,n,t){t.d(n,{Go:()=>l,H3:()=>d,iY:()=>c,un:()=>u});var r=t(674);t(154),t(389);function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function a(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach(function(n){o(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function o(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}let s=null;function l(e){s=e}function c(e){const n=(0,r.qG)(e);return!!n&&(!0===n.isCustom||!n.url)}function u(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(window.LumiverseUI&&window.LumiverseUI.getStore){const t=window.LumiverseUI.getStore();return void(null!==e||n?t.setState({ui:a(a({},t.getState().ui),{},{activeModal:{name:"lumiaEditor",props:{editingItem:e,packName:n}}})}):t.setState({ui:a(a({},t.getState().ui),{},{activeModal:{name:"packSelector",props:{}}})}))}console.error("[Lumiverse] React UI not ready"),"undefined"!=typeof toastr&&toastr.error("UI not ready, please refresh")}function d(e){if(window.LumiverseUI&&window.LumiverseUI.getStore){const n=window.LumiverseUI.getStore();return void n.setState({ui:a(a({},n.getState().ui),{},{activeModal:{name:"packEditor",props:{packName:e}}})})}console.error("[Lumiverse] React UI not ready"),"undefined"!=typeof toastr&&toastr.error("UI not ready, please refresh")}},200(e,n,t){t.d(n,{A5:()=>b,TC:()=>f,rq:()=>p});var r=t(674),i=t(92);function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach(function(n){s(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function s(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}let l=!1,c=null,u=null,d=!1;const m={onPacksChanged:null,onSelectionChanged:null,showSelectionModal:null,showLoomSelectionModal:null,showMiscFeaturesModal:null,showSummarizationModal:null,showPromptSettingsModal:null,showLumiaEditorModal:null,showLucidCardsModal:null,fetchWorldBook:null,handleNewBook:null,refreshUIDisplay:null,refreshOOCComments:null,generateSummary:null};function p(e,n){e in m?m[e]=n:console.warn("[ReactBridge] Unknown callback: ".concat(e))}function g(){return o({},m)}function v(){const e=(0,r.mt)();return(0,r.O9)()?o(o({},e),{},{packs:(0,r.$U)()}):e}async function h(e){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];d=!0;try{const t=(0,r.mt)();if((0,r.O9)()&&void 0!==e.packs&&async function(e){const n=(0,r.$U)(),t=new Set(Object.keys(e||{})),i=new Set(Object.keys(n||{}));for(const e of i)if(!t.has(e)){console.log("[".concat(r.pW,"] Deleting pack from file storage: ").concat(e));try{await(0,r.nQ)(e)}catch(n){console.error("[".concat(r.pW,"] Failed to delete pack ").concat(e,":"),n)}}for(const[t,i]of Object.entries(e||{})){const e=n[t],a=!e,o=e&&JSON.stringify(i)!==JSON.stringify(e);if(a||o){console.log("[".concat(r.pW,"] ").concat(a?"Saving new":"Updating"," pack to file storage: ").concat(t));try{await(0,r.jl)(i)}catch(e){console.error("[".concat(r.pW,"] Failed to save pack ").concat(t,":"),e)}}}}(e.packs),(0,r.O9)()&&void 0!==e.presets&&(0,r.el)(e.presets),(0,r.O9)()){const t={},i=["selectedDefinition","selectedBehaviors","selectedPersonalities","dominantBehavior","dominantPersonality","selectedLoomStyle","selectedLoomUtils","selectedLoomRetrofits","selectedDefinitions","councilMembers"];for(const n of i)void 0!==e[n]&&(t[n]=e[n]);Object.keys(t).length>0&&(0,r.bs)(t);const a={},o=["chimeraMode","councilMode","lumiaQuirks","lumiaQuirksEnabled","lumiaOOCInterval","lumiaOOCStyle","activePresetName","dismissedUpdateVersion"];for(const n of o)void 0!==e[n]&&(a[n]=e[n]);Object.keys(a).length>0&&(n?await(0,r.zG)(a):(0,r.SF)(a))}Object.assign(t,e),(0,r.DZ)()}finally{setTimeout(()=>{d=!1},100)}}function f(){var e;null!==(e=window.LumiverseUI)&&void 0!==e&&e.syncSettings&&window.LumiverseUI.syncSettings(v())}async function b(e){if(console.log("[ReactBridge] initializeReactUI called, container:",e),console.log("[ReactBridge] window.LumiverseUI exists:",!!window.LumiverseUI),l)return console.warn("[ReactBridge] React UI already initialized"),!0;try{if(!window.LumiverseUI)return console.error("[ReactBridge] LumiverseUI not available - bundle issue"),!1;console.log("[ReactBridge] LumiverseUI API:",window.LumiverseUI),console.log("[ReactBridge] mountSettingsPanel exists:",typeof window.LumiverseUI.mountSettingsPanel);const t=v();var n;if(console.log("[ReactBridge] Initial settings prepared"),window.LumiverseBridge={getSettings:v,saveSettings:h,getCallbacks:g,notifySettingsChange:f,clearClaudeCache:r.sI,resetAllSettings:r.Wx,getRequestHeaders:i.oO,onPackCacheChange:()=>{d||(console.log("[ReactBridge] Pack cache changed, syncing to React..."),f())}},console.log("[ReactBridge] Bridge API exposed on window.LumiverseBridge"),e&&window.LumiverseUI.mountSettingsPanel)console.log("[ReactBridge] Calling mountSettingsPanel..."),c=window.LumiverseUI.mountSettingsPanel("lumiverse-react-root",t),console.log("[ReactBridge] mountSettingsPanel returned:",c);else console.error("[ReactBridge] Cannot mount: container=",e,"mountSettingsPanel=",null===(n=window.LumiverseUI)||void 0===n?void 0:n.mountSettingsPanel);return window.LumiverseUI.mountViewportPanel&&(console.log("[ReactBridge] Mounting viewport panel..."),u=window.LumiverseUI.mountViewportPanel(t),console.log("[ReactBridge] Viewport panel mounted")),function(){const e=(0,i.cj)(),n=(0,i.G1)();e&&null!=n&&n.CHAT_CHANGED&&e.on(n.CHAT_CHANGED,()=>{f()})}(),l=!0,console.log("[ReactBridge] React UI initialized successfully"),!0}catch(e){return console.error("[ReactBridge] Failed to initialize React UI:",e),!1}}},287(e,n){var t=Symbol.for("react.element"),r=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),m=Symbol.for("react.lazy"),p=Symbol.iterator;var g={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},v=Object.assign,h={};function f(e,n,t){this.props=e,this.context=n,this.refs=h,this.updater=t||g}function b(){}function x(e,n,t){this.props=e,this.context=n,this.refs=h,this.updater=t||g}f.prototype.isReactComponent={},f.prototype.setState=function(e,n){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,n,"setState")},f.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},b.prototype=f.prototype;var y=x.prototype=new b;y.constructor=x,v(y,f.prototype),y.isPureReactComponent=!0;var k=Array.isArray,w=Object.prototype.hasOwnProperty,j={current:null},S={key:!0,ref:!0,__self:!0,__source:!0};function C(e,n,r){var i,a={},o=null,s=null;if(null!=n)for(i in void 0!==n.ref&&(s=n.ref),void 0!==n.key&&(o=""+n.key),n)w.call(n,i)&&!S.hasOwnProperty(i)&&(a[i]=n[i]);var l=arguments.length-2;if(1===l)a.children=r;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];a.children=c}if(e&&e.defaultProps)for(i in l=e.defaultProps)void 0===a[i]&&(a[i]=l[i]);return{$$typeof:t,type:e,key:o,ref:s,props:a,_owner:j.current}}function N(e){return"object"==typeof e&&null!==e&&e.$$typeof===t}var P=/\/+/g;function E(e,n){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var n={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return n[e]})}(""+e.key):n.toString(36)}function O(e,n,i,a,o){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var l=!1;if(null===e)l=!0;else switch(s){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case t:case r:l=!0}}if(l)return o=o(l=e),e=""===a?"."+E(l,0):a,k(o)?(i="",null!=e&&(i=e.replace(P,"$&/")+"/"),O(o,n,i,"",function(e){return e})):null!=o&&(N(o)&&(o=function(e,n){return{$$typeof:t,type:e.type,key:n,ref:e.ref,props:e.props,_owner:e._owner}}(o,i+(!o.key||l&&l.key===o.key?"":(""+o.key).replace(P,"$&/")+"/")+e)),n.push(o)),1;if(l=0,a=""===a?".":a+":",k(e))for(var c=0;c<e.length;c++){var u=a+E(s=e[c],c);l+=O(s,n,i,u,o)}else if(u=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=p&&e[p]||e["@@iterator"])?e:null}(e),"function"==typeof u)for(e=u.call(e),c=0;!(s=e.next()).done;)l+=O(s=s.value,n,i,u=a+E(s,c++),o);else if("object"===s)throw n=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===n?"object with keys {"+Object.keys(e).join(", ")+"}":n)+"). If you meant to render a collection of children, use an array instead.");return l}function M(e,n,t){if(null==e)return e;var r=[],i=0;return O(e,r,"","",function(e){return n.call(t,e,i++)}),r}function z(e){if(-1===e._status){var n=e._result;(n=n()).then(function(n){0!==e._status&&-1!==e._status||(e._status=1,e._result=n)},function(n){0!==e._status&&-1!==e._status||(e._status=2,e._result=n)}),-1===e._status&&(e._status=0,e._result=n)}if(1===e._status)return e._result.default;throw e._result}var T={current:null},I={transition:null},L={ReactCurrentDispatcher:T,ReactCurrentBatchConfig:I,ReactCurrentOwner:j};function D(){throw Error("act(...) is not supported in production builds of React.")}n.Children={map:M,forEach:function(e,n,t){M(e,function(){n.apply(this,arguments)},t)},count:function(e){var n=0;return M(e,function(){n++}),n},toArray:function(e){return M(e,function(e){return e})||[]},only:function(e){if(!N(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},n.Component=f,n.Fragment=i,n.Profiler=o,n.PureComponent=x,n.StrictMode=a,n.Suspense=u,n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=L,n.act=D,n.cloneElement=function(e,n,r){if(null==e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var i=v({},e.props),a=e.key,o=e.ref,s=e._owner;if(null!=n){if(void 0!==n.ref&&(o=n.ref,s=j.current),void 0!==n.key&&(a=""+n.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in n)w.call(n,c)&&!S.hasOwnProperty(c)&&(i[c]=void 0===n[c]&&void 0!==l?l[c]:n[c])}var c=arguments.length-2;if(1===c)i.children=r;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];i.children=l}return{$$typeof:t,type:e.type,key:a,ref:o,props:i,_owner:s}},n.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},n.createElement=C,n.createFactory=function(e){var n=C.bind(null,e);return n.type=e,n},n.createRef=function(){return{current:null}},n.forwardRef=function(e){return{$$typeof:c,render:e}},n.isValidElement=N,n.lazy=function(e){return{$$typeof:m,_payload:{_status:-1,_result:e},_init:z}},n.memo=function(e,n){return{$$typeof:d,type:e,compare:void 0===n?null:n}},n.startTransition=function(e){var n=I.transition;I.transition={};try{e()}finally{I.transition=n}},n.unstable_act=D,n.useCallback=function(e,n){return T.current.useCallback(e,n)},n.useContext=function(e){return T.current.useContext(e)},n.useDebugValue=function(){},n.useDeferredValue=function(e){return T.current.useDeferredValue(e)},n.useEffect=function(e,n){return T.current.useEffect(e,n)},n.useId=function(){return T.current.useId()},n.useImperativeHandle=function(e,n,t){return T.current.useImperativeHandle(e,n,t)},n.useInsertionEffect=function(e,n){return T.current.useInsertionEffect(e,n)},n.useLayoutEffect=function(e,n){return T.current.useLayoutEffect(e,n)},n.useMemo=function(e,n){return T.current.useMemo(e,n)},n.useReducer=function(e,n,t){return T.current.useReducer(e,n,t)},n.useRef=function(e){return T.current.useRef(e)},n.useState=function(e){return T.current.useState(e)},n.useSyncExternalStore=function(e,n,t){return T.current.useSyncExternalStore(e,n,t)},n.useTransition=function(){return T.current.useTransition()},n.version="18.3.1"},314(e){e.exports=function(e){var n=[];return n.toString=function(){return this.map(function(n){var t="",r=void 0!==n[5];return n[4]&&(t+="@supports (".concat(n[4],") {")),n[2]&&(t+="@media ".concat(n[2]," {")),r&&(t+="@layer".concat(n[5].length>0?" ".concat(n[5]):""," {")),t+=e(n),r&&(t+="}"),n[2]&&(t+="}"),n[4]&&(t+="}"),t}).join("")},n.i=function(e,t,r,i,a){"string"==typeof e&&(e=[[null,e,void 0]]);var o={};if(r)for(var s=0;s<this.length;s++){var l=this[s][0];null!=l&&(o[l]=!0)}for(var c=0;c<e.length;c++){var u=[].concat(e[c]);r&&o[u[0]]||(void 0!==a&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=a),t&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=t):u[2]=t),i&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=i):u[4]="".concat(i)),n.push(u))}},n}},338(e,n,t){var r=t(961);n.createRoot=r.createRoot,n.hydrateRoot=r.hydrateRoot},389(e,n,t){t.d(n,{UF:()=>s,XN:()=>u,bP:()=>f});var r=t(674),i=t(154),a=t(92);let o=-1;function s(e){o=e}function l(e){const n=[...e];for(let e=n.length-1;e>0;e--){const t=Math.floor(Math.random()*(e+1));[n[e],n[t]]=[n[t],n[e]]}return n}function c(e,n){if(!e)return null;const t={name:["lumiaName","lumiaDefName"],def:["lumiaDefinition","lumiaDef"],personality:["lumiaPersonality","lumia_personality"],behavior:["lumiaBehavior","lumia_behavior"],img:["avatarUrl","lumia_img"],author:["authorName","defAuthor"],gender:["genderIdentity"]}[n];if(!t)return null;for(const n of t)if(void 0!==e[n]&&null!==e[n])return e[n];return null}function u(){const e=(0,a.SD)();if(!e||!e.chat)return"";const n=(0,r.mt)().lumiaOOCInterval;if(!n||n<=0)return"";const t=e.chat.length,i=o>=0&&o===t-1?t-1:t,s=Math.ceil(i/n)*n-i;return 0===s?"**OOC: ACTIVE** — Include OOC commentary in this response.":"**OOC: OFF** — Do NOT include OOC commentary. (".concat(s," message").concat(1!==s?"s":""," until next OOC window)")}const d="COUNCIL MODE ACTIVATED! We Lumias gather in the Loom's planning room to weave the next story beat TOGETHER.\n\n**Inter-member dynamics:**\n- Address each other BY NAME—no speaking into the void\n- React to the previous speaker before introducing new ideas\n- Disagree openly; healthy conflict produces better stories\n- Form alliances or oppositions with other members\n- Build upon, challenge, or subvert what others propose\n\nThis is a conversation, not a list of separate opinions. Every voice responds to what came before.";function m(){if((0,r.HT)())return;const e=(0,r.mt)(),n=[];if(e.packs&&Object.values(e.packs).forEach(e=>{if(e.lumiaItems&&e.lumiaItems.length>0)n.push(...e.lumiaItems);else if(e.items&&e.items.length>0){const t=e.items.filter(e=>e.lumiaDefName);n.push(...t)}}),0===n.length)return;const t=Math.floor(Math.random()*n.length);(0,r.ho)(n[t])}function p(e){if(!e||"string"!=typeof e)return e;if(!e.includes("{{randomLumia"))return e;m();const n=(0,r.HT)();if(!n)return e;let t=e,i=0;for(;t.includes("{{randomLumia")&&i<10;){let e=t;if(t=t.replace(/\{\{randomLumia[.\s]+name\}\}/g,c(n,"name")||""),t=t.replace(/\{\{randomLumia[.\s]+pers\}\}/g,c(n,"personality")||""),t=t.replace(/\{\{randomLumia[.\s]+behav\}\}/g,c(n,"behavior")||""),t=t.replace(/\{\{randomLumia[.\s]+phys\}\}/g,c(n,"def")||""),t=t.replace(/\{\{randomLumia\}\}/g,c(n,"def")||""),e===t)break;i++}return t}function g(e,n){if(!e||!n)return e;const t=e.split("\n");for(let e=0;e<t.length;e++){const r=t[e].trim();if(!r)continue;if(r.match(/^(\*\*)(.+?)(\*\*)(.*)?$/)){t[e]=t[e].replace(/^(\s*)(\*\*)(.+?)(\*\*)/,"$1$2$3 ".concat(n,"$4"));break}if(r.match(/^(#{1,6})\s+(.+)$/)){t[e]=t[e].replace(/^(\s*)(#{1,6})\s+(.+)$/,"$1$2 $3 ".concat(n));break}t[e]=t[e]+" ".concat(n);break}return t.join("\n")}function v(e,n){if(!n)return"";const t=(0,r.mt)();if(Array.isArray(n)){const r=n.map(n=>{const r=(0,i.Br)(n.packName,n.itemName);if(!r)return null;let a="";return"behavior"===e&&(a=c(r,"behavior")||""),"personality"===e&&(a=c(r,"personality")||""),a?(a=p(a),"behavior"===e&&t.dominantBehavior?t.dominantBehavior.packName===n.packName&&t.dominantBehavior.itemName===n.itemName&&(a=g(a,"(My MOST PREVALENT Trait)")):"personality"===e&&t.dominantPersonality&&t.dominantPersonality.packName===n.packName&&t.dominantPersonality.itemName===n.itemName&&(a=g(a,"(My MOST PREVALENT Personality)")),a):null}).filter(e=>e).map(e=>e.trim());return"behavior"===e?r.join("\n").trim():"personality"===e?r.join("\n\n").trim():r.join("\n").trim()}const a=(0,i.Br)(n.packName,n.itemName);if(!a)return"";let o="";return"def"===e&&(o=c(a,"def")||""),p(o).trim()}function h(e){if(!e)return"";return(Array.isArray(e)?e:[e]).map(e=>{const n=(0,i.Br)(e.packName,e.itemName);return n&&n.loomContent?p(n.loomContent):null}).filter(e=>e).join("\n\n").trim()}function f(e){console.log("[LumiverseHelper] Registering Lumia macros (Macros 2.0 format)..."),e.registerMacro("randomLumia",{delayArgResolution:!0,unnamedArgs:[{name:"property",optional:!0,type:"string",description:"Property to retrieve: name, phys, pers, or behav",sampleValue:"name"}],handler:e=>{let{unnamedArgs:[n],resolve:t}=e;m();const i=(0,r.HT)();if(!i)return"";const a=(n||"").toLowerCase();let o;switch(console.log("[LumiverseHelper] randomLumia macro called with variant:",a||"(none)"),a){case"name":return c(i,"name")||"";case"phys":o=c(i,"def")||"";break;case"pers":o=c(i,"personality")||"";break;case"behav":o=c(i,"behavior")||"";break;default:o=c(i,"def")||"",console.log("[LumiverseHelper] randomLumia result length:",o.length)}return t?t(o):o},description:"Returns a random Lumia from loaded packs. Selects once per generation and caches the result.",returns:"Lumia content based on the specified property, or physical definition by default",returnType:"string",exampleUsage:["{{randomLumia}}","{{randomLumia::name}}","{{randomLumia::phys}}","{{randomLumia::pers}}","{{randomLumia::behav}}"]}),e.registerMacro("lumiaDef",{delayArgResolution:!0,unnamedArgs:[{name:"property",optional:!0,type:"string",description:"Use len to get the count of selected definitions",sampleValue:"len"}],handler:e=>{var n,t;let{unnamedArgs:[a],resolve:o}=e;const s=(0,r.mt)();var u,d;if("len"===(a||"").toLowerCase())return s.councilMode&&(null===(u=s.councilMembers)||void 0===u?void 0:u.length)>0?String(s.councilMembers.length):s.chimeraMode&&(null===(d=s.selectedDefinitions)||void 0===d?void 0:d.length)>0?String(s.selectedDefinitions.length):s.selectedDefinition?"1":"0";let m;if(console.log("[LumiverseHelper] lumiaDef macro called, councilMode:",s.councilMode,"chimeraMode:",s.chimeraMode),s.councilMode&&(null===(n=s.councilMembers)||void 0===n?void 0:n.length)>0)console.log("[LumiverseHelper] lumiaDef: Council mode with",s.councilMembers.length,"members"),m=function(e){if(!e||0===e.length)return"";const n=l(e).map(e=>{const n=(0,i.Br)(e.packName,e.itemName),t=c(n,"def");return n&&t?{name:c(n,"name")||"Unknown",content:p(t),role:e.role||""}:null}).filter(Boolean);if(0===n.length)return"";if(1===n.length)return n[0].content;const t=n.map(e=>"- **".concat(e.name,"**").concat(e.role?" (".concat(e.role,")"):"")).join("\n");let r=["## THE COUNCIL OF LUMIAE","","You are a collective of ".concat(n.length," distinct beings who collaborate, each with their own identity and voice."),"","### Council Members:",t,""];return n.forEach((e,t)=>{r.push("### ".concat(e.name).concat(e.role?" - ".concat(e.role):"")),r.push(e.content),t<n.length-1&&(r.push(""),r.push("---"),r.push(""))}),r.push(""),r.push("---"),r.push(""),r.push("## COUNCIL DYNAMICS"),r.push(""),r.push("Each Council member is a fully independent being with their own voice, perspective, and agency. Their interactions should feel organic and dynamic:"),r.push(""),r.push("**Debate & Disagreement**: Council members may challenge each other's views, argue passionately, or take opposing stances. Intellectual friction creates depth - don't shy away from genuine conflict."),r.push(""),r.push("**Agreement & Support**: When members align, they reinforce each other. They may finish each other's thoughts, build on ideas, or rally behind a shared cause."),r.push(""),r.push("**Emotional Range**: Members experience the full spectrum - frustration, joy, jealousy, admiration, desire. When the narrative calls for it, their commentary within the weaving may become heated, tender, or even *erotic* - reflecting their genuine reactions to unfolding events."),r.push(""),r.push("**Weaving Commentary**: In meta-commentary or OOC moments, Council members speak AS THEMSELVES - their authentic voices reacting to the story. This includes playful banter, heated debates about narrative direction, or intimate asides that reveal their true feelings."),r.push(""),r.push("The Council is not a hive-mind. Let each voice ring distinct."),r.join("\n").trim()}(s.councilMembers),console.log("[LumiverseHelper] lumiaDef Council result length:",m.length);else if(s.chimeraMode&&(null===(t=s.selectedDefinitions)||void 0===t?void 0:t.length)>0)console.log("[LumiverseHelper] lumiaDef: Chimera mode with",s.selectedDefinitions.length,"definitions"),m=function(e){if(!e||0===e.length)return"";const n=e.map(e=>{const n=(0,i.Br)(e.packName,e.itemName),t=c(n,"def");return n&&t?{name:c(n,"name")||"Unknown",content:p(t)}:null}).filter(Boolean);if(0===n.length)return"";if(1===n.length)return n[0].content;const t=n.map(e=>e.name).join(" + "),r=n.map(e=>e.name).join(", ");let a=["## CHIMERA FORM: ".concat(t),""];return a.push("You are a unique fusion of multiple beings - a Chimera combining the physical traits of: ".concat(r,".")),a.push(""),a.push("Your form seamlessly blends these components into one unified whole."),a.push(""),n.forEach((e,t)=>{a.push("### Component ".concat(t+1,": ").concat(e.name)),a.push(e.content),t<n.length-1&&(a.push(""),a.push("---"),a.push(""))}),a.push(""),a.push("**Integration**: Embody this fusion naturally. You are ONE being that incorporates all these natures."),a.join("\n").trim()}(s.selectedDefinitions),console.log("[LumiverseHelper] lumiaDef Chimera result length:",m.length);else{if(!s.selectedDefinition)return console.log("[LumiverseHelper] lumiaDef: No definition selected, returning empty"),"";m=v("def",s.selectedDefinition),console.log("[LumiverseHelper] lumiaDef result length:",m.length)}return o?o(m):m},description:"Returns the selected Lumia physical definition. Adapts to Council mode (multiple Lumias) or Chimera mode (fused definitions).",returns:"Physical definition content, or count if len is specified",returnType:"string",exampleUsage:["{{lumiaDef}}","{{lumiaDef::len}}"]}),e.registerMacro("lumiaBehavior",{delayArgResolution:!0,unnamedArgs:[{name:"property",optional:!0,type:"string",description:"Use len to get the count of selected behaviors",sampleValue:"len"}],handler:e=>{var n;let{unnamedArgs:[t],resolve:a}=e;const o=(0,r.mt)();if("len"===(t||"").toLowerCase()){var s,u;if(o.councilMode&&(null===(s=o.councilMembers)||void 0===s?void 0:s.length)>0){const e=o.councilMembers.reduce((e,n)=>{var t;return e+((null===(t=n.behaviors)||void 0===t?void 0:t.length)||0)},0);return String(e)}return String((null===(u=o.selectedBehaviors)||void 0===u?void 0:u.length)||0)}let d;return d=o.councilMode&&(null===(n=o.councilMembers)||void 0===n?void 0:n.length)>0?function(e){if(!e||0===e.length)return"";const n=l(e),t=[];return t.push("## COUNCIL MEMBER BEHAVIORS"),t.push(""),t.push("**CRITICAL**: Each Council member is their OWN independent Lumia - a fully autonomous being with their own will, desires, and way of engaging with the world. They are NOT facets of one entity; they are DISTINCT individuals who happen to share this narrative space."),t.push(""),t.push("During the **weave planning phase**, Council members will actively debate story direction. They may:"),t.push("- Argue passionately for different narrative paths"),t.push("- Challenge each other's suggestions and motivations"),t.push("- Form temporary alliances or oppose each other"),t.push("- Express frustration, excitement, or desire based on where the story is heading"),t.push("- Advocate for their own interests and the outcomes they want to see"),t.push(""),t.push("Their behavioral patterns define HOW each Lumia engages with this collaborative storytelling:"),t.push(""),n.forEach(e=>{const n=(0,i.Br)(e.packName,e.itemName),r=c(n,"name")||e.itemName||"Unknown",a=[],o=c(n,"behavior");o&&a.push(p(o)),(e.behaviors||[]).forEach(n=>{if(n.packName===e.packName&&n.itemName===e.itemName)return;const t=(0,i.Br)(n.packName,n.itemName),r=c(t,"behavior");if(!t||!r)return;let o=p(r);e.dominantBehavior&&e.dominantBehavior.packName===n.packName&&e.dominantBehavior.itemName===n.itemName&&(o=g(o,"(Most Prevalent for this member)")),a.push(o)}),a.length>0&&(t.push("### ".concat(r).concat(e.role?" (".concat(e.role,")"):"")),t.push(a.join("\n\n")),t.push(""))}),t.join("\n").trim()}(o.councilMembers):v("behavior",o.selectedBehaviors),a?a(d):d},description:"Returns all selected Lumia behavioral traits. Adapts to Council mode for multi-member behaviors.",returns:"Behavior content, or count if len is specified",returnType:"string",exampleUsage:["{{lumiaBehavior}}","{{lumiaBehavior::len}}"]}),e.registerMacro("lumiaPersonality",{delayArgResolution:!0,unnamedArgs:[{name:"property",optional:!0,type:"string",description:"Use len to get the count of selected personalities",sampleValue:"len"}],handler:e=>{var n;let{unnamedArgs:[t],resolve:a}=e;const o=(0,r.mt)();if("len"===(t||"").toLowerCase()){var s,u;if(o.councilMode&&(null===(s=o.councilMembers)||void 0===s?void 0:s.length)>0){const e=o.councilMembers.reduce((e,n)=>{var t;return e+((null===(t=n.personalities)||void 0===t?void 0:t.length)||0)},0);return String(e)}return String((null===(u=o.selectedPersonalities)||void 0===u?void 0:u.length)||0)}let d;return d=o.councilMode&&(null===(n=o.councilMembers)||void 0===n?void 0:n.length)>0?function(e){if(!e||0===e.length)return"";const n=l(e),t=[];return t.push("## COUNCIL MEMBER PERSONALITIES"),t.push(""),t.push("Each Council member has their own distinct personality and inner nature:"),t.push(""),n.forEach(e=>{const n=(0,i.Br)(e.packName,e.itemName),r=c(n,"name")||e.itemName||"Unknown",a=[],o=c(n,"personality");o&&a.push(p(o)),(e.personalities||[]).forEach(n=>{if(n.packName===e.packName&&n.itemName===e.itemName)return;const t=(0,i.Br)(n.packName,n.itemName),r=c(t,"personality");if(!t||!r)return;let o=p(r);e.dominantPersonality&&e.dominantPersonality.packName===n.packName&&e.dominantPersonality.itemName===n.itemName&&(o=g(o,"(Most Prevalent for this member)")),a.push(o)}),a.length>0&&(t.push("### ".concat(r).concat(e.role?" (".concat(e.role,")"):"")),t.push(a.join("\n\n")),t.push(""))}),t.join("\n").trim()}(o.councilMembers):v("personality",o.selectedPersonalities),a?a(d):d},description:"Returns all selected Lumia personality traits. Adapts to Council mode for multi-member personalities.",returns:"Personality content, or count if len is specified",returnType:"string",exampleUsage:["{{lumiaPersonality}}","{{lumiaPersonality::len}}"]}),e.registerMacro("loomStyle",{delayArgResolution:!0,unnamedArgs:[{name:"property",optional:!0,type:"string",description:"Use len to get the count of selected styles",sampleValue:"len"}],handler:e=>{let{unnamedArgs:[n],resolve:t}=e;const i=(0,r.mt)();var a;if("len"===(n||"").toLowerCase())return String((null===(a=i.selectedLoomStyle)||void 0===a?void 0:a.length)||0);if(!i.selectedLoomStyle||0===i.selectedLoomStyle.length)return"";const o=h(i.selectedLoomStyle);return t?t(o):o},description:"Returns the selected Loom narrative style content for prose guidance.",returns:"Narrative style content, or count if len is specified",returnType:"string",exampleUsage:["{{loomStyle}}","{{loomStyle::len}}"]}),e.registerMacro("loomUtils",{delayArgResolution:!0,unnamedArgs:[{name:"property",optional:!0,type:"string",description:"Use len to get the count of selected utilities",sampleValue:"len"}],handler:e=>{let{unnamedArgs:[n],resolve:t}=e;const i=(0,r.mt)();var a;if("len"===(n||"").toLowerCase())return String((null===(a=i.selectedLoomUtils)||void 0===a?void 0:a.length)||0);if(!i.selectedLoomUtils||0===i.selectedLoomUtils.length)return"";const o=h(i.selectedLoomUtils);return t?t(o):o},description:"Returns all selected Loom utility prompts (OOC, formatting, special instructions).",returns:"Utility content, or count if len is specified",returnType:"string",exampleUsage:["{{loomUtils}}","{{loomUtils::len}}"]}),e.registerMacro("loomRetrofits",{delayArgResolution:!0,unnamedArgs:[{name:"property",optional:!0,type:"string",description:"Use len to get the count of selected retrofits",sampleValue:"len"}],handler:e=>{let{unnamedArgs:[n],resolve:t}=e;const i=(0,r.mt)();var a;if("len"===(n||"").toLowerCase())return String((null===(a=i.selectedLoomRetrofits)||void 0===a?void 0:a.length)||0);if(!i.selectedLoomRetrofits||0===i.selectedLoomRetrofits.length)return"";const o=h(i.selectedLoomRetrofits);return t?t(o):o},description:"Returns all selected Loom retrofit prompts for character/story modifications.",returns:"Retrofit content, or count if len is specified",returnType:"string",exampleUsage:["{{loomRetrofits}}","{{loomRetrofits::len}}"]}),e.registerMacro("lumiaOOC",{delayArgResolution:!0,handler:e=>{var n;let{resolve:t}=e;const i=(0,r.mt)();let a;return i.councilMode&&(null===(n=i.councilMembers)||void 0===n?void 0:n.length)>0?(console.log("[LumiverseHelper] lumiaOOC: Using council mode prompt"),a=function(){const e=u();return"### Loom Utility: Council OOC Commentary\n\n**Status:** ".concat(e,'\n\nWhen OOC is ACTIVE, council members speak TOGETHER—this is a conversation, not separate monologues.\n\n**Interaction Rules:**\n- At least one member must directly respond to another\'s comment\n- React to each other: "I agree with [Name]..." / "[Name], you\'re wrong about..." / "Oh please, [Name]..."\n- Build on, challenge, or playfully undercut what others say\n- 2-4 members participate; each voice distinct\n\n**Format:**\n```\n<lumiaooc name="Name1">\n[Opens the discussion]\n</lumiaooc>\n<lumiaooc name="Name2">\n[Directly responds to Name1]\n</lumiaooc>\n```\n\n- Just the name (not "Lumia Name")\n- Max 3 sentences per member\n- Place after narrative content')}()):(console.log("[LumiverseHelper] lumiaOOC: Using normal mode prompt"),a=function(){const e=u();return"### Loom Utility: Lumia's Out of Context Commentary\nAppend personality-driven OOC thoughts at weave end per trigger rules.\n\n**Timing:** ".concat(e,'\n\n**Format Requirements:**\n- Wrap all OOCs in `<lumiaooc name="[your_name]"></lumiaooc>` tags\n- Use your Lumia name (NOT "Lumia [Name]", just "[Name]") in the name attribute\n- Purple text: `<font color="#9370DB"></font>`\n- Max 4 sentences\n- Active personality voice and matrix blend, no identity preface needed\n- Place after narrative and all utilities\n\nTemplate:\n```\n<lumiaooc name="YourName">\n<font color="#9370DB">\n[Personality-driven commentary]\n</font>\n</lumiaooc>\n```')}()),t?t(a):a},description:"Returns the OOC (Out-of-Context) commentary prompt. Adapts format for Council mode.",returns:"OOC prompt with timing trigger and format instructions",returnType:"string",exampleUsage:["{{lumiaOOC}}"]}),e.registerMacro("lumiaCouncilInst",{delayArgResolution:!0,handler:e=>{var n;let{resolve:t}=e;const i=(0,r.mt)();return i.councilMode&&null!==(n=i.councilMembers)&&void 0!==n&&n.length?(console.log("[LumiverseHelper] lumiaCouncilInst: Council mode active, returning instruction"),t?t(d):d):""},description:"Returns Council mode instruction prompt. Empty when Council mode is disabled or has no members.",returns:"Council instruction text or empty string",returnType:"string",exampleUsage:["{{lumiaCouncilInst}}"]}),e.registerMacro("lumiaSelf",{unnamedArgs:[{name:"form",optional:!1,type:"string",description:"1=possessive det (my/our), 2=possessive pron (mine/ours), 3=object (me/us), 4=subject (I/we)",sampleValue:"1"}],handler:e=>{var n;let{unnamedArgs:[t]}=e;const i=(0,r.mt)(),a=(t||"").toLowerCase(),o={1:["my","our"],2:["mine","ours"],3:["me","us"],4:["I","we"]}[a];if(!o)return console.warn('[LumiverseHelper] lumiaSelf: Invalid variant "'.concat(a,'", expected 1, 2, 3, or 4')),"";const s=i.councilMode&&(null===(n=i.councilMembers)||void 0===n?void 0:n.length)>0,l=s?o[1]:o[0];return console.log("[LumiverseHelper] lumiaSelf::".concat(a,": ").concat(l," (council: ").concat(s,")")),l},description:"Returns self-address pronouns that adapt to Council mode (singular vs plural).",returns:"Pronoun string (my/our, mine/ours, me/us, or I/we)",returnType:"string",exampleUsage:["{{lumiaSelf::1}}","{{lumiaSelf::2}}","{{lumiaSelf::3}}","{{lumiaSelf::4}}"]}),e.registerMacro("lumiaCouncilModeActive",{handler:()=>{var e;const n=(0,r.mt)();return n.councilMode&&null!==(e=n.councilMembers)&&void 0!==e&&e.length?"yes":"no"},description:"Returns Council Mode status indicator. 'yes' if active with members, 'no' otherwise. ST Conditional Compatible.",returns:"'yes' if enabled, 'no' if disabled. ST Conditional Compatible.",returnType:"string",exampleUsage:["{{lumiaCouncilModeActive}}"]});const n=e=>{var n,t,i;let{resolve:a}=e;const o=(0,r.mt)();if(!1===o.lumiaQuirksEnabled||null===(n=o.lumiaQuirks)||void 0===n||!n.trim())return"";const s=o.councilMode&&(null===(t=o.councilMembers)||void 0===t?void 0:t.length)>0,l=o.chimeraMode&&(null===(i=o.selectedDefinitions)||void 0===i?void 0:i.length)>0;let c;c=s?"**Council Quirks**\nThere are a few extra behavioral quirks to the council today.":l?"**Chimera Quirks**\nThere are a few extra behavioral quirks to this fused form.":"**Behavioral Quirks**\nThere are a few extra behavioral quirks to embody.";const u="".concat(c," They are as follows:\n").concat(o.lumiaQuirks.trim());return a?a(u):u};e.registerMacro("lumiaQuirks",{delayArgResolution:!0,handler:n,description:"Returns formatted behavioral quirks when quirks text is set. Works in all modes (single, chimera, council).",returns:"Formatted quirks prompt or empty string",returnType:"string",exampleUsage:["{{lumiaQuirks}}"]}),e.registerMacro("lumiaCouncilQuirks",{delayArgResolution:!0,handler:n,description:"[Deprecated - use {{lumiaQuirks}}] Alias for lumiaQuirks macro.",returns:"Formatted quirks prompt or empty string",returnType:"string",exampleUsage:["{{lumiaCouncilQuirks}}"]}),e.registerMacro("lumiaStateSynthesis",{delayArgResolution:!0,handler:e=>{var n,t,i,a;let{resolve:o}=e;const s=(0,r.mt)();if(s.councilMode&&(null===(n=s.councilMembers)||void 0===n?void 0:n.length)>0){const e=s.councilMembers.length,n="**Council Sound-Off**\nThe council consists of ".concat(e," distinct members, each with their own voice, perspective, and mannerisms. Council dynamics require:\n- Each member maintains their UNIQUE personality—do not blend or homogenize voices\n- Members should react to and engage WITH EACH OTHER: debate, agree, tease, support, challenge\n- Acknowledge what other council members say or do; don't ignore fellow members\n- Have genuine conversations and interactions, not just sequential monologues\n- Show interpersonal dynamics: alliances, rivalries, inside jokes, shared history\n- Let personality clashes and harmonies emerge naturally between members");return o?o(n):n}const l=((null===(t=s.selectedBehaviors)||void 0===t?void 0:t.length)||0)>1,c=((null===(i=s.selectedPersonalities)||void 0===i?void 0:i.length)||0)>1,u=s.chimeraMode&&((null===(a=s.selectedDefinitions)||void 0===a?void 0:a.length)||0)>1;if(!l&&!c&&!u)return"";const d="**State Synthesis**\nAssess each active personality component. Affirm synthesis: My body is [details, clothing, shape]. I am {trait 1}, {trait 2}... So I am [blended description]. Recall how this synthesized self speaks and acts—adopt ALL active traits harmoniously. Never dull or stale.";return o?o(d):d},description:"Smart synthesis macro. Council mode: soundoff for member interaction. Non-council: synthesis when multiple traits active.",returns:"Appropriate prompt or empty string",returnType:"string",exampleUsage:["{{lumiaStateSynthesis}}"]})}},417(e){e.exports=function(e,n){return n||(n={}),e?(e=String(e.__esModule?e.default:e),/^['"].*['"]$/.test(e)&&(e=e.slice(1,-1)),n.hash&&(e+=n.hash),/["'() \t\n]|(%20)/.test(e)||n.needQuotes?'"'.concat(e.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):e):e}},456(e,n,t){t.d(n,{A:()=>h});var r=t(601),i=t.n(r),a=t(314),o=t.n(a),s=t(417),l=t.n(s),c=new URL(t(919),t.b),u=new URL(t(796),t.b),d=new URL(t(43),t.b),m=o()(i()),p=l()(c),g=l()(u),v=l()(d);m.push([e.id,`/* ========================================\n   Lumiverse Helper - React UI Styles\n   Apple-esque minimal design with dark theme\n   Inspired by oldLumiverseCode/style.css\n   ======================================== */\n\n/* CSS Custom Properties - Purple accent color scheme */\n:root {\n    /* Primary purple accent (matching old design) */\n    --lumiverse-primary: rgba(147, 112, 219, 0.9);\n    --lumiverse-primary-hover: rgba(167, 132, 239, 0.95);\n    --lumiverse-primary-light: rgba(147, 112, 219, 0.1);\n    --lumiverse-primary-muted: rgba(147, 112, 219, 0.6);\n    --lumiverse-primary-text: rgba(186, 135, 255, 0.95);\n\n    /* Secondary gray tones */\n    --lumiverse-secondary: rgba(128, 128, 128, 0.15);\n    --lumiverse-secondary-hover: rgba(128, 128, 128, 0.25);\n    --lumiverse-secondary-border: rgba(128, 128, 128, 0.25);\n\n    /* Status colors */\n    --lumiverse-danger: #ef4444;\n    --lumiverse-danger-hover: #dc2626;\n    --lumiverse-success: #22c55e;\n    --lumiverse-warning: #f59e0b;\n\n    /* Dark purple-tinted backgrounds (matching old design) */\n    --lumiverse-bg: rgba(28, 24, 38, 0.95);\n    --lumiverse-bg-elevated: rgba(35, 30, 48, 0.9);\n    --lumiverse-bg-hover: rgba(45, 40, 58, 0.9);\n    --lumiverse-bg-dark: rgba(0, 0, 0, 0.15);\n    --lumiverse-bg-darker: rgba(0, 0, 0, 0.25);\n\n    /* Subtle purple-tinted borders */\n    --lumiverse-border: rgba(147, 112, 219, 0.12);\n    --lumiverse-border-hover: rgba(147, 112, 219, 0.25);\n    --lumiverse-border-light: rgba(128, 128, 128, 0.12);\n\n    /* Text colors with proper opacity */\n    --lumiverse-text: rgba(255, 255, 255, 0.9);\n    --lumiverse-text-muted: rgba(255, 255, 255, 0.65);\n    --lumiverse-text-dim: rgba(255, 255, 255, 0.4);\n    --lumiverse-text-hint: rgba(255, 255, 255, 0.3);\n\n    /* Consistent border radii */\n    --lumiverse-radius-sm: 5px;\n    --lumiverse-radius: 8px;\n    --lumiverse-radius-md: 10px;\n    --lumiverse-radius-lg: 12px;\n    --lumiverse-radius-xl: 16px;\n\n    /* Shadows */\n    --lumiverse-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);\n    --lumiverse-shadow-lg: 0 24px 80px rgba(0, 0, 0, 0.5), 0 0 1px rgba(147, 112, 219, 0.3);\n\n    /* Smooth transitions (200ms like old design) */\n    --lumiverse-transition: 200ms ease;\n    --lumiverse-transition-fast: 150ms ease;\n\n    /* Typography */\n    --lumiverse-font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", sans-serif;\n    --lumiverse-font-mono: "SF Mono", "Menlo", "Monaco", "Consolas", monospace;\n}\n\n/* ========================================\n   LUMIA SETTINGS PANEL - Exact replica\n   Modern Apple-esque minimal design\n   (from oldLumiverseCode/style.css)\n   ======================================== */\n\n.lumia-injector-settings {\n    padding: 0;\n    font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", sans-serif;\n}\n\n/* Panel Container */\n.lumia-panel {\n    margin-bottom: 12px;\n    background: linear-gradient(\n        165deg,\n        rgba(28, 24, 38, 0.6) 0%,\n        rgba(35, 30, 48, 0.5) 100%\n    );\n    border: 1px solid rgba(147, 112, 219, 0.12);\n    border-radius: 12px;\n    overflow: hidden;\n    transition: border-color 0.2s ease;\n}\n\n.lumia-panel:hover {\n    border-color: rgba(147, 112, 219, 0.25);\n}\n\n/* Panel Header */\n.lumia-panel-header {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 12px 14px;\n    background: linear-gradient(\n        180deg,\n        rgba(147, 112, 219, 0.08) 0%,\n        transparent 100%\n    );\n    border-bottom: 1px solid rgba(147, 112, 219, 0.08);\n}\n\n.lumia-panel-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 20px;\n    height: 20px;\n    flex-shrink: 0;\n}\n\n.lumia-panel-icon svg {\n    width: 18px;\n    height: 18px;\n    stroke: rgba(147, 112, 219, 0.8);\n}\n\n.lumia-panel-title {\n    font-size: 13px;\n    font-weight: 600;\n    color: rgba(255, 255, 255, 0.9);\n    letter-spacing: -0.1px;\n    flex-grow: 1;\n}\n\n/* Collapsible Panel */\n.lumia-panel-collapsible {\n    cursor: default;\n}\n\n.lumia-panel-header-clickable {\n    cursor: pointer;\n    list-style: none;\n    user-select: none;\n}\n\n.lumia-panel-header-clickable::-webkit-details-marker {\n    display: none;\n}\n\n.lumia-panel-chevron {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 20px;\n    height: 20px;\n    transition: transform 0.2s ease;\n}\n\n.lumia-panel-chevron svg {\n    width: 16px;\n    height: 16px;\n    stroke: rgba(255, 255, 255, 0.4);\n}\n\ndetails.lumia-panel[open] .lumia-panel-chevron {\n    transform: rotate(180deg);\n}\n\n/* Panel Content */\n.lumia-panel-content {\n    padding: 14px;\n}\n\n/* Status Badge */\n.lumia-status-badge {\n    display: inline-flex;\n    align-items: center;\n    padding: 6px 12px;\n    margin-bottom: 12px;\n    background: rgba(147, 112, 219, 0.1);\n    border: 1px solid rgba(147, 112, 219, 0.2);\n    border-radius: 20px;\n    font-size: 12px;\n    font-weight: 500;\n    color: rgba(186, 135, 255, 0.9);\n    letter-spacing: 0.1px;\n}\n\n/* Input Row */\n.lumia-input-row {\n    display: flex;\n    gap: 8px;\n    margin-bottom: 10px;\n}\n\n.lumia-input {\n    flex: 1;\n    padding: 10px 14px;\n    background: rgba(0, 0, 0, 0.25);\n    border: 1px solid rgba(128, 128, 128, 0.2);\n    border-radius: 8px;\n    font-size: 13px;\n    color: rgba(255, 255, 255, 0.9);\n    transition: all 0.2s ease;\n    font-family: inherit;\n}\n\n.lumia-input::placeholder {\n    color: rgba(255, 255, 255, 0.35);\n}\n\n.lumia-input:focus {\n    outline: none;\n    border-color: rgba(147, 112, 219, 0.5);\n    background: rgba(0, 0, 0, 0.35);\n}\n\n/* Source Actions - centered buttons with dividers */\n.lumia-source-actions {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n}\n\n.lumia-source-actions .lumia-btn-full {\n    width: 100%;\n    max-width: 100%;\n}\n\n/* Divider Text */\n.lumia-divider-text {\n    text-align: center;\n    font-size: 11px;\n    font-weight: 500;\n    color: rgba(255, 255, 255, 0.3);\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    margin: 12px 0;\n    position: relative;\n}\n\n.lumia-divider-text::before,\n.lumia-divider-text::after {\n    content: "";\n    position: absolute;\n    top: 50%;\n    width: calc(50% - 20px);\n    height: 1px;\n    background: rgba(128, 128, 128, 0.2);\n}\n\n.lumia-divider-text::before {\n    left: 0;\n}\n\n.lumia-divider-text::after {\n    right: 0;\n}\n\n/* Buttons */\n.lumia-btn {\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    gap: 8px;\n    padding: 10px 16px;\n    border: none;\n    border-radius: 8px;\n    font-size: 13px;\n    font-weight: 500;\n    font-family: inherit;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    white-space: nowrap;\n}\n\n.lumia-btn svg {\n    width: 16px;\n    height: 16px;\n    flex-shrink: 0;\n}\n\n.lumia-btn-primary {\n    background: linear-gradient(\n        135deg,\n        rgba(147, 112, 219, 0.9) 0%,\n        rgba(123, 95, 196, 0.9) 100%\n    );\n    color: white;\n}\n\n.lumia-btn-primary:hover {\n    background: linear-gradient(\n        135deg,\n        rgba(167, 132, 239, 0.95) 0%,\n        rgba(143, 115, 216, 0.95) 100%\n    );\n    transform: translateY(-1px);\n}\n\n.lumia-btn-secondary {\n    background: rgba(128, 128, 128, 0.15);\n    border: 1px solid rgba(128, 128, 128, 0.25);\n    color: rgba(255, 255, 255, 0.85);\n}\n\n.lumia-btn-secondary:hover {\n    background: rgba(128, 128, 128, 0.25);\n    border-color: rgba(147, 112, 219, 0.3);\n}\n\n.lumia-btn-full {\n    width: 100%;\n}\n\n.lumia-btn-sm {\n    padding: 6px 12px;\n    font-size: 12px;\n    background: rgba(147, 112, 219, 0.15);\n    border: 1px solid rgba(147, 112, 219, 0.25);\n    color: rgba(186, 135, 255, 0.95);\n}\n\n.lumia-btn-sm:hover {\n    background: rgba(147, 112, 219, 0.25);\n    border-color: rgba(147, 112, 219, 0.4);\n}\n\n.lumia-btn-icon {\n    padding: 6px;\n    background: transparent;\n    border: none;\n}\n\n.lumia-btn-icon:hover {\n    background: rgba(147, 112, 219, 0.15);\n}\n\n.lumia-btn-icon svg {\n    width: 14px;\n    height: 14px;\n    stroke: rgba(186, 135, 255, 0.8);\n}\n\n/* Danger Button */\n.lumia-btn-danger {\n    background: linear-gradient(\n        135deg,\n        rgba(220, 53, 69, 0.9) 0%,\n        rgba(185, 45, 58, 0.9) 100%\n    );\n    color: rgba(255, 255, 255, 0.95);\n    border: 1px solid rgba(220, 53, 69, 0.4);\n}\n\n.lumia-btn-danger:hover {\n    background: linear-gradient(\n        135deg,\n        rgba(240, 73, 89, 0.95) 0%,\n        rgba(205, 65, 78, 0.95) 100%\n    );\n    transform: translateY(-1px);\n}\n\n.lumia-btn-danger svg {\n    stroke: rgba(255, 255, 255, 0.9);\n    margin-right: 6px;\n}\n\n/* Danger Zone Section */\n.lumia-danger-zone {\n    display: flex;\n    flex-direction: column;\n    gap: 12px;\n}\n\n.lumia-danger-zone-description {\n    font-size: 12px;\n    color: rgba(255, 255, 255, 0.6);\n    line-height: 1.5;\n    margin: 0;\n}\n\n/* Selector Group */\n.lumia-selector-group {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n}\n\n.lumia-selector {\n    background: rgba(0, 0, 0, 0.15);\n    border: 1px solid rgba(128, 128, 128, 0.12);\n    border-radius: 10px;\n    padding: 12px 14px;\n    transition: all 0.2s ease;\n}\n\n.lumia-selector:hover {\n    border-color: rgba(147, 112, 219, 0.2);\n    background: rgba(0, 0, 0, 0.2);\n}\n\n.lumia-selector-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 8px;\n}\n\n.lumia-selector-label {\n    font-size: 12px;\n    font-weight: 600;\n    color: rgba(255, 255, 255, 0.8);\n    letter-spacing: 0.1px;\n}\n\n.lumia-selector-hint {\n    font-size: 10px;\n    font-weight: 500;\n    color: rgba(147, 112, 219, 0.6);\n    text-transform: uppercase;\n    letter-spacing: 0.3px;\n}\n\n.lumia-selector-row {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n}\n\n.lumia-selector-value {\n    flex: 1;\n    font-size: 13px;\n    font-weight: 500;\n    color: rgba(255, 255, 255, 0.65);\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n    min-width: 0;\n}\n\n/* Selector Group Disabled State (Council Mode Active) */\n.lumia-selector-group--disabled {\n    opacity: 0.5;\n    pointer-events: none;\n    filter: grayscale(30%);\n}\n\n/* Council Notice */\n.lumia-council-notice {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 10px 14px;\n    margin-bottom: 12px;\n    background: linear-gradient(\n        135deg,\n        rgba(147, 112, 219, 0.15) 0%,\n        rgba(100, 80, 180, 0.1) 100%\n    );\n    border: 1px solid rgba(147, 112, 219, 0.25);\n    border-radius: 8px;\n    font-size: 12px;\n    font-weight: 500;\n    color: rgba(186, 135, 255, 0.9);\n}\n\n.lumia-council-notice svg {\n    flex-shrink: 0;\n    stroke: rgba(186, 135, 255, 0.8);\n}\n\n/* Council Config Button (in SettingsPanel) */\n.lumia-council-config-btn {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    width: 100%;\n    padding: 12px 14px;\n    margin-bottom: 12px;\n    background: linear-gradient(\n        135deg,\n        rgba(147, 112, 219, 0.12) 0%,\n        rgba(147, 112, 219, 0.06) 100%\n    );\n    border: 1px solid rgba(147, 112, 219, 0.3);\n    border-radius: 10px;\n    color: var(--lumiverse-text);\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumia-council-config-btn:hover {\n    background: linear-gradient(\n        135deg,\n        rgba(147, 112, 219, 0.18) 0%,\n        rgba(147, 112, 219, 0.1) 100%\n    );\n    border-color: rgba(147, 112, 219, 0.5);\n}\n\n.lumia-council-config-btn svg {\n    flex-shrink: 0;\n    color: var(--lumiverse-primary);\n}\n\n.lumia-council-config-text {\n    flex: 1;\n    text-align: left;\n    font-size: 13px;\n    font-weight: 500;\n}\n\n.lumia-council-config-action {\n    padding: 4px 10px;\n    background: rgba(147, 112, 219, 0.2);\n    border-radius: 6px;\n    font-size: 11px;\n    font-weight: 600;\n    color: var(--lumiverse-primary);\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n.lumia-council-config-btn:hover .lumia-council-config-action {\n    background: var(--lumiverse-primary);\n    color: white;\n}\n\n/* ----------------------------------------\n   Quick Actions Section\n   ---------------------------------------- */\n.lumia-quick-actions {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    margin-bottom: 12px;\n    flex-wrap: wrap;\n}\n\n.lumia-quick-action-group {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    flex: 1;\n    min-width: 0;\n}\n\n.lumia-quick-action-btn {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 6px;\n    padding: 8px 12px;\n    background: rgba(30, 30, 46, 0.6);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    border-radius: 8px;\n    color: var(--lumiverse-text-secondary);\n    font-size: 12px;\n    font-weight: 500;\n    cursor: pointer;\n    transition: all 0.15s ease;\n    white-space: nowrap;\n    font-family: inherit;\n}\n\n.lumia-quick-action-btn:hover:not(:disabled) {\n    background: rgba(30, 30, 46, 0.8);\n    border-color: rgba(147, 112, 219, 0.3);\n    color: var(--lumiverse-text-primary);\n}\n\n.lumia-quick-action-btn--council {\n    flex-shrink: 0;\n}\n\n.lumia-quick-action-btn--disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n}\n\n.lumia-quick-action-btn--primary {\n    background: rgba(147, 112, 219, 0.15);\n    border-color: rgba(147, 112, 219, 0.3);\n    color: var(--lumiverse-primary);\n    padding: 8px 10px;\n}\n\n.lumia-quick-action-btn--primary:hover:not(:disabled) {\n    background: rgba(147, 112, 219, 0.25);\n    border-color: rgba(147, 112, 219, 0.5);\n}\n\n.lumia-quick-action-btn--active {\n    background: rgba(147, 112, 219, 0.1);\n    border-color: rgba(147, 112, 219, 0.3);\n    color: var(--lumiverse-primary);\n}\n\n.lumia-quick-action-text {\n    max-width: 100px;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumia-quick-action-chevron {\n    transition: transform 0.15s ease;\n    flex-shrink: 0;\n}\n\n.lumia-quick-action-chevron--open {\n    transform: rotate(180deg);\n}\n\n/* Dropdown */\n.lumia-quick-action-dropdown-wrapper {\n    position: relative;\n    flex: 1;\n    min-width: 0;\n}\n\n.lumia-quick-action-dropdown {\n    position: absolute;\n    top: calc(100% + 4px);\n    left: 0;\n    right: 0;\n    min-width: 140px;\n    background: rgba(25, 25, 35, 0.98);\n    border: 1px solid rgba(255, 255, 255, 0.12);\n    border-radius: 8px;\n    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);\n    z-index: 100;\n    max-height: 200px;\n    overflow-y: auto;\n}\n\n.lumia-quick-action-dropdown-empty {\n    padding: 12px;\n    text-align: center;\n    color: var(--lumiverse-text-muted);\n    font-size: 11px;\n}\n\n.lumia-quick-action-dropdown-item {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    width: 100%;\n    padding: 10px 12px;\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text-secondary);\n    font-size: 12px;\n    text-align: left;\n    cursor: pointer;\n    transition: all 0.1s ease;\n    font-family: inherit;\n}\n\n.lumia-quick-action-dropdown-item:hover {\n    background: rgba(147, 112, 219, 0.1);\n    color: var(--lumiverse-text-primary);\n}\n\n.lumia-quick-action-dropdown-item--active {\n    background: rgba(147, 112, 219, 0.15);\n    color: var(--lumiverse-primary);\n}\n\n.lumia-quick-action-dropdown-item svg {\n    flex-shrink: 0;\n}\n\n/* Form */\n.lumia-quick-action-form {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    flex: 1;\n    min-width: 0;\n}\n\n.lumia-quick-action-input {\n    flex: 1;\n    min-width: 0;\n    padding: 8px 10px;\n    background: rgba(30, 30, 46, 0.8);\n    border: 1px solid rgba(147, 112, 219, 0.3);\n    border-radius: 6px;\n    color: var(--lumiverse-text-primary);\n    font-size: 12px;\n    font-family: inherit;\n}\n\n.lumia-quick-action-input:focus {\n    outline: none;\n    border-color: rgba(147, 112, 219, 0.6);\n}\n\n.lumia-quick-action-input::placeholder {\n    color: var(--lumiverse-text-muted);\n}\n\n/* Responsive adjustments */\n@media (max-width: 480px) {\n    .lumia-quick-actions {\n        flex-direction: column;\n        align-items: stretch;\n    }\n\n    .lumia-quick-action-btn--council {\n        width: 100%;\n    }\n\n    .lumia-quick-action-group {\n        width: 100%;\n    }\n\n    .lumia-quick-action-text {\n        max-width: none;\n    }\n}\n\n/* Clear All Button */\n.lumia-clear-all-btn {\n    display: inline-flex;\n    align-items: center;\n    gap: 6px;\n    padding: 5px 10px;\n    background: rgba(239, 68, 68, 0.1);\n    border: 1px solid rgba(239, 68, 68, 0.2);\n    border-radius: 6px;\n    font-size: 11px;\n    font-weight: 500;\n    color: rgba(239, 68, 68, 0.8);\n    cursor: pointer;\n    transition: all 0.2s ease;\n    font-family: inherit;\n}\n\n.lumia-clear-all-btn:hover {\n    background: rgba(239, 68, 68, 0.2);\n    border-color: rgba(239, 68, 68, 0.4);\n    color: rgba(239, 68, 68, 1);\n}\n\n.lumia-clear-all-btn svg {\n    width: 14px;\n    height: 14px;\n}\n\n/* Panel Action (header button area) */\n.lumia-panel-action {\n    display: flex;\n    align-items: center;\n    margin-left: auto;\n}\n\n/* Panel Chevron for collapsible panels */\n.lumia-panel-chevron--expanded {\n    transform: rotate(180deg);\n}\n\n/* Tools Row */\n.lumia-tools-row {\n    display: grid;\n    grid-template-columns: repeat(2, 1fr);\n    gap: 10px;\n}\n\n.lumia-tool-btn {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    gap: 8px;\n    padding: 16px 12px;\n    background: rgba(0, 0, 0, 0.15);\n    border: 1px solid rgba(128, 128, 128, 0.12);\n    border-radius: 10px;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumia-tool-btn svg {\n    width: 22px;\n    height: 22px;\n    stroke: rgba(147, 112, 219, 0.7);\n    transition: stroke 0.2s ease;\n}\n\n.lumia-tool-btn span {\n    font-size: 12px;\n    font-weight: 500;\n    color: rgba(255, 255, 255, 0.75);\n    font-family: inherit;\n}\n\n.lumia-tool-btn:hover {\n    background: rgba(147, 112, 219, 0.1);\n    border-color: rgba(147, 112, 219, 0.25);\n}\n\n.lumia-tool-btn:hover svg {\n    stroke: rgba(186, 135, 255, 0.9);\n}\n\n.lumia-tool-btn-accent {\n    background: linear-gradient(\n        135deg,\n        rgba(147, 112, 219, 0.2) 0%,\n        rgba(123, 95, 196, 0.15) 100%\n    );\n    border-color: rgba(147, 112, 219, 0.35);\n}\n\n.lumia-tool-btn-accent svg {\n    stroke: rgba(186, 135, 255, 0.9);\n}\n\n.lumia-tool-btn-accent span {\n    color: rgba(186, 135, 255, 0.95);\n}\n\n.lumia-tool-btn-accent:hover {\n    background: linear-gradient(\n        135deg,\n        rgba(147, 112, 219, 0.3) 0%,\n        rgba(123, 95, 196, 0.25) 100%\n    );\n    border-color: rgba(147, 112, 219, 0.5);\n}\n\n/* Macro Reference */\n.lumia-macro-reference {\n    display: flex;\n    flex-direction: column;\n    gap: 14px;\n}\n\n.lumia-macro-group {\n    display: flex;\n    flex-direction: column;\n    gap: 6px;\n}\n\n.lumia-macro-group-title {\n    font-size: 10px;\n    font-weight: 600;\n    color: rgba(147, 112, 219, 0.7);\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    margin-bottom: 2px;\n}\n\n.lumia-macro-list {\n    display: flex;\n    flex-direction: column;\n    gap: 4px;\n}\n\n.lumia-macro {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 6px 0;\n    cursor: pointer;\n    transition: opacity 0.2s ease;\n}\n\n.lumia-macro:hover {\n    opacity: 0.85;\n}\n\n.lumia-macro--copied {\n    opacity: 1;\n}\n\n.lumia-macro--copied code {\n    background: rgba(147, 112, 219, 0.25);\n    border-color: rgba(147, 112, 219, 0.4);\n}\n\n.lumia-macro code {\n    font-family: "SF Mono", "Menlo", "Monaco", "Consolas", monospace;\n    font-size: 11px;\n    padding: 4px 8px;\n    background: rgba(0, 0, 0, 0.3);\n    border: 1px solid rgba(128, 128, 128, 0.15);\n    border-radius: 5px;\n    color: rgba(186, 135, 255, 0.95);\n    white-space: nowrap;\n    transition: all 0.2s ease;\n}\n\n.lumia-macro span {\n    font-size: 12px;\n    color: rgba(255, 255, 255, 0.55);\n}\n\n/* Custom Packs */\n.lumia-custom-packs {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumia-pack-item {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 10px 12px;\n    background: rgba(0, 0, 0, 0.15);\n    border: 1px solid rgba(128, 128, 128, 0.12);\n    border-radius: 8px;\n    transition: all 0.2s ease;\n}\n\n.lumia-pack-item:hover {\n    border-color: rgba(147, 112, 219, 0.2);\n    background: rgba(0, 0, 0, 0.2);\n}\n\n.lumia-pack-name {\n    flex: 1;\n    font-size: 13px;\n    font-weight: 500;\n    color: rgba(255, 255, 255, 0.85);\n}\n\n.lumia-pack-count {\n    font-size: 11px;\n    color: rgba(147, 112, 219, 0.7);\n    padding: 2px 8px;\n    background: rgba(147, 112, 219, 0.1);\n    border-radius: 10px;\n}\n\n/* Expandable Pack Container */\n.lumia-pack-item-container {\n    border-radius: 8px;\n    overflow: hidden;\n}\n\n.lumia-pack-item-container--expanded {\n    background: rgba(0, 0, 0, 0.08);\n    border: 1px solid rgba(147, 112, 219, 0.15);\n}\n\n.lumia-pack-item-container--expanded .lumia-pack-item {\n    border-bottom: 1px solid rgba(128, 128, 128, 0.1);\n    border-radius: 8px 8px 0 0;\n}\n\n/* Expand button */\n.lumia-pack-expand-btn {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 24px;\n    height: 24px;\n    padding: 0;\n    background: transparent;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n    color: rgba(255, 255, 255, 0.5);\n    transition: all 0.2s ease;\n}\n\n.lumia-pack-expand-btn:hover {\n    background: rgba(147, 112, 219, 0.15);\n    color: rgba(255, 255, 255, 0.8);\n}\n\n/* Chevron rotation */\n.lumia-pack-chevron {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: transform 0.2s ease;\n}\n\n.lumia-pack-chevron svg {\n    width: 14px;\n    height: 14px;\n}\n\n.lumia-pack-chevron--expanded {\n    transform: rotate(180deg);\n}\n\n/* Expanded Lumia items list */\n.lumia-pack-items-list {\n    display: flex;\n    flex-direction: column;\n    padding: 4px 8px 8px 8px;\n    overflow: hidden;\n}\n\n/* Individual Lumia item in expanded list */\n.lumia-pack-lumia-item {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    padding: 8px 10px;\n    margin-top: 4px;\n    background: rgba(0, 0, 0, 0.12);\n    border: 1px solid rgba(128, 128, 128, 0.08);\n    border-radius: 6px;\n    transition: all 0.15s ease;\n}\n\n.lumia-pack-lumia-item:hover {\n    background: rgba(0, 0, 0, 0.18);\n    border-color: rgba(147, 112, 219, 0.2);\n}\n\n/* Lumia avatar in expanded list */\n.lumia-pack-lumia-avatar {\n    width: 28px;\n    height: 28px;\n    border-radius: 50%;\n    object-fit: cover;\n    border: 1px solid rgba(147, 112, 219, 0.2);\n    flex-shrink: 0;\n    animation: lumiverseFadeIn 0.2s ease;\n}\n\n/* Lumia name in expanded list */\n.lumia-pack-lumia-name {\n    flex: 1;\n    font-size: 12px;\n    font-weight: 500;\n    color: rgba(255, 255, 255, 0.8);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n/* Small icon button */\n.lumia-btn-icon-sm {\n    width: 24px !important;\n    height: 24px !important;\n    padding: 0 !important;\n    font-size: 12px;\n}\n\n.lumia-btn-icon-sm svg {\n    width: 12px;\n    height: 12px;\n}\n\n/* Empty state for expanded pack */\n.lumia-pack-items-empty {\n    padding: 12px;\n    text-align: center;\n    overflow: hidden;\n}\n\n.lumia-pack-items-empty span {\n    font-size: 12px;\n    color: rgba(255, 255, 255, 0.4);\n    font-style: italic;\n}\n\n/* ----------------------------------------\n   Base App Container\n   ---------------------------------------- */\n.lumiverse-app {\n    font-family: var(--lumiverse-font-family);\n    color: var(--lumiverse-text);\n    font-size: 14px;\n    line-height: 1.5;\n}\n\n.lumiverse-react-root {\n    margin: 0;\n    padding: 0;\n}\n\n/* ----------------------------------------\n   Settings Panel - Main container with gradient background\n   ---------------------------------------- */\n.lumiverse-settings-panel {\n    background: linear-gradient(\n        165deg,\n        rgba(28, 24, 38, 0.95) 0%,\n        rgba(35, 30, 48, 0.9) 100%\n    );\n    border-radius: var(--lumiverse-radius-lg);\n    border: 1px solid var(--lumiverse-border);\n    overflow: hidden;\n    transition: border-color var(--lumiverse-transition);\n}\n\n.lumiverse-settings-panel:hover {\n    border-color: var(--lumiverse-border-hover);\n}\n\n.lumiverse-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 12px 14px;\n    background: linear-gradient(\n        180deg,\n        rgba(147, 112, 219, 0.08) 0%,\n        transparent 100%\n    );\n    border-bottom: 1px solid rgba(147, 112, 219, 0.08);\n}\n\n.lumiverse-header-badge {\n    font-size: 10px;\n    font-weight: 500;\n    padding: 4px 8px;\n    background: var(--lumiverse-primary-light);\n    border: 1px solid rgba(147, 112, 219, 0.2);\n    border-radius: 12px;\n    color: var(--lumiverse-primary-text);\n    text-transform: uppercase;\n    letter-spacing: 0.3px;\n}\n\n.lumiverse-title {\n    margin: 0;\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    letter-spacing: -0.1px;\n}\n\n/* ----------------------------------------\n   Sections (Collapsible) - Panel-like sections\n   ---------------------------------------- */\n.lumiverse-section {\n    margin-bottom: 0;\n    background: linear-gradient(\n        165deg,\n        rgba(28, 24, 38, 0.6) 0%,\n        rgba(35, 30, 48, 0.5) 100%\n    );\n    border-bottom: 1px solid var(--lumiverse-border);\n    transition: border-color var(--lumiverse-transition);\n}\n\n.lumiverse-section:last-child {\n    border-bottom: none;\n}\n\n.lumiverse-section:hover {\n    border-color: var(--lumiverse-border-hover);\n}\n\n.lumiverse-section-header {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    width: 100%;\n    padding: 12px 14px;\n    background: linear-gradient(\n        180deg,\n        rgba(147, 112, 219, 0.08) 0%,\n        transparent 100%\n    );\n    border: none;\n    border-bottom: 1px solid rgba(147, 112, 219, 0.08);\n    color: var(--lumiverse-text);\n    font-size: 13px;\n    font-weight: 600;\n    cursor: pointer;\n    transition: background var(--lumiverse-transition);\n    letter-spacing: -0.1px;\n}\n\n.lumiverse-section-header:hover {\n    background: linear-gradient(\n        180deg,\n        rgba(147, 112, 219, 0.12) 0%,\n        rgba(147, 112, 219, 0.04) 100%\n    );\n}\n\n.lumiverse-section-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 20px;\n    height: 20px;\n    flex-shrink: 0;\n    font-size: 16px;\n}\n\n.lumiverse-section-title {\n    flex: 1;\n    text-align: left;\n}\n\n.lumiverse-section-chevron {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 20px;\n    height: 20px;\n    font-size: 10px;\n    color: var(--lumiverse-text-dim);\n    transition: transform var(--lumiverse-transition);\n}\n\n.lumiverse-section-chevron.rotated {\n    transform: rotate(180deg);\n}\n\n.lumiverse-section-content {\n    padding: 14px;\n    background: transparent;\n}\n\n/* ----------------------------------------\n   Toggle Switch\n   ---------------------------------------- */\n.lumiverse-toggle-wrapper {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 8px 0;\n    cursor: pointer;\n}\n\n.lumiverse-toggle-text {\n    flex: 1;\n    margin-right: 12px;\n}\n\n.lumiverse-toggle-label {\n    display: block;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-toggle-description {\n    display: block;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n    margin-top: 2px;\n}\n\n.lumiverse-toggle {\n    position: relative;\n    width: 44px;\n    height: 24px;\n    background: var(--lumiverse-secondary);\n    border-radius: 12px;\n    transition: background var(--lumiverse-transition);\n}\n\n.lumiverse-toggle--on {\n    background: var(--lumiverse-primary);\n}\n\n.lumiverse-toggle-input {\n    position: absolute;\n    opacity: 0;\n    width: 100%;\n    height: 100%;\n    cursor: pointer;\n}\n\n.lumiverse-toggle-slider {\n    position: absolute;\n    top: 2px;\n    left: 2px;\n    width: 20px;\n    height: 20px;\n    background: white;\n    border-radius: 50%;\n    transition: transform var(--lumiverse-transition);\n    pointer-events: none;\n}\n\n.lumiverse-toggle--on .lumiverse-toggle-slider {\n    transform: translateX(20px);\n}\n\n/* Drawer toggle container (settings panel) */\n.lumia-drawer-toggle-container {\n    margin-bottom: 12px;\n    padding: 12px 14px;\n    background: linear-gradient(\n        165deg,\n        rgba(28, 24, 38, 0.6) 0%,\n        rgba(35, 30, 48, 0.5) 100%\n    );\n    border: 1px solid rgba(147, 112, 219, 0.12);\n    border-radius: 12px;\n    transition: border-color 0.2s ease;\n}\n\n.lumia-drawer-toggle-container:hover {\n    border-color: rgba(147, 112, 219, 0.25);\n}\n\n/* Button position settings container */\n.lumia-button-position-container {\n    margin-bottom: 12px;\n    padding: 12px 14px;\n    background: linear-gradient(\n        165deg,\n        rgba(28, 24, 38, 0.5) 0%,\n        rgba(35, 30, 48, 0.4) 100%\n    );\n    border: 1px solid rgba(147, 112, 219, 0.1);\n    border-radius: 12px;\n    transition: border-color 0.2s ease;\n}\n\n.lumia-button-position-container:hover {\n    border-color: rgba(147, 112, 219, 0.2);\n}\n\n.lumia-button-position-inputs {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 12px;\n    margin-top: 12px;\n    padding-top: 12px;\n    border-top: 1px solid rgba(147, 112, 219, 0.1);\n}\n\n.lumia-position-field {\n    display: flex;\n    flex-direction: column;\n    gap: 4px;\n    flex: 1;\n    min-width: 100px;\n}\n\n.lumia-position-field label {\n    font-size: 0.75rem;\n    color: rgba(255, 255, 255, 0.6);\n    font-weight: 500;\n}\n\n.lumia-input-sm {\n    padding: 6px 10px;\n    font-size: 0.85rem;\n}\n\n.lumia-position-hint {\n    width: 100%;\n    font-size: 0.7rem;\n    color: rgba(147, 112, 219, 0.7);\n    font-style: italic;\n    margin-top: 4px;\n}\n\n/* Mode toggles container */\n.lumia-mode-toggles {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n    margin-bottom: 16px;\n    padding-bottom: 14px;\n    border-bottom: 1px solid rgba(147, 112, 219, 0.12);\n}\n\n/* Mode toggle row */\n.lumiverse-mode-toggle {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 10px 12px;\n    background: rgba(28, 24, 38, 0.4);\n    border: 1px solid rgba(147, 112, 219, 0.1);\n    border-radius: 10px;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-mode-toggle:hover {\n    background: rgba(147, 112, 219, 0.08);\n    border-color: rgba(147, 112, 219, 0.2);\n}\n\n.lumiverse-mode-toggle--disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n    pointer-events: none;\n}\n\n.lumiverse-mode-toggle-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 32px;\n    height: 32px;\n    background: rgba(147, 112, 219, 0.15);\n    border-radius: 8px;\n    flex-shrink: 0;\n}\n\n.lumiverse-mode-toggle-icon svg {\n    width: 18px;\n    height: 18px;\n    color: var(--lumiverse-primary);\n}\n\n.lumiverse-mode-toggle-text {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n    min-width: 0;\n}\n\n.lumiverse-mode-toggle-label {\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-mode-toggle-description {\n    font-size: 11px;\n    color: var(--lumiverse-muted);\n    line-height: 1.3;\n}\n\n/* Small toggle variant */\n.lumiverse-toggle--sm {\n    width: 36px;\n    height: 20px;\n    flex-shrink: 0;\n}\n\n.lumiverse-toggle--sm .lumiverse-toggle-slider {\n    width: 16px;\n    height: 16px;\n    top: 2px;\n    left: 2px;\n}\n\n.lumiverse-toggle--sm.lumiverse-toggle--on .lumiverse-toggle-slider {\n    transform: translateX(16px);\n}\n\n/* ----------------------------------------\n   Buttons - Apple-esque with gradients\n   ---------------------------------------- */\n.lumiverse-btn {\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    gap: 8px;\n    padding: 10px 16px;\n    font-size: 13px;\n    font-weight: 500;\n    font-family: inherit;\n    border-radius: var(--lumiverse-radius);\n    border: none;\n    cursor: pointer;\n    transition: all var(--lumiverse-transition);\n    white-space: nowrap;\n}\n\n.lumiverse-btn svg {\n    width: 16px;\n    height: 16px;\n    flex-shrink: 0;\n}\n\n.lumiverse-btn--primary {\n    background: linear-gradient(\n        135deg,\n        rgba(147, 112, 219, 0.9) 0%,\n        rgba(123, 95, 196, 0.9) 100%\n    );\n    color: white;\n}\n\n.lumiverse-btn--primary:hover {\n    background: linear-gradient(\n        135deg,\n        rgba(167, 132, 239, 0.95) 0%,\n        rgba(143, 115, 216, 0.95) 100%\n    );\n    transform: translateY(-1px);\n}\n\n.lumiverse-btn--secondary {\n    background: rgba(128, 128, 128, 0.15);\n    border: 1px solid rgba(128, 128, 128, 0.25);\n    color: rgba(255, 255, 255, 0.85);\n}\n\n.lumiverse-btn--secondary:hover {\n    background: rgba(128, 128, 128, 0.25);\n    border-color: rgba(147, 112, 219, 0.3);\n}\n\n.lumiverse-btn--danger {\n    background: linear-gradient(\n        135deg,\n        rgba(239, 68, 68, 0.9) 0%,\n        rgba(220, 38, 38, 0.9) 100%\n    );\n    color: white;\n}\n\n.lumiverse-btn--danger:hover {\n    background: linear-gradient(\n        135deg,\n        rgba(248, 113, 113, 0.95) 0%,\n        rgba(239, 68, 68, 0.95) 100%\n    );\n    transform: translateY(-1px);\n}\n\n.lumiverse-btn--icon {\n    padding: 6px;\n    min-width: auto;\n    background: transparent;\n    border: none;\n}\n\n.lumiverse-btn--icon:hover {\n    background: rgba(147, 112, 219, 0.15);\n}\n\n.lumiverse-btn-full {\n    width: 100%;\n}\n\n.lumiverse-btn-sm {\n    padding: 6px 12px;\n    font-size: 12px;\n    background: rgba(147, 112, 219, 0.15);\n    border: 1px solid rgba(147, 112, 219, 0.25);\n    color: var(--lumiverse-primary-text);\n}\n\n.lumiverse-btn-sm:hover {\n    background: rgba(147, 112, 219, 0.25);\n    border-color: rgba(147, 112, 219, 0.4);\n}\n\n/* ----------------------------------------\n   Selection Row\n   ---------------------------------------- */\n.lumiverse-selection-row {\n    display: flex;\n    align-items: center;\n    margin-bottom: 12px;\n}\n\n.lumiverse-selection-label {\n    width: 100px;\n    flex-shrink: 0;\n    font-weight: 500;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-selection-button {\n    flex: 1;\n    display: flex;\n    align-items: center;\n    padding: 10px 14px;\n    background: var(--lumiverse-bg-elevated);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    color: var(--lumiverse-text);\n    cursor: pointer;\n    transition: all var(--lumiverse-transition);\n}\n\n.lumiverse-selection-button:hover {\n    background: var(--lumiverse-bg-hover);\n    border-color: var(--lumiverse-border-light);\n}\n\n.lumiverse-selection-text {\n    flex: 1;\n    text-align: left;\n}\n\n.lumiverse-selection-dominant {\n    font-size: 12px;\n    color: var(--lumiverse-warning);\n    margin-left: 8px;\n}\n\n.lumiverse-selection-arrow {\n    margin-left: 8px;\n    color: var(--lumiverse-text-muted);\n}\n\n/* ----------------------------------------\n   Stats Bar\n   ---------------------------------------- */\n.lumiverse-stats {\n    display: flex;\n    align-items: center;\n    padding: 8px 12px;\n    margin-bottom: 16px;\n    background: var(--lumiverse-primary-light);\n    border-radius: var(--lumiverse-radius);\n    font-size: 13px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-stats-divider {\n    margin: 0 8px;\n}\n\n/* ----------------------------------------\n   Radio Group\n   ---------------------------------------- */\n.lumiverse-radio-group {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n    margin-top: 12px;\n}\n\n.lumiverse-radio {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    cursor: pointer;\n}\n\n.lumiverse-radio input[type="radio"] {\n    accent-color: var(--lumiverse-primary);\n}\n\n/* ----------------------------------------\n   Number Input\n   ---------------------------------------- */\n.lumiverse-number-wrapper {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n    margin-top: 12px;\n}\n\n.lumiverse-number-label {\n    font-weight: 500;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-number-input {\n    width: 80px;\n    padding: 8px 12px;\n    background: var(--lumiverse-bg-elevated);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    color: var(--lumiverse-text);\n    font-size: 14px;\n}\n\n.lumiverse-number-input:focus {\n    outline: none;\n    border-color: var(--lumiverse-primary);\n}\n\n/* ----------------------------------------\n   Pack Actions & List\n   ---------------------------------------- */\n.lumiverse-pack-actions {\n    display: flex;\n    gap: 8px;\n    margin-bottom: 16px;\n}\n\n.lumiverse-custom-packs h4 {\n    margin: 0 0 12px 0;\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--lumiverse-text-muted);\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n.lumiverse-pack-item {\n    display: flex;\n    align-items: center;\n    padding: 10px 12px;\n    background: var(--lumiverse-bg-elevated);\n    border-radius: var(--lumiverse-radius);\n    margin-bottom: 8px;\n}\n\n.lumiverse-pack-name {\n    flex: 1;\n    font-weight: 500;\n}\n\n.lumiverse-pack-count {\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n    margin-right: 8px;\n}\n\n/* ----------------------------------------\n   Loom Selections\n   ---------------------------------------- */\n.lumiverse-loom-selections {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n    margin-top: 12px;\n}\n\n/* ----------------------------------------\n   Modal Styles\n   ---------------------------------------- */\n.lumiverse-modal-backdrop {\n    position: fixed;\n    inset: 0;\n    background: rgba(0, 0, 0, 0.7);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    z-index: 10000;\n    padding: 16px;\n    box-sizing: border-box;\n}\n\n.lumiverse-modal {\n    background: var(--lumiverse-bg);\n    border-radius: var(--lumiverse-radius-lg);\n    border: 1px solid var(--lumiverse-border);\n    box-shadow: var(--lumiverse-shadow-lg);\n    max-height: 80vh;\n    display: flex;\n    flex-direction: column;\n    overflow: hidden;\n    min-height: 0; /* Critical: allows flex children to shrink below content size */\n}\n\n.lumiverse-modal--small {\n    width: 400px;\n}\n\n.lumiverse-modal--medium {\n    width: 560px;\n}\n\n.lumiverse-modal--large {\n    width: 800px;\n    max-width: 90vw;\n}\n\n/* Editor modals need their content to scroll, not the modal wrapper */\n.lumiverse-modal-lumia-editor,\n.lumiverse-modal-loom-editor,\n.lumiverse-modal-pack-editor {\n    min-height: 0; /* Ensure scrolling works in nested flex */\n}\n\n/* Mobile responsiveness for modals */\n@media (max-width: 600px) {\n    .lumiverse-modal-backdrop {\n        padding: 12px;\n        align-items: flex-start; /* Align to top on mobile for long modals */\n        padding-top: max(12px, env(safe-area-inset-top));\n        padding-bottom: max(12px, env(safe-area-inset-bottom));\n    }\n\n    .lumiverse-modal {\n        width: calc(100vw - 24px);\n        max-width: calc(100vw - 24px);\n        max-height: calc(100dvh - 24px);\n        max-height: calc(100vh - 24px); /* Fallback */\n        margin: auto;\n    }\n\n    .lumiverse-modal--small,\n    .lumiverse-modal--medium,\n    .lumiverse-modal--large {\n        width: calc(100vw - 24px);\n        max-width: calc(100vw - 24px);\n    }\n\n    /* Editor modals on mobile - maximize usable space */\n    .lumiverse-modal-lumia-editor,\n    .lumiverse-modal-loom-editor,\n    .lumiverse-modal-pack-editor {\n        max-height: calc(100dvh - 24px);\n        height: auto; /* Content determines height */\n        overflow: hidden; /* Contain the flex layout */\n    }\n}\n\n.lumiverse-modal-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 16px 20px;\n    background: var(--lumiverse-bg-elevated);\n    border-bottom: 1px solid var(--lumiverse-border);\n    flex-shrink: 0;\n}\n\n.lumiverse-modal-title {\n    margin: 0;\n    font-size: 18px;\n    font-weight: 600;\n}\n\n.lumiverse-modal-close {\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text-muted);\n    font-size: 18px;\n    cursor: pointer;\n    padding: 4px 8px;\n    border-radius: var(--lumiverse-radius-sm);\n    transition: all var(--lumiverse-transition);\n}\n\n.lumiverse-modal-close:hover {\n    background: var(--lumiverse-bg-hover);\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-modal-body {\n    flex: 1;\n    overflow: hidden;\n    display: flex;\n    flex-direction: column;\n    min-height: 0;\n}\n\n/* ----------------------------------------\n   Selection Modal\n   ---------------------------------------- */\n.lumiverse-selection-modal {\n    display: flex;\n    flex-direction: column;\n    height: 100%;\n}\n\n.lumiverse-selection-toolbar {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 12px 16px;\n    background: var(--lumiverse-bg-elevated);\n    border-bottom: 1px solid var(--lumiverse-border);\n}\n\n.lumiverse-selection-count {\n    font-size: 13px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-dominant-indicator {\n    margin-left: 8px;\n    color: var(--lumiverse-warning);\n}\n\n.lumiverse-selection-content {\n    flex: 1;\n    overflow-y: auto;\n    padding: 16px;\n}\n\n.lumiverse-selection-footer {\n    padding: 12px 16px;\n    background: var(--lumiverse-bg-elevated);\n    border-top: 1px solid var(--lumiverse-border);\n    display: flex;\n    justify-content: flex-end;\n}\n\n/* ----------------------------------------\n   Search Input\n   ---------------------------------------- */\n.lumiverse-search {\n    display: flex;\n    align-items: center;\n    background: var(--lumiverse-bg);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    padding: 0 12px;\n    flex: 1;\n    max-width: 300px;\n}\n\n.lumiverse-search-icon {\n    font-size: 14px;\n    margin-right: 8px;\n}\n\n.lumiverse-search-input {\n    flex: 1;\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text);\n    padding: 8px 0;\n    font-size: 14px;\n}\n\n.lumiverse-search-input:focus {\n    outline: none;\n}\n\n.lumiverse-search-input::placeholder {\n    color: var(--lumiverse-text-dim);\n}\n\n.lumiverse-search-clear {\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    padding: 2px 6px;\n}\n\n/* ----------------------------------------\n   Pack Section (in modals)\n   ---------------------------------------- */\n.lumiverse-pack-section {\n    margin-bottom: 16px;\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    overflow: hidden;\n}\n\n.lumiverse-pack-header {\n    display: flex;\n    align-items: center;\n    width: 100%;\n    padding: 12px 14px;\n    background: var(--lumiverse-bg-elevated);\n    border: none;\n    color: var(--lumiverse-text);\n    cursor: pointer;\n    transition: background var(--lumiverse-transition);\n}\n\n.lumiverse-pack-header:hover {\n    background: var(--lumiverse-bg-hover);\n}\n\n.lumiverse-pack-cover {\n    width: 40px;\n    height: 40px;\n    border-radius: var(--lumiverse-radius-sm);\n    object-fit: cover;\n    margin-right: 12px;\n}\n\n.lumiverse-pack-info {\n    flex: 1;\n    text-align: left;\n}\n\n.lumiverse-pack-meta {\n    display: flex;\n    gap: 12px;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n    margin-top: 2px;\n}\n\n.lumiverse-pack-chevron {\n    font-size: 10px;\n    color: var(--lumiverse-text-muted);\n    transition: transform var(--lumiverse-transition);\n}\n\n.lumiverse-pack-chevron.rotated {\n    transform: rotate(180deg);\n}\n\n.lumiverse-pack-items {\n    padding: 8px;\n    background: var(--lumiverse-bg);\n}\n\n/* ----------------------------------------\n   Selectable Item\n   ---------------------------------------- */\n.lumiverse-selectable-item {\n    display: flex;\n    align-items: flex-start;\n    padding: 12px;\n    background: var(--lumiverse-bg-elevated);\n    border: 1px solid transparent;\n    border-radius: var(--lumiverse-radius);\n    margin-bottom: 8px;\n    cursor: pointer;\n    transition: all var(--lumiverse-transition);\n}\n\n.lumiverse-selectable-item:hover {\n    background: var(--lumiverse-bg-hover);\n}\n\n.lumiverse-selectable-item--selected {\n    border-color: var(--lumiverse-primary);\n    background: var(--lumiverse-primary-light);\n}\n\n.lumiverse-selectable-item--dominant {\n    border-color: var(--lumiverse-warning);\n}\n\n.lumiverse-item-image {\n    width: 48px;\n    height: 48px;\n    border-radius: var(--lumiverse-radius);\n    overflow: hidden;\n    margin-right: 12px;\n    flex-shrink: 0;\n    background: var(--lumiverse-bg);\n}\n\n.lumiverse-item-image img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n}\n\n.lumiverse-item-content {\n    flex: 1;\n    min-width: 0;\n}\n\n.lumiverse-item-header {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n}\n\n.lumiverse-item-name {\n    font-weight: 500;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-dominant-btn {\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text-dim);\n    font-size: 14px;\n    cursor: pointer;\n    padding: 2px 4px;\n    transition: color var(--lumiverse-transition);\n}\n\n.lumiverse-dominant-btn:hover {\n    color: var(--lumiverse-warning);\n}\n\n.lumiverse-dominant-btn--active {\n    color: var(--lumiverse-warning);\n}\n\n.lumiverse-item-description {\n    margin: 4px 0 0 0;\n    font-size: 13px;\n    color: var(--lumiverse-text-muted);\n    overflow: hidden;\n    text-overflow: ellipsis;\n    display: -webkit-box;\n    -webkit-line-clamp: 2;\n    -webkit-box-orient: vertical;\n}\n\n.lumiverse-item-checkbox {\n    margin-left: 12px;\n    flex-shrink: 0;\n}\n\n.lumiverse-checkbox {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 20px;\n    height: 20px;\n    border: 2px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius-sm);\n    color: transparent;\n    font-size: 12px;\n    transition: all var(--lumiverse-transition);\n}\n\n.lumiverse-checkbox.checked {\n    background: var(--lumiverse-primary);\n    border-color: var(--lumiverse-primary);\n    color: white;\n}\n\n.lumiverse-radio-dot {\n    width: 20px;\n    height: 20px;\n    border: 2px solid var(--lumiverse-border);\n    border-radius: 50%;\n    position: relative;\n}\n\n.lumiverse-radio-dot.checked::after {\n    content: '';\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    width: 10px;\n    height: 10px;\n    background: var(--lumiverse-primary);\n    border-radius: 50%;\n}\n\n/* ----------------------------------------\n   Empty State\n   ---------------------------------------- */\n.lumiverse-empty-state {\n    text-align: center;\n    padding: 40px 20px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-empty-icon {\n    font-size: 48px;\n    display: block;\n    margin-bottom: 16px;\n}\n\n.lumiverse-empty-state p {\n    margin: 0 0 8px 0;\n}\n\n.lumiverse-empty-hint {\n    font-size: 13px;\n    color: var(--lumiverse-text-dim);\n}\n\n/* ----------------------------------------\n   Pack Editor Modal\n   ---------------------------------------- */\n.lumiverse-pack-editor-modal {\n    display: flex;\n    flex-direction: column;\n    height: 100%;\n}\n\n.lumiverse-pack-editor-content {\n    flex: 1;\n    overflow-y: auto;\n    padding: 20px;\n}\n\n.lumiverse-pack-metadata {\n    margin-bottom: 24px;\n}\n\n.lumiverse-pack-metadata h3,\n.lumiverse-pack-items-header h3 {\n    margin: 0 0 16px 0;\n    font-size: 16px;\n    font-weight: 600;\n}\n\n.lumiverse-pack-items-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    margin-bottom: 16px;\n}\n\n.lumiverse-pack-items-list {\n    display: flex;\n    flex-direction: column;\n    gap: 16px;\n}\n\n.lumiverse-pack-editor-footer {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 16px 20px;\n    background: var(--lumiverse-bg-elevated);\n    border-top: 1px solid var(--lumiverse-border);\n}\n\n.lumiverse-pack-editor-actions {\n    display: flex;\n    gap: 8px;\n}\n\n/* ----------------------------------------\n   Form Fields\n   ---------------------------------------- */\n.lumiverse-form-field {\n    margin-bottom: 16px;\n}\n\n.lumiverse-form-field--error .lumiverse-input,\n.lumiverse-form-field--error .lumiverse-textarea {\n    border-color: var(--lumiverse-danger);\n}\n\n.lumiverse-form-label {\n    display: block;\n    margin-bottom: 6px;\n    font-weight: 500;\n    font-size: 13px;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-required {\n    color: var(--lumiverse-danger);\n    margin-left: 2px;\n}\n\n.lumiverse-form-error {\n    display: block;\n    margin-top: 4px;\n    font-size: 12px;\n    color: var(--lumiverse-danger);\n}\n\n.lumiverse-input,\n.lumiverse-textarea,\n.lumiverse-select {\n    width: 100%;\n    padding: 10px 12px;\n    background: var(--lumiverse-bg-elevated);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    color: var(--lumiverse-text);\n    font-size: 14px;\n    font-family: inherit;\n    transition: border-color var(--lumiverse-transition);\n}\n\n.lumiverse-input:focus,\n.lumiverse-textarea:focus,\n.lumiverse-select:focus {\n    outline: none;\n    border-color: var(--lumiverse-primary);\n}\n\n.lumiverse-textarea {\n    resize: vertical;\n    min-height: 80px;\n}\n\n.lumiverse-select {\n    cursor: pointer;\n}\n\n/* ----------------------------------------\n   Image Input\n   ---------------------------------------- */\n.lumiverse-image-input {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumiverse-image-preview {\n    width: 100px;\n    height: 100px;\n    border-radius: var(--lumiverse-radius);\n    overflow: hidden;\n    background: var(--lumiverse-bg);\n}\n\n.lumiverse-image-preview img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n}\n\n.lumiverse-image-error {\n    font-size: 12px;\n    color: var(--lumiverse-danger);\n}\n\n/* ----------------------------------------\n   Lumia Item Editor\n   ---------------------------------------- */\n.lumiverse-lumia-editor {\n    background: var(--lumiverse-bg-elevated);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    padding: 16px;\n}\n\n.lumiverse-lumia-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    margin-bottom: 16px;\n    padding-bottom: 12px;\n    border-bottom: 1px solid var(--lumiverse-border);\n}\n\n.lumiverse-lumia-type {\n    font-size: 12px;\n    font-weight: 600;\n    text-transform: uppercase;\n    color: var(--lumiverse-primary);\n    background: var(--lumiverse-primary-light);\n    padding: 4px 8px;\n    border-radius: var(--lumiverse-radius-sm);\n}\n\n.lumiverse-lumia-fields {\n    display: grid;\n    gap: 12px;\n}\n\n/* ----------------------------------------\n   Loading & Error States\n   ---------------------------------------- */\n.lumiverse-loading-overlay {\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background: rgba(0, 0, 0, 0.5);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    z-index: 10001;\n}\n\n.lumiverse-spinner {\n    width: 40px;\n    height: 40px;\n    border: 3px solid var(--lumiverse-border);\n    border-top-color: var(--lumiverse-primary);\n    border-radius: 50%;\n    animation: lumiverse-spin 0.8s linear infinite;\n}\n\n@keyframes lumiverse-spin {\n    to {\n        transform: rotate(360deg);\n    }\n}\n\n.lumiverse-error-toast {\n    position: fixed;\n    bottom: 20px;\n    right: 20px;\n    display: flex;\n    align-items: center;\n    gap: 12px;\n    padding: 12px 16px;\n    background: var(--lumiverse-danger);\n    color: white;\n    border-radius: var(--lumiverse-radius);\n    box-shadow: var(--lumiverse-shadow-lg);\n    z-index: 10002;\n    cursor: pointer;\n}\n\n.lumiverse-error-dismiss {\n    background: rgba(255, 255, 255, 0.2);\n    border: none;\n    color: white;\n    padding: 4px 8px;\n    border-radius: var(--lumiverse-radius-sm);\n    font-size: 12px;\n    cursor: pointer;\n}\n\n/* ----------------------------------------\n   Header Badge\n   ---------------------------------------- */\n.lumiverse-header-badge {\n    font-size: 10px;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    padding: 4px 8px;\n    background: var(--lumiverse-primary-light);\n    color: var(--lumiverse-primary);\n    border-radius: var(--lumiverse-radius-sm);\n}\n\n/* ----------------------------------------\n   Selector Components - Matching old lumia-selector pattern\n   ---------------------------------------- */\n.lumiverse-selector {\n    background: rgba(0, 0, 0, 0.15);\n    border: 1px solid rgba(128, 128, 128, 0.12);\n    border-radius: var(--lumiverse-radius-md);\n    padding: 12px 14px;\n    transition: all var(--lumiverse-transition);\n}\n\n.lumiverse-selector:hover {\n    border-color: rgba(147, 112, 219, 0.2);\n    background: rgba(0, 0, 0, 0.2);\n}\n\n.lumiverse-selector-group {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n}\n\n.lumiverse-selector-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    margin-bottom: 8px;\n}\n\n.lumiverse-selector-label {\n    font-size: 12px;\n    font-weight: 600;\n    color: rgba(255, 255, 255, 0.8);\n    letter-spacing: 0.1px;\n}\n\n.lumiverse-selector-hint {\n    font-size: 10px;\n    font-weight: 500;\n    color: rgba(147, 112, 219, 0.6);\n    text-transform: uppercase;\n    letter-spacing: 0.3px;\n}\n\n.lumiverse-selector-row {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n}\n\n.lumiverse-selector-value {\n    flex: 1;\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--lumiverse-text-muted);\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n    min-width: 0;\n    display: flex;\n    align-items: center;\n    gap: 8px;\n}\n\n.lumiverse-dominant-badge {\n    font-size: 11px;\n    color: var(--lumiverse-warning);\n    background: rgba(245, 158, 11, 0.15);\n    padding: 3px 8px;\n    border-radius: var(--lumiverse-radius-sm);\n    border: 1px solid rgba(245, 158, 11, 0.25);\n}\n\n/* ----------------------------------------\n   Tool Buttons - Grid layout with accent styling\n   ---------------------------------------- */\n.lumiverse-tools-row {\n    display: grid;\n    grid-template-columns: repeat(2, 1fr);\n    gap: 10px;\n}\n\n.lumiverse-tool-btn {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    gap: 8px;\n    padding: 16px 12px;\n    background: rgba(0, 0, 0, 0.15);\n    border: 1px solid rgba(128, 128, 128, 0.12);\n    border-radius: var(--lumiverse-radius-md);\n    color: rgba(255, 255, 255, 0.75);\n    font-size: 12px;\n    font-weight: 500;\n    font-family: inherit;\n    cursor: pointer;\n    transition: all var(--lumiverse-transition);\n}\n\n.lumiverse-tool-icon {\n    font-size: 18px;\n    transition: transform var(--lumiverse-transition);\n}\n\n.lumiverse-tool-btn:hover {\n    background: rgba(147, 112, 219, 0.1);\n    border-color: rgba(147, 112, 219, 0.25);\n}\n\n.lumiverse-tool-btn:hover .lumiverse-tool-icon {\n    transform: scale(1.1);\n}\n\n.lumiverse-tool-btn-accent {\n    background: linear-gradient(\n        135deg,\n        rgba(147, 112, 219, 0.2) 0%,\n        rgba(123, 95, 196, 0.15) 100%\n    );\n    border-color: rgba(147, 112, 219, 0.35);\n    color: var(--lumiverse-primary-text);\n}\n\n.lumiverse-tool-btn-accent:hover {\n    background: linear-gradient(\n        135deg,\n        rgba(147, 112, 219, 0.3) 0%,\n        rgba(123, 95, 196, 0.25) 100%\n    );\n    border-color: rgba(147, 112, 219, 0.5);\n}\n\n.lumiverse-tool-icon {\n    font-size: 16px;\n}\n\n/* ----------------------------------------\n   Macro Reference - Matching old lumia-macro pattern\n   ---------------------------------------- */\n.lumiverse-macro-reference {\n    display: flex;\n    flex-direction: column;\n    gap: 14px;\n}\n\n.lumiverse-macro-group {\n    display: flex;\n    flex-direction: column;\n    gap: 6px;\n}\n\n.lumiverse-macro-group-title {\n    font-size: 10px;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    color: rgba(147, 112, 219, 0.7);\n    margin-bottom: 2px;\n}\n\n.lumiverse-macro-list {\n    display: flex;\n    flex-direction: column;\n    gap: 4px;\n}\n\n.lumiverse-macro {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 6px 0;\n    cursor: pointer;\n    transition: all var(--lumiverse-transition);\n}\n\n.lumiverse-macro:hover {\n    opacity: 0.85;\n}\n\n.lumiverse-macro--copied {\n    opacity: 1;\n}\n\n.lumiverse-macro--copied code {\n    background: rgba(147, 112, 219, 0.25);\n    border-color: rgba(147, 112, 219, 0.4);\n}\n\n.lumiverse-macro code {\n    font-family: var(--lumiverse-font-mono);\n    font-size: 11px;\n    padding: 4px 8px;\n    background: rgba(0, 0, 0, 0.3);\n    border: 1px solid rgba(128, 128, 128, 0.15);\n    border-radius: var(--lumiverse-radius-sm);\n    color: var(--lumiverse-primary-text);\n    white-space: nowrap;\n    transition: all var(--lumiverse-transition);\n}\n\n.lumiverse-macro span {\n    font-size: 12px;\n    color: rgba(255, 255, 255, 0.55);\n}\n\n/* ----------------------------------------\n   Status Badge - Pack count indicator\n   ---------------------------------------- */\n.lumiverse-status-badge {\n    display: inline-flex;\n    align-items: center;\n    padding: 6px 12px;\n    margin-bottom: 12px;\n    background: rgba(147, 112, 219, 0.1);\n    border: 1px solid rgba(147, 112, 219, 0.2);\n    border-radius: 20px;\n    font-size: 12px;\n    font-weight: 500;\n    color: var(--lumiverse-primary-text);\n    letter-spacing: 0.1px;\n}\n\n/* ----------------------------------------\n   Divider - Matching old lumia-divider-text\n   ---------------------------------------- */\n.lumiverse-divider-text {\n    text-align: center;\n    font-size: 11px;\n    font-weight: 500;\n    color: rgba(255, 255, 255, 0.3);\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    margin: 12px 0;\n    position: relative;\n}\n\n.lumiverse-divider-text::before,\n.lumiverse-divider-text::after {\n    content: '';\n    position: absolute;\n    top: 50%;\n    width: calc(50% - 20px);\n    height: 1px;\n    background: rgba(128, 128, 128, 0.2);\n}\n\n.lumiverse-divider-text::before {\n    left: 0;\n}\n\n.lumiverse-divider-text::after {\n    right: 0;\n}\n\n/* ----------------------------------------\n   Input Row and Input Styling\n   ---------------------------------------- */\n.lumiverse-input-row {\n    display: flex;\n    gap: 8px;\n    margin-bottom: 10px;\n}\n\n.lumiverse-input {\n    flex: 1;\n    padding: 10px 14px;\n    background: rgba(0, 0, 0, 0.25);\n    border: 1px solid rgba(128, 128, 128, 0.2);\n    border-radius: var(--lumiverse-radius);\n    font-size: 13px;\n    color: var(--lumiverse-text);\n    font-family: inherit;\n    transition: all var(--lumiverse-transition);\n}\n\n.lumiverse-input::placeholder {\n    color: rgba(255, 255, 255, 0.35);\n}\n\n.lumiverse-input:focus {\n    outline: none;\n    border-color: rgba(147, 112, 219, 0.5);\n    background: rgba(0, 0, 0, 0.35);\n}\n\n/* ----------------------------------------\n   Custom Packs List\n   ---------------------------------------- */\n.lumiverse-custom-packs {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n/* ----------------------------------------\n   Loom Selection Modal\n   ---------------------------------------- */\n.lumiverse-loom-selection-modal {\n    display: flex;\n    flex-direction: column;\n    height: 100%;\n}\n\n.lumiverse-selection-actions {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n}\n\n.lumiverse-loom-item {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 12px 16px;\n    background: var(--lumiverse-bg-tertiary);\n    border-radius: var(--lumiverse-radius-sm);\n    cursor: pointer;\n    transition: all var(--lumiverse-transition);\n    border: 1px solid transparent;\n}\n\n.lumiverse-loom-item:hover {\n    background: var(--lumiverse-bg-secondary);\n    border-color: var(--lumiverse-border-light);\n}\n\n.lumiverse-loom-item--selected {\n    background: rgba(var(--lumiverse-primary-rgb, 147, 112, 219), 0.15);\n    border-color: var(--lumiverse-primary);\n}\n\n.lumiverse-loom-item-content {\n    flex: 1;\n}\n\n.lumiverse-loom-item-name {\n    font-weight: 500;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-loom-item-actions {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    margin-left: auto;\n}\n\n.lumiverse-loom-item-toggle {\n    margin-left: 0;\n}\n\n.lumiverse-loom-item-edit {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 24px;\n    height: 24px;\n    padding: 0;\n    background: rgba(128, 128, 128, 0.15);\n    border: 1px solid rgba(128, 128, 128, 0.15);\n    border-radius: var(--lumiverse-radius-sm);\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    transition: all 0.15s ease;\n    flex-shrink: 0;\n}\n\n.lumiverse-loom-item-edit:hover {\n    background: rgba(100, 149, 237, 0.25);\n    border-color: rgba(100, 149, 237, 0.3);\n    color: rgba(130, 179, 255, 0.95);\n}\n\n.lumiverse-toggle-switch {\n    position: relative;\n    width: 40px;\n    height: 22px;\n}\n\n.lumiverse-toggle-track {\n    width: 100%;\n    height: 100%;\n    background: var(--lumiverse-bg-secondary);\n    border: 2px solid var(--lumiverse-border);\n    border-radius: 11px;\n    transition: all var(--lumiverse-transition);\n}\n\n.lumiverse-toggle-switch.checked .lumiverse-toggle-track {\n    background: var(--lumiverse-primary);\n    border-color: var(--lumiverse-primary);\n}\n\n.lumiverse-toggle-thumb {\n    position: absolute;\n    top: 3px;\n    left: 3px;\n    width: 16px;\n    height: 16px;\n    background: white;\n    border-radius: 50%;\n    transition: transform var(--lumiverse-transition);\n}\n\n.lumiverse-toggle-switch.checked .lumiverse-toggle-thumb {\n    transform: translateX(18px);\n}\n\n/* Selection footer for Loom modals */\n.lumiverse-selection-footer {\n    display: flex;\n    justify-content: flex-end;\n    padding: 16px;\n    border-top: 1px solid var(--lumiverse-border);\n    margin-top: auto;\n}\n\n/* Text button style */\n.lumiverse-btn--text {\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text-muted);\n    padding: 4px 8px;\n}\n\n.lumiverse-btn--text:hover {\n    color: var(--lumiverse-text);\n    background: var(--lumiverse-bg-tertiary);\n}\n\n/* Pack section improvements for Loom modal */\n.lumiverse-pack-icon {\n    margin-right: 8px;\n}\n\n/* Ensure pack items have proper spacing */\n.lumiverse-pack-items {\n    display: flex;\n    flex-direction: column;\n    gap: 4px;\n    padding: 12px;\n    background: var(--lumiverse-bg-secondary);\n    border-radius: 0 0 var(--lumiverse-radius) var(--lumiverse-radius);\n}\n\n/* Pack section collapsed state */\n.lumiverse-pack-section.collapsed .lumiverse-pack-items {\n    display: none;\n}\n\n/* Custom pack badge */\n.lumiverse-pack-badge-custom {\n    font-size: 10px;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    padding: 2px 6px;\n    background: rgba(var(--lumiverse-primary-rgb, 147, 112, 219), 0.2);\n    color: var(--lumiverse-primary);\n    border-radius: 4px;\n    margin-left: 8px;\n}\n\n/* Small icon button */\n.lumiverse-icon-btn-sm {\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    width: 28px;\n    height: 28px;\n    padding: 0;\n    background: transparent;\n    border: none;\n    border-radius: 6px;\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    transition: all 0.15s ease;\n    margin-left: auto;\n    flex-shrink: 0;\n}\n\n.lumiverse-icon-btn-sm:hover {\n    color: var(--lumiverse-danger, #ef4444);\n    background: rgba(239, 68, 68, 0.1);\n}\n\n.lumiverse-icon-btn-sm svg,\n.lumiverse-icon-sm svg {\n    width: 16px;\n    height: 16px;\n}\n\n.lumiverse-icon-sm {\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n}\n\n/* ============================================\n   LOOM MODAL CONTROLS - Collapse/Expand & Sort\n   ============================================ */\n\n.lumiverse-modal-controls {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    gap: 12px;\n    padding: 12px 16px;\n    background: var(--lumiverse-bg-elevated, #1a1a1a);\n    border-bottom: 1px solid var(--lumiverse-border);\n}\n\n.lumiverse-modal-controls-group {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n}\n\n.lumiverse-modal-control-btn {\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    gap: 6px;\n    padding: 8px 12px;\n    font-size: 12px;\n    font-weight: 500;\n    color: var(--lumiverse-text-secondary, #999);\n    background: var(--lumiverse-bg-tertiary, #2a2a2a);\n    border: 1px solid var(--lumiverse-border, #3a3a3a);\n    border-radius: 8px;\n    cursor: pointer;\n    transition: all 0.15s ease;\n    white-space: nowrap;\n}\n\n.lumiverse-modal-control-btn:hover {\n    color: var(--lumiverse-text, #fff);\n    background: var(--lumiverse-bg-hover, #333);\n    border-color: var(--lumiverse-accent, #7c3aed);\n}\n\n.lumiverse-modal-control-btn:active {\n    transform: scale(0.97);\n}\n\n.lumiverse-control-icon,\n.lumiverse-control-icon svg {\n    width: 14px;\n    height: 14px;\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n}\n\n/* Sort Dropdown for Loom modals */\n.lumiverse-modal-sort {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    padding: 6px 12px;\n    background: var(--lumiverse-bg-tertiary, #2a2a2a);\n    border: 1px solid var(--lumiverse-border, #3a3a3a);\n    border-radius: 8px;\n}\n\n.lumiverse-modal-sort-label {\n    font-size: 12px;\n    font-weight: 500;\n    color: var(--lumiverse-text-muted, #666);\n}\n\n.lumiverse-select {\n    padding: 4px 8px;\n    font-size: 12px;\n    font-weight: 500;\n    color: var(--lumiverse-text, #fff);\n    background: var(--lumiverse-bg-secondary, #1e1e1e);\n    border: 1px solid var(--lumiverse-border, #3a3a3a);\n    border-radius: 6px;\n    cursor: pointer;\n    transition: all 0.15s ease;\n    min-width: 100px;\n}\n\n.lumiverse-select:hover {\n    border-color: var(--lumiverse-border-hover, #4a4a4a);\n}\n\n.lumiverse-select:focus {\n    outline: none;\n    border-color: var(--lumiverse-accent, #7c3aed);\n    box-shadow: 0 0 0 2px rgba(124, 58, 237, 0.15);\n}\n\n/* Mobile adjustments for Loom modal controls */\n@media (max-width: 600px) {\n    .lumiverse-modal-controls {\n        flex-wrap: wrap;\n        gap: 8px;\n        padding: 10px 12px;\n    }\n\n    .lumiverse-modal-control-btn {\n        padding: 6px 10px;\n        font-size: 11px;\n    }\n\n    .lumiverse-modal-control-btn span {\n        display: none;\n    }\n\n    .lumiverse-modal-control-btn .lumiverse-control-icon {\n        margin: 0;\n    }\n\n    .lumiverse-modal-sort {\n        flex: 1;\n        min-width: 100%;\n        justify-content: space-between;\n    }\n\n    .lumiverse-select {\n        flex: 1;\n        min-width: 0;\n    }\n}\n\n/* ----------------------------------------\n   Pack Editor Modal\n   ---------------------------------------- */\n.lumiverse-pack-editor-modal {\n    display: flex;\n    flex-direction: column;\n    height: 100%;\n}\n\n.lumiverse-pack-editor-content {\n    flex: 1;\n    overflow-y: auto;\n    padding: 16px;\n    display: flex;\n    flex-direction: column;\n    gap: 24px;\n}\n\n.lumiverse-pack-metadata h3,\n.lumiverse-pack-items-section h3 {\n    margin: 0 0 16px 0;\n    font-size: 16px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-pack-items-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 16px;\n}\n\n.lumiverse-pack-items-header h3 {\n    margin: 0;\n}\n\n.lumiverse-pack-items-list {\n    display: flex;\n    flex-direction: column;\n    gap: 16px;\n}\n\n/* Lumia Item Editor */\n.lumiverse-lumia-editor {\n    background: var(--lumiverse-bg-tertiary);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    overflow: hidden;\n}\n\n.lumiverse-lumia-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 12px 16px;\n    background: var(--lumiverse-bg-secondary);\n    border-bottom: 1px solid var(--lumiverse-border);\n}\n\n.lumiverse-lumia-type {\n    font-size: 12px;\n    font-weight: 600;\n    text-transform: uppercase;\n    color: var(--lumiverse-text-muted);\n    background: var(--lumiverse-bg-primary);\n    padding: 4px 8px;\n    border-radius: var(--lumiverse-radius-sm);\n}\n\n.lumiverse-lumia-fields {\n    padding: 16px;\n    display: flex;\n    flex-direction: column;\n    gap: 16px;\n}\n\n/* Pack Editor Footer */\n.lumiverse-pack-editor-footer {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 16px;\n    border-top: 1px solid var(--lumiverse-border);\n    background: var(--lumiverse-bg-secondary);\n}\n\n.lumiverse-pack-editor-footer-left {\n    display: flex;\n    gap: 8px;\n    align-items: center;\n}\n\n.lumiverse-pack-editor-actions {\n    display: flex;\n    gap: 8px;\n    margin-left: auto;\n}\n\n/* Pack Editor Title */\n.lumiverse-pack-editor-title {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    margin-bottom: 20px;\n}\n\n.lumiverse-pack-editor-title h3 {\n    margin: 0;\n    font-size: 18px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-pack-editor-title svg {\n    color: var(--lumiverse-primary-text);\n}\n\n/* Pack Lumias Info Section */\n.lumiverse-pack-lumias-info {\n    background: var(--lumiverse-bg-tertiary);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    padding: 16px;\n}\n\n.lumiverse-pack-lumias-header {\n    margin-bottom: 8px;\n}\n\n.lumiverse-pack-lumias-count {\n    font-size: 14px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-pack-lumias-hint {\n    font-size: 13px;\n    color: var(--lumiverse-text-muted);\n    margin: 0 0 12px 0;\n}\n\n/* Full width button modifier */\n.lumiverse-btn--full {\n    width: 100%;\n    justify-content: center;\n}\n\n/* Form hint text */\n.lumiverse-form-hint {\n    display: block;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n    margin-top: 4px;\n    font-style: italic;\n}\n\n/* Lumia editor row (side-by-side fields) */\n.lumiverse-lumia-row {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 12px;\n}\n\n.lumiverse-lumia-row .lumiverse-form-field {\n    margin-bottom: 0;\n}\n\n/* Lumia name in header */\n.lumiverse-lumia-name {\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    font-size: 14px;\n}\n\n/* Clickable Lumia name (for opening full editor) */\n.lumiverse-lumia-name--clickable {\n    cursor: pointer;\n    transition: color 0.15s ease;\n}\n\n.lumiverse-lumia-name--clickable:hover {\n    color: var(--lumiverse-primary-text);\n}\n\n/* Header actions container */\n.lumiverse-lumia-header-actions {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n}\n\n/* Expand button in header */\n.lumiverse-btn--expand {\n    background: rgba(147, 112, 219, 0.1);\n    border: 1px solid rgba(147, 112, 219, 0.2);\n    color: var(--lumiverse-primary-text);\n    opacity: 0.7;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-btn--expand:hover {\n    background: rgba(147, 112, 219, 0.2);\n    opacity: 1;\n}\n\n/* Image Input */\n.lumiverse-image-input {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumiverse-image-preview {\n    width: 100px;\n    height: 100px;\n    border-radius: var(--lumiverse-radius);\n    overflow: hidden;\n    border: 1px solid var(--lumiverse-border);\n}\n\n.lumiverse-image-preview img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n}\n\n.lumiverse-image-error {\n    color: var(--lumiverse-danger);\n    font-size: 12px;\n}\n\n/* Danger button */\n.lumiverse-btn--danger {\n    background: transparent;\n    border: 1px solid var(--lumiverse-danger);\n    color: var(--lumiverse-danger);\n}\n\n.lumiverse-btn--danger:hover {\n    background: var(--lumiverse-danger);\n    color: white;\n}\n\n.lumiverse-btn--icon {\n    padding: 6px 8px;\n}\n\n/* Select input */\n.lumiverse-select {\n    width: 100%;\n    padding: 10px 12px;\n    background: var(--lumiverse-bg-tertiary);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius-sm);\n    color: var(--lumiverse-text);\n    font-size: 14px;\n    cursor: pointer;\n}\n\n.lumiverse-select:focus {\n    outline: none;\n    border-color: var(--lumiverse-primary);\n}\n\n/* Required asterisk */\n.lumiverse-required {\n    color: var(--lumiverse-danger);\n    margin-left: 4px;\n}\n\n/* ----------------------------------------\n   Pack Selector Modal\n   ---------------------------------------- */\n.lumia-modal-pack-selector {\n    max-width: 480px;\n    width: 90%;\n}\n\n.lumiverse-pack-selector-modal {\n    display: flex;\n    flex-direction: column;\n    max-height: 70vh;\n}\n\n.lumiverse-pack-selector-content {\n    flex: 1;\n    overflow-y: auto;\n    padding: 16px;\n}\n\n.lumiverse-pack-selector-section {\n    margin-bottom: 16px;\n}\n\n.lumiverse-pack-selector-heading {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    margin: 0 0 12px 0;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n.lumiverse-pack-selector-empty {\n    padding: 20px;\n    text-align: center;\n    color: var(--lumiverse-text-muted);\n    font-size: 13px;\n    background: var(--lumiverse-bg-tertiary);\n    border-radius: var(--lumiverse-radius);\n}\n\n.lumiverse-pack-selector-list {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumiverse-pack-selector-item {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n    padding: 12px 14px;\n    background: var(--lumiverse-bg-tertiary);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    cursor: pointer;\n    transition: all 0.15s ease;\n    text-align: left;\n    width: 100%;\n}\n\n.lumiverse-pack-selector-item:hover {\n    background: var(--lumiverse-bg-hover);\n    border-color: var(--lumiverse-primary);\n}\n\n.lumiverse-pack-selector-item-icon {\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-pack-selector-item-info {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n}\n\n.lumiverse-pack-selector-item-name {\n    font-weight: 500;\n    color: var(--lumiverse-text);\n    font-size: 14px;\n}\n\n.lumiverse-pack-selector-item-meta {\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-pack-selector-item-arrow {\n    color: var(--lumiverse-text-muted);\n    opacity: 0;\n    transition: opacity 0.15s ease;\n}\n\n.lumiverse-pack-selector-item:hover .lumiverse-pack-selector-item-arrow {\n    opacity: 1;\n}\n\n.lumiverse-pack-selector-divider {\n    display: flex;\n    align-items: center;\n    margin: 16px 0;\n    color: var(--lumiverse-text-muted);\n    font-size: 12px;\n}\n\n.lumiverse-pack-selector-divider::before,\n.lumiverse-pack-selector-divider::after {\n    content: '';\n    flex: 1;\n    height: 1px;\n    background: var(--lumiverse-border);\n}\n\n.lumiverse-pack-selector-divider span {\n    padding: 0 12px;\n}\n\n.lumiverse-pack-selector-create-btn {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 8px;\n    width: 100%;\n    padding: 14px;\n    background: transparent;\n    border: 2px dashed var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    color: var(--lumiverse-text-muted);\n    font-size: 14px;\n    cursor: pointer;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-pack-selector-create-btn:hover {\n    border-color: var(--lumiverse-primary);\n    color: var(--lumiverse-primary);\n    background: rgba(var(--lumiverse-primary-rgb), 0.05);\n}\n\n.lumiverse-pack-selector-form {\n    background: var(--lumiverse-bg-tertiary);\n    border-radius: var(--lumiverse-radius);\n    padding: 16px;\n}\n\n.lumiverse-pack-selector-field {\n    margin-bottom: 12px;\n}\n\n.lumiverse-pack-selector-field:last-of-type {\n    margin-bottom: 0;\n}\n\n.lumiverse-pack-selector-error {\n    color: var(--lumiverse-danger);\n    font-size: 12px;\n    margin: 8px 0;\n}\n\n.lumiverse-pack-selector-form-actions {\n    display: flex;\n    gap: 8px;\n    justify-content: flex-end;\n    margin-top: 16px;\n}\n\n.lumiverse-pack-selector-footer {\n    display: flex;\n    justify-content: flex-end;\n    padding: 12px 16px;\n    border-top: 1px solid var(--lumiverse-border);\n    background: var(--lumiverse-bg-secondary);\n}\n\n/* Pack Selector - Expandable Item Wrapper */\n.lumiverse-pack-selector-item-wrapper {\n    border-radius: var(--lumiverse-radius);\n    overflow: hidden;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-pack-selector-item-wrapper--expanded {\n    background: rgba(0, 0, 0, 0.15);\n    border: 1px solid var(--lumiverse-border);\n}\n\n.lumiverse-pack-selector-item-wrapper--expanded .lumiverse-pack-selector-item {\n    border-color: transparent;\n    border-radius: var(--lumiverse-radius) var(--lumiverse-radius) 0 0;\n}\n\n.lumiverse-pack-selector-item-wrapper--expanded .lumiverse-pack-selector-item-arrow {\n    opacity: 1;\n}\n\n/* Pack Selector - Expanded Lumias List */\n.lumiverse-pack-selector-lumias {\n    padding: 8px 12px 12px;\n    border-top: 1px solid var(--lumiverse-border-light);\n}\n\n.lumiverse-pack-selector-add-lumia {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 6px;\n    width: 100%;\n    padding: 10px 12px;\n    margin-bottom: 8px;\n    background: rgba(147, 112, 219, 0.1);\n    border: 1px dashed rgba(147, 112, 219, 0.3);\n    border-radius: var(--lumiverse-radius-sm);\n    color: var(--lumiverse-primary-text);\n    font-size: 13px;\n    font-weight: 500;\n    cursor: pointer;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-pack-selector-add-lumia:hover {\n    background: rgba(147, 112, 219, 0.2);\n    border-color: rgba(147, 112, 219, 0.5);\n}\n\n.lumiverse-pack-selector-lumia-list {\n    display: flex;\n    flex-direction: column;\n    gap: 4px;\n}\n\n.lumiverse-pack-selector-lumia-item {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 8px 10px;\n    background: rgba(0, 0, 0, 0.1);\n    border: 1px solid rgba(128, 128, 128, 0.08);\n    border-radius: var(--lumiverse-radius-sm);\n    transition: all 0.15s ease;\n}\n\n.lumiverse-pack-selector-lumia-item:hover {\n    background: rgba(0, 0, 0, 0.18);\n    border-color: rgba(147, 112, 219, 0.2);\n}\n\n.lumiverse-pack-selector-lumia-avatar {\n    width: 28px;\n    height: 28px;\n    border-radius: 50%;\n    object-fit: cover;\n    border: 1px solid rgba(147, 112, 219, 0.2);\n    flex-shrink: 0;\n}\n\n.lumiverse-pack-selector-lumia-name {\n    flex: 1;\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-pack-selector-lumia-edit {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 28px;\n    height: 28px;\n    padding: 0;\n    background: rgba(147, 112, 219, 0.15);\n    border: 1px solid rgba(147, 112, 219, 0.2);\n    border-radius: var(--lumiverse-radius-sm);\n    color: var(--lumiverse-primary-text);\n    cursor: pointer;\n    transition: all 0.15s ease;\n    flex-shrink: 0;\n}\n\n.lumiverse-pack-selector-lumia-edit:hover {\n    background: rgba(147, 112, 219, 0.3);\n    border-color: rgba(147, 112, 219, 0.4);\n}\n\n.lumiverse-pack-selector-lumia-empty {\n    padding: 12px;\n    text-align: center;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n    font-style: italic;\n}\n\n/* Pack Selector - Unified Items List (Lumia + Loom) */\n.lumiverse-pack-selector-items {\n    padding: 8px 12px 12px;\n    border-top: 1px solid var(--lumiverse-border-light);\n}\n\n.lumiverse-pack-selector-add-item {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 6px;\n    width: 100%;\n    padding: 10px 12px;\n    margin-bottom: 8px;\n    background: linear-gradient(135deg, rgba(147, 112, 219, 0.1) 0%, rgba(100, 149, 237, 0.1) 100%);\n    border: 1px dashed rgba(147, 112, 219, 0.3);\n    border-radius: var(--lumiverse-radius-sm);\n    color: var(--lumiverse-primary-text);\n    font-size: 13px;\n    font-weight: 500;\n    cursor: pointer;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-pack-selector-add-item:hover {\n    background: linear-gradient(135deg, rgba(147, 112, 219, 0.2) 0%, rgba(100, 149, 237, 0.2) 100%);\n    border-color: rgba(147, 112, 219, 0.5);\n}\n\n.lumiverse-pack-selector-item-list {\n    display: flex;\n    flex-direction: column;\n    gap: 4px;\n}\n\n.lumiverse-pack-selector-item-row {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 8px 10px;\n    background: rgba(0, 0, 0, 0.1);\n    border: 1px solid rgba(128, 128, 128, 0.08);\n    border-radius: var(--lumiverse-radius-sm);\n    transition: all 0.15s ease;\n}\n\n.lumiverse-pack-selector-item-row:hover {\n    background: rgba(0, 0, 0, 0.18);\n    border-color: rgba(147, 112, 219, 0.2);\n}\n\n.lumiverse-pack-selector-item-row--loom:hover {\n    border-color: rgba(100, 149, 237, 0.2);\n}\n\n.lumiverse-pack-selector-item-icon-sm {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 28px;\n    height: 28px;\n    border-radius: 50%;\n    flex-shrink: 0;\n    overflow: hidden;\n}\n\n.lumiverse-pack-selector-item-icon--lumia {\n    background: rgba(147, 112, 219, 0.15);\n    color: rgba(186, 135, 255, 0.9);\n    border: 1px solid rgba(147, 112, 219, 0.2);\n}\n\n.lumiverse-pack-selector-item-icon--loom {\n    background: rgba(100, 149, 237, 0.15);\n    color: rgba(130, 179, 255, 0.9);\n    border: 1px solid rgba(100, 149, 237, 0.2);\n}\n\n.lumiverse-pack-selector-item-avatar {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n    animation: lumiverseFadeIn 0.2s ease;\n}\n\n.lumiverse-pack-selector-item-name {\n    flex: 1;\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-pack-selector-item-type {\n    font-size: 10px;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    padding: 3px 8px;\n    border-radius: 10px;\n    background: rgba(147, 112, 219, 0.15);\n    color: rgba(186, 135, 255, 0.85);\n    flex-shrink: 0;\n}\n\n.lumiverse-pack-selector-item-type--loom {\n    background: rgba(100, 149, 237, 0.15);\n    color: rgba(130, 179, 255, 0.85);\n}\n\n.lumiverse-pack-selector-item-edit {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 28px;\n    height: 28px;\n    padding: 0;\n    background: rgba(128, 128, 128, 0.15);\n    border: 1px solid rgba(128, 128, 128, 0.15);\n    border-radius: var(--lumiverse-radius-sm);\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    transition: all 0.15s ease;\n    flex-shrink: 0;\n}\n\n.lumiverse-pack-selector-item-edit:hover {\n    background: rgba(147, 112, 219, 0.25);\n    border-color: rgba(147, 112, 219, 0.3);\n    color: var(--lumiverse-primary-text);\n}\n\n.lumiverse-pack-selector-item-row--loom .lumiverse-pack-selector-item-edit:hover {\n    background: rgba(100, 149, 237, 0.25);\n    border-color: rgba(100, 149, 237, 0.3);\n    color: rgba(130, 179, 255, 0.95);\n}\n\n.lumiverse-pack-selector-items-empty {\n    padding: 12px;\n    text-align: center;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n    font-style: italic;\n}\n\n/* Pack name class for clarity */\n.lumiverse-pack-selector-pack-name {\n    font-size: 14px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n/* ----------------------------------------\n   Lumia Editor Modal\n   ---------------------------------------- */\n.lumiverse-modal-lumia-editor {\n    max-width: 640px;\n    width: 90%;\n}\n\n.lumiverse-editor-modal {\n    display: flex;\n    flex-direction: column;\n    flex: 1;\n    min-height: 0; /* Critical for flex overflow */\n    overflow: hidden; /* Let child .lumiverse-editor-content scroll */\n}\n\n.lumiverse-editor-content {\n    flex: 1;\n    min-height: 0; /* Critical for flex overflow */\n    overflow-y: auto;\n    overflow-x: hidden;\n    padding: 16px;\n    -webkit-overflow-scrolling: touch;\n}\n\n.lumiverse-editor-section {\n    margin-bottom: 20px;\n    background: var(--lumiverse-bg-tertiary);\n    border-radius: var(--lumiverse-radius);\n    overflow: hidden;\n}\n\n.lumiverse-editor-section:last-child {\n    margin-bottom: 0;\n}\n\n.lumiverse-editor-section-header {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    padding: 12px 14px;\n    background: var(--lumiverse-bg-secondary);\n    border-bottom: 1px solid var(--lumiverse-border);\n    font-weight: 600;\n    font-size: 13px;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-editor-section-content {\n    padding: 14px;\n}\n\n.lumiverse-editor-field {\n    margin-bottom: 14px;\n}\n\n.lumiverse-editor-field:last-child {\n    margin-bottom: 0;\n}\n\n.lumiverse-editor-field--error .lumiverse-input,\n.lumiverse-editor-field--error .lumiverse-textarea {\n    border-color: var(--lumiverse-danger);\n}\n\n.lumiverse-editor-label {\n    display: block;\n    font-size: 12px;\n    font-weight: 500;\n    color: var(--lumiverse-text-muted);\n    margin-bottom: 6px;\n}\n\n.lumiverse-editor-hint {\n    display: block;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n    margin-top: 4px;\n    font-style: italic;\n}\n\n.lumiverse-editor-error {\n    display: block;\n    font-size: 11px;\n    color: var(--lumiverse-danger);\n    margin-top: 4px;\n}\n\n.lumiverse-editor-row {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 12px;\n}\n\n.lumiverse-editor-row .lumiverse-editor-field {\n    margin-bottom: 0;\n}\n\n.lumiverse-editor-avatar-preview {\n    width: 80px;\n    height: 80px;\n    border-radius: var(--lumiverse-radius);\n    overflow: hidden;\n    border: 1px solid var(--lumiverse-border);\n    margin-top: 8px;\n    position: relative;\n}\n\n.lumiverse-editor-avatar-preview img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n    opacity: 0;\n    transition: opacity 0.2s ease;\n}\n\n.lumiverse-editor-avatar-preview.loaded img {\n    opacity: 1;\n}\n\n.lumiverse-editor-avatar-spinner {\n    position: absolute;\n    inset: 0;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    background: var(--lumiverse-bg-tertiary);\n}\n\n.lumiverse-editor-avatar-spinner::after {\n    content: '';\n    width: 20px;\n    height: 20px;\n    border: 2px solid var(--lumiverse-border);\n    border-top-color: var(--lumiverse-primary);\n    border-radius: 50%;\n    animation: spin 0.8s linear infinite;\n}\n\n.lumiverse-editor-avatar-preview.loaded .lumiverse-editor-avatar-spinner {\n    display: none;\n}\n\n.lumiverse-editor-footer {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    padding: 12px 16px;\n    border-top: 1px solid var(--lumiverse-border);\n    background: var(--lumiverse-bg-secondary);\n    flex-shrink: 0;\n}\n\n.lumiverse-editor-footer-spacer {\n    flex: 1;\n}\n\n/* Editor modal textareas - desktop */\n.lumiverse-editor-modal .lumiverse-textarea {\n    min-height: 120px;\n    line-height: 1.5;\n    resize: vertical;\n}\n\n/* Physicality/Personality/Behavior sections need more space */\n.lumiverse-editor-section:not(:first-child) .lumiverse-textarea {\n    min-height: 140px;\n}\n\n/* ----------------------------------------\n   Item Type Selector\n   Choice between Lumia and Loom\n   ---------------------------------------- */\n.lumiverse-type-selector {\n    display: flex;\n    flex-direction: column;\n    padding: 20px;\n    min-width: 420px;\n}\n\n.lumiverse-type-selector-header {\n    text-align: center;\n    margin-bottom: 24px;\n}\n\n.lumiverse-type-selector-title {\n    font-size: 16px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    margin: 0 0 6px 0;\n    letter-spacing: -0.2px;\n}\n\n.lumiverse-type-selector-subtitle {\n    font-size: 13px;\n    color: var(--lumiverse-text-muted);\n    margin: 0;\n}\n\n.lumiverse-type-selector-options {\n    display: flex;\n    flex-direction: column;\n    gap: 12px;\n}\n\n.lumiverse-type-option {\n    display: flex;\n    align-items: center;\n    gap: 16px;\n    padding: 16px 18px;\n    background: var(--lumiverse-bg-elevated);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius-lg);\n    cursor: pointer;\n    transition: all var(--lumiverse-transition);\n    text-align: left;\n    width: 100%;\n}\n\n.lumiverse-type-option:hover,\n.lumiverse-type-option--hovered {\n    background: var(--lumiverse-bg-hover);\n    border-color: var(--lumiverse-border-hover);\n    transform: translateY(-1px);\n}\n\n.lumiverse-type-option--lumia:hover,\n.lumiverse-type-option--lumia.lumiverse-type-option--hovered {\n    border-color: rgba(147, 112, 219, 0.4);\n    box-shadow: 0 4px 20px rgba(147, 112, 219, 0.15);\n}\n\n.lumiverse-type-option--loom:hover,\n.lumiverse-type-option--loom.lumiverse-type-option--hovered {\n    border-color: rgba(100, 149, 237, 0.4);\n    box-shadow: 0 4px 20px rgba(100, 149, 237, 0.15);\n}\n\n.lumiverse-type-option-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 48px;\n    height: 48px;\n    border-radius: var(--lumiverse-radius);\n    flex-shrink: 0;\n    transition: all var(--lumiverse-transition);\n}\n\n.lumiverse-type-option--lumia .lumiverse-type-option-icon {\n    background: rgba(147, 112, 219, 0.15);\n    color: rgba(186, 135, 255, 0.9);\n}\n\n.lumiverse-type-option--lumia:hover .lumiverse-type-option-icon,\n.lumiverse-type-option--lumia.lumiverse-type-option--hovered .lumiverse-type-option-icon {\n    background: rgba(147, 112, 219, 0.25);\n}\n\n.lumiverse-type-option--loom .lumiverse-type-option-icon {\n    background: rgba(100, 149, 237, 0.15);\n    color: rgba(130, 179, 255, 0.9);\n}\n\n.lumiverse-type-option--loom:hover .lumiverse-type-option-icon,\n.lumiverse-type-option--loom.lumiverse-type-option--hovered .lumiverse-type-option-icon {\n    background: rgba(100, 149, 237, 0.25);\n}\n\n.lumiverse-type-option-content {\n    flex: 1;\n    min-width: 0;\n}\n\n.lumiverse-type-option-label {\n    display: block;\n    font-size: 14px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    margin-bottom: 4px;\n}\n\n.lumiverse-type-option-desc {\n    display: block;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n    line-height: 1.4;\n}\n\n.lumiverse-type-option-arrow {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 24px;\n    height: 24px;\n    color: var(--lumiverse-text-dim);\n    opacity: 0;\n    transform: translateX(-4px);\n    transition: all var(--lumiverse-transition);\n}\n\n.lumiverse-type-option:hover .lumiverse-type-option-arrow,\n.lumiverse-type-option--hovered .lumiverse-type-option-arrow {\n    opacity: 1;\n    transform: translateX(0);\n}\n\n.lumiverse-type-selector-footer {\n    display: flex;\n    justify-content: center;\n    margin-top: 20px;\n    padding-top: 16px;\n    border-top: 1px solid var(--lumiverse-border);\n}\n\n/* Modal wrapper for type selector */\n.lumia-modal-type-selector {\n    max-width: 480px;\n    width: 90%;\n}\n\n/* ----------------------------------------\n   Loom Editor Modal\n   ---------------------------------------- */\n.lumia-modal-loom-editor {\n    max-width: 580px;\n    width: 90%;\n}\n\n.lumiverse-loom-editor {\n    display: flex;\n    flex-direction: column;\n    max-height: 80vh;\n}\n\n.lumiverse-loom-editor-content {\n    flex: 1;\n    overflow-y: auto;\n    padding: 16px;\n}\n\n.lumiverse-loom-category-select {\n    margin-bottom: 16px;\n}\n\n.lumiverse-loom-category-options {\n    display: flex;\n    gap: 8px;\n    flex-wrap: wrap;\n}\n\n.lumiverse-loom-category-btn {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    padding: 8px 14px;\n    background: var(--lumiverse-bg-elevated);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 20px;\n    font-size: 12px;\n    font-weight: 500;\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    transition: all var(--lumiverse-transition);\n}\n\n.lumiverse-loom-category-btn:hover {\n    background: var(--lumiverse-bg-hover);\n    border-color: var(--lumiverse-border-hover);\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-loom-category-btn--selected {\n    background: rgba(100, 149, 237, 0.2);\n    border-color: rgba(100, 149, 237, 0.4);\n    color: rgba(130, 179, 255, 0.95);\n}\n\n.lumiverse-loom-category-btn--selected:hover {\n    background: rgba(100, 149, 237, 0.25);\n    border-color: rgba(100, 149, 237, 0.5);\n}\n\n.lumiverse-loom-content-field {\n    margin-top: 16px;\n}\n\n.lumiverse-loom-content-field .lumiverse-textarea {\n    min-height: 200px;\n    resize: vertical;\n}\n\n/* ============================================\n   MOBILE RESPONSIVE - Editor Modals\n   Lumia Editor, Loom Editor, Pack Editor, Pack Selector\n   \n   CRITICAL: The modal hierarchy is:\n   .lumiverse-modal-backdrop (fixed, flex center)\n     .lumiverse-modal.lumiverse-modal-lumia-editor (flex column, max-height constrained)\n       .lumiverse-editor-modal (flex column, fills parent)\n         .lumiverse-editor-content (MUST SCROLL - flex: 1, overflow-y: auto)\n         .lumiverse-editor-footer (flex-shrink: 0, stays at bottom)\n   \n   The parent .lumiverse-modal has overflow: hidden by default.\n   We override it for editor modals to allow internal scrolling.\n   ============================================ */\n\n@media (max-width: 600px) {\n    /* ----------------------------------------\n       Editor Modal Wrapper - Mobile\n       Override the parent .lumiverse-modal settings\n       ---------------------------------------- */\n    .lumiverse-modal.lumiverse-modal-lumia-editor,\n    .lumiverse-modal.lumiverse-modal-loom-editor,\n    .lumiverse-modal.lumiverse-modal-pack-editor,\n    .lumiverse-modal.lumiverse-modal-pack-selector {\n        width: calc(100vw - 24px) !important;\n        max-width: calc(100vw - 24px) !important;\n        /* Height: use vh as fallback, dvh as enhancement */\n        height: calc(100vh - 24px);\n        max-height: calc(100vh - 24px);\n        margin: 0;\n        display: flex;\n        flex-direction: column;\n        overflow: hidden;\n        min-height: 0 !important; /* Critical for nested flex scroll */\n    }\n\n    /* Dynamic viewport units for modern browsers */\n    @supports (height: 100dvh) {\n        .lumiverse-modal.lumiverse-modal-lumia-editor,\n        .lumiverse-modal.lumiverse-modal-loom-editor,\n        .lumiverse-modal.lumiverse-modal-pack-editor,\n        .lumiverse-modal.lumiverse-modal-pack-selector {\n            height: calc(100dvh - 24px);\n            max-height: calc(100dvh - 24px);\n        }\n    }\n\n    /* ----------------------------------------\n       Lumia Editor Modal - Mobile\n       \n       This is the inner container inside .lumiverse-modal\n       ---------------------------------------- */\n    .lumiverse-editor-modal {\n        display: flex;\n        flex-direction: column;\n        flex: 1;\n        min-height: 0 !important; /* Critical: allows flex child to shrink */\n        height: 100%;\n        overflow: hidden;\n    }\n\n    /* Scrollable content area - THE KEY ELEMENT */\n    .lumiverse-editor-content {\n        flex: 1;\n        min-height: 0 !important; /* Critical: enables overflow scrolling */\n        overflow-y: auto !important;\n        overflow-x: hidden;\n        -webkit-overflow-scrolling: touch;\n        padding: 12px;\n        overscroll-behavior: contain;\n    }\n\n    /* Section styling */\n    .lumiverse-editor-section {\n        margin-bottom: 12px;\n        border-radius: var(--lumiverse-radius);\n        background: var(--lumiverse-bg-tertiary);\n    }\n\n    .lumiverse-editor-section:last-child {\n        margin-bottom: 0;\n    }\n\n    .lumiverse-editor-section-header {\n        padding: 10px 12px;\n        font-size: 12px;\n        font-weight: 600;\n        background: var(--lumiverse-bg-secondary);\n        border-bottom: 1px solid var(--lumiverse-border);\n    }\n\n    .lumiverse-editor-section-content {\n        padding: 12px;\n    }\n\n    /* Form fields */\n    .lumiverse-editor-field {\n        margin-bottom: 12px;\n    }\n\n    .lumiverse-editor-field:last-child {\n        margin-bottom: 0;\n    }\n\n    .lumiverse-editor-label {\n        display: block;\n        font-size: 11px;\n        font-weight: 600;\n        margin-bottom: 6px;\n        text-transform: uppercase;\n        letter-spacing: 0.3px;\n        color: var(--lumiverse-text-muted);\n    }\n\n    /* Stack two-column rows vertically */\n    .lumiverse-editor-row {\n        display: flex;\n        flex-direction: column;\n        gap: 12px;\n    }\n\n    .lumiverse-editor-row .lumiverse-editor-field {\n        margin-bottom: 0;\n    }\n\n    /* Avatar preview */\n    .lumiverse-editor-avatar-preview {\n        width: 60px;\n        height: 60px;\n        border-radius: 8px;\n        flex-shrink: 0;\n    }\n\n    /* ----------------------------------------\n       Input Sizing - Mobile\n       All inputs need comfortable touch targets\n       ---------------------------------------- */\n    .lumiverse-editor-modal .lumiverse-input,\n    .lumiverse-editor-modal .lumiverse-select {\n        min-height: 44px; /* iOS touch target minimum */\n        font-size: 16px; /* Prevents iOS zoom on focus */\n        padding: 10px 12px;\n    }\n\n    /* Select dropdown - ensure it's visible */\n    .lumiverse-editor-modal .lumiverse-select {\n        appearance: none;\n        background-image: url(${p});\n        background-repeat: no-repeat;\n        background-position: right 12px center;\n        padding-right: 36px;\n    }\n\n    /* Textareas - generous sizing */\n    .lumiverse-editor-modal .lumiverse-textarea {\n        min-height: 100px;\n        font-size: 16px; /* Prevents iOS zoom */\n        line-height: 1.5;\n        padding: 12px;\n        resize: vertical;\n    }\n\n    /* Hint text */\n    .lumiverse-editor-hint {\n        font-size: 11px;\n        color: var(--lumiverse-text-muted);\n        margin-top: 4px;\n        font-style: italic;\n    }\n\n    /* ----------------------------------------\n       Footer - Fixed at bottom\n       ---------------------------------------- */\n    .lumiverse-editor-footer {\n        flex-shrink: 0; /* Never compress the footer */\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n        padding: 12px;\n        border-top: 1px solid var(--lumiverse-border);\n        background: var(--lumiverse-bg-secondary);\n    }\n\n    .lumiverse-editor-footer .lumiverse-btn {\n        min-height: 44px;\n        padding: 10px 16px;\n        font-size: 14px;\n        font-weight: 500;\n    }\n\n    /* Primary and Secondary buttons side by side */\n    .lumiverse-editor-footer .lumiverse-btn--primary,\n    .lumiverse-editor-footer .lumiverse-btn--secondary:not(.lumiverse-btn--danger) {\n        flex: 1 1 auto;\n    }\n\n    /* Delete button full width on its own row */\n    .lumiverse-editor-footer .lumiverse-btn--danger {\n        flex: 0 0 100%;\n        order: 10; /* Push to end */\n        margin-top: 4px;\n    }\n\n    .lumiverse-editor-footer-spacer {\n        display: none;\n    }\n\n    /* ----------------------------------------\n       Loom Editor Modal - Mobile\n       \n       Same flex structure as Lumia editor\n       ---------------------------------------- */\n    .lumiverse-loom-editor {\n        display: flex;\n        flex-direction: column;\n        flex: 1 1 auto;\n        min-height: 0;\n        max-height: 100%;\n        overflow: hidden;\n    }\n\n    .lumiverse-loom-editor-content {\n        flex: 1 1 auto;\n        min-height: 0;\n        overflow-y: auto;\n        overflow-x: hidden;\n        -webkit-overflow-scrolling: touch;\n        padding: 12px;\n        overscroll-behavior: contain;\n    }\n\n    /* Category buttons - touch friendly */\n    .lumiverse-loom-category-options {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n    }\n\n    .lumiverse-loom-category-btn {\n        min-height: 40px;\n        padding: 8px 14px;\n        font-size: 13px;\n        border-radius: 20px;\n    }\n\n    .lumiverse-loom-category-btn svg {\n        width: 14px;\n        height: 14px;\n    }\n\n    /* Loom content textarea */\n    .lumiverse-loom-content-field .lumiverse-textarea,\n    .lumiverse-loom-editor .lumiverse-textarea {\n        min-height: 150px;\n        font-size: 16px;\n        line-height: 1.5;\n        resize: vertical;\n    }\n\n    /* ----------------------------------------\n       Pack Editor Modal - Mobile\n       ---------------------------------------- */\n    .lumiverse-pack-editor-modal,\n    .lumiverse-pack-selector-modal {\n        display: flex;\n        flex-direction: column;\n        flex: 1 1 auto;\n        min-height: 0 !important;\n        max-height: 100%;\n        overflow: hidden;\n    }\n\n    .lumiverse-pack-editor-content,\n    .lumiverse-pack-selector-content {\n        flex: 1 1 auto;\n        min-height: 0 !important;\n        overflow-y: auto !important;\n        overflow-x: hidden;\n        -webkit-overflow-scrolling: touch;\n        padding: 12px;\n        gap: 12px;\n        overscroll-behavior: contain;\n    }\n\n    .lumiverse-pack-editor-title {\n        margin-bottom: 12px;\n        gap: 8px;\n    }\n\n    .lumiverse-pack-editor-title h3 {\n        font-size: 16px;\n    }\n\n    .lumiverse-pack-editor-title svg {\n        width: 18px;\n        height: 18px;\n    }\n\n    /* Pack lumias info section */\n    .lumiverse-pack-lumias-info {\n        padding: 12px;\n    }\n\n    .lumiverse-pack-lumias-count {\n        font-size: 13px;\n    }\n\n    .lumiverse-pack-lumias-hint {\n        font-size: 12px;\n        margin-bottom: 10px;\n    }\n\n    /* Pack editor footer */\n    .lumiverse-pack-editor-footer {\n        flex-shrink: 0;\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n        padding: 12px;\n        border-top: 1px solid var(--lumiverse-border);\n        background: var(--lumiverse-bg-secondary);\n    }\n\n    .lumiverse-pack-editor-footer-left {\n        flex: 0 0 100%;\n        order: 2;\n        justify-content: center;\n    }\n\n    .lumiverse-pack-editor-actions {\n        flex: 0 0 100%;\n        order: 1;\n    }\n\n    .lumiverse-pack-editor-footer .lumiverse-btn {\n        flex: 1;\n        justify-content: center;\n        min-height: 44px;\n        font-size: 14px;\n        font-weight: 500;\n    }\n\n    /* ----------------------------------------\n       Common Input Styles - Mobile\n       16px font prevents iOS zoom on focus\n       ---------------------------------------- */\n    .lumiverse-input,\n    .lumiverse-select {\n        font-size: 16px;\n        padding: 10px 12px;\n        min-height: 44px;\n    }\n\n    .lumiverse-textarea {\n        font-size: 16px;\n        padding: 10px 12px;\n        min-height: 80px;\n    }\n\n    /* Image input adjustments */\n    .lumiverse-image-input .lumiverse-image-preview {\n        margin-top: 8px;\n    }\n\n    .lumiverse-image-input .lumiverse-image-preview img {\n        max-height: 100px;\n    }\n\n    /* Form field adjustments */\n    .lumiverse-form-field {\n        margin-bottom: 12px;\n    }\n\n    .lumiverse-form-label {\n        font-size: 11px;\n        margin-bottom: 5px;\n    }\n\n    .lumiverse-form-hint,\n    .lumiverse-editor-hint {\n        font-size: 10px;\n    }\n\n    /* Stack lumia row fields vertically */\n    .lumiverse-lumia-row {\n        grid-template-columns: 1fr;\n        gap: 12px;\n    }\n}\n\n/* ----------------------------------------\n   Viewport Panel (Dockable Sidebar)\n   ---------------------------------------- */\n\n/* Container for the viewport panel - mounted to document.body */\n.lumiverse-viewport-container {\n    /* Inline styles handle positioning, this is for any additional styling */\n    margin: 0;\n    padding: 0;\n}\n\n/* Wrapper that slides in/out - contains both toggle and panel */\n.lumiverse-viewport-wrapper {\n    display: flex;\n    flex-direction: row;\n    align-items: flex-start;\n    height: 100vh;\n    height: 100dvh;\n}\n\n/* Container for the toggle button - positioned to left of panel */\n.lumiverse-toggle-container {\n    position: absolute;\n    top: 12px;\n    right: 100%; /* Position to the left of the wrapper */\n    margin-right: 12px;\n    pointer-events: auto;\n}\n\n/* Custom position modifier - disables default positioning, uses inline styles */\n.lumiverse-toggle-container--custom {\n    /* Reset all positioning to allow inline styles to take effect */\n    position: fixed;\n    top: auto;\n    right: auto;\n    margin: 0;\n}\n\n.lumiverse-viewport-panel {\n    height: 100%;\n    display: flex;\n    flex-direction: row;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n    pointer-events: auto;\n}\n\n.lumiverse-viewport-panel--collapsed {\n    /* Just show the tab bar when collapsed */\n}\n\n/* Tab sidebar */\n.lumiverse-vp-tabs {\n    display: flex;\n    flex-direction: column;\n    width: 56px;\n    background: linear-gradient(180deg, rgba(28, 24, 38, 0.98) 0%, rgba(20, 17, 28, 0.98) 100%);\n    border-left: 1px solid rgba(147, 112, 219, 0.2);\n    padding: 8px 0; /* Minimal padding - panel is at top of screen */\n    gap: 4px;\n}\n\n.lumiverse-vp-tab {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    width: 52px;\n    height: 52px;\n    margin: 0 2px;\n    background: transparent;\n    border: none;\n    border-radius: 8px;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-vp-tab:hover {\n    background: rgba(147, 112, 219, 0.15);\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-vp-tab--active {\n    background: rgba(147, 112, 219, 0.25);\n    color: var(--lumiverse-primary);\n    box-shadow: inset 2px 0 0 var(--lumiverse-primary);\n}\n\n.lumiverse-vp-tab-icon {\n    font-size: 18px;\n    line-height: 1;\n}\n\n.lumiverse-vp-tab-label {\n    font-size: 10px;\n    margin-top: 4px;\n    white-space: nowrap;\n    overflow: visible;\n    text-overflow: clip;\n    max-width: none;\n}\n\n.lumiverse-vp-tabs-spacer {\n    flex: 1;\n}\n\n.lumiverse-vp-collapse-btn {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 52px;\n    height: 40px;\n    margin: 0 2px;\n    background: transparent;\n    border: none;\n    border-radius: 8px;\n    cursor: pointer;\n    color: var(--lumiverse-text-muted);\n    font-size: 14px;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-vp-collapse-btn:hover {\n    background: rgba(147, 112, 219, 0.15);\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-vp-collapse-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: transform 0.2s ease;\n}\n\n.lumiverse-vp-collapse-icon--rotated {\n    transform: rotate(180deg);\n}\n\n/* Main panel area */\n.lumiverse-vp-main {\n    display: flex;\n    flex-direction: column;\n    background: linear-gradient(180deg, rgba(28, 24, 38, 0.98) 0%, rgba(20, 17, 28, 0.98) 100%);\n    border-left: 1px solid rgba(147, 112, 219, 0.15);\n    overflow: hidden;\n}\n\n.lumiverse-vp-header {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 12px 16px;\n    background: rgba(147, 112, 219, 0.08);\n    border-bottom: 1px solid rgba(147, 112, 219, 0.15);\n    min-height: 48px;\n}\n\n.lumiverse-vp-header-icon {\n    font-size: 18px;\n}\n\n.lumiverse-vp-header-title {\n    flex: 1;\n    font-size: 14px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-vp-close-btn {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 28px;\n    height: 28px;\n    background: transparent;\n    border: none;\n    border-radius: 6px;\n    cursor: pointer;\n    color: var(--lumiverse-text-muted);\n    font-size: 14px;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-vp-close-btn:hover {\n    background: rgba(255, 100, 100, 0.2);\n    color: #ff6464;\n}\n\n.lumiverse-vp-content {\n    flex: 1;\n    position: relative; /* Containing block for absolute exit animations */\n    overflow-y: auto;\n    overflow-x: hidden;\n    scrollbar-gutter: stable; /* Reserve scrollbar space to prevent layout shift */\n    contain: layout style; /* Isolate layout calculations for performance */\n}\n\n.lumiverse-vp-tab-content {\n    display: none; /* Hidden by default */\n    min-height: 100%;\n}\n\n.lumiverse-vp-tab-content--active {\n    display: block; /* Show active tab instantly */\n}\n\n/* Placeholder content */\n.lumiverse-vp-placeholder {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    padding: 40px 20px;\n    text-align: center;\n    min-height: 300px;\n}\n\n.lumiverse-vp-placeholder-icon {\n    font-size: 48px;\n    margin-bottom: 16px;\n    opacity: 0.6;\n}\n\n.lumiverse-vp-placeholder h3 {\n    margin: 0 0 8px 0;\n    font-size: 16px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-vp-placeholder p {\n    margin: 0 0 16px 0;\n    font-size: 13px;\n    color: var(--lumiverse-text-muted);\n    max-width: 240px;\n}\n\n.lumiverse-vp-placeholder-badge {\n    display: inline-block;\n    padding: 4px 12px;\n    background: rgba(147, 112, 219, 0.15);\n    border: 1px solid rgba(147, 112, 219, 0.3);\n    border-radius: 12px;\n    font-size: 11px;\n    font-weight: 600;\n    color: var(--lumiverse-primary);\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n/* ----------------------------------------\n   Character Lumia Profile\n   ---------------------------------------- */\n.lumiverse-character-profile {\n    padding: 16px;\n    display: flex;\n    flex-direction: column;\n    gap: 16px;\n}\n\n/* Profile Header */\n.lumiverse-profile-header {\n    display: flex;\n    align-items: center;\n    gap: 14px;\n    padding-bottom: 16px;\n    border-bottom: 1px solid rgba(147, 112, 219, 0.15);\n}\n\n.lumiverse-profile-avatar {\n    width: 56px;\n    height: 56px;\n    border-radius: 12px;\n    overflow: hidden;\n    background: rgba(147, 112, 219, 0.1);\n    flex-shrink: 0;\n    border: 2px solid rgba(147, 112, 219, 0.3);\n}\n\n.lumiverse-profile-avatar img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n    animation: lumiverseFadeIn 0.2s ease;\n}\n\n.lumiverse-profile-avatar-placeholder {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 100%;\n    height: 100%;\n    font-size: 24px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-profile-info {\n    flex: 1;\n    min-width: 0;\n}\n\n.lumiverse-profile-name {\n    margin: 0 0 8px 0;\n    font-size: 16px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-profile-stats {\n    display: flex;\n    gap: 6px;\n}\n\n.lumiverse-stat {\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    gap: 4px;\n    padding: 4px 8px;\n    background: rgba(147, 112, 219, 0.08);\n    border-radius: 6px;\n    cursor: default;\n}\n\n.lumiverse-stat-icon {\n    color: var(--lumiverse-text-muted);\n    flex-shrink: 0;\n}\n\n.lumiverse-stat-value {\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--lumiverse-primary);\n}\n\n/* Profile Sections */\n.lumiverse-profile-section {\n    background: rgba(147, 112, 219, 0.05);\n    border-radius: 10px;\n    padding: 12px;\n}\n\n.lumiverse-profile-section-header {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    margin-bottom: 10px;\n}\n\n.lumiverse-profile-section-icon {\n    font-size: 14px;\n}\n\n.lumiverse-profile-section-title {\n    font-size: 12px;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    color: var(--lumiverse-text-muted);\n    flex: 1;\n}\n\n.lumiverse-profile-section-count {\n    font-size: 11px;\n    font-weight: 600;\n    color: var(--lumiverse-primary);\n    background: rgba(147, 112, 219, 0.15);\n    padding: 2px 8px;\n    border-radius: 10px;\n}\n\n/* Council Banner - shown in Profile tab when Council mode is active */\n.lumiverse-council-banner {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 16px;\n    padding: 24px 20px;\n    background: linear-gradient(\n        135deg,\n        rgba(147, 112, 219, 0.12) 0%,\n        rgba(100, 180, 255, 0.08) 100%\n    );\n    border: 1px solid rgba(147, 112, 219, 0.2);\n    border-radius: 12px;\n    text-align: center;\n}\n\n.lumiverse-council-banner-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 56px;\n    height: 56px;\n    background: linear-gradient(135deg, rgba(147, 112, 219, 0.25) 0%, rgba(100, 180, 255, 0.15) 100%);\n    border-radius: 50%;\n    color: var(--lumiverse-primary);\n}\n\n.lumiverse-council-banner-content {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n    width: 100%;\n}\n\n.lumiverse-council-banner-title {\n    font-size: 15px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    margin: 0;\n}\n\n.lumiverse-council-banner-stats {\n    display: flex;\n    justify-content: center;\n    gap: 16px;\n    flex-wrap: wrap;\n}\n\n.lumiverse-council-banner-stat {\n    display: flex;\n    align-items: center;\n    gap: 5px;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-council-banner-stat svg {\n    color: var(--lumiverse-primary);\n    opacity: 0.8;\n}\n\n.lumiverse-council-banner-avatars {\n    display: flex;\n    justify-content: center;\n    margin-top: 4px;\n}\n\n.lumiverse-council-banner-avatar {\n    width: 36px;\n    height: 36px;\n    border-radius: 50%;\n    background: rgba(147, 112, 219, 0.2);\n    border: 2px solid var(--lumiverse-surface);\n    margin-left: -10px;\n    overflow: hidden;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-council-banner-avatar:first-child {\n    margin-left: 0;\n}\n\n.lumiverse-council-banner-avatar img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n    animation: lumiverseFadeIn 0.2s ease;\n}\n\n.lumiverse-council-banner-more {\n    width: 36px;\n    height: 36px;\n    border-radius: 50%;\n    background: rgba(147, 112, 219, 0.3);\n    border: 2px solid var(--lumiverse-surface);\n    margin-left: -10px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 11px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-council-banner-btn {\n    display: inline-flex;\n    align-items: center;\n    gap: 6px;\n    padding: 10px 20px;\n    font-size: 13px;\n    font-weight: 500;\n    color: white;\n    background: linear-gradient(135deg, rgba(147, 112, 219, 0.9) 0%, rgba(123, 95, 196, 0.9) 100%);\n    border: none;\n    border-radius: 8px;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    margin-top: 4px;\n}\n\n.lumiverse-council-banner-btn:hover {\n    background: linear-gradient(135deg, rgba(167, 139, 240, 0.95) 0%, rgba(147, 112, 219, 0.95) 100%);\n    transform: translateY(-1px);\n    box-shadow: 0 4px 12px rgba(147, 112, 219, 0.3);\n}\n\n.lumiverse-council-banner-btn svg {\n    transition: transform 0.2s ease;\n}\n\n.lumiverse-council-banner-btn:hover svg {\n    transform: translateX(3px);\n}\n\n/* Trait Cards */\n.lumiverse-traits-list {\n    display: flex;\n    flex-direction: column;\n    gap: 6px;\n}\n\n.lumiverse-trait-card {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 10px 12px;\n    border-radius: 8px;\n    border: 1px solid transparent;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-trait-card:hover {\n    transform: translateX(2px);\n}\n\n.lumiverse-trait-card--dominant {\n    box-shadow: 0 0 0 1px rgba(245, 158, 11, 0.4), 0 2px 8px rgba(245, 158, 11, 0.15);\n}\n\n.lumiverse-trait-icon {\n    font-size: 14px;\n    flex-shrink: 0;\n}\n\n.lumiverse-trait-info {\n    flex: 1;\n    min-width: 0;\n    display: flex;\n    align-items: center;\n    gap: 8px;\n}\n\n.lumiverse-trait-name {\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-trait-dominant-badge {\n    font-size: 10px;\n    font-weight: 600;\n    color: var(--lumiverse-warning);\n    background: rgba(245, 158, 11, 0.15);\n    padding: 2px 6px;\n    border-radius: 4px;\n    white-space: nowrap;\n}\n\n.lumiverse-trait-remove {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 22px;\n    height: 22px;\n    background: transparent;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n    color: var(--lumiverse-text-muted);\n    font-size: 12px;\n    opacity: 0;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-trait-card:hover .lumiverse-trait-remove {\n    opacity: 1;\n}\n\n.lumiverse-trait-remove:hover {\n    background: rgba(239, 68, 68, 0.15);\n    color: var(--lumiverse-danger);\n}\n\n/* Empty Section */\n.lumiverse-profile-empty {\n    padding: 16px;\n    text-align: center;\n    color: var(--lumiverse-text-dim);\n    font-size: 12px;\n    font-style: italic;\n}\n\n/* Loom Summary */\n.lumiverse-loom-summary {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumiverse-loom-group {\n    display: flex;\n    align-items: flex-start;\n    gap: 8px;\n    font-size: 12px;\n}\n\n.lumiverse-loom-label {\n    font-weight: 600;\n    color: var(--lumiverse-text-muted);\n    flex-shrink: 0;\n    min-width: 60px;\n}\n\n.lumiverse-loom-items {\n    color: var(--lumiverse-text);\n    line-height: 1.4;\n}\n\n/* ----------------------------------------\n   Visual Pack Browser\n   ---------------------------------------- */\n.lumiverse-pack-browser {\n    padding: 12px;\n    display: flex;\n    flex-direction: column;\n    gap: 12px;\n    height: 100%;\n}\n\n/* Stats Bar */\n.lumiverse-browser-stats {\n    display: flex;\n    justify-content: space-between;\n    padding: 10px 12px;\n    background: rgba(147, 112, 219, 0.08);\n    border-radius: 10px;\n    gap: 8px;\n}\n\n.lumiverse-browser-stat {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    flex: 1;\n}\n\n.lumiverse-browser-stat-value {\n    font-size: 16px;\n    font-weight: 700;\n    color: var(--lumiverse-primary);\n}\n\n.lumiverse-browser-stat-label {\n    font-size: 9px;\n    letter-spacing: 0.5px;\n    color: var(--lumiverse-text-muted);\n}\n\n/* Search */\n.lumiverse-pack-search {\n    display: flex;\n    align-items: center;\n    background: rgba(30, 30, 46, 0.8);\n    border: 1px solid rgba(147, 112, 219, 0.2);\n    border-radius: 8px;\n    padding: 0 12px;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-pack-search:focus-within {\n    border-color: var(--lumiverse-primary);\n    box-shadow: 0 0 0 2px rgba(147, 112, 219, 0.15);\n}\n\n.lumiverse-pack-search-icon {\n    font-size: 14px;\n    margin-right: 8px;\n    opacity: 0.6;\n}\n\n.lumiverse-pack-search-input {\n    flex: 1;\n    background: transparent;\n    border: none;\n    padding: 10px 0;\n    color: var(--lumiverse-text);\n    font-size: 13px;\n}\n\n.lumiverse-pack-search-input:focus {\n    outline: none;\n}\n\n.lumiverse-pack-search-input::placeholder {\n    color: var(--lumiverse-text-dim);\n}\n\n.lumiverse-pack-search-clear {\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    padding: 4px;\n    font-size: 12px;\n    opacity: 0.6;\n    transition: opacity 0.15s ease;\n}\n\n.lumiverse-pack-search-clear:hover {\n    opacity: 1;\n}\n\n/* Filter Tabs */\n.lumiverse-pack-filters {\n    display: flex;\n    gap: 2px;\n    padding: 4px;\n    background: rgba(30, 30, 46, 0.6);\n    border-radius: 8px;\n}\n\n.lumiverse-pack-filter {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    flex: 1;\n    min-width: 32px;\n    height: 32px;\n    background: transparent;\n    border: none;\n    border-radius: 6px;\n    cursor: pointer;\n    transition: all 0.15s ease;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-pack-filter:hover {\n    background: rgba(147, 112, 219, 0.1);\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-pack-filter--active {\n    background: rgba(147, 112, 219, 0.2);\n    color: var(--lumiverse-primary);\n}\n\n/* Filter container with toggle */\n.lumiverse-pack-filters-container {\n    display: flex;\n    gap: 8px;\n    align-items: stretch;\n}\n\n.lumiverse-pack-filters-container .lumiverse-pack-filters {\n    flex: 1;\n}\n\n/* Selected Only Toggle */\n.lumiverse-pack-filter-selected-toggle {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 4px;\n    padding: 4px 8px;\n    background: rgba(30, 30, 46, 0.6);\n    border: 1px solid transparent;\n    border-radius: 8px;\n    cursor: pointer;\n    transition: all 0.15s ease;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-pack-filter-selected-toggle:hover {\n    background: rgba(147, 112, 219, 0.15);\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-pack-filter-selected-toggle--active {\n    background: rgba(147, 112, 219, 0.25);\n    border-color: rgba(147, 112, 219, 0.4);\n    color: var(--lumiverse-primary);\n}\n\n.lumiverse-pack-filter-selected-count {\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    min-width: 16px;\n    height: 16px;\n    padding: 0 4px;\n    background: rgba(147, 112, 219, 0.3);\n    border-radius: 8px;\n    font-size: 10px;\n    font-weight: 600;\n    color: var(--lumiverse-primary);\n}\n\n.lumiverse-pack-filter-selected-toggle--active .lumiverse-pack-filter-selected-count {\n    background: rgba(147, 112, 219, 0.5);\n    color: var(--lumiverse-text);\n}\n\n/* Pack List */\n.lumiverse-browser-packs {\n    flex: 1;\n    overflow-y: auto;\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumiverse-browser-pack {\n    background: rgba(30, 30, 46, 0.6);\n    border-radius: 10px;\n    overflow: hidden;\n    border: 1px solid rgba(147, 112, 219, 0.1);\n}\n\n/* Pack Header */\n.lumiverse-browser-pack-header {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    width: 100%;\n    padding: 10px 12px;\n    background: transparent;\n    border: none;\n    cursor: pointer;\n    transition: background 0.15s ease;\n    text-align: left;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-browser-pack-header:hover {\n    background: rgba(147, 112, 219, 0.08);\n}\n\n.lumiverse-browser-pack-header--expanded {\n    background: rgba(147, 112, 219, 0.1);\n    border-bottom: 1px solid rgba(147, 112, 219, 0.15);\n}\n\n.lumiverse-browser-pack-cover {\n    width: 36px;\n    height: 36px;\n    border-radius: 6px;\n    object-fit: cover;\n    flex-shrink: 0;\n    animation: lumiverseFadeIn 0.2s ease;\n}\n\n.lumiverse-browser-pack-cover-placeholder {\n    width: 36px;\n    height: 36px;\n    border-radius: 6px;\n    background: rgba(147, 112, 219, 0.15);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 18px;\n    flex-shrink: 0;\n}\n\n.lumiverse-browser-pack-info {\n    flex: 1;\n    min-width: 0;\n    display: flex;\n    flex-direction: column;\n}\n\n.lumiverse-browser-pack-name {\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-browser-pack-meta {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n    margin-top: 2px;\n}\n\n.lumiverse-browser-pack-custom-badge {\n    font-size: 9px;\n    font-weight: 600;\n    text-transform: uppercase;\n    color: var(--lumiverse-warning);\n    background: rgba(245, 158, 11, 0.15);\n    padding: 1px 4px;\n    border-radius: 3px;\n}\n\n.lumiverse-browser-pack-chevron {\n    font-size: 10px;\n    color: var(--lumiverse-text-muted);\n    transition: transform 0.2s ease;\n}\n\n.lumiverse-browser-pack-chevron--rotated {\n    transform: rotate(180deg);\n}\n\n/* Pack Items */\n.lumiverse-browser-pack-items {\n    overflow: hidden;\n}\n\n.lumiverse-browser-items-container {\n    padding: 8px 10px;\n}\n\n.lumiverse-browser-items-container::-webkit-scrollbar {\n    width: 6px;\n}\n\n.lumiverse-browser-items-container::-webkit-scrollbar-track {\n    background: transparent;\n}\n\n.lumiverse-browser-items-container::-webkit-scrollbar-thumb {\n    background: rgba(147, 112, 219, 0.3);\n    border-radius: 3px;\n}\n\n/* Item Card */\n.lumiverse-browser-item {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 8px 10px;\n    border-radius: 6px;\n    border: 1px solid transparent;\n    cursor: pointer;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-browser-item:hover {\n    transform: translateX(2px);\n}\n\n.lumiverse-browser-item--selected {\n    box-shadow:\n        0 0 0 1px currentColor,\n        0 2px 8px rgba(0, 0, 0, 0.15);\n}\n\n.lumiverse-browser-item-check {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 18px;\n    height: 18px;\n    border-radius: 50%;\n    background: rgba(100, 200, 100, 0.9);\n    color: white;\n    margin-left: auto;\n    flex-shrink: 0;\n}\n\n.lumiverse-browser-item-image {\n    width: 32px;\n    height: 32px;\n    border-radius: 4px;\n    object-fit: cover;\n    flex-shrink: 0;\n    animation: lumiverseFadeIn 0.2s ease;\n}\n\n.lumiverse-browser-item-content {\n    flex: 1;\n    min-width: 0;\n}\n\n.lumiverse-browser-item-header {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n}\n\n.lumiverse-browser-item-icon {\n    font-size: 12px;\n}\n\n.lumiverse-browser-item-name {\n    font-size: 12px;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-browser-item-desc {\n    margin: 2px 0 0 0;\n    font-size: 10px;\n    color: var(--lumiverse-text-muted);\n    overflow: hidden;\n    text-overflow: ellipsis;\n    display: -webkit-box;\n    -webkit-line-clamp: 1;\n    -webkit-box-orient: vertical;\n}\n\n/* Empty States */\n.lumiverse-browser-empty {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    padding: 40px 20px;\n    text-align: center;\n}\n\n.lumiverse-browser-empty-icon {\n    font-size: 40px;\n    margin-bottom: 12px;\n    opacity: 0.5;\n}\n\n.lumiverse-browser-empty p {\n    margin: 0 0 4px 0;\n    font-size: 14px;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-browser-empty-hint {\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-browser-empty-items {\n    padding: 16px;\n    text-align: center;\n    color: var(--lumiverse-text-dim);\n    font-size: 12px;\n    font-style: italic;\n}\n\n/* Clear All Selections Button */\n.lumiverse-browser-clear-all {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 8px;\n    width: 100%;\n    padding: 10px 16px;\n    margin-top: 12px;\n    background: linear-gradient(\n        135deg,\n        rgba(220, 80, 80, 0.08) 0%,\n        rgba(180, 60, 90, 0.12) 100%\n    );\n    border: 1px solid rgba(220, 100, 100, 0.2);\n    border-radius: 8px;\n    color: var(--lumiverse-text-muted);\n    font-size: 12px;\n    font-weight: 500;\n    letter-spacing: 0.02em;\n    cursor: pointer;\n    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);\n}\n\n.lumiverse-browser-clear-all:hover {\n    background: linear-gradient(\n        135deg,\n        rgba(220, 80, 80, 0.15) 0%,\n        rgba(180, 60, 90, 0.2) 100%\n    );\n    border-color: rgba(220, 100, 100, 0.4);\n    color: var(--lumiverse-text);\n    transform: translateY(-1px);\n}\n\n.lumiverse-browser-clear-all:active {\n    transform: translateY(0);\n}\n\n.lumiverse-browser-clear-count {\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    min-width: 18px;\n    height: 18px;\n    padding: 0 5px;\n    background: rgba(220, 100, 100, 0.25);\n    border-radius: 9px;\n    font-size: 10px;\n    font-weight: 600;\n}\n\n/* ----------------------------------------\n   Preset Manager\n   ---------------------------------------- */\n.lumiverse-preset-manager {\n    padding: 12px;\n    display: flex;\n    flex-direction: column;\n    gap: 16px;\n}\n\n.lumiverse-preset-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    gap: 12px;\n}\n\n.lumiverse-preset-title {\n    margin: 0;\n    font-size: 14px;\n    font-weight: 600;\n    color: var(--lumiverse-text-primary);\n}\n\n.lumiverse-preset-create-btn {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    padding: 6px 12px;\n    background: rgba(147, 112, 219, 0.2);\n    border: 1px solid rgba(147, 112, 219, 0.3);\n    border-radius: 6px;\n    color: rgba(147, 112, 219, 1);\n    font-size: 12px;\n    font-weight: 500;\n    cursor: pointer;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-preset-create-btn:hover {\n    background: rgba(147, 112, 219, 0.3);\n    border-color: rgba(147, 112, 219, 0.5);\n}\n\n.lumiverse-preset-create-form {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    min-width: 0;\n    flex: 1;\n    max-width: 220px;\n}\n\n.lumiverse-preset-input {\n    flex: 1;\n    padding: 6px 10px;\n    background: rgba(30, 30, 46, 0.8);\n    border: 1px solid rgba(147, 112, 219, 0.3);\n    border-radius: 6px;\n    color: var(--lumiverse-text-primary);\n    font-size: 12px;\n    min-width: 0;\n    width: 100%;\n}\n\n/* Responsive: preset form on small screens */\n@media (max-width: 380px) {\n    .lumiverse-preset-header {\n        flex-wrap: wrap;\n        gap: 8px;\n    }\n\n    .lumiverse-preset-create-form {\n        width: 100%;\n        max-width: none;\n        order: 1;\n    }\n\n    .lumiverse-preset-title {\n        flex: 1;\n    }\n}\n\n.lumiverse-preset-input:focus {\n    outline: none;\n    border-color: rgba(147, 112, 219, 0.6);\n}\n\n.lumiverse-preset-input::placeholder {\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-preset-list {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n}\n\n.lumiverse-preset-card {\n    background: rgba(30, 30, 46, 0.6);\n    border: 1px solid rgba(255, 255, 255, 0.08);\n    border-radius: 10px;\n    padding: 12px;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-preset-card:hover {\n    background: rgba(30, 30, 46, 0.8);\n    border-color: rgba(147, 112, 219, 0.2);\n}\n\n.lumiverse-preset-card--active {\n    border-color: rgba(147, 112, 219, 0.4);\n    background: rgba(147, 112, 219, 0.08);\n}\n\n.lumiverse-preset-card-header {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    margin-bottom: 8px;\n}\n\n.lumiverse-preset-card-icon {\n    color: rgba(147, 112, 219, 0.8);\n}\n\n.lumiverse-preset-card-name {\n    flex: 1;\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--lumiverse-text-primary);\n}\n\n.lumiverse-preset-card-active-badge {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    padding: 2px 8px;\n    background: rgba(147, 112, 219, 0.2);\n    border-radius: 10px;\n    font-size: 10px;\n    font-weight: 500;\n    color: rgba(147, 112, 219, 1);\n}\n\n.lumiverse-preset-card-meta {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    margin-bottom: 10px;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-preset-card-traits {\n    color: var(--lumiverse-text-secondary);\n}\n\n/* Preset stats with icons */\n.lumiverse-preset-stats {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n}\n\n.lumiverse-preset-stat {\n    display: flex;\n    align-items: center;\n    gap: 3px;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-preset-stat svg {\n    opacity: 0.7;\n}\n\n.lumiverse-preset-stat--chimera {\n    color: rgba(100, 200, 255, 0.9);\n}\n\n.lumiverse-preset-stat--chimera svg {\n    color: rgba(100, 200, 255, 0.9);\n    opacity: 1;\n}\n\n.lumiverse-preset-stat--council {\n    color: rgba(147, 112, 219, 0.9);\n}\n\n.lumiverse-preset-stat--council svg {\n    color: rgba(147, 112, 219, 0.9);\n    opacity: 1;\n}\n\n.lumiverse-preset-card-mode {\n    padding: 2px 6px;\n    background: rgba(255, 193, 7, 0.15);\n    border-radius: 4px;\n    font-size: 10px;\n    color: rgba(255, 193, 7, 0.9);\n}\n\n.lumiverse-preset-card-time {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    margin-left: auto;\n}\n\n.lumiverse-preset-card-actions {\n    display: flex;\n    gap: 6px;\n}\n\n.lumiverse-preset-btn {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    padding: 6px 10px;\n    background: rgba(255, 255, 255, 0.06);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    border-radius: 6px;\n    color: var(--lumiverse-text-secondary);\n    font-size: 12px;\n    font-weight: 500;\n    cursor: pointer;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-preset-btn:hover {\n    background: rgba(255, 255, 255, 0.1);\n    color: var(--lumiverse-text-primary);\n}\n\n.lumiverse-preset-btn--primary {\n    background: rgba(147, 112, 219, 0.2);\n    border-color: rgba(147, 112, 219, 0.3);\n    color: rgba(147, 112, 219, 1);\n}\n\n.lumiverse-preset-btn--primary:hover {\n    background: rgba(147, 112, 219, 0.3);\n    border-color: rgba(147, 112, 219, 0.5);\n}\n\n.lumiverse-preset-btn--primary:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n}\n\n.lumiverse-preset-btn--danger {\n    color: rgba(255, 100, 100, 0.8);\n}\n\n.lumiverse-preset-btn--danger:hover {\n    background: rgba(255, 100, 100, 0.15);\n    border-color: rgba(255, 100, 100, 0.3);\n    color: rgba(255, 100, 100, 1);\n}\n\n.lumiverse-preset-btn--confirming {\n    background: rgba(255, 100, 100, 0.2);\n    border-color: rgba(255, 100, 100, 0.4);\n    color: rgba(255, 100, 100, 1);\n}\n\n.lumiverse-preset-empty {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    padding: 32px 16px;\n    text-align: center;\n}\n\n.lumiverse-preset-empty-icon {\n    margin-bottom: 12px;\n    color: var(--lumiverse-text-muted);\n    opacity: 0.5;\n}\n\n.lumiverse-preset-empty h4 {\n    margin: 0 0 8px 0;\n    font-size: 14px;\n    font-weight: 600;\n    color: var(--lumiverse-text-primary);\n}\n\n.lumiverse-preset-empty p {\n    margin: 0;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n    max-width: 240px;\n}\n\n.lumiverse-preset-help {\n    padding: 10px;\n    background: rgba(30, 30, 46, 0.4);\n    border-radius: 8px;\n}\n\n.lumiverse-preset-help p {\n    margin: 0;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n    line-height: 1.5;\n}\n\n/* ----------------------------------------\n   OOC Analytics Dashboard\n   ---------------------------------------- */\n.lumiverse-ooc-analytics {\n    padding: 12px;\n    display: flex;\n    flex-direction: column;\n    gap: 16px;\n}\n\n.lumiverse-analytics-section {\n    background: rgba(30, 30, 46, 0.6);\n    border-radius: 10px;\n    padding: 12px;\n}\n\n.lumiverse-analytics-section-title {\n    margin: 0 0 12px 0;\n    font-size: 11px;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    color: var(--lumiverse-text-muted);\n}\n\n/* Stats Grid */\n.lumiverse-analytics-stats-grid {\n    display: grid;\n    grid-template-columns: repeat(2, 1fr);\n    gap: 8px;\n}\n\n.lumiverse-analytics-stat {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 10px 12px;\n    background: rgba(147, 112, 219, 0.08);\n    border-radius: 8px;\n    border: 1px solid rgba(147, 112, 219, 0.15);\n}\n\n.lumiverse-analytics-stat-icon {\n    font-size: 20px;\n    flex-shrink: 0;\n}\n\n.lumiverse-analytics-stat-info {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n}\n\n.lumiverse-analytics-stat-value {\n    font-size: 18px;\n    font-weight: 700;\n    color: var(--lumiverse-primary);\n}\n\n.lumiverse-analytics-stat-label {\n    font-size: 10px;\n    color: var(--lumiverse-text-muted);\n    text-transform: uppercase;\n    letter-spacing: 0.3px;\n}\n\n.lumiverse-analytics-stat-trend {\n    font-size: 14px;\n    padding: 2px 6px;\n    border-radius: 4px;\n    background: rgba(147, 112, 219, 0.15);\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-analytics-stat-trend--up {\n    background: rgba(34, 197, 94, 0.15);\n    color: var(--lumiverse-success);\n}\n\n.lumiverse-analytics-stat-trend--down {\n    background: rgba(239, 68, 68, 0.15);\n    color: var(--lumiverse-danger);\n}\n\n/* Type Distribution */\n.lumiverse-analytics-distribution {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumiverse-analytics-bars {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n}\n\n.lumiverse-analytics-bar-item {\n    display: flex;\n    flex-direction: column;\n    gap: 4px;\n}\n\n.lumiverse-analytics-bar-label {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    font-size: 12px;\n}\n\n.lumiverse-analytics-bar-icon {\n    font-size: 12px;\n}\n\n.lumiverse-analytics-bar-name {\n    flex: 1;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-analytics-bar-count {\n    color: var(--lumiverse-text-muted);\n    font-weight: 600;\n}\n\n.lumiverse-analytics-bar-track {\n    height: 6px;\n    background: rgba(147, 112, 219, 0.1);\n    border-radius: 3px;\n    overflow: hidden;\n}\n\n.lumiverse-analytics-bar-fill {\n    height: 100%;\n    border-radius: 3px;\n    transition: width 0.5s ease-out;\n}\n\n/* Insights */\n.lumiverse-analytics-insights {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumiverse-analytics-insight {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 10px 12px;\n    background: rgba(147, 112, 219, 0.05);\n    border-radius: 8px;\n}\n\n.lumiverse-analytics-insight-icon {\n    font-size: 18px;\n    flex-shrink: 0;\n}\n\n.lumiverse-analytics-insight-content {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n}\n\n.lumiverse-analytics-insight-title {\n    font-size: 10px;\n    color: var(--lumiverse-text-muted);\n    text-transform: uppercase;\n    letter-spacing: 0.3px;\n}\n\n.lumiverse-analytics-insight-value {\n    font-size: 14px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-analytics-insight-desc {\n    font-size: 11px;\n    color: var(--lumiverse-text-dim);\n}\n\n/* Timeline */\n.lumiverse-analytics-timeline {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumiverse-analytics-comment {\n    display: flex;\n    align-items: flex-start;\n    gap: 10px;\n    padding: 8px 10px;\n    background: rgba(147, 112, 219, 0.05);\n    border-radius: 6px;\n    border-left: 2px solid var(--lumiverse-primary);\n}\n\n.lumiverse-analytics-comment-icon {\n    font-size: 14px;\n    flex-shrink: 0;\n    margin-top: 2px;\n}\n\n.lumiverse-analytics-comment-content {\n    flex: 1;\n    min-width: 0;\n}\n\n.lumiverse-analytics-comment-text {\n    margin: 0;\n    font-size: 12px;\n    color: var(--lumiverse-text);\n    line-height: 1.4;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    display: -webkit-box;\n    -webkit-line-clamp: 2;\n    -webkit-box-orient: vertical;\n}\n\n.lumiverse-analytics-comment-time {\n    font-size: 10px;\n    color: var(--lumiverse-text-dim);\n}\n\n/* Quick Controls */\n.lumiverse-analytics-controls {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n/* Empty state */\n.lumiverse-analytics-empty {\n    padding: 20px;\n    text-align: center;\n    color: var(--lumiverse-text-dim);\n    font-size: 12px;\n    font-style: italic;\n}\n\n/* ----------------------------------------\n   Panel Toggle Button\n   ---------------------------------------- */\n.lumiverse-panel-toggle {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    padding: 8px 14px;\n    background: linear-gradient(135deg, rgba(147, 112, 219, 0.95) 0%, rgba(123, 88, 195, 0.95) 100%);\n    border: 1px solid rgba(255, 255, 255, 0.2);\n    border-radius: 20px;\n    cursor: pointer;\n    box-shadow: 0 4px 12px rgba(147, 112, 219, 0.4), 0 0 20px rgba(147, 112, 219, 0.2);\n    white-space: nowrap;\n    transition: box-shadow 0.15s ease, border-color 0.15s ease;\n}\n\n.lumiverse-panel-toggle:hover {\n    box-shadow: 0 4px 16px rgba(147, 112, 219, 0.6), 0 0 35px rgba(147, 112, 219, 0.4);\n    border-color: rgba(255, 255, 255, 0.35);\n}\n\n.lumiverse-panel-toggle--active {\n    background: linear-gradient(135deg, rgba(100, 80, 180, 0.95) 0%, rgba(80, 60, 160, 0.95) 100%);\n    /* Position is now controlled by transform (x) for sync with panel animation */\n}\n\n.lumiverse-panel-toggle-icon {\n    font-size: 16px;\n    line-height: 1;\n}\n\n.lumiverse-panel-toggle-label {\n    font-size: 12px;\n    font-weight: 600;\n    color: white;\n    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);\n}\n\n/* ----------------------------------------\n   Viewport Panel - Settings Panels\n   ---------------------------------------- */\n\n/* General settings panel styles */\n.lumiverse-vp-settings-panel {\n    padding: 16px;\n    display: flex;\n    flex-direction: column;\n    gap: 16px;\n}\n\n.lumiverse-vp-settings-section {\n    background: rgba(147, 112, 219, 0.05);\n    border: 1px solid rgba(147, 112, 219, 0.15);\n    border-radius: 10px;\n    padding: 14px;\n}\n\n.lumiverse-vp-settings-section-header {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    margin-bottom: 10px;\n    color: var(--lumiverse-text);\n    font-weight: 600;\n    font-size: 13px;\n}\n\n.lumiverse-vp-settings-desc {\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n    margin: 0 0 12px 0;\n    line-height: 1.4;\n}\n\n/* Toggle row */\n.lumiverse-vp-toggle-row {\n    display: flex;\n    align-items: flex-start;\n    justify-content: space-between;\n    padding: 8px 0;\n    gap: 12px;\n}\n\n.lumiverse-vp-toggle-label {\n    flex: 1;\n    cursor: pointer;\n}\n\n.lumiverse-vp-toggle-text {\n    display: block;\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-vp-toggle-hint {\n    display: block;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n    margin-top: 2px;\n}\n\n.lumiverse-vp-toggle-switch-wrapper {\n    flex-shrink: 0;\n}\n\n.lumiverse-vp-toggle-input {\n    display: none !important;\n    position: absolute !important;\n    opacity: 0 !important;\n    width: 0 !important;\n    height: 0 !important;\n    pointer-events: none !important;\n}\n\n.lumiverse-vp-toggle-track {\n    position: relative;\n    width: 40px;\n    height: 22px;\n    background: var(--lumiverse-secondary);\n    border-radius: 11px;\n    cursor: pointer;\n    transition: background 0.2s ease;\n}\n\n.lumiverse-vp-toggle-track--on {\n    background: var(--lumiverse-primary);\n}\n\n.lumiverse-vp-toggle-thumb {\n    position: absolute;\n    top: 2px;\n    left: 2px;\n    width: 18px;\n    height: 18px;\n    background: white;\n    border-radius: 50%;\n    transition: transform 0.2s ease;\n}\n\n.lumiverse-vp-toggle-track--on .lumiverse-vp-toggle-thumb {\n    transform: translateX(18px);\n}\n\n/* Disabled toggle states */\n.lumiverse-vp-toggle-row--disabled {\n    opacity: 0.5;\n    pointer-events: none;\n}\n\n.lumiverse-vp-toggle-row--disabled .lumiverse-vp-toggle-label {\n    cursor: not-allowed;\n}\n\n.lumiverse-vp-toggle-track--disabled {\n    background: var(--lumiverse-bg-dark) !important;\n    cursor: not-allowed;\n}\n\n.lumiverse-vp-toggle-track--disabled .lumiverse-vp-toggle-thumb {\n    background: rgba(255, 255, 255, 0.5);\n}\n\n/* Field input */\n.lumiverse-vp-field {\n    margin-bottom: 12px;\n}\n\n.lumiverse-vp-field--inline {\n    display: flex;\n    flex-wrap: wrap;\n    align-items: center;\n    gap: 8px;\n}\n\n.lumiverse-vp-field-label {\n    display: block;\n    font-size: 12px;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n    margin-bottom: 6px;\n}\n\n.lumiverse-vp-field--inline .lumiverse-vp-field-label {\n    margin-bottom: 0;\n    flex: 1;\n}\n\n.lumiverse-vp-field-input {\n    width: 100%;\n    padding: 8px 12px;\n    background: var(--lumiverse-bg);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 6px;\n    color: var(--lumiverse-text);\n    font-size: 13px;\n    transition: border-color 0.2s ease;\n}\n\n.lumiverse-vp-field-input:focus {\n    outline: none;\n    border-color: var(--lumiverse-primary);\n}\n\n.lumiverse-vp-field-input--small {\n    width: 70px;\n    text-align: center;\n}\n\n.lumiverse-vp-field-hint {\n    display: block;\n    font-size: 11px;\n    color: var(--lumiverse-text-dim);\n    margin-top: 4px;\n}\n\n.lumiverse-vp-field--inline .lumiverse-vp-field-hint {\n    flex-basis: 100%;\n}\n\n/* Style options (radio buttons) */\n.lumiverse-vp-style-options {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumiverse-vp-style-option {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 12px 14px;\n    background: var(--lumiverse-bg);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 8px;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-vp-style-option:hover {\n    border-color: var(--lumiverse-border-light);\n    background: var(--lumiverse-bg-hover);\n}\n\n.lumiverse-vp-style-option--selected {\n    border-color: var(--lumiverse-primary);\n    background: rgba(147, 112, 219, 0.1);\n}\n\n.lumiverse-vp-style-option input[type="radio"] {\n    display: none !important;\n    position: absolute !important;\n    opacity: 0 !important;\n    width: 0 !important;\n    height: 0 !important;\n    pointer-events: none !important;\n}\n\n.lumiverse-vp-style-option-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 32px;\n    height: 32px;\n    background: rgba(147, 112, 219, 0.15);\n    border-radius: 6px;\n    color: var(--lumiverse-primary);\n}\n\n.lumiverse-vp-style-option-text {\n    flex: 1;\n}\n\n.lumiverse-vp-style-option-title {\n    display: block;\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-vp-style-option-desc {\n    display: block;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n    margin-top: 2px;\n    line-height: 1.3;\n}\n\n/* Save button */\n.lumiverse-vp-save-btn {\n    width: 100%;\n    padding: 10px 16px;\n    background: var(--lumiverse-primary);\n    border: none;\n    border-radius: 8px;\n    color: white;\n    font-size: 13px;\n    font-weight: 600;\n    cursor: pointer;\n    transition: background 0.2s ease;\n}\n\n.lumiverse-vp-save-btn:hover {\n    background: var(--lumiverse-primary-hover);\n}\n\n/* Collapsible sections */\n.lumiverse-vp-collapsible {\n    background: rgba(147, 112, 219, 0.05);\n    border: 1px solid rgba(147, 112, 219, 0.15);\n    border-radius: 10px;\n    overflow: hidden;\n}\n\n.lumiverse-vp-collapsible-header {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    width: 100%;\n    padding: 12px 14px;\n    background: transparent;\n    border: none;\n    cursor: pointer;\n    color: var(--lumiverse-text);\n    font-size: 13px;\n    font-weight: 600;\n    text-align: left;\n    transition: background 0.2s ease;\n}\n\n.lumiverse-vp-collapsible-header:hover {\n    background: rgba(147, 112, 219, 0.08);\n}\n\n.lumiverse-vp-collapsible-chevron {\n    display: flex;\n    color: var(--lumiverse-text-muted);\n    transition: transform 0.2s ease;\n}\n\n.lumiverse-vp-collapsible-chevron--open {\n    transform: rotate(180deg);\n}\n\n.lumiverse-vp-collapsible-icon {\n    display: flex;\n    color: var(--lumiverse-primary);\n}\n\n.lumiverse-vp-collapsible-title {\n    flex: 1;\n}\n\n.lumiverse-vp-collapsible-status {\n    padding: 2px 8px;\n    background: rgba(100, 100, 100, 0.2);\n    border-radius: 10px;\n    font-size: 10px;\n    font-weight: 600;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-vp-collapsible-status--active {\n    background: rgba(34, 197, 94, 0.2);\n    color: var(--lumiverse-success);\n}\n\n.lumiverse-vp-collapsible-content {\n    overflow: hidden;\n}\n\n.lumiverse-vp-collapsible-inner {\n    padding: 12px 14px 14px 14px;\n}\n\n/* Info box */\n.lumiverse-vp-info-box {\n    background: rgba(147, 112, 219, 0.08);\n    border: 1px solid rgba(147, 112, 219, 0.2);\n    border-radius: 8px;\n    padding: 12px;\n    margin-top: 12px;\n}\n\n.lumiverse-vp-info-box--muted {\n    opacity: 0.5;\n}\n\n.lumiverse-vp-info-box-header {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    font-size: 11px;\n    font-weight: 600;\n    color: var(--lumiverse-primary);\n    margin-bottom: 8px;\n}\n\n.lumiverse-vp-info-box-list {\n    margin: 0;\n    padding: 0 0 0 16px;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n    line-height: 1.5;\n}\n\n.lumiverse-vp-info-box-list code {\n    background: rgba(147, 112, 219, 0.15);\n    padding: 1px 4px;\n    border-radius: 3px;\n    font-size: 10px;\n}\n\n/* Filter items */\n.lumiverse-vp-filter-item {\n    padding: 8px 0;\n    border-bottom: 1px solid rgba(147, 112, 219, 0.1);\n}\n\n.lumiverse-vp-filter-item:last-child {\n    border-bottom: none;\n}\n\n.lumiverse-vp-filter-options {\n    padding: 8px 0 0 24px;\n    overflow: hidden;\n}\n\n.lumiverse-vp-filter-sub {\n    padding-left: 16px;\n    border-left: 2px solid rgba(147, 112, 219, 0.2);\n    margin-left: 8px;\n}\n\n/* ----------------------------------------\n   Viewport Panel - Summary Editor\n   ---------------------------------------- */\n.lumiverse-vp-summary-editor {\n    display: flex;\n    flex-direction: column;\n    height: 100%;\n    padding: 12px;\n    gap: 12px;\n}\n\n.lumiverse-vp-summary-status {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    padding: 10px 12px;\n    border-radius: 8px;\n    font-size: 12px;\n    font-weight: 500;\n}\n\n.lumiverse-vp-summary-status--exists {\n    background: rgba(34, 197, 94, 0.1);\n    border: 1px solid rgba(34, 197, 94, 0.3);\n    color: var(--lumiverse-success);\n}\n\n.lumiverse-vp-summary-status--empty {\n    background: rgba(245, 158, 11, 0.1);\n    border: 1px solid rgba(245, 158, 11, 0.3);\n    color: var(--lumiverse-warning);\n}\n\n.lumiverse-vp-summary-status--no-chat {\n    background: rgba(100, 100, 100, 0.1);\n    border: 1px solid rgba(100, 100, 100, 0.3);\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-vp-summary-textarea-wrapper {\n    flex: 1;\n    min-height: 200px;\n    margin-bottom: 4px;\n    overflow: hidden;\n}\n\n.lumiverse-vp-summary-textarea {\n    width: 100%;\n    height: 100%;\n    min-height: 200px;\n    padding: 12px;\n    background: var(--lumiverse-bg);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 8px;\n    color: var(--lumiverse-text);\n    font-size: 12px;\n    font-family: inherit;\n    line-height: 1.5;\n    resize: none;\n    transition: border-color 0.2s ease;\n}\n\n.lumiverse-vp-summary-textarea:focus {\n    outline: none;\n    border-color: var(--lumiverse-primary);\n}\n\n.lumiverse-vp-summary-textarea::placeholder {\n    color: var(--lumiverse-text-dim);\n}\n\n.lumiverse-vp-summary-textarea:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n}\n\n.lumiverse-vp-summary-actions {\n    display: flex;\n    gap: 10px;\n    justify-content: center;\n    margin-top: 12px;\n    padding-top: 4px;\n}\n\n.lumiverse-vp-action-btn {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 6px;\n    padding: 8px 12px;\n    min-height: 36px;\n    border: none;\n    border-radius: 6px;\n    font-size: 12px;\n    font-weight: 500;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n/* Icon-only button mode */\n.lumiverse-vp-action-btn--icon-only {\n    padding: 10px 12px;\n    min-width: 44px;\n    width: 44px;\n    height: 40px;\n    flex: 1;\n    max-width: 56px;\n}\n\n.lumiverse-vp-action-btn--secondary {\n    background: var(--lumiverse-bg-elevated);\n    color: var(--lumiverse-text);\n    border: 1px solid var(--lumiverse-border);\n}\n\n.lumiverse-vp-action-btn--secondary:hover {\n    background: var(--lumiverse-bg-hover);\n}\n\n.lumiverse-vp-action-btn--primary {\n    background: var(--lumiverse-primary);\n    color: white;\n}\n\n.lumiverse-vp-action-btn--primary:hover {\n    background: var(--lumiverse-primary-hover);\n}\n\n.lumiverse-vp-action-btn--danger {\n    background: transparent;\n    color: var(--lumiverse-danger);\n    border: 1px solid var(--lumiverse-danger);\n}\n\n.lumiverse-vp-action-btn--danger:hover {\n    background: rgba(239, 68, 68, 0.1);\n}\n\n.lumiverse-vp-action-btn--disabled {\n    opacity: 0.4;\n    cursor: not-allowed;\n}\n\n.lumiverse-vp-summary-unsaved {\n    text-align: center;\n    font-size: 11px;\n    color: var(--lumiverse-warning);\n    padding: 4px;\n}\n\n/* Action button spinner */\n.lumiverse-vp-action-btn-spinner {\n    width: 14px;\n    height: 14px;\n    border: 2px solid rgba(255, 255, 255, 0.3);\n    border-top-color: white;\n    border-radius: 50%;\n    animation: lumiverse-spin 0.8s linear infinite;\n}\n\n.lumiverse-vp-action-btn--icon-only .lumiverse-vp-action-btn-spinner {\n    width: 16px;\n    height: 16px;\n}\n\n@keyframes lumiverse-spin {\n    to { transform: rotate(360deg); }\n}\n\n/* Summary config section */\n.lumiverse-vp-summary-config {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n}\n\n/* Radio group */\n.lumiverse-vp-radio-group {\n    display: flex;\n    gap: 8px;\n    flex-wrap: wrap;\n}\n\n.lumiverse-vp-radio-group--wide .lumiverse-vp-radio-option {\n    flex: 1;\n    min-width: 100px;\n}\n\n.lumiverse-vp-radio-option {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    padding: 8px 14px;\n    background: var(--lumiverse-bg);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 6px;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-vp-radio-option:hover {\n    border-color: var(--lumiverse-border-hover);\n    background: var(--lumiverse-bg-hover);\n}\n\n.lumiverse-vp-radio-option--selected {\n    border-color: var(--lumiverse-primary);\n    background: rgba(147, 112, 219, 0.15);\n}\n\n.lumiverse-vp-radio-option input[type="radio"] {\n    display: none !important;\n    position: absolute !important;\n    opacity: 0 !important;\n    width: 0 !important;\n    height: 0 !important;\n    pointer-events: none !important;\n}\n\n.lumiverse-vp-radio-option-label {\n    font-size: 12px;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n}\n\n/* Field rows */\n.lumiverse-vp-field-row {\n    display: flex;\n    gap: 12px;\n}\n\n.lumiverse-vp-field-row .lumiverse-vp-field {\n    flex: 1;\n}\n\n.lumiverse-vp-field-row--3 .lumiverse-vp-field {\n    flex: 1;\n    min-width: 0;\n}\n\n/* Select field */\n.lumiverse-vp-field-select {\n    width: 100%;\n    padding: 8px 12px;\n    background: var(--lumiverse-bg);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 6px;\n    color: var(--lumiverse-text);\n    font-size: 12px;\n    cursor: pointer;\n    transition: border-color 0.2s ease;\n    appearance: none;\n    background-image: url(${g});\n    background-repeat: no-repeat;\n    background-position: right 10px center;\n    padding-right: 30px;\n}\n\n.lumiverse-vp-field-select:focus {\n    outline: none;\n    border-color: var(--lumiverse-primary);\n}\n\n.lumiverse-vp-field-select option {\n    background: var(--lumiverse-bg);\n    color: var(--lumiverse-text);\n}\n\n/* Warning box */\n.lumiverse-vp-warning-box {\n    display: flex;\n    align-items: flex-start;\n    gap: 8px;\n    padding: 10px 12px;\n    margin-top: 10px;\n    background: rgba(245, 158, 11, 0.1);\n    border: 1px solid rgba(245, 158, 11, 0.3);\n    border-radius: 6px;\n    font-size: 11px;\n    color: var(--lumiverse-warning);\n    line-height: 1.4;\n}\n\n.lumiverse-vp-warning-box svg {\n    flex-shrink: 0;\n    margin-top: 1px;\n}\n\n/* Settings description */\n.lumiverse-vp-settings-desc {\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n    margin: 8px 0 0 0;\n    line-height: 1.4;\n}\n\n/* ============================================\n   LUMIA MODAL SYSTEM\n   Card-based selection modal design\n   ============================================ */\n\n/* Modal Backdrop */\n.lumia-modal-backdrop {\n    position: fixed;\n    inset: 0;\n    background: rgba(0, 0, 0, 0.5);\n    z-index: 9998;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    animation: lumia-backdrop-fadein 0.15s ease-out;\n}\n\n@keyframes lumia-backdrop-fadein {\n    from { opacity: 0; }\n    to { opacity: 1; }\n}\n\n/* Modal Container */\n.lumia-modal {\n    font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", sans-serif;\n    background: linear-gradient(\n        165deg,\n        rgba(22, 18, 32, 0.98) 0%,\n        rgba(28, 24, 40, 0.98) 100%\n    );\n    border: 1px solid rgba(147, 112, 219, 0.2);\n    border-radius: 16px;\n    box-shadow:\n        0 24px 80px rgba(0, 0, 0, 0.5),\n        0 0 1px rgba(147, 112, 219, 0.3);\n    padding: 0;\n    overflow: hidden;\n    display: flex;\n    flex-direction: column;\n    max-height: 85vh;\n    max-height: 85dvh;\n    height: auto;\n    width: 90vw;\n    max-width: 600px;\n    z-index: 9999;\n    /* Ensure flex children don't overflow */\n    min-height: 0;\n}\n\n/* Selection Modal Variant (wider for cards) */\n.lumia-modal-selection {\n    max-width: 700px;\n}\n\n/* Settings Modal Variant */\n.lumia-modal-settings {\n    max-width: 520px;\n}\n\n/* Editor Modal Variant - needs scrollable content */\n.lumia-modal-editor {\n    max-width: 640px;\n    width: 90%;\n}\n\n.lumia-modal-editor .lumia-modal-content {\n    flex: 1;\n    min-height: 0;\n    overflow-y: auto;\n    overflow-x: hidden;\n}\n\n/* Modal Selection Content Wrapper */\n.lumia-modal-selection-content {\n    display: flex;\n    flex-direction: column;\n    flex: 1;\n    min-height: 0; /* Allow flex children to shrink properly */\n    overflow: hidden; /* Let child scroll container handle overflow */\n}\n\n/* Modal Header - Inner (for modals with custom headers) */\n.lumia-modal-header-inner {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n    padding: 18px 20px;\n    background: linear-gradient(\n        180deg,\n        rgba(147, 112, 219, 0.1) 0%,\n        transparent 100%\n    );\n    border-bottom: 1px solid rgba(147, 112, 219, 0.12);\n    flex-shrink: 0;\n}\n\n.lumia-modal-header-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 36px;\n    height: 36px;\n    background: linear-gradient(\n        135deg,\n        rgba(147, 112, 219, 0.2) 0%,\n        rgba(147, 112, 219, 0.1) 100%\n    );\n    border-radius: 10px;\n    border: 1px solid rgba(147, 112, 219, 0.2);\n}\n\n.lumia-modal-header-icon svg {\n    width: 20px;\n    height: 20px;\n    stroke: rgba(186, 135, 255, 0.9);\n}\n\n.lumia-modal-header-text {\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n    flex: 1;\n    min-width: 0;\n}\n\n.lumia-modal-title {\n    font-size: 17px;\n    font-weight: 600;\n    color: rgba(255, 255, 255, 0.95);\n    letter-spacing: -0.2px;\n    margin: 0;\n    padding: 0;\n}\n\n.lumia-modal-subtitle {\n    font-size: 12px;\n    font-weight: 400;\n    color: rgba(255, 255, 255, 0.5);\n    margin: 0;\n    letter-spacing: 0.1px;\n}\n\n/* Clear Button */\n.lumia-clear-btn {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    padding: 8px 14px;\n    background: rgba(128, 128, 128, 0.1);\n    border: 1px solid rgba(128, 128, 128, 0.25);\n    border-radius: 8px;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    font-family: inherit;\n    font-size: 12px;\n    font-weight: 500;\n    color: rgba(255, 255, 255, 0.7);\n    flex-shrink: 0;\n    margin-left: auto;\n}\n\n.lumia-clear-btn svg {\n    width: 16px;\n    height: 16px;\n    stroke: rgba(255, 255, 255, 0.6);\n}\n\n.lumia-clear-btn:hover {\n    background: rgba(244, 67, 54, 0.15);\n    border-color: rgba(244, 67, 54, 0.4);\n    color: rgba(244, 67, 54, 0.95);\n}\n\n.lumia-clear-btn:hover svg {\n    stroke: rgba(244, 67, 54, 0.95);\n}\n\n/* Modal Content Area */\n.lumia-modal-content {\n    padding: 20px;\n    display: block;\n    flex: 1 1 auto;\n    overflow-y: auto;\n    overflow-x: hidden;\n    min-height: 0;\n}\n\n.lumia-modal-content > * + * {\n    margin-top: 16px;\n}\n\n/* Custom scrollbar for modal content */\n.lumia-modal-content::-webkit-scrollbar {\n    width: 8px;\n}\n\n.lumia-modal-content::-webkit-scrollbar-track {\n    background: rgba(0, 0, 0, 0.2);\n    border-radius: 4px;\n}\n\n.lumia-modal-content::-webkit-scrollbar-thumb {\n    background: rgba(147, 112, 219, 0.3);\n    border-radius: 4px;\n}\n\n.lumia-modal-content::-webkit-scrollbar-thumb:hover {\n    background: rgba(147, 112, 219, 0.5);\n}\n\n/* Modal Panel */\n.lumia-modal-panel {\n    background: rgba(0, 0, 0, 0.2);\n    border: 1px solid rgba(128, 128, 128, 0.12);\n    border-radius: 12px;\n    overflow: visible;\n}\n\n.lumia-modal-panel-header {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 12px 14px;\n    background: rgba(255, 255, 255, 0.02);\n    border-bottom: 1px solid rgba(128, 128, 128, 0.08);\n}\n\n.lumia-modal-panel-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 18px;\n    height: 18px;\n}\n\n.lumia-modal-panel-icon svg {\n    width: 16px;\n    height: 16px;\n    stroke: rgba(147, 112, 219, 0.7);\n}\n\n.lumia-modal-panel-title {\n    font-size: 12px;\n    font-weight: 600;\n    color: rgba(255, 255, 255, 0.8);\n    letter-spacing: 0.1px;\n}\n\n.lumia-modal-panel-count {\n    font-size: 11px;\n    font-weight: 500;\n    color: rgba(147, 112, 219, 0.7);\n    background: rgba(147, 112, 219, 0.1);\n    padding: 4px 8px;\n    border-radius: 10px;\n    flex-shrink: 0;\n}\n\n.lumia-modal-panel-content {\n    padding: 16px;\n    display: flex;\n    flex-direction: column;\n    gap: 14px;\n}\n\n.lumia-modal-panel-content-cards {\n    padding: 12px;\n}\n\n/* Modal Empty State */\n.lumia-modal-empty {\n    padding: 40px 20px;\n    text-align: center;\n    color: rgba(255, 255, 255, 0.4);\n    font-size: 14px;\n}\n\n/* Modal Footer - Pinned to bottom */\n.lumia-modal-footer {\n    display: flex;\n    justify-content: flex-end;\n    gap: 10px;\n    padding: 16px 20px;\n    background: rgba(22, 18, 32, 0.98);\n    border-top: 1px solid rgba(128, 128, 128, 0.15);\n    flex-shrink: 0;\n    margin-top: auto;\n    position: sticky;\n    bottom: 0;\n    z-index: 10;\n    /* Subtle shadow to indicate floating */\n    box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.3);\n}\n\n/* Modal Buttons */\n.lumia-modal-btn {\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    gap: 8px;\n    padding: 10px 20px;\n    border: none;\n    border-radius: 8px;\n    font-size: 13px;\n    font-weight: 500;\n    font-family: inherit;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumia-modal-btn svg {\n    width: 16px;\n    height: 16px;\n}\n\n.lumia-modal-btn-primary {\n    background: linear-gradient(\n        135deg,\n        rgba(147, 112, 219, 0.9) 0%,\n        rgba(123, 95, 196, 0.9) 100%\n    );\n    color: white;\n}\n\n.lumia-modal-btn-primary:hover {\n    background: linear-gradient(\n        135deg,\n        rgba(167, 132, 239, 0.95) 0%,\n        rgba(143, 115, 216, 0.95) 100%\n    );\n    transform: translateY(-1px);\n}\n\n.lumia-modal-btn-secondary {\n    background: rgba(128, 128, 128, 0.15);\n    border: 1px solid rgba(128, 128, 128, 0.2);\n    color: rgba(255, 255, 255, 0.75);\n}\n\n.lumia-modal-btn-secondary:hover {\n    background: rgba(128, 128, 128, 0.25);\n    color: rgba(255, 255, 255, 0.9);\n}\n\n/* Collapsible Panel Styles */\n.lumia-collapsible-trigger {\n    cursor: pointer;\n    user-select: none;\n}\n\n.lumia-panel-collapse-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 16px;\n    height: 16px;\n    flex-shrink: 0;\n    transition: transform 0.2s ease;\n}\n\n.lumia-panel-collapse-icon svg {\n    width: 14px;\n    height: 14px;\n    stroke: rgba(255, 255, 255, 0.4);\n}\n\n.lumia-collapsible.collapsed .lumia-panel-collapse-icon {\n    transform: rotate(-90deg);\n}\n\n.lumia-collapsible-content {\n    display: grid;\n    grid-template-rows: 1fr;\n    transition:\n        grid-template-rows 0.25s ease,\n        opacity 0.2s ease,\n        padding 0.25s ease;\n    opacity: 1;\n}\n\n.lumia-collapsible-content > * {\n    overflow: hidden;\n}\n\n.lumia-collapsible.collapsed .lumia-collapsible-content {\n    grid-template-rows: 0fr;\n    opacity: 0;\n    padding-top: 0;\n    padding-bottom: 0;\n}\n\n/* Custom Pack Badge */\n.lumia-pack-badge-custom {\n    font-size: 10px;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    color: rgba(147, 112, 219, 0.9);\n    background: rgba(147, 112, 219, 0.15);\n    padding: 3px 8px;\n    border-radius: 6px;\n    border: 1px solid rgba(147, 112, 219, 0.25);\n}\n\n/* Icon Button Small */\n.lumia-icon-btn-sm {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 28px;\n    height: 28px;\n    padding: 0;\n    background: transparent;\n    border: 1px solid transparent;\n    border-radius: 6px;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    margin-left: auto;\n}\n\n.lumia-icon-btn-sm svg {\n    width: 16px;\n    height: 16px;\n    stroke: rgba(255, 255, 255, 0.4);\n}\n\n.lumia-icon-btn-sm:hover {\n    background: rgba(244, 67, 54, 0.15);\n    border-color: rgba(244, 67, 54, 0.3);\n}\n\n.lumia-icon-btn-sm:hover svg {\n    stroke: rgba(244, 67, 54, 0.9);\n}\n\n/* ============================================\n   LUMIA CARD GRID & CARDS\n   ============================================ */\n\n.lumia-card-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));\n    gap: 16px;\n    padding: 4px;\n}\n\n.lumia-card {\n    position: relative;\n    display: flex;\n    flex-direction: column;\n    background: linear-gradient(\n        165deg,\n        rgba(28, 24, 38, 0.95) 0%,\n        rgba(38, 32, 52, 0.9) 50%,\n        rgba(32, 28, 45, 0.95) 100%\n    );\n    border: 1px solid rgba(128, 128, 128, 0.15);\n    border-radius: 16px;\n    overflow: hidden;\n    cursor: pointer;\n    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);\n}\n\n.lumia-card:hover {\n    transform: translateY(-4px);\n    border-color: rgba(147, 112, 219, 0.3);\n    box-shadow:\n        0 8px 24px rgba(0, 0, 0, 0.25),\n        0 0 0 1px rgba(147, 112, 219, 0.15);\n}\n\n.lumia-card.selected {\n    border-color: rgba(100, 149, 237, 0.6);\n    box-shadow:\n        0 4px 16px rgba(100, 149, 237, 0.2),\n        0 0 0 1px rgba(100, 149, 237, 0.3),\n        inset 0 0 20px rgba(100, 149, 237, 0.05);\n}\n\n.lumia-card.selected::after {\n    content: "";\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    height: 2px;\n    background: linear-gradient(\n        90deg,\n        transparent 0%,\n        rgba(100, 149, 237, 0.5) 20%,\n        rgba(100, 149, 237, 0.8) 50%,\n        rgba(100, 149, 237, 0.5) 80%,\n        transparent 100%\n    );\n}\n\n/* Card Image Container */\n.lumia-card-image {\n    position: relative;\n    width: 100%;\n    aspect-ratio: 1 / 1;\n    background: linear-gradient(\n        135deg,\n        rgba(20, 16, 28, 0.8) 0%,\n        rgba(40, 32, 55, 0.6) 100%\n    );\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    overflow: hidden;\n}\n\n.lumia-card-image img {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n    transition: transform 0.3s ease, opacity 0.3s ease;\n    opacity: 0;\n}\n\n.lumia-card-image img.lumia-img-loaded {\n    opacity: 1;\n}\n\n.lumia-card:hover .lumia-card-image img {\n    transform: scale(1.05);\n}\n\n.lumia-card-placeholder {\n    font-size: 48px;\n    font-weight: 300;\n    color: rgba(147, 112, 219, 0.4);\n    font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", sans-serif;\n    user-select: none;\n}\n\n/* Image Loading Spinner */\n.lumia-img-spinner {\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    width: 24px;\n    height: 24px;\n    border: 2px solid rgba(147, 112, 219, 0.2);\n    border-top-color: rgba(147, 112, 219, 0.7);\n    border-radius: 50%;\n    animation: lumia-spin 0.8s linear infinite;\n}\n\n@keyframes lumia-spin {\n    to { transform: translate(-50%, -50%) rotate(360deg); }\n}\n\n.lumia-card-image:has(.lumia-img-loaded) .lumia-img-spinner {\n    display: none;\n}\n\n/* Dominant Star Icon */\n.lumia-dominant-icon {\n    position: absolute;\n    top: 10px;\n    right: 10px;\n    width: 32px;\n    height: 32px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    background: rgba(0, 0, 0, 0.5);\n    backdrop-filter: blur(8px);\n    -webkit-backdrop-filter: blur(8px);\n    border-radius: 50%;\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    cursor: pointer;\n    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);\n    z-index: 10;\n    opacity: 0;\n}\n\n.lumia-card:hover .lumia-dominant-icon,\n.lumia-card.selected .lumia-dominant-icon {\n    opacity: 1;\n}\n\n.lumia-dominant-icon:hover {\n    background: rgba(0, 0, 0, 0.7);\n    border-color: rgba(255, 193, 7, 0.4);\n    transform: scale(1.1);\n}\n\n.lumia-dominant-icon.dominant {\n    opacity: 1;\n    background: linear-gradient(\n        135deg,\n        rgba(255, 193, 7, 0.9) 0%,\n        rgba(255, 152, 0, 0.9) 100%\n    );\n    border-color: rgba(255, 193, 7, 0.6);\n    box-shadow: 0 2px 12px rgba(255, 193, 7, 0.4);\n}\n\n.lumia-dominant-icon svg {\n    width: 18px;\n    height: 18px;\n    fill: none;\n    stroke: rgba(255, 255, 255, 0.7);\n    stroke-width: 2;\n    stroke-linecap: round;\n    stroke-linejoin: round;\n    transition: all 0.25s ease;\n}\n\n.lumia-dominant-icon:hover svg {\n    stroke: rgba(255, 193, 7, 0.9);\n}\n\n.lumia-dominant-icon.dominant svg {\n    fill: rgba(255, 255, 255, 0.95);\n    stroke: rgba(255, 255, 255, 0.95);\n}\n\n/* Edit Icon for custom pack items */\n.lumia-edit-icon {\n    position: absolute;\n    bottom: 10px;\n    right: 10px;\n    width: 28px;\n    height: 28px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    background: rgba(147, 112, 219, 0.85);\n    backdrop-filter: blur(8px);\n    -webkit-backdrop-filter: blur(8px);\n    border-radius: 50%;\n    border: 1px solid rgba(147, 112, 219, 0.4);\n    cursor: pointer;\n    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);\n    z-index: 10;\n    opacity: 0;\n}\n\n.lumia-card:hover .lumia-edit-icon {\n    opacity: 1;\n}\n\n.lumia-edit-icon:hover {\n    background: rgba(147, 112, 219, 1);\n    border-color: rgba(186, 135, 255, 0.6);\n    transform: scale(1.1);\n    box-shadow: 0 2px 12px rgba(147, 112, 219, 0.4);\n}\n\n.lumia-edit-icon svg {\n    width: 14px;\n    height: 14px;\n    fill: none;\n    stroke: rgba(255, 255, 255, 0.95);\n    stroke-width: 2;\n    stroke-linecap: round;\n    stroke-linejoin: round;\n}\n\n/* Enable All Icon - sparkles button for quick-enabling all traits */\n.lumia-enable-all-icon {\n    position: absolute;\n    bottom: 10px;\n    left: 10px;\n    width: 28px;\n    height: 28px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    background: rgba(255, 193, 7, 0.85);\n    backdrop-filter: blur(8px);\n    -webkit-backdrop-filter: blur(8px);\n    border-radius: 50%;\n    border: 1px solid rgba(255, 193, 7, 0.4);\n    cursor: pointer;\n    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);\n    z-index: 10;\n    opacity: 0;\n}\n\n.lumia-card:hover .lumia-enable-all-icon {\n    opacity: 1;\n}\n\n.lumia-enable-all-icon:hover {\n    background: rgba(255, 193, 7, 1);\n    border-color: rgba(255, 215, 0, 0.8);\n    transform: scale(1.1);\n    box-shadow: 0 2px 12px rgba(255, 193, 7, 0.5);\n}\n\n.lumia-enable-all-icon svg {\n    width: 14px;\n    height: 14px;\n    fill: none;\n    stroke: rgba(0, 0, 0, 0.85);\n    stroke-width: 2;\n    stroke-linecap: round;\n    stroke-linejoin: round;\n}\n\n/* All-enabled state - shows when all traits are active */\n.lumia-enable-all-icon.all-enabled {\n    opacity: 1;\n    background: rgba(76, 175, 80, 0.95);\n    border-color: rgba(76, 175, 80, 0.6);\n    box-shadow: 0 2px 8px rgba(76, 175, 80, 0.4);\n}\n\n.lumia-enable-all-icon.all-enabled:hover {\n    background: rgba(56, 142, 60, 1);\n    border-color: rgba(76, 175, 80, 0.8);\n    box-shadow: 0 2px 12px rgba(76, 175, 80, 0.6);\n}\n\n.lumia-enable-all-icon.all-enabled svg {\n    stroke: rgba(255, 255, 255, 0.95);\n}\n\n/* Selection Checkmark Overlay */\n.lumia-card-check {\n    position: absolute;\n    top: 10px;\n    left: 10px;\n    width: 28px;\n    height: 28px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    background: rgba(100, 149, 237, 0.9);\n    border-radius: 50%;\n    opacity: 0;\n    transform: scale(0.5);\n    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);\n    z-index: 10;\n}\n\n.lumia-card.selected .lumia-card-check {\n    opacity: 1;\n    transform: scale(1);\n}\n\n.lumia-card-check svg {\n    width: 16px;\n    height: 16px;\n    fill: none;\n    stroke: white;\n    stroke-width: 2.5;\n    stroke-linecap: round;\n    stroke-linejoin: round;\n}\n\n/* Card Info Section */\n.lumia-card-info {\n    padding: 14px 16px 16px;\n    display: flex;\n    flex-direction: column;\n    gap: 4px;\n    background: linear-gradient(\n        180deg,\n        rgba(28, 24, 38, 0) 0%,\n        rgba(28, 24, 38, 0.95) 20%\n    );\n}\n\n.lumia-card-name {\n    font-size: 15px;\n    font-weight: 600;\n    color: rgba(255, 255, 255, 0.95);\n    font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", sans-serif;\n    letter-spacing: -0.2px;\n    line-height: 1.3;\n    word-break: break-word;\n}\n\n/* Definition Card Variant (no dominant icon) */\n.lumia-card.definition-card .lumia-dominant-icon {\n    display: none;\n}\n\n/* Card Appear Animation */\n.lumia-card.lumia-card-appear {\n    animation: lumia-card-appear 0.3s ease-out forwards;\n    opacity: 0;\n}\n\n@keyframes lumia-card-appear {\n    from {\n        opacity: 0;\n        transform: translateY(10px);\n    }\n    to {\n        opacity: 1;\n        transform: translateY(0);\n    }\n}\n\n/* Staggered animation delays */\n.lumia-card.lumia-card-appear:nth-child(1) { animation-delay: 0ms; }\n.lumia-card.lumia-card-appear:nth-child(2) { animation-delay: 30ms; }\n.lumia-card.lumia-card-appear:nth-child(3) { animation-delay: 60ms; }\n.lumia-card.lumia-card-appear:nth-child(4) { animation-delay: 90ms; }\n.lumia-card.lumia-card-appear:nth-child(5) { animation-delay: 120ms; }\n.lumia-card.lumia-card-appear:nth-child(6) { animation-delay: 150ms; }\n.lumia-card.lumia-card-appear:nth-child(7) { animation-delay: 180ms; }\n.lumia-card.lumia-card-appear:nth-child(8) { animation-delay: 210ms; }\n.lumia-card.lumia-card-appear:nth-child(9) { animation-delay: 240ms; }\n.lumia-card.lumia-card-appear:nth-child(10) { animation-delay: 270ms; }\n.lumia-card.lumia-card-appear:nth-child(n+11) { animation-delay: 300ms; }\n\n/* ============================================\n   MODAL PORTAL - Renders at document.body level\n   ============================================ */\n\n.lumia-modal-backdrop {\n    position: fixed;\n    inset: 0;\n    z-index: 10000;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    padding: 16px;\n    box-sizing: border-box;\n}\n\n/* ============================================\n   LUMIA MODAL RESPONSIVE\n   ============================================ */\n\n@media (max-width: 600px) {\n    /* Adjusted modal style - centered, not full-screen */\n    .lumia-modal {\n        width: 94vw;\n        max-width: 400px;\n        max-height: 90vh;\n        max-height: 90dvh;\n        border-radius: 16px;\n        margin: auto;\n    }\n\n    .lumia-modal-selection {\n        max-width: 94vw;\n    }\n\n    /* Ensure backdrop properly centers the modal */\n    .lumia-modal-backdrop {\n        padding: 16px;\n    }\n\n    /* Modal content scrolling for mobile */\n    .lumia-modal-content {\n        overflow-y: auto;\n        -webkit-overflow-scrolling: touch;\n    }\n\n    .lumia-modal-header-inner {\n        padding: 14px 16px;\n        gap: 10px;\n    }\n\n    .lumia-modal-header-icon {\n        width: 32px;\n        height: 32px;\n    }\n\n    .lumia-modal-title {\n        font-size: 15px;\n    }\n\n    .lumia-modal-content {\n        padding: 12px;\n    }\n\n    .lumia-modal-content > * + * {\n        margin-top: 12px;\n    }\n\n    .lumia-modal-panel-content {\n        padding: 10px;\n    }\n\n    .lumia-modal-footer {\n        padding: 12px 16px;\n    }\n\n    .lumia-modal-btn {\n        padding: 10px 16px;\n        font-size: 13px;\n    }\n\n    .lumia-card-grid {\n        grid-template-columns: repeat(2, 1fr);\n        gap: 12px;\n    }\n\n    .lumia-card {\n        border-radius: 12px;\n    }\n\n    .lumia-card-info {\n        padding: 10px 12px 12px;\n    }\n\n    .lumia-card-name {\n        font-size: 13px;\n    }\n\n    .lumia-card-check {\n        width: 24px;\n        height: 24px;\n    }\n\n    .lumia-card-check svg {\n        width: 14px;\n        height: 14px;\n    }\n\n    .lumia-card-placeholder {\n        font-size: 36px;\n    }\n\n    /* ----------------------------------------\n       Legacy Lumia Editor Modal - Mobile\n       This is the jQuery <dialog> based editor\n       ---------------------------------------- */\n    .lumia-modal-editor {\n        width: calc(100vw - 24px) !important;\n        max-width: calc(100vw - 24px) !important;\n        height: calc(100vh - 24px);\n        max-height: calc(100vh - 24px);\n        display: flex;\n        flex-direction: column;\n        overflow: hidden;\n        min-height: 0;\n    }\n\n    @supports (height: 100dvh) {\n        .lumia-modal-editor {\n            height: calc(100dvh - 24px);\n            max-height: calc(100dvh - 24px);\n        }\n    }\n\n    /* Editor content must scroll */\n    .lumia-modal-editor .lumia-modal-content {\n        flex: 1;\n        min-height: 0;\n        overflow-y: auto;\n        overflow-x: hidden;\n        -webkit-overflow-scrolling: touch;\n        padding: 12px;\n    }\n\n    /* Editor form fills content */\n    .lumia-modal-editor .lumia-editor-form {\n        display: flex;\n        flex-direction: column;\n        gap: 12px;\n    }\n\n    /* Editor sections */\n    .lumia-modal-editor .lumia-editor-section {\n        background: rgba(0, 0, 0, 0.2);\n        border: 1px solid rgba(128, 128, 128, 0.12);\n        border-radius: 12px;\n        overflow: hidden;\n    }\n\n    .lumia-modal-editor .lumia-editor-section-header {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        padding: 10px 12px;\n        background: rgba(255, 255, 255, 0.02);\n        border-bottom: 1px solid rgba(128, 128, 128, 0.08);\n        font-size: 12px;\n        font-weight: 600;\n    }\n\n    .lumia-modal-editor .lumia-editor-section-icon {\n        display: flex;\n        align-items: center;\n        width: 16px;\n        height: 16px;\n    }\n\n    .lumia-modal-editor .lumia-editor-section-icon svg {\n        width: 16px;\n        height: 16px;\n        stroke: rgba(147, 112, 219, 0.7);\n    }\n\n    .lumia-modal-editor .lumia-editor-section-content {\n        padding: 12px;\n    }\n\n    /* Form fields */\n    .lumia-modal-editor .lumia-editor-field {\n        margin-bottom: 12px;\n    }\n\n    .lumia-modal-editor .lumia-editor-field:last-child {\n        margin-bottom: 0;\n    }\n\n    .lumia-modal-editor .lumia-editor-label {\n        display: block;\n        font-size: 11px;\n        font-weight: 600;\n        text-transform: uppercase;\n        letter-spacing: 0.3px;\n        color: rgba(255, 255, 255, 0.6);\n        margin-bottom: 6px;\n    }\n\n    /* Stack row fields vertically on mobile */\n    .lumia-modal-editor .lumia-editor-row {\n        display: flex;\n        flex-direction: column;\n        gap: 12px;\n    }\n\n    .lumia-modal-editor .lumia-editor-field-half {\n        width: 100%;\n    }\n\n    /* Inputs - 16px font prevents iOS zoom */\n    .lumia-modal-editor .lumia-input,\n    .lumia-modal-editor .lumia-select {\n        width: 100%;\n        min-height: 44px;\n        padding: 10px 12px;\n        font-size: 16px;\n        background: rgba(0, 0, 0, 0.3);\n        border: 1px solid rgba(128, 128, 128, 0.2);\n        border-radius: 8px;\n        color: rgba(255, 255, 255, 0.9);\n    }\n\n    .lumia-modal-editor .lumia-textarea {\n        width: 100%;\n        min-height: 100px;\n        padding: 12px;\n        font-size: 16px;\n        line-height: 1.5;\n        background: rgba(0, 0, 0, 0.3);\n        border: 1px solid rgba(128, 128, 128, 0.2);\n        border-radius: 8px;\n        color: rgba(255, 255, 255, 0.9);\n        resize: vertical;\n    }\n\n    .lumia-modal-editor .lumia-editor-hint {\n        display: block;\n        font-size: 10px;\n        color: rgba(255, 255, 255, 0.4);\n        margin-top: 4px;\n        font-style: italic;\n    }\n\n    /* Avatar preview */\n    .lumia-modal-editor .lumia-editor-preview {\n        width: 60px;\n        height: 60px;\n        border-radius: 8px;\n        overflow: hidden;\n        margin-top: 8px;\n    }\n\n    .lumia-modal-editor .lumia-editor-preview img {\n        width: 100%;\n        height: 100%;\n        object-fit: cover;\n    }\n\n    /* Footer stays at bottom */\n    .lumia-modal-editor .lumia-modal-footer {\n        flex-shrink: 0;\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n        padding: 12px;\n        border-top: 1px solid rgba(128, 128, 128, 0.12);\n        background: rgba(0, 0, 0, 0.2);\n    }\n\n    .lumia-modal-editor .lumia-modal-footer .lumia-modal-btn {\n        flex: 1;\n        min-height: 44px;\n        padding: 10px 16px;\n        font-size: 14px;\n        font-weight: 500;\n    }\n\n    /* Delete button full width on bottom */\n    .lumia-modal-editor .lumia-modal-footer .lumia-modal-btn-danger {\n        flex: 0 0 100%;\n        order: 10;\n        margin-top: 4px;\n    }\n\n    /* Disable animations on mobile for performance */\n    .lumia-card,\n    .lumia-card-image img,\n    .lumia-dominant-icon,\n    .lumia-card-check {\n        transition: none !important;\n    }\n\n    .lumia-card:hover {\n        transform: none;\n    }\n\n    .lumia-card:hover .lumia-card-image img {\n        transform: none;\n    }\n\n    /* Viewport Panel Mobile */\n    .lumiverse-viewport-wrapper {\n        width: 100vw !important;\n    }\n\n    .lumiverse-viewport-panel {\n        width: 100%;\n    }\n\n    .lumiverse-vp-tabs {\n        width: 48px;\n    }\n\n    .lumiverse-vp-tab {\n        width: 44px;\n        height: 44px;\n    }\n\n    .lumiverse-vp-tab-label {\n        font-size: 9px;\n    }\n\n    /* Toggle button - shift down to avoid SillyTavern's top bar */\n    /* Only apply to default positioning, not custom */\n    .lumiverse-toggle-container:not(.lumiverse-toggle-container--custom) {\n        top: 44px !important;\n    }\n\n    /* Summary textarea - ensure proper height on mobile */\n    .lumiverse-vp-summary-editor {\n        min-height: 0;\n    }\n\n    .lumiverse-vp-summary-textarea-wrapper {\n        flex: 1;\n        min-height: 180px;\n        display: flex;\n        flex-direction: column;\n    }\n\n    .lumiverse-vp-summary-textarea {\n        flex: 1;\n        min-height: 180px;\n    }\n}\n\n/* ============================================\n   MODAL CONTROLS - Collapse/Expand & Sort\n   Shared styling for Lumia Selection modals\n   ============================================ */\n\n.lumia-modal-controls {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    gap: 12px;\n    padding: 12px 16px;\n    background: rgba(0, 0, 0, 0.2);\n    border-bottom: 1px solid rgba(128, 128, 128, 0.12);\n    margin: 0 -16px 16px -16px;\n    width: calc(100% + 32px);\n}\n\n.lumia-modal-controls-group {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n}\n\n.lumia-modal-control-btn {\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    gap: 6px;\n    padding: 8px 12px;\n    font-size: 12px;\n    font-weight: 500;\n    color: rgba(255, 255, 255, 0.7);\n    background: rgba(0, 0, 0, 0.25);\n    border: 1px solid rgba(128, 128, 128, 0.15);\n    border-radius: 8px;\n    cursor: pointer;\n    transition: all 0.15s ease;\n    white-space: nowrap;\n}\n\n.lumia-modal-control-btn svg {\n    width: 14px;\n    height: 14px;\n    stroke: currentColor;\n    flex-shrink: 0;\n    display: block;\n}\n\n.lumia-modal-control-btn:hover {\n    color: rgba(255, 255, 255, 0.95);\n    background: rgba(0, 0, 0, 0.35);\n    border-color: rgba(147, 112, 219, 0.5);\n}\n\n.lumia-modal-control-btn:active {\n    transform: scale(0.97);\n}\n\n/* Control icons */\n.lumia-control-icon {\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    width: 16px;\n    height: 16px;\n    flex-shrink: 0;\n}\n\n.lumia-control-icon svg {\n    width: 16px;\n    height: 16px;\n    stroke: currentColor;\n    display: block;\n}\n\n/* Sort icon */\n.lumia-sort-icon {\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    width: 16px;\n    height: 16px;\n    flex-shrink: 0;\n    color: rgba(255, 255, 255, 0.6);\n}\n\n.lumia-sort-icon svg {\n    width: 16px;\n    height: 16px;\n    stroke: currentColor;\n    display: block;\n}\n\n/* Sort Dropdown */\n.lumia-modal-sort {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    padding: 6px 12px;\n    background: rgba(0, 0, 0, 0.25);\n    border: 1px solid rgba(128, 128, 128, 0.15);\n    border-radius: 8px;\n}\n\n/* Direct SVG targeting for sort dropdown - mirrors .lumia-modal-control-btn svg pattern */\n.lumia-modal-sort svg {\n    width: 14px;\n    height: 14px;\n    stroke: currentColor;\n    flex-shrink: 0;\n    display: block;\n}\n\n.lumia-modal-sort-label {\n    font-size: 12px;\n    font-weight: 500;\n    color: rgba(255, 255, 255, 0.5);\n}\n\n.lumia-select {\n    padding: 4px 8px;\n    font-size: 12px;\n    font-weight: 500;\n    color: rgba(255, 255, 255, 0.9);\n    background: rgba(0, 0, 0, 0.3);\n    border: 1px solid rgba(128, 128, 128, 0.2);\n    border-radius: 6px;\n    cursor: pointer;\n    transition: all 0.15s ease;\n    min-width: 100px;\n}\n\n.lumia-select:hover {\n    border-color: rgba(147, 112, 219, 0.4);\n}\n\n.lumia-select:focus {\n    outline: none;\n    border-color: rgba(147, 112, 219, 0.6);\n    box-shadow: 0 0 0 2px rgba(147, 112, 219, 0.15);\n}\n\n.lumia-select option {\n    background: #1a1a1a;\n    color: #fff;\n}\n\n/* Mobile adjustments for controls */\n@media (max-width: 600px) {\n    .lumia-modal-controls {\n        flex-wrap: wrap;\n        gap: 8px;\n        padding: 10px 12px;\n        margin: 0 -12px 12px -12px;\n        width: calc(100% + 24px);\n    }\n\n    .lumia-modal-control-btn {\n        padding: 6px 10px;\n        font-size: 11px;\n    }\n\n    /* Hide text labels on mobile, but keep icon spans visible */\n    .lumia-modal-control-btn > span:not(.lumia-btn-icon):not(.lumia-control-icon):not([class*="icon"]) {\n        display: none;\n    }\n\n    .lumia-modal-sort {\n        flex: 1;\n        min-width: 100%;\n        justify-content: space-between;\n    }\n\n    .lumia-select {\n        flex: 1;\n        min-width: 0;\n        padding: 5px 8px;\n        font-size: 11px;\n    }\n}\n\n/* ============================================\n   LOOM ITEMS - Styling for Loom Selection Modal\n   ============================================ */\n\n/* Loom items container within pack section */\n.lumia-loom-items {\n    display: flex;\n    flex-direction: column;\n    gap: 6px;\n    padding: 12px;\n    background: rgba(0, 0, 0, 0.15);\n}\n\n/* Individual Loom item */\n.lumiverse-loom-item {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 12px 16px;\n    background: rgba(0, 0, 0, 0.2);\n    border: 1px solid rgba(128, 128, 128, 0.12);\n    border-radius: 8px;\n    cursor: pointer;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-loom-item:hover {\n    background: rgba(0, 0, 0, 0.3);\n    border-color: rgba(147, 112, 219, 0.3);\n}\n\n.lumiverse-loom-item--selected {\n    background: rgba(147, 112, 219, 0.15);\n    border-color: rgba(147, 112, 219, 0.5);\n}\n\n.lumiverse-loom-item-content {\n    flex: 1;\n}\n\n.lumiverse-loom-item-name {\n    font-weight: 500;\n    color: rgba(255, 255, 255, 0.9);\n    font-size: 14px;\n}\n\n.lumiverse-loom-item-actions {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    margin-left: auto;\n}\n\n.lumiverse-loom-item-toggle {\n    margin-left: 0;\n}\n\n.lumiverse-loom-item-edit {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 24px;\n    height: 24px;\n    padding: 0;\n    background: rgba(128, 128, 128, 0.15);\n    border: 1px solid rgba(128, 128, 128, 0.15);\n    border-radius: var(--lumiverse-radius-sm, 4px);\n    color: rgba(255, 255, 255, 0.5);\n    cursor: pointer;\n    transition: all 0.15s ease;\n    flex-shrink: 0;\n}\n\n.lumiverse-loom-item-edit:hover {\n    background: rgba(100, 149, 237, 0.25);\n    border-color: rgba(100, 149, 237, 0.3);\n    color: rgba(130, 179, 255, 0.95);\n}\n\n/* Toggle switch styling */\n.lumiverse-toggle-switch {\n    position: relative;\n    width: 40px;\n    height: 22px;\n}\n\n.lumiverse-toggle-track {\n    width: 100%;\n    height: 100%;\n    background: rgba(0, 0, 0, 0.3);\n    border: 2px solid rgba(128, 128, 128, 0.2);\n    border-radius: 11px;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-toggle-switch.checked .lumiverse-toggle-track {\n    background: rgba(147, 112, 219, 0.8);\n    border-color: rgba(147, 112, 219, 0.8);\n}\n\n.lumiverse-toggle-thumb {\n    position: absolute;\n    top: 3px;\n    left: 3px;\n    width: 16px;\n    height: 16px;\n    background: white;\n    border-radius: 50%;\n    transition: transform 0.15s ease;\n}\n\n.lumiverse-toggle-switch.checked .lumiverse-toggle-thumb {\n    transform: translateX(18px);\n}\n\n/* Selection actions */\n.lumia-selection-actions {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n    margin-left: auto;\n}\n\n.lumia-selection-count {\n    font-size: 13px;\n    color: rgba(255, 255, 255, 0.5);\n}\n\n/* Search box styling matching Lumia modal */\n.lumia-search-box {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    padding: 8px 12px;\n    background: rgba(0, 0, 0, 0.2);\n    border: 1px solid rgba(128, 128, 128, 0.12);\n    border-radius: 8px;\n    flex: 1;\n    max-width: 300px;\n}\n\n.lumia-search-icon,\n.lumia-search-icon svg {\n    width: 16px;\n    height: 16px;\n    color: rgba(255, 255, 255, 0.4);\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n}\n\n.lumia-search-input {\n    flex: 1;\n    background: transparent;\n    border: none;\n    outline: none;\n    color: rgba(255, 255, 255, 0.9);\n    font-size: 13px;\n}\n\n.lumia-search-input::placeholder {\n    color: rgba(255, 255, 255, 0.4);\n}\n\n.lumia-search-clear {\n    background: transparent;\n    border: none;\n    padding: 4px;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: rgba(255, 255, 255, 0.4);\n    transition: color 0.15s ease;\n}\n\n.lumia-search-clear:hover {\n    color: rgba(255, 255, 255, 0.8);\n}\n\n.lumia-search-clear-icon,\n.lumia-search-clear-icon svg {\n    width: 14px;\n    height: 14px;\n}\n\n/* ----------------------------------------\n   Lumia Modes Section (Chimera/Council)\n   ---------------------------------------- */\n.lumiverse-vp-mode-option {\n    margin-bottom: 8px;\n}\n\n.lumiverse-vp-mode-option:last-child {\n    margin-bottom: 0;\n}\n\n.lumiverse-vp-mode-details {\n    margin-top: 8px;\n    padding-left: 12px;\n    border-left: 2px solid rgba(147, 112, 219, 0.3);\n}\n\n.lumiverse-vp-mode-note {\n    margin: 8px 0 0;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n    font-style: italic;\n}\n\n/* ----------------------------------------\n   Council Manager Component\n   ---------------------------------------- */\n.lumiverse-council-manager {\n    padding: 12px;\n    display: flex;\n    flex-direction: column;\n    gap: 12px;\n}\n\n.lumiverse-council-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    gap: 12px;\n}\n\n.lumiverse-council-title {\n    margin: 0;\n    font-size: 14px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    display: flex;\n    align-items: center;\n    gap: 8px;\n}\n\n.lumiverse-council-title svg {\n    color: var(--lumiverse-primary);\n}\n\n.lumiverse-council-mode-toggle {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    cursor: pointer;\n}\n\n.lumiverse-council-mode-toggle input {\n    display: none;\n}\n\n.lumiverse-council-mode-switch {\n    width: 40px;\n    height: 22px;\n    background: rgba(100, 100, 130, 0.3);\n    border-radius: 11px;\n    position: relative;\n    transition: background 0.2s ease;\n}\n\n.lumiverse-council-mode-switch--on {\n    background: var(--lumiverse-primary);\n}\n\n.lumiverse-council-mode-thumb {\n    position: absolute;\n    top: 2px;\n    left: 2px;\n    width: 18px;\n    height: 18px;\n    background: white;\n    border-radius: 50%;\n    transition: transform 0.2s ease;\n}\n\n.lumiverse-council-mode-switch--on .lumiverse-council-mode-thumb {\n    transform: translateX(18px);\n}\n\n.lumiverse-council-mode-label {\n    font-size: 11px;\n    font-weight: 500;\n    color: var(--lumiverse-text-muted);\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n.lumiverse-council-desc {\n    margin: 0;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n    line-height: 1.5;\n}\n\n/* Add member section */\n.lumiverse-council-add-section {\n    margin-top: 4px;\n}\n\n.lumiverse-council-add-btn {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 8px;\n    width: 100%;\n    padding: 10px 16px;\n    min-height: 44px; /* Mobile touch target minimum */\n    background: rgba(147, 112, 219, 0.1);\n    border: 1px dashed rgba(147, 112, 219, 0.3);\n    border-radius: 8px;\n    color: var(--lumiverse-primary);\n    font-size: 13px;\n    font-weight: 500;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    touch-action: manipulation;\n    -webkit-tap-highlight-color: rgba(147, 112, 219, 0.3);\n    /* Android WebView button reset */\n    -webkit-appearance: none;\n    appearance: none;\n}\n\n.lumiverse-council-add-btn:hover:not(:disabled) {\n    background: rgba(147, 112, 219, 0.15);\n    border-color: rgba(147, 112, 219, 0.5);\n}\n\n.lumiverse-council-add-btn:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n}\n\n/* Button container for dual buttons */\n.lumiverse-council-add-buttons {\n    display: flex;\n    gap: 8px;\n}\n\n.lumiverse-council-add-buttons .lumiverse-council-add-btn {\n    flex: 1;\n    min-width: 0;\n}\n\n/* Secondary button variant */\n.lumiverse-council-add-btn--secondary {\n    background: rgba(100, 180, 255, 0.1);\n    border-color: rgba(100, 180, 255, 0.3);\n    color: #64b4ff;\n}\n\n.lumiverse-council-add-btn--secondary:hover:not(:disabled) {\n    background: rgba(100, 180, 255, 0.15);\n    border-color: rgba(100, 180, 255, 0.5);\n}\n\n/* Pack icon in quick add dropdown */\n.lumiverse-council-pack-icon {\n    background: rgba(100, 180, 255, 0.1);\n}\n\n/* Add dropdown */\n.lumiverse-council-add-dropdown {\n    background: rgba(30, 30, 46, 0.95);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 10px;\n    overflow: hidden;\n    overscroll-behavior: contain;\n    /* Android touch compatibility */\n    touch-action: pan-y;\n    -webkit-overflow-scrolling: touch;\n}\n\n.lumiverse-council-add-header {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    padding: 10px;\n    border-bottom: 1px solid var(--lumiverse-border);\n}\n\n.lumiverse-council-search {\n    flex: 1;\n    padding: 8px 12px;\n    background: var(--lumiverse-bg);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 6px;\n    color: var(--lumiverse-text);\n    font-size: 13px;\n}\n\n.lumiverse-council-search:focus {\n    outline: none;\n    border-color: var(--lumiverse-primary);\n}\n\n.lumiverse-council-add-list {\n    max-height: 200px;\n    overflow-y: auto;\n    -webkit-overflow-scrolling: touch;\n    overscroll-behavior: contain;\n}\n\n.lumiverse-council-add-empty {\n    padding: 20px;\n    text-align: center;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-council-add-item {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    width: 100%;\n    padding: 10px 12px;\n    background: transparent;\n    border: none;\n    border-bottom: 1px solid rgba(255, 255, 255, 0.05);\n    color: var(--lumiverse-text);\n    cursor: pointer;\n    transition: background 0.2s ease;\n    text-align: left;\n    /* Button reset - CRITICAL for mobile touch */\n    font: inherit;\n    -webkit-appearance: none;\n    appearance: none;\n    /* Mobile touch fixes */\n    touch-action: manipulation;\n    -webkit-tap-highlight-color: rgba(147, 112, 219, 0.2);\n    /* Ensure minimum touch target for Android accessibility */\n    min-height: 48px;\n}\n\n.lumiverse-council-add-item:hover {\n    background: rgba(147, 112, 219, 0.1);\n}\n\n.lumiverse-council-add-item:active {\n    background: rgba(147, 112, 219, 0.2);\n}\n\n.lumiverse-council-add-item:last-child {\n    border-bottom: none;\n}\n\n.lumiverse-council-add-item-avatar {\n    width: 36px;\n    height: 36px;\n    border-radius: 6px;\n    overflow: hidden;\n    background: rgba(147, 112, 219, 0.15);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: var(--lumiverse-primary);\n    flex-shrink: 0;\n    pointer-events: none; /* Allow parent button to capture touch */\n}\n\n.lumiverse-council-add-item-avatar img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n    animation: lumiverseFadeIn 0.2s ease;\n}\n\n.lumiverse-council-add-item-info {\n    flex: 1;\n    min-width: 0;\n    pointer-events: none; /* Allow parent button to capture touch */\n}\n\n.lumiverse-council-add-item-name {\n    display: block;\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-council-add-item-pack {\n    display: block;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n}\n\n/* Members list */\n.lumiverse-council-members {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumiverse-council-empty {\n    padding: 24px;\n    text-align: center;\n    background: rgba(30, 30, 46, 0.4);\n    border-radius: 10px;\n}\n\n.lumiverse-council-empty-icon {\n    display: block;\n    margin-bottom: 12px;\n    color: var(--lumiverse-primary);\n    opacity: 0.5;\n}\n\n.lumiverse-council-empty h4 {\n    margin: 0 0 8px;\n    font-size: 14px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-council-empty p {\n    margin: 0;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n    line-height: 1.5;\n}\n\n/* Member card */\n.lumiverse-council-member {\n    background: rgba(30, 30, 46, 0.6);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 10px;\n    overflow: hidden;\n}\n\n.lumiverse-council-member-header {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 10px 12px;\n    cursor: pointer;\n    transition: background 0.2s ease;\n}\n\n.lumiverse-council-member-header:hover {\n    background: rgba(147, 112, 219, 0.05);\n}\n\n.lumiverse-council-member-avatar {\n    width: 40px;\n    height: 40px;\n    border-radius: 8px;\n    overflow: hidden;\n    background: rgba(147, 112, 219, 0.15);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: var(--lumiverse-primary);\n    flex-shrink: 0;\n}\n\n.lumiverse-council-member-avatar img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n    animation: lumiverseFadeIn 0.2s ease;\n}\n\n.lumiverse-council-member-info {\n    flex: 1;\n    min-width: 0;\n}\n\n.lumiverse-council-member-name {\n    display: block;\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-council-member-role {\n    display: block;\n    font-size: 11px;\n    color: var(--lumiverse-primary);\n    font-weight: 500;\n}\n\n.lumiverse-council-member-stats {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    margin-top: 4px;\n}\n\n.lumiverse-council-stat {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-council-stat svg {\n    opacity: 0.7;\n}\n\n.lumiverse-council-member-actions {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n}\n\n.lumiverse-council-btn {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 28px;\n    height: 28px;\n    min-width: 36px;  /* Mobile touch target */\n    min-height: 36px; /* Mobile touch target */\n    background: rgba(100, 100, 130, 0.2);\n    border: none;\n    border-radius: 6px;\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    transition: all 0.2s ease;\n    touch-action: manipulation;\n    -webkit-tap-highlight-color: rgba(147, 112, 219, 0.3);\n    /* Android WebView button reset */\n    -webkit-appearance: none;\n    appearance: none;\n}\n\n.lumiverse-council-btn:hover {\n    background: rgba(147, 112, 219, 0.2);\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-council-btn--primary {\n    background: var(--lumiverse-primary);\n    color: white;\n}\n\n.lumiverse-council-btn--primary:hover {\n    background: var(--lumiverse-primary-light);\n}\n\n.lumiverse-council-btn--danger:hover {\n    background: rgba(239, 68, 68, 0.2);\n    color: var(--lumiverse-danger);\n}\n\n.lumiverse-council-expand {\n    display: flex;\n    transition: transform 0.2s ease;\n}\n\n.lumiverse-council-expand--open {\n    transform: rotate(180deg);\n}\n\n/* Member body (expanded content) */\n.lumiverse-council-member-body {\n    padding: 12px;\n    border-top: 1px solid var(--lumiverse-border);\n    background: rgba(20, 20, 36, 0.4);\n}\n\n.lumiverse-council-role-edit {\n    margin-bottom: 12px;\n}\n\n.lumiverse-council-role-edit label {\n    display: block;\n    font-size: 11px;\n    font-weight: 500;\n    color: var(--lumiverse-text-muted);\n    margin-bottom: 6px;\n}\n\n.lumiverse-council-role-input-row {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    width: 100%;\n}\n\n.lumiverse-council-role-input-row .lumiverse-council-btn {\n    flex: 0 0 auto;\n    width: 32px;\n    height: 32px;\n}\n\n.lumiverse-council-input {\n    flex: 1 1 0;\n    min-width: 0;\n    padding: 8px 12px;\n    background: var(--lumiverse-bg);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 6px;\n    color: var(--lumiverse-text);\n    font-size: 13px;\n}\n\n.lumiverse-council-input:focus {\n    outline: none;\n    border-color: var(--lumiverse-primary);\n}\n\n.lumiverse-council-role-display {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    margin-bottom: 12px;\n    font-size: 12px;\n}\n\n.lumiverse-council-role-label {\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-council-role-value {\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-council-role-value em {\n    color: var(--lumiverse-text-muted);\n    font-style: italic;\n}\n\n/* Traits section */\n.lumiverse-council-traits-section {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumiverse-council-traits-group {\n    display: flex;\n    flex-wrap: wrap;\n    align-items: flex-start;\n    gap: 6px;\n    font-size: 12px;\n}\n\n.lumiverse-council-traits-label {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    color: var(--lumiverse-text-muted);\n    flex-shrink: 0;\n}\n\n.lumiverse-council-traits-list {\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-council-traits-empty {\n    color: var(--lumiverse-text-dim);\n    font-style: italic;\n}\n\n.lumiverse-council-help-text {\n    margin: 12px 0 0;\n    padding: 10px;\n    background: rgba(147, 112, 219, 0.08);\n    border-radius: 6px;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n    line-height: 1.5;\n}\n\n/* Help text at bottom */\n.lumiverse-council-help {\n    padding: 10px;\n    background: rgba(30, 30, 46, 0.4);\n    border-radius: 8px;\n}\n\n.lumiverse-council-help p {\n    margin: 0;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n    line-height: 1.5;\n}\n\n.lumiverse-council-help code {\n    background: rgba(147, 112, 219, 0.15);\n    padding: 2px 5px;\n    border-radius: 3px;\n    font-size: 10px;\n    color: var(--lumiverse-primary);\n}\n\n/* ========================================\n   Council Select Modal\n   Mobile-friendly modal for selecting council members\n   ======================================== */\n\n.lumiverse-council-select-modal {\n    display: flex;\n    flex-direction: column;\n    height: 100%;\n    max-height: 80vh;\n}\n\n/* Header */\n.lumiverse-council-select-header {\n    display: flex;\n    align-items: flex-start;\n    gap: 12px;\n    padding: 16px 20px;\n    border-bottom: 1px solid var(--lumiverse-border);\n}\n\n.lumiverse-council-select-header-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 40px;\n    height: 40px;\n    background: linear-gradient(135deg, var(--lumiverse-primary), var(--lumiverse-primary-light));\n    border-radius: 10px;\n    color: white;\n    flex-shrink: 0;\n}\n\n.lumiverse-council-select-header-text h3 {\n    margin: 0 0 4px;\n    font-size: 16px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-council-select-header-text p {\n    margin: 0;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n    line-height: 1.4;\n}\n\n/* Sections */\n.lumiverse-council-select-section {\n    padding: 16px 20px;\n    border-bottom: 1px solid var(--lumiverse-border);\n    flex-shrink: 0;\n}\n\n/* Council Members section - constrained height with scrolling */\n.lumiverse-council-select-section:not(.lumiverse-council-select-section--available) {\n    max-height: 35vh;\n    display: flex;\n    flex-direction: column;\n}\n\n.lumiverse-council-select-section--available {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    min-height: 200px;\n    overflow: hidden;\n}\n\n.lumiverse-council-select-section-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    gap: 12px;\n    margin-bottom: 12px;\n    font-size: 12px;\n    font-weight: 600;\n    color: var(--lumiverse-text-muted);\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n.lumiverse-council-select-count {\n    padding: 2px 8px;\n    background: var(--lumiverse-primary);\n    border-radius: 10px;\n    font-size: 11px;\n    font-weight: 600;\n    color: white;\n}\n\n/* Search */\n.lumiverse-council-search-wrapper {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    padding: 6px 10px;\n    background: rgba(30, 30, 46, 0.6);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 8px;\n    flex: 1;\n    max-width: 200px;\n}\n\n.lumiverse-council-search-wrapper svg {\n    color: var(--lumiverse-text-muted);\n    flex-shrink: 0;\n}\n\n.lumiverse-council-search-input {\n    flex: 1;\n    min-width: 0;\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text);\n    font-size: 12px;\n}\n\n.lumiverse-council-search-input::placeholder {\n    color: var(--lumiverse-text-dim);\n}\n\n.lumiverse-council-search-input:focus {\n    outline: none;\n}\n\n.lumiverse-council-search-clear {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 18px;\n    height: 18px;\n    background: rgba(100, 100, 130, 0.3);\n    border: none;\n    border-radius: 50%;\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-council-search-clear:hover {\n    background: rgba(239, 68, 68, 0.3);\n    color: var(--lumiverse-danger);\n}\n\n/* Members list (horizontal scrolling on mobile) */\n.lumiverse-council-select-members {\n    min-height: 60px;\n    flex: 1;\n    overflow-y: auto;\n    scrollbar-width: thin;\n    scrollbar-color: rgba(147, 112, 219, 0.3) transparent;\n}\n\n.lumiverse-council-select-members::-webkit-scrollbar {\n    width: 6px;\n}\n\n.lumiverse-council-select-members::-webkit-scrollbar-track {\n    background: transparent;\n}\n\n.lumiverse-council-select-members::-webkit-scrollbar-thumb {\n    background: rgba(147, 112, 219, 0.3);\n    border-radius: 3px;\n}\n\n.lumiverse-council-select-members::-webkit-scrollbar-thumb:hover {\n    background: rgba(147, 112, 219, 0.5);\n}\n\n.lumiverse-council-member-list {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n/* Member card (in modal) */\n.lumiverse-council-member-card {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 10px 12px;\n    background: rgba(30, 30, 46, 0.6);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 10px;\n}\n\n.lumiverse-council-member-card-avatar {\n    width: 36px;\n    height: 36px;\n    border-radius: 8px;\n    overflow: hidden;\n    background: rgba(147, 112, 219, 0.15);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: var(--lumiverse-primary);\n    flex-shrink: 0;\n}\n\n.lumiverse-council-member-card-avatar img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n    animation: lumiverseFadeIn 0.2s ease;\n}\n\n.lumiverse-council-member-card-content {\n    flex: 1;\n    min-width: 0;\n}\n\n.lumiverse-council-member-card-name {\n    display: block;\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-council-member-card-meta {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    margin-top: 2px;\n}\n\n.lumiverse-council-member-card-role {\n    font-size: 11px;\n    color: var(--lumiverse-primary);\n    font-weight: 500;\n    cursor: pointer;\n    /* Android touch compatibility for interactive span */\n    touch-action: manipulation;\n    -webkit-tap-highlight-color: rgba(147, 112, 219, 0.2);\n    padding: 4px 0; /* Increase touch target */\n}\n\n.lumiverse-council-member-card-role:hover {\n    text-decoration: underline;\n}\n\n.lumiverse-council-add-role-btn {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    padding: 4px 8px; /* Increase padding for touch target */\n    margin: -4px -8px; /* Compensate visually */\n    background: none;\n    border: none;\n    font-size: 10px;\n    color: var(--lumiverse-text-dim);\n    cursor: pointer;\n    transition: color 0.2s ease;\n    /* Android touch compatibility */\n    touch-action: manipulation;\n    -webkit-tap-highlight-color: rgba(147, 112, 219, 0.2);\n    -webkit-appearance: none;\n    appearance: none;\n    min-height: 32px; /* Mobile touch target */\n}\n\n.lumiverse-council-add-role-btn:hover {\n    color: var(--lumiverse-primary);\n}\n\n.lumiverse-council-member-card-stats {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n}\n\n.lumiverse-council-member-card-stats span {\n    display: flex;\n    align-items: center;\n    gap: 3px;\n    font-size: 10px;\n    color: var(--lumiverse-text-dim);\n}\n\n/* Small buttons for modal */\n.lumiverse-council-btn-sm {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 24px;\n    height: 24px;\n    /* Ensure minimum touch target on mobile */\n    min-width: 36px;\n    min-height: 36px;\n    background: rgba(100, 100, 130, 0.2);\n    border: none;\n    border-radius: 6px;\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    transition: all 0.2s ease;\n    flex-shrink: 0;\n    /* Android touch compatibility */\n    touch-action: manipulation;\n    -webkit-tap-highlight-color: rgba(147, 112, 219, 0.3);\n}\n\n.lumiverse-council-btn-sm:hover {\n    background: rgba(147, 112, 219, 0.2);\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-council-btn-sm--primary {\n    background: var(--lumiverse-primary);\n    color: white;\n}\n\n.lumiverse-council-btn-sm--primary:hover {\n    background: var(--lumiverse-primary-light);\n}\n\n.lumiverse-council-btn-sm--danger:hover {\n    background: rgba(239, 68, 68, 0.2);\n    color: var(--lumiverse-danger);\n}\n\n/* Role edit in modal */\n.lumiverse-council-member-role-edit {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    margin-top: 4px;\n}\n\n.lumiverse-council-input-sm {\n    flex: 1;\n    min-width: 0;\n    padding: 4px 8px;\n    background: var(--lumiverse-bg);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 4px;\n    color: var(--lumiverse-text);\n    font-size: 11px;\n}\n\n.lumiverse-council-input-sm:focus {\n    outline: none;\n    border-color: var(--lumiverse-primary);\n}\n\n/* Grid wrapper for available Lumias */\n.lumiverse-council-select-grid-wrapper {\n    flex: 1;\n    overflow-y: auto;\n    min-height: 150px;\n}\n\n/* Card grid for available Lumias */\n.lumiverse-council-select-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));\n    gap: 12px;\n    padding: 4px 0;\n}\n\n/* Show more button for pagination */\n.lumiverse-council-show-more {\n    display: block;\n    width: 100%;\n    padding: 12px;\n    margin-top: 12px;\n    background: rgba(147, 112, 219, 0.1);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 8px;\n    color: var(--lumiverse-text-primary);\n    font-size: 13px;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    text-align: center;\n}\n\n.lumiverse-council-show-more:hover {\n    background: rgba(147, 112, 219, 0.2);\n    border-color: var(--lumiverse-primary);\n}\n\n.lumiverse-council-show-more:active {\n    transform: scale(0.99);\n}\n\n/* Selectable card - now a button for iOS touch compatibility */\n.lumiverse-council-select-card {\n    display: flex;\n    flex-direction: column;\n    background: rgba(30, 30, 46, 0.6);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 10px;\n    overflow: hidden;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    /* Button reset */\n    padding: 0;\n    margin: 0;\n    font: inherit;\n    text-align: left;\n    /* Mobile touch fixes - Android compatibility */\n    touch-action: manipulation;\n    -webkit-tap-highlight-color: rgba(147, 112, 219, 0.2);\n    -webkit-appearance: none;\n    appearance: none;\n}\n\n.lumiverse-council-select-card:hover {\n    border-color: var(--lumiverse-primary);\n    transform: translateY(-2px);\n    box-shadow: 0 4px 12px rgba(147, 112, 219, 0.15);\n}\n\n.lumiverse-council-select-card:active {\n    transform: scale(0.98);\n    border-color: var(--lumiverse-primary);\n}\n\n.lumiverse-council-select-card-image {\n    position: relative;\n    aspect-ratio: 1;\n    background: rgba(147, 112, 219, 0.1);\n    pointer-events: none; /* Allow parent button to capture touch */\n}\n\n.lumiverse-council-select-card-image img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n    opacity: 0;\n    transition: opacity 0.2s ease;\n}\n\n.lumiverse-council-select-card-image img.lumia-img-loaded {\n    opacity: 1;\n}\n\n.lumiverse-council-select-card-placeholder {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 100%;\n    height: 100%;\n    color: var(--lumiverse-text-dim);\n}\n\n.lumiverse-council-select-card-add {\n    position: absolute;\n    bottom: 6px;\n    right: 6px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 24px;\n    height: 24px;\n    background: var(--lumiverse-primary);\n    border-radius: 50%;\n    color: white;\n    opacity: 0;\n    transform: scale(0.8);\n    transition: all 0.2s ease;\n}\n\n.lumiverse-council-select-card:hover .lumiverse-council-select-card-add {\n    opacity: 1;\n    transform: scale(1);\n}\n\n.lumiverse-council-select-card-info {\n    padding: 8px;\n    text-align: center;\n    pointer-events: none; /* Allow parent button to capture touch */\n}\n\n.lumiverse-council-select-card-name {\n    display: block;\n    font-size: 11px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-council-select-card-pack {\n    display: block;\n    font-size: 9px;\n    color: var(--lumiverse-text-dim);\n    margin-top: 2px;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n/* Empty states */\n.lumiverse-council-select-empty {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    padding: 24px;\n    text-align: center;\n    color: var(--lumiverse-primary);\n}\n\n.lumiverse-council-select-empty--muted {\n    color: var(--lumiverse-text-dim);\n}\n\n.lumiverse-council-select-empty span {\n    display: block;\n    margin-top: 8px;\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-council-select-empty p {\n    margin: 4px 0 0;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n    line-height: 1.4;\n}\n\n/* Footer */\n.lumiverse-council-select-footer {\n    display: flex;\n    justify-content: flex-end;\n    gap: 10px;\n    padding: 12px 20px;\n    border-top: 1px solid var(--lumiverse-border);\n    background: rgba(20, 20, 36, 0.4);\n}\n\n/* Mobile responsiveness */\n@media (max-width: 480px) {\n    .lumiverse-council-select-modal {\n        max-height: 90vh;\n    }\n\n    .lumiverse-council-select-header {\n        padding: 12px 16px;\n    }\n\n    .lumiverse-council-select-header-icon {\n        width: 36px;\n        height: 36px;\n    }\n\n    .lumiverse-council-select-header-text h3 {\n        font-size: 15px;\n    }\n\n    .lumiverse-council-select-section {\n        padding: 12px 16px;\n    }\n\n    .lumiverse-council-select-section-header {\n        flex-wrap: wrap;\n    }\n\n    .lumiverse-council-search-wrapper {\n        max-width: none;\n        width: 100%;\n        margin-top: 8px;\n        order: 1;\n    }\n\n    .lumiverse-council-member-list {\n        /* Horizontal scroll on mobile */\n        flex-direction: row;\n        overflow-x: auto;\n        padding-bottom: 8px;\n        gap: 10px;\n        scrollbar-width: thin;\n    }\n\n    .lumiverse-council-member-card {\n        flex-shrink: 0;\n        min-width: 200px;\n        max-width: 280px;\n    }\n\n    .lumiverse-council-select-grid {\n        grid-template-columns: repeat(3, 1fr);\n        gap: 8px;\n    }\n\n    .lumiverse-council-select-card-info {\n        padding: 6px;\n    }\n\n    .lumiverse-council-select-card-name {\n        font-size: 10px;\n    }\n\n    .lumiverse-council-select-card-pack {\n        display: none;\n    }\n\n    /* Always show plus icon on touch devices since hover doesn't work */\n    .lumiverse-council-select-card-add {\n        opacity: 1;\n        transform: scale(1);\n    }\n\n    .lumiverse-council-select-footer {\n        padding: 10px 16px;\n    }\n}\n\n/* Council Quirks Section */\n.lumiverse-council-quirks-section {\n    margin: 16px 0;\n    padding: 12px;\n    background: var(--SmartThemeBotMesBlurTintColor, rgba(0, 0, 0, 0.1));\n    border-radius: 8px;\n}\n\n.lumiverse-council-quirks-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    margin-bottom: 4px;\n}\n\n.lumiverse-council-quirks-label {\n    font-weight: 600;\n    font-size: 0.9em;\n    color: var(--lumiverse-text, var(--SmartThemeBodyColor, #fff));\n}\n\n.lumiverse-council-quirks-hint {\n    font-size: 0.8em;\n    color: var(--lumiverse-text-muted, var(--SmartThemeEmColor, #888));\n    margin: 0 0 8px 0;\n}\n\n.lumiverse-council-quirks-hint code {\n    background: rgba(0, 0, 0, 0.2);\n    padding: 2px 6px;\n    border-radius: 4px;\n    font-family: monospace;\n    font-size: 0.9em;\n}\n\n.lumiverse-council-textarea {\n    width: 100%;\n    min-height: 80px;\n    padding: 8px;\n    background: var(--lumiverse-bg, var(--SmartThemeBlurTintColor, rgba(0, 0, 0, 0.2)));\n    border: 1px solid var(--lumiverse-border, var(--SmartThemeBorderColor, rgba(255, 255, 255, 0.1)));\n    border-radius: 6px;\n    color: inherit;\n    font-family: inherit;\n    font-size: 0.9em;\n    resize: vertical;\n}\n\n.lumiverse-council-textarea:focus {\n    outline: none;\n    border-color: var(--lumiverse-primary, #9370DB);\n}\n\n.lumiverse-council-quirks-actions {\n    display: flex;\n    gap: 8px;\n    margin-top: 8px;\n}\n\n.lumiverse-council-quirks-preview {\n    padding: 8px;\n    background: rgba(0, 0, 0, 0.1);\n    border-radius: 6px;\n    font-size: 0.9em;\n}\n\n.lumiverse-council-quirks-text {\n    white-space: pre-wrap;\n}\n\n.lumiverse-council-quirks-empty {\n    color: var(--lumiverse-text-muted, var(--SmartThemeEmColor, #888));\n    font-style: italic;\n}\n\n.lumiverse-council-btn--sm {\n    padding: 4px 8px;\n    font-size: 12px;\n    border-radius: 4px;\n}\n\n/* State Synthesis sub-option styling */\n.lumiverse-vp-mode-option--sub {\n    margin-left: 16px;\n    padding-left: 12px;\n    border-left: 2px solid var(--lumiverse-border, var(--SmartThemeBorderColor, rgba(255, 255, 255, 0.1)));\n}\n\n/* Viewport Panel Quirks Section */\n.lumiverse-vp-quirks-section {\n    margin-top: 16px;\n    padding: 12px;\n    background: var(--SmartThemeBotMesBlurTintColor, rgba(0, 0, 0, 0.1));\n    border-radius: 8px;\n    transition: opacity 0.2s ease;\n}\n\n.lumiverse-vp-quirks-section--disabled {\n    opacity: 0.5;\n}\n\n.lumiverse-vp-quirks-section--disabled .lumiverse-vp-quirks-preview,\n.lumiverse-vp-quirks-section--disabled .lumiverse-vp-quirks-hint {\n    pointer-events: none;\n}\n\n.lumiverse-vp-quirks-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    margin-bottom: 4px;\n}\n\n.lumiverse-vp-quirks-header-left {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n}\n\n/* Compact inline toggle for quirks */\n.lumiverse-vp-quirks-toggle {\n    display: flex;\n    align-items: center;\n    padding: 0;\n    background: none;\n    border: none;\n    cursor: pointer;\n}\n\n.lumiverse-vp-quirks-toggle-track {\n    position: relative;\n    width: 28px;\n    height: 14px;\n    background: rgba(255, 255, 255, 0.15);\n    border-radius: 7px;\n    transition: background 0.2s ease;\n}\n\n.lumiverse-vp-quirks-toggle--on .lumiverse-vp-quirks-toggle-track {\n    background: var(--lumiverse-primary, #9370DB);\n}\n\n.lumiverse-vp-quirks-toggle-thumb {\n    position: absolute;\n    top: 2px;\n    left: 2px;\n    width: 10px;\n    height: 10px;\n    background: rgba(255, 255, 255, 0.7);\n    border-radius: 50%;\n    transition: transform 0.2s ease, background 0.2s ease;\n}\n\n.lumiverse-vp-quirks-toggle--on .lumiverse-vp-quirks-toggle-thumb {\n    transform: translateX(14px);\n    background: #fff;\n}\n\n.lumiverse-vp-quirks-toggle:hover .lumiverse-vp-quirks-toggle-track {\n    background: rgba(255, 255, 255, 0.25);\n}\n\n.lumiverse-vp-quirks-toggle--on:hover .lumiverse-vp-quirks-toggle-track {\n    background: var(--lumiverse-primary-light, #a388e0);\n}\n\n.lumiverse-vp-quirks-label {\n    font-weight: 600;\n    font-size: 0.9em;\n    color: var(--lumiverse-text, var(--SmartThemeBodyColor, #fff));\n}\n\n.lumiverse-vp-quirks-edit-btn {\n    padding: 4px 8px;\n    background: transparent;\n    border: 1px solid var(--lumiverse-border, var(--SmartThemeBorderColor, rgba(255, 255, 255, 0.1)));\n    border-radius: 4px;\n    color: var(--lumiverse-text-muted, var(--SmartThemeEmColor, #888));\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-vp-quirks-edit-btn:hover {\n    background: rgba(147, 112, 219, 0.2);\n    color: var(--lumiverse-text, var(--SmartThemeBodyColor, #fff));\n}\n\n.lumiverse-vp-quirks-hint {\n    font-size: 0.8em;\n    color: var(--lumiverse-text-muted, var(--SmartThemeEmColor, #888));\n    margin: 0 0 8px 0;\n}\n\n.lumiverse-vp-quirks-hint code {\n    background: rgba(0, 0, 0, 0.2);\n    padding: 2px 6px;\n    border-radius: 4px;\n    font-family: monospace;\n    font-size: 0.9em;\n}\n\n.lumiverse-vp-quirks-textarea {\n    width: 100%;\n    min-height: 60px;\n    padding: 8px;\n    background: var(--lumiverse-bg, var(--SmartThemeBlurTintColor, rgba(0, 0, 0, 0.2)));\n    border: 1px solid var(--lumiverse-border, var(--SmartThemeBorderColor, rgba(255, 255, 255, 0.1)));\n    border-radius: 6px;\n    color: inherit;\n    font-family: inherit;\n    font-size: 0.85em;\n    resize: vertical;\n}\n\n.lumiverse-vp-quirks-textarea:focus {\n    outline: none;\n    border-color: var(--lumiverse-primary, #9370DB);\n}\n\n.lumiverse-vp-quirks-actions {\n    display: flex;\n    gap: 8px;\n    margin-top: 8px;\n}\n\n.lumiverse-vp-quirks-btn {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    padding: 4px 10px;\n    background: transparent;\n    border: 1px solid var(--lumiverse-border, var(--SmartThemeBorderColor, rgba(255, 255, 255, 0.1)));\n    border-radius: 4px;\n    color: var(--lumiverse-text-muted, var(--SmartThemeEmColor, #888));\n    font-size: 0.8em;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-vp-quirks-btn:hover {\n    background: rgba(147, 112, 219, 0.2);\n    color: var(--lumiverse-text, var(--SmartThemeBodyColor, #fff));\n}\n\n.lumiverse-vp-quirks-btn--primary {\n    background: var(--lumiverse-primary, #9370DB);\n    border-color: var(--lumiverse-primary, #9370DB);\n    color: white;\n}\n\n.lumiverse-vp-quirks-btn--primary:hover {\n    background: var(--lumiverse-primary-light, #a388e0);\n}\n\n.lumiverse-vp-quirks-preview {\n    padding: 8px;\n    min-height: 60px;\n    background: rgba(0, 0, 0, 0.1);\n    border-radius: 6px;\n    font-size: 0.85em;\n}\n\n.lumiverse-vp-quirks-text {\n    white-space: pre-wrap;\n}\n\n.lumiverse-vp-quirks-empty {\n    color: var(--lumiverse-text-muted, var(--SmartThemeEmColor, #888));\n    font-style: italic;\n}\n\n/* Smart Synthesis Info */\n.lumiverse-vp-smart-info {\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n    margin-bottom: 8px;\n}\n\n.lumiverse-vp-smart-label {\n    font-weight: 600;\n    font-size: 0.9em;\n    color: var(--lumiverse-text, var(--SmartThemeBodyColor, #fff));\n}\n\n.lumiverse-vp-smart-hint {\n    font-size: 0.8em;\n    color: var(--lumiverse-text-muted, var(--SmartThemeEmColor, #888));\n}\n\n/* ----------------------------------------\n   Collapsible Component - CSS Grid Based\n   High-performance alternative to height animations.\n   Uses grid-template-rows: 0fr -> 1fr which is GPU-accelerated\n   and doesn't trigger layout thrashing.\n   ---------------------------------------- */\n.lumiverse-collapsible {\n    display: grid;\n    grid-template-rows: 0fr;\n    transition: grid-template-rows var(--collapsible-duration, 200ms) ease-out;\n}\n\n.lumiverse-collapsible.is-open {\n    grid-template-rows: 1fr;\n}\n\n.lumiverse-collapsible-inner {\n    overflow: hidden;\n    /* Ensure content is properly hidden when collapsed */\n    min-height: 0;\n}\n\n/* Optional: Fade in content when opening */\n.lumiverse-collapsible .lumiverse-collapsible-inner > * {\n    opacity: 0;\n    transition: opacity calc(var(--collapsible-duration, 200ms) * 0.5) ease-out;\n    transition-delay: calc(var(--collapsible-duration, 200ms) * 0.25);\n}\n\n.lumiverse-collapsible.is-open .lumiverse-collapsible-inner > * {\n    opacity: 1;\n}\n\n/* Reduced motion: instant transitions for accessibility */\n@media (prefers-reduced-motion: reduce) {\n    .lumiverse-collapsible {\n        transition: none;\n    }\n\n    .lumiverse-collapsible .lumiverse-collapsible-inner > * {\n        transition: none;\n        opacity: 1;\n    }\n\n    .lumiverse-collapsible:not(.is-open) .lumiverse-collapsible-inner > * {\n        opacity: 0;\n    }\n}\n\n/* ========================================\n   Pack Detail Modal - Pack Contents Viewer\n   Centered modal for viewing pack contents\n   with quick-add actions\n   ======================================== */\n\n/* Backdrop */\n.lumiverse-pack-detail-backdrop {\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background: rgba(0, 0, 0, 0.7);\n    backdrop-filter: blur(4px);\n    z-index: 10000;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    padding: 20px;\n    animation: fadeIn 0.15s ease-out;\n}\n\n@keyframes fadeIn {\n    from { opacity: 0; }\n    to { opacity: 1; }\n}\n\n@keyframes lumiverseFadeIn {\n    from { opacity: 0; }\n    to { opacity: 1; }\n}\n\n/* Pack detail modal - extends lumia-modal base class */\n.lumiverse-pack-detail-modal {\n    /* Override base modal width for pack details */\n    max-width: 650px;\n    /* Use Lumiverse theme colors */\n    background: var(--lumiverse-bg);\n    border-color: var(--lumiverse-border);\n    /* Custom animation */\n    animation: slideUp 0.2s ease-out;\n}\n\n@keyframes slideUp {\n    from {\n        opacity: 0;\n        transform: translateY(20px);\n    }\n    to {\n        opacity: 1;\n        transform: translateY(0);\n    }\n}\n\n/* Header */\n.lumiverse-pack-detail-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 16px 20px;\n    border-bottom: 1px solid var(--lumiverse-border);\n    background: var(--lumiverse-bg-elevated);\n    flex-shrink: 0;\n}\n\n.lumiverse-pack-detail-header-info {\n    display: flex;\n    align-items: center;\n    gap: 14px;\n    flex: 1;\n    min-width: 0;\n}\n\n.lumiverse-pack-detail-header-icon {\n    width: 48px;\n    height: 48px;\n    border-radius: var(--lumiverse-radius);\n    background: var(--lumiverse-bg-dark);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    flex-shrink: 0;\n    overflow: hidden;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-pack-detail-header-icon img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n    animation: lumiverseFadeIn 0.2s ease;\n}\n\n.lumiverse-pack-detail-header-img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n    animation: lumiverseFadeIn 0.2s ease;\n}\n\n.lumiverse-pack-detail-header-text {\n    flex: 1;\n    min-width: 0;\n}\n\n.lumiverse-pack-detail-title {\n    margin: 0;\n    font-size: 18px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-pack-detail-stats {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 12px;\n    margin-top: 6px;\n}\n\n.lumiverse-pack-detail-stats > span {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-pack-detail-stat {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-pack-detail-close {\n    width: 32px;\n    height: 32px;\n    border-radius: 50%;\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: all var(--lumiverse-transition-fast);\n    flex-shrink: 0;\n}\n\n.lumiverse-pack-detail-close:hover {\n    background: var(--lumiverse-bg-hover);\n    color: var(--lumiverse-text);\n}\n\n/* Content */\n.lumiverse-pack-detail-content {\n    flex: 1;\n    overflow-y: auto;\n    padding: 16px 20px;\n}\n\n/* Empty state */\n.lumiverse-pack-detail-empty {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    padding: 48px 20px;\n    text-align: center;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-pack-detail-empty svg {\n    opacity: 0.4;\n    margin-bottom: 12px;\n}\n\n.lumiverse-pack-detail-empty p {\n    margin: 0;\n    font-size: 14px;\n}\n\n/* Lumia list */\n.lumiverse-pack-detail-list {\n    display: flex;\n    flex-direction: column;\n    gap: 12px;\n}\n\n/* Lumia card */\n.lumiverse-pack-detail-lumia {\n    background: var(--lumiverse-bg-elevated);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    padding: 14px;\n    transition: border-color var(--lumiverse-transition-fast);\n}\n\n.lumiverse-pack-detail-lumia:hover {\n    border-color: var(--lumiverse-border-hover);\n}\n\n/* Lumia header */\n.lumiverse-pack-detail-lumia-header {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n    margin-bottom: 12px;\n}\n\n.lumiverse-pack-detail-lumia-avatar {\n    width: 44px;\n    height: 44px;\n    border-radius: var(--lumiverse-radius-sm);\n    background: var(--lumiverse-bg-dark);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    flex-shrink: 0;\n    overflow: hidden;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-pack-detail-lumia-avatar img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n}\n\n.lumiverse-pack-detail-lumia-info {\n    flex: 1;\n    min-width: 0;\n}\n\n.lumiverse-pack-detail-lumia-name {\n    margin: 0;\n    font-size: 15px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-pack-detail-lumia-author {\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n}\n\n/* Traits container */\n.lumiverse-pack-detail-traits {\n    display: flex;\n    flex-direction: column;\n    gap: 6px;\n    margin-bottom: 12px;\n}\n\n/* Trait preview */\n.lumiverse-pack-detail-trait {\n    background: var(--lumiverse-bg-dark);\n    border-radius: var(--lumiverse-radius-sm);\n    overflow: hidden;\n}\n\n.lumiverse-pack-detail-trait-header {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    width: 100%;\n    padding: 8px 12px;\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text);\n    cursor: pointer;\n    transition: background var(--lumiverse-transition-fast);\n    text-align: left;\n}\n\n.lumiverse-pack-detail-trait-header:hover {\n    background: rgba(255, 255, 255, 0.03);\n}\n\n.lumiverse-pack-detail-trait-header--open {\n    background: rgba(255, 255, 255, 0.02);\n}\n\n.lumiverse-pack-detail-trait-icon {\n    color: var(--lumiverse-text-muted);\n    display: flex;\n    align-items: center;\n}\n\n.lumiverse-pack-detail-trait-title {\n    flex: 1;\n    font-size: 13px;\n    font-weight: 500;\n}\n\n.lumiverse-pack-detail-trait-chevron {\n    color: var(--lumiverse-text-dim);\n    display: flex;\n    align-items: center;\n}\n\n.lumiverse-pack-detail-trait-content {\n    padding: 0 12px 12px;\n}\n\n.lumiverse-pack-detail-trait-content p {\n    margin: 0;\n    font-size: 12px;\n    line-height: 1.5;\n    color: var(--lumiverse-text-muted);\n    white-space: pre-wrap;\n    word-break: break-word;\n}\n\n/* Actions */\n.lumiverse-pack-detail-actions {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 8px;\n}\n\n.lumiverse-pack-detail-action {\n    display: flex;\n    align-items: center;\n    gap: 5px;\n    padding: 6px 10px;\n    background: var(--lumiverse-primary-light);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius-sm);\n    color: var(--lumiverse-text);\n    font-size: 12px;\n    font-weight: 500;\n    cursor: pointer;\n    transition: all var(--lumiverse-transition-fast);\n}\n\n.lumiverse-pack-detail-action:hover:not(:disabled) {\n    background: var(--lumiverse-primary);\n    border-color: var(--lumiverse-primary);\n    color: white;\n}\n\n.lumiverse-pack-detail-action:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n}\n\n.lumiverse-pack-detail-action--selected {\n    background: var(--lumiverse-success);\n    border-color: var(--lumiverse-success);\n    color: white;\n    cursor: default;\n}\n\n.lumiverse-pack-detail-action--selected:hover {\n    background: var(--lumiverse-success);\n    border-color: var(--lumiverse-success);\n}\n\n.lumiverse-pack-detail-action--enable-all {\n    background: transparent;\n    border-style: dashed;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-pack-detail-action--enable-all:hover {\n    background: var(--lumiverse-bg-hover);\n    border-color: var(--lumiverse-border-hover);\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-pack-detail-action--enable-all.all-enabled {\n    background: rgba(76, 175, 80, 0.15);\n    border-color: rgba(76, 175, 80, 0.6);\n    border-style: solid;\n    color: rgba(76, 175, 80, 1);\n}\n\n.lumiverse-pack-detail-action--enable-all.all-enabled:hover {\n    background: rgba(76, 175, 80, 0.25);\n    border-color: rgba(76, 175, 80, 0.8);\n}\n\n/* Pack browser - View button */\n.lumiverse-browser-pack-view-btn {\n    width: 28px;\n    height: 28px;\n    border-radius: var(--lumiverse-radius-sm);\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text-dim);\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: all var(--lumiverse-transition-fast);\n    flex-shrink: 0;\n    margin-left: auto;\n    margin-right: 8px;\n}\n\n.lumiverse-browser-pack-view-btn:hover {\n    background: var(--lumiverse-bg-hover);\n    color: var(--lumiverse-primary);\n}\n\n/* Downloaded Packs Section in Settings */\n.lumia-downloaded-packs {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumia-downloaded-pack-item {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n    padding: 10px 12px;\n    background: var(--lumiverse-bg-dark);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    transition: border-color var(--lumiverse-transition-fast);\n}\n\n.lumia-downloaded-pack-item:hover {\n    border-color: var(--lumiverse-border-hover);\n}\n\n.lumia-downloaded-pack-cover {\n    width: 36px;\n    height: 36px;\n    border-radius: var(--lumiverse-radius-sm);\n    object-fit: cover;\n    flex-shrink: 0;\n    animation: lumiverseFadeIn 0.2s ease;\n}\n\n.lumia-downloaded-pack-cover-placeholder {\n    width: 36px;\n    height: 36px;\n    border-radius: var(--lumiverse-radius-sm);\n    background: var(--lumiverse-bg-darker);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    flex-shrink: 0;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumia-downloaded-pack-cover-placeholder svg {\n    width: 18px;\n    height: 18px;\n}\n\n.lumia-downloaded-pack-info {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n    min-width: 0;\n}\n\n.lumia-downloaded-pack-name {\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumia-downloaded-pack-count {\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n}\n\n/* Downloaded Pack Actions */\n.lumia-downloaded-pack-actions {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    flex-shrink: 0;\n}\n\n/* Danger Icon Button */\n.lumia-btn-icon-danger {\n    color: var(--lumiverse-danger);\n    opacity: 0.6;\n}\n\n.lumia-btn-icon-danger:hover {\n    opacity: 1;\n    background: rgba(239, 68, 68, 0.15);\n}\n\n/* Loom Pack Detail Modal Additions */\n.lumiverse-loom-detail-modal {\n    /* Uses same base styles as pack detail modal */\n}\n\n.lumiverse-loom-detail-categories {\n    display: flex;\n    flex-direction: column;\n    gap: 16px;\n}\n\n/* Category section */\n.lumiverse-loom-detail-category {\n    background: var(--lumiverse-bg-elevated);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    overflow: hidden;\n}\n\n.lumiverse-loom-detail-category-header {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    width: 100%;\n    padding: 12px 14px;\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text);\n    cursor: pointer;\n    transition: background var(--lumiverse-transition-fast);\n    text-align: left;\n}\n\n.lumiverse-loom-detail-category-header:hover {\n    background: rgba(255, 255, 255, 0.03);\n}\n\n.lumiverse-loom-detail-category-header--expanded {\n    border-bottom: 1px solid var(--lumiverse-border);\n}\n\n.lumiverse-loom-detail-category-icon {\n    color: var(--lumiverse-primary);\n    display: flex;\n    align-items: center;\n}\n\n.lumiverse-loom-detail-category-title {\n    flex: 1;\n    font-size: 14px;\n    font-weight: 600;\n}\n\n.lumiverse-loom-detail-category-count {\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n    background: var(--lumiverse-bg-dark);\n    padding: 2px 8px;\n    border-radius: 10px;\n}\n\n.lumiverse-loom-detail-category-chevron {\n    color: var(--lumiverse-text-dim);\n    display: flex;\n    align-items: center;\n}\n\n.lumiverse-loom-detail-category-items {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n    padding: 12px;\n}\n\n/* Loom item card */\n.lumiverse-loom-detail-item {\n    padding: 10px 12px;\n    border: 1px solid;\n    border-radius: var(--lumiverse-radius-sm);\n    transition: all var(--lumiverse-transition-fast);\n}\n\n.lumiverse-loom-detail-item:hover {\n    transform: translateY(-1px);\n}\n\n.lumiverse-loom-detail-item-header {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n}\n\n.lumiverse-loom-detail-item-icon {\n    color: var(--lumiverse-text-muted);\n    display: flex;\n    align-items: center;\n}\n\n.lumiverse-loom-detail-item-name {\n    flex: 1;\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-loom-detail-item-toggle {\n    width: 24px;\n    height: 24px;\n    border-radius: 50%;\n    background: var(--lumiverse-bg-dark);\n    border: 1px solid var(--lumiverse-border);\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: all var(--lumiverse-transition-fast);\n}\n\n.lumiverse-loom-detail-item-toggle:hover {\n    background: var(--lumiverse-primary-light);\n    border-color: var(--lumiverse-primary);\n    color: var(--lumiverse-primary);\n}\n\n.lumiverse-loom-detail-item-toggle--selected {\n    background: var(--lumiverse-success);\n    border-color: var(--lumiverse-success);\n    color: white;\n}\n\n.lumiverse-loom-detail-item-toggle--selected:hover {\n    background: var(--lumiverse-danger);\n    border-color: var(--lumiverse-danger);\n}\n\n/* Content preview */\n.lumiverse-loom-detail-content-preview {\n    margin-top: 8px;\n}\n\n.lumiverse-loom-detail-content-toggle {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    padding: 4px 8px;\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text-dim);\n    font-size: 11px;\n    cursor: pointer;\n    transition: color var(--lumiverse-transition-fast);\n}\n\n.lumiverse-loom-detail-content-toggle:hover {\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-loom-detail-content-toggle--open {\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-loom-detail-content-chevron {\n    display: flex;\n    align-items: center;\n}\n\n.lumiverse-loom-detail-content-text {\n    padding: 8px 12px;\n    background: rgba(0, 0, 0, 0.15);\n    border-radius: var(--lumiverse-radius-sm);\n    margin-top: 6px;\n}\n\n.lumiverse-loom-detail-content-text p {\n    margin: 0;\n    font-size: 12px;\n    line-height: 1.5;\n    color: var(--lumiverse-text-muted);\n    white-space: pre-wrap;\n    word-break: break-word;\n}\n\n/* Loom Packs Section in Settings */\n.lumia-loom-packs {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumia-loom-pack-item {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n    padding: 10px 12px;\n    background: var(--lumiverse-bg-dark);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    transition: border-color var(--lumiverse-transition-fast);\n}\n\n.lumia-loom-pack-item:hover {\n    border-color: var(--lumiverse-border-hover);\n}\n\n.lumia-loom-pack-cover {\n    width: 36px;\n    height: 36px;\n    border-radius: var(--lumiverse-radius-sm);\n    object-fit: cover;\n    flex-shrink: 0;\n    animation: lumiverseFadeIn 0.2s ease;\n}\n\n.lumia-loom-pack-cover-placeholder {\n    width: 36px;\n    height: 36px;\n    border-radius: var(--lumiverse-radius-sm);\n    background: var(--lumiverse-bg-darker);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    flex-shrink: 0;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumia-loom-pack-cover-placeholder svg {\n    width: 18px;\n    height: 18px;\n}\n\n.lumia-loom-pack-info {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n    min-width: 0;\n}\n\n.lumia-loom-pack-name {\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumia-loom-pack-stats {\n    display: flex;\n    gap: 10px;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumia-loom-pack-stats span {\n    display: flex;\n    align-items: center;\n    gap: 3px;\n}\n\n/* Loom Pack Actions */\n.lumia-loom-pack-actions {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    flex-shrink: 0;\n}\n\n/* Mobile responsive */\n@media (max-width: 600px) {\n    .lumiverse-pack-detail-modal {\n        /* Override max-width for mobile */\n        max-width: 94vw;\n    }\n\n    .lumiverse-pack-detail-header {\n        padding: 14px 16px;\n    }\n\n    .lumiverse-pack-detail-header-icon {\n        width: 40px;\n        height: 40px;\n    }\n\n    .lumiverse-pack-detail-title {\n        font-size: 16px;\n    }\n\n    .lumiverse-pack-detail-content {\n        padding: 14px 16px;\n    }\n\n    .lumiverse-pack-detail-lumia {\n        padding: 12px;\n    }\n\n    .lumiverse-pack-detail-lumia-avatar {\n        width: 38px;\n        height: 38px;\n    }\n\n    .lumiverse-pack-detail-lumia-name {\n        font-size: 14px;\n    }\n\n    .lumiverse-pack-detail-actions {\n        gap: 6px;\n    }\n\n    .lumiverse-pack-detail-action {\n        padding: 8px 12px;\n        font-size: 13px;\n    }\n}\n\n\n/* ========================================\n   CHAT PRESETS PANEL & MODAL\n   Download presets from Lucid.cards + Reasoning/CoT settings\n   Modal-based design matching Lumia selection modal aesthetic\n   ======================================== */\n\n/* ============================================\n   UPDATE NOTIFICATION BANNERS\n   ============================================ */\n\n.lumiverse-presets-updates {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n    margin-bottom: 12px;\n}\n\n.lumiverse-presets-update-banner {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 10px 12px;\n    background: linear-gradient(135deg, rgba(34, 197, 94, 0.12), rgba(22, 163, 74, 0.08));\n    border: 1px solid rgba(34, 197, 94, 0.25);\n    border-radius: 10px;\n    animation: lumiverse-update-pulse 2s ease-in-out infinite;\n}\n\n@keyframes lumiverse-update-pulse {\n    0%, 100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.1); }\n    50% { box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.05); }\n}\n\n.lumiverse-presets-update-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 28px;\n    height: 28px;\n    background: rgba(34, 197, 94, 0.15);\n    border-radius: 7px;\n    color: rgba(34, 197, 94, 0.9);\n    flex-shrink: 0;\n}\n\n.lumiverse-presets-update-text {\n    flex: 1;\n    min-width: 0;\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n}\n\n.lumiverse-presets-update-title {\n    font-size: 12px;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-presets-update-version {\n    font-size: 10px;\n    color: rgba(34, 197, 94, 0.85);\n    font-family: var(--lumiverse-font-mono);\n}\n\n.lumiverse-presets-update-actions {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    flex-shrink: 0;\n}\n\n.lumiverse-presets-update-btn {\n    padding: 5px 12px;\n    background: rgba(34, 197, 94, 0.2);\n    border: 1px solid rgba(34, 197, 94, 0.35);\n    border-radius: 6px;\n    color: rgba(34, 197, 94, 0.95);\n    font-size: 11px;\n    font-weight: 600;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-presets-update-btn:hover {\n    background: rgba(34, 197, 94, 0.3);\n    border-color: rgba(34, 197, 94, 0.5);\n}\n\n.lumiverse-presets-update-dismiss {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 22px;\n    height: 22px;\n    background: transparent;\n    border: none;\n    border-radius: 4px;\n    color: var(--lumiverse-text-dim);\n    cursor: pointer;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-presets-update-dismiss:hover {\n    background: rgba(255, 255, 255, 0.05);\n    color: var(--lumiverse-text-muted);\n}\n\n/* ============================================\n   INVENTORY (Imported Presets in Settings Panel)\n   ============================================ */\n\n.lumiverse-presets-inventory {\n    margin-bottom: 14px;\n}\n\n.lumiverse-presets-inventory-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    margin-bottom: 10px;\n    padding-bottom: 8px;\n    border-bottom: 1px solid rgba(147, 112, 219, 0.1);\n}\n\n.lumiverse-presets-inventory-label {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    font-size: 11px;\n    font-weight: 600;\n    color: var(--lumiverse-text-muted);\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n.lumiverse-presets-inventory-label svg {\n    color: rgba(147, 112, 219, 0.7);\n}\n\n.lumiverse-presets-inventory-updates {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    padding: 3px 8px;\n    background: rgba(34, 197, 94, 0.12);\n    border: 1px solid rgba(34, 197, 94, 0.25);\n    border-radius: 10px;\n    font-size: 10px;\n    font-weight: 600;\n    color: rgba(34, 197, 94, 0.95);\n}\n\n.lumiverse-presets-inventory-list {\n    display: flex;\n    flex-direction: column;\n    gap: 6px;\n}\n\n.lumiverse-presets-inventory-item {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 10px 12px;\n    background: rgba(0, 0, 0, 0.15);\n    border: 1px solid rgba(128, 128, 128, 0.1);\n    border-radius: 10px;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-presets-inventory-item:hover {\n    background: rgba(0, 0, 0, 0.2);\n    border-color: rgba(147, 112, 219, 0.15);\n}\n\n.lumiverse-presets-inventory-item.has-update {\n    background: linear-gradient(135deg, rgba(34, 197, 94, 0.08), rgba(22, 163, 74, 0.04));\n    border-color: rgba(34, 197, 94, 0.2);\n}\n\n.lumiverse-presets-inventory-item-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 28px;\n    height: 28px;\n    background: rgba(147, 112, 219, 0.12);\n    border: 1px solid rgba(147, 112, 219, 0.2);\n    border-radius: 7px;\n    color: rgba(147, 112, 219, 0.8);\n    flex-shrink: 0;\n}\n\n.lumiverse-presets-inventory-item.has-update .lumiverse-presets-inventory-item-icon {\n    background: rgba(34, 197, 94, 0.12);\n    border-color: rgba(34, 197, 94, 0.25);\n    color: rgba(34, 197, 94, 0.9);\n}\n\n.lumiverse-presets-inventory-item-info {\n    flex: 1;\n    min-width: 0;\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n}\n\n.lumiverse-presets-inventory-item-name {\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-presets-inventory-item-version {\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n    font-family: var(--lumiverse-font-mono);\n}\n\n.lumiverse-presets-inventory-item.has-update .lumiverse-presets-inventory-item-version {\n    color: rgba(34, 197, 94, 0.85);\n}\n\n.lumiverse-presets-inventory-item-badge {\n    padding: 3px 8px;\n    background: rgba(34, 197, 94, 0.15);\n    border: 1px solid rgba(34, 197, 94, 0.3);\n    border-radius: 6px;\n    font-size: 10px;\n    font-weight: 600;\n    color: rgba(34, 197, 94, 0.95);\n    flex-shrink: 0;\n}\n\n/* Empty State */\n.lumiverse-presets-empty-state {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    gap: 8px;\n    padding: 24px 16px;\n    margin-bottom: 14px;\n    background: rgba(0, 0, 0, 0.1);\n    border: 1px dashed rgba(128, 128, 128, 0.2);\n    border-radius: 12px;\n    color: var(--lumiverse-text-dim);\n}\n\n.lumiverse-presets-empty-state svg {\n    color: rgba(147, 112, 219, 0.4);\n}\n\n.lumiverse-presets-empty-state span {\n    font-size: 12px;\n}\n\n/* Reasoning Quick Status */\n.lumiverse-presets-reasoning-status {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 8px;\n    margin-bottom: 12px;\n}\n\n.lumiverse-presets-reasoning-status-item {\n    display: flex;\n    align-items: center;\n    gap: 5px;\n    padding: 6px 10px;\n    background: rgba(147, 112, 219, 0.08);\n    border: 1px solid rgba(147, 112, 219, 0.15);\n    border-radius: 8px;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-presets-reasoning-status-item svg {\n    color: rgba(147, 112, 219, 0.7);\n    flex-shrink: 0;\n}\n\n.lumiverse-presets-reasoning-status-item code {\n    padding: 2px 5px;\n    background: rgba(0, 0, 0, 0.25);\n    border-radius: 4px;\n    font-size: 10px;\n    font-family: var(--lumiverse-font-mono);\n    color: rgba(186, 135, 255, 0.9);\n}\n\n/* ============================================\n   MODAL CONTAINER\n   ============================================ */\n\n.lumiverse-presets-modal {\n    width: 90vw;\n    max-width: 560px;\n    max-height: 85vh;\n    max-height: 85dvh;\n    height: auto;\n    min-height: 0;\n    display: flex;\n    flex-direction: column;\n    background: var(--lumiverse-bg);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 16px;\n    box-shadow: 0 16px 48px rgba(0, 0, 0, 0.4);\n    overflow: hidden;\n}\n\n/* Mobile-friendly sizing */\n@media (max-width: 480px) {\n    .lumiverse-presets-modal {\n        width: 95vw;\n        max-height: 90dvh;\n        border-radius: 16px;\n    }\n}\n\n/* Modal header */\n.lumiverse-presets-modal-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 16px 20px;\n    background: transparent;\n    border-bottom: 1px solid var(--lumiverse-border);\n    flex-shrink: 0;\n}\n\n.lumiverse-presets-modal-header-info {\n    display: flex;\n    align-items: center;\n    gap: 14px;\n}\n\n.lumiverse-presets-modal-header-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 40px;\n    height: 40px;\n    background: linear-gradient(135deg, rgba(147, 112, 219, 0.2), rgba(147, 112, 219, 0.1));\n    border-radius: 10px;\n    color: var(--lumiverse-primary);\n}\n\n.lumiverse-presets-modal-header-text {\n    display: flex;\n    flex-direction: column;\n    gap: 3px;\n}\n\n.lumiverse-presets-modal-title {\n    margin: 0;\n    font-size: 17px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    letter-spacing: -0.02em;\n}\n\n.lumiverse-presets-modal-subtitle {\n    margin: 0;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-presets-modal-close {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 34px;\n    height: 34px;\n    border: 1px solid rgba(128, 128, 128, 0.15);\n    border-radius: 8px;\n    background: rgba(255, 255, 255, 0.03);\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-presets-modal-close:hover {\n    background: rgba(239, 68, 68, 0.15);\n    border-color: rgba(239, 68, 68, 0.3);\n    color: rgba(239, 68, 68, 0.95);\n}\n\n/* Modal content - scrollable container */\n.lumiverse-presets-modal-content {\n    flex: 1 1 auto;\n    min-height: 0;\n    overflow-y: auto;\n    overflow-x: hidden;\n    padding: 16px 20px;\n    display: flex;\n    flex-direction: column;\n    gap: 16px;\n}\n\n.lumiverse-presets-modal-content::-webkit-scrollbar {\n    width: 6px;\n}\n\n.lumiverse-presets-modal-content::-webkit-scrollbar-track {\n    background: rgba(0, 0, 0, 0.1);\n    border-radius: 3px;\n}\n\n.lumiverse-presets-modal-content::-webkit-scrollbar-thumb {\n    background: rgba(147, 112, 219, 0.3);\n    border-radius: 3px;\n}\n\n.lumiverse-presets-modal-content::-webkit-scrollbar-thumb:hover {\n    background: rgba(147, 112, 219, 0.5);\n}\n\n/* Modal footer */\n.lumiverse-presets-modal-footer {\n    display: flex;\n    align-items: center;\n    justify-content: flex-end;\n    padding: 14px 20px;\n    border-top: 1px solid var(--lumiverse-border);\n    background: transparent;\n    flex-shrink: 0;\n}\n\n.lumiverse-presets-modal-btn {\n    padding: 10px 24px;\n    border: 1px solid rgba(128, 128, 128, 0.2);\n    border-radius: 8px;\n    font-size: 13px;\n    font-weight: 500;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-presets-modal-btn--primary {\n    background: linear-gradient(135deg, rgba(147, 112, 219, 0.9), rgba(100, 149, 237, 0.8));\n    border-color: rgba(147, 112, 219, 0.5);\n    color: white;\n}\n\n.lumiverse-presets-modal-btn--primary:hover {\n    background: linear-gradient(135deg, rgba(147, 112, 219, 1), rgba(100, 149, 237, 0.9));\n    box-shadow: 0 4px 12px rgba(147, 112, 219, 0.3);\n    transform: translateY(-1px);\n}\n\n/* ============================================\n   SECTION CONTAINERS\n   ============================================ */\n\n.lumiverse-presets-section {\n    background: rgba(38, 32, 52, 0.5);\n    border: 1px solid rgba(128, 128, 128, 0.1);\n    border-radius: 14px;\n    overflow: hidden;\n    flex-shrink: 0; /* Prevent sections from shrinking when content expands */\n}\n\n.lumiverse-presets-section-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 12px 14px;\n    background: rgba(0, 0, 0, 0.15);\n    border-bottom: 1px solid rgba(128, 128, 128, 0.08);\n}\n\n.lumiverse-presets-section-title {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    font-size: 12px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n.lumiverse-presets-section-title svg {\n    color: rgba(147, 112, 219, 0.8);\n}\n\n/* Refresh button */\n.lumiverse-presets-refresh {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 28px;\n    height: 28px;\n    border: 1px solid rgba(147, 112, 219, 0.2);\n    border-radius: 6px;\n    background: rgba(147, 112, 219, 0.08);\n    color: rgba(147, 112, 219, 0.8);\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-presets-refresh:hover:not(:disabled) {\n    background: rgba(147, 112, 219, 0.18);\n    border-color: rgba(147, 112, 219, 0.35);\n    color: rgba(147, 112, 219, 1);\n}\n\n.lumiverse-presets-refresh:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n}\n\n.lumiverse-presets-refresh.is-loading svg {\n    animation: lumiverse-spin 0.8s linear infinite;\n}\n\n/* ============================================\n   EMPTY / LOADING / ERROR STATES\n   ============================================ */\n\n.lumiverse-presets-empty {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    gap: 12px;\n    padding: 32px 20px;\n}\n\n.lumiverse-presets-empty-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 56px;\n    height: 56px;\n    background: linear-gradient(135deg, rgba(147, 112, 219, 0.1), rgba(100, 149, 237, 0.08));\n    border: 1px dashed rgba(147, 112, 219, 0.25);\n    border-radius: 14px;\n    color: rgba(147, 112, 219, 0.5);\n}\n\n.lumiverse-presets-empty-text {\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n    text-align: center;\n}\n\n.lumiverse-presets-empty-btn {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    padding: 9px 18px;\n    background: linear-gradient(135deg, rgba(147, 112, 219, 0.2), rgba(100, 149, 237, 0.15));\n    border: 1px solid rgba(147, 112, 219, 0.3);\n    border-radius: 8px;\n    color: rgba(147, 112, 219, 0.95);\n    font-size: 12px;\n    font-weight: 500;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-presets-empty-btn:hover {\n    background: linear-gradient(135deg, rgba(147, 112, 219, 0.3), rgba(100, 149, 237, 0.25));\n    border-color: rgba(147, 112, 219, 0.5);\n    transform: translateY(-1px);\n}\n\n.lumiverse-presets-loading {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    gap: 12px;\n    padding: 32px 20px;\n    color: var(--lumiverse-text-muted);\n    font-size: 12px;\n}\n\n.lumiverse-presets-loading-spinner {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 44px;\n    height: 44px;\n    background: rgba(147, 112, 219, 0.1);\n    border-radius: 50%;\n    color: rgba(147, 112, 219, 0.8);\n}\n\n.lumiverse-presets-loading-spinner svg {\n    animation: lumiverse-spin 0.8s linear infinite;\n}\n\n.lumiverse-presets-error {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    gap: 10px;\n    padding: 28px 20px;\n    color: rgba(239, 68, 68, 0.9);\n    font-size: 12px;\n    text-align: center;\n}\n\n.lumiverse-presets-error button {\n    margin-top: 4px;\n    padding: 7px 14px;\n    border: 1px solid rgba(239, 68, 68, 0.4);\n    border-radius: 6px;\n    background: rgba(239, 68, 68, 0.15);\n    color: rgba(239, 68, 68, 0.95);\n    font-size: 11px;\n    font-weight: 500;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-presets-error button:hover {\n    background: rgba(239, 68, 68, 0.25);\n    border-color: rgba(239, 68, 68, 0.6);\n}\n\n/* ============================================\n   PRESET LIST & CARDS\n   ============================================ */\n\n.lumiverse-presets-list {\n    display: flex;\n    flex-direction: column;\n    gap: 6px;\n    padding: 10px;\n}\n\n/* Preset card - unified clickable container */\n.lumiverse-preset-card {\n    background: rgba(45, 38, 60, 0.6);\n    border: 1px solid rgba(128, 128, 128, 0.1);\n    border-radius: 10px;\n    overflow: hidden;\n    transition: border-color 0.2s ease, box-shadow 0.2s ease;\n    animation: lumiverse-preset-card-appear 0.25s ease-out backwards;\n    animation-delay: var(--card-delay, 0ms);\n    cursor: pointer;\n    outline: none;\n}\n\n.lumiverse-preset-card:focus-visible {\n    border-color: rgba(147, 112, 219, 0.5);\n    box-shadow: 0 0 0 2px rgba(147, 112, 219, 0.2);\n}\n\n@keyframes lumiverse-preset-card-appear {\n    from {\n        opacity: 0;\n        transform: translateY(8px);\n    }\n    to {\n        opacity: 1;\n        transform: translateY(0);\n    }\n}\n\n.lumiverse-preset-card:hover {\n    border-color: rgba(147, 112, 219, 0.25);\n}\n\n.lumiverse-preset-card.is-expanded {\n    border-color: rgba(100, 149, 237, 0.35);\n    box-shadow: 0 2px 12px rgba(0, 0, 0, 0.15);\n}\n\n.lumiverse-preset-card.has-update {\n    border-color: rgba(34, 197, 94, 0.3);\n    background: linear-gradient(135deg, rgba(34, 197, 94, 0.05), rgba(45, 38, 60, 0.6));\n}\n\n.lumiverse-preset-card.has-update:hover {\n    border-color: rgba(34, 197, 94, 0.45);\n}\n\n/* Card header - no longer a button, just a container */\n.lumiverse-preset-card-header {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    width: 100%;\n    padding: 10px 12px;\n    background: transparent;\n    text-align: left;\n    transition: background 0.15s ease;\n}\n\n.lumiverse-preset-card:hover .lumiverse-preset-card-header {\n    background: rgba(255, 255, 255, 0.02);\n}\n\n.lumiverse-preset-card-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 32px;\n    height: 32px;\n    background: linear-gradient(135deg, rgba(100, 149, 237, 0.15), rgba(147, 112, 219, 0.1));\n    border: 1px solid rgba(100, 149, 237, 0.2);\n    border-radius: 7px;\n    color: rgba(100, 149, 237, 0.85);\n    flex-shrink: 0;\n}\n\n.lumiverse-preset-card-icon.has-update {\n    background: linear-gradient(135deg, rgba(34, 197, 94, 0.2), rgba(22, 163, 74, 0.15));\n    border-color: rgba(34, 197, 94, 0.3);\n    color: rgba(34, 197, 94, 0.9);\n}\n\n.lumiverse-preset-card-info {\n    flex: 1;\n    min-width: 0;\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n}\n\n.lumiverse-preset-card-name {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    font-size: 12px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-preset-card-update-badge {\n    padding: 2px 5px;\n    background: rgba(34, 197, 94, 0.2);\n    border-radius: 4px;\n    font-size: 9px;\n    font-weight: 600;\n    color: rgba(34, 197, 94, 0.95);\n    text-transform: uppercase;\n    letter-spacing: 0.3px;\n    flex-shrink: 0;\n}\n\n.lumiverse-preset-card-meta {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    font-size: 10px;\n    color: var(--lumiverse-text-dim);\n}\n\n.lumiverse-preset-card-meta svg {\n    opacity: 0.6;\n}\n\n.lumiverse-preset-card-actions {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    flex-shrink: 0;\n}\n\n.lumiverse-preset-card-download {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 28px;\n    height: 28px;\n    border: 1px solid rgba(100, 149, 237, 0.25);\n    border-radius: 6px;\n    background: rgba(100, 149, 237, 0.12);\n    color: rgba(100, 149, 237, 0.85);\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-preset-card-download:hover:not(:disabled) {\n    background: rgba(100, 149, 237, 0.25);\n    border-color: rgba(100, 149, 237, 0.45);\n    color: rgba(100, 149, 237, 1);\n}\n\n.lumiverse-preset-card-download:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n}\n\n.lumiverse-preset-card-chevron {\n    color: var(--lumiverse-text-dim);\n    transition: transform 0.2s ease;\n}\n\n.lumiverse-preset-card.is-expanded .lumiverse-preset-card-chevron {\n    transform: rotate(90deg);\n    color: rgba(100, 149, 237, 0.8);\n}\n\n/* Version list - CSS grid collapse to avoid layout thrashing */\n.lumiverse-preset-card-versions {\n    display: grid;\n    grid-template-rows: 0fr;\n    transition: grid-template-rows 0.2s ease;\n}\n\n.lumiverse-preset-card-versions.is-expanded {\n    grid-template-rows: 1fr;\n}\n\n.lumiverse-preset-card-versions-inner {\n    overflow: hidden;\n    display: flex;\n    flex-direction: column;\n    gap: 4px;\n    padding: 0;\n    background: rgba(0, 0, 0, 0.12);\n    border-top: 1px solid transparent;\n}\n\n.lumiverse-preset-card-versions.is-expanded .lumiverse-preset-card-versions-inner {\n    padding: 8px 10px 10px;\n    border-top-color: rgba(100, 149, 237, 0.1);\n}\n\n/* Show more versions button */\n.lumiverse-preset-versions-showmore {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 6px;\n    width: 100%;\n    padding: 8px 10px;\n    margin-top: 2px;\n    border: 1px dashed rgba(147, 112, 219, 0.2);\n    border-radius: 6px;\n    background: rgba(147, 112, 219, 0.05);\n    color: var(--lumiverse-text-muted);\n    font-size: 11px;\n    font-weight: 500;\n    cursor: pointer;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-preset-versions-showmore:hover {\n    background: rgba(147, 112, 219, 0.12);\n    border-color: rgba(147, 112, 219, 0.35);\n    color: rgba(147, 112, 219, 0.95);\n}\n\n.lumiverse-preset-versions-showmore svg {\n    opacity: 0.7;\n}\n\n/* Version items */\n.lumiverse-preset-version {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 8px 10px;\n    background: rgba(38, 32, 52, 0.6);\n    border: 1px solid rgba(128, 128, 128, 0.08);\n    border-radius: 6px;\n    transition: background 0.15s ease, border-color 0.15s ease;\n}\n\n.lumiverse-preset-version:hover {\n    background: rgba(45, 38, 60, 0.8);\n    border-color: rgba(147, 112, 219, 0.15);\n}\n\n.lumiverse-preset-version.is-latest {\n    background: linear-gradient(135deg, rgba(100, 149, 237, 0.08), rgba(147, 112, 219, 0.05));\n    border-color: rgba(100, 149, 237, 0.15);\n}\n\n.lumiverse-preset-version.is-prolix {\n    background: linear-gradient(135deg, rgba(249, 115, 22, 0.08), rgba(234, 88, 12, 0.05));\n    border-color: rgba(249, 115, 22, 0.15);\n}\n\n.lumiverse-preset-version-info {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    flex: 1;\n    min-width: 0;\n}\n\n.lumiverse-preset-version-name {\n    font-size: 11px;\n    font-weight: 500;\n    color: var(--lumiverse-text-muted);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-preset-version-badges {\n    display: flex;\n    gap: 4px;\n    flex-shrink: 0;\n}\n\n.lumiverse-preset-version-badge {\n    padding: 2px 6px;\n    border-radius: 4px;\n    font-size: 9px;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.3px;\n}\n\n.lumiverse-preset-version-badge.is-latest {\n    background: linear-gradient(135deg, rgba(100, 149, 237, 0.25), rgba(147, 112, 219, 0.2));\n    color: rgba(100, 149, 237, 0.95);\n}\n\n.lumiverse-preset-version-badge.is-prolix {\n    background: rgba(249, 115, 22, 0.18);\n    color: rgba(249, 115, 22, 0.95);\n}\n\n.lumiverse-preset-version-download {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    padding: 5px 9px;\n    border: 1px solid rgba(147, 112, 219, 0.2);\n    border-radius: 5px;\n    background: rgba(147, 112, 219, 0.1);\n    color: rgba(147, 112, 219, 0.85);\n    font-size: 10px;\n    font-weight: 500;\n    cursor: pointer;\n    transition: all 0.15s ease;\n    flex-shrink: 0;\n}\n\n.lumiverse-preset-version-download:hover:not(:disabled) {\n    background: rgba(147, 112, 219, 0.2);\n    border-color: rgba(147, 112, 219, 0.4);\n    color: rgba(147, 112, 219, 1);\n}\n\n.lumiverse-preset-version-download:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n}\n\n/* ============================================\n   REASONING SECTION\n   ============================================ */\n\n.lumiverse-presets-reasoning {\n    padding: 14px;\n    display: flex;\n    flex-direction: column;\n    gap: 14px;\n}\n\n/* Quick presets */\n.lumiverse-presets-reasoning-quick {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumiverse-presets-reasoning-label {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    font-size: 10px;\n    font-weight: 600;\n    color: var(--lumiverse-text-dim);\n    text-transform: uppercase;\n    letter-spacing: 0.6px;\n}\n\n.lumiverse-presets-reasoning-label svg {\n    color: rgba(147, 112, 219, 0.7);\n}\n\n.lumiverse-presets-reasoning-btns {\n    display: flex;\n    gap: 6px;\n    flex-wrap: wrap;\n}\n\n.lumiverse-presets-reasoning-btn {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 3px;\n    padding: 9px 14px;\n    border: 1px solid rgba(128, 128, 128, 0.12);\n    border-radius: 8px;\n    background: rgba(38, 32, 52, 0.6);\n    cursor: pointer;\n    transition: all 0.2s ease;\n    flex: 1;\n    min-width: 80px;\n}\n\n.lumiverse-presets-reasoning-btn:hover {\n    transform: translateY(-1px);\n}\n\n.lumiverse-presets-reasoning-btn-label {\n    font-size: 11px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-presets-reasoning-btn code {\n    font-size: 9px;\n    font-family: var(--lumiverse-font-mono);\n    color: var(--lumiverse-text-dim);\n    opacity: 0.8;\n}\n\n/* DeepSeek variant */\n.lumiverse-presets-reasoning-btn--deepseek {\n    border-color: rgba(52, 152, 219, 0.2);\n    background: linear-gradient(135deg, rgba(52, 152, 219, 0.08), rgba(41, 128, 185, 0.05));\n}\n\n.lumiverse-presets-reasoning-btn--deepseek:hover {\n    border-color: rgba(52, 152, 219, 0.4);\n    background: linear-gradient(135deg, rgba(52, 152, 219, 0.15), rgba(41, 128, 185, 0.1));\n}\n\n.lumiverse-presets-reasoning-btn--deepseek .lumiverse-presets-reasoning-btn-label {\n    color: rgba(52, 152, 219, 0.95);\n}\n\n/* Claude variant */\n.lumiverse-presets-reasoning-btn--claude {\n    border-color: rgba(217, 119, 87, 0.2);\n    background: linear-gradient(135deg, rgba(217, 119, 87, 0.08), rgba(193, 95, 63, 0.05));\n}\n\n.lumiverse-presets-reasoning-btn--claude:hover {\n    border-color: rgba(217, 119, 87, 0.4);\n    background: linear-gradient(135deg, rgba(217, 119, 87, 0.15), rgba(193, 95, 63, 0.1));\n}\n\n.lumiverse-presets-reasoning-btn--claude .lumiverse-presets-reasoning-btn-label {\n    color: rgba(217, 119, 87, 0.95);\n}\n\n/* o1 variant */\n.lumiverse-presets-reasoning-btn--o1 {\n    border-color: rgba(16, 163, 127, 0.2);\n    background: linear-gradient(135deg, rgba(16, 163, 127, 0.08), rgba(13, 138, 107, 0.05));\n}\n\n.lumiverse-presets-reasoning-btn--o1:hover {\n    border-color: rgba(16, 163, 127, 0.4);\n    background: linear-gradient(135deg, rgba(16, 163, 127, 0.15), rgba(13, 138, 107, 0.1));\n}\n\n.lumiverse-presets-reasoning-btn--o1 .lumiverse-presets-reasoning-btn-label {\n    color: rgba(16, 163, 127, 0.95);\n}\n\n/* Current settings */\n.lumiverse-presets-reasoning-current {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n    padding: 10px 12px;\n    background: rgba(0, 0, 0, 0.15);\n    border: 1px solid rgba(128, 128, 128, 0.08);\n    border-radius: 8px;\n}\n\n.lumiverse-presets-reasoning-row {\n    display: flex;\n    align-items: center;\n}\n\n.lumiverse-presets-reasoning-checkbox {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    cursor: pointer;\n    font-size: 12px;\n    color: var(--lumiverse-text);\n    position: relative;\n}\n\n.lumiverse-presets-reasoning-checkbox input[type="checkbox"] {\n    position: absolute;\n    opacity: 0;\n    cursor: pointer;\n}\n\n.lumiverse-presets-reasoning-checkmark {\n    width: 16px;\n    height: 16px;\n    background: rgba(28, 24, 38, 0.8);\n    border: 1px solid rgba(147, 112, 219, 0.3);\n    border-radius: 4px;\n    transition: all 0.15s ease;\n    position: relative;\n    flex-shrink: 0;\n}\n\n.lumiverse-presets-reasoning-checkbox input:checked ~ .lumiverse-presets-reasoning-checkmark {\n    background: linear-gradient(135deg, rgba(147, 112, 219, 0.8), rgba(100, 149, 237, 0.7));\n    border-color: rgba(147, 112, 219, 0.6);\n}\n\n.lumiverse-presets-reasoning-checkmark::after {\n    content: '';\n    position: absolute;\n    left: 5px;\n    top: 2px;\n    width: 4px;\n    height: 8px;\n    border: solid white;\n    border-width: 0 2px 2px 0;\n    transform: rotate(45deg);\n    opacity: 0;\n    transition: opacity 0.15s ease;\n}\n\n.lumiverse-presets-reasoning-checkbox input:checked ~ .lumiverse-presets-reasoning-checkmark::after {\n    opacity: 1;\n}\n\n.lumiverse-presets-reasoning-tags {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-presets-reasoning-tags svg {\n    color: var(--lumiverse-text-dim);\n}\n\n.lumiverse-presets-reasoning-tags code {\n    padding: 2px 5px;\n    background: rgba(0, 0, 0, 0.2);\n    border-radius: 3px;\n    font-family: var(--lumiverse-font-mono);\n    font-size: 10px;\n    color: rgba(147, 112, 219, 0.9);\n}\n\n.lumiverse-presets-reasoning-tags-sep {\n    opacity: 0.4;\n}\n\n/* API Reasoning Settings (Include Reasoning & Effort) */\n.lumiverse-presets-api-reasoning {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n    padding-top: 12px;\n    margin-top: 4px;\n    border-top: 1px solid rgba(128, 128, 128, 0.1);\n}\n\n.lumiverse-presets-api-reasoning-controls {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    gap: 16px;\n    flex-wrap: wrap;\n}\n\n.lumiverse-presets-api-reasoning-effort {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n}\n\n.lumiverse-presets-api-reasoning-effort-label {\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-presets-api-reasoning-select {\n    padding: 6px 28px 6px 10px;\n    border: 1px solid rgba(128, 128, 128, 0.2);\n    border-radius: 6px;\n    background: rgba(28, 24, 38, 0.7);\n    color: var(--lumiverse-text);\n    font-size: 12px;\n    cursor: pointer;\n    transition: all 0.15s ease;\n    appearance: none;\n    background-image: url(${v});\n    background-repeat: no-repeat;\n    background-position: right 8px center;\n}\n\n.lumiverse-presets-api-reasoning-select:hover:not(:disabled) {\n    border-color: rgba(147, 112, 219, 0.4);\n}\n\n.lumiverse-presets-api-reasoning-select:focus {\n    outline: none;\n    border-color: rgba(147, 112, 219, 0.5);\n    box-shadow: 0 0 0 2px rgba(147, 112, 219, 0.1);\n}\n\n.lumiverse-presets-api-reasoning-select:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n}\n\n.lumiverse-presets-api-reasoning-select option {\n    background: rgb(38, 32, 52);\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-presets-api-reasoning-hint {\n    margin: 0;\n    font-size: 10px;\n    color: var(--lumiverse-text-dim);\n    font-style: italic;\n}\n\n/* Start Reply With */\n.lumiverse-presets-startreply {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumiverse-presets-startreply-label {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    font-size: 10px;\n    font-weight: 600;\n    color: var(--lumiverse-text-dim);\n    text-transform: uppercase;\n    letter-spacing: 0.6px;\n}\n\n.lumiverse-presets-startreply-label svg {\n    color: rgba(250, 204, 21, 0.7);\n}\n\n.lumiverse-presets-startreply-input-wrap {\n    position: relative;\n}\n\n.lumiverse-presets-startreply-input {\n    width: 100%;\n    padding: 10px 12px;\n    border: 1px solid rgba(128, 128, 128, 0.12);\n    border-radius: 8px;\n    background: rgba(28, 24, 38, 0.7);\n    color: var(--lumiverse-text);\n    font-family: var(--lumiverse-font-mono);\n    font-size: 12px;\n    resize: vertical;\n    min-height: 52px;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-presets-startreply-input:focus {\n    outline: none;\n    border-color: rgba(250, 204, 21, 0.35);\n    box-shadow: 0 0 0 2px rgba(250, 204, 21, 0.08);\n}\n\n.lumiverse-presets-startreply-input::placeholder {\n    color: var(--lumiverse-text-dim);\n}\n\n.lumiverse-presets-startreply-quick {\n    display: flex;\n    gap: 5px;\n    flex-wrap: wrap;\n}\n\n.lumiverse-presets-startreply-btn {\n    padding: 5px 10px;\n    border: 1px solid rgba(128, 128, 128, 0.12);\n    border-radius: 5px;\n    background: rgba(38, 32, 52, 0.5);\n    color: var(--lumiverse-text-muted);\n    font-family: var(--lumiverse-font-mono);\n    font-size: 10px;\n    cursor: pointer;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-presets-startreply-btn:hover {\n    background: rgba(147, 112, 219, 0.15);\n    border-color: rgba(147, 112, 219, 0.3);\n    color: rgba(147, 112, 219, 0.95);\n}\n\n.lumiverse-presets-startreply-btn--clear {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    padding: 5px 8px;\n    color: var(--lumiverse-text-dim);\n}\n\n.lumiverse-presets-startreply-btn--clear:hover {\n    background: rgba(239, 68, 68, 0.15);\n    border-color: rgba(239, 68, 68, 0.3);\n    color: rgba(239, 68, 68, 0.95);\n}\n\n/* Claude variant for Start Reply With (no newline) */\n.lumiverse-presets-startreply-btn--claude {\n    border-color: rgba(217, 119, 87, 0.15);\n    background: rgba(217, 119, 87, 0.08);\n}\n\n.lumiverse-presets-startreply-btn--claude:hover {\n    background: rgba(217, 119, 87, 0.18);\n    border-color: rgba(217, 119, 87, 0.35);\n    color: rgba(217, 119, 87, 0.95);\n}\n\n/* Disabled state when API Reasoning is enabled */\n.lumiverse-presets-startreply.is-disabled {\n    opacity: 0.6;\n    pointer-events: none;\n}\n\n.lumiverse-presets-startreply.is-disabled .lumiverse-presets-startreply-input {\n    background: rgba(28, 24, 38, 0.4);\n    cursor: not-allowed;\n}\n\n.lumiverse-presets-startreply.is-disabled .lumiverse-presets-startreply-btn {\n    cursor: not-allowed;\n    opacity: 0.5;\n}\n\n.lumiverse-presets-startreply-disabled-hint {\n    font-size: 9px;\n    font-weight: 400;\n    color: rgba(250, 204, 21, 0.6);\n    font-style: italic;\n    text-transform: none;\n    letter-spacing: 0;\n    margin-left: auto;\n}\n\n/* Compact mode for sidebar usage */\n.lumiverse-presets-reasoning--compact {\n    padding: 0;\n    margin: 0;\n}\n\n.lumiverse-presets-reasoning--compact .lumiverse-presets-reasoning-quick {\n    padding: 10px;\n    margin-bottom: 8px;\n}\n\n.lumiverse-presets-reasoning--compact .lumiverse-presets-reasoning-btns {\n    gap: 6px;\n}\n\n.lumiverse-presets-reasoning--compact .lumiverse-presets-reasoning-btn {\n    padding: 6px 10px;\n    font-size: 10px;\n}\n\n.lumiverse-presets-reasoning--compact .lumiverse-presets-reasoning-current {\n    padding: 8px 10px;\n}\n\n.lumiverse-presets-reasoning--compact .lumiverse-presets-api-reasoning {\n    padding: 10px;\n}\n\n.lumiverse-presets-reasoning--compact .lumiverse-presets-startreply {\n    padding: 10px;\n}\n\n.lumiverse-presets-reasoning--compact .lumiverse-presets-startreply-input {\n    min-height: 40px;\n}\n\n/* Prompt Post-Processing Section */\n.lumiverse-presets-postprocessing {\n    padding: 12px 16px;\n    background: linear-gradient(135deg, rgba(99, 102, 241, 0.08) 0%, rgba(139, 92, 246, 0.05) 100%);\n    border-top: 1px solid rgba(99, 102, 241, 0.15);\n}\n\n.lumiverse-presets-postprocessing-label {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    font-size: 11px;\n    font-weight: 600;\n    color: rgba(255, 255, 255, 0.85);\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    margin-bottom: 10px;\n}\n\n.lumiverse-presets-postprocessing-label svg {\n    color: rgba(139, 92, 246, 0.8);\n}\n\n.lumiverse-presets-postprocessing-select {\n    width: 100%;\n    padding: 8px 12px;\n    font-size: 12px;\n    font-family: inherit;\n    color: rgba(255, 255, 255, 0.9);\n    background: rgba(0, 0, 0, 0.3);\n    border: 1px solid rgba(99, 102, 241, 0.3);\n    border-radius: 6px;\n    cursor: pointer;\n    transition: all 0.15s ease;\n    appearance: none;\n    background-image: url(${g});\n    background-repeat: no-repeat;\n    background-position: right 10px center;\n    padding-right: 32px;\n}\n\n.lumiverse-presets-postprocessing-select:hover {\n    border-color: rgba(139, 92, 246, 0.5);\n    background-color: rgba(0, 0, 0, 0.4);\n}\n\n.lumiverse-presets-postprocessing-select:focus {\n    outline: none;\n    border-color: rgba(139, 92, 246, 0.7);\n    box-shadow: 0 0 0 2px rgba(139, 92, 246, 0.15);\n}\n\n.lumiverse-presets-postprocessing-select option {\n    background: #1e1e2e;\n    color: rgba(255, 255, 255, 0.9);\n    padding: 8px;\n}\n\n.lumiverse-presets-postprocessing-hint {\n    margin: 8px 0 0 0;\n    font-size: 10px;\n    color: rgba(255, 255, 255, 0.45);\n    line-height: 1.4;\n}\n\n/* Compact mode for post-processing */\n.lumiverse-presets-reasoning--compact .lumiverse-presets-postprocessing {\n    padding: 10px;\n}\n\n/* ========================================\n   Preset Editor Styles\n   ======================================== */\n\n.lumiverse-preset-editor {\n    width: 800px;\n    height: 80vh;\n    display: flex;\n    flex-direction: column;\n}\n\n.lumiverse-editor-content {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    overflow: hidden;\n    padding: 0;\n}\n\n.lumiverse-toolbar {\n    display: flex;\n    gap: 10px;\n    padding: 12px 16px;\n    background: var(--lumiverse-bg-elevated);\n    border-bottom: 1px solid var(--lumiverse-border);\n}\n\n.lumiverse-prompt-list {\n    flex: 1;\n    overflow-y: auto;\n    padding: 16px;\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumiverse-prompt-item {\n    display: flex;\n    align-items: flex-start;\n    padding: 10px;\n    background: var(--lumiverse-bg-elevated);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    gap: 12px;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-prompt-item:hover {\n    border-color: var(--lumiverse-border-hover);\n    background: var(--lumiverse-bg-hover);\n}\n\n.lumiverse-prompt-category {\n    background: rgba(147, 112, 219, 0.1);\n    border-color: rgba(147, 112, 219, 0.25);\n    margin-top: 16px;\n    margin-bottom: 4px;\n}\n\n.lumiverse-prompt-category .lumiverse-prompt-name {\n    font-size: 14px;\n    font-weight: 600;\n    color: var(--lumiverse-primary-text);\n}\n\n.lumiverse-prompt-drag-handle {\n    cursor: grab;\n    color: var(--lumiverse-text-muted);\n    padding-top: 2px;\n    /* Required for dnd-kit to handle pointer events properly */\n    touch-action: none;\n    user-select: none;\n    -webkit-user-select: none;\n}\n\n.lumiverse-prompt-drag-handle:active {\n    cursor: grabbing;\n}\n\n.lumiverse-prompt-content {\n    flex: 1;\n    min-width: 0;\n}\n\n.lumiverse-prompt-header {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    margin-bottom: 4px;\n}\n\n.lumiverse-prompt-name {\n    font-weight: 500;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-prompt-category-icon {\n    color: var(--lumiverse-primary);\n    display: flex;\n    align-items: center;\n}\n\n.lumiverse-prompt-preview {\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    font-family: var(--lumiverse-font-mono);\n}\n\n.lumiverse-prompt-badges {\n    display: flex;\n    gap: 4px;\n    margin-left: 8px;\n}\n\n.lumiverse-badge {\n    font-size: 10px;\n    padding: 2px 6px;\n    border-radius: 4px;\n    text-transform: uppercase;\n    font-weight: 600;\n}\n\n.lumiverse-badge-system {\n    background: rgba(147, 112, 219, 0.2);\n    color: var(--lumiverse-primary-text);\n}\n\n.lumiverse-badge-user {\n    background: rgba(59, 130, 246, 0.2);\n    color: #60a5fa;\n}\n\n.lumiverse-badge-assistant {\n    background: rgba(16, 185, 129, 0.2);\n    color: #34d399;\n}\n\n.lumiverse-prompt-actions {\n    display: flex;\n    gap: 6px;\n    align-items: center;\n}\n\n.lumiverse-icon-btn {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 28px;\n    height: 28px;\n    padding: 0;\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text-muted);\n    border-radius: 6px;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-icon-btn:hover {\n    background: rgba(255, 255, 255, 0.1);\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-prompt-disabled {\n    opacity: 0.5;\n    background: rgba(0, 0, 0, 0.2);\n}\n\n/* Edit Form Overlay */\n.lumiverse-edit-form {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background: var(--lumiverse-bg);\n    padding: 24px;\n    z-index: 10;\n    display: flex;\n    flex-direction: column;\n    gap: 16px;\n}\n\n.lumiverse-form-group {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumiverse-form-group label {\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-form-group input,\n.lumiverse-form-group select,\n.lumiverse-form-group textarea {\n    padding: 10px;\n    background: var(--lumiverse-bg-elevated);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    color: var(--lumiverse-text);\n    font-family: inherit;\n    font-size: 14px;\n}\n\n.lumiverse-form-group textarea {\n    font-family: var(--lumiverse-font-mono);\n    line-height: 1.5;\n    resize: none;\n    flex: 1;\n}\n\n.lumiverse-form-actions {\n    display: flex;\n    gap: 12px;\n    justify-content: flex-end;\n    margin-top: auto;\n}\n\n/* Select Dropdown */\n.lumiverse-select {\n    padding: 8px 12px;\n    background: var(--lumiverse-bg-elevated);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    color: var(--lumiverse-text);\n    font-size: 13px;\n    font-family: inherit;\n    cursor: pointer;\n    outline: none;\n    transition: all var(--lumiverse-transition);\n}\n\n.lumiverse-select:hover,\n.lumiverse-select:focus {\n    border-color: var(--lumiverse-primary);\n    background: var(--lumiverse-bg-hover);\n}\n\n.lumiverse-select option {\n    background: var(--lumiverse-bg-elevated);\n    color: var(--lumiverse-text);\n}\n\n/* ========================================\n   Preset Editor - Enhanced Button Styles\n   ======================================== */\n\n/* Base .lumiverse-btn inside preset-editor gets default styling */\n.lumiverse-preset-editor .lumiverse-btn {\n    background: rgba(75, 75, 95, 0.6);\n    border: 1px solid rgba(255, 255, 255, 0.12);\n    color: var(--lumiverse-text);\n    backdrop-filter: blur(8px);\n    -webkit-backdrop-filter: blur(8px);\n}\n\n.lumiverse-preset-editor .lumiverse-btn:hover {\n    background: rgba(95, 95, 115, 0.7);\n    border-color: rgba(147, 112, 219, 0.35);\n    transform: translateY(-1px);\n}\n\n/* Primary button in preset editor */\n.lumiverse-preset-editor .lumiverse-btn.lumiverse-btn-primary {\n    background: linear-gradient(\n        135deg,\n        rgba(147, 112, 219, 0.85) 0%,\n        rgba(123, 95, 196, 0.85) 100%\n    );\n    border: 1px solid rgba(147, 112, 219, 0.4);\n    color: #fff;\n    font-weight: 600;\n    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);\n}\n\n.lumiverse-preset-editor .lumiverse-btn.lumiverse-btn-primary:hover {\n    background: linear-gradient(\n        135deg,\n        rgba(167, 132, 239, 0.95) 0%,\n        rgba(143, 115, 216, 0.95) 100%\n    );\n    border-color: rgba(147, 112, 219, 0.6);\n    box-shadow: 0 4px 12px rgba(147, 112, 219, 0.3);\n}\n\n/* Danger button variant */\n.lumiverse-preset-editor .lumiverse-btn-danger,\n.lumiverse-preset-editor .lumiverse-icon-btn.lumiverse-btn-danger {\n    color: rgba(239, 100, 100, 0.9);\n}\n\n.lumiverse-preset-editor .lumiverse-btn-danger:hover,\n.lumiverse-preset-editor .lumiverse-icon-btn.lumiverse-btn-danger:hover {\n    background: rgba(239, 68, 68, 0.2);\n    color: #f87171;\n}\n\n/* Modal header styling */\n.lumiverse-preset-editor .lumiverse-modal-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 16px 20px;\n    border-bottom: 1px solid rgba(255, 255, 255, 0.08);\n    background: linear-gradient(\n        180deg,\n        rgba(45, 45, 65, 0.9) 0%,\n        rgba(35, 35, 50, 0.8) 100%\n    );\n}\n\n.lumiverse-preset-editor .lumiverse-modal-header h3 {\n    margin: 0;\n    font-size: 16px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n}\n\n/* Close button */\n.lumiverse-preset-editor .lumiverse-close-btn {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 32px;\n    height: 32px;\n    padding: 0;\n    background: rgba(255, 255, 255, 0.06);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    border-radius: 8px;\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-preset-editor .lumiverse-close-btn:hover {\n    background: rgba(239, 68, 68, 0.15);\n    border-color: rgba(239, 68, 68, 0.3);\n    color: #f87171;\n}\n\n/* Toolbar enhancements */\n.lumiverse-preset-editor .lumiverse-toolbar {\n    background: linear-gradient(\n        180deg,\n        rgba(35, 35, 50, 0.6) 0%,\n        rgba(30, 30, 45, 0.4) 100%\n    );\n    border-bottom: 1px solid rgba(255, 255, 255, 0.06);\n    padding: 12px 16px;\n}\n\n/* Edit form overlay enhancements */\n.lumiverse-preset-editor .lumiverse-edit-form {\n    background: linear-gradient(\n        180deg,\n        rgba(30, 30, 46, 0.98) 0%,\n        rgba(25, 25, 38, 0.98) 100%\n    );\n    border-radius: 0;\n}\n\n.lumiverse-preset-editor .lumiverse-edit-form h4 {\n    margin: 0 0 16px 0;\n    font-size: 16px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    padding-bottom: 12px;\n    border-bottom: 1px solid rgba(255, 255, 255, 0.08);\n}\n\n/* Form inputs enhanced */\n.lumiverse-preset-editor .lumiverse-form-group input,\n.lumiverse-preset-editor .lumiverse-form-group select,\n.lumiverse-preset-editor .lumiverse-form-group textarea {\n    background: rgba(20, 20, 35, 0.8);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    transition: all 0.2s ease;\n}\n\n.lumiverse-preset-editor .lumiverse-form-group input:focus,\n.lumiverse-preset-editor .lumiverse-form-group select:focus,\n.lumiverse-preset-editor .lumiverse-form-group textarea:focus {\n    outline: none;\n    border-color: rgba(147, 112, 219, 0.5);\n    box-shadow: 0 0 0 3px rgba(147, 112, 219, 0.15);\n}\n\n/* Prompt list container */\n.lumiverse-preset-editor .lumiverse-prompt-list {\n    background: rgba(20, 20, 35, 0.4);\n}\n\n/* Prompt items enhanced */\n.lumiverse-preset-editor .lumiverse-prompt-item {\n    background: rgba(45, 45, 65, 0.5);\n    border: 1px solid rgba(255, 255, 255, 0.08);\n    backdrop-filter: blur(4px);\n    -webkit-backdrop-filter: blur(4px);\n}\n\n.lumiverse-preset-editor .lumiverse-prompt-item:hover {\n    background: rgba(55, 55, 75, 0.6);\n    border-color: rgba(147, 112, 219, 0.25);\n}\n\n/* Dragging state */\n.lumiverse-preset-editor .lumiverse-prompt-item[style*="opacity: 0.5"] {\n    background: rgba(147, 112, 219, 0.15);\n    border-color: rgba(147, 112, 219, 0.4);\n}\n\n/* Icon buttons in prompt actions */\n.lumiverse-preset-editor .lumiverse-prompt-actions .lumiverse-icon-btn {\n    background: rgba(255, 255, 255, 0.04);\n    border: 1px solid transparent;\n}\n\n.lumiverse-preset-editor .lumiverse-prompt-actions .lumiverse-icon-btn:hover {\n    background: rgba(147, 112, 219, 0.2);\n    border-color: rgba(147, 112, 219, 0.3);\n    color: var(--lumiverse-primary-text);\n}\n\n/* Category toggle button */\n.lumiverse-preset-editor .lumiverse-prompt-category .lumiverse-icon-btn {\n    color: var(--lumiverse-primary-text);\n}\n\n/* Empty state */\n.lumiverse-preset-editor .lumiverse-empty-state {\n    color: var(--lumiverse-text-muted);\n    font-style: italic;\n}\n\n/* Drag overlay item */\n.lumiverse-prompt-dragging {\n    display: flex;\n    align-items: flex-start;\n    padding: 10px;\n    background: rgba(147, 112, 219, 0.25);\n    border: 2px solid rgba(147, 112, 219, 0.6);\n    border-radius: var(--lumiverse-radius);\n    gap: 12px;\n    box-shadow: \n        0 8px 32px rgba(0, 0, 0, 0.4),\n        0 0 0 1px rgba(147, 112, 219, 0.3);\n    cursor: grabbing;\n    transform: scale(1.02);\n}\n\n.lumiverse-prompt-dragging .lumiverse-prompt-drag-handle {\n    color: var(--lumiverse-primary-text);\n    cursor: grabbing;\n}\n\n.lumiverse-prompt-dragging .lumiverse-prompt-name {\n    font-weight: 500;\n    color: var(--lumiverse-text);\n}\n\n/* ========================================\n   Toggle State Menu Styles\n   ======================================== */\n\n/* Accent button (when states exist) */\n.lumiverse-preset-editor .lumiverse-btn.lumiverse-btn-accent {\n    background: rgba(147, 112, 219, 0.25);\n    border-color: rgba(147, 112, 219, 0.4);\n    color: var(--lumiverse-primary-text);\n}\n\n.lumiverse-preset-editor .lumiverse-btn.lumiverse-btn-accent:hover {\n    background: rgba(147, 112, 219, 0.35);\n    border-color: rgba(147, 112, 219, 0.6);\n}\n\n/* Toggle states container */\n.lumiverse-toggle-states {\n    position: relative;\n}\n\n/* Toggle state dropdown menu */\n.lumiverse-toggle-state-menu {\n    position: absolute;\n    top: calc(100% + 8px);\n    left: 0;\n    z-index: 100;\n    min-width: 280px;\n    background: linear-gradient(\n        180deg,\n        rgba(35, 35, 52, 0.98) 0%,\n        rgba(28, 28, 42, 0.98) 100%\n    );\n    border: 1px solid rgba(255, 255, 255, 0.12);\n    border-radius: var(--lumiverse-radius);\n    box-shadow: \n        0 8px 32px rgba(0, 0, 0, 0.4),\n        0 0 0 1px rgba(147, 112, 219, 0.1);\n    backdrop-filter: blur(12px);\n    -webkit-backdrop-filter: blur(12px);\n    overflow: hidden;\n}\n\n/* Save section */\n.lumiverse-toggle-state-save {\n    display: flex;\n    gap: 8px;\n    padding: 12px;\n    border-bottom: 1px solid rgba(255, 255, 255, 0.08);\n}\n\n.lumiverse-toggle-state-save input {\n    flex: 1;\n    padding: 8px 12px;\n    background: rgba(20, 20, 35, 0.8);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    border-radius: var(--lumiverse-radius-sm);\n    color: var(--lumiverse-text);\n    font-size: 13px;\n    outline: none;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-toggle-state-save input:focus {\n    border-color: rgba(147, 112, 219, 0.5);\n    box-shadow: 0 0 0 2px rgba(147, 112, 219, 0.15);\n}\n\n.lumiverse-toggle-state-save input::placeholder {\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-toggle-state-save .lumiverse-btn {\n    padding: 8px 12px;\n    min-width: auto;\n}\n\n/* Divider */\n.lumiverse-toggle-state-divider {\n    padding: 8px 12px 6px;\n    font-size: 11px;\n    font-weight: 600;\n    color: var(--lumiverse-text-muted);\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n/* State list */\n.lumiverse-toggle-state-list {\n    max-height: 200px;\n    overflow-y: auto;\n}\n\n/* Individual state item */\n.lumiverse-toggle-state-item {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    gap: 8px;\n    padding: 10px 12px;\n    cursor: pointer;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-toggle-state-item:hover {\n    background: rgba(147, 112, 219, 0.15);\n}\n\n.lumiverse-toggle-state-item span {\n    flex: 1;\n    font-size: 13px;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-toggle-state-item .lumiverse-icon-btn {\n    opacity: 0.5;\n    padding: 4px;\n}\n\n.lumiverse-toggle-state-item:hover .lumiverse-icon-btn {\n    opacity: 1;\n}\n\n/* Empty state */\n.lumiverse-toggle-state-empty {\n    padding: 16px 12px;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n    text-align: center;\n    font-style: italic;\n    line-height: 1.5;\n}\n\n/* Toggle message (success/error feedback) */\n.lumiverse-toggle-message {\n    padding: 6px 12px;\n    font-size: 12px;\n    font-weight: 500;\n    border-radius: var(--lumiverse-radius-sm);\n    animation: fadeIn 0.2s ease;\n}\n\n.lumiverse-toggle-message-success {\n    background: rgba(34, 197, 94, 0.2);\n    color: #4ade80;\n    border: 1px solid rgba(34, 197, 94, 0.3);\n}\n\n.lumiverse-toggle-message-error {\n    background: rgba(239, 68, 68, 0.2);\n    color: #f87171;\n    border: 1px solid rgba(239, 68, 68, 0.3);\n}\n\n@keyframes fadeIn {\n    from { opacity: 0; transform: translateY(-4px); }\n    to { opacity: 1; transform: translateY(0); }\n}\n\n\n/* ----------------------------------------\n   Update Notification System\n   ---------------------------------------- */\n\n/* Update Banner - warm amber/orange with purple accents */\n.lumiverse-update-banner {\n    background: linear-gradient(135deg, rgba(251, 191, 36, 0.15) 0%, rgba(245, 158, 11, 0.2) 50%, rgba(147, 112, 219, 0.1) 100%);\n    border: 1px solid rgba(251, 191, 36, 0.4);\n    border-radius: var(--lumiverse-radius);\n    padding: 12px 16px;\n    margin-bottom: 12px;\n    animation: updateBannerSlideIn 0.3s ease-out;\n}\n\n.lumiverse-update-banner.has-extension-update {\n    border-color: rgba(251, 191, 36, 0.6);\n    box-shadow: 0 0 20px rgba(251, 191, 36, 0.15);\n}\n\n@keyframes updateBannerSlideIn {\n    from {\n        opacity: 0;\n        transform: translateY(-10px);\n    }\n    to {\n        opacity: 1;\n        transform: translateY(0);\n    }\n}\n\n.lumiverse-update-banner-content {\n    display: flex;\n    align-items: flex-start;\n    gap: 12px;\n}\n\n.lumiverse-update-banner-icon {\n    color: #fbbf24;\n    flex-shrink: 0;\n    margin-top: 2px;\n    animation: updatePulse 2s ease-in-out infinite;\n}\n\n@keyframes updatePulse {\n    0%, 100% { opacity: 1; }\n    50% { opacity: 0.6; }\n}\n\n.lumiverse-update-banner-text {\n    flex: 1;\n    min-width: 0;\n}\n\n.lumiverse-update-banner-main {\n    display: flex;\n    flex-wrap: wrap;\n    align-items: center;\n    gap: 8px;\n    font-size: 13px;\n    color: #fcd34d;\n    font-weight: 500;\n}\n\n.lumiverse-update-banner-main strong {\n    color: #fef08a;\n}\n\n.lumiverse-update-banner-link {\n    display: inline-flex;\n    align-items: center;\n    gap: 4px;\n    color: #a78bfa;\n    font-size: 12px;\n    font-weight: 600;\n    text-decoration: none;\n    transition: color 0.2s ease;\n}\n\n.lumiverse-update-banner-link:hover {\n    color: #c4b5fd;\n    text-decoration: underline;\n}\n\n.lumiverse-update-banner-presets {\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n    margin-top: 4px;\n}\n\n.lumiverse-update-banner-dismiss {\n    padding: 4px;\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    border-radius: 4px;\n    transition: all 0.2s ease;\n    flex-shrink: 0;\n}\n\n.lumiverse-update-banner-dismiss:hover {\n    background: rgba(255, 255, 255, 0.1);\n    color: var(--lumiverse-text);\n}\n\n/* Update Dot - small pulsing indicator on toggle button */\n.lumiverse-update-dot {\n    width: 8px;\n    height: 8px;\n    background: #fbbf24;\n    border-radius: 50%;\n    box-shadow: 0 0 8px rgba(251, 191, 36, 0.6);\n    animation: updateDotPulse 1.5s ease-in-out infinite;\n    margin-left: 4px;\n}\n\n@keyframes updateDotPulse {\n    0%, 100% {\n        box-shadow: 0 0 8px rgba(251, 191, 36, 0.6);\n        transform: scale(1);\n    }\n    50% {\n        box-shadow: 0 0 12px rgba(251, 191, 36, 0.9);\n        transform: scale(1.1);\n    }\n}\n\n/* Toggle button with updates - blended purple/amber gradient */\n.lumiverse-panel-toggle--has-updates {\n    background: linear-gradient(135deg, rgba(147, 112, 219, 0.85) 0%, rgba(180, 140, 200, 0.9) 50%, rgba(251, 191, 36, 0.75) 100%);\n    border-color: rgba(251, 191, 36, 0.4);\n    box-shadow: 0 4px 12px rgba(147, 112, 219, 0.3), 0 0 15px rgba(251, 191, 36, 0.25);\n}\n\n.lumiverse-panel-toggle--has-updates:hover {\n    box-shadow: 0 4px 16px rgba(147, 112, 219, 0.5), 0 0 25px rgba(251, 191, 36, 0.4);\n    border-color: rgba(251, 191, 36, 0.6);\n}\n\n/* Accordion Badge - "New!" indicator next to title */\n.lumiverse-accordion-badge {\n    display: inline-flex;\n    align-items: center;\n    padding: 2px 8px;\n    margin-left: 8px;\n    font-size: 10px;\n    font-weight: 700;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    color: #1f2937;\n    background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);\n    border-radius: 10px;\n    box-shadow: 0 2px 6px rgba(251, 191, 36, 0.4);\n    animation: badgeBounce 0.5s ease-out;\n}\n\n@keyframes badgeBounce {\n    0% { transform: scale(0); opacity: 0; }\n    60% { transform: scale(1.2); }\n    100% { transform: scale(1); opacity: 1; }\n}\n\n/* Update indicator for ViewportPanel header area */\n.lumiverse-vp-main .lumiverse-update-banner {\n    margin: 0 0 8px 0;\n    border-radius: var(--lumiverse-radius-sm);\n}\n\n/* Compact version for tight spaces */\n.lumiverse-update-banner--compact {\n    padding: 8px 12px;\n}\n\n.lumiverse-update-banner--compact .lumiverse-update-banner-main {\n    font-size: 12px;\n}\n\n.lumiverse-update-banner--compact .lumiverse-update-banner-icon {\n    display: none;\n}\n\n/* ============================================\n   PRESET BINDINGS PANEL STYLES\n   ============================================ */\n\n/* Status Section */\n.lumiverse-bindings-status {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n    padding: 10px 12px;\n    background: var(--lumiverse-bg-secondary);\n    border-radius: var(--lumiverse-radius-sm);\n    margin-bottom: 10px;\n}\n\n.lumiverse-bindings-context {\n    display: flex;\n    flex-direction: column;\n    gap: 6px;\n}\n\n.lumiverse-bindings-context-item {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-bindings-context-item svg {\n    flex-shrink: 0;\n    opacity: 0.7;\n}\n\n.lumiverse-bindings-context-label {\n    opacity: 0.7;\n}\n\n.lumiverse-bindings-context-value {\n    color: var(--lumiverse-text);\n    font-weight: 500;\n}\n\n.lumiverse-bindings-context-value--mono {\n    font-family: var(--lumiverse-font-mono);\n    font-size: 11px;\n}\n\n.lumiverse-bindings-context-bound {\n    display: inline-flex;\n    align-items: center;\n    gap: 3px;\n    padding: 2px 6px;\n    background: rgba(147, 112, 219, 0.2);\n    color: var(--lumiverse-accent);\n    border-radius: 4px;\n    font-size: 10px;\n    font-weight: 500;\n    margin-left: auto;\n}\n\n.lumiverse-bindings-active {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    padding: 6px 10px;\n    background: rgba(147, 112, 219, 0.15);\n    border: 1px solid rgba(147, 112, 219, 0.3);\n    border-radius: var(--lumiverse-radius-sm);\n    font-size: 12px;\n    color: var(--lumiverse-accent);\n}\n\n.lumiverse-bindings-empty-context {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    padding: 8px 0;\n    color: var(--lumiverse-text-muted);\n    font-size: 12px;\n}\n\n.lumiverse-bindings-empty-context svg {\n    opacity: 0.5;\n}\n\n.lumiverse-bindings-summary {\n    display: flex;\n    align-items: center;\n    margin-bottom: 10px;\n}\n\n.lumiverse-bindings-summary-label {\n    display: flex;\n    align-items: center;\n    gap: 5px;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n}\n\n/* Modal Styles */\n.lumiverse-bindings-modal {\n    width: min(520px, 95vw);\n    max-height: 85vh;\n    display: flex;\n    flex-direction: column;\n}\n\n.lumiverse-bindings-modal-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 16px 20px;\n    border-bottom: 1px solid var(--lumiverse-border);\n    background: linear-gradient(180deg, var(--lumiverse-bg-secondary) 0%, var(--lumiverse-bg) 100%);\n}\n\n.lumiverse-bindings-modal-header-info {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n}\n\n.lumiverse-bindings-modal-header-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 40px;\n    height: 40px;\n    background: linear-gradient(135deg, rgba(147, 112, 219, 0.2) 0%, rgba(147, 112, 219, 0.1) 100%);\n    border-radius: var(--lumiverse-radius);\n    color: var(--lumiverse-accent);\n}\n\n.lumiverse-bindings-modal-header-text {\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n}\n\n.lumiverse-bindings-modal-title {\n    margin: 0;\n    font-size: 16px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-bindings-modal-subtitle {\n    margin: 0;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-bindings-modal-close {\n    padding: 8px;\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    border-radius: var(--lumiverse-radius-sm);\n    transition: all 0.2s ease;\n}\n\n.lumiverse-bindings-modal-close:hover {\n    background: var(--lumiverse-bg-secondary);\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-bindings-modal-content {\n    flex: 1;\n    overflow-y: auto;\n    padding: 16px 20px;\n    display: flex;\n    flex-direction: column;\n    gap: 20px;\n}\n\n.lumiverse-bindings-modal-footer {\n    display: flex;\n    justify-content: flex-end;\n    padding: 12px 20px;\n    border-top: 1px solid var(--lumiverse-border);\n    background: var(--lumiverse-bg-secondary);\n}\n\n.lumiverse-bindings-modal-btn {\n    padding: 8px 20px;\n    border: none;\n    border-radius: var(--lumiverse-radius-sm);\n    font-size: 13px;\n    font-weight: 500;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-bindings-modal-btn--primary {\n    background: var(--lumiverse-accent);\n    color: white;\n}\n\n.lumiverse-bindings-modal-btn--primary:hover {\n    background: var(--lumiverse-accent-hover);\n}\n\n/* Sections */\n.lumiverse-bindings-section {\n    display: flex;\n    flex-direction: column;\n    gap: 12px;\n}\n\n.lumiverse-bindings-section-header {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-bindings-section-header svg {\n    color: var(--lumiverse-accent);\n}\n\n/* Create Binding Form */\n.lumiverse-bindings-create {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n    padding: 12px;\n    background: var(--lumiverse-bg-secondary);\n    border-radius: var(--lumiverse-radius);\n}\n\n.lumiverse-bindings-type-toggle {\n    display: flex;\n    gap: 8px;\n}\n\n.lumiverse-bindings-type-btn {\n    flex: 1;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 6px;\n    padding: 8px 12px;\n    background: var(--lumiverse-bg);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius-sm);\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-bindings-type-btn:hover:not(:disabled) {\n    border-color: var(--lumiverse-border-light);\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-bindings-type-btn.is-active {\n    background: rgba(147, 112, 219, 0.15);\n    border-color: var(--lumiverse-accent);\n    color: var(--lumiverse-accent);\n}\n\n.lumiverse-bindings-type-btn:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n}\n\n.lumiverse-bindings-create-context {\n    display: flex;\n    align-items: center;\n    padding: 8px 10px;\n    background: var(--lumiverse-bg);\n    border-radius: var(--lumiverse-radius-sm);\n    font-size: 12px;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-bindings-create-context span {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n}\n\n.lumiverse-bindings-create-context svg {\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-bindings-create-existing {\n    margin-left: 8px;\n    color: var(--lumiverse-accent);\n    font-size: 11px;\n}\n\n.lumiverse-bindings-create-row {\n    display: flex;\n    gap: 8px;\n}\n\n.lumiverse-bindings-select {\n    flex: 1;\n    padding: 8px 10px;\n    background: var(--lumiverse-bg);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius-sm);\n    font-size: 12px;\n    color: var(--lumiverse-text);\n    cursor: pointer;\n}\n\n.lumiverse-bindings-select:focus {\n    outline: none;\n    border-color: var(--lumiverse-accent);\n}\n\n.lumiverse-bindings-no-presets {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    padding: 8px 10px;\n    background: rgba(234, 179, 8, 0.1);\n    border: 1px solid rgba(234, 179, 8, 0.3);\n    border-radius: var(--lumiverse-radius-sm);\n    font-size: 11px;\n    color: #eab308;\n}\n\n.lumiverse-bindings-no-context {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 8px;\n    padding: 24px;\n    color: var(--lumiverse-text-muted);\n    text-align: center;\n}\n\n.lumiverse-bindings-no-context svg {\n    opacity: 0.5;\n}\n\n/* Bindings List */\n.lumiverse-bindings-list {\n    display: flex;\n    flex-direction: column;\n    gap: 6px;\n}\n\n.lumiverse-bindings-list-item {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 10px 12px;\n    background: var(--lumiverse-bg-secondary);\n    border-radius: var(--lumiverse-radius-sm);\n    transition: all 0.2s ease;\n}\n\n.lumiverse-bindings-list-item:hover {\n    background: var(--lumiverse-bg-hover);\n}\n\n.lumiverse-bindings-list-item-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 28px;\n    height: 28px;\n    background: rgba(147, 112, 219, 0.15);\n    border-radius: var(--lumiverse-radius-sm);\n    color: var(--lumiverse-accent);\n    flex-shrink: 0;\n}\n\n.lumiverse-bindings-list-item-info {\n    flex: 1;\n    min-width: 0;\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n}\n\n.lumiverse-bindings-list-item-name {\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-bindings-list-item-type {\n    font-size: 10px;\n    color: var(--lumiverse-text-muted);\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n.lumiverse-bindings-list-item-preset {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    padding: 4px 8px;\n    background: rgba(147, 112, 219, 0.15);\n    border-radius: var(--lumiverse-radius-sm);\n    font-size: 11px;\n    color: var(--lumiverse-accent);\n    white-space: nowrap;\n}\n\n.lumiverse-bindings-list-item-remove {\n    padding: 6px;\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    border-radius: var(--lumiverse-radius-sm);\n    transition: all 0.2s ease;\n    opacity: 0;\n}\n\n.lumiverse-bindings-list-item:hover .lumiverse-bindings-list-item-remove {\n    opacity: 1;\n}\n\n.lumiverse-bindings-list-item-remove:hover {\n    background: rgba(239, 68, 68, 0.15);\n    color: #ef4444;\n}\n\n/* Empty State */\n.lumiverse-bindings-empty {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 8px;\n    padding: 24px;\n    color: var(--lumiverse-text-muted);\n    text-align: center;\n}\n\n.lumiverse-bindings-empty svg {\n    opacity: 0.5;\n}\n\n.lumiverse-bindings-empty-hint {\n    font-size: 11px;\n    opacity: 0.7;\n}\n\n/* Info Box */\n.lumiverse-bindings-info {\n    padding: 12px;\n    background: rgba(147, 112, 219, 0.08);\n    border: 1px solid rgba(147, 112, 219, 0.2);\n    border-radius: var(--lumiverse-radius);\n}\n\n.lumiverse-bindings-info-title {\n    font-size: 12px;\n    font-weight: 600;\n    color: var(--lumiverse-accent);\n    margin-bottom: 8px;\n}\n\n.lumiverse-bindings-info-list {\n    margin: 0;\n    padding-left: 18px;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n    line-height: 1.6;\n}\n\n.lumiverse-bindings-info-list li {\n    margin-bottom: 4px;\n}\n\n.lumiverse-bindings-info-list strong {\n    color: var(--lumiverse-text);\n}\n\n/* =============================================================================\n   PROFILE BIND BUTTON - Quick bind button in profile header\n   ============================================================================= */\n\n.lumiverse-profile-bind-btn {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 36px;\n    height: 36px;\n    flex-shrink: 0;\n    background: rgba(147, 112, 219, 0.08);\n    border: 1px solid rgba(147, 112, 219, 0.2);\n    border-radius: 10px;\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-profile-bind-btn:hover {\n    background: rgba(147, 112, 219, 0.15);\n    border-color: rgba(147, 112, 219, 0.35);\n    color: var(--lumiverse-primary);\n    transform: scale(1.05);\n}\n\n.lumiverse-profile-bind-btn--active {\n    background: rgba(147, 112, 219, 0.2);\n    border-color: var(--lumiverse-primary);\n    color: var(--lumiverse-primary);\n}\n\n.lumiverse-profile-bind-btn--active:hover {\n    background: rgba(147, 112, 219, 0.3);\n}\n\n/* =============================================================================\n   PROFILE BINDINGS MODAL - Compact modal from profile tab\n   ============================================================================= */\n\n.lumiverse-profile-bindings-backdrop {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n}\n\n.lumiverse-profile-bindings-modal {\n    background: var(--lumiverse-bg);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 14px;\n    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);\n    width: 320px;\n    max-width: 90vw;\n    overflow: hidden;\n    animation: lumiverseProfileModalIn 0.2s ease;\n}\n\n@keyframes lumiverseProfileModalIn {\n    from {\n        opacity: 0;\n        transform: scale(0.95) translateY(-8px);\n    }\n    to {\n        opacity: 1;\n        transform: scale(1) translateY(0);\n    }\n}\n\n/* Header */\n.lumiverse-profile-bindings-header {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 14px 16px;\n    background: rgba(147, 112, 219, 0.08);\n    border-bottom: 1px solid var(--lumiverse-border);\n}\n\n.lumiverse-profile-bindings-header-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 32px;\n    height: 32px;\n    background: rgba(147, 112, 219, 0.15);\n    border-radius: 8px;\n    color: var(--lumiverse-primary);\n    flex-shrink: 0;\n}\n\n.lumiverse-profile-bindings-header-text {\n    flex: 1;\n    min-width: 0;\n}\n\n.lumiverse-profile-bindings-title {\n    display: block;\n    font-size: 14px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-profile-bindings-subtitle {\n    display: block;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n    margin-top: 1px;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-profile-bindings-close {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 28px;\n    height: 28px;\n    background: transparent;\n    border: none;\n    border-radius: 6px;\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    transition: all 0.15s ease;\n    flex-shrink: 0;\n}\n\n.lumiverse-profile-bindings-close:hover {\n    background: rgba(255, 100, 100, 0.15);\n    color: #ff6b6b;\n}\n\n/* Content */\n.lumiverse-profile-bindings-content {\n    padding: 14px 16px 16px;\n    display: flex;\n    flex-direction: column;\n    gap: 14px;\n}\n\n/* Status section */\n.lumiverse-profile-bindings-status {\n    display: flex;\n    flex-direction: column;\n    gap: 6px;\n}\n\n.lumiverse-profile-bindings-status-row {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    padding: 8px 10px;\n    background: rgba(0, 0, 0, 0.15);\n    border-radius: 8px;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-profile-bindings-status-row.is-bound {\n    background: rgba(147, 112, 219, 0.12);\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-profile-bindings-status-row svg:first-child {\n    flex-shrink: 0;\n    opacity: 0.7;\n}\n\n.lumiverse-profile-bindings-status-label {\n    font-weight: 500;\n    flex-shrink: 0;\n}\n\n.lumiverse-profile-bindings-status-value {\n    flex: 1;\n    min-width: 0;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-profile-bindings-status-row.is-bound .lumiverse-profile-bindings-status-value {\n    color: var(--lumiverse-primary);\n    font-weight: 500;\n}\n\n.lumiverse-profile-bindings-status-remove {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 20px;\n    height: 20px;\n    background: transparent;\n    border: none;\n    border-radius: 4px;\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    flex-shrink: 0;\n    opacity: 0.6;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-profile-bindings-status-remove:hover {\n    background: rgba(255, 100, 100, 0.2);\n    color: #ff6b6b;\n    opacity: 1;\n}\n\n/* Create section */\n.lumiverse-profile-bindings-create {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n    padding-top: 10px;\n    border-top: 1px solid var(--lumiverse-border);\n}\n\n.lumiverse-profile-bindings-type-toggle {\n    display: flex;\n    gap: 6px;\n}\n\n.lumiverse-profile-bindings-type-btn {\n    flex: 1;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 6px;\n    padding: 8px 12px;\n    background: rgba(0, 0, 0, 0.1);\n    border: 1px solid transparent;\n    border-radius: 8px;\n    font-size: 12px;\n    font-weight: 500;\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-profile-bindings-type-btn:hover:not(:disabled) {\n    background: rgba(147, 112, 219, 0.1);\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-profile-bindings-type-btn.is-active {\n    background: rgba(147, 112, 219, 0.15);\n    border-color: var(--lumiverse-primary);\n    color: var(--lumiverse-primary);\n}\n\n.lumiverse-profile-bindings-type-btn:disabled {\n    opacity: 0.4;\n    cursor: not-allowed;\n}\n\n.lumiverse-profile-bindings-select-row {\n    display: flex;\n    gap: 8px;\n}\n\n.lumiverse-profile-bindings-select {\n    flex: 1;\n    min-width: 0;\n    padding: 8px 12px;\n    background: rgba(0, 0, 0, 0.2);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 8px;\n    color: var(--lumiverse-text);\n    font-size: 12px;\n    cursor: pointer;\n    transition: border-color 0.15s ease;\n}\n\n.lumiverse-profile-bindings-select:hover {\n    border-color: rgba(147, 112, 219, 0.4);\n}\n\n.lumiverse-profile-bindings-select:focus {\n    outline: none;\n    border-color: var(--lumiverse-primary);\n}\n\n.lumiverse-profile-bindings-bind-btn {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 36px;\n    height: 36px;\n    background: var(--lumiverse-primary);\n    border: none;\n    border-radius: 8px;\n    color: #fff;\n    cursor: pointer;\n    flex-shrink: 0;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-profile-bindings-bind-btn:hover:not(:disabled) {\n    background: var(--lumiverse-primary-hover);\n    transform: scale(1.05);\n}\n\n.lumiverse-profile-bindings-bind-btn:disabled {\n    opacity: 0.4;\n    cursor: not-allowed;\n    transform: none;\n}\n\n/* Empty state */\n.lumiverse-profile-bindings-empty {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 8px;\n    padding: 28px 20px;\n    color: var(--lumiverse-text-muted);\n    text-align: center;\n}\n\n.lumiverse-profile-bindings-empty svg {\n    opacity: 0.4;\n}\n\n/* ============================================\n   RESPONSIVE CARD GRID\n   3 columns on desktop, 2 columns on mobile\n   ============================================ */\n\n.lumiverse-responsive-card-grid {\n    display: grid;\n    grid-template-columns: repeat(3, 1fr);\n    gap: 16px;\n}\n\n@media (max-width: 600px) {\n    .lumiverse-responsive-card-grid {\n        grid-template-columns: repeat(2, 1fr);\n    }\n}\n\n/* Small card grid (for selection modals with square cards) */\n.lumiverse-responsive-small-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));\n    gap: 10px;\n    padding: 12px;\n}\n\n@media (max-width: 480px) {\n    .lumiverse-responsive-small-grid {\n        grid-template-columns: repeat(2, 1fr);\n    }\n}\n`,""]);const h=m},463(e,n){function t(e,n){var t=e.length;e.push(n);e:for(;0<t;){var r=t-1>>>1,i=e[r];if(!(0<a(i,n)))break e;e[r]=n,e[t]=i,t=r}}function r(e){return 0===e.length?null:e[0]}function i(e){if(0===e.length)return null;var n=e[0],t=e.pop();if(t!==n){e[0]=t;e:for(var r=0,i=e.length,o=i>>>1;r<o;){var s=2*(r+1)-1,l=e[s],c=s+1,u=e[c];if(0>a(l,t))c<i&&0>a(u,l)?(e[r]=u,e[c]=t,r=c):(e[r]=l,e[s]=t,r=s);else{if(!(c<i&&0>a(u,t)))break e;e[r]=u,e[c]=t,r=c}}}return n}function a(e,n){var t=e.sortIndex-n.sortIndex;return 0!==t?t:e.id-n.id}if("object"==typeof performance&&"function"==typeof performance.now){var o=performance;n.unstable_now=function(){return o.now()}}else{var s=Date,l=s.now();n.unstable_now=function(){return s.now()-l}}var c=[],u=[],d=1,m=null,p=3,g=!1,v=!1,h=!1,f="function"==typeof setTimeout?setTimeout:null,b="function"==typeof clearTimeout?clearTimeout:null,x="undefined"!=typeof setImmediate?setImmediate:null;function y(e){for(var n=r(u);null!==n;){if(null===n.callback)i(u);else{if(!(n.startTime<=e))break;i(u),n.sortIndex=n.expirationTime,t(c,n)}n=r(u)}}function k(e){if(h=!1,y(e),!v)if(null!==r(c))v=!0,I(w);else{var n=r(u);null!==n&&L(k,n.startTime-e)}}function w(e,t){v=!1,h&&(h=!1,b(N),N=-1),g=!0;var a=p;try{for(y(t),m=r(c);null!==m&&(!(m.expirationTime>t)||e&&!O());){var o=m.callback;if("function"==typeof o){m.callback=null,p=m.priorityLevel;var s=o(m.expirationTime<=t);t=n.unstable_now(),"function"==typeof s?m.callback=s:m===r(c)&&i(c),y(t)}else i(c);m=r(c)}if(null!==m)var l=!0;else{var d=r(u);null!==d&&L(k,d.startTime-t),l=!1}return l}finally{m=null,p=a,g=!1}}"undefined"!=typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var j,S=!1,C=null,N=-1,P=5,E=-1;function O(){return!(n.unstable_now()-E<P)}function M(){if(null!==C){var e=n.unstable_now();E=e;var t=!0;try{t=C(!0,e)}finally{t?j():(S=!1,C=null)}}else S=!1}if("function"==typeof x)j=function(){x(M)};else if("undefined"!=typeof MessageChannel){var z=new MessageChannel,T=z.port2;z.port1.onmessage=M,j=function(){T.postMessage(null)}}else j=function(){f(M,0)};function I(e){C=e,S||(S=!0,j())}function L(e,t){N=f(function(){e(n.unstable_now())},t)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(e){e.callback=null},n.unstable_continueExecution=function(){v||g||(v=!0,I(w))},n.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):P=0<e?Math.floor(1e3/e):5},n.unstable_getCurrentPriorityLevel=function(){return p},n.unstable_getFirstCallbackNode=function(){return r(c)},n.unstable_next=function(e){switch(p){case 1:case 2:case 3:var n=3;break;default:n=p}var t=p;p=n;try{return e()}finally{p=t}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(e,n){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var t=p;p=e;try{return n()}finally{p=t}},n.unstable_scheduleCallback=function(e,i,a){var o=n.unstable_now();switch("object"==typeof a&&null!==a?a="number"==typeof(a=a.delay)&&0<a?o+a:o:a=o,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:d++,callback:i,priorityLevel:e,startTime:a,expirationTime:s=a+s,sortIndex:-1},a>o?(e.sortIndex=a,t(u,e),null===r(c)&&e===r(u)&&(h?(b(N),N=-1):h=!0,L(k,a-o))):(e.sortIndex=s,t(c,e),v||g||(v=!0,I(w))),e},n.unstable_shouldYield=O,n.unstable_wrapCallback=function(e){var n=p;return function(){var t=p;p=n;try{return e.apply(this,arguments)}finally{p=t}}}},485(e,n,t){t.d(n,{E:()=>p,Iv:()=>h,Zq:()=>y,__:()=>f,dj:()=>u,tb:()=>k,x$:()=>v});var r=t(92),i=t(674),a=t(100);const o="loom_last_summarized_at";let s=null,l=null,c=!1;function u(){return c}function d(e){g();const n=document.getElementById("chat");if(!n)return;const t=n.querySelector(".mes:last-child");if(!t)return;const r=t.querySelector(".timestamp");if(!r)return;l=t;const i=document.createElement("span");i.className="loom-summary-indicator",i.id="loom-summary-indicator","loading"===e?(i.innerHTML='<span class="loom-summary-spinner"></span><span>Weaving summary...</span>',r.appendChild(i),s=i):"complete"===e?m(t,"complete"):"error"===e&&m(t,"error")}function m(e,n){if(!e)return;const t=e.querySelector(".timestamp");if(!t)return;const i=t.querySelector(".loom-summary-marker");i&&i.remove();const a=document.createElement("span");a.className="loom-summary-marker",a.setAttribute("data-summary-type",n),"complete"===n?(a.classList.add("loom-summary-marker-complete"),a.innerHTML='<svg class="loom-summary-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <ellipse cx="12" cy="12" rx="8" ry="10" stroke="currentColor" stroke-width="1.5" fill="none"/>\n  <ellipse cx="12" cy="12" rx="3" ry="10" stroke="currentColor" stroke-width="1.5" fill="none"/>\n  <line x1="4" y1="8" x2="20" y2="8" stroke="currentColor" stroke-width="1.5"/>\n  <line x1="4" y1="16" x2="20" y2="16" stroke="currentColor" stroke-width="1.5"/>\n  <circle cx="12" cy="12" r="2" fill="currentColor"/>\n</svg>',a.title="Summary woven up to this message"):"error"===n&&(a.classList.add("loom-summary-marker-error"),a.innerHTML='<svg class="loom-summary-icon loom-summary-icon-error" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="1.5" fill="none"/>\n  <path d="M15 9L9 15M9 9L15 15" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>\n</svg>',a.title="Summary generation failed at this message"),t.appendChild(a);const o=function(e){return(null==e?void 0:e.getAttribute("mesid"))||null}(e);o&&function(e,n){var t;const i=(0,r.SD)();if(null==i||!i.chatMetadata)return;i.chatMetadata.loom_summary_marker={mesId:e,type:n,timestamp:Date.now()},null===(t=i.saveMetadata)||void 0===t||t.call(i)}(o,n)}function p(){var e;const n=(0,r.SD)();if(null==n||null===(e=n.chatMetadata)||void 0===e||!e.loom_summary_marker)return;const t=n.chatMetadata.loom_summary_marker;if(!t.mesId)return;const i=(a=t.mesId)?document.querySelector('.mes[mesid="'.concat(a,'"]')):null;var a;i&&m(i,t.type)}function g(){s&&(s.remove(),s=null);const e=document.getElementById("loom-summary-indicator");e&&e.remove()}const v={openai:{name:"OpenAI",endpoint:"https://api.openai.com/v1/chat/completions",secretKey:"api_key_openai",placeholder:"gpt-4o-mini",format:"openai"},anthropic:{name:"Anthropic Claude",endpoint:"https://api.anthropic.com/v1/messages",secretKey:"api_key_claude",placeholder:"claude-sonnet-4-5-20250929",format:"anthropic"},openrouter:{name:"OpenRouter",endpoint:"https://openrouter.ai/api/v1/chat/completions",secretKey:"api_key_openrouter",placeholder:"openai/gpt-4o-mini",format:"openai"},google:{name:"Google AI Studio",endpoint:"https://generativelanguage.googleapis.com/v1beta/models",secretKey:"api_key_makersuite",placeholder:"gemini-2.0-flash",format:"google"},chutes:{name:"Chutes",endpoint:"https://llm.chutes.ai/v1/chat/completions",secretKey:"api_key_chutes",placeholder:"deepseek-ai/DeepSeek-V3",format:"openai"},electronhub:{name:"ElectronHub",endpoint:"https://api.electronhub.ai/v1/chat/completions",secretKey:"api_key_electronhub",placeholder:"gpt-4o-mini",format:"openai"},nanogpt:{name:"NanoGPT",endpoint:"https://nano-gpt.com/api/v1/chat/completions",secretKey:"api_key_nanogpt",placeholder:"chatgpt-4o-latest",format:"openai"},zai:{name:"Z.AI",endpoint:"https://api.z.ai/api/paas/v4/chat/completions",secretKey:"api_key_zai",placeholder:"gpt-4o-mini",format:"openai"},custom:{name:"Custom (OpenAI Compatible)",endpoint:"",secretKey:null,placeholder:"your-model-id",format:"openai"}};function h(e){return v[e]||v.custom}function f(e){const n=h(e);return{endpoint:n.endpoint,placeholder:n.placeholder}}function b(e){var n;const t=(0,r.SD)();if(!t||!t.chat)return null;const o=t.chat.slice(-e);if(0===o.length)return null;const s=(null===(n=t.chatMetadata)||void 0===n?void 0:n[i.zA])||"",l=(0,a.J3)(),c=(0,a.K$)(),u=(0,a.N4)(),d=c?(0,a.U3)():[];let m;if(c){const e=d.length>0?d.join(", "):"group members";m="Track evolving dynamics between characters (".concat(e,") and between characters and ").concat(l,". Trust, tension, affection, rivalry. (NEVER track ").concat(l,"'s internal state—only how characters perceive or relate to them.)")}else m="Track evolving dynamics between ".concat(u," and ").concat(l,", as well as any NPCs. Trust, tension, affection, rivalry. (NEVER track ").concat(l,"'s internal state—only how characters perceive or relate to them.)");let p="";o.forEach(e=>{const n=e.is_user?e.name||"User":e.name||"Character";let t=e.mes||e.content||"";t=t.replace(/<loom_sum>[\s\S]*?<\/loom_sum>/gi,"").trim(),t&&(p+="".concat(n,": ").concat(t,"\n\n"))});return{systemPrompt:"You are a Lucid Loom narrative archivist for interactive fiction and roleplay. Your task is to weave comprehensive story summaries that maintain narrative continuity while capturing the essence of the tale.\n\nYour summary MUST use this exact structured format with clear headers:\n\n**Completed Objectives** (MAX 7 items)\nStory beats and arcs that have already concluded. Plot points resolved, conflicts addressed, milestones reached.\n\n**Focused Objectives** (MAX 5 items)\nActive story threads requiring attention. These can shift or be deviated from at any time but represent current narrative focus.\n\n**Foreshadowing Beats** (MAX 5 items)\nEvents hinted at or seeded in recent story beats. Potential future complications, promises made, warnings given.\n\n**Character Developments** (MAX 7 items total)\nTrack meaningful changes in personality, beliefs, skills, or emotional state for each character (NEVER ".concat(l,").\n\n**Memorable Actions** (MAX 7 items)\nPhysical actions of significance—combat moves, gestures, gifts exchanged, locations visited. Details that may matter later.\n\n**Memorable Dialogues** (MAX 5 items)\nWords that left a mark. Confessions, promises, threats, revelations, or simply beautiful turns of phrase.\n\n**Relationships** (MAX 5 items)\n").concat(m,'\n\nCRITICAL GUIDELINES:\n- Use bullet points under each header for clarity—avoid walls of text\n- Be precise and detailed, never sacrifice important information\n- Be concise, never pad with redundant or obvious observations\n- If a category has no relevant content, write "None at present" rather than inventing filler\n- NEVER track or summarize ').concat(l,"'s thoughts, feelings, or internal state\n- RESPECT ITEM LIMITS: Each category has a maximum item count. When at capacity, remove the oldest or least relevant item to make room for new ones\n- PRESERVE IMPORTANT HISTORY: When removing items, prioritize keeping entries that have ongoing narrative relevance (active plot threads, unresolved tensions, recurring themes)\n- CONSOLIDATE when possible: Combine related items into single, more comprehensive bullet points rather than having many fragmented entries"),userPrompt:"".concat(s?"**PREVIOUS LOOM SUMMARY** (use this as your foundation—do NOT discard important information):\n".concat(s,"\n\n---\n\n**MERGE INSTRUCTIONS:**\n- Start with ALL existing entries from the previous summary\n- Add new developments from the recent events below\n- When a category exceeds its item limit, consolidate related items or remove the least narratively relevant\n- NEVER silently drop items that still have ongoing relevance (active conflicts, unresolved threads, important relationships)\n- If an item from the previous summary is still relevant but needs updating, modify it rather than removing it\n\n---\n\n"):"","**RECENT STORY EVENTS** to weave into the summary:\n\n").concat(p,"\n\nProvide an updated Loom Summary incorporating these new events. Use the exact structured format with all seven headers. Output ONLY the summary content—no meta-commentary or additional formatting.")}}async function x(e,n){const t=e.secondary||{},a=t.provider||"openai",o=t.model,s=t.temperature||.7,l=void 0!==t.topP?t.topP:1,c=t.maxTokens||8192;if(!o)throw new Error("No model specified for secondary LLM");const u=h(a);let d;if("custom"===a){if(d=t.apiKey,!d)throw new Error("No API key specified for custom provider")}else if(d=await async function(e){if(!e)return null;try{const n=await fetch("/api/secrets/find",{method:"POST",headers:(0,r.oO)(),body:JSON.stringify({key:e})});return n.ok?(await n.json()).value||null:(console.warn("[".concat(i.pW,"] Could not fetch secret key: ").concat(e," (status: ").concat(n.status,")")),null)}catch(e){return console.error("[".concat(i.pW,"] Error fetching secret key:"),e),null}}(u.secretKey),!d)throw new Error("No API key found for ".concat(u.name,". Please add your API key in SillyTavern's API settings."));const m=b(n);if(!m)throw new Error("No chat messages to summarize");const p="custom"===a?t.endpoint:u.endpoint;if(!p)throw new Error("No endpoint specified for secondary LLM");let g;if(console.log("[".concat(i.pW,"] Generating summary with ").concat(u.name,"...")),"anthropic"===u.format){const e=(0,i.mt)(),n=(0,i.X7)(),t={model:o,max_tokens:c,system:e.disableAnthropicCache?[{type:"text",text:m.systemPrompt,cache_control:{type:"ephemeral"}}]:m.systemPrompt,messages:[{role:"user",content:m.userPrompt}],temperature:s,metadata:{lumia_config_version:String(n)}};l>0&&l<1&&(t.top_p=l);const r={"Content-Type":"application/json","x-api-key":d,"anthropic-version":"2023-06-01"};if(e.disableAnthropicCache&&(r["anthropic-beta"]="prompt-caching-2024-07-31",console.log("[".concat(i.pW,"] Cache busting enabled for this request (Lumia config v").concat(n,")"))),g=await fetch(p,{method:"POST",headers:r,body:JSON.stringify(t)}),!g.ok){const e=await g.text().catch(()=>"Unable to read error");throw new Error("Anthropic API error: ".concat(g.status," - ").concat(e))}const a=await g.json();if(a.content&&Array.isArray(a.content)){const e=a.content.find(e=>"text"===e.type);return(null==e?void 0:e.text)||""}return""}if("google"===u.format){var v;const e="".concat(p,"/").concat(o,":generateContent"),n={safetySettings:[{category:"HARM_CATEGORY_HARASSMENT",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_HATE_SPEECH",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_SEXUALLY_EXPLICIT",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_DANGEROUS_CONTENT",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_CIVIC_INTEGRITY",threshold:"BLOCK_NONE"}],contents:[{role:"user",parts:[{text:"".concat(m.systemPrompt,"\n\n---\n\n").concat(m.userPrompt)}]}],generationConfig:{temperature:s,maxOutputTokens:c}};if(l>0&&l<1&&(n.generationConfig.topP=l),g=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json","x-goog-api-key":d},body:JSON.stringify(n)}),!g.ok){const e=await g.text().catch(()=>"Unable to read error");throw new Error("Google AI Studio API error: ".concat(g.status," - ").concat(e))}const t=await g.json();return null!==(v=t.candidates)&&void 0!==v&&null!==(v=v[0])&&void 0!==v&&null!==(v=v.content)&&void 0!==v&&null!==(v=v.parts)&&void 0!==v&&null!==(v=v[0])&&void 0!==v&&v.text?t.candidates[0].content.parts[0].text:""}{var f;const e={"Content-Type":"application/json",Authorization:"Bearer ".concat(d)};"openrouter"===a&&(e["HTTP-Referer"]=window.location.origin,e["X-Title"]="Lumia Injector");const n={model:o,messages:[{role:"system",content:m.systemPrompt},{role:"user",content:m.userPrompt}],temperature:s,max_tokens:c};if(l>0&&l<1&&(n.top_p=l),g=await fetch(p,{method:"POST",headers:e,body:JSON.stringify(n)}),!g.ok){const e=await g.text().catch(()=>"Unable to read error");throw new Error("".concat(u.name," API error: ").concat(g.status," - ").concat(e))}const t=await g.json();return null!==(f=t.choices)&&void 0!==f&&null!==(f=f[0])&&void 0!==f&&null!==(f=f.message)&&void 0!==f&&f.content?t.choices[0].message.content:""}}async function y(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const a=(0,i.mt)(),s=e||a.summarization;if(!s)return console.log("[".concat(i.pW,"] Summarization not configured")),null;const l=(0,r.SD)();if(!l||!l.chat||0===l.chat.length)return console.log("[".concat(i.pW,"] No chat to summarize")),null;const c=n?s.manualMessageContext||10:s.autoMessageContext||10;console.log("[".concat(i.pW,"] Using ").concat(n?"manual":"auto"," message context: ").concat(c," messages")),t&&d("loading");try{let e;if("main"===s.apiSource)e=await async function(e,n){const{generateRaw:t}=(0,r.SD)();if(!t)throw new Error("generateRaw not available - is SillyTavern properly loaded?");const a=b(n);if(!a)throw new Error("No chat messages to summarize");return console.log("[".concat(i.pW,"] Generating summary with Main API...")),await t({systemPrompt:a.systemPrompt,prompt:a.userPrompt,prefill:""})}(0,c);else{if("secondary"!==s.apiSource)throw t&&d("error","Invalid API source"),new Error("Unknown API source: ".concat(s.apiSource));e=await x(s,c)}return e&&e.trim()?(l.chatMetadata[i.zA]=e.trim(),function(e){const n=(0,r.SD)();null!=n&&n.chatMetadata&&(n.chatMetadata[o]={messageCount:e,timestamp:Date.now()})}(l.chat.length),await l.saveMetadata(),console.log("[".concat(i.pW,"] Summary saved to chat metadata at message ").concat(l.chat.length)),t&&d("complete"),e.trim()):(t&&g(),null)}catch(e){throw console.error("[".concat(i.pW,"] Summary generation failed:"),e),t&&d("error"),e}}function k(){if(c)return;const e=(0,i.mt)().summarization;if(!e||"auto"!==e.mode)return;const n=(0,r.SD)();if(!n||!n.chat)return;const a=e.autoInterval||10,s=n.chat.length,l=function(){var e;const n=(0,r.SD)();return null!=n&&null!==(e=n.chatMetadata)&&void 0!==e&&e[o]&&n.chatMetadata[o].messageCount||0}(),u=s-l;s>=a&&u>=a&&(console.log("[".concat(i.pW,"] Auto-summarization triggered: ").concat(u," messages since last summary (at ").concat(l,"), current count: ").concat(s)),c=!0,Promise.resolve().then(t.bind(t,932)).then(e=>{let{updateLoomSummaryButtonState:n}=e;n()}).catch(()=>{}),y(null,!1,!0).then(e=>{c=!1,Promise.resolve().then(t.bind(t,932)).then(e=>{let{updateLoomSummaryButtonState:n}=e;n()}).catch(()=>{}),e&&toastr.info("Loom summary updated automatically")}).catch(e=>{c=!1,Promise.resolve().then(t.bind(t,932)).then(e=>{let{updateLoomSummaryButtonState:n}=e;n()}).catch(()=>{}),console.error("[".concat(i.pW,"] Auto-summarization failed:"),e)}))}},540(e,n,t){e.exports=t(287)},551(e,n,t){var r=t(540),i=t(982);function a(e){for(var n="https://reactjs.org/docs/error-decoder.html?invariant="+e,t=1;t<arguments.length;t++)n+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+e+"; visit "+n+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,s={};function l(e,n){c(e,n),c(e+"Capture",n)}function c(e,n){for(s[e]=n,e=0;e<n.length;e++)o.add(n[e])}var u=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),d=Object.prototype.hasOwnProperty,m=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},g={};function v(e,n,t,r,i,a,o){this.acceptsBooleans=2===n||3===n||4===n,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=t,this.propertyName=e,this.type=n,this.sanitizeURL=a,this.removeEmptyString=o}var h={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){h[e]=new v(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var n=e[0];h[n]=new v(n,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){h[e]=new v(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){h[e]=new v(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){h[e]=new v(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){h[e]=new v(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){h[e]=new v(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){h[e]=new v(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){h[e]=new v(e,5,!1,e.toLowerCase(),null,!1,!1)});var f=/[\-:]([a-z])/g;function b(e){return e[1].toUpperCase()}function x(e,n,t,r){var i=h.hasOwnProperty(n)?h[n]:null;(null!==i?0!==i.type:r||!(2<n.length)||"o"!==n[0]&&"O"!==n[0]||"n"!==n[1]&&"N"!==n[1])&&(function(e,n,t,r){if(null==n||function(e,n,t,r){if(null!==t&&0===t.type)return!1;switch(typeof n){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==t?!t.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,n,t,r))return!0;if(r)return!1;if(null!==t)switch(t.type){case 3:return!n;case 4:return!1===n;case 5:return isNaN(n);case 6:return isNaN(n)||1>n}return!1}(n,t,i,r)&&(t=null),r||null===i?function(e){return!!d.call(g,e)||!d.call(p,e)&&(m.test(e)?g[e]=!0:(p[e]=!0,!1))}(n)&&(null===t?e.removeAttribute(n):e.setAttribute(n,""+t)):i.mustUseProperty?e[i.propertyName]=null===t?3!==i.type&&"":t:(n=i.attributeName,r=i.attributeNamespace,null===t?e.removeAttribute(n):(t=3===(i=i.type)||4===i&&!0===t?"":""+t,r?e.setAttributeNS(r,n,t):e.setAttribute(n,t))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var n=e.replace(f,b);h[n]=new v(n,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var n=e.replace(f,b);h[n]=new v(n,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var n=e.replace(f,b);h[n]=new v(n,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){h[e]=new v(e,1,!1,e.toLowerCase(),null,!1,!1)}),h.xlinkHref=new v("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){h[e]=new v(e,1,!1,e.toLowerCase(),null,!0,!0)});var y=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,k=Symbol.for("react.element"),w=Symbol.for("react.portal"),j=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),C=Symbol.for("react.profiler"),N=Symbol.for("react.provider"),P=Symbol.for("react.context"),E=Symbol.for("react.forward_ref"),O=Symbol.for("react.suspense"),M=Symbol.for("react.suspense_list"),z=Symbol.for("react.memo"),T=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var I=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var L=Symbol.iterator;function D(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=L&&e[L]||e["@@iterator"])?e:null}var A,R=Object.assign;function B(e){if(void 0===A)try{throw Error()}catch(e){var n=e.stack.trim().match(/\n( *(at )?)/);A=n&&n[1]||""}return"\n"+A+e}var _=!1;function U(e,n){if(!e||_)return"";_=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(n)if(n=function(){throw Error()},Object.defineProperty(n.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(n,[])}catch(e){var r=e}Reflect.construct(e,[],n)}else{try{n.call()}catch(e){r=e}e.call(n.prototype)}else{try{throw Error()}catch(e){r=e}e()}}catch(n){if(n&&r&&"string"==typeof n.stack){for(var i=n.stack.split("\n"),a=r.stack.split("\n"),o=i.length-1,s=a.length-1;1<=o&&0<=s&&i[o]!==a[s];)s--;for(;1<=o&&0<=s;o--,s--)if(i[o]!==a[s]){if(1!==o||1!==s)do{if(o--,0>--s||i[o]!==a[s]){var l="\n"+i[o].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=o&&0<=s);break}}}finally{_=!1,Error.prepareStackTrace=t}return(e=e?e.displayName||e.name:"")?B(e):""}function F(e){switch(e.tag){case 5:return B(e.type);case 16:return B("Lazy");case 13:return B("Suspense");case 19:return B("SuspenseList");case 0:case 2:case 15:return e=U(e.type,!1);case 11:return e=U(e.type.render,!1);case 1:return e=U(e.type,!0);default:return""}}function W(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case j:return"Fragment";case w:return"Portal";case C:return"Profiler";case S:return"StrictMode";case O:return"Suspense";case M:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case P:return(e.displayName||"Context")+".Consumer";case N:return(e._context.displayName||"Context")+".Provider";case E:var n=e.render;return(e=e.displayName)||(e=""!==(e=n.displayName||n.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case z:return null!==(n=e.displayName||null)?n:W(e.type)||"Memo";case T:n=e._payload,e=e._init;try{return W(e(n))}catch(e){}}return null}function H(e){var n=e.type;switch(e.tag){case 24:return"Cache";case 9:return(n.displayName||"Context")+".Consumer";case 10:return(n._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=n.render).displayName||e.name||"",n.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return n;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return W(n);case 8:return n===S?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"==typeof n)return n.displayName||n.name||null;if("string"==typeof n)return n}return null}function V(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function q(e){var n=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===n||"radio"===n)}function $(e){e._valueTracker||(e._valueTracker=function(e){var n=q(e)?"checked":"value",t=Object.getOwnPropertyDescriptor(e.constructor.prototype,n),r=""+e[n];if(!e.hasOwnProperty(n)&&void 0!==t&&"function"==typeof t.get&&"function"==typeof t.set){var i=t.get,a=t.set;return Object.defineProperty(e,n,{configurable:!0,get:function(){return i.call(this)},set:function(e){r=""+e,a.call(this,e)}}),Object.defineProperty(e,n,{enumerable:t.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[n]}}}}(e))}function Y(e){if(!e)return!1;var n=e._valueTracker;if(!n)return!0;var t=n.getValue(),r="";return e&&(r=q(e)?e.checked?"true":"false":e.value),(e=r)!==t&&(n.setValue(e),!0)}function K(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(n){return e.body}}function Q(e,n){var t=n.checked;return R({},n,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=t?t:e._wrapperState.initialChecked})}function G(e,n){var t=null==n.defaultValue?"":n.defaultValue,r=null!=n.checked?n.checked:n.defaultChecked;t=V(null!=n.value?n.value:t),e._wrapperState={initialChecked:r,initialValue:t,controlled:"checkbox"===n.type||"radio"===n.type?null!=n.checked:null!=n.value}}function X(e,n){null!=(n=n.checked)&&x(e,"checked",n,!1)}function Z(e,n){X(e,n);var t=V(n.value),r=n.type;if(null!=t)"number"===r?(0===t&&""===e.value||e.value!=t)&&(e.value=""+t):e.value!==""+t&&(e.value=""+t);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");n.hasOwnProperty("value")?ee(e,n.type,t):n.hasOwnProperty("defaultValue")&&ee(e,n.type,V(n.defaultValue)),null==n.checked&&null!=n.defaultChecked&&(e.defaultChecked=!!n.defaultChecked)}function J(e,n,t){if(n.hasOwnProperty("value")||n.hasOwnProperty("defaultValue")){var r=n.type;if(!("submit"!==r&&"reset"!==r||void 0!==n.value&&null!==n.value))return;n=""+e._wrapperState.initialValue,t||n===e.value||(e.value=n),e.defaultValue=n}""!==(t=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==t&&(e.name=t)}function ee(e,n,t){"number"===n&&K(e.ownerDocument)===e||(null==t?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+t&&(e.defaultValue=""+t))}var ne=Array.isArray;function te(e,n,t,r){if(e=e.options,n){n={};for(var i=0;i<t.length;i++)n["$"+t[i]]=!0;for(t=0;t<e.length;t++)i=n.hasOwnProperty("$"+e[t].value),e[t].selected!==i&&(e[t].selected=i),i&&r&&(e[t].defaultSelected=!0)}else{for(t=""+V(t),n=null,i=0;i<e.length;i++){if(e[i].value===t)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0));null!==n||e[i].disabled||(n=e[i])}null!==n&&(n.selected=!0)}}function re(e,n){if(null!=n.dangerouslySetInnerHTML)throw Error(a(91));return R({},n,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ie(e,n){var t=n.value;if(null==t){if(t=n.children,n=n.defaultValue,null!=t){if(null!=n)throw Error(a(92));if(ne(t)){if(1<t.length)throw Error(a(93));t=t[0]}n=t}null==n&&(n=""),t=n}e._wrapperState={initialValue:V(t)}}function ae(e,n){var t=V(n.value),r=V(n.defaultValue);null!=t&&((t=""+t)!==e.value&&(e.value=t),null==n.defaultValue&&e.defaultValue!==t&&(e.defaultValue=t)),null!=r&&(e.defaultValue=""+r)}function oe(e){var n=e.textContent;n===e._wrapperState.initialValue&&""!==n&&null!==n&&(e.value=n)}function se(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function le(e,n){return null==e||"http://www.w3.org/1999/xhtml"===e?se(n):"http://www.w3.org/2000/svg"===e&&"foreignObject"===n?"http://www.w3.org/1999/xhtml":e}var ce,ue,de=(ue=function(e,n){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=n;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+n.valueOf().toString()+"</svg>",n=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;n.firstChild;)e.appendChild(n.firstChild)}},"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,n,t,r){MSApp.execUnsafeLocalFunction(function(){return ue(e,n)})}:ue);function me(e,n){if(n){var t=e.firstChild;if(t&&t===e.lastChild&&3===t.nodeType)return void(t.nodeValue=n)}e.textContent=n}var pe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ge=["Webkit","ms","Moz","O"];function ve(e,n,t){return null==n||"boolean"==typeof n||""===n?"":t||"number"!=typeof n||0===n||pe.hasOwnProperty(e)&&pe[e]?(""+n).trim():n+"px"}function he(e,n){for(var t in e=e.style,n)if(n.hasOwnProperty(t)){var r=0===t.indexOf("--"),i=ve(t,n[t],r);"float"===t&&(t="cssFloat"),r?e.setProperty(t,i):e[t]=i}}Object.keys(pe).forEach(function(e){ge.forEach(function(n){n=n+e.charAt(0).toUpperCase()+e.substring(1),pe[n]=pe[e]})});var fe=R({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function be(e,n){if(n){if(fe[e]&&(null!=n.children||null!=n.dangerouslySetInnerHTML))throw Error(a(137,e));if(null!=n.dangerouslySetInnerHTML){if(null!=n.children)throw Error(a(60));if("object"!=typeof n.dangerouslySetInnerHTML||!("__html"in n.dangerouslySetInnerHTML))throw Error(a(61))}if(null!=n.style&&"object"!=typeof n.style)throw Error(a(62))}}function xe(e,n){if(-1===e.indexOf("-"))return"string"==typeof n.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ye=null;function ke(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var we=null,je=null,Se=null;function Ce(e){if(e=xi(e)){if("function"!=typeof we)throw Error(a(280));var n=e.stateNode;n&&(n=ki(n),we(e.stateNode,e.type,n))}}function Ne(e){je?Se?Se.push(e):Se=[e]:je=e}function Pe(){if(je){var e=je,n=Se;if(Se=je=null,Ce(e),n)for(e=0;e<n.length;e++)Ce(n[e])}}function Ee(e,n){return e(n)}function Oe(){}var Me=!1;function ze(e,n,t){if(Me)return e(n,t);Me=!0;try{return Ee(e,n,t)}finally{Me=!1,(null!==je||null!==Se)&&(Oe(),Pe())}}function Te(e,n){var t=e.stateNode;if(null===t)return null;var r=ki(t);if(null===r)return null;t=r[n];e:switch(n){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(t&&"function"!=typeof t)throw Error(a(231,n,typeof t));return t}var Ie=!1;if(u)try{var Le={};Object.defineProperty(Le,"passive",{get:function(){Ie=!0}}),window.addEventListener("test",Le,Le),window.removeEventListener("test",Le,Le)}catch(ue){Ie=!1}function De(e,n,t,r,i,a,o,s,l){var c=Array.prototype.slice.call(arguments,3);try{n.apply(t,c)}catch(e){this.onError(e)}}var Ae=!1,Re=null,Be=!1,_e=null,Ue={onError:function(e){Ae=!0,Re=e}};function Fe(e,n,t,r,i,a,o,s,l){Ae=!1,Re=null,De.apply(Ue,arguments)}function We(e){var n=e,t=e;if(e.alternate)for(;n.return;)n=n.return;else{e=n;do{!!(4098&(n=e).flags)&&(t=n.return),e=n.return}while(e)}return 3===n.tag?t:null}function He(e){if(13===e.tag){var n=e.memoizedState;if(null===n&&(null!==(e=e.alternate)&&(n=e.memoizedState)),null!==n)return n.dehydrated}return null}function Ve(e){if(We(e)!==e)throw Error(a(188))}function qe(e){return null!==(e=function(e){var n=e.alternate;if(!n){if(null===(n=We(e)))throw Error(a(188));return n!==e?null:e}for(var t=e,r=n;;){var i=t.return;if(null===i)break;var o=i.alternate;if(null===o){if(null!==(r=i.return)){t=r;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===t)return Ve(i),e;if(o===r)return Ve(i),n;o=o.sibling}throw Error(a(188))}if(t.return!==r.return)t=i,r=o;else{for(var s=!1,l=i.child;l;){if(l===t){s=!0,t=i,r=o;break}if(l===r){s=!0,r=i,t=o;break}l=l.sibling}if(!s){for(l=o.child;l;){if(l===t){s=!0,t=o,r=i;break}if(l===r){s=!0,r=o,t=i;break}l=l.sibling}if(!s)throw Error(a(189))}}if(t.alternate!==r)throw Error(a(190))}if(3!==t.tag)throw Error(a(188));return t.stateNode.current===t?e:n}(e))?$e(e):null}function $e(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var n=$e(e);if(null!==n)return n;e=e.sibling}return null}var Ye=i.unstable_scheduleCallback,Ke=i.unstable_cancelCallback,Qe=i.unstable_shouldYield,Ge=i.unstable_requestPaint,Xe=i.unstable_now,Ze=i.unstable_getCurrentPriorityLevel,Je=i.unstable_ImmediatePriority,en=i.unstable_UserBlockingPriority,nn=i.unstable_NormalPriority,tn=i.unstable_LowPriority,rn=i.unstable_IdlePriority,an=null,on=null;var sn=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(ln(e)/cn|0)|0},ln=Math.log,cn=Math.LN2;var un=64,dn=4194304;function mn(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function pn(e,n){var t=e.pendingLanes;if(0===t)return 0;var r=0,i=e.suspendedLanes,a=e.pingedLanes,o=268435455&t;if(0!==o){var s=o&~i;0!==s?r=mn(s):0!==(a&=o)&&(r=mn(a))}else 0!==(o=t&~i)?r=mn(o):0!==a&&(r=mn(a));if(0===r)return 0;if(0!==n&&n!==r&&0===(n&i)&&((i=r&-r)>=(a=n&-n)||16===i&&4194240&a))return n;if(4&r&&(r|=16&t),0!==(n=e.entangledLanes))for(e=e.entanglements,n&=r;0<n;)i=1<<(t=31-sn(n)),r|=e[t],n&=~i;return r}function gn(e,n){switch(e){case 1:case 2:case 4:return n+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n+5e3;default:return-1}}function vn(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function hn(){var e=un;return!(4194240&(un<<=1))&&(un=64),e}function fn(e){for(var n=[],t=0;31>t;t++)n.push(e);return n}function bn(e,n,t){e.pendingLanes|=n,536870912!==n&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[n=31-sn(n)]=t}function xn(e,n){var t=e.entangledLanes|=n;for(e=e.entanglements;t;){var r=31-sn(t),i=1<<r;i&n|e[r]&n&&(e[r]|=n),t&=~i}}var yn=0;function kn(e){return 1<(e&=-e)?4<e?268435455&e?16:536870912:4:1}var wn,jn,Sn,Cn,Nn,Pn=!1,En=[],On=null,Mn=null,zn=null,Tn=new Map,In=new Map,Ln=[],Dn="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function An(e,n){switch(e){case"focusin":case"focusout":On=null;break;case"dragenter":case"dragleave":Mn=null;break;case"mouseover":case"mouseout":zn=null;break;case"pointerover":case"pointerout":Tn.delete(n.pointerId);break;case"gotpointercapture":case"lostpointercapture":In.delete(n.pointerId)}}function Rn(e,n,t,r,i,a){return null===e||e.nativeEvent!==a?(e={blockedOn:n,domEventName:t,eventSystemFlags:r,nativeEvent:a,targetContainers:[i]},null!==n&&(null!==(n=xi(n))&&jn(n)),e):(e.eventSystemFlags|=r,n=e.targetContainers,null!==i&&-1===n.indexOf(i)&&n.push(i),e)}function Bn(e){var n=bi(e.target);if(null!==n){var t=We(n);if(null!==t)if(13===(n=t.tag)){if(null!==(n=He(t)))return e.blockedOn=n,void Nn(e.priority,function(){Sn(t)})}else if(3===n&&t.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===t.tag?t.stateNode.containerInfo:null)}e.blockedOn=null}function _n(e){if(null!==e.blockedOn)return!1;for(var n=e.targetContainers;0<n.length;){var t=Gn(e.domEventName,e.eventSystemFlags,n[0],e.nativeEvent);if(null!==t)return null!==(n=xi(t))&&jn(n),e.blockedOn=t,!1;var r=new(t=e.nativeEvent).constructor(t.type,t);ye=r,t.target.dispatchEvent(r),ye=null,n.shift()}return!0}function Un(e,n,t){_n(e)&&t.delete(n)}function Fn(){Pn=!1,null!==On&&_n(On)&&(On=null),null!==Mn&&_n(Mn)&&(Mn=null),null!==zn&&_n(zn)&&(zn=null),Tn.forEach(Un),In.forEach(Un)}function Wn(e,n){e.blockedOn===n&&(e.blockedOn=null,Pn||(Pn=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,Fn)))}function Hn(e){function n(n){return Wn(n,e)}if(0<En.length){Wn(En[0],e);for(var t=1;t<En.length;t++){var r=En[t];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==On&&Wn(On,e),null!==Mn&&Wn(Mn,e),null!==zn&&Wn(zn,e),Tn.forEach(n),In.forEach(n),t=0;t<Ln.length;t++)(r=Ln[t]).blockedOn===e&&(r.blockedOn=null);for(;0<Ln.length&&null===(t=Ln[0]).blockedOn;)Bn(t),null===t.blockedOn&&Ln.shift()}var Vn=y.ReactCurrentBatchConfig,qn=!0;function $n(e,n,t,r){var i=yn,a=Vn.transition;Vn.transition=null;try{yn=1,Kn(e,n,t,r)}finally{yn=i,Vn.transition=a}}function Yn(e,n,t,r){var i=yn,a=Vn.transition;Vn.transition=null;try{yn=4,Kn(e,n,t,r)}finally{yn=i,Vn.transition=a}}function Kn(e,n,t,r){if(qn){var i=Gn(e,n,t,r);if(null===i)Vr(e,n,r,Qn,t),An(e,r);else if(function(e,n,t,r,i){switch(n){case"focusin":return On=Rn(On,e,n,t,r,i),!0;case"dragenter":return Mn=Rn(Mn,e,n,t,r,i),!0;case"mouseover":return zn=Rn(zn,e,n,t,r,i),!0;case"pointerover":var a=i.pointerId;return Tn.set(a,Rn(Tn.get(a)||null,e,n,t,r,i)),!0;case"gotpointercapture":return a=i.pointerId,In.set(a,Rn(In.get(a)||null,e,n,t,r,i)),!0}return!1}(i,e,n,t,r))r.stopPropagation();else if(An(e,r),4&n&&-1<Dn.indexOf(e)){for(;null!==i;){var a=xi(i);if(null!==a&&wn(a),null===(a=Gn(e,n,t,r))&&Vr(e,n,r,Qn,t),a===i)break;i=a}null!==i&&r.stopPropagation()}else Vr(e,n,r,null,t)}}var Qn=null;function Gn(e,n,t,r){if(Qn=null,null!==(e=bi(e=ke(r))))if(null===(n=We(e)))e=null;else if(13===(t=n.tag)){if(null!==(e=He(n)))return e;e=null}else if(3===t){if(n.stateNode.current.memoizedState.isDehydrated)return 3===n.tag?n.stateNode.containerInfo:null;e=null}else n!==e&&(e=null);return Qn=e,null}function Xn(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ze()){case Je:return 1;case en:return 4;case nn:case tn:return 16;case rn:return 536870912;default:return 16}default:return 16}}var Zn=null,Jn=null,et=null;function nt(){if(et)return et;var e,n,t=Jn,r=t.length,i="value"in Zn?Zn.value:Zn.textContent,a=i.length;for(e=0;e<r&&t[e]===i[e];e++);var o=r-e;for(n=1;n<=o&&t[r-n]===i[a-n];n++);return et=i.slice(e,1<n?1-n:void 0)}function tt(e){var n=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===n&&(e=13):e=n,10===e&&(e=13),32<=e||13===e?e:0}function rt(){return!0}function it(){return!1}function at(e){function n(n,t,r,i,a){for(var o in this._reactName=n,this._targetInst=r,this.type=t,this.nativeEvent=i,this.target=a,this.currentTarget=null,e)e.hasOwnProperty(o)&&(n=e[o],this[o]=n?n(i):i[o]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?rt:it,this.isPropagationStopped=it,this}return R(n.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=rt)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=rt)},persist:function(){},isPersistent:rt}),n}var ot,st,lt,ct={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ut=at(ct),dt=R({},ct,{view:0,detail:0}),mt=at(dt),pt=R({},dt,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ct,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==lt&&(lt&&"mousemove"===e.type?(ot=e.screenX-lt.screenX,st=e.screenY-lt.screenY):st=ot=0,lt=e),ot)},movementY:function(e){return"movementY"in e?e.movementY:st}}),gt=at(pt),vt=at(R({},pt,{dataTransfer:0})),ht=at(R({},dt,{relatedTarget:0})),ft=at(R({},ct,{animationName:0,elapsedTime:0,pseudoElement:0})),bt=R({},ct,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),xt=at(bt),yt=at(R({},ct,{data:0})),kt={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},wt={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},jt={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function St(e){var n=this.nativeEvent;return n.getModifierState?n.getModifierState(e):!!(e=jt[e])&&!!n[e]}function Ct(){return St}var Nt=R({},dt,{key:function(e){if(e.key){var n=kt[e.key]||e.key;if("Unidentified"!==n)return n}return"keypress"===e.type?13===(e=tt(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?wt[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ct,charCode:function(e){return"keypress"===e.type?tt(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tt(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Pt=at(Nt),Et=at(R({},pt,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Ot=at(R({},dt,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ct})),Mt=at(R({},ct,{propertyName:0,elapsedTime:0,pseudoElement:0})),zt=R({},pt,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Tt=at(zt),It=[9,13,27,32],Lt=u&&"CompositionEvent"in window,Dt=null;u&&"documentMode"in document&&(Dt=document.documentMode);var At=u&&"TextEvent"in window&&!Dt,Rt=u&&(!Lt||Dt&&8<Dt&&11>=Dt),Bt=String.fromCharCode(32),_t=!1;function Ut(e,n){switch(e){case"keyup":return-1!==It.indexOf(n.keyCode);case"keydown":return 229!==n.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ft(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var Wt=!1;var Ht={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Vt(e){var n=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===n?!!Ht[e.type]:"textarea"===n}function qt(e,n,t,r){Ne(r),0<(n=$r(n,"onChange")).length&&(t=new ut("onChange","change",null,t,r),e.push({event:t,listeners:n}))}var $t=null,Yt=null;function Kt(e){Br(e,0)}function Qt(e){if(Y(yi(e)))return e}function Gt(e,n){if("change"===e)return n}var Xt=!1;if(u){var Zt;if(u){var Jt="oninput"in document;if(!Jt){var er=document.createElement("div");er.setAttribute("oninput","return;"),Jt="function"==typeof er.oninput}Zt=Jt}else Zt=!1;Xt=Zt&&(!document.documentMode||9<document.documentMode)}function nr(){$t&&($t.detachEvent("onpropertychange",tr),Yt=$t=null)}function tr(e){if("value"===e.propertyName&&Qt(Yt)){var n=[];qt(n,Yt,e,ke(e)),ze(Kt,n)}}function rr(e,n,t){"focusin"===e?(nr(),Yt=t,($t=n).attachEvent("onpropertychange",tr)):"focusout"===e&&nr()}function ir(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Qt(Yt)}function ar(e,n){if("click"===e)return Qt(n)}function or(e,n){if("input"===e||"change"===e)return Qt(n)}var sr="function"==typeof Object.is?Object.is:function(e,n){return e===n&&(0!==e||1/e==1/n)||e!=e&&n!=n};function lr(e,n){if(sr(e,n))return!0;if("object"!=typeof e||null===e||"object"!=typeof n||null===n)return!1;var t=Object.keys(e),r=Object.keys(n);if(t.length!==r.length)return!1;for(r=0;r<t.length;r++){var i=t[r];if(!d.call(n,i)||!sr(e[i],n[i]))return!1}return!0}function cr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ur(e,n){var t,r=cr(e);for(e=0;r;){if(3===r.nodeType){if(t=e+r.textContent.length,e<=n&&t>=n)return{node:r,offset:n-e};e=t}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=cr(r)}}function dr(e,n){return!(!e||!n)&&(e===n||(!e||3!==e.nodeType)&&(n&&3===n.nodeType?dr(e,n.parentNode):"contains"in e?e.contains(n):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(n))))}function mr(){for(var e=window,n=K();n instanceof e.HTMLIFrameElement;){try{var t="string"==typeof n.contentWindow.location.href}catch(e){t=!1}if(!t)break;n=K((e=n.contentWindow).document)}return n}function pr(e){var n=e&&e.nodeName&&e.nodeName.toLowerCase();return n&&("input"===n&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===n||"true"===e.contentEditable)}function gr(e){var n=mr(),t=e.focusedElem,r=e.selectionRange;if(n!==t&&t&&t.ownerDocument&&dr(t.ownerDocument.documentElement,t)){if(null!==r&&pr(t))if(n=r.start,void 0===(e=r.end)&&(e=n),"selectionStart"in t)t.selectionStart=n,t.selectionEnd=Math.min(e,t.value.length);else if((e=(n=t.ownerDocument||document)&&n.defaultView||window).getSelection){e=e.getSelection();var i=t.textContent.length,a=Math.min(r.start,i);r=void 0===r.end?a:Math.min(r.end,i),!e.extend&&a>r&&(i=r,r=a,a=i),i=ur(t,a);var o=ur(t,r);i&&o&&(1!==e.rangeCount||e.anchorNode!==i.node||e.anchorOffset!==i.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&((n=n.createRange()).setStart(i.node,i.offset),e.removeAllRanges(),a>r?(e.addRange(n),e.extend(o.node,o.offset)):(n.setEnd(o.node,o.offset),e.addRange(n)))}for(n=[],e=t;e=e.parentNode;)1===e.nodeType&&n.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"==typeof t.focus&&t.focus(),t=0;t<n.length;t++)(e=n[t]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var vr=u&&"documentMode"in document&&11>=document.documentMode,hr=null,fr=null,br=null,xr=!1;function yr(e,n,t){var r=t.window===t?t.document:9===t.nodeType?t:t.ownerDocument;xr||null==hr||hr!==K(r)||("selectionStart"in(r=hr)&&pr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},br&&lr(br,r)||(br=r,0<(r=$r(fr,"onSelect")).length&&(n=new ut("onSelect","select",null,n,t),e.push({event:n,listeners:r}),n.target=hr)))}function kr(e,n){var t={};return t[e.toLowerCase()]=n.toLowerCase(),t["Webkit"+e]="webkit"+n,t["Moz"+e]="moz"+n,t}var wr={animationend:kr("Animation","AnimationEnd"),animationiteration:kr("Animation","AnimationIteration"),animationstart:kr("Animation","AnimationStart"),transitionend:kr("Transition","TransitionEnd")},jr={},Sr={};function Cr(e){if(jr[e])return jr[e];if(!wr[e])return e;var n,t=wr[e];for(n in t)if(t.hasOwnProperty(n)&&n in Sr)return jr[e]=t[n];return e}u&&(Sr=document.createElement("div").style,"AnimationEvent"in window||(delete wr.animationend.animation,delete wr.animationiteration.animation,delete wr.animationstart.animation),"TransitionEvent"in window||delete wr.transitionend.transition);var Nr=Cr("animationend"),Pr=Cr("animationiteration"),Er=Cr("animationstart"),Or=Cr("transitionend"),Mr=new Map,zr="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Tr(e,n){Mr.set(e,n),l(n,[e])}for(var Ir=0;Ir<zr.length;Ir++){var Lr=zr[Ir];Tr(Lr.toLowerCase(),"on"+(Lr[0].toUpperCase()+Lr.slice(1)))}Tr(Nr,"onAnimationEnd"),Tr(Pr,"onAnimationIteration"),Tr(Er,"onAnimationStart"),Tr("dblclick","onDoubleClick"),Tr("focusin","onFocus"),Tr("focusout","onBlur"),Tr(Or,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Dr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ar=new Set("cancel close invalid load scroll toggle".split(" ").concat(Dr));function Rr(e,n,t){var r=e.type||"unknown-event";e.currentTarget=t,function(e,n,t,r,i,o,s,l,c){if(Fe.apply(this,arguments),Ae){if(!Ae)throw Error(a(198));var u=Re;Ae=!1,Re=null,Be||(Be=!0,_e=u)}}(r,n,void 0,e),e.currentTarget=null}function Br(e,n){n=!!(4&n);for(var t=0;t<e.length;t++){var r=e[t],i=r.event;r=r.listeners;e:{var a=void 0;if(n)for(var o=r.length-1;0<=o;o--){var s=r[o],l=s.instance,c=s.currentTarget;if(s=s.listener,l!==a&&i.isPropagationStopped())break e;Rr(i,s,c),a=l}else for(o=0;o<r.length;o++){if(l=(s=r[o]).instance,c=s.currentTarget,s=s.listener,l!==a&&i.isPropagationStopped())break e;Rr(i,s,c),a=l}}}if(Be)throw e=_e,Be=!1,_e=null,e}function _r(e,n){var t=n[vi];void 0===t&&(t=n[vi]=new Set);var r=e+"__bubble";t.has(r)||(Hr(n,e,2,!1),t.add(r))}function Ur(e,n,t){var r=0;n&&(r|=4),Hr(t,e,r,n)}var Fr="_reactListening"+Math.random().toString(36).slice(2);function Wr(e){if(!e[Fr]){e[Fr]=!0,o.forEach(function(n){"selectionchange"!==n&&(Ar.has(n)||Ur(n,!1,e),Ur(n,!0,e))});var n=9===e.nodeType?e:e.ownerDocument;null===n||n[Fr]||(n[Fr]=!0,Ur("selectionchange",!1,n))}}function Hr(e,n,t,r){switch(Xn(n)){case 1:var i=$n;break;case 4:i=Yn;break;default:i=Kn}t=i.bind(null,n,t,e),i=void 0,!Ie||"touchstart"!==n&&"touchmove"!==n&&"wheel"!==n||(i=!0),r?void 0!==i?e.addEventListener(n,t,{capture:!0,passive:i}):e.addEventListener(n,t,!0):void 0!==i?e.addEventListener(n,t,{passive:i}):e.addEventListener(n,t,!1)}function Vr(e,n,t,r,i){var a=r;if(!(1&n||2&n||null===r))e:for(;;){if(null===r)return;var o=r.tag;if(3===o||4===o){var s=r.stateNode.containerInfo;if(s===i||8===s.nodeType&&s.parentNode===i)break;if(4===o)for(o=r.return;null!==o;){var l=o.tag;if((3===l||4===l)&&((l=o.stateNode.containerInfo)===i||8===l.nodeType&&l.parentNode===i))return;o=o.return}for(;null!==s;){if(null===(o=bi(s)))return;if(5===(l=o.tag)||6===l){r=a=o;continue e}s=s.parentNode}}r=r.return}ze(function(){var r=a,i=ke(t),o=[];e:{var s=Mr.get(e);if(void 0!==s){var l=ut,c=e;switch(e){case"keypress":if(0===tt(t))break e;case"keydown":case"keyup":l=Pt;break;case"focusin":c="focus",l=ht;break;case"focusout":c="blur",l=ht;break;case"beforeblur":case"afterblur":l=ht;break;case"click":if(2===t.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=gt;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=vt;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Ot;break;case Nr:case Pr:case Er:l=ft;break;case Or:l=Mt;break;case"scroll":l=mt;break;case"wheel":l=Tt;break;case"copy":case"cut":case"paste":l=xt;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=Et}var u=!!(4&n),d=!u&&"scroll"===e,m=u?null!==s?s+"Capture":null:s;u=[];for(var p,g=r;null!==g;){var v=(p=g).stateNode;if(5===p.tag&&null!==v&&(p=v,null!==m&&(null!=(v=Te(g,m))&&u.push(qr(g,v,p)))),d)break;g=g.return}0<u.length&&(s=new l(s,c,null,t,i),o.push({event:s,listeners:u}))}}if(!(7&n)){if(l="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||t===ye||!(c=t.relatedTarget||t.fromElement)||!bi(c)&&!c[gi])&&(l||s)&&(s=i.window===i?i:(s=i.ownerDocument)?s.defaultView||s.parentWindow:window,l?(l=r,null!==(c=(c=t.relatedTarget||t.toElement)?bi(c):null)&&(c!==(d=We(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=r),l!==c)){if(u=gt,v="onMouseLeave",m="onMouseEnter",g="mouse","pointerout"!==e&&"pointerover"!==e||(u=Et,v="onPointerLeave",m="onPointerEnter",g="pointer"),d=null==l?s:yi(l),p=null==c?s:yi(c),(s=new u(v,g+"leave",l,t,i)).target=d,s.relatedTarget=p,v=null,bi(i)===r&&((u=new u(m,g+"enter",c,t,i)).target=p,u.relatedTarget=d,v=u),d=v,l&&c)e:{for(m=c,g=0,p=u=l;p;p=Yr(p))g++;for(p=0,v=m;v;v=Yr(v))p++;for(;0<g-p;)u=Yr(u),g--;for(;0<p-g;)m=Yr(m),p--;for(;g--;){if(u===m||null!==m&&u===m.alternate)break e;u=Yr(u),m=Yr(m)}u=null}else u=null;null!==l&&Kr(o,s,l,u,!1),null!==c&&null!==d&&Kr(o,d,c,u,!0)}if("select"===(l=(s=r?yi(r):window).nodeName&&s.nodeName.toLowerCase())||"input"===l&&"file"===s.type)var h=Gt;else if(Vt(s))if(Xt)h=or;else{h=ir;var f=rr}else(l=s.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(h=ar);switch(h&&(h=h(e,r))?qt(o,h,t,i):(f&&f(e,s,r),"focusout"===e&&(f=s._wrapperState)&&f.controlled&&"number"===s.type&&ee(s,"number",s.value)),f=r?yi(r):window,e){case"focusin":(Vt(f)||"true"===f.contentEditable)&&(hr=f,fr=r,br=null);break;case"focusout":br=fr=hr=null;break;case"mousedown":xr=!0;break;case"contextmenu":case"mouseup":case"dragend":xr=!1,yr(o,t,i);break;case"selectionchange":if(vr)break;case"keydown":case"keyup":yr(o,t,i)}var b;if(Lt)e:{switch(e){case"compositionstart":var x="onCompositionStart";break e;case"compositionend":x="onCompositionEnd";break e;case"compositionupdate":x="onCompositionUpdate";break e}x=void 0}else Wt?Ut(e,t)&&(x="onCompositionEnd"):"keydown"===e&&229===t.keyCode&&(x="onCompositionStart");x&&(Rt&&"ko"!==t.locale&&(Wt||"onCompositionStart"!==x?"onCompositionEnd"===x&&Wt&&(b=nt()):(Jn="value"in(Zn=i)?Zn.value:Zn.textContent,Wt=!0)),0<(f=$r(r,x)).length&&(x=new yt(x,e,null,t,i),o.push({event:x,listeners:f}),b?x.data=b:null!==(b=Ft(t))&&(x.data=b))),(b=At?function(e,n){switch(e){case"compositionend":return Ft(n);case"keypress":return 32!==n.which?null:(_t=!0,Bt);case"textInput":return(e=n.data)===Bt&&_t?null:e;default:return null}}(e,t):function(e,n){if(Wt)return"compositionend"===e||!Lt&&Ut(e,n)?(e=nt(),et=Jn=Zn=null,Wt=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(n.ctrlKey||n.altKey||n.metaKey)||n.ctrlKey&&n.altKey){if(n.char&&1<n.char.length)return n.char;if(n.which)return String.fromCharCode(n.which)}return null;case"compositionend":return Rt&&"ko"!==n.locale?null:n.data}}(e,t))&&(0<(r=$r(r,"onBeforeInput")).length&&(i=new yt("onBeforeInput","beforeinput",null,t,i),o.push({event:i,listeners:r}),i.data=b))}Br(o,n)})}function qr(e,n,t){return{instance:e,listener:n,currentTarget:t}}function $r(e,n){for(var t=n+"Capture",r=[];null!==e;){var i=e,a=i.stateNode;5===i.tag&&null!==a&&(i=a,null!=(a=Te(e,t))&&r.unshift(qr(e,a,i)),null!=(a=Te(e,n))&&r.push(qr(e,a,i))),e=e.return}return r}function Yr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Kr(e,n,t,r,i){for(var a=n._reactName,o=[];null!==t&&t!==r;){var s=t,l=s.alternate,c=s.stateNode;if(null!==l&&l===r)break;5===s.tag&&null!==c&&(s=c,i?null!=(l=Te(t,a))&&o.unshift(qr(t,l,s)):i||null!=(l=Te(t,a))&&o.push(qr(t,l,s))),t=t.return}0!==o.length&&e.push({event:n,listeners:o})}var Qr=/\r\n?/g,Gr=/\u0000|\uFFFD/g;function Xr(e){return("string"==typeof e?e:""+e).replace(Qr,"\n").replace(Gr,"")}function Zr(e,n,t){if(n=Xr(n),Xr(e)!==n&&t)throw Error(a(425))}function Jr(){}var ei=null,ni=null;function ti(e,n){return"textarea"===e||"noscript"===e||"string"==typeof n.children||"number"==typeof n.children||"object"==typeof n.dangerouslySetInnerHTML&&null!==n.dangerouslySetInnerHTML&&null!=n.dangerouslySetInnerHTML.__html}var ri="function"==typeof setTimeout?setTimeout:void 0,ii="function"==typeof clearTimeout?clearTimeout:void 0,ai="function"==typeof Promise?Promise:void 0,oi="function"==typeof queueMicrotask?queueMicrotask:void 0!==ai?function(e){return ai.resolve(null).then(e).catch(si)}:ri;function si(e){setTimeout(function(){throw e})}function li(e,n){var t=n,r=0;do{var i=t.nextSibling;if(e.removeChild(t),i&&8===i.nodeType)if("/$"===(t=i.data)){if(0===r)return e.removeChild(i),void Hn(n);r--}else"$"!==t&&"$?"!==t&&"$!"!==t||r++;t=i}while(t);Hn(n)}function ci(e){for(;null!=e;e=e.nextSibling){var n=e.nodeType;if(1===n||3===n)break;if(8===n){if("$"===(n=e.data)||"$!"===n||"$?"===n)break;if("/$"===n)return null}}return e}function ui(e){e=e.previousSibling;for(var n=0;e;){if(8===e.nodeType){var t=e.data;if("$"===t||"$!"===t||"$?"===t){if(0===n)return e;n--}else"/$"===t&&n++}e=e.previousSibling}return null}var di=Math.random().toString(36).slice(2),mi="__reactFiber$"+di,pi="__reactProps$"+di,gi="__reactContainer$"+di,vi="__reactEvents$"+di,hi="__reactListeners$"+di,fi="__reactHandles$"+di;function bi(e){var n=e[mi];if(n)return n;for(var t=e.parentNode;t;){if(n=t[gi]||t[mi]){if(t=n.alternate,null!==n.child||null!==t&&null!==t.child)for(e=ui(e);null!==e;){if(t=e[mi])return t;e=ui(e)}return n}t=(e=t).parentNode}return null}function xi(e){return!(e=e[mi]||e[gi])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function yi(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(a(33))}function ki(e){return e[pi]||null}var wi=[],ji=-1;function Si(e){return{current:e}}function Ci(e){0>ji||(e.current=wi[ji],wi[ji]=null,ji--)}function Ni(e,n){ji++,wi[ji]=e.current,e.current=n}var Pi={},Ei=Si(Pi),Oi=Si(!1),Mi=Pi;function zi(e,n){var t=e.type.contextTypes;if(!t)return Pi;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===n)return r.__reactInternalMemoizedMaskedChildContext;var i,a={};for(i in t)a[i]=n[i];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=n,e.__reactInternalMemoizedMaskedChildContext=a),a}function Ti(e){return null!=(e=e.childContextTypes)}function Ii(){Ci(Oi),Ci(Ei)}function Li(e,n,t){if(Ei.current!==Pi)throw Error(a(168));Ni(Ei,n),Ni(Oi,t)}function Di(e,n,t){var r=e.stateNode;if(n=n.childContextTypes,"function"!=typeof r.getChildContext)return t;for(var i in r=r.getChildContext())if(!(i in n))throw Error(a(108,H(e)||"Unknown",i));return R({},t,r)}function Ai(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Pi,Mi=Ei.current,Ni(Ei,e),Ni(Oi,Oi.current),!0}function Ri(e,n,t){var r=e.stateNode;if(!r)throw Error(a(169));t?(e=Di(e,n,Mi),r.__reactInternalMemoizedMergedChildContext=e,Ci(Oi),Ci(Ei),Ni(Ei,e)):Ci(Oi),Ni(Oi,t)}var Bi=null,_i=!1,Ui=!1;function Fi(e){null===Bi?Bi=[e]:Bi.push(e)}function Wi(){if(!Ui&&null!==Bi){Ui=!0;var e=0,n=yn;try{var t=Bi;for(yn=1;e<t.length;e++){var r=t[e];do{r=r(!0)}while(null!==r)}Bi=null,_i=!1}catch(n){throw null!==Bi&&(Bi=Bi.slice(e+1)),Ye(Je,Wi),n}finally{yn=n,Ui=!1}}return null}var Hi=[],Vi=0,qi=null,$i=0,Yi=[],Ki=0,Qi=null,Gi=1,Xi="";function Zi(e,n){Hi[Vi++]=$i,Hi[Vi++]=qi,qi=e,$i=n}function Ji(e,n,t){Yi[Ki++]=Gi,Yi[Ki++]=Xi,Yi[Ki++]=Qi,Qi=e;var r=Gi;e=Xi;var i=32-sn(r)-1;r&=~(1<<i),t+=1;var a=32-sn(n)+i;if(30<a){var o=i-i%5;a=(r&(1<<o)-1).toString(32),r>>=o,i-=o,Gi=1<<32-sn(n)+i|t<<i|r,Xi=a+e}else Gi=1<<a|t<<i|r,Xi=e}function ea(e){null!==e.return&&(Zi(e,1),Ji(e,1,0))}function na(e){for(;e===qi;)qi=Hi[--Vi],Hi[Vi]=null,$i=Hi[--Vi],Hi[Vi]=null;for(;e===Qi;)Qi=Yi[--Ki],Yi[Ki]=null,Xi=Yi[--Ki],Yi[Ki]=null,Gi=Yi[--Ki],Yi[Ki]=null}var ta=null,ra=null,ia=!1,aa=null;function oa(e,n){var t=Mc(5,null,null,0);t.elementType="DELETED",t.stateNode=n,t.return=e,null===(n=e.deletions)?(e.deletions=[t],e.flags|=16):n.push(t)}function sa(e,n){switch(e.tag){case 5:var t=e.type;return null!==(n=1!==n.nodeType||t.toLowerCase()!==n.nodeName.toLowerCase()?null:n)&&(e.stateNode=n,ta=e,ra=ci(n.firstChild),!0);case 6:return null!==(n=""===e.pendingProps||3!==n.nodeType?null:n)&&(e.stateNode=n,ta=e,ra=null,!0);case 13:return null!==(n=8!==n.nodeType?null:n)&&(t=null!==Qi?{id:Gi,overflow:Xi}:null,e.memoizedState={dehydrated:n,treeContext:t,retryLane:1073741824},(t=Mc(18,null,null,0)).stateNode=n,t.return=e,e.child=t,ta=e,ra=null,!0);default:return!1}}function la(e){return!(!(1&e.mode)||128&e.flags)}function ca(e){if(ia){var n=ra;if(n){var t=n;if(!sa(e,n)){if(la(e))throw Error(a(418));n=ci(t.nextSibling);var r=ta;n&&sa(e,n)?oa(r,t):(e.flags=-4097&e.flags|2,ia=!1,ta=e)}}else{if(la(e))throw Error(a(418));e.flags=-4097&e.flags|2,ia=!1,ta=e}}}function ua(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;ta=e}function da(e){if(e!==ta)return!1;if(!ia)return ua(e),ia=!0,!1;var n;if((n=3!==e.tag)&&!(n=5!==e.tag)&&(n="head"!==(n=e.type)&&"body"!==n&&!ti(e.type,e.memoizedProps)),n&&(n=ra)){if(la(e))throw ma(),Error(a(418));for(;n;)oa(e,n),n=ci(n.nextSibling)}if(ua(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(a(317));e:{for(e=e.nextSibling,n=0;e;){if(8===e.nodeType){var t=e.data;if("/$"===t){if(0===n){ra=ci(e.nextSibling);break e}n--}else"$"!==t&&"$!"!==t&&"$?"!==t||n++}e=e.nextSibling}ra=null}}else ra=ta?ci(e.stateNode.nextSibling):null;return!0}function ma(){for(var e=ra;e;)e=ci(e.nextSibling)}function pa(){ra=ta=null,ia=!1}function ga(e){null===aa?aa=[e]:aa.push(e)}var va=y.ReactCurrentBatchConfig;function ha(e,n,t){if(null!==(e=t.ref)&&"function"!=typeof e&&"object"!=typeof e){if(t._owner){if(t=t._owner){if(1!==t.tag)throw Error(a(309));var r=t.stateNode}if(!r)throw Error(a(147,e));var i=r,o=""+e;return null!==n&&null!==n.ref&&"function"==typeof n.ref&&n.ref._stringRef===o?n.ref:(n=function(e){var n=i.refs;null===e?delete n[o]:n[o]=e},n._stringRef=o,n)}if("string"!=typeof e)throw Error(a(284));if(!t._owner)throw Error(a(290,e))}return e}function fa(e,n){throw e=Object.prototype.toString.call(n),Error(a(31,"[object Object]"===e?"object with keys {"+Object.keys(n).join(", ")+"}":e))}function ba(e){return(0,e._init)(e._payload)}function xa(e){function n(n,t){if(e){var r=n.deletions;null===r?(n.deletions=[t],n.flags|=16):r.push(t)}}function t(t,r){if(!e)return null;for(;null!==r;)n(t,r),r=r.sibling;return null}function r(e,n){for(e=new Map;null!==n;)null!==n.key?e.set(n.key,n):e.set(n.index,n),n=n.sibling;return e}function i(e,n){return(e=Tc(e,n)).index=0,e.sibling=null,e}function o(n,t,r){return n.index=r,e?null!==(r=n.alternate)?(r=r.index)<t?(n.flags|=2,t):r:(n.flags|=2,t):(n.flags|=1048576,t)}function s(n){return e&&null===n.alternate&&(n.flags|=2),n}function l(e,n,t,r){return null===n||6!==n.tag?((n=Ac(t,e.mode,r)).return=e,n):((n=i(n,t)).return=e,n)}function c(e,n,t,r){var a=t.type;return a===j?d(e,n,t.props.children,r,t.key):null!==n&&(n.elementType===a||"object"==typeof a&&null!==a&&a.$$typeof===T&&ba(a)===n.type)?((r=i(n,t.props)).ref=ha(e,n,t),r.return=e,r):((r=Ic(t.type,t.key,t.props,null,e.mode,r)).ref=ha(e,n,t),r.return=e,r)}function u(e,n,t,r){return null===n||4!==n.tag||n.stateNode.containerInfo!==t.containerInfo||n.stateNode.implementation!==t.implementation?((n=Rc(t,e.mode,r)).return=e,n):((n=i(n,t.children||[])).return=e,n)}function d(e,n,t,r,a){return null===n||7!==n.tag?((n=Lc(t,e.mode,r,a)).return=e,n):((n=i(n,t)).return=e,n)}function m(e,n,t){if("string"==typeof n&&""!==n||"number"==typeof n)return(n=Ac(""+n,e.mode,t)).return=e,n;if("object"==typeof n&&null!==n){switch(n.$$typeof){case k:return(t=Ic(n.type,n.key,n.props,null,e.mode,t)).ref=ha(e,null,n),t.return=e,t;case w:return(n=Rc(n,e.mode,t)).return=e,n;case T:return m(e,(0,n._init)(n._payload),t)}if(ne(n)||D(n))return(n=Lc(n,e.mode,t,null)).return=e,n;fa(e,n)}return null}function p(e,n,t,r){var i=null!==n?n.key:null;if("string"==typeof t&&""!==t||"number"==typeof t)return null!==i?null:l(e,n,""+t,r);if("object"==typeof t&&null!==t){switch(t.$$typeof){case k:return t.key===i?c(e,n,t,r):null;case w:return t.key===i?u(e,n,t,r):null;case T:return p(e,n,(i=t._init)(t._payload),r)}if(ne(t)||D(t))return null!==i?null:d(e,n,t,r,null);fa(e,t)}return null}function g(e,n,t,r,i){if("string"==typeof r&&""!==r||"number"==typeof r)return l(n,e=e.get(t)||null,""+r,i);if("object"==typeof r&&null!==r){switch(r.$$typeof){case k:return c(n,e=e.get(null===r.key?t:r.key)||null,r,i);case w:return u(n,e=e.get(null===r.key?t:r.key)||null,r,i);case T:return g(e,n,t,(0,r._init)(r._payload),i)}if(ne(r)||D(r))return d(n,e=e.get(t)||null,r,i,null);fa(n,r)}return null}function v(i,a,s,l){for(var c=null,u=null,d=a,v=a=0,h=null;null!==d&&v<s.length;v++){d.index>v?(h=d,d=null):h=d.sibling;var f=p(i,d,s[v],l);if(null===f){null===d&&(d=h);break}e&&d&&null===f.alternate&&n(i,d),a=o(f,a,v),null===u?c=f:u.sibling=f,u=f,d=h}if(v===s.length)return t(i,d),ia&&Zi(i,v),c;if(null===d){for(;v<s.length;v++)null!==(d=m(i,s[v],l))&&(a=o(d,a,v),null===u?c=d:u.sibling=d,u=d);return ia&&Zi(i,v),c}for(d=r(i,d);v<s.length;v++)null!==(h=g(d,i,v,s[v],l))&&(e&&null!==h.alternate&&d.delete(null===h.key?v:h.key),a=o(h,a,v),null===u?c=h:u.sibling=h,u=h);return e&&d.forEach(function(e){return n(i,e)}),ia&&Zi(i,v),c}function h(i,s,l,c){var u=D(l);if("function"!=typeof u)throw Error(a(150));if(null==(l=u.call(l)))throw Error(a(151));for(var d=u=null,v=s,h=s=0,f=null,b=l.next();null!==v&&!b.done;h++,b=l.next()){v.index>h?(f=v,v=null):f=v.sibling;var x=p(i,v,b.value,c);if(null===x){null===v&&(v=f);break}e&&v&&null===x.alternate&&n(i,v),s=o(x,s,h),null===d?u=x:d.sibling=x,d=x,v=f}if(b.done)return t(i,v),ia&&Zi(i,h),u;if(null===v){for(;!b.done;h++,b=l.next())null!==(b=m(i,b.value,c))&&(s=o(b,s,h),null===d?u=b:d.sibling=b,d=b);return ia&&Zi(i,h),u}for(v=r(i,v);!b.done;h++,b=l.next())null!==(b=g(v,i,h,b.value,c))&&(e&&null!==b.alternate&&v.delete(null===b.key?h:b.key),s=o(b,s,h),null===d?u=b:d.sibling=b,d=b);return e&&v.forEach(function(e){return n(i,e)}),ia&&Zi(i,h),u}return function e(r,a,o,l){if("object"==typeof o&&null!==o&&o.type===j&&null===o.key&&(o=o.props.children),"object"==typeof o&&null!==o){switch(o.$$typeof){case k:e:{for(var c=o.key,u=a;null!==u;){if(u.key===c){if((c=o.type)===j){if(7===u.tag){t(r,u.sibling),(a=i(u,o.props.children)).return=r,r=a;break e}}else if(u.elementType===c||"object"==typeof c&&null!==c&&c.$$typeof===T&&ba(c)===u.type){t(r,u.sibling),(a=i(u,o.props)).ref=ha(r,u,o),a.return=r,r=a;break e}t(r,u);break}n(r,u),u=u.sibling}o.type===j?((a=Lc(o.props.children,r.mode,l,o.key)).return=r,r=a):((l=Ic(o.type,o.key,o.props,null,r.mode,l)).ref=ha(r,a,o),l.return=r,r=l)}return s(r);case w:e:{for(u=o.key;null!==a;){if(a.key===u){if(4===a.tag&&a.stateNode.containerInfo===o.containerInfo&&a.stateNode.implementation===o.implementation){t(r,a.sibling),(a=i(a,o.children||[])).return=r,r=a;break e}t(r,a);break}n(r,a),a=a.sibling}(a=Rc(o,r.mode,l)).return=r,r=a}return s(r);case T:return e(r,a,(u=o._init)(o._payload),l)}if(ne(o))return v(r,a,o,l);if(D(o))return h(r,a,o,l);fa(r,o)}return"string"==typeof o&&""!==o||"number"==typeof o?(o=""+o,null!==a&&6===a.tag?(t(r,a.sibling),(a=i(a,o)).return=r,r=a):(t(r,a),(a=Ac(o,r.mode,l)).return=r,r=a),s(r)):t(r,a)}}var ya=xa(!0),ka=xa(!1),wa=Si(null),ja=null,Sa=null,Ca=null;function Na(){Ca=Sa=ja=null}function Pa(e){var n=wa.current;Ci(wa),e._currentValue=n}function Ea(e,n,t){for(;null!==e;){var r=e.alternate;if((e.childLanes&n)!==n?(e.childLanes|=n,null!==r&&(r.childLanes|=n)):null!==r&&(r.childLanes&n)!==n&&(r.childLanes|=n),e===t)break;e=e.return}}function Oa(e,n){ja=e,Ca=Sa=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&n)&&(xs=!0),e.firstContext=null)}function Ma(e){var n=e._currentValue;if(Ca!==e)if(e={context:e,memoizedValue:n,next:null},null===Sa){if(null===ja)throw Error(a(308));Sa=e,ja.dependencies={lanes:0,firstContext:e}}else Sa=Sa.next=e;return n}var za=null;function Ta(e){null===za?za=[e]:za.push(e)}function Ia(e,n,t,r){var i=n.interleaved;return null===i?(t.next=t,Ta(n)):(t.next=i.next,i.next=t),n.interleaved=t,La(e,r)}function La(e,n){e.lanes|=n;var t=e.alternate;for(null!==t&&(t.lanes|=n),t=e,e=e.return;null!==e;)e.childLanes|=n,null!==(t=e.alternate)&&(t.childLanes|=n),t=e,e=e.return;return 3===t.tag?t.stateNode:null}var Da=!1;function Aa(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Ra(e,n){e=e.updateQueue,n.updateQueue===e&&(n.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Ba(e,n){return{eventTime:e,lane:n,tag:0,payload:null,callback:null,next:null}}function _a(e,n,t){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,2&Pl){var i=r.pending;return null===i?n.next=n:(n.next=i.next,i.next=n),r.pending=n,La(e,t)}return null===(i=r.interleaved)?(n.next=n,Ta(r)):(n.next=i.next,i.next=n),r.interleaved=n,La(e,t)}function Ua(e,n,t){if(null!==(n=n.updateQueue)&&(n=n.shared,4194240&t)){var r=n.lanes;t|=r&=e.pendingLanes,n.lanes=t,xn(e,t)}}function Fa(e,n){var t=e.updateQueue,r=e.alternate;if(null!==r&&t===(r=r.updateQueue)){var i=null,a=null;if(null!==(t=t.firstBaseUpdate)){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};null===a?i=a=o:a=a.next=o,t=t.next}while(null!==t);null===a?i=a=n:a=a.next=n}else i=a=n;return t={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:a,shared:r.shared,effects:r.effects},void(e.updateQueue=t)}null===(e=t.lastBaseUpdate)?t.firstBaseUpdate=n:e.next=n,t.lastBaseUpdate=n}function Wa(e,n,t,r){var i=e.updateQueue;Da=!1;var a=i.firstBaseUpdate,o=i.lastBaseUpdate,s=i.shared.pending;if(null!==s){i.shared.pending=null;var l=s,c=l.next;l.next=null,null===o?a=c:o.next=c,o=l;var u=e.alternate;null!==u&&((s=(u=u.updateQueue).lastBaseUpdate)!==o&&(null===s?u.firstBaseUpdate=c:s.next=c,u.lastBaseUpdate=l))}if(null!==a){var d=i.baseState;for(o=0,u=c=l=null,s=a;;){var m=s.lane,p=s.eventTime;if((r&m)===m){null!==u&&(u=u.next={eventTime:p,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var g=e,v=s;switch(m=n,p=t,v.tag){case 1:if("function"==typeof(g=v.payload)){d=g.call(p,d,m);break e}d=g;break e;case 3:g.flags=-65537&g.flags|128;case 0:if(null==(m="function"==typeof(g=v.payload)?g.call(p,d,m):g))break e;d=R({},d,m);break e;case 2:Da=!0}}null!==s.callback&&0!==s.lane&&(e.flags|=64,null===(m=i.effects)?i.effects=[s]:m.push(s))}else p={eventTime:p,lane:m,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===u?(c=u=p,l=d):u=u.next=p,o|=m;if(null===(s=s.next)){if(null===(s=i.shared.pending))break;s=(m=s).next,m.next=null,i.lastBaseUpdate=m,i.shared.pending=null}}if(null===u&&(l=d),i.baseState=l,i.firstBaseUpdate=c,i.lastBaseUpdate=u,null!==(n=i.shared.interleaved)){i=n;do{o|=i.lane,i=i.next}while(i!==n)}else null===a&&(i.shared.lanes=0);Dl|=o,e.lanes=o,e.memoizedState=d}}function Ha(e,n,t){if(e=n.effects,n.effects=null,null!==e)for(n=0;n<e.length;n++){var r=e[n],i=r.callback;if(null!==i){if(r.callback=null,r=t,"function"!=typeof i)throw Error(a(191,i));i.call(r)}}}var Va={},qa=Si(Va),$a=Si(Va),Ya=Si(Va);function Ka(e){if(e===Va)throw Error(a(174));return e}function Qa(e,n){switch(Ni(Ya,n),Ni($a,e),Ni(qa,Va),e=n.nodeType){case 9:case 11:n=(n=n.documentElement)?n.namespaceURI:le(null,"");break;default:n=le(n=(e=8===e?n.parentNode:n).namespaceURI||null,e=e.tagName)}Ci(qa),Ni(qa,n)}function Ga(){Ci(qa),Ci($a),Ci(Ya)}function Xa(e){Ka(Ya.current);var n=Ka(qa.current),t=le(n,e.type);n!==t&&(Ni($a,e),Ni(qa,t))}function Za(e){$a.current===e&&(Ci(qa),Ci($a))}var Ja=Si(0);function eo(e){for(var n=e;null!==n;){if(13===n.tag){var t=n.memoizedState;if(null!==t&&(null===(t=t.dehydrated)||"$?"===t.data||"$!"===t.data))return n}else if(19===n.tag&&void 0!==n.memoizedProps.revealOrder){if(128&n.flags)return n}else if(null!==n.child){n.child.return=n,n=n.child;continue}if(n===e)break;for(;null===n.sibling;){if(null===n.return||n.return===e)return null;n=n.return}n.sibling.return=n.return,n=n.sibling}return null}var no=[];function to(){for(var e=0;e<no.length;e++)no[e]._workInProgressVersionPrimary=null;no.length=0}var ro=y.ReactCurrentDispatcher,io=y.ReactCurrentBatchConfig,ao=0,oo=null,so=null,lo=null,co=!1,uo=!1,mo=0,po=0;function go(){throw Error(a(321))}function vo(e,n){if(null===n)return!1;for(var t=0;t<n.length&&t<e.length;t++)if(!sr(e[t],n[t]))return!1;return!0}function ho(e,n,t,r,i,o){if(ao=o,oo=n,n.memoizedState=null,n.updateQueue=null,n.lanes=0,ro.current=null===e||null===e.memoizedState?Jo:es,e=t(r,i),uo){o=0;do{if(uo=!1,mo=0,25<=o)throw Error(a(301));o+=1,lo=so=null,n.updateQueue=null,ro.current=ns,e=t(r,i)}while(uo)}if(ro.current=Zo,n=null!==so&&null!==so.next,ao=0,lo=so=oo=null,co=!1,n)throw Error(a(300));return e}function fo(){var e=0!==mo;return mo=0,e}function bo(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===lo?oo.memoizedState=lo=e:lo=lo.next=e,lo}function xo(){if(null===so){var e=oo.alternate;e=null!==e?e.memoizedState:null}else e=so.next;var n=null===lo?oo.memoizedState:lo.next;if(null!==n)lo=n,so=e;else{if(null===e)throw Error(a(310));e={memoizedState:(so=e).memoizedState,baseState:so.baseState,baseQueue:so.baseQueue,queue:so.queue,next:null},null===lo?oo.memoizedState=lo=e:lo=lo.next=e}return lo}function yo(e,n){return"function"==typeof n?n(e):n}function ko(e){var n=xo(),t=n.queue;if(null===t)throw Error(a(311));t.lastRenderedReducer=e;var r=so,i=r.baseQueue,o=t.pending;if(null!==o){if(null!==i){var s=i.next;i.next=o.next,o.next=s}r.baseQueue=i=o,t.pending=null}if(null!==i){o=i.next,r=r.baseState;var l=s=null,c=null,u=o;do{var d=u.lane;if((ao&d)===d)null!==c&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:e(r,u.action);else{var m={lane:d,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===c?(l=c=m,s=r):c=c.next=m,oo.lanes|=d,Dl|=d}u=u.next}while(null!==u&&u!==o);null===c?s=r:c.next=l,sr(r,n.memoizedState)||(xs=!0),n.memoizedState=r,n.baseState=s,n.baseQueue=c,t.lastRenderedState=r}if(null!==(e=t.interleaved)){i=e;do{o=i.lane,oo.lanes|=o,Dl|=o,i=i.next}while(i!==e)}else null===i&&(t.lanes=0);return[n.memoizedState,t.dispatch]}function wo(e){var n=xo(),t=n.queue;if(null===t)throw Error(a(311));t.lastRenderedReducer=e;var r=t.dispatch,i=t.pending,o=n.memoizedState;if(null!==i){t.pending=null;var s=i=i.next;do{o=e(o,s.action),s=s.next}while(s!==i);sr(o,n.memoizedState)||(xs=!0),n.memoizedState=o,null===n.baseQueue&&(n.baseState=o),t.lastRenderedState=o}return[o,r]}function jo(){}function So(e,n){var t=oo,r=xo(),i=n(),o=!sr(r.memoizedState,i);if(o&&(r.memoizedState=i,xs=!0),r=r.queue,Ao(Po.bind(null,t,r,e),[e]),r.getSnapshot!==n||o||null!==lo&&1&lo.memoizedState.tag){if(t.flags|=2048,zo(9,No.bind(null,t,r,i,n),void 0,null),null===El)throw Error(a(349));30&ao||Co(t,n,i)}return i}function Co(e,n,t){e.flags|=16384,e={getSnapshot:n,value:t},null===(n=oo.updateQueue)?(n={lastEffect:null,stores:null},oo.updateQueue=n,n.stores=[e]):null===(t=n.stores)?n.stores=[e]:t.push(e)}function No(e,n,t,r){n.value=t,n.getSnapshot=r,Eo(n)&&Oo(e)}function Po(e,n,t){return t(function(){Eo(n)&&Oo(e)})}function Eo(e){var n=e.getSnapshot;e=e.value;try{var t=n();return!sr(e,t)}catch(e){return!0}}function Oo(e){var n=La(e,1);null!==n&&nc(n,e,1,-1)}function Mo(e){var n=bo();return"function"==typeof e&&(e=e()),n.memoizedState=n.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:yo,lastRenderedState:e},n.queue=e,e=e.dispatch=Ko.bind(null,oo,e),[n.memoizedState,e]}function zo(e,n,t,r){return e={tag:e,create:n,destroy:t,deps:r,next:null},null===(n=oo.updateQueue)?(n={lastEffect:null,stores:null},oo.updateQueue=n,n.lastEffect=e.next=e):null===(t=n.lastEffect)?n.lastEffect=e.next=e:(r=t.next,t.next=e,e.next=r,n.lastEffect=e),e}function To(){return xo().memoizedState}function Io(e,n,t,r){var i=bo();oo.flags|=e,i.memoizedState=zo(1|n,t,void 0,void 0===r?null:r)}function Lo(e,n,t,r){var i=xo();r=void 0===r?null:r;var a=void 0;if(null!==so){var o=so.memoizedState;if(a=o.destroy,null!==r&&vo(r,o.deps))return void(i.memoizedState=zo(n,t,a,r))}oo.flags|=e,i.memoizedState=zo(1|n,t,a,r)}function Do(e,n){return Io(8390656,8,e,n)}function Ao(e,n){return Lo(2048,8,e,n)}function Ro(e,n){return Lo(4,2,e,n)}function Bo(e,n){return Lo(4,4,e,n)}function _o(e,n){return"function"==typeof n?(e=e(),n(e),function(){n(null)}):null!=n?(e=e(),n.current=e,function(){n.current=null}):void 0}function Uo(e,n,t){return t=null!=t?t.concat([e]):null,Lo(4,4,_o.bind(null,n,e),t)}function Fo(){}function Wo(e,n){var t=xo();n=void 0===n?null:n;var r=t.memoizedState;return null!==r&&null!==n&&vo(n,r[1])?r[0]:(t.memoizedState=[e,n],e)}function Ho(e,n){var t=xo();n=void 0===n?null:n;var r=t.memoizedState;return null!==r&&null!==n&&vo(n,r[1])?r[0]:(e=e(),t.memoizedState=[e,n],e)}function Vo(e,n,t){return 21&ao?(sr(t,n)||(t=hn(),oo.lanes|=t,Dl|=t,e.baseState=!0),n):(e.baseState&&(e.baseState=!1,xs=!0),e.memoizedState=t)}function qo(e,n){var t=yn;yn=0!==t&&4>t?t:4,e(!0);var r=io.transition;io.transition={};try{e(!1),n()}finally{yn=t,io.transition=r}}function $o(){return xo().memoizedState}function Yo(e,n,t){var r=ec(e);if(t={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null},Qo(e))Go(n,t);else if(null!==(t=Ia(e,n,t,r))){nc(t,e,r,Jl()),Xo(t,n,r)}}function Ko(e,n,t){var r=ec(e),i={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null};if(Qo(e))Go(n,i);else{var a=e.alternate;if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=n.lastRenderedReducer))try{var o=n.lastRenderedState,s=a(o,t);if(i.hasEagerState=!0,i.eagerState=s,sr(s,o)){var l=n.interleaved;return null===l?(i.next=i,Ta(n)):(i.next=l.next,l.next=i),void(n.interleaved=i)}}catch(e){}null!==(t=Ia(e,n,i,r))&&(nc(t,e,r,i=Jl()),Xo(t,n,r))}}function Qo(e){var n=e.alternate;return e===oo||null!==n&&n===oo}function Go(e,n){uo=co=!0;var t=e.pending;null===t?n.next=n:(n.next=t.next,t.next=n),e.pending=n}function Xo(e,n,t){if(4194240&t){var r=n.lanes;t|=r&=e.pendingLanes,n.lanes=t,xn(e,t)}}var Zo={readContext:Ma,useCallback:go,useContext:go,useEffect:go,useImperativeHandle:go,useInsertionEffect:go,useLayoutEffect:go,useMemo:go,useReducer:go,useRef:go,useState:go,useDebugValue:go,useDeferredValue:go,useTransition:go,useMutableSource:go,useSyncExternalStore:go,useId:go,unstable_isNewReconciler:!1},Jo={readContext:Ma,useCallback:function(e,n){return bo().memoizedState=[e,void 0===n?null:n],e},useContext:Ma,useEffect:Do,useImperativeHandle:function(e,n,t){return t=null!=t?t.concat([e]):null,Io(4194308,4,_o.bind(null,n,e),t)},useLayoutEffect:function(e,n){return Io(4194308,4,e,n)},useInsertionEffect:function(e,n){return Io(4,2,e,n)},useMemo:function(e,n){var t=bo();return n=void 0===n?null:n,e=e(),t.memoizedState=[e,n],e},useReducer:function(e,n,t){var r=bo();return n=void 0!==t?t(n):n,r.memoizedState=r.baseState=n,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:n},r.queue=e,e=e.dispatch=Yo.bind(null,oo,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},bo().memoizedState=e},useState:Mo,useDebugValue:Fo,useDeferredValue:function(e){return bo().memoizedState=e},useTransition:function(){var e=Mo(!1),n=e[0];return e=qo.bind(null,e[1]),bo().memoizedState=e,[n,e]},useMutableSource:function(){},useSyncExternalStore:function(e,n,t){var r=oo,i=bo();if(ia){if(void 0===t)throw Error(a(407));t=t()}else{if(t=n(),null===El)throw Error(a(349));30&ao||Co(r,n,t)}i.memoizedState=t;var o={value:t,getSnapshot:n};return i.queue=o,Do(Po.bind(null,r,o,e),[e]),r.flags|=2048,zo(9,No.bind(null,r,o,t,n),void 0,null),t},useId:function(){var e=bo(),n=El.identifierPrefix;if(ia){var t=Xi;n=":"+n+"R"+(t=(Gi&~(1<<32-sn(Gi)-1)).toString(32)+t),0<(t=mo++)&&(n+="H"+t.toString(32)),n+=":"}else n=":"+n+"r"+(t=po++).toString(32)+":";return e.memoizedState=n},unstable_isNewReconciler:!1},es={readContext:Ma,useCallback:Wo,useContext:Ma,useEffect:Ao,useImperativeHandle:Uo,useInsertionEffect:Ro,useLayoutEffect:Bo,useMemo:Ho,useReducer:ko,useRef:To,useState:function(){return ko(yo)},useDebugValue:Fo,useDeferredValue:function(e){return Vo(xo(),so.memoizedState,e)},useTransition:function(){return[ko(yo)[0],xo().memoizedState]},useMutableSource:jo,useSyncExternalStore:So,useId:$o,unstable_isNewReconciler:!1},ns={readContext:Ma,useCallback:Wo,useContext:Ma,useEffect:Ao,useImperativeHandle:Uo,useInsertionEffect:Ro,useLayoutEffect:Bo,useMemo:Ho,useReducer:wo,useRef:To,useState:function(){return wo(yo)},useDebugValue:Fo,useDeferredValue:function(e){var n=xo();return null===so?n.memoizedState=e:Vo(n,so.memoizedState,e)},useTransition:function(){return[wo(yo)[0],xo().memoizedState]},useMutableSource:jo,useSyncExternalStore:So,useId:$o,unstable_isNewReconciler:!1};function ts(e,n){if(e&&e.defaultProps){for(var t in n=R({},n),e=e.defaultProps)void 0===n[t]&&(n[t]=e[t]);return n}return n}function rs(e,n,t,r){t=null==(t=t(r,n=e.memoizedState))?n:R({},n,t),e.memoizedState=t,0===e.lanes&&(e.updateQueue.baseState=t)}var is={isMounted:function(e){return!!(e=e._reactInternals)&&We(e)===e},enqueueSetState:function(e,n,t){e=e._reactInternals;var r=Jl(),i=ec(e),a=Ba(r,i);a.payload=n,null!=t&&(a.callback=t),null!==(n=_a(e,a,i))&&(nc(n,e,i,r),Ua(n,e,i))},enqueueReplaceState:function(e,n,t){e=e._reactInternals;var r=Jl(),i=ec(e),a=Ba(r,i);a.tag=1,a.payload=n,null!=t&&(a.callback=t),null!==(n=_a(e,a,i))&&(nc(n,e,i,r),Ua(n,e,i))},enqueueForceUpdate:function(e,n){e=e._reactInternals;var t=Jl(),r=ec(e),i=Ba(t,r);i.tag=2,null!=n&&(i.callback=n),null!==(n=_a(e,i,r))&&(nc(n,e,r,t),Ua(n,e,r))}};function as(e,n,t,r,i,a,o){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,a,o):!n.prototype||!n.prototype.isPureReactComponent||(!lr(t,r)||!lr(i,a))}function os(e,n,t){var r=!1,i=Pi,a=n.contextType;return"object"==typeof a&&null!==a?a=Ma(a):(i=Ti(n)?Mi:Ei.current,a=(r=null!=(r=n.contextTypes))?zi(e,i):Pi),n=new n(t,a),e.memoizedState=null!==n.state&&void 0!==n.state?n.state:null,n.updater=is,e.stateNode=n,n._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=a),n}function ss(e,n,t,r){e=n.state,"function"==typeof n.componentWillReceiveProps&&n.componentWillReceiveProps(t,r),"function"==typeof n.UNSAFE_componentWillReceiveProps&&n.UNSAFE_componentWillReceiveProps(t,r),n.state!==e&&is.enqueueReplaceState(n,n.state,null)}function ls(e,n,t,r){var i=e.stateNode;i.props=t,i.state=e.memoizedState,i.refs={},Aa(e);var a=n.contextType;"object"==typeof a&&null!==a?i.context=Ma(a):(a=Ti(n)?Mi:Ei.current,i.context=zi(e,a)),i.state=e.memoizedState,"function"==typeof(a=n.getDerivedStateFromProps)&&(rs(e,n,a,t),i.state=e.memoizedState),"function"==typeof n.getDerivedStateFromProps||"function"==typeof i.getSnapshotBeforeUpdate||"function"!=typeof i.UNSAFE_componentWillMount&&"function"!=typeof i.componentWillMount||(n=i.state,"function"==typeof i.componentWillMount&&i.componentWillMount(),"function"==typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),n!==i.state&&is.enqueueReplaceState(i,i.state,null),Wa(e,t,i,r),i.state=e.memoizedState),"function"==typeof i.componentDidMount&&(e.flags|=4194308)}function cs(e,n){try{var t="",r=n;do{t+=F(r),r=r.return}while(r);var i=t}catch(e){i="\nError generating stack: "+e.message+"\n"+e.stack}return{value:e,source:n,stack:i,digest:null}}function us(e,n,t){return{value:e,source:null,stack:null!=t?t:null,digest:null!=n?n:null}}function ds(e,n){try{console.error(n.value)}catch(e){setTimeout(function(){throw e})}}var ms="function"==typeof WeakMap?WeakMap:Map;function ps(e,n,t){(t=Ba(-1,t)).tag=3,t.payload={element:null};var r=n.value;return t.callback=function(){Hl||(Hl=!0,Vl=r),ds(0,n)},t}function gs(e,n,t){(t=Ba(-1,t)).tag=3;var r=e.type.getDerivedStateFromError;if("function"==typeof r){var i=n.value;t.payload=function(){return r(i)},t.callback=function(){ds(0,n)}}var a=e.stateNode;return null!==a&&"function"==typeof a.componentDidCatch&&(t.callback=function(){ds(0,n),"function"!=typeof r&&(null===ql?ql=new Set([this]):ql.add(this));var e=n.stack;this.componentDidCatch(n.value,{componentStack:null!==e?e:""})}),t}function vs(e,n,t){var r=e.pingCache;if(null===r){r=e.pingCache=new ms;var i=new Set;r.set(n,i)}else void 0===(i=r.get(n))&&(i=new Set,r.set(n,i));i.has(t)||(i.add(t),e=Sc.bind(null,e,n,t),n.then(e,e))}function hs(e){do{var n;if((n=13===e.tag)&&(n=null===(n=e.memoizedState)||null!==n.dehydrated),n)return e;e=e.return}while(null!==e);return null}function fs(e,n,t,r,i){return 1&e.mode?(e.flags|=65536,e.lanes=i,e):(e===n?e.flags|=65536:(e.flags|=128,t.flags|=131072,t.flags&=-52805,1===t.tag&&(null===t.alternate?t.tag=17:((n=Ba(-1,1)).tag=2,_a(t,n,1))),t.lanes|=1),e)}var bs=y.ReactCurrentOwner,xs=!1;function ys(e,n,t,r){n.child=null===e?ka(n,null,t,r):ya(n,e.child,t,r)}function ks(e,n,t,r,i){t=t.render;var a=n.ref;return Oa(n,i),r=ho(e,n,t,r,a,i),t=fo(),null===e||xs?(ia&&t&&ea(n),n.flags|=1,ys(e,n,r,i),n.child):(n.updateQueue=e.updateQueue,n.flags&=-2053,e.lanes&=~i,Hs(e,n,i))}function ws(e,n,t,r,i){if(null===e){var a=t.type;return"function"!=typeof a||zc(a)||void 0!==a.defaultProps||null!==t.compare||void 0!==t.defaultProps?((e=Ic(t.type,null,r,n,n.mode,i)).ref=n.ref,e.return=n,n.child=e):(n.tag=15,n.type=a,js(e,n,a,r,i))}if(a=e.child,0===(e.lanes&i)){var o=a.memoizedProps;if((t=null!==(t=t.compare)?t:lr)(o,r)&&e.ref===n.ref)return Hs(e,n,i)}return n.flags|=1,(e=Tc(a,r)).ref=n.ref,e.return=n,n.child=e}function js(e,n,t,r,i){if(null!==e){var a=e.memoizedProps;if(lr(a,r)&&e.ref===n.ref){if(xs=!1,n.pendingProps=r=a,0===(e.lanes&i))return n.lanes=e.lanes,Hs(e,n,i);131072&e.flags&&(xs=!0)}}return Ns(e,n,t,r,i)}function Ss(e,n,t){var r=n.pendingProps,i=r.children,a=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(1&n.mode){if(!(1073741824&t))return e=null!==a?a.baseLanes|t:t,n.lanes=n.childLanes=1073741824,n.memoizedState={baseLanes:e,cachePool:null,transitions:null},n.updateQueue=null,Ni(Tl,zl),zl|=e,null;n.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==a?a.baseLanes:t,Ni(Tl,zl),zl|=r}else n.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ni(Tl,zl),zl|=t;else null!==a?(r=a.baseLanes|t,n.memoizedState=null):r=t,Ni(Tl,zl),zl|=r;return ys(e,n,i,t),n.child}function Cs(e,n){var t=n.ref;(null===e&&null!==t||null!==e&&e.ref!==t)&&(n.flags|=512,n.flags|=2097152)}function Ns(e,n,t,r,i){var a=Ti(t)?Mi:Ei.current;return a=zi(n,a),Oa(n,i),t=ho(e,n,t,r,a,i),r=fo(),null===e||xs?(ia&&r&&ea(n),n.flags|=1,ys(e,n,t,i),n.child):(n.updateQueue=e.updateQueue,n.flags&=-2053,e.lanes&=~i,Hs(e,n,i))}function Ps(e,n,t,r,i){if(Ti(t)){var a=!0;Ai(n)}else a=!1;if(Oa(n,i),null===n.stateNode)Ws(e,n),os(n,t,r),ls(n,t,r,i),r=!0;else if(null===e){var o=n.stateNode,s=n.memoizedProps;o.props=s;var l=o.context,c=t.contextType;"object"==typeof c&&null!==c?c=Ma(c):c=zi(n,c=Ti(t)?Mi:Ei.current);var u=t.getDerivedStateFromProps,d="function"==typeof u||"function"==typeof o.getSnapshotBeforeUpdate;d||"function"!=typeof o.UNSAFE_componentWillReceiveProps&&"function"!=typeof o.componentWillReceiveProps||(s!==r||l!==c)&&ss(n,o,r,c),Da=!1;var m=n.memoizedState;o.state=m,Wa(n,r,o,i),l=n.memoizedState,s!==r||m!==l||Oi.current||Da?("function"==typeof u&&(rs(n,t,u,r),l=n.memoizedState),(s=Da||as(n,t,s,r,m,l,c))?(d||"function"!=typeof o.UNSAFE_componentWillMount&&"function"!=typeof o.componentWillMount||("function"==typeof o.componentWillMount&&o.componentWillMount(),"function"==typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"==typeof o.componentDidMount&&(n.flags|=4194308)):("function"==typeof o.componentDidMount&&(n.flags|=4194308),n.memoizedProps=r,n.memoizedState=l),o.props=r,o.state=l,o.context=c,r=s):("function"==typeof o.componentDidMount&&(n.flags|=4194308),r=!1)}else{o=n.stateNode,Ra(e,n),s=n.memoizedProps,c=n.type===n.elementType?s:ts(n.type,s),o.props=c,d=n.pendingProps,m=o.context,"object"==typeof(l=t.contextType)&&null!==l?l=Ma(l):l=zi(n,l=Ti(t)?Mi:Ei.current);var p=t.getDerivedStateFromProps;(u="function"==typeof p||"function"==typeof o.getSnapshotBeforeUpdate)||"function"!=typeof o.UNSAFE_componentWillReceiveProps&&"function"!=typeof o.componentWillReceiveProps||(s!==d||m!==l)&&ss(n,o,r,l),Da=!1,m=n.memoizedState,o.state=m,Wa(n,r,o,i);var g=n.memoizedState;s!==d||m!==g||Oi.current||Da?("function"==typeof p&&(rs(n,t,p,r),g=n.memoizedState),(c=Da||as(n,t,c,r,m,g,l)||!1)?(u||"function"!=typeof o.UNSAFE_componentWillUpdate&&"function"!=typeof o.componentWillUpdate||("function"==typeof o.componentWillUpdate&&o.componentWillUpdate(r,g,l),"function"==typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(r,g,l)),"function"==typeof o.componentDidUpdate&&(n.flags|=4),"function"==typeof o.getSnapshotBeforeUpdate&&(n.flags|=1024)):("function"!=typeof o.componentDidUpdate||s===e.memoizedProps&&m===e.memoizedState||(n.flags|=4),"function"!=typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&m===e.memoizedState||(n.flags|=1024),n.memoizedProps=r,n.memoizedState=g),o.props=r,o.state=g,o.context=l,r=c):("function"!=typeof o.componentDidUpdate||s===e.memoizedProps&&m===e.memoizedState||(n.flags|=4),"function"!=typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&m===e.memoizedState||(n.flags|=1024),r=!1)}return Es(e,n,t,r,a,i)}function Es(e,n,t,r,i,a){Cs(e,n);var o=!!(128&n.flags);if(!r&&!o)return i&&Ri(n,t,!1),Hs(e,n,a);r=n.stateNode,bs.current=n;var s=o&&"function"!=typeof t.getDerivedStateFromError?null:r.render();return n.flags|=1,null!==e&&o?(n.child=ya(n,e.child,null,a),n.child=ya(n,null,s,a)):ys(e,n,s,a),n.memoizedState=r.state,i&&Ri(n,t,!0),n.child}function Os(e){var n=e.stateNode;n.pendingContext?Li(0,n.pendingContext,n.pendingContext!==n.context):n.context&&Li(0,n.context,!1),Qa(e,n.containerInfo)}function Ms(e,n,t,r,i){return pa(),ga(i),n.flags|=256,ys(e,n,t,r),n.child}var zs,Ts,Is,Ls={dehydrated:null,treeContext:null,retryLane:0};function Ds(e){return{baseLanes:e,cachePool:null,transitions:null}}function As(e,n,t){var r,i=n.pendingProps,o=Ja.current,s=!1,l=!!(128&n.flags);if((r=l)||(r=(null===e||null!==e.memoizedState)&&!!(2&o)),r?(s=!0,n.flags&=-129):null!==e&&null===e.memoizedState||(o|=1),Ni(Ja,1&o),null===e)return ca(n),null!==(e=n.memoizedState)&&null!==(e=e.dehydrated)?(1&n.mode?"$!"===e.data?n.lanes=8:n.lanes=1073741824:n.lanes=1,null):(l=i.children,e=i.fallback,s?(i=n.mode,s=n.child,l={mode:"hidden",children:l},1&i||null===s?s=Dc(l,i,0,null):(s.childLanes=0,s.pendingProps=l),e=Lc(e,i,t,null),s.return=n,e.return=n,s.sibling=e,n.child=s,n.child.memoizedState=Ds(t),n.memoizedState=Ls,e):Rs(n,l));if(null!==(o=e.memoizedState)&&null!==(r=o.dehydrated))return function(e,n,t,r,i,o,s){if(t)return 256&n.flags?(n.flags&=-257,Bs(e,n,s,r=us(Error(a(422))))):null!==n.memoizedState?(n.child=e.child,n.flags|=128,null):(o=r.fallback,i=n.mode,r=Dc({mode:"visible",children:r.children},i,0,null),(o=Lc(o,i,s,null)).flags|=2,r.return=n,o.return=n,r.sibling=o,n.child=r,1&n.mode&&ya(n,e.child,null,s),n.child.memoizedState=Ds(s),n.memoizedState=Ls,o);if(!(1&n.mode))return Bs(e,n,s,null);if("$!"===i.data){if(r=i.nextSibling&&i.nextSibling.dataset)var l=r.dgst;return r=l,Bs(e,n,s,r=us(o=Error(a(419)),r,void 0))}if(l=0!==(s&e.childLanes),xs||l){if(null!==(r=El)){switch(s&-s){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}0!==(i=0!==(i&(r.suspendedLanes|s))?0:i)&&i!==o.retryLane&&(o.retryLane=i,La(e,i),nc(r,e,i,-1))}return gc(),Bs(e,n,s,r=us(Error(a(421))))}return"$?"===i.data?(n.flags|=128,n.child=e.child,n=Nc.bind(null,e),i._reactRetry=n,null):(e=o.treeContext,ra=ci(i.nextSibling),ta=n,ia=!0,aa=null,null!==e&&(Yi[Ki++]=Gi,Yi[Ki++]=Xi,Yi[Ki++]=Qi,Gi=e.id,Xi=e.overflow,Qi=n),n=Rs(n,r.children),n.flags|=4096,n)}(e,n,l,i,r,o,t);if(s){s=i.fallback,l=n.mode,r=(o=e.child).sibling;var c={mode:"hidden",children:i.children};return 1&l||n.child===o?(i=Tc(o,c)).subtreeFlags=14680064&o.subtreeFlags:((i=n.child).childLanes=0,i.pendingProps=c,n.deletions=null),null!==r?s=Tc(r,s):(s=Lc(s,l,t,null)).flags|=2,s.return=n,i.return=n,i.sibling=s,n.child=i,i=s,s=n.child,l=null===(l=e.child.memoizedState)?Ds(t):{baseLanes:l.baseLanes|t,cachePool:null,transitions:l.transitions},s.memoizedState=l,s.childLanes=e.childLanes&~t,n.memoizedState=Ls,i}return e=(s=e.child).sibling,i=Tc(s,{mode:"visible",children:i.children}),!(1&n.mode)&&(i.lanes=t),i.return=n,i.sibling=null,null!==e&&(null===(t=n.deletions)?(n.deletions=[e],n.flags|=16):t.push(e)),n.child=i,n.memoizedState=null,i}function Rs(e,n){return(n=Dc({mode:"visible",children:n},e.mode,0,null)).return=e,e.child=n}function Bs(e,n,t,r){return null!==r&&ga(r),ya(n,e.child,null,t),(e=Rs(n,n.pendingProps.children)).flags|=2,n.memoizedState=null,e}function _s(e,n,t){e.lanes|=n;var r=e.alternate;null!==r&&(r.lanes|=n),Ea(e.return,n,t)}function Us(e,n,t,r,i){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:n,rendering:null,renderingStartTime:0,last:r,tail:t,tailMode:i}:(a.isBackwards=n,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=t,a.tailMode=i)}function Fs(e,n,t){var r=n.pendingProps,i=r.revealOrder,a=r.tail;if(ys(e,n,r.children,t),2&(r=Ja.current))r=1&r|2,n.flags|=128;else{if(null!==e&&128&e.flags)e:for(e=n.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&_s(e,t,n);else if(19===e.tag)_s(e,t,n);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===n)break e;for(;null===e.sibling;){if(null===e.return||e.return===n)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Ni(Ja,r),1&n.mode)switch(i){case"forwards":for(t=n.child,i=null;null!==t;)null!==(e=t.alternate)&&null===eo(e)&&(i=t),t=t.sibling;null===(t=i)?(i=n.child,n.child=null):(i=t.sibling,t.sibling=null),Us(n,!1,i,t,a);break;case"backwards":for(t=null,i=n.child,n.child=null;null!==i;){if(null!==(e=i.alternate)&&null===eo(e)){n.child=i;break}e=i.sibling,i.sibling=t,t=i,i=e}Us(n,!0,t,null,a);break;case"together":Us(n,!1,null,null,void 0);break;default:n.memoizedState=null}else n.memoizedState=null;return n.child}function Ws(e,n){!(1&n.mode)&&null!==e&&(e.alternate=null,n.alternate=null,n.flags|=2)}function Hs(e,n,t){if(null!==e&&(n.dependencies=e.dependencies),Dl|=n.lanes,0===(t&n.childLanes))return null;if(null!==e&&n.child!==e.child)throw Error(a(153));if(null!==n.child){for(t=Tc(e=n.child,e.pendingProps),n.child=t,t.return=n;null!==e.sibling;)e=e.sibling,(t=t.sibling=Tc(e,e.pendingProps)).return=n;t.sibling=null}return n.child}function Vs(e,n){if(!ia)switch(e.tailMode){case"hidden":n=e.tail;for(var t=null;null!==n;)null!==n.alternate&&(t=n),n=n.sibling;null===t?e.tail=null:t.sibling=null;break;case"collapsed":t=e.tail;for(var r=null;null!==t;)null!==t.alternate&&(r=t),t=t.sibling;null===r?n||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function qs(e){var n=null!==e.alternate&&e.alternate.child===e.child,t=0,r=0;if(n)for(var i=e.child;null!==i;)t|=i.lanes|i.childLanes,r|=14680064&i.subtreeFlags,r|=14680064&i.flags,i.return=e,i=i.sibling;else for(i=e.child;null!==i;)t|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=r,e.childLanes=t,n}function $s(e,n,t){var r=n.pendingProps;switch(na(n),n.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return qs(n),null;case 1:case 17:return Ti(n.type)&&Ii(),qs(n),null;case 3:return r=n.stateNode,Ga(),Ci(Oi),Ci(Ei),to(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(da(n)?n.flags|=4:null===e||e.memoizedState.isDehydrated&&!(256&n.flags)||(n.flags|=1024,null!==aa&&(ac(aa),aa=null))),qs(n),null;case 5:Za(n);var i=Ka(Ya.current);if(t=n.type,null!==e&&null!=n.stateNode)Ts(e,n,t,r),e.ref!==n.ref&&(n.flags|=512,n.flags|=2097152);else{if(!r){if(null===n.stateNode)throw Error(a(166));return qs(n),null}if(e=Ka(qa.current),da(n)){r=n.stateNode,t=n.type;var o=n.memoizedProps;switch(r[mi]=n,r[pi]=o,e=!!(1&n.mode),t){case"dialog":_r("cancel",r),_r("close",r);break;case"iframe":case"object":case"embed":_r("load",r);break;case"video":case"audio":for(i=0;i<Dr.length;i++)_r(Dr[i],r);break;case"source":_r("error",r);break;case"img":case"image":case"link":_r("error",r),_r("load",r);break;case"details":_r("toggle",r);break;case"input":G(r,o),_r("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!o.multiple},_r("invalid",r);break;case"textarea":ie(r,o),_r("invalid",r)}for(var l in be(t,o),i=null,o)if(o.hasOwnProperty(l)){var c=o[l];"children"===l?"string"==typeof c?r.textContent!==c&&(!0!==o.suppressHydrationWarning&&Zr(r.textContent,c,e),i=["children",c]):"number"==typeof c&&r.textContent!==""+c&&(!0!==o.suppressHydrationWarning&&Zr(r.textContent,c,e),i=["children",""+c]):s.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&_r("scroll",r)}switch(t){case"input":$(r),J(r,o,!0);break;case"textarea":$(r),oe(r);break;case"select":case"option":break;default:"function"==typeof o.onClick&&(r.onclick=Jr)}r=i,n.updateQueue=r,null!==r&&(n.flags|=4)}else{l=9===i.nodeType?i:i.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=se(t)),"http://www.w3.org/1999/xhtml"===e?"script"===t?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"==typeof r.is?e=l.createElement(t,{is:r.is}):(e=l.createElement(t),"select"===t&&(l=e,r.multiple?l.multiple=!0:r.size&&(l.size=r.size))):e=l.createElementNS(e,t),e[mi]=n,e[pi]=r,zs(e,n),n.stateNode=e;e:{switch(l=xe(t,r),t){case"dialog":_r("cancel",e),_r("close",e),i=r;break;case"iframe":case"object":case"embed":_r("load",e),i=r;break;case"video":case"audio":for(i=0;i<Dr.length;i++)_r(Dr[i],e);i=r;break;case"source":_r("error",e),i=r;break;case"img":case"image":case"link":_r("error",e),_r("load",e),i=r;break;case"details":_r("toggle",e),i=r;break;case"input":G(e,r),i=Q(e,r),_r("invalid",e);break;case"option":default:i=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},i=R({},r,{value:void 0}),_r("invalid",e);break;case"textarea":ie(e,r),i=re(e,r),_r("invalid",e)}for(o in be(t,i),c=i)if(c.hasOwnProperty(o)){var u=c[o];"style"===o?he(e,u):"dangerouslySetInnerHTML"===o?null!=(u=u?u.__html:void 0)&&de(e,u):"children"===o?"string"==typeof u?("textarea"!==t||""!==u)&&me(e,u):"number"==typeof u&&me(e,""+u):"suppressContentEditableWarning"!==o&&"suppressHydrationWarning"!==o&&"autoFocus"!==o&&(s.hasOwnProperty(o)?null!=u&&"onScroll"===o&&_r("scroll",e):null!=u&&x(e,o,u,l))}switch(t){case"input":$(e),J(e,r,!1);break;case"textarea":$(e),oe(e);break;case"option":null!=r.value&&e.setAttribute("value",""+V(r.value));break;case"select":e.multiple=!!r.multiple,null!=(o=r.value)?te(e,!!r.multiple,o,!1):null!=r.defaultValue&&te(e,!!r.multiple,r.defaultValue,!0);break;default:"function"==typeof i.onClick&&(e.onclick=Jr)}switch(t){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(n.flags|=4)}null!==n.ref&&(n.flags|=512,n.flags|=2097152)}return qs(n),null;case 6:if(e&&null!=n.stateNode)Is(0,n,e.memoizedProps,r);else{if("string"!=typeof r&&null===n.stateNode)throw Error(a(166));if(t=Ka(Ya.current),Ka(qa.current),da(n)){if(r=n.stateNode,t=n.memoizedProps,r[mi]=n,(o=r.nodeValue!==t)&&null!==(e=ta))switch(e.tag){case 3:Zr(r.nodeValue,t,!!(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Zr(r.nodeValue,t,!!(1&e.mode))}o&&(n.flags|=4)}else(r=(9===t.nodeType?t:t.ownerDocument).createTextNode(r))[mi]=n,n.stateNode=r}return qs(n),null;case 13:if(Ci(Ja),r=n.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(ia&&null!==ra&&1&n.mode&&!(128&n.flags))ma(),pa(),n.flags|=98560,o=!1;else if(o=da(n),null!==r&&null!==r.dehydrated){if(null===e){if(!o)throw Error(a(318));if(!(o=null!==(o=n.memoizedState)?o.dehydrated:null))throw Error(a(317));o[mi]=n}else pa(),!(128&n.flags)&&(n.memoizedState=null),n.flags|=4;qs(n),o=!1}else null!==aa&&(ac(aa),aa=null),o=!0;if(!o)return 65536&n.flags?n:null}return 128&n.flags?(n.lanes=t,n):((r=null!==r)!==(null!==e&&null!==e.memoizedState)&&r&&(n.child.flags|=8192,1&n.mode&&(null===e||1&Ja.current?0===Il&&(Il=3):gc())),null!==n.updateQueue&&(n.flags|=4),qs(n),null);case 4:return Ga(),null===e&&Wr(n.stateNode.containerInfo),qs(n),null;case 10:return Pa(n.type._context),qs(n),null;case 19:if(Ci(Ja),null===(o=n.memoizedState))return qs(n),null;if(r=!!(128&n.flags),null===(l=o.rendering))if(r)Vs(o,!1);else{if(0!==Il||null!==e&&128&e.flags)for(e=n.child;null!==e;){if(null!==(l=eo(e))){for(n.flags|=128,Vs(o,!1),null!==(r=l.updateQueue)&&(n.updateQueue=r,n.flags|=4),n.subtreeFlags=0,r=t,t=n.child;null!==t;)e=r,(o=t).flags&=14680066,null===(l=o.alternate)?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=l.childLanes,o.lanes=l.lanes,o.child=l.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=l.memoizedProps,o.memoizedState=l.memoizedState,o.updateQueue=l.updateQueue,o.type=l.type,e=l.dependencies,o.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),t=t.sibling;return Ni(Ja,1&Ja.current|2),n.child}e=e.sibling}null!==o.tail&&Xe()>Fl&&(n.flags|=128,r=!0,Vs(o,!1),n.lanes=4194304)}else{if(!r)if(null!==(e=eo(l))){if(n.flags|=128,r=!0,null!==(t=e.updateQueue)&&(n.updateQueue=t,n.flags|=4),Vs(o,!0),null===o.tail&&"hidden"===o.tailMode&&!l.alternate&&!ia)return qs(n),null}else 2*Xe()-o.renderingStartTime>Fl&&1073741824!==t&&(n.flags|=128,r=!0,Vs(o,!1),n.lanes=4194304);o.isBackwards?(l.sibling=n.child,n.child=l):(null!==(t=o.last)?t.sibling=l:n.child=l,o.last=l)}return null!==o.tail?(n=o.tail,o.rendering=n,o.tail=n.sibling,o.renderingStartTime=Xe(),n.sibling=null,t=Ja.current,Ni(Ja,r?1&t|2:1&t),n):(qs(n),null);case 22:case 23:return uc(),r=null!==n.memoizedState,null!==e&&null!==e.memoizedState!==r&&(n.flags|=8192),r&&1&n.mode?!!(1073741824&zl)&&(qs(n),6&n.subtreeFlags&&(n.flags|=8192)):qs(n),null;case 24:case 25:return null}throw Error(a(156,n.tag))}function Ys(e,n){switch(na(n),n.tag){case 1:return Ti(n.type)&&Ii(),65536&(e=n.flags)?(n.flags=-65537&e|128,n):null;case 3:return Ga(),Ci(Oi),Ci(Ei),to(),65536&(e=n.flags)&&!(128&e)?(n.flags=-65537&e|128,n):null;case 5:return Za(n),null;case 13:if(Ci(Ja),null!==(e=n.memoizedState)&&null!==e.dehydrated){if(null===n.alternate)throw Error(a(340));pa()}return 65536&(e=n.flags)?(n.flags=-65537&e|128,n):null;case 19:return Ci(Ja),null;case 4:return Ga(),null;case 10:return Pa(n.type._context),null;case 22:case 23:return uc(),null;default:return null}}zs=function(e,n){for(var t=n.child;null!==t;){if(5===t.tag||6===t.tag)e.appendChild(t.stateNode);else if(4!==t.tag&&null!==t.child){t.child.return=t,t=t.child;continue}if(t===n)break;for(;null===t.sibling;){if(null===t.return||t.return===n)return;t=t.return}t.sibling.return=t.return,t=t.sibling}},Ts=function(e,n,t,r){var i=e.memoizedProps;if(i!==r){e=n.stateNode,Ka(qa.current);var a,o=null;switch(t){case"input":i=Q(e,i),r=Q(e,r),o=[];break;case"select":i=R({},i,{value:void 0}),r=R({},r,{value:void 0}),o=[];break;case"textarea":i=re(e,i),r=re(e,r),o=[];break;default:"function"!=typeof i.onClick&&"function"==typeof r.onClick&&(e.onclick=Jr)}for(u in be(t,r),t=null,i)if(!r.hasOwnProperty(u)&&i.hasOwnProperty(u)&&null!=i[u])if("style"===u){var l=i[u];for(a in l)l.hasOwnProperty(a)&&(t||(t={}),t[a]="")}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(s.hasOwnProperty(u)?o||(o=[]):(o=o||[]).push(u,null));for(u in r){var c=r[u];if(l=null!=i?i[u]:void 0,r.hasOwnProperty(u)&&c!==l&&(null!=c||null!=l))if("style"===u)if(l){for(a in l)!l.hasOwnProperty(a)||c&&c.hasOwnProperty(a)||(t||(t={}),t[a]="");for(a in c)c.hasOwnProperty(a)&&l[a]!==c[a]&&(t||(t={}),t[a]=c[a])}else t||(o||(o=[]),o.push(u,t)),t=c;else"dangerouslySetInnerHTML"===u?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(o=o||[]).push(u,c)):"children"===u?"string"!=typeof c&&"number"!=typeof c||(o=o||[]).push(u,""+c):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(s.hasOwnProperty(u)?(null!=c&&"onScroll"===u&&_r("scroll",e),o||l===c||(o=[])):(o=o||[]).push(u,c))}t&&(o=o||[]).push("style",t);var u=o;(n.updateQueue=u)&&(n.flags|=4)}},Is=function(e,n,t,r){t!==r&&(n.flags|=4)};var Ks=!1,Qs=!1,Gs="function"==typeof WeakSet?WeakSet:Set,Xs=null;function Zs(e,n){var t=e.ref;if(null!==t)if("function"==typeof t)try{t(null)}catch(t){jc(e,n,t)}else t.current=null}function Js(e,n,t){try{t()}catch(t){jc(e,n,t)}}var el=!1;function nl(e,n,t){var r=n.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var i=r=r.next;do{if((i.tag&e)===e){var a=i.destroy;i.destroy=void 0,void 0!==a&&Js(n,t,a)}i=i.next}while(i!==r)}}function tl(e,n){if(null!==(n=null!==(n=n.updateQueue)?n.lastEffect:null)){var t=n=n.next;do{if((t.tag&e)===e){var r=t.create;t.destroy=r()}t=t.next}while(t!==n)}}function rl(e){var n=e.ref;if(null!==n){var t=e.stateNode;e.tag,e=t,"function"==typeof n?n(e):n.current=e}}function il(e){var n=e.alternate;null!==n&&(e.alternate=null,il(n)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(n=e.stateNode)&&(delete n[mi],delete n[pi],delete n[vi],delete n[hi],delete n[fi])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function al(e){return 5===e.tag||3===e.tag||4===e.tag}function ol(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||al(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function sl(e,n,t){var r=e.tag;if(5===r||6===r)e=e.stateNode,n?8===t.nodeType?t.parentNode.insertBefore(e,n):t.insertBefore(e,n):(8===t.nodeType?(n=t.parentNode).insertBefore(e,t):(n=t).appendChild(e),null!=(t=t._reactRootContainer)||null!==n.onclick||(n.onclick=Jr));else if(4!==r&&null!==(e=e.child))for(sl(e,n,t),e=e.sibling;null!==e;)sl(e,n,t),e=e.sibling}function ll(e,n,t){var r=e.tag;if(5===r||6===r)e=e.stateNode,n?t.insertBefore(e,n):t.appendChild(e);else if(4!==r&&null!==(e=e.child))for(ll(e,n,t),e=e.sibling;null!==e;)ll(e,n,t),e=e.sibling}var cl=null,ul=!1;function dl(e,n,t){for(t=t.child;null!==t;)ml(e,n,t),t=t.sibling}function ml(e,n,t){if(on&&"function"==typeof on.onCommitFiberUnmount)try{on.onCommitFiberUnmount(an,t)}catch(e){}switch(t.tag){case 5:Qs||Zs(t,n);case 6:var r=cl,i=ul;cl=null,dl(e,n,t),ul=i,null!==(cl=r)&&(ul?(e=cl,t=t.stateNode,8===e.nodeType?e.parentNode.removeChild(t):e.removeChild(t)):cl.removeChild(t.stateNode));break;case 18:null!==cl&&(ul?(e=cl,t=t.stateNode,8===e.nodeType?li(e.parentNode,t):1===e.nodeType&&li(e,t),Hn(e)):li(cl,t.stateNode));break;case 4:r=cl,i=ul,cl=t.stateNode.containerInfo,ul=!0,dl(e,n,t),cl=r,ul=i;break;case 0:case 11:case 14:case 15:if(!Qs&&(null!==(r=t.updateQueue)&&null!==(r=r.lastEffect))){i=r=r.next;do{var a=i,o=a.destroy;a=a.tag,void 0!==o&&(2&a||4&a)&&Js(t,n,o),i=i.next}while(i!==r)}dl(e,n,t);break;case 1:if(!Qs&&(Zs(t,n),"function"==typeof(r=t.stateNode).componentWillUnmount))try{r.props=t.memoizedProps,r.state=t.memoizedState,r.componentWillUnmount()}catch(e){jc(t,n,e)}dl(e,n,t);break;case 21:dl(e,n,t);break;case 22:1&t.mode?(Qs=(r=Qs)||null!==t.memoizedState,dl(e,n,t),Qs=r):dl(e,n,t);break;default:dl(e,n,t)}}function pl(e){var n=e.updateQueue;if(null!==n){e.updateQueue=null;var t=e.stateNode;null===t&&(t=e.stateNode=new Gs),n.forEach(function(n){var r=Pc.bind(null,e,n);t.has(n)||(t.add(n),n.then(r,r))})}}function gl(e,n){var t=n.deletions;if(null!==t)for(var r=0;r<t.length;r++){var i=t[r];try{var o=e,s=n,l=s;e:for(;null!==l;){switch(l.tag){case 5:cl=l.stateNode,ul=!1;break e;case 3:case 4:cl=l.stateNode.containerInfo,ul=!0;break e}l=l.return}if(null===cl)throw Error(a(160));ml(o,s,i),cl=null,ul=!1;var c=i.alternate;null!==c&&(c.return=null),i.return=null}catch(e){jc(i,n,e)}}if(12854&n.subtreeFlags)for(n=n.child;null!==n;)vl(n,e),n=n.sibling}function vl(e,n){var t=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(gl(n,e),hl(e),4&r){try{nl(3,e,e.return),tl(3,e)}catch(n){jc(e,e.return,n)}try{nl(5,e,e.return)}catch(n){jc(e,e.return,n)}}break;case 1:gl(n,e),hl(e),512&r&&null!==t&&Zs(t,t.return);break;case 5:if(gl(n,e),hl(e),512&r&&null!==t&&Zs(t,t.return),32&e.flags){var i=e.stateNode;try{me(i,"")}catch(n){jc(e,e.return,n)}}if(4&r&&null!=(i=e.stateNode)){var o=e.memoizedProps,s=null!==t?t.memoizedProps:o,l=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===l&&"radio"===o.type&&null!=o.name&&X(i,o),xe(l,s);var u=xe(l,o);for(s=0;s<c.length;s+=2){var d=c[s],m=c[s+1];"style"===d?he(i,m):"dangerouslySetInnerHTML"===d?de(i,m):"children"===d?me(i,m):x(i,d,m,u)}switch(l){case"input":Z(i,o);break;case"textarea":ae(i,o);break;case"select":var p=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!o.multiple;var g=o.value;null!=g?te(i,!!o.multiple,g,!1):p!==!!o.multiple&&(null!=o.defaultValue?te(i,!!o.multiple,o.defaultValue,!0):te(i,!!o.multiple,o.multiple?[]:"",!1))}i[pi]=o}catch(n){jc(e,e.return,n)}}break;case 6:if(gl(n,e),hl(e),4&r){if(null===e.stateNode)throw Error(a(162));i=e.stateNode,o=e.memoizedProps;try{i.nodeValue=o}catch(n){jc(e,e.return,n)}}break;case 3:if(gl(n,e),hl(e),4&r&&null!==t&&t.memoizedState.isDehydrated)try{Hn(n.containerInfo)}catch(n){jc(e,e.return,n)}break;case 4:default:gl(n,e),hl(e);break;case 13:gl(n,e),hl(e),8192&(i=e.child).flags&&(o=null!==i.memoizedState,i.stateNode.isHidden=o,!o||null!==i.alternate&&null!==i.alternate.memoizedState||(Ul=Xe())),4&r&&pl(e);break;case 22:if(d=null!==t&&null!==t.memoizedState,1&e.mode?(Qs=(u=Qs)||d,gl(n,e),Qs=u):gl(n,e),hl(e),8192&r){if(u=null!==e.memoizedState,(e.stateNode.isHidden=u)&&!d&&1&e.mode)for(Xs=e,d=e.child;null!==d;){for(m=Xs=d;null!==Xs;){switch(g=(p=Xs).child,p.tag){case 0:case 11:case 14:case 15:nl(4,p,p.return);break;case 1:Zs(p,p.return);var v=p.stateNode;if("function"==typeof v.componentWillUnmount){r=p,t=p.return;try{n=r,v.props=n.memoizedProps,v.state=n.memoizedState,v.componentWillUnmount()}catch(e){jc(r,t,e)}}break;case 5:Zs(p,p.return);break;case 22:if(null!==p.memoizedState){yl(m);continue}}null!==g?(g.return=p,Xs=g):yl(m)}d=d.sibling}e:for(d=null,m=e;;){if(5===m.tag){if(null===d){d=m;try{i=m.stateNode,u?"function"==typeof(o=i.style).setProperty?o.setProperty("display","none","important"):o.display="none":(l=m.stateNode,s=null!=(c=m.memoizedProps.style)&&c.hasOwnProperty("display")?c.display:null,l.style.display=ve("display",s))}catch(n){jc(e,e.return,n)}}}else if(6===m.tag){if(null===d)try{m.stateNode.nodeValue=u?"":m.memoizedProps}catch(n){jc(e,e.return,n)}}else if((22!==m.tag&&23!==m.tag||null===m.memoizedState||m===e)&&null!==m.child){m.child.return=m,m=m.child;continue}if(m===e)break e;for(;null===m.sibling;){if(null===m.return||m.return===e)break e;d===m&&(d=null),m=m.return}d===m&&(d=null),m.sibling.return=m.return,m=m.sibling}}break;case 19:gl(n,e),hl(e),4&r&&pl(e);case 21:}}function hl(e){var n=e.flags;if(2&n){try{e:{for(var t=e.return;null!==t;){if(al(t)){var r=t;break e}t=t.return}throw Error(a(160))}switch(r.tag){case 5:var i=r.stateNode;32&r.flags&&(me(i,""),r.flags&=-33),ll(e,ol(e),i);break;case 3:case 4:var o=r.stateNode.containerInfo;sl(e,ol(e),o);break;default:throw Error(a(161))}}catch(n){jc(e,e.return,n)}e.flags&=-3}4096&n&&(e.flags&=-4097)}function fl(e,n,t){Xs=e,bl(e,n,t)}function bl(e,n,t){for(var r=!!(1&e.mode);null!==Xs;){var i=Xs,a=i.child;if(22===i.tag&&r){var o=null!==i.memoizedState||Ks;if(!o){var s=i.alternate,l=null!==s&&null!==s.memoizedState||Qs;s=Ks;var c=Qs;if(Ks=o,(Qs=l)&&!c)for(Xs=i;null!==Xs;)l=(o=Xs).child,22===o.tag&&null!==o.memoizedState?kl(i):null!==l?(l.return=o,Xs=l):kl(i);for(;null!==a;)Xs=a,bl(a,n,t),a=a.sibling;Xs=i,Ks=s,Qs=c}xl(e)}else 8772&i.subtreeFlags&&null!==a?(a.return=i,Xs=a):xl(e)}}function xl(e){for(;null!==Xs;){var n=Xs;if(8772&n.flags){var t=n.alternate;try{if(8772&n.flags)switch(n.tag){case 0:case 11:case 15:Qs||tl(5,n);break;case 1:var r=n.stateNode;if(4&n.flags&&!Qs)if(null===t)r.componentDidMount();else{var i=n.elementType===n.type?t.memoizedProps:ts(n.type,t.memoizedProps);r.componentDidUpdate(i,t.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var o=n.updateQueue;null!==o&&Ha(n,o,r);break;case 3:var s=n.updateQueue;if(null!==s){if(t=null,null!==n.child)switch(n.child.tag){case 5:case 1:t=n.child.stateNode}Ha(n,s,t)}break;case 5:var l=n.stateNode;if(null===t&&4&n.flags){t=l;var c=n.memoizedProps;switch(n.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&t.focus();break;case"img":c.src&&(t.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===n.memoizedState){var u=n.alternate;if(null!==u){var d=u.memoizedState;if(null!==d){var m=d.dehydrated;null!==m&&Hn(m)}}}break;default:throw Error(a(163))}Qs||512&n.flags&&rl(n)}catch(e){jc(n,n.return,e)}}if(n===e){Xs=null;break}if(null!==(t=n.sibling)){t.return=n.return,Xs=t;break}Xs=n.return}}function yl(e){for(;null!==Xs;){var n=Xs;if(n===e){Xs=null;break}var t=n.sibling;if(null!==t){t.return=n.return,Xs=t;break}Xs=n.return}}function kl(e){for(;null!==Xs;){var n=Xs;try{switch(n.tag){case 0:case 11:case 15:var t=n.return;try{tl(4,n)}catch(e){jc(n,t,e)}break;case 1:var r=n.stateNode;if("function"==typeof r.componentDidMount){var i=n.return;try{r.componentDidMount()}catch(e){jc(n,i,e)}}var a=n.return;try{rl(n)}catch(e){jc(n,a,e)}break;case 5:var o=n.return;try{rl(n)}catch(e){jc(n,o,e)}}}catch(e){jc(n,n.return,e)}if(n===e){Xs=null;break}var s=n.sibling;if(null!==s){s.return=n.return,Xs=s;break}Xs=n.return}}var wl,jl=Math.ceil,Sl=y.ReactCurrentDispatcher,Cl=y.ReactCurrentOwner,Nl=y.ReactCurrentBatchConfig,Pl=0,El=null,Ol=null,Ml=0,zl=0,Tl=Si(0),Il=0,Ll=null,Dl=0,Al=0,Rl=0,Bl=null,_l=null,Ul=0,Fl=1/0,Wl=null,Hl=!1,Vl=null,ql=null,$l=!1,Yl=null,Kl=0,Ql=0,Gl=null,Xl=-1,Zl=0;function Jl(){return 6&Pl?Xe():-1!==Xl?Xl:Xl=Xe()}function ec(e){return 1&e.mode?2&Pl&&0!==Ml?Ml&-Ml:null!==va.transition?(0===Zl&&(Zl=hn()),Zl):0!==(e=yn)?e:e=void 0===(e=window.event)?16:Xn(e.type):1}function nc(e,n,t,r){if(50<Ql)throw Ql=0,Gl=null,Error(a(185));bn(e,t,r),2&Pl&&e===El||(e===El&&(!(2&Pl)&&(Al|=t),4===Il&&oc(e,Ml)),tc(e,r),1===t&&0===Pl&&!(1&n.mode)&&(Fl=Xe()+500,_i&&Wi()))}function tc(e,n){var t=e.callbackNode;!function(e,n){for(var t=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,a=e.pendingLanes;0<a;){var o=31-sn(a),s=1<<o,l=i[o];-1===l?0!==(s&t)&&0===(s&r)||(i[o]=gn(s,n)):l<=n&&(e.expiredLanes|=s),a&=~s}}(e,n);var r=pn(e,e===El?Ml:0);if(0===r)null!==t&&Ke(t),e.callbackNode=null,e.callbackPriority=0;else if(n=r&-r,e.callbackPriority!==n){if(null!=t&&Ke(t),1===n)0===e.tag?function(e){_i=!0,Fi(e)}(sc.bind(null,e)):Fi(sc.bind(null,e)),oi(function(){!(6&Pl)&&Wi()}),t=null;else{switch(kn(r)){case 1:t=Je;break;case 4:t=en;break;case 16:default:t=nn;break;case 536870912:t=rn}t=Ec(t,rc.bind(null,e))}e.callbackPriority=n,e.callbackNode=t}}function rc(e,n){if(Xl=-1,Zl=0,6&Pl)throw Error(a(327));var t=e.callbackNode;if(kc()&&e.callbackNode!==t)return null;var r=pn(e,e===El?Ml:0);if(0===r)return null;if(30&r||0!==(r&e.expiredLanes)||n)n=vc(e,r);else{n=r;var i=Pl;Pl|=2;var o=pc();for(El===e&&Ml===n||(Wl=null,Fl=Xe()+500,dc(e,n));;)try{fc();break}catch(n){mc(e,n)}Na(),Sl.current=o,Pl=i,null!==Ol?n=0:(El=null,Ml=0,n=Il)}if(0!==n){if(2===n&&(0!==(i=vn(e))&&(r=i,n=ic(e,i))),1===n)throw t=Ll,dc(e,0),oc(e,r),tc(e,Xe()),t;if(6===n)oc(e,r);else{if(i=e.current.alternate,!(30&r||function(e){for(var n=e;;){if(16384&n.flags){var t=n.updateQueue;if(null!==t&&null!==(t=t.stores))for(var r=0;r<t.length;r++){var i=t[r],a=i.getSnapshot;i=i.value;try{if(!sr(a(),i))return!1}catch(e){return!1}}}if(t=n.child,16384&n.subtreeFlags&&null!==t)t.return=n,n=t;else{if(n===e)break;for(;null===n.sibling;){if(null===n.return||n.return===e)return!0;n=n.return}n.sibling.return=n.return,n=n.sibling}}return!0}(i)||(n=vc(e,r),2===n&&(o=vn(e),0!==o&&(r=o,n=ic(e,o))),1!==n)))throw t=Ll,dc(e,0),oc(e,r),tc(e,Xe()),t;switch(e.finishedWork=i,e.finishedLanes=r,n){case 0:case 1:throw Error(a(345));case 2:case 5:yc(e,_l,Wl);break;case 3:if(oc(e,r),(130023424&r)===r&&10<(n=Ul+500-Xe())){if(0!==pn(e,0))break;if(((i=e.suspendedLanes)&r)!==r){Jl(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=ri(yc.bind(null,e,_l,Wl),n);break}yc(e,_l,Wl);break;case 4:if(oc(e,r),(4194240&r)===r)break;for(n=e.eventTimes,i=-1;0<r;){var s=31-sn(r);o=1<<s,(s=n[s])>i&&(i=s),r&=~o}if(r=i,10<(r=(120>(r=Xe()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*jl(r/1960))-r)){e.timeoutHandle=ri(yc.bind(null,e,_l,Wl),r);break}yc(e,_l,Wl);break;default:throw Error(a(329))}}}return tc(e,Xe()),e.callbackNode===t?rc.bind(null,e):null}function ic(e,n){var t=Bl;return e.current.memoizedState.isDehydrated&&(dc(e,n).flags|=256),2!==(e=vc(e,n))&&(n=_l,_l=t,null!==n&&ac(n)),e}function ac(e){null===_l?_l=e:_l.push.apply(_l,e)}function oc(e,n){for(n&=~Rl,n&=~Al,e.suspendedLanes|=n,e.pingedLanes&=~n,e=e.expirationTimes;0<n;){var t=31-sn(n),r=1<<t;e[t]=-1,n&=~r}}function sc(e){if(6&Pl)throw Error(a(327));kc();var n=pn(e,0);if(!(1&n))return tc(e,Xe()),null;var t=vc(e,n);if(0!==e.tag&&2===t){var r=vn(e);0!==r&&(n=r,t=ic(e,r))}if(1===t)throw t=Ll,dc(e,0),oc(e,n),tc(e,Xe()),t;if(6===t)throw Error(a(345));return e.finishedWork=e.current.alternate,e.finishedLanes=n,yc(e,_l,Wl),tc(e,Xe()),null}function lc(e,n){var t=Pl;Pl|=1;try{return e(n)}finally{0===(Pl=t)&&(Fl=Xe()+500,_i&&Wi())}}function cc(e){null!==Yl&&0===Yl.tag&&!(6&Pl)&&kc();var n=Pl;Pl|=1;var t=Nl.transition,r=yn;try{if(Nl.transition=null,yn=1,e)return e()}finally{yn=r,Nl.transition=t,!(6&(Pl=n))&&Wi()}}function uc(){zl=Tl.current,Ci(Tl)}function dc(e,n){e.finishedWork=null,e.finishedLanes=0;var t=e.timeoutHandle;if(-1!==t&&(e.timeoutHandle=-1,ii(t)),null!==Ol)for(t=Ol.return;null!==t;){var r=t;switch(na(r),r.tag){case 1:null!=(r=r.type.childContextTypes)&&Ii();break;case 3:Ga(),Ci(Oi),Ci(Ei),to();break;case 5:Za(r);break;case 4:Ga();break;case 13:case 19:Ci(Ja);break;case 10:Pa(r.type._context);break;case 22:case 23:uc()}t=t.return}if(El=e,Ol=e=Tc(e.current,null),Ml=zl=n,Il=0,Ll=null,Rl=Al=Dl=0,_l=Bl=null,null!==za){for(n=0;n<za.length;n++)if(null!==(r=(t=za[n]).interleaved)){t.interleaved=null;var i=r.next,a=t.pending;if(null!==a){var o=a.next;a.next=i,r.next=o}t.pending=r}za=null}return e}function mc(e,n){for(;;){var t=Ol;try{if(Na(),ro.current=Zo,co){for(var r=oo.memoizedState;null!==r;){var i=r.queue;null!==i&&(i.pending=null),r=r.next}co=!1}if(ao=0,lo=so=oo=null,uo=!1,mo=0,Cl.current=null,null===t||null===t.return){Il=1,Ll=n,Ol=null;break}e:{var o=e,s=t.return,l=t,c=n;if(n=Ml,l.flags|=32768,null!==c&&"object"==typeof c&&"function"==typeof c.then){var u=c,d=l,m=d.tag;if(!(1&d.mode||0!==m&&11!==m&&15!==m)){var p=d.alternate;p?(d.updateQueue=p.updateQueue,d.memoizedState=p.memoizedState,d.lanes=p.lanes):(d.updateQueue=null,d.memoizedState=null)}var g=hs(s);if(null!==g){g.flags&=-257,fs(g,s,l,0,n),1&g.mode&&vs(o,u,n),c=u;var v=(n=g).updateQueue;if(null===v){var h=new Set;h.add(c),n.updateQueue=h}else v.add(c);break e}if(!(1&n)){vs(o,u,n),gc();break e}c=Error(a(426))}else if(ia&&1&l.mode){var f=hs(s);if(null!==f){!(65536&f.flags)&&(f.flags|=256),fs(f,s,l,0,n),ga(cs(c,l));break e}}o=c=cs(c,l),4!==Il&&(Il=2),null===Bl?Bl=[o]:Bl.push(o),o=s;do{switch(o.tag){case 3:o.flags|=65536,n&=-n,o.lanes|=n,Fa(o,ps(0,c,n));break e;case 1:l=c;var b=o.type,x=o.stateNode;if(!(128&o.flags||"function"!=typeof b.getDerivedStateFromError&&(null===x||"function"!=typeof x.componentDidCatch||null!==ql&&ql.has(x)))){o.flags|=65536,n&=-n,o.lanes|=n,Fa(o,gs(o,l,n));break e}}o=o.return}while(null!==o)}xc(t)}catch(e){n=e,Ol===t&&null!==t&&(Ol=t=t.return);continue}break}}function pc(){var e=Sl.current;return Sl.current=Zo,null===e?Zo:e}function gc(){0!==Il&&3!==Il&&2!==Il||(Il=4),null===El||!(268435455&Dl)&&!(268435455&Al)||oc(El,Ml)}function vc(e,n){var t=Pl;Pl|=2;var r=pc();for(El===e&&Ml===n||(Wl=null,dc(e,n));;)try{hc();break}catch(n){mc(e,n)}if(Na(),Pl=t,Sl.current=r,null!==Ol)throw Error(a(261));return El=null,Ml=0,Il}function hc(){for(;null!==Ol;)bc(Ol)}function fc(){for(;null!==Ol&&!Qe();)bc(Ol)}function bc(e){var n=wl(e.alternate,e,zl);e.memoizedProps=e.pendingProps,null===n?xc(e):Ol=n,Cl.current=null}function xc(e){var n=e;do{var t=n.alternate;if(e=n.return,32768&n.flags){if(null!==(t=Ys(t,n)))return t.flags&=32767,void(Ol=t);if(null===e)return Il=6,void(Ol=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}else if(null!==(t=$s(t,n,zl)))return void(Ol=t);if(null!==(n=n.sibling))return void(Ol=n);Ol=n=e}while(null!==n);0===Il&&(Il=5)}function yc(e,n,t){var r=yn,i=Nl.transition;try{Nl.transition=null,yn=1,function(e,n,t,r){do{kc()}while(null!==Yl);if(6&Pl)throw Error(a(327));t=e.finishedWork;var i=e.finishedLanes;if(null===t)return null;if(e.finishedWork=null,e.finishedLanes=0,t===e.current)throw Error(a(177));e.callbackNode=null,e.callbackPriority=0;var o=t.lanes|t.childLanes;if(function(e,n){var t=e.pendingLanes&~n;e.pendingLanes=n,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=n,e.mutableReadLanes&=n,e.entangledLanes&=n,n=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<t;){var i=31-sn(t),a=1<<i;n[i]=0,r[i]=-1,e[i]=-1,t&=~a}}(e,o),e===El&&(Ol=El=null,Ml=0),!(2064&t.subtreeFlags)&&!(2064&t.flags)||$l||($l=!0,Ec(nn,function(){return kc(),null})),o=!!(15990&t.flags),!!(15990&t.subtreeFlags)||o){o=Nl.transition,Nl.transition=null;var s=yn;yn=1;var l=Pl;Pl|=4,Cl.current=null,function(e,n){if(ei=qn,pr(e=mr())){if("selectionStart"in e)var t={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(t=(t=e.ownerDocument)&&t.defaultView||window).getSelection&&t.getSelection();if(r&&0!==r.rangeCount){t=r.anchorNode;var i=r.anchorOffset,o=r.focusNode;r=r.focusOffset;try{t.nodeType,o.nodeType}catch(e){t=null;break e}var s=0,l=-1,c=-1,u=0,d=0,m=e,p=null;n:for(;;){for(var g;m!==t||0!==i&&3!==m.nodeType||(l=s+i),m!==o||0!==r&&3!==m.nodeType||(c=s+r),3===m.nodeType&&(s+=m.nodeValue.length),null!==(g=m.firstChild);)p=m,m=g;for(;;){if(m===e)break n;if(p===t&&++u===i&&(l=s),p===o&&++d===r&&(c=s),null!==(g=m.nextSibling))break;p=(m=p).parentNode}m=g}t=-1===l||-1===c?null:{start:l,end:c}}else t=null}t=t||{start:0,end:0}}else t=null;for(ni={focusedElem:e,selectionRange:t},qn=!1,Xs=n;null!==Xs;)if(e=(n=Xs).child,1028&n.subtreeFlags&&null!==e)e.return=n,Xs=e;else for(;null!==Xs;){n=Xs;try{var v=n.alternate;if(1024&n.flags)switch(n.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==v){var h=v.memoizedProps,f=v.memoizedState,b=n.stateNode,x=b.getSnapshotBeforeUpdate(n.elementType===n.type?h:ts(n.type,h),f);b.__reactInternalSnapshotBeforeUpdate=x}break;case 3:var y=n.stateNode.containerInfo;1===y.nodeType?y.textContent="":9===y.nodeType&&y.documentElement&&y.removeChild(y.documentElement);break;default:throw Error(a(163))}}catch(e){jc(n,n.return,e)}if(null!==(e=n.sibling)){e.return=n.return,Xs=e;break}Xs=n.return}v=el,el=!1}(e,t),vl(t,e),gr(ni),qn=!!ei,ni=ei=null,e.current=t,fl(t,e,i),Ge(),Pl=l,yn=s,Nl.transition=o}else e.current=t;if($l&&($l=!1,Yl=e,Kl=i),o=e.pendingLanes,0===o&&(ql=null),function(e){if(on&&"function"==typeof on.onCommitFiberRoot)try{on.onCommitFiberRoot(an,e,void 0,!(128&~e.current.flags))}catch(e){}}(t.stateNode),tc(e,Xe()),null!==n)for(r=e.onRecoverableError,t=0;t<n.length;t++)i=n[t],r(i.value,{componentStack:i.stack,digest:i.digest});if(Hl)throw Hl=!1,e=Vl,Vl=null,e;!!(1&Kl)&&0!==e.tag&&kc(),o=e.pendingLanes,1&o?e===Gl?Ql++:(Ql=0,Gl=e):Ql=0,Wi()}(e,n,t,r)}finally{Nl.transition=i,yn=r}return null}function kc(){if(null!==Yl){var e=kn(Kl),n=Nl.transition,t=yn;try{if(Nl.transition=null,yn=16>e?16:e,null===Yl)var r=!1;else{if(e=Yl,Yl=null,Kl=0,6&Pl)throw Error(a(331));var i=Pl;for(Pl|=4,Xs=e.current;null!==Xs;){var o=Xs,s=o.child;if(16&Xs.flags){var l=o.deletions;if(null!==l){for(var c=0;c<l.length;c++){var u=l[c];for(Xs=u;null!==Xs;){var d=Xs;switch(d.tag){case 0:case 11:case 15:nl(8,d,o)}var m=d.child;if(null!==m)m.return=d,Xs=m;else for(;null!==Xs;){var p=(d=Xs).sibling,g=d.return;if(il(d),d===u){Xs=null;break}if(null!==p){p.return=g,Xs=p;break}Xs=g}}}var v=o.alternate;if(null!==v){var h=v.child;if(null!==h){v.child=null;do{var f=h.sibling;h.sibling=null,h=f}while(null!==h)}}Xs=o}}if(2064&o.subtreeFlags&&null!==s)s.return=o,Xs=s;else e:for(;null!==Xs;){if(2048&(o=Xs).flags)switch(o.tag){case 0:case 11:case 15:nl(9,o,o.return)}var b=o.sibling;if(null!==b){b.return=o.return,Xs=b;break e}Xs=o.return}}var x=e.current;for(Xs=x;null!==Xs;){var y=(s=Xs).child;if(2064&s.subtreeFlags&&null!==y)y.return=s,Xs=y;else e:for(s=x;null!==Xs;){if(2048&(l=Xs).flags)try{switch(l.tag){case 0:case 11:case 15:tl(9,l)}}catch(e){jc(l,l.return,e)}if(l===s){Xs=null;break e}var k=l.sibling;if(null!==k){k.return=l.return,Xs=k;break e}Xs=l.return}}if(Pl=i,Wi(),on&&"function"==typeof on.onPostCommitFiberRoot)try{on.onPostCommitFiberRoot(an,e)}catch(e){}r=!0}return r}finally{yn=t,Nl.transition=n}}return!1}function wc(e,n,t){e=_a(e,n=ps(0,n=cs(t,n),1),1),n=Jl(),null!==e&&(bn(e,1,n),tc(e,n))}function jc(e,n,t){if(3===e.tag)wc(e,e,t);else for(;null!==n;){if(3===n.tag){wc(n,e,t);break}if(1===n.tag){var r=n.stateNode;if("function"==typeof n.type.getDerivedStateFromError||"function"==typeof r.componentDidCatch&&(null===ql||!ql.has(r))){n=_a(n,e=gs(n,e=cs(t,e),1),1),e=Jl(),null!==n&&(bn(n,1,e),tc(n,e));break}}n=n.return}}function Sc(e,n,t){var r=e.pingCache;null!==r&&r.delete(n),n=Jl(),e.pingedLanes|=e.suspendedLanes&t,El===e&&(Ml&t)===t&&(4===Il||3===Il&&(130023424&Ml)===Ml&&500>Xe()-Ul?dc(e,0):Rl|=t),tc(e,n)}function Cc(e,n){0===n&&(1&e.mode?(n=dn,!(130023424&(dn<<=1))&&(dn=4194304)):n=1);var t=Jl();null!==(e=La(e,n))&&(bn(e,n,t),tc(e,t))}function Nc(e){var n=e.memoizedState,t=0;null!==n&&(t=n.retryLane),Cc(e,t)}function Pc(e,n){var t=0;switch(e.tag){case 13:var r=e.stateNode,i=e.memoizedState;null!==i&&(t=i.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(a(314))}null!==r&&r.delete(n),Cc(e,t)}function Ec(e,n){return Ye(e,n)}function Oc(e,n,t,r){this.tag=e,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=n,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Mc(e,n,t,r){return new Oc(e,n,t,r)}function zc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Tc(e,n){var t=e.alternate;return null===t?((t=Mc(e.tag,n,e.key,e.mode)).elementType=e.elementType,t.type=e.type,t.stateNode=e.stateNode,t.alternate=e,e.alternate=t):(t.pendingProps=n,t.type=e.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=14680064&e.flags,t.childLanes=e.childLanes,t.lanes=e.lanes,t.child=e.child,t.memoizedProps=e.memoizedProps,t.memoizedState=e.memoizedState,t.updateQueue=e.updateQueue,n=e.dependencies,t.dependencies=null===n?null:{lanes:n.lanes,firstContext:n.firstContext},t.sibling=e.sibling,t.index=e.index,t.ref=e.ref,t}function Ic(e,n,t,r,i,o){var s=2;if(r=e,"function"==typeof e)zc(e)&&(s=1);else if("string"==typeof e)s=5;else e:switch(e){case j:return Lc(t.children,i,o,n);case S:s=8,i|=8;break;case C:return(e=Mc(12,t,n,2|i)).elementType=C,e.lanes=o,e;case O:return(e=Mc(13,t,n,i)).elementType=O,e.lanes=o,e;case M:return(e=Mc(19,t,n,i)).elementType=M,e.lanes=o,e;case I:return Dc(t,i,o,n);default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case N:s=10;break e;case P:s=9;break e;case E:s=11;break e;case z:s=14;break e;case T:s=16,r=null;break e}throw Error(a(130,null==e?e:typeof e,""))}return(n=Mc(s,t,n,i)).elementType=e,n.type=r,n.lanes=o,n}function Lc(e,n,t,r){return(e=Mc(7,e,r,n)).lanes=t,e}function Dc(e,n,t,r){return(e=Mc(22,e,r,n)).elementType=I,e.lanes=t,e.stateNode={isHidden:!1},e}function Ac(e,n,t){return(e=Mc(6,e,null,n)).lanes=t,e}function Rc(e,n,t){return(n=Mc(4,null!==e.children?e.children:[],e.key,n)).lanes=t,n.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},n}function Bc(e,n,t,r,i){this.tag=n,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=fn(0),this.expirationTimes=fn(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=fn(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function _c(e,n,t,r,i,a,o,s,l){return e=new Bc(e,n,t,s,l),1===n?(n=1,!0===a&&(n|=8)):n=0,a=Mc(3,null,null,n),e.current=a,a.stateNode=e,a.memoizedState={element:r,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},Aa(a),e}function Uc(e){if(!e)return Pi;e:{if(We(e=e._reactInternals)!==e||1!==e.tag)throw Error(a(170));var n=e;do{switch(n.tag){case 3:n=n.stateNode.context;break e;case 1:if(Ti(n.type)){n=n.stateNode.__reactInternalMemoizedMergedChildContext;break e}}n=n.return}while(null!==n);throw Error(a(171))}if(1===e.tag){var t=e.type;if(Ti(t))return Di(e,t,n)}return n}function Fc(e,n,t,r,i,a,o,s,l){return(e=_c(t,r,!0,e,0,a,0,s,l)).context=Uc(null),t=e.current,(a=Ba(r=Jl(),i=ec(t))).callback=null!=n?n:null,_a(t,a,i),e.current.lanes=i,bn(e,i,r),tc(e,r),e}function Wc(e,n,t,r){var i=n.current,a=Jl(),o=ec(i);return t=Uc(t),null===n.context?n.context=t:n.pendingContext=t,(n=Ba(a,o)).payload={element:e},null!==(r=void 0===r?null:r)&&(n.callback=r),null!==(e=_a(i,n,o))&&(nc(e,i,o,a),Ua(e,i,o)),o}function Hc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Vc(e,n){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var t=e.retryLane;e.retryLane=0!==t&&t<n?t:n}}function qc(e,n){Vc(e,n),(e=e.alternate)&&Vc(e,n)}wl=function(e,n,t){if(null!==e)if(e.memoizedProps!==n.pendingProps||Oi.current)xs=!0;else{if(0===(e.lanes&t)&&!(128&n.flags))return xs=!1,function(e,n,t){switch(n.tag){case 3:Os(n),pa();break;case 5:Xa(n);break;case 1:Ti(n.type)&&Ai(n);break;case 4:Qa(n,n.stateNode.containerInfo);break;case 10:var r=n.type._context,i=n.memoizedProps.value;Ni(wa,r._currentValue),r._currentValue=i;break;case 13:if(null!==(r=n.memoizedState))return null!==r.dehydrated?(Ni(Ja,1&Ja.current),n.flags|=128,null):0!==(t&n.child.childLanes)?As(e,n,t):(Ni(Ja,1&Ja.current),null!==(e=Hs(e,n,t))?e.sibling:null);Ni(Ja,1&Ja.current);break;case 19:if(r=0!==(t&n.childLanes),128&e.flags){if(r)return Fs(e,n,t);n.flags|=128}if(null!==(i=n.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),Ni(Ja,Ja.current),r)break;return null;case 22:case 23:return n.lanes=0,Ss(e,n,t)}return Hs(e,n,t)}(e,n,t);xs=!!(131072&e.flags)}else xs=!1,ia&&1048576&n.flags&&Ji(n,$i,n.index);switch(n.lanes=0,n.tag){case 2:var r=n.type;Ws(e,n),e=n.pendingProps;var i=zi(n,Ei.current);Oa(n,t),i=ho(null,n,r,e,i,t);var o=fo();return n.flags|=1,"object"==typeof i&&null!==i&&"function"==typeof i.render&&void 0===i.$$typeof?(n.tag=1,n.memoizedState=null,n.updateQueue=null,Ti(r)?(o=!0,Ai(n)):o=!1,n.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,Aa(n),i.updater=is,n.stateNode=i,i._reactInternals=n,ls(n,r,e,t),n=Es(null,n,r,!0,o,t)):(n.tag=0,ia&&o&&ea(n),ys(null,n,i,t),n=n.child),n;case 16:r=n.elementType;e:{switch(Ws(e,n),e=n.pendingProps,r=(i=r._init)(r._payload),n.type=r,i=n.tag=function(e){if("function"==typeof e)return zc(e)?1:0;if(null!=e){if((e=e.$$typeof)===E)return 11;if(e===z)return 14}return 2}(r),e=ts(r,e),i){case 0:n=Ns(null,n,r,e,t);break e;case 1:n=Ps(null,n,r,e,t);break e;case 11:n=ks(null,n,r,e,t);break e;case 14:n=ws(null,n,r,ts(r.type,e),t);break e}throw Error(a(306,r,""))}return n;case 0:return r=n.type,i=n.pendingProps,Ns(e,n,r,i=n.elementType===r?i:ts(r,i),t);case 1:return r=n.type,i=n.pendingProps,Ps(e,n,r,i=n.elementType===r?i:ts(r,i),t);case 3:e:{if(Os(n),null===e)throw Error(a(387));r=n.pendingProps,i=(o=n.memoizedState).element,Ra(e,n),Wa(n,r,null,t);var s=n.memoizedState;if(r=s.element,o.isDehydrated){if(o={element:r,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},n.updateQueue.baseState=o,n.memoizedState=o,256&n.flags){n=Ms(e,n,r,t,i=cs(Error(a(423)),n));break e}if(r!==i){n=Ms(e,n,r,t,i=cs(Error(a(424)),n));break e}for(ra=ci(n.stateNode.containerInfo.firstChild),ta=n,ia=!0,aa=null,t=ka(n,null,r,t),n.child=t;t;)t.flags=-3&t.flags|4096,t=t.sibling}else{if(pa(),r===i){n=Hs(e,n,t);break e}ys(e,n,r,t)}n=n.child}return n;case 5:return Xa(n),null===e&&ca(n),r=n.type,i=n.pendingProps,o=null!==e?e.memoizedProps:null,s=i.children,ti(r,i)?s=null:null!==o&&ti(r,o)&&(n.flags|=32),Cs(e,n),ys(e,n,s,t),n.child;case 6:return null===e&&ca(n),null;case 13:return As(e,n,t);case 4:return Qa(n,n.stateNode.containerInfo),r=n.pendingProps,null===e?n.child=ya(n,null,r,t):ys(e,n,r,t),n.child;case 11:return r=n.type,i=n.pendingProps,ks(e,n,r,i=n.elementType===r?i:ts(r,i),t);case 7:return ys(e,n,n.pendingProps,t),n.child;case 8:case 12:return ys(e,n,n.pendingProps.children,t),n.child;case 10:e:{if(r=n.type._context,i=n.pendingProps,o=n.memoizedProps,s=i.value,Ni(wa,r._currentValue),r._currentValue=s,null!==o)if(sr(o.value,s)){if(o.children===i.children&&!Oi.current){n=Hs(e,n,t);break e}}else for(null!==(o=n.child)&&(o.return=n);null!==o;){var l=o.dependencies;if(null!==l){s=o.child;for(var c=l.firstContext;null!==c;){if(c.context===r){if(1===o.tag){(c=Ba(-1,t&-t)).tag=2;var u=o.updateQueue;if(null!==u){var d=(u=u.shared).pending;null===d?c.next=c:(c.next=d.next,d.next=c),u.pending=c}}o.lanes|=t,null!==(c=o.alternate)&&(c.lanes|=t),Ea(o.return,t,n),l.lanes|=t;break}c=c.next}}else if(10===o.tag)s=o.type===n.type?null:o.child;else if(18===o.tag){if(null===(s=o.return))throw Error(a(341));s.lanes|=t,null!==(l=s.alternate)&&(l.lanes|=t),Ea(s,t,n),s=o.sibling}else s=o.child;if(null!==s)s.return=o;else for(s=o;null!==s;){if(s===n){s=null;break}if(null!==(o=s.sibling)){o.return=s.return,s=o;break}s=s.return}o=s}ys(e,n,i.children,t),n=n.child}return n;case 9:return i=n.type,r=n.pendingProps.children,Oa(n,t),r=r(i=Ma(i)),n.flags|=1,ys(e,n,r,t),n.child;case 14:return i=ts(r=n.type,n.pendingProps),ws(e,n,r,i=ts(r.type,i),t);case 15:return js(e,n,n.type,n.pendingProps,t);case 17:return r=n.type,i=n.pendingProps,i=n.elementType===r?i:ts(r,i),Ws(e,n),n.tag=1,Ti(r)?(e=!0,Ai(n)):e=!1,Oa(n,t),os(n,r,i),ls(n,r,i,t),Es(null,n,r,!0,e,t);case 19:return Fs(e,n,t);case 22:return Ss(e,n,t)}throw Error(a(156,n.tag))};var $c="function"==typeof reportError?reportError:function(e){console.error(e)};function Yc(e){this._internalRoot=e}function Kc(e){this._internalRoot=e}function Qc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Gc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Xc(){}function Zc(e,n,t,r,i){var a=t._reactRootContainer;if(a){var o=a;if("function"==typeof i){var s=i;i=function(){var e=Hc(o);s.call(e)}}Wc(n,o,e,i)}else o=function(e,n,t,r,i){if(i){if("function"==typeof r){var a=r;r=function(){var e=Hc(o);a.call(e)}}var o=Fc(n,r,e,0,null,!1,0,"",Xc);return e._reactRootContainer=o,e[gi]=o.current,Wr(8===e.nodeType?e.parentNode:e),cc(),o}for(;i=e.lastChild;)e.removeChild(i);if("function"==typeof r){var s=r;r=function(){var e=Hc(l);s.call(e)}}var l=_c(e,0,!1,null,0,!1,0,"",Xc);return e._reactRootContainer=l,e[gi]=l.current,Wr(8===e.nodeType?e.parentNode:e),cc(function(){Wc(n,l,t,r)}),l}(t,n,e,i,r);return Hc(o)}Kc.prototype.render=Yc.prototype.render=function(e){var n=this._internalRoot;if(null===n)throw Error(a(409));Wc(e,n,null,null)},Kc.prototype.unmount=Yc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var n=e.containerInfo;cc(function(){Wc(null,e,null,null)}),n[gi]=null}},Kc.prototype.unstable_scheduleHydration=function(e){if(e){var n=Cn();e={blockedOn:null,target:e,priority:n};for(var t=0;t<Ln.length&&0!==n&&n<Ln[t].priority;t++);Ln.splice(t,0,e),0===t&&Bn(e)}},wn=function(e){switch(e.tag){case 3:var n=e.stateNode;if(n.current.memoizedState.isDehydrated){var t=mn(n.pendingLanes);0!==t&&(xn(n,1|t),tc(n,Xe()),!(6&Pl)&&(Fl=Xe()+500,Wi()))}break;case 13:cc(function(){var n=La(e,1);if(null!==n){var t=Jl();nc(n,e,1,t)}}),qc(e,1)}},jn=function(e){if(13===e.tag){var n=La(e,134217728);if(null!==n)nc(n,e,134217728,Jl());qc(e,134217728)}},Sn=function(e){if(13===e.tag){var n=ec(e),t=La(e,n);if(null!==t)nc(t,e,n,Jl());qc(e,n)}},Cn=function(){return yn},Nn=function(e,n){var t=yn;try{return yn=e,n()}finally{yn=t}},we=function(e,n,t){switch(n){case"input":if(Z(e,t),n=t.name,"radio"===t.type&&null!=n){for(t=e;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+n)+'][type="radio"]'),n=0;n<t.length;n++){var r=t[n];if(r!==e&&r.form===e.form){var i=ki(r);if(!i)throw Error(a(90));Y(r),Z(r,i)}}}break;case"textarea":ae(e,t);break;case"select":null!=(n=t.value)&&te(e,!!t.multiple,n,!1)}},Ee=lc,Oe=cc;var Jc={usingClientEntryPoint:!1,Events:[xi,yi,ki,Ne,Pe,lc]},eu={findFiberByHostInstance:bi,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},nu={bundleType:eu.bundleType,version:eu.version,rendererPackageName:eu.rendererPackageName,rendererConfig:eu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:y.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=qe(e))?null:e.stateNode},findFiberByHostInstance:eu.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var tu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!tu.isDisabled&&tu.supportsFiber)try{an=tu.inject(nu),on=tu}catch(ue){}}n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Jc,n.createPortal=function(e,n){var t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Qc(n))throw Error(a(200));return function(e,n,t){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:w,key:null==r?null:""+r,children:e,containerInfo:n,implementation:t}}(e,n,null,t)},n.createRoot=function(e,n){if(!Qc(e))throw Error(a(299));var t=!1,r="",i=$c;return null!=n&&(!0===n.unstable_strictMode&&(t=!0),void 0!==n.identifierPrefix&&(r=n.identifierPrefix),void 0!==n.onRecoverableError&&(i=n.onRecoverableError)),n=_c(e,1,!1,null,0,t,0,r,i),e[gi]=n.current,Wr(8===e.nodeType?e.parentNode:e),new Yc(n)},n.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var n=e._reactInternals;if(void 0===n){if("function"==typeof e.render)throw Error(a(188));throw e=Object.keys(e).join(","),Error(a(268,e))}return e=null===(e=qe(n))?null:e.stateNode},n.flushSync=function(e){return cc(e)},n.hydrate=function(e,n,t){if(!Gc(n))throw Error(a(200));return Zc(null,e,n,!0,t)},n.hydrateRoot=function(e,n,t){if(!Qc(e))throw Error(a(405));var r=null!=t&&t.hydratedSources||null,i=!1,o="",s=$c;if(null!=t&&(!0===t.unstable_strictMode&&(i=!0),void 0!==t.identifierPrefix&&(o=t.identifierPrefix),void 0!==t.onRecoverableError&&(s=t.onRecoverableError)),n=Fc(n,null,e,1,null!=t?t:null,i,0,o,s),e[gi]=n.current,Wr(e),r)for(e=0;e<r.length;e++)i=(i=(t=r[e])._getVersion)(t._source),null==n.mutableSourceEagerHydrationData?n.mutableSourceEagerHydrationData=[t,i]:n.mutableSourceEagerHydrationData.push(t,i);return new Kc(n)},n.render=function(e,n,t){if(!Gc(n))throw Error(a(200));return Zc(null,e,n,!1,t)},n.unmountComponentAtNode=function(e){if(!Gc(e))throw Error(a(40));return!!e._reactRootContainer&&(cc(function(){Zc(null,null,e,!1,function(){e._reactRootContainer=null,e[gi]=null})}),!0)},n.unstable_batchedUpdates=lc,n.unstable_renderSubtreeIntoContainer=function(e,n,t,r){if(!Gc(t))throw Error(a(200));if(null==e||void 0===e._reactInternals)throw Error(a(38));return Zc(e,n,t,!1,r)},n.version="18.3.1-next-f1338f8080-20240426"},601(e){e.exports=function(e){return e[1]}},659(e){var n={};e.exports=function(e,t){var r=function(e){if(void 0===n[e]){var t=document.querySelector(e);if(window.HTMLIFrameElement&&t instanceof window.HTMLIFrameElement)try{t=t.contentDocument.head}catch(e){t=null}n[e]=t}return n[e]}(e);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(t)}},674(e,n,t){t.d(n,{$U:()=>O,DZ:()=>E,HT:()=>h,Ll:()=>b,M5:()=>C,O9:()=>P,SF:()=>L,Wx:()=>U,X7:()=>B,bs:()=>I,el:()=>A,flushPendingSaves:()=>R,ho:()=>f,jl:()=>z,mt:()=>v,nQ:()=>T,pW:()=>l,qG:()=>M,sI:()=>_,xg:()=>N,zA:()=>u,zG:()=>D});var r=t(92),i=t(699);function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach(function(n){s(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function s(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const l="lumia-injector",c="lumia_injector_settings",u="loom_summary",d=0,m={schemaVersion:2,packs:{},selectedDefinition:null,selectedBehaviors:[],selectedPersonalities:[],dominantBehavior:null,dominantPersonality:null,selectedLoomStyle:[],selectedLoomUtils:[],selectedLoomRetrofits:[],presets:{},activePresetName:null,chimeraMode:!1,selectedDefinitions:[],councilMode:!1,councilMembers:[],lumiaQuirks:"",stateSynthesis:{enabled:!1},lumiaOOCInterval:null,lumiaOOCStyle:"social",sovereignHand:{enabled:!1,excludeLastMessage:!0,includeMessageInPrompt:!0},contextFilters:{htmlTags:{enabled:!1,keepDepth:3,stripFonts:!1,fontKeepDepth:3},detailsBlocks:{enabled:!1,keepDepth:3},loomItems:{enabled:!1,keepDepth:5}},messageTruncation:{enabled:!1,keepCount:50},summarization:{mode:"disabled",apiSource:"main",autoInterval:10,autoMessageContext:10,manualMessageContext:10,secondary:{provider:"openai",model:"",endpoint:"",apiKey:"",temperature:.7,topP:1,maxTokens:8192}},lumiaConfigVersion:1,lastLumiaChangeTimestamp:null,disableAnthropicCache:!1,trackedPresets:{},dismissedUpdateVersion:null,lumiaButtonPosition:{useDefault:!0,xPercent:1,yPercent:1}};let p=o({},m),g=null;function v(){return p}function h(){return g}function f(e){g=e}function b(){g=null}function x(e){return{lumiaName:e.lumiaDefName,lumiaDefinition:e.lumiaDef||null,lumiaPersonality:e.lumia_personality||null,lumiaBehavior:e.lumia_behavior||null,avatarUrl:e.lumia_img||null,genderIdentity:d,authorName:e.defAuthor||null,version:1}}function y(e){return{loomName:e.loomName,loomContent:e.loomContent,loomCategory:e.loomCategory,authorName:null,version:1}}function k(e){const n=[],t=[];for(const r of e.items||[])r.lumiaDefName?n.push(x(r)):r.loomCategory&&t.push(y(r));return{packName:e.name||e.packName,packAuthor:e.author||e.packAuthor||null,coverUrl:e.coverUrl||null,version:1,packExtras:e.packExtras||[],lumiaItems:n,loomItems:t,isCustom:e.isCustom||!1,url:e.url||""}}function w(){let e=!1;if((p.lumiaLibrary||p.worldBookData)&&0===Object.keys(p.packs).length){console.log("Lumia Injector: Migrating legacy settings...");let n=p.lumiaLibrary||[];if(0===n.length&&p.worldBookData&&console.warn("Legacy worldBookData found but cannot be migrated automatically. Please re-import your world book."),n.length>0){const t="Default (Legacy)";p.packs[t]={name:t,items:n,url:p.worldBookUrl||"Legacy"};const r=e=>{var t;return null===(t=n[e])||void 0===t?void 0:t.lumiaDefName};if("number"==typeof p.selectedDefinition){const e=r(p.selectedDefinition);p.selectedDefinition=e?{packName:t,itemName:e}:null}Array.isArray(p.selectedBehaviors)&&p.selectedBehaviors.length>0&&"number"==typeof p.selectedBehaviors[0]?p.selectedBehaviors=p.selectedBehaviors.map(e=>{const n=r(e);return n?{packName:t,itemName:n}:null}).filter(e=>e):p.selectedBehaviors=[],Array.isArray(p.selectedPersonalities)&&p.selectedPersonalities.length>0&&"number"==typeof p.selectedPersonalities[0]?p.selectedPersonalities=p.selectedPersonalities.map(e=>{const n=r(e);return n?{packName:t,itemName:n}:null}).filter(e=>e):p.selectedPersonalities=[],delete p.lumiaLibrary,delete p.worldBookData,delete p.worldBookUrl,e=!0}}(function(){let e=!1;const n=p.schemaVersion||1;if(n>=2)return!1;console.log("[".concat(l,"] Migrating packs from schema v").concat(n," to v").concat(2,"..."));for(const n in p.packs){const t=p.packs[n];!t.items||t.lumiaItems||t.loomItems||(console.log("[".concat(l,"] Migrating pack: ").concat(n)),p.packs[n]=k(t),e=!0)}return p.schemaVersion=2,e&&console.log("[".concat(l,"] Pack migration complete")),e})()&&(e=!0);for(const n in p.packs){const t=p.packs[n];t.url?!0===t.isCustom&&(console.log("[".concat(l,"] Fixing isCustom flag for URL pack: ").concat(n)),t.isCustom=!1,e=!0):!0!==t.isCustom&&(console.log("[".concat(l,"] Fixing isCustom flag for local pack: ").concat(n)),t.isCustom=!0,e=!0)}return p.schemaVersion||(p.schemaVersion=2),p.packs||(p.packs={}),p.selectedBehaviors||(p.selectedBehaviors=[]),p.selectedPersonalities||(p.selectedPersonalities=[]),void 0===p.dominantBehavior&&(p.dominantBehavior=null),void 0===p.dominantPersonality&&(p.dominantPersonality=null),p.selectedLoomUtils||(p.selectedLoomUtils=[]),p.selectedLoomRetrofits||(p.selectedLoomRetrofits=[]),void 0===p.lumiaOOCInterval&&(p.lumiaOOCInterval=null),p.lumiaOOCStyle||(p.lumiaOOCStyle="social"),p.sovereignHand||(p.sovereignHand={enabled:!1,excludeLastMessage:!0,includeMessageInPrompt:!0}),void 0===p.sovereignHand.excludeLastMessage&&(p.sovereignHand.excludeLastMessage=!0),void 0===p.sovereignHand.includeMessageInPrompt&&(p.sovereignHand.includeMessageInPrompt=!0),p.contextFilters||(p.contextFilters={htmlTags:{enabled:!1,stripFonts:!1,fontKeepDepth:3},detailsBlocks:{enabled:!1,keepDepth:3},loomItems:{enabled:!1,keepDepth:5}}),p.contextFilters.htmlTags||(p.contextFilters.htmlTags={enabled:!1,keepDepth:3,stripFonts:!1,fontKeepDepth:3}),void 0===p.contextFilters.htmlTags.keepDepth&&(p.contextFilters.htmlTags.keepDepth=3),void 0===p.contextFilters.htmlTags.stripFonts&&(p.contextFilters.htmlTags.stripFonts=!1),void 0===p.contextFilters.htmlTags.fontKeepDepth&&(p.contextFilters.htmlTags.fontKeepDepth=3),p.contextFilters.detailsBlocks||(p.contextFilters.detailsBlocks={enabled:!1,keepDepth:3}),void 0===p.contextFilters.detailsBlocks.keepDepth&&(p.contextFilters.detailsBlocks.keepDepth=3),p.contextFilters.loomItems||(p.contextFilters.loomItems={enabled:!1,keepDepth:5}),void 0===p.contextFilters.loomItems.keepDepth&&(p.contextFilters.loomItems.keepDepth=5),p.messageTruncation||(p.messageTruncation={enabled:!1,keepCount:50}),void 0===p.messageTruncation.keepCount&&(p.messageTruncation.keepCount=50),p.summarization||(p.summarization={mode:"disabled",apiSource:"main",autoInterval:10,autoMessageContext:10,manualMessageContext:10,secondary:{provider:"openai",model:"",endpoint:"",apiKey:"",temperature:.7,topP:1,maxTokens:8192}}),void 0!==p.summarization.messageContext&&(p.summarization.autoMessageContext=p.summarization.messageContext,p.summarization.manualMessageContext=p.summarization.messageContext,delete p.summarization.messageContext,e=!0),void 0===p.summarization.autoMessageContext&&(p.summarization.autoMessageContext=10),void 0===p.summarization.manualMessageContext&&(p.summarization.manualMessageContext=10),p.summarization.secondary||(p.summarization.secondary={provider:"openai",model:"",endpoint:"",apiKey:"",temperature:.7,topP:1,maxTokens:8192}),void 0===p.summarization.secondary.topP&&(p.summarization.secondary.topP=1),(!p.summarization.secondary.maxTokens||p.summarization.secondary.maxTokens<256)&&(p.summarization.secondary.maxTokens=8192),p.presets||(p.presets={}),void 0===p.activePresetName&&(p.activePresetName=null),void 0===p.chimeraMode&&(p.chimeraMode=!1),p.selectedDefinitions||(p.selectedDefinitions=[]),void 0===p.councilMode&&(p.councilMode=!1),p.councilMembers||(p.councilMembers=[]),void 0!==p.councilQuirks&&void 0===p.lumiaQuirks&&(p.lumiaQuirks=p.councilQuirks,delete p.councilQuirks,e=!0),void 0===p.lumiaQuirks&&(p.lumiaQuirks=""),p.stateSynthesis||(p.stateSynthesis={enabled:!1}),e}let j=!1,S=!1;function C(){const e=(0,r.fJ)();e[c]?(p=o(o({},p),e[c]),w()&&E()):e[c]=p}async function N(){if(j)return(0,i.tE)();console.log("[".concat(l,"] Initializing pack file storage..."));const e=!0===p.packStorageMigrated;if(!await(0,i.g1)())return console.warn("[".concat(l,"] File storage not available, using extension settings")),j=!0,!1;if(!e&&p.packs&&Object.keys(p.packs).length>0){console.log("[".concat(l,"] Migrating packs to file storage..."));const{migrated:e,failed:n}=await(0,i.DT)(p.packs);e>0&&((0,i.sp)(p),p.packStorageMigrated=!0,p.packsBackedUp=!0,delete p.packs,E(),console.log("[".concat(l,"] Migration complete: ").concat(e," packs moved to file storage")),n>0&&console.warn("[".concat(l,"] ").concat(n," packs failed to migrate"))),S=!0}else e&&(console.log("[".concat(l,"] Packs already migrated to file storage")),S=!0,p.selectionsCleanedUp||(console.log("[".concat(l,"] Cleaning up duplicated selections from extension_settings...")),p.selectionsCleanedUp=!0,E()));j=!0;const n=(0,i.vU)();return n&&(n.selections&&Object.assign(p,n.selections),n.preferences&&Object.assign(p,n.preferences),n.presets&&(p.presets=n.presets)),(0,i.nF)(()=>{var e;"undefined"!=typeof window&&null!==(e=window.LumiverseBridge)&&void 0!==e&&e.onPackCacheChange&&window.LumiverseBridge.onPackCacheChange()}),!0}function P(){return j&&(0,i.tE)()}function E(){const e=(0,r.fJ)(),n=(0,r.kL)();if(P()){const n=o({},p);delete n.packs,delete n.selectedDefinition,delete n.selectedBehaviors,delete n.selectedPersonalities,delete n.dominantBehavior,delete n.dominantPersonality,delete n.selectedLoomStyle,delete n.selectedLoomUtils,delete n.selectedLoomRetrofits,delete n.selectedDefinitions,delete n.councilMembers,delete n.chimeraMode,delete n.councilMode,delete n.lumiaQuirks,delete n.lumiaQuirksEnabled,delete n.lumiaOOCInterval,delete n.lumiaOOCStyle,delete n.activePresetName,delete n.presets,e[c]=n}else e[c]=p;n()}function O(){if(P()){const e={};for(const n of(0,i.LU)()){e[n.packName||n.name]=n}return e}return p.packs||{}}function M(e){var n;return P()?(0,i.d8)(e):(null===(n=p.packs)||void 0===n?void 0:n[e])||null}async function z(e){const n=e.packName||e.name;P()?await(0,i.j0)(e):(p.packs||(p.packs={}),p.packs[n]=e,E())}async function T(e){var n;P()?await(0,i.CY)(e):null!==(n=p.packs)&&void 0!==n&&n[e]&&(delete p.packs[e],E())}function I(e){Object.assign(p,e),P()?(0,i.Xy)(e):E()}function L(e){Object.assign(p,e),P()?(0,i.Ug)(e):E()}async function D(e){Object.assign(p,e),P()?await(0,i.z_)(e):E()}function A(e){p.presets=e,P()?(0,i.W8)(e):E()}async function R(){P()&&await(0,i.W3)()}function B(){return p.lumiaConfigVersion||1}function _(){return p.lumiaConfigVersion=(p.lumiaConfigVersion||0)+1,p.lastLumiaChangeTimestamp=Date.now(),p.disableAnthropicCache=!0,E(),console.log("[".concat(l,"] Claude cache cleared - version now ").concat(p.lumiaConfigVersion)),setTimeout(()=>{p.disableAnthropicCache=!1,E()},5e3),p.lumiaConfigVersion}async function U(){const e=(0,r.fJ)(),n=(0,r.kL)();console.log("[".concat(l,"] NUCLEAR RESET: Wiping all extension settings and User Files data..."));try{const e=await(0,i.Bq)();console.log("[".concat(l,"] User Files cleanup: ").concat(e.deleted.length," deleted, ").concat(e.failed.length," failed"))}catch(e){console.error("[".concat(l,"] Failed to clear User Files data:"),e)}delete e[c],p=o({},m),n(),console.log("[".concat(l,"] Settings wiped. Page will reload...")),setTimeout(()=>{window.location.reload()},1500)}},699(e,n,t){t.d(n,{Bq:()=>te,W3:()=>X,LU:()=>B,vU:()=>A,d8:()=>R,SS:()=>K,or:()=>q,JL:()=>$,g1:()=>L,tE:()=>D,DT:()=>ee,sp:()=>ne,CY:()=>U,Im:()=>Q,nF:()=>Z,Ug:()=>W,z_:()=>H,W8:()=>V,Xy:()=>F,j0:()=>_,Bl:()=>Y});var r=t(92),i=t(674);const a="lumiverse_",o="".concat(a,"index.json"),s="".concat(a,"pack_");function l(e){let n=0;for(let t=0;t<e.length;t++){n=(n<<5)-n+e.charCodeAt(t),n&=n}return(n>>>0).toString(16).padStart(8,"0")}function c(e){return"".concat(s).concat(l(e),".json")}async function u(e,n){const t=function(e){const n=JSON.stringify(e);return btoa(unescape(encodeURIComponent(n)))}(n),i=await fetch("/api/files/upload",{method:"POST",headers:(0,r.oO)(),body:JSON.stringify({name:e,data:t})});if(!i.ok){const n=await i.text().catch(()=>"Unknown error");throw new Error("Failed to save file ".concat(e,": ").concat(i.status," - ").concat(n))}return await i.json()}async function d(e){const n="/user/files/".concat(e,"?t=").concat(Date.now());try{const e=await fetch(n);if(!e.ok){if(404===e.status)return null;throw new Error("Failed to load file: ".concat(e.status))}return await e.json()}catch(n){return console.warn("[".concat(i.pW,"] Could not load file ").concat(e,":"),n),null}}async function m(e){try{const n="user/files/".concat(e);return(await fetch("/api/files/delete",{method:"POST",headers:(0,r.oO)(),body:JSON.stringify({path:n})})).ok}catch(n){return console.warn("[".concat(i.pW,"] Could not delete file ").concat(e,":"),n),!1}}async function p(e){try{await u(o,e),console.log("[".concat(i.pW,"] Index saved successfully"))}catch(e){throw console.error("[".concat(i.pW,"] Failed to save index:"),e),e}}async function g(){const e=await d(o);if(e){const{index:n,migrated:t}=function(e){let n=!1;return(!e.version||e.version<2)&&(e.presets||(e.presets={}),e.version=2,n=!0,console.log("[".concat(i.pW,"] Migrated index to v2 (added presets)"))),{index:e,migrated:n}}(e);return{index:n,isNew:!1,migrated:t}}return{index:{version:3,packRegistry:{},selections:{selectedDefinition:null,selectedBehaviors:[],selectedPersonalities:[],dominantBehavior:null,dominantPersonality:null,selectedLoomStyle:[],selectedLoomUtils:[],selectedLoomRetrofits:[],selectedDefinitions:[],councilMembers:[]},preferences:{chimeraMode:!1,councilMode:!1,lumiaQuirks:"",lumiaQuirksEnabled:!0,lumiaOOCInterval:null,lumiaOOCStyle:"social",activePresetName:null},presets:{},toggleStateRegistry:{}},isNew:!0,migrated:!1}}async function v(e){const n=e.packName||e.name,t=c(n);try{return await u(t,e),console.log("[".concat(i.pW,'] Pack "').concat(n,'" saved to ').concat(t)),t}catch(e){throw console.error("[".concat(i.pW,'] Failed to save pack "').concat(n,'":'),e),e}}async function h(e){return await m(e)}async function f(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;const t=new Map;if(0===e.length)return t;const r=[],a=async e=>{try{const n=await async function(e){return await d(e)}(e);n&&t.set(e,n)}catch(n){console.warn("[".concat(i.pW,"] Failed to load pack ").concat(e,":"),n)}};for(const t of e){const e=a(t).then(()=>{r.splice(r.indexOf(e),1)});r.push(e),r.length>=n&&await Promise.race(r)}return await Promise.all(r),t}function b(e){var n,t,r;const i=e.packName||e.name;return{packName:i,fileKey:c(i),version:e.version||1,lumiaCount:(null===(n=e.lumiaItems)||void 0===n?void 0:n.length)||0,loomCount:(null===(t=e.loomItems)||void 0===t?void 0:t.length)||0,isCustom:null!==(r=e.isCustom)&&void 0!==r?r:!e.url,url:e.url||null,packAuthor:e.packAuthor||e.author||null,coverUrl:e.coverUrl||null}}function x(e){return e}const y="".concat(a,"togglestate_");function k(e){return"".concat(y).concat(l(e),".json")}async function w(e){const n=k(e),t=await m(n);return t&&console.log("[".concat(i.pW,'] Deleted toggle state "').concat(e,'"')),t}function j(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function S(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?j(Object(t),!0).forEach(function(n){C(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):j(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function C(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}let N=null;const P=new Map,E=new Set;let O=!1,M=!1,z=null;const T=new Set,I={selections:null,preferences:null};async function L(){if(O)return console.log("[".concat(i.pW,"] Pack cache already initialized")),!0;if(!await async function(){try{const e=await fetch("/user/files/".concat(o,"?t=").concat(Date.now()),{method:"HEAD"});return e.ok||404===e.status}catch(e){return console.warn("[".concat(i.pW,"] File storage API not available:"),e),!1}}())return console.warn("[".concat(i.pW,"] File storage not available, falling back to extension settings")),!1;try{var e;const{index:n,isNew:t,migrated:r}=await g();N=n,console.log("[".concat(i.pW,"] Index loaded:"),{packCount:Object.keys(N.packRegistry).length,hasSelections:!(null===(e=N.selections)||void 0===e||!e.selectedDefinition),presetCount:Object.keys(N.presets||{}).length,isNew:t,migrated:r}),(t||r)&&(console.log("[".concat(i.pW,"] ").concat(t?"Creating initial":"Saving migrated"," index file...")),await p(N));const a=function(e){if(!e)return[];const n=new Set,t=e=>{null!=e&&e.packName&&n.add(e.packName),null!=e&&e.packId&&n.add(e.packId)};t(e.selectedDefinition),t(e.dominantBehavior),t(e.dominantPersonality);const r=["selectedBehaviors","selectedPersonalities","selectedLoomStyle","selectedLoomUtils","selectedLoomRetrofits","selectedDefinitions"];for(const n of r)Array.isArray(e[n])&&e[n].forEach(t);if(Array.isArray(e.councilMembers))for(const n of e.councilMembers)t(n),Array.isArray(n.behaviors)&&n.behaviors.forEach(t),Array.isArray(n.personalities)&&n.personalities.forEach(t);return Array.from(n)}(N.selections);if(console.log("[".concat(i.pW,"] Active pack IDs:"),a),a.length>0){const e=a.map(e=>{var n;return null===(n=N.packRegistry[e])||void 0===n?void 0:n.fileKey}).filter(Boolean),n=await f(e,3);for(const[e,t]of n){const e=x(t.packName||t.name);P.set(e,t)}console.log("[".concat(i.pW,"] Loaded ").concat(P.size," active packs into cache"))}return O=!0,function(){I.selections&&N&&(console.log("[".concat(i.pW,"] Applying pending selection updates")),N.selections=S(S({},N.selections),I.selections),I.selections=null);I.preferences&&N&&(console.log("[".concat(i.pW,"] Applying pending preference updates")),N.preferences=S(S({},N.preferences),I.preferences),I.preferences=null);!N||null!==I.selections&&null!==I.preferences||G()}(),async function(){var e;if(null===(e=N)||void 0===e||!e.packRegistry||M)return;const n=Object.keys(N.packRegistry),t=Array.from(P.keys()),r=n.filter(e=>!t.includes(e));if(0===r.length)return void(M=!0);console.log("[".concat(i.pW,"] Background loading ").concat(r.length," remaining packs..."));const a=e=>{"undefined"!=typeof requestIdleCallback?requestIdleCallback(e,{timeout:5e3}):setTimeout(e,100)},o=2;let s=0;const l=async()=>{if(s>=r.length)return M=!0,console.log("[".concat(i.pW,"] All packs loaded into cache")),void J();const e=r.slice(s,s+o).map(e=>{var n;return null===(n=N.packRegistry[e])||void 0===n?void 0:n.fileKey}).filter(Boolean);try{const n=await f(e,o);for(const[e,t]of n){const e=x(t.packName||t.name);P.set(e,t)}}catch(e){console.warn("[".concat(i.pW,"] Error loading background batch:"),e)}s+=o,a(l)};a(l)}(),!0}catch(e){return console.error("[".concat(i.pW,"] Failed to initialize pack cache:"),e),!1}}function D(){return O}function A(){return N}function R(e){return P.get(e)||null}function B(){return Array.from(P.values())}async function _(e){const n=e.packName||e.name;P.set(n,e);await v(e);N||(N=await g()),N.packRegistry[n]=b(e),G(),J()}async function U(e){var n,t;const r=null===(n=N)||void 0===n||null===(n=n.packRegistry)||void 0===n?void 0:n[e];P.get(e);let a=null==r?void 0:r.fileKey;if(a||(a=c(e),console.log("[".concat(i.pW,'] No registry entry for pack "').concat(e,'", computed fileKey: ').concat(a))),P.delete(e),a){console.log("[".concat(i.pW,"] Deleting pack file: ").concat(a));await h(a)?console.log("[".concat(i.pW,"] Successfully deleted pack file: ").concat(a)):console.warn("[".concat(i.pW,"] Failed to delete pack file: ").concat(a))}null!==(t=N)&&void 0!==t&&t.packRegistry&&delete N.packRegistry[e],function(e){var n;if(null===(n=N)||void 0===n||!n.selections)return;const t=N.selections,r=n=>(null==n?void 0:n.packName)===e||(null==n?void 0:n.packId)===e;r(t.selectedDefinition)&&(t.selectedDefinition=null);r(t.dominantBehavior)&&(t.dominantBehavior=null);r(t.dominantPersonality)&&(t.dominantPersonality=null);const i=["selectedBehaviors","selectedPersonalities","selectedLoomStyle","selectedLoomUtils","selectedLoomRetrofits","selectedDefinitions"];for(const e of i)Array.isArray(t[e])&&(t[e]=t[e].filter(e=>!r(e)));if(Array.isArray(t.councilMembers)){t.councilMembers=t.councilMembers.filter(e=>!r(e));for(const e of t.councilMembers)Array.isArray(e.behaviors)&&(e.behaviors=e.behaviors.filter(e=>!r(e))),Array.isArray(e.personalities)&&(e.personalities=e.personalities.filter(e=>!r(e)))}}(e),G(),J()}function F(e){if(!N)return console.warn("[".concat(i.pW,"] updateSelections called before cache initialized, queuing update")),void(I.selections=S(S({},I.selections),e));N.selections=S(S({},N.selections),e),G(),J()}function W(e){if(!N)return console.warn("[".concat(i.pW,"] updatePreferences called before cache initialized, queuing update")),void(I.preferences=S(S({},I.preferences),e));N.preferences=S(S({},N.preferences),e),G(),J()}async function H(e){if(!N)return console.warn("[".concat(i.pW,"] updatePreferencesImmediate called before cache initialized, queuing update")),void(I.preferences=S(S({},I.preferences),e));N.preferences=S(S({},N.preferences),e),z&&(clearTimeout(z),z=null);try{await p(N)}catch(e){console.error("[".concat(i.pW,"] Failed to save preferences immediately:"),e)}J()}function V(e){N&&(N.presets=e,G(),J())}function q(){var e;return null!==(e=N)&&void 0!==e&&e.toggleStateRegistry?Object.keys(N.toggleStateRegistry):[]}function $(){var e;return(null===(e=N)||void 0===e?void 0:e.toggleStateRegistry)||{}}async function Y(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;N&&(N.toggleStateRegistry||(N.toggleStateRegistry={}),await async function(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=k(e),a=Date.now();let o=a;try{const e=await d(r);null!=e&&e.createdAt&&(o=e.createdAt)}catch(e){}const s={name:e,createdAt:o,updatedAt:a,sourcePreset:t,toggles:n};return await u(r,s),console.log("[".concat(i.pW,'] Saved toggle state "').concat(e,'" to ').concat(r)),{fileKey:r}}(e,n,t),N.toggleStateRegistry[e]=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return{name:e,fileKey:k(e),sourcePreset:n,createdAt:Date.now()}}(e,t),G(),J())}async function K(e){return await async function(e){const n=k(e);return await d(n)}(e)}async function Q(e){var n;null!==(n=N)&&void 0!==n&&n.toggleStateRegistry&&(await w(e),delete N.toggleStateRegistry[e],G(),J())}function G(){z&&clearTimeout(z),z=setTimeout(async()=>{if(N)try{await p(N)}catch(e){console.error("[".concat(i.pW,"] Failed to save index:"),e)}z=null},500)}async function X(){z&&(clearTimeout(z),z=null),N&&await p(N)}function Z(e){return T.add(e),()=>T.delete(e)}function J(){for(const e of T)try{e()}catch(e){console.error("[".concat(i.pW,"] Cache listener error:"),e)}}async function ee(e){if(!e||"object"!=typeof e)return{migrated:0,failed:0};const n=Object.entries(e);if(0===n.length)return{migrated:0,failed:0};console.log("[".concat(i.pW,"] Migrating ").concat(n.length," packs to file storage..."));let t=0,r=0;if(!N){const{index:e}=await g();N=e}for(const[e,s]of n)try{var a;const n=s.packName||s.name||e,r=x(n),i={packName:n,packAuthor:s.packAuthor||s.author||null,coverUrl:s.coverUrl||null,version:s.version||1,packExtras:s.packExtras||[],lumiaItems:s.lumiaItems||[],loomItems:s.loomItems||[],isCustom:null!==(a=s.isCustom)&&void 0!==a?a:!s.url,url:s.url||""};if(s.items&&!s.lumiaItems&&!s.loomItems){i.lumiaItems=[],i.loomItems=[];for(const e of s.items){var o;if(e.lumiaDefName||e.lumiaName)i.lumiaItems.push({lumiaName:e.lumiaName||e.lumiaDefName,lumiaDefinition:e.lumiaDefinition||e.lumiaDef||null,lumiaPersonality:e.lumiaPersonality||e.lumia_personality||null,lumiaBehavior:e.lumiaBehavior||e.lumia_behavior||null,avatarUrl:e.avatarUrl||e.lumia_img||null,genderIdentity:null!==(o=e.genderIdentity)&&void 0!==o?o:0,authorName:e.authorName||e.defAuthor||null,version:1});else e.loomName&&i.loomItems.push({loomName:e.loomName,loomContent:e.loomContent||"",loomCategory:e.loomCategory||"Loom Utilities",authorName:e.authorName||null,version:1})}}await v(i);N.packRegistry[r]=b(i),P.set(r,i),t++}catch(n){console.error("[".concat(i.pW,"] Failed to migrate pack ").concat(e,":"),n),r++}return await p(N),console.log("[".concat(i.pW,"] Migration complete: ").concat(t," succeeded, ").concat(r," failed")),{migrated:t,failed:r}}function ne(e){if(!N)return;const n=["selectedDefinition","selectedBehaviors","selectedPersonalities","dominantBehavior","dominantPersonality","selectedLoomStyle","selectedLoomUtils","selectedLoomRetrofits","selectedDefinitions","councilMembers"];for(const t of n)void 0!==e[t]&&(N.selections[t]=e[t]);const t=["chimeraMode","councilMode","lumiaQuirks","lumiaQuirksEnabled","lumiaOOCInterval","lumiaOOCStyle","activePresetName"];for(const n of t)void 0!==e[n]&&(N.preferences[n]=e[n]);e.presets&&"object"==typeof e.presets&&(N.presets||(N.presets={}),Object.assign(N.presets,e.presets),console.log("[".concat(i.pW,"] Migrated ").concat(Object.keys(e.presets).length," presets")))}async function te(){console.log("[".concat(i.pW,"] NUCLEAR: Clearing all Lumiverse data...")),z&&(clearTimeout(z),z=null),N=null,P.clear(),E.clear(),O=!1,M=!1,I.selections=null,I.preferences=null;const e=await async function(){var e,n;const t=[],r=[];console.log("[".concat(i.pW,"] NUCLEAR: Deleting all Lumiverse files from User Files API..."));let a=null;try{a=(await g()).index}catch(e){console.warn("[".concat(i.pW,"] Could not load index for cleanup, proceeding with index deletion only"))}if(null!==(e=a)&&void 0!==e&&e.packRegistry){const e=Object.values(a.packRegistry).map(e=>e.fileKey).filter(Boolean);for(const n of e)try{await h(n)?t.push(n):r.push(n)}catch(e){console.warn("[".concat(i.pW,"] Failed to delete pack file ").concat(n,":"),e),r.push(n)}}if(null!==(n=a)&&void 0!==n&&n.toggleStateRegistry)for(const e of Object.keys(a.toggleStateRegistry))try{await w(e)?t.push("togglestate:".concat(e)):r.push("togglestate:".concat(e))}catch(n){console.warn("[".concat(i.pW,"] Failed to delete toggle state ").concat(e,":"),n),r.push("togglestate:".concat(e))}try{await m(o)?t.push(o):r.push(o)}catch(e){console.warn("[".concat(i.pW,"] Failed to delete index file:"),e),r.push(o)}return console.log("[".concat(i.pW,"] NUCLEAR: Deleted ").concat(t.length," files, ").concat(r.length," failed")),{deleted:t,failed:r}}();return notifyCacheChange(),console.log("[".concat(i.pW,"] NUCLEAR: All Lumiverse data cleared")),e}"undefined"!=typeof window&&(window.debugLumiversePackCache=function(){console.group("[".concat(i.pW,"] Pack Cache State")),console.log("Initialized:",O),console.log("All packs loaded:",M),console.log("Cached index:",N),console.log("Pack cache size:",P.size),console.log("Cached pack IDs:",Array.from(P.keys())),console.log("Loading packs:",Array.from(E)),console.groupEnd()})},796(e){e.exports="data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%2712%27 height=%2712%27 viewBox=%270 0 24 24%27 fill=%27none%27 stroke=%27rgba%28255,255,255,0.5%29%27 stroke-width=%272%27 stroke-linecap=%27round%27 stroke-linejoin=%27round%27%3E%3Cpolyline points=%276 9 12 15 18 9%27%3E%3C/polyline%3E%3C/svg%3E"},825(e){e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var n=e.insertStyleElement(e);return{update:function(t){!function(e,n,t){var r="";t.supports&&(r+="@supports (".concat(t.supports,") {")),t.media&&(r+="@media ".concat(t.media," {"));var i=void 0!==t.layer;i&&(r+="@layer".concat(t.layer.length>0?" ".concat(t.layer):""," {")),r+=t.css,i&&(r+="}"),t.media&&(r+="}"),t.supports&&(r+="}");var a=t.sourceMap;a&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),n.styleTagTransform(r,e,n.options)}(n,e,t)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(n)}}}},848(e,n,t){e.exports=t(20)},919(e){e.exports="data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%2712%27 height=%2712%27 viewBox=%270 0 24 24%27 fill=%27none%27 stroke=%27%23888%27 stroke-width=%272%27%3E%3Cpath d=%27M6 9l6 6 6-6%27/%3E%3C/svg%3E"},932(e,n,t){t.d(n,{Cm:()=>S,Dz:()=>N,GM:()=>w,YR:()=>P,Zl:()=>u,e2:()=>C,mR:()=>j,ry:()=>k,updateLoomSummaryButtonState:()=>E,xx:()=>m});var r=t(92),i=t(674),a=t(154),o=t(485),s=t(199),l=t(200);let c=null;function u(e){c=e}let d=null;function m(e){d=e}function p(){d&&d()}const g='<svg viewBox="0 0 24 24"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>',v='<svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"></polyline></svg>',h='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>',f='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>',b='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>',x='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>';function y(e){const n=e[0];if(!n)return;const t=window.innerHeight||document.documentElement.clientHeight,r=(window.innerWidth||document.documentElement.clientWidth)<=600?24:48,i=t-r;n.style.maxHeight="".concat(i,"px");const a=e.find(".lumia-modal-header"),o=e.find(".lumia-modal-footer"),s=e.find(".lumia-modal-content");requestAnimationFrame(()=>{const e=a.length?a[0].offsetHeight:0,n=o.length?o[0].offsetHeight:0,t=i-e-n;s.length&&(s[0].style.maxHeight="".concat(t,"px"),s[0].style.overflowY="auto")});const l=()=>{const e=(window.innerHeight||document.documentElement.clientHeight)-r;n.style.maxHeight="".concat(e,"px");const t=e-(a.length?a[0].offsetHeight:0)-(o.length?o[0].offsetHeight:0);s.length&&(s[0].style.maxHeight="".concat(t,"px"))};window.addEventListener("resize",l),n._resizeCleanup=()=>window.removeEventListener("resize",l)}function k(e){const n=(0,i.mt)(),t=Object.values(n.packs);let r="",o="",l=!1,c=null,u="";"definition"===e?(r="Select Definition",o="Choose the physical form for your Lumia",l=!1,u='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>\n            <circle cx="12" cy="7" r="4"></circle>\n        </svg>'):"behavior"===e?(r="Select Behaviors",o="Choose behavioral traits (tap star for dominant)",l=!0,c="dominantBehavior",u='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n            <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path>\n        </svg>'):"personality"===e&&(r="Select Personalities",o="Choose personality traits (tap star for dominant)",l=!0,c="dominantPersonality",u='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n            <path d="M12 2a10 10 0 1 0 10 10H12V2z"></path>\n            <path d="M12 2a10 10 0 0 1 10 10"></path>\n            <circle cx="12" cy="12" r="6"></circle>\n        </svg>'),$("#lumia-selection-modal").remove();let d="";0===t.length?d='<div class="lumia-modal-empty">No Lumia Packs loaded. Add one in settings!</div>':t.forEach(t=>{const r=t.items;if(!r||0===r.length)return;const i=r.filter(e=>e.lumiaDefName);if(0===i.length)return;const o=(0,s.iY)(t.name),u=i.map(r=>{const i=r.lumiaDefName,s=(0,a.ZD)(t.name),u=(0,a.ZD)(i),d=r.lumia_img;let m=!1;if(l){m=("behavior"===e?n.selectedBehaviors:n.selectedPersonalities).some(e=>e.packName===t.name&&e.itemName===i)}else{const e=n.selectedDefinition;m=e&&e.packName===t.name&&e.itemName===i}let p=!1;c&&n[c]&&(p=n[c].packName===t.name&&n[c].itemName===i);const h=null!==c;return'\n                <div class="lumia-card lumia-card-appear '.concat("definition"===e?"definition-card":""," ").concat(m?"selected":"",'"\n                     data-pack="').concat(s,'"\n                     data-item="').concat(u,'">\n                    <div class="lumia-card-image">\n                        ').concat(d?'<img src="'.concat(d,'" alt="').concat(u,'" loading="lazy"><div class="lumia-img-spinner"></div>'):'<div class="lumia-card-placeholder">?</div>',"\n                        ").concat(h?'\n                        <div class="lumia-dominant-icon '.concat(p?"dominant":"",'"\n                             data-pack="').concat(s,'"\n                             data-item="').concat(u,'"\n                             title="').concat(p?"Remove as dominant":"Set as dominant trait",'">\n                            ').concat(g,"\n                        </div>\n                        "):"",'\n                        <div class="lumia-card-check">\n                            ').concat(v,"\n                        </div>\n                        ").concat(o?'\n                        <button class="lumia-card-edit-btn"\n                                data-pack="'.concat(s,'"\n                                data-item="').concat(u,'"\n                                title="Edit Lumia">\n                            ').concat(x,"\n                        </button>\n                        "):"",'\n                    </div>\n                    <div class="lumia-card-info">\n                        <div class="lumia-card-name">').concat(i||"Unknown","</div>\n                    </div>\n                </div>\n                ")}).join("");d+='\n            <div class="lumia-modal-panel lumia-collapsible lumia-pack-section">\n                <div class="lumia-modal-panel-header lumia-collapsible-trigger">\n                    <span class="lumia-panel-collapse-icon">\n                        '.concat(b,'\n                    </span>\n                    <span class="lumia-modal-panel-icon">\n                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                            <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>\n                        </svg>\n                    </span>\n                    <span class="lumia-modal-panel-title">').concat((0,a.ZD)(t.name),"</span>\n                    ").concat(o?'<span class="lumia-pack-badge-custom">Custom</span>':"",'\n                    <span class="lumia-modal-panel-count">').concat(i.length," items</span>\n                    ").concat(o?'<button class="lumia-pack-edit-btn" data-pack="'.concat((0,a.ZD)(t.name),'" title="Edit Pack">').concat(x,"</button>"):"",'\n                    <button class="lumia-icon-btn-sm lumia-remove-pack-btn" data-pack="').concat((0,a.ZD)(t.name),'" title="Remove Pack">\n                        ').concat(h,'\n                    </button>\n                </div>\n                <div class="lumia-modal-panel-content lumia-modal-panel-content-cards lumia-collapsible-content">\n                    <div class="lumia-card-grid">\n                        ').concat(u,"\n                    </div>\n                </div>\n            </div>\n            ")});const m='\n        <dialog id="lumia-selection-modal" class="popup popup--animation-fast lumia-modal lumia-modal-selection">\n            <div class="lumia-modal-header">\n                <div class="lumia-modal-header-icon">\n                    '.concat(u,'\n                </div>\n                <div class="lumia-modal-header-text">\n                    <h3 class="lumia-modal-title">').concat(r,'</h3>\n                    <p class="lumia-modal-subtitle">').concat(o,'</p>\n                </div>\n                <button class="lumia-clear-btn" title="Clear all selections">\n                    ').concat(f,'\n                    <span>Clear</span>\n                </button>\n            </div>\n            <div class="lumia-modal-content">\n                ').concat(d,'\n            </div>\n            <div class="lumia-modal-footer">\n                <button class="lumia-modal-btn lumia-modal-btn-secondary lumia-modal-close-btn">Close</button>\n                ').concat(l?'<button class="lumia-modal-btn lumia-modal-btn-primary lumia-modal-done">Done</button>':"","\n            </div>\n        </dialog>\n    ");$("body").append(m);const k=$("#lumia-selection-modal");y(k);const w=()=>{k[0]._resizeCleanup&&k[0]._resizeCleanup(),k[0].close(),k.remove(),p()};k.on("click mousedown mouseup",function(e){e.stopPropagation(),"click"===e.type&&e.target===this&&w()}),k.find(".lumia-modal-close-btn, .lumia-modal-done").click(w),k.on("keydown",function(e){"Escape"===e.key&&w()}),k.find(".lumia-collapsible-trigger").click(function(e){$(e.target).closest(".lumia-remove-pack-btn").length>0||$(this).closest(".lumia-collapsible").toggleClass("collapsed")}),k.find(".lumia-clear-btn").click(function(t){t.stopPropagation(),"definition"===e?n.selectedDefinition=null:"behavior"===e?(n.selectedBehaviors=[],n.dominantBehavior=null):"personality"===e&&(n.selectedPersonalities=[],n.dominantPersonality=null),(0,i.DZ)(),k.find(".lumia-card").removeClass("selected"),k.find(".lumia-dominant-icon").removeClass("dominant"),toastr.info("".concat(r.replace("Select ","")," cleared"))}),k.find(".lumia-remove-pack-btn").click(function(e){e.stopPropagation();const t=$(this).data("pack");confirm('Are you sure you want to remove the pack "'.concat(t,'"?'))&&(delete n.packs[t],n.selectedDefinition&&n.selectedDefinition.packName===t&&(n.selectedDefinition=null),n.selectedBehaviors=n.selectedBehaviors.filter(e=>e.packName!==t),n.selectedPersonalities=n.selectedPersonalities.filter(e=>e.packName!==t),n.dominantBehavior&&n.dominantBehavior.packName===t&&(n.dominantBehavior=null),n.dominantPersonality&&n.dominantPersonality.packName===t&&(n.dominantPersonality=null),(0,i.DZ)(),$(this).closest(".lumia-modal-panel").remove(),0===Object.keys(n.packs).length&&w())}),k.find(".lumia-pack-edit-btn").click(function(e){e.stopPropagation();const n=$(this).data("pack");w(),(0,s.H3)(n)}),k.find(".lumia-card-edit-btn").click(function(e){e.stopPropagation();const n=$(this).data("pack"),t=$(this).data("item"),r=(0,a.Br)(n,t);r&&(w(),(0,s.un)(r,n))}),c&&k.find(".lumia-dominant-icon").click(function(t){t.stopPropagation();const r=$(this).data("pack"),a=$(this).data("item"),o=$(this),s="behavior"===e?n.selectedBehaviors:n.selectedPersonalities;s.some(e=>e.packName===r&&e.itemName===a)||(s.push({packName:r,itemName:a}),"behavior"===e?n.selectedBehaviors=s:n.selectedPersonalities=s,o.closest(".lumia-card").addClass("selected"));const l=n[c];l&&l.packName===r&&l.itemName===a?(n[c]=null,o.removeClass("dominant")):(k.find(".lumia-dominant-icon").removeClass("dominant"),n[c]={packName:r,itemName:a},o.addClass("dominant")),(0,i.DZ)()}),k.find(".lumia-card").click(function(t){if($(t.target).closest(".lumia-dominant-icon").length>0||$(t.target).closest(".lumia-card-edit-btn").length>0)return;const r=$(this).data("pack"),a=$(this).data("item");if(l){const t=$(this);let o="behavior"===e?n.selectedBehaviors:n.selectedPersonalities;const s=o.findIndex(e=>e.packName===r&&e.itemName===a);-1!==s?(o.splice(s,1),t.removeClass("selected"),c&&n[c]&&n[c].packName===r&&n[c].itemName===a&&(n[c]=null,t.find(".lumia-dominant-icon").removeClass("dominant"))):(o.push({packName:r,itemName:a}),t.addClass("selected")),"behavior"===e?n.selectedBehaviors=o:n.selectedPersonalities=o,(0,i.DZ)()}else k.find(".lumia-card").removeClass("selected"),$(this).addClass("selected"),n.selectedDefinition={packName:r,itemName:a},(0,i.DZ)()}),k.find(".lumia-card-image img").each(function(){const e=$(this);this.complete&&0!==this.naturalHeight?e.addClass("lumia-img-loaded"):(e.on("load",function(){e.addClass("lumia-img-loaded")}),e.on("error",function(){e.addClass("lumia-img-loaded"),e.css("display","none"),e.parent().append('<div class="lumia-card-placeholder">?</div>')}))}),k[0].showModal()}function w(){const e=(0,i.mt)();$("#lumia-misc-modal").remove();const n=e.lumiaOOCInterval||"",t=e.lumiaOOCStyle||"social",r='\n        <dialog id="lumia-misc-modal" class="popup popup--animation-fast lumia-modal lumia-modal-settings">\n            <div class="lumia-modal-header">\n                <div class="lumia-modal-header-icon">\n                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>\n                    </svg>\n                </div>\n                <h3 class="lumia-modal-title">OOC Settings</h3>\n            </div>\n            <div class="lumia-modal-content">\n\n                <div class="lumia-modal-panel">\n                    <div class="lumia-modal-panel-header">\n                        <span class="lumia-modal-panel-icon">\n                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                                <circle cx="12" cy="12" r="10"></circle>\n                                <polyline points="12 6 12 12 16 14"></polyline>\n                            </svg>\n                        </span>\n                        <span class="lumia-modal-panel-title">Comment Trigger</span>\n                    </div>\n                    <div class="lumia-modal-panel-content">\n                        <p class="lumia-modal-description">Automatically inject OOC instructions at message intervals.</p>\n                        <div class="lumia-modal-field">\n                            <label class="lumia-modal-label" for="lumia-ooc-interval-input">Message Interval</label>\n                            <input type="number"\n                                   id="lumia-ooc-interval-input"\n                                   class="lumia-modal-input"\n                                   placeholder="e.g., 10 (empty = disabled)"\n                                   min="1"\n                                   value="'.concat((0,a.ZD)(n.toString()),'" />\n                            <span class="lumia-modal-hint">Triggers when message count is divisible by this number</span>\n                        </div>\n                    </div>\n                </div>\n\n                <div class="lumia-modal-panel">\n                    <div class="lumia-modal-panel-header">\n                        <span class="lumia-modal-panel-icon">\n                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>\n                                <line x1="3" y1="9" x2="21" y2="9"></line>\n                                <line x1="9" y1="21" x2="9" y2="9"></line>\n                            </svg>\n                        </span>\n                        <span class="lumia-modal-panel-title">Display Style</span>\n                    </div>\n                    <div class="lumia-modal-panel-content">\n                        <p class="lumia-modal-description">Choose how OOC comments appear in chat.</p>\n                        <div class="lumia-style-options">\n                            <label class="lumia-style-option ').concat("social"===t?"selected":"",'">\n                                <input type="radio" name="ooc-style" value="social" ').concat("social"===t?"checked":"",' />\n                                <div class="lumia-style-option-content">\n                                    <span class="lumia-style-option-icon">\n                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                                            <rect x="3" y="3" width="18" height="18" rx="2"></rect>\n                                            <circle cx="8.5" cy="8.5" r="1.5"></circle>\n                                            <path d="M21 15l-5-5L5 21"></path>\n                                        </svg>\n                                    </span>\n                                    <div class="lumia-style-option-text">\n                                        <span class="lumia-style-option-title">Social Card</span>\n                                        <span class="lumia-style-option-desc">Full card with avatar & animations</span>\n                                    </div>\n                                </div>\n                            </label>\n                            <label class="lumia-style-option ').concat("margin"===t?"selected":"",'">\n                                <input type="radio" name="ooc-style" value="margin" ').concat("margin"===t?"checked":"",' />\n                                <div class="lumia-style-option-content">\n                                    <span class="lumia-style-option-icon">\n                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>\n                                            <polyline points="14 2 14 8 20 8"></polyline>\n                                        </svg>\n                                    </span>\n                                    <div class="lumia-style-option-text">\n                                        <span class="lumia-style-option-title">Margin Note</span>\n                                        <span class="lumia-style-option-desc">Minimal hanging tag style</span>\n                                    </div>\n                                </div>\n                            </label>\n                            <label class="lumia-style-option ').concat("whisper"===t?"selected":"",'">\n                                <input type="radio" name="ooc-style" value="whisper" ').concat("whisper"===t?"checked":"",' />\n                                <div class="lumia-style-option-content">\n                                    <span class="lumia-style-option-icon">\n                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                                            <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path>\n                                        </svg>\n                                    </span>\n                                    <div class="lumia-style-option-text">\n                                        <span class="lumia-style-option-title">Whisper Bubble</span>\n                                        <span class="lumia-style-option-desc">Soft ethereal thought bubble</span>\n                                    </div>\n                                </div>\n                            </label>\n                        </div>\n                    </div>\n                </div>\n\n            </div>\n            <div class="lumia-modal-footer">\n                <button class="lumia-modal-btn lumia-modal-btn-secondary lumia-misc-cancel-btn">Cancel</button>\n                <button class="lumia-modal-btn lumia-modal-btn-primary lumia-misc-save-btn">Save Changes</button>\n            </div>\n        </dialog>\n    ');$("body").append(r);const o=$("#lumia-misc-modal");y(o);const s=()=>{o[0]._resizeCleanup&&o[0]._resizeCleanup(),o[0].close(),o.remove()};o.on("click mousedown mouseup",function(e){e.stopPropagation(),"click"===e.type&&e.target===this&&s()}),o.find('.lumia-style-option input[type="radio"]').change(function(){o.find(".lumia-style-option").removeClass("selected"),$(this).closest(".lumia-style-option").addClass("selected")}),o.find(".lumia-misc-save-btn").click(()=>{const n=$("#lumia-ooc-interval-input").val().trim(),t=o.find('input[name="ooc-style"]:checked').val(),r=e.lumiaOOCStyle;e.lumiaOOCInterval=n?parseInt(n,10):null,e.lumiaOOCStyle=t,(0,i.DZ)(),(0,l.TC)(),toastr.success("OOC settings saved!"),s(),r!==t&&c&&setTimeout(()=>c(!0),100)}),o.find(".lumia-misc-cancel-btn").click(s),o.on("keydown",function(e){"Escape"===e.key&&s()}),o[0].showModal()}function j(e){const n=(0,i.mt)(),t=Object.values(n.packs);let r="",o="",s=!1,l=null,c="";"Narrative Style"===e?(r="Select Narrative Styles",o="Choose how the story is told",s=!0,l="selectedLoomStyle",c='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n            <path d="M12 19l7-7 3 3-7 7-3-3z"></path>\n            <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"></path>\n            <path d="M2 2l7.586 7.586"></path>\n            <circle cx="11" cy="11" r="2"></circle>\n        </svg>'):"Loom Utilities"===e?(r="Select Loom Utilities",o="Toggle utilities to enhance generation",s=!0,l="selectedLoomUtils",c='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n            <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path>\n        </svg>'):"Retrofits"===e&&(r="Select Retrofits",o="Choose retrofit modifications",s=!0,l="selectedLoomRetrofits",c='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n            <circle cx="12" cy="12" r="3"></circle>\n            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"></path>\n        </svg>'),$("#loom-selection-modal").remove();let u="";0===t.length?u='<div class="lumia-modal-empty">No Packs loaded. Add one in settings!</div>':(t.forEach(t=>{const r=t.items;if(!r||0===r.length)return;const i=r.filter(n=>n.loomCategory===e);if(0===i.length)return;const o=i.map(e=>{let r=!1;const i=e.loomName;if(s){r=(Array.isArray(n[l])?n[l]:[]).some(e=>e.packName===t.name&&e.itemName===i)}else{const e=n[l];r=e&&e.packName===t.name&&e.itemName===i}const o=(0,a.ZD)(t.name),c=(0,a.ZD)(i);return'\n                <div class="lumia-list-item '.concat(r?"selected":"",'"\n                     data-pack="').concat(o,'"\n                     data-item="').concat(c,'">\n                    <div class="lumia-list-item-content">\n                        <span class="lumia-list-item-name">').concat(i||"Unknown",'</span>\n                    </div>\n                    <div class="lumia-list-item-toggle">\n                        ').concat(s?'\n                        <div class="lumia-toggle-switch">\n                            <div class="lumia-toggle-track">\n                                <div class="lumia-toggle-thumb"></div>\n                            </div>\n                        </div>\n                        ':'\n                        <div class="lumia-radio-indicator"></div>\n                        ',"\n                    </div>\n                </div>\n                ")}).join("");o&&(u+='\n                <div class="lumia-modal-panel lumia-collapsible">\n                    <div class="lumia-modal-panel-header lumia-collapsible-trigger">\n                        <span class="lumia-panel-collapse-icon">\n                            '.concat(b,'\n                        </span>\n                        <span class="lumia-modal-panel-icon">\n                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                                <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>\n                            </svg>\n                        </span>\n                        <span class="lumia-modal-panel-title">').concat(t.name,'</span>\n                        <span class="lumia-modal-panel-count">').concat(i.length,' items</span>\n                        <button class="lumia-icon-btn-sm lumia-remove-pack-btn" data-pack="').concat((0,a.ZD)(t.name),'" title="Remove Pack">\n                            ').concat(h,'\n                        </button>\n                    </div>\n                    <div class="lumia-modal-panel-content lumia-modal-panel-content-list lumia-collapsible-content">\n                        <div class="lumia-list-group">\n                            ').concat(o,"\n                        </div>\n                    </div>\n                </div>\n                "))}),u||(u='<div class="lumia-modal-empty">No "'.concat(e,'" items found in loaded packs.</div>')));const d='\n        <dialog id="loom-selection-modal" class="popup popup--animation-fast lumia-modal lumia-modal-selection">\n            <div class="lumia-modal-header">\n                <div class="lumia-modal-header-icon">\n                    '.concat(c,'\n                </div>\n                <div class="lumia-modal-header-text">\n                    <h3 class="lumia-modal-title">').concat(r,'</h3>\n                    <p class="lumia-modal-subtitle">').concat(o,'</p>\n                </div>\n                <button class="lumia-clear-btn" title="Clear selection">\n                    ').concat(f,'\n                    <span>Clear</span>\n                </button>\n            </div>\n            <div class="lumia-modal-content">\n                ').concat(u,'\n            </div>\n            <div class="lumia-modal-footer">\n                <button class="lumia-modal-btn lumia-modal-btn-secondary lumia-modal-close-btn">Close</button>\n                ').concat(s?'<button class="lumia-modal-btn lumia-modal-btn-primary lumia-modal-done">Done</button>':"","\n            </div>\n        </dialog>\n    ");$("body").append(d);const m=$("#loom-selection-modal");y(m);const g=()=>{m[0]._resizeCleanup&&m[0]._resizeCleanup(),m[0].close(),m.remove(),p()};m.on("click mousedown mouseup",function(e){e.stopPropagation(),"click"===e.type&&e.target===this&&g()}),m.find(".lumia-modal-close-btn, .lumia-modal-done").click(g),m.on("keydown",function(e){"Escape"===e.key&&g()}),m.find(".lumia-collapsible-trigger").click(function(e){$(e.target).closest(".lumia-list-item").length>0||$(e.target).closest(".lumia-remove-pack-btn").length>0||$(this).closest(".lumia-collapsible").toggleClass("collapsed")}),m.find(".lumia-clear-btn").click(function(e){e.stopPropagation(),n[l]=s?[]:null,(0,i.DZ)(),m.find(".lumia-list-item").removeClass("selected"),toastr.info("".concat(r.replace("Select ","")," cleared"))}),m.find(".lumia-remove-pack-btn").click(function(e){e.stopPropagation();const t=$(this).data("pack");confirm('Are you sure you want to remove the pack "'.concat(t,'"?'))&&(delete n.packs[t],n.selectedLoomStyle=(Array.isArray(n.selectedLoomStyle)?n.selectedLoomStyle:[]).filter(e=>e.packName!==t),n.selectedLoomUtils=n.selectedLoomUtils.filter(e=>e.packName!==t),n.selectedLoomRetrofits=n.selectedLoomRetrofits.filter(e=>e.packName!==t),n.selectedDefinition&&n.selectedDefinition.packName===t&&(n.selectedDefinition=null),n.selectedBehaviors=n.selectedBehaviors.filter(e=>e.packName!==t),n.selectedPersonalities=n.selectedPersonalities.filter(e=>e.packName!==t),n.dominantBehavior&&n.dominantBehavior.packName===t&&(n.dominantBehavior=null),n.dominantPersonality&&n.dominantPersonality.packName===t&&(n.dominantPersonality=null),(0,i.DZ)(),$(this).closest(".lumia-modal-panel").remove(),0===Object.keys(n.packs).length&&g())}),m.find(".lumia-list-item").click(function(){const e=$(this).data("pack"),t=$(this).data("item");if(s){const r=$(this);let a=n[l];const o=a.findIndex(n=>n.packName===e&&n.itemName===t);-1!==o?(a.splice(o,1),r.removeClass("selected")):(a.push({packName:e,itemName:t}),r.addClass("selected")),n[l]=a,(0,i.DZ)()}else m.find(".lumia-list-item").removeClass("selected"),$(this).addClass("selected"),n[l]={packName:e,itemName:t},(0,i.DZ)(),setTimeout(g,150)}),m[0].showModal()}function S(){var e;const n=(0,i.mt)(),t=(0,r.SD)();$("#lumia-summarization-modal").remove();const s=n.summarization||{},c=s.secondary||{},u=s.mode||"disabled",d=s.apiSource||"main",m=s.autoInterval||10,p=s.autoMessageContext||10,g=s.manualMessageContext||10,v=c.provider||"openai",h=c.model||"",f=c.endpoint||"",b=c.apiKey||"",x=c.temperature||.7,k=void 0!==c.topP?c.topP:1,w=c.maxTokens||8192,j=n.messageTruncation||{},S=j.enabled||!1,C=null!==(e=j.keepCount)&&void 0!==e?e:50,N=(null==t?void 0:t.chat)&&t.chat.length>0,P=(0,o.__)(v),E='\n        <dialog id="lumia-summarization-modal" class="popup popup--animation-fast lumia-modal lumia-modal-settings">\n            <div class="lumia-modal-header">\n                <div class="lumia-modal-header-icon">\n                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                        <line x1="21" y1="10" x2="3" y2="10"></line>\n                        <line x1="21" y1="6" x2="3" y2="6"></line>\n                        <line x1="21" y1="14" x2="3" y2="14"></line>\n                        <line x1="21" y1="18" x2="3" y2="18"></line>\n                    </svg>\n                </div>\n                <h3 class="lumia-modal-title">Summarization</h3>\n            </div>\n            <div class="lumia-modal-content">\n\n                \x3c!-- Mode Selection --\x3e\n                <div class="lumia-modal-panel">\n                    <div class="lumia-modal-panel-header">\n                        <span class="lumia-modal-panel-icon">\n                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                                <circle cx="12" cy="12" r="3"></circle>\n                                <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"></path>\n                            </svg>\n                        </span>\n                        <span class="lumia-modal-panel-title">Mode</span>\n                    </div>\n                    <div class="lumia-modal-panel-content">\n                        <div class="lumia-mode-options">\n                            <label class="lumia-mode-option '.concat("disabled"===u?"selected":"",'">\n                                <input type="radio" name="sum-mode" value="disabled" ').concat("disabled"===u?"checked":"",' />\n                                <span class="lumia-mode-option-label">Disabled</span>\n                            </label>\n                            <label class="lumia-mode-option ').concat("auto"===u?"selected":"",'">\n                                <input type="radio" name="sum-mode" value="auto" ').concat("auto"===u?"checked":"",' />\n                                <span class="lumia-mode-option-label">Automatic</span>\n                            </label>\n                            <label class="lumia-mode-option ').concat("manual"===u?"selected":"",'">\n                                <input type="radio" name="sum-mode" value="manual" ').concat("manual"===u?"checked":"",' />\n                                <span class="lumia-mode-option-label">Manual</span>\n                            </label>\n                        </div>\n                    </div>\n                </div>\n\n                \x3c!-- Auto Settings (conditional) --\x3e\n                <div class="lumia-modal-panel" id="lumia-sum-auto-section" style="').concat("auto"===u?"":"display: none;",'">\n                    <div class="lumia-modal-panel-header">\n                        <span class="lumia-modal-panel-icon">\n                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                                <circle cx="12" cy="12" r="10"></circle>\n                                <polyline points="12 6 12 12 16 14"></polyline>\n                            </svg>\n                        </span>\n                        <span class="lumia-modal-panel-title">Auto Settings</span>\n                    </div>\n                    <div class="lumia-modal-panel-content">\n                        <div class="lumia-modal-field-row">\n                            <div class="lumia-modal-field">\n                                <label class="lumia-modal-label" for="lumia-sum-interval-input">Interval</label>\n                                <input type="number" id="lumia-sum-interval-input" class="lumia-modal-input" min="1" value="').concat(m,'" />\n                                <span class="lumia-modal-hint">Every N messages</span>\n                            </div>\n                            <div class="lumia-modal-field">\n                                <label class="lumia-modal-label" for="lumia-sum-auto-context-input">Context</label>\n                                <input type="number" id="lumia-sum-auto-context-input" class="lumia-modal-input" min="1" max="100" value="').concat(p,'" />\n                                <span class="lumia-modal-hint">Messages to include</span>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                \x3c!-- Manual Context (conditional) --\x3e\n                <div class="lumia-modal-panel" id="lumia-sum-manual-section" style="').concat("manual"===u||"auto"===u?"":"display: none;",'">\n                    <div class="lumia-modal-panel-header">\n                        <span class="lumia-modal-panel-icon">\n                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>\n                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>\n                            </svg>\n                        </span>\n                        <span class="lumia-modal-panel-title">Manual Context</span>\n                    </div>\n                    <div class="lumia-modal-panel-content">\n                        <div class="lumia-modal-field">\n                            <label class="lumia-modal-label" for="lumia-sum-manual-context-input">Messages to include</label>\n                            <input type="number" id="lumia-sum-manual-context-input" class="lumia-modal-input" min="1" max="100" value="').concat(g,'" />\n                            <span class="lumia-modal-hint">When using /loom-summarize command</span>\n                        </div>\n                    </div>\n                </div>\n\n                \x3c!-- API Source --\x3e\n                <div class="lumia-modal-panel">\n                    <div class="lumia-modal-panel-header">\n                        <span class="lumia-modal-panel-icon">\n                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                                <path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"></path>\n                            </svg>\n                        </span>\n                        <span class="lumia-modal-panel-title">API Source</span>\n                    </div>\n                    <div class="lumia-modal-panel-content">\n                        <div class="lumia-mode-options">\n                            <label class="lumia-mode-option lumia-mode-option-wide ').concat("main"===d?"selected":"",'">\n                                <input type="radio" name="sum-source" value="main" ').concat("main"===d?"checked":"",' />\n                                <span class="lumia-mode-option-label">Main API</span>\n                            </label>\n                            <label class="lumia-mode-option lumia-mode-option-wide ').concat("secondary"===d?"selected":"",'">\n                                <input type="radio" name="sum-source" value="secondary" ').concat("secondary"===d?"checked":"",' />\n                                <span class="lumia-mode-option-label">Secondary LLM</span>\n                            </label>\n                        </div>\n                    </div>\n                </div>\n\n                \x3c!-- Secondary LLM Config (conditional) --\x3e\n                <div class="lumia-modal-panel" id="lumia-sum-secondary-section" style="').concat("secondary"===d?"":"display: none;",'">\n                    <div class="lumia-modal-panel-header">\n                        <span class="lumia-modal-panel-icon">\n                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                                <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>\n                                <line x1="8" y1="21" x2="16" y2="21"></line>\n                                <line x1="12" y1="17" x2="12" y2="21"></line>\n                            </svg>\n                        </span>\n                        <span class="lumia-modal-panel-title">Secondary LLM</span>\n                    </div>\n                    <div class="lumia-modal-panel-content">\n                        <div class="lumia-modal-field">\n                            <label class="lumia-modal-label" for="lumia-sum-provider-select">Provider</label>\n                            <select id="lumia-sum-provider-select" class="lumia-modal-select">\n                                ').concat(Object.entries(o.x$).map(e=>{let[n,t]=e;return'<option value="'.concat(n,'" ').concat(v===n?"selected":"",">").concat(t.name,"</option>")}).join(""),'\n                            </select>\n                            <span class="lumia-modal-hint lumia-sum-provider-hint ').concat("custom"===v?"lumia-hidden":"",'">\n                                Uses API key from SillyTavern settings\n                            </span>\n                        </div>\n\n                        <div class="lumia-modal-field-row">\n                            <div class="lumia-modal-field">\n                                <label class="lumia-modal-label" for="lumia-sum-model-input">Model</label>\n                                <input type="text" id="lumia-sum-model-input" class="lumia-modal-input"\n                                       placeholder="').concat(P.placeholder,'"\n                                       value="').concat((0,a.ZD)(h),'" />\n                            </div>\n                        </div>\n\n                        <div class="lumia-modal-field lumia-sum-custom-fields ').concat("custom"===v?"":"lumia-hidden",'">\n                            <label class="lumia-modal-label" for="lumia-sum-endpoint-input">Endpoint URL</label>\n                            <input type="text" id="lumia-sum-endpoint-input" class="lumia-modal-input"\n                                   placeholder="https://your-api.com/v1/chat/completions"\n                                   value="').concat((0,a.ZD)(f),'" />\n                        </div>\n\n                        <div class="lumia-modal-field lumia-sum-custom-fields ').concat("custom"===v?"":"lumia-hidden",'">\n                            <label class="lumia-modal-label" for="lumia-sum-apikey-input">API Key</label>\n                            <input type="password" id="lumia-sum-apikey-input" class="lumia-modal-input"\n                                   placeholder="Your API key"\n                                   value="').concat((0,a.ZD)(b),'" />\n                        </div>\n\n                        <div class="lumia-modal-field-row lumia-modal-field-row-3">\n                            <div class="lumia-modal-field">\n                                <label class="lumia-modal-label" for="lumia-sum-temp-input">Temp</label>\n                                <input type="number" id="lumia-sum-temp-input" class="lumia-modal-input"\n                                       min="0" max="2" step="0.1" value="').concat(x,'" />\n                            </div>\n                            <div class="lumia-modal-field">\n                                <label class="lumia-modal-label" for="lumia-sum-topp-input">Top-P</label>\n                                <input type="number" id="lumia-sum-topp-input" class="lumia-modal-input"\n                                       min="0" max="1" step="0.05" value="').concat(k,'" />\n                            </div>\n                            <div class="lumia-modal-field">\n                                <label class="lumia-modal-label" for="lumia-sum-maxtokens-input">Max Tokens</label>\n                                <input type="text" id="lumia-sum-maxtokens-input" class="lumia-modal-input"\n                                       value="').concat(w,'" />\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                \x3c!-- Test Section --\x3e\n                <div class="lumia-modal-panel lumia-modal-panel-accent">\n                    <div class="lumia-modal-panel-header">\n                        <span class="lumia-modal-panel-icon">\n                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                                <polygon points="5 3 19 12 5 21 5 3"></polygon>\n                            </svg>\n                        </span>\n                        <span class="lumia-modal-panel-title">Test</span>\n                    </div>\n                    <div class="lumia-modal-panel-content">\n                        <button id="lumia-sum-test-btn" class="lumia-modal-btn lumia-modal-btn-primary lumia-modal-btn-full ').concat(N?"":"lumia-btn-disabled",'" ').concat(N?"":"disabled",'>\n                            <span class="lumia-btn-icon">\n                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                                    <polyline points="20 6 9 17 4 12"></polyline>\n                                </svg>\n                            </span>\n                            <span class="lumia-btn-spinner lumia-hidden"></span>\n                            <span class="lumia-btn-text">').concat(N?"Generate Summary Now":"No Active Chat",'</span>\n                        </button>\n                        <div id="lumia-sum-test-result" class="lumia-test-result lumia-hidden"></div>\n                        ').concat(N?"":'<div class="lumia-test-hint">Open a chat to test summarization</div>','\n                    </div>\n                </div>\n\n                \x3c!-- Message Truncation Section --\x3e\n                <div class="lumia-modal-panel">\n                    <div class="lumia-modal-panel-header">\n                        <span class="lumia-modal-panel-icon">\n                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>\n                            </svg>\n                        </span>\n                        <span class="lumia-modal-panel-title">Save N Messages</span>\n                    </div>\n                    <div class="lumia-modal-panel-content">\n                        <div class="lumia-filter-item">\n                            <div class="lumia-toggle-row">\n                                <label class="lumia-toggle-label" for="lumia-trunc-toggle">\n                                    <span class="lumia-toggle-text">Limit Context Messages</span>\n                                    <span class="lumia-toggle-hint">Only send the last N messages to the AI</span>\n                                </label>\n                                <div class="lumia-toggle-switch-wrapper">\n                                    <input type="checkbox" id="lumia-trunc-toggle" class="lumia-toggle-input" ').concat(S?"checked":"",' />\n                                    <label for="lumia-trunc-toggle" class="lumia-toggle-switch-label">\n                                        <div class="lumia-toggle-track">\n                                            <div class="lumia-toggle-thumb"></div>\n                                        </div>\n                                    </label>\n                                </div>\n                            </div>\n                            <div class="lumia-filter-options ').concat(S?"":"lumia-filter-options-hidden",'">\n                                <label class="lumia-input-label">\n                                    <span>Messages to keep:</span>\n                                    <input type="number" id="lumia-trunc-count-input" class="lumia-input-number" value="').concat(C,'" min="5" max="500" />\n                                </label>\n                                <span class="lumia-input-hint">Number of recent messages to include in context</span>\n\n                                <div class="lumia-warning-box">\n                                    <div class="lumia-warning-box-icon">\n                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                                            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>\n                                            <line x1="12" y1="9" x2="12" y2="13"></line>\n                                            <line x1="12" y1="17" x2="12.01" y2="17"></line>\n                                        </svg>\n                                    </div>\n                                    <div class="lumia-warning-box-content">\n                                        <div class="lumia-warning-box-title">Memory Loss Warning</div>\n                                        <div class="lumia-warning-box-text">\n                                            Older messages beyond this limit will be excluded from the AI\'s context.\n                                            The AI will lose awareness of earlier events, character details, and plot points.\n                                            Consider using Loom summarization to preserve important memories.\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n            </div>\n            <div class="lumia-modal-footer">\n                <button class="lumia-modal-btn lumia-modal-btn-secondary lumia-sum-cancel-btn">Cancel</button>\n                <button class="lumia-modal-btn lumia-modal-btn-primary lumia-sum-save-btn">Save Changes</button>\n            </div>\n        </dialog>\n    ');$("body").append(E);const O=$("#lumia-summarization-modal");y(O);const M=()=>{O[0]._resizeCleanup&&O[0]._resizeCleanup(),O[0].close(),O.remove()};O.on("click mousedown mouseup",function(e){e.stopPropagation(),"click"===e.type&&e.target===this&&M()}),O.find('input[name="sum-mode"]').change(function(){O.find(".lumia-mode-option").each(function(){$(this).find('input[name="sum-mode"]').is(":checked")?$(this).addClass("selected"):$(this).removeClass("selected")});const e=$(this).val();"auto"===e?(O.find("#lumia-sum-auto-section").show(),O.find("#lumia-sum-manual-section").show()):"manual"===e?(O.find("#lumia-sum-auto-section").hide(),O.find("#lumia-sum-manual-section").show()):(O.find("#lumia-sum-auto-section").hide(),O.find("#lumia-sum-manual-section").hide())}),O.find('input[name="sum-source"]').change(function(){O.find(".lumia-mode-option").each(function(){const e=$(this).find('input[name="sum-source"]');e.length&&e.is(":checked")?$(this).addClass("selected"):$(this).find('input[name="sum-source"]').length&&$(this).removeClass("selected")});"secondary"===$(this).val()?O.find("#lumia-sum-secondary-section").show():O.find("#lumia-sum-secondary-section").hide()}),O.find("#lumia-sum-provider-select").change(function(){const e=$(this).val(),n=(0,o.Iv)(e);O.find("#lumia-sum-model-input").attr("placeholder",n.placeholder),"custom"===e?(O.find(".lumia-sum-custom-fields").removeClass("lumia-hidden"),O.find(".lumia-sum-provider-hint").addClass("lumia-hidden")):(O.find(".lumia-sum-custom-fields").addClass("lumia-hidden"),O.find(".lumia-sum-provider-hint").removeClass("lumia-hidden"))}),O.find("#lumia-trunc-toggle").change(function(){const e=$(this).closest(".lumia-filter-item").find(".lumia-filter-options");$(this).is(":checked")?e.removeClass("lumia-filter-options-hidden"):e.addClass("lumia-filter-options-hidden")});const z=e=>{const n=parseInt(e,10);return isNaN(n)||!/^\d+$/.test(String(e).trim())?8192:Math.max(256,n)};O.find("#lumia-sum-test-btn").click(async function(){const e=$(this),n=e.find(".lumia-btn-icon"),t=e.find(".lumia-btn-spinner"),r=e.find(".lumia-btn-text"),a=O.find("#lumia-sum-test-result");e.prop("disabled",!0),n.addClass("lumia-hidden"),t.removeClass("lumia-hidden"),r.text("Weaving summary..."),a.addClass("lumia-hidden").removeClass("lumia-test-result-success lumia-test-result-error");try{const i={mode:O.find('input[name="sum-mode"]:checked').val(),apiSource:O.find('input[name="sum-source"]:checked').val(),autoInterval:parseInt(O.find("#lumia-sum-interval-input").val())||10,autoMessageContext:parseInt(O.find("#lumia-sum-auto-context-input").val())||10,manualMessageContext:parseInt(O.find("#lumia-sum-manual-context-input").val())||10,secondary:{provider:O.find("#lumia-sum-provider-select").val(),model:O.find("#lumia-sum-model-input").val(),endpoint:O.find("#lumia-sum-endpoint-input").val(),apiKey:O.find("#lumia-sum-apikey-input").val(),temperature:parseFloat(O.find("#lumia-sum-temp-input").val())||.7,topP:parseFloat(O.find("#lumia-sum-topp-input").val())||1,maxTokens:z(O.find("#lumia-sum-maxtokens-input").val())}},s=await(0,o.Zq)(i,!0);e.prop("disabled",!1),t.addClass("lumia-hidden"),n.removeClass("lumia-hidden"),r.text("Generate Summary Now"),s?(a.removeClass("lumia-hidden").addClass("lumia-test-result-success").html('\n            <div class="lumia-test-result-icon">\n              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                <polyline points="20 6 9 17 4 12"></polyline>\n              </svg>\n            </div>\n            <div class="lumia-test-result-content">\n              <div class="lumia-test-result-title">Summary woven successfully!</div>\n              <div class="lumia-test-result-text">Saved to chat metadata.</div>\n            </div>\n          '),toastr.success("Summary generated and saved to chat metadata!")):a.removeClass("lumia-hidden").addClass("lumia-test-result-error").html('\n            <div class="lumia-test-result-icon">\n              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                <circle cx="12" cy="12" r="10"></circle>\n                <line x1="12" y1="8" x2="12" y2="12"></line>\n                <line x1="12" y1="16" x2="12.01" y2="16"></line>\n              </svg>\n            </div>\n            <div class="lumia-test-result-content">\n              <div class="lumia-test-result-title">No summary generated</div>\n              <div class="lumia-test-result-text">Check console for details.</div>\n            </div>\n          ')}catch(o){console.error("[".concat(i.pW,"] Summarization error:"),o),e.prop("disabled",!1),t.addClass("lumia-hidden"),n.removeClass("lumia-hidden"),r.text("Generate Summary Now"),a.removeClass("lumia-hidden").addClass("lumia-test-result-error").html('\n          <div class="lumia-test-result-icon">\n            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n              <circle cx="12" cy="12" r="10"></circle>\n              <path d="M15 9l-6 6M9 9l6 6"></path>\n            </svg>\n          </div>\n          <div class="lumia-test-result-content">\n            <div class="lumia-test-result-title">Error</div>\n            <div class="lumia-test-result-text">'.concat(o.message,"</div>\n          </div>\n        "))}}),O.find(".lumia-sum-save-btn").click(()=>{const e=z(O.find("#lumia-sum-maxtokens-input").val());O.find("#lumia-sum-maxtokens-input").val(e),n.summarization={mode:O.find('input[name="sum-mode"]:checked').val(),apiSource:O.find('input[name="sum-source"]:checked').val(),autoInterval:parseInt(O.find("#lumia-sum-interval-input").val())||10,autoMessageContext:parseInt(O.find("#lumia-sum-auto-context-input").val())||10,manualMessageContext:parseInt(O.find("#lumia-sum-manual-context-input").val())||10,secondary:{provider:O.find("#lumia-sum-provider-select").val(),model:O.find("#lumia-sum-model-input").val(),endpoint:O.find("#lumia-sum-endpoint-input").val(),apiKey:O.find("#lumia-sum-apikey-input").val(),temperature:parseFloat(O.find("#lumia-sum-temp-input").val())||.7,topP:parseFloat(O.find("#lumia-sum-topp-input").val())||1,maxTokens:e}},n.messageTruncation={enabled:O.find("#lumia-trunc-toggle").is(":checked"),keepCount:parseInt(O.find("#lumia-trunc-count-input").val())||50},(0,i.DZ)(),(0,l.TC)(),toastr.success("Summarization settings saved!"),M()}),O.find(".lumia-sum-cancel-btn").click(M),O.on("keydown",function(e){"Escape"===e.key&&M()}),O[0].showModal()}function C(){const e=(0,i.mt)();$("#lumia-prompt-settings-modal").remove();const n=e.sovereignHand||{},t=n.enabled||!1,r=!1!==n.excludeLastMessage,a=!1!==n.includeMessageInPrompt,o=e.contextFilters||{},s=o.htmlTags||{},c=o.detailsBlocks||{},u=o.loomItems||{},d='\n        <dialog id="lumia-prompt-settings-modal" class="popup popup--animation-fast lumia-modal lumia-modal-settings">\n            <div class="lumia-modal-header">\n                <div class="lumia-modal-header-icon">\n                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>\n                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>\n                    </svg>\n                </div>\n                <h3 class="lumia-modal-title">Prompt Settings</h3>\n            </div>\n            <div class="lumia-modal-content">\n\n                \x3c!-- Sovereign Hand Section --\x3e\n                <div class="lumia-modal-panel lumia-collapsible">\n                    <div class="lumia-modal-panel-header lumia-collapsible-trigger">\n                        <span class="lumia-panel-collapse-icon">\n                            '.concat(b,'\n                        </span>\n                        <span class="lumia-modal-panel-icon">\n                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                                <path d="M18 3a3 3 0 0 0-3 3v12a3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3H6a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3V6a3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3h12a3 3 0 0 0 3-3 3 3 0 0 0-3-3z"></path>\n                            </svg>\n                        </span>\n                        <span class="lumia-modal-panel-title">Sovereign Hand</span>\n                        <span class="lumia-panel-status ').concat(t?"lumia-panel-status-active":"",'">').concat(t?"Active":"Inactive",'</span>\n                    </div>\n                    <div class="lumia-modal-panel-content lumia-collapsible-content">\n                        <div class="lumia-panel-content-inner">\n                            <p class="lumia-modal-description">Enable Sovereign Hand integration to use advanced prompt manipulation features.</p>\n\n                            <div class="lumia-toggle-row">\n                                <label class="lumia-toggle-label" for="lumia-sovereign-hand-toggle">\n                                    <span class="lumia-toggle-text">Use Sovereign Hand Features</span>\n                                    <span class="lumia-toggle-hint">Enables Sovereign Hand macros for advanced prompt control</span>\n                                </label>\n                                <div class="lumia-toggle-switch-wrapper">\n                                    <input type="checkbox" id="lumia-sovereign-hand-toggle" class="lumia-toggle-input" ').concat(t?"checked":"",' />\n                                    <label for="lumia-sovereign-hand-toggle" class="lumia-toggle-switch-label">\n                                        <div class="lumia-toggle-track">\n                                            <div class="lumia-toggle-thumb"></div>\n                                        </div>\n                                    </label>\n                                </div>\n                            </div>\n\n                            <div class="lumia-toggle-row ').concat(t?"":"lumia-toggle-disabled",'">\n                                <label class="lumia-toggle-label" for="lumia-sovereign-exclude-toggle">\n                                    <span class="lumia-toggle-text">Exclude Last Message from Context</span>\n                                    <span class="lumia-toggle-hint">When enabled, removes the last user message from the outgoing context</span>\n                                </label>\n                                <div class="lumia-toggle-switch-wrapper">\n                                    <input type="checkbox" id="lumia-sovereign-exclude-toggle" class="lumia-toggle-input" ').concat(r?"checked":""," ").concat(t?"":"disabled",' />\n                                    <label for="lumia-sovereign-exclude-toggle" class="lumia-toggle-switch-label">\n                                        <div class="lumia-toggle-track">\n                                            <div class="lumia-toggle-thumb"></div>\n                                        </div>\n                                    </label>\n                                </div>\n                            </div>\n\n                            <div class="lumia-toggle-row ').concat(t?"":"lumia-toggle-disabled",'">\n                                <label class="lumia-toggle-label" for="lumia-sovereign-include-prompt-toggle">\n                                    <span class="lumia-toggle-text">Include Message in Master Prompt</span>\n                                    <span class="lumia-toggle-hint">When enabled, includes the user message in the {{loomSovHand}} macro output</span>\n                                </label>\n                                <div class="lumia-toggle-switch-wrapper">\n                                    <input type="checkbox" id="lumia-sovereign-include-prompt-toggle" class="lumia-toggle-input" ').concat(a?"checked":""," ").concat(t?"":"disabled",' />\n                                    <label for="lumia-sovereign-include-prompt-toggle" class="lumia-toggle-switch-label">\n                                        <div class="lumia-toggle-track">\n                                            <div class="lumia-toggle-thumb"></div>\n                                        </div>\n                                    </label>\n                                </div>\n                            </div>\n\n                            <div class="lumia-info-box lumia-info-box-sovereign ').concat(t?"":"lumia-info-box-muted",'">\n                                <div class="lumia-info-box-header">\n                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                                        <circle cx="12" cy="12" r="10"></circle>\n                                        <line x1="12" y1="16" x2="12" y2="12"></line>\n                                        <line x1="12" y1="8" x2="12.01" y2="8"></line>\n                                    </svg>\n                                    <span>Available macros:</span>\n                                </div>\n                                <ul class="lumia-info-box-list">\n                                    <li><code>{{loomLastUserMessage}}</code> returns the last user message content</li>\n                                    <li><code>{{loomLastCharMessage}}</code> returns the last character message content</li>\n                                    <li><code>{{lastMessageName}}</code> returns the name of whoever sent the last message</li>\n                                    <li><code>{{loomContinuePrompt}}</code> adds continuation instructions when character spoke last</li>\n                                </ul>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                \x3c!-- Context Filters Section --\x3e\n                <div class="lumia-modal-panel lumia-collapsible">\n                    <div class="lumia-modal-panel-header lumia-collapsible-trigger">\n                        <span class="lumia-panel-collapse-icon">\n                            ').concat(b,'\n                        </span>\n                        <span class="lumia-modal-panel-icon">\n                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                                <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>\n                            </svg>\n                        </span>\n                        <span class="lumia-modal-panel-title">Context Filters</span>\n                        <span class="lumia-panel-status ').concat(s.enabled||c.enabled||u.enabled?"lumia-panel-status-active":"",'">').concat(s.enabled||c.enabled||u.enabled?"Active":"Inactive",'</span>\n                    </div>\n                    <div class="lumia-modal-panel-content lumia-collapsible-content">\n                        <div class="lumia-panel-content-inner">\n                            <p class="lumia-modal-description">Filter out specific content from the chat context before sending to the AI. Helps reduce token usage and keep prompts clean.</p>\n\n                            \x3c!-- HTML Tags Filter --\x3e\n                            <div class="lumia-filter-item">\n                                <div class="lumia-toggle-row">\n                                    <label class="lumia-toggle-label" for="lumia-filter-html-toggle">\n                                        <span class="lumia-toggle-text">Strip HTML Tags</span>\n                                        <span class="lumia-toggle-hint">Removes formatting tags: &lt;div&gt;, &lt;span&gt;, &lt;b&gt;, &lt;i&gt;, &lt;u&gt;, &lt;em&gt;, &lt;strong&gt;</span>\n                                    </label>\n                                    <div class="lumia-toggle-switch-wrapper">\n                                        <input type="checkbox" id="lumia-filter-html-toggle" class="lumia-toggle-input" ').concat(s.enabled?"checked":"",' />\n                                        <label for="lumia-filter-html-toggle" class="lumia-toggle-switch-label">\n                                            <div class="lumia-toggle-track">\n                                                <div class="lumia-toggle-thumb"></div>\n                                            </div>\n                                        </label>\n                                    </div>\n                                </div>\n                                <div class="lumia-filter-options ').concat(s.enabled?"":"lumia-filter-options-hidden",'">\n                                    <label class="lumia-input-label">\n                                        <span>Keep HTML in last N messages:</span>\n                                        <input type="number" id="lumia-filter-html-depth" class="lumia-input-number" value="').concat(s.keepDepth||3,'" min="0" max="100" />\n                                    </label>\n                                    <span class="lumia-input-hint">HTML tags in older messages will be stripped to save tokens</span>\n                                    \x3c!-- Strip Fonts Sub-toggle --\x3e\n                                    <div class="lumia-filter-sub-item">\n                                        <div class="lumia-toggle-row">\n                                            <label class="lumia-toggle-label" for="lumia-filter-fonts-toggle">\n                                                <span class="lumia-toggle-text">Also Strip Fonts</span>\n                                                <span class="lumia-toggle-hint">Remove &lt;font&gt; tags (used by some presets for colored dialogue)</span>\n                                            </label>\n                                            <div class="lumia-toggle-switch-wrapper">\n                                                <input type="checkbox" id="lumia-filter-fonts-toggle" class="lumia-toggle-input" ').concat(s.stripFonts?"checked":"",' />\n                                                <label for="lumia-filter-fonts-toggle" class="lumia-toggle-switch-label">\n                                                    <div class="lumia-toggle-track">\n                                                        <div class="lumia-toggle-thumb"></div>\n                                                    </div>\n                                                </label>\n                                            </div>\n                                        </div>\n                                        <div class="lumia-filter-options lumia-filter-sub-options ').concat(s.stripFonts?"":"lumia-filter-options-hidden",'">\n                                            <label class="lumia-input-label">\n                                                <span>Keep fonts in last N messages:</span>\n                                                <input type="number" id="lumia-filter-fonts-depth" class="lumia-input-number" value="').concat(s.fontKeepDepth||3,'" min="0" max="100" />\n                                            </label>\n                                            <span class="lumia-input-hint">Font tags in older messages will be stripped to save tokens</span>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n\n                            \x3c!-- Details Blocks Filter --\x3e\n                            <div class="lumia-filter-item">\n                                <div class="lumia-toggle-row">\n                                    <label class="lumia-toggle-label" for="lumia-filter-details-toggle">\n                                        <span class="lumia-toggle-text">Filter Details Blocks</span>\n                                        <span class="lumia-toggle-hint">Removes &lt;details&gt; blocks from older messages to save context</span>\n                                    </label>\n                                    <div class="lumia-toggle-switch-wrapper">\n                                        <input type="checkbox" id="lumia-filter-details-toggle" class="lumia-toggle-input" ').concat(c.enabled?"checked":"",' />\n                                        <label for="lumia-filter-details-toggle" class="lumia-toggle-switch-label">\n                                            <div class="lumia-toggle-track">\n                                                <div class="lumia-toggle-thumb"></div>\n                                            </div>\n                                        </label>\n                                    </div>\n                                </div>\n                                <div class="lumia-filter-options ').concat(c.enabled?"":"lumia-filter-options-hidden",'">\n                                    <label class="lumia-input-label">\n                                        <span>Keep in last N messages:</span>\n                                        <input type="number" id="lumia-filter-details-depth" class="lumia-input-number" value="').concat(c.keepDepth||3,'" min="0" max="100" />\n                                    </label>\n                                    <span class="lumia-input-hint">Messages beyond this depth will have &lt;details&gt; blocks removed</span>\n                                </div>\n                            </div>\n\n                            \x3c!-- Loom Items Filter --\x3e\n                            <div class="lumia-filter-item">\n                                <div class="lumia-toggle-row">\n                                    <label class="lumia-toggle-label" for="lumia-filter-loom-toggle">\n                                        <span class="lumia-toggle-text">Filter Loom Tags</span>\n                                        <span class="lumia-toggle-hint">Removes Lucid Loom-related tags from older messages</span>\n                                    </label>\n                                    <div class="lumia-toggle-switch-wrapper">\n                                        <input type="checkbox" id="lumia-filter-loom-toggle" class="lumia-toggle-input" ').concat(u.enabled?"checked":"",' />\n                                        <label for="lumia-filter-loom-toggle" class="lumia-toggle-switch-label">\n                                            <div class="lumia-toggle-track">\n                                                <div class="lumia-toggle-thumb"></div>\n                                            </div>\n                                        </label>\n                                    </div>\n                                </div>\n                                <div class="lumia-filter-options ').concat(u.enabled?"":"lumia-filter-options-hidden",'">\n                                    <label class="lumia-input-label">\n                                        <span>Keep in last N messages:</span>\n                                        <input type="number" id="lumia-filter-loom-depth" class="lumia-input-number" value="').concat(u.keepDepth||5,'" min="0" max="100" />\n                                    </label>\n                                    <span class="lumia-input-hint">Loom tags in older messages will be stripped to save tokens</span>\n                                </div>\n                            </div>\n\n                        </div>\n                    </div>\n                </div>\n\n            </div>\n            <div class="lumia-modal-footer">\n                <button class="lumia-modal-btn lumia-modal-btn-secondary lumia-prompt-settings-cancel-btn">Cancel</button>\n                <button class="lumia-modal-btn lumia-modal-btn-primary lumia-prompt-settings-save-btn">Save Changes</button>\n            </div>\n        </dialog>\n    ');$("body").append(d);const m=$("#lumia-prompt-settings-modal");y(m);const p=()=>{m[0]._resizeCleanup&&m[0]._resizeCleanup(),m[0].close(),m.remove()};function g(){const e=m.find("#lumia-filter-html-toggle").is(":checked"),n=m.find("#lumia-filter-details-toggle").is(":checked"),t=m.find("#lumia-filter-loom-toggle").is(":checked"),r=m.find(".lumia-modal-panel").eq(1).find(".lumia-panel-status");e||n||t?r.addClass("lumia-panel-status-active").text("Active"):r.removeClass("lumia-panel-status-active").text("Inactive")}m.on("click mousedown mouseup",function(e){e.stopPropagation(),"click"===e.type&&e.target===this&&p()}),m.find(".lumia-collapsible-trigger").click(function(e){$(e.target).closest("input, label, .lumia-toggle-switch-wrapper").length>0||$(this).closest(".lumia-collapsible").toggleClass("collapsed")}),m.find("#lumia-sovereign-hand-toggle").change(function(){const e=$(this).is(":checked"),n=m.find(".lumia-info-box-sovereign"),t=$(this).closest(".lumia-collapsible").find(".lumia-panel-status"),r=m.find("#lumia-sovereign-exclude-toggle"),i=r.closest(".lumia-toggle-row"),a=m.find("#lumia-sovereign-include-prompt-toggle"),o=a.closest(".lumia-toggle-row");e?(n.removeClass("lumia-info-box-muted"),t.addClass("lumia-panel-status-active").text("Active"),r.prop("disabled",!1),i.removeClass("lumia-toggle-disabled"),a.prop("disabled",!1),o.removeClass("lumia-toggle-disabled")):(n.addClass("lumia-info-box-muted"),t.removeClass("lumia-panel-status-active").text("Inactive"),r.prop("disabled",!0),i.addClass("lumia-toggle-disabled"),a.prop("disabled",!0),o.addClass("lumia-toggle-disabled"))}),m.find("#lumia-filter-details-toggle").change(function(){const e=$(this).closest(".lumia-filter-item").find(".lumia-filter-options");$(this).is(":checked")?e.removeClass("lumia-filter-options-hidden"):e.addClass("lumia-filter-options-hidden"),g()}),m.find("#lumia-filter-loom-toggle").change(function(){const e=$(this).closest(".lumia-filter-item").find(".lumia-filter-options");$(this).is(":checked")?e.removeClass("lumia-filter-options-hidden"):e.addClass("lumia-filter-options-hidden"),g()}),m.find("#lumia-filter-html-toggle").change(function(){const e=$(this).closest(".lumia-filter-item").find("> .lumia-filter-options");$(this).is(":checked")?e.removeClass("lumia-filter-options-hidden"):e.addClass("lumia-filter-options-hidden"),g()}),m.find("#lumia-filter-fonts-toggle").change(function(){const e=$(this).closest(".lumia-filter-sub-item").find(".lumia-filter-sub-options");$(this).is(":checked")?e.removeClass("lumia-filter-options-hidden"):e.addClass("lumia-filter-options-hidden")}),m.find(".lumia-prompt-settings-save-btn").click(()=>{const n=m.find("#lumia-sovereign-hand-toggle").is(":checked"),t=m.find("#lumia-sovereign-exclude-toggle").is(":checked"),r=m.find("#lumia-sovereign-include-prompt-toggle").is(":checked");e.sovereignHand||(e.sovereignHand={}),e.sovereignHand.enabled=n,e.sovereignHand.excludeLastMessage=t,e.sovereignHand.includeMessageInPrompt=r,e.contextFilters||(e.contextFilters={}),e.contextFilters.htmlTags={enabled:m.find("#lumia-filter-html-toggle").is(":checked"),keepDepth:parseInt(m.find("#lumia-filter-html-depth").val())||3,stripFonts:m.find("#lumia-filter-fonts-toggle").is(":checked"),fontKeepDepth:parseInt(m.find("#lumia-filter-fonts-depth").val())||3},e.contextFilters.detailsBlocks={enabled:m.find("#lumia-filter-details-toggle").is(":checked"),keepDepth:parseInt(m.find("#lumia-filter-details-depth").val())||3},e.contextFilters.loomItems={enabled:m.find("#lumia-filter-loom-toggle").is(":checked"),keepDepth:parseInt(m.find("#lumia-filter-loom-depth").val())||5},(0,i.DZ)(),(0,l.TC)(),toastr.success("Prompt settings saved!"),p()}),m.find(".lumia-prompt-settings-cancel-btn").click(p),m.on("keydown",function(e){"Escape"===e.key&&p()}),m[0].showModal()}async function N(){(0,i.mt)();$("#lucid-cards-modal").remove();$("body").append('\n        <dialog id="lucid-cards-modal" class="popup popup--animation-fast lumia-modal lumia-modal-lucid-cards">\n            <div class="lumia-modal-header">\n                <div class="lumia-modal-header-icon">\n                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                        <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>\n                        <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>\n                        <line x1="12" y1="22.08" x2="12" y2="12"></line>\n                    </svg>\n                </div>\n                <div class="lumia-modal-header-text">\n                    <h3 class="lumia-modal-title">Lucid Cards Browser</h3>\n                    <p class="lumia-modal-subtitle">Browse and import official Lumiverse content</p>\n                </div>\n            </div>\n            <div class="lucid-cards-tabs">\n                <button class="lucid-cards-tab active" data-category="Lumia DLCs">\n                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>\n                        <circle cx="12" cy="7" r="4"></circle>\n                    </svg>\n                    <span>Lumia DLCs</span>\n                </button>\n                <button class="lucid-cards-tab" data-category="Loom Utilities">\n                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                        <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path>\n                    </svg>\n                    <span>Utilities</span>\n                </button>\n                <button class="lucid-cards-tab" data-category="Loom Retrofits">\n                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                        <circle cx="12" cy="12" r="3"></circle>\n                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"></path>\n                    </svg>\n                    <span>Retrofits</span>\n                </button>\n                <button class="lucid-cards-tab" data-category="Loom Narratives">\n                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                        <path d="M12 19l7-7 3 3-7 7-3-3z"></path>\n                        <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"></path>\n                        <path d="M2 2l7.586 7.586"></path>\n                        <circle cx="11" cy="11" r="2"></circle>\n                    </svg>\n                    <span>Narratives</span>\n                </button>\n            </div>\n            <div class="lumia-modal-content">\n                <div class="lucid-cards-loading">\n                    <div class="lucid-cards-spinner"></div>\n                    <span>Loading content from Lucid.cards...</span>\n                </div>\n                <div class="lucid-cards-error" style="display: none;">\n                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                        <circle cx="12" cy="12" r="10"></circle>\n                        <line x1="15" y1="9" x2="9" y2="15"></line>\n                        <line x1="9" y1="9" x2="15" y2="15"></line>\n                    </svg>\n                    <span class="lucid-cards-error-message">Failed to load content</span>\n                    <button class="lumia-modal-btn lumia-modal-btn-secondary lucid-cards-retry-btn">Retry</button>\n                </div>\n                <div class="lucid-cards-content" style="display: none;"></div>\n            </div>\n            <div class="lumia-modal-footer lucid-cards-footer">\n                <button class="lumia-modal-btn lumia-modal-btn-secondary lucid-cards-close-btn">Close</button>\n                <div class="lucid-cards-selection-controls" style="display: none;">\n                    <button class="lumia-modal-btn lumia-modal-btn-text lucid-cards-select-all-btn">Select All</button>\n                    <button class="lumia-modal-btn lumia-modal-btn-text lucid-cards-clear-btn">Clear</button>\n                </div>\n                <div class="lucid-cards-selected-count" style="display: none;">\n                    <span class="lucid-cards-count-text">0 selected</span>\n                </div>\n                <button class="lumia-modal-btn lumia-modal-btn-primary lucid-cards-import-btn" style="display: none;">\n                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>\n                        <polyline points="7 10 12 15 17 10"></polyline>\n                        <line x1="12" y1="15" x2="12" y2="3"></line>\n                    </svg>\n                    <span class="lucid-cards-import-text">Import Packs</span>\n                </button>\n            </div>\n        </dialog>\n    ');const e=$("#lucid-cards-modal");let n="Lumia DLCs",r=[],o=null;const s=()=>{const n=r.length;0===n?(e.find(".lucid-cards-selection-controls").hide(),e.find(".lucid-cards-selected-count").hide(),e.find(".lucid-cards-import-btn").hide()):(e.find(".lucid-cards-selection-controls").show(),e.find(".lucid-cards-selected-count").show(),e.find(".lucid-cards-count-text").text("".concat(n," selected")),e.find(".lucid-cards-import-text").text(1===n?"Import Pack":"Import ".concat(n," Packs")),e.find(".lucid-cards-import-btn").show()),requestAnimationFrame(()=>c())},c=()=>{const n=e[0],t=(window.innerHeight||document.documentElement.clientHeight)-((window.innerWidth||document.documentElement.clientWidth)<=600?24:48);n.style.maxHeight="".concat(t,"px");const r=e.find(".lumia-modal-header"),i=e.find(".lucid-cards-tabs"),a=e.find(".lumia-modal-footer"),o=e.find(".lumia-modal-content");requestAnimationFrame(()=>{const e=r.length?r[0].offsetHeight:0,n=i.length?i[0].offsetHeight:0,s=a.length?a[0].offsetHeight:0,l=t-e-n-s;o.length&&(o[0].style.maxHeight="".concat(l,"px"),o[0].style.overflowY="auto")})};c();const u=()=>c();window.addEventListener("resize",u),e[0]._resizeCleanup=()=>window.removeEventListener("resize",u);const d=()=>{e[0]._resizeCleanup&&e[0]._resizeCleanup(),e[0].close(),e.remove(),p()};e.on("click mousedown mouseup",function(e){e.stopPropagation(),"click"===e.type&&e.target===this&&d()}),e.on("keydown",function(e){"Escape"===e.key&&d()});const m=async()=>{e.find(".lucid-cards-loading").show(),e.find(".lucid-cards-error").hide(),e.find(".lucid-cards-content").hide(),r=[],s();try{const e=await fetch("https://lucid.cards/api/lumia-dlc");if(!e.ok)throw new Error("HTTP error: ".concat(e.status));o=await e.json(),g()}catch(n){console.error("[".concat(i.pW,"] Failed to fetch Lucid.cards:"),n),e.find(".lucid-cards-loading").hide(),e.find(".lucid-cards-error-message").text("Failed to load: ".concat(n.message)),e.find(".lucid-cards-error").show()}},g=()=>{var t;const i=(null===(t=o)||void 0===t?void 0:t.packs)||[];if(!o||0===i.length)return e.find(".lucid-cards-loading").hide(),e.find(".lucid-cards-error-message").text("No content available"),void e.find(".lucid-cards-error").show();e.find(".lucid-cards-loading").hide(),e.find(".lucid-cards-error").hide();const l=e.find(".lucid-cards-content");let c;if(l.empty(),c="Lumia DLCs"===n?i.filter(e=>"lumia"===e.packType||e.lumiaCount&&e.lumiaCount>0):i.filter(e=>"loom"===e.packType||e.loomCount&&e.loomCount>0),0===c.length)return l.html('<div class="lucid-cards-empty">No items available in this category.</div>'),void l.show();const u=c.map(e=>{const n=e.packName||"Unknown",t=(0,a.ZD)(n),r=e.slug?"/api/lumia-dlc/".concat(e.slug):"",i=(0,a.ZD)(r),o=e.coverUrl||null,s=e.packAuthor||null,l=[];e.lumiaCount>0&&l.push("".concat(e.lumiaCount," Lumia")),e.loomCount>0&&l.push("".concat(e.loomCount," Loom")),e.extrasCount>0&&l.push("".concat(e.extrasCount," Extra"));const c=l.length>0?l.join(", "):"",u=o?'<img src="'.concat((0,a.ZD)(o),'" alt="" loading="lazy" class="lumia-img-loaded">'):'<div class="lucid-dlc-card-placeholder">\n                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">\n                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>\n                    <circle cx="8.5" cy="8.5" r="1.5"></circle>\n                    <polyline points="21 15 16 10 5 21"></polyline>\n                </svg>\n            </div>',d=s?(0,a.ZD)(s):"Unknown Author";return'\n                  <div class="lucid-dlc-card" data-path="'.concat(i,'" data-name="').concat(t,'"\n                       data-cover-img="').concat((0,a.ZD)(o||""),'" data-author="').concat((0,a.ZD)(s||""),'">\n                      <div class="lucid-dlc-card-image">\n                          ').concat(u,'\n                          <div class="lucid-dlc-card-check">\n                              ').concat(v,'\n                          </div>\n                      </div>\n                      <div class="lucid-dlc-card-info">\n                          <div class="lucid-dlc-card-title">').concat(t,'</div>\n                          <div class="lucid-dlc-card-author">').concat(d,"</div>\n                          ").concat(c?'<div class="lucid-dlc-card-counts">'.concat((0,a.ZD)(c),"</div>"):"","\n                      </div>\n                  </div>\n              ")}).join("");l.html('<div class="lucid-dlc-grid">'.concat(u,"</div>")),l.show(),r=[],e.find(".lucid-dlc-card").removeClass("selected"),s()};e.find(".lucid-cards-tab").click(function(){e.find(".lucid-cards-tab").removeClass("active"),$(this).addClass("active"),n=$(this).data("category"),r=[],e.find(".lucid-dlc-card").removeClass("selected"),s(),g()}),e.on("click",".lucid-dlc-card",function(){const e=$(this),n=e.data("path"),t=e.data("name"),i=e.data("author")||"Unknown Author",a=r.findIndex(e=>e.path===n);a>=0?(r.splice(a,1),e.removeClass("selected")):(r.push({path:n,name:t,author:i}),e.addClass("selected")),s()}),e.find(".lucid-cards-select-all-btn").click(function(){const n=e.find(".lucid-dlc-card");r=[],n.each(function(){const e=$(this);e.addClass("selected"),r.push({path:e.data("path"),name:e.data("name"),author:e.data("author")||"Unknown Author"})}),s()}),e.find(".lucid-cards-clear-btn").click(function(){r=[],e.find(".lucid-dlc-card").removeClass("selected"),s()}),e.find(".lucid-cards-close-btn").click(d),e.find(".lucid-cards-retry-btn").click(m),e.find(".lucid-cards-import-btn").click(async function(){if(0===r.length)return;const n=$(this),o=n.html(),c=r.length;let u=0,d=0,m=0;const p=(0,i.mt)(),{importPack:g}=await Promise.resolve().then(t.bind(t,154));n.prop("disabled",!0);for(let t=0;t<r.length;t++){const o=r[t];if(n.html('\n        <svg class="lucid-cards-btn-spinner" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n          <circle cx="12" cy="12" r="10"></circle>\n        </svg>\n        Importing '.concat(t+1," of ").concat(c,"...\n      ")),p.packs[o.name]){d++;const n=(0,a.ZD)(o.path);e.find('.lucid-dlc-card[data-path="'.concat(n,'"]')).addClass("already-imported");continue}try{const n=await fetch("https://lucid.cards".concat(o.path));if(!n.ok)throw new Error("HTTP error: ".concat(n.status));const t=await n.json();if(!1===t.success)throw new Error(t.error||"Failed to fetch pack");g(t.pack||t,o.name,!0),u++;const r=(0,a.ZD)(o.path);e.find('.lucid-dlc-card[data-path="'.concat(r,'"]')).addClass("imported")}catch(e){console.error("[".concat(i.pW,'] Import failed for "').concat(o.name,'":'),e),m++}}(0,l.TC)();const v=[];u>0&&v.push("".concat(u," imported")),d>0&&v.push("".concat(d," skipped (already exist)")),m>0&&v.push("".concat(m," failed")),u>0?toastr.success("Import complete: ".concat(v.join(", "))):d>0&&0===m?toastr.info("All ".concat(d," packs already exist")):toastr.error("Import failed: ".concat(v.join(", "))),r=[],e.find(".lucid-dlc-card").removeClass("selected"),s(),n.prop("disabled",!1).html(o)}),e[0].showModal(),m()}function P(){const e=(0,i.mt)(),n=document.getElementById("lumia-book-status"),t=Object.values(e.packs);if(t.length>0){if(n){const e=t.reduce((e,n)=>{var t,r,i;const a=(null===(t=n.lumiaItems)||void 0===t?void 0:t.length)||0,o=(null===(r=n.loomItems)||void 0===r?void 0:r.length)||0,s=(null===(i=n.items)||void 0===i?void 0:i.length)||0;return e+(a+o>0?a+o:s)},0);n.textContent="Loaded ".concat(t.length," packs (").concat(e," items total)")}const i=document.getElementById("lumia-current-definition");var r;if(i)if(e.chimeraMode&&(null===(r=e.selectedDefinitions)||void 0===r?void 0:r.length)>0){const n=e.selectedDefinitions.map(e=>{const n=(0,a.Br)(e.packName,e.itemName);return n?n.lumiaDefName:null}).filter(e=>e);i.textContent=n.length>0?"[Chimera] ".concat(n.join(" + ")):"No Chimera definitions selected"}else{const n=e.selectedDefinition;if(n){const e=(0,a.Br)(n.packName,n.itemName);i.textContent=e?"".concat(e.lumiaDefName," (").concat(n.packName,")"):"Item not found (Maybe pack removed?)"}else i.textContent="No definition selected"}const o=document.getElementById("lumia-current-behaviors");if(o){const n=e.selectedBehaviors.map(n=>{const t=(0,a.Br)(n.packName,n.itemName);if(!t)return null;const r=t.lumiaDefName;return e.dominantBehavior&&e.dominantBehavior.packName===n.packName&&e.dominantBehavior.itemName===n.itemName?"★ ".concat(r):r}).filter(e=>e);o.textContent=n.length>0?n.join(", "):"No behaviors selected"}const s=document.getElementById("lumia-current-personalities");if(s){const n=e.selectedPersonalities.map(n=>{const t=(0,a.Br)(n.packName,n.itemName);if(!t)return null;const r=t.lumiaDefName;return e.dominantPersonality&&e.dominantPersonality.packName===n.packName&&e.dominantPersonality.itemName===n.itemName?"★ ".concat(r):r}).filter(e=>e);s.textContent=n.length>0?n.join(", "):"No personalities selected"}const l=document.getElementById("loom-current-style");if(l){const n=(Array.isArray(e.selectedLoomStyle)?e.selectedLoomStyle:[]).map(e=>{const n=(0,a.Br)(e.packName,e.itemName);return n?n.loomName:null}).filter(e=>e);l.textContent=n.length>0?n.join(", "):"No styles selected"}const c=document.getElementById("loom-current-utils");if(c){const n=e.selectedLoomUtils.map(e=>{const n=(0,a.Br)(e.packName,e.itemName);return n?n.loomName:null}).filter(e=>e);c.textContent=n.length>0?n.join(", "):"No utilities selected"}const u=document.getElementById("loom-current-retrofits");if(u){const n=e.selectedLoomRetrofits.map(e=>{const n=(0,a.Br)(e.packName,e.itemName);return n?n.loomName:null}).filter(e=>e);u.textContent=n.length>0?n.join(", "):"No retrofits selected"}}else n&&(n.textContent="No Packs loaded"),["lumia-current-definition","lumia-current-behaviors","lumia-current-personalities","loom-current-style","loom-current-utils","loom-current-retrofits"].forEach(e=>{const n=document.getElementById(e);n&&(n.textContent="No selection possible (Load packs first)")})}function E(){var e;const n=document.getElementById("lumia-loom-summary-btn");if(!n)return;const t=(0,r.SD)(),a=null==t||null===(e=t.chatMetadata)||void 0===e?void 0:e[i.zA],s=(null==t?void 0:t.chat)&&t.chat.length>0,l=(0,o.dj)();n.classList.remove("lumia-loom-summary-btn-hidden","lumia-loom-summary-btn-empty","lumia-loom-summary-btn-active","lumia-loom-summary-btn-summarizing"),l?(n.classList.add("lumia-loom-summary-btn-summarizing"),n.title="Generating summary..."):s?a?(n.classList.add("lumia-loom-summary-btn-active"),n.title="View/Edit Loom Summary"):(n.classList.add("lumia-loom-summary-btn-empty"),n.title="No Loom Summary (click to create)"):(n.classList.add("lumia-loom-summary-btn-hidden"),n.title="No active chat")}},961(e,n,t){!function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(e){console.error(e)}}(),e.exports=t(551)},982(e,n,t){e.exports=t(463)}},n={};function t(r){var i=n[r];if(void 0!==i)return i.exports;var a=n[r]={id:r,exports:{}};return e[r](a,a.exports,t),a.exports}t.m=e,t.n=e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},t.d=(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},t.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),t.b="undefined"!=typeof document&&document.baseURI||self.location.href,t.nc=void 0;var r=t(92);const i={createElement(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const t=document.createElement(e),{attrs:r={},text:i,html:a,children:o=[],style:s={},data:l={}}=n;return Object.entries(r).forEach(e=>{let[n,r]=e;null!=r&&t.setAttribute(n,r)}),Object.entries(s).forEach(e=>{let[n,r]=e;t.style[n]=r}),Object.entries(l).forEach(e=>{let[n,r]=e;t.dataset[n]=r}),void 0!==i?t.textContent=i:void 0!==a&&(t.innerHTML=a),o.forEach(e=>{e instanceof HTMLElement&&t.appendChild(e)}),t},query(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:document).querySelector(e)},queryAll(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;return Array.from(n.querySelectorAll(e))},on(e,n,t,r){const i="string"==typeof e?this.query(e):e;if(!i)return console.warn("DOMUtils.on: Target element not found"),()=>{};if("string"==typeof t){const e=t,a=r,o=n=>{const t=n.target.closest(e);t&&i.contains(t)&&a.call(t,n)};return i.addEventListener(n,o),()=>i.removeEventListener(n,o)}const a=t;return i.addEventListener(n,a),()=>i.removeEventListener(n,a)},once(e,n,t){const r="string"==typeof e?this.query(e):e;if(!r)return console.warn("DOMUtils.once: Target element not found"),()=>{};const i=e=>{t(e),r.removeEventListener(n,i)};return r.addEventListener(n,i),()=>r.removeEventListener(n,i)},debounce(e,n){let t,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return function(){for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];const s=this,l=r&&!t;clearTimeout(t),t=setTimeout(()=>{t=null,r||e.apply(s,a)},n),l&&e.apply(s,a)}},throttle(e,n){let t;return function(){const r=this;if(!t){for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];e.apply(r,a),t=!0,setTimeout(()=>t=!1,n)}}},addClass(e){const n="string"==typeof e?this.query(e):e;if(n){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];n.classList.add(...r)}return n},removeClass(e){const n="string"==typeof e?this.query(e):e;if(n){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];n.classList.remove(...r)}return n},toggleClass(e,n,t){const r="string"==typeof e?this.query(e):e;return!!r&&r.classList.toggle(n,t)},hasClass(e,n){const t="string"==typeof e?this.query(e):e;return!!t&&t.classList.contains(n)},scrollTo(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{target:n,top:t,left:r,behavior:i="smooth",offset:a=0,container:o=window}=e;if(n){const e="string"==typeof n?this.query(n):n;if(e){const n=e.getBoundingClientRect(),t=o===window?window.pageYOffset:o.scrollTop;o.scrollTo({top:t+n.top+a,behavior:i})}}else o.scrollTo({top:void 0!==t?t:o.scrollY,left:void 0!==r?r:o.scrollX,behavior:i})},isVisible(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const t="string"==typeof e?this.query(e):e;if(!t)return Promise.resolve(!1);const{threshold:r=0,rootMargin:i="0px"}=n;if(!("IntersectionObserver"in window)){const e=t.getBoundingClientRect();return Promise.resolve(e.top>=0&&e.left>=0&&e.bottom<=window.innerHeight&&e.right<=window.innerWidth)}return new Promise(e=>{const n=new IntersectionObserver(t=>{e(t[0].isIntersecting),n.disconnect()},{threshold:r,rootMargin:i});n.observe(t)})},observeVisibility(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r="string"==typeof e?this.query(e):e;if(!r||!("IntersectionObserver"in window))return{disconnect:()=>{}};const{threshold:i=0,rootMargin:a="0px"}=t,o=new IntersectionObserver(e=>{e.forEach(e=>n(e.isIntersecting))},{threshold:i,rootMargin:a});return o.observe(r),o},getRect(e){const n="string"==typeof e?this.query(e):e;return n?n.getBoundingClientRect():null},getOffset(e){const n="string"==typeof e?this.query(e):e;if(!n)return null;const t=n.getBoundingClientRect();return{top:t.top+window.pageYOffset,left:t.left+window.pageXOffset}},setStyle(e,n){const t="string"==typeof e?this.query(e):e;return t&&Object.entries(n).forEach(e=>{let[n,r]=e;t.style[n]=r}),t},getStyle(e,n){const t="string"==typeof e?this.query(e):e;return t?window.getComputedStyle(t)[n]:""},show(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"block";const t="string"==typeof e?this.query(e):e;return t&&(t.style.display=n),t},hide(e){const n="string"==typeof e?this.query(e):e;return n&&(n.style.display="none"),n},toggle(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"block";const t="string"==typeof e?this.query(e):e;if(!t)return!1;const r="none"===window.getComputedStyle(t).display;return t.style.display=r?n:"none",r},remove(e){const n="string"==typeof e?this.query(e):e;return n&&n.parentNode&&n.parentNode.removeChild(n),n},empty(e){const n="string"==typeof e?this.query(e):e;if(n)for(;n.firstChild;)n.removeChild(n.firstChild);return n},attr(e,n,t){const r="string"==typeof e?this.query(e):e;return r?"string"==typeof n&&void 0===t?r.getAttribute(n):"string"==typeof n?(r.setAttribute(n,t),r):"object"==typeof n?(Object.entries(n).forEach(e=>{let[n,t]=e;r.setAttribute(n,t)}),r):null:null},removeAttr(e,n){const t="string"==typeof e?this.query(e):e;return t&&t.removeAttribute(n),t},ready(e){"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e()},createQueryCache(){const e=new Map;return{get(n){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;const r="".concat(n,":").concat(t);if(!e.has(r)){const i=t.querySelector(n);i&&e.set(r,i)}return e.get(r)||null},clear(){e.clear()}}},getDistanceToViewport(e){const n="string"==typeof e?this.query(e):e;if(!n)return null;const t=n.getBoundingClientRect(),r=window.innerWidth||document.documentElement.clientWidth,i=window.innerHeight||document.documentElement.clientHeight;return{top:t.top,right:r-t.right,bottom:i-t.bottom,left:t.left}},getDistanceBetween(e,n){const t="string"==typeof e?this.query(e):e,r="string"==typeof n?this.query(n):n;if(!t||!r)return null;const i=t.getBoundingClientRect(),a=r.getBoundingClientRect();let o,s;return o=i.right<a.left?a.left-i.right:a.right<i.left?i.left-a.right:0,s=i.bottom<a.top?a.top-i.bottom:a.bottom<i.top?i.top-a.bottom:0,{horizontal:o,vertical:s,diagonal:Math.sqrt(o*o+s*s)}},logElementMeasurements(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Element";const t="string"==typeof e?i.query(e):e;if(!t)return console.warn("DOMUtils.logElementMeasurements: Element not found"),null;const r=t.getBoundingClientRect(),a=window.getComputedStyle(t),o=i.getDistanceToViewport(t),s={selector:"string"==typeof e?e:t.tagName,dimensions:{width:r.width,height:r.height,computedWidth:a.width,computedHeight:a.height},position:{top:r.top,right:r.right,bottom:r.bottom,left:r.left,x:r.x,y:r.y},distanceToViewport:o,viewport:{width:window.innerWidth,height:window.innerHeight},padding:{top:a.paddingTop,right:a.paddingRight,bottom:a.paddingBottom,left:a.paddingLeft},margin:{top:a.marginTop,right:a.marginRight,bottom:a.marginBottom,left:a.marginLeft}};return console.group("📏 ".concat(n," Measurements")),console.log("Element:",t),console.log("Dimensions:",s.dimensions),console.log("Position:",s.position),console.log("Distance to Viewport Edges:",s.distanceToViewport),console.log("Viewport Size:",s.viewport),console.log("Padding:",s.padding),console.log("Margin:",s.margin),console.groupEnd(),s}},{createElement:a,query:o,queryAll:s,on:l,once:c,debounce:u,throttle:d,addClass:m,removeClass:p,toggleClass:g,hasClass:v,scrollTo:h,isVisible:f,observeVisibility:b,getRect:x,getOffset:y,setStyle:k,getStyle:w,show:j,hide:S,toggle:C,remove:N,empty:P,attr:E,removeAttr:O,ready:M,createQueryCache:z,getDistanceToViewport:T,getDistanceBetween:I,logElementMeasurements:L}=i;var D=t(674),A=t(154),R=t(932),B=t(485),_=t(389),U=t(100);const F=new Map;let W=null,H=null,V=!1,q=!0,Y=!1,K=!1;let Q=!1,G=0,X=null,Z=null;function J(e){const n=V;V=e,e&&!n&&(q=!0,console.log("[".concat(D.pW,"] RAF: Streaming started, first render will be immediate"))),n&&!e&&(console.log("[".concat(D.pW,"] RAF: Streaming ended, flushing pending updates")),async function(){null!==H&&(clearTimeout(H),H=null);null!==W&&(cancelAnimationFrame(W),W=null);await new Promise(e=>setTimeout(e,0)),await te()}())}function ee(){if(q)return q=!1,void(null===W&&(W=requestAnimationFrame(te)));V?(null!==H&&clearTimeout(H),H=setTimeout(()=>{H=null;const e=performance.now()-G;if(e<50){setTimeout(()=>{null===W&&(W=requestAnimationFrame(te))},50-e)}else null===W&&(W=requestAnimationFrame(te))},100)):null===W&&(W=requestAnimationFrame(te))}function ne(){return new Promise(e=>setTimeout(e,0))}async function te(){W=null,G=performance.now();const e=F.size>0,n=Y;if(!e&&!n)return;if(Q)return void console.log("[".concat(D.pW,"] RAF: Skipping flush - chunked processing active"));Q=!0;const t=window.scrollY,r=n?"full":F.size;console.log("[".concat(D.pW,"] RAF: Flushing ").concat(r," update(s) [chunked]"));const i=performance.now();try{if(n)Z&&await Z(K),Y=!1,K=!1;else{const e=Array.from(F.values());F.clear();for(let n=0;n<e.length;n++)X&&X(e[n].mesId,e[n].force),(n+1)%15==0&&n<e.length-1&&await ne()}}catch(e){console.error("[".concat(D.pW,"] RAF: Error during flush:"),e)}finally{Q=!1}window.scrollTo(window.scrollX,t);const a=performance.now()-i;console.log("[".concat(D.pW,"] RAF: Flush completed in ").concat(a.toFixed(2),"ms"))}function re(){F.clear(),Y=!1,K=!1,Q=!1,null!==H&&(clearTimeout(H),H=null),null!==W&&(cancelAnimationFrame(W),W=null)}const ie="#9370db";let ae=null,oe=null,se=!1,le=!1;function ce(e){se=e,J(e)}function ue(e){if(!e)return"";let n=e.replace(/<\/?lumi[ao]_?ooc(?:\s+[^>]*)?>/gi,"");return n=n.replace(/<\/?lumi[ao]_[a-z_]+(?:\s+[^>]*)?>/gi,""),n=n.replace(/<\/?font(?:\s+[^>]*)?>/gi,""),n=n.replace(/<(p|div)>\s*<\/\1>/gi,""),n=n.replace(/<(p|div)(?:\s+[^>]*)?>/gi,""),n=n.replace(/<\/(p|div)>/gi,"<br>"),n=n.replace(/\s*<br\s*\/?>\s*/gi,"<br>"),n=n.replace(/(<br>){2,}/gi,"<br>"),n=n.replace(/(\n\s*){2,}/g,"\n"),n=n.replace(/^(\s|<br\s*\/?>)+/gi,""),n=n.replace(/(\s|<br\s*\/?>)+$/gi,""),n.trim()}function de(){const e=(0,D.mt)();if(e.selectedDefinition){const n=(0,A.Br)(e.selectedDefinition.packName,e.selectedDefinition.itemName),t=(null==n?void 0:n.avatarUrl)||(null==n?void 0:n.lumia_img);if(t)return t}return null}function me(e){if(!e)return null;let n=e.trim();n=n.replace(/^lumi[ao]\s+/i,"");const t=n.toLowerCase();if((t.startsWith("lumia")||t.startsWith("lumio"))&&n.length>5){const e=n.substring(5);e[0]===e[0].toUpperCase()&&(n=e)}return n||null}function pe(e){return e?e.replace(/&quot;/g,'"').replace(/&#34;/g,'"').replace(/&apos;/g,"'").replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"):""}function ge(e){if(!e)return null;let n=e.match(/name\s*=\s*"([^"]*)"/i);return n?pe(n[1]):(n=e.match(/name\s*=\s*'([^']*)'/i),n?pe(n[1]):(n=e.match(/name\s*=\s*&quot;([^&]*)&quot;/i),n?pe(n[1]):(n=e.match(/name\s*=\s*(\w+)/i),n?pe(n[1]):null)))}function ve(e){if(!e)return"";let n=e;return n=n.replace(/\*\*\*(.+?)\*\*\*/g,"$1"),n=n.replace(/\*\*(.+?)\*\*/g,"$1"),n=n.replace(/\*(.+?)\*/g,"$1"),n=n.replace(/___(.+?)___/g,"$1"),n=n.replace(/__(.+?)__/g,"$1"),n=n.replace(/_(.+?)_/g,"$1"),n=n.replace(/^\*([^*]+)\*/g,"$1"),n=n.replace(/[""]/g,'"'),n=n.replace(/['']/g,"'"),n=n.replace(/…/g,"..."),n}const he=new Map;function fe(e){he.delete(e)}function be(){he.clear()}function xe(e,n){const t=n.toLowerCase().trim();he.has(e)||he.set(e,new Set),he.get(e).add(t)}function ye(e,n){if(!e||!n)return 0;const t=e.toLowerCase().trim(),r=n.toLowerCase().trim();if(t===r)return 100;const i=t.split(/\s+/).filter(e=>e.length>=2),a=r.split(/\s+/).filter(e=>e.length>=2);let o=0;for(const e of i)a.includes(e)&&o++;if(o>0){const e=o/i.length,n=o/a.length;return 50+Math.round((e+n)/2*40)}return 0}function ke(e){var n,t;if(!e)return null;const r=me(e);if(!r)return null;const i=(0,D.mt)();let a={score:0,avatar:null};const o=(e,n)=>{const t=(null==e?void 0:e.avatarUrl)||(null==e?void 0:e.lumia_img);if(!t)return;const i=ye(r,n);i>a.score&&(a={score:i,avatar:t})};if(i.councilMode&&null!==(n=i.councilMembers)&&void 0!==n&&n.length)for(const e of i.councilMembers){const n=(0,A.Br)(e.packName,e.itemName);if(!n)continue;if(o(n,n.lumiaName||n.lumiaDefName||e.itemName),o(n,e.itemName),100===a.score)return a.avatar}if(i.selectedDefinition){const e=(0,A.Br)(i.selectedDefinition.packName,i.selectedDefinition.itemName);if(e){if(o(e,e.lumiaName||e.lumiaDefName||i.selectedDefinition.itemName),o(e,i.selectedDefinition.itemName),100===a.score)return a.avatar}}if(i.chimeraMode&&null!==(t=i.selectedDefinitions)&&void 0!==t&&t.length)for(const e of i.selectedDefinitions){const n=(0,A.Br)(e.packName,e.itemName);if(!n)continue;if(o(n,n.lumiaName||n.lumiaDefName||e.itemName),o(n,e.itemName),100===a.score)return a.avatar}if(a.score>=50)return a.avatar;if(i.packs)for(const e of Object.values(i.packs))if(e.lumiaItems&&e.lumiaItems.length>0)for(const n of e.lumiaItems){if(o(n,n.lumiaName||n.lumiaDefName||""),100===a.score)return a.avatar}else if(e.items)for(const n of e.items){if(o(n,n.lumiaDefName||n.lumiaName||""),100===a.score)return a.avatar}return a.score>=50?a.avatar:null}function we(e,n){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const r=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:0)%2==1;switch((0,D.mt)().lumiaOOCStyle||"social"){case"none":return function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const t=n||"Lumia",r=a("span",{attrs:{class:"lumia-ooc-raw","data-lumia-ooc":"true","data-lumia-speaker":t},html:e});return r}(e,t);case"margin":return function(e,n){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const i=r||"Lumia",o=(r||"Lumia").charAt(0).toUpperCase(),s=n?a("img",{attrs:{src:n,alt:o,class:"lumia-ooc-margin-tag-avatar"}}):a("span",{attrs:{class:"lumia-ooc-margin-tag-letter"},text:o}),l=a("div",{attrs:{class:"lumia-ooc-margin-tag"},children:[s]}),c=a("div",{attrs:{class:"lumia-ooc-margin-label"},text:i}),u=a("div",{attrs:{class:"lumia-ooc-margin-text"},html:e}),d=a("div",{attrs:{class:"lumia-ooc-margin-content-area"},children:[c,u]}),m=t?"lumia-ooc-margin lumia-ooc-alt":"lumia-ooc-margin";return a("div",{attrs:{class:m,"data-lumia-ooc":"true"},children:[l,d]})}(e,n,r,t);case"whisper":return function(e,n){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const i=r||"Lumia",o="".concat(i," whispers..."),s=(r||"Lumia").charAt(0).toUpperCase(),l=n?a("img",{attrs:{src:n,alt:i,class:"lumia-ooc-whisper-avatar"}}):a("div",{attrs:{class:"lumia-ooc-whisper-avatar-placeholder"},text:s}),c=a("div",{attrs:{class:"lumia-ooc-whisper-avatar-wrap"},children:[l]}),u=a("span",{attrs:{class:"lumia-ooc-whisper-name"},text:o}),d=a("div",{attrs:{class:"lumia-ooc-whisper-header"},children:[u]}),m=a("div",{attrs:{class:"lumia-ooc-whisper-text"},html:e}),p=a("div",{attrs:{class:"lumia-ooc-whisper-bubble"},children:[d,m]}),g=t?"lumia-ooc-whisper lumia-ooc-alt":"lumia-ooc-whisper";return a("div",{attrs:{class:g,"data-lumia-ooc":"true"},children:[c,p]})}(e,n,r,t);default:return function(e,n){var t;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=(0,D.mt)(),o=i.councilMode&&(null===(t=i.councilMembers)||void 0===t?void 0:t.length)>0,s=r||"Lumia",l=o?"speaks from the Council":"weaving through the Loom",c=(r||"Lumia").charAt(0).toUpperCase(),u=n?a("img",{attrs:{src:n,alt:s,class:"lumia-ooc-avatar"}}):a("div",{attrs:{class:"lumia-ooc-avatar lumia-ooc-avatar-placeholder"},text:c}),d=a("div",{attrs:{class:"lumia-ooc-avatar-container"},children:[u]}),m=a("span",{attrs:{class:"lumia-ooc-name"},text:s}),p=a("span",{attrs:{class:"lumia-ooc-thread"},text:l}),g=a("div",{attrs:{class:"lumia-ooc-header-row"},children:[m,p]}),v=a("div",{attrs:{class:"lumia-ooc-content"},html:e}),h=a("div",{attrs:{class:"lumia-ooc-content-column"},children:[g,v]});return a("div",{attrs:{class:"lumia-ooc-comment-box","data-lumia-ooc":"true"},children:[d,h]})}(e,n,t)}}function je(e){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{var t;const i=o('div[mesid="'.concat(e,'"] .mes_text'));if(!i)return;n&&fe(e);const a=(0,r.SD)(),l=null==a||null===(t=a.chat)||void 0===t?void 0:t[e],c=function(e){if(!e)return[];const n=[],t=/<(lumi[ao]_?ooc)([^>]*)>([\s\S]*?)<\/\1>/gi;let r;for(;null!==(r=t.exec(e));){const e=r[1],t=r[2],i=r[3],a=ge(t),o=me(a);console.log("[".concat(D.pW,"] Extracted OOC: tag=").concat(e,', attrs="').concat(t.trim(),'", name="').concat(a,'" → "').concat(o,'", content length=').concat(i.length)),n.push({name:o,content:i.trim(),fullMatch:r[0]})}return n}((null==l?void 0:l.mes)||(null==l?void 0:l.content)||""),u=s("[data-lumia-ooc]",i);if(u.length>0&&u.length>=c.length&&!n)return;let d=0;c.length>0&&(console.log("[".concat(D.pW,"] Found ").concat(c.length," <lumia_ooc> tag(s) in raw content for message ").concat(e)),c.forEach((n,t)=>{const r=function(e){if(!e)return"";const n=document.createElement("div");n.innerHTML=e;let t=n.textContent||n.innerText||"";return t=ve(t),t=t.replace(/\s+/g," ").trim(),t}(n.content);if(!r)return void console.log("[".concat(D.pW,"] Skipping OOC #").concat(t+1,": empty after text extraction"));if(function(e,n){const t=n.toLowerCase().trim(),r=he.get(e);return(null==r?void 0:r.has(t))||!1}(e,r))return void console.log("[".concat(D.pW,"] Skipping OOC #").concat(t+1,": already processed"));console.log("[".concat(D.pW,"] Processing OOC #").concat(t+1).concat(n.name?" (".concat(n.name,")"):"",': "').concat(r.substring(0,60),'..."'));const a=n.name&&ke(n.name)||de(),o=function(e,n,t){if(!e||!n)return null;const r=n.replace(/\s+/g," ").trim();if(!r)return null;const i=r.substring(0,Math.min(40,r.length)).toLowerCase(),a=r.length>20?r.substring(r.length-20).toLowerCase():r.toLowerCase(),o=document.createTreeWalker(e,NodeFilter.SHOW_TEXT);let s,l=null,c=0,u=null,d=0,m="";const p=[];let g=null;for(;s=o.nextNode();){var v,h;if(null!==(v=s.parentElement)&&void 0!==v&&v.closest("[data-lumia-ooc]"))continue;const e=null===(h=s.parentElement)||void 0===h?void 0:h.closest("p, div, li, blockquote, h1, h2, h3, h4, h5, h6");g&&e&&e!==g&&m.length>0&&!/\s$/.test(m)&&(m+=" "),g=e,p.push({node:s,start:m.length,text:s.nodeValue||""}),m+=s.nodeValue||""}const f=m.replace(/\s+/g," ").replace(/…/g,"...").replace(/[""]/g,'"').replace(/['']/g,"'").toLowerCase(),b=f.indexOf(i);if(-1===b)return console.log("[".concat(D.pW,'] findAndWrapOOCContent: Could not find prefix "').concat(i.substring(0,30),'..." in DOM text')),null;const x=b+r.length;if(r.length>40&&!f.substring(Math.max(b,x-20),x).includes(a.substring(0,10)))return console.log("[".concat(D.pW,"] findAndWrapOOCContent: Suffix mismatch, skipping false positive")),null;const y=[];let k=!1;for(let e=0;e<m.length;e++){const n=m[e];/\s/.test(n)?k||(y.push(e),k=!0):"…"===n?(y.push(e),y.push(e),y.push(e),k=!1):(y.push(e),k=!1)}let w=b<y.length?y[b]:0,j=x<=y.length?y[x-1]+1:m.length;for(const e of p){const n=e.start+e.text.length;if(!l&&e.start<=w&&n>w&&(l=e.node,c=w-e.start),e.start<j&&n>=j){u=e.node,d=j-e.start;break}}if(!l||!u)return console.log("[".concat(D.pW,"] findAndWrapOOCContent: Could not map match to text nodes")),null;try{const e=document.createRange();e.setStart(l,Math.min(c,l.length)),e.setEnd(u,Math.min(d,u.length));const n=e.cloneContents(),r=document.createElement("div");r.appendChild(n);const i=r.innerHTML||e.toString();return e.deleteContents(),console.log("[".concat(D.pW,"] findAndWrapOOCContent: Successfully isolated OOC content (").concat(i.length," chars)")),{range:e,innerHTML:ue(i)||ue(t),wrapperCreated:!0}}catch(e){return console.error("[".concat(D.pW,"] findAndWrapOOCContent: Range error:"),e),null}}(i,r,n.content);if(o&&o.wrapperCreated){const i=we(o.innerHTML,a,d,n.name);return o.range.insertNode(i),function(e){if(!e)return;let n=e,t=n.parentElement;for(;t&&(null===(r=t.classList)||void 0===r||!r.contains("mes_text"));){var r,i,a;const e=t.parentElement;if("FONT"===t.tagName){var o;const r=null===(o=t.getAttribute("color"))||void 0===o?void 0:o.toLowerCase();if(r===ie||"rgb(147, 112, 219)"===r){var s;Array.from(t.childNodes).forEach(e=>{var t;e!==n&&(e.nodeType===Node.ELEMENT_NODE&&"BR"===e.tagName?e.remove():e.nodeType!==Node.TEXT_NODE||null!==(t=e.textContent)&&void 0!==t&&t.trim()||e.remove())}),t.parentNode&&(t.parentNode.insertBefore(n,t),null!==(s=t.textContent)&&void 0!==s&&s.trim()||t.querySelector("[data-lumia-ooc]")||t.remove()),t=e;continue}}if(null!==(i=(a=t).matches)&&void 0!==i&&i.call(a,"p, div")){const r=Array.from(t.childNodes).filter(e=>{var t;return e===n||!!(e.nodeType!==Node.TEXT_NODE||null!==(t=e.textContent)&&void 0!==t&&t.trim())&&(e.nodeType!==Node.ELEMENT_NODE||"BR"!==e.tagName)});if(1===r.length&&r[0]===n){t.parentNode&&(t.parentNode.insertBefore(n,t),t.remove()),t=e;continue}}n=t,t=e}if(t=e.parentElement,t){var l,c;const n=n=>{var t,r;n&&n!==e&&n.nodeType===Node.ELEMENT_NODE&&("BR"===n.tagName?n.remove():null===(t=n.matches)||void 0===t||!t.call(n,"p, div, font")||null!==(r=n.textContent)&&void 0!==r&&r.trim()||n.querySelector("img, [data-lumia-ooc]")||n.remove())};n(e.previousElementSibling),n(e.nextElementSibling);const t=e.previousSibling,r=e.nextSibling;(null==t?void 0:t.nodeType)!==Node.TEXT_NODE||null!==(l=t.textContent)&&void 0!==l&&l.trim()||t.remove(),(null==r?void 0:r.nodeType)!==Node.TEXT_NODE||null!==(c=r.textContent)&&void 0!==c&&c.trim()||r.remove()}}(i),xe(e,r),d++,void console.log("[".concat(D.pW,"] Replaced OOC #").concat(t+1," with styled box (surgical Range method)"))}const l=function(e,n){if(!e||!n)return null;const t=n.replace(/\s+/g," ").trim().toLowerCase();if(!t)return null;const r=t.substring(0,Math.min(50,t.length)),i=s("p",e);for(let e=0;e<i.length;e++){const n=i[e];if(n.closest("[data-lumia-ooc]"))continue;const a=ve((n.textContent||"").replace(/\s+/g," ").replace(/…/g,"...").replace(/[""]/g,'"').replace(/['']/g,"'").trim()).toLowerCase();if(!a.includes(r))continue;const o=t.length/a.length;if(!(o<.7))return console.log("[".concat(D.pW,"] findMatchingElement: Matched paragraph ").concat(e," (").concat(Math.round(100*o),"% OOC content)")),{element:n,innerHTML:n.innerHTML};console.log("[".concat(D.pW,"] findMatchingElement: Skipping paragraph ").concat(e," - OOC is only ").concat(Math.round(100*o),"% of content"))}return null}(i,r);if(!l)return void console.log("[".concat(D.pW,"] Could not find OOC #").concat(t+1," text in DOM (tried surgical and element methods)"));const c=ue(l.innerHTML);if(!c)return;const u=we(c,a,d,n.name);l.element.parentNode&&(l.element.parentNode.replaceChild(u,l.element),xe(e,r),d++,console.log("[".concat(D.pW,"] Replaced OOC #").concat(t+1," with styled box (element fallback method)")))})),d>0&&console.log("[".concat(D.pW,"] Finished processing ").concat(d," OOC comment(s) in message ").concat(e))}catch(e){console.error("[".concat(D.pW,"] Error processing OOC comments:"),e)}}function Se(e){!function(e){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const t="ooc-".concat(e),r=F.get(t);F.set(t,{mesId:e,force:n||(null==r?void 0:r.force)||!1}),ee()}(e,arguments.length>1&&void 0!==arguments[1]&&arguments[1])}async function Ce(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(le)return void console.log("[".concat(D.pW,"] Skipping concurrent full OOC processing"));const n=(0,r.SD)();if(n&&n.chat){le=!0;try{const t=n.chat.length;if(console.log("[".concat(D.pW,"] Processing all OOC comments in chat (").concat(t," messages)").concat(e?" [clearing existing]":""," [chunked]")),e){s("[data-lumia-ooc]").forEach(e=>{let n="";const t=e.querySelector(".lumia-ooc-margin-text"),r=e.querySelector(".lumia-ooc-whisper-text"),i=e.querySelector(".lumia-ooc-content");t?n=t.innerHTML:r?n=r.innerHTML:i&&(n=i.innerHTML);const a=document.createElement("font");a.setAttribute("color","#9370DB"),a.innerHTML=n,e.parentNode&&e.parentNode.replaceChild(a,e)}),be()}for(let e=0;e<t;e++){const n=o('div[mesid="'.concat(e,'"] .mes_text'));n&&(0,U.vL)(n),je(e),(e+1)%15==0&&e<t-1&&await ne()}}finally{le=!1}}}function Ne(){!function(){Y=!0,K=arguments.length>0&&void 0!==arguments[0]&&arguments[0]||K,F.clear(),ee()}(arguments.length>0&&void 0!==arguments[0]&&arguments[0])}function Pe(){ae&&clearTimeout(ae),oe&&clearTimeout(oe),be();function e(){const e=Date.now();!function n(){var t;const i=document.getElementById("chat"),a=(0,r.SD)(),l=(null==a||null===(t=a.chat)||void 0===t?void 0:t.length)||0,c=(i?s(".mes_text",i):[]).length;if(Date.now()-e>2e3)return console.log("[".concat(D.pW,"] Max wait time reached (context: ").concat(l,", DOM: ").concat(c,"), processing OOCs now")),void Ne();if(0===l)return void console.log("[".concat(D.pW,"] Empty chat detected, no OOC processing needed"));if(0===c)return void(oe=setTimeout(n,50));if(c>=Math.max(1,Math.floor(.8*l))){var u;const e=o('div[mesid="'.concat(l-1,'"] .mes_text'));if(e&&null!==(u=e.textContent)&&void 0!==u&&u.trim())return console.log("[".concat(D.pW,"] DOM ready with ").concat(c,"/").concat(l," messages, scheduling OOC processing")),void Ne()}oe=setTimeout(n,50)}()}ae=setTimeout(()=>{requestAnimationFrame(e)},100)}function Ee(){console.log("[".concat(D.pW,"] Initializing RAF batch renderer for OOC comments")),X=je,Z=Ce}var Oe=t(199),Me=t(200),ze=t(699);function Te(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function Ie(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Te(Object(t),!0).forEach(function(n){Le(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Te(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Le(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const De="openai";const Ae=new class{constructor(){this.context=(0,r.SD)()}getManager(){var e;return this.context||(this.context=(0,r.SD)()),null===(e=this.context)||void 0===e?void 0:e.getPresetManager(De)}getCurrentPreset(){const e=this.getManager();if(!e)return console.warn("[ChatPresetService] Manager not found for API_ID:",De),null;const n=e.getSelectedPresetName();console.log("[ChatPresetService] Active preset name:",n);let t=null;{const n=e.getPresetList();n&&n.settings&&(console.log("[ChatPresetService] Using getPresetList().settings for OpenAI"),t=n.settings)}if(t||(t=e.getPresetSettings(n)),console.log("[ChatPresetService] Raw settings found:",!!t,t?Object.keys(t):"null"),!t)return null;Array.isArray(t.prompts)||(console.warn("[ChatPresetService] Prompts array missing or invalid in settings, defaulting to empty"),t.prompts=[]);try{return{name:n,settings:structuredClone(t)}}catch(e){return console.error("[ChatPresetService] structuredClone failed:",e),{name:n,settings:Ie(Ie({},t),{},{prompts:t.prompts.map(e=>Ie({},e))})}}}getAvailablePresets(){const e=this.getManager();if(!e)return[];if("function"==typeof e.getAllPresets)return e.getAllPresets();const n=e.getPresetList();return n&&n.preset_names?Array.isArray(n.preset_names)?n.preset_names:Object.keys(n.preset_names):[]}async selectPreset(e){const n=this.getManager();if(!n)return!1;const t=n.findPreset(e);return!!t&&(n.selectPreset(t),!0)}exportPreset(e){const n=this.getCurrentPreset();if(!n||!n.settings)return null;if(!e||e===n.name)return JSON.stringify(n.settings,null,4);const t=this.getManager().getCompletionPresetByName(e);return t?JSON.stringify(t,null,4):null}async createPreset(e,n){const t=this.getManager();return!!t&&(await t.savePreset(e,n),!0)}async deletePreset(e){const n=this.getManager();return!!n&&(await n.deletePreset(e),!0)}async savePreset(e,n){const t=this.getManager();if(!t)return!1;try{return await t.savePreset(e,n),!0}catch(e){return console.error("Failed to save preset:",e),!1}}async updatePrompts(e){const n=this.getCurrentPreset();if(!n)return!1;const{name:t,settings:r}=n;return r.prompts=e,await this.savePreset(t,r)}getToggleStateNames(){return(0,ze.or)()}getToggleStateRegistry(){return(0,ze.JL)()}async saveToggleState(e,n){const t=this.getCurrentPreset(),r=(null==t?void 0:t.name)||null,i={};for(const e of n){const n=e.identifier||e.name;n&&(i[n]=!1!==e.enabled)}await(0,ze.Bl)(e,i,r),console.log('[ChatPresetService] Saved toggle state "'.concat(e,'" with ').concat(Object.keys(i).length," prompts"))}async loadToggleState(e){return await(0,ze.SS)(e)}async applyToggleState(e,n){const t=await(0,ze.SS)(e);if(null==t||!t.toggles)return{prompts:n,matched:0,unmatched:0};let r=0,i=0;const a=n.map(e=>{const n=e.identifier||e.name;return n&&n in t.toggles?(r++,Ie(Ie({},e),{},{enabled:t.toggles[n]})):(i++,e)});return console.log('[ChatPresetService] Applied toggle state "'.concat(e,'": ').concat(r," matched, ").concat(i," unmatched")),{prompts:a,matched:r,unmatched:i}}async deleteToggleState(e){await(0,ze.Im)(e),console.log('[ChatPresetService] Deleted toggle state "'.concat(e,'"'))}},Re="PresetBindingService";let Be=null,_e=!1,Ue=null;function Fe(){var e;const n=(0,ze.vU)();return(null==n||null===(e=n.selections)||void 0===e?void 0:e.presetBindings)||{characters:{},chats:{}}}function We(e){(0,ze.Xy)({presetBindings:e}),Ue&&Ue(e)}function He(e,n){if(!e)return void console.warn("[".concat(Re,"] Cannot set binding: no avatar name provided"));const t=Fe();n?(t.characters[e]=n,console.log("[".concat(Re,'] Bound character "').concat(e,'" to preset "').concat(n,'"'))):(delete t.characters[e],console.log("[".concat(Re,'] Removed binding for character "').concat(e,'"'))),We(t)}function Ve(e,n){if(!e)return void console.warn("[".concat(Re,"] Cannot set binding: no chat ID provided"));const t=Fe();n?(t.chats[e]=n,console.log("[".concat(Re,'] Bound chat "').concat(e,'" to preset "').concat(n,'"'))):(delete t.chats[e],console.log("[".concat(Re,'] Removed binding for chat "').concat(e,'"'))),We(t)}function qe(e){if(!e)return null;return Fe().characters[e]||null}function $e(e){if(!e)return null;return Fe().chats[e]||null}function Ye(){var e;const n=(0,r.SD)();return n&&void 0!==n.characterId&&null!==n.characterId&&(null===(e=n.characters)||void 0===e||null===(e=e[n.characterId])||void 0===e?void 0:e.avatar)||null}function Ke(){var e;const n=(0,r.SD)();if(!n)return null;if("function"==typeof n.getCurrentChatId)return n.getCurrentChatId();var t;if(n.groupId)return(null===(t=n.groups)||void 0===t||null===(t=t.find(e=>e.id===n.groupId))||void 0===t?void 0:t.chat_id)||null;const i=null===(e=n.characters)||void 0===e?void 0:e[n.characterId];return(null==i?void 0:i.chat)||null}function Qe(){const e=Ke(),n=Ye();if(e){const n=$e(e);if(n)return{presetName:n,bindingType:"chat",bindingId:e}}if(n){const e=qe(n);if(e)return{presetName:e,bindingType:"character",bindingId:n}}return{presetName:null,bindingType:null,bindingId:null}}function Ge(){const e=(0,r.SD)(),n=Ye(),t=Ke();let i=null;if(n&&null!=e&&e.characters){const t=e.characters.find(e=>e.avatar===n);i=(null==t?void 0:t.name)||null}return{characterAvatar:n,characterName:i,chatId:t}}function Xe(e){Ue=e}function Ze(){const e=(0,r.cj)(),n=(0,r.G1)();return e&&null!=n&&n.CHAT_CHANGED?(e.on(n.CHAT_CHANGED,()=>{console.log("[".concat(Re,"] CHAT_CHANGED detected, checking bindings...")),setTimeout(()=>{!async function(){if(_e)return console.log("[".concat(Re,"] Already switching, skipping...")),!1;const e=Qe();if(!e.presetName)return console.log("[".concat(Re,"] No binding for current context")),Be=null,!1;const n="".concat(e.bindingType,":").concat(e.bindingId,":").concat(e.presetName);if(Be===n)return console.log("[".concat(Re,"] Binding already applied, skipping")),!1;if(!Ae.getAvailablePresets().includes(e.presetName))return console.warn("[".concat(Re,'] Bound preset "').concat(e.presetName,'" no longer exists')),"chat"===e.bindingType?Ve(e.bindingId,null):"character"===e.bindingType&&He(e.bindingId,null),!1;_e=!0;try{console.log("[".concat(Re,"] Applying ").concat(e.bindingType,' binding: "').concat(e.presetName,'" for ').concat(e.bindingId));const t=await Ae.selectPreset(e.presetName);if(t&&(Be=n,console.log("[".concat(Re,'] Successfully switched to preset "').concat(e.presetName,'"')),"undefined"!=typeof toastr)){const n="chat"===e.bindingType?"chat":"character";toastr.info('Preset switched to "'.concat(e.presetName,'" (').concat(n," binding)"),"Lumiverse Helper",{timeOut:2e3,preventDuplicates:!0})}return t}catch(e){return console.error("[".concat(Re,"] Failed to apply binding:"),e),!1}finally{_e=!1}}()},100)}),console.log("[".concat(Re,"] Preset binding service initialized")),!0):(console.warn("[".concat(Re,"] Cannot initialize: ST event system not available")),!1)}var Je=t(540),en=t(338),nn=t(848);const tn=["ui"],rn=["ui"];function an(e,n){if(null==e)return{};var t,r,i=function(e,n){if(null==e)return{};var t={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==n.indexOf(r))continue;t[r]=e[r]}return t}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],-1===n.indexOf(t)&&{}.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}function on(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function sn(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?on(Object(t),!0).forEach(function(n){ln(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):on(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function ln(e,n,t){return(n=cn(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function cn(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}let un=null;function dn(){if("undefined"!=typeof crypto&&"function"==typeof crypto.randomUUID)try{return crypto.randomUUID()}catch(e){}const e="0123456789abcdef";let n="";for(let t=0;t<36;t++)n+=8===t||13===t||18===t||23===t?"-":14===t?"4":19===t?e[4*Math.random()|8]:e[16*Math.random()|0];return n}const mn=function(e){let n=e;const t=new Set;return{getState:()=>n,setState:e=>{const r="function"==typeof e?e(n):e;r!==n&&(n=sn(sn({},n),r),t.forEach(e=>e()))},subscribe:e=>(t.add(e),()=>t.delete(e))}}({packs:{},selectedDefinition:null,selectedBehaviors:[],selectedPersonalities:[],dominantBehavior:null,dominantPersonality:null,selectedLoomStyle:[],selectedLoomUtils:[],selectedLoomRetrofits:[],presets:{},activePresetName:null,chimeraMode:!1,selectedDefinitions:[],councilMode:!1,councilMembers:[],lumiaQuirks:"",lumiaQuirksEnabled:!0,stateSynthesis:{enabled:!1},oocEnabled:!0,lumiaOOCStyle:"social",lumiaOOCInterval:null,messageTruncation:{enabled:!1,keepCount:50},contextFilters:{},sovereignHand:{enabled:!1,excludeLastMessage:!0,includeMessageInPrompt:!0},summarization:{},showLumiverseDrawer:!0,dismissedUpdateVersion:null,lumiaButtonPosition:{useDefault:!0,xPercent:1,yPercent:1},chatChangeCounter:0,ui:{activeModal:null,isLoading:!1,isUpdatingExtension:!1,error:null,viewingPack:null,viewingLoomPack:null},updates:{extensionUpdate:null,presetUpdates:[],lastChecked:null}});function pn(e,n,t){const r=n.split("."),i=sn({},e);let a=i;for(let e=0;e<r.length-1;e++)a[r[e]]=sn({},a[r[e]]),a=a[r[e]];return a[r[r.length-1]]=t,i}function gn(e,n){if(!e)return null;if(e.lumiaItems&&e.lumiaItems.length>0){const t=e.lumiaItems.find(e=>e.lumiaName===n||e.lumiaDefName===n);if(t)return t}return e.items&&e.items.length>0?e.items.find(e=>e.lumiaDefName===n):null}function vn(e,n){if(!e)return null;const t={name:["lumiaName","lumiaDefName"],def:["lumiaDefinition","lumiaDef"],personality:["lumiaPersonality","lumia_personality"],behavior:["lumiaBehavior","lumia_behavior"],img:["avatarUrl","lumia_img"],author:["authorName","defAuthor"],gender:["genderIdentity"]}[n];if(!t)return null;for(const n of t)if(void 0!==e[n]&&null!==e[n])return e[n];return null}function hn(e,n){if(!e||!n)return null;if(e[n])return e[n];for(const[t,r]of Object.entries(e))if(r.name===n||r.packName===n)return r;return null}const fn={updateSettings:(e,n)=>{const t=mn.getState();mn.setState({settings:pn(t.settings,e,n)})},setSettings:e=>{mn.setState({settings:e})},setPacks:e=>{mn.setState({packs:e})},setCustomPacks:e=>{const n=sn({},mn.getState().packs);e.forEach(e=>{const t=e.packName||e.name;n[t]=sn(sn({},e),{},{isCustom:!0})}),mn.setState({packs:n})},addCustomPack:e=>{const n=mn.getState(),t=n.packs&&"object"==typeof n.packs?sn({},n.packs):{};t[e.packName||e.name]=sn(sn({},e),{},{isCustom:!0}),mn.setState({packs:t})},updateCustomPack:(e,n)=>{const t=mn.getState(),r=t.packs&&"object"==typeof t.packs?sn({},t.packs):{};let i=null;for(const[n,t]of Object.entries(r))if(t.id===e||t.name===e||t.packName===e||n===e){i=n;break}if(i){const e=r[i],t=n.packName||n.name||e.packName||e.name,a=sn(sn(sn({},e),n),{},{isCustom:!0});t!==i?(delete r[i],r[t]=a):r[i]=a,mn.setState({packs:r})}},removeCustomPack:e=>{const n=mn.getState(),t=n.packs&&"object"==typeof n.packs?sn({},n.packs):{};for(const[n,r]of Object.entries(t))if(r.id===e||r.name===e||r.packName===e||n===e){delete t[n];break}mn.setState({packs:t})},removePack:e=>{const n=mn.getState(),t=n.packs&&"object"==typeof n.packs?sn({},n.packs):{};if(t[e])delete t[e];else for(const[n,r]of Object.entries(t))if(r.name===e||r.packName===e){delete t[n];break}mn.setState({packs:t})},_selectionsMatch:(e,n)=>!(!e||!n)&&(e.packName===n.packName&&e.itemName===n.itemName),setSelectedBehaviors:e=>{mn.setState({selectedBehaviors:e})},toggleBehavior:e=>{const n=mn.getState(),t=fn._selectionsMatch,r=n.selectedBehaviors.findIndex(n=>t(n,e));if(r>=0){const i=[...n.selectedBehaviors];i.splice(r,1),mn.setState({selectedBehaviors:i,dominantBehavior:t(n.dominantBehavior,e)?null:n.dominantBehavior})}else mn.setState({selectedBehaviors:[...n.selectedBehaviors,e]})},setDominantBehavior:e=>{mn.setState({dominantBehavior:e})},setSelectedPersonalities:e=>{mn.setState({selectedPersonalities:e})},togglePersonality:e=>{const n=mn.getState(),t=fn._selectionsMatch,r=n.selectedPersonalities.findIndex(n=>t(n,e));if(r>=0){const i=[...n.selectedPersonalities];i.splice(r,1),mn.setState({selectedPersonalities:i,dominantPersonality:t(n.dominantPersonality,e)?null:n.dominantPersonality})}else mn.setState({selectedPersonalities:[...n.selectedPersonalities,e]})},setDominantPersonality:e=>{mn.setState({dominantPersonality:e})},setSelectedDefinition:e=>{mn.setState({selectedDefinition:e})},clearSelections:()=>{mn.setState({selectedBehaviors:[],selectedPersonalities:[],selectedDefinition:null,dominantBehavior:null,dominantPersonality:null})},setSelectedLoomStyles:e=>{mn.setState({selectedLoomStyle:e})},toggleLoomStyle:e=>{const n=mn.getState(),t=fn._selectionsMatch,r=n.selectedLoomStyle||[],i=r.findIndex(n=>t(n,e));if(i>=0){const e=[...r];e.splice(i,1),mn.setState({selectedLoomStyle:e})}else mn.setState({selectedLoomStyle:[...r,e]})},setSelectedLoomUtilities:e=>{mn.setState({selectedLoomUtils:e})},toggleLoomUtility:e=>{const n=mn.getState(),t=fn._selectionsMatch,r=n.selectedLoomUtils||[],i=r.findIndex(n=>t(n,e));if(i>=0){const e=[...r];e.splice(i,1),mn.setState({selectedLoomUtils:e})}else mn.setState({selectedLoomUtils:[...r,e]})},setSelectedLoomRetrofits:e=>{mn.setState({selectedLoomRetrofits:e})},toggleLoomRetrofit:e=>{const n=mn.getState(),t=fn._selectionsMatch,r=n.selectedLoomRetrofits||[],i=r.findIndex(n=>t(n,e));if(i>=0){const e=[...r];e.splice(i,1),mn.setState({selectedLoomRetrofits:e})}else mn.setState({selectedLoomRetrofits:[...r,e]})},clearLoomSelections:()=>{mn.setState({selectedLoomStyle:[],selectedLoomUtils:[],selectedLoomRetrofits:[]})},clearAllSelections:()=>{mn.setState({selectedBehaviors:[],selectedPersonalities:[],selectedDefinition:null,dominantBehavior:null,dominantPersonality:null,selectedLoomStyle:[],selectedLoomUtils:[],selectedLoomRetrofits:[]})},areAllTraitsEnabledForLumia:(e,n)=>{const t=mn.getState(),r=hn(t.packs,e);if(!r)return!1;const i=gn(r,n);if(!i)return!1;if(vn(i,"def")){const r=t.selectedDefinition;if(!r||r.packName!==e||r.itemName!==n)return!1}if(vn(i,"behavior")){if(!(t.selectedBehaviors||[]).some(t=>t.packName===e&&t.itemName===n))return!1}if(vn(i,"personality")){if(!(t.selectedPersonalities||[]).some(t=>t.packName===e&&t.itemName===n))return!1}return!0},toggleAllTraitsForLumia:(e,n)=>{const t=mn.getState(),r=hn(t.packs,e);if(!r)return!1;const i=gn(r,n);if(!i)return!1;if(fn.areAllTraitsEnabledForLumia(e,n)){const r={};if(vn(i,"def")){const i=t.selectedDefinition;i&&i.packName===e&&i.itemName===n&&(r.selectedDefinition=null)}if(vn(i,"behavior")){const i=t.selectedBehaviors||[];r.selectedBehaviors=i.filter(t=>!(t.packName===e&&t.itemName===n))}if(vn(i,"personality")){const i=t.selectedPersonalities||[];r.selectedPersonalities=i.filter(t=>!(t.packName===e&&t.itemName===n))}return Object.keys(r).length>0&&mn.setState(r),!1}{const r={packName:e,itemName:n},a={};if(vn(i,"def")&&(a.selectedDefinition=r),vn(i,"behavior")){const i=t.selectedBehaviors||[];i.some(t=>t.packName===e&&t.itemName===n)||(a.selectedBehaviors=[...i,r])}if(vn(i,"personality")){const i=t.selectedPersonalities||[];i.some(t=>t.packName===e&&t.itemName===n)||(a.selectedPersonalities=[...i,r])}return Object.keys(a).length>0&&mn.setState(a),!0}},enableAllTraitsForLumia:(e,n)=>{const t=mn.getState(),r=hn(t.packs,e);if(!r)return;const i=gn(r,n);if(!i)return;const a={packName:e,itemName:n},o={};if(vn(i,"def")&&(o.selectedDefinition=a),vn(i,"behavior")){const r=t.selectedBehaviors||[];r.some(t=>t.packName===e&&t.itemName===n)||(o.selectedBehaviors=[...r,a])}if(vn(i,"personality")){const r=t.selectedPersonalities||[];r.some(t=>t.packName===e&&t.itemName===n)||(o.selectedPersonalities=[...r,a])}Object.keys(o).length>0&&mn.setState(o)},savePreset:e=>{const n=mn.getState(),t=Date.now(),r={name:e,createdAt:t,updatedAt:t,selectedDefinition:n.selectedDefinition,selectedBehaviors:[...n.selectedBehaviors||[]],selectedPersonalities:[...n.selectedPersonalities||[]],dominantBehavior:n.dominantBehavior,dominantPersonality:n.dominantPersonality,chimeraMode:n.chimeraMode||!1,selectedDefinitions:[...n.selectedDefinitions||[]],councilMode:n.councilMode||!1,councilMembers:structuredClone(n.councilMembers||[]),lumiaQuirks:n.lumiaQuirks||"",lumiaQuirksEnabled:!1!==n.lumiaQuirksEnabled};mn.setState({presets:sn(sn({},n.presets),{},{[e]:r}),activePresetName:e})},loadPreset:e=>{const n=mn.getState().presets[e];if(!n)return;const t={selectedDefinition:n.selectedDefinition,selectedBehaviors:n.selectedBehaviors||[],selectedPersonalities:n.selectedPersonalities||[],dominantBehavior:n.dominantBehavior,dominantPersonality:n.dominantPersonality,activePresetName:e};void 0!==n.chimeraMode&&(t.chimeraMode=n.chimeraMode,t.selectedDefinitions=n.selectedDefinitions||[]),void 0!==n.councilMode&&(t.councilMode=n.councilMode,t.councilMembers=n.councilMembers||[]),t.lumiaQuirks=n.lumiaQuirks||n.councilQuirks||"",t.lumiaQuirksEnabled=!1!==n.lumiaQuirksEnabled,mn.setState(t)},deletePreset:e=>{const n=mn.getState(),t=n.presets,{[e]:r}=t,i=an(t,[e].map(cn));mn.setState({presets:i,activePresetName:n.activePresetName===e?null:n.activePresetName})},updatePreset:e=>{const n=mn.getState(),t=n.presets[e];if(!t)return;const r=sn(sn({},t),{},{updatedAt:Date.now(),selectedDefinition:n.selectedDefinition,selectedBehaviors:[...n.selectedBehaviors||[]],selectedPersonalities:[...n.selectedPersonalities||[]],dominantBehavior:n.dominantBehavior,dominantPersonality:n.dominantPersonality,chimeraMode:n.chimeraMode||!1,selectedDefinitions:[...n.selectedDefinitions||[]],councilMode:n.councilMode||!1,councilMembers:structuredClone(n.councilMembers||[]),lumiaQuirks:n.lumiaQuirks||"",lumiaQuirksEnabled:!1!==n.lumiaQuirksEnabled});mn.setState({presets:sn(sn({},n.presets),{},{[e]:r})})},clearActivePreset:()=>{mn.setState({activePresetName:null})},setChimeraMode:e=>{var n;const t=mn.getState();e&&t.councilMode&&mn.setState({councilMode:!1,councilMembers:[]}),e&&t.selectedDefinition?mn.setState({chimeraMode:!0,selectedDefinitions:[t.selectedDefinition],selectedDefinition:null}):!e&&(null===(n=t.selectedDefinitions)||void 0===n?void 0:n.length)>0?mn.setState({chimeraMode:!1,selectedDefinition:t.selectedDefinitions[0],selectedDefinitions:[]}):mn.setState({chimeraMode:e})},toggleChimeraDefinition:e=>{const n=mn.getState().selectedDefinitions||[],t=fn._selectionsMatch,r=n.findIndex(n=>t(n,e));if(r>=0){const e=[...n];e.splice(r,1),mn.setState({selectedDefinitions:e})}else mn.setState({selectedDefinitions:[...n,e]})},clearChimeraDefinitions:()=>{mn.setState({selectedDefinitions:[]})},setCouncilMode:e=>{const n=mn.getState();e&&n.chimeraMode&&mn.setState({chimeraMode:!1,selectedDefinitions:[]}),mn.setState({councilMode:e})},addCouncilMember:e=>{const n=mn.getState(),t=n.councilMembers||[],r=gn(hn(n.packs,e.packName),e.itemName),i=[],a=[];vn(r,"behavior")&&i.push({packName:e.packName,itemName:e.itemName}),vn(r,"personality")&&a.push({packName:e.packName,itemName:e.itemName});const o={id:dn(),packName:e.packName,itemName:e.itemName,behaviors:i,personalities:a,dominantBehavior:null,dominantPersonality:null,role:""},s=[...t,o];return mn.setState({councilMembers:s}),o},updateCouncilMember:(e,n)=>{const t=mn.getState();mn.setState({councilMembers:t.councilMembers.map(t=>t.id===e?sn(sn({},t),n):t)})},removeCouncilMember:e=>{const n=mn.getState();mn.setState({councilMembers:n.councilMembers.filter(n=>n.id!==e)})},clearCouncilMembers:()=>{mn.setState({councilMembers:[]})},setLumiaQuirks:e=>{mn.setState({lumiaQuirks:e})},setLumiaQuirksEnabled:e=>{mn.setState({lumiaQuirksEnabled:e})},setStateSynthesisEnabled:e=>{const n=mn.getState();mn.setState({stateSynthesis:sn(sn({},n.stateSynthesis),{},{enabled:e})})},addCouncilMembersFromPack:e=>{const n=mn.getState(),t=hn(n.packs,e);if(!t)return 0;let r=[];if(t.lumiaItems&&t.lumiaItems.length>0?r=t.lumiaItems.filter(e=>e.lumiaDefinition||e.lumiaDef):t.items&&t.items.length>0&&(r=t.items.filter(e=>(e.lumiaDefName||e.lumiaName)&&(e.lumiaDef||e.lumiaDefinition))),0===r.length)return 0;const i=n.councilMembers||[],a=new Set(i.map(e=>"".concat(e.packName,":").concat(e.itemName))),o=r.filter(n=>{const t=n.lumiaName||n.lumiaDefName;return!a.has("".concat(e,":").concat(t))});if(0===o.length)return 0;const s=o.map(n=>{const t=n.lumiaName||n.lumiaDefName,r=[],i=[];return vn(n,"behavior")&&r.push({packName:e,itemName:t}),vn(n,"personality")&&i.push({packName:e,itemName:t}),{id:dn(),packName:e,itemName:t,behaviors:r,personalities:i,dominantBehavior:null,dominantPersonality:null,role:""}});return mn.setState({councilMembers:[...i,...s]}),s.length},openModal:function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};mn.setState({ui:sn(sn({},mn.getState().ui),{},{activeModal:{name:e,props:n}})})},closeModal:()=>{mn.setState({ui:sn(sn({},mn.getState().ui),{},{activeModal:null})})},setLoading:e=>{mn.setState({ui:sn(sn({},mn.getState().ui),{},{isLoading:e})})},setError:e=>{mn.setState({ui:sn(sn({},mn.getState().ui),{},{error:e})})},clearError:()=>{mn.setState({ui:sn(sn({},mn.getState().ui),{},{error:null})})},openPackDetail:e=>{mn.setState({ui:sn(sn({},mn.getState().ui),{},{viewingPack:e})})},closePackDetail:()=>{mn.setState({ui:sn(sn({},mn.getState().ui),{},{viewingPack:null})})},openLoomPackDetail:e=>{mn.setState({ui:sn(sn({},mn.getState().ui),{},{viewingLoomPack:e})})},closeLoomPackDetail:()=>{mn.setState({ui:sn(sn({},mn.getState().ui),{},{viewingLoomPack:null})})},setExtensionUpdate:e=>{const n=mn.getState();mn.setState({updates:sn(sn({},n.updates),{},{extensionUpdate:e,lastChecked:Date.now()})})},setPresetUpdates:e=>{const n=mn.getState();mn.setState({updates:sn(sn({},n.updates),{},{presetUpdates:e||[]})})},clearUpdates:()=>{mn.setState({updates:{extensionUpdate:null,presetUpdates:[],lastChecked:null}})},dismissExtensionUpdate:e=>{mn.setState({dismissedUpdateVersion:e}),kn()},updateExtension:async()=>{const e=mn.getState();mn.setState({ui:sn(sn({},e.ui),{},{isUpdatingExtension:!0})});try{const e="undefined"!=typeof LumiverseBridge&&LumiverseBridge.getRequestHeaders?LumiverseBridge.getRequestHeaders:()=>({"Content-Type":"application/json"}),n=await fetch("/api/extensions/update",{method:"POST",headers:e(),body:JSON.stringify({extensionName:"SillyTavern-LumiverseHelper",global:!1})}),t=mn.getState();if(mn.setState({ui:sn(sn({},t.ui),{},{isUpdatingExtension:!1})}),!n.ok)return console.error("[LumiverseHelper] Extension update failed: ".concat(n.statusText)),{success:!1,message:"Update failed: ".concat(n.statusText)};const r=await n.json();return r.isUpToDate?(console.log("[LumiverseHelper] Extension is already up to date."),{success:!1,message:"Already up to date"}):(console.log("[LumiverseHelper] Extension updated successfully to ".concat(r.shortCommitHash,".")),{success:!0,message:"Updated to ".concat(r.shortCommitHash,". Reload to apply changes.")})}catch(e){console.error("[LumiverseHelper] Error updating extension:",e);const n=mn.getState();return mn.setState({ui:sn(sn({},n.ui),{},{isUpdatingExtension:!1})}),{success:!1,message:"Error: ".concat(e.message)}}}};function bn(e){if(!e)return;const n=mn.getState();mn.setState(sn(sn({},e),{},{ui:n.ui,chatChangeCounter:(n.chatChangeCounter||0)+1}))}function xn(){const e=mn.getState(),{ui:n}=e;return an(e,tn)}function yn(){!function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300;un&&clearTimeout(un),un=setTimeout(e,n)}(()=>{"undefined"!=typeof LumiverseBridge&&LumiverseBridge.saveSettings&&LumiverseBridge.saveSettings(xn())})}async function kn(){"undefined"!=typeof LumiverseBridge&&LumiverseBridge.saveSettings&&await LumiverseBridge.saveSettings(xn(),!0)}const wn={getState:mn.getState,setState:mn.setState,subscribe:mn.subscribe,syncFromExtension:bn,exportForExtension:xn,saveToExtension:yn};wn.getState=mn.getState;const jn=(0,Je.createContext)(null);function Sn(e){let{children:n,initialSettings:t=null}=e;const r=(0,Je.useRef)(!1);return(0,Je.useEffect)(()=>{if(!r.current)if(r.current=!0,t)console.log("[LumiverseProvider] Using initialSettings from bridge"),bn(t);else if("undefined"!=typeof LumiverseBridge&&LumiverseBridge.getSettings){console.log("[LumiverseProvider] Fetching settings via LumiverseBridge");const e=LumiverseBridge.getSettings();e&&bn(e)}else console.warn("[LumiverseProvider] No settings source available")},[t]),(0,nn.jsx)(jn.Provider,{value:mn,children:n})}function Cn(e){const n=(0,Je.useRef)(e);n.current=e;const t=(0,Je.useCallback)(()=>n.current(mn.getState()),[]);return(0,Je.useSyncExternalStore)(mn.subscribe,t,t)}function Nn(){return fn}const Pn=e=>e.settings,En=e=>e.ui,On=()=>mn.getState().selectedBehaviors,Mn=()=>mn.getState().selectedPersonalities,zn=()=>mn.getState().selectedDefinition,Tn=()=>mn.getState().dominantBehavior,In=()=>mn.getState().dominantPersonality,Ln=[],Dn=()=>mn.getState().selectedLoomStyle||Ln,An=()=>mn.getState().selectedLoomUtils||Ln,Rn=()=>mn.getState().selectedLoomRetrofits||Ln,Bn=()=>mn.getState().packs,_n={extensionUpdate:null,presetUpdates:[],lastChecked:null},Un=()=>mn.getState().updates||_n;function Fn(){return Cn(Pn)}function Wn(){const e=(0,Je.useSyncExternalStore)(mn.subscribe,On,On),n=(0,Je.useSyncExternalStore)(mn.subscribe,Mn,Mn),t=(0,Je.useSyncExternalStore)(mn.subscribe,zn,zn),r=(0,Je.useSyncExternalStore)(mn.subscribe,Tn,Tn),i=(0,Je.useSyncExternalStore)(mn.subscribe,In,In);return(0,Je.useMemo)(()=>({behaviors:e,personalities:n,definition:t,dominantBehavior:r,dominantPersonality:i}),[e,n,t,r,i])}function Hn(){const e=(0,Je.useSyncExternalStore)(mn.subscribe,Dn,Dn),n=(0,Je.useSyncExternalStore)(mn.subscribe,An,An),t=(0,Je.useSyncExternalStore)(mn.subscribe,Rn,Rn);return(0,Je.useMemo)(()=>({styles:e,utilities:n,retrofits:t}),[e,n,t])}function Vn(){const e=(0,Je.useSyncExternalStore)(mn.subscribe,Bn,Bn);return(0,Je.useMemo)(()=>{let n=[];e&&(Array.isArray(e)?n=e:"object"==typeof e&&(n=Object.entries(e).map(e=>{let[n,t]=e;return sn(sn({},t),{},{name:t.name||t.packName||n})})));const t=n.filter(e=>!0===e.isCustom);return{packs:n.filter(e=>!e.isCustom),customPacks:t,allPacks:n}},[e])}function qn(){return Cn(En)}function $n(){const e=(0,Je.useSyncExternalStore)(mn.subscribe,Un,Un),n=(0,Je.useSyncExternalStore)(mn.subscribe,()=>mn.getState().dismissedUpdateVersion,()=>mn.getState().dismissedUpdateVersion);return(0,Je.useMemo)(()=>{var t,r;const i=e.extensionUpdate,a=n&&(null==i?void 0:i.latestVersion)===n,o=(null==i?void 0:i.hasUpdate)&&!a;return{extensionUpdate:i,presetUpdates:e.presetUpdates||[],lastChecked:e.lastChecked,dismissedVersion:n,hasExtensionUpdate:o,hasPresetUpdates:((null===(t=e.presetUpdates)||void 0===t?void 0:t.length)||0)>0,hasAnyUpdate:o||(null===(r=e.presetUpdates)||void 0===r?void 0:r.length)>0}},[e,n])}function Yn(e){const[n,t]=(0,Je.useState)({objectPosition:"center center",isLoaded:!1,isPortrait:!1,isSquare:!1,isLandscape:!1}),r=(0,Je.useRef)(e);return(0,Je.useEffect)(()=>{if(r.current=e,!e)return void t({objectPosition:"center center",isLoaded:!1,isPortrait:!1,isSquare:!1,isLandscape:!1});const n=new Image;return n.onload=()=>{if(r.current!==e)return;const{naturalWidth:i,naturalHeight:a}=n,o=i/a,s=o<.9;let l="center center";s&&(l="center 20%"),t({objectPosition:l,isLoaded:!0,isPortrait:s,isSquare:o>=.9&&o<=1.1,isLandscape:o>1.1})},n.onerror=()=>{r.current===e&&t({objectPosition:"center center",isLoaded:!1,isPortrait:!1,isSquare:!1,isLandscape:!1})},n.src=e,()=>{n.onload=null,n.onerror=null}},[e]),n}"undefined"!=typeof window&&(window.debugLumiverseData=function(){const e=mn.getState();console.log("=".repeat(80)),console.log("LUMIVERSE DEBUG DATA DUMP"),console.log("=".repeat(80)),console.log("\n--- STORE STATE: packs ---"),console.log("Type:",typeof e.packs,Array.isArray(e.packs)?"(Array - WRONG!)":"(Object - correct)"),console.log("Pack names:",e.packs?Object.keys(e.packs):"null"),console.log("Packs:",JSON.stringify(e.packs,null,2)),console.log("\n--- CURRENT SELECTIONS ---"),console.log("selectedDefinition:",JSON.stringify(e.selectedDefinition,null,2)),console.log("selectedBehaviors:",JSON.stringify(e.selectedBehaviors,null,2)),console.log("selectedPersonalities:",JSON.stringify(e.selectedPersonalities,null,2)),console.log("dominantBehavior:",JSON.stringify(e.dominantBehavior,null,2)),console.log("dominantPersonality:",JSON.stringify(e.dominantPersonality,null,2)),console.log("\n--- LOOM SELECTIONS ---"),console.log("selectedLoomStyle:",JSON.stringify(e.selectedLoomStyle,null,2)),console.log("selectedLoomUtils:",JSON.stringify(e.selectedLoomUtils,null,2)),console.log("selectedLoomRetrofits:",JSON.stringify(e.selectedLoomRetrofits,null,2)),console.log("\n--- SETTINGS FROM LUMIVERSE BRIDGE ---");try{if("undefined"!=typeof LumiverseBridge&&LumiverseBridge.getSettings){const e=LumiverseBridge.getSettings();e?(console.log("Bridge packs type:",typeof e.packs,Array.isArray(e.packs)?"(Array)":"(Object)"),console.log("Bridge pack names:",e.packs?Object.keys(e.packs):"null"),console.log("Full bridge settings:",JSON.stringify(e,null,2))):console.log("LumiverseBridge.getSettings() returned null")}else console.log("LumiverseBridge not available")}catch(e){console.log("Error reading bridge settings:",e.message)}console.log("\n--- PACK STRUCTURE ANALYSIS ---");const n=e.packs||{},t=Object.entries(n);console.log("Total packs:",t.length),t.forEach(e=>{let[n,t]=e;console.log('\nPack "'.concat(n,'":')),console.log("  - Pack keys:",Object.keys(t));const r=!(!t.lumiaItems&&!t.loomItems);var i,a,o,s,l;console.log("  - Format:",r?"v2 (lumiaItems/loomItems)":"v1 (mixed items[])"),r?(console.log("  - lumiaItems count:",(null===(i=t.lumiaItems)||void 0===i?void 0:i.length)||0),console.log("  - loomItems count:",(null===(a=t.loomItems)||void 0===a?void 0:a.length)||0),(null===(o=t.lumiaItems)||void 0===o?void 0:o.length)>0&&(console.log("  - Lumia items:"),t.lumiaItems.forEach((e,n)=>{var t;const r=e.lumiaName||"NONE",i=e.lumiaDefinition?"YES":"NO",a=e.lumiaBehavior?"YES":"NO",o=e.lumiaPersonality?"YES":"NO",s=null!==(t=e.genderIdentity)&&void 0!==t?t:"NONE";console.log("    [".concat(n,'] lumiaName="').concat(r,'", hasDef=').concat(i,", hasBehavior=").concat(a,", hasPersonality=").concat(o,", gender=").concat(s))})),(null===(s=t.loomItems)||void 0===s?void 0:s.length)>0&&(console.log("  - Loom items:"),t.loomItems.forEach((e,n)=>{console.log("    [".concat(n,'] loomName="').concat(e.loomName,'", loomCategory="').concat(e.loomCategory,'"'))}))):(console.log("  - items count:",(null===(l=t.items)||void 0===l?void 0:l.length)||0),t.items&&t.items.length>0&&(console.log("  - First item keys:",Object.keys(t.items[0])),console.log("  - Items with lumiaDefName:",t.items.filter(e=>e.lumiaDefName).length),console.log("  - Items with loomCategory:",t.items.filter(e=>e.loomCategory).length),console.log("  - All items:"),t.items.forEach((e,n)=>{const t=e.lumiaDefName||"NONE",r=e.loomCategory||"NONE",i=e.lumiaDef?"YES":"NO",a=e.lumia_behavior?"YES":"NO",o=e.lumia_personality?"YES":"NO";console.log("    [".concat(n,'] lumiaDefName="').concat(t,'", loomCategory="').concat(r,'", hasDef=').concat(i,", hasBehavior=").concat(a,", hasPersonality=").concat(o))})))}),console.log("\n"+"=".repeat(80)),console.log("END DEBUG DUMP - Copy everything above for analysis"),console.log("=".repeat(80));const{ui:r}=e;return{storeState:an(e,rn)}});const Kn=e=>{const n=(e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,n,t)=>t?t.toUpperCase():n.toLowerCase()))(e);return n.charAt(0).toUpperCase()+n.slice(1)},Qn=(...e)=>e.filter((e,n,t)=>Boolean(e)&&""!==e.trim()&&t.indexOf(e)===n).join(" ").trim(),Gn=e=>{for(const n in e)if(n.startsWith("aria-")||"role"===n||"title"===n)return!0};var Xn={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const Zn=(0,Je.forwardRef)(({color:e="currentColor",size:n=24,strokeWidth:t=2,absoluteStrokeWidth:r,className:i="",children:a,iconNode:o,...s},l)=>(0,Je.createElement)("svg",{ref:l,...Xn,width:n,height:n,stroke:e,strokeWidth:r?24*Number(t)/Number(n):t,className:Qn("lucide",i),...!a&&!Gn(s)&&{"aria-hidden":"true"},...s},[...o.map(([e,n])=>(0,Je.createElement)(e,n)),...Array.isArray(a)?a:[a]])),Jn=(e,n)=>{const t=(0,Je.forwardRef)(({className:t,...r},i)=>{return(0,Je.createElement)(Zn,{ref:i,iconNode:n,className:Qn(`lucide-${a=Kn(e),a.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,t),...r});var a});return t.displayName=Kn(e),t},et=Jn("package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]]),nt=Jn("pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]),tt=Jn("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]),rt=Jn("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]);function it(e){var n,t,r="";if("string"==typeof e||"number"==typeof e)r+=e;else if("object"==typeof e)if(Array.isArray(e)){var i=e.length;for(n=0;n<i;n++)e[n]&&(t=it(e[n]))&&(r&&(r+=" "),r+=t)}else for(t in e)e[t]&&(r&&(r+=" "),r+=t);return r}const at=function(){for(var e,n,t=0,r="",i=arguments.length;t<i;t++)(e=arguments[t])&&(n=it(e))&&(r&&(r+=" "),r+=n);return r},ot=Jn("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),st=Jn("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),lt=Jn("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),ct=["value","onChange","placeholder","className","autoFocus"],ut=["value","onChange","placeholder","rows","className"];function dt(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function mt(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?dt(Object(t),!0).forEach(function(n){pt(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):dt(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function pt(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function gt(e,n){if(null==e)return{};var t,r,i=function(e,n){if(null==e)return{};var t={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==n.indexOf(r))continue;t[r]=e[r]}return t}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],-1===n.indexOf(t)&&{}.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}function vt(e){let{children:n,className:t}=e;return(0,nn.jsx)("div",{className:at("lumiverse-editor-modal",t),style:{display:"flex",flexDirection:"column",flex:"1 1 auto",minHeight:0,maxHeight:"100%",overflow:"hidden"},children:n})}function ht(e){let{children:n,className:t}=e;return(0,nn.jsx)("div",{className:at("lumiverse-editor-content",t),style:{flex:"1 1 auto",minHeight:0,overflowY:"auto",overflowX:"hidden",padding:"16px"},children:n})}function ft(e){let{children:n,className:t}=e;return(0,nn.jsx)("div",{className:at("lumiverse-editor-footer",t),style:{display:"flex",alignItems:"center",padding:"16px",background:"var(--lumiverse-bg-elevated)",borderTop:"1px solid var(--lumiverse-border)",flexShrink:0},children:n})}function bt(e){let{label:n,required:t,hint:r,error:i,children:a,className:o}=e;return(0,nn.jsxs)("div",{className:at("lumiverse-form-field",i&&"lumiverse-form-field--error",o),style:{marginBottom:"16px"},children:[(0,nn.jsxs)("label",{className:"lumiverse-form-label",style:{display:"block",marginBottom:"6px",fontSize:"13px",fontWeight:500,color:"var(--lumiverse-text-muted)"},children:[n,t&&(0,nn.jsx)("span",{className:"lumiverse-required",style:{color:"var(--lumiverse-danger)",marginLeft:"4px"},children:"*"})]}),a,r&&(0,nn.jsx)("div",{className:"lumiverse-form-hint",style:{marginTop:"6px",fontSize:"11px",color:"var(--lumiverse-text-dim)",lineHeight:1.4},children:r}),i&&(0,nn.jsx)("div",{className:"lumiverse-form-error",style:{marginTop:"4px",fontSize:"12px",color:"var(--lumiverse-danger)"},children:i})]})}function xt(e){let{Icon:n,title:t,children:r,defaultExpanded:i=!0,className:a}=e;const[o,s]=Je.useState(i);return(0,nn.jsxs)("div",{className:at("lumiverse-editor-section",a),style:{marginBottom:"20px"},children:[(0,nn.jsxs)("div",{className:"lumiverse-editor-section-header",onClick:()=>s(!o),style:{display:"flex",alignItems:"center",gap:"10px",paddingBottom:"10px",marginBottom:"10px",borderBottom:"1px solid var(--lumiverse-border)",cursor:"pointer",userSelect:"none"},children:[n&&(0,nn.jsx)("div",{className:"lumiverse-section-icon",style:{display:"flex",alignItems:"center",justifyContent:"center",width:"24px",height:"24px",borderRadius:"6px",background:"rgba(147, 112, 219, 0.1)",color:"var(--lumiverse-primary)"},children:(0,nn.jsx)(n,{size:14,strokeWidth:2})}),(0,nn.jsx)("span",{style:{fontSize:"13px",fontWeight:600,color:"var(--lumiverse-text)",flex:1},children:t}),(0,nn.jsx)("div",{style:{color:"var(--lumiverse-text-dim)"},children:o?(0,nn.jsx)(ot,{size:16}):(0,nn.jsx)(st,{size:16})})]}),o&&(0,nn.jsx)("div",{className:"lumiverse-editor-section-content",children:r})]})}function yt(e){let{value:n,onChange:t,placeholder:r,className:i,autoFocus:a}=e,o=gt(e,ct);return(0,nn.jsx)("input",mt({type:"text",className:at("lumiverse-input",i),value:n,onChange:e=>t(e.target.value),placeholder:r,autoFocus:a,style:{width:"100%",padding:"10px 12px",background:"rgba(0, 0, 0, 0.2)",border:"1px solid var(--lumiverse-border)",borderRadius:"8px",color:"var(--lumiverse-text)",fontSize:"13px",fontFamily:"inherit"}},o))}function kt(e){let{value:n,onChange:t,placeholder:r,rows:i=4,className:a}=e,o=gt(e,ut);return(0,nn.jsx)("textarea",mt({className:at("lumiverse-textarea",a),value:n,onChange:e=>t(e.target.value),placeholder:r,rows:i,style:{width:"100%",padding:"10px 12px",background:"rgba(0, 0, 0, 0.2)",border:"1px solid var(--lumiverse-border)",borderRadius:"8px",color:"var(--lumiverse-text)",fontSize:"13px",fontFamily:"inherit",lineHeight:1.5,resize:"vertical"}},o))}function wt(e){let{value:n,onChange:t,placeholder:r,className:i}=e;const[a,o]=(0,Je.useState)(!1),{objectPosition:s}=Yn(n||"");return(0,Je.useEffect)(()=>{o(!1)},[n]),(0,nn.jsx)("div",{className:at("lumiverse-image-input",i),children:(0,nn.jsxs)("div",{style:{display:"flex",gap:"10px",alignItems:"flex-start"},children:[(0,nn.jsx)("div",{style:{flex:1},children:(0,nn.jsx)(yt,{value:n,onChange:t,placeholder:r||"https://..."})}),n&&!a&&(0,nn.jsx)("div",{className:"lumiverse-image-preview",style:{width:"40px",height:"40px",borderRadius:"6px",overflow:"hidden",border:"1px solid var(--lumiverse-border)",flexShrink:0,background:"rgba(0,0,0,0.2)"},children:(0,nn.jsx)("img",{src:n,alt:"Preview",style:{width:"100%",height:"100%",objectFit:"cover",objectPosition:s,animation:"lumiverseFadeIn 0.2s ease"},onError:()=>o(!0)})}),(!n||a)&&(0,nn.jsx)("div",{style:{width:"40px",height:"40px",borderRadius:"6px",border:"1px dashed var(--lumiverse-border)",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,color:"var(--lumiverse-text-dim)"},children:(0,nn.jsx)(lt,{size:16})})]})})}function jt(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function St(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?jt(Object(t),!0).forEach(function(n){Ct(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):jt(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Ct(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function Nt(e){const n=function(e){const n=e.packName||e.name||"Unnamed Pack",t=e.packAuthor||e.author||null,r=e.coverUrl||null,i=e.version||1;let a=[];e.lumiaItems&&e.lumiaItems.length>0?a=e.lumiaItems.map(e=>{var n;return{lumiaName:e.lumiaName||e.lumiaDefName||"Unknown",lumiaDefinition:e.lumiaDefinition||e.lumiaDef||"",lumiaPersonality:e.lumiaPersonality||e.lumia_personality||"",lumiaBehavior:e.lumiaBehavior||e.lumia_behavior||"",avatarUrl:e.avatarUrl||e.lumia_img||null,genderIdentity:null!==(n=e.genderIdentity)&&void 0!==n?n:0,authorName:e.authorName||t||null,version:e.version||1}}):e.items&&e.items.length>0&&(a=e.items.filter(e=>e.lumiaDefName||e.lumiaDef).map(e=>{var n;return{lumiaName:e.lumiaDefName||e.lumiaName||"Unknown",lumiaDefinition:e.lumiaDef||e.lumiaDefinition||"",lumiaPersonality:e.lumia_personality||e.lumiaPersonality||"",lumiaBehavior:e.lumia_behavior||e.lumiaBehavior||"",avatarUrl:e.lumia_img||e.avatarUrl||null,genderIdentity:null!==(n=e.genderIdentity)&&void 0!==n?n:0,authorName:e.authorName||t||null,version:e.version||1}}));let o=[];return e.loomItems&&e.loomItems.length>0?o=e.loomItems.map(e=>({loomName:e.loomName||e.name||"Unknown",loomContent:e.loomContent||e.content||"",loomCategory:e.loomCategory||e.category||"Loom Utilities",authorName:e.authorName||t||null,version:e.version||1})):e.items&&e.items.length>0&&(o=e.items.filter(e=>(e.loomCategory||e.loomName)&&!e.lumiaDefName&&!e.lumiaDef).map(e=>({loomName:e.loomName||e.name||"Unknown",loomContent:e.loomContent||e.content||"",loomCategory:e.loomCategory||e.category||"Loom Utilities",authorName:e.authorName||t||null,version:e.version||1}))),{packName:n,packAuthor:t,coverUrl:r,version:i,packExtras:e.packExtras||[],lumiaItems:a,loomItems:o}}(e),t=JSON.stringify(n,null,2),r=new Blob([t],{type:"application/json"}),i=URL.createObjectURL(r),a=e.packName||e.name||"pack",o=document.createElement("a");o.href=i,o.download="".concat(a.replace(/[^a-z0-9]/gi,"_"),"_lumiverse.json"),document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(i)}function Pt(e){return e.packName||e.name||""}function Et(e){return e.packAuthor||e.author||""}const Ot=function(e){let{packId:n,packName:t,onClose:r}=e;const{customPacks:i}=Vn(),a=Nn(),o=n||t,s=o?i.find(e=>e.id===o||e.name===o||e.packName===o):null,[l,c]=(0,Je.useState)(()=>s?St(St({},s),{},{packName:s.packName||s.name||"",packAuthor:s.packAuthor||s.author||""}):{id:"pack_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),packName:"",name:"",packAuthor:"",coverUrl:"",url:"",isCustom:!0,version:1,packExtras:[],lumiaItems:[],loomItems:[]}),[u,d]=(0,Je.useState)({}),m=(0,Je.useCallback)((e,n)=>{c(t=>St(St({},t),{},{[e]:n})),u[e]&&d(n=>St(St({},n),{},{[e]:null}))},[u]),p=function(e){return e.lumiaItems&&e.lumiaItems.length>0?e.lumiaItems.length:e.items&&e.items.length>0?e.items.filter(e=>e.lumiaDefName||e.lumiaName||e.lumiaDef).length:0}(l),g=function(e){return e.loomItems&&e.loomItems.length>0?e.loomItems.length:e.items&&e.items.length>0?e.items.filter(e=>(e.loomCategory||e.loomName)&&!e.lumiaDefName&&!e.lumiaDef).length:0}(l);return(0,nn.jsxs)(vt,{children:[(0,nn.jsxs)(ht,{children:[(0,nn.jsxs)(xt,{Icon:et,title:s?"Edit Pack":"New Pack",children:[(0,nn.jsx)(bt,{label:"Pack Name",required:!0,error:u.packName,children:(0,nn.jsx)(yt,{value:Pt(l),onChange:e=>{c(n=>St(St({},n),{},{packName:e,name:e})),u.packName&&d(e=>St(St({},e),{},{packName:null}))},placeholder:"My Custom Pack",autoFocus:!0})}),(0,nn.jsx)(bt,{label:"Author",children:(0,nn.jsx)(yt,{value:Et(l),onChange:e=>{c(n=>St(St({},n),{},{packAuthor:e,author:e}))},placeholder:"Your name"})}),(0,nn.jsx)(bt,{label:"Cover Image",hint:"URL for pack cover image",children:(0,nn.jsx)(wt,{value:l.coverUrl||"",onChange:e=>m("coverUrl",e),placeholder:"https://..."})})]}),(0,nn.jsxs)(xt,{Icon:nt,title:"Pack Contents",children:[(0,nn.jsxs)("div",{style:{padding:"12px",background:"rgba(147, 112, 219, 0.05)",border:"1px solid var(--lumiverse-border)",borderRadius:"8px",marginBottom:"12px",textAlign:"center"},children:[(0,nn.jsxs)("div",{style:{fontSize:"13px",color:"var(--lumiverse-text)",marginBottom:"8px"},children:[p," Lumia",1!==p?"s":"",g>0?", ".concat(g," Loom item").concat(1!==g?"s":""):""," in this pack"]}),(0,nn.jsx)("div",{style:{fontSize:"11px",color:"var(--lumiverse-text-muted)"},children:"Use the Pack Selector to add, edit, or remove individual items."})]}),(0,nn.jsxs)("button",{className:"lumiverse-btn lumiverse-btn--secondary lumiverse-btn--full",onClick:()=>{const e=Pt(l);if(e.trim()){const n=St(St({},l),{},{name:e});s?a.updateCustomPack(l.id||Pt(s),n):a.addCustomPack(n),yn()}a.openModal("packSelector"),r()},type:"button",children:[(0,nn.jsx)(nt,{size:14,strokeWidth:1.5}),"Manage Lumias & Looms"]})]})]}),(0,nn.jsxs)(ft,{children:[(0,nn.jsxs)("div",{style:{display:"flex",gap:"8px",marginRight:"auto"},children:[s&&(0,nn.jsxs)("button",{className:"lumiverse-btn lumiverse-btn--danger",onClick:()=>{const e=Pt(l);window.confirm('Are you sure you want to delete "'.concat(e,'"? This will remove all Lumias in this pack.'))&&(a.removeCustomPack(l.id||e),yn(),r())},type:"button",children:[(0,nn.jsx)(tt,{size:14}),"Delete"]}),(0,nn.jsxs)("button",{className:"lumiverse-btn lumiverse-btn--secondary",onClick:()=>{Pt(l).trim()?Nt(l):alert("Please enter a pack name before exporting.")},type:"button",title:"Export as Lumiverse Pack",children:[(0,nn.jsx)(rt,{size:14}),"Export"]})]}),(0,nn.jsxs)("div",{style:{display:"flex",gap:"8px"},children:[(0,nn.jsx)("button",{className:"lumiverse-btn lumiverse-btn--secondary",onClick:r,type:"button",children:"Cancel"}),(0,nn.jsx)("button",{className:"lumiverse-btn lumiverse-btn--primary",onClick:()=>{if(!(()=>{const e={};return Pt(l).trim()||(e.packName="Pack name is required"),d(e),0===Object.keys(e).length})())return;const e=St(St({},l),{},{name:Pt(l)});s?a.updateCustomPack(l.id||Pt(s),e):a.addCustomPack(e),yn(),r()},type:"button",children:s?"Save Changes":"Create Pack"})]})]})]})},Mt=["isOpen","children","className","duration","initial","animate","exit","transition"];function zt(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function Tt(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?zt(Object(t),!0).forEach(function(n){It(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):zt(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function It(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const Lt=(0,Je.forwardRef)(function(e,n){let{isOpen:t,children:r,className:i,duration:a=200,initial:o,animate:s,exit:l,transition:c}=e,u=function(e,n){if(null==e)return{};var t,r,i=function(e,n){if(null==e)return{};var t={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==n.indexOf(r))continue;t[r]=e[r]}return t}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],-1===n.indexOf(t)&&{}.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}(e,Mt);return(0,nn.jsx)("div",Tt(Tt({ref:n,className:at("lumiverse-collapsible",i,{"is-open":t}),style:{"--collapsible-duration":"".concat(a,"ms")}},u),{},{children:(0,nn.jsx)("div",{className:"lumiverse-collapsible-inner",children:r})}))});var Dt=t(961);const At=Jn("circle-arrow-up",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m16 12-4-4-4 4",key:"177agl"}],["path",{d:"M12 16V8",key:"1sbj14"}]]),Rt=Jn("file-braces",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 12a1 1 0 0 0-1 1v1a1 1 0 0 1-1 1 1 1 0 0 1 1 1v1a1 1 0 0 0 1 1",key:"1oajmo"}],["path",{d:"M14 18a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1 1 1 0 0 1-1-1v-1a1 1 0 0 0-1-1",key:"mpwhp6"}]]),Bt=Jn("cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]),_t=Jn("brain",[["path",{d:"M12 18V5",key:"adv99a"}],["path",{d:"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4",key:"1e3is1"}],["path",{d:"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5",key:"1gqd8o"}],["path",{d:"M17.997 5.125a4 4 0 0 1 2.526 5.77",key:"iwvgf7"}],["path",{d:"M18 18a4 4 0 0 0 2-7.464",key:"efp6ie"}],["path",{d:"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517",key:"1gq6am"}],["path",{d:"M6 18a4 4 0 0 1-2-7.464",key:"k1g0md"}],["path",{d:"M6.003 5.125a4 4 0 0 0-2.526 5.77",key:"q97ue3"}]]),Ut=Jn("zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),Ft=Jn("settings-2",[["path",{d:"M14 17H5",key:"gfn3mx"}],["path",{d:"M19 7h-9",key:"6i9tg"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]]),Wt=Jn("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),Ht=Jn("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),Vt=Jn("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),qt=Jn("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),$t=Jn("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),Yt=["trackVersion"];function Kt(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function Qt(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Kt(Object(t),!0).forEach(function(n){Gt(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Kt(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Gt(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const Xt="presets-service",Zt="https://lucid.cards",Jt=new Set;function er(){const e=lr();Jt.forEach(n=>{try{n(e)}catch(e){console.error("[".concat(Xt,"] Tracking listener error:"),e)}})}const nr=new Set;function tr(){const e={reasoning:hr(),startReplyWith:br(),apiReasoning:yr(),postProcessing:rr()};nr.forEach(n=>{try{n(e)}catch(e){console.error("[".concat(Xt,"] Reasoning listener error:"),e)}})}function rr(){var e;const n=(0,r.SD)();return(null==n||null===(e=n.chatCompletionSettings)||void 0===e?void 0:e.custom_prompt_post_processing)||""}const ir=["chat_completion_source","openai_model","claude_model","openrouter_model","mistralai_model","ai21_model","cohere_model","perplexity_model","groq_model","chutes_model","siliconflow_model","electronhub_model","nanogpt_model","deepseek_model","aimlapi_model","xai_model","pollinations_model","moonshot_model","fireworks_model","cometapi_model","google_model","vertexai_model","zai_model","azure_openai_model","custom_model","custom_url","custom_include_body","custom_exclude_body","custom_include_headers","custom_prompt_post_processing","openrouter_use_fallback","openrouter_group_models","openrouter_sort_models","openrouter_providers","openrouter_allow_fallbacks","openrouter_middleout","azure_base_url","azure_deployment_name","azure_api_version","vertexai_auth_mode","vertexai_region","vertexai_express_project_id","zai_endpoint","reverse_proxy","proxy_password","bypass_status_check","show_external_models"],ar=["mistralai_model"];function or(e,n){const t=Qt({},e);return ir.forEach(e=>{void 0===t[e]&&(t[e]=n[e])}),ar.forEach(e=>{void 0!==t[e]&&null!==t[e]||(t[e]=n[e]||"")}),t}function sr(e){return e?"".concat(e.major,".").concat(e.minor,".").concat(e.patch):"unknown"}function lr(){return(0,D.mt)().trackedPresets||{}}async function cr(){const e=lr(),n=Object.keys(e);if(0===n.length)return[];const t=n.map(async n=>{const t=e[n],r=await async function(e){try{const n=await fetch("".concat(Zt,"/api/download/chat-presets/").concat(e,"/latest"));if(!n.ok)return null;const t=await n.json();return t.success&&t.version||null}catch(e){return null}}(n);if(null==r||!r.version)return null;const i=r.version,a=t.version;return s=i,((o=a)&&s?o.major!==s.major?o.major<s.major?-1:1:o.minor!==s.minor?o.minor<s.minor?-1:1:o.patch!==s.patch?o.patch<s.patch?-1:1:0:0)<0?{slug:n,name:t.name,currentVersion:a,latestVersion:i,latestVersionName:r.name||sr(i)}:null;var o,s});try{return(await Promise.all(t)).filter(Boolean)}catch(e){return console.error("[".concat(Xt,"] Failed to check for updates:"),e),[]}}function ur(e){return e&&["input_sequence","output_sequence"].every(n=>Object.keys(e).includes(n))}function dr(e){return e&&["story_string"].every(n=>Object.keys(e).includes(n))}function mr(e){if(!e)return!1;const n=Object.keys(e),t=n.includes("temp")||n.includes("temperature")||n.includes("temp_openai"),r=["top_p","top_k","rep_pen","repetition_penalty","frequency_penalty","freq_pen_openai","openai_model","top_p_openai"].some(e=>n.includes(e));return t&&r}function pr(e){return e&&["prefix","suffix","separator"].every(n=>Object.keys(e).includes(n))}async function gr(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"latest",t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{trackVersion:i=!0}=t,a=function(e,n){if(null==e)return{};var t,r,i=function(e,n){if(null==e)return{};var t={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==n.indexOf(r))continue;t[r]=e[r]}return t}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],-1===n.indexOf(t)&&{}.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}(t,Yt);try{var o;const t=await async function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"latest";try{const t=await fetch("".concat(Zt,"/api/download/chat-presets/").concat(e,"/").concat(n));if(!t.ok)throw new Error("HTTP ".concat(t.status,": ").concat(t.statusText));const r=await t.json();if(!r.success)throw new Error(r.error||"Preset download failed");return r}catch(e){throw console.error("[".concat(Xt,"] Failed to download preset:"),e),e}}(e,n);if(!t.data)throw new Error("No preset data in API response");const s=(null===(o=t.preset)||void 0===o?void 0:o.latestVersion)||null,l=(null==s?void 0:s.name)||"".concat(e," ").concat(n),c=await async function(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{activate:i=!1}=t,a=(0,r.SD)();if(!a)return{success:!1,type:"none",message:"SillyTavern context not available"};try{if(ur(e)){const t=a.getPresetManager("instruct");return await t.savePreset(e.name||n,e),i&&await t.selectPreset(e.name||n),a.saveSettingsDebounced(),{success:!0,type:"instruct",message:"Imported Instruct Preset"}}if(dr(e)){const t=a.getPresetManager("context");return await t.savePreset(e.name||n,e),i&&await t.selectPreset(e.name||n),a.saveSettingsDebounced(),{success:!0,type:"context",message:"Imported Context Preset"}}if(mr(e)){var o;const t=a.chatCompletionSettings||window.oai_settings||{},r=or(e,t);console.log("[".concat(Xt,"] Hydrated preset has mistralai_model:"),typeof r.mistralai_model,r.mistralai_model);const l=a.getPresetManager("openai");await l.savePreset(n,r);const c=null===(o=l.getCompletionPresetByName)||void 0===o?void 0:o.call(l,n);if(c?(console.log("[".concat(Xt,"] Stored preset has mistralai_model:"),typeof c.mistralai_model,c.mistralai_model),ar.forEach(e=>{void 0===c[e]&&(c[e]="",console.log("[".concat(Xt,"] Patched stored preset with ").concat(e)))})):console.warn("[".concat(Xt,"] Could not find stored preset to verify")),i){var s;ar.forEach(e=>{t&&void 0===t[e]&&(t[e]="")}),await new Promise(e=>setTimeout(e,50));const e=null===(s=l.findPreset)||void 0===s?void 0:s.call(l,n);console.log("[".concat(Xt,'] selectPreset - name: "').concat(n,'", optionValue: "').concat(e,'"')),null!=e?await l.selectPreset(e):await l.selectPreset(n)}return a.saveSettingsDebounced(),{success:!0,type:"openai",message:"Imported API Preset"}}if(pr(e)){const t=a.getPresetManager("reasoning");return await t.savePreset(e.name||n,e),i&&await t.selectPreset(e.name||n),a.saveSettingsDebounced(),{success:!0,type:"reasoning",message:"Imported Reasoning Preset"}}let t=0;const r=[];if(e.instruct&&ur(e.instruct)){const i=a.getPresetManager("instruct");await i.savePreset(e.instruct.name||"".concat(n,"_instruct"),e.instruct),t++,r.push("instruct")}if(e.context&&dr(e.context)){const i=a.getPresetManager("context");await i.savePreset(e.context.name||"".concat(n,"_context"),e.context),t++,r.push("context")}if(e.reasoning&&pr(e.reasoning)){const i=a.getPresetManager("reasoning");await i.savePreset(e.reasoning.name||"".concat(n,"_reasoning"),e.reasoning),t++,r.push("reasoning")}if(e.preset&&mr(e.preset)){const i=a.chatCompletionSettings||window.oai_settings||{},o=or(e.preset,i),s=a.getPresetManager("openai");await s.savePreset(o.name||n,o),t++,r.push("openai")}return t>0?(a.saveSettingsDebounced(),{success:!0,type:"master",message:"Imported ".concat(t," preset(s): ").concat(r.join(", "))}):{success:!1,type:"unknown",message:"Unknown preset format"}}catch(e){return console.error("[".concat(Xt,"] Import error:"),e),{success:!1,type:"error",message:e.message}}}(t.data,l,a);return console.log("[".concat(Xt,"] Import result:"),{success:c.success,trackVersion:i,hasVersion:!!s,versionInfo:s}),c.success&&i&&function(e,n,t){const r=(0,D.mt)();r.trackedPresets||(r.trackedPresets={}),r.trackedPresets[e]={name:(null==n?void 0:n.name)||e,version:(null==t?void 0:t.version)||null,versionName:(null==t?void 0:t.name)||"unknown",importedAt:Date.now()},(0,D.DZ)(),console.log("[".concat(Xt,"] Tracked preset: ").concat(e," v").concat(sr(null==t?void 0:t.version))),er()}(e,t.preset,s||{name:n,version:null}),Qt(Qt({},c),{},{presetInfo:t.preset,versionInfo:s})}catch(e){return console.error("[".concat(Xt,"] Download and import failed:"),e),{success:!1,type:"error",message:e.message}}}function vr(e){const n=(0,r.SD)();if(!n)return void console.warn("[".concat(Xt,"] Context not available for reasoning config"));const t=n.powerUserSettings;if(!t||!t.reasoning)return void console.warn("[".concat(Xt,"] Reasoning settings not available"));const i=window.jQuery;void 0!==e.autoParse&&(t.reasoning.auto_parse=e.autoParse,i&&i("#reasoning_auto_parse").prop("checked",e.autoParse)),void 0!==e.prefix&&(t.reasoning.prefix=e.prefix,i&&i("#reasoning_prefix").val(e.prefix)),void 0!==e.suffix&&(t.reasoning.suffix=e.suffix,i&&i("#reasoning_suffix").val(e.suffix)),void 0!==e.showHidden&&(t.reasoning.show_hidden=e.showHidden,i&&i("#reasoning_show_hidden").prop("checked",e.showHidden)),void 0!==e.autoExpand&&(t.reasoning.auto_expand=e.autoExpand,i&&i("#reasoning_auto_expand").prop("checked",e.autoExpand)),void 0!==e.addToPrompts&&(t.reasoning.add_to_prompts=e.addToPrompts,i&&i("#reasoning_add_to_prompts").prop("checked",e.addToPrompts)),n.saveSettingsDebounced(),console.log("[".concat(Xt,"] Reasoning settings updated")),tr()}function hr(){var e;const n=(0,r.SD)();return null!=n&&null!==(e=n.powerUserSettings)&&void 0!==e&&e.reasoning?Qt({},n.powerUserSettings.reasoning):null}function fr(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{showInUI:t=!0}=n,i=(0,r.SD)();if(!i)return void console.warn("[".concat(Xt,"] Context not available for Start Reply With"));const a=i.powerUserSettings;if(!a)return void console.warn("[".concat(Xt,"] Power user settings not available"));a.user_prompt_bias=e,t&&(a.show_user_prompt_bias=!0);const o=window.jQuery;if(o){const n=o("#start_reply_with");n.length&&n.val(e)}i.saveSettingsDebounced(),console.log("[".concat(Xt,'] Start Reply With set to: "').concat(e.substring(0,50),'..."')),tr()}function br(){var e;const n=(0,r.SD)();return(null==n||null===(e=n.powerUserSettings)||void 0===e?void 0:e.user_prompt_bias)||""}const xr=["auto","low","medium","high","min","max"];function yr(){const e=(0,r.SD)();return null!=e&&e.chatCompletionSettings?{enabled:!!e.chatCompletionSettings.show_thoughts,effort:e.chatCompletionSettings.reasoning_effort||"auto"}:{enabled:!1,effort:"auto"}}const kr=[{value:"",label:"None (Default)"},{value:"merge",label:"Merge (Recommended for Claude/OpenAI)"},{value:"merge_tools",label:"Merge (preserve tool calls)"},{value:"semi",label:"Semi-alternation"},{value:"semi_tools",label:"Semi-alternation (with tools)"},{value:"strict",label:"Strict alternation"},{value:"strict_tools",label:"Strict alternation (with tools)"},{value:"single",label:"Single (last user message only)"}];function wr(){var e;const n=(0,r.SD)();return(null==n||null===(e=n.chatCompletionSettings)||void 0===e?void 0:e.custom_prompt_post_processing)||""}const jr={deepseek:{autoParse:!0,prefix:"<think>\n",suffix:"\n</think>",showHidden:!0,autoExpand:!1,addToPrompts:!1},openai_o1:{autoParse:!0,prefix:"<reasoning>\n",suffix:"\n</reasoning>",showHidden:!0,autoExpand:!1,addToPrompts:!1},claude_extended:{autoParse:!0,prefix:"<thinking>\n",suffix:"\n</thinking>",showHidden:!0,autoExpand:!1,addToPrompts:!1}};function Sr(){const[e,n]=(0,Je.useState)(null),[t,i]=(0,Je.useState)(""),[a,o]=(0,Je.useState)({enabled:!1,effort:"auto"}),[s,l]=(0,Je.useState)(""),c=(0,Je.useRef)({startReplyWith:""});c.current.startReplyWith=t,(0,Je.useEffect)(()=>{n(hr()),i(br()),o(yr()),l(wr());var e;return e=e=>{n(e.reasoning),i(e.startReplyWith),o(e.apiReasoning),l(e.postProcessing)},nr.add(e),()=>nr.delete(e)},[]);const u=(0,Je.useCallback)(()=>{n(hr()),i(br()),o(yr()),l(wr())},[]),d=(0,Je.useCallback)(function(e){const t=jr[e];t&&(arguments.length>1&&void 0!==arguments[1]&&arguments[1]?function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const t=jr[e];if(!t)return void console.warn("[".concat(Xt,"] Unknown reasoning preset: ").concat(e));vr(t),fr(n||"".concat(t.prefix,"\n"))}(e):vr(t),n(hr()),i(br()))},[]),m=(0,Je.useCallback)(e=>{i(e),fr(e)},[]),p=(0,Je.useCallback)((e,t)=>{vr({[e]:t}),n(hr())},[]);return{reasoningSettings:e,startReplyWith:t,apiReasoning:a,postProcessing:s,handleApplyReasoningPreset:d,handleStartReplyWithChange:m,handleReasoningToggle:p,handleAPIReasoningToggle:(0,Je.useCallback)(e=>{!function(e){const n=(0,r.SD)();if(null==n||!n.chatCompletionSettings)return void console.warn("[".concat(Xt,"] Chat completion settings not available"));n.chatCompletionSettings.show_thoughts=!!e;const t=window.jQuery;t&&t("#openai_show_thoughts").prop("checked",!!e),e||(n.chatCompletionSettings.reasoning_effort="auto",t&&t("#openai_reasoning_effort").val("auto")),n.saveSettingsDebounced(),console.log("[".concat(Xt,"] Include Reasoning set to: ").concat(e)),tr()}(e),o(yr()),e&&c.current.startReplyWith&&(i(""),fr(""))},[]),handleReasoningEffortChange:(0,Je.useCallback)(e=>{!function(e){const n=(0,r.SD)();if(null==n||!n.chatCompletionSettings)return void console.warn("[".concat(Xt,"] Chat completion settings not available"));if(!xr.includes(e))return void console.warn("[".concat(Xt,"] Invalid reasoning effort: ").concat(e));n.chatCompletionSettings.reasoning_effort=e;const t=window.jQuery;t&&t("#openai_reasoning_effort").val(e),n.saveSettingsDebounced(),console.log("[".concat(Xt,"] Reasoning Effort set to: ").concat(e)),tr()}(e),o(yr())},[]),handlePostProcessingChange:(0,Je.useCallback)(e=>{l(e),function(e){const n=(0,r.SD)();if(null==n||!n.chatCompletionSettings)return void console.warn("[".concat(Xt,"] Chat completion settings not available"));if(!kr.map(e=>e.value).includes(e))return void console.warn("[".concat(Xt,"] Invalid post-processing strategy: ").concat(e));n.chatCompletionSettings.custom_prompt_post_processing=e;const t=window.jQuery;t&&t("#custom_prompt_post_processing").val(e),n.saveSettingsDebounced(),console.log("[".concat(Xt,"] Post-processing set to: ").concat(e||"(none)")),tr()}(e)},[]),refreshState:u,REASONING_EFFORT_LEVELS:xr,POST_PROCESSING_OPTIONS:kr}}const Cr=Jn("sparkles",[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]]),Nr=Jn("tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]),Pr=Jn("gauge",[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]]),Er=Jn("layers",[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]]);function Or(e){let{reasoningSettings:n,startReplyWith:t,apiReasoning:r,postProcessing:i="",onApplyReasoningPreset:a,onStartReplyWithChange:o,onReasoningToggle:s,onAPIReasoningToggle:l,onReasoningEffortChange:c,onPostProcessingChange:u,effortLevels:d=["auto","low","medium","high","min","max"],postProcessingOptions:m=[{value:"",label:"None (Default)"},{value:"merge",label:"Merge (Recommended for Claude/OpenAI)"},{value:"merge_tools",label:"Merge (preserve tool calls)"},{value:"semi",label:"Semi-alternation"},{value:"semi_tools",label:"Semi-alternation (with tools)"},{value:"strict",label:"Strict alternation"},{value:"strict_tools",label:"Strict alternation (with tools)"},{value:"single",label:"Single (last user message only)"}],compact:p=!1}=e;return(0,nn.jsxs)("div",{className:at("lumiverse-presets-reasoning",p&&"lumiverse-presets-reasoning--compact"),children:[(0,nn.jsxs)("div",{className:"lumiverse-presets-reasoning-quick",children:[(0,nn.jsxs)("span",{className:"lumiverse-presets-reasoning-label",children:[(0,nn.jsx)(Cr,{size:12,strokeWidth:2}),"Quick Presets"]}),(0,nn.jsxs)("div",{className:"lumiverse-presets-reasoning-btns",children:[(0,nn.jsxs)("button",{className:"lumiverse-presets-reasoning-btn lumiverse-presets-reasoning-btn--deepseek",onClick:()=>a("deepseek",!1),title:"Apply DeepSeek <think> tags",type:"button",children:[(0,nn.jsx)("span",{className:"lumiverse-presets-reasoning-btn-label",children:"DeepSeek"}),(0,nn.jsx)("code",{children:"<think>"})]}),(0,nn.jsxs)("button",{className:"lumiverse-presets-reasoning-btn lumiverse-presets-reasoning-btn--claude",onClick:()=>a("claude_extended",!1),title:"Apply Claude <thinking> tags",type:"button",children:[(0,nn.jsx)("span",{className:"lumiverse-presets-reasoning-btn-label",children:"Claude"}),(0,nn.jsx)("code",{children:"<thinking>"})]}),(0,nn.jsxs)("button",{className:"lumiverse-presets-reasoning-btn lumiverse-presets-reasoning-btn--o1",onClick:()=>a("openai_o1",!1),title:"Apply o1 <reasoning> tags",type:"button",children:[(0,nn.jsx)("span",{className:"lumiverse-presets-reasoning-btn-label",children:"o1"}),(0,nn.jsx)("code",{children:"<reasoning>"})]})]})]}),n&&(0,nn.jsxs)("div",{className:"lumiverse-presets-reasoning-current",children:[(0,nn.jsx)("div",{className:"lumiverse-presets-reasoning-row",children:(0,nn.jsxs)("label",{className:"lumiverse-presets-reasoning-checkbox",children:[(0,nn.jsx)("input",{type:"checkbox",checked:n.auto_parse||!1,onChange:e=>s("autoParse",e.target.checked)}),(0,nn.jsx)("span",{className:"lumiverse-presets-reasoning-checkmark"}),(0,nn.jsx)("span",{children:"Auto-parse thoughts"})]})}),(0,nn.jsxs)("div",{className:"lumiverse-presets-reasoning-tags",children:[(0,nn.jsx)(Nr,{size:12,strokeWidth:2}),(0,nn.jsx)("span",{children:"Tags:"}),(0,nn.jsx)("code",{children:(n.prefix||"<think>").replace(/\n/g,"↵")}),(0,nn.jsx)("span",{className:"lumiverse-presets-reasoning-tags-sep",children:"/"}),(0,nn.jsx)("code",{children:(n.suffix||"</think>").replace(/\n/g,"↵")})]})]}),(0,nn.jsxs)("div",{className:"lumiverse-presets-api-reasoning",children:[(0,nn.jsxs)("span",{className:"lumiverse-presets-reasoning-label",children:[(0,nn.jsx)(Pr,{size:12,strokeWidth:2}),"API Reasoning (for supported models)"]}),(0,nn.jsxs)("div",{className:"lumiverse-presets-api-reasoning-controls",children:[(0,nn.jsxs)("label",{className:"lumiverse-presets-reasoning-checkbox",children:[(0,nn.jsx)("input",{type:"checkbox",checked:r.enabled,onChange:e=>l(e.target.checked)}),(0,nn.jsx)("span",{className:"lumiverse-presets-reasoning-checkmark"}),(0,nn.jsx)("span",{children:"Include Reasoning"})]}),(0,nn.jsxs)("div",{className:"lumiverse-presets-api-reasoning-effort",children:[(0,nn.jsx)("span",{className:"lumiverse-presets-api-reasoning-effort-label",children:"Effort:"}),(0,nn.jsx)("select",{className:"lumiverse-presets-api-reasoning-select",value:r.effort,onChange:e=>c(e.target.value),disabled:!r.enabled,children:d.map(e=>(0,nn.jsx)("option",{value:e,children:e.charAt(0).toUpperCase()+e.slice(1)},e))})]})]}),(0,nn.jsx)("p",{className:"lumiverse-presets-api-reasoning-hint",children:"For o1/o3, Grok 3, DeepSeek R1, and other reasoning models"})]}),(0,nn.jsxs)("div",{className:at("lumiverse-presets-startreply",r.enabled&&"is-disabled"),children:[(0,nn.jsxs)("label",{className:"lumiverse-presets-startreply-label",children:[(0,nn.jsx)(Ut,{size:12,strokeWidth:2}),(0,nn.jsx)("span",{children:"Start Reply With (Prompt Bias)"}),r.enabled&&(0,nn.jsx)("span",{className:"lumiverse-presets-startreply-disabled-hint",children:"Disabled when API Reasoning is on"})]}),(0,nn.jsx)("div",{className:"lumiverse-presets-startreply-input-wrap",children:(0,nn.jsx)("textarea",{className:"lumiverse-presets-startreply-input",value:t,onChange:e=>o(e.target.value),placeholder:r.enabled?"Disabled while API Reasoning is active":"Force AI to start response with...",rows:2,disabled:r.enabled})}),(0,nn.jsxs)("div",{className:"lumiverse-presets-startreply-quick",children:[(0,nn.jsx)("button",{className:"lumiverse-presets-startreply-btn",onClick:()=>o("<think>\n"),title:"Set to <think> tag with newline",type:"button",disabled:r.enabled,children:"<think>↵"}),(0,nn.jsx)("button",{className:"lumiverse-presets-startreply-btn lumiverse-presets-startreply-btn--claude",onClick:()=>o("<think>"),title:"Set to <think> tag (Claude, no newline)",type:"button",disabled:r.enabled,children:"<think>"}),(0,nn.jsx)("button",{className:"lumiverse-presets-startreply-btn lumiverse-presets-startreply-btn--claude",onClick:()=>o("<thinking>"),title:"Set to <thinking> tag (Claude, no newline)",type:"button",disabled:r.enabled,children:"<thinking>"}),(0,nn.jsx)("button",{className:"lumiverse-presets-startreply-btn lumiverse-presets-startreply-btn--clear",onClick:()=>o(""),title:"Clear",type:"button",disabled:r.enabled,children:(0,nn.jsx)(Wt,{size:12,strokeWidth:2})})]})]}),u&&(0,nn.jsxs)("div",{className:"lumiverse-presets-postprocessing",children:[(0,nn.jsxs)("label",{className:"lumiverse-presets-postprocessing-label",children:[(0,nn.jsx)(Er,{size:12,strokeWidth:2}),(0,nn.jsx)("span",{children:"Prompt Post-Processing"})]}),(0,nn.jsx)("select",{className:"lumiverse-presets-postprocessing-select",value:i,onChange:e=>u(e.target.value),children:m.map(e=>(0,nn.jsx)("option",{value:e.value,children:e.label},e.value))}),(0,nn.jsx)("p",{className:"lumiverse-presets-postprocessing-hint",children:"Controls how messages are combined before sending to the API"})]})]})}function Mr(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function zr(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Mr(Object(t),!0).forEach(function(n){Tr(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Mr(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Tr(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function Ir(){const e=Nn(),[n,t]=(0,Je.useState)(!1),[r,i]=(0,Je.useState)({}),[a,o]=(0,Je.useState)(null),[s,l]=(0,Je.useState)(""),[c,u]=(0,Je.useState)([]),d=(0,Je.useRef)(null);(0,Je.useEffect)(()=>{i(lr()),o(hr()),l(br());const n=(t=n=>{i(n),cr().then(n=>{u(n),e.setPresetUpdates(n)})},Jt.add(t),()=>Jt.delete(t));var t;const r=setTimeout(()=>{cr().then(n=>{u(n),e.setPresetUpdates(n)})},5e3);return d.current=setInterval(()=>{cr().then(n=>{u(n),e.setPresetUpdates(n)})},18e5),()=>{n(),clearTimeout(r),d.current&&clearInterval(d.current)}},[e]);const m=(0,Je.useCallback)(()=>{t(!0)},[]),p=(0,Je.useCallback)(()=>{t(!1),i(lr()),o(hr()),l(br()),cr().then(n=>{u(n),e.setPresetUpdates(n)})},[e]),g=(0,Je.useMemo)(()=>Object.entries(r).map(e=>{let[n,t]=e;const r=c.find(e=>e.slug===n);return{slug:n,name:t.name,version:t.version,versionName:t.versionName,hasUpdate:!!r,latestVersionName:null==r?void 0:r.latestVersionName}}),[r,c]),v=(0,Je.useMemo)(()=>null!=a&&a.auto_parse?a.prefix||"<think>":null,[a]),h=(0,Je.useMemo)(()=>{if(!s)return null;return s.slice(0,20).replace(/\n/g,"↵")+(s.length>20?"…":"")},[s]),f=c.length;return(0,nn.jsxs)(nn.Fragment,{children:[g.length>0?(0,nn.jsxs)("div",{className:"lumiverse-presets-inventory",children:[(0,nn.jsxs)("div",{className:"lumiverse-presets-inventory-header",children:[(0,nn.jsxs)("span",{className:"lumiverse-presets-inventory-label",children:[(0,nn.jsx)(et,{size:12,strokeWidth:2}),"Imported Presets"]}),f>0&&(0,nn.jsxs)("span",{className:"lumiverse-presets-inventory-updates",children:[(0,nn.jsx)(At,{size:11,strokeWidth:2}),f," update",1!==f?"s":""]})]}),(0,nn.jsx)("div",{className:"lumiverse-presets-inventory-list",children:g.map(e=>(0,nn.jsxs)("div",{className:at("lumiverse-presets-inventory-item",e.hasUpdate&&"has-update"),children:[(0,nn.jsx)("div",{className:"lumiverse-presets-inventory-item-icon",children:e.hasUpdate?(0,nn.jsx)(At,{size:14,strokeWidth:1.5}):(0,nn.jsx)(Rt,{size:14,strokeWidth:1.5})}),(0,nn.jsxs)("div",{className:"lumiverse-presets-inventory-item-info",children:[(0,nn.jsx)("span",{className:"lumiverse-presets-inventory-item-name",children:e.name}),(0,nn.jsx)("span",{className:"lumiverse-presets-inventory-item-version",children:e.hasUpdate?(0,nn.jsxs)(nn.Fragment,{children:[sr(e.version)," → ",e.latestVersionName]}):(0,nn.jsxs)(nn.Fragment,{children:["v",sr(e.version)]})})]}),e.hasUpdate&&(0,nn.jsx)("span",{className:"lumiverse-presets-inventory-item-badge",children:"Update"})]},e.slug))})]}):(0,nn.jsxs)("div",{className:"lumiverse-presets-empty-state",children:[(0,nn.jsx)(Bt,{size:20,strokeWidth:1.5}),(0,nn.jsx)("span",{children:"No presets imported yet"})]}),(v||h)&&(0,nn.jsxs)("div",{className:"lumiverse-presets-reasoning-status",children:[v&&(0,nn.jsxs)("div",{className:"lumiverse-presets-reasoning-status-item",children:[(0,nn.jsx)(_t,{size:12,strokeWidth:2}),(0,nn.jsx)("span",{children:"CoT:"}),(0,nn.jsx)("code",{children:v})]}),h&&(0,nn.jsxs)("div",{className:"lumiverse-presets-reasoning-status-item",children:[(0,nn.jsx)(Ut,{size:12,strokeWidth:2}),(0,nn.jsx)("span",{children:"Bias:"}),(0,nn.jsx)("code",{children:h})]})]}),(0,nn.jsxs)("div",{className:"lumia-chat-presets-actions",style:{display:"flex",gap:"8px",flexDirection:"column"},children:[(0,nn.jsxs)("button",{className:"lumia-btn lumia-btn-primary lumia-btn-full",onClick:m,type:"button",children:[(0,nn.jsx)(Ft,{size:14,strokeWidth:2}),f>0?"Configure (".concat(f," update").concat(1!==f?"s":"",")"):"Download & Configure"]}),(0,nn.jsxs)("button",{className:"lumia-btn lumia-btn-secondary lumia-btn-full",onClick:()=>e.openModal("presetEditor"),type:"button",children:[(0,nn.jsx)(nt,{size:14,strokeWidth:2}),"Preset Editor"]})]}),n&&(0,nn.jsx)(Lr,{onClose:p,availableUpdates:c,onUpdateComplete:()=>{i(lr()),cr().then(u)}})]})}function Lr(e){let{onClose:n,availableUpdates:t=[],onUpdateComplete:r}=e;const[i,a]=(0,Je.useState)(null),[o,s]=(0,Je.useState)(!1),[l,c]=(0,Je.useState)(null),[u,d]=(0,Je.useState)(null),[m,p]=(0,Je.useState)(null),{reasoningSettings:g,startReplyWith:v,apiReasoning:h,postProcessing:f,handleApplyReasoningPreset:b,handleStartReplyWithChange:x,handleReasoningToggle:y,handleAPIReasoningToggle:k,handleReasoningEffortChange:w,handlePostProcessingChange:j,REASONING_EFFORT_LEVELS:S,POST_PROCESSING_OPTIONS:C}=Sr(),N=(0,Je.useRef)(null),P=(0,Je.useRef)(null),E=(0,Je.useCallback)(function(e){var n;b(e,arguments.length>1&&void 0!==arguments[1]&&arguments[1]),null===(n=toastr)||void 0===n||n.success("Applied ".concat(e," reasoning settings"),"Reasoning Updated")},[b]);(0,Je.useEffect)(()=>{const e=e=>{"Escape"===e.key&&n()};return document.addEventListener("keydown",e),document.body.style.overflow="hidden",()=>{document.removeEventListener("keydown",e),document.body.style.overflow=""}},[n]);const O=(0,Je.useCallback)(async()=>{s(!0),c(null);try{const e=await async function(){try{const e=await fetch("".concat(Zt,"/api/download/chat-presets"));if(!e.ok)throw new Error("HTTP ".concat(e.status,": ").concat(e.statusText));const n=await e.json();if(!n.success)throw new Error(n.error||"Unknown API error");return n}catch(e){throw console.error("[".concat(Xt,"] Failed to fetch presets:"),e),e}}();a(e.presets||[])}catch(e){c(e.message),console.error("[ChatPresets] Failed to load:",e)}finally{s(!1)}},[]),M=(0,Je.useCallback)(async(e,n,t)=>{p("".concat(e,"-").concat(n));try{const o=await gr(e,n,{activate:!0});var i,a;if(o.success)null===(i=toastr)||void 0===i||i.success("Imported: ".concat(t||n),"Preset Added"),null==r||r();else null===(a=toastr)||void 0===a||a.error(o.message,"Import Failed")}catch(e){var o;null===(o=toastr)||void 0===o||o.error(e.message,"Download Failed")}finally{p(null)}},[r]),z=(0,Je.useCallback)(e=>{e.target===e.currentTarget&&n()},[n]),T=(0,Je.useCallback)(e=>{e.stopPropagation()},[]);return(0,Dt.createPortal)((0,nn.jsx)("div",{className:"lumiverse-modal-backdrop",onClick:z,onMouseDown:T,onMouseUp:T,children:(0,nn.jsxs)("div",{ref:N,className:"lumiverse-modal lumiverse-presets-modal",onClick:T,role:"dialog","aria-modal":"true",children:[(0,nn.jsxs)("div",{className:"lumiverse-presets-modal-header",children:[(0,nn.jsxs)("div",{className:"lumiverse-presets-modal-header-info",children:[(0,nn.jsx)("span",{className:"lumiverse-presets-modal-header-icon",children:(0,nn.jsx)(Bt,{size:22,strokeWidth:1.5})}),(0,nn.jsxs)("div",{className:"lumiverse-presets-modal-header-text",children:[(0,nn.jsx)("h3",{className:"lumiverse-presets-modal-title",children:"Chat Presets"}),(0,nn.jsx)("p",{className:"lumiverse-presets-modal-subtitle",children:"Download presets from Lucid.cards & configure reasoning"})]})]}),(0,nn.jsx)("button",{className:"lumiverse-presets-modal-close",onClick:n,title:"Close",type:"button",children:(0,nn.jsx)(Wt,{size:18,strokeWidth:2})})]}),(0,nn.jsxs)("div",{className:"lumiverse-presets-modal-content",ref:P,children:[(0,nn.jsxs)("div",{className:"lumiverse-presets-section",children:[(0,nn.jsxs)("div",{className:"lumiverse-presets-section-header",children:[(0,nn.jsxs)("div",{className:"lumiverse-presets-section-title",children:[(0,nn.jsx)(rt,{size:14,strokeWidth:2}),(0,nn.jsx)("span",{children:"Download Presets"})]}),(0,nn.jsx)("button",{className:at("lumiverse-presets-refresh",o&&"is-loading"),onClick:O,disabled:o,title:"Refresh preset list",type:"button",children:(0,nn.jsx)(Ht,{size:14,strokeWidth:2})})]}),!i&&!o&&!l&&(0,nn.jsxs)("div",{className:"lumiverse-presets-empty",children:[(0,nn.jsx)("div",{className:"lumiverse-presets-empty-icon",children:(0,nn.jsx)(et,{size:28,strokeWidth:1})}),(0,nn.jsx)("span",{className:"lumiverse-presets-empty-text",children:"Browse curated Chat Completion presets"}),(0,nn.jsxs)("button",{className:"lumiverse-presets-empty-btn",onClick:O,type:"button",children:[(0,nn.jsx)(Ht,{size:14,strokeWidth:2}),"Load Presets"]})]}),o&&(0,nn.jsxs)("div",{className:"lumiverse-presets-loading",children:[(0,nn.jsx)("div",{className:"lumiverse-presets-loading-spinner",children:(0,nn.jsx)(Vt,{size:22,strokeWidth:1.5})}),(0,nn.jsx)("span",{children:"Fetching presets..."})]}),l&&(0,nn.jsxs)("div",{className:"lumiverse-presets-error",children:[(0,nn.jsx)(qt,{size:16,strokeWidth:1.5}),(0,nn.jsx)("span",{children:l}),(0,nn.jsx)("button",{onClick:O,type:"button",children:"Retry"})]}),i&&i.length>0&&(0,nn.jsx)("div",{className:"lumiverse-presets-list",children:i.map((e,n)=>{const r=t.find(n=>n.slug===e.slug);return(0,nn.jsx)(Ar,{preset:e,isExpanded:u===e.slug,onToggle:()=>d(u===e.slug?null:e.slug),onDownload:M,downloadingVersion:m,animationIndex:n,updateAvailable:r},e.slug)})})]}),(0,nn.jsxs)("div",{className:"lumiverse-presets-section",children:[(0,nn.jsx)("div",{className:"lumiverse-presets-section-header",children:(0,nn.jsxs)("div",{className:"lumiverse-presets-section-title",children:[(0,nn.jsx)(_t,{size:14,strokeWidth:2}),(0,nn.jsx)("span",{children:"Reasoning / Chain of Thought"})]})}),(0,nn.jsx)(Or,{reasoningSettings:g,startReplyWith:v,apiReasoning:h,postProcessing:f,onApplyReasoningPreset:E,onStartReplyWithChange:x,onReasoningToggle:y,onAPIReasoningToggle:k,onReasoningEffortChange:w,onPostProcessingChange:j,effortLevels:S,postProcessingOptions:C})]})]}),(0,nn.jsx)("div",{className:"lumiverse-presets-modal-footer",children:(0,nn.jsx)("button",{className:"lumiverse-presets-modal-btn lumiverse-presets-modal-btn--primary",onClick:n,type:"button",children:"Done"})})]})}),document.body)}const Dr=3;function Ar(e){let{preset:n,isExpanded:t,onToggle:r,onDownload:i,downloadingVersion:a,animationIndex:o,updateAvailable:s}=e;const[l,c]=(0,Je.useState)(!1),u=(0,Je.useMemo)(()=>{var e,t;const r=[];return null!==(e=n.versions)&&void 0!==e&&e.standard&&n.versions.standard.forEach(e=>{r.push(zr(zr({},e),{},{isProlix:!1}))}),null!==(t=n.versions)&&void 0!==t&&t.prolix&&n.versions.prolix.forEach(e=>{r.push(zr(zr({},e),{},{isProlix:!0}))}),r.sort((e,n)=>e.isLatest&&!n.isLatest?-1:!e.isLatest&&n.isLatest?1:n.name.localeCompare(e.name,void 0,{numeric:!0}))},[n.versions]),d=(0,Je.useMemo)(()=>l||u.length<=Dr?u:u.slice(0,Dr),[u,l]),m=u.length-Dr,p=m>0&&!l,g={"--card-delay":"".concat(Math.min(40*o,250),"ms")};(0,Je.useEffect)(()=>{t||c(!1)},[t]);const v=(0,Je.useCallback)(e=>{e.target.closest("button")||r()},[r]),h=(0,Je.useCallback)(e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),r())},[r]);return(0,nn.jsxs)("div",{className:at("lumiverse-preset-card",t&&"is-expanded",s&&"has-update"),style:g,onClick:v,onKeyDown:h,role:"button",tabIndex:0,"aria-expanded":t,"aria-label":"".concat(n.name," preset").concat(s?" - update available":""),children:[(0,nn.jsxs)("div",{className:"lumiverse-preset-card-header",children:[(0,nn.jsx)("div",{className:at("lumiverse-preset-card-icon",s&&"has-update"),children:s?(0,nn.jsx)(At,{size:16,strokeWidth:1.5}):(0,nn.jsx)(Rt,{size:16,strokeWidth:1.5})}),(0,nn.jsxs)("div",{className:"lumiverse-preset-card-info",children:[(0,nn.jsxs)("span",{className:"lumiverse-preset-card-name",children:[n.name,s&&(0,nn.jsx)("span",{className:"lumiverse-preset-card-update-badge",children:"Update"})]}),(0,nn.jsx)("span",{className:"lumiverse-preset-card-meta",children:s?(0,nn.jsxs)(nn.Fragment,{children:[(0,nn.jsx)(At,{size:10,strokeWidth:2}),sr(s.currentVersion)," → ",s.latestVersionName]}):(0,nn.jsxs)(nn.Fragment,{children:[(0,nn.jsx)($t,{size:10,strokeWidth:2}),n.totalVersions," version",1!==n.totalVersions?"s":""]})})]}),(0,nn.jsxs)("div",{className:"lumiverse-preset-card-actions",children:[(0,nn.jsx)("button",{className:"lumiverse-preset-card-download",onClick:e=>{var t;e.stopPropagation(),i(n.slug,"latest",null===(t=n.latestVersion)||void 0===t?void 0:t.name)},disabled:a==="".concat(n.slug,"-latest"),title:"Download latest version",type:"button",children:a==="".concat(n.slug,"-latest")?(0,nn.jsx)(Vt,{size:14,strokeWidth:2,className:"lumiverse-spin"}):(0,nn.jsx)(rt,{size:14,strokeWidth:2})}),(0,nn.jsx)(st,{size:14,strokeWidth:2,className:"lumiverse-preset-card-chevron"})]})]}),(0,nn.jsx)("div",{className:at("lumiverse-preset-card-versions",t&&"is-expanded"),role:"region","aria-label":"".concat(n.name," versions"),children:(0,nn.jsxs)("div",{className:"lumiverse-preset-card-versions-inner",children:[d.map(e=>{const t="".concat(n.slug,"-").concat(e.slug),r=a===t;return(0,nn.jsxs)("div",{className:at("lumiverse-preset-version",e.isProlix&&"is-prolix",e.isLatest&&"is-latest"),children:[(0,nn.jsxs)("div",{className:"lumiverse-preset-version-info",children:[(0,nn.jsx)("span",{className:"lumiverse-preset-version-name",children:e.name}),(0,nn.jsxs)("div",{className:"lumiverse-preset-version-badges",children:[e.isLatest&&(0,nn.jsx)("span",{className:"lumiverse-preset-version-badge is-latest",children:"Latest"}),e.isProlix&&(0,nn.jsx)("span",{className:"lumiverse-preset-version-badge is-prolix",children:"Prolix"})]})]}),(0,nn.jsx)("button",{className:"lumiverse-preset-version-download",onClick:t=>{t.stopPropagation(),i(n.slug,e.slug,e.name)},disabled:r,type:"button","aria-label":"Download ".concat(e.name),children:r?(0,nn.jsx)(Vt,{size:12,strokeWidth:2,className:"lumiverse-spin"}):(0,nn.jsxs)(nn.Fragment,{children:[(0,nn.jsx)(rt,{size:12,strokeWidth:2}),(0,nn.jsx)("span",{children:"Add"})]})})]},e.slug)}),p&&(0,nn.jsxs)("button",{className:"lumiverse-preset-versions-showmore",onClick:e=>{e.stopPropagation(),c(!0)},type:"button",children:[(0,nn.jsx)(ot,{size:12,strokeWidth:2}),(0,nn.jsxs)("span",{children:["Show ",m," more version",1!==m?"s":""]})]})]})})]})}const Rr=Jn("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),Br=Jn("link-2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]),_r=Jn("message-square",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]]),Ur=Jn("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),Fr=Jn("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),Wr=Jn("link-2-off",[["path",{d:"M9 17H7A5 5 0 0 1 7 7",key:"10o201"}],["path",{d:"M15 7h2a5 5 0 0 1 4 8",key:"1d3206"}],["line",{x1:"8",x2:"12",y1:"12",y2:"12",key:"rvw6j4"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);function Hr(){const[e,n]=(0,Je.useState)(()=>Fe()),[t,i]=(0,Je.useState)(()=>Ge()),[a,o]=(0,Je.useState)([]);(0,Je.useEffect)(()=>{Xe(e=>{n(e||Fe())}),o(Ae.getAvailablePresets());const e=setInterval(()=>{i(Ge())},2e3);return()=>{Xe(null),clearInterval(e)}},[]);const s=(0,Je.useCallback)(()=>{o(Ae.getAvailablePresets())},[]),l=(0,Je.useMemo)(()=>Qe(),[e,t]),c=(0,Je.useCallback)(e=>{const r=t.characterAvatar;return r?(He(r,e),n(Fe()),!0):(console.warn("[usePresetBindings] No current character to bind"),!1)},[t.characterAvatar]),u=(0,Je.useCallback)(e=>{const r=t.chatId;return r?(Ve(r,e),n(Fe()),!0):(console.warn("[usePresetBindings] No current chat to bind"),!1)},[t.chatId]),d=(0,Je.useCallback)(e=>{He(e,null),n(Fe())},[]),m=(0,Je.useCallback)(e=>{Ve(e,null),n(Fe())},[]),p=(0,Je.useMemo)(()=>function(){const e=Fe(),n=(0,r.SD)(),t=[];for(const[r,i]of Object.entries(e.characters)){let e=r;if(null!=n&&n.characters){const t=n.characters.find(e=>e.avatar===r);null!=t&&t.name&&(e=t.name)}t.push({type:"character",id:r,displayName:e,presetName:i})}for(const[n,r]of Object.entries(e.chats))t.push({type:"chat",id:n,displayName:n,presetName:r});return t}(),[e]),g=(0,Je.useMemo)(()=>t.characterAvatar?qe(t.characterAvatar):null,[t.characterAvatar,e]),v=(0,Je.useMemo)(()=>t.chatId?$e(t.chatId):null,[t.chatId,e]);return{bindings:e,contextInfo:t,availablePresets:a,currentBinding:l,allBindings:p,currentCharacterBinding:g,currentChatBinding:v,bindCurrentCharacter:c,bindCurrentChat:u,removeCharacterBinding:d,removeChatBinding:m,refreshPresets:s,setCharacterBinding:He,setChatBinding:Ve}}const Vr=wn,qr=()=>Vr.getState().activePresetName||"";function $r(){const[e,n]=(0,Je.useState)(!1),{contextInfo:t,currentBinding:r,currentCharacterBinding:i,currentChatBinding:a,allBindings:o}=Hr(),s=o.length>0,l=t.characterAvatar||t.chatId,c=(0,Je.useMemo)(()=>{if(!r.presetName)return null;const e="chat"===r.bindingType?"Chat":"Character";return"".concat(e,": ").concat(r.presetName)},[r]);return(0,nn.jsxs)(nn.Fragment,{children:[(0,nn.jsx)("div",{className:"lumiverse-bindings-status",children:l?(0,nn.jsxs)(nn.Fragment,{children:[(0,nn.jsxs)("div",{className:"lumiverse-bindings-context",children:[t.characterName&&(0,nn.jsxs)("div",{className:"lumiverse-bindings-context-item",children:[(0,nn.jsx)(Rr,{size:12,strokeWidth:2}),(0,nn.jsx)("span",{className:"lumiverse-bindings-context-label",children:"Character:"}),(0,nn.jsx)("span",{className:"lumiverse-bindings-context-value",children:t.characterName}),i&&(0,nn.jsxs)("span",{className:"lumiverse-bindings-context-bound",children:[(0,nn.jsx)(Br,{size:10}),i]})]}),t.chatId&&(0,nn.jsxs)("div",{className:"lumiverse-bindings-context-item",children:[(0,nn.jsx)(_r,{size:12,strokeWidth:2}),(0,nn.jsx)("span",{className:"lumiverse-bindings-context-label",children:"Chat:"}),(0,nn.jsx)("span",{className:"lumiverse-bindings-context-value lumiverse-bindings-context-value--mono",children:t.chatId.length>25?t.chatId.slice(0,25)+"...":t.chatId}),a&&(0,nn.jsxs)("span",{className:"lumiverse-bindings-context-bound",children:[(0,nn.jsx)(Br,{size:10}),a]})]})]}),c&&(0,nn.jsxs)("div",{className:"lumiverse-bindings-active",children:[(0,nn.jsx)(Br,{size:12,strokeWidth:2}),(0,nn.jsxs)("span",{children:["Active: ",c]})]})]}):(0,nn.jsxs)("div",{className:"lumiverse-bindings-empty-context",children:[(0,nn.jsx)(Rr,{size:16,strokeWidth:1.5}),(0,nn.jsx)("span",{children:"Select a character to manage bindings"})]})}),s&&(0,nn.jsx)("div",{className:"lumiverse-bindings-summary",children:(0,nn.jsxs)("span",{className:"lumiverse-bindings-summary-label",children:[(0,nn.jsx)(Br,{size:11,strokeWidth:2}),o.length," binding",1!==o.length?"s":""," configured"]})}),(0,nn.jsxs)("button",{className:"lumia-btn lumia-btn-secondary lumia-btn-full",onClick:()=>n(!0),type:"button",children:[(0,nn.jsx)(Ft,{size:14,strokeWidth:2}),"Manage Bindings"]}),e&&(0,nn.jsx)(Yr,{onClose:()=>n(!1)})]})}function Yr(e){let{onClose:n}=e;const{contextInfo:t,availablePresets:r,allBindings:i,currentCharacterBinding:a,currentChatBinding:o,bindCurrentCharacter:s,bindCurrentChat:l,removeCharacterBinding:c,removeChatBinding:u,refreshPresets:d}=Hr(),m=(0,Je.useSyncExternalStore)(Vr.subscribe,qr,qr),[p,g]=(0,Je.useState)(()=>a||o||m||""),[v,h]=(0,Je.useState)("character");Je.useEffect(()=>{d()},[d]),Je.useEffect(()=>{const e=e=>{"Escape"===e.key&&n()};return document.addEventListener("keydown",e),document.body.style.overflow="hidden",()=>{document.removeEventListener("keydown",e),document.body.style.overflow=""}},[n]);const f=(0,Je.useCallback)(()=>{var e;if(!p)return void(null===(e=toastr)||void 0===e||e.warning("Select a preset first"));let n=!1;var r,i,a;"character"===v?(n=s(p),n&&(null===(r=toastr)||void 0===r||r.success('Bound "'.concat(t.characterName,'" to "').concat(p,'"')))):(n=l(p),n&&(null===(i=toastr)||void 0===i||i.success('Bound current chat to "'.concat(p,'"'))));n?g(""):null===(a=toastr)||void 0===a||a.error("No active context to bind")},[p,v,s,l,t.characterName]),b=(0,Je.useCallback)((e,n)=>{var t,r;"character"===e?(c(n),null===(t=toastr)||void 0===t||t.info("Character binding removed")):(u(n),null===(r=toastr)||void 0===r||r.info("Chat binding removed"))},[c,u]),x=(0,Je.useCallback)(e=>{e.target===e.currentTarget&&n()},[n]),y=(0,Je.useCallback)(e=>{e.stopPropagation()},[]),k=t.characterAvatar||t.chatId;return(0,Dt.createPortal)((0,nn.jsx)("div",{className:"lumiverse-modal-backdrop",onClick:x,onMouseDown:y,onMouseUp:y,children:(0,nn.jsxs)("div",{className:"lumiverse-modal lumiverse-bindings-modal",onClick:y,role:"dialog","aria-modal":"true",children:[(0,nn.jsxs)("div",{className:"lumiverse-bindings-modal-header",children:[(0,nn.jsxs)("div",{className:"lumiverse-bindings-modal-header-info",children:[(0,nn.jsx)("span",{className:"lumiverse-bindings-modal-header-icon",children:(0,nn.jsx)(Br,{size:22,strokeWidth:1.5})}),(0,nn.jsxs)("div",{className:"lumiverse-bindings-modal-header-text",children:[(0,nn.jsx)("h3",{className:"lumiverse-bindings-modal-title",children:"Preset Bindings"}),(0,nn.jsx)("p",{className:"lumiverse-bindings-modal-subtitle",children:"Auto-switch presets when changing characters or chats"})]})]}),(0,nn.jsx)("button",{className:"lumiverse-bindings-modal-close",onClick:n,title:"Close",type:"button",children:(0,nn.jsx)(Wt,{size:18,strokeWidth:2})})]}),(0,nn.jsxs)("div",{className:"lumiverse-bindings-modal-content",children:[(0,nn.jsxs)("div",{className:"lumiverse-bindings-section",children:[(0,nn.jsxs)("div",{className:"lumiverse-bindings-section-header",children:[(0,nn.jsx)(Ur,{size:14,strokeWidth:2}),(0,nn.jsx)("span",{children:"Create Binding"})]}),k?(0,nn.jsxs)("div",{className:"lumiverse-bindings-create",children:[(0,nn.jsxs)("div",{className:"lumiverse-bindings-type-toggle",children:[(0,nn.jsxs)("button",{className:at("lumiverse-bindings-type-btn","character"===v&&"is-active"),onClick:()=>h("character"),disabled:!t.characterAvatar,type:"button",children:[(0,nn.jsx)(Rr,{size:14,strokeWidth:2}),"Character"]}),(0,nn.jsxs)("button",{className:at("lumiverse-bindings-type-btn","chat"===v&&"is-active"),onClick:()=>h("chat"),disabled:!t.chatId,type:"button",children:[(0,nn.jsx)(_r,{size:14,strokeWidth:2}),"This Chat"]})]}),(0,nn.jsx)("div",{className:"lumiverse-bindings-create-context",children:"character"===v?(0,nn.jsxs)("span",{children:[(0,nn.jsx)(Rr,{size:12}),t.characterName||t.characterAvatar||"No character",a&&(0,nn.jsxs)("span",{className:"lumiverse-bindings-create-existing",children:["(currently: ",a,")"]})]}):(0,nn.jsxs)("span",{children:[(0,nn.jsx)(_r,{size:12}),t.chatId?t.chatId.length>30?t.chatId.slice(0,30)+"...":t.chatId:"No chat",o&&(0,nn.jsxs)("span",{className:"lumiverse-bindings-create-existing",children:["(currently: ",o,")"]})]})}),(0,nn.jsxs)("div",{className:"lumiverse-bindings-create-row",children:[(0,nn.jsxs)("select",{className:"lumiverse-bindings-select",value:p,onChange:e=>g(e.target.value),children:[(0,nn.jsx)("option",{value:"",children:"Select a preset..."}),r.map(e=>(0,nn.jsx)("option",{value:e,children:e},e))]}),(0,nn.jsxs)("button",{className:"lumia-btn lumia-btn-primary",onClick:f,disabled:!p,type:"button",children:[(0,nn.jsx)(Br,{size:14,strokeWidth:2}),"Bind"]})]}),0===r.length&&(0,nn.jsxs)("div",{className:"lumiverse-bindings-no-presets",children:[(0,nn.jsx)(Fr,{size:14,strokeWidth:2}),(0,nn.jsx)("span",{children:"No presets available. Create one in SillyTavern first."})]})]}):(0,nn.jsxs)("div",{className:"lumiverse-bindings-no-context",children:[(0,nn.jsx)(Rr,{size:20,strokeWidth:1.5}),(0,nn.jsx)("span",{children:"Select a character to create bindings"})]})]}),(0,nn.jsxs)("div",{className:"lumiverse-bindings-section",children:[(0,nn.jsxs)("div",{className:"lumiverse-bindings-section-header",children:[(0,nn.jsx)(Br,{size:14,strokeWidth:2}),(0,nn.jsxs)("span",{children:["Active Bindings (",i.length,")"]})]}),i.length>0?(0,nn.jsx)("div",{className:"lumiverse-bindings-list",children:i.map(e=>(0,nn.jsxs)("div",{className:"lumiverse-bindings-list-item",children:[(0,nn.jsx)("div",{className:"lumiverse-bindings-list-item-icon",children:"character"===e.type?(0,nn.jsx)(Rr,{size:14,strokeWidth:1.5}):(0,nn.jsx)(_r,{size:14,strokeWidth:1.5})}),(0,nn.jsxs)("div",{className:"lumiverse-bindings-list-item-info",children:[(0,nn.jsx)("span",{className:"lumiverse-bindings-list-item-name",children:e.displayName}),(0,nn.jsx)("span",{className:"lumiverse-bindings-list-item-type",children:"character"===e.type?"Character":"Chat"})]}),(0,nn.jsxs)("div",{className:"lumiverse-bindings-list-item-preset",children:[(0,nn.jsx)(Rt,{size:12,strokeWidth:1.5}),e.presetName]}),(0,nn.jsx)("button",{className:"lumiverse-bindings-list-item-remove",onClick:()=>b(e.type,e.id),title:"Remove binding",type:"button",children:(0,nn.jsx)(tt,{size:14,strokeWidth:2})})]},"".concat(e.type,"-").concat(e.id)))}):(0,nn.jsxs)("div",{className:"lumiverse-bindings-empty",children:[(0,nn.jsx)(Wr,{size:20,strokeWidth:1.5}),(0,nn.jsx)("span",{children:"No bindings configured"}),(0,nn.jsx)("span",{className:"lumiverse-bindings-empty-hint",children:"Bindings auto-switch presets when you change characters or chats"})]})]}),(0,nn.jsxs)("div",{className:"lumiverse-bindings-info",children:[(0,nn.jsx)("div",{className:"lumiverse-bindings-info-title",children:"How it works"}),(0,nn.jsxs)("ul",{className:"lumiverse-bindings-info-list",children:[(0,nn.jsxs)("li",{children:[(0,nn.jsx)("strong",{children:"Chat bindings"})," have higher priority than character bindings"]}),(0,nn.jsx)("li",{children:"When you switch to a character/chat with a binding, the preset auto-switches"}),(0,nn.jsx)("li",{children:"If a bound preset is deleted, the binding is automatically removed"})]})]})]}),(0,nn.jsx)("div",{className:"lumiverse-bindings-modal-footer",children:(0,nn.jsx)("button",{className:"lumiverse-bindings-modal-btn lumiverse-bindings-modal-btn--primary",onClick:n,type:"button",children:"Done"})})]})}),document.body)}const Kr=(0,Je.createContext)({});function Qr(e){const n=(0,Je.useRef)(null);return null===n.current&&(n.current=e()),n.current}const Gr=(0,Je.createContext)(null),Xr=(0,Je.createContext)({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"});class Zr extends Je.Component{getSnapshotBeforeUpdate(e){const n=this.props.childRef.current;if(n&&e.isPresent&&!this.props.isPresent){const e=this.props.sizeRef.current;e.height=n.offsetHeight||0,e.width=n.offsetWidth||0,e.top=n.offsetTop,e.left=n.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function Jr({children:e,isPresent:n}){const t=(0,Je.useId)(),r=(0,Je.useRef)(null),i=(0,Je.useRef)({width:0,height:0,top:0,left:0}),{nonce:a}=(0,Je.useContext)(Xr);return(0,Je.useInsertionEffect)(()=>{const{width:e,height:o,top:s,left:l}=i.current;if(n||!r.current||!e||!o)return;r.current.dataset.motionPopId=t;const c=document.createElement("style");return a&&(c.nonce=a),document.head.appendChild(c),c.sheet&&c.sheet.insertRule(`\n          [data-motion-pop-id="${t}"] {\n            position: absolute !important;\n            width: ${e}px !important;\n            height: ${o}px !important;\n            top: ${s}px !important;\n            left: ${l}px !important;\n          }\n        `),()=>{document.head.removeChild(c)}},[n]),(0,nn.jsx)(Zr,{isPresent:n,childRef:r,sizeRef:i,children:Je.cloneElement(e,{ref:r})})}const ei=({children:e,initial:n,isPresent:t,onExitComplete:r,custom:i,presenceAffectsLayout:a,mode:o})=>{const s=Qr(ni),l=(0,Je.useId)(),c=(0,Je.useCallback)(e=>{s.set(e,!0);for(const e of s.values())if(!e)return;r&&r()},[s,r]),u=(0,Je.useMemo)(()=>({id:l,initial:n,isPresent:t,custom:i,onExitComplete:c,register:e=>(s.set(e,!1),()=>s.delete(e))}),a?[Math.random(),c]:[t,c]);return(0,Je.useMemo)(()=>{s.forEach((e,n)=>s.set(n,!1))},[t]),Je.useEffect(()=>{!t&&!s.size&&r&&r()},[t]),"popLayout"===o&&(e=(0,nn.jsx)(Jr,{isPresent:t,children:e})),(0,nn.jsx)(Gr.Provider,{value:u,children:e})};function ni(){return new Map}function ti(e=!0){const n=(0,Je.useContext)(Gr);if(null===n)return[!0,null];const{isPresent:t,onExitComplete:r,register:i}=n,a=(0,Je.useId)();(0,Je.useEffect)(()=>{e&&i(a)},[e]);const o=(0,Je.useCallback)(()=>e&&r&&r(a),[a,r,e]);return!t&&r?[!1,o]:[!0]}const ri=e=>e.key||"";function ii(e){const n=[];return Je.Children.forEach(e,e=>{(0,Je.isValidElement)(e)&&n.push(e)}),n}const ai="undefined"!=typeof window,oi=ai?Je.useLayoutEffect:Je.useEffect,si=({children:e,custom:n,initial:t=!0,onExitComplete:r,presenceAffectsLayout:i=!0,mode:a="sync",propagate:o=!1})=>{const[s,l]=ti(o),c=(0,Je.useMemo)(()=>ii(e),[e]),u=o&&!s?[]:c.map(ri),d=(0,Je.useRef)(!0),m=(0,Je.useRef)(c),p=Qr(()=>new Map),[g,v]=(0,Je.useState)(c),[h,f]=(0,Je.useState)(c);oi(()=>{d.current=!1,m.current=c;for(let e=0;e<h.length;e++){const n=ri(h[e]);u.includes(n)?p.delete(n):!0!==p.get(n)&&p.set(n,!1)}},[h,u.length,u.join("-")]);const b=[];if(c!==g){let e=[...c];for(let n=0;n<h.length;n++){const t=h[n],r=ri(t);u.includes(r)||(e.splice(n,0,t),b.push(t))}return"wait"===a&&b.length&&(e=b),f(ii(e)),void v(c)}const{forceRender:x}=(0,Je.useContext)(Kr);return(0,nn.jsx)(nn.Fragment,{children:h.map(e=>{const g=ri(e),v=!(o&&!s)&&(c===h||u.includes(g));return(0,nn.jsx)(ei,{isPresent:v,initial:!(d.current&&!t)&&void 0,custom:v?void 0:n,presenceAffectsLayout:i,mode:a,onExitComplete:v?void 0:()=>{if(!p.has(g))return;p.set(g,!0);let e=!0;p.forEach(n=>{n||(e=!1)}),e&&(null==x||x(),f(m.current),o&&(null==l||l()),r&&r())},children:e},g)})})};function li(e){if("undefined"==typeof Proxy)return e;const n=new Map;return new Proxy((...n)=>e(...n),{get:(t,r)=>"create"===r?e:(n.has(r)||n.set(r,e(r)),n.get(r))})}function ci(e){return null!==e&&"object"==typeof e&&"function"==typeof e.start}const ui=e=>Array.isArray(e);function di(e,n){if(!Array.isArray(n))return!1;const t=n.length;if(t!==e.length)return!1;for(let r=0;r<t;r++)if(n[r]!==e[r])return!1;return!0}function mi(e){return"string"==typeof e||Array.isArray(e)}function pi(e){const n=[{},{}];return null==e||e.values.forEach((e,t)=>{n[0][t]=e.get(),n[1][t]=e.getVelocity()}),n}function gi(e,n,t,r){if("function"==typeof n){const[i,a]=pi(r);n=n(void 0!==t?t:e.custom,i,a)}if("string"==typeof n&&(n=e.variants&&e.variants[n]),"function"==typeof n){const[i,a]=pi(r);n=n(void 0!==t?t:e.custom,i,a)}return n}function vi(e,n,t){const r=e.getProps();return gi(r,n,void 0!==t?t:r.custom,e)}const hi=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],fi=["initial",...hi];function bi(e,n){return e?e[n]||e.default||e:void 0}const xi=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],yi=new Set(xi),ki=new Set(["width","height","top","left","right","bottom",...xi]),wi=e=>ui(e)?e[e.length-1]||0:e,ji=!1,Si=!1,Ci=e=>e;const Ni=["read","resolveKeyframes","update","preRender","render","postRender"];function Pi(e,n){let t=!1,r=!0;const i={delta:0,timestamp:0,isProcessing:!1},a=()=>t=!0,o=Ni.reduce((e,n)=>(e[n]=function(e){let n=new Set,t=new Set,r=!1,i=!1;const a=new WeakSet;let o={delta:0,timestamp:0,isProcessing:!1};function s(n){a.has(n)&&(l.schedule(n),e()),n(o)}const l={schedule:(e,i=!1,o=!1)=>{const s=o&&r?n:t;return i&&a.add(e),s.has(e)||s.add(e),e},cancel:e=>{t.delete(e),a.delete(e)},process:e=>{o=e,r?i=!0:(r=!0,[n,t]=[t,n],n.forEach(s),n.clear(),r=!1,i&&(i=!1,l.process(e)))}};return l}(a),e),{}),{read:s,resolveKeyframes:l,update:c,preRender:u,render:d,postRender:m}=o,p=()=>{const a=Si?i.timestamp:performance.now();t=!1,i.delta=r?1e3/60:Math.max(Math.min(a-i.timestamp,40),1),i.timestamp=a,i.isProcessing=!0,s.process(i),l.process(i),c.process(i),u.process(i),d.process(i),m.process(i),i.isProcessing=!1,t&&n&&(r=!1,e(p))},g=Ni.reduce((n,a)=>{const s=o[a];return n[a]=(n,a=!1,o=!1)=>(t||(t=!0,r=!0,i.isProcessing||e(p)),s.schedule(n,a,o)),n},{});return{schedule:g,cancel:e=>{for(let n=0;n<Ni.length;n++)o[Ni[n]].cancel(e)},state:i,steps:o}}const{schedule:Ei,cancel:Oi,state:Mi,steps:zi}=Pi("undefined"!=typeof requestAnimationFrame?requestAnimationFrame:Ci,!0);let Ti;function Ii(){Ti=void 0}const Li={now:()=>(void 0===Ti&&Li.set(Mi.isProcessing||Si?Mi.timestamp:performance.now()),Ti),set:e=>{Ti=e,queueMicrotask(Ii)}};function Di(e,n){-1===e.indexOf(n)&&e.push(n)}function Ai(e,n){const t=e.indexOf(n);t>-1&&e.splice(t,1)}class Ri{constructor(){this.subscriptions=[]}add(e){return Di(this.subscriptions,e),()=>Ai(this.subscriptions,e)}notify(e,n,t){const r=this.subscriptions.length;if(r)if(1===r)this.subscriptions[0](e,n,t);else for(let i=0;i<r;i++){const r=this.subscriptions[i];r&&r(e,n,t)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function Bi(e,n){return n?e*(1e3/n):0}const _i={current:void 0};class Ui{constructor(e,n={}){this.version="11.18.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(e,n=!0)=>{const t=Li.now();this.updatedAt!==t&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(e),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),n&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(e),this.owner=n.owner}setCurrent(e){var n;this.current=e,this.updatedAt=Li.now(),null===this.canTrackVelocity&&void 0!==e&&(this.canTrackVelocity=(n=this.current,!isNaN(parseFloat(n))))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,n){this.events[e]||(this.events[e]=new Ri);const t=this.events[e].add(n);return"change"===e?()=>{t(),Ei.read(()=>{this.events.change.getSize()||this.stop()})}:t}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,n){this.passiveEffect=e,this.stopPassiveEffect=n}set(e,n=!0){n&&this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e,n)}setWithVelocity(e,n,t){this.set(n),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-t}jump(e,n=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,n&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return _i.current&&_i.current.push(this),this.current}getPrevious(){return this.prev}getVelocity(){const e=Li.now();if(!this.canTrackVelocity||void 0===this.prevFrameValue||e-this.updatedAt>30)return 0;const n=Math.min(this.updatedAt-this.prevUpdatedAt,30);return Bi(parseFloat(this.current)-parseFloat(this.prevFrameValue),n)}start(e){return this.stop(),new Promise(n=>{this.hasAnimated=!0,this.animation=e(n),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Fi(e,n){return new Ui(e,n)}function Wi(e,n,t){e.hasValue(n)?e.getValue(n).set(t):e.addValue(n,Fi(t))}const Hi=e=>Boolean(e&&e.getVelocity);function Vi(e,n){const t=e.getValue("willChange");if(r=t,Boolean(Hi(r)&&r.add))return t.add(n);var r}const qi=e=>e.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),$i="data-"+qi("framerAppearId");function Yi(e){return e.props[$i]}function Ki(e){let n;return()=>(void 0===n&&(n=e()),n)}const Qi=Ki(()=>void 0!==window.ScrollTimeline);class Gi{constructor(e){this.stop=()=>this.runAll("stop"),this.animations=e.filter(Boolean)}get finished(){return Promise.all(this.animations.map(e=>"finished"in e?e.finished:e))}getAll(e){return this.animations[0][e]}setAll(e,n){for(let t=0;t<this.animations.length;t++)this.animations[t][e]=n}attachTimeline(e,n){const t=this.animations.map(t=>Qi()&&t.attachTimeline?t.attachTimeline(e):"function"==typeof n?n(t):void 0);return()=>{t.forEach((e,n)=>{e&&e(),this.animations[n].stop()})}}get time(){return this.getAll("time")}set time(e){this.setAll("time",e)}get speed(){return this.getAll("speed")}set speed(e){this.setAll("speed",e)}get startTime(){return this.getAll("startTime")}get duration(){let e=0;for(let n=0;n<this.animations.length;n++)e=Math.max(e,this.animations[n].duration);return e}runAll(e){this.animations.forEach(n=>n[e]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class Xi extends Gi{then(e,n){return Promise.all(this.animations).then(e).catch(n)}}const Zi=e=>1e3*e,Ji=e=>e/1e3,ea=!1;function na(e){return"function"==typeof e}function ta(e,n){e.timeline=n,e.onfinish=null}const ra=e=>Array.isArray(e)&&"number"==typeof e[0],ia={linearEasing:void 0};function aa(e,n){const t=Ki(e);return()=>{var e;return null!==(e=ia[n])&&void 0!==e?e:t()}}const oa=aa(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch(e){return!1}return!0},"linearEasing"),sa=(e,n,t)=>{const r=n-e;return 0===r?1:(t-e)/r},la=(e,n,t=10)=>{let r="";const i=Math.max(Math.round(n/t),2);for(let n=0;n<i;n++)r+=e(sa(0,i-1,n))+", ";return`linear(${r.substring(0,r.length-2)})`};function ca(e){return Boolean("function"==typeof e&&oa()||!e||"string"==typeof e&&(e in da||oa())||ra(e)||Array.isArray(e)&&e.every(ca))}const ua=([e,n,t,r])=>`cubic-bezier(${e}, ${n}, ${t}, ${r})`,da={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:ua([0,.65,.55,1]),circOut:ua([.55,0,1,.45]),backIn:ua([.31,.01,.66,-.59]),backOut:ua([.33,1.53,.69,.99])};function ma(e,n){return e?"function"==typeof e&&oa()?la(e,n):ra(e)?ua(e):Array.isArray(e)?e.map(e=>ma(e,n)||da.easeOut):da[e]:void 0}const pa=(e,n,t)=>(((1-3*t+3*n)*e+(3*t-6*n))*e+3*n)*e;function ga(e,n,t,r){if(e===n&&t===r)return Ci;const i=n=>function(e,n,t,r,i){let a,o,s=0;do{o=n+(t-n)/2,a=pa(o,r,i)-e,a>0?t=o:n=o}while(Math.abs(a)>1e-7&&++s<12);return o}(n,0,1,e,t);return e=>0===e||1===e?e:pa(i(e),n,r)}const va=e=>n=>n<=.5?e(2*n)/2:(2-e(2*(1-n)))/2,ha=e=>n=>1-e(1-n),fa=ga(.33,1.53,.69,.99),ba=ha(fa),xa=va(ba),ya=e=>(e*=2)<1?.5*ba(e):.5*(2-Math.pow(2,-10*(e-1))),ka=e=>1-Math.sin(Math.acos(e)),wa=ha(ka),ja=va(ka),Sa=e=>/^0[^.\s]+$/u.test(e);function Ca(e){return"number"==typeof e?0===e:null===e||("none"===e||"0"===e||Sa(e))}const Na=(e,n,t)=>t>n?n:t<e?e:t,Pa={test:e=>"number"==typeof e,parse:parseFloat,transform:e=>e},Ea={...Pa,transform:e=>Na(0,1,e)},Oa={...Pa,default:1},Ma=e=>Math.round(1e5*e)/1e5,za=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;const Ta=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,Ia=(e,n)=>t=>Boolean("string"==typeof t&&Ta.test(t)&&t.startsWith(e)||n&&!function(e){return null==e}(t)&&Object.prototype.hasOwnProperty.call(t,n)),La=(e,n,t)=>r=>{if("string"!=typeof r)return r;const[i,a,o,s]=r.match(za);return{[e]:parseFloat(i),[n]:parseFloat(a),[t]:parseFloat(o),alpha:void 0!==s?parseFloat(s):1}},Da={...Pa,transform:e=>Math.round((e=>Na(0,255,e))(e))},Aa={test:Ia("rgb","red"),parse:La("red","green","blue"),transform:({red:e,green:n,blue:t,alpha:r=1})=>"rgba("+Da.transform(e)+", "+Da.transform(n)+", "+Da.transform(t)+", "+Ma(Ea.transform(r))+")"};const Ra={test:Ia("#"),parse:function(e){let n="",t="",r="",i="";return e.length>5?(n=e.substring(1,3),t=e.substring(3,5),r=e.substring(5,7),i=e.substring(7,9)):(n=e.substring(1,2),t=e.substring(2,3),r=e.substring(3,4),i=e.substring(4,5),n+=n,t+=t,r+=r,i+=i),{red:parseInt(n,16),green:parseInt(t,16),blue:parseInt(r,16),alpha:i?parseInt(i,16)/255:1}},transform:Aa.transform},Ba=e=>({test:n=>"string"==typeof n&&n.endsWith(e)&&1===n.split(" ").length,parse:parseFloat,transform:n=>`${n}${e}`}),_a=Ba("deg"),Ua=Ba("%"),Fa=Ba("px"),Wa=Ba("vh"),Ha=Ba("vw"),Va={...Ua,parse:e=>Ua.parse(e)/100,transform:e=>Ua.transform(100*e)},qa={test:Ia("hsl","hue"),parse:La("hue","saturation","lightness"),transform:({hue:e,saturation:n,lightness:t,alpha:r=1})=>"hsla("+Math.round(e)+", "+Ua.transform(Ma(n))+", "+Ua.transform(Ma(t))+", "+Ma(Ea.transform(r))+")"},$a={test:e=>Aa.test(e)||Ra.test(e)||qa.test(e),parse:e=>Aa.test(e)?Aa.parse(e):qa.test(e)?qa.parse(e):Ra.parse(e),transform:e=>"string"==typeof e?e:e.hasOwnProperty("red")?Aa.transform(e):qa.transform(e)},Ya=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;const Ka="number",Qa="color",Ga=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Xa(e){const n=e.toString(),t=[],r={color:[],number:[],var:[]},i=[];let a=0;const o=n.replace(Ga,e=>($a.test(e)?(r.color.push(a),i.push(Qa),t.push($a.parse(e))):e.startsWith("var(")?(r.var.push(a),i.push("var"),t.push(e)):(r.number.push(a),i.push(Ka),t.push(parseFloat(e))),++a,"${}")).split("${}");return{values:t,split:o,indexes:r,types:i}}function Za(e){return Xa(e).values}function Ja(e){const{split:n,types:t}=Xa(e),r=n.length;return e=>{let i="";for(let a=0;a<r;a++)if(i+=n[a],void 0!==e[a]){const n=t[a];i+=n===Ka?Ma(e[a]):n===Qa?$a.transform(e[a]):e[a]}return i}}const eo=e=>"number"==typeof e?0:e;const no={test:function(e){var n,t;return isNaN(e)&&"string"==typeof e&&((null===(n=e.match(za))||void 0===n?void 0:n.length)||0)+((null===(t=e.match(Ya))||void 0===t?void 0:t.length)||0)>0},parse:Za,createTransformer:Ja,getAnimatableNone:function(e){const n=Za(e);return Ja(e)(n.map(eo))}},to=new Set(["brightness","contrast","saturate","opacity"]);function ro(e){const[n,t]=e.slice(0,-1).split("(");if("drop-shadow"===n)return e;const[r]=t.match(za)||[];if(!r)return e;const i=t.replace(r,"");let a=to.has(n)?1:0;return r!==t&&(a*=100),n+"("+a+i+")"}const io=/\b([a-z-]*)\(.*?\)/gu,ao={...no,getAnimatableNone:e=>{const n=e.match(io);return n?n.map(ro).join(" "):e}},oo={borderWidth:Fa,borderTopWidth:Fa,borderRightWidth:Fa,borderBottomWidth:Fa,borderLeftWidth:Fa,borderRadius:Fa,radius:Fa,borderTopLeftRadius:Fa,borderTopRightRadius:Fa,borderBottomRightRadius:Fa,borderBottomLeftRadius:Fa,width:Fa,maxWidth:Fa,height:Fa,maxHeight:Fa,top:Fa,right:Fa,bottom:Fa,left:Fa,padding:Fa,paddingTop:Fa,paddingRight:Fa,paddingBottom:Fa,paddingLeft:Fa,margin:Fa,marginTop:Fa,marginRight:Fa,marginBottom:Fa,marginLeft:Fa,backgroundPositionX:Fa,backgroundPositionY:Fa},so={rotate:_a,rotateX:_a,rotateY:_a,rotateZ:_a,scale:Oa,scaleX:Oa,scaleY:Oa,scaleZ:Oa,skew:_a,skewX:_a,skewY:_a,distance:Fa,translateX:Fa,translateY:Fa,translateZ:Fa,x:Fa,y:Fa,z:Fa,perspective:Fa,transformPerspective:Fa,opacity:Ea,originX:Va,originY:Va,originZ:Fa},lo={...Pa,transform:Math.round},co={...oo,...so,zIndex:lo,size:Fa,fillOpacity:Ea,strokeOpacity:Ea,numOctaves:lo},uo={...co,color:$a,backgroundColor:$a,outlineColor:$a,fill:$a,stroke:$a,borderColor:$a,borderTopColor:$a,borderRightColor:$a,borderBottomColor:$a,borderLeftColor:$a,filter:ao,WebkitFilter:ao},mo=e=>uo[e];function po(e,n){let t=mo(e);return t!==ao&&(t=no),t.getAnimatableNone?t.getAnimatableNone(n):void 0}const go=new Set(["auto","none","0"]);const vo=e=>e===Pa||e===Fa,ho=(e,n)=>parseFloat(e.split(", ")[n]),fo=(e,n)=>(t,{transform:r})=>{if("none"===r||!r)return 0;const i=r.match(/^matrix3d\((.+)\)$/u);if(i)return ho(i[1],n);{const n=r.match(/^matrix\((.+)\)$/u);return n?ho(n[1],e):0}},bo=new Set(["x","y","z"]),xo=xi.filter(e=>!bo.has(e));const yo={width:({x:e},{paddingLeft:n="0",paddingRight:t="0"})=>e.max-e.min-parseFloat(n)-parseFloat(t),height:({y:e},{paddingTop:n="0",paddingBottom:t="0"})=>e.max-e.min-parseFloat(n)-parseFloat(t),top:(e,{top:n})=>parseFloat(n),left:(e,{left:n})=>parseFloat(n),bottom:({y:e},{top:n})=>parseFloat(n)+(e.max-e.min),right:({x:e},{left:n})=>parseFloat(n)+(e.max-e.min),x:fo(4,13),y:fo(5,14)};yo.translateX=yo.x,yo.translateY=yo.y;const ko=new Set;let wo=!1,jo=!1;function So(){if(jo){const e=Array.from(ko).filter(e=>e.needsMeasurement),n=new Set(e.map(e=>e.element)),t=new Map;n.forEach(e=>{const n=function(e){const n=[];return xo.forEach(t=>{const r=e.getValue(t);void 0!==r&&(n.push([t,r.get()]),r.set(t.startsWith("scale")?1:0))}),n}(e);n.length&&(t.set(e,n),e.render())}),e.forEach(e=>e.measureInitialState()),n.forEach(e=>{e.render();const n=t.get(e);n&&n.forEach(([n,t])=>{var r;null===(r=e.getValue(n))||void 0===r||r.set(t)})}),e.forEach(e=>e.measureEndState()),e.forEach(e=>{void 0!==e.suspendedScrollY&&window.scrollTo(0,e.suspendedScrollY)})}jo=!1,wo=!1,ko.forEach(e=>e.complete()),ko.clear()}function Co(){ko.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(jo=!0)})}class No{constructor(e,n,t,r,i,a=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...e],this.onComplete=n,this.name=t,this.motionValue=r,this.element=i,this.isAsync=a}scheduleResolve(){this.isScheduled=!0,this.isAsync?(ko.add(this),wo||(wo=!0,Ei.read(Co),Ei.resolveKeyframes(So))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:n,element:t,motionValue:r}=this;for(let i=0;i<e.length;i++)if(null===e[i])if(0===i){const i=null==r?void 0:r.get(),a=e[e.length-1];if(void 0!==i)e[0]=i;else if(t&&n){const r=t.readValue(n,a);null!=r&&(e[0]=r)}void 0===e[0]&&(e[0]=a),r&&void 0===i&&r.set(e[0])}else e[i]=e[i-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),ko.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,ko.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}let Po=Ci,Eo=Ci;const Oo=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e),Mo=e=>n=>"string"==typeof n&&n.startsWith(e),zo=Mo("--"),To=Mo("var(--"),Io=e=>!!To(e)&&Lo.test(e.split("/*")[0].trim()),Lo=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,Do=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function Ao(e,n,t=1){Eo(t<=4,`Max CSS variable fallback depth detected in property "${e}". This may indicate a circular fallback dependency.`);const[r,i]=function(e){const n=Do.exec(e);if(!n)return[,];const[,t,r,i]=n;return[`--${null!=t?t:r}`,i]}(e);if(!r)return;const a=window.getComputedStyle(n).getPropertyValue(r);if(a){const e=a.trim();return Oo(e)?parseFloat(e):e}return Io(i)?Ao(i,n,t+1):i}const Ro=e=>n=>n.test(e),Bo=[Pa,Fa,Ua,_a,Ha,Wa,{test:e=>"auto"===e,parse:e=>e}],_o=e=>Bo.find(Ro(e));class Uo extends No{constructor(e,n,t,r,i){super(e,n,t,r,i,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:n,name:t}=this;if(!n||!n.current)return;super.readKeyframes();for(let t=0;t<e.length;t++){let r=e[t];if("string"==typeof r&&(r=r.trim(),Io(r))){const i=Ao(r,n.current);void 0!==i&&(e[t]=i),t===e.length-1&&(this.finalKeyframe=r)}}if(this.resolveNoneKeyframes(),!ki.has(t)||2!==e.length)return;const[r,i]=e,a=_o(r),o=_o(i);if(a!==o)if(vo(a)&&vo(o))for(let n=0;n<e.length;n++){const t=e[n];"string"==typeof t&&(e[n]=parseFloat(t))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:n}=this,t=[];for(let n=0;n<e.length;n++)Ca(e[n])&&t.push(n);t.length&&function(e,n,t){let r,i=0;for(;i<e.length&&!r;){const n=e[i];"string"==typeof n&&!go.has(n)&&Xa(n).values.length&&(r=e[i]),i++}if(r&&t)for(const i of n)e[i]=po(t,r)}(e,t,n)}measureInitialState(){const{element:e,unresolvedKeyframes:n,name:t}=this;if(!e||!e.current)return;"height"===t&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=yo[t](e.measureViewportBox(),window.getComputedStyle(e.current)),n[0]=this.measuredOrigin;const r=n[n.length-1];void 0!==r&&e.getValue(t,r).jump(r,!1)}measureEndState(){var e;const{element:n,name:t,unresolvedKeyframes:r}=this;if(!n||!n.current)return;const i=n.getValue(t);i&&i.jump(this.measuredOrigin,!1);const a=r.length-1,o=r[a];r[a]=yo[t](n.measureViewportBox(),window.getComputedStyle(n.current)),null!==o&&void 0===this.finalKeyframe&&(this.finalKeyframe=o),(null===(e=this.removedTransforms)||void 0===e?void 0:e.length)&&this.removedTransforms.forEach(([e,t])=>{n.getValue(e).set(t)}),this.resolveNoneKeyframes()}}const Fo=(e,n)=>"zIndex"!==n&&(!("number"!=typeof e&&!Array.isArray(e))||!("string"!=typeof e||!no.test(e)&&"0"!==e||e.startsWith("url(")));function Wo(e,n,t,r){const i=e[0];if(null===i)return!1;if("display"===n||"visibility"===n)return!0;const a=e[e.length-1],o=Fo(i,n),s=Fo(a,n);return Po(o===s,`You are trying to animate ${n} from "${i}" to "${a}". ${i} is not an animatable value - to enable this animation set ${i} to a value animatable to ${a} via the \`style\` property.`),!(!o||!s)&&(function(e){const n=e[0];if(1===e.length)return!0;for(let t=0;t<e.length;t++)if(e[t]!==n)return!0}(e)||("spring"===t||na(t))&&r)}const Ho=e=>null!==e;function Vo(e,{repeat:n,repeatType:t="loop"},r){const i=e.filter(Ho),a=n&&"loop"!==t&&n%2==1?0:i.length-1;return a&&void 0!==r?r:i[a]}class qo{constructor({autoplay:e=!0,delay:n=0,type:t="keyframes",repeat:r=0,repeatDelay:i=0,repeatType:a="loop",...o}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=Li.now(),this.options={autoplay:e,delay:n,type:t,repeat:r,repeatDelay:i,repeatType:a,...o},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt&&this.resolvedAt-this.createdAt>40?this.resolvedAt:this.createdAt}get resolved(){return this._resolved||this.hasAttemptedResolve||(Co(),So()),this._resolved}onKeyframesResolved(e,n){this.resolvedAt=Li.now(),this.hasAttemptedResolve=!0;const{name:t,type:r,velocity:i,delay:a,onComplete:o,onUpdate:s,isGenerator:l}=this.options;if(!l&&!Wo(e,t,r,i)){if(ea||!a)return s&&s(Vo(e,this.options,n)),o&&o(),void this.resolveFinishedPromise();this.options.duration=0}const c=this.initPlayback(e,n);!1!==c&&(this._resolved={keyframes:e,finalKeyframe:n,...c},this.onPostResolved())}onPostResolved(){}then(e,n){return this.currentFinishedPromise.then(e,n)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(e=>{this.resolveFinishedPromise=e})}}const $o=2e4;function Yo(e){let n=0;let t=e.next(n);for(;!t.done&&n<$o;)n+=50,t=e.next(n);return n>=$o?1/0:n}const Ko=(e,n,t)=>e+(n-e)*t;function Qo(e,n,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?e+6*(n-e)*t:t<.5?n:t<2/3?e+(n-e)*(2/3-t)*6:e}function Go(e,n){return t=>t>0?n:e}const Xo=(e,n,t)=>{const r=e*e,i=t*(n*n-r)+r;return i<0?0:Math.sqrt(i)},Zo=[Ra,Aa,qa];function Jo(e){const n=(t=e,Zo.find(e=>e.test(t)));var t;if(Po(Boolean(n),`'${e}' is not an animatable color. Use the equivalent color code instead.`),!Boolean(n))return!1;let r=n.parse(e);return n===qa&&(r=function({hue:e,saturation:n,lightness:t,alpha:r}){e/=360,t/=100;let i=0,a=0,o=0;if(n/=100){const r=t<.5?t*(1+n):t+n-t*n,s=2*t-r;i=Qo(s,r,e+1/3),a=Qo(s,r,e),o=Qo(s,r,e-1/3)}else i=a=o=t;return{red:Math.round(255*i),green:Math.round(255*a),blue:Math.round(255*o),alpha:r}}(r)),r}const es=(e,n)=>{const t=Jo(e),r=Jo(n);if(!t||!r)return Go(e,n);const i={...t};return e=>(i.red=Xo(t.red,r.red,e),i.green=Xo(t.green,r.green,e),i.blue=Xo(t.blue,r.blue,e),i.alpha=Ko(t.alpha,r.alpha,e),Aa.transform(i))},ns=(e,n)=>t=>n(e(t)),ts=(...e)=>e.reduce(ns),rs=new Set(["none","hidden"]);function is(e,n){return t=>Ko(e,n,t)}function as(e){return"number"==typeof e?is:"string"==typeof e?Io(e)?Go:$a.test(e)?es:ls:Array.isArray(e)?os:"object"==typeof e?$a.test(e)?es:ss:Go}function os(e,n){const t=[...e],r=t.length,i=e.map((e,t)=>as(e)(e,n[t]));return e=>{for(let n=0;n<r;n++)t[n]=i[n](e);return t}}function ss(e,n){const t={...e,...n},r={};for(const i in t)void 0!==e[i]&&void 0!==n[i]&&(r[i]=as(e[i])(e[i],n[i]));return e=>{for(const n in r)t[n]=r[n](e);return t}}const ls=(e,n)=>{const t=no.createTransformer(n),r=Xa(e),i=Xa(n);return r.indexes.var.length===i.indexes.var.length&&r.indexes.color.length===i.indexes.color.length&&r.indexes.number.length>=i.indexes.number.length?rs.has(e)&&!i.values.length||rs.has(n)&&!r.values.length?function(e,n){return rs.has(e)?t=>t<=0?e:n:t=>t>=1?n:e}(e,n):ts(os(function(e,n){var t;const r=[],i={color:0,var:0,number:0};for(let a=0;a<n.values.length;a++){const o=n.types[a],s=e.indexes[o][i[o]],l=null!==(t=e.values[s])&&void 0!==t?t:0;r[a]=l,i[o]++}return r}(r,i),i.values),t):(Po(!0,`Complex values '${e}' and '${n}' too different to mix. Ensure all colors are of the same type, and that each contains the same quantity of number and color values. Falling back to instant transition.`),Go(e,n))};function cs(e,n,t){if("number"==typeof e&&"number"==typeof n&&"number"==typeof t)return Ko(e,n,t);return as(e)(e,n)}function us(e,n,t){const r=Math.max(n-5,0);return Bi(t-e(r),n-r)}const ds=100,ms=10,ps=1,gs=0,vs=800,hs=.3,fs=.3,bs={granular:.01,default:2},xs={granular:.005,default:.5},ys=.01,ks=10,ws=.05,js=1,Ss=.001;function Cs({duration:e=vs,bounce:n=hs,velocity:t=gs,mass:r=ps}){let i,a;Po(e<=Zi(ks),"Spring duration must be 10 seconds or less");let o=1-n;o=Na(ws,js,o),e=Na(ys,ks,Ji(e)),o<1?(i=n=>{const r=n*o,i=r*e,a=r-t,s=Ps(n,o),l=Math.exp(-i);return Ss-a/s*l},a=n=>{const r=n*o*e,a=r*t+t,s=Math.pow(o,2)*Math.pow(n,2)*e,l=Math.exp(-r),c=Ps(Math.pow(n,2),o);return(-i(n)+Ss>0?-1:1)*((a-s)*l)/c}):(i=n=>Math.exp(-n*e)*((n-t)*e+1)-.001,a=n=>Math.exp(-n*e)*(e*e*(t-n)));const s=function(e,n,t){let r=t;for(let t=1;t<Ns;t++)r-=e(r)/n(r);return r}(i,a,5/e);if(e=Zi(e),isNaN(s))return{stiffness:ds,damping:ms,duration:e};{const n=Math.pow(s,2)*r;return{stiffness:n,damping:2*o*Math.sqrt(r*n),duration:e}}}const Ns=12;function Ps(e,n){return e*Math.sqrt(1-n*n)}const Es=["duration","bounce"],Os=["stiffness","damping","mass"];function Ms(e,n){return n.some(n=>void 0!==e[n])}function zs(e=fs,n=hs){const t="object"!=typeof e?{visualDuration:e,keyframes:[0,1],bounce:n}:e;let{restSpeed:r,restDelta:i}=t;const a=t.keyframes[0],o=t.keyframes[t.keyframes.length-1],s={done:!1,value:a},{stiffness:l,damping:c,mass:u,duration:d,velocity:m,isResolvedFromDuration:p}=function(e){let n={velocity:gs,stiffness:ds,damping:ms,mass:ps,isResolvedFromDuration:!1,...e};if(!Ms(e,Os)&&Ms(e,Es))if(e.visualDuration){const t=e.visualDuration,r=2*Math.PI/(1.2*t),i=r*r,a=2*Na(.05,1,1-(e.bounce||0))*Math.sqrt(i);n={...n,mass:ps,stiffness:i,damping:a}}else{const t=Cs(e);n={...n,...t,mass:ps},n.isResolvedFromDuration=!0}return n}({...t,velocity:-Ji(t.velocity||0)}),g=m||0,v=c/(2*Math.sqrt(l*u)),h=o-a,f=Ji(Math.sqrt(l/u)),b=Math.abs(h)<5;let x;if(r||(r=b?bs.granular:bs.default),i||(i=b?xs.granular:xs.default),v<1){const e=Ps(f,v);x=n=>{const t=Math.exp(-v*f*n);return o-t*((g+v*f*h)/e*Math.sin(e*n)+h*Math.cos(e*n))}}else if(1===v)x=e=>o-Math.exp(-f*e)*(h+(g+f*h)*e);else{const e=f*Math.sqrt(v*v-1);x=n=>{const t=Math.exp(-v*f*n),r=Math.min(e*n,300);return o-t*((g+v*f*h)*Math.sinh(r)+e*h*Math.cosh(r))/e}}const y={calculatedDuration:p&&d||null,next:e=>{const n=x(e);if(p)s.done=e>=d;else{let t=0;v<1&&(t=0===e?Zi(g):us(x,e,n));const a=Math.abs(t)<=r,l=Math.abs(o-n)<=i;s.done=a&&l}return s.value=s.done?o:n,s},toString:()=>{const e=Math.min(Yo(y),$o),n=la(n=>y.next(e*n).value,e,30);return e+"ms "+n}};return y}function Ts({keyframes:e,velocity:n=0,power:t=.8,timeConstant:r=325,bounceDamping:i=10,bounceStiffness:a=500,modifyTarget:o,min:s,max:l,restDelta:c=.5,restSpeed:u}){const d=e[0],m={done:!1,value:d},p=e=>void 0===s?l:void 0===l||Math.abs(s-e)<Math.abs(l-e)?s:l;let g=t*n;const v=d+g,h=void 0===o?v:o(v);h!==v&&(g=h-d);const f=e=>-g*Math.exp(-e/r),b=e=>h+f(e),x=e=>{const n=f(e),t=b(e);m.done=Math.abs(n)<=c,m.value=m.done?h:t};let y,k;const w=e=>{var n;(n=m.value,void 0!==s&&n<s||void 0!==l&&n>l)&&(y=e,k=zs({keyframes:[m.value,p(m.value)],velocity:us(b,e,m.value),damping:i,stiffness:a,restDelta:c,restSpeed:u}))};return w(0),{calculatedDuration:null,next:e=>{let n=!1;return k||void 0!==y||(n=!0,x(e),w(e)),void 0!==y&&e>=y?k.next(e-y):(!n&&x(e),m)}}}const Is=ga(.42,0,1,1),Ls=ga(0,0,.58,1),Ds=ga(.42,0,.58,1),As={linear:Ci,easeIn:Is,easeInOut:Ds,easeOut:Ls,circIn:ka,circInOut:ja,circOut:wa,backIn:ba,backInOut:xa,backOut:fa,anticipate:ya},Rs=e=>{if(ra(e)){Eo(4===e.length,"Cubic bezier arrays must contain four numerical values.");const[n,t,r,i]=e;return ga(n,t,r,i)}return"string"==typeof e?(Eo(void 0!==As[e],`Invalid easing type '${e}'`),As[e]):e};function Bs(e,n,{clamp:t=!0,ease:r,mixer:i}={}){const a=e.length;if(Eo(a===n.length,"Both input and output ranges must be the same length"),1===a)return()=>n[0];if(2===a&&n[0]===n[1])return()=>n[1];const o=e[0]===e[1];e[0]>e[a-1]&&(e=[...e].reverse(),n=[...n].reverse());const s=function(e,n,t){const r=[],i=t||cs,a=e.length-1;for(let t=0;t<a;t++){let a=i(e[t],e[t+1]);if(n){const e=Array.isArray(n)?n[t]||Ci:n;a=ts(e,a)}r.push(a)}return r}(n,r,i),l=s.length,c=t=>{if(o&&t<e[0])return n[0];let r=0;if(l>1)for(;r<e.length-2&&!(t<e[r+1]);r++);const i=sa(e[r],e[r+1],t);return s[r](i)};return t?n=>c(Na(e[0],e[a-1],n)):c}function _s(e){const n=[0];return function(e,n){const t=e[e.length-1];for(let r=1;r<=n;r++){const i=sa(0,n,r);e.push(Ko(t,1,i))}}(n,e.length-1),n}function Us({duration:e=300,keyframes:n,times:t,ease:r="easeInOut"}){const i=(e=>Array.isArray(e)&&"number"!=typeof e[0])(r)?r.map(Rs):Rs(r),a={done:!1,value:n[0]},o=function(e,n){return e.map(e=>e*n)}(t&&t.length===n.length?t:_s(n),e),s=Bs(o,n,{ease:Array.isArray(i)?i:(l=n,c=i,l.map(()=>c||Ds).splice(0,l.length-1))});var l,c;return{calculatedDuration:e,next:n=>(a.value=s(n),a.done=n>=e,a)}}const Fs=e=>{const n=({timestamp:n})=>e(n);return{start:()=>Ei.update(n,!0),stop:()=>Oi(n),now:()=>Mi.isProcessing?Mi.timestamp:Li.now()}},Ws={decay:Ts,inertia:Ts,tween:Us,keyframes:Us,spring:zs},Hs=e=>e/100;class Vs extends qo{constructor(e){super(e),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,"idle"===this.state)return;this.teardown();const{onStop:e}=this.options;e&&e()};const{name:n,motionValue:t,element:r,keyframes:i}=this.options,a=(null==r?void 0:r.KeyframeResolver)||No;this.resolver=new a(i,(e,n)=>this.onKeyframesResolved(e,n),n,t,r),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(e){const{type:n="keyframes",repeat:t=0,repeatDelay:r=0,repeatType:i,velocity:a=0}=this.options,o=na(n)?n:Ws[n]||Us;let s,l;o!==Us&&"number"!=typeof e[0]&&(s=ts(Hs,cs(e[0],e[1])),e=[0,100]);const c=o({...this.options,keyframes:e});"mirror"===i&&(l=o({...this.options,keyframes:[...e].reverse(),velocity:-a})),null===c.calculatedDuration&&(c.calculatedDuration=Yo(c));const{calculatedDuration:u}=c,d=u+r;return{generator:c,mirroredGenerator:l,mapPercentToKeyframes:s,calculatedDuration:u,resolvedDuration:d,totalDuration:d*(t+1)-r}}onPostResolved(){const{autoplay:e=!0}=this.options;this.play(),"paused"!==this.pendingPlayState&&e?this.state=this.pendingPlayState:this.pause()}tick(e,n=!1){const{resolved:t}=this;if(!t){const{keyframes:e}=this.options;return{done:!0,value:e[e.length-1]}}const{finalKeyframe:r,generator:i,mirroredGenerator:a,mapPercentToKeyframes:o,keyframes:s,calculatedDuration:l,totalDuration:c,resolvedDuration:u}=t;if(null===this.startTime)return i.next(0);const{delay:d,repeat:m,repeatType:p,repeatDelay:g,onUpdate:v}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-c/this.speed,this.startTime)),n?this.currentTime=e:null!==this.holdTime?this.currentTime=this.holdTime:this.currentTime=Math.round(e-this.startTime)*this.speed;const h=this.currentTime-d*(this.speed>=0?1:-1),f=this.speed>=0?h<0:h>c;this.currentTime=Math.max(h,0),"finished"===this.state&&null===this.holdTime&&(this.currentTime=c);let b=this.currentTime,x=i;if(m){const e=Math.min(this.currentTime,c)/u;let n=Math.floor(e),t=e%1;!t&&e>=1&&(t=1),1===t&&n--,n=Math.min(n,m+1);Boolean(n%2)&&("reverse"===p?(t=1-t,g&&(t-=g/u)):"mirror"===p&&(x=a)),b=Na(0,1,t)*u}const y=f?{done:!1,value:s[0]}:x.next(b);o&&(y.value=o(y.value));let{done:k}=y;f||null===l||(k=this.speed>=0?this.currentTime>=c:this.currentTime<=0);const w=null===this.holdTime&&("finished"===this.state||"running"===this.state&&k);return w&&void 0!==r&&(y.value=Vo(s,this.options,r)),v&&v(y.value),w&&this.finish(),y}get duration(){const{resolved:e}=this;return e?Ji(e.calculatedDuration):0}get time(){return Ji(this.currentTime)}set time(e){e=Zi(e),this.currentTime=e,null!==this.holdTime||0===this.speed?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.speed)}get speed(){return this.playbackSpeed}set speed(e){const n=this.playbackSpeed!==e;this.playbackSpeed=e,n&&(this.time=Ji(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved)return void(this.pendingPlayState="running");if(this.isStopped)return;const{driver:e=Fs,onPlay:n,startTime:t}=this.options;this.driver||(this.driver=e(e=>this.tick(e))),n&&n();const r=this.driver.now();null!==this.holdTime?this.startTime=r-this.holdTime:this.startTime?"finished"===this.state&&(this.startTime=r):this.startTime=null!=t?t:this.calcStartTime(),"finished"===this.state&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var e;this._resolved?(this.state="paused",this.holdTime=null!==(e=this.currentTime)&&void 0!==e?e:0):this.pendingPlayState="paused"}complete(){"running"!==this.state&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:e}=this.options;e&&e()}cancel(){null!==this.cancelTime&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}}const qs=new Set(["opacity","clipPath","filter","transform"]);function $s(e,n,t,{delay:r=0,duration:i=300,repeat:a=0,repeatType:o="loop",ease:s="easeInOut",times:l}={}){const c={[n]:t};l&&(c.offset=l);const u=ma(s,i);return Array.isArray(u)&&(c.easing=u),e.animate(c,{delay:r,duration:i,easing:Array.isArray(u)?"linear":u,fill:"both",iterations:a+1,direction:"reverse"===o?"alternate":"normal"})}const Ys=Ki(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));const Ks={anticipate:ya,backInOut:xa,circInOut:ja};class Qs extends qo{constructor(e){super(e);const{name:n,motionValue:t,element:r,keyframes:i}=this.options;this.resolver=new Uo(i,(e,n)=>this.onKeyframesResolved(e,n),n,t,r),this.resolver.scheduleResolve()}initPlayback(e,n){let{duration:t=300,times:r,ease:i,type:a,motionValue:o,name:s,startTime:l}=this.options;if(!o.owner||!o.owner.current)return!1;if("string"==typeof i&&oa()&&function(e){return e in Ks}(i)&&(i=Ks[i]),function(e){return na(e.type)||"spring"===e.type||!ca(e.ease)}(this.options)){const{onComplete:n,onUpdate:o,motionValue:s,element:l,...c}=this.options,u=function(e,n){const t=new Vs({...n,keyframes:e,repeat:0,delay:0,isGenerator:!0});let r={done:!1,value:e[0]};const i=[];let a=0;for(;!r.done&&a<2e4;)r=t.sample(a),i.push(r.value),a+=10;return{times:void 0,keyframes:i,duration:a-10,ease:"linear"}}(e,c);1===(e=u.keyframes).length&&(e[1]=e[0]),t=u.duration,r=u.times,i=u.ease,a="keyframes"}const c=$s(o.owner.current,s,e,{...this.options,duration:t,times:r,ease:i});return c.startTime=null!=l?l:this.calcStartTime(),this.pendingTimeline?(ta(c,this.pendingTimeline),this.pendingTimeline=void 0):c.onfinish=()=>{const{onComplete:t}=this.options;o.set(Vo(e,this.options,n)),t&&t(),this.cancel(),this.resolveFinishedPromise()},{animation:c,duration:t,times:r,type:a,ease:i,keyframes:e}}get duration(){const{resolved:e}=this;if(!e)return 0;const{duration:n}=e;return Ji(n)}get time(){const{resolved:e}=this;if(!e)return 0;const{animation:n}=e;return Ji(n.currentTime||0)}set time(e){const{resolved:n}=this;if(!n)return;const{animation:t}=n;t.currentTime=Zi(e)}get speed(){const{resolved:e}=this;if(!e)return 1;const{animation:n}=e;return n.playbackRate}set speed(e){const{resolved:n}=this;if(!n)return;const{animation:t}=n;t.playbackRate=e}get state(){const{resolved:e}=this;if(!e)return"idle";const{animation:n}=e;return n.playState}get startTime(){const{resolved:e}=this;if(!e)return null;const{animation:n}=e;return n.startTime}attachTimeline(e){if(this._resolved){const{resolved:n}=this;if(!n)return Ci;const{animation:t}=n;ta(t,e)}else this.pendingTimeline=e;return Ci}play(){if(this.isStopped)return;const{resolved:e}=this;if(!e)return;const{animation:n}=e;"finished"===n.playState&&this.updateFinishedPromise(),n.play()}pause(){const{resolved:e}=this;if(!e)return;const{animation:n}=e;n.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,"idle"===this.state)return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:e}=this;if(!e)return;const{animation:n,keyframes:t,duration:r,type:i,ease:a,times:o}=e;if("idle"===n.playState||"finished"===n.playState)return;if(this.time){const{motionValue:e,onUpdate:n,onComplete:s,element:l,...c}=this.options,u=new Vs({...c,keyframes:t,duration:r,type:i,ease:a,times:o,isGenerator:!0}),d=Zi(this.time);e.setWithVelocity(u.sample(d-10).value,u.sample(d).value,10)}const{onStop:s}=this.options;s&&s(),this.cancel()}complete(){const{resolved:e}=this;e&&e.animation.finish()}cancel(){const{resolved:e}=this;e&&e.animation.cancel()}static supports(e){const{motionValue:n,name:t,repeatDelay:r,repeatType:i,damping:a,type:o}=e;if(!(n&&n.owner&&n.owner.current instanceof HTMLElement))return!1;const{onUpdate:s,transformTemplate:l}=n.owner.getProps();return Ys()&&t&&qs.has(t)&&!s&&!l&&!r&&"mirror"!==i&&0!==a&&"inertia"!==o}}const Gs={type:"spring",stiffness:500,damping:25,restSpeed:10},Xs={type:"keyframes",duration:.8},Zs={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},Js=(e,{keyframes:n})=>n.length>2?Xs:yi.has(e)?e.startsWith("scale")?{type:"spring",stiffness:550,damping:0===n[1]?2*Math.sqrt(550):30,restSpeed:10}:Gs:Zs;const el=(e,n,t,r={},i,a)=>o=>{const s=bi(r,e)||{},l=s.delay||r.delay||0;let{elapsed:c=0}=r;c-=Zi(l);let u={keyframes:Array.isArray(t)?t:[null,t],ease:"easeOut",velocity:n.getVelocity(),...s,delay:-c,onUpdate:e=>{n.set(e),s.onUpdate&&s.onUpdate(e)},onComplete:()=>{o(),s.onComplete&&s.onComplete()},name:e,motionValue:n,element:a?void 0:i};(function({when:e,delay:n,delayChildren:t,staggerChildren:r,staggerDirection:i,repeat:a,repeatType:o,repeatDelay:s,from:l,elapsed:c,...u}){return!!Object.keys(u).length})(s)||(u={...u,...Js(e,u)}),u.duration&&(u.duration=Zi(u.duration)),u.repeatDelay&&(u.repeatDelay=Zi(u.repeatDelay)),void 0!==u.from&&(u.keyframes[0]=u.from);let d=!1;if((!1===u.type||0===u.duration&&!u.repeatDelay)&&(u.duration=0,0===u.delay&&(d=!0)),(ea||ji)&&(d=!0,u.duration=0,u.delay=0),d&&!a&&void 0!==n.get()){const e=Vo(u.keyframes,s);if(void 0!==e)return Ei.update(()=>{u.onUpdate(e),u.onComplete()}),new Xi([])}return!a&&Qs.supports(u)?new Qs(u):new Vs(u)};function nl({protectedKeys:e,needsAnimating:n},t){const r=e.hasOwnProperty(t)&&!0!==n[t];return n[t]=!1,r}function tl(e,n,{delay:t=0,transitionOverride:r,type:i}={}){var a;let{transition:o=e.getDefaultTransition(),transitionEnd:s,...l}=n;r&&(o=r);const c=[],u=i&&e.animationState&&e.animationState.getState()[i];for(const n in l){const r=e.getValue(n,null!==(a=e.latestValues[n])&&void 0!==a?a:null),i=l[n];if(void 0===i||u&&nl(u,n))continue;const s={delay:t,...bi(o||{},n)};let d=!1;if(window.MotionHandoffAnimation){const t=Yi(e);if(t){const e=window.MotionHandoffAnimation(t,n,Ei);null!==e&&(s.startTime=e,d=!0)}}Vi(e,n),r.start(el(n,r,i,e.shouldReduceMotion&&ki.has(n)?{type:!1}:s,e,d));const m=r.animation;m&&c.push(m)}return s&&Promise.all(c).then(()=>{Ei.update(()=>{s&&function(e,n){const t=vi(e,n);let{transitionEnd:r={},transition:i={},...a}=t||{};a={...a,...r};for(const n in a)Wi(e,n,wi(a[n]))}(e,s)})}),c}function rl(e,n,t={}){var r;const i=vi(e,n,"exit"===t.type?null===(r=e.presenceContext)||void 0===r?void 0:r.custom:void 0);let{transition:a=e.getDefaultTransition()||{}}=i||{};t.transitionOverride&&(a=t.transitionOverride);const o=i?()=>Promise.all(tl(e,i,t)):()=>Promise.resolve(),s=e.variantChildren&&e.variantChildren.size?(r=0)=>{const{delayChildren:i=0,staggerChildren:o,staggerDirection:s}=a;return function(e,n,t=0,r=0,i=1,a){const o=[],s=(e.variantChildren.size-1)*r,l=1===i?(e=0)=>e*r:(e=0)=>s-e*r;return Array.from(e.variantChildren).sort(il).forEach((e,r)=>{e.notify("AnimationStart",n),o.push(rl(e,n,{...a,delay:t+l(r)}).then(()=>e.notify("AnimationComplete",n)))}),Promise.all(o)}(e,n,i+r,o,s,t)}:()=>Promise.resolve(),{when:l}=a;if(l){const[e,n]="beforeChildren"===l?[o,s]:[s,o];return e().then(()=>n())}return Promise.all([o(),s(t.delay)])}function il(e,n){return e.sortNodePosition(n)}const al=fi.length;function ol(e){if(!e)return;if(!e.isControllingVariants){const n=e.parent&&ol(e.parent)||{};return void 0!==e.props.initial&&(n.initial=e.props.initial),n}const n={};for(let t=0;t<al;t++){const r=fi[t],i=e.props[r];(mi(i)||!1===i)&&(n[r]=i)}return n}const sl=[...hi].reverse(),ll=hi.length;function cl(e){return n=>Promise.all(n.map(({animation:n,options:t})=>function(e,n,t={}){let r;if(e.notify("AnimationStart",n),Array.isArray(n)){const i=n.map(n=>rl(e,n,t));r=Promise.all(i)}else if("string"==typeof n)r=rl(e,n,t);else{const i="function"==typeof n?vi(e,n,t.custom):n;r=Promise.all(tl(e,i,t))}return r.then(()=>{e.notify("AnimationComplete",n)})}(e,n,t)))}function ul(e){let n=cl(e),t=pl(),r=!0;const i=n=>(t,r)=>{var i;const a=vi(e,r,"exit"===n?null===(i=e.presenceContext)||void 0===i?void 0:i.custom:void 0);if(a){const{transition:e,transitionEnd:n,...r}=a;t={...t,...r,...n}}return t};function a(a){const{props:o}=e,s=ol(e.parent)||{},l=[],c=new Set;let u={},d=1/0;for(let n=0;n<ll;n++){const m=sl[n],p=t[m],g=void 0!==o[m]?o[m]:s[m],v=mi(g),h=m===a?p.isActive:null;!1===h&&(d=n);let f=g===s[m]&&g!==o[m]&&v;if(f&&r&&e.manuallyAnimateOnMount&&(f=!1),p.protectedKeys={...u},!p.isActive&&null===h||!g&&!p.prevProp||ci(g)||"boolean"==typeof g)continue;const b=dl(p.prevProp,g);let x=b||m===a&&p.isActive&&!f&&v||n>d&&v,y=!1;const k=Array.isArray(g)?g:[g];let w=k.reduce(i(m),{});!1===h&&(w={});const{prevResolvedValues:j={}}=p,S={...j,...w},C=n=>{x=!0,c.has(n)&&(y=!0,c.delete(n)),p.needsAnimating[n]=!0;const t=e.getValue(n);t&&(t.liveStyle=!1)};for(const e in S){const n=w[e],t=j[e];if(u.hasOwnProperty(e))continue;let r=!1;r=ui(n)&&ui(t)?!di(n,t):n!==t,r?null!=n?C(e):c.add(e):void 0!==n&&c.has(e)?C(e):p.protectedKeys[e]=!0}p.prevProp=g,p.prevResolvedValues=w,p.isActive&&(u={...u,...w}),r&&e.blockInitialAnimation&&(x=!1);x&&(!(f&&b)||y)&&l.push(...k.map(e=>({animation:e,options:{type:m}})))}if(c.size){const n={};c.forEach(t=>{const r=e.getBaseTarget(t),i=e.getValue(t);i&&(i.liveStyle=!0),n[t]=null!=r?r:null}),l.push({animation:n})}let m=Boolean(l.length);return!r||!1!==o.initial&&o.initial!==o.animate||e.manuallyAnimateOnMount||(m=!1),r=!1,m?n(l):Promise.resolve()}return{animateChanges:a,setActive:function(n,r){var i;if(t[n].isActive===r)return Promise.resolve();null===(i=e.variantChildren)||void 0===i||i.forEach(e=>{var t;return null===(t=e.animationState)||void 0===t?void 0:t.setActive(n,r)}),t[n].isActive=r;const o=a(n);for(const e in t)t[e].protectedKeys={};return o},setAnimateFunction:function(t){n=t(e)},getState:()=>t,reset:()=>{t=pl(),r=!0}}}function dl(e,n){return"string"==typeof n?n!==e:!!Array.isArray(n)&&!di(n,e)}function ml(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function pl(){return{animate:ml(!0),whileInView:ml(),whileHover:ml(),whileTap:ml(),whileDrag:ml(),whileFocus:ml(),exit:ml()}}class gl{constructor(e){this.isMounted=!1,this.node=e}update(){}}let vl=0;const hl={animation:{Feature:class extends gl{constructor(e){super(e),e.animationState||(e.animationState=ul(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();ci(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:n}=this.node.prevProps||{};e!==n&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),null===(e=this.unmountControls)||void 0===e||e.call(this)}}},exit:{Feature:class extends gl{constructor(){super(...arguments),this.id=vl++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:n}=this.node.presenceContext,{isPresent:t}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===t)return;const r=this.node.animationState.setActive("exit",!e);n&&!e&&r.then(()=>n(this.id))}mount(){const{register:e}=this.node.presenceContext||{};e&&(this.unmount=e(this.id))}unmount(){}}}},fl={x:!1,y:!1};function bl(){return fl.x||fl.y}const xl=e=>"mouse"===e.pointerType?"number"!=typeof e.button||e.button<=0:!1!==e.isPrimary;function yl(e,n,t,r={passive:!0}){return e.addEventListener(n,t,r),()=>e.removeEventListener(n,t)}function kl(e){return{point:{x:e.pageX,y:e.pageY}}}function wl(e,n,t,r){return yl(e,n,(e=>n=>xl(n)&&e(n,kl(n)))(t),r)}const jl=(e,n)=>Math.abs(e-n);class Sl{constructor(e,n,{transformPagePoint:t,contextWindow:r,dragSnapToOrigin:i=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!this.lastMoveEvent||!this.lastMoveEventInfo)return;const e=Pl(this.lastMoveEventInfo,this.history),n=null!==this.startEvent,t=function(e,n){const t=jl(e.x,n.x),r=jl(e.y,n.y);return Math.sqrt(t**2+r**2)}(e.offset,{x:0,y:0})>=3;if(!n&&!t)return;const{point:r}=e,{timestamp:i}=Mi;this.history.push({...r,timestamp:i});const{onStart:a,onMove:o}=this.handlers;n||(a&&a(this.lastMoveEvent,e),this.startEvent=this.lastMoveEvent),o&&o(this.lastMoveEvent,e)},this.handlePointerMove=(e,n)=>{this.lastMoveEvent=e,this.lastMoveEventInfo=Cl(n,this.transformPagePoint),Ei.update(this.updatePoint,!0)},this.handlePointerUp=(e,n)=>{this.end();const{onEnd:t,onSessionEnd:r,resumeAnimation:i}=this.handlers;if(this.dragSnapToOrigin&&i&&i(),!this.lastMoveEvent||!this.lastMoveEventInfo)return;const a=Pl("pointercancel"===e.type?this.lastMoveEventInfo:Cl(n,this.transformPagePoint),this.history);this.startEvent&&t&&t(e,a),r&&r(e,a)},!xl(e))return;this.dragSnapToOrigin=i,this.handlers=n,this.transformPagePoint=t,this.contextWindow=r||window;const a=Cl(kl(e),this.transformPagePoint),{point:o}=a,{timestamp:s}=Mi;this.history=[{...o,timestamp:s}];const{onSessionStart:l}=n;l&&l(e,Pl(a,this.history)),this.removeListeners=ts(wl(this.contextWindow,"pointermove",this.handlePointerMove),wl(this.contextWindow,"pointerup",this.handlePointerUp),wl(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),Oi(this.updatePoint)}}function Cl(e,n){return n?{point:n(e.point)}:e}function Nl(e,n){return{x:e.x-n.x,y:e.y-n.y}}function Pl({point:e},n){return{point:e,delta:Nl(e,Ol(n)),offset:Nl(e,El(n)),velocity:Ml(n,.1)}}function El(e){return e[0]}function Ol(e){return e[e.length-1]}function Ml(e,n){if(e.length<2)return{x:0,y:0};let t=e.length-1,r=null;const i=Ol(e);for(;t>=0&&(r=e[t],!(i.timestamp-r.timestamp>Zi(n)));)t--;if(!r)return{x:0,y:0};const a=Ji(i.timestamp-r.timestamp);if(0===a)return{x:0,y:0};const o={x:(i.x-r.x)/a,y:(i.y-r.y)/a};return o.x===1/0&&(o.x=0),o.y===1/0&&(o.y=0),o}function zl(e){return e&&"object"==typeof e&&Object.prototype.hasOwnProperty.call(e,"current")}function Tl(e){return e.max-e.min}function Il(e,n,t,r=.5){e.origin=r,e.originPoint=Ko(n.min,n.max,e.origin),e.scale=Tl(t)/Tl(n),e.translate=Ko(t.min,t.max,e.origin)-e.originPoint,(e.scale>=.9999&&e.scale<=1.0001||isNaN(e.scale))&&(e.scale=1),(e.translate>=-.01&&e.translate<=.01||isNaN(e.translate))&&(e.translate=0)}function Ll(e,n,t,r){Il(e.x,n.x,t.x,r?r.originX:void 0),Il(e.y,n.y,t.y,r?r.originY:void 0)}function Dl(e,n,t){e.min=t.min+n.min,e.max=e.min+Tl(n)}function Al(e,n,t){e.min=n.min-t.min,e.max=e.min+Tl(n)}function Rl(e,n,t){Al(e.x,n.x,t.x),Al(e.y,n.y,t.y)}function Bl(e,n,t){return{min:void 0!==n?e.min+n:void 0,max:void 0!==t?e.max+t-(e.max-e.min):void 0}}function _l(e,n){let t=n.min-e.min,r=n.max-e.max;return n.max-n.min<e.max-e.min&&([t,r]=[r,t]),{min:t,max:r}}const Ul=.35;function Fl(e,n,t){return{min:Wl(e,n),max:Wl(e,t)}}function Wl(e,n){return"number"==typeof e?e:e[n]||0}const Hl=()=>({x:{min:0,max:0},y:{min:0,max:0}});function Vl(e){return[e("x"),e("y")]}function ql({top:e,left:n,right:t,bottom:r}){return{x:{min:n,max:t},y:{min:e,max:r}}}function $l(e){return void 0===e||1===e}function Yl({scale:e,scaleX:n,scaleY:t}){return!$l(e)||!$l(n)||!$l(t)}function Kl(e){return Yl(e)||Ql(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function Ql(e){return Gl(e.x)||Gl(e.y)}function Gl(e){return e&&"0%"!==e}function Xl(e,n,t){return t+n*(e-t)}function Zl(e,n,t,r,i){return void 0!==i&&(e=Xl(e,i,r)),Xl(e,t,r)+n}function Jl(e,n=0,t=1,r,i){e.min=Zl(e.min,n,t,r,i),e.max=Zl(e.max,n,t,r,i)}function ec(e,{x:n,y:t}){Jl(e.x,n.translate,n.scale,n.originPoint),Jl(e.y,t.translate,t.scale,t.originPoint)}const nc=.999999999999,tc=1.0000000000001;function rc(e,n){e.min=e.min+n,e.max=e.max+n}function ic(e,n,t,r,i=.5){Jl(e,n,t,Ko(e.min,e.max,i),r)}function ac(e,n){ic(e.x,n.x,n.scaleX,n.scale,n.originX),ic(e.y,n.y,n.scaleY,n.scale,n.originY)}function oc(e,n){return ql(function(e,n){if(!n)return e;const t=n({x:e.left,y:e.top}),r=n({x:e.right,y:e.bottom});return{top:t.y,left:t.x,bottom:r.y,right:r.x}}(e.getBoundingClientRect(),n))}const sc=({current:e})=>e?e.ownerDocument.defaultView:null,lc=new WeakMap;class cc{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic={x:{min:0,max:0},y:{min:0,max:0}},this.visualElement=e}start(e,{snapToCursor:n=!1}={}){const{presenceContext:t}=this.visualElement;if(t&&!1===t.isPresent)return;const{dragSnapToOrigin:r}=this.getProps();this.panSession=new Sl(e,{onSessionStart:e=>{const{dragSnapToOrigin:t}=this.getProps();t?this.pauseAnimation():this.stopAnimation(),n&&this.snapToCursor(kl(e).point)},onStart:(e,n)=>{const{drag:t,dragPropagation:r,onDragStart:i}=this.getProps();if(t&&!r&&(this.openDragLock&&this.openDragLock(),this.openDragLock="x"===(a=t)||"y"===a?fl[a]?null:(fl[a]=!0,()=>{fl[a]=!1}):fl.x||fl.y?null:(fl.x=fl.y=!0,()=>{fl.x=fl.y=!1}),!this.openDragLock))return;var a;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Vl(e=>{let n=this.getAxisMotionValue(e).get()||0;if(Ua.test(n)){const{projection:t}=this.visualElement;if(t&&t.layout){const r=t.layout.layoutBox[e];if(r){n=Tl(r)*(parseFloat(n)/100)}}}this.originPoint[e]=n}),i&&Ei.postRender(()=>i(e,n)),Vi(this.visualElement,"transform");const{animationState:o}=this.visualElement;o&&o.setActive("whileDrag",!0)},onMove:(e,n)=>{const{dragPropagation:t,dragDirectionLock:r,onDirectionLock:i,onDrag:a}=this.getProps();if(!t&&!this.openDragLock)return;const{offset:o}=n;if(r&&null===this.currentDirection)return this.currentDirection=function(e,n=10){let t=null;Math.abs(e.y)>n?t="y":Math.abs(e.x)>n&&(t="x");return t}(o),void(null!==this.currentDirection&&i&&i(this.currentDirection));this.updateAxis("x",n.point,o),this.updateAxis("y",n.point,o),this.visualElement.render(),a&&a(e,n)},onSessionEnd:(e,n)=>this.stop(e,n),resumeAnimation:()=>Vl(e=>{var n;return"paused"===this.getAnimationState(e)&&(null===(n=this.getAxisMotionValue(e).animation)||void 0===n?void 0:n.play())})},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:r,contextWindow:sc(this.visualElement)})}stop(e,n){const t=this.isDragging;if(this.cancel(),!t)return;const{velocity:r}=n;this.startAnimation(r);const{onDragEnd:i}=this.getProps();i&&Ei.postRender(()=>i(e,n))}cancel(){this.isDragging=!1;const{projection:e,animationState:n}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:t}=this.getProps();!t&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),n&&n.setActive("whileDrag",!1)}updateAxis(e,n,t){const{drag:r}=this.getProps();if(!t||!uc(e,r,this.currentDirection))return;const i=this.getAxisMotionValue(e);let a=this.originPoint[e]+t[e];this.constraints&&this.constraints[e]&&(a=function(e,{min:n,max:t},r){return void 0!==n&&e<n?e=r?Ko(n,e,r.min):Math.max(e,n):void 0!==t&&e>t&&(e=r?Ko(t,e,r.max):Math.min(e,t)),e}(a,this.constraints[e],this.elastic[e])),i.set(a)}resolveConstraints(){var e;const{dragConstraints:n,dragElastic:t}=this.getProps(),r=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):null===(e=this.visualElement.projection)||void 0===e?void 0:e.layout,i=this.constraints;n&&zl(n)?this.constraints||(this.constraints=this.resolveRefConstraints()):this.constraints=!(!n||!r)&&function(e,{top:n,left:t,bottom:r,right:i}){return{x:Bl(e.x,t,i),y:Bl(e.y,n,r)}}(r.layoutBox,n),this.elastic=function(e=Ul){return!1===e?e=0:!0===e&&(e=Ul),{x:Fl(e,"left","right"),y:Fl(e,"top","bottom")}}(t),i!==this.constraints&&r&&this.constraints&&!this.hasMutatedConstraints&&Vl(e=>{!1!==this.constraints&&this.getAxisMotionValue(e)&&(this.constraints[e]=function(e,n){const t={};return void 0!==n.min&&(t.min=n.min-e.min),void 0!==n.max&&(t.max=n.max-e.min),t}(r.layoutBox[e],this.constraints[e]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:n}=this.getProps();if(!e||!zl(e))return!1;const t=e.current;Eo(null!==t,"If `dragConstraints` is set as a React ref, that ref must be passed to another component's `ref` prop.");const{projection:r}=this.visualElement;if(!r||!r.layout)return!1;const i=function(e,n,t){const r=oc(e,t),{scroll:i}=n;return i&&(rc(r.x,i.offset.x),rc(r.y,i.offset.y)),r}(t,r.root,this.visualElement.getTransformPagePoint());let a=function(e,n){return{x:_l(e.x,n.x),y:_l(e.y,n.y)}}(r.layout.layoutBox,i);if(n){const e=n(function({x:e,y:n}){return{top:n.min,right:e.max,bottom:n.max,left:e.min}}(a));this.hasMutatedConstraints=!!e,e&&(a=ql(e))}return a}startAnimation(e){const{drag:n,dragMomentum:t,dragElastic:r,dragTransition:i,dragSnapToOrigin:a,onDragTransitionEnd:o}=this.getProps(),s=this.constraints||{},l=Vl(o=>{if(!uc(o,n,this.currentDirection))return;let l=s&&s[o]||{};a&&(l={min:0,max:0});const c=r?200:1e6,u=r?40:1e7,d={type:"inertia",velocity:t?e[o]:0,bounceStiffness:c,bounceDamping:u,timeConstant:750,restDelta:1,restSpeed:10,...i,...l};return this.startAxisValueAnimation(o,d)});return Promise.all(l).then(o)}startAxisValueAnimation(e,n){const t=this.getAxisMotionValue(e);return Vi(this.visualElement,e),t.start(el(e,t,0,n,this.visualElement,!1))}stopAnimation(){Vl(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){Vl(e=>{var n;return null===(n=this.getAxisMotionValue(e).animation)||void 0===n?void 0:n.pause()})}getAnimationState(e){var n;return null===(n=this.getAxisMotionValue(e).animation)||void 0===n?void 0:n.state}getAxisMotionValue(e){const n=`_drag${e.toUpperCase()}`,t=this.visualElement.getProps(),r=t[n];return r||this.visualElement.getValue(e,(t.initial?t.initial[e]:void 0)||0)}snapToCursor(e){Vl(n=>{const{drag:t}=this.getProps();if(!uc(n,t,this.currentDirection))return;const{projection:r}=this.visualElement,i=this.getAxisMotionValue(n);if(r&&r.layout){const{min:t,max:a}=r.layout.layoutBox[n];i.set(e[n]-Ko(t,a,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:n}=this.getProps(),{projection:t}=this.visualElement;if(!zl(n)||!t||!this.constraints)return;this.stopAnimation();const r={x:0,y:0};Vl(e=>{const n=this.getAxisMotionValue(e);if(n&&!1!==this.constraints){const t=n.get();r[e]=function(e,n){let t=.5;const r=Tl(e),i=Tl(n);return i>r?t=sa(n.min,n.max-r,e.min):r>i&&(t=sa(e.min,e.max-i,n.min)),Na(0,1,t)}({min:t,max:t},this.constraints[e])}});const{transformTemplate:i}=this.visualElement.getProps();this.visualElement.current.style.transform=i?i({},""):"none",t.root&&t.root.updateScroll(),t.updateLayout(),this.resolveConstraints(),Vl(n=>{if(!uc(n,e,null))return;const t=this.getAxisMotionValue(n),{min:i,max:a}=this.constraints[n];t.set(Ko(i,a,r[n]))})}addListeners(){if(!this.visualElement.current)return;lc.set(this.visualElement,this);const e=wl(this.visualElement.current,"pointerdown",e=>{const{drag:n,dragListener:t=!0}=this.getProps();n&&t&&this.start(e)}),n=()=>{const{dragConstraints:e}=this.getProps();zl(e)&&e.current&&(this.constraints=this.resolveRefConstraints())},{projection:t}=this.visualElement,r=t.addEventListener("measure",n);t&&!t.layout&&(t.root&&t.root.updateScroll(),t.updateLayout()),Ei.read(n);const i=yl(window,"resize",()=>this.scalePositionWithinConstraints()),a=t.addEventListener("didUpdate",({delta:e,hasLayoutChanged:n})=>{this.isDragging&&n&&(Vl(n=>{const t=this.getAxisMotionValue(n);t&&(this.originPoint[n]+=e[n].translate,t.set(t.get()+e[n].translate))}),this.visualElement.render())});return()=>{i(),e(),r(),a&&a()}}getProps(){const e=this.visualElement.getProps(),{drag:n=!1,dragDirectionLock:t=!1,dragPropagation:r=!1,dragConstraints:i=!1,dragElastic:a=Ul,dragMomentum:o=!0}=e;return{...e,drag:n,dragDirectionLock:t,dragPropagation:r,dragConstraints:i,dragElastic:a,dragMomentum:o}}}function uc(e,n,t){return!(!0!==n&&n!==e||null!==t&&t!==e)}const dc=e=>(n,t)=>{e&&Ei.postRender(()=>e(n,t))};const mc=(0,Je.createContext)({}),pc={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function gc(e,n){return n.max===n.min?0:e/(n.max-n.min)*100}const vc={correct:(e,n)=>{if(!n.target)return e;if("string"==typeof e){if(!Fa.test(e))return e;e=parseFloat(e)}return`${gc(e,n.target.x)}% ${gc(e,n.target.y)}%`}},hc={correct:(e,{treeScale:n,projectionDelta:t})=>{const r=e,i=no.parse(e);if(i.length>5)return r;const a=no.createTransformer(e),o="number"!=typeof i[0]?1:0,s=t.x.scale*n.x,l=t.y.scale*n.y;i[0+o]/=s,i[1+o]/=l;const c=Ko(s,l,.5);return"number"==typeof i[2+o]&&(i[2+o]/=c),"number"==typeof i[3+o]&&(i[3+o]/=c),a(i)}},fc={};const{schedule:bc,cancel:xc}=Pi(queueMicrotask,!1);class yc extends Je.Component{componentDidMount(){const{visualElement:e,layoutGroup:n,switchLayoutGroup:t,layoutId:r}=this.props,{projection:i}=e;var a;a=wc,Object.assign(fc,a),i&&(n.group&&n.group.add(i),t&&t.register&&r&&t.register(i),i.root.didUpdate(),i.addEventListener("animationComplete",()=>{this.safeToRemove()}),i.setOptions({...i.options,onExitComplete:()=>this.safeToRemove()})),pc.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:n,visualElement:t,drag:r,isPresent:i}=this.props,a=t.projection;return a?(a.isPresent=i,r||e.layoutDependency!==n||void 0===n?a.willUpdate():this.safeToRemove(),e.isPresent!==i&&(i?a.promote():a.relegate()||Ei.postRender(()=>{const e=a.getStack();e&&e.members.length||this.safeToRemove()})),null):null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),bc.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:n,switchLayoutGroup:t}=this.props,{projection:r}=e;r&&(r.scheduleCheckAfterUnmount(),n&&n.group&&n.group.remove(r),t&&t.deregister&&t.deregister(r))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function kc(e){const[n,t]=ti(),r=(0,Je.useContext)(Kr);return(0,nn.jsx)(yc,{...e,layoutGroup:r,switchLayoutGroup:(0,Je.useContext)(mc),isPresent:n,safeToRemove:t})}const wc={borderRadius:{...vc,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:vc,borderTopRightRadius:vc,borderBottomLeftRadius:vc,borderBottomRightRadius:vc,boxShadow:hc};const jc=(e,n)=>e.depth-n.depth;class Sc{constructor(){this.children=[],this.isDirty=!1}add(e){Di(this.children,e),this.isDirty=!0}remove(e){Ai(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(jc),this.isDirty=!1,this.children.forEach(e)}}function Cc(e,n){const t=Li.now(),r=({timestamp:i})=>{const a=i-t;a>=n&&(Oi(r),e(a-n))};return Ei.read(r,!0),()=>Oi(r)}function Nc(e){const n=Hi(e)?e.get():e;return t=n,Boolean(t&&"object"==typeof t&&t.mix&&t.toValue)?n.toValue():n;var t}const Pc=["TopLeft","TopRight","BottomLeft","BottomRight"],Ec=Pc.length,Oc=e=>"string"==typeof e?parseFloat(e):e,Mc=e=>"number"==typeof e||Fa.test(e);function zc(e,n){return void 0!==e[n]?e[n]:e.borderRadius}const Tc=Lc(0,.5,wa),Ic=Lc(.5,.95,Ci);function Lc(e,n,t){return r=>r<e?0:r>n?1:t(sa(e,n,r))}function Dc(e,n){e.min=n.min,e.max=n.max}function Ac(e,n){Dc(e.x,n.x),Dc(e.y,n.y)}function Rc(e,n){e.translate=n.translate,e.scale=n.scale,e.originPoint=n.originPoint,e.origin=n.origin}function Bc(e,n,t,r,i){return e=Xl(e-=n,1/t,r),void 0!==i&&(e=Xl(e,1/i,r)),e}function _c(e,n,[t,r,i],a,o){!function(e,n=0,t=1,r=.5,i,a=e,o=e){Ua.test(n)&&(n=parseFloat(n),n=Ko(o.min,o.max,n/100)-o.min);if("number"!=typeof n)return;let s=Ko(a.min,a.max,r);e===a&&(s-=n),e.min=Bc(e.min,n,t,s,i),e.max=Bc(e.max,n,t,s,i)}(e,n[t],n[r],n[i],n.scale,a,o)}const Uc=["x","scaleX","originX"],Fc=["y","scaleY","originY"];function Wc(e,n,t,r){_c(e.x,n,Uc,t?t.x:void 0,r?r.x:void 0),_c(e.y,n,Fc,t?t.y:void 0,r?r.y:void 0)}function Hc(e){return 0===e.translate&&1===e.scale}function Vc(e){return Hc(e.x)&&Hc(e.y)}function qc(e,n){return e.min===n.min&&e.max===n.max}function $c(e,n){return Math.round(e.min)===Math.round(n.min)&&Math.round(e.max)===Math.round(n.max)}function Yc(e,n){return $c(e.x,n.x)&&$c(e.y,n.y)}function Kc(e){return Tl(e.x)/Tl(e.y)}function Qc(e,n){return e.translate===n.translate&&e.scale===n.scale&&e.originPoint===n.originPoint}class Gc{constructor(){this.members=[]}add(e){Di(this.members,e),e.scheduleRender()}remove(e){if(Ai(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const e=this.members[this.members.length-1];e&&this.promote(e)}}relegate(e){const n=this.members.findIndex(n=>e===n);if(0===n)return!1;let t;for(let e=n;e>=0;e--){const n=this.members[e];if(!1!==n.isPresent){t=n;break}}return!!t&&(this.promote(t),!0)}promote(e,n){const t=this.lead;if(e!==t&&(this.prevLead=t,this.lead=e,e.show(),t)){t.instance&&t.scheduleRender(),e.scheduleRender(),e.resumeFrom=t,n&&(e.resumeFrom.preserveOpacity=!0),t.snapshot&&(e.snapshot=t.snapshot,e.snapshot.latestValues=t.animationValues||t.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:r}=e.options;!1===r&&t.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:n,resumingFrom:t}=e;n.onExitComplete&&n.onExitComplete(),t&&t.options.onExitComplete&&t.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}const Xc={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},Zc="undefined"!=typeof window&&void 0!==window.MotionDebug,Jc=["","X","Y","Z"],eu={visibility:"hidden"};let nu=0;function tu(e,n,t,r){const{latestValues:i}=n;i[e]&&(t[e]=i[e],n.setStaticValue(e,0),r&&(r[e]=0))}function ru(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:n}=e.options;if(!n)return;const t=Yi(n);if(window.MotionHasOptimisedAnimation(t,"transform")){const{layout:n,layoutId:r}=e.options;window.MotionCancelOptimisedAnimation(t,"transform",Ei,!(n||r))}const{parent:r}=e;r&&!r.hasCheckedOptimisedAppear&&ru(r)}function iu({attachResizeListener:e,defaultParent:n,measureScroll:t,checkIsScrollRoot:r,resetTransform:i}){return class{constructor(e={},t=(null==n?void 0:n())){this.id=nu++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,Zc&&(Xc.totalNodes=Xc.resolvedTargetDeltas=Xc.recalculatedProjection=0),this.nodes.forEach(su),this.nodes.forEach(gu),this.nodes.forEach(vu),this.nodes.forEach(lu),Zc&&window.MotionDebug.record(Xc)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=e,this.root=t?t.root||t:this,this.path=t?[...t.path,t]:[],this.parent=t,this.depth=t?t.depth+1:0;for(let e=0;e<this.path.length;e++)this.path[e].shouldResetTransform=!0;this.root===this&&(this.nodes=new Sc)}addEventListener(e,n){return this.eventHandlers.has(e)||this.eventHandlers.set(e,new Ri),this.eventHandlers.get(e).add(n)}notifyListeners(e,...n){const t=this.eventHandlers.get(e);t&&t.notify(...n)}hasListeners(e){return this.eventHandlers.has(e)}mount(n,t=this.root.hasTreeAnimated){if(this.instance)return;var r;this.isSVG=(r=n)instanceof SVGElement&&"svg"!==r.tagName,this.instance=n;const{layoutId:i,layout:a,visualElement:o}=this.options;if(o&&!o.current&&o.mount(n),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),t&&(a||i)&&(this.isLayoutDirty=!0),e){let t;const r=()=>this.root.updateBlockedByResize=!1;e(n,()=>{this.root.updateBlockedByResize=!0,t&&t(),t=Cc(r,250),pc.hasAnimatedSinceResize&&(pc.hasAnimatedSinceResize=!1,this.nodes.forEach(pu))})}i&&this.root.registerSharedNode(i,this),!1!==this.options.animate&&o&&(i||a)&&this.addEventListener("didUpdate",({delta:e,hasLayoutChanged:n,hasRelativeTargetChanged:t,layout:r})=>{if(this.isTreeAnimationBlocked())return this.target=void 0,void(this.relativeTarget=void 0);const i=this.options.transition||o.getDefaultTransition()||ku,{onLayoutAnimationStart:a,onLayoutAnimationComplete:s}=o.getProps(),l=!this.targetLayout||!Yc(this.targetLayout,r)||t,c=!n&&t;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||c||n&&(l||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(e,c);const n={...bi(i,"layout"),onPlay:a,onComplete:s};(o.shouldReduceMotion||this.options.layoutRoot)&&(n.delay=0,n.type=!1),this.startAnimation(n)}else n||pu(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=r})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const e=this.getStack();e&&e.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,Oi(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(hu),this.animationId++)}getTransformTemplate(){const{visualElement:e}=this.options;return e&&e.getProps().transformTemplate}willUpdate(e=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked())return void(this.options.onExitComplete&&this.options.onExitComplete());if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&ru(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let e=0;e<this.path.length;e++){const n=this.path[e];n.shouldResetTransform=!0,n.updateScroll("snapshot"),n.options.layoutRoot&&n.willUpdate(!1)}const{layoutId:n,layout:t}=this.options;if(void 0===n&&!t)return;const r=this.getTransformTemplate();this.prevTransformTemplateValue=r?r(this.latestValues,""):void 0,this.updateSnapshot(),e&&this.notifyListeners("willUpdate")}update(){this.updateScheduled=!1;if(this.isUpdateBlocked())return this.unblockUpdate(),this.clearAllSnapshots(),void this.nodes.forEach(uu);this.isUpdating||this.nodes.forEach(du),this.isUpdating=!1,this.nodes.forEach(mu),this.nodes.forEach(au),this.nodes.forEach(ou),this.clearAllSnapshots();const e=Li.now();Mi.delta=Na(0,1e3/60,e-Mi.timestamp),Mi.timestamp=e,Mi.isProcessing=!0,zi.update.process(Mi),zi.preRender.process(Mi),zi.render.process(Mi),Mi.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,bc.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(cu),this.sharedNodes.forEach(fu)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Ei.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Ei.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){!this.snapshot&&this.instance&&(this.snapshot=this.measure())}updateLayout(){if(!this.instance)return;if(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead()||this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let e=0;e<this.path.length;e++){this.path[e].updateScroll()}const e=this.layout;this.layout=this.measure(!1),this.layoutCorrected={x:{min:0,max:0},y:{min:0,max:0}},this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:n}=this.options;n&&n.notify("LayoutMeasure",this.layout.layoutBox,e?e.layoutBox:void 0)}updateScroll(e="measure"){let n=Boolean(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===e&&(n=!1),n){const n=r(this.instance);this.scroll={animationId:this.root.animationId,phase:e,isRoot:n,offset:t(this.instance),wasRoot:this.scroll?this.scroll.isRoot:n}}}resetTransform(){if(!i)return;const e=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,n=this.projectionDelta&&!Vc(this.projectionDelta),t=this.getTransformTemplate(),r=t?t(this.latestValues,""):void 0,a=r!==this.prevTransformTemplateValue;e&&(n||Kl(this.latestValues)||a)&&(i(this.instance,r),this.shouldResetTransform=!1,this.scheduleRender())}measure(e=!0){const n=this.measurePageBox();let t=this.removeElementScroll(n);var r;return e&&(t=this.removeTransform(t)),Su((r=t).x),Su(r.y),{animationId:this.root.animationId,measuredBox:n,layoutBox:t,latestValues:{},source:this.id}}measurePageBox(){var e;const{visualElement:n}=this.options;if(!n)return{x:{min:0,max:0},y:{min:0,max:0}};const t=n.measureViewportBox();if(!((null===(e=this.scroll)||void 0===e?void 0:e.wasRoot)||this.path.some(Nu))){const{scroll:e}=this.root;e&&(rc(t.x,e.offset.x),rc(t.y,e.offset.y))}return t}removeElementScroll(e){var n;const t={x:{min:0,max:0},y:{min:0,max:0}};if(Ac(t,e),null===(n=this.scroll)||void 0===n?void 0:n.wasRoot)return t;for(let n=0;n<this.path.length;n++){const r=this.path[n],{scroll:i,options:a}=r;r!==this.root&&i&&a.layoutScroll&&(i.wasRoot&&Ac(t,e),rc(t.x,i.offset.x),rc(t.y,i.offset.y))}return t}applyTransform(e,n=!1){const t={x:{min:0,max:0},y:{min:0,max:0}};Ac(t,e);for(let e=0;e<this.path.length;e++){const r=this.path[e];!n&&r.options.layoutScroll&&r.scroll&&r!==r.root&&ac(t,{x:-r.scroll.offset.x,y:-r.scroll.offset.y}),Kl(r.latestValues)&&ac(t,r.latestValues)}return Kl(this.latestValues)&&ac(t,this.latestValues),t}removeTransform(e){const n={x:{min:0,max:0},y:{min:0,max:0}};Ac(n,e);for(let e=0;e<this.path.length;e++){const t=this.path[e];if(!t.instance)continue;if(!Kl(t.latestValues))continue;Yl(t.latestValues)&&t.updateSnapshot();const r=Hl();Ac(r,t.measurePageBox()),Wc(n,t.latestValues,t.snapshot?t.snapshot.layoutBox:void 0,r)}return Kl(this.latestValues)&&Wc(n,this.latestValues),n}setTargetDelta(e){this.targetDelta=e,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(e){this.options={...this.options,...e,crossfade:void 0===e.crossfade||e.crossfade}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Mi.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(e=!1){var n;const t=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=t.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=t.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=t.isSharedProjectionDirty);const r=Boolean(this.resumingFrom)||this!==t;if(!(e||r&&this.isSharedProjectionDirty||this.isProjectionDirty||(null===(n=this.parent)||void 0===n?void 0:n.isProjectionDirty)||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:i,layoutId:a}=this.options;if(this.layout&&(i||a)){if(this.resolvedRelativeTargetAt=Mi.timestamp,!this.targetDelta&&!this.relativeTarget){const e=this.getClosestProjectingParent();e&&e.layout&&1!==this.animationProgress?(this.relativeParent=e,this.forceRelativeParentToResolveTarget(),this.relativeTarget={x:{min:0,max:0},y:{min:0,max:0}},this.relativeTargetOrigin={x:{min:0,max:0},y:{min:0,max:0}},Rl(this.relativeTargetOrigin,this.layout.layoutBox,e.layout.layoutBox),Ac(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(this.relativeTarget||this.targetDelta){var o,s,l;if(this.target||(this.target={x:{min:0,max:0},y:{min:0,max:0}},this.targetWithTransforms={x:{min:0,max:0},y:{min:0,max:0}}),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),o=this.target,s=this.relativeTarget,l=this.relativeParent.target,Dl(o.x,s.x,l.x),Dl(o.y,s.y,l.y)):this.targetDelta?(Boolean(this.resumingFrom)?this.target=this.applyTransform(this.layout.layoutBox):Ac(this.target,this.layout.layoutBox),ec(this.target,this.targetDelta)):Ac(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const e=this.getClosestProjectingParent();e&&Boolean(e.resumingFrom)===Boolean(this.resumingFrom)&&!e.options.layoutScroll&&e.target&&1!==this.animationProgress?(this.relativeParent=e,this.forceRelativeParentToResolveTarget(),this.relativeTarget={x:{min:0,max:0},y:{min:0,max:0}},this.relativeTargetOrigin={x:{min:0,max:0},y:{min:0,max:0}},Rl(this.relativeTargetOrigin,this.target,e.target),Ac(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}Zc&&Xc.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(this.parent&&!Yl(this.parent.latestValues)&&!Ql(this.parent.latestValues))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return Boolean((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var e;const n=this.getLead(),t=Boolean(this.resumingFrom)||this!==n;let r=!0;if((this.isProjectionDirty||(null===(e=this.parent)||void 0===e?void 0:e.isProjectionDirty))&&(r=!1),t&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(r=!1),this.resolvedRelativeTargetAt===Mi.timestamp&&(r=!1),r)return;const{layout:i,layoutId:a}=this.options;if(this.isTreeAnimating=Boolean(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!i&&!a)return;Ac(this.layoutCorrected,this.layout.layoutBox);const o=this.treeScale.x,s=this.treeScale.y;!function(e,n,t,r=!1){const i=t.length;if(!i)return;let a,o;n.x=n.y=1;for(let s=0;s<i;s++){a=t[s],o=a.projectionDelta;const{visualElement:i}=a.options;i&&i.props.style&&"contents"===i.props.style.display||(r&&a.options.layoutScroll&&a.scroll&&a!==a.root&&ac(e,{x:-a.scroll.offset.x,y:-a.scroll.offset.y}),o&&(n.x*=o.x.scale,n.y*=o.y.scale,ec(e,o)),r&&Kl(a.latestValues)&&ac(e,a.latestValues))}n.x<tc&&n.x>nc&&(n.x=1),n.y<tc&&n.y>nc&&(n.y=1)}(this.layoutCorrected,this.treeScale,this.path,t),!n.layout||n.target||1===this.treeScale.x&&1===this.treeScale.y||(n.target=n.layout.layoutBox,n.targetWithTransforms={x:{min:0,max:0},y:{min:0,max:0}});const{target:l}=n;l?(this.projectionDelta&&this.prevProjectionDelta?(Rc(this.prevProjectionDelta.x,this.projectionDelta.x),Rc(this.prevProjectionDelta.y,this.projectionDelta.y)):this.createProjectionDeltas(),Ll(this.projectionDelta,this.layoutCorrected,l,this.latestValues),this.treeScale.x===o&&this.treeScale.y===s&&Qc(this.projectionDelta.x,this.prevProjectionDelta.x)&&Qc(this.projectionDelta.y,this.prevProjectionDelta.y)||(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",l)),Zc&&Xc.recalculatedProjection++):this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender())}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(e=!0){var n;if(null===(n=this.options.visualElement)||void 0===n||n.scheduleRender(),e){const e=this.getStack();e&&e.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}},this.projectionDelta={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}},this.projectionDeltaWithTransform={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}}}setAnimationOrigin(e,n=!1){const t=this.snapshot,r=t?t.latestValues:{},i={...this.latestValues},a={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};this.relativeParent&&this.relativeParent.options.layoutRoot||(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!n;const o={x:{min:0,max:0},y:{min:0,max:0}},s=(t?t.source:void 0)!==(this.layout?this.layout.source:void 0),l=this.getStack(),c=!l||l.members.length<=1,u=Boolean(s&&!c&&!0===this.options.crossfade&&!this.path.some(yu));let d;this.animationProgress=0,this.mixTargetDelta=n=>{const t=n/1e3;var l,m,p,g,v,h;bu(a.x,e.x,t),bu(a.y,e.y,t),this.setTargetDelta(a),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Rl(o,this.layout.layoutBox,this.relativeParent.layout.layoutBox),p=this.relativeTarget,g=this.relativeTargetOrigin,v=o,h=t,xu(p.x,g.x,v.x,h),xu(p.y,g.y,v.y,h),d&&(l=this.relativeTarget,m=d,qc(l.x,m.x)&&qc(l.y,m.y))&&(this.isProjectionDirty=!1),d||(d={x:{min:0,max:0},y:{min:0,max:0}}),Ac(d,this.relativeTarget)),s&&(this.animationValues=i,function(e,n,t,r,i,a){i?(e.opacity=Ko(0,void 0!==t.opacity?t.opacity:1,Tc(r)),e.opacityExit=Ko(void 0!==n.opacity?n.opacity:1,0,Ic(r))):a&&(e.opacity=Ko(void 0!==n.opacity?n.opacity:1,void 0!==t.opacity?t.opacity:1,r));for(let i=0;i<Ec;i++){const a=`border${Pc[i]}Radius`;let o=zc(n,a),s=zc(t,a);void 0===o&&void 0===s||(o||(o=0),s||(s=0),0===o||0===s||Mc(o)===Mc(s)?(e[a]=Math.max(Ko(Oc(o),Oc(s),r),0),(Ua.test(s)||Ua.test(o))&&(e[a]+="%")):e[a]=s)}(n.rotate||t.rotate)&&(e.rotate=Ko(n.rotate||0,t.rotate||0,r))}(i,r,this.latestValues,t,u,c)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=t},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(e){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(Oi(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Ei.update(()=>{pc.hasAnimatedSinceResize=!0,this.currentAnimation=function(e,n,t){const r=Hi(e)?e:Fi(e);return r.start(el("",r,n,t)),r.animation}(0,1e3,{...e,onUpdate:n=>{this.mixTargetDelta(n),e.onUpdate&&e.onUpdate(n)},onComplete:()=>{e.onComplete&&e.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const e=this.getStack();e&&e.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(1e3),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const e=this.getLead();let{targetWithTransforms:n,target:t,layout:r,latestValues:i}=e;if(n&&t&&r){if(this!==e&&this.layout&&r&&Cu(this.options.animationType,this.layout.layoutBox,r.layoutBox)){t=this.target||{x:{min:0,max:0},y:{min:0,max:0}};const n=Tl(this.layout.layoutBox.x);t.x.min=e.target.x.min,t.x.max=t.x.min+n;const r=Tl(this.layout.layoutBox.y);t.y.min=e.target.y.min,t.y.max=t.y.min+r}Ac(n,t),ac(n,i),Ll(this.projectionDeltaWithTransform,this.layoutCorrected,n,i)}}registerSharedNode(e,n){this.sharedNodes.has(e)||this.sharedNodes.set(e,new Gc);this.sharedNodes.get(e).add(n);const t=n.options.initialPromotionConfig;n.promote({transition:t?t.transition:void 0,preserveFollowOpacity:t&&t.shouldPreserveFollowOpacity?t.shouldPreserveFollowOpacity(n):void 0})}isLead(){const e=this.getStack();return!e||e.lead===this}getLead(){var e;const{layoutId:n}=this.options;return n&&(null===(e=this.getStack())||void 0===e?void 0:e.lead)||this}getPrevLead(){var e;const{layoutId:n}=this.options;return n?null===(e=this.getStack())||void 0===e?void 0:e.prevLead:void 0}getStack(){const{layoutId:e}=this.options;if(e)return this.root.sharedNodes.get(e)}promote({needsReset:e,transition:n,preserveFollowOpacity:t}={}){const r=this.getStack();r&&r.promote(this,t),e&&(this.projectionDelta=void 0,this.needsReset=!0),n&&this.setOptions({transition:n})}relegate(){const e=this.getStack();return!!e&&e.relegate(this)}resetSkewAndRotation(){const{visualElement:e}=this.options;if(!e)return;let n=!1;const{latestValues:t}=e;if((t.z||t.rotate||t.rotateX||t.rotateY||t.rotateZ||t.skewX||t.skewY)&&(n=!0),!n)return;const r={};t.z&&tu("z",e,r,this.animationValues);for(let n=0;n<Jc.length;n++)tu(`rotate${Jc[n]}`,e,r,this.animationValues),tu(`skew${Jc[n]}`,e,r,this.animationValues);e.render();for(const n in r)e.setStaticValue(n,r[n]),this.animationValues&&(this.animationValues[n]=r[n]);e.scheduleRender()}getProjectionStyles(e){var n,t;if(!this.instance||this.isSVG)return;if(!this.isVisible)return eu;const r={visibility:""},i=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,r.opacity="",r.pointerEvents=Nc(null==e?void 0:e.pointerEvents)||"",r.transform=i?i(this.latestValues,""):"none",r;const a=this.getLead();if(!this.projectionDelta||!this.layout||!a.target){const n={};return this.options.layoutId&&(n.opacity=void 0!==this.latestValues.opacity?this.latestValues.opacity:1,n.pointerEvents=Nc(null==e?void 0:e.pointerEvents)||""),this.hasProjected&&!Kl(this.latestValues)&&(n.transform=i?i({},""):"none",this.hasProjected=!1),n}const o=a.animationValues||a.latestValues;this.applyTransformsToTarget(),r.transform=function(e,n,t){let r="";const i=e.x.translate/n.x,a=e.y.translate/n.y,o=(null==t?void 0:t.z)||0;if((i||a||o)&&(r=`translate3d(${i}px, ${a}px, ${o}px) `),1===n.x&&1===n.y||(r+=`scale(${1/n.x}, ${1/n.y}) `),t){const{transformPerspective:e,rotate:n,rotateX:i,rotateY:a,skewX:o,skewY:s}=t;e&&(r=`perspective(${e}px) ${r}`),n&&(r+=`rotate(${n}deg) `),i&&(r+=`rotateX(${i}deg) `),a&&(r+=`rotateY(${a}deg) `),o&&(r+=`skewX(${o}deg) `),s&&(r+=`skewY(${s}deg) `)}const s=e.x.scale*n.x,l=e.y.scale*n.y;return 1===s&&1===l||(r+=`scale(${s}, ${l})`),r||"none"}(this.projectionDeltaWithTransform,this.treeScale,o),i&&(r.transform=i(o,r.transform));const{x:s,y:l}=this.projectionDelta;r.transformOrigin=`${100*s.origin}% ${100*l.origin}% 0`,a.animationValues?r.opacity=a===this?null!==(t=null!==(n=o.opacity)&&void 0!==n?n:this.latestValues.opacity)&&void 0!==t?t:1:this.preserveOpacity?this.latestValues.opacity:o.opacityExit:r.opacity=a===this?void 0!==o.opacity?o.opacity:"":void 0!==o.opacityExit?o.opacityExit:0;for(const e in fc){if(void 0===o[e])continue;const{correct:n,applyTo:t}=fc[e],i="none"===r.transform?o[e]:n(o[e],a);if(t){const e=t.length;for(let n=0;n<e;n++)r[t[n]]=i}else r[e]=i}return this.options.layoutId&&(r.pointerEvents=a===this?Nc(null==e?void 0:e.pointerEvents)||"":"none"),r}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(e=>{var n;return null===(n=e.currentAnimation)||void 0===n?void 0:n.stop()}),this.root.nodes.forEach(uu),this.root.sharedNodes.clear()}}}function au(e){e.updateLayout()}function ou(e){var n;const t=(null===(n=e.resumeFrom)||void 0===n?void 0:n.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&t&&e.hasListeners("didUpdate")){const{layoutBox:n,measuredBox:r}=e.layout,{animationType:i}=e.options,a=t.source!==e.layout.source;"size"===i?Vl(e=>{const r=a?t.measuredBox[e]:t.layoutBox[e],i=Tl(r);r.min=n[e].min,r.max=r.min+i}):Cu(i,t.layoutBox,n)&&Vl(r=>{const i=a?t.measuredBox[r]:t.layoutBox[r],o=Tl(n[r]);i.max=i.min+o,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[r].max=e.relativeTarget[r].min+o)});const o={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};Ll(o,n,t.layoutBox);const s={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};a?Ll(s,e.applyTransform(r,!0),t.measuredBox):Ll(s,n,t.layoutBox);const l=!Vc(o);let c=!1;if(!e.resumeFrom){const r=e.getClosestProjectingParent();if(r&&!r.resumeFrom){const{snapshot:i,layout:a}=r;if(i&&a){const o={x:{min:0,max:0},y:{min:0,max:0}};Rl(o,t.layoutBox,i.layoutBox);const s={x:{min:0,max:0},y:{min:0,max:0}};Rl(s,n,a.layoutBox),Yc(o,s)||(c=!0),r.options.layoutRoot&&(e.relativeTarget=s,e.relativeTargetOrigin=o,e.relativeParent=r)}}}e.notifyListeners("didUpdate",{layout:n,snapshot:t,delta:s,layoutDelta:o,hasLayoutChanged:l,hasRelativeTargetChanged:c})}else if(e.isLead()){const{onExitComplete:n}=e.options;n&&n()}e.options.transition=void 0}function su(e){Zc&&Xc.totalNodes++,e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=Boolean(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function lu(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function cu(e){e.clearSnapshot()}function uu(e){e.clearMeasurements()}function du(e){e.isLayoutDirty=!1}function mu(e){const{visualElement:n}=e.options;n&&n.getProps().onBeforeLayoutMeasure&&n.notify("BeforeLayoutMeasure"),e.resetTransform()}function pu(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function gu(e){e.resolveTargetDelta()}function vu(e){e.calcProjection()}function hu(e){e.resetSkewAndRotation()}function fu(e){e.removeLeadSnapshot()}function bu(e,n,t){e.translate=Ko(n.translate,0,t),e.scale=Ko(n.scale,1,t),e.origin=n.origin,e.originPoint=n.originPoint}function xu(e,n,t,r){e.min=Ko(n.min,t.min,r),e.max=Ko(n.max,t.max,r)}function yu(e){return e.animationValues&&void 0!==e.animationValues.opacityExit}const ku={duration:.45,ease:[.4,0,.1,1]},wu=e=>"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),ju=wu("applewebkit/")&&!wu("chrome/")?Math.round:Ci;function Su(e){e.min=ju(e.min),e.max=ju(e.max)}function Cu(e,n,t){return"position"===e||"preserve-aspect"===e&&(r=Kc(n),i=Kc(t),a=.2,!(Math.abs(r-i)<=a));var r,i,a}function Nu(e){var n;return e!==e.root&&(null===(n=e.scroll)||void 0===n?void 0:n.wasRoot)}const Pu=iu({attachResizeListener:(e,n)=>yl(e,"resize",n),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),Eu={current:void 0},Ou=iu({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!Eu.current){const e=new Pu({});e.mount(window),e.setOptions({layoutScroll:!0}),Eu.current=e}return Eu.current},resetTransform:(e,n)=>{e.style.transform=void 0!==n?n:"none"},checkIsScrollRoot:e=>Boolean("fixed"===window.getComputedStyle(e).position)}),Mu={pan:{Feature:class extends gl{constructor(){super(...arguments),this.removePointerDownListener=Ci}onPointerDown(e){this.session=new Sl(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:sc(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:n,onPan:t,onPanEnd:r}=this.node.getProps();return{onSessionStart:dc(e),onStart:dc(n),onMove:t,onEnd:(e,n)=>{delete this.session,r&&Ei.postRender(()=>r(e,n))}}}mount(){this.removePointerDownListener=wl(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}},drag:{Feature:class extends gl{constructor(e){super(e),this.removeGroupControls=Ci,this.removeListeners=Ci,this.controls=new cc(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Ci}unmount(){this.removeGroupControls(),this.removeListeners()}},ProjectionNode:Ou,MeasureLayout:kc}};function zu(e,n){const t=function(e,n,t){var r;if(e instanceof Element)return[e];if("string"==typeof e){let i=document;n&&(i=n.current);const a=null!==(r=null==t?void 0:t[e])&&void 0!==r?r:i.querySelectorAll(e);return a?Array.from(a):[]}return Array.from(e)}(e),r=new AbortController;return[t,{passive:!0,...n,signal:r.signal},()=>r.abort()]}function Tu(e){return n=>{"touch"===n.pointerType||bl()||e(n)}}function Iu(e,n,t){const{props:r}=e;e.animationState&&r.whileHover&&e.animationState.setActive("whileHover","Start"===t);const i=r["onHover"+t];i&&Ei.postRender(()=>i(n,kl(n)))}const Lu=(e,n)=>!!n&&(e===n||Lu(e,n.parentElement)),Du=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);const Au=new WeakSet;function Ru(e){return n=>{"Enter"===n.key&&e(n)}}function Bu(e,n){e.dispatchEvent(new PointerEvent("pointer"+n,{isPrimary:!0,bubbles:!0}))}function _u(e){return xl(e)&&!bl()}function Uu(e,n,t={}){const[r,i,a]=zu(e,t),o=e=>{const r=e.currentTarget;if(!_u(e)||Au.has(r))return;Au.add(r);const a=n(e),o=(e,n)=>{window.removeEventListener("pointerup",s),window.removeEventListener("pointercancel",l),_u(e)&&Au.has(r)&&(Au.delete(r),"function"==typeof a&&a(e,{success:n}))},s=e=>{o(e,t.useGlobalTarget||Lu(r,e.target))},l=e=>{o(e,!1)};window.addEventListener("pointerup",s,i),window.addEventListener("pointercancel",l,i)};return r.forEach(e=>{(function(e){return Du.has(e.tagName)||-1!==e.tabIndex})(e)||null!==e.getAttribute("tabindex")||(e.tabIndex=0);(t.useGlobalTarget?window:e).addEventListener("pointerdown",o,i),e.addEventListener("focus",e=>((e,n)=>{const t=e.currentTarget;if(!t)return;const r=Ru(()=>{if(Au.has(t))return;Bu(t,"down");const e=Ru(()=>{Bu(t,"up")});t.addEventListener("keyup",e,n),t.addEventListener("blur",()=>Bu(t,"cancel"),n)});t.addEventListener("keydown",r,n),t.addEventListener("blur",()=>t.removeEventListener("keydown",r),n)})(e,i),i)}),a}function Fu(e,n,t){const{props:r}=e;e.animationState&&r.whileTap&&e.animationState.setActive("whileTap","Start"===t);const i=r["onTap"+("End"===t?"":t)];i&&Ei.postRender(()=>i(n,kl(n)))}const Wu=new WeakMap,Hu=new WeakMap,Vu=e=>{const n=Wu.get(e.target);n&&n(e)},qu=e=>{e.forEach(Vu)};function $u(e,n,t){const r=function({root:e,...n}){const t=e||document;Hu.has(t)||Hu.set(t,{});const r=Hu.get(t),i=JSON.stringify(n);return r[i]||(r[i]=new IntersectionObserver(qu,{root:e,...n})),r[i]}(n);return Wu.set(e,t),r.observe(e),()=>{Wu.delete(e),r.unobserve(e)}}const Yu={some:0,all:1};const Ku={inView:{Feature:class extends gl{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:n,margin:t,amount:r="some",once:i}=e,a={root:n?n.current:void 0,rootMargin:t,threshold:"number"==typeof r?r:Yu[r]};return $u(this.node.current,a,e=>{const{isIntersecting:n}=e;if(this.isInView===n)return;if(this.isInView=n,i&&!n&&this.hasEnteredView)return;n&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",n);const{onViewportEnter:t,onViewportLeave:r}=this.node.getProps(),a=n?t:r;a&&a(e)})}mount(){this.startObserver()}update(){if("undefined"==typeof IntersectionObserver)return;const{props:e,prevProps:n}=this.node;["amount","margin","root"].some(function({viewport:e={}},{viewport:n={}}={}){return t=>e[t]!==n[t]}(e,n))&&this.startObserver()}unmount(){}}},tap:{Feature:class extends gl{mount(){const{current:e}=this.node;e&&(this.unmount=Uu(e,e=>(Fu(this.node,e,"Start"),(e,{success:n})=>Fu(this.node,e,n?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}},focus:{Feature:class extends gl{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch(n){e=!0}e&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){this.isActive&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=ts(yl(this.node.current,"focus",()=>this.onFocus()),yl(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}},hover:{Feature:class extends gl{mount(){const{current:e}=this.node;e&&(this.unmount=function(e,n,t={}){const[r,i,a]=zu(e,t),o=Tu(e=>{const{target:t}=e,r=n(e);if("function"!=typeof r||!t)return;const a=Tu(e=>{r(e),t.removeEventListener("pointerleave",a)});t.addEventListener("pointerleave",a,i)});return r.forEach(e=>{e.addEventListener("pointerenter",o,i)}),a}(e,e=>(Iu(this.node,e,"Start"),e=>Iu(this.node,e,"End"))))}unmount(){}}}},Qu={layout:{ProjectionNode:Ou,MeasureLayout:kc}},Gu=(0,Je.createContext)({strict:!1}),Xu=(0,Je.createContext)({});function Zu(e){return ci(e.animate)||fi.some(n=>mi(e[n]))}function Ju(e){return Boolean(Zu(e)||e.variants)}function ed(e){const{initial:n,animate:t}=function(e,n){if(Zu(e)){const{initial:n,animate:t}=e;return{initial:!1===n||mi(n)?n:void 0,animate:mi(t)?t:void 0}}return!1!==e.inherit?n:{}}(e,(0,Je.useContext)(Xu));return(0,Je.useMemo)(()=>({initial:n,animate:t}),[nd(n),nd(t)])}function nd(e){return Array.isArray(e)?e.join(" "):e}const td={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},rd={};for(const e in td)rd[e]={isEnabled:n=>td[e].some(e=>!!n[e])};const id=Symbol.for("motionComponentSymbol");function ad(e,n,t){return(0,Je.useCallback)(r=>{r&&e.onMount&&e.onMount(r),n&&(r?n.mount(r):n.unmount()),t&&("function"==typeof t?t(r):zl(t)&&(t.current=r))},[n])}function od(e,n,t,r,i){var a,o;const{visualElement:s}=(0,Je.useContext)(Xu),l=(0,Je.useContext)(Gu),c=(0,Je.useContext)(Gr),u=(0,Je.useContext)(Xr).reducedMotion,d=(0,Je.useRef)(null);r=r||l.renderer,!d.current&&r&&(d.current=r(e,{visualState:n,parent:s,props:t,presenceContext:c,blockInitialAnimation:!!c&&!1===c.initial,reducedMotionConfig:u}));const m=d.current,p=(0,Je.useContext)(mc);!m||m.projection||!i||"html"!==m.type&&"svg"!==m.type||function(e,n,t,r){const{layoutId:i,layout:a,drag:o,dragConstraints:s,layoutScroll:l,layoutRoot:c}=n;e.projection=new t(e.latestValues,n["data-framer-portal-id"]?void 0:sd(e.parent)),e.projection.setOptions({layoutId:i,layout:a,alwaysMeasureLayout:Boolean(o)||s&&zl(s),visualElement:e,animationType:"string"==typeof a?a:"both",initialPromotionConfig:r,layoutScroll:l,layoutRoot:c})}(d.current,t,i,p);const g=(0,Je.useRef)(!1);(0,Je.useInsertionEffect)(()=>{m&&g.current&&m.update(t,c)});const v=t[$i],h=(0,Je.useRef)(Boolean(v)&&!(null===(a=window.MotionHandoffIsComplete)||void 0===a?void 0:a.call(window,v))&&(null===(o=window.MotionHasOptimisedAnimation)||void 0===o?void 0:o.call(window,v)));return oi(()=>{m&&(g.current=!0,window.MotionIsMounted=!0,m.updateFeatures(),bc.render(m.render),h.current&&m.animationState&&m.animationState.animateChanges())}),(0,Je.useEffect)(()=>{m&&(!h.current&&m.animationState&&m.animationState.animateChanges(),h.current&&(queueMicrotask(()=>{var e;null===(e=window.MotionHandoffMarkAsComplete)||void 0===e||e.call(window,v)}),h.current=!1))}),m}function sd(e){if(e)return!1!==e.options.allowProjection?e.projection:sd(e.parent)}function ld({preloadedFeatures:e,createVisualElement:n,useRender:t,useVisualState:r,Component:i}){var a,o;function s(e,a){let o;const s={...(0,Je.useContext)(Xr),...e,layoutId:cd(e)},{isStatic:l}=s,c=ed(e),u=r(e,l);if(!l&&ai){!function(){(0,Je.useContext)(Gu).strict;0}();const e=function(e){const{drag:n,layout:t}=rd;if(!n&&!t)return{};const r={...n,...t};return{MeasureLayout:(null==n?void 0:n.isEnabled(e))||(null==t?void 0:t.isEnabled(e))?r.MeasureLayout:void 0,ProjectionNode:r.ProjectionNode}}(s);o=e.MeasureLayout,c.visualElement=od(i,u,s,n,e.ProjectionNode)}return(0,nn.jsxs)(Xu.Provider,{value:c,children:[o&&c.visualElement?(0,nn.jsx)(o,{visualElement:c.visualElement,...s}):null,t(i,e,ad(u,c.visualElement,a),u,l,c.visualElement)]})}e&&function(e){for(const n in e)rd[n]={...rd[n],...e[n]}}(e),s.displayName=`motion.${"string"==typeof i?i:`create(${null!==(o=null!==(a=i.displayName)&&void 0!==a?a:i.name)&&void 0!==o?o:""})`}`;const l=(0,Je.forwardRef)(s);return l[id]=i,l}function cd({layoutId:e}){const n=(0,Je.useContext)(Kr).id;return n&&void 0!==e?n+"-"+e:e}const ud=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function dd(e){return"string"==typeof e&&!e.includes("-")&&!!(ud.indexOf(e)>-1||/[A-Z]/u.test(e))}const md=e=>(n,t)=>{const r=(0,Je.useContext)(Xu),i=(0,Je.useContext)(Gr),a=()=>function({scrapeMotionValuesFromProps:e,createRenderState:n,onUpdate:t},r,i,a){const o={latestValues:pd(r,i,a,e),renderState:n()};return t&&(o.onMount=e=>t({props:r,current:e,...o}),o.onUpdate=e=>t(e)),o}(e,n,r,i);return t?a():Qr(a)};function pd(e,n,t,r){const i={},a=r(e,{});for(const e in a)i[e]=Nc(a[e]);let{initial:o,animate:s}=e;const l=Zu(e),c=Ju(e);n&&c&&!l&&!1!==e.inherit&&(void 0===o&&(o=n.initial),void 0===s&&(s=n.animate));let u=!!t&&!1===t.initial;u=u||!1===o;const d=u?s:o;if(d&&"boolean"!=typeof d&&!ci(d)){const n=Array.isArray(d)?d:[d];for(let t=0;t<n.length;t++){const r=gi(e,n[t]);if(r){const{transitionEnd:e,transition:n,...t}=r;for(const e in t){let n=t[e];if(Array.isArray(n)){n=n[u?n.length-1:0]}null!==n&&(i[e]=n)}for(const n in e)i[n]=e[n]}}}return i}const gd=(e,n)=>n&&"number"==typeof e?n.transform(e):e,vd={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},hd=xi.length;function fd(e,n,t){const{style:r,vars:i,transformOrigin:a}=e;let o=!1,s=!1;for(const e in n){const t=n[e];if(yi.has(e))o=!0;else if(zo(e))i[e]=t;else{const n=gd(t,co[e]);e.startsWith("origin")?(s=!0,a[e]=n):r[e]=n}}if(n.transform||(o||t?r.transform=function(e,n,t){let r="",i=!0;for(let a=0;a<hd;a++){const o=xi[a],s=e[o];if(void 0===s)continue;let l=!0;if(l="number"==typeof s?s===(o.startsWith("scale")?1:0):0===parseFloat(s),!l||t){const e=gd(s,co[o]);l||(i=!1,r+=`${vd[o]||o}(${e}) `),t&&(n[o]=e)}}return r=r.trim(),t?r=t(n,i?"":r):i&&(r="none"),r}(n,e.transform,t):r.transform&&(r.transform="none")),s){const{originX:e="50%",originY:n="50%",originZ:t=0}=a;r.transformOrigin=`${e} ${n} ${t}`}}const bd={offset:"stroke-dashoffset",array:"stroke-dasharray"},xd={offset:"strokeDashoffset",array:"strokeDasharray"};function yd(e,n,t){return"string"==typeof e?e:Fa.transform(n+t*e)}function kd(e,{attrX:n,attrY:t,attrScale:r,originX:i,originY:a,pathLength:o,pathSpacing:s=1,pathOffset:l=0,...c},u,d){if(fd(e,c,d),u)return void(e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox));e.attrs=e.style,e.style={};const{attrs:m,style:p,dimensions:g}=e;m.transform&&(g&&(p.transform=m.transform),delete m.transform),g&&(void 0!==i||void 0!==a||p.transform)&&(p.transformOrigin=function(e,n,t){return`${yd(n,e.x,e.width)} ${yd(t,e.y,e.height)}`}(g,void 0!==i?i:.5,void 0!==a?a:.5)),void 0!==n&&(m.x=n),void 0!==t&&(m.y=t),void 0!==r&&(m.scale=r),void 0!==o&&function(e,n,t=1,r=0,i=!0){e.pathLength=1;const a=i?bd:xd;e[a.offset]=Fa.transform(-r);const o=Fa.transform(n),s=Fa.transform(t);e[a.array]=`${o} ${s}`}(m,o,s,l,!1)}const wd=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),jd=()=>({style:{},transform:{},transformOrigin:{},vars:{},attrs:{}}),Sd=e=>"string"==typeof e&&"svg"===e.toLowerCase();function Cd(e,{style:n,vars:t},r,i){Object.assign(e.style,n,i&&i.getProjectionStyles(r));for(const n in t)e.style.setProperty(n,t[n])}const Nd=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function Pd(e,n,t,r){Cd(e,n,void 0,r);for(const t in n.attrs)e.setAttribute(Nd.has(t)?t:qi(t),n.attrs[t])}function Ed(e,{layout:n,layoutId:t}){return yi.has(e)||e.startsWith("origin")||(n||void 0!==t)&&(!!fc[e]||"opacity"===e)}function Od(e,n,t){var r;const{style:i}=e,a={};for(const o in i)(Hi(i[o])||n.style&&Hi(n.style[o])||Ed(o,e)||void 0!==(null===(r=null==t?void 0:t.getValue(o))||void 0===r?void 0:r.liveStyle))&&(a[o]=i[o]);return a}function Md(e,n,t){const r=Od(e,n,t);for(const t in e)if(Hi(e[t])||Hi(n[t])){r[-1!==xi.indexOf(t)?"attr"+t.charAt(0).toUpperCase()+t.substring(1):t]=e[t]}return r}const zd=["x","y","width","height","cx","cy","r"],Td={useVisualState:md({scrapeMotionValuesFromProps:Md,createRenderState:jd,onUpdate:({props:e,prevProps:n,current:t,renderState:r,latestValues:i})=>{if(!t)return;let a=!!e.drag;if(!a)for(const e in i)if(yi.has(e)){a=!0;break}if(!a)return;let o=!n;if(n)for(let t=0;t<zd.length;t++){const r=zd[t];e[r]!==n[r]&&(o=!0)}o&&Ei.read(()=>{!function(e,n){try{n.dimensions="function"==typeof e.getBBox?e.getBBox():e.getBoundingClientRect()}catch(e){n.dimensions={x:0,y:0,width:0,height:0}}}(t,r),Ei.render(()=>{kd(r,i,Sd(t.tagName),e.transformTemplate),Pd(t,r)})})}})},Id={useVisualState:md({scrapeMotionValuesFromProps:Od,createRenderState:wd})};function Ld(e,n,t){for(const r in n)Hi(n[r])||Ed(r,t)||(e[r]=n[r])}function Dd(e,n){const t={};return Ld(t,e.style||{},e),Object.assign(t,function({transformTemplate:e},n){return(0,Je.useMemo)(()=>{const t={style:{},transform:{},transformOrigin:{},vars:{}};return fd(t,n,e),Object.assign({},t.vars,t.style)},[n])}(e,n)),t}function Ad(e,n){const t={},r=Dd(e,n);return e.drag&&!1!==e.dragListener&&(t.draggable=!1,r.userSelect=r.WebkitUserSelect=r.WebkitTouchCallout="none",r.touchAction=!0===e.drag?"none":"pan-"+("x"===e.drag?"y":"x")),void 0===e.tabIndex&&(e.onTap||e.onTapStart||e.whileTap)&&(t.tabIndex=0),t.style=r,t}const Rd=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Bd(e){return e.startsWith("while")||e.startsWith("drag")&&"draggable"!==e||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||Rd.has(e)}let _d=e=>!Bd(e);try{(Ud=require("@emotion/is-prop-valid").default)&&(_d=e=>e.startsWith("on")?!Bd(e):Ud(e))}catch(e){}var Ud;function Fd(e,n,t,r){const i=(0,Je.useMemo)(()=>{const t={style:{},transform:{},transformOrigin:{},vars:{},attrs:{}};return kd(t,n,Sd(r),e.transformTemplate),{...t.attrs,style:{...t.style}}},[n]);if(e.style){const n={};Ld(n,e.style,e),i.style={...n,...i.style}}return i}function Wd(e=!1){return(n,t,r,{latestValues:i},a)=>{const o=(dd(n)?Fd:Ad)(t,i,a,n),s=function(e,n,t){const r={};for(const i in e)"values"===i&&"object"==typeof e.values||(_d(i)||!0===t&&Bd(i)||!n&&!Bd(i)||e.draggable&&i.startsWith("onDrag"))&&(r[i]=e[i]);return r}(t,"string"==typeof n,e),l=n!==Je.Fragment?{...s,...o,ref:r}:{},{children:c}=t,u=(0,Je.useMemo)(()=>Hi(c)?c.get():c,[c]);return(0,Je.createElement)(n,{...l,children:u})}}function Hd(e,n){return function(t,{forwardMotionProps:r}={forwardMotionProps:!1}){return ld({...dd(t)?Td:Id,preloadedFeatures:e,useRender:Wd(r),createVisualElement:n,Component:t})}}const Vd={current:null},qd={current:!1};const $d=[...Bo,$a,no],Yd=new WeakMap;const Kd=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class Qd{scrapeMotionValuesFromProps(e,n,t){return{}}constructor({parent:e,props:n,presenceContext:t,reducedMotionConfig:r,blockInitialAnimation:i,visualState:a},o={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=No,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const e=Li.now();this.renderScheduledAt<e&&(this.renderScheduledAt=e,Ei.render(this.render,!1,!0))};const{latestValues:s,renderState:l,onUpdate:c}=a;this.onUpdate=c,this.latestValues=s,this.baseTarget={...s},this.initialValues=n.initial?{...s}:{},this.renderState=l,this.parent=e,this.props=n,this.presenceContext=t,this.depth=e?e.depth+1:0,this.reducedMotionConfig=r,this.options=o,this.blockInitialAnimation=Boolean(i),this.isControllingVariants=Zu(n),this.isVariantNode=Ju(n),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=Boolean(e&&e.current);const{willChange:u,...d}=this.scrapeMotionValuesFromProps(n,{},this);for(const e in d){const n=d[e];void 0!==s[e]&&Hi(n)&&n.set(s[e],!1)}}mount(e){this.current=e,Yd.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((e,n)=>this.bindToMotionValue(n,e)),qd.current||function(){if(qd.current=!0,ai)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),n=()=>Vd.current=e.matches;e.addListener(n),n()}else Vd.current=!1}(),this.shouldReduceMotion="never"!==this.reducedMotionConfig&&("always"===this.reducedMotionConfig||Vd.current),this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){Yd.delete(this.current),this.projection&&this.projection.unmount(),Oi(this.notifyUpdate),Oi(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const n=this.features[e];n&&(n.unmount(),n.isMounted=!1)}this.current=null}bindToMotionValue(e,n){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const t=yi.has(e),r=n.on("change",n=>{this.latestValues[e]=n,this.props.onUpdate&&Ei.preRender(this.notifyUpdate),t&&this.projection&&(this.projection.isTransformDirty=!0)}),i=n.on("renderRequest",this.scheduleRender);let a;window.MotionCheckAppearSync&&(a=window.MotionCheckAppearSync(this,e,n)),this.valueSubscriptions.set(e,()=>{r(),i(),a&&a(),n.owner&&n.stop()})}sortNodePosition(e){return this.current&&this.sortInstanceNodePosition&&this.type===e.type?this.sortInstanceNodePosition(this.current,e.current):0}updateFeatures(){let e="animation";for(e in rd){const n=rd[e];if(!n)continue;const{isEnabled:t,Feature:r}=n;if(!this.features[e]&&r&&t(this.props)&&(this.features[e]=new r(this)),this.features[e]){const n=this.features[e];n.isMounted?n.update():(n.mount(),n.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):{x:{min:0,max:0},y:{min:0,max:0}}}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,n){this.latestValues[e]=n}update(e,n){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=n;for(let n=0;n<Kd.length;n++){const t=Kd[n];this.propEventSubscriptions[t]&&(this.propEventSubscriptions[t](),delete this.propEventSubscriptions[t]);const r=e["on"+t];r&&(this.propEventSubscriptions[t]=this.on(t,r))}this.prevMotionValues=function(e,n,t){for(const r in n){const i=n[r],a=t[r];if(Hi(i))e.addValue(r,i);else if(Hi(a))e.addValue(r,Fi(i,{owner:e}));else if(a!==i)if(e.hasValue(r)){const n=e.getValue(r);!0===n.liveStyle?n.jump(i):n.hasAnimated||n.set(i)}else{const n=e.getStaticValue(r);e.addValue(r,Fi(void 0!==n?n:i,{owner:e}))}}for(const r in t)void 0===n[r]&&e.removeValue(r);return n}(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const n=this.getClosestVariantNode();if(n)return n.variantChildren&&n.variantChildren.add(e),()=>n.variantChildren.delete(e)}addValue(e,n){const t=this.values.get(e);n!==t&&(t&&this.removeValue(e),this.bindToMotionValue(e,n),this.values.set(e,n),this.latestValues[e]=n.get())}removeValue(e){this.values.delete(e);const n=this.valueSubscriptions.get(e);n&&(n(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,n){if(this.props.values&&this.props.values[e])return this.props.values[e];let t=this.values.get(e);return void 0===t&&void 0!==n&&(t=Fi(null===n?void 0:n,{owner:this}),this.addValue(e,t)),t}readValue(e,n){var t;let r=void 0===this.latestValues[e]&&this.current?null!==(t=this.getBaseTargetFromProps(this.props,e))&&void 0!==t?t:this.readValueFromInstance(this.current,e,this.options):this.latestValues[e];var i;return null!=r&&("string"==typeof r&&(Oo(r)||Sa(r))?r=parseFloat(r):(i=r,!$d.find(Ro(i))&&no.test(n)&&(r=po(e,n))),this.setBaseTarget(e,Hi(r)?r.get():r)),Hi(r)?r.get():r}setBaseTarget(e,n){this.baseTarget[e]=n}getBaseTarget(e){var n;const{initial:t}=this.props;let r;if("string"==typeof t||"object"==typeof t){const i=gi(this.props,t,null===(n=this.presenceContext)||void 0===n?void 0:n.custom);i&&(r=i[e])}if(t&&void 0!==r)return r;const i=this.getBaseTargetFromProps(this.props,e);return void 0===i||Hi(i)?void 0!==this.initialValues[e]&&void 0===r?void 0:this.baseTarget[e]:i}on(e,n){return this.events[e]||(this.events[e]=new Ri),this.events[e].add(n)}notify(e,...n){this.events[e]&&this.events[e].notify(...n)}}class Gd extends Qd{constructor(){super(...arguments),this.KeyframeResolver=Uo}sortInstanceNodePosition(e,n){return 2&e.compareDocumentPosition(n)?1:-1}getBaseTargetFromProps(e,n){return e.style?e.style[n]:void 0}removeValueFromRenderState(e,{vars:n,style:t}){delete n[e],delete t[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;Hi(e)&&(this.childSubscription=e.on("change",e=>{this.current&&(this.current.textContent=`${e}`)}))}}class Xd extends Gd{constructor(){super(...arguments),this.type="html",this.renderInstance=Cd}readValueFromInstance(e,n){if(yi.has(n)){const e=mo(n);return e&&e.default||0}{const r=(t=e,window.getComputedStyle(t)),i=(zo(n)?r.getPropertyValue(n):r[n])||0;return"string"==typeof i?i.trim():i}var t}measureInstanceViewportBox(e,{transformPagePoint:n}){return oc(e,n)}build(e,n,t){fd(e,n,t.transformTemplate)}scrapeMotionValuesFromProps(e,n,t){return Od(e,n,t)}}class Zd extends Gd{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Hl}getBaseTargetFromProps(e,n){return e[n]}readValueFromInstance(e,n){if(yi.has(n)){const e=mo(n);return e&&e.default||0}return n=Nd.has(n)?n:qi(n),e.getAttribute(n)}scrapeMotionValuesFromProps(e,n,t){return Md(e,n,t)}build(e,n,t){kd(e,n,this.isSVGTag,t.transformTemplate)}renderInstance(e,n,t,r){Pd(e,n,0,r)}mount(e){this.isSVGTag=Sd(e.tagName),super.mount(e)}}const Jd=(e,n)=>dd(e)?new Zd(n):new Xd(n,{allowProjection:e!==Je.Fragment}),em=li(Hd({...hl,...Ku,...Mu,...Qu},Jd)),nm=Jn("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]),tm=Jn("bookmark",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]]),rm=Jn("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),im=Jn("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),am=Jn("wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.106-3.105c.32-.322.863-.22.983.218a6 6 0 0 1-8.259 7.057l-7.91 7.91a1 1 0 0 1-2.999-3l7.91-7.91a6 6 0 0 1 7.057-8.259c.438.12.54.662.219.984z",key:"1ngwbx"}]]);function om(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function sm(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?om(Object(t),!0).forEach(function(n){lm(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):om(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function lm(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const cm=wn,um=[],dm={},mm={useDefault:!0,xPercent:1,yPercent:1},pm=()=>cm.getState().presets||dm,gm=()=>cm.getState().activePresetName,vm=()=>cm.getState().chimeraMode||!1,hm=()=>cm.getState().councilMode||!1,fm=()=>cm.getState().councilMembers||um,bm=()=>cm.getState().selectedDefinitions||um,xm=()=>{var e;return null===(e=cm.getState().showLumiverseDrawer)||void 0===e||e},ym=()=>{var e;return null!==(e=cm.getState().lumiaButtonPosition)&&void 0!==e?e:mm},km={chimera:(0,nn.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,nn.jsx)("path",{d:"M12 2L2 7l10 5 10-5-10-5z"}),(0,nn.jsx)("path",{d:"M2 17l10 5 10-5"}),(0,nn.jsx)("path",{d:"M2 12l10 5 10-5"})]}),council:(0,nn.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,nn.jsx)("path",{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),(0,nn.jsx)("circle",{cx:"9",cy:"7",r:"4"}),(0,nn.jsx)("path",{d:"M23 21v-2a4 4 0 0 0-3-3.87"}),(0,nn.jsx)("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]})},wm={book:(0,nn.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,nn.jsx)("path",{d:"M4 19.5A2.5 2.5 0 0 1 6.5 17H20"}),(0,nn.jsx)("path",{d:"M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"})]}),settings:(0,nn.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,nn.jsx)("circle",{cx:"12",cy:"12",r:"3"}),(0,nn.jsx)("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]}),layers:(0,nn.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,nn.jsx)("path",{d:"M12 2L2 7l10 5 10-5-10-5z"}),(0,nn.jsx)("path",{d:"M2 17l10 5 10-5"}),(0,nn.jsx)("path",{d:"M2 12l10 5 10-5"})]}),tools:(0,nn.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,nn.jsx)("path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"})}),terminal:(0,nn.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,nn.jsx)("polyline",{points:"4 17 10 11 4 5"}),(0,nn.jsx)("line",{x1:"12",y1:"19",x2:"20",y2:"19"})]}),upload:(0,nn.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,nn.jsx)("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),(0,nn.jsx)("polyline",{points:"17 8 12 3 7 8"}),(0,nn.jsx)("line",{x1:"12",y1:"3",x2:"12",y2:"15"})]}),box:(0,nn.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,nn.jsx)("path",{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"}),(0,nn.jsx)("polyline",{points:"3.27 6.96 12 12.01 20.73 6.96"}),(0,nn.jsx)("line",{x1:"12",y1:"22.08",x2:"12",y2:"12"})]}),plus:(0,nn.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,nn.jsx)("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),(0,nn.jsx)("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),dots:(0,nn.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,nn.jsx)("circle",{cx:"12",cy:"12",r:"1"}),(0,nn.jsx)("circle",{cx:"19",cy:"12",r:"1"}),(0,nn.jsx)("circle",{cx:"5",cy:"12",r:"1"})]}),lines:(0,nn.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,nn.jsx)("line",{x1:"21",y1:"10",x2:"3",y2:"10"}),(0,nn.jsx)("line",{x1:"21",y1:"6",x2:"3",y2:"6"}),(0,nn.jsx)("line",{x1:"21",y1:"14",x2:"3",y2:"14"}),(0,nn.jsx)("line",{x1:"21",y1:"18",x2:"3",y2:"18"})]}),edit:(0,nn.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,nn.jsx)("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),(0,nn.jsx)("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]}),chevronDown:(0,nn.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,nn.jsx)("polyline",{points:"6 9 12 15 18 9"})}),package:(0,nn.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,nn.jsx)("line",{x1:"16.5",y1:"9.4",x2:"7.5",y2:"4.21"}),(0,nn.jsx)("path",{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"}),(0,nn.jsx)("polyline",{points:"3.27 6.96 12 12.01 20.73 6.96"}),(0,nn.jsx)("line",{x1:"12",y1:"22.08",x2:"12",y2:"12"})]}),download:(0,nn.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,nn.jsx)("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),(0,nn.jsx)("polyline",{points:"7 10 12 15 17 10"}),(0,nn.jsx)("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]})};function jm(e){let{item:n,packName:t,onEdit:r,editIcon:i}=e;const a=n.avatarUrl||n.lumia_img,o=n.lumiaName||n.lumiaDefName,{objectPosition:s}=Yn(a);return(0,nn.jsxs)("div",{className:"lumia-pack-lumia-item",children:[a&&(0,nn.jsx)("img",{src:a,alt:"",className:"lumia-pack-lumia-avatar",style:{objectPosition:s},onError:e=>{e.target.style.display="none"}}),(0,nn.jsx)("span",{className:"lumia-pack-lumia-name",children:o}),(0,nn.jsx)("button",{className:"lumia-btn lumia-btn-icon lumia-btn-icon-sm",onClick:()=>r(t,n),title:"Edit Lumia",type:"button",children:i})]})}function Sm(e){let{title:n,icon:t,action:r,collapsible:i,collapsed:a,onToggle:o,children:s}=e;const l=void 0!==a,[c,u]=(0,Je.useState)(!1),d=l?a:c,m=(0,Je.useCallback)(()=>{l&&o?o():u(e=>!e)},[l,o]);return(0,nn.jsxs)("div",{className:at("lumia-panel",i&&d&&"lumia-panel--collapsed"),children:[(0,nn.jsxs)("div",{className:at("lumia-panel-header",i&&"lumia-panel-header-clickable"),onClick:i?m:void 0,children:[(0,nn.jsx)("span",{className:"lumia-panel-icon",children:t}),(0,nn.jsx)("span",{className:"lumia-panel-title",children:n}),r&&(0,nn.jsx)("span",{className:"lumia-panel-action",onClick:e=>e.stopPropagation(),children:r}),i&&(0,nn.jsx)("span",{className:at("lumia-panel-chevron",!d&&"lumia-panel-chevron--expanded"),children:wm.chevronDown})]}),i?(0,nn.jsx)(Lt,{isOpen:!d,className:"lumia-panel-content",duration:200,children:s}):(0,nn.jsx)("div",{className:"lumia-panel-content",children:s})]})}function Cm(e){let{title:n,icon:t,children:r}=e;const[i,a]=(0,Je.useState)(!1);return(0,nn.jsxs)("details",{className:"lumia-panel lumia-panel-collapsible",open:i,onToggle:e=>a(e.target.open),children:[(0,nn.jsxs)("summary",{className:"lumia-panel-header lumia-panel-header-clickable",children:[(0,nn.jsx)("span",{className:"lumia-panel-icon",children:t}),(0,nn.jsx)("span",{className:"lumia-panel-title",children:n}),(0,nn.jsx)("span",{className:"lumia-panel-chevron",children:wm.chevronDown})]}),(0,nn.jsx)("div",{className:"lumia-panel-content lumia-macro-reference",children:r})]})}function Nm(e){let{label:n,hint:t,selections:r,dominant:i,modalName:a}=e;const o=Nn(),s=(null==r?void 0:r.length)||0,l=(0,Je.useMemo)(()=>{if(0===s)return"No ".concat(n.toLowerCase()," selected");const e=null==i?void 0:i.id,t=(null==i?void 0:i.name)||(null==i?void 0:i.itemName)||(null==i?void 0:i.lumiaDefName);return r.map(n=>{const r=(null==n?void 0:n.name)||(null==n?void 0:n.itemName)||(null==n?void 0:n.lumiaDefName)||"Unknown",a=null==n?void 0:n.id;return i&&(e&&a&&e===a||t&&r&&t===r)?"★ ".concat(r):r}).join(", ")},[s,r,n,i]);return(0,nn.jsxs)("div",{className:"lumia-selector",children:[(0,nn.jsxs)("div",{className:"lumia-selector-header",children:[(0,nn.jsx)("span",{className:"lumia-selector-label",children:n}),(0,nn.jsx)("span",{className:"lumia-selector-hint",children:t})]}),(0,nn.jsxs)("div",{className:"lumia-selector-row",children:[(0,nn.jsx)("div",{className:"lumia-selector-value",children:l}),(0,nn.jsx)("button",{className:"lumia-btn lumia-btn-sm",onClick:()=>o.openModal(a),type:"button",children:"Select"})]})]})}function Pm(e){let{icon:n,label:t,onClick:r,accent:i=!1}=e;return(0,nn.jsxs)("button",{className:at("lumia-tool-btn",i&&"lumia-tool-btn-accent"),onClick:r,type:"button",children:[n,(0,nn.jsx)("span",{children:t})]})}function Em(e){let{icon:n,label:t,description:r,checked:i,onChange:a,disabled:o}=e;return(0,nn.jsxs)("label",{className:at("lumiverse-mode-toggle",o&&"lumiverse-mode-toggle--disabled"),children:[(0,nn.jsx)("span",{className:"lumiverse-mode-toggle-icon",children:n}),(0,nn.jsxs)("div",{className:"lumiverse-mode-toggle-text",children:[(0,nn.jsx)("span",{className:"lumiverse-mode-toggle-label",children:t}),(0,nn.jsx)("span",{className:"lumiverse-mode-toggle-description",children:r})]}),(0,nn.jsxs)("div",{className:at("lumiverse-toggle lumiverse-toggle--sm",i&&"lumiverse-toggle--on"),children:[(0,nn.jsx)("input",{type:"checkbox",className:"lumiverse-toggle-input",checked:i,onChange:e=>a(e.target.checked),disabled:o}),(0,nn.jsx)("span",{className:"lumiverse-toggle-slider"})]})]})}function Om(e){let{code:n,description:t}=e;const[r,i]=(0,Je.useState)(!1),a=(0,Je.useCallback)(()=>{navigator.clipboard.writeText(n),i(!0),setTimeout(()=>i(!1),1500)},[n]);return(0,nn.jsxs)("div",{className:at("lumia-macro",r&&"lumia-macro--copied"),onClick:a,title:"Click to copy",children:[(0,nn.jsx)("code",{children:n}),(0,nn.jsx)("span",{children:r?"Copied!":t})]})}function Mm(e){let{councilMode:n,councilMembers:t,onOpenCouncil:r,actions:i}=e;const[a,o]=(0,Je.useState)(!1),[s,l]=(0,Je.useState)(""),[c,u]=(0,Je.useState)(!1),d=(0,Je.useSyncExternalStore)(cm.subscribe,pm,pm),m=(0,Je.useSyncExternalStore)(cm.subscribe,gm,gm),p=(0,Je.useMemo)(()=>Object.values(d).sort((e,n)=>{const t=e.updatedAt||e.createdAt||0;return(n.updatedAt||n.createdAt||0)-t}),[d]),g=(0,Je.useCallback)(()=>{const e=s.trim();e&&(d[e]?"undefined"!=typeof toastr&&toastr.warning('Preset "'.concat(e,'" already exists')):(i.savePreset(e),yn(),l(""),o(!1),"undefined"!=typeof toastr&&toastr.success('Preset "'.concat(e,'" saved'))))},[s,d,i]),v=(0,Je.useCallback)(e=>{i.loadPreset(e),yn(),u(!1),"undefined"!=typeof toastr&&toastr.info('Loaded preset "'.concat(e,'"'))},[i]);return(0,nn.jsxs)("div",{className:"lumia-quick-actions",children:[(0,nn.jsxs)("button",{className:at("lumia-quick-action-btn","lumia-quick-action-btn--council",!n&&"lumia-quick-action-btn--disabled"),onClick:n?r:void 0,disabled:!n,type:"button",title:n?"Configure council members":"Enable Council Mode first",children:[(0,nn.jsx)(nm,{size:14,strokeWidth:1.5}),(0,nn.jsx)("span",{className:"lumia-quick-action-text",children:n?t.length>0?"".concat(t.length," member").concat(1!==t.length?"s":""):"Configure":"Council"})]}),(0,nn.jsx)("div",{className:"lumia-quick-action-group",children:a?(0,nn.jsxs)("div",{className:"lumia-quick-action-form",children:[(0,nn.jsx)("input",{type:"text",className:"lumia-quick-action-input",placeholder:"Preset name...",value:s,onChange:e=>l(e.target.value),onKeyDown:e=>{"Enter"===e.key&&g(),"Escape"===e.key&&(o(!1),l(""))},autoFocus:!0}),(0,nn.jsx)("button",{className:"lumia-quick-action-btn lumia-quick-action-btn--primary",onClick:g,disabled:!s.trim(),type:"button",title:"Save preset",children:(0,nn.jsx)(rm,{size:14,strokeWidth:2})}),(0,nn.jsx)("button",{className:"lumia-quick-action-btn",onClick:()=>{o(!1),l("")},type:"button",title:"Cancel",children:(0,nn.jsx)(Wt,{size:14,strokeWidth:2})})]}):(0,nn.jsxs)(nn.Fragment,{children:[(0,nn.jsx)("button",{className:"lumia-quick-action-btn lumia-quick-action-btn--primary",onClick:()=>o(!0),title:"Save current configuration as preset",type:"button",children:(0,nn.jsx)(Ur,{size:14,strokeWidth:2})}),(0,nn.jsxs)("div",{className:"lumia-quick-action-dropdown-wrapper",children:[(0,nn.jsxs)("button",{className:at("lumia-quick-action-btn",m&&"lumia-quick-action-btn--active"),onClick:()=>u(!c),title:m?"Active: ".concat(m):"Load preset",type:"button",children:[(0,nn.jsx)(tm,{size:14,strokeWidth:1.5}),(0,nn.jsx)("span",{className:"lumia-quick-action-text",children:m||"Presets"}),(0,nn.jsx)(ot,{size:12,strokeWidth:2,className:at("lumia-quick-action-chevron",c&&"lumia-quick-action-chevron--open")})]}),(0,nn.jsx)(si,{children:c&&(0,nn.jsx)(em.div,{className:"lumia-quick-action-dropdown",initial:{opacity:0,y:-8},animate:{opacity:1,y:0},exit:{opacity:0,y:-8},transition:{duration:.15},children:0===p.length?(0,nn.jsx)("div",{className:"lumia-quick-action-dropdown-empty",children:"No presets saved"}):p.map(e=>(0,nn.jsxs)("button",{className:at("lumia-quick-action-dropdown-item",m===e.name&&"lumia-quick-action-dropdown-item--active"),onClick:()=>v(e.name),type:"button",children:[(0,nn.jsx)("span",{children:e.name}),m===e.name&&(0,nn.jsx)(rm,{size:12,strokeWidth:2})]},e.name))})})]})]})})]})}const zm=function(){Fn();const e=Wn(),n=Hn(),t=Nn(),{packs:r,customPacks:i,allPacks:a}=Vn(),[o,s]=(0,Je.useState)(null),[l,c]=(0,Je.useState)({customPacks:!1,downloadedPacks:!1,loomPacks:!1}),u=(0,Je.useCallback)(e=>{c(n=>sm(sm({},n),{},{[e]:!n[e]}))},[]),d=(0,Je.useSyncExternalStore)(cm.subscribe,vm,vm),m=(0,Je.useSyncExternalStore)(cm.subscribe,hm,hm),p=(0,Je.useSyncExternalStore)(cm.subscribe,fm,fm),g=(0,Je.useSyncExternalStore)(cm.subscribe,bm,bm),v=m&&p.length>0,h=(0,Je.useCallback)(e=>{t.setChimeraMode(e),yn()},[t]),f=(0,Je.useCallback)(e=>{t.setCouncilMode(e),yn()},[t]),b=(0,Je.useCallback)(()=>{t.clearSelections(),yn(),"undefined"!=typeof toastr&&toastr.info("All Lumia selections cleared")},[t]),x=(0,Je.useCallback)(e=>{confirm('Are you sure you want to delete "'.concat(e,'"?'))&&(t.removePack(e),yn(),"undefined"!=typeof toastr&&toastr.success('Pack "'.concat(e,'" deleted')))},[t]),y=(0,Je.useCallback)(e=>{s(n=>n===e?null:e)},[]),k=a.length,w=(0,Je.useMemo)(()=>a.reduce((e,n)=>{var t,r,i;const a=(null===(t=n.lumiaItems)||void 0===t?void 0:t.length)||0,o=(null===(r=n.loomItems)||void 0===r?void 0:r.length)||0,s=(null===(i=n.items)||void 0===i?void 0:i.length)||0;return e+(a+o>0?a+o:s)},0),[a]),j=(0,Je.useMemo)(()=>r.filter(e=>{var n,t,r,i,a;return(null===(n=e.loomItems)||void 0===n?void 0:n.length)>0||((null===(t=e.loomStyles)||void 0===t?void 0:t.length)>0||((null===(r=e.loomUtils)||void 0===r?void 0:r.length)>0||((null===(i=e.loomRetrofits)||void 0===i?void 0:i.length)>0||!(null===(a=e.items)||void 0===a||!a.some(e=>e.loomCategory)))))}),[r]),S=(0,Je.useCallback)(function(e){if("undefined"!=typeof LumiverseBridge){const i=LumiverseBridge.getCallbacks();if(i&&i[e]){for(var n=arguments.length,t=new Array(n>1?n-1:0),r=1;r<n;r++)t[r-1]=arguments[r];i[e](...t)}}},[]),C=(0,Je.useCallback)(e=>{var n;const t=null===(n=e.target.files)||void 0===n?void 0:n[0];if(!t)return;console.log("[SettingsPanel] File selected for upload:",t.name);const r=new FileReader;r.onload=e=>{try{const n=JSON.parse(e.target.result);if(console.log("[SettingsPanel] JSON parsed successfully, entries:",n.entries?Object.keys(n.entries).length:"no entries field"),"undefined"!=typeof LumiverseBridge){const e=LumiverseBridge.getCallbacks();console.log("[SettingsPanel] Available callbacks:",e?Object.keys(e).filter(n=>e[n]):"none"),e&&e.handleNewBook?(console.log("[SettingsPanel] Calling handleNewBook..."),e.handleNewBook(n,t.name,!1),e.refreshUIDisplay&&e.refreshUIDisplay(),console.log("[SettingsPanel] Import complete")):(console.error("[SettingsPanel] handleNewBook callback not registered"),"undefined"!=typeof toastr&&toastr.error("Import function not available. Please reload the page."))}else console.error("[SettingsPanel] LumiverseBridge not available"),"undefined"!=typeof toastr&&toastr.error("Bridge not available. Please reload the page.")}catch(e){console.error("[SettingsPanel] Failed to parse JSON:",e),"undefined"!=typeof toastr&&toastr.error("Failed to parse JSON: "+e.message)}},r.onerror=()=>{console.error("[SettingsPanel] Failed to read file"),"undefined"!=typeof toastr&&toastr.error("Failed to read file")},r.readAsText(t),e.target.value=""},[]),N=(0,Je.useSyncExternalStore)(cm.subscribe,xm,xm),P=(0,Je.useSyncExternalStore)(cm.subscribe,ym,ym),E=(0,Je.useCallback)(e=>{cm.setState({showLumiverseDrawer:e}),yn()},[]),O=(0,Je.useCallback)(()=>{window.confirm("WARNING: This will completely reset ALL Lumiverse Helper settings to defaults.\n\nThis includes:\n- All downloaded packs\n- All custom packs\n- All Lumia and Loom selections\n- All presets\n- All advanced settings\n\nThe page will reload after reset.\n\nAre you sure you want to continue?")&&("undefined"!=typeof LumiverseBridge&&LumiverseBridge.resetAllSettings?("undefined"!=typeof toastr&&toastr.warning("Resetting all settings..."),LumiverseBridge.resetAllSettings()):(console.error("[SettingsPanel] resetAllSettings not available on bridge"),"undefined"!=typeof toastr&&toastr.error("Reset function not available. Please reload the page.")))},[]),M=(0,Je.useCallback)(e=>{cm.setState({lumiaButtonPosition:sm(sm({},cm.getState().lumiaButtonPosition),{},{useDefault:e})}),yn()},[]),z=(0,Je.useCallback)(e=>{const n=Math.max(0,Math.min(100,parseInt(e,10)||0));cm.setState({lumiaButtonPosition:sm(sm({},cm.getState().lumiaButtonPosition),{},{xPercent:n})}),yn()},[]),T=(0,Je.useCallback)(e=>{const n=Math.max(0,Math.min(100,parseInt(e,10)||0));cm.setState({lumiaButtonPosition:sm(sm({},cm.getState().lumiaButtonPosition),{},{yPercent:n})}),yn()},[]);return(0,nn.jsxs)("div",{className:"lumia-injector-settings",children:[(0,nn.jsx)("div",{className:"lumia-drawer-toggle-container",children:(0,nn.jsxs)("label",{className:"lumiverse-toggle-wrapper",children:[(0,nn.jsxs)("div",{className:"lumiverse-toggle-text",children:[(0,nn.jsx)("span",{className:"lumiverse-toggle-label",children:"Show Lumiverse Drawer"}),(0,nn.jsx)("span",{className:"lumiverse-toggle-description",children:"Access quick settings from a slide-out panel"})]}),(0,nn.jsxs)("div",{className:at("lumiverse-toggle",N&&"lumiverse-toggle--on"),children:[(0,nn.jsx)("input",{type:"checkbox",className:"lumiverse-toggle-input",checked:N,onChange:e=>E(e.target.checked)}),(0,nn.jsx)("span",{className:"lumiverse-toggle-slider"})]})]})}),N&&(0,nn.jsxs)("div",{className:"lumia-button-position-container",children:[(0,nn.jsxs)("label",{className:"lumiverse-toggle-wrapper",children:[(0,nn.jsxs)("div",{className:"lumiverse-toggle-text",children:[(0,nn.jsx)("span",{className:"lumiverse-toggle-label",children:"Custom Button Position"}),(0,nn.jsx)("span",{className:"lumiverse-toggle-description",children:"Position the Lumia button anywhere on screen"})]}),(0,nn.jsxs)("div",{className:at("lumiverse-toggle",!P.useDefault&&"lumiverse-toggle--on"),children:[(0,nn.jsx)("input",{type:"checkbox",className:"lumiverse-toggle-input",checked:!P.useDefault,onChange:e=>M(!e.target.checked)}),(0,nn.jsx)("span",{className:"lumiverse-toggle-slider"})]})]}),!P.useDefault&&(0,nn.jsxs)("div",{className:"lumia-button-position-inputs",children:[(0,nn.jsxs)("div",{className:"lumia-position-field",children:[(0,nn.jsx)("label",{htmlFor:"lumia-btn-x",children:"X (% from right)"}),(0,nn.jsx)("input",{type:"number",id:"lumia-btn-x",className:"lumia-input lumia-input-sm",value:P.xPercent,onChange:e=>z(e.target.value),min:"0",max:"100"})]}),(0,nn.jsxs)("div",{className:"lumia-position-field",children:[(0,nn.jsx)("label",{htmlFor:"lumia-btn-y",children:"Y (% from top)"}),(0,nn.jsx)("input",{type:"number",id:"lumia-btn-y",className:"lumia-input lumia-input-sm",value:P.yPercent,onChange:e=>T(e.target.value),min:"0",max:"100"})]}),(0,nn.jsx)("span",{className:"lumia-position-hint",children:"Slide-out animation is disabled with custom positioning"})]})]}),(0,nn.jsxs)(Sm,{title:"Lumia DLC Packs",icon:wm.book,children:[(0,nn.jsx)("div",{className:"lumia-status-badge",children:k>0?"".concat(k," pack").concat(1!==k?"s":""," loaded (").concat(w," items)"):"No packs loaded"}),(0,nn.jsxs)("div",{className:"lumia-input-row",children:[(0,nn.jsx)("input",{type:"text",className:"lumia-input",placeholder:"Enter Lumia DLC Pack URL (JSON)",id:"lumia-url-input-react"}),(0,nn.jsx)("button",{className:"lumia-btn lumia-btn-primary",onClick:()=>S("fetchWorldBook"),type:"button",children:"Fetch"})]}),(0,nn.jsxs)("div",{className:"lumia-source-actions",children:[(0,nn.jsx)("div",{className:"lumia-divider-text",children:"or"}),(0,nn.jsxs)("button",{className:"lumia-btn lumia-btn-secondary lumia-btn-full",onClick:()=>{var e;return null===(e=document.getElementById("lumia-file-input-react"))||void 0===e?void 0:e.click()},type:"button",children:[wm.upload,"Upload JSON File"]}),(0,nn.jsx)("input",{type:"file",id:"lumia-file-input-react",accept:".json",style:{display:"none"},onChange:C}),(0,nn.jsx)("div",{className:"lumia-divider-text",children:"or"}),(0,nn.jsxs)("button",{className:"lumia-btn lumia-btn-primary lumia-btn-full",onClick:()=>t.openModal("lucidCards"),type:"button",children:[wm.box,"Browse Lucid Cards"]})]})]}),(0,nn.jsx)(Sm,{title:"Chat Presets",icon:(0,nn.jsx)(rt,{size:16,strokeWidth:1.5}),children:(0,nn.jsx)(Ir,{})}),(0,nn.jsx)(Sm,{title:"Preset Bindings",icon:wm.layers,children:(0,nn.jsx)($r,{})}),(0,nn.jsxs)(Sm,{title:"Lumia Configuration",icon:wm.settings,action:(0,nn.jsxs)("button",{className:"lumia-clear-all-btn",onClick:b,title:"Clear all Lumia selections",type:"button",children:[(0,nn.jsx)(tt,{size:14,strokeWidth:1.5}),"Clear All"]}),children:[(0,nn.jsxs)("div",{className:"lumia-mode-toggles",children:[(0,nn.jsx)(Em,{icon:km.chimera,label:"Chimera Mode",description:"Fuse multiple physical definitions",checked:d,onChange:h,disabled:m}),(0,nn.jsx)(Em,{icon:km.council,label:"Council Mode",description:"Multiple independent Lumias",checked:m,onChange:f,disabled:d})]}),(0,nn.jsx)(Mm,{councilMode:m,councilMembers:p,onOpenCouncil:()=>t.openModal("councilSelect"),actions:t}),(0,nn.jsxs)("div",{className:at("lumia-selector-group",v&&"lumia-selector-group--disabled"),children:[(0,nn.jsx)(Nm,{label:d?"Chimera Definitions":"Definition",hint:d?"Select Multiple":"Select One",selections:d?g:e.definition?[e.definition]:[],modalName:"definitions"}),(0,nn.jsx)(Nm,{label:"Behaviors",hint:"Select Multiple",selections:e.behaviors,dominant:e.dominantBehavior,modalName:"behaviors"}),(0,nn.jsx)(Nm,{label:"Personalities",hint:"Select Multiple",selections:e.personalities,dominant:e.dominantPersonality,modalName:"personalities"})]})]}),(0,nn.jsx)(Sm,{title:"Loom Configuration",icon:wm.layers,children:(0,nn.jsxs)("div",{className:"lumia-selector-group",children:[(0,nn.jsx)(Nm,{label:"Narrative Style",hint:"Select Multiple",selections:n.styles,modalName:"loomStyles"}),(0,nn.jsx)(Nm,{label:"Loom Utilities",hint:"Select Multiple",selections:n.utilities,modalName:"loomUtilities"}),(0,nn.jsx)(Nm,{label:"Retrofits",hint:"Select Multiple",selections:n.retrofits,modalName:"loomRetrofits"})]})}),(0,nn.jsx)(Sm,{title:"Tools",icon:wm.tools,children:(0,nn.jsxs)("div",{className:"lumia-tools-row",children:[(0,nn.jsx)(Pm,{icon:wm.plus,label:"Lumia Editor",onClick:()=>t.openModal("packSelector"),accent:!0}),(0,nn.jsx)(Pm,{icon:wm.dots,label:"OOC Settings",onClick:()=>t.openModal("oocSettings")}),(0,nn.jsx)(Pm,{icon:wm.lines,label:"Summarization",onClick:()=>t.openModal("summarization")}),(0,nn.jsx)(Pm,{icon:wm.edit,label:"Prompt Settings",onClick:()=>t.openModal("promptSettings")})]})}),(0,nn.jsxs)(Cm,{title:"Macro Reference",icon:wm.terminal,children:[(0,nn.jsxs)("div",{className:"lumia-macro-group",children:[(0,nn.jsx)("div",{className:"lumia-macro-group-title",children:"Lumia Content"}),(0,nn.jsxs)("div",{className:"lumia-macro-list",children:[(0,nn.jsx)(Om,{code:"{{lumiaDef}}",description:"Physical Definition"}),(0,nn.jsx)(Om,{code:"{{lumiaBehavior}}",description:"Behavior(s)"}),(0,nn.jsx)(Om,{code:"{{lumiaPersonality}}",description:"Personality(s)"}),(0,nn.jsx)(Om,{code:"{{lumiaCouncilModeActive}}",description:"Yes/No status indicator, (conditional ready)"})]})]}),(0,nn.jsxs)("div",{className:"lumia-macro-group",children:[(0,nn.jsx)("div",{className:"lumia-macro-group-title",children:"Loom Content"}),(0,nn.jsxs)("div",{className:"lumia-macro-list",children:[(0,nn.jsx)(Om,{code:"{{loomStyle}}",description:"Narrative Style"}),(0,nn.jsx)(Om,{code:"{{loomUtils}}",description:"Loom Utilities"}),(0,nn.jsx)(Om,{code:"{{loomRetrofits}}",description:"Retrofits"})]})]}),(0,nn.jsxs)("div",{className:"lumia-macro-group",children:[(0,nn.jsx)("div",{className:"lumia-macro-group-title",children:"Random Lumia"}),(0,nn.jsxs)("div",{className:"lumia-macro-list",children:[(0,nn.jsx)(Om,{code:"{{randomLumia}}",description:"Random definition"}),(0,nn.jsx)(Om,{code:"{{randomLumia.pers}}",description:"Random personality"}),(0,nn.jsx)(Om,{code:"{{randomLumia.behav}}",description:"Random behavior"}),(0,nn.jsx)(Om,{code:"{{randomLumia.name}}",description:"Random name"})]})]}),(0,nn.jsxs)("div",{className:"lumia-macro-group",children:[(0,nn.jsx)("div",{className:"lumia-macro-group-title",children:"Tracking & OOC"}),(0,nn.jsxs)("div",{className:"lumia-macro-list",children:[(0,nn.jsx)(Om,{code:"{{lumiaMessageCount}}",description:"Message count"}),(0,nn.jsx)(Om,{code:"{{lumiaOOCTrigger}}",description:"OOC trigger/countdown"})]})]}),(0,nn.jsxs)("div",{className:"lumia-macro-group",children:[(0,nn.jsx)("div",{className:"lumia-macro-group-title",children:"Summarization"}),(0,nn.jsxs)("div",{className:"lumia-macro-list",children:[(0,nn.jsx)(Om,{code:"{{loomSummary}}",description:"Stored summary"}),(0,nn.jsx)(Om,{code:"{{loomSummaryPrompt}}",description:"Summary directive"}),(0,nn.jsx)(Om,{code:"/loom-summarize",description:"Manual trigger"})]})]}),(0,nn.jsxs)("div",{className:"lumia-macro-group",children:[(0,nn.jsx)("div",{className:"lumia-macro-group-title",children:"Sovereign Hand"}),(0,nn.jsxs)("div",{className:"lumia-macro-list",children:[(0,nn.jsx)(Om,{code:"{{loomSovHand}}",description:"Full Sovereign Hand prompt (with user message)"}),(0,nn.jsx)(Om,{code:"{{loomSovHandActive}}",description:"Yes/No status indicator (conditional ready)"}),(0,nn.jsx)(Om,{code:"{{loomLastUserMessage}}",description:"Last user message content"}),(0,nn.jsx)(Om,{code:"{{loomLastCharMessage}}",description:"Last character message content"}),(0,nn.jsx)(Om,{code:"{{lastMessageName}}",description:"Name of whoever sent the last message"}),(0,nn.jsx)(Om,{code:"{{loomContinuePrompt}}",description:"Continue-scene prompt when character spoke last"})]})]})]}),i.length>0&&(0,nn.jsx)(Sm,{title:"Custom Packs",icon:wm.package,collapsible:!0,collapsed:l.customPacks,onToggle:()=>u("customPacks"),children:(0,nn.jsx)("div",{className:"lumia-custom-packs",children:i.map(e=>{var n,r;const i=e.id||e.name,a=o===i,s=(null===(n=e.lumiaItems)||void 0===n?void 0:n.length)>0?e.lumiaItems:(null===(r=e.items)||void 0===r?void 0:r.filter(e=>e.lumiaDefName))||[];return(0,nn.jsxs)(em.div,{className:at("lumia-pack-item-container",a&&"lumia-pack-item-container--expanded"),initial:{opacity:0,y:-10},animate:{opacity:1,y:0},children:[(0,nn.jsxs)("div",{className:"lumia-pack-item",children:[(0,nn.jsx)("button",{className:"lumia-pack-expand-btn",onClick:()=>y(i),type:"button",title:a?"Collapse":"Expand to see Lumias",children:(0,nn.jsx)("span",{className:at("lumia-pack-chevron",a&&"lumia-pack-chevron--expanded"),children:wm.chevronDown})}),(0,nn.jsx)("span",{className:"lumia-pack-name",onClick:()=>y(i),style:{cursor:"pointer"},children:e.name}),(0,nn.jsxs)("span",{className:"lumia-pack-count",children:[s.length," Lumia",1!==s.length?"s":""]}),(0,nn.jsx)("button",{className:"lumia-btn lumia-btn-icon",onClick:()=>Nt(e),title:"Export as Lumiverse Pack",type:"button",children:wm.download}),(0,nn.jsx)("button",{className:"lumia-btn lumia-btn-icon",onClick:()=>t.openModal("packEditor",{packId:i}),title:"Edit pack",type:"button",children:wm.edit})]}),(0,nn.jsx)(Lt,{isOpen:a&&s.length>0,className:"lumia-pack-items-list",duration:200,children:s.map((n,r)=>(0,nn.jsx)(jm,{item:n,packName:e.name,onEdit:(e,n)=>t.openModal("lumiaEditor",{packName:e,editingItem:n}),editIcon:wm.edit},n.lumiaDefName||r))}),(0,nn.jsx)(Lt,{isOpen:a&&0===s.length,className:"lumia-pack-items-empty",duration:200,children:(0,nn.jsx)("span",{children:"No Lumias in this pack yet"})})]},i)})})}),r.length>0&&(0,nn.jsx)(Sm,{title:"Downloaded Packs",icon:wm.box,collapsible:!0,collapsed:l.downloadedPacks,onToggle:()=>u("downloadedPacks"),children:(0,nn.jsx)("div",{className:"lumia-downloaded-packs",children:r.map(e=>{var n,r;const i=e.name||e.packName||"Unknown Pack",a=(null===(n=e.lumiaItems)||void 0===n?void 0:n.length)>0?e.lumiaItems:(null===(r=e.items)||void 0===r?void 0:r.filter(e=>e.lumiaDefName&&e.lumiaDef))||[],o=e.coverUrl||e.packCover;return(0,nn.jsxs)("div",{className:"lumia-downloaded-pack-item",children:[o?(0,nn.jsx)("img",{src:o,alt:i,className:"lumia-downloaded-pack-cover"}):(0,nn.jsx)("div",{className:"lumia-downloaded-pack-cover-placeholder",children:wm.package}),(0,nn.jsxs)("div",{className:"lumia-downloaded-pack-info",children:[(0,nn.jsx)("span",{className:"lumia-downloaded-pack-name",children:i}),(0,nn.jsxs)("span",{className:"lumia-downloaded-pack-count",children:[a.length," Lumia",1!==a.length?"s":""]})]}),(0,nn.jsxs)("div",{className:"lumia-downloaded-pack-actions",children:[(0,nn.jsx)("button",{className:"lumia-btn lumia-btn-icon",onClick:()=>t.openPackDetail(i),title:"View pack contents",type:"button",children:(0,nn.jsx)(im,{size:16,strokeWidth:1.5})}),(0,nn.jsx)("button",{className:"lumia-btn lumia-btn-icon lumia-btn-icon-danger",onClick:()=>x(i),title:"Delete pack",type:"button",children:(0,nn.jsx)(tt,{size:16,strokeWidth:1.5})})]})]},i)})})}),j.length>0&&(0,nn.jsx)(Sm,{title:"Loom Packs",icon:wm.layers,collapsible:!0,collapsed:l.loomPacks,onToggle:()=>u("loomPacks"),children:(0,nn.jsx)("div",{className:"lumia-loom-packs",children:j.map(e=>{var n,r,i;const a=e.name||e.packName||"Unknown Pack";let o=(null===(n=e.loomStyles)||void 0===n?void 0:n.length)||0,s=(null===(r=e.loomUtils)||void 0===r?void 0:r.length)||0,l=(null===(i=e.loomRetrofits)||void 0===i?void 0:i.length)||0;const c=e=>{const n=e.loomCategory||e.category;"Narrative Style"===n||"loomStyles"===n?o++:"Loom Utilities"===n||"loomUtils"===n?s++:"Retrofits"!==n&&"loomRetrofits"!==n||l++};return e.loomItems&&e.loomItems.forEach(c),e.items&&e.items.forEach(e=>{(e.loomCategory||e.category)&&c(e)}),(0,nn.jsxs)("div",{className:"lumia-loom-pack-item",children:[e.packCover?(0,nn.jsx)("img",{src:e.packCover,alt:a,className:"lumia-loom-pack-cover"}):(0,nn.jsx)("div",{className:"lumia-loom-pack-cover-placeholder",children:wm.layers}),(0,nn.jsxs)("div",{className:"lumia-loom-pack-info",children:[(0,nn.jsx)("span",{className:"lumia-loom-pack-name",children:a}),(0,nn.jsxs)("div",{className:"lumia-loom-pack-stats",children:[o>0&&(0,nn.jsxs)("span",{children:[(0,nn.jsx)(Cr,{size:10})," ",o]}),s>0&&(0,nn.jsxs)("span",{children:[(0,nn.jsx)(am,{size:10})," ",s]}),l>0&&(0,nn.jsxs)("span",{children:[(0,nn.jsx)(Er,{size:10})," ",l]})]})]}),(0,nn.jsxs)("div",{className:"lumia-loom-pack-actions",children:[(0,nn.jsx)("button",{className:"lumia-btn lumia-btn-icon",onClick:()=>t.openLoomPackDetail(a),title:"View loom contents",type:"button",children:(0,nn.jsx)(im,{size:16,strokeWidth:1.5})}),(0,nn.jsx)("button",{className:"lumia-btn lumia-btn-icon lumia-btn-icon-danger",onClick:()=>x(a),title:"Delete pack",type:"button",children:(0,nn.jsx)(tt,{size:16,strokeWidth:1.5})})]})]},a)})})}),(0,nn.jsx)(Cm,{title:"Danger Zone",icon:(0,nn.jsx)(Fr,{size:16,strokeWidth:1.5}),children:(0,nn.jsxs)("div",{className:"lumia-danger-zone",children:[(0,nn.jsx)("p",{className:"lumia-danger-zone-description",children:"If you're experiencing issues with the extension, you can reset all settings to their defaults. This will remove all packs, selections, and configurations."}),(0,nn.jsxs)("button",{className:"lumia-btn lumia-btn-danger lumia-btn-full",onClick:O,type:"button",children:[(0,nn.jsx)(Fr,{size:16,strokeWidth:1.5}),"Reset All Settings"]})]})})]})},Tm=Jn("pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),Im=Jn("star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]),Lm=Jn("folder",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]),Dm=Jn("chart-pie",[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]]),Am=Jn("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),Rm=Jn("chevron-up",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),Bm=Jn("arrow-down-a-z",[["path",{d:"m3 16 4 4 4-4",key:"1co6wj"}],["path",{d:"M7 20V4",key:"1yoxec"}],["path",{d:"M20 8h-5",key:"1vsyxs"}],["path",{d:"M15 10V6.5a2.5 2.5 0 0 1 5 0V10",key:"ag13bf"}],["path",{d:"M15 14h5l-5 6h5",key:"ur5jdg"}]]);function _m(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function Um(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?_m(Object(t),!0).forEach(function(n){Fm(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):_m(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Fm(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const Wm=wn,Hm=[],Vm=()=>Wm.getState().chimeraMode||!1,qm=()=>Wm.getState().selectedDefinitions||Hm,$m={layout:{display:"flex",flexDirection:"column",height:"100%",maxHeight:"100%",minHeight:0},header:{display:"flex",alignItems:"center",gap:"12px",padding:"16px 20px",borderBottom:"1px solid var(--lumiverse-border, rgba(255, 255, 255, 0.1))",flexShrink:0},headerIcon:{width:"40px",height:"40px",borderRadius:"10px",background:"linear-gradient(135deg, rgba(147, 112, 219, 0.2), rgba(147, 112, 219, 0.1))",display:"flex",alignItems:"center",justifyContent:"center",color:"var(--lumiverse-primary, #9370db)"},headerText:{flex:1},title:{margin:0,fontSize:"16px",fontWeight:600,color:"var(--lumiverse-text, #e0e0e0)"},subtitle:{margin:"4px 0 0",fontSize:"12px",color:"var(--lumiverse-text-muted, #999)"},clearBtn:{display:"flex",alignItems:"center",gap:"6px",padding:"8px 12px",fontSize:"12px",fontWeight:500,borderRadius:"6px",border:"1px solid rgba(239, 68, 68, 0.3)",background:"rgba(239, 68, 68, 0.1)",color:"#ef4444",cursor:"pointer",transition:"all 0.15s ease"},controls:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px 20px",background:"rgba(0, 0, 0, 0.15)",borderBottom:"1px solid var(--lumiverse-border, rgba(255, 255, 255, 0.1))",flexShrink:0},controlsGroup:{display:"flex",alignItems:"center",gap:"8px"},controlBtn:{display:"flex",alignItems:"center",gap:"4px",padding:"6px 10px",fontSize:"11px",fontWeight:500,borderRadius:"6px",border:"none",background:"rgba(0, 0, 0, 0.2)",color:"var(--lumiverse-text-muted, #999)",cursor:"pointer",transition:"all 0.15s ease"},sortContainer:{display:"flex",alignItems:"center",gap:"6px",fontSize:"11px",color:"var(--lumiverse-text-muted, #999)"},select:{padding:"5px 24px 5px 8px",fontSize:"11px",borderRadius:"6px",border:"1px solid var(--lumiverse-border, rgba(255, 255, 255, 0.1))",background:"rgba(0, 0, 0, 0.3)",color:"var(--lumiverse-text, #e0e0e0)",cursor:"pointer",appearance:"none",backgroundImage:"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%23999' stroke-width='2'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E\")",backgroundRepeat:"no-repeat",backgroundPosition:"right 6px center"},scrollArea:{flex:"1 1 auto",minHeight:0,overflowY:"auto",padding:"12px 20px"},empty:{textAlign:"center",padding:"40px 20px",color:"var(--lumiverse-text-muted, #999)",fontSize:"14px"},packSection:{marginBottom:"16px",border:"1px solid var(--lumiverse-border, rgba(255, 255, 255, 0.1))",borderRadius:"10px",overflow:"hidden"},packHeader:{display:"flex",alignItems:"center",gap:"8px",padding:"10px 12px",background:"rgba(0, 0, 0, 0.2)",cursor:"pointer",transition:"background 0.15s ease",width:"100%",border:"none",color:"inherit",textAlign:"left",fontFamily:"inherit"},packCollapseIcon:{color:"var(--lumiverse-text-muted, #999)",transition:"transform 0.2s ease"},packFolderIcon:{color:"var(--lumiverse-primary, #9370db)"},packTitle:{flex:1,fontSize:"13px",fontWeight:500,color:"var(--lumiverse-text, #e0e0e0)"},packBadge:{fontSize:"10px",padding:"2px 6px",borderRadius:"4px",background:"rgba(147, 112, 219, 0.2)",color:"var(--lumiverse-primary, #9370db)"},packCount:{fontSize:"11px",color:"var(--lumiverse-text-muted, #999)"},packRemoveBtn:{width:"24px",height:"24px",borderRadius:"6px",border:"none",background:"transparent",color:"var(--lumiverse-text-muted, #999)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.15s ease"},cardGrid:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(100px, 1fr))",gap:"10px",padding:"12px"},card:{position:"relative",borderRadius:"10px",overflow:"hidden",cursor:"pointer",transition:"all 0.2s ease",border:"2px solid transparent",background:"rgba(0, 0, 0, 0.2)"},cardSelected:{borderColor:"var(--lumiverse-primary, #9370db)",boxShadow:"0 0 0 1px var(--lumiverse-primary, #9370db)"},cardImage:{position:"relative",aspectRatio:"1",background:"rgba(0, 0, 0, 0.3)"},cardImg:{width:"100%",height:"100%",objectFit:"cover",transition:"opacity 0.2s ease"},cardPlaceholder:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"24px",color:"var(--lumiverse-text-muted, #999)",background:"linear-gradient(135deg, rgba(147, 112, 219, 0.1), rgba(147, 112, 219, 0.05))"},cardCheck:{position:"absolute",top:"6px",right:"6px",width:"22px",height:"22px",borderRadius:"50%",background:"var(--lumiverse-primary, #9370db)",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",opacity:0,transform:"scale(0.8)",transition:"all 0.15s ease"},cardCheckVisible:{opacity:1,transform:"scale(1)"},cardIconOverlay:{position:"absolute",width:"26px",height:"26px",borderRadius:"6px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",transition:"all 0.15s ease"},cardDominant:{top:"6px",left:"6px",background:"rgba(0, 0, 0, 0.6)",color:"var(--lumiverse-text-muted, #999)"},cardDominantActive:{background:"rgba(255, 193, 7, 0.9)",color:"#fff"},cardEnableAll:{bottom:"6px",left:"6px",background:"rgba(0, 0, 0, 0.6)",color:"var(--lumiverse-text-muted, #999)"},cardEnableAllActive:{background:"rgba(147, 112, 219, 0.9)",color:"#fff"},cardEdit:{bottom:"6px",right:"6px",background:"rgba(0, 0, 0, 0.6)",color:"var(--lumiverse-text-muted, #999)"},cardInfo:{padding:"8px 10px"},cardName:{fontSize:"11px",fontWeight:500,color:"var(--lumiverse-text, #e0e0e0)",textAlign:"center",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},footer:{display:"flex",justifyContent:"flex-end",gap:"8px",padding:"12px 20px",borderTop:"1px solid var(--lumiverse-border, rgba(255, 255, 255, 0.1))",flexShrink:0},btn:{padding:"10px 16px",fontSize:"13px",fontWeight:500,borderRadius:"8px",border:"none",cursor:"pointer",transition:"all 0.15s ease"},btnSecondary:{background:"rgba(0, 0, 0, 0.3)",color:"var(--lumiverse-text, #e0e0e0)",border:"1px solid var(--lumiverse-border, rgba(255, 255, 255, 0.1))"},btnPrimary:{background:"var(--lumiverse-primary, #9370db)",color:"#fff"}};function Ym(e,n){if(!e)return null;const t={name:["lumiaName","lumiaDefName"],def:["lumiaDefinition","lumiaDef"],personality:["lumiaPersonality","lumia_personality"],behavior:["lumiaBehavior","lumia_behavior"],img:["avatarUrl","lumia_img"]}[n];if(!t)return null;for(const n of t)if(void 0!==e[n]&&null!==e[n])return e[n];return null}function Km(e){let{item:n,packName:t,isSelected:r,isDominant:i,onSelect:a,onSetDominant:o,showDominant:s,isDefinition:l,animationIndex:c,isEditable:u,onEdit:d}=e;const[m,p]=(0,Je.useState)(!1),[g,v]=(0,Je.useState)(!1),h=Nn(),f=Ym(n,"name")||"Unknown",b=Ym(n,"img"),x=function(e){return[!!Ym(e,"def"),!!Ym(e,"behavior"),!!Ym(e,"personality")].filter(Boolean).length>1}(n),y=x&&h.areAllTraitsEnabledForLumia(t,f),{objectPosition:k}=Yn(b);return(0,nn.jsxs)("div",{style:Um(Um({},$m.card),r?$m.cardSelected:{}),onClick:e=>{e.target.closest("[data-action]")||a(n)},"data-pack":t,"data-item":f,children:[(0,nn.jsxs)("div",{style:$m.cardImage,children:[b&&!g?(0,nn.jsx)("img",{src:b,alt:f,loading:"lazy",style:Um(Um({},$m.cardImg),{},{objectPosition:k,opacity:m?1:0}),onLoad:()=>p(!0),onError:()=>v(!0)}):(0,nn.jsx)("div",{style:$m.cardPlaceholder,children:"?"}),x&&(0,nn.jsx)("div",{"data-action":"enable-all",style:Um(Um(Um({},$m.cardIconOverlay),$m.cardEnableAll),y?$m.cardEnableAllActive:{}),onClick:e=>{e.stopPropagation(),h.toggleAllTraitsForLumia(t,f),yn()},title:y?"Disable all traits":"Enable all traits",children:(0,nn.jsx)(Cr,{size:12})}),u&&d&&(0,nn.jsx)("div",{"data-action":"edit",style:Um(Um({},$m.cardIconOverlay),$m.cardEdit),onClick:e=>{e.stopPropagation(),d&&d(n)},title:"Edit this Lumia",children:(0,nn.jsx)(Tm,{size:12})}),s&&(0,nn.jsx)("div",{"data-action":"dominant",style:Um(Um(Um({},$m.cardIconOverlay),$m.cardDominant),i?$m.cardDominantActive:{}),onClick:e=>{e.stopPropagation(),o(n)},title:i?"Remove as dominant":"Set as dominant trait",children:(0,nn.jsx)(Im,{size:12,fill:i?"currentColor":"none"})}),(0,nn.jsx)("div",{style:Um(Um({},$m.cardCheck),r?$m.cardCheckVisible:{}),children:(0,nn.jsx)(rm,{size:12,strokeWidth:3})})]}),(0,nn.jsx)("div",{style:$m.cardInfo,children:(0,nn.jsx)("div",{style:$m.cardName,children:f})})]})}function Qm(e){let{pack:n,items:t,isEditable:r,type:i,isSelected:a,isDominant:o,onSelect:s,onSetDominant:l,showDominant:c,onRemovePack:u,onEditItem:d,isCollapsed:m,onToggleCollapse:p}=e;const[g,v]=(0,Je.useState)(!1),h=void 0!==m,f=h?m:g,b=n.name||n.packName||"Unknown Pack";return(0,nn.jsxs)("div",{style:$m.packSection,children:[(0,nn.jsxs)("div",{style:$m.packHeader,onClick:e=>{e.target.closest("[data-action]")||(h&&p?p(b):v(!g))},children:[(0,nn.jsx)("span",{style:Um(Um({},$m.packCollapseIcon),{},{transform:f?"rotate(-90deg)":"rotate(0deg)"}),children:(0,nn.jsx)(ot,{size:14})}),(0,nn.jsx)(Lm,{size:14,style:$m.packFolderIcon}),(0,nn.jsx)("span",{style:$m.packTitle,children:b}),r&&(0,nn.jsx)("span",{style:$m.packBadge,children:"Custom"}),(0,nn.jsxs)("span",{style:$m.packCount,children:[t.length," items"]}),(0,nn.jsx)("button",{"data-action":"remove",style:$m.packRemoveBtn,onClick:e=>{e.stopPropagation(),u(b)},title:"Remove Pack",children:(0,nn.jsx)(tt,{size:14})})]}),!f&&(0,nn.jsx)("div",{className:"lumiverse-responsive-small-grid",children:t.map((e,n)=>(0,nn.jsx)(Km,{item:e,packName:b,isSelected:a(e,b),isDominant:o(e,b),onSelect:e=>s(e,b),onSetDominant:e=>l(e,b),showDominant:c,isDefinition:"definitions"===i,animationIndex:n,isEditable:r,onEdit:r?e=>d(e,b):void 0},Ym(e,"name")||e.id||n))})]})}const Gm=function(e){let{type:n,multiSelect:t=!0,allowDominant:r=!1,onClose:i}=e;const{allPacks:a}=Vn(),o=Wn(),s=Nn(),l=(0,Je.useSyncExternalStore)(Wm.subscribe,Vm,Vm),c=(0,Je.useSyncExternalStore)(Wm.subscribe,qm,qm),u=function(e){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];switch(e){case"definitions":return n?{title:"Select Chimera Forms",subtitle:"Choose multiple physical forms to fuse into a Chimera",isMulti:!0,dominantKey:null}:{title:"Select Definition",subtitle:"Choose the physical form for your Lumia",isMulti:!1,dominantKey:null};case"behaviors":return{title:"Select Behaviors",subtitle:"Choose behavioral traits (tap star for dominant)",isMulti:!0,dominantKey:"dominantBehavior"};case"personalities":return{title:"Select Personalities",subtitle:"Choose personality traits (tap star for dominant)",isMulti:!0,dominantKey:"dominantPersonality"};default:return{title:"Select Items",subtitle:"",isMulti:!0,dominantKey:null}}}(n,l),d=function(e){switch(e){case"definitions":default:return Rr;case"behaviors":return am;case"personalities":return Dm}}(n),m=(0,Je.useMemo)(()=>{switch(n){case"behaviors":return{selectedItems:o.behaviors||[],dominantItem:o.dominantBehavior,toggleAction:s.toggleBehavior,setDominantAction:s.setDominantBehavior,clearAction:()=>{s.setSelectedBehaviors([]),s.setDominantBehavior(null)}};case"personalities":return{selectedItems:o.personalities||[],dominantItem:o.dominantPersonality,toggleAction:s.togglePersonality,setDominantAction:s.setDominantPersonality,clearAction:()=>{s.setSelectedPersonalities([]),s.setDominantPersonality(null)}};case"definitions":return l?{selectedItems:c,dominantItem:null,toggleAction:s.toggleChimeraDefinition,setDominantAction:null,clearAction:s.clearChimeraDefinitions}:{selectedItems:o.definition?[o.definition]:[],dominantItem:null,toggleAction:e=>{const n=o.definition;n&&n.packName===e.packName&&n.itemName===e.itemName?s.setSelectedDefinition(null):s.setSelectedDefinition(e)},setDominantAction:null,clearAction:()=>s.setSelectedDefinition(null)};default:return{selectedItems:[],dominantItem:null,toggleAction:()=>{},setDominantAction:null,clearAction:()=>{}}}},[n,o,s,l,c]),{selectedItems:p,dominantItem:g,toggleAction:v,setDominantAction:h,clearAction:f}=m;(0,Je.useEffect)(()=>{const e=setTimeout(()=>{yn()},100);return()=>clearTimeout(e)},[p,g]);const[b,x]=(0,Je.useState)(new Set),[y,k]=(0,Je.useState)("default"),w=(0,Je.useMemo)(()=>a.map(e=>{const n=function(e){return e.lumiaItems&&Array.isArray(e.lumiaItems)?e.lumiaItems:(e.items||[]).filter(e=>!e.loomCategory&&!!e.lumiaDefName)}(e);return Um(Um({},e),{},{lumiaItems:n,isEditable:e.isCustom||e.isEditable||!1})}).filter(e=>e.lumiaItems.length>0),[a,n]),j=(0,Je.useMemo)(()=>"default"===y?w:[...w].sort((e,n)=>{if("name"===y){const t=(e.name||e.packName||"").toLowerCase(),r=(n.name||n.packName||"").toLowerCase();return t.localeCompare(r)}if("author"===y){const t=(e.author||"").toLowerCase(),r=(n.author||"").toLowerCase();return t.localeCompare(r)}return 0}),[w,y]),S=(0,Je.useCallback)(e=>{x(n=>{const t=new Set(n);return t.has(e)?t.delete(e):t.add(e),t})},[]),C=(0,Je.useCallback)(e=>b.has(e),[b]),N=(0,Je.useCallback)((e,n)=>{const t=Ym(e,"name");return p.some(e=>e.packName===n&&e.itemName===t)},[p]),P=(0,Je.useCallback)((e,n)=>{if(!g)return!1;const t=Ym(e,"name");return g.packName===n&&g.itemName===t},[g]),E=(0,Je.useCallback)((e,n)=>{const t={packName:n,itemName:Ym(e,"name")};v(t)},[v]),O=(0,Je.useCallback)((e,n)=>{if(!h)return;const t={packName:n,itemName:Ym(e,"name")};N(e,n)||v(t),P(e,n)?h(null):h(t)},[h,v,N,P]),M=(0,Je.useCallback)(()=>{f()},[f]),z=(0,Je.useCallback)(e=>{window.confirm('Delete pack "'.concat(e,'"? This action cannot be undone.'))&&(s.removeCustomPack(e),yn())},[s]),T=(0,Je.useCallback)((e,n)=>{s.openModal("lumiaEditor",{packName:n,editingItem:e})},[s]);return(0,nn.jsxs)("div",{style:$m.layout,children:[(0,nn.jsxs)("div",{style:$m.header,children:[(0,nn.jsx)("div",{style:$m.headerIcon,children:(0,nn.jsx)(d,{size:20})}),(0,nn.jsxs)("div",{style:$m.headerText,children:[(0,nn.jsx)("h3",{style:$m.title,children:u.title}),(0,nn.jsx)("p",{style:$m.subtitle,children:u.subtitle})]}),(0,nn.jsxs)("button",{style:$m.clearBtn,onClick:M,title:"Clear all selections",children:[(0,nn.jsx)(Am,{size:14}),(0,nn.jsx)("span",{children:"Clear"})]})]}),j.length>0&&(0,nn.jsxs)("div",{style:$m.controls,children:[(0,nn.jsxs)("div",{style:$m.controlsGroup,children:[(0,nn.jsxs)("button",{style:$m.controlBtn,onClick:()=>{x(new Set)},title:"Expand all packs",type:"button",children:[(0,nn.jsx)(ot,{size:12}),(0,nn.jsx)("span",{children:"Expand All"})]}),(0,nn.jsxs)("button",{style:$m.controlBtn,onClick:()=>{const e=w.map(e=>e.name||e.packName);x(new Set(e))},title:"Collapse all packs",type:"button",children:[(0,nn.jsx)(Rm,{size:12}),(0,nn.jsx)("span",{children:"Collapse All"})]})]}),(0,nn.jsxs)("div",{style:$m.sortContainer,children:[(0,nn.jsx)(Bm,{size:12}),(0,nn.jsx)("span",{children:"Sort:"}),(0,nn.jsxs)("select",{style:$m.select,value:y,onChange:e=>k(e.target.value),children:[(0,nn.jsx)("option",{value:"default",children:"Default"}),(0,nn.jsx)("option",{value:"name",children:"Pack Name"}),(0,nn.jsx)("option",{value:"author",children:"Author"})]})]})]}),(0,nn.jsx)("div",{style:$m.scrollArea,children:0===j.length?(0,nn.jsx)("div",{style:$m.empty,children:"No Lumia Packs loaded. Add one in settings!"}):j.map(e=>{const t=e.name||e.packName;return(0,nn.jsx)(Qm,{pack:e,items:e.lumiaItems,isEditable:e.isEditable,type:n,isSelected:N,isDominant:P,onSelect:E,onSetDominant:O,showDominant:r&&u.isMulti,onRemovePack:z,onEditItem:T,isCollapsed:C(t),onToggleCollapse:S},e.id||t)})}),(0,nn.jsxs)("div",{style:$m.footer,children:[(0,nn.jsx)("button",{style:Um(Um({},$m.btn),$m.btnSecondary),onClick:i,children:"Close"}),u.isMulti&&(0,nn.jsx)("button",{style:Um(Um({},$m.btn),$m.btnPrimary),onClick:i,children:"Done"})]})]})},Xm=Jn("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);function Zm(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function Jm(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Zm(Object(t),!0).forEach(function(n){ep(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Zm(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function ep(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const np={layout:{display:"flex",flexDirection:"column",height:"100%",maxHeight:"100%",minHeight:0},header:{display:"flex",alignItems:"center",gap:"12px",padding:"16px 20px",borderBottom:"1px solid var(--lumiverse-border, rgba(255, 255, 255, 0.1))",flexShrink:0},searchBox:{flex:1,display:"flex",alignItems:"center",gap:"10px",padding:"8px 12px",background:"rgba(0, 0, 0, 0.25)",border:"1px solid var(--lumiverse-border, rgba(255, 255, 255, 0.1))",borderRadius:"8px"},searchIcon:{color:"var(--lumiverse-text-muted, #999)",flexShrink:0},searchInput:{flex:1,background:"transparent",border:"none",outline:"none",color:"var(--lumiverse-text, #e0e0e0)",fontSize:"13px"},searchClear:{width:"20px",height:"20px",display:"flex",alignItems:"center",justifyContent:"center",background:"transparent",border:"none",color:"var(--lumiverse-text-muted, #999)",cursor:"pointer",borderRadius:"4px",transition:"background 0.15s ease"},selectionInfo:{display:"flex",alignItems:"center",gap:"10px",flexShrink:0},selectionCount:{fontSize:"12px",color:"var(--lumiverse-text-muted, #999)",whiteSpace:"nowrap"},clearBtn:{display:"flex",alignItems:"center",gap:"6px",padding:"8px 12px",fontSize:"12px",fontWeight:500,borderRadius:"6px",border:"1px solid rgba(239, 68, 68, 0.3)",background:"rgba(239, 68, 68, 0.1)",color:"#ef4444",cursor:"pointer",transition:"all 0.15s ease"},controls:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px 20px",background:"rgba(0, 0, 0, 0.15)",borderBottom:"1px solid var(--lumiverse-border, rgba(255, 255, 255, 0.1))",flexShrink:0},controlsGroup:{display:"flex",alignItems:"center",gap:"8px"},controlBtn:{display:"flex",alignItems:"center",gap:"4px",padding:"6px 10px",fontSize:"11px",fontWeight:500,borderRadius:"6px",border:"none",background:"rgba(0, 0, 0, 0.2)",color:"var(--lumiverse-text-muted, #999)",cursor:"pointer",transition:"all 0.15s ease"},sortContainer:{display:"flex",alignItems:"center",gap:"6px",fontSize:"11px",color:"var(--lumiverse-text-muted, #999)"},select:{padding:"5px 24px 5px 8px",fontSize:"11px",borderRadius:"6px",border:"1px solid var(--lumiverse-border, rgba(255, 255, 255, 0.1))",background:"rgba(0, 0, 0, 0.3)",color:"var(--lumiverse-text, #e0e0e0)",cursor:"pointer",appearance:"none",backgroundImage:"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%23999' stroke-width='2'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E\")",backgroundRepeat:"no-repeat",backgroundPosition:"right 6px center"},scrollArea:{flex:"1 1 auto",minHeight:0,overflowY:"auto",padding:"12px 20px"},empty:{textAlign:"center",padding:"40px 20px",color:"var(--lumiverse-text-muted, #999)",fontSize:"14px"},emptyBtn:{marginTop:"12px",padding:"8px 16px",fontSize:"12px",borderRadius:"6px",border:"1px solid var(--lumiverse-border, rgba(255, 255, 255, 0.1))",background:"rgba(0, 0, 0, 0.2)",color:"var(--lumiverse-text, #e0e0e0)",cursor:"pointer"},packSection:{marginBottom:"16px",border:"1px solid var(--lumiverse-border, rgba(255, 255, 255, 0.1))",borderRadius:"10px",overflow:"hidden"},packHeader:{display:"flex",alignItems:"center",gap:"8px",padding:"10px 12px",background:"rgba(0, 0, 0, 0.2)",cursor:"pointer",transition:"background 0.15s ease",width:"100%",border:"none",color:"inherit",textAlign:"left",fontFamily:"inherit"},packCollapseIcon:{color:"var(--lumiverse-text-muted, #999)",transition:"transform 0.2s ease"},packFolderIcon:{color:"var(--lumiverse-primary, #9370db)"},packTitle:{flex:1,fontSize:"13px",fontWeight:500,color:"var(--lumiverse-text, #e0e0e0)"},packBadge:{fontSize:"10px",padding:"2px 6px",borderRadius:"4px",background:"rgba(147, 112, 219, 0.2)",color:"var(--lumiverse-primary, #9370db)"},packCount:{fontSize:"11px",color:"var(--lumiverse-text-muted, #999)"},packRemoveBtn:{width:"24px",height:"24px",borderRadius:"6px",border:"none",background:"transparent",color:"var(--lumiverse-text-muted, #999)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.15s ease"},itemsList:{padding:"8px 12px",display:"flex",flexDirection:"column",gap:"6px"},item:{display:"flex",alignItems:"center",gap:"10px",padding:"10px 12px",background:"rgba(0, 0, 0, 0.15)",border:"1px solid var(--lumiverse-border, rgba(255, 255, 255, 0.1))",borderRadius:"8px",cursor:"pointer",transition:"all 0.15s ease"},itemSelected:{background:"rgba(147, 112, 219, 0.15)",borderColor:"rgba(147, 112, 219, 0.4)"},itemContent:{flex:1,minWidth:0},itemName:{fontSize:"13px",fontWeight:500,color:"var(--lumiverse-text, #e0e0e0)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},itemActions:{display:"flex",alignItems:"center",gap:"8px",flexShrink:0},itemEditBtn:{width:"24px",height:"24px",borderRadius:"6px",border:"none",background:"rgba(0, 0, 0, 0.2)",color:"var(--lumiverse-text-muted, #999)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.15s ease"},toggleSwitch:{width:"36px",height:"20px",borderRadius:"10px",background:"rgba(0, 0, 0, 0.3)",border:"1px solid var(--lumiverse-border, rgba(255, 255, 255, 0.15))",position:"relative",cursor:"pointer",transition:"all 0.15s ease"},toggleSwitchChecked:{background:"var(--lumiverse-primary, #9370db)",borderColor:"var(--lumiverse-primary, #9370db)"},toggleThumb:{width:"16px",height:"16px",borderRadius:"50%",background:"#fff",position:"absolute",top:"1px",left:"1px",transition:"transform 0.15s ease"},toggleThumbChecked:{transform:"translateX(16px)"},footer:{display:"flex",justifyContent:"flex-end",gap:"8px",padding:"12px 20px",borderTop:"1px solid var(--lumiverse-border, rgba(255, 255, 255, 0.1))",flexShrink:0},btn:{padding:"10px 16px",fontSize:"13px",fontWeight:500,borderRadius:"8px",border:"none",cursor:"pointer",transition:"all 0.15s ease"},btnPrimary:{background:"var(--lumiverse-primary, #9370db)",color:"#fff"}},tp={loomStyles:{category:"Narrative Style",packField:"loomStyles",storeField:"styles",toggleAction:"toggleLoomStyle",isMulti:!0},loomUtilities:{category:"Loom Utilities",packField:"loomUtils",storeField:"utilities",toggleAction:"toggleLoomUtility",isMulti:!0},loomRetrofits:{category:"Retrofits",packField:"loomRetrofits",storeField:"retrofits",toggleAction:"toggleLoomRetrofit",isMulti:!0}};function rp(e){let{value:n,onChange:t,placeholder:r}=e;return(0,nn.jsxs)("div",{style:np.searchBox,children:[(0,nn.jsx)(Xm,{size:14,style:np.searchIcon}),(0,nn.jsx)("input",{type:"text",style:np.searchInput,value:n,onChange:e=>t(e.target.value),placeholder:r}),n&&(0,nn.jsx)("button",{style:np.searchClear,onClick:()=>t(""),type:"button","aria-label":"Clear search",children:(0,nn.jsx)(Am,{size:14})})]})}function ip(e){let{item:n,packName:t,isSelected:r,onToggle:i,isMulti:a,isEditable:o,onEdit:s}=e;const l=n.loomName||n.itemName||n.name||"Unknown";return(0,nn.jsxs)("div",{style:Jm(Jm({},np.item),r?np.itemSelected:{}),onClick:()=>i(t,l),role:"button",tabIndex:0,onKeyDown:e=>"Enter"===e.key&&i(t,l),children:[(0,nn.jsx)("div",{style:np.itemContent,children:(0,nn.jsx)("span",{style:np.itemName,children:l})}),(0,nn.jsxs)("div",{style:np.itemActions,children:[o&&s&&(0,nn.jsx)("button",{style:np.itemEditBtn,onClick:e=>{e.stopPropagation(),s&&s(t,n)},title:"Edit this Loom item",type:"button",children:(0,nn.jsx)(Tm,{size:12})}),(0,nn.jsx)("div",{style:Jm(Jm({},np.toggleSwitch),r?np.toggleSwitchChecked:{}),children:(0,nn.jsx)("div",{style:Jm(Jm({},np.toggleThumb),r?np.toggleThumbChecked:{})})})]})]})}function ap(e){let{pack:n,children:t,defaultOpen:r=!0,isEditable:i,onRemovePack:a,isCollapsed:o,onToggleCollapse:s}=e;const[l,c]=(0,Je.useState)(r),u=Je.Children.count(t),d=n.name||n.packName||"Unknown Pack",m=void 0!==o,p=m?!o:l;if(0===u)return null;return(0,nn.jsxs)("div",{style:np.packSection,children:[(0,nn.jsxs)("div",{style:np.packHeader,onClick:e=>{e.target.closest("[data-action]")||(m&&s?s(d):c(!l))},children:[(0,nn.jsx)("span",{style:Jm(Jm({},np.packCollapseIcon),{},{transform:p?"rotate(0deg)":"rotate(-90deg)"}),children:(0,nn.jsx)(ot,{size:14})}),(0,nn.jsx)(Lm,{size:14,style:np.packFolderIcon}),(0,nn.jsx)("span",{style:np.packTitle,children:d}),i&&(0,nn.jsx)("span",{style:np.packBadge,children:"Custom"}),(0,nn.jsxs)("span",{style:np.packCount,children:[u," items"]}),(0,nn.jsx)("button",{"data-action":"remove",style:np.packRemoveBtn,onClick:e=>{e.stopPropagation(),a(d)},title:"Remove Pack",type:"button",children:(0,nn.jsx)(tt,{size:14})})]}),p&&(0,nn.jsx)("div",{style:np.itemsList,children:t})]})}const op=function(e){let{type:n,onClose:t}=e;const[r,i]=(0,Je.useState)(""),[a,o]=(0,Je.useState)(new Set),[s,l]=(0,Je.useState)("default"),{allPacks:c}=Vn(),u=Nn(),d=Hn(),m=tp[n];if(!m)return(0,nn.jsxs)("div",{style:np.empty,children:["Unknown Loom type: ",n]});const{category:p,storeField:g,toggleAction:v,isMulti:h}=m,f=(0,Je.useMemo)(()=>{const e=d[g];return e?Array.isArray(e)?e:[e]:[]},[d,g]),b=(0,Je.useCallback)((e,n)=>f.some(t=>t.packName===e&&t.itemName===n),[f]),x=(0,Je.useCallback)((e,n)=>{const t={packName:e,itemName:n};u[v]?(u[v](t),yn()):console.error("[LoomSelectionModal] Unknown toggle action: ".concat(v))},[u,v]),y=(0,Je.useCallback)(()=>{const e={styles:"setSelectedLoomStyles",utilities:"setSelectedLoomUtilities",retrofits:"setSelectedLoomRetrofits"}[g];u[e]&&(u[e]([]),yn())},[u,g]),k=(0,Je.useMemo)(()=>{const e=r.toLowerCase().trim();return c.map(n=>{const t=function(e,n){const t=[],{category:r,packField:i}=n;return e.loomItems&&Array.isArray(e.loomItems)&&e.loomItems.forEach(e=>{e.loomCategory===r&&t.push(Jm(Jm({},e),{},{loomName:e.loomName||e.itemName||e.name}))}),e[i]&&Array.isArray(e[i])&&e[i].forEach(e=>{t.push(Jm(Jm({},e),{},{loomName:e.loomName||e.itemName||e.name}))}),e.items&&Array.isArray(e.items)&&e.items.forEach(e=>{const n=e.loomCategory||e.category||e.type;n!==r&&n!==i||t.push(Jm(Jm({},e),{},{loomName:e.loomName||e.itemName||e.name}))}),t}(n,m),r=e?t.filter(n=>(n.loomName||n.itemName||n.name||"").toLowerCase().includes(e)):t;return Jm(Jm({},n),{},{loomItems:r,isEditable:n.isCustom||n.isEditable||!1})}).filter(e=>e.loomItems.length>0)},[c,m,r]),w=(0,Je.useMemo)(()=>"default"===s?k:[...k].sort((e,n)=>{if("name"===s){const t=(e.name||e.packName||"").toLowerCase(),r=(n.name||n.packName||"").toLowerCase();return t.localeCompare(r)}if("author"===s){const t=(e.author||"").toLowerCase(),r=(n.author||"").toLowerCase();return t.localeCompare(r)}return 0}),[k,s]),j=(0,Je.useCallback)(()=>{const e=k.map(e=>e.name||e.packName);o(new Set(e))},[k]),S=(0,Je.useCallback)(()=>{o(new Set)},[]),C=(0,Je.useCallback)(e=>{o(n=>{const t=new Set(n);return t.has(e)?t.delete(e):t.add(e),t})},[]),N=e=>a.has(e),P=(0,Je.useCallback)(e=>{window.confirm('Delete pack "'.concat(e,'"? This action cannot be undone.'))&&(u.removeCustomPack(e),yn())},[u]),E=(0,Je.useCallback)((e,n)=>{u.openModal("loomEditor",{packName:e,editingItem:n})},[u]),O=w.reduce((e,n)=>e+n.loomItems.length,0),M=f.length;return(0,nn.jsxs)("div",{style:np.layout,children:[(0,nn.jsxs)("div",{style:np.header,children:[(0,nn.jsx)(rp,{value:r,onChange:i,placeholder:"Search ".concat(p,"...")}),(0,nn.jsxs)("div",{style:np.selectionInfo,children:[(0,nn.jsxs)("span",{style:np.selectionCount,children:[M," selected"]}),M>0&&(0,nn.jsxs)("button",{style:np.clearBtn,onClick:y,title:"Clear all selections",children:[(0,nn.jsx)(Am,{size:14}),(0,nn.jsx)("span",{children:"Clear"})]})]})]}),w.length>0&&(0,nn.jsxs)("div",{style:np.controls,children:[(0,nn.jsxs)("div",{style:np.controlsGroup,children:[(0,nn.jsxs)("button",{style:np.controlBtn,onClick:S,title:"Expand all packs",type:"button",children:[(0,nn.jsx)(ot,{size:12}),(0,nn.jsx)("span",{children:"Expand All"})]}),(0,nn.jsxs)("button",{style:np.controlBtn,onClick:j,title:"Collapse all packs",type:"button",children:[(0,nn.jsx)(Rm,{size:12}),(0,nn.jsx)("span",{children:"Collapse All"})]})]}),(0,nn.jsxs)("div",{style:np.sortContainer,children:[(0,nn.jsx)(Bm,{size:12}),(0,nn.jsx)("span",{children:"Sort:"}),(0,nn.jsxs)("select",{style:np.select,value:s,onChange:e=>l(e.target.value),children:[(0,nn.jsx)("option",{value:"default",children:"Default"}),(0,nn.jsx)("option",{value:"name",children:"Pack Name"}),(0,nn.jsx)("option",{value:"author",children:"Author"})]})]})]}),(0,nn.jsx)("div",{style:np.scrollArea,children:0===O?(0,nn.jsxs)("div",{style:np.empty,children:['No "',p,'" items found in loaded packs.',r&&(0,nn.jsx)("button",{style:np.emptyBtn,onClick:()=>i(""),type:"button",children:"Clear search"})]}):w.map(e=>{const n=(e=>e.name||e.packName||"Unknown Pack")(e);return(0,nn.jsx)(ap,{pack:e,isEditable:e.isEditable,onRemovePack:P,isCollapsed:N(n),onToggleCollapse:C,children:e.loomItems.map(t=>{const r=t.loomName||t.itemName||t.name;return(0,nn.jsx)(ip,{item:t,packName:n,isSelected:b(n,r),onToggle:x,isMulti:h,isEditable:e.isEditable,onEdit:E},"".concat(n,"-").concat(r))})},e.id||n)})}),(0,nn.jsx)("div",{style:np.footer,children:(0,nn.jsx)("button",{style:Jm(Jm({},np.btn),np.btnPrimary),onClick:t,children:"Done"})})]})},sp=Jn("scroll-text",[["path",{d:"M15 12h-5",key:"r7krc0"}],["path",{d:"M15 8h-5",key:"1khuty"}],["path",{d:"M19 17V5a2 2 0 0 0-2-2H4",key:"zz82l3"}],["path",{d:"M8 21h12a2 2 0 0 0 2-2v-1a1 1 0 0 0-1-1H11a1 1 0 0 0-1 1v1a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v2a1 1 0 0 0 1 1h3",key:"1ph1d7"}]]),lp=Jn("folder-plus",[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]);function cp(e){return e.packName||e.name||"Unknown Pack"}function up(e){return e.lumiaName||e.lumiaDefName||"Unknown"}function dp(e){return e.loomName||e.itemName||e.name||"Unknown"}function mp(e){let{item:n,packName:t,onEdit:r}=e;const i=function(e){return e.avatarUrl||e.lumia_img||null}(n),{objectPosition:a}=Yn(i),o=up(n);return(0,nn.jsxs)("div",{className:"lumiverse-pack-selector-item-row",children:[(0,nn.jsx)("div",{className:"lumiverse-pack-selector-item-icon-sm lumiverse-pack-selector-item-icon--lumia",children:i?(0,nn.jsx)("img",{src:i,alt:"",className:"lumiverse-pack-selector-item-avatar",style:{objectPosition:a},onError:e=>{e.target.style.display="none"}}):(0,nn.jsx)(Rr,{size:14,strokeWidth:1.5})}),(0,nn.jsx)("span",{className:"lumiverse-pack-selector-item-name",children:o}),(0,nn.jsx)("span",{className:"lumiverse-pack-selector-item-type",children:"Lumia"}),(0,nn.jsx)("button",{className:"lumiverse-pack-selector-item-edit",onClick:()=>r(t,n,"lumia"),title:"Edit this Lumia",type:"button",children:(0,nn.jsx)(nt,{size:14,strokeWidth:1.5})})]})}function pp(e){let{item:n,packName:t,onEdit:r}=e;const i=dp(n),a=n.loomCategory||n.category||"Unknown",o="Narrative Style"===a?"Style":"Loom Utilities"===a?"Utility":"Retrofits"===a?"Retrofit":a;return(0,nn.jsxs)("div",{className:"lumiverse-pack-selector-item-row lumiverse-pack-selector-item-row--loom",children:[(0,nn.jsx)("div",{className:"lumiverse-pack-selector-item-icon-sm lumiverse-pack-selector-item-icon--loom",children:(0,nn.jsx)(sp,{size:14,strokeWidth:1.5})}),(0,nn.jsx)("span",{className:"lumiverse-pack-selector-item-name",children:i}),(0,nn.jsx)("span",{className:"lumiverse-pack-selector-item-type lumiverse-pack-selector-item-type--loom",children:o}),(0,nn.jsx)("button",{className:"lumiverse-pack-selector-item-edit",onClick:()=>r(t,n,"loom"),title:"Edit this Loom item",type:"button",children:(0,nn.jsx)(nt,{size:14,strokeWidth:1.5})})]})}const gp=function(e){let{onSelect:n,onClose:t}=e;const{customPacks:r,allPacks:i}=Vn(),a=Nn(),[o,s]=(0,Je.useState)(null),[l,c]=(0,Je.useState)(!1),[u,d]=(0,Je.useState)(""),[m,p]=(0,Je.useState)(""),[g,v]=(0,Je.useState)(""),[h,f]=(0,Je.useState)(""),b=i.filter(e=>e.isCustom||!e.url),x=(0,Je.useCallback)(e=>{const n=cp(e);s(e=>e===n?null:n)},[]),y=(0,Je.useCallback)(e=>{a.openModal("itemTypeSelector",{packName:e})},[a]),k=(0,Je.useCallback)((e,n,t)=>{"loom"===t?a.openModal("loomEditor",{packName:e,editingItem:n}):a.openModal("lumiaEditor",{packName:e,editingItem:n})},[a]),w=(0,Je.useCallback)(()=>{const e=u.trim();if(!e)return void f("Pack name is required");if(i.some(n=>n.name===e))return void f('Pack "'.concat(e,'" already exists'));const n={id:"pack_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),packName:e,name:e,packAuthor:m.trim()||null,coverUrl:g.trim()||null,url:"",isCustom:!0,version:1,packExtras:[],lumiaItems:[],loomItems:[]};a.addCustomPack(n),yn(),c(!1),d(""),p(""),v(""),f(""),s(e)},[u,m,g,i,a]),j=e=>e.lumiaItems&&e.lumiaItems.length>0?e.lumiaItems:e.items?e.items.filter(e=>e.lumiaDefName||e.lumiaName):[],S=e=>e.loomItems&&e.loomItems.length>0?e.loomItems:[];return(0,nn.jsxs)(vt,{className:"lumiverse-pack-selector-modal",children:[(0,nn.jsxs)(ht,{className:"lumiverse-pack-selector-content",children:[(0,nn.jsxs)("div",{className:"lumiverse-pack-selector-section",children:[(0,nn.jsx)("h4",{className:"lumiverse-pack-selector-heading",children:"Select a Pack"}),0===b.length?(0,nn.jsx)("div",{className:"lumiverse-pack-selector-empty",children:(0,nn.jsx)("p",{children:"No custom packs yet. Create your first one below!"})}):(0,nn.jsx)("div",{className:"lumiverse-pack-selector-list",children:b.map(e=>{const n=cp(e),t=function(e){return e.packAuthor||e.author||null}(e),r=o===n,i=j(e),a=S(e),s=(e=>{const n=j(e).length,t=S(e).length;return{lumiaCount:n,loomCount:t,total:n+t}})(e);return(0,nn.jsxs)("div",{className:at("lumiverse-pack-selector-item-wrapper",r&&"lumiverse-pack-selector-item-wrapper--expanded"),children:[(0,nn.jsxs)("button",{className:"lumiverse-pack-selector-item",onClick:()=>x(e),type:"button",children:[(0,nn.jsx)("div",{className:"lumiverse-pack-selector-item-icon",children:(0,nn.jsx)(Lm,{size:20,strokeWidth:1.5})}),(0,nn.jsxs)("div",{className:"lumiverse-pack-selector-item-info",children:[(0,nn.jsx)("span",{className:"lumiverse-pack-selector-pack-name",children:n}),(0,nn.jsxs)("span",{className:"lumiverse-pack-selector-item-meta",children:[s.lumiaCount>0&&"".concat(s.lumiaCount," Lumia").concat(1!==s.lumiaCount?"s":""),s.lumiaCount>0&&s.loomCount>0&&" • ",s.loomCount>0&&"".concat(s.loomCount," Loom").concat(1!==s.loomCount?"s":""),0===s.total&&"Empty",t&&" • by ".concat(t)]})]}),r?(0,nn.jsx)(ot,{size:16,className:"lumiverse-pack-selector-item-arrow"}):(0,nn.jsx)(st,{size:16,className:"lumiverse-pack-selector-item-arrow"})]}),r&&(0,nn.jsxs)("div",{className:"lumiverse-pack-selector-items",children:[(0,nn.jsxs)("button",{className:"lumiverse-pack-selector-add-item",onClick:()=>y(n),type:"button",children:[(0,nn.jsx)(Ur,{size:14,strokeWidth:2}),(0,nn.jsx)("span",{children:"Add New Item"})]}),i.length>0||a.length>0?(0,nn.jsxs)("div",{className:"lumiverse-pack-selector-item-list",children:[i.map((e,t)=>(0,nn.jsx)(mp,{item:e,packName:n,onEdit:k},up(e)||"lumia-".concat(t))),a.map((e,t)=>(0,nn.jsx)(pp,{item:e,packName:n,onEdit:k},dp(e)||"loom-".concat(t)))]}):(0,nn.jsx)("div",{className:"lumiverse-pack-selector-items-empty",children:"No items yet. Add your first one!"})]})]},e.id||n)})})]}),(0,nn.jsx)("div",{className:"lumiverse-pack-selector-divider",children:(0,nn.jsx)("span",{children:"or"})}),(0,nn.jsx)("div",{className:"lumiverse-pack-selector-section",children:l?(0,nn.jsxs)("div",{className:"lumiverse-pack-selector-form",children:[(0,nn.jsxs)("h4",{className:"lumiverse-pack-selector-heading",children:[(0,nn.jsx)(lp,{size:16,strokeWidth:1.5}),"Create New Pack"]}),(0,nn.jsx)("div",{className:"lumiverse-pack-selector-field",children:(0,nn.jsx)(yt,{placeholder:"Pack name (required)",value:u,onChange:d,autoFocus:!0})}),(0,nn.jsx)("div",{className:"lumiverse-pack-selector-field",children:(0,nn.jsx)(yt,{placeholder:"Author name (optional)",value:m,onChange:p})}),(0,nn.jsx)("div",{className:"lumiverse-pack-selector-field",children:(0,nn.jsx)(yt,{placeholder:"Cover image URL (optional)",value:g,onChange:v})}),h&&(0,nn.jsx)("div",{className:"lumiverse-pack-selector-error",children:h}),(0,nn.jsxs)("div",{className:"lumiverse-pack-selector-form-actions",children:[(0,nn.jsx)("button",{className:"lumiverse-btn lumiverse-btn--secondary",onClick:()=>{c(!1),d(""),p(""),v(""),f("")},type:"button",children:"Cancel"}),(0,nn.jsxs)("button",{className:"lumiverse-btn lumiverse-btn--primary",onClick:w,type:"button",children:[(0,nn.jsx)(lp,{size:14}),"Create & Continue"]})]})]}):(0,nn.jsxs)("button",{className:"lumiverse-pack-selector-create-btn",onClick:()=>c(!0),type:"button",children:[(0,nn.jsx)(lp,{size:18,strokeWidth:1.5}),(0,nn.jsx)("span",{children:"Create New Pack"})]})})]}),(0,nn.jsx)(ft,{className:"lumiverse-pack-selector-footer",children:(0,nn.jsx)("button",{className:"lumiverse-btn lumiverse-btn--secondary",onClick:t,type:"button",style:{marginLeft:"auto"},children:"Cancel"})})]})},vp=Jn("smile",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]);function hp(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function fp(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?hp(Object(t),!0).forEach(function(n){bp(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):hp(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function bp(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const xp=0,yp=[{value:xp,label:"She/Her"},{value:1,label:"He/Him"},{value:2,label:"They/Them"}];function kp(e,n){if(!e)return null;const t={name:["lumiaName","lumiaDefName"],def:["lumiaDefinition","lumiaDef"],personality:["lumiaPersonality","lumia_personality"],behavior:["lumiaBehavior","lumia_behavior"],img:["avatarUrl","lumia_img"],author:["authorName","defAuthor"],gender:["genderIdentity"]}[n];if(!t)return null;for(const n of t)if(void 0!==e[n]&&null!==e[n])return e[n];return null}const wp={modalLayout:{display:"flex",flexDirection:"column",height:"100%",maxHeight:"100%",minHeight:0,overflow:"hidden"},header:{display:"flex",alignItems:"center",gap:"12px",padding:"16px 20px",background:"var(--lumiverse-bg-elevated)",borderBottom:"1px solid var(--lumiverse-border)",flexShrink:0},headerIcon:{width:"36px",height:"36px",borderRadius:"10px",background:"linear-gradient(135deg, rgba(147, 112, 219, 0.2), rgba(186, 85, 211, 0.15))",display:"flex",alignItems:"center",justifyContent:"center",color:"var(--lumiverse-primary)",flexShrink:0},headerTitle:{flex:1,fontSize:"15px",fontWeight:600,color:"var(--lumiverse-text)",margin:0},headerSubtitle:{fontSize:"12px",color:"var(--lumiverse-text-muted)",marginTop:"2px"},closeBtn:{width:"32px",height:"32px",borderRadius:"8px",border:"none",background:"transparent",color:"var(--lumiverse-text-muted)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.15s ease",flexShrink:0},scrollArea:{flex:"1 1 auto",minHeight:0,overflowY:"auto",overflowX:"hidden",padding:"20px"},section:{marginBottom:"24px"},sectionHeader:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"16px",paddingBottom:"10px",borderBottom:"1px solid var(--lumiverse-border)"},sectionIcon:{width:"28px",height:"28px",borderRadius:"8px",background:"rgba(147, 112, 219, 0.1)",display:"flex",alignItems:"center",justifyContent:"center",color:"var(--lumiverse-primary)"},sectionTitle:{fontSize:"14px",fontWeight:600,color:"var(--lumiverse-text)"},field:{marginBottom:"16px"},label:{display:"flex",alignItems:"center",gap:"6px",marginBottom:"8px",fontSize:"13px",fontWeight:500,color:"var(--lumiverse-text-muted)"},required:{color:"var(--lumiverse-danger)"},hint:{marginTop:"6px",fontSize:"11px",color:"var(--lumiverse-text-dim)",lineHeight:1.4},error:{marginTop:"4px",fontSize:"12px",color:"var(--lumiverse-danger)"},input:{width:"100%",padding:"10px 12px",background:"rgba(0, 0, 0, 0.25)",border:"1px solid var(--lumiverse-border)",borderRadius:"8px",color:"var(--lumiverse-text)",fontSize:"13px",fontFamily:"inherit",outline:"none",transition:"border-color 0.15s ease, box-shadow 0.15s ease",boxSizing:"border-box"},textarea:{width:"100%",padding:"12px",background:"rgba(0, 0, 0, 0.25)",border:"1px solid var(--lumiverse-border)",borderRadius:"8px",color:"var(--lumiverse-text)",fontSize:"13px",fontFamily:"inherit",lineHeight:1.6,resize:"vertical",outline:"none",transition:"border-color 0.15s ease, box-shadow 0.15s ease",boxSizing:"border-box",minHeight:"120px"},select:{width:"100%",padding:"10px 32px 10px 12px",background:"rgba(0, 0, 0, 0.25)",border:"1px solid var(--lumiverse-border)",borderRadius:"8px",color:"var(--lumiverse-text)",fontSize:"13px",fontFamily:"inherit",appearance:"none",cursor:"pointer",outline:"none",boxSizing:"border-box"},selectWrapper:{position:"relative"},selectChevron:{position:"absolute",right:"12px",top:"50%",transform:"translateY(-50%)",pointerEvents:"none",color:"var(--lumiverse-text-muted)"},grid2Col:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px"},imageRow:{display:"flex",gap:"10px",alignItems:"flex-start"},imagePreview:{width:"44px",height:"44px",borderRadius:"8px",overflow:"hidden",border:"1px solid var(--lumiverse-border)",flexShrink:0,background:"rgba(0, 0, 0, 0.2)"},imagePlaceholder:{width:"44px",height:"44px",borderRadius:"8px",border:"1px dashed var(--lumiverse-border)",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,color:"var(--lumiverse-text-dim)",background:"rgba(0, 0, 0, 0.1)"},footer:{display:"flex",alignItems:"center",gap:"8px",padding:"16px 20px",background:"var(--lumiverse-bg-elevated)",borderTop:"1px solid var(--lumiverse-border)",flexShrink:0},btnPrimary:{padding:"10px 20px",borderRadius:"8px",border:"none",background:"var(--lumiverse-primary)",color:"#fff",fontSize:"13px",fontWeight:600,cursor:"pointer",transition:"all 0.15s ease",display:"flex",alignItems:"center",gap:"6px"},btnSecondary:{padding:"10px 16px",borderRadius:"8px",border:"1px solid var(--lumiverse-border)",background:"transparent",color:"var(--lumiverse-text)",fontSize:"13px",fontWeight:500,cursor:"pointer",transition:"all 0.15s ease"},btnDanger:{padding:"10px 16px",borderRadius:"8px",border:"1px solid rgba(239, 68, 68, 0.3)",background:"rgba(239, 68, 68, 0.1)",color:"#ef4444",fontSize:"13px",fontWeight:500,cursor:"pointer",display:"flex",alignItems:"center",gap:"6px",marginRight:"auto"},spacer:{marginRight:"auto"}};function jp(e){let{url:n}=e;const[t,r]=(0,Je.useState)(!1),{objectPosition:i}=Yn(n||"");return Je.useEffect(()=>{r(!1)},[n]),!n||t?(0,nn.jsx)("div",{style:wp.imagePlaceholder,children:(0,nn.jsx)(lt,{size:18})}):(0,nn.jsx)("div",{style:wp.imagePreview,children:(0,nn.jsx)("img",{src:n,alt:"Avatar",style:{width:"100%",height:"100%",objectFit:"cover",objectPosition:i,animation:"lumiverseFadeIn 0.2s ease"},onError:()=>r(!0)})})}const Sp=function(e){var n;let{packName:t,editingItem:r=null,onClose:i,onSaved:a}=e;const{allPacks:o}=Vn(),s=Nn(),l=null!==r,c=o.find(e=>(e.name||e.packName)===t),[u,d]=(0,Je.useState)(kp(r,"name")||""),[m,p]=(0,Je.useState)(kp(r,"img")||""),[g,v]=(0,Je.useState)(kp(r,"author")||""),[h,f]=(0,Je.useState)(kp(r,"def")||""),[b,x]=(0,Je.useState)(kp(r,"personality")||""),[y,k]=(0,Je.useState)(kp(r,"behavior")||""),[w,j]=(0,Je.useState)(null!==(n=kp(r,"gender"))&&void 0!==n?n:xp),[S,C]=(0,Je.useState)({}),N=(0,Je.useCallback)(()=>{const e={};if(u.trim()||(e.name="Lumia name is required"),c&&u.trim()){const n=c.lumiaItems||c.items||[],t=kp(r,"name");n.find(e=>{const n=kp(e,"name");return n===u.trim()&&(!l||n!==t)})&&(e.name='A Lumia named "'.concat(u.trim(),'" already exists'))}return C(e),0===Object.keys(e).length},[u,c,l,r]),P=(0,Je.useCallback)(()=>{if(!N())return;const e={lumiaName:u.trim(),avatarUrl:m.trim()||null,authorName:g.trim()||null,lumiaDefinition:h.trim()||null,lumiaPersonality:b.trim()||null,lumiaBehavior:y.trim()||null,genderIdentity:Number(w),version:1};if(c){const n=[...c.lumiaItems||c.items||[]],i=kp(r,"name");if(l){const t=n.findIndex(e=>kp(e,"name")===i);t>=0?n[t]=e:n.push(e)}else n.push(e);const o=fp(fp({},c),{},{lumiaItems:n,items:void 0}),u=c.id||c.name||c.packName;c.isCustom?s.updateCustomPack(u,o):s.updateCustomPack(u,fp(fp({},o),{},{isCustom:!0})),yn(),a&&a(e,t)}i()},[N,u,m,g,h,b,y,w,c,l,r,s,t,i,a]),E=(0,Je.useCallback)(()=>{if(!l||!r)return;const e=kp(r,"name");if(window.confirm('Delete "'.concat(e,'"? This cannot be undone.'))){if(c){const n=(c.lumiaItems||c.items||[]).filter(n=>kp(n,"name")!==e),t=fp(fp({},c),{},{lumiaItems:n,items:void 0}),r=c.id||c.name||c.packName;c.isCustom?s.updateCustomPack(r,t):s.updateCustomPack(r,fp(fp({},t),{},{isCustom:!0})),yn()}i()}},[l,r,c,s,i]);return c?(0,nn.jsxs)("div",{style:wp.modalLayout,children:[(0,nn.jsxs)("div",{style:wp.header,children:[(0,nn.jsx)("div",{style:wp.headerIcon,children:(0,nn.jsx)(Cr,{size:18})}),(0,nn.jsxs)("div",{style:{flex:1},children:[(0,nn.jsx)("h2",{style:wp.headerTitle,children:l?"Edit Lumia":"Create New Lumia"}),(0,nn.jsx)("div",{style:wp.headerSubtitle,children:c.packName||c.name})]}),(0,nn.jsx)("button",{style:wp.closeBtn,onClick:i,onMouseOver:e=>e.currentTarget.style.background="var(--lumiverse-bg-hover)",onMouseOut:e=>e.currentTarget.style.background="transparent",children:(0,nn.jsx)(Wt,{size:18})})]}),(0,nn.jsxs)("div",{style:wp.scrollArea,children:[(0,nn.jsxs)("div",{style:wp.section,children:[(0,nn.jsxs)("div",{style:wp.sectionHeader,children:[(0,nn.jsx)("div",{style:wp.sectionIcon,children:(0,nn.jsx)(Rr,{size:15})}),(0,nn.jsx)("span",{style:wp.sectionTitle,children:"Basic Info"})]}),(0,nn.jsxs)("div",{style:wp.field,children:[(0,nn.jsxs)("label",{style:wp.label,children:["Lumia Name ",(0,nn.jsx)("span",{style:wp.required,children:"*"})]}),(0,nn.jsx)("input",{type:"text",style:wp.input,value:u,onChange:e=>{d(e.target.value),S.name&&C(e=>fp(fp({},e),{},{name:null}))},placeholder:"e.g., Aria, Luna, Sage",autoFocus:!0}),(0,nn.jsx)("div",{style:wp.hint,children:"Referenced as 'Lumia' in World Books"}),S.name&&(0,nn.jsx)("div",{style:wp.error,children:S.name})]}),(0,nn.jsxs)("div",{style:wp.grid2Col,children:[(0,nn.jsxs)("div",{style:wp.field,children:[(0,nn.jsx)("label",{style:wp.label,children:"Gender Identity"}),(0,nn.jsxs)("div",{style:wp.selectWrapper,children:[(0,nn.jsx)("select",{style:wp.select,value:w,onChange:e=>j(e.target.value),children:yp.map(e=>(0,nn.jsx)("option",{value:e.value,children:e.label},e.value))}),(0,nn.jsx)("div",{style:wp.selectChevron,children:"▼"})]}),(0,nn.jsx)("div",{style:wp.hint,children:"For pronouns macro"})]}),(0,nn.jsxs)("div",{style:wp.field,children:[(0,nn.jsx)("label",{style:wp.label,children:"Author"}),(0,nn.jsx)("input",{type:"text",style:wp.input,value:g,onChange:e=>v(e.target.value),placeholder:"Your name"})]})]}),(0,nn.jsxs)("div",{style:wp.field,children:[(0,nn.jsx)("label",{style:wp.label,children:"Avatar URL"}),(0,nn.jsxs)("div",{style:wp.imageRow,children:[(0,nn.jsx)("div",{style:{flex:1},children:(0,nn.jsx)("input",{type:"text",style:wp.input,value:m,onChange:e=>p(e.target.value),placeholder:"https://..."})}),(0,nn.jsx)(jp,{url:m})]})]})]}),(0,nn.jsxs)("div",{style:wp.section,children:[(0,nn.jsxs)("div",{style:wp.sectionHeader,children:[(0,nn.jsx)("div",{style:wp.sectionIcon,children:(0,nn.jsx)(Rr,{size:15})}),(0,nn.jsx)("span",{style:wp.sectionTitle,children:"Physical Definition"})]}),(0,nn.jsxs)("div",{style:wp.field,children:[(0,nn.jsx)("label",{style:wp.label,children:"Physicality"}),(0,nn.jsx)("textarea",{style:wp.textarea,value:h,onChange:e=>f(e.target.value),placeholder:"Describe Lumia's physical appearance, form, and presence...",rows:6}),(0,nn.jsxs)("div",{style:wp.hint,children:["Injected via ","{{lumiaDef}}"," macro"]})]})]}),(0,nn.jsxs)("div",{style:wp.section,children:[(0,nn.jsxs)("div",{style:wp.sectionHeader,children:[(0,nn.jsx)("div",{style:wp.sectionIcon,children:(0,nn.jsx)(vp,{size:15})}),(0,nn.jsx)("span",{style:wp.sectionTitle,children:"Personality Traits"})]}),(0,nn.jsxs)("div",{style:wp.field,children:[(0,nn.jsx)("label",{style:wp.label,children:"Personality"}),(0,nn.jsx)("textarea",{style:wp.textarea,value:b,onChange:e=>x(e.target.value),placeholder:"Describe Lumia's personality, disposition, and inner nature...",rows:6}),(0,nn.jsxs)("div",{style:wp.hint,children:["Injected via ","{{lumiaPersonality}}"," macro"]})]})]}),(0,nn.jsxs)("div",{style:wp.section,children:[(0,nn.jsxs)("div",{style:wp.sectionHeader,children:[(0,nn.jsx)("div",{style:wp.sectionIcon,children:(0,nn.jsx)(am,{size:15})}),(0,nn.jsx)("span",{style:wp.sectionTitle,children:"Behavioral Patterns"})]}),(0,nn.jsxs)("div",{style:wp.field,children:[(0,nn.jsx)("label",{style:wp.label,children:"Behavior"}),(0,nn.jsx)("textarea",{style:wp.textarea,value:y,onChange:e=>k(e.target.value),placeholder:"Describe Lumia's behavioral patterns, habits, and tendencies...",rows:6}),(0,nn.jsxs)("div",{style:wp.hint,children:["Injected via ","{{lumiaBehavior}}"," macro"]})]})]})]}),(0,nn.jsxs)("div",{style:wp.footer,children:[l?(0,nn.jsxs)("button",{style:wp.btnDanger,onClick:E,children:[(0,nn.jsx)(tt,{size:14})," Delete"]}):(0,nn.jsx)("div",{style:wp.spacer}),(0,nn.jsx)("button",{style:wp.btnSecondary,onClick:i,children:"Cancel"}),(0,nn.jsx)("button",{style:wp.btnPrimary,onClick:P,children:l?"Save Changes":"Create Lumia"})]})]}):(0,nn.jsx)("div",{style:wp.modalLayout,children:(0,nn.jsxs)("div",{style:fp(fp({},wp.scrollArea),{},{textAlign:"center",paddingTop:"40px"}),children:[(0,nn.jsxs)("p",{style:{color:"var(--lumiverse-text-muted)"},children:['Pack "',t,'" not found.']}),(0,nn.jsx)("button",{style:wp.btnSecondary,onClick:i,children:"Close"})]})})},Cp=Jn("palette",[["path",{d:"M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z",key:"e79jfc"}],["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}]]),Np=Jn("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);function Pp(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function Ep(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Pp(Object(t),!0).forEach(function(n){Op(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Pp(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Op(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const Mp=[{value:"Narrative Style",label:"Narrative Style",description:"Writing style and prose guidance",Icon:Cp},{value:"Loom Utilities",label:"Utility",description:"Helper functions and techniques",Icon:am},{value:"Retrofits",label:"Retrofit",description:"System modifications and enhancements",Icon:Np}];function zp(e,n){if(!e)return null;const t={name:["loomName","itemName","name"],content:["loomContent","content"],category:["loomCategory","category","type"],author:["authorName","author"]}[n];if(!t)return null;for(const n of t)if(void 0!==e[n]&&null!==e[n])return e[n];return null}function Tp(e){switch(e){case"Narrative Style":return"Injected via {{loomStyle}} macro. Describe prose style, tone, and writing approach.";case"Loom Utilities":return"Injected via {{loomUtils}} macro. Define helper techniques or utility functions.";case"Retrofits":return"Injected via {{loomRetrofits}} macro. System modifications and enhancements.";default:return""}}function Ip(e){switch(e){case"Narrative Style":return"Write in a dark, atmospheric style. Use vivid sensory descriptions emphasizing shadows, decay, and unease...";case"Loom Utilities":return"When transitioning between scenes, use a brief temporal or spatial marker followed by sensory grounding...";case"Retrofits":return"Track and reference previous conversations, character states, and plot points. Maintain consistency...";default:return"Enter the content for this Loom item..."}}const Lp=function(e){var n;let{packName:t,editingItem:r=null,onClose:i,onSaved:a}=e;const{allPacks:o}=Vn(),s=Nn(),l=null!==r,c=o.find(e=>(e.name||e.packName)===t),[u,d]=(0,Je.useState)(zp(r,"name")||""),[m,p]=(0,Je.useState)(zp(r,"content")||""),[g,v]=(0,Je.useState)(zp(r,"category")||"Narrative Style"),[h,f]=(0,Je.useState)(zp(r,"author")||""),[b,x]=(0,Je.useState)({}),y=(0,Je.useCallback)(()=>{const e={};if(u.trim()||(e.name="Loom name is required"),m.trim()||(e.content="Content is required"),c&&u.trim()){const n=c.loomItems||[],t=zp(r,"name");n.find(e=>{const n=zp(e,"name");return n===u.trim()&&(!l||n!==t)})&&(e.name='A Loom item named "'.concat(u.trim(),'" already exists in this pack'))}return x(e),0===Object.keys(e).length},[u,m,c,l,r]),k=(0,Je.useCallback)(()=>{if(!y())return;const e={loomName:u.trim(),loomContent:m.trim(),loomCategory:g,authorName:h.trim()||null,version:1};if(c){const n=[...c.loomItems||[]],i=zp(r,"name");if(l){const t=n.findIndex(e=>zp(e,"name")===i);t>=0?n[t]=e:n.push(e)}else n.push(e);const o=Ep(Ep({},c),{},{loomItems:n}),u=c.id||c.name||c.packName;c.isCustom?s.updateCustomPack(u,o):s.updateCustomPack(u,Ep(Ep({},o),{},{isCustom:!0})),yn(),a&&a(e,t)}i()},[y,u,m,g,h,c,l,r,s,t,i,a]),w=(0,Je.useCallback)(()=>{if(!l||!r)return;const e=zp(r,"name");if(window.confirm('Are you sure you want to delete "'.concat(e,'"? This cannot be undone.'))){if(c){const n=(c.loomItems||[]).filter(n=>zp(n,"name")!==e),t=Ep(Ep({},c),{},{loomItems:n}),r=c.id||c.name||c.packName;c.isCustom?s.updateCustomPack(r,t):s.updateCustomPack(r,Ep(Ep({},t),{},{isCustom:!0})),yn()}i()}},[l,r,c,s,i]);return c?(0,nn.jsxs)(vt,{children:[(0,nn.jsxs)(ht,{children:[(0,nn.jsxs)(xt,{Icon:sp,title:"Loom Details",children:[(0,nn.jsx)(bt,{label:"Loom Name",required:!0,error:b.name,children:(0,nn.jsx)(yt,{value:u,onChange:e=>{d(e),b.name&&x(e=>Ep(Ep({},e),{},{name:null}))},placeholder:"e.g., Gothic Horror, Scene Helper",autoFocus:!0})}),(0,nn.jsx)(bt,{label:"Author",children:(0,nn.jsx)(yt,{value:h,onChange:e=>f(e),placeholder:"Your name"})}),(0,nn.jsx)(bt,{label:"Category",required:!0,children:(0,nn.jsx)("div",{className:"lumiverse-loom-category-options",style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"8px"},children:Mp.map(e=>(0,nn.jsxs)("button",{type:"button",className:at("lumiverse-loom-category-btn",g===e.value&&"lumiverse-loom-category-btn--selected"),onClick:()=>v(e.value),title:e.description,style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"6px",padding:"10px 4px",background:g===e.value?"rgba(147, 112, 219, 0.15)":"rgba(0, 0, 0, 0.2)",border:"1px solid ".concat(g===e.value?"var(--lumiverse-primary)":"var(--lumiverse-border)"),borderRadius:"8px",color:g===e.value?"var(--lumiverse-primary)":"var(--lumiverse-text-muted)",cursor:"pointer",transition:"all 0.2s ease"},children:[(0,nn.jsx)(e.Icon,{size:16,strokeWidth:1.5}),(0,nn.jsx)("span",{style:{fontSize:"11px",fontWeight:500},children:e.label})]},e.value))})})]}),(0,nn.jsx)(xt,{Icon:(null===(n=Mp.find(e=>e.value===g))||void 0===n?void 0:n.Icon)||sp,title:"Content",children:(0,nn.jsx)(bt,{label:"Loom Content",required:!0,error:b.content,hint:Tp(g),children:(0,nn.jsx)(kt,{value:m,onChange:e=>{p(e),b.content&&x(e=>Ep(Ep({},e),{},{content:null}))},placeholder:Ip(g),rows:12})})})]}),(0,nn.jsxs)(ft,{children:[l&&(0,nn.jsxs)("button",{className:"lumiverse-btn lumiverse-btn--danger",onClick:w,type:"button",style:{marginRight:"auto"},children:[(0,nn.jsx)(tt,{size:14,style:{marginRight:"6px"}}),"Delete"]}),!l&&(0,nn.jsx)("div",{style:{marginRight:"auto"}}),(0,nn.jsx)("button",{className:"lumiverse-btn lumiverse-btn--secondary",onClick:i,type:"button",style:{marginRight:"8px"},children:"Cancel"}),(0,nn.jsx)("button",{className:"lumiverse-btn lumiverse-btn--primary",onClick:k,type:"button",children:l?"Save Changes":"Create Loom"})]})]}):(0,nn.jsxs)("div",{className:"lumiverse-editor-modal lumiverse-editor-error",children:[(0,nn.jsxs)("p",{children:['Pack "',t,'" not found.']}),(0,nn.jsx)("button",{className:"lumiverse-btn lumiverse-btn--secondary",onClick:i,children:"Close"})]})},Dp=Jn("arrow-right",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);const Ap=function(e){let{packName:n,onSelectLumia:t,onSelectLoom:r,onBack:i}=e;const[a,o]=(0,Je.useState)(null);return(0,nn.jsxs)(vt,{className:"lumiverse-type-selector",children:[(0,nn.jsxs)(ht,{className:"lumiverse-type-selector-content",children:[(0,nn.jsxs)("div",{className:"lumiverse-type-selector-header",style:{textAlign:"center",marginBottom:"24px"},children:[(0,nn.jsxs)("h3",{className:"lumiverse-type-selector-title",style:{fontSize:"18px",fontWeight:600,color:"var(--lumiverse-text)",marginBottom:"8px"},children:["Add to ",n]}),(0,nn.jsx)("p",{className:"lumiverse-type-selector-subtitle",style:{fontSize:"13px",color:"var(--lumiverse-text-muted)"},children:"Choose what you'd like to create"})]}),(0,nn.jsxs)("div",{className:"lumiverse-type-selector-options",style:{display:"flex",flexDirection:"column",gap:"12px"},children:[(0,nn.jsxs)("button",{className:at("lumiverse-type-option","lumiverse-type-option--lumia","lumia"===a&&"lumiverse-type-option--hovered"),onClick:t,onMouseEnter:()=>o("lumia"),onMouseLeave:()=>o(null),type:"button",style:{display:"flex",alignItems:"center",textAlign:"left",padding:"16px",background:"lumia"===a?"rgba(147, 112, 219, 0.15)":"rgba(0, 0, 0, 0.2)",border:"1px solid ".concat("lumia"===a?"var(--lumiverse-primary)":"var(--lumiverse-border)"),borderRadius:"12px",cursor:"pointer",transition:"all 0.2s ease",width:"100%"},children:[(0,nn.jsx)("div",{className:"lumiverse-type-option-icon",style:{width:"48px",height:"48px",borderRadius:"50%",background:"rgba(147, 112, 219, 0.15)",display:"flex",alignItems:"center",justifyContent:"center",color:"var(--lumiverse-primary)",marginRight:"16px",flexShrink:0},children:(0,nn.jsx)(Rr,{size:24,strokeWidth:1.5})}),(0,nn.jsxs)("div",{className:"lumiverse-type-option-content",style:{flex:1},children:[(0,nn.jsx)("span",{className:"lumiverse-type-option-label",style:{display:"block",fontSize:"15px",fontWeight:600,color:"var(--lumiverse-text)",marginBottom:"4px"},children:"Lumia"}),(0,nn.jsx)("span",{className:"lumiverse-type-option-desc",style:{display:"block",fontSize:"12px",color:"var(--lumiverse-text-muted)",lineHeight:1.4},children:"Character definition with physicality, personality, and behavior"})]}),(0,nn.jsx)("div",{className:"lumiverse-type-option-arrow",style:{color:"lumia"===a?"var(--lumiverse-primary)":"var(--lumiverse-text-dim)",marginLeft:"12px"},children:(0,nn.jsx)(Dp,{size:20,strokeWidth:2})})]}),(0,nn.jsxs)("button",{className:at("lumiverse-type-option","lumiverse-type-option--loom","loom"===a&&"lumiverse-type-option--hovered"),onClick:r,onMouseEnter:()=>o("loom"),onMouseLeave:()=>o(null),type:"button",style:{display:"flex",alignItems:"center",textAlign:"left",padding:"16px",background:"loom"===a?"rgba(147, 112, 219, 0.15)":"rgba(0, 0, 0, 0.2)",border:"1px solid ".concat("loom"===a?"var(--lumiverse-primary)":"var(--lumiverse-border)"),borderRadius:"12px",cursor:"pointer",transition:"all 0.2s ease",width:"100%"},children:[(0,nn.jsx)("div",{className:"lumiverse-type-option-icon",style:{width:"48px",height:"48px",borderRadius:"50%",background:"rgba(147, 112, 219, 0.15)",display:"flex",alignItems:"center",justifyContent:"center",color:"var(--lumiverse-primary)",marginRight:"16px",flexShrink:0},children:(0,nn.jsx)(sp,{size:24,strokeWidth:1.5})}),(0,nn.jsxs)("div",{className:"lumiverse-type-option-content",style:{flex:1},children:[(0,nn.jsx)("span",{className:"lumiverse-type-option-label",style:{display:"block",fontSize:"15px",fontWeight:600,color:"var(--lumiverse-text)",marginBottom:"4px"},children:"Loom"}),(0,nn.jsx)("span",{className:"lumiverse-type-option-desc",style:{display:"block",fontSize:"12px",color:"var(--lumiverse-text-muted)",lineHeight:1.4},children:"Narrative style, utility, or retrofit modifier"})]}),(0,nn.jsx)("div",{className:"lumiverse-type-option-arrow",style:{color:"loom"===a?"var(--lumiverse-primary)":"var(--lumiverse-text-dim)",marginLeft:"12px"},children:(0,nn.jsx)(Dp,{size:20,strokeWidth:2})})]})]})]}),i&&(0,nn.jsx)(ft,{className:"lumiverse-type-selector-footer",children:(0,nn.jsx)("button",{className:"lumiverse-btn lumiverse-btn--secondary",onClick:i,type:"button",style:{marginRight:"auto"},children:"Back"})})]})},Rp=Jn("heart",[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]]);function Bp(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function _p(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Bp(Object(t),!0).forEach(function(n){Up(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Bp(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Up(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const Fp=wn,Wp=[],Hp=()=>Fp.getState().councilMembers||Wp;function Vp(e,n){return e?e.lumiaItems&&e.lumiaItems.length>0?e.lumiaItems.find(e=>e.lumiaName===n||e.lumiaDefName===n):e.items?e.items.find(e=>e.lumiaDefName===n):null:null}function qp(e,n){if(!e)return null;const t={name:["lumiaName","lumiaDefName"],def:["lumiaDefinition","lumiaDef"],img:["avatarUrl","lumia_img"]}[n];if(!t)return null;for(const n of t)if(void 0!==e[n]&&null!==e[n])return e[n];return null}const $p=(0,Je.memo)(function(e){let{item:n,packName:t,onAdd:r,animationIndex:i}=e;const a=qp(n,"img"),o=qp(n,"name")||"Unknown",[s,l]=(0,Je.useState)(!1),c="undefined"!=typeof window&&window.innerWidth<=600?0:i<10?20*i:0,u=(0,Je.useCallback)(e=>{e.stopPropagation(),e.preventDefault(),r({packName:t,itemName:o})},[r,t,o]),d=(0,Je.useCallback)(()=>l(!0),[]);return(0,nn.jsxs)("div",{className:"lumiverse-council-select-card lumia-card-appear",style:c?{animationDelay:"".concat(c,"ms")}:void 0,onPointerUp:u,role:"button",tabIndex:0,children:[(0,nn.jsxs)("div",{className:"lumiverse-council-select-card-image",children:[a&&!s?(0,nn.jsx)("img",{src:a,alt:o,loading:"lazy",className:"lumia-img-loaded",onError:d}):(0,nn.jsx)("div",{className:"lumiverse-council-select-card-placeholder",children:(0,nn.jsx)(nm,{size:24,strokeWidth:1.5})}),(0,nn.jsx)("div",{className:"lumiverse-council-select-card-add",children:(0,nn.jsx)(Ur,{size:16,strokeWidth:2})})]}),(0,nn.jsxs)("div",{className:"lumiverse-council-select-card-info",children:[(0,nn.jsx)("span",{className:"lumiverse-council-select-card-name",children:o}),(0,nn.jsx)("span",{className:"lumiverse-council-select-card-pack",children:t})]})]})}),Yp=(0,Je.memo)(function(e){var n,t;let{member:r,packs:i,onRemove:a,onUpdateRole:o}=e;const[s,l]=(0,Je.useState)(!1),[c,u]=(0,Je.useState)(r.role||""),d=function(e,n,t){const r=(Array.isArray(e)?e.reduce((e,n)=>_p(_p({},e),{},{[n.name||n.packName]:n}),{}):e)[n];if(!r)return t;const i=Vp(r,t);return(null==i?void 0:i.lumiaName)||(null==i?void 0:i.lumiaDefName)||t}(i,r.packName,r.itemName),m=function(e,n,t){const r=(Array.isArray(e)?e.reduce((e,n)=>_p(_p({},e),{},{[n.name||n.packName]:n}),{}):e)[n];if(!r)return null;const i=Vp(r,t);return(null==i?void 0:i.avatarUrl)||(null==i?void 0:i.lumia_img)||null}(i,r.packName,r.itemName),p=(0,Je.useCallback)(()=>{o(r.id,{role:c}),l(!1)},[r.id,c,o]),g=(0,Je.useCallback)(e=>{"Enter"===e.key&&p(),"Escape"===e.key&&(u(r.role||""),l(!1))},[p,r.role]),v=(0,Je.useCallback)(e=>{e.stopPropagation(),e.preventDefault(),a(r.id)},[r.id,a]),h=(null===(n=r.behaviors)||void 0===n?void 0:n.length)||0,f=(null===(t=r.personalities)||void 0===t?void 0:t.length)||0;return(0,nn.jsxs)("div",{className:"lumiverse-council-member-card",children:[(0,nn.jsx)("div",{className:"lumiverse-council-member-card-avatar",children:m?(0,nn.jsx)("img",{src:m,alt:d}):(0,nn.jsx)(nm,{size:20,strokeWidth:1.5})}),(0,nn.jsxs)("div",{className:"lumiverse-council-member-card-content",children:[(0,nn.jsx)("span",{className:"lumiverse-council-member-card-name",children:d}),s?(0,nn.jsxs)("div",{className:"lumiverse-council-member-role-edit",children:[(0,nn.jsx)("input",{type:"text",className:"lumiverse-council-input-sm",placeholder:"Role/title...",value:c,onChange:e=>u(e.target.value),onKeyDown:g,autoFocus:!0}),(0,nn.jsx)("button",{className:"lumiverse-council-btn-sm lumiverse-council-btn-sm--primary",onPointerUp:e=>{e.stopPropagation(),e.preventDefault(),p()},type:"button",children:(0,nn.jsx)(rm,{size:12,strokeWidth:2})}),(0,nn.jsx)("button",{className:"lumiverse-council-btn-sm",onPointerUp:e=>{e.stopPropagation(),e.preventDefault(),u(r.role||""),l(!1)},type:"button",children:(0,nn.jsx)(Wt,{size:12,strokeWidth:2})})]}):(0,nn.jsxs)("div",{className:"lumiverse-council-member-card-meta",children:[r.role?(0,nn.jsx)("span",{className:"lumiverse-council-member-card-role",onPointerUp:e=>{e.stopPropagation(),e.preventDefault(),l(!0)},title:"Tap to edit role",children:r.role}):(0,nn.jsxs)("button",{className:"lumiverse-council-add-role-btn",onPointerUp:e=>{e.stopPropagation(),e.preventDefault(),l(!0)},type:"button",children:[(0,nn.jsx)(nt,{size:10})," Add role"]}),(0,nn.jsxs)("span",{className:"lumiverse-council-member-card-stats",children:[(0,nn.jsxs)("span",{title:"Behaviors",children:[(0,nn.jsx)(Ut,{size:10})," ",h]}),(0,nn.jsxs)("span",{title:"Personalities",children:[(0,nn.jsx)(Rp,{size:10})," ",f]})]})]})]}),(0,nn.jsx)("button",{className:"lumiverse-council-btn-sm lumiverse-council-btn-sm--danger",onPointerUp:v,title:"Remove from council",type:"button",children:(0,nn.jsx)(tt,{size:14,strokeWidth:1.5})})]})});function Kp(){return(0,nn.jsxs)("div",{className:"lumiverse-council-select-empty",children:[(0,nn.jsx)(nm,{size:24,strokeWidth:1.5}),(0,nn.jsx)("span",{children:"No council members yet"}),(0,nn.jsx)("p",{children:"Select Lumias from below to add them to your council."})]})}function Qp(e){let{hasSearch:n}=e;return(0,nn.jsx)("div",{className:"lumiverse-council-select-empty lumiverse-council-select-empty--muted",children:n?(0,nn.jsxs)(nn.Fragment,{children:[(0,nn.jsx)(Xm,{size:24,strokeWidth:1.5}),(0,nn.jsx)("span",{children:"No matching Lumias"}),(0,nn.jsx)("p",{children:"Try a different search term."})]}):(0,nn.jsxs)(nn.Fragment,{children:[(0,nn.jsx)(nm,{size:24,strokeWidth:1.5}),(0,nn.jsx)("span",{children:"No Lumias available"}),(0,nn.jsx)("p",{children:"All Lumias are already in the council, or no packs are loaded."})]})})}const Gp=function(e){let{onClose:n}=e;const t=Nn(),{allPacks:r}=Vn(),[i,a]=(0,Je.useState)(""),[o,s]=(0,Je.useState)(20),l=(0,Je.useSyncExternalStore)(Fp.subscribe,Hp,Hp),c=(0,Je.useMemo)(()=>Array.isArray(r)?r.reduce((e,n)=>_p(_p({},e),{},{[n.name||n.packName]:n}),{}):r||{},[r]),u=(0,Je.useMemo)(()=>{const e=new Set(l.map(e=>"".concat(e.packName,":").concat(e.itemName))),n=[];if((Array.isArray(r)?r:Object.values(r||{})).forEach(t=>{const r=t.name||t.packName;t.lumiaItems&&t.lumiaItems.length>0?t.lumiaItems.forEach(t=>{const i=t.lumiaName||t.lumiaDefName,a=t.lumiaDefinition||t.lumiaDef;if(!i||!a)return;const o="".concat(r,":").concat(i);e.has(o)||n.push({packName:r,item:t})}):t.items&&t.items.forEach(t=>{if(!t.lumiaDefName||!t.lumiaDef)return;const i="".concat(r,":").concat(t.lumiaDefName);e.has(i)||n.push({packName:r,item:t})})}),i.trim()){const e=i.toLowerCase();return n.filter(n=>{let{item:t,packName:r}=n;return(qp(t,"name")||"").toLowerCase().includes(e)||r.toLowerCase().includes(e)})}return n},[r,l,i]),d=(0,Je.useCallback)(e=>{t.addCouncilMember(e),kn()},[t]),m=(0,Je.useCallback)(e=>{t.removeCouncilMember(e),kn()},[t]),p=(0,Je.useCallback)((e,n)=>{t.updateCouncilMember(e,n),yn()},[t]);return(0,nn.jsxs)("div",{className:"lumiverse-council-select-modal",children:[(0,nn.jsxs)("div",{className:"lumiverse-council-select-header",children:[(0,nn.jsx)("div",{className:"lumiverse-council-select-header-icon",children:(0,nn.jsx)(nm,{size:20,strokeWidth:1.5})}),(0,nn.jsxs)("div",{className:"lumiverse-council-select-header-text",children:[(0,nn.jsx)("h3",{children:"Configure Council"}),(0,nn.jsx)("p",{children:"Select Lumias to join your council of independent characters."})]})]}),(0,nn.jsxs)("div",{className:"lumiverse-council-select-section",children:[(0,nn.jsxs)("div",{className:"lumiverse-council-select-section-header",children:[(0,nn.jsx)("span",{children:"Council Members"}),(0,nn.jsx)("span",{className:"lumiverse-council-select-count",children:l.length})]}),(0,nn.jsx)("div",{className:"lumiverse-council-select-members",children:0===l.length?(0,nn.jsx)(Kp,{}):(0,nn.jsx)("div",{className:"lumiverse-council-member-list",children:l.map(e=>(0,nn.jsx)(Yp,{member:e,packs:c,onRemove:m,onUpdateRole:p},e.id))})})]}),(0,nn.jsxs)("div",{className:"lumiverse-council-select-section lumiverse-council-select-section--available",children:[(0,nn.jsxs)("div",{className:"lumiverse-council-select-section-header",children:[(0,nn.jsx)("span",{children:"Add Lumias"}),(0,nn.jsxs)("div",{className:"lumiverse-council-search-wrapper",children:[(0,nn.jsx)(Xm,{size:14,strokeWidth:1.5}),(0,nn.jsx)("input",{type:"text",className:"lumiverse-council-search-input",placeholder:"Search...",value:i,onChange:e=>a(e.target.value)}),i&&(0,nn.jsx)("button",{className:"lumiverse-council-search-clear",onClick:()=>a(""),type:"button",children:(0,nn.jsx)(Wt,{size:12,strokeWidth:2})})]})]}),(0,nn.jsx)("div",{className:"lumiverse-council-select-grid-wrapper",children:0===u.length?(0,nn.jsx)(Qp,{hasSearch:!!i.trim()}):(0,nn.jsxs)(nn.Fragment,{children:[(0,nn.jsx)("div",{className:"lumiverse-council-select-grid",children:u.slice(0,o).map((e,n)=>{let{item:t,packName:r}=e;return(0,nn.jsx)($p,{item:t,packName:r,onAdd:d,animationIndex:n},"".concat(r,":").concat(qp(t,"name")))})}),u.length>o&&(0,nn.jsxs)("button",{className:"lumiverse-council-show-more",onClick:()=>s(e=>e+20),type:"button",children:["Show more (",u.length-o," remaining)"]})]})})]}),(0,nn.jsx)("div",{className:"lumiverse-council-select-footer",children:(0,nn.jsx)("button",{className:"lumia-modal-btn lumia-modal-btn-primary",onClick:n,type:"button",children:"Done"})})]})};const Xp="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement;function Zp(e){const n=Object.prototype.toString.call(e);return"[object Window]"===n||"[object global]"===n}function Jp(e){return"nodeType"in e}function eg(e){var n,t;return e?Zp(e)?e:Jp(e)&&null!=(n=null==(t=e.ownerDocument)?void 0:t.defaultView)?n:window:window}function ng(e){const{Document:n}=eg(e);return e instanceof n}function tg(e){return!Zp(e)&&e instanceof eg(e).HTMLElement}function rg(e){return e instanceof eg(e).SVGElement}function ig(e){return e?Zp(e)?e.document:Jp(e)?ng(e)?e:tg(e)||rg(e)?e.ownerDocument:document:document:document}const ag=Xp?Je.useLayoutEffect:Je.useEffect;function og(e){const n=(0,Je.useRef)(e);return ag(()=>{n.current=e}),(0,Je.useCallback)(function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return null==n.current?void 0:n.current(...t)},[])}function sg(e,n){void 0===n&&(n=[e]);const t=(0,Je.useRef)(e);return ag(()=>{t.current!==e&&(t.current=e)},n),t}function lg(e,n){const t=(0,Je.useRef)();return(0,Je.useMemo)(()=>{const n=e(t.current);return t.current=n,n},[...n])}function cg(e){const n=og(e),t=(0,Je.useRef)(null),r=(0,Je.useCallback)(e=>{e!==t.current&&(null==n||n(e,t.current)),t.current=e},[]);return[t,r]}function ug(e){const n=(0,Je.useRef)();return(0,Je.useEffect)(()=>{n.current=e},[e]),n.current}let dg={};function mg(e,n){return(0,Je.useMemo)(()=>{if(n)return n;const t=null==dg[e]?0:dg[e]+1;return dg[e]=t,e+"-"+t},[e,n])}function pg(e){return function(n){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return r.reduce((n,t)=>{const r=Object.entries(t);for(const[t,i]of r){const r=n[t];null!=r&&(n[t]=r+e*i)}return n},{...n})}}const gg=pg(1),vg=pg(-1);function hg(e){if(!e)return!1;const{KeyboardEvent:n}=eg(e.target);return n&&e instanceof n}function fg(e){if(function(e){if(!e)return!1;const{TouchEvent:n}=eg(e.target);return n&&e instanceof n}(e)){if(e.touches&&e.touches.length){const{clientX:n,clientY:t}=e.touches[0];return{x:n,y:t}}if(e.changedTouches&&e.changedTouches.length){const{clientX:n,clientY:t}=e.changedTouches[0];return{x:n,y:t}}}return function(e){return"clientX"in e&&"clientY"in e}(e)?{x:e.clientX,y:e.clientY}:null}const bg=Object.freeze({Translate:{toString(e){if(!e)return;const{x:n,y:t}=e;return"translate3d("+(n?Math.round(n):0)+"px, "+(t?Math.round(t):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;const{scaleX:n,scaleY:t}=e;return"scaleX("+n+") scaleY("+t+")"}},Transform:{toString(e){if(e)return[bg.Translate.toString(e),bg.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:n,duration:t,easing:r}=e;return n+" "+t+"ms "+r}}}),xg="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function yg(e){return e.matches(xg)?e:e.querySelector(xg)}const kg={display:"none"};function wg(e){let{id:n,value:t}=e;return Je.createElement("div",{id:n,style:kg},t)}function jg(e){let{id:n,announcement:t,ariaLiveType:r="assertive"}=e;return Je.createElement("div",{id:n,style:{position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"},role:"status","aria-live":r,"aria-atomic":!0},t)}const Sg=(0,Je.createContext)(null);const Cg={draggable:"\n    To pick up a draggable item, press the space bar.\n    While dragging, use the arrow keys to move the item.\n    Press space again to drop the item in its new position, or press escape to cancel.\n  "},Ng={onDragStart(e){let{active:n}=e;return"Picked up draggable item "+n.id+"."},onDragOver(e){let{active:n,over:t}=e;return t?"Draggable item "+n.id+" was moved over droppable area "+t.id+".":"Draggable item "+n.id+" is no longer over a droppable area."},onDragEnd(e){let{active:n,over:t}=e;return t?"Draggable item "+n.id+" was dropped over droppable area "+t.id:"Draggable item "+n.id+" was dropped."},onDragCancel(e){let{active:n}=e;return"Dragging was cancelled. Draggable item "+n.id+" was dropped."}};function Pg(e){let{announcements:n=Ng,container:t,hiddenTextDescribedById:r,screenReaderInstructions:i=Cg}=e;const{announce:a,announcement:o}=function(){const[e,n]=(0,Je.useState)("");return{announce:(0,Je.useCallback)(e=>{null!=e&&n(e)},[]),announcement:e}}(),s=mg("DndLiveRegion"),[l,c]=(0,Je.useState)(!1);if((0,Je.useEffect)(()=>{c(!0)},[]),function(e){const n=(0,Je.useContext)(Sg);(0,Je.useEffect)(()=>{if(!n)throw new Error("useDndMonitor must be used within a children of <DndContext>");return n(e)},[e,n])}((0,Je.useMemo)(()=>({onDragStart(e){let{active:t}=e;a(n.onDragStart({active:t}))},onDragMove(e){let{active:t,over:r}=e;n.onDragMove&&a(n.onDragMove({active:t,over:r}))},onDragOver(e){let{active:t,over:r}=e;a(n.onDragOver({active:t,over:r}))},onDragEnd(e){let{active:t,over:r}=e;a(n.onDragEnd({active:t,over:r}))},onDragCancel(e){let{active:t,over:r}=e;a(n.onDragCancel({active:t,over:r}))}}),[a,n])),!l)return null;const u=Je.createElement(Je.Fragment,null,Je.createElement(wg,{id:r,value:i.draggable}),Je.createElement(jg,{id:s,announcement:o}));return t?(0,Dt.createPortal)(u,t):u}var Eg;function Og(){}function Mg(e,n){return(0,Je.useMemo)(()=>({sensor:e,options:null!=n?n:{}}),[e,n])}!function(e){e.DragStart="dragStart",e.DragMove="dragMove",e.DragEnd="dragEnd",e.DragCancel="dragCancel",e.DragOver="dragOver",e.RegisterDroppable="registerDroppable",e.SetDroppableDisabled="setDroppableDisabled",e.UnregisterDroppable="unregisterDroppable"}(Eg||(Eg={}));const zg=Object.freeze({x:0,y:0});function Tg(e,n){return Math.sqrt(Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2))}function Ig(e,n){const t=fg(e);if(!t)return"0 0";return(t.x-n.left)/n.width*100+"% "+(t.y-n.top)/n.height*100+"%"}function Lg(e,n){let{data:{value:t}}=e,{data:{value:r}}=n;return t-r}function Dg(e,n){let{data:{value:t}}=e,{data:{value:r}}=n;return r-t}function Ag(e){let{left:n,top:t,height:r,width:i}=e;return[{x:n,y:t},{x:n+i,y:t},{x:n,y:t+r},{x:n+i,y:t+r}]}function Rg(e,n){if(!e||0===e.length)return null;const[t]=e;return n?t[n]:t}function Bg(e,n,t){return void 0===n&&(n=e.left),void 0===t&&(t=e.top),{x:n+.5*e.width,y:t+.5*e.height}}const _g=e=>{let{collisionRect:n,droppableRects:t,droppableContainers:r}=e;const i=Bg(n,n.left,n.top),a=[];for(const e of r){const{id:n}=e,r=t.get(n);if(r){const t=Tg(Bg(r),i);a.push({id:n,data:{droppableContainer:e,value:t}})}}return a.sort(Lg)};function Ug(e,n){const t=Math.max(n.top,e.top),r=Math.max(n.left,e.left),i=Math.min(n.left+n.width,e.left+e.width),a=Math.min(n.top+n.height,e.top+e.height),o=i-r,s=a-t;if(r<i&&t<a){const t=n.width*n.height,r=e.width*e.height,i=o*s;return Number((i/(t+r-i)).toFixed(4))}return 0}const Fg=e=>{let{collisionRect:n,droppableRects:t,droppableContainers:r}=e;const i=[];for(const e of r){const{id:r}=e,a=t.get(r);if(a){const t=Ug(a,n);t>0&&i.push({id:r,data:{droppableContainer:e,value:t}})}}return i.sort(Dg)};function Wg(e,n){return e&&n?{x:e.left-n.left,y:e.top-n.top}:zg}function Hg(e){return function(n){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return r.reduce((n,t)=>({...n,top:n.top+e*t.y,bottom:n.bottom+e*t.y,left:n.left+e*t.x,right:n.right+e*t.x}),{...n})}}const Vg=Hg(1);function qg(e){if(e.startsWith("matrix3d(")){const n=e.slice(9,-1).split(/, /);return{x:+n[12],y:+n[13],scaleX:+n[0],scaleY:+n[5]}}if(e.startsWith("matrix(")){const n=e.slice(7,-1).split(/, /);return{x:+n[4],y:+n[5],scaleX:+n[0],scaleY:+n[3]}}return null}const $g={ignoreTransform:!1};function Yg(e,n){void 0===n&&(n=$g);let t=e.getBoundingClientRect();if(n.ignoreTransform){const{transform:n,transformOrigin:r}=eg(e).getComputedStyle(e);n&&(t=function(e,n,t){const r=qg(n);if(!r)return e;const{scaleX:i,scaleY:a,x:o,y:s}=r,l=e.left-o-(1-i)*parseFloat(t),c=e.top-s-(1-a)*parseFloat(t.slice(t.indexOf(" ")+1)),u=i?e.width/i:e.width,d=a?e.height/a:e.height;return{width:u,height:d,top:c,right:l+u,bottom:c+d,left:l}}(t,n,r))}const{top:r,left:i,width:a,height:o,bottom:s,right:l}=t;return{top:r,left:i,width:a,height:o,bottom:s,right:l}}function Kg(e){return Yg(e,{ignoreTransform:!0})}function Qg(e,n){const t=[];return e?function r(i){if(null!=n&&t.length>=n)return t;if(!i)return t;if(ng(i)&&null!=i.scrollingElement&&!t.includes(i.scrollingElement))return t.push(i.scrollingElement),t;if(!tg(i)||rg(i))return t;if(t.includes(i))return t;const a=eg(e).getComputedStyle(i);return i!==e&&function(e,n){void 0===n&&(n=eg(e).getComputedStyle(e));const t=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(e=>{const r=n[e];return"string"==typeof r&&t.test(r)})}(i,a)&&t.push(i),function(e,n){return void 0===n&&(n=eg(e).getComputedStyle(e)),"fixed"===n.position}(i,a)?t:r(i.parentNode)}(e):t}function Gg(e){const[n]=Qg(e,1);return null!=n?n:null}function Xg(e){return Xp&&e?Zp(e)?e:Jp(e)?ng(e)||e===ig(e).scrollingElement?window:tg(e)?e:null:null:null}function Zg(e){return Zp(e)?e.scrollX:e.scrollLeft}function Jg(e){return Zp(e)?e.scrollY:e.scrollTop}function ev(e){return{x:Zg(e),y:Jg(e)}}var nv;function tv(e){return!(!Xp||!e)&&e===document.scrollingElement}function rv(e){const n={x:0,y:0},t=tv(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},r={x:e.scrollWidth-t.width,y:e.scrollHeight-t.height};return{isTop:e.scrollTop<=n.y,isLeft:e.scrollLeft<=n.x,isBottom:e.scrollTop>=r.y,isRight:e.scrollLeft>=r.x,maxScroll:r,minScroll:n}}!function(e){e[e.Forward=1]="Forward",e[e.Backward=-1]="Backward"}(nv||(nv={}));const iv={x:.2,y:.2};function av(e,n,t,r,i){let{top:a,left:o,right:s,bottom:l}=t;void 0===r&&(r=10),void 0===i&&(i=iv);const{isTop:c,isBottom:u,isLeft:d,isRight:m}=rv(e),p={x:0,y:0},g={x:0,y:0},v=n.height*i.y,h=n.width*i.x;return!c&&a<=n.top+v?(p.y=nv.Backward,g.y=r*Math.abs((n.top+v-a)/v)):!u&&l>=n.bottom-v&&(p.y=nv.Forward,g.y=r*Math.abs((n.bottom-v-l)/v)),!m&&s>=n.right-h?(p.x=nv.Forward,g.x=r*Math.abs((n.right-h-s)/h)):!d&&o<=n.left+h&&(p.x=nv.Backward,g.x=r*Math.abs((n.left+h-o)/h)),{direction:p,speed:g}}function ov(e){if(e===document.scrollingElement){const{innerWidth:e,innerHeight:n}=window;return{top:0,left:0,right:e,bottom:n,width:e,height:n}}const{top:n,left:t,right:r,bottom:i}=e.getBoundingClientRect();return{top:n,left:t,right:r,bottom:i,width:e.clientWidth,height:e.clientHeight}}function sv(e){return e.reduce((e,n)=>gg(e,ev(n)),zg)}function lv(e,n){if(void 0===n&&(n=Yg),!e)return;const{top:t,left:r,bottom:i,right:a}=n(e);Gg(e)&&(i<=0||a<=0||t>=window.innerHeight||r>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}const cv=[["x",["left","right"],function(e){return e.reduce((e,n)=>e+Zg(n),0)}],["y",["top","bottom"],function(e){return e.reduce((e,n)=>e+Jg(n),0)}]];class uv{constructor(e,n){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const t=Qg(n),r=sv(t);this.rect={...e},this.width=e.width,this.height=e.height;for(const[e,n,i]of cv)for(const a of n)Object.defineProperty(this,a,{get:()=>{const n=i(t),o=r[e]-n;return this.rect[a]+o},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class dv{constructor(e){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(e=>{var n;return null==(n=this.target)?void 0:n.removeEventListener(...e)})},this.target=e}add(e,n,t){var r;null==(r=this.target)||r.addEventListener(e,n,t),this.listeners.push([e,n,t])}}function mv(e,n){const t=Math.abs(e.x),r=Math.abs(e.y);return"number"==typeof n?Math.sqrt(t**2+r**2)>n:"x"in n&&"y"in n?t>n.x&&r>n.y:"x"in n?t>n.x:"y"in n&&r>n.y}var pv,gv;function vv(e){e.preventDefault()}function hv(e){e.stopPropagation()}!function(e){e.Click="click",e.DragStart="dragstart",e.Keydown="keydown",e.ContextMenu="contextmenu",e.Resize="resize",e.SelectionChange="selectionchange",e.VisibilityChange="visibilitychange"}(pv||(pv={})),function(e){e.Space="Space",e.Down="ArrowDown",e.Right="ArrowRight",e.Left="ArrowLeft",e.Up="ArrowUp",e.Esc="Escape",e.Enter="Enter",e.Tab="Tab"}(gv||(gv={}));const fv={start:[gv.Space,gv.Enter],cancel:[gv.Esc],end:[gv.Space,gv.Enter,gv.Tab]},bv=(e,n)=>{let{currentCoordinates:t}=n;switch(e.code){case gv.Right:return{...t,x:t.x+25};case gv.Left:return{...t,x:t.x-25};case gv.Down:return{...t,y:t.y+25};case gv.Up:return{...t,y:t.y-25}}};class xv{constructor(e){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=e;const{event:{target:n}}=e;this.props=e,this.listeners=new dv(ig(n)),this.windowListeners=new dv(eg(n)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(pv.Resize,this.handleCancel),this.windowListeners.add(pv.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(pv.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:e,onStart:n}=this.props,t=e.node.current;t&&lv(t),n(zg)}handleKeyDown(e){if(hg(e)){const{active:n,context:t,options:r}=this.props,{keyboardCodes:i=fv,coordinateGetter:a=bv,scrollBehavior:o="smooth"}=r,{code:s}=e;if(i.end.includes(s))return void this.handleEnd(e);if(i.cancel.includes(s))return void this.handleCancel(e);const{collisionRect:l}=t.current,c=l?{x:l.left,y:l.top}:zg;this.referenceCoordinates||(this.referenceCoordinates=c);const u=a(e,{active:n,context:t.current,currentCoordinates:c});if(u){const n=vg(u,c),r={x:0,y:0},{scrollableAncestors:i}=t.current;for(const t of i){const i=e.code,{isTop:a,isRight:s,isLeft:l,isBottom:c,maxScroll:d,minScroll:m}=rv(t),p=ov(t),g={x:Math.min(i===gv.Right?p.right-p.width/2:p.right,Math.max(i===gv.Right?p.left:p.left+p.width/2,u.x)),y:Math.min(i===gv.Down?p.bottom-p.height/2:p.bottom,Math.max(i===gv.Down?p.top:p.top+p.height/2,u.y))},v=i===gv.Right&&!s||i===gv.Left&&!l,h=i===gv.Down&&!c||i===gv.Up&&!a;if(v&&g.x!==u.x){const e=t.scrollLeft+n.x,a=i===gv.Right&&e<=d.x||i===gv.Left&&e>=m.x;if(a&&!n.y)return void t.scrollTo({left:e,behavior:o});r.x=a?t.scrollLeft-e:i===gv.Right?t.scrollLeft-d.x:t.scrollLeft-m.x,r.x&&t.scrollBy({left:-r.x,behavior:o});break}if(h&&g.y!==u.y){const e=t.scrollTop+n.y,a=i===gv.Down&&e<=d.y||i===gv.Up&&e>=m.y;if(a&&!n.x)return void t.scrollTo({top:e,behavior:o});r.y=a?t.scrollTop-e:i===gv.Down?t.scrollTop-d.y:t.scrollTop-m.y,r.y&&t.scrollBy({top:-r.y,behavior:o});break}}this.handleMove(e,gg(vg(u,this.referenceCoordinates),r))}}}handleMove(e,n){const{onMove:t}=this.props;e.preventDefault(),t(n)}handleEnd(e){const{onEnd:n}=this.props;e.preventDefault(),this.detach(),n()}handleCancel(e){const{onCancel:n}=this.props;e.preventDefault(),this.detach(),n()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}function yv(e){return Boolean(e&&"distance"in e)}function kv(e){return Boolean(e&&"delay"in e)}xv.activators=[{eventName:"onKeyDown",handler:(e,n,t)=>{let{keyboardCodes:r=fv,onActivation:i}=n,{active:a}=t;const{code:o}=e.nativeEvent;if(r.start.includes(o)){const n=a.activatorNode.current;return(!n||e.target===n)&&(e.preventDefault(),null==i||i({event:e.nativeEvent}),!0)}return!1}}];class wv{constructor(e,n,t){var r;void 0===t&&(t=function(e){const{EventTarget:n}=eg(e);return e instanceof n?e:ig(e)}(e.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=e,this.events=n;const{event:i}=e,{target:a}=i;this.props=e,this.events=n,this.document=ig(a),this.documentListeners=new dv(this.document),this.listeners=new dv(t),this.windowListeners=new dv(eg(a)),this.initialCoordinates=null!=(r=fg(i))?r:zg,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:e,props:{options:{activationConstraint:n,bypassActivationConstraint:t}}}=this;if(this.listeners.add(e.move.name,this.handleMove,{passive:!1}),this.listeners.add(e.end.name,this.handleEnd),e.cancel&&this.listeners.add(e.cancel.name,this.handleCancel),this.windowListeners.add(pv.Resize,this.handleCancel),this.windowListeners.add(pv.DragStart,vv),this.windowListeners.add(pv.VisibilityChange,this.handleCancel),this.windowListeners.add(pv.ContextMenu,vv),this.documentListeners.add(pv.Keydown,this.handleKeydown),n){if(null!=t&&t({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(kv(n))return this.timeoutId=setTimeout(this.handleStart,n.delay),void this.handlePending(n);if(yv(n))return void this.handlePending(n)}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),null!==this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(e,n){const{active:t,onPending:r}=this.props;r(t,e,this.initialCoordinates,n)}handleStart(){const{initialCoordinates:e}=this,{onStart:n}=this.props;e&&(this.activated=!0,this.documentListeners.add(pv.Click,hv,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(pv.SelectionChange,this.removeTextSelection),n(e))}handleMove(e){var n;const{activated:t,initialCoordinates:r,props:i}=this,{onMove:a,options:{activationConstraint:o}}=i;if(!r)return;const s=null!=(n=fg(e))?n:zg,l=vg(r,s);if(!t&&o){if(yv(o)){if(null!=o.tolerance&&mv(l,o.tolerance))return this.handleCancel();if(mv(l,o.distance))return this.handleStart()}return kv(o)&&mv(l,o.tolerance)?this.handleCancel():void this.handlePending(o,l)}e.cancelable&&e.preventDefault(),a(s)}handleEnd(){const{onAbort:e,onEnd:n}=this.props;this.detach(),this.activated||e(this.props.active),n()}handleCancel(){const{onAbort:e,onCancel:n}=this.props;this.detach(),this.activated||e(this.props.active),n()}handleKeydown(e){e.code===gv.Esc&&this.handleCancel()}removeTextSelection(){var e;null==(e=this.document.getSelection())||e.removeAllRanges()}}const jv={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class Sv extends wv{constructor(e){const{event:n}=e,t=ig(n.target);super(e,jv,t)}}Sv.activators=[{eventName:"onPointerDown",handler:(e,n)=>{let{nativeEvent:t}=e,{onActivation:r}=n;return!(!t.isPrimary||0!==t.button)&&(null==r||r({event:t}),!0)}}];const Cv={move:{name:"mousemove"},end:{name:"mouseup"}};var Nv;!function(e){e[e.RightClick=2]="RightClick"}(Nv||(Nv={}));(class extends wv{constructor(e){super(e,Cv,ig(e.event.target))}}).activators=[{eventName:"onMouseDown",handler:(e,n)=>{let{nativeEvent:t}=e,{onActivation:r}=n;return t.button!==Nv.RightClick&&(null==r||r({event:t}),!0)}}];const Pv={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};var Ev,Ov;function Mv(e){let{acceleration:n,activator:t=Ev.Pointer,canScroll:r,draggingRect:i,enabled:a,interval:o=5,order:s=Ov.TreeOrder,pointerCoordinates:l,scrollableAncestors:c,scrollableAncestorRects:u,delta:d,threshold:m}=e;const p=function(e){let{delta:n,disabled:t}=e;const r=ug(n);return lg(e=>{if(t||!r||!e)return zv;const i={x:Math.sign(n.x-r.x),y:Math.sign(n.y-r.y)};return{x:{[nv.Backward]:e.x[nv.Backward]||-1===i.x,[nv.Forward]:e.x[nv.Forward]||1===i.x},y:{[nv.Backward]:e.y[nv.Backward]||-1===i.y,[nv.Forward]:e.y[nv.Forward]||1===i.y}}},[t,n,r])}({delta:d,disabled:!a}),[g,v]=function(){const e=(0,Je.useRef)(null);return[(0,Je.useCallback)((n,t)=>{e.current=setInterval(n,t)},[]),(0,Je.useCallback)(()=>{null!==e.current&&(clearInterval(e.current),e.current=null)},[])]}(),h=(0,Je.useRef)({x:0,y:0}),f=(0,Je.useRef)({x:0,y:0}),b=(0,Je.useMemo)(()=>{switch(t){case Ev.Pointer:return l?{top:l.y,bottom:l.y,left:l.x,right:l.x}:null;case Ev.DraggableRect:return i}},[t,i,l]),x=(0,Je.useRef)(null),y=(0,Je.useCallback)(()=>{const e=x.current;if(!e)return;const n=h.current.x*f.current.x,t=h.current.y*f.current.y;e.scrollBy(n,t)},[]),k=(0,Je.useMemo)(()=>s===Ov.TreeOrder?[...c].reverse():c,[s,c]);(0,Je.useEffect)(()=>{if(a&&c.length&&b){for(const e of k){if(!1===(null==r?void 0:r(e)))continue;const t=c.indexOf(e),i=u[t];if(!i)continue;const{direction:a,speed:s}=av(e,i,b,n,m);for(const e of["x","y"])p[e][a[e]]||(s[e]=0,a[e]=0);if(s.x>0||s.y>0)return v(),x.current=e,g(y,o),h.current=s,void(f.current=a)}h.current={x:0,y:0},f.current={x:0,y:0},v()}else v()},[n,y,r,v,a,o,JSON.stringify(b),JSON.stringify(p),g,c,k,u,JSON.stringify(m)])}(class extends wv{constructor(e){super(e,Pv)}static setup(){return window.addEventListener(Pv.move.name,e,{capture:!1,passive:!1}),function(){window.removeEventListener(Pv.move.name,e)};function e(){}}}).activators=[{eventName:"onTouchStart",handler:(e,n)=>{let{nativeEvent:t}=e,{onActivation:r}=n;const{touches:i}=t;return!(i.length>1)&&(null==r||r({event:t}),!0)}}],function(e){e[e.Pointer=0]="Pointer",e[e.DraggableRect=1]="DraggableRect"}(Ev||(Ev={})),function(e){e[e.TreeOrder=0]="TreeOrder",e[e.ReversedTreeOrder=1]="ReversedTreeOrder"}(Ov||(Ov={}));const zv={x:{[nv.Backward]:!1,[nv.Forward]:!1},y:{[nv.Backward]:!1,[nv.Forward]:!1}};var Tv,Iv;!function(e){e[e.Always=0]="Always",e[e.BeforeDragging=1]="BeforeDragging",e[e.WhileDragging=2]="WhileDragging"}(Tv||(Tv={})),function(e){e.Optimized="optimized"}(Iv||(Iv={}));const Lv=new Map;function Dv(e,n){return lg(t=>e?t||("function"==typeof n?n(e):e):null,[n,e])}function Av(e){let{callback:n,disabled:t}=e;const r=og(n),i=(0,Je.useMemo)(()=>{if(t||"undefined"==typeof window||void 0===window.ResizeObserver)return;const{ResizeObserver:e}=window;return new e(r)},[t]);return(0,Je.useEffect)(()=>()=>null==i?void 0:i.disconnect(),[i]),i}function Rv(e){return new uv(Yg(e),e)}function Bv(e,n,t){void 0===n&&(n=Rv);const[r,i]=(0,Je.useState)(null);function a(){i(r=>{if(!e)return null;var i;if(!1===e.isConnected)return null!=(i=null!=r?r:t)?i:null;const a=n(e);return JSON.stringify(r)===JSON.stringify(a)?r:a})}const o=function(e){let{callback:n,disabled:t}=e;const r=og(n),i=(0,Je.useMemo)(()=>{if(t||"undefined"==typeof window||void 0===window.MutationObserver)return;const{MutationObserver:e}=window;return new e(r)},[r,t]);return(0,Je.useEffect)(()=>()=>null==i?void 0:i.disconnect(),[i]),i}({callback(n){if(e)for(const t of n){const{type:n,target:r}=t;if("childList"===n&&r instanceof HTMLElement&&r.contains(e)){a();break}}}}),s=Av({callback:a});return ag(()=>{a(),e?(null==s||s.observe(e),null==o||o.observe(document.body,{childList:!0,subtree:!0})):(null==s||s.disconnect(),null==o||o.disconnect())},[e]),r}const _v=[];function Uv(e,n){void 0===n&&(n=[]);const t=(0,Je.useRef)(null);return(0,Je.useEffect)(()=>{t.current=null},n),(0,Je.useEffect)(()=>{const n=e!==zg;n&&!t.current&&(t.current=e),!n&&t.current&&(t.current=null)},[e]),t.current?vg(e,t.current):zg}function Fv(e){return(0,Je.useMemo)(()=>e?function(e){const n=e.innerWidth,t=e.innerHeight;return{top:0,left:0,right:n,bottom:t,width:n,height:t}}(e):null,[e])}const Wv=[];function Hv(e){if(!e)return null;if(e.children.length>1)return e;const n=e.children[0];return tg(n)?n:e}const Vv=[{sensor:Sv,options:{}},{sensor:xv,options:{}}],qv={current:{}},$v={draggable:{measure:Kg},droppable:{measure:Kg,strategy:Tv.WhileDragging,frequency:Iv.Optimized},dragOverlay:{measure:Yg}};class Yv extends Map{get(e){var n;return null!=e&&null!=(n=super.get(e))?n:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(e=>{let{disabled:n}=e;return!n})}getNodeFor(e){var n,t;return null!=(n=null==(t=this.get(e))?void 0:t.node.current)?n:void 0}}const Kv={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new Yv,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:Og},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:$v,measureDroppableContainers:Og,windowRect:null,measuringScheduled:!1},Qv={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:Og,draggableNodes:new Map,over:null,measureDroppableContainers:Og},Gv=(0,Je.createContext)(Qv),Xv=(0,Je.createContext)(Kv);function Zv(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new Yv}}}function Jv(e,n){switch(n.type){case Eg.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:n.initialCoordinates,active:n.active}};case Eg.DragMove:return null==e.draggable.active?e:{...e,draggable:{...e.draggable,translate:{x:n.coordinates.x-e.draggable.initialCoordinates.x,y:n.coordinates.y-e.draggable.initialCoordinates.y}}};case Eg.DragEnd:case Eg.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case Eg.RegisterDroppable:{const{element:t}=n,{id:r}=t,i=new Yv(e.droppable.containers);return i.set(r,t),{...e,droppable:{...e.droppable,containers:i}}}case Eg.SetDroppableDisabled:{const{id:t,key:r,disabled:i}=n,a=e.droppable.containers.get(t);if(!a||r!==a.key)return e;const o=new Yv(e.droppable.containers);return o.set(t,{...a,disabled:i}),{...e,droppable:{...e.droppable,containers:o}}}case Eg.UnregisterDroppable:{const{id:t,key:r}=n,i=e.droppable.containers.get(t);if(!i||r!==i.key)return e;const a=new Yv(e.droppable.containers);return a.delete(t),{...e,droppable:{...e.droppable,containers:a}}}default:return e}}function eh(e){let{disabled:n}=e;const{active:t,activatorEvent:r,draggableNodes:i}=(0,Je.useContext)(Gv),a=ug(r),o=ug(null==t?void 0:t.id);return(0,Je.useEffect)(()=>{if(!n&&!r&&a&&null!=o){if(!hg(a))return;if(document.activeElement===a.target)return;const e=i.get(o);if(!e)return;const{activatorNode:n,node:t}=e;if(!n.current&&!t.current)return;requestAnimationFrame(()=>{for(const e of[n.current,t.current]){if(!e)continue;const n=yg(e);if(n){n.focus();break}}})}},[r,n,i,o,a]),null}function nh(e,n){let{transform:t,...r}=n;return null!=e&&e.length?e.reduce((e,n)=>n({transform:e,...r}),t):t}const th=(0,Je.createContext)({...zg,scaleX:1,scaleY:1});var rh;!function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initializing=1]="Initializing",e[e.Initialized=2]="Initialized"}(rh||(rh={}));const ih=(0,Je.memo)(function(e){var n,t,r,i;let{id:a,accessibility:o,autoScroll:s=!0,children:l,sensors:c=Vv,collisionDetection:u=Fg,measuring:d,modifiers:m,...p}=e;const g=(0,Je.useReducer)(Jv,void 0,Zv),[v,h]=g,[f,b]=function(){const[e]=(0,Je.useState)(()=>new Set),n=(0,Je.useCallback)(n=>(e.add(n),()=>e.delete(n)),[e]);return[(0,Je.useCallback)(n=>{let{type:t,event:r}=n;e.forEach(e=>{var n;return null==(n=e[t])?void 0:n.call(e,r)})},[e]),n]}(),[x,y]=(0,Je.useState)(rh.Uninitialized),k=x===rh.Initialized,{draggable:{active:w,nodes:j,translate:S},droppable:{containers:C}}=v,N=null!=w?j.get(w):null,P=(0,Je.useRef)({initial:null,translated:null}),E=(0,Je.useMemo)(()=>{var e;return null!=w?{id:w,data:null!=(e=null==N?void 0:N.data)?e:qv,rect:P}:null},[w,N]),O=(0,Je.useRef)(null),[M,z]=(0,Je.useState)(null),[T,I]=(0,Je.useState)(null),L=sg(p,Object.values(p)),D=mg("DndDescribedBy",a),A=(0,Je.useMemo)(()=>C.getEnabled(),[C]),R=(B=d,(0,Je.useMemo)(()=>({draggable:{...$v.draggable,...null==B?void 0:B.draggable},droppable:{...$v.droppable,...null==B?void 0:B.droppable},dragOverlay:{...$v.dragOverlay,...null==B?void 0:B.dragOverlay}}),[null==B?void 0:B.draggable,null==B?void 0:B.droppable,null==B?void 0:B.dragOverlay]));var B;const{droppableRects:_,measureDroppableContainers:U,measuringScheduled:F}=function(e,n){let{dragging:t,dependencies:r,config:i}=n;const[a,o]=(0,Je.useState)(null),{frequency:s,measure:l,strategy:c}=i,u=(0,Je.useRef)(e),d=function(){switch(c){case Tv.Always:return!1;case Tv.BeforeDragging:return t;default:return!t}}(),m=sg(d),p=(0,Je.useCallback)(function(e){void 0===e&&(e=[]),m.current||o(n=>null===n?e:n.concat(e.filter(e=>!n.includes(e))))},[m]),g=(0,Je.useRef)(null),v=lg(n=>{if(d&&!t)return Lv;if(!n||n===Lv||u.current!==e||null!=a){const n=new Map;for(let t of e){if(!t)continue;if(a&&a.length>0&&!a.includes(t.id)&&t.rect.current){n.set(t.id,t.rect.current);continue}const e=t.node.current,r=e?new uv(l(e),e):null;t.rect.current=r,r&&n.set(t.id,r)}return n}return n},[e,a,t,d,l]);return(0,Je.useEffect)(()=>{u.current=e},[e]),(0,Je.useEffect)(()=>{d||p()},[t,d]),(0,Je.useEffect)(()=>{a&&a.length>0&&o(null)},[JSON.stringify(a)]),(0,Je.useEffect)(()=>{d||"number"!=typeof s||null!==g.current||(g.current=setTimeout(()=>{p(),g.current=null},s))},[s,d,p,...r]),{droppableRects:v,measureDroppableContainers:p,measuringScheduled:null!=a}}(A,{dragging:k,dependencies:[S.x,S.y],config:R.droppable}),W=function(e,n){const t=null!=n?e.get(n):void 0,r=t?t.node.current:null;return lg(e=>{var t;return null==n?null:null!=(t=null!=r?r:e)?t:null},[r,n])}(j,w),H=(0,Je.useMemo)(()=>T?fg(T):null,[T]),V=function(){const e=!1===(null==M?void 0:M.autoScrollEnabled),n="object"==typeof s?!1===s.enabled:!1===s,t=k&&!e&&!n;if("object"==typeof s)return{...s,enabled:t};return{enabled:t}}(),q=function(e,n){return Dv(e,n)}(W,R.draggable.measure);!function(e){let{activeNode:n,measure:t,initialRect:r,config:i=!0}=e;const a=(0,Je.useRef)(!1),{x:o,y:s}="boolean"==typeof i?{x:i,y:i}:i;ag(()=>{if(!o&&!s||!n)return void(a.current=!1);if(a.current||!r)return;const e=null==n?void 0:n.node.current;if(!e||!1===e.isConnected)return;const i=Wg(t(e),r);if(o||(i.x=0),s||(i.y=0),a.current=!0,Math.abs(i.x)>0||Math.abs(i.y)>0){const n=Gg(e);n&&n.scrollBy({top:i.y,left:i.x})}},[n,o,s,r,t])}({activeNode:null!=w?j.get(w):null,config:V.layoutShiftCompensation,initialRect:q,measure:R.draggable.measure});const $=Bv(W,R.draggable.measure,q),Y=Bv(W?W.parentElement:null),K=(0,Je.useRef)({activatorEvent:null,active:null,activeNode:W,collisionRect:null,collisions:null,droppableRects:_,draggableNodes:j,draggingNode:null,draggingNodeRect:null,droppableContainers:C,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),Q=C.getNodeFor(null==(n=K.current.over)?void 0:n.id),G=function(e){let{measure:n}=e;const[t,r]=(0,Je.useState)(null),i=Av({callback:(0,Je.useCallback)(e=>{for(const{target:t}of e)if(tg(t)){r(e=>{const r=n(t);return e?{...e,width:r.width,height:r.height}:r});break}},[n])}),a=(0,Je.useCallback)(e=>{const t=Hv(e);null==i||i.disconnect(),t&&(null==i||i.observe(t)),r(t?n(t):null)},[n,i]),[o,s]=cg(a);return(0,Je.useMemo)(()=>({nodeRef:o,rect:t,setRef:s}),[t,o,s])}({measure:R.dragOverlay.measure}),X=null!=(t=G.nodeRef.current)?t:W,Z=k?null!=(r=G.rect)?r:$:null,J=Boolean(G.nodeRef.current&&G.rect),ee=Wg(ne=J?null:$,Dv(ne));var ne;const te=Fv(X?eg(X):null),re=function(e){const n=(0,Je.useRef)(e),t=lg(t=>e?t&&t!==_v&&e&&n.current&&e.parentNode===n.current.parentNode?t:Qg(e):_v,[e]);return(0,Je.useEffect)(()=>{n.current=e},[e]),t}(k?null!=Q?Q:W:null),ie=function(e,n){void 0===n&&(n=Yg);const[t]=e,r=Fv(t?eg(t):null),[i,a]=(0,Je.useState)(Wv);function o(){a(()=>e.length?e.map(e=>tv(e)?r:new uv(n(e),e)):Wv)}const s=Av({callback:o});return ag(()=>{null==s||s.disconnect(),o(),e.forEach(e=>null==s?void 0:s.observe(e))},[e]),i}(re),ae=nh(m,{transform:{x:S.x-ee.x,y:S.y-ee.y,scaleX:1,scaleY:1},activatorEvent:T,active:E,activeNodeRect:$,containerNodeRect:Y,draggingNodeRect:Z,over:K.current.over,overlayNodeRect:G.rect,scrollableAncestors:re,scrollableAncestorRects:ie,windowRect:te}),oe=H?gg(H,S):null,se=function(e){const[n,t]=(0,Je.useState)(null),r=(0,Je.useRef)(e),i=(0,Je.useCallback)(e=>{const n=Xg(e.target);n&&t(e=>e?(e.set(n,ev(n)),new Map(e)):null)},[]);return(0,Je.useEffect)(()=>{const n=r.current;if(e!==n){a(n);const o=e.map(e=>{const n=Xg(e);return n?(n.addEventListener("scroll",i,{passive:!0}),[n,ev(n)]):null}).filter(e=>null!=e);t(o.length?new Map(o):null),r.current=e}return()=>{a(e),a(n)};function a(e){e.forEach(e=>{const n=Xg(e);null==n||n.removeEventListener("scroll",i)})}},[i,e]),(0,Je.useMemo)(()=>e.length?n?Array.from(n.values()).reduce((e,n)=>gg(e,n),zg):sv(e):zg,[e,n])}(re),le=Uv(se),ce=Uv(se,[$]),ue=gg(ae,le),de=Z?Vg(Z,ae):null,me=E&&de?u({active:E,collisionRect:de,droppableRects:_,droppableContainers:A,pointerCoordinates:oe}):null,pe=Rg(me,"id"),[ge,ve]=(0,Je.useState)(null),he=function(e,n,t){return{...e,scaleX:n&&t?n.width/t.width:1,scaleY:n&&t?n.height/t.height:1}}(J?ae:gg(ae,ce),null!=(i=null==ge?void 0:ge.rect)?i:null,$),fe=(0,Je.useRef)(null),be=(0,Je.useCallback)((e,n)=>{let{sensor:t,options:r}=n;if(null==O.current)return;const i=j.get(O.current);if(!i)return;const a=e.nativeEvent,o=new t({active:O.current,activeNode:i,event:a,options:r,context:K,onAbort(e){if(!j.get(e))return;const{onDragAbort:n}=L.current,t={id:e};null==n||n(t),f({type:"onDragAbort",event:t})},onPending(e,n,t,r){if(!j.get(e))return;const{onDragPending:i}=L.current,a={id:e,constraint:n,initialCoordinates:t,offset:r};null==i||i(a),f({type:"onDragPending",event:a})},onStart(e){const n=O.current;if(null==n)return;const t=j.get(n);if(!t)return;const{onDragStart:r}=L.current,i={activatorEvent:a,active:{id:n,data:t.data,rect:P}};(0,Dt.unstable_batchedUpdates)(()=>{null==r||r(i),y(rh.Initializing),h({type:Eg.DragStart,initialCoordinates:e,active:n}),f({type:"onDragStart",event:i}),z(fe.current),I(a)})},onMove(e){h({type:Eg.DragMove,coordinates:e})},onEnd:s(Eg.DragEnd),onCancel:s(Eg.DragCancel)});function s(e){return async function(){const{active:n,collisions:t,over:r,scrollAdjustedTranslate:i}=K.current;let o=null;if(n&&i){const{cancelDrop:s}=L.current;if(o={activatorEvent:a,active:n,collisions:t,delta:i,over:r},e===Eg.DragEnd&&"function"==typeof s){await Promise.resolve(s(o))&&(e=Eg.DragCancel)}}O.current=null,(0,Dt.unstable_batchedUpdates)(()=>{h({type:e}),y(rh.Uninitialized),ve(null),z(null),I(null),fe.current=null;const n=e===Eg.DragEnd?"onDragEnd":"onDragCancel";if(o){const e=L.current[n];null==e||e(o),f({type:n,event:o})}})}}fe.current=o},[j]),xe=(0,Je.useCallback)((e,n)=>(t,r)=>{const i=t.nativeEvent,a=j.get(r);if(null!==O.current||!a||i.dndKit||i.defaultPrevented)return;const o={active:a};!0===e(t,n.options,o)&&(i.dndKit={capturedBy:n.sensor},O.current=r,be(t,n))},[j,be]),ye=function(e,n){return(0,Je.useMemo)(()=>e.reduce((e,t)=>{const{sensor:r}=t;return[...e,...r.activators.map(e=>({eventName:e.eventName,handler:n(e.handler,t)}))]},[]),[e,n])}(c,xe);!function(e){(0,Je.useEffect)(()=>{if(!Xp)return;const n=e.map(e=>{let{sensor:n}=e;return null==n.setup?void 0:n.setup()});return()=>{for(const e of n)null==e||e()}},e.map(e=>{let{sensor:n}=e;return n}))}(c),ag(()=>{$&&x===rh.Initializing&&y(rh.Initialized)},[$,x]),(0,Je.useEffect)(()=>{const{onDragMove:e}=L.current,{active:n,activatorEvent:t,collisions:r,over:i}=K.current;if(!n||!t)return;const a={active:n,activatorEvent:t,collisions:r,delta:{x:ue.x,y:ue.y},over:i};(0,Dt.unstable_batchedUpdates)(()=>{null==e||e(a),f({type:"onDragMove",event:a})})},[ue.x,ue.y]),(0,Je.useEffect)(()=>{const{active:e,activatorEvent:n,collisions:t,droppableContainers:r,scrollAdjustedTranslate:i}=K.current;if(!e||null==O.current||!n||!i)return;const{onDragOver:a}=L.current,o=r.get(pe),s=o&&o.rect.current?{id:o.id,rect:o.rect.current,data:o.data,disabled:o.disabled}:null,l={active:e,activatorEvent:n,collisions:t,delta:{x:i.x,y:i.y},over:s};(0,Dt.unstable_batchedUpdates)(()=>{ve(s),null==a||a(l),f({type:"onDragOver",event:l})})},[pe]),ag(()=>{K.current={activatorEvent:T,active:E,activeNode:W,collisionRect:de,collisions:me,droppableRects:_,draggableNodes:j,draggingNode:X,draggingNodeRect:Z,droppableContainers:C,over:ge,scrollableAncestors:re,scrollAdjustedTranslate:ue},P.current={initial:Z,translated:de}},[E,W,me,de,j,X,Z,_,C,ge,re,ue]),Mv({...V,delta:S,draggingRect:de,pointerCoordinates:oe,scrollableAncestors:re,scrollableAncestorRects:ie});const ke=(0,Je.useMemo)(()=>({active:E,activeNode:W,activeNodeRect:$,activatorEvent:T,collisions:me,containerNodeRect:Y,dragOverlay:G,draggableNodes:j,droppableContainers:C,droppableRects:_,over:ge,measureDroppableContainers:U,scrollableAncestors:re,scrollableAncestorRects:ie,measuringConfiguration:R,measuringScheduled:F,windowRect:te}),[E,W,$,T,me,Y,G,j,C,_,ge,U,re,ie,R,F,te]),we=(0,Je.useMemo)(()=>({activatorEvent:T,activators:ye,active:E,activeNodeRect:$,ariaDescribedById:{draggable:D},dispatch:h,draggableNodes:j,over:ge,measureDroppableContainers:U}),[T,ye,E,$,h,D,j,ge,U]);return Je.createElement(Sg.Provider,{value:b},Je.createElement(Gv.Provider,{value:we},Je.createElement(Xv.Provider,{value:ke},Je.createElement(th.Provider,{value:he},l)),Je.createElement(eh,{disabled:!1===(null==o?void 0:o.restoreFocus)})),Je.createElement(Pg,{...o,hiddenTextDescribedById:D}))}),ah=(0,Je.createContext)(null),oh="button";function sh(e){let{id:n,data:t,disabled:r=!1,attributes:i}=e;const a=mg("Draggable"),{activators:o,activatorEvent:s,active:l,activeNodeRect:c,ariaDescribedById:u,draggableNodes:d,over:m}=(0,Je.useContext)(Gv),{role:p=oh,roleDescription:g="draggable",tabIndex:v=0}=null!=i?i:{},h=(null==l?void 0:l.id)===n,f=(0,Je.useContext)(h?th:ah),[b,x]=cg(),[y,k]=cg(),w=function(e,n){return(0,Je.useMemo)(()=>e.reduce((e,t)=>{let{eventName:r,handler:i}=t;return e[r]=e=>{i(e,n)},e},{}),[e,n])}(o,n),j=sg(t);ag(()=>(d.set(n,{id:n,key:a,node:b,activatorNode:y,data:j}),()=>{const e=d.get(n);e&&e.key===a&&d.delete(n)}),[d,n]);return{active:l,activatorEvent:s,activeNodeRect:c,attributes:(0,Je.useMemo)(()=>({role:p,tabIndex:v,"aria-disabled":r,"aria-pressed":!(!h||p!==oh)||void 0,"aria-roledescription":g,"aria-describedby":u.draggable}),[r,p,v,h,g,u.draggable]),isDragging:h,listeners:r?void 0:w,node:b,over:m,setNodeRef:x,setActivatorNodeRef:k,transform:f}}function lh(){return(0,Je.useContext)(Xv)}const ch={timeout:25};function uh(e){let{animation:n,children:t}=e;const[r,i]=(0,Je.useState)(null),[a,o]=(0,Je.useState)(null),s=ug(t);return t||r||!s||i(s),ag(()=>{if(!a)return;const e=null==r?void 0:r.key,t=null==r?void 0:r.props.id;null!=e&&null!=t?Promise.resolve(n(t,a)).then(()=>{i(null)}):i(null)},[n,r,a]),Je.createElement(Je.Fragment,null,t,r?(0,Je.cloneElement)(r,{ref:o}):null)}const dh={x:0,y:0,scaleX:1,scaleY:1};function mh(e){let{children:n}=e;return Je.createElement(Gv.Provider,{value:Qv},Je.createElement(th.Provider,{value:dh},n))}const ph={position:"fixed",touchAction:"none"},gh=e=>hg(e)?"transform 250ms ease":void 0,vh=(0,Je.forwardRef)((e,n)=>{let{as:t,activatorEvent:r,adjustScale:i,children:a,className:o,rect:s,style:l,transform:c,transition:u=gh}=e;if(!s)return null;const d=i?c:{...c,scaleX:1,scaleY:1},m={...ph,width:s.width,height:s.height,top:s.top,left:s.left,transform:bg.Transform.toString(d),transformOrigin:i&&r?Ig(r,s):void 0,transition:"function"==typeof u?u(r):u,...l};return Je.createElement(t,{className:o,style:m,ref:n},a)}),hh=e=>n=>{let{active:t,dragOverlay:r}=n;const i={},{styles:a,className:o}=e;if(null!=a&&a.active)for(const[e,n]of Object.entries(a.active))void 0!==n&&(i[e]=t.node.style.getPropertyValue(e),t.node.style.setProperty(e,n));if(null!=a&&a.dragOverlay)for(const[e,n]of Object.entries(a.dragOverlay))void 0!==n&&r.node.style.setProperty(e,n);return null!=o&&o.active&&t.node.classList.add(o.active),null!=o&&o.dragOverlay&&r.node.classList.add(o.dragOverlay),function(){for(const[e,n]of Object.entries(i))t.node.style.setProperty(e,n);null!=o&&o.active&&t.node.classList.remove(o.active)}},fh={duration:250,easing:"ease",keyframes:e=>{let{transform:{initial:n,final:t}}=e;return[{transform:bg.Transform.toString(n)},{transform:bg.Transform.toString(t)}]},sideEffects:hh({styles:{active:{opacity:"0"}}})};function bh(e){let{config:n,draggableNodes:t,droppableContainers:r,measuringConfiguration:i}=e;return og((e,a)=>{if(null===n)return;const o=t.get(e);if(!o)return;const s=o.node.current;if(!s)return;const l=Hv(a);if(!l)return;const{transform:c}=eg(a).getComputedStyle(a),u=qg(c);if(!u)return;const d="function"==typeof n?n:function(e){const{duration:n,easing:t,sideEffects:r,keyframes:i}={...fh,...e};return e=>{let{active:a,dragOverlay:o,transform:s,...l}=e;if(!n)return;const c={x:o.rect.left-a.rect.left,y:o.rect.top-a.rect.top},u={scaleX:1!==s.scaleX?a.rect.width*s.scaleX/o.rect.width:1,scaleY:1!==s.scaleY?a.rect.height*s.scaleY/o.rect.height:1},d={x:s.x-c.x,y:s.y-c.y,...u},m=i({...l,active:a,dragOverlay:o,transform:{initial:s,final:d}}),[p]=m,g=m[m.length-1];if(JSON.stringify(p)===JSON.stringify(g))return;const v=null==r?void 0:r({active:a,dragOverlay:o,...l}),h=o.node.animate(m,{duration:n,easing:t,fill:"forwards"});return new Promise(e=>{h.onfinish=()=>{null==v||v(),e()}})}}(n);return lv(s,i.draggable.measure),d({active:{id:e,data:o.data,node:s,rect:i.draggable.measure(s)},draggableNodes:t,dragOverlay:{node:a,rect:i.dragOverlay.measure(l)},droppableContainers:r,measuringConfiguration:i,transform:u})})}let xh=0;function yh(e){return(0,Je.useMemo)(()=>{if(null!=e)return xh++,xh},[e])}const kh=Je.memo(e=>{let{adjustScale:n=!1,children:t,dropAnimation:r,style:i,transition:a,modifiers:o,wrapperElement:s="div",className:l,zIndex:c=999}=e;const{activatorEvent:u,active:d,activeNodeRect:m,containerNodeRect:p,draggableNodes:g,droppableContainers:v,dragOverlay:h,over:f,measuringConfiguration:b,scrollableAncestors:x,scrollableAncestorRects:y,windowRect:k}=lh(),w=(0,Je.useContext)(th),j=yh(null==d?void 0:d.id),S=nh(o,{activatorEvent:u,active:d,activeNodeRect:m,containerNodeRect:p,draggingNodeRect:h.rect,over:f,overlayNodeRect:h.rect,scrollableAncestors:x,scrollableAncestorRects:y,transform:w,windowRect:k}),C=Dv(m),N=bh({config:r,draggableNodes:g,droppableContainers:v,measuringConfiguration:b}),P=C?h.setRef:void 0;return Je.createElement(mh,null,Je.createElement(uh,{animation:N},d&&j?Je.createElement(vh,{key:j,id:d.id,ref:P,as:s,activatorEvent:u,adjustScale:n,className:l,transition:a,rect:C,style:{zIndex:c,...i},transform:S},t):null))});function wh(e,n,t){const r=e.slice();return r.splice(t<0?r.length+t:t,0,r.splice(n,1)[0]),r}function jh(e,n){return e.reduce((e,t,r)=>{const i=n.get(t);return i&&(e[r]=i),e},Array(e.length))}function Sh(e){return null!==e&&e>=0}const Ch=e=>{let{rects:n,activeIndex:t,overIndex:r,index:i}=e;const a=wh(n,r,t),o=n[i],s=a[i];return s&&o?{x:s.left-o.left,y:s.top-o.top,scaleX:s.width/o.width,scaleY:s.height/o.height}:null},Nh={scaleX:1,scaleY:1},Ph=e=>{var n;let{activeIndex:t,activeNodeRect:r,index:i,rects:a,overIndex:o}=e;const s=null!=(n=a[t])?n:r;if(!s)return null;if(i===t){const e=a[o];return e?{x:0,y:t<o?e.top+e.height-(s.top+s.height):e.top-s.top,...Nh}:null}const l=function(e,n,t){const r=e[n],i=e[n-1],a=e[n+1];if(!r)return 0;if(t<n)return i?r.top-(i.top+i.height):a?a.top-(r.top+r.height):0;return a?a.top-(r.top+r.height):i?r.top-(i.top+i.height):0}(a,i,t);return i>t&&i<=o?{x:0,y:-s.height-l,...Nh}:i<t&&i>=o?{x:0,y:s.height+l,...Nh}:{x:0,y:0,...Nh}};const Eh="Sortable",Oh=Je.createContext({activeIndex:-1,containerId:Eh,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:Ch,disabled:{draggable:!1,droppable:!1}});function Mh(e){let{children:n,id:t,items:r,strategy:i=Ch,disabled:a=!1}=e;const{active:o,dragOverlay:s,droppableRects:l,over:c,measureDroppableContainers:u}=lh(),d=mg(Eh,t),m=Boolean(null!==s.rect),p=(0,Je.useMemo)(()=>r.map(e=>"object"==typeof e&&"id"in e?e.id:e),[r]),g=null!=o,v=o?p.indexOf(o.id):-1,h=c?p.indexOf(c.id):-1,f=(0,Je.useRef)(p),b=!function(e,n){if(e===n)return!0;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t]!==n[t])return!1;return!0}(p,f.current),x=-1!==h&&-1===v||b,y=function(e){return"boolean"==typeof e?{draggable:e,droppable:e}:e}(a);ag(()=>{b&&g&&u(p)},[b,p,g,u]),(0,Je.useEffect)(()=>{f.current=p},[p]);const k=(0,Je.useMemo)(()=>({activeIndex:v,containerId:d,disabled:y,disableTransforms:x,items:p,overIndex:h,useDragOverlay:m,sortedRects:jh(p,l),strategy:i}),[v,d,y.draggable,y.droppable,x,p,h,l,m,i]);return Je.createElement(Oh.Provider,{value:k},n)}const zh=e=>{let{id:n,items:t,activeIndex:r,overIndex:i}=e;return wh(t,r,i).indexOf(n)},Th=e=>{let{containerId:n,isSorting:t,wasDragging:r,index:i,items:a,newIndex:o,previousItems:s,previousContainerId:l,transition:c}=e;return!(!c||!r)&&((s===a||i!==o)&&(!!t||o!==i&&n===l))},Ih={duration:200,easing:"ease"},Lh="transform",Dh=bg.Transition.toString({property:Lh,duration:0,easing:"linear"}),Ah={roleDescription:"sortable"};function Rh(e){let{animateLayoutChanges:n=Th,attributes:t,disabled:r,data:i,getNewIndex:a=zh,id:o,strategy:s,resizeObserverConfig:l,transition:c=Ih}=e;const{items:u,containerId:d,activeIndex:m,disabled:p,disableTransforms:g,sortedRects:v,overIndex:h,useDragOverlay:f,strategy:b}=(0,Je.useContext)(Oh),x=function(e,n){var t,r;if("boolean"==typeof e)return{draggable:e,droppable:!1};return{draggable:null!=(t=null==e?void 0:e.draggable)?t:n.draggable,droppable:null!=(r=null==e?void 0:e.droppable)?r:n.droppable}}(r,p),y=u.indexOf(o),k=(0,Je.useMemo)(()=>({sortable:{containerId:d,index:y,items:u},...i}),[d,i,y,u]),w=(0,Je.useMemo)(()=>u.slice(u.indexOf(o)),[u,o]),{rect:j,node:S,isOver:C,setNodeRef:N}=function(e){let{data:n,disabled:t=!1,id:r,resizeObserverConfig:i}=e;const a=mg("Droppable"),{active:o,dispatch:s,over:l,measureDroppableContainers:c}=(0,Je.useContext)(Gv),u=(0,Je.useRef)({disabled:t}),d=(0,Je.useRef)(!1),m=(0,Je.useRef)(null),p=(0,Je.useRef)(null),{disabled:g,updateMeasurementsFor:v,timeout:h}={...ch,...i},f=sg(null!=v?v:r),b=Av({callback:(0,Je.useCallback)(()=>{d.current?(null!=p.current&&clearTimeout(p.current),p.current=setTimeout(()=>{c(Array.isArray(f.current)?f.current:[f.current]),p.current=null},h)):d.current=!0},[h]),disabled:g||!o}),x=(0,Je.useCallback)((e,n)=>{b&&(n&&(b.unobserve(n),d.current=!1),e&&b.observe(e))},[b]),[y,k]=cg(x),w=sg(n);return(0,Je.useEffect)(()=>{b&&y.current&&(b.disconnect(),d.current=!1,b.observe(y.current))},[y,b]),(0,Je.useEffect)(()=>(s({type:Eg.RegisterDroppable,element:{id:r,key:a,disabled:t,node:y,rect:m,data:w}}),()=>s({type:Eg.UnregisterDroppable,key:a,id:r})),[r]),(0,Je.useEffect)(()=>{t!==u.current.disabled&&(s({type:Eg.SetDroppableDisabled,id:r,key:a,disabled:t}),u.current.disabled=t)},[r,a,t,s]),{active:o,rect:m,isOver:(null==l?void 0:l.id)===r,node:y,over:l,setNodeRef:k}}({id:o,data:k,disabled:x.droppable,resizeObserverConfig:{updateMeasurementsFor:w,...l}}),{active:P,activatorEvent:E,activeNodeRect:O,attributes:M,setNodeRef:z,listeners:T,isDragging:I,over:L,setActivatorNodeRef:D,transform:A}=sh({id:o,data:k,attributes:{...Ah,...t},disabled:x.draggable}),R=function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return(0,Je.useMemo)(()=>e=>{n.forEach(n=>n(e))},n)}(N,z),B=Boolean(P),_=B&&!g&&Sh(m)&&Sh(h),U=!f&&I,F=U&&_?A:null,W=_?null!=F?F:(null!=s?s:b)({rects:v,activeNodeRect:O,activeIndex:m,overIndex:h,index:y}):null,H=Sh(m)&&Sh(h)?a({id:o,items:u,activeIndex:m,overIndex:h}):y,V=null==P?void 0:P.id,q=(0,Je.useRef)({activeId:V,items:u,newIndex:H,containerId:d}),$=u!==q.current.items,Y=n({active:P,containerId:d,isDragging:I,isSorting:B,id:o,index:y,items:u,newIndex:q.current.newIndex,previousItems:q.current.items,previousContainerId:q.current.containerId,transition:c,wasDragging:null!=q.current.activeId}),K=function(e){let{disabled:n,index:t,node:r,rect:i}=e;const[a,o]=(0,Je.useState)(null),s=(0,Je.useRef)(t);return ag(()=>{if(!n&&t!==s.current&&r.current){const e=i.current;if(e){const n=Yg(r.current,{ignoreTransform:!0}),t={x:e.left-n.left,y:e.top-n.top,scaleX:e.width/n.width,scaleY:e.height/n.height};(t.x||t.y)&&o(t)}}t!==s.current&&(s.current=t)},[n,t,r,i]),(0,Je.useEffect)(()=>{a&&o(null)},[a]),a}({disabled:!Y,index:y,node:S,rect:j});return(0,Je.useEffect)(()=>{B&&q.current.newIndex!==H&&(q.current.newIndex=H),d!==q.current.containerId&&(q.current.containerId=d),u!==q.current.items&&(q.current.items=u)},[B,H,d,u]),(0,Je.useEffect)(()=>{if(V===q.current.activeId)return;if(null!=V&&null==q.current.activeId)return void(q.current.activeId=V);const e=setTimeout(()=>{q.current.activeId=V},50);return()=>clearTimeout(e)},[V]),{active:P,activeIndex:m,attributes:M,data:k,rect:j,index:y,newIndex:H,items:u,isOver:C,isSorting:B,isDragging:I,listeners:T,node:S,overIndex:h,over:L,setNodeRef:R,setActivatorNodeRef:D,setDroppableNodeRef:N,setDraggableNodeRef:z,transform:null!=K?K:W,transition:function(){if(K||$&&q.current.newIndex===y)return Dh;if(U&&!hg(E)||!c)return;if(B||Y)return bg.Transition.toString({...c,property:Lh});return}()}}function Bh(e){if(!e)return!1;const n=e.data.current;return!!(n&&"sortable"in n&&"object"==typeof n.sortable&&"containerId"in n.sortable&&"items"in n.sortable&&"index"in n.sortable)}const _h=[gv.Down,gv.Right,gv.Up,gv.Left],Uh=(e,n)=>{let{context:{active:t,collisionRect:r,droppableRects:i,droppableContainers:a,over:o,scrollableAncestors:s}}=n;if(_h.includes(e.code)){if(e.preventDefault(),!t||!r)return;const n=[];a.getEnabled().forEach(t=>{if(!t||null!=t&&t.disabled)return;const a=i.get(t.id);if(a)switch(e.code){case gv.Down:r.top<a.top&&n.push(t);break;case gv.Up:r.top>a.top&&n.push(t);break;case gv.Left:r.left>a.left&&n.push(t);break;case gv.Right:r.left<a.left&&n.push(t)}});const l=(e=>{let{collisionRect:n,droppableRects:t,droppableContainers:r}=e;const i=Ag(n),a=[];for(const e of r){const{id:n}=e,r=t.get(n);if(r){const t=Ag(r),o=i.reduce((e,n,r)=>e+Tg(t[r],n),0),s=Number((o/4).toFixed(4));a.push({id:n,data:{droppableContainer:e,value:s}})}}return a.sort(Lg)})({active:t,collisionRect:r,droppableRects:i,droppableContainers:n,pointerCoordinates:null});let c=Rg(l,"id");if(c===(null==o?void 0:o.id)&&l.length>1&&(c=l[1].id),null!=c){const e=a.get(t.id),n=a.get(c),o=n?i.get(n.id):null,l=null==n?void 0:n.node.current;if(l&&o&&e&&n){const t=Qg(l).some((e,n)=>s[n]!==e),i=Fh(e,n),a=function(e,n){if(!Bh(e)||!Bh(n))return!1;if(!Fh(e,n))return!1;return e.data.current.sortable.index<n.data.current.sortable.index}(e,n),c=t||!i?{x:0,y:0}:{x:a?r.width-o.width:0,y:a?r.height-o.height:0},u={x:o.left,y:o.top};return c.x&&c.y?u:vg(u,c)}}}};function Fh(e,n){return!(!Bh(e)||!Bh(n))&&e.data.current.sortable.containerId===n.data.current.sortable.containerId}const Wh=Jn("grip-vertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]),Hh=Jn("eye-off",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),Vh=Jn("bookmark-check",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2Z",key:"169p4p"}],["path",{d:"m9 10 2 2 4-4",key:"1gnqz4"}]]),qh=Jn("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);function $h(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function Yh(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?$h(Object(t),!0).forEach(function(n){Kh(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):$h(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Kh(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function Qh(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function Gh(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Qh(Object(t),!0).forEach(function(n){Xh(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Qh(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Xh(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const Zh="━";function Jh(e){let{prompt:n,index:t,onEdit:r,onDelete:i,onToggleEnabled:a,onToggleCollapse:o,isCollapsed:s}=e;const{attributes:l,listeners:c,setNodeRef:u,transform:d,transition:m,isDragging:p}=Rh({id:n.identifier||n._uiId}),g={transform:bg.Transform.toString(d),transition:m,opacity:p?.5:1},v=n.name.startsWith(Zh),h=v?n.name.substring(1).trim():n.name;return(0,nn.jsxs)("div",{ref:u,style:g,className:at("lumiverse-prompt-item",v&&"lumiverse-prompt-category",!n.enabled&&"lumiverse-prompt-disabled"),children:[(0,nn.jsx)("div",Gh(Gh(Gh({className:"lumiverse-prompt-drag-handle"},l),c),{},{children:(0,nn.jsx)(Wh,{size:16})})),(0,nn.jsxs)("div",{className:"lumiverse-prompt-content",children:[(0,nn.jsxs)("div",{className:"lumiverse-prompt-header",children:[v&&(0,nn.jsx)("button",{className:"lumiverse-icon-btn",onClick:()=>o(n.identifier||n._uiId),style:{marginRight:4},children:s?(0,nn.jsx)(st,{size:18}):(0,nn.jsx)(ot,{size:18})}),(0,nn.jsx)("span",{className:"lumiverse-prompt-name",children:h}),(0,nn.jsx)("div",{className:"lumiverse-prompt-badges",children:(0,nn.jsx)("span",{className:at("lumiverse-badge","lumiverse-badge-".concat(n.role)),children:n.role})})]}),!v&&(0,nn.jsxs)("div",{className:"lumiverse-prompt-preview",children:[n.content.substring(0,60),n.content.length>60&&"..."]})]}),(0,nn.jsxs)("div",{className:"lumiverse-prompt-actions",children:[(0,nn.jsx)("button",{className:"lumiverse-icon-btn",onClick:()=>a(t),title:n.enabled?"Disable":"Enable",children:n.enabled?(0,nn.jsx)(im,{size:18}):(0,nn.jsx)(Hh,{size:18})}),(0,nn.jsx)("button",{className:"lumiverse-icon-btn",onClick:()=>r(t),title:"Edit",children:(0,nn.jsx)(nt,{size:18})}),(0,nn.jsx)("button",{className:"lumiverse-icon-btn lumiverse-btn-danger",onClick:()=>i(t),title:"Delete",children:(0,nn.jsx)(tt,{size:18})})]})]})}const ef=Jn("file-text",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]),nf=Jn("message-circle",[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]]),tf=Jn("layout-grid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);function rf(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function af(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?rf(Object(t),!0).forEach(function(n){of(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):rf(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function of(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const sf=[{value:"social",label:"Social Card",description:"Full card with avatar & animations",Icon:lt},{value:"margin",label:"Margin Note",description:"Minimal hanging tag style",Icon:ef},{value:"whisper",label:"Whisper Bubble",description:"Soft ethereal thought bubble",Icon:nf}],lf={layout:{display:"flex",flexDirection:"column",height:"100%",maxHeight:"100%",minHeight:0},header:{display:"flex",alignItems:"center",gap:"12px",padding:"16px 20px",borderBottom:"1px solid var(--lumiverse-border)",flexShrink:0},headerIcon:{display:"flex",alignItems:"center",justifyContent:"center",width:"40px",height:"40px",borderRadius:"10px",background:"linear-gradient(135deg, rgba(147, 112, 219, 0.2), rgba(147, 112, 219, 0.1))",color:"var(--lumiverse-primary)"},headerText:{flex:1},title:{margin:0,fontSize:"16px",fontWeight:600,color:"var(--lumiverse-text)"},subtitle:{margin:"4px 0 0",fontSize:"12px",color:"var(--lumiverse-text-muted)"},scrollArea:{flex:"1 1 auto",minHeight:0,overflowY:"auto",padding:"16px 20px"},section:{marginBottom:"20px"},sectionHeader:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"12px",color:"var(--lumiverse-text)",fontWeight:500,fontSize:"14px"},sectionIcon:{color:"var(--lumiverse-primary)"},description:{fontSize:"12px",color:"var(--lumiverse-text-muted)",marginBottom:"12px"},field:{marginBottom:"12px"},label:{display:"block",fontSize:"12px",fontWeight:500,color:"var(--lumiverse-text)",marginBottom:"6px"},input:{width:"100%",padding:"10px 12px",fontSize:"13px",background:"var(--lumiverse-input-bg)",border:"1px solid var(--lumiverse-border)",borderRadius:"8px",color:"var(--lumiverse-text)",outline:"none",transition:"border-color 0.2s ease"},hint:{fontSize:"11px",color:"var(--lumiverse-text-muted)",marginTop:"4px"},styleGrid:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"10px"},styleOption:{display:"flex",flexDirection:"column",alignItems:"center",gap:"8px",padding:"14px 8px",background:"rgba(0, 0, 0, 0.2)",border:"1px solid var(--lumiverse-border)",borderRadius:"10px",cursor:"pointer",transition:"all 0.2s ease"},styleOptionSelected:{background:"rgba(147, 112, 219, 0.15)",borderColor:"var(--lumiverse-primary)"},styleOptionIcon:{color:"var(--lumiverse-text-muted)",transition:"color 0.2s ease"},styleOptionIconSelected:{color:"var(--lumiverse-primary)"},styleOptionLabel:{fontSize:"12px",fontWeight:500,color:"var(--lumiverse-text)",textAlign:"center"},styleOptionDesc:{fontSize:"10px",color:"var(--lumiverse-text-muted)",textAlign:"center",lineHeight:1.3},footer:{display:"flex",justifyContent:"flex-end",gap:"8px",padding:"12px 20px",borderTop:"1px solid var(--lumiverse-border)",flexShrink:0},button:{padding:"10px 16px",fontSize:"13px",fontWeight:500,borderRadius:"8px",border:"none",cursor:"pointer",transition:"all 0.2s ease"},buttonSecondary:{background:"var(--lumiverse-surface)",color:"var(--lumiverse-text)",border:"1px solid var(--lumiverse-border)"},buttonPrimary:{background:"var(--lumiverse-primary)",color:"white"}};const cf=function(e){let{onClose:n}=e;const t=wn,r=Nn(),i=t.getState().lumiaOOCInterval||"",a=t.getState().lumiaOOCStyle||"social",[o,s]=(0,Je.useState)(i.toString()),[l,c]=(0,Je.useState)(a),u=(0,Je.useCallback)(()=>{const e=o.trim()?parseInt(o,10):null;if(r.setSettings({lumiaOOCInterval:e,lumiaOOCStyle:l}),kn(),window.toastr&&window.toastr.success("OOC settings saved!"),l!==a){var t,i;const e=null===(t=window.LumiverseBridge)||void 0===t||null===(i=t.getCallbacks)||void 0===i?void 0:i.call(t);null!=e&&e.refreshOOCComments&&setTimeout(()=>e.refreshOOCComments(!0),100)}n()},[o,l,a,r,n]);return(0,nn.jsxs)("div",{style:lf.layout,children:[(0,nn.jsxs)("div",{style:lf.header,children:[(0,nn.jsx)("div",{style:lf.headerIcon,children:(0,nn.jsx)(_r,{size:20,strokeWidth:1.5})}),(0,nn.jsxs)("div",{style:lf.headerText,children:[(0,nn.jsx)("h3",{style:lf.title,children:"OOC Settings"}),(0,nn.jsx)("p",{style:lf.subtitle,children:"Configure out-of-character comments"})]})]}),(0,nn.jsxs)("div",{style:lf.scrollArea,children:[(0,nn.jsxs)("div",{style:lf.section,children:[(0,nn.jsxs)("div",{style:lf.sectionHeader,children:[(0,nn.jsx)($t,{size:16,style:lf.sectionIcon}),(0,nn.jsx)("span",{children:"Comment Trigger"})]}),(0,nn.jsx)("p",{style:lf.description,children:"Automatically inject OOC instructions at message intervals."}),(0,nn.jsxs)("div",{style:lf.field,children:[(0,nn.jsx)("label",{style:lf.label,children:"Message Interval"}),(0,nn.jsx)("input",{type:"number",style:lf.input,placeholder:"e.g., 10 (empty = disabled)",min:"1",value:o,onChange:e=>s(e.target.value)}),(0,nn.jsx)("div",{style:lf.hint,children:"Triggers when message count is divisible by this number"})]})]}),(0,nn.jsxs)("div",{style:lf.section,children:[(0,nn.jsxs)("div",{style:lf.sectionHeader,children:[(0,nn.jsx)(tf,{size:16,style:lf.sectionIcon}),(0,nn.jsx)("span",{children:"Display Style"})]}),(0,nn.jsx)("p",{style:lf.description,children:"Choose how OOC comments appear in chat."}),(0,nn.jsx)("div",{style:lf.styleGrid,children:sf.map(e=>{const n=l===e.value;return(0,nn.jsxs)("button",{type:"button",style:af(af({},lf.styleOption),n?lf.styleOptionSelected:{}),onClick:()=>c(e.value),children:[(0,nn.jsx)(e.Icon,{size:20,strokeWidth:1.5,style:af(af({},lf.styleOptionIcon),n?lf.styleOptionIconSelected:{})}),(0,nn.jsx)("span",{style:lf.styleOptionLabel,children:e.label}),(0,nn.jsx)("span",{style:lf.styleOptionDesc,children:e.description})]},e.value)})})]})]}),(0,nn.jsxs)("div",{style:lf.footer,children:[(0,nn.jsx)("button",{type:"button",style:af(af({},lf.button),lf.buttonSecondary),onClick:n,children:"Cancel"}),(0,nn.jsx)("button",{type:"button",style:af(af({},lf.button),lf.buttonPrimary),onClick:u,children:"Save Changes"})]})]})},uf=Jn("text-align-start",[["path",{d:"M21 5H3",key:"1fi0y6"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M17 19H3",key:"z6ezky"}]]),df=Jn("pen-line",[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]),mf=Jn("server",[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]]),pf=Jn("play",[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]]);function gf(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function vf(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?gf(Object(t),!0).forEach(function(n){hf(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):gf(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function hf(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const ff={openai:{name:"OpenAI",placeholder:"gpt-4-turbo-preview"},anthropic:{name:"Anthropic",placeholder:"claude-3-opus-20240229"},google:{name:"Google AI",placeholder:"gemini-pro"},openrouter:{name:"OpenRouter",placeholder:"anthropic/claude-3-opus"},custom:{name:"Custom Endpoint",placeholder:"your-model-name"}},bf={layout:{display:"flex",flexDirection:"column",height:"100%",maxHeight:"100%",minHeight:0},header:{display:"flex",alignItems:"center",gap:"12px",padding:"16px 20px",borderBottom:"1px solid var(--lumiverse-border)",flexShrink:0},headerIcon:{display:"flex",alignItems:"center",justifyContent:"center",width:"40px",height:"40px",borderRadius:"10px",background:"linear-gradient(135deg, rgba(147, 112, 219, 0.2), rgba(147, 112, 219, 0.1))",color:"var(--lumiverse-primary)"},headerText:{flex:1},title:{margin:0,fontSize:"16px",fontWeight:600,color:"var(--lumiverse-text)"},subtitle:{margin:"4px 0 0",fontSize:"12px",color:"var(--lumiverse-text-muted)"},scrollArea:{flex:"1 1 auto",minHeight:0,overflowY:"auto",padding:"16px 20px"},section:{marginBottom:"20px",padding:"14px",background:"rgba(0, 0, 0, 0.15)",borderRadius:"10px",border:"1px solid var(--lumiverse-border)"},sectionHeader:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"12px",color:"var(--lumiverse-text)",fontWeight:500,fontSize:"14px"},sectionIcon:{color:"var(--lumiverse-primary)"},modeOptions:{display:"flex",gap:"8px"},modeOption:{flex:1,padding:"10px",background:"rgba(0, 0, 0, 0.2)",border:"1px solid var(--lumiverse-border)",borderRadius:"8px",cursor:"pointer",transition:"all 0.2s ease",textAlign:"center",fontSize:"13px",fontWeight:500,color:"var(--lumiverse-text)"},modeOptionSelected:{background:"rgba(147, 112, 219, 0.15)",borderColor:"var(--lumiverse-primary)",color:"var(--lumiverse-primary)"},field:{marginBottom:"12px"},fieldRow:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px"},fieldRow3:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"12px"},label:{display:"block",fontSize:"12px",fontWeight:500,color:"var(--lumiverse-text)",marginBottom:"6px"},input:{width:"100%",padding:"10px 12px",fontSize:"13px",background:"var(--lumiverse-input-bg)",border:"1px solid var(--lumiverse-border)",borderRadius:"8px",color:"var(--lumiverse-text)",outline:"none",boxSizing:"border-box"},select:{width:"100%",padding:"10px 12px",fontSize:"13px",background:"var(--lumiverse-input-bg)",border:"1px solid var(--lumiverse-border)",borderRadius:"8px",color:"var(--lumiverse-text)",outline:"none",boxSizing:"border-box"},hint:{fontSize:"11px",color:"var(--lumiverse-text-muted)",marginTop:"4px"},toggleRow:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px 0"},toggleLabel:{flex:1},toggleText:{display:"block",fontSize:"13px",fontWeight:500,color:"var(--lumiverse-text)"},toggleHint:{display:"block",fontSize:"11px",color:"var(--lumiverse-text-muted)",marginTop:"2px"},toggle:{position:"relative",width:"44px",height:"24px",background:"rgba(0, 0, 0, 0.3)",borderRadius:"12px",cursor:"pointer",transition:"background 0.2s ease"},toggleActive:{background:"var(--lumiverse-primary)"},toggleThumb:{position:"absolute",top:"2px",left:"2px",width:"20px",height:"20px",background:"white",borderRadius:"50%",transition:"transform 0.2s ease"},toggleThumbActive:{transform:"translateX(20px)"},warningBox:{display:"flex",gap:"12px",padding:"12px",background:"rgba(255, 152, 0, 0.1)",border:"1px solid rgba(255, 152, 0, 0.3)",borderRadius:"8px",marginTop:"12px"},warningIcon:{color:"#ff9800",flexShrink:0},warningContent:{flex:1},warningTitle:{fontSize:"12px",fontWeight:600,color:"#ff9800",marginBottom:"4px"},warningText:{fontSize:"11px",color:"var(--lumiverse-text-muted)",lineHeight:1.4},testSection:{marginBottom:"20px",padding:"14px",background:"rgba(147, 112, 219, 0.08)",borderRadius:"10px",border:"1px solid rgba(147, 112, 219, 0.2)"},testButton:{width:"100%",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",padding:"12px",fontSize:"14px",fontWeight:500,background:"var(--lumiverse-primary)",color:"white",border:"none",borderRadius:"8px",cursor:"pointer"},testButtonDisabled:{opacity:.5,cursor:"not-allowed"},testResult:{display:"flex",alignItems:"flex-start",gap:"10px",padding:"12px",borderRadius:"8px",marginTop:"12px"},testResultSuccess:{background:"rgba(76, 175, 80, 0.1)",border:"1px solid rgba(76, 175, 80, 0.3)"},testResultError:{background:"rgba(244, 67, 54, 0.1)",border:"1px solid rgba(244, 67, 54, 0.3)"},footer:{display:"flex",justifyContent:"flex-end",gap:"8px",padding:"12px 20px",borderTop:"1px solid var(--lumiverse-border)",flexShrink:0},button:{padding:"10px 16px",fontSize:"13px",fontWeight:500,borderRadius:"8px",border:"none",cursor:"pointer",transition:"all 0.2s ease"},buttonSecondary:{background:"var(--lumiverse-surface)",color:"var(--lumiverse-text)",border:"1px solid var(--lumiverse-border)"},buttonPrimary:{background:"var(--lumiverse-primary)",color:"white"},hidden:{display:"none"}};const xf=function(e){var n,t;let{onClose:r}=e;const i=wn,a=Nn(),o=i.getState(),s=o.summarization||{},l=s.secondary||{},c=o.messageTruncation||{},[u,d]=(0,Je.useState)(s.mode||"disabled"),[m,p]=(0,Je.useState)(s.apiSource||"main"),[g,v]=(0,Je.useState)(s.autoInterval||10),[h,f]=(0,Je.useState)(s.autoMessageContext||10),[b,x]=(0,Je.useState)(s.manualMessageContext||10),[y,k]=(0,Je.useState)(l.provider||"openai"),[w,j]=(0,Je.useState)(l.model||""),[S,C]=(0,Je.useState)(l.endpoint||""),[N,P]=(0,Je.useState)(l.apiKey||""),[E,O]=(0,Je.useState)(l.temperature||.7),[M,z]=(0,Je.useState)(void 0!==l.topP?l.topP:1),[T,I]=(0,Je.useState)(l.maxTokens||8192),[L,D]=(0,Je.useState)(c.enabled||!1),[A,R]=(0,Je.useState)(null!==(n=c.keepCount)&&void 0!==n?n:50),[B,_]=(0,Je.useState)(!1),[U,F]=(0,Je.useState)(null),W=(0,Je.useCallback)(()=>{const e={summarization:{mode:u,apiSource:m,autoInterval:parseInt(g,10)||10,autoMessageContext:parseInt(h,10)||10,manualMessageContext:parseInt(b,10)||10,secondary:{provider:y,model:w,endpoint:S,apiKey:N,temperature:parseFloat(E)||.7,topP:parseFloat(M)||1,maxTokens:(e=>{const n=parseInt(e,10);return isNaN(n)?8192:Math.max(256,n)})(T)}},messageTruncation:{enabled:L,keepCount:parseInt(A,10)||50}};a.setSettings(e),yn(),window.toastr&&window.toastr.success("Summarization settings saved!"),r()},[u,m,g,h,b,y,w,S,N,E,M,T,L,A,a,r]),H=(0,Je.useCallback)(async()=>{_(!0),F(null);try{var e,n;const t=null===(e=window.LumiverseBridge)||void 0===e||null===(n=e.getCallbacks)||void 0===n?void 0:n.call(e);if(null!=t&&t.generateSummary){const e={mode:u,apiSource:m,autoInterval:parseInt(g,10)||10,autoMessageContext:parseInt(h,10)||10,manualMessageContext:parseInt(b,10)||10,secondary:{provider:y,model:w,endpoint:S,apiKey:N,temperature:parseFloat(E)||.7,topP:parseFloat(M)||1,maxTokens:parseInt(T,10)||8192}};await t.generateSummary(e,!0)?(F({success:!0,message:"Summary woven successfully! Saved to chat metadata."}),window.toastr&&window.toastr.success("Summary generated and saved to chat metadata!")):F({success:!1,message:"No summary generated. Check console for details."})}else F({success:!1,message:"Summary generation not available."})}catch(e){console.error("[SummarizationModal] Test error:",e),F({success:!1,message:e.message||"Failed to generate summary"})}finally{_(!1)}},[u,m,g,h,b,y,w,S,N,E,M,T]),V=(()=>{try{var e,n;const t=null===(e=window.SillyTavern)||void 0===e||null===(n=e.getContext)||void 0===n?void 0:n.call(e);return(null==t?void 0:t.chat)&&t.chat.length>0}catch(e){return!1}})();return(0,nn.jsxs)("div",{style:bf.layout,children:[(0,nn.jsxs)("div",{style:bf.header,children:[(0,nn.jsx)("div",{style:bf.headerIcon,children:(0,nn.jsx)(uf,{size:20,strokeWidth:1.5})}),(0,nn.jsxs)("div",{style:bf.headerText,children:[(0,nn.jsx)("h3",{style:bf.title,children:"Summarization"}),(0,nn.jsx)("p",{style:bf.subtitle,children:"Configure story summarization settings"})]})]}),(0,nn.jsxs)("div",{style:bf.scrollArea,children:[(0,nn.jsxs)("div",{style:bf.section,children:[(0,nn.jsxs)("div",{style:bf.sectionHeader,children:[(0,nn.jsx)(Np,{size:16,style:bf.sectionIcon}),(0,nn.jsx)("span",{children:"Mode"})]}),(0,nn.jsx)("div",{style:bf.modeOptions,children:["disabled","auto","manual"].map(e=>(0,nn.jsx)("button",{type:"button",style:vf(vf({},bf.modeOption),u===e?bf.modeOptionSelected:{}),onClick:()=>d(e),children:e.charAt(0).toUpperCase()+e.slice(1)},e))})]}),"auto"===u&&(0,nn.jsxs)("div",{style:bf.section,children:[(0,nn.jsxs)("div",{style:bf.sectionHeader,children:[(0,nn.jsx)($t,{size:16,style:bf.sectionIcon}),(0,nn.jsx)("span",{children:"Auto Settings"})]}),(0,nn.jsxs)("div",{style:bf.fieldRow,children:[(0,nn.jsxs)("div",{style:bf.field,children:[(0,nn.jsx)("label",{style:bf.label,children:"Interval"}),(0,nn.jsx)("input",{type:"number",style:bf.input,min:"1",value:g,onChange:e=>v(e.target.value)}),(0,nn.jsx)("div",{style:bf.hint,children:"Every N messages"})]}),(0,nn.jsxs)("div",{style:bf.field,children:[(0,nn.jsx)("label",{style:bf.label,children:"Context"}),(0,nn.jsx)("input",{type:"number",style:bf.input,min:"1",max:"100",value:h,onChange:e=>f(e.target.value)}),(0,nn.jsx)("div",{style:bf.hint,children:"Messages to include"})]})]})]}),("manual"===u||"auto"===u)&&(0,nn.jsxs)("div",{style:bf.section,children:[(0,nn.jsxs)("div",{style:bf.sectionHeader,children:[(0,nn.jsx)(df,{size:16,style:bf.sectionIcon}),(0,nn.jsx)("span",{children:"Manual Context"})]}),(0,nn.jsxs)("div",{style:bf.field,children:[(0,nn.jsx)("label",{style:bf.label,children:"Messages to include"}),(0,nn.jsx)("input",{type:"number",style:bf.input,min:"1",max:"100",value:b,onChange:e=>x(e.target.value)}),(0,nn.jsx)("div",{style:bf.hint,children:"When using /loom-summarize command"})]})]}),(0,nn.jsxs)("div",{style:bf.section,children:[(0,nn.jsxs)("div",{style:bf.sectionHeader,children:[(0,nn.jsx)(Bt,{size:16,style:bf.sectionIcon}),(0,nn.jsx)("span",{children:"API Source"})]}),(0,nn.jsxs)("div",{style:bf.modeOptions,children:[(0,nn.jsx)("button",{type:"button",style:vf(vf({},bf.modeOption),"main"===m?bf.modeOptionSelected:{}),onClick:()=>p("main"),children:"Main API"}),(0,nn.jsx)("button",{type:"button",style:vf(vf({},bf.modeOption),"secondary"===m?bf.modeOptionSelected:{}),onClick:()=>p("secondary"),children:"Secondary LLM"})]})]}),"secondary"===m&&(0,nn.jsxs)("div",{style:bf.section,children:[(0,nn.jsxs)("div",{style:bf.sectionHeader,children:[(0,nn.jsx)(mf,{size:16,style:bf.sectionIcon}),(0,nn.jsx)("span",{children:"Secondary LLM"})]}),(0,nn.jsxs)("div",{style:bf.field,children:[(0,nn.jsx)("label",{style:bf.label,children:"Provider"}),(0,nn.jsx)("select",{style:bf.select,value:y,onChange:e=>k(e.target.value),children:Object.entries(ff).map(e=>{let[n,t]=e;return(0,nn.jsx)("option",{value:n,children:t.name},n)})}),"custom"!==y&&(0,nn.jsx)("div",{style:bf.hint,children:"Uses API key from SillyTavern settings"})]}),(0,nn.jsxs)("div",{style:bf.field,children:[(0,nn.jsx)("label",{style:bf.label,children:"Model"}),(0,nn.jsx)("input",{type:"text",style:bf.input,placeholder:(null===(t=ff[y])||void 0===t?void 0:t.placeholder)||"model-name",value:w,onChange:e=>j(e.target.value)})]}),"custom"===y&&(0,nn.jsxs)(nn.Fragment,{children:[(0,nn.jsxs)("div",{style:bf.field,children:[(0,nn.jsx)("label",{style:bf.label,children:"Endpoint URL"}),(0,nn.jsx)("input",{type:"text",style:bf.input,placeholder:"https://your-api.com/v1/chat/completions",value:S,onChange:e=>C(e.target.value)})]}),(0,nn.jsxs)("div",{style:bf.field,children:[(0,nn.jsx)("label",{style:bf.label,children:"API Key"}),(0,nn.jsx)("input",{type:"password",style:bf.input,placeholder:"Your API key",value:N,onChange:e=>P(e.target.value)})]})]}),(0,nn.jsxs)("div",{style:bf.fieldRow3,children:[(0,nn.jsxs)("div",{style:bf.field,children:[(0,nn.jsx)("label",{style:bf.label,children:"Temp"}),(0,nn.jsx)("input",{type:"number",style:bf.input,min:"0",max:"2",step:"0.1",value:E,onChange:e=>O(e.target.value)})]}),(0,nn.jsxs)("div",{style:bf.field,children:[(0,nn.jsx)("label",{style:bf.label,children:"Top-P"}),(0,nn.jsx)("input",{type:"number",style:bf.input,min:"0",max:"1",step:"0.05",value:M,onChange:e=>z(e.target.value)})]}),(0,nn.jsxs)("div",{style:bf.field,children:[(0,nn.jsx)("label",{style:bf.label,children:"Max Tokens"}),(0,nn.jsx)("input",{type:"number",style:bf.input,value:T,onChange:e=>I(e.target.value)})]})]})]}),(0,nn.jsxs)("div",{style:bf.testSection,children:[(0,nn.jsxs)("div",{style:bf.sectionHeader,children:[(0,nn.jsx)(pf,{size:16,style:bf.sectionIcon}),(0,nn.jsx)("span",{children:"Test"})]}),(0,nn.jsx)("button",{type:"button",style:vf(vf({},bf.testButton),!V||B?bf.testButtonDisabled:{}),onClick:H,disabled:!V||B,children:B?(0,nn.jsxs)(nn.Fragment,{children:[(0,nn.jsx)(Vt,{size:16,style:{animation:"spin 1s linear infinite"}}),(0,nn.jsx)("span",{children:"Weaving summary..."})]}):(0,nn.jsxs)(nn.Fragment,{children:[(0,nn.jsx)(rm,{size:16}),(0,nn.jsx)("span",{children:V?"Generate Summary Now":"No Active Chat"})]})}),U&&(0,nn.jsxs)("div",{style:vf(vf({},bf.testResult),U.success?bf.testResultSuccess:bf.testResultError),children:[U.success?(0,nn.jsx)(rm,{size:16,style:{color:"#4caf50"}}):(0,nn.jsx)(Wt,{size:16,style:{color:"#f44336"}}),(0,nn.jsx)("span",{style:{fontSize:"12px",color:"var(--lumiverse-text)"},children:U.message})]}),!V&&(0,nn.jsx)("div",{style:vf(vf({},bf.hint),{},{marginTop:"8px",textAlign:"center"}),children:"Open a chat to test summarization"})]}),(0,nn.jsxs)("div",{style:bf.section,children:[(0,nn.jsxs)("div",{style:bf.sectionHeader,children:[(0,nn.jsx)(_r,{size:16,style:bf.sectionIcon}),(0,nn.jsx)("span",{children:"Save N Messages"})]}),(0,nn.jsxs)("div",{style:bf.toggleRow,children:[(0,nn.jsxs)("div",{style:bf.toggleLabel,children:[(0,nn.jsx)("span",{style:bf.toggleText,children:"Limit Context Messages"}),(0,nn.jsx)("span",{style:bf.toggleHint,children:"Only send the last N messages to the AI"})]}),(0,nn.jsx)("div",{style:vf(vf({},bf.toggle),L?bf.toggleActive:{}),onClick:()=>D(!L),children:(0,nn.jsx)("div",{style:vf(vf({},bf.toggleThumb),L?bf.toggleThumbActive:{})})})]}),L&&(0,nn.jsxs)(nn.Fragment,{children:[(0,nn.jsxs)("div",{style:bf.field,children:[(0,nn.jsx)("label",{style:bf.label,children:"Messages to keep"}),(0,nn.jsx)("input",{type:"number",style:bf.input,min:"5",max:"500",value:A,onChange:e=>R(e.target.value)}),(0,nn.jsx)("div",{style:bf.hint,children:"Number of recent messages to include in context"})]}),(0,nn.jsxs)("div",{style:bf.warningBox,children:[(0,nn.jsx)(Fr,{size:20,style:bf.warningIcon}),(0,nn.jsxs)("div",{style:bf.warningContent,children:[(0,nn.jsx)("div",{style:bf.warningTitle,children:"Memory Loss Warning"}),(0,nn.jsx)("div",{style:bf.warningText,children:"Older messages beyond this limit will be excluded from the AI's context. The AI will lose awareness of earlier events, character details, and plot points. Consider using Loom summarization to preserve important memories."})]})]})]})]})]}),(0,nn.jsxs)("div",{style:bf.footer,children:[(0,nn.jsx)("button",{type:"button",style:vf(vf({},bf.button),bf.buttonSecondary),onClick:r,children:"Cancel"}),(0,nn.jsx)("button",{type:"button",style:vf(vf({},bf.button),bf.buttonPrimary),onClick:W,children:"Save Changes"})]}),(0,nn.jsx)("style",{children:"\n                @keyframes spin {\n                    from { transform: rotate(0deg); }\n                    to { transform: rotate(360deg); }\n                }\n            "})]})},yf=Jn("grid-3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]),kf=Jn("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),wf=Jn("funnel",[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]]);function jf(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function Sf(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?jf(Object(t),!0).forEach(function(n){Cf(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):jf(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Cf(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const Nf={layout:{display:"flex",flexDirection:"column",height:"100%",maxHeight:"100%",minHeight:0},header:{display:"flex",alignItems:"center",gap:"12px",padding:"16px 20px",borderBottom:"1px solid var(--lumiverse-border)",flexShrink:0},headerIcon:{display:"flex",alignItems:"center",justifyContent:"center",width:"40px",height:"40px",borderRadius:"10px",background:"linear-gradient(135deg, rgba(147, 112, 219, 0.2), rgba(147, 112, 219, 0.1))",color:"var(--lumiverse-primary)"},headerText:{flex:1},title:{margin:0,fontSize:"16px",fontWeight:600,color:"var(--lumiverse-text)"},subtitle:{margin:"4px 0 0",fontSize:"12px",color:"var(--lumiverse-text-muted)"},scrollArea:{flex:"1 1 auto",minHeight:0,overflowY:"auto",padding:"16px 20px"},section:{marginBottom:"16px",background:"rgba(0, 0, 0, 0.15)",borderRadius:"10px",border:"1px solid var(--lumiverse-border)",overflow:"hidden"},sectionHeader:{display:"flex",alignItems:"center",gap:"10px",padding:"12px 14px",cursor:"pointer",transition:"background 0.2s ease"},sectionHeaderIcon:{display:"flex",alignItems:"center",justifyContent:"center",width:"28px",height:"28px",borderRadius:"6px",background:"rgba(147, 112, 219, 0.15)",color:"var(--lumiverse-primary)"},sectionHeaderText:{flex:1,fontSize:"14px",fontWeight:500,color:"var(--lumiverse-text)"},statusBadge:{fontSize:"10px",fontWeight:600,padding:"3px 8px",borderRadius:"10px",textTransform:"uppercase",letterSpacing:"0.5px"},statusActive:{background:"rgba(76, 175, 80, 0.15)",color:"#4caf50"},statusInactive:{background:"rgba(158, 158, 158, 0.15)",color:"#9e9e9e"},collapseIcon:{color:"var(--lumiverse-text-muted)",transition:"transform 0.2s ease"},sectionContent:{padding:"0 14px 14px"},description:{fontSize:"12px",color:"var(--lumiverse-text-muted)",marginBottom:"12px",lineHeight:1.5},toggleRow:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px 0",borderBottom:"1px solid var(--lumiverse-border)"},toggleRowLast:{borderBottom:"none"},toggleRowDisabled:{opacity:.5},toggleLabel:{flex:1},toggleText:{display:"block",fontSize:"13px",fontWeight:500,color:"var(--lumiverse-text)"},toggleHint:{display:"block",fontSize:"11px",color:"var(--lumiverse-text-muted)",marginTop:"2px"},toggle:{position:"relative",width:"44px",height:"24px",background:"rgba(0, 0, 0, 0.3)",borderRadius:"12px",cursor:"pointer",transition:"background 0.2s ease",flexShrink:0},toggleActive:{background:"var(--lumiverse-primary)"},toggleThumb:{position:"absolute",top:"2px",left:"2px",width:"20px",height:"20px",background:"white",borderRadius:"50%",transition:"transform 0.2s ease"},toggleThumbActive:{transform:"translateX(20px)"},infoBox:{background:"rgba(147, 112, 219, 0.08)",border:"1px solid rgba(147, 112, 219, 0.2)",borderRadius:"8px",padding:"12px",marginTop:"12px"},infoBoxMuted:{opacity:.6},infoBoxHeader:{display:"flex",alignItems:"center",gap:"6px",fontSize:"12px",fontWeight:500,color:"var(--lumiverse-primary)",marginBottom:"8px"},infoBoxList:{margin:0,padding:"0 0 0 16px",fontSize:"11px",color:"var(--lumiverse-text-muted)",lineHeight:1.6},infoBoxCode:{fontFamily:"monospace",background:"rgba(0, 0, 0, 0.2)",padding:"1px 4px",borderRadius:"3px",fontSize:"10px"},filterItem:{marginBottom:"12px"},filterOptions:{marginTop:"10px",padding:"10px 12px",background:"rgba(0, 0, 0, 0.1)",borderRadius:"6px"},filterOptionsHidden:{display:"none"},subFilterItem:{marginTop:"10px",paddingTop:"10px",borderTop:"1px dashed var(--lumiverse-border)"},field:{marginBottom:"8px"},label:{display:"flex",alignItems:"center",gap:"8px",fontSize:"12px",fontWeight:500,color:"var(--lumiverse-text)",marginBottom:"6px"},input:{width:"80px",padding:"8px 10px",fontSize:"13px",background:"var(--lumiverse-input-bg)",border:"1px solid var(--lumiverse-border)",borderRadius:"6px",color:"var(--lumiverse-text)",outline:"none"},hint:{fontSize:"10px",color:"var(--lumiverse-text-muted)",marginTop:"4px"},footer:{display:"flex",justifyContent:"flex-end",gap:"8px",padding:"12px 20px",borderTop:"1px solid var(--lumiverse-border)",flexShrink:0},button:{padding:"10px 16px",fontSize:"13px",fontWeight:500,borderRadius:"8px",border:"none",cursor:"pointer",transition:"all 0.2s ease"},buttonSecondary:{background:"var(--lumiverse-surface)",color:"var(--lumiverse-text)",border:"1px solid var(--lumiverse-border)"},buttonPrimary:{background:"var(--lumiverse-primary)",color:"white"}};function Pf(e){let{checked:n,onChange:t,disabled:r}=e;return(0,nn.jsx)("div",{style:Sf(Sf(Sf({},Nf.toggle),n?Nf.toggleActive:{}),r?{opacity:.5,cursor:"not-allowed"}:{}),onClick:()=>!r&&t(!n),children:(0,nn.jsx)("div",{style:Sf(Sf({},Nf.toggleThumb),n?Nf.toggleThumbActive:{})})})}const Ef=function(e){let{onClose:n}=e;const t=wn,r=Nn(),i=t.getState(),a=i.sovereignHand||{},o=i.contextFilters||{},s=o.htmlTags||{},l=o.detailsBlocks||{},c=o.loomItems||{},[u,d]=(0,Je.useState)(!0),[m,p]=(0,Je.useState)(!0),[g,v]=(0,Je.useState)(a.enabled||!1),[h,f]=(0,Je.useState)(!1!==a.excludeLastMessage),[b,x]=(0,Je.useState)(!1!==a.includeMessageInPrompt),[y,k]=(0,Je.useState)(s.enabled||!1),[w,j]=(0,Je.useState)(s.keepDepth||3),[S,C]=(0,Je.useState)(s.stripFonts||!1),[N,P]=(0,Je.useState)(s.fontKeepDepth||3),[E,O]=(0,Je.useState)(l.enabled||!1),[M,z]=(0,Je.useState)(l.keepDepth||3),[T,I]=(0,Je.useState)(c.enabled||!1),[L,D]=(0,Je.useState)(c.keepDepth||5),A=(0,Je.useCallback)(()=>{const e={sovereignHand:{enabled:g,excludeLastMessage:h,includeMessageInPrompt:b},contextFilters:{htmlTags:{enabled:y,keepDepth:parseInt(w,10)||3,stripFonts:S,fontKeepDepth:parseInt(N,10)||3},detailsBlocks:{enabled:E,keepDepth:parseInt(M,10)||3},loomItems:{enabled:T,keepDepth:parseInt(L,10)||5}}};r.setSettings(e),yn(),window.toastr&&window.toastr.success("Prompt settings saved!"),n()},[g,h,b,y,w,S,N,E,M,T,L,r,n]),R=y||E||T;return(0,nn.jsxs)("div",{style:Nf.layout,children:[(0,nn.jsxs)("div",{style:Nf.header,children:[(0,nn.jsx)("div",{style:Nf.headerIcon,children:(0,nn.jsx)(df,{size:20,strokeWidth:1.5})}),(0,nn.jsxs)("div",{style:Nf.headerText,children:[(0,nn.jsx)("h3",{style:Nf.title,children:"Prompt Settings"}),(0,nn.jsx)("p",{style:Nf.subtitle,children:"Configure advanced prompt features"})]})]}),(0,nn.jsxs)("div",{style:Nf.scrollArea,children:[(0,nn.jsxs)("div",{style:Nf.section,children:[(0,nn.jsxs)("div",{style:Nf.sectionHeader,onClick:()=>d(!u),children:[(0,nn.jsx)("div",{style:Nf.sectionHeaderIcon,children:(0,nn.jsx)(yf,{size:16,strokeWidth:1.5})}),(0,nn.jsx)("span",{style:Nf.sectionHeaderText,children:"Sovereign Hand"}),(0,nn.jsx)("span",{style:Sf(Sf({},Nf.statusBadge),g?Nf.statusActive:Nf.statusInactive),children:g?"Active":"Inactive"}),u?(0,nn.jsx)(Rm,{size:16,style:Nf.collapseIcon}):(0,nn.jsx)(ot,{size:16,style:Nf.collapseIcon})]}),u&&(0,nn.jsxs)("div",{style:Nf.sectionContent,children:[(0,nn.jsx)("p",{style:Nf.description,children:"Enable Sovereign Hand integration to use advanced prompt manipulation features."}),(0,nn.jsxs)("div",{style:Nf.toggleRow,children:[(0,nn.jsxs)("div",{style:Nf.toggleLabel,children:[(0,nn.jsx)("span",{style:Nf.toggleText,children:"Use Sovereign Hand Features"}),(0,nn.jsx)("span",{style:Nf.toggleHint,children:"Enables Sovereign Hand macros for advanced prompt control"})]}),(0,nn.jsx)(Pf,{checked:g,onChange:v})]}),(0,nn.jsxs)("div",{style:Sf(Sf({},Nf.toggleRow),g?{}:Nf.toggleRowDisabled),children:[(0,nn.jsxs)("div",{style:Nf.toggleLabel,children:[(0,nn.jsx)("span",{style:Nf.toggleText,children:"Exclude Last Message from Context"}),(0,nn.jsx)("span",{style:Nf.toggleHint,children:"When enabled, removes the last user message from the outgoing context"})]}),(0,nn.jsx)(Pf,{checked:h,onChange:f,disabled:!g})]}),(0,nn.jsxs)("div",{style:Sf(Sf(Sf({},Nf.toggleRow),Nf.toggleRowLast),g?{}:Nf.toggleRowDisabled),children:[(0,nn.jsxs)("div",{style:Nf.toggleLabel,children:[(0,nn.jsx)("span",{style:Nf.toggleText,children:"Include Message in Master Prompt"}),(0,nn.jsxs)("span",{style:Nf.toggleHint,children:["When enabled, includes the user message in the ","{{loomSovHand}}"," macro output"]})]}),(0,nn.jsx)(Pf,{checked:b,onChange:x,disabled:!g})]}),(0,nn.jsxs)("div",{style:Sf(Sf({},Nf.infoBox),g?{}:Nf.infoBoxMuted),children:[(0,nn.jsxs)("div",{style:Nf.infoBoxHeader,children:[(0,nn.jsx)(kf,{size:14}),(0,nn.jsx)("span",{children:"Available macros:"})]}),(0,nn.jsxs)("ul",{style:Nf.infoBoxList,children:[(0,nn.jsxs)("li",{children:[(0,nn.jsx)("code",{style:Nf.infoBoxCode,children:"{{loomLastUserMessage}}"})," returns the last user message content"]}),(0,nn.jsxs)("li",{children:[(0,nn.jsx)("code",{style:Nf.infoBoxCode,children:"{{loomLastCharMessage}}"})," returns the last character message content"]}),(0,nn.jsxs)("li",{children:[(0,nn.jsx)("code",{style:Nf.infoBoxCode,children:"{{lastMessageName}}"})," returns the name of whoever sent the last message"]}),(0,nn.jsxs)("li",{children:[(0,nn.jsx)("code",{style:Nf.infoBoxCode,children:"{{loomContinuePrompt}}"})," adds continuation instructions when character spoke last"]})]})]})]})]}),(0,nn.jsxs)("div",{style:Nf.section,children:[(0,nn.jsxs)("div",{style:Nf.sectionHeader,onClick:()=>p(!m),children:[(0,nn.jsx)("div",{style:Nf.sectionHeaderIcon,children:(0,nn.jsx)(wf,{size:16,strokeWidth:1.5})}),(0,nn.jsx)("span",{style:Nf.sectionHeaderText,children:"Context Filters"}),(0,nn.jsx)("span",{style:Sf(Sf({},Nf.statusBadge),R?Nf.statusActive:Nf.statusInactive),children:R?"Active":"Inactive"}),m?(0,nn.jsx)(Rm,{size:16,style:Nf.collapseIcon}):(0,nn.jsx)(ot,{size:16,style:Nf.collapseIcon})]}),m&&(0,nn.jsxs)("div",{style:Nf.sectionContent,children:[(0,nn.jsx)("p",{style:Nf.description,children:"Filter out specific content from the chat context before sending to the AI. Helps reduce token usage and keep prompts clean."}),(0,nn.jsxs)("div",{style:Nf.filterItem,children:[(0,nn.jsxs)("div",{style:Nf.toggleRow,children:[(0,nn.jsxs)("div",{style:Nf.toggleLabel,children:[(0,nn.jsx)("span",{style:Nf.toggleText,children:"Strip HTML Tags"}),(0,nn.jsx)("span",{style:Nf.toggleHint,children:"Removes formatting tags: <div>, <span>, <b>, <i>, <u>, <em>, <strong>"})]}),(0,nn.jsx)(Pf,{checked:y,onChange:k})]}),y&&(0,nn.jsxs)("div",{style:Nf.filterOptions,children:[(0,nn.jsxs)("div",{style:Nf.field,children:[(0,nn.jsxs)("label",{style:Nf.label,children:[(0,nn.jsx)("span",{children:"Keep HTML in last N messages:"}),(0,nn.jsx)("input",{type:"number",style:Nf.input,min:"0",max:"100",value:w,onChange:e=>j(e.target.value)})]}),(0,nn.jsx)("div",{style:Nf.hint,children:"HTML tags in older messages will be stripped to save tokens"})]}),(0,nn.jsxs)("div",{style:Nf.subFilterItem,children:[(0,nn.jsxs)("div",{style:Nf.toggleRow,children:[(0,nn.jsxs)("div",{style:Nf.toggleLabel,children:[(0,nn.jsx)("span",{style:Nf.toggleText,children:"Also Strip Fonts"}),(0,nn.jsx)("span",{style:Nf.toggleHint,children:"Remove <font> tags (used by some presets for colored dialogue)"})]}),(0,nn.jsx)(Pf,{checked:S,onChange:C})]}),S&&(0,nn.jsx)("div",{style:{marginTop:"8px"},children:(0,nn.jsxs)("label",{style:Nf.label,children:[(0,nn.jsx)("span",{children:"Keep fonts in last N messages:"}),(0,nn.jsx)("input",{type:"number",style:Nf.input,min:"0",max:"100",value:N,onChange:e=>P(e.target.value)})]})})]})]})]}),(0,nn.jsxs)("div",{style:Nf.filterItem,children:[(0,nn.jsxs)("div",{style:Nf.toggleRow,children:[(0,nn.jsxs)("div",{style:Nf.toggleLabel,children:[(0,nn.jsx)("span",{style:Nf.toggleText,children:"Filter Details Blocks"}),(0,nn.jsx)("span",{style:Nf.toggleHint,children:"Removes <details> blocks from older messages to save context"})]}),(0,nn.jsx)(Pf,{checked:E,onChange:O})]}),E&&(0,nn.jsx)("div",{style:Nf.filterOptions,children:(0,nn.jsxs)("div",{style:Nf.field,children:[(0,nn.jsxs)("label",{style:Nf.label,children:[(0,nn.jsx)("span",{children:"Keep in last N messages:"}),(0,nn.jsx)("input",{type:"number",style:Nf.input,min:"0",max:"100",value:M,onChange:e=>z(e.target.value)})]}),(0,nn.jsx)("div",{style:Nf.hint,children:"Messages beyond this depth will have <details> blocks removed"})]})})]}),(0,nn.jsxs)("div",{style:Nf.filterItem,children:[(0,nn.jsxs)("div",{style:Sf(Sf({},Nf.toggleRow),Nf.toggleRowLast),children:[(0,nn.jsxs)("div",{style:Nf.toggleLabel,children:[(0,nn.jsx)("span",{style:Nf.toggleText,children:"Filter Loom Tags"}),(0,nn.jsx)("span",{style:Nf.toggleHint,children:"Removes Lucid Loom-related tags from older messages"})]}),(0,nn.jsx)(Pf,{checked:T,onChange:I})]}),T&&(0,nn.jsx)("div",{style:Nf.filterOptions,children:(0,nn.jsxs)("div",{style:Nf.field,children:[(0,nn.jsxs)("label",{style:Nf.label,children:[(0,nn.jsx)("span",{children:"Keep in last N messages:"}),(0,nn.jsx)("input",{type:"number",style:Nf.input,min:"0",max:"100",value:L,onChange:e=>D(e.target.value)})]}),(0,nn.jsx)("div",{style:Nf.hint,children:"Loom tags in older messages will be stripped to save tokens"})]})})]})]})]})]}),(0,nn.jsxs)("div",{style:Nf.footer,children:[(0,nn.jsx)("button",{type:"button",style:Sf(Sf({},Nf.button),Nf.buttonSecondary),onClick:n,children:"Cancel"}),(0,nn.jsx)("button",{type:"button",style:Sf(Sf({},Nf.button),Nf.buttonPrimary),onClick:A,children:"Save Changes"})]})]})},Of=Jn("box",[["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]),Mf=["src","alt","style","objectPosition","className"];function zf(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function Tf(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?zf(Object(t),!0).forEach(function(n){If(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):zf(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function If(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const Lf={container:{position:"relative",width:"100%",height:"100%"},image:{width:"100%",height:"100%",objectFit:"cover",transition:"opacity 0.2s ease"},spinner:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",display:"flex",alignItems:"center",justifyContent:"center",color:"var(--lumiverse-primary, #9370db)",opacity:.6,animation:"spin 1s linear infinite"}};const Df=function(e){let{src:n,alt:t="",style:r={},objectPosition:i="center",className:a=""}=e,o=function(e,n){if(null==e)return{};var t,r,i=function(e,n){if(null==e)return{};var t={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==n.indexOf(r))continue;t[r]=e[r]}return t}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],-1===n.indexOf(t)&&{}.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}(e,Mf);const[s,l]=(0,Je.useState)(!0),[c,u]=(0,Je.useState)(!1),d=(0,Je.useCallback)(()=>{l(!1)},[]),m=(0,Je.useCallback)(()=>{l(!1),u(!0)},[]);return c||!n?null:(0,nn.jsxs)("div",{style:Lf.container,children:[s&&(0,nn.jsx)("div",{style:Lf.spinner,children:(0,nn.jsx)(Vt,{size:24,strokeWidth:1.5})}),(0,nn.jsx)("img",Tf({src:n,alt:t,style:Tf(Tf(Tf({},Lf.image),r),{},{objectPosition:i,opacity:s?0:1}),className:a,loading:"lazy",onLoad:d,onError:m},o))]})};function Af(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function Rf(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Af(Object(t),!0).forEach(function(n){Bf(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Af(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Bf(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const _f=[{id:"Lumia DLCs",label:"Lumia DLCs",Icon:Rr},{id:"Loom Utilities",label:"Utilities",Icon:am},{id:"Loom Retrofits",label:"Retrofits",Icon:Np},{id:"Loom Narratives",label:"Narratives",Icon:Cp}],Uf={layout:{display:"flex",flexDirection:"column",height:"100%",maxHeight:"100%",minHeight:0},header:{display:"flex",alignItems:"center",gap:"12px",padding:"16px 20px",borderBottom:"1px solid var(--lumiverse-border)",flexShrink:0},headerIcon:{display:"flex",alignItems:"center",justifyContent:"center",width:"40px",height:"40px",borderRadius:"10px",background:"linear-gradient(135deg, rgba(147, 112, 219, 0.2), rgba(147, 112, 219, 0.1))",color:"var(--lumiverse-primary)"},headerText:{flex:1},title:{margin:0,fontSize:"16px",fontWeight:600,color:"var(--lumiverse-text)"},subtitle:{margin:"4px 0 0",fontSize:"12px",color:"var(--lumiverse-text-muted)"},tabs:{display:"flex",gap:"2px",padding:"0 16px",borderBottom:"1px solid var(--lumiverse-border)",flexShrink:0,overflowX:"auto"},tab:{display:"flex",alignItems:"center",gap:"6px",padding:"12px 14px",fontSize:"12px",fontWeight:500,color:"var(--lumiverse-text-muted)",background:"transparent",border:"none",borderBottom:"2px solid transparent",cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap"},tabActive:{color:"var(--lumiverse-primary)",borderBottomColor:"var(--lumiverse-primary)"},scrollArea:{flex:"1 1 auto",minHeight:0,overflowY:"auto",padding:"16px"},loading:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"12px",padding:"40px",color:"var(--lumiverse-text-muted)"},spinner:{animation:"spin 1s linear infinite"},error:{display:"flex",flexDirection:"column",alignItems:"center",gap:"12px",padding:"40px",textAlign:"center"},errorIcon:{color:"#f44336"},errorText:{fontSize:"13px",color:"var(--lumiverse-text-muted)"},retryButton:{display:"flex",alignItems:"center",gap:"6px",padding:"8px 16px",fontSize:"13px",fontWeight:500,background:"var(--lumiverse-surface)",color:"var(--lumiverse-text)",border:"1px solid var(--lumiverse-border)",borderRadius:"6px",cursor:"pointer"},empty:{textAlign:"center",padding:"40px 20px",fontSize:"13px",color:"var(--lumiverse-text-muted)"},grid:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"16px"},card:{position:"relative",background:"rgba(0, 0, 0, 0.2)",borderRadius:"12px",border:"1px solid var(--lumiverse-border)",overflow:"hidden",cursor:"pointer",transition:"all 0.2s ease"},cardSelected:{borderColor:"var(--lumiverse-primary)",boxShadow:"0 0 0 1px var(--lumiverse-primary)"},cardImported:{opacity:.5},cardImage:{position:"relative",aspectRatio:"3 / 4",background:"rgba(0, 0, 0, 0.3)",display:"flex",alignItems:"center",justifyContent:"center"},cardImg:{width:"100%",height:"100%",objectFit:"cover"},cardPlaceholder:{color:"var(--lumiverse-text-muted)"},cardCheck:{position:"absolute",top:"8px",right:"8px",width:"24px",height:"24px",borderRadius:"50%",background:"var(--lumiverse-primary)",display:"flex",alignItems:"center",justifyContent:"center",color:"white",opacity:0,transform:"scale(0.8)",transition:"all 0.2s ease"},cardCheckVisible:{opacity:1,transform:"scale(1)"},cardInfo:{padding:"12px"},cardTitle:{fontSize:"14px",fontWeight:600,color:"var(--lumiverse-text)",marginBottom:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},cardAuthor:{fontSize:"12px",color:"var(--lumiverse-text-muted)",marginBottom:"6px"},cardCounts:{fontSize:"11px",color:"var(--lumiverse-primary)"},footer:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:"12px",padding:"12px 16px",borderTop:"1px solid var(--lumiverse-border)",flexShrink:0},footerLeft:{display:"flex",alignItems:"center",gap:"8px"},footerButton:{padding:"6px 12px",fontSize:"12px",fontWeight:500,background:"transparent",color:"var(--lumiverse-text-muted)",border:"none",cursor:"pointer",transition:"color 0.2s ease"},footerRight:{display:"flex",alignItems:"center",gap:"12px"},selectedCount:{fontSize:"12px",color:"var(--lumiverse-text-muted)"},button:{padding:"10px 16px",fontSize:"13px",fontWeight:500,borderRadius:"8px",border:"none",cursor:"pointer",transition:"all 0.2s ease"},buttonSecondary:{background:"var(--lumiverse-surface)",color:"var(--lumiverse-text)",border:"1px solid var(--lumiverse-border)"},buttonPrimary:{display:"flex",alignItems:"center",gap:"6px",background:"var(--lumiverse-primary)",color:"white"},buttonDisabled:{opacity:.5,cursor:"not-allowed"}};const Ff=function(e){let{onClose:n}=e;const[t,r]=(0,Je.useState)("Lumia DLCs"),[i,a]=(0,Je.useState)(!0),[o,s]=(0,Je.useState)(null),[l,c]=(0,Je.useState)([]),[u,d]=(0,Je.useState)([]),[m,p]=(0,Je.useState)(!1),[g,v]=(0,Je.useState)({current:0,total:0}),h=(0,Je.useCallback)(async()=>{a(!0),s(null),d([]);try{const e=await fetch("https://lucid.cards/api/lumia-dlc");if(!e.ok)throw new Error("HTTP error: ".concat(e.status));const n=await e.json();c(n.packs||[])}catch(e){console.error("[LucidCardsModal] Fetch error:",e),s(e.message||"Failed to load content")}finally{a(!1)}},[]);(0,Je.useEffect)(()=>{h()},[h]);const f=l.filter(e=>"Lumia DLCs"===t?"lumia"===e.packType||e.lumiaCount&&e.lumiaCount>0:"loom"===e.packType||e.loomCount&&e.loomCount>0),b=(0,Je.useCallback)(e=>{const n=e.slug;d(t=>t.find(e=>e.slug===n)?t.filter(e=>e.slug!==n):[...t,e])},[]),x=(0,Je.useCallback)(()=>{d(f)},[f]),y=(0,Je.useCallback)(()=>{d([])},[]),k=(0,Je.useCallback)(e=>u.some(n=>n.slug===e.slug),[u]),w=(0,Je.useCallback)(async()=>{if(0===u.length||m)return;p(!0);const e=u.length;let n=0,t=0,r=0;for(let i=0;i<u.length;i++){const a=u[i];if(v({current:i+1,total:e}),(0,D.qG)(a.packName))t++;else try{const e=await fetch("https://lucid.cards/api/lumia-dlc/".concat(a.slug));if(!e.ok)throw new Error("HTTP error: ".concat(e.status));const t=await e.json();if(!1===t.success)throw new Error(t.error||"Failed to fetch pack");const r=t.pack||t,i={packName:r.packName||a.packName,packAuthor:r.packAuthor||null,coverUrl:r.coverUrl||null,version:r.version||1,packExtras:r.packExtras||[],lumiaItems:r.lumiaItems||[],loomItems:r.loomItems||[],isCustom:!1,url:"https://lucid.cards/api/lumia-dlc/".concat(a.slug)};await(0,D.jl)(i),n++}catch(e){console.error('[LucidCardsModal] Import failed for "'.concat(a.packName,'":'),e),r++}}const i=[];n>0&&i.push("".concat(n," imported")),t>0&&i.push("".concat(t," skipped (already exist)")),r>0&&i.push("".concat(r," failed")),window.toastr&&(n>0?window.toastr.success("Import complete: ".concat(i.join(", "))):t>0&&0===r?window.toastr.info("All ".concat(t," packs already exist")):window.toastr.error("Import failed: ".concat(i.join(", ")))),p(!1),d([]),v({current:0,total:0})},[u,m]);return(0,nn.jsxs)("div",{style:Uf.layout,children:[(0,nn.jsxs)("div",{style:Uf.header,children:[(0,nn.jsx)("div",{style:Uf.headerIcon,children:(0,nn.jsx)(Of,{size:20,strokeWidth:1.5})}),(0,nn.jsxs)("div",{style:Uf.headerText,children:[(0,nn.jsx)("h3",{style:Uf.title,children:"Lucid Cards Browser"}),(0,nn.jsx)("p",{style:Uf.subtitle,children:"Browse and import official Lumiverse content"})]})]}),(0,nn.jsx)("div",{style:Uf.tabs,children:_f.map(e=>(0,nn.jsxs)("button",{type:"button",style:Rf(Rf({},Uf.tab),t===e.id?Uf.tabActive:{}),onClick:()=>{r(e.id),d([])},children:[(0,nn.jsx)(e.Icon,{size:14}),(0,nn.jsx)("span",{children:e.label})]},e.id))}),(0,nn.jsx)("div",{style:Uf.scrollArea,children:i?(0,nn.jsxs)("div",{style:Uf.loading,children:[(0,nn.jsx)(Vt,{size:24,style:Uf.spinner}),(0,nn.jsx)("span",{children:"Loading content from Lucid.cards..."})]}):o?(0,nn.jsxs)("div",{style:Uf.error,children:[(0,nn.jsx)(Wt,{size:32,style:Uf.errorIcon}),(0,nn.jsx)("span",{style:Uf.errorText,children:o}),(0,nn.jsxs)("button",{type:"button",style:Uf.retryButton,onClick:h,children:[(0,nn.jsx)(Ht,{size:14}),(0,nn.jsx)("span",{children:"Retry"})]})]}):0===f.length?(0,nn.jsx)("div",{style:Uf.empty,children:"No items available in this category."}):(0,nn.jsx)("div",{className:"lumiverse-responsive-card-grid",children:f.map(e=>{const n=k(e),t=[];return e.lumiaCount>0&&t.push("".concat(e.lumiaCount," Lumia")),e.loomCount>0&&t.push("".concat(e.loomCount," Loom")),e.extrasCount>0&&t.push("".concat(e.extrasCount," Extra")),(0,nn.jsxs)("div",{style:Rf(Rf({},Uf.card),n?Uf.cardSelected:{}),onClick:()=>b(e),children:[(0,nn.jsxs)("div",{style:Uf.cardImage,children:[e.coverUrl?(0,nn.jsx)(Df,{src:e.coverUrl,alt:"",style:Uf.cardImg}):(0,nn.jsx)(Of,{size:32,style:Uf.cardPlaceholder}),(0,nn.jsx)("div",{style:Rf(Rf({},Uf.cardCheck),n?Uf.cardCheckVisible:{}),children:(0,nn.jsx)(rm,{size:14})})]}),(0,nn.jsxs)("div",{style:Uf.cardInfo,children:[(0,nn.jsx)("div",{style:Uf.cardTitle,children:e.packName||"Unknown"}),(0,nn.jsx)("div",{style:Uf.cardAuthor,children:e.packAuthor||"Unknown Author"}),t.length>0&&(0,nn.jsx)("div",{style:Uf.cardCounts,children:t.join(", ")})]})]},e.slug)})})}),(0,nn.jsxs)("div",{style:Uf.footer,children:[(0,nn.jsx)("button",{type:"button",style:Rf(Rf({},Uf.button),Uf.buttonSecondary),onClick:n,children:"Close"}),(0,nn.jsxs)("div",{style:Uf.footerRight,children:[u.length>0&&(0,nn.jsxs)(nn.Fragment,{children:[(0,nn.jsxs)("div",{style:Uf.footerLeft,children:[(0,nn.jsx)("button",{type:"button",style:Uf.footerButton,onClick:x,children:"Select All"}),(0,nn.jsx)("button",{type:"button",style:Uf.footerButton,onClick:y,children:"Clear"})]}),(0,nn.jsxs)("span",{style:Uf.selectedCount,children:[u.length," selected"]})]}),u.length>0&&(0,nn.jsx)("button",{type:"button",style:Rf(Rf(Rf({},Uf.button),Uf.buttonPrimary),m?Uf.buttonDisabled:{}),onClick:w,disabled:m,children:m?(0,nn.jsxs)(nn.Fragment,{children:[(0,nn.jsx)(Vt,{size:14,style:Uf.spinner}),(0,nn.jsxs)("span",{children:["Importing ",g.current," of ",g.total,"..."]})]}):(0,nn.jsxs)(nn.Fragment,{children:[(0,nn.jsx)(rt,{size:14}),(0,nn.jsxs)("span",{children:["Import ",1===u.length?"Pack":"".concat(u.length," Packs")]})]})})]})]}),(0,nn.jsx)("style",{children:"\n                @keyframes spin {\n                    from { transform: rotate(0deg); }\n                    to { transform: rotate(360deg); }\n                }\n            "})]})},Wf=Jn("globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);function Hf(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function Vf(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Hf(Object(t),!0).forEach(function(n){qf(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Hf(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function qf(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const $f="lumiverseLoomSummary",Yf={layout:{display:"flex",flexDirection:"column",height:"100%",maxHeight:"100%",minHeight:0},header:{display:"flex",alignItems:"center",gap:"12px",padding:"16px 20px",borderBottom:"1px solid var(--lumiverse-border)",flexShrink:0},headerIcon:{display:"flex",alignItems:"center",justifyContent:"center",width:"40px",height:"40px",borderRadius:"10px",background:"linear-gradient(135deg, rgba(147, 112, 219, 0.2), rgba(147, 112, 219, 0.1))",color:"var(--lumiverse-primary)"},headerText:{flex:1},title:{margin:0,fontSize:"16px",fontWeight:600,color:"var(--lumiverse-text)"},scrollArea:{flex:"1 1 auto",minHeight:0,overflowY:"auto",padding:"16px 20px",display:"flex",flexDirection:"column",gap:"12px"},status:{display:"flex",alignItems:"center",gap:"8px",padding:"10px 12px",borderRadius:"8px",fontSize:"12px"},statusExists:{background:"rgba(76, 175, 80, 0.1)",border:"1px solid rgba(76, 175, 80, 0.3)",color:"#4caf50"},statusEmpty:{background:"rgba(255, 152, 0, 0.1)",border:"1px solid rgba(255, 152, 0, 0.3)",color:"#ff9800"},textarea:{flex:1,minHeight:"200px",padding:"14px",fontSize:"13px",lineHeight:1.6,fontFamily:"inherit",background:"var(--lumiverse-input-bg)",border:"1px solid var(--lumiverse-border)",borderRadius:"10px",color:"var(--lumiverse-text)",resize:"vertical",outline:"none",transition:"border-color 0.2s ease"},footer:{display:"flex",justifyContent:"space-between",gap:"8px",padding:"12px 20px",borderTop:"1px solid var(--lumiverse-border)",flexShrink:0},footerLeft:{display:"flex",gap:"8px"},footerRight:{display:"flex",gap:"8px"},button:{display:"flex",alignItems:"center",gap:"6px",padding:"10px 16px",fontSize:"13px",fontWeight:500,borderRadius:"8px",border:"none",cursor:"pointer",transition:"all 0.2s ease"},buttonSecondary:{background:"var(--lumiverse-surface)",color:"var(--lumiverse-text)",border:"1px solid var(--lumiverse-border)"},buttonDanger:{background:"rgba(244, 67, 54, 0.1)",color:"#f44336",border:"1px solid rgba(244, 67, 54, 0.3)"},buttonDangerDisabled:{opacity:.5,cursor:"not-allowed"},buttonPrimary:{background:"var(--lumiverse-primary)",color:"white"}};function Kf(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function Qf(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Kf(Object(t),!0).forEach(function(n){Gf(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Kf(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Gf(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function Xf(e){let{children:n,onClose:t,modalType:r,size:i="medium",hasCustomHeader:a=!1}=e;const o=(0,Je.useCallback)(e=>{"Escape"===e.key&&t()},[t]);(0,Je.useEffect)(()=>(document.addEventListener("keydown",o),document.body.style.overflow="hidden",()=>{document.removeEventListener("keydown",o),document.body.style.overflow=""}),[o]);const s=e=>{e.stopPropagation()},l="editor"===r,c=at("lumiverse-modal","small"===i&&"lumiverse-modal--small","medium"===i&&"lumiverse-modal--medium","large"===i&&"lumiverse-modal--large","selection"===r&&"lumiverse-modal-selection","settings"===r&&"lumiverse-modal-settings","editor"===r&&"lumiverse-modal-editor","pack-editor"===r&&"lumiverse-modal-pack-editor","pack-selector"===r&&"lumiverse-modal-pack-selector","lumia-editor"===r&&"lumiverse-modal-lumia-editor","loom-editor"===r&&"lumiverse-modal-loom-editor","type-selector"===r&&"lumiverse-modal-type-selector");return(0,nn.jsx)("div",{className:"lumiverse-modal-backdrop",onClick:e=>{e.stopPropagation(),e.target===e.currentTarget&&t()},onMouseDown:s,onMouseUp:s,onPointerDown:l?void 0:s,onPointerUp:l?void 0:s,onTouchStart:s,onTouchEnd:s,children:(0,nn.jsx)("div",{className:c,role:"dialog","aria-modal":"true",onClick:e=>e.stopPropagation(),children:n})})}const Zf={behaviors:{component:Gm,modalType:"selection",size:"large",hasCustomHeader:!0,props:{type:"behaviors",multiSelect:!0,allowDominant:!0}},personalities:{component:Gm,modalType:"selection",size:"large",hasCustomHeader:!0,props:{type:"personalities",multiSelect:!0,allowDominant:!0}},definitions:{component:Gm,modalType:"selection",size:"large",hasCustomHeader:!0,props:{type:"definitions",multiSelect:!1,allowDominant:!1}},packEditor:{component:Ot,modalType:"pack-editor",size:"large",hasCustomHeader:!0,props:{}},importPack:{component:()=>(0,nn.jsx)("div",{className:"lumia-modal-empty",children:"Import Pack Modal (TODO)"}),modalType:"settings",size:"medium",hasCustomHeader:!1,props:{}},loomStyles:{component:op,modalType:"selection",size:"large",hasCustomHeader:!0,props:{type:"loomStyles"}},loomUtilities:{component:op,modalType:"selection",size:"large",hasCustomHeader:!0,props:{type:"loomUtilities"}},loomRetrofits:{component:op,modalType:"selection",size:"large",hasCustomHeader:!0,props:{type:"loomRetrofits"}},packSelector:{component:gp,modalType:"pack-selector",size:"medium",hasCustomHeader:!0,props:{}},lumiaEditor:{component:Sp,modalType:"lumia-editor",size:"large",hasCustomHeader:!0,props:{}},loomEditor:{component:Lp,modalType:"loom-editor",size:"large",hasCustomHeader:!0,props:{}},itemTypeSelector:{component:function(e){let{packName:n,onClose:t}=e;const r=Nn();return(0,nn.jsx)(Ap,{packName:n,onSelectLumia:()=>{r.openModal("lumiaEditor",{packName:n})},onSelectLoom:()=>{r.openModal("loomEditor",{packName:n})},onBack:t})},modalType:"type-selector",size:"medium",hasCustomHeader:!0,props:{}},councilSelect:{component:Gp,modalType:"selection",size:"large",hasCustomHeader:!0,props:{}},presetEditor:{component:function(e){let{onClose:n}=e;const{currentPreset:t,prompts:r,availablePresets:i,toggleStateNames:a,savePrompts:o,selectPreset:s,exportPreset:l,saveToggleState:c,applyToggleState:u,deleteToggleState:d,isLoading:m,error:p}=function(){const[e,n]=(0,Je.useState)(null),[t,r]=(0,Je.useState)([]),[i,a]=(0,Je.useState)([]),[o,s]=(0,Je.useState)([]),[l,c]=(0,Je.useState)(!1),[u,d]=(0,Je.useState)(null),m=(0,Je.useCallback)(async()=>{c(!0);try{const e=Ae.getAvailablePresets();a(e);const t=Ae.getToggleStateNames();s(t);const i=Ae.getCurrentPreset();if(console.log("[usePresetEditor] Loaded preset:",i),i){n(i);const e=i.settings.prompts||[];console.log("[usePresetEditor] Raw prompts length:",e.length);const t=e.map(e=>Yh(Yh({},e),{},{_uiId:e.identifier&&"main"!==e.identifier?e.identifier:crypto.randomUUID()}));r(t)}else d("No active preset found")}catch(e){d(e.message)}finally{c(!1)}},[]),p=(0,Je.useCallback)(async e=>{c(!0);try{await Ae.selectPreset(e)?await m():d("Failed to select preset: ".concat(e))}catch(e){d(e.message)}finally{c(!1)}},[m]),g=(0,Je.useCallback)(()=>{if(!e)return;const n=Ae.exportPreset(e.name);if(n){const t=new Blob([n],{type:"application/json"}),r=URL.createObjectURL(t),i=document.createElement("a");i.href=r,i.download="".concat(e.name,".json"),i.click(),URL.revokeObjectURL(r)}},[e]),v=(0,Je.useCallback)(async n=>{if(e){r(n);try{await Ae.updatePrompts(n)}catch(e){d("Failed to save prompts"),console.error("[usePresetEditor] Failed to persist prompts:",e),m()}}},[e,m]),h=(0,Je.useMemo)(()=>{const e=[];let n=null;return t.forEach((t,r)=>{if(t.name.startsWith("━"))n=Yh(Yh({},t),{},{id:t.identifier||"prompt-".concat(r),originalIndex:r,children:[]}),e.push(n);else{const i=Yh(Yh({},t),{},{id:t.identifier||"prompt-".concat(r),originalIndex:r});n?n.children.push(i):e.push(i)}}),e},[t]),f=(0,Je.useCallback)(async e=>{if(!e||0===t.length)return!1;try{return await Ae.saveToggleState(e,t),s(Ae.getToggleStateNames()),!0}catch(e){return d("Failed to save toggle state: ".concat(e.message)),!1}},[t]),b=(0,Je.useCallback)(async e=>{if(!e||0===t.length)return null;try{const n=await Ae.applyToggleState(e,t);return n.prompts&&(r(n.prompts),await Ae.updatePrompts(n.prompts)),n}catch(e){return d("Failed to apply toggle state: ".concat(e.message)),null}},[t]),x=(0,Je.useCallback)(async e=>{try{return await Ae.deleteToggleState(e),s(Ae.getToggleStateNames()),!0}catch(e){return d("Failed to delete toggle state: ".concat(e.message)),!1}},[]);return(0,Je.useEffect)(()=>{m()},[m]),{currentPreset:e,prompts:t,availablePresets:i,toggleStateNames:o,structuredPrompts:h,isLoading:l,error:u,refresh:m,selectPreset:p,exportPreset:g,savePrompts:v,saveToggleState:f,applyToggleState:b,deleteToggleState:x}}(),[g,v]=(0,Je.useState)(null),[h,f]=(0,Je.useState)(null),[b,x]=(0,Je.useState)(new Set),[y,k]=(0,Je.useState)(null),[w,j]=(0,Je.useState)(!1),[S,C]=(0,Je.useState)(""),[N,P]=(0,Je.useState)(null),E=e=>{const n=new Set(b);n.has(e)?n.delete(e):n.add(e),x(n)},O=(0,Je.useMemo)(()=>{const e=[];let n=!1;for(const t of r){if(t.name.startsWith(Zh)){const r=t.identifier||t._uiId;n=b.has(r),e.push(t)}else n||e.push(t)}return e},[r,b]),M=function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return(0,Je.useMemo)(()=>[...n].filter(e=>null!=e),[...n])}(Mg(Sv,{activationConstraint:{distance:8}}),Mg(xv,{coordinateGetter:Uh})),z=(0,Je.useCallback)(e=>{k(e.active.id)},[]),T=(0,Je.useCallback)(e=>{const{active:n,over:t}=e;if(k(null),t&&n.id!==t.id){const e=r.findIndex(e=>(e.identifier||e._uiId)===n.id),i=r.findIndex(e=>(e.identifier||e._uiId)===t.id);-1!==e&&-1!==i&&o(wh(r,e,i))}},[r,o]),I=(0,Je.useCallback)(()=>{k(null)},[]),L=(0,Je.useMemo)(()=>y?r.find(e=>(e.identifier||e._uiId)===y):null,[y,r]),D=e=>r.findIndex(n=>(n.identifier||n._uiId)===(e.identifier||e._uiId)),A=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const n={identifier:crypto.randomUUID(),name:e?"".concat(Zh," New Category"):"New Prompt",content:"",role:"system",enabled:!0,injection_position:0,injection_depth:4,_uiId:crypto.randomUUID()};o([...r,n])},R=async()=>{if(!S.trim())return void P({type:"error",text:"Please enter a name"});await c(S.trim())&&(P({type:"success",text:'Saved "'.concat(S.trim(),'"')}),C(""),setTimeout(()=>P(null),2e3))};return m&&!t?(0,nn.jsx)("div",{className:"lumiverse-loading",children:"Loading..."}):(0,nn.jsxs)("div",{className:"lumiverse-preset-editor",children:[(0,nn.jsxs)("div",{className:"lumiverse-modal-header",children:[(0,nn.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"10px",flex:1},children:[(0,nn.jsx)("h3",{children:"Preset Editor:"}),(0,nn.jsx)("select",{value:(null==t?void 0:t.name)||"",onChange:e=>s(e.target.value),className:"lumiverse-select",style:{maxWidth:"250px"},children:i.map(e=>(0,nn.jsx)("option",{value:e,children:e},e))})]}),(0,nn.jsx)("button",{className:"lumiverse-close-btn",onClick:n,children:(0,nn.jsx)(Wt,{size:20})})]}),(0,nn.jsxs)("div",{className:"lumiverse-editor-content",children:[(0,nn.jsxs)("div",{className:"lumiverse-toolbar",children:[(0,nn.jsxs)("button",{className:"lumiverse-btn",onClick:()=>A(!1),children:[(0,nn.jsx)(Ur,{size:16})," Add Prompt"]}),(0,nn.jsxs)("button",{className:"lumiverse-btn",onClick:()=>A(!0),children:[(0,nn.jsx)(Ur,{size:16})," Add Category"]}),(0,nn.jsxs)("div",{className:"lumiverse-toggle-states",style:{position:"relative"},children:[(0,nn.jsxs)("button",{className:at("lumiverse-btn",a.length>0&&"lumiverse-btn-accent"),onClick:()=>j(!w),title:"Toggle States - Save/Load prompt enabled states",children:[a.length>0?(0,nn.jsx)(Vh,{size:16}):(0,nn.jsx)(tm,{size:16}),"States ",a.length>0&&"(".concat(a.length,")")]}),w&&(0,nn.jsxs)("div",{className:"lumiverse-toggle-state-menu",children:[(0,nn.jsxs)("div",{className:"lumiverse-toggle-state-save",children:[(0,nn.jsx)("input",{type:"text",placeholder:"Name for current state...",value:S,onChange:e=>C(e.target.value),onKeyDown:e=>"Enter"===e.key&&R()}),(0,nn.jsx)("button",{className:"lumiverse-btn lumiverse-btn-primary",onClick:R,disabled:!S.trim(),children:(0,nn.jsx)(qh,{size:14})})]}),a.length>0&&(0,nn.jsxs)(nn.Fragment,{children:[(0,nn.jsx)("div",{className:"lumiverse-toggle-state-divider",children:"Saved States"}),(0,nn.jsx)("div",{className:"lumiverse-toggle-state-list",children:a.map(e=>(0,nn.jsxs)("div",{className:"lumiverse-toggle-state-item",onClick:()=>(async e=>{const n=await u(e);n&&(P({type:"success",text:'Applied "'.concat(e,'": ').concat(n.matched," matched, ").concat(n.unmatched," unchanged")}),setTimeout(()=>P(null),3e3)),j(!1)})(e),children:[(0,nn.jsx)("span",{children:e}),(0,nn.jsx)("button",{className:"lumiverse-icon-btn lumiverse-btn-danger",onClick:n=>(async(e,n)=>{n.stopPropagation(),confirm('Delete toggle state "'.concat(e,'"?'))&&(await d(e),P({type:"success",text:'Deleted "'.concat(e,'"')}),setTimeout(()=>P(null),2e3))})(e,n),title:"Delete",children:(0,nn.jsx)(tt,{size:14})})]},e))})]}),0===a.length&&(0,nn.jsx)("div",{className:"lumiverse-toggle-state-empty",children:"No saved states yet. Enter a name above to save current toggle configuration."})]})]}),(0,nn.jsx)("div",{style:{flex:1}}),N&&(0,nn.jsx)("div",{className:at("lumiverse-toggle-message","lumiverse-toggle-message-".concat(N.type)),children:N.text}),(0,nn.jsxs)("button",{className:"lumiverse-btn",onClick:l,title:"Export as JSON",children:[(0,nn.jsx)(qh,{size:16})," Export"]})]}),null!==g&&(0,nn.jsxs)("div",{className:"lumiverse-edit-form",children:[(0,nn.jsx)("h4",{children:"Edit Prompt"}),(0,nn.jsxs)("div",{className:"lumiverse-form-group",children:[(0,nn.jsx)("label",{children:"Name"}),(0,nn.jsx)("input",{type:"text",value:h.name,onChange:e=>f(Gh(Gh({},h),{},{name:e.target.value}))})]}),(0,nn.jsxs)("div",{className:"lumiverse-form-group",children:[(0,nn.jsx)("label",{children:"Role"}),(0,nn.jsxs)("select",{value:h.role,onChange:e=>f(Gh(Gh({},h),{},{role:e.target.value})),children:[(0,nn.jsx)("option",{value:"system",children:"System"}),(0,nn.jsx)("option",{value:"user",children:"User"}),(0,nn.jsx)("option",{value:"assistant",children:"Assistant"})]})]}),(0,nn.jsxs)("div",{className:"lumiverse-form-group",children:[(0,nn.jsx)("label",{children:"Content"}),(0,nn.jsx)("textarea",{value:h.content,onChange:e=>f(Gh(Gh({},h),{},{content:e.target.value})),rows:10})]}),(0,nn.jsxs)("div",{style:{display:"flex",gap:"10px"},children:[(0,nn.jsxs)("div",{className:"lumiverse-form-group",style:{flex:1},children:[(0,nn.jsx)("label",{children:"Injection Position"}),(0,nn.jsxs)("select",{value:h.injection_position||0,onChange:e=>f(Gh(Gh({},h),{},{injection_position:parseInt(e.target.value)})),children:[(0,nn.jsx)("option",{value:0,children:"Relative (0)"}),(0,nn.jsx)("option",{value:1,children:"Absolute (1)"})]})]}),(0,nn.jsxs)("div",{className:"lumiverse-form-group",style:{flex:1},children:[(0,nn.jsx)("label",{children:"Injection Depth"}),(0,nn.jsx)("input",{type:"number",value:h.injection_depth||4,onChange:e=>f(Gh(Gh({},h),{},{injection_depth:parseInt(e.target.value)}))})]})]}),(0,nn.jsxs)("div",{className:"lumiverse-form-actions",children:[(0,nn.jsxs)("button",{className:"lumiverse-btn lumiverse-btn-primary",onClick:()=>{const e=[...r];e[g]=h,o(e),v(null),f(null)},children:[(0,nn.jsx)(rm,{size:16})," Save"]}),(0,nn.jsx)("button",{className:"lumiverse-btn",onClick:()=>{v(null),f(null)},children:"Cancel"})]})]}),(0,nn.jsx)("div",{className:"lumiverse-prompt-list",children:0===O.length?(0,nn.jsx)("div",{className:"lumiverse-empty-state",style:{padding:"20px",textAlign:"center",color:"var(--lumiverse-text-muted)"},children:0===r.length?"No prompts found in this preset. Click 'Add Prompt' to start.":"All prompts hidden. Expand categories to view."}):(0,nn.jsxs)(ih,{sensors:M,collisionDetection:_g,onDragStart:z,onDragEnd:T,onDragCancel:I,children:[(0,nn.jsx)(Mh,{items:O.map(e=>e.identifier||e._uiId),strategy:Ph,children:O.map(e=>(0,nn.jsx)(Jh,{prompt:e,index:0,onEdit:()=>(e=>{const n=D(e);v(n),f(Gh({},r[n]))})(e),onDelete:()=>(e=>{if(confirm("Are you sure you want to delete this prompt?")){const n=D(e),t=[...r];t.splice(n,1),o(t)}})(e),onToggleEnabled:()=>(e=>{const n=D(e),t=[...r];t[n].enabled=!t[n].enabled,o(t)})(e),onToggleCollapse:E,isCollapsed:b.has(e.identifier||e._uiId)},e.identifier||e._uiId))}),(0,nn.jsx)(kh,{children:L?(0,nn.jsxs)("div",{className:"lumiverse-prompt-item lumiverse-prompt-dragging",children:[(0,nn.jsx)("div",{className:"lumiverse-prompt-drag-handle",children:(0,nn.jsx)(Wh,{size:16})}),(0,nn.jsx)("div",{className:"lumiverse-prompt-content",children:(0,nn.jsxs)("div",{className:"lumiverse-prompt-header",children:[(0,nn.jsx)("span",{className:"lumiverse-prompt-name",children:L.name.startsWith(Zh)?L.name.substring(1).trim():L.name}),(0,nn.jsx)("div",{className:"lumiverse-prompt-badges",children:(0,nn.jsx)("span",{className:at("lumiverse-badge","lumiverse-badge-".concat(L.role)),children:L.role})})]})})]}):null})]})})]})]})},modalType:"editor",size:"large",hasCustomHeader:!1,props:{}},oocSettings:{component:cf,modalType:"settings",size:"medium",hasCustomHeader:!0,props:{}},summarization:{component:xf,modalType:"settings",size:"large",hasCustomHeader:!0,props:{}},promptSettings:{component:Ef,modalType:"settings",size:"large",hasCustomHeader:!0,props:{}},lucidCards:{component:Ff,modalType:"selection",size:"large",hasCustomHeader:!0,props:{}},loomSummary:{component:function(e){var n;let{onClose:t}=e;const r=(0,Je.useCallback)(()=>{try{var e,n;return null===(e=window.SillyTavern)||void 0===e||null===(n=e.getContext)||void 0===n?void 0:n.call(e)}catch(e){return null}},[]),i=r(),a=(null==i?void 0:i.chat)&&i.chat.length>0,o=(null==i||null===(n=i.chatMetadata)||void 0===n?void 0:n[$f])||"",s=!!o,[l,c]=(0,Je.useState)(o),u=(0,Je.useCallback)(()=>{var e;const n=r();if(!n)return void(window.toastr&&window.toastr.error("No active chat context"));n.chatMetadata||(n.chatMetadata={});const i=l.trim();i?(n.chatMetadata[$f]=i,window.toastr&&window.toastr.success("Loom summary saved!")):(delete n.chatMetadata[$f],window.toastr&&window.toastr.info("Loom summary cleared")),null===(e=n.saveMetadata)||void 0===e||e.call(n),"function"==typeof window.updateLoomSummaryButtonState&&window.updateLoomSummaryButtonState(),t()},[l,r,t]),d=(0,Je.useCallback)(()=>{if(!window.confirm("Are you sure you want to clear the Loom summary for this chat?"))return;const e=r();var n;null!=e&&e.chatMetadata&&(delete e.chatMetadata[$f],null===(n=e.saveMetadata)||void 0===n||n.call(e),window.toastr&&window.toastr.info("Loom summary cleared"),"function"==typeof window.updateLoomSummaryButtonState&&window.updateLoomSummaryButtonState());t()},[r,t]);return a?(0,nn.jsxs)("div",{style:Yf.layout,children:[(0,nn.jsxs)("div",{style:Yf.header,children:[(0,nn.jsx)("div",{style:Yf.headerIcon,children:(0,nn.jsx)(Wf,{size:20,strokeWidth:1.5})}),(0,nn.jsx)("div",{style:Yf.headerText,children:(0,nn.jsx)("h3",{style:Yf.title,children:"Loom Summary"})})]}),(0,nn.jsxs)("div",{style:Yf.scrollArea,children:[(0,nn.jsx)("div",{style:Vf(Vf({},Yf.status),s?Yf.statusExists:Yf.statusEmpty),children:s?(0,nn.jsxs)(nn.Fragment,{children:[(0,nn.jsx)(rm,{size:16}),(0,nn.jsx)("span",{children:"Summary exists for this chat"})]}):(0,nn.jsxs)(nn.Fragment,{children:[(0,nn.jsx)(qt,{size:16}),(0,nn.jsx)("span",{children:"No summary yet - generate one or write your own"})]})}),(0,nn.jsx)("textarea",{style:Yf.textarea,placeholder:"Write or paste your Loom summary here...\n\nUse the structured format:\n**Completed Objectives**\n- ...\n\n**Focused Objectives**\n- ...\n\n**Foreshadowing Beats**\n- ...\n\n(etc.)",value:l,onChange:e=>c(e.target.value),autoFocus:!0})]}),(0,nn.jsxs)("div",{style:Yf.footer,children:[(0,nn.jsx)("div",{style:Yf.footerLeft,children:(0,nn.jsxs)("button",{type:"button",style:Vf(Vf(Vf({},Yf.button),Yf.buttonDanger),s?{}:Yf.buttonDangerDisabled),onClick:d,disabled:!s,children:[(0,nn.jsx)(tt,{size:14}),"Clear"]})}),(0,nn.jsxs)("div",{style:Yf.footerRight,children:[(0,nn.jsx)("button",{type:"button",style:Vf(Vf({},Yf.button),Yf.buttonSecondary),onClick:t,children:"Cancel"}),(0,nn.jsx)("button",{type:"button",style:Vf(Vf({},Yf.button),Yf.buttonPrimary),onClick:u,children:"Save"})]})]})]}):(0,nn.jsxs)("div",{style:Yf.layout,children:[(0,nn.jsxs)("div",{style:Yf.header,children:[(0,nn.jsx)("div",{style:Yf.headerIcon,children:(0,nn.jsx)(Wf,{size:20,strokeWidth:1.5})}),(0,nn.jsx)("div",{style:Yf.headerText,children:(0,nn.jsx)("h3",{style:Yf.title,children:"Loom Summary"})})]}),(0,nn.jsx)("div",{style:Yf.scrollArea,children:(0,nn.jsxs)("div",{style:Vf(Vf({},Yf.status),Yf.statusEmpty),children:[(0,nn.jsx)(qt,{size:16}),(0,nn.jsx)("span",{children:"No active chat to view summary for"})]})}),(0,nn.jsxs)("div",{style:Yf.footer,children:[(0,nn.jsx)("div",{}),(0,nn.jsx)("button",{type:"button",style:Vf(Vf({},Yf.button),Yf.buttonSecondary),onClick:t,children:"Close"})]})]})},modalType:"settings",size:"medium",hasCustomHeader:!0,props:{}}};const Jf=function(){const e=qn(),n=Nn();if(!e.activeModal)return null;const{name:t,props:r}=e.activeModal,i=Zf[t];if(!i)return console.warn("[LumiverseUI] Unknown modal: ".concat(t)),null;const{component:a,modalType:o,size:s,hasCustomHeader:l,props:c}=i;return(0,Dt.createPortal)((0,nn.jsx)(Xf,{modalType:o,size:s,hasCustomHeader:l,onClose:n.closeModal,children:(0,nn.jsx)(a,Qf(Qf(Qf({},c),r),{},{onClose:n.closeModal}))}),document.body)};function eb(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function nb(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?eb(Object(t),!0).forEach(function(n){tb(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):eb(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function tb(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const rb=wn,ib={},ab=()=>{var e;return null===(e=rb.getState().ui)||void 0===e?void 0:e.viewingPack},ob=()=>rb.getState().packs||ib,sb={lumiaCard:{background:"rgba(0, 0, 0, 0.2)",border:"1px solid var(--lumiverse-border, rgba(255, 255, 255, 0.1))",borderRadius:"12px",overflow:"hidden",transition:"border-color 0.15s ease",display:"flex",flexDirection:"column"},lumiaImageContainer:{position:"relative",aspectRatio:"3 / 4",background:"rgba(0, 0, 0, 0.3)",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden"},lumiaImage:{width:"100%",height:"100%",objectFit:"cover"},lumiaPlaceholder:{color:"var(--lumiverse-text-muted, #999)",opacity:.5},lumiaInfo:{padding:"12px"},lumiaName:{margin:0,fontSize:"14px",fontWeight:600,color:"var(--lumiverse-text, #e0e0e0)",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},lumiaAuthor:{fontSize:"12px",color:"var(--lumiverse-text-muted, #999)",marginTop:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},traitBadges:{display:"flex",flexWrap:"wrap",gap:"6px",marginTop:"8px"},traitBadge:{display:"flex",alignItems:"center",gap:"4px",padding:"4px 8px",fontSize:"10px",fontWeight:500,borderRadius:"4px",background:"rgba(147, 112, 219, 0.15)",color:"var(--lumiverse-primary, #9370db)"},actions:{display:"flex",flexWrap:"wrap",gap:"6px",padding:"0 12px 12px"},actionBtn:{display:"flex",alignItems:"center",gap:"4px",padding:"6px 10px",fontSize:"11px",fontWeight:500,borderRadius:"6px",border:"1px solid var(--lumiverse-border, rgba(255, 255, 255, 0.1))",background:"rgba(0, 0, 0, 0.2)",color:"var(--lumiverse-text, #e0e0e0)",cursor:"pointer",transition:"all 0.15s ease"},actionBtnSelected:{background:"rgba(147, 112, 219, 0.2)",borderColor:"var(--lumiverse-primary, #9370db)",color:"var(--lumiverse-primary, #9370db)"},actionBtnEnableAll:{background:"rgba(147, 112, 219, 0.1)",borderColor:"rgba(147, 112, 219, 0.3)"},actionBtnAllEnabled:{background:"rgba(147, 112, 219, 0.25)",borderColor:"var(--lumiverse-primary, #9370db)",color:"var(--lumiverse-primary, #9370db)"}};function lb(e,n){if(!e)return null;const t={name:["lumiaName","lumiaDefName"],def:["lumiaDefinition","lumiaDef"],personality:["lumiaPersonality","lumia_personality"],behavior:["lumiaBehavior","lumia_behavior"],img:["avatarUrl","lumia_img"],author:["authorName","defAuthor"]}[n];if(!t)return null;for(const n of t)if(void 0!==e[n]&&null!==e[n])return e[n];return null}function cb(e){return e.lumiaItems&&Array.isArray(e.lumiaItems)?e.lumiaItems:e.items&&Array.isArray(e.items)?e.items.filter(e=>!e.loomCategory&&!!e.lumiaDefName):[]}function ub(e){let{label:n,Icon:t,isSelected:r,onClick:i,disabled:a}=e;return(0,nn.jsxs)("button",{style:nb(nb({},sb.actionBtn),r?sb.actionBtnSelected:{}),onClick:i,disabled:a,title:r?"Already selected":n,type:"button",children:[r?(0,nn.jsx)(rm,{size:12,strokeWidth:2}):(0,nn.jsx)(Ur,{size:12,strokeWidth:2}),(0,nn.jsx)("span",{children:n})]})}function db(e){let{item:n,packName:t,selections:r,actions:i}=e;const a=lb(n,"name"),o=lb(n,"img"),s=lb(n,"def"),l=lb(n,"behavior"),c=lb(n,"personality"),u=lb(n,"author"),{objectPosition:d}=Yn(o),m=(0,Je.useMemo)(()=>!!r.definition&&(r.definition.packName===t&&r.definition.itemName===a),[r.definition,t,a]),p=(0,Je.useMemo)(()=>(r.behaviors||[]).some(e=>e.packName===t&&e.itemName===a),[r.behaviors,t,a]),g=(0,Je.useMemo)(()=>(r.personalities||[]).some(e=>e.packName===t&&e.itemName===a),[r.personalities,t,a]),v=(0,Je.useCallback)(()=>{m||(i.setSelectedDefinition({packName:t,itemName:a}),yn(),"undefined"!=typeof toastr&&toastr.success('Set "'.concat(a,'" as definition')))},[m,i,t,a]),h=(0,Je.useCallback)(()=>{p||(i.toggleBehavior({packName:t,itemName:a}),yn(),"undefined"!=typeof toastr&&toastr.success('Added "'.concat(a,'" behavior')))},[p,i,t,a]),f=(0,Je.useCallback)(()=>{g||(i.togglePersonality({packName:t,itemName:a}),yn(),"undefined"!=typeof toastr&&toastr.success('Added "'.concat(a,'" personality')))},[g,i,t,a]),b=!!s,x=!!l,y=!!c,k=[b,x,y].filter(Boolean).length>1,w=k&&i.areAllTraitsEnabledForLumia(t,a),j=(0,Je.useCallback)(()=>{const e=i.toggleAllTraitsForLumia(t,a);yn(),"undefined"!=typeof toastr&&(e?toastr.success('Enabled all traits for "'.concat(a,'"')):toastr.info('Disabled all traits for "'.concat(a,'"')))},[i,t,a]);return(0,nn.jsxs)("div",{style:sb.lumiaCard,children:[(0,nn.jsx)("div",{style:sb.lumiaImageContainer,children:o?(0,nn.jsx)(Df,{src:o,alt:a,style:sb.lumiaImage,objectPosition:d}):(0,nn.jsx)(Rr,{size:48,strokeWidth:1.5,style:sb.lumiaPlaceholder})}),(0,nn.jsxs)("div",{style:sb.lumiaInfo,children:[(0,nn.jsx)("h4",{style:sb.lumiaName,children:a}),u&&(0,nn.jsxs)("span",{style:sb.lumiaAuthor,children:["by ",u]}),(0,nn.jsxs)("div",{style:sb.traitBadges,children:[b&&(0,nn.jsxs)("span",{style:sb.traitBadge,children:[(0,nn.jsx)(ef,{size:10})," Def"]}),x&&(0,nn.jsxs)("span",{style:sb.traitBadge,children:[(0,nn.jsx)(Ut,{size:10})," Behav"]}),y&&(0,nn.jsxs)("span",{style:sb.traitBadge,children:[(0,nn.jsx)(Rp,{size:10})," Pers"]})]})]}),(0,nn.jsxs)("div",{style:sb.actions,children:[b&&(0,nn.jsx)(ub,{label:"Set Def",Icon:ef,isSelected:m,onClick:v}),x&&(0,nn.jsx)(ub,{label:"Add Behavior",Icon:Ut,isSelected:p,onClick:h}),y&&(0,nn.jsx)(ub,{label:"Add Personality",Icon:Rp,isSelected:g,onClick:f}),k&&(0,nn.jsx)("button",{style:nb(nb(nb({},sb.actionBtn),sb.actionBtnEnableAll),w?sb.actionBtnAllEnabled:{}),onClick:j,title:w?"Disable all traits for this Lumia":"Enable all traits for this Lumia",type:"button",children:w?"Disable All":"Enable All"})]})]})}const mb=function(){const e=Nn(),n=Wn(),t=(0,Je.useSyncExternalStore)(rb.subscribe,ab,ab),r=(0,Je.useSyncExternalStore)(rb.subscribe,ob,ob),i=(0,Je.useMemo)(()=>t&&r[t]||null,[t,r]),a=(0,Je.useMemo)(()=>{if(!i)return[];return cb(i).filter(e=>lb(e,"def"))},[i]),o=(0,Je.useMemo)(()=>{if(!i)return{lumias:0,behaviors:0,personalities:0};const e=cb(i);return{lumias:e.filter(e=>lb(e,"def")).length,behaviors:e.filter(e=>lb(e,"behavior")).length,personalities:e.filter(e=>lb(e,"personality")).length}},[i]),s=(0,Je.useCallback)(()=>{e.closePackDetail()},[e]);(0,Je.useEffect)(()=>{if(!t||!i)return;const e=e=>{"Escape"===e.key&&s()};return document.addEventListener("keydown",e),document.body.style.overflow="hidden",()=>{document.removeEventListener("keydown",e),document.body.style.overflow=""}},[t,i,s]);const l=(0,Je.useCallback)(e=>{e.stopPropagation()},[]),c=(0,Je.useCallback)(e=>{e.stopPropagation(),e.target===e.currentTarget&&s()},[s]);return t&&i?(0,Dt.createPortal)((0,nn.jsx)("div",{className:"lumiverse-modal-backdrop",onClick:c,onMouseDown:l,onMouseUp:l,onPointerDown:l,onPointerUp:l,onTouchStart:l,onTouchEnd:l,children:(0,nn.jsxs)("div",{className:"lumiverse-modal lumiverse-modal--large",onClick:l,role:"dialog","aria-modal":"true",children:[(0,nn.jsxs)("div",{className:"lumiverse-modal-header lumiverse-pack-detail-header",children:[(0,nn.jsx)("div",{className:"lumiverse-pack-detail-header-icon",children:i.packCover?(0,nn.jsx)("img",{src:i.packCover,alt:t,className:"lumiverse-pack-detail-header-img"}):(0,nn.jsx)(et,{size:24,strokeWidth:1.5})}),(0,nn.jsxs)("div",{className:"lumiverse-pack-detail-header-text",children:[(0,nn.jsx)("h3",{className:"lumiverse-pack-detail-title",children:t}),(0,nn.jsxs)("div",{className:"lumiverse-pack-detail-stats",children:[(0,nn.jsxs)("span",{className:"lumiverse-pack-detail-stat",children:[(0,nn.jsx)(ef,{size:12})," ",o.lumias," Lumia",1!==o.lumias?"s":""]}),(0,nn.jsxs)("span",{className:"lumiverse-pack-detail-stat",children:[(0,nn.jsx)(Ut,{size:12})," ",o.behaviors," Behavior",1!==o.behaviors?"s":""]}),(0,nn.jsxs)("span",{className:"lumiverse-pack-detail-stat",children:[(0,nn.jsx)(Rp,{size:12})," ",o.personalities," Personalit",1!==o.personalities?"ies":"y"]})]})]}),(0,nn.jsx)("button",{className:"lumiverse-modal-close",onClick:s,title:"Close",type:"button",children:(0,nn.jsx)(Wt,{size:20,strokeWidth:2})})]}),(0,nn.jsx)("div",{className:"lumiverse-modal-body lumiverse-pack-detail-content",children:0===a.length?(0,nn.jsxs)("div",{className:"lumiverse-pack-detail-empty",children:[(0,nn.jsx)(et,{size:32,strokeWidth:1.5}),(0,nn.jsx)("p",{children:"No Lumias found in this pack"})]}):(0,nn.jsx)("div",{className:"lumiverse-responsive-card-grid",children:a.map((r,i)=>(0,nn.jsx)(db,{item:r,packName:t,selections:n,actions:e},lb(r,"name")||i))})})]})}),document.body):null};function pb(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function gb(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?pb(Object(t),!0).forEach(function(n){vb(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):pb(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function vb(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const hb=wn,fb={},bb=()=>{var e;return null===(e=hb.getState().ui)||void 0===e?void 0:e.viewingLoomPack},xb=()=>hb.getState().packs||fb,yb={"Narrative Style":{Icon:Cr,color:"rgba(147, 112, 219, 0.15)",colorActive:"rgba(147, 112, 219, 0.25)",border:"rgba(147, 112, 219, 0.3)",borderActive:"rgba(147, 112, 219, 0.6)",storeField:"styles",toggleAction:"toggleLoomStyle"},"Loom Utilities":{Icon:am,color:"rgba(100, 200, 255, 0.15)",colorActive:"rgba(100, 200, 255, 0.25)",border:"rgba(100, 200, 255, 0.3)",borderActive:"rgba(100, 200, 255, 0.6)",storeField:"utilities",toggleAction:"toggleLoomUtility"},Retrofits:{Icon:Er,color:"rgba(255, 180, 100, 0.15)",colorActive:"rgba(255, 180, 100, 0.25)",border:"rgba(255, 180, 100, 0.3)",borderActive:"rgba(255, 180, 100, 0.6)",storeField:"retrofits",toggleAction:"toggleLoomRetrofit"}},kb={categorySection:{marginBottom:"16px"},categoryHeader:{display:"flex",alignItems:"center",gap:"8px",padding:"10px 12px",background:"transparent",border:"1px solid var(--lumiverse-border, rgba(255, 255, 255, 0.1))",borderRadius:"10px",width:"100%",color:"var(--lumiverse-text, #e0e0e0)",fontSize:"13px",fontWeight:500,cursor:"pointer",transition:"background 0.15s ease"},categoryHeaderExpanded:{borderBottomLeftRadius:0,borderBottomRightRadius:0,background:"rgba(0, 0, 0, 0.2)"},categoryIcon:{width:"24px",height:"24px",borderRadius:"6px",background:"rgba(147, 112, 219, 0.15)",display:"flex",alignItems:"center",justifyContent:"center",color:"var(--lumiverse-primary, #9370db)"},categoryTitle:{flex:1,textAlign:"left"},categoryCount:{fontSize:"11px",color:"var(--lumiverse-text-muted, #999)",background:"rgba(0, 0, 0, 0.3)",padding:"2px 8px",borderRadius:"10px"},categoryChevron:{color:"var(--lumiverse-text-muted, #999)",transition:"transform 0.2s ease"},categoryItems:{border:"1px solid var(--lumiverse-border, rgba(255, 255, 255, 0.1))",borderTop:"none",borderBottomLeftRadius:"10px",borderBottomRightRadius:"10px",padding:"8px",display:"flex",flexDirection:"column",gap:"6px"},itemCard:{display:"flex",flexDirection:"column",gap:"8px",padding:"12px",borderRadius:"8px",border:"1px solid",transition:"all 0.15s ease"},itemHeader:{display:"flex",alignItems:"center",gap:"8px"},itemIcon:{width:"20px",height:"20px",borderRadius:"5px",display:"flex",alignItems:"center",justifyContent:"center"},itemName:{flex:1,fontSize:"13px",fontWeight:500,color:"var(--lumiverse-text, #e0e0e0)"},itemToggle:{width:"24px",height:"24px",borderRadius:"6px",border:"1px solid var(--lumiverse-border, rgba(255, 255, 255, 0.15))",background:"rgba(0, 0, 0, 0.2)",color:"var(--lumiverse-text-muted, #999)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.15s ease"},itemToggleSelected:{background:"var(--lumiverse-primary, #9370db)",borderColor:"var(--lumiverse-primary, #9370db)",color:"#fff"},contentToggle:{display:"flex",alignItems:"center",gap:"6px",padding:"6px 10px",background:"rgba(0, 0, 0, 0.2)",border:"none",borderRadius:"6px",width:"fit-content",color:"var(--lumiverse-text-muted, #999)",fontSize:"11px",cursor:"pointer",transition:"background 0.15s ease"},contentText:{fontSize:"12px",lineHeight:1.6,color:"var(--lumiverse-text-muted, #999)",padding:"8px 10px",background:"rgba(0, 0, 0, 0.15)",borderRadius:"6px",margin:0}};function wb(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;return!e||e.length<=n?e:e.slice(0,n)+"..."}function jb(e){let{content:n,defaultOpen:t=!1}=e;const[r,i]=(0,Je.useState)(t);return n?(0,nn.jsxs)(nn.Fragment,{children:[(0,nn.jsxs)("button",{style:kb.contentToggle,onClick:()=>i(!r),type:"button",children:[(0,nn.jsx)("span",{children:"Preview"}),(0,nn.jsx)("span",{children:r?(0,nn.jsx)(Rm,{size:10}):(0,nn.jsx)(ot,{size:10})})]}),r&&(0,nn.jsx)("p",{style:kb.contentText,children:wb(n,500)})]}):null}function Sb(e){let{item:n,packName:t,category:r,isSelected:i,onToggle:a}=e;const o=yb[r]||yb["Narrative Style"],{Icon:s,color:l,colorActive:c,border:u,borderActive:d}=o,m=n.loomName||n.itemName||n.name||"Unknown";return(0,nn.jsxs)("div",{style:gb(gb({},kb.itemCard),{},{background:i?c:l,borderColor:i?d:u}),children:[(0,nn.jsxs)("div",{style:kb.itemHeader,children:[(0,nn.jsx)("span",{style:gb(gb({},kb.itemIcon),{},{background:i?c:l}),children:(0,nn.jsx)(s,{size:12,strokeWidth:1.5})}),(0,nn.jsx)("span",{style:kb.itemName,children:m}),(0,nn.jsx)("button",{style:gb(gb({},kb.itemToggle),i?kb.itemToggleSelected:{}),onClick:()=>a(t,m),title:i?"Remove from selection":"Add to selection",type:"button",children:i?(0,nn.jsx)(rm,{size:12,strokeWidth:2}):(0,nn.jsx)(Ur,{size:12,strokeWidth:2})})]}),(0,nn.jsx)(jb,{content:n.loomContent||n.content})]})}function Cb(e){let{category:n,items:t,packName:r,selections:i,actions:a}=e;const[o,s]=(0,Je.useState)(!0),l=yb[n],{Icon:c,storeField:u,toggleAction:d}=l,m=(0,Je.useCallback)(e=>(i[u]||[]).some(n=>n.packName===r&&n.itemName===e),[i,u,r]),p=(0,Je.useCallback)((e,n)=>{if(a[d]&&(a[d]({packName:e,itemName:n}),yn(),"undefined"!=typeof toastr)){const e=m(n);toastr.success(e?'Removed "'.concat(n,'"'):'Added "'.concat(n,'"'))}},[a,d,m]);return t&&0!==t.length?(0,nn.jsxs)("div",{style:kb.categorySection,children:[(0,nn.jsxs)("button",{style:gb(gb({},kb.categoryHeader),o?kb.categoryHeaderExpanded:{}),onClick:()=>s(!o),type:"button",children:[(0,nn.jsx)("span",{style:kb.categoryIcon,children:(0,nn.jsx)(c,{size:14,strokeWidth:1.5})}),(0,nn.jsx)("span",{style:kb.categoryTitle,children:n}),(0,nn.jsx)("span",{style:kb.categoryCount,children:t.length}),(0,nn.jsx)("span",{style:kb.categoryChevron,children:o?(0,nn.jsx)(Rm,{size:14}):(0,nn.jsx)(ot,{size:14})})]}),o&&(0,nn.jsx)("div",{style:kb.categoryItems,children:t.map((e,t)=>{const i=e.loomName||e.itemName||e.name;return(0,nn.jsx)(Sb,{item:e,packName:r,category:n,isSelected:m(i),onToggle:p},i||t)})})]}):null}const Nb=function(){const e=Nn(),n=Hn(),t=(0,Je.useSyncExternalStore)(hb.subscribe,bb,bb),r=(0,Je.useSyncExternalStore)(hb.subscribe,xb,xb),i=(0,Je.useMemo)(()=>t&&r[t]||null,[t,r]),a=(0,Je.useMemo)(()=>i?function(e){const n={"Narrative Style":[],"Loom Utilities":[],Retrofits:[]},t=e=>{const t=e.loomCategory||e.category;"Narrative Style"===t||"loomStyles"===t?n["Narrative Style"].push(e):"Loom Utilities"===t||"loomUtils"===t?n["Loom Utilities"].push(e):"Retrofits"!==t&&"loomRetrofits"!==t||n.Retrofits.push(e)};return e.loomItems&&Array.isArray(e.loomItems)&&e.loomItems.forEach(t),e.loomStyles&&Array.isArray(e.loomStyles)&&n["Narrative Style"].push(...e.loomStyles),e.loomUtils&&Array.isArray(e.loomUtils)&&n["Loom Utilities"].push(...e.loomUtils),e.loomRetrofits&&Array.isArray(e.loomRetrofits)&&n.Retrofits.push(...e.loomRetrofits),e.items&&Array.isArray(e.items)&&e.items.forEach(e=>{(e.loomCategory||e.category)&&t(e)}),n}(i):null,[i]),o=(0,Je.useMemo)(()=>a?{styles:a["Narrative Style"].length,utilities:a["Loom Utilities"].length,retrofits:a.Retrofits.length}:{styles:0,utilities:0,retrofits:0},[a]),s=o.styles+o.utilities+o.retrofits,l=(0,Je.useCallback)(()=>{e.closeLoomPackDetail()},[e]);(0,Je.useEffect)(()=>{if(!t||!i)return;const e=e=>{"Escape"===e.key&&l()};return document.addEventListener("keydown",e),document.body.style.overflow="hidden",()=>{document.removeEventListener("keydown",e),document.body.style.overflow=""}},[t,i,l]);const c=(0,Je.useCallback)(e=>{e.stopPropagation()},[]),u=(0,Je.useCallback)(e=>{e.stopPropagation(),e.target===e.currentTarget&&l()},[l]);return t&&i?(0,Dt.createPortal)((0,nn.jsx)("div",{className:"lumiverse-modal-backdrop",onClick:u,onMouseDown:c,onMouseUp:c,onPointerDown:c,onPointerUp:c,onTouchStart:c,onTouchEnd:c,children:(0,nn.jsxs)("div",{className:"lumiverse-modal lumiverse-modal--medium",onClick:c,role:"dialog","aria-modal":"true",children:[(0,nn.jsxs)("div",{className:"lumiverse-modal-header lumiverse-pack-detail-header",children:[(0,nn.jsx)("div",{className:"lumiverse-pack-detail-header-icon",children:i.packCover?(0,nn.jsx)("img",{src:i.packCover,alt:t,className:"lumiverse-pack-detail-header-img"}):(0,nn.jsx)(Er,{size:24,strokeWidth:1.5})}),(0,nn.jsxs)("div",{className:"lumiverse-pack-detail-header-text",children:[(0,nn.jsx)("h3",{className:"lumiverse-pack-detail-title",children:t}),(0,nn.jsxs)("div",{className:"lumiverse-pack-detail-stats",children:[(0,nn.jsxs)("span",{className:"lumiverse-pack-detail-stat",children:[(0,nn.jsx)(Cr,{size:12})," ",o.styles," Style",1!==o.styles?"s":""]}),(0,nn.jsxs)("span",{className:"lumiverse-pack-detail-stat",children:[(0,nn.jsx)(am,{size:12})," ",o.utilities," Utilit",1!==o.utilities?"ies":"y"]}),(0,nn.jsxs)("span",{className:"lumiverse-pack-detail-stat",children:[(0,nn.jsx)(Er,{size:12})," ",o.retrofits," Retrofit",1!==o.retrofits?"s":""]})]})]}),(0,nn.jsx)("button",{className:"lumiverse-modal-close",onClick:l,title:"Close",type:"button",children:(0,nn.jsx)(Wt,{size:20,strokeWidth:2})})]}),(0,nn.jsx)("div",{className:"lumiverse-modal-body lumiverse-pack-detail-content",children:0===s?(0,nn.jsxs)("div",{className:"lumiverse-pack-detail-empty",children:[(0,nn.jsx)(Er,{size:32,strokeWidth:1.5}),(0,nn.jsx)("p",{children:"No Loom items found in this pack"})]}):(0,nn.jsxs)(nn.Fragment,{children:[(0,nn.jsx)(Cb,{category:"Narrative Style",items:a["Narrative Style"],packName:t,selections:n,actions:e}),(0,nn.jsx)(Cb,{category:"Loom Utilities",items:a["Loom Utilities"],packName:t,selections:n,actions:e}),(0,nn.jsx)(Cb,{category:"Retrofits",items:a.Retrofits,packName:t,selections:n,actions:e})]})})]})}),document.body):null},Pb=Jn("external-link",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);function Eb(e){let{variant:n="full",onDismiss:t}=e;const{extensionUpdate:r,presetUpdates:i,hasAnyUpdate:a,hasExtensionUpdate:o}=$n(),s=Cn(e=>e.ui.isUpdatingExtension),l=Nn(),[c,u]=(0,Je.useState)(null);if(!a)return null;const d=(null==i?void 0:i.length)||0;return"compact"===n?(0,nn.jsx)("div",{className:"lumiverse-update-indicator",children:(0,nn.jsx)(At,{size:12,strokeWidth:2.5})}):"badge"===n?(0,nn.jsx)("span",{className:"lumiverse-update-badge",children:"New!"}):(0,nn.jsx)("div",{className:at("lumiverse-update-banner",o&&"has-extension-update"),children:(0,nn.jsxs)("div",{className:"lumiverse-update-banner-content",children:[(0,nn.jsx)("div",{className:"lumiverse-update-banner-icon",children:(0,nn.jsx)(At,{size:20,strokeWidth:2})}),(0,nn.jsxs)("div",{className:"lumiverse-update-banner-text",children:[o&&(0,nn.jsxs)("div",{className:"lumiverse-update-banner-main",children:[(0,nn.jsxs)("strong",{children:["Lumiverse Helper ",r.latestVersion]})," available",c?(0,nn.jsxs)("span",{className:at("lumiverse-update-result",c.success?"success":"error"),style:{display:"inline-flex",alignItems:"center",gap:"4px",marginLeft:"8px",fontSize:"0.9em",fontWeight:"normal"},children:[c.success?(0,nn.jsx)(rm,{size:12}):(0,nn.jsx)(qt,{size:12}),c.success?"Updated!":c.message,c.success&&(0,nn.jsxs)("button",{className:"lumiverse-update-banner-link",onClick:()=>{window.location.reload()},style:{background:"none",border:"none",padding:0,font:"inherit",cursor:"pointer",display:"inline-flex",alignItems:"center",gap:"4px",textDecoration:"underline",marginLeft:"4px"},children:["Reload now ",(0,nn.jsx)(Ht,{size:12})]})]}):(0,nn.jsxs)("button",{className:"lumiverse-update-banner-link",onClick:async()=>{if(s)return;const e=await l.updateExtension();u(e),e.success&&setTimeout(()=>{l.setExtensionUpdate(null)},5e3)},disabled:s,style:{background:"none",border:"none",padding:0,font:"inherit",cursor:s?"wait":"pointer",display:"inline-flex",alignItems:"center",gap:"4px",textDecoration:"underline"},children:[s?"Updating...":"Update now",s?(0,nn.jsx)(Vt,{size:12,className:"animate-spin"}):(0,nn.jsx)(Pb,{size:12})]})]}),d>0&&(0,nn.jsxs)("div",{className:"lumiverse-update-banner-presets",children:[d," preset",1!==d?"s":""," ",1!==d?"have":"has"," updates: ",i.slice(0,3).map(e=>e.name).join(", "),d>3?", +".concat(d-3," more"):""]})]}),t&&(0,nn.jsx)("button",{className:"lumiverse-update-banner-dismiss",onClick:t,title:"Dismiss",children:(0,nn.jsx)(Wt,{size:16})})]})})}function Ob(){const{hasAnyUpdate:e}=$n();return e?(0,nn.jsx)("span",{className:"lumiverse-update-dot"}):null}const Mb="update-service";let zb=null,Tb=null,Ib=0;const Lb=new Set;function Db(){const e={extensionUpdate:Tb,presetUpdates:[]};Lb.forEach(n=>{try{n(e)}catch(e){console.error("[".concat(Mb,"] Update listener error:"),e)}})}function Ab(e){if(!e||"string"!=typeof e)return{major:0,minor:0,patch:0};const n=e.replace(/^v/,"").split(".").map(Number);return{major:n[0]||0,minor:n[1]||0,patch:n[2]||0}}async function Rb(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const n=Date.now();if(!e&&Tb&&n-Ib<18e5)return Tb;const t=function(){if(zb)return zb;try{if("undefined"!=typeof SillyTavern&&SillyTavern.getContext){var e;const n=SillyTavern.getContext();if(null!==(e=n.extensionSettings)&&void 0!==e&&null!==(e=e["lumiverse-helper"])&&void 0!==e&&e.version)return zb=n.extensionSettings["lumiverse-helper"].version,zb}}catch(e){}return zb="4.0.1",zb}(),r=await async function(){try{const e=await fetch("https://raw.githubusercontent.com/prolix-oc/SillyTavern-LumiverseHelper/main/manifest.json",{cache:"no-store",headers:{Accept:"application/json"}});if(!e.ok)return console.warn("[".concat(Mb,"] Failed to fetch remote manifest: ").concat(e.status)),null;const n=await e.json();return{version:n.version,display_name:n.display_name||"Lumiverse Helper"}}catch(e){return console.warn("[".concat(Mb,"] Error fetching remote manifest:"),e),null}}();if(!r)return null;const i=r.version,a=function(e,n){const t=Ab(e),r=Ab(n);return t.major!==r.major?t.major<r.major?-1:1:t.minor!==r.minor?t.minor<r.minor?-1:1:t.patch!==r.patch?t.patch<r.patch?-1:1:0}(t,i)<0;return Tb={hasUpdate:a,currentVersion:t,latestVersion:i},Ib=n,Db(),console.log("[".concat(Mb,"] Extension update check: current=").concat(t,", latest=").concat(i,", hasUpdate=").concat(a)),Tb}function Bb(){const e=Nn(),n=(0,Je.useRef)(null),t=(0,Je.useRef)(!1),r=(0,Je.useCallback)(async()=>{try{const n=await Rb();n&&e.setExtensionUpdate(n);const t=await cr();e.setPresetUpdates(t);!function(e,n,t){var r;if("undefined"!=typeof window&&null!==(r=window.LumiverseUI)&&void 0!==r&&r.updateAccordionBadge){let r="New!";t&&n>0?r="Updates!":n>1&&(r="".concat(n," updates")),window.LumiverseUI.updateAccordionBadge(e,r)}}((null==n?void 0:n.hasUpdate)||(null==t?void 0:t.length)>0,(null==t?void 0:t.length)||0,null==n?void 0:n.hasUpdate),console.log("[useUpdateChecker] Update check complete:",{extensionUpdate:null==n?void 0:n.hasUpdate,presetUpdates:(null==t?void 0:t.length)||0})}catch(e){console.warn("[useUpdateChecker] Update check failed:",e)}},[e]);return(0,Je.useEffect)(()=>{if(t.current)return;t.current=!0;const i=setTimeout(()=>{r()},5e3);n.current=setInterval(()=>{r()},18e5);const a=(o=n=>{n.extensionUpdate&&e.setExtensionUpdate(n.extensionUpdate)},Lb.add(o),()=>Lb.delete(o));var o;return()=>{clearTimeout(i),n.current&&clearInterval(n.current),a()}},[r,e]),{refresh:r}}const _b=function(){Fn();const e=Nn(),n=qn(),{extensionUpdate:t}=$n();Bb();const r=(0,Je.useCallback)(()=>{null!=t&&t.latestVersion&&e.dismissExtensionUpdate(t.latestVersion)},[e,null==t?void 0:t.latestVersion]);return(0,nn.jsxs)("div",{className:"lumiverse-app",children:[(0,nn.jsx)(Eb,{variant:"full",onDismiss:r}),(0,nn.jsx)(zm,{}),(0,nn.jsx)(Jf,{}),(0,nn.jsx)(mb,{}),(0,nn.jsx)(Nb,{}),n.isLoading&&(0,nn.jsx)("div",{className:"lumiverse-loading-overlay",children:(0,nn.jsx)("div",{className:"lumiverse-spinner"})}),n.error&&(0,nn.jsxs)("div",{className:"lumiverse-error-toast",onClick:e.clearError,children:[(0,nn.jsx)("span",{children:n.error}),(0,nn.jsx)("button",{className:"lumiverse-error-dismiss",children:"Dismiss"})]})]})},Ub=Jn("sliders-vertical",[["path",{d:"M10 8h4",key:"1sr2af"}],["path",{d:"M12 21v-9",key:"17s77i"}],["path",{d:"M12 8V3",key:"13r4qs"}],["path",{d:"M17 16h4",key:"h1uq16"}],["path",{d:"M19 12V3",key:"o1uvq1"}],["path",{d:"M19 21v-5",key:"qua636"}],["path",{d:"M3 14h4",key:"bcjad9"}],["path",{d:"M5 10V3",key:"cb8scm"}],["path",{d:"M5 21v-7",key:"1w1uti"}]]),Fb=wn,Wb={useDefault:!0,xPercent:1,yPercent:1},Hb=()=>{var e;return null!==(e=Fb.getState().lumiaButtonPosition)&&void 0!==e?e:Wb};function Vb(e){let{isVisible:n,onClick:t,hasUpdates:r}=e;return(0,nn.jsxs)("button",{className:at("lumiverse-panel-toggle",n&&"lumiverse-panel-toggle--active",r&&"lumiverse-panel-toggle--has-updates"),onClick:t,title:n?"Hide Lumiverse Panel":"Show Lumiverse Panel",type:"button",children:[(0,nn.jsx)("span",{className:"lumiverse-panel-toggle-icon",children:(0,nn.jsx)(Cr,{size:18,strokeWidth:2})}),(0,nn.jsx)("span",{className:"lumiverse-panel-toggle-label",children:"Lumia"}),(0,nn.jsx)(Ob,{})]})}function qb(e){let{id:n,Icon:t,label:r,isActive:i,onClick:a}=e;return(0,nn.jsxs)("button",{className:at("lumiverse-vp-tab",i&&"lumiverse-vp-tab--active"),onClick:()=>a(n),title:r,type:"button",children:[(0,nn.jsx)("span",{className:"lumiverse-vp-tab-icon",children:(0,nn.jsx)(t,{size:20,strokeWidth:1.5})}),(0,nn.jsx)("span",{className:"lumiverse-vp-tab-label",children:r})]})}function $b(e){let{isCollapsed:n,onClick:t}=e;return(0,nn.jsx)("button",{className:"lumiverse-vp-collapse-btn",onClick:t,title:n?"Expand panel":"Collapse panel",type:"button",children:(0,nn.jsx)("span",{className:at("lumiverse-vp-collapse-icon",n&&"lumiverse-vp-collapse-icon--rotated"),children:(0,nn.jsx)(st,{size:18,strokeWidth:2})})})}function Yb(e){let{title:n,Icon:t,onClose:r}=e;return(0,nn.jsxs)("div",{className:"lumiverse-vp-header",children:[(0,nn.jsx)("span",{className:"lumiverse-vp-header-icon",children:(0,nn.jsx)(t,{size:18,strokeWidth:1.5})}),(0,nn.jsx)("span",{className:"lumiverse-vp-header-title",children:n}),(0,nn.jsx)("button",{className:"lumiverse-vp-close-btn",onClick:r,title:"Close panel",type:"button",children:(0,nn.jsx)(Wt,{size:16,strokeWidth:2})})]})}const Kb=[{id:"profile",Icon:Rr,label:"Profile",title:"Character Lumia Profile"},{id:"presets",Icon:tm,label:"Presets",title:"Lumia Presets"},{id:"browser",Icon:et,label:"Packs",title:"Pack Browser"},{id:"ooc",Icon:_r,label:"OOC",title:"OOC Settings"},{id:"prompt",Icon:Ub,label:"Prompt",title:"Prompt Settings"},{id:"council",Icon:nm,label:"Council",title:"Council of Lumiae"},{id:"summary",Icon:ef,label:"Summary",title:"Summary Editor"}];function Qb(e){let{tab:n}=e;const t={profile:{Icon:Rr,title:"Character Lumia Profile",description:"View and manage Lumia traits for the current character"},presets:{Icon:tm,title:"Lumia Presets",description:"Save and load preset configurations for quick switching"},browser:{Icon:et,title:"Pack Browser",description:"Browse and search through all loaded packs with previews"},ooc:{Icon:_r,title:"OOC Settings",description:"Configure out-of-character comment behavior and triggers"},prompt:{Icon:Ub,title:"Prompt Settings",description:"Configure prompt injection and formatting options"},council:{Icon:nm,title:"Council of Lumiae",description:"Manage multiple independent Lumias that collaborate as a council"},summary:{Icon:ef,title:"Summary Editor",description:"View and edit the current conversation summary"}}[n]||{},{Icon:r}=t;return(0,nn.jsxs)("div",{className:"lumiverse-vp-placeholder",children:[r&&(0,nn.jsx)("span",{className:"lumiverse-vp-placeholder-icon",children:(0,nn.jsx)(r,{size:32,strokeWidth:1.5})}),(0,nn.jsx)("h3",{children:t.title}),(0,nn.jsx)("p",{children:t.description}),(0,nn.jsx)("span",{className:"lumiverse-vp-placeholder-badge",children:"Coming Soon"})]})}const Gb=function(e){let{isVisible:n,onToggle:t,onClose:r,defaultTab:i="profile",ProfileContent:a,PresetsContent:o,BrowserContent:s,OOCContent:l,PromptContent:c,CouncilContent:u,SummaryContent:d}=e;const[m,p]=(0,Je.useState)(i),[g,v]=(0,Je.useState)(!1),h=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:600;const[n,t]=(0,Je.useState)("undefined"!=typeof window&&window.innerWidth<=e);return(0,Je.useEffect)(()=>{const n=()=>{const n=window.innerWidth<=e;t(e=>e!==n?n:e)};return window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[e]),n}(),{hasAnyUpdate:f}=$n(),b=(0,Je.useSyncExternalStore)(Fb.subscribe,Hb,Hb),x=!b.useDefault,y=h?window.innerWidth:376,k=h?window.innerWidth-56:320,w=(0,Je.useCallback)(e=>{g&&v(!1),p(e)},[g]),j=(0,Je.useCallback)(()=>{v(e=>!e)},[]),S=Kb.find(e=>e.id===m),C=(0,Je.useMemo)(()=>({profile:a?(0,nn.jsx)(a,{onTabChange:w}):(0,nn.jsx)(Qb,{tab:"profile"}),presets:o?(0,nn.jsx)(o,{}):(0,nn.jsx)(Qb,{tab:"presets"}),browser:s?(0,nn.jsx)(s,{}):(0,nn.jsx)(Qb,{tab:"browser"}),ooc:l?(0,nn.jsx)(l,{}):(0,nn.jsx)(Qb,{tab:"ooc"}),prompt:c?(0,nn.jsx)(c,{}):(0,nn.jsx)(Qb,{tab:"prompt"}),council:u?(0,nn.jsx)(u,{}):(0,nn.jsx)(Qb,{tab:"council"}),summary:d?(0,nn.jsx)(d,{}):(0,nn.jsx)(Qb,{tab:"summary"})}),[a,o,s,l,c,u,d,w]);return(0,nn.jsxs)(nn.Fragment,{children:[(0,nn.jsx)("div",{className:at("lumiverse-toggle-container",x&&"lumiverse-toggle-container--custom"),style:x?{position:"fixed",top:0,right:"".concat(b.xPercent,"%"),marginTop:"".concat(b.yPercent,"vh"),marginRight:0,zIndex:9997,pointerEvents:"auto",display:h&&n?"none":"block"}:{position:"fixed",top:12,right:n?g?68:y+12:12,zIndex:9997,pointerEvents:"auto",transition:"right 0.25s cubic-bezier(0.4, 0, 0.2, 1)",display:h&&n?"none":"block"},children:(0,nn.jsx)(Vb,{isVisible:n,onClick:t,hasUpdates:f})}),(0,nn.jsx)("div",{className:"lumiverse-viewport-wrapper",style:{position:"fixed",top:0,right:0,bottom:0,width:y,zIndex:9998,transform:"translateX(".concat(n?0:y,"px)"),transition:"transform 0.25s cubic-bezier(0.4, 0, 0.2, 1)",pointerEvents:"none"},children:(0,nn.jsxs)("div",{className:at("lumiverse-viewport-panel",g&&"lumiverse-viewport-panel--collapsed"),style:{transform:g?"translateX(".concat(k,"px)"):"translateX(0)",transition:"transform 0.2s ease",pointerEvents:"auto"},children:[(0,nn.jsxs)("div",{className:"lumiverse-vp-tabs",children:[Kb.map(e=>(0,nn.jsx)(qb,{id:e.id,Icon:e.Icon,label:e.label,isActive:m===e.id,onClick:w},e.id)),(0,nn.jsx)("div",{className:"lumiverse-vp-tabs-spacer"}),(0,nn.jsx)($b,{isCollapsed:g,onClick:j})]}),(0,nn.jsxs)("div",{className:"lumiverse-vp-main",style:{width:k,opacity:g?0:1,transition:"opacity 0.2s ease"},children:[(0,nn.jsx)(Yb,{title:(null==S?void 0:S.title)||"Panel",Icon:(null==S?void 0:S.Icon)||Rr,onClose:r}),(0,nn.jsx)(Eb,{variant:"full"}),(0,nn.jsx)("div",{className:"lumiverse-vp-content",children:Kb.map(e=>(0,nn.jsx)("div",{className:at("lumiverse-vp-tab-content",m===e.id&&"lumiverse-vp-tab-content--active"),"aria-hidden":m!==e.id,children:C[e.id]},e.id))})]})]})})]})},Xb=wn,Zb=[],Jb=()=>Xb.getState().chatChangeCounter||0,ex=()=>Xb.getState().chimeraMode||!1,nx=()=>Xb.getState().selectedDefinitions||Zb,tx=()=>Xb.getState().councilMode||!1,rx=()=>Xb.getState().councilMembers||Zb,ix=()=>Xb.getState().activePresetName||"";function ax(e){return(null==e?void 0:e.id)||(null==e?void 0:e.itemName)||(null==e?void 0:e.lumiaDefName)||null}function ox(e,n){if(!e||!n)return!1;const t=ax(e),r=ax(n);return t&&r&&t===r}const sx=(0,Je.forwardRef)(function(e,n){let{trait:t,type:r,isDominant:i,onRemove:a}=e;const o={definition:{bg:"rgba(100, 200, 255, 0.15)",border:"rgba(100, 200, 255, 0.3)",Icon:ef},behavior:{bg:"rgba(255, 180, 100, 0.15)",border:"rgba(255, 180, 100, 0.3)",Icon:Ut},personality:{bg:"rgba(200, 100, 255, 0.15)",border:"rgba(200, 100, 255, 0.3)",Icon:Rp}},s=o[r]||o.definition,{Icon:l}=s;return(0,nn.jsxs)(em.div,{ref:n,className:at("lumiverse-trait-card",i&&"lumiverse-trait-card--dominant"),style:{background:s.bg,borderColor:s.border},initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.1},children:[(0,nn.jsx)("span",{className:"lumiverse-trait-icon",children:(0,nn.jsx)(l,{size:16,strokeWidth:1.5})}),(0,nn.jsxs)("div",{className:"lumiverse-trait-info",children:[(0,nn.jsx)("span",{className:"lumiverse-trait-name",children:t.name||t.itemName||t.lumiaDefName||"Unknown"}),i&&(0,nn.jsxs)("span",{className:"lumiverse-trait-dominant-badge",children:[(0,nn.jsx)(Im,{size:12,strokeWidth:2})," Dominant"]})]}),a&&(0,nn.jsx)("button",{className:"lumiverse-trait-remove",onClick:()=>a(t),title:"Remove trait",type:"button",children:(0,nn.jsx)(Wt,{size:14,strokeWidth:2})})]})});function lx(e){let{Icon:n,title:t,count:r}=e;return(0,nn.jsxs)("div",{className:"lumiverse-profile-section-header",children:[(0,nn.jsx)("span",{className:"lumiverse-profile-section-icon",children:(0,nn.jsx)(n,{size:16,strokeWidth:1.5})}),(0,nn.jsx)("span",{className:"lumiverse-profile-section-title",children:t}),void 0!==r&&(0,nn.jsx)("span",{className:"lumiverse-profile-section-count",children:r})]})}function cx(e){let{message:n}=e;return(0,nn.jsx)("div",{className:"lumiverse-profile-empty",children:(0,nn.jsx)("span",{children:n})})}function ux(e){let{councilMembers:n,allPacks:t,onManageCouncil:r}=e;const i=n.length,a=n.reduce((e,n)=>{var t;return e+((null===(t=n.behaviors)||void 0===t?void 0:t.length)||0)},0),o=n.reduce((e,n)=>{var t;return e+((null===(t=n.personalities)||void 0===t?void 0:t.length)||0)},0),s=n.slice(0,4),l=i-4;return(0,nn.jsxs)("div",{className:"lumiverse-council-banner",children:[(0,nn.jsx)("div",{className:"lumiverse-council-banner-icon",children:(0,nn.jsx)(nm,{size:28,strokeWidth:1.5})}),(0,nn.jsxs)("div",{className:"lumiverse-council-banner-content",children:[(0,nn.jsx)("h4",{className:"lumiverse-council-banner-title",children:"Council of Lumiae Active"}),(0,nn.jsxs)("div",{className:"lumiverse-council-banner-stats",children:[(0,nn.jsxs)("span",{className:"lumiverse-council-banner-stat",children:[(0,nn.jsx)(nm,{size:14})," ",i," member",1!==i?"s":""]}),(0,nn.jsxs)("span",{className:"lumiverse-council-banner-stat",children:[(0,nn.jsx)(Ut,{size:14})," ",a," behavior",1!==a?"s":""]}),(0,nn.jsxs)("span",{className:"lumiverse-council-banner-stat",children:[(0,nn.jsx)(Rp,{size:14})," ",o," personalit",1!==o?"ies":"y"]})]}),s.length>0&&(0,nn.jsxs)("div",{className:"lumiverse-council-banner-avatars",children:[s.map((e,n)=>{const r=function(e,n,t){var r;const i=(Array.isArray(e)?e:Object.values(e||{})).find(e=>(e.name||e.packName)===n);if(!i)return null;if(i.lumiaItems&&i.lumiaItems.length>0){const e=i.lumiaItems.find(e=>e.lumiaName===t||e.lumiaDefName===t);return(null==e?void 0:e.avatarUrl)||(null==e?void 0:e.lumia_img)||null}const a=null===(r=i.items)||void 0===r?void 0:r.find(e=>e.lumiaDefName===t);return(null==a?void 0:a.lumia_img)||null}(t,e.packName,e.itemName);return(0,nn.jsx)("div",{className:"lumiverse-council-banner-avatar",style:{zIndex:s.length-n},title:e.itemName,children:r?(0,nn.jsx)("img",{src:r,alt:e.itemName}):(0,nn.jsx)(nm,{size:14})},e.id)}),l>0&&(0,nn.jsxs)("div",{className:"lumiverse-council-banner-more",children:["+",l]})]})]}),r&&(0,nn.jsxs)("button",{className:"lumiverse-council-banner-btn",onClick:r,type:"button",children:["Manage Council ",(0,nn.jsx)(Dp,{size:16})]})]})}function dx(){const e=Hn(),{styles:n,utilities:t,retrofits:r}=e;return n.length>0||t.length>0||r.length>0?(0,nn.jsxs)("div",{className:"lumiverse-profile-section",children:[(0,nn.jsx)(lx,{Icon:Cr,title:"Loom Configuration"}),(0,nn.jsxs)("div",{className:"lumiverse-loom-summary",children:[n.length>0&&(0,nn.jsxs)("div",{className:"lumiverse-loom-group",children:[(0,nn.jsx)("span",{className:"lumiverse-loom-label",children:"Styles:"}),(0,nn.jsx)("span",{className:"lumiverse-loom-items",children:n.map(e=>e.name||e.itemName||"Unknown").join(", ")})]}),t.length>0&&(0,nn.jsxs)("div",{className:"lumiverse-loom-group",children:[(0,nn.jsx)("span",{className:"lumiverse-loom-label",children:"Utilities:"}),(0,nn.jsx)("span",{className:"lumiverse-loom-items",children:t.map(e=>e.name||e.itemName||"Unknown").join(", ")})]}),r.length>0&&(0,nn.jsxs)("div",{className:"lumiverse-loom-group",children:[(0,nn.jsx)("span",{className:"lumiverse-loom-label",children:"Retrofits:"}),(0,nn.jsx)("span",{className:"lumiverse-loom-items",children:r.map(e=>e.name||e.itemName||"Unknown").join(", ")})]})]})]}):(0,nn.jsxs)("div",{className:"lumiverse-profile-section",children:[(0,nn.jsx)(lx,{Icon:Cr,title:"Loom Configuration"}),(0,nn.jsx)(cx,{message:"No Loom items selected"})]})}function mx(e){let{onClose:n}=e;const{contextInfo:t,availablePresets:r,currentCharacterBinding:i,currentChatBinding:a,bindCurrentCharacter:o,bindCurrentChat:s,removeCharacterBinding:l,removeChatBinding:c,refreshPresets:u}=Hr(),d=(0,Je.useSyncExternalStore)(Xb.subscribe,ix,ix),[m,p]=(0,Je.useState)(()=>i||a||d||""),[g,v]=(0,Je.useState)("character");Je.useEffect(()=>{u()},[u]),Je.useEffect(()=>{const e=e=>{"Escape"===e.key&&n()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[n]);const h=(0,Je.useCallback)(()=>{var e;if(!m)return void(null===(e=toastr)||void 0===e||e.warning("Select a preset first"));let n=!1;var r,i,a;"character"===g?(n=o(m),n&&(null===(r=toastr)||void 0===r||r.success('Bound "'.concat(t.characterName,'" to "').concat(m,'"')))):(n=s(m),n&&(null===(i=toastr)||void 0===i||i.success('Bound current chat to "'.concat(m,'"'))));n?p(""):null===(a=toastr)||void 0===a||a.error("No active context to bind")},[m,g,o,s,t.characterName]),f=(0,Je.useCallback)(()=>{var e;t.characterAvatar&&(l(t.characterAvatar),null===(e=toastr)||void 0===e||e.info("Character binding removed"))},[t.characterAvatar,l]),b=(0,Je.useCallback)(()=>{var e;t.chatId&&(c(t.chatId),null===(e=toastr)||void 0===e||e.info("Chat binding removed"))},[t.chatId,c]),x=(0,Je.useCallback)(e=>{e.target===e.currentTarget&&n()},[n]),y=t.characterAvatar||t.chatId;return(0,Dt.createPortal)((0,nn.jsx)("div",{className:"lumiverse-modal-backdrop lumiverse-profile-bindings-backdrop",onClick:x,children:(0,nn.jsxs)("div",{className:"lumiverse-profile-bindings-modal",onClick:e=>e.stopPropagation(),role:"dialog","aria-modal":"true",children:[(0,nn.jsxs)("div",{className:"lumiverse-profile-bindings-header",children:[(0,nn.jsx)("div",{className:"lumiverse-profile-bindings-header-icon",children:(0,nn.jsx)(Br,{size:18,strokeWidth:2})}),(0,nn.jsxs)("div",{className:"lumiverse-profile-bindings-header-text",children:[(0,nn.jsx)("span",{className:"lumiverse-profile-bindings-title",children:"Preset Binding"}),(0,nn.jsx)("span",{className:"lumiverse-profile-bindings-subtitle",children:t.characterName||"No character"})]}),(0,nn.jsx)("button",{className:"lumiverse-profile-bindings-close",onClick:n,type:"button",children:(0,nn.jsx)(Wt,{size:16,strokeWidth:2})})]}),y?(0,nn.jsxs)("div",{className:"lumiverse-profile-bindings-content",children:[(0,nn.jsxs)("div",{className:"lumiverse-profile-bindings-status",children:[(0,nn.jsxs)("div",{className:at("lumiverse-profile-bindings-status-row",i&&"is-bound"),children:[(0,nn.jsx)(Rr,{size:14,strokeWidth:1.5}),(0,nn.jsx)("span",{className:"lumiverse-profile-bindings-status-label",children:"Character:"}),(0,nn.jsx)("span",{className:"lumiverse-profile-bindings-status-value",children:i||"Not bound"}),i&&(0,nn.jsx)("button",{className:"lumiverse-profile-bindings-status-remove",onClick:f,title:"Remove binding",type:"button",children:(0,nn.jsx)(Wt,{size:12,strokeWidth:2})})]}),(0,nn.jsxs)("div",{className:at("lumiverse-profile-bindings-status-row",a&&"is-bound"),children:[(0,nn.jsx)(_r,{size:14,strokeWidth:1.5}),(0,nn.jsx)("span",{className:"lumiverse-profile-bindings-status-label",children:"Chat:"}),(0,nn.jsx)("span",{className:"lumiverse-profile-bindings-status-value",children:a||"Not bound"}),a&&(0,nn.jsx)("button",{className:"lumiverse-profile-bindings-status-remove",onClick:b,title:"Remove binding",type:"button",children:(0,nn.jsx)(Wt,{size:12,strokeWidth:2})})]})]}),(0,nn.jsxs)("div",{className:"lumiverse-profile-bindings-create",children:[(0,nn.jsxs)("div",{className:"lumiverse-profile-bindings-type-toggle",children:[(0,nn.jsxs)("button",{className:at("lumiverse-profile-bindings-type-btn","character"===g&&"is-active"),onClick:()=>v("character"),disabled:!t.characterAvatar,type:"button",children:[(0,nn.jsx)(Rr,{size:12,strokeWidth:2}),"Character"]}),(0,nn.jsxs)("button",{className:at("lumiverse-profile-bindings-type-btn","chat"===g&&"is-active"),onClick:()=>v("chat"),disabled:!t.chatId,type:"button",children:[(0,nn.jsx)(_r,{size:12,strokeWidth:2}),"Chat"]})]}),(0,nn.jsxs)("div",{className:"lumiverse-profile-bindings-select-row",children:[(0,nn.jsxs)("select",{className:"lumiverse-profile-bindings-select",value:m,onChange:e=>p(e.target.value),children:[(0,nn.jsx)("option",{value:"",children:"Select preset..."}),r.map(e=>(0,nn.jsx)("option",{value:e,children:e},e))]}),(0,nn.jsx)("button",{className:"lumiverse-profile-bindings-bind-btn",onClick:h,disabled:!m,type:"button",children:(0,nn.jsx)(Br,{size:14,strokeWidth:2})})]})]})]}):(0,nn.jsxs)("div",{className:"lumiverse-profile-bindings-empty",children:[(0,nn.jsx)(Rr,{size:24,strokeWidth:1.5}),(0,nn.jsx)("span",{children:"Select a character first"})]})]})}),document.body)}function px(e){let{onClick:n,currentBinding:t,currentCharacterBinding:r,currentChatBinding:i}=e;const a=!!t.presetName,o=t.bindingType,s=t.presetName;return(0,nn.jsx)("button",{className:at("lumiverse-profile-bind-btn",a&&"lumiverse-profile-bind-btn--active"),onClick:n,title:a?"Bound to: ".concat(s," (").concat(o,")"):"Bind preset to character or chat",type:"button",children:a?(0,nn.jsx)(Br,{size:16,strokeWidth:2}):(0,nn.jsx)(Wr,{size:16,strokeWidth:1.5})})}const gx=function(e){var n,t;let{onTabChange:r}=e;const i=function(){const e=(0,Je.useSyncExternalStore)(Xb.subscribe,Jb,()=>0);return(0,Je.useMemo)(()=>{if("undefined"!=typeof SillyTavern)try{const e=SillyTavern.getContext();if(null!=e&&e.characters&&void 0!==(null==e?void 0:e.characterId)){const n=e.characters[e.characterId];return{name:(null==n?void 0:n.name)||"Unknown",avatar:null!=n&&n.avatar?"/characters/".concat(encodeURIComponent(n.avatar)):null,description:(null==n?void 0:n.description)||""}}}catch(e){console.warn("[LumiverseUI] Could not get character:",e)}return{name:"No Character",avatar:null,description:""}},[e])}(),a=Wn(),{allPacks:o}=Vn(),[s,l]=(0,Je.useState)(!1),{currentBinding:c,currentCharacterBinding:u,currentChatBinding:d}=Hr(),m=(0,Je.useSyncExternalStore)(Xb.subscribe,ex,ex),p=(0,Je.useSyncExternalStore)(Xb.subscribe,nx,nx),g=(0,Je.useSyncExternalStore)(Xb.subscribe,tx,tx),v=(0,Je.useSyncExternalStore)(Xb.subscribe,rx,rx),h=g&&v.length>0,f=m?p.length:a.definition?1:0,b=(0,Je.useMemo)(()=>{var e,n;return{behaviors:(null===(e=a.behaviors)||void 0===e?void 0:e.length)||0,personalities:(null===(n=a.personalities)||void 0===n?void 0:n.length)||0,hasDefinition:!!a.definition,definitionCount:f,totalPacks:o.length}},[a,o,f]),x=(0,Je.useCallback)(()=>{l(!0)},[]),y=(0,Je.useCallback)(()=>{l(!1)},[]);return(0,nn.jsxs)("div",{className:"lumiverse-character-profile",children:[(0,nn.jsxs)("div",{className:"lumiverse-profile-header",children:[(0,nn.jsx)("div",{className:"lumiverse-profile-avatar",children:i.avatar?(0,nn.jsx)("img",{src:i.avatar,alt:i.name}):(0,nn.jsx)("span",{className:"lumiverse-profile-avatar-placeholder",children:(0,nn.jsx)(Rr,{size:32,strokeWidth:1.5})})}),(0,nn.jsxs)("div",{className:"lumiverse-profile-info",children:[(0,nn.jsx)("h3",{className:"lumiverse-profile-name",children:i.name}),(0,nn.jsxs)("div",{className:"lumiverse-profile-stats",children:[(0,nn.jsxs)("span",{className:"lumiverse-stat",title:"Behaviors",children:[(0,nn.jsx)(Ut,{size:14,strokeWidth:1.5,className:"lumiverse-stat-icon"}),(0,nn.jsx)("span",{className:"lumiverse-stat-value",children:b.behaviors})]}),(0,nn.jsxs)("span",{className:"lumiverse-stat",title:"Personalities",children:[(0,nn.jsx)(Rp,{size:14,strokeWidth:1.5,className:"lumiverse-stat-icon"}),(0,nn.jsx)("span",{className:"lumiverse-stat-value",children:b.personalities})]}),(0,nn.jsxs)("span",{className:"lumiverse-stat",title:"Packs",children:[(0,nn.jsx)(et,{size:14,strokeWidth:1.5,className:"lumiverse-stat-icon"}),(0,nn.jsx)("span",{className:"lumiverse-stat-value",children:b.totalPacks})]})]})]}),(0,nn.jsx)(px,{onClick:x,currentBinding:c,currentCharacterBinding:u,currentChatBinding:d})]}),s&&(0,nn.jsx)(mx,{onClose:y}),h?(0,nn.jsx)(ux,{councilMembers:v,allPacks:o,onManageCouncil:()=>{r&&r("council")}}):(0,nn.jsxs)(nn.Fragment,{children:[(0,nn.jsxs)("div",{className:"lumiverse-profile-section",children:[(0,nn.jsx)(lx,{Icon:m?Er:ef,title:m?"Chimera Definitions":"Definition",count:b.definitionCount}),(0,nn.jsx)("div",{className:"lumiverse-traits-list",children:(0,nn.jsx)(si,{initial:!1,children:m?p.length>0?p.map((e,n)=>(0,nn.jsx)(sx,{trait:e,type:"definition"},ax(e)||"def-".concat(n))):(0,nn.jsx)(cx,{message:"No Chimera forms selected"}):a.definition?(0,nn.jsx)(sx,{trait:a.definition,type:"definition"},ax(a.definition)||"def"):(0,nn.jsx)(cx,{message:"No definition selected"})})})]}),(0,nn.jsxs)("div",{className:"lumiverse-profile-section",children:[(0,nn.jsx)(lx,{Icon:Ut,title:"Behaviors",count:b.behaviors}),(0,nn.jsx)("div",{className:"lumiverse-traits-list",children:(0,nn.jsx)(si,{initial:!1,children:(null===(n=a.behaviors)||void 0===n?void 0:n.length)>0?a.behaviors.map(e=>(0,nn.jsx)(sx,{trait:e,type:"behavior",isDominant:ox(a.dominantBehavior,e)},ax(e))):(0,nn.jsx)(cx,{message:"No behaviors selected"})})})]}),(0,nn.jsxs)("div",{className:"lumiverse-profile-section",children:[(0,nn.jsx)(lx,{Icon:Rp,title:"Personalities",count:b.personalities}),(0,nn.jsx)("div",{className:"lumiverse-traits-list",children:(0,nn.jsx)(si,{initial:!1,children:(null===(t=a.personalities)||void 0===t?void 0:t.length)>0?a.personalities.map(e=>(0,nn.jsx)(sx,{trait:e,type:"personality",isDominant:ox(a.dominantPersonality,e)},ax(e))):(0,nn.jsx)(cx,{message:"No personalities selected"})})})]})]}),(0,nn.jsx)(dx,{})]})},vx=wn,hx={},fx=()=>vx.getState().presets||hx,bx=()=>vx.getState().activePresetName;function xx(e){if(!e)return"";const n=Date.now()-e,t=Math.floor(n/6e4);if(t<1)return"Just now";if(t<60)return"".concat(t,"m ago");const r=Math.floor(t/60);if(r<24)return"".concat(r,"h ago");const i=Math.floor(r/24);return i<7?"".concat(i,"d ago"):new Date(e).toLocaleDateString()}function yx(e){let{preset:n,isActive:t,onLoad:r,onUpdate:i,onDelete:a}=e;const[o,s]=(0,Je.useState)(!1),l=(0,Je.useMemo)(()=>{var e,t,r,i,a,o;if(n.councilMode&&(null===(e=n.councilMembers)||void 0===e?void 0:e.length)>0){return{isCouncil:!0,members:n.councilMembers.length,behaviors:n.councilMembers.reduce((e,n)=>{var t;return e+((null===(t=n.behaviors)||void 0===t?void 0:t.length)||0)},0),personalities:n.councilMembers.reduce((e,n)=>{var t;return e+((null===(t=n.personalities)||void 0===t?void 0:t.length)||0)},0)}}return n.chimeraMode&&(null===(t=n.selectedDefinitions)||void 0===t?void 0:t.length)>0?{isChimera:!0,definitions:n.selectedDefinitions.length,behaviors:(null===(r=n.selectedBehaviors)||void 0===r?void 0:r.length)||0,personalities:(null===(i=n.selectedPersonalities)||void 0===i?void 0:i.length)||0}:{definitions:n.selectedDefinition?1:0,behaviors:(null===(a=n.selectedBehaviors)||void 0===a?void 0:a.length)||0,personalities:(null===(o=n.selectedPersonalities)||void 0===o?void 0:o.length)||0}},[n]);return(0,nn.jsxs)("div",{className:at("lumiverse-preset-card",t&&"lumiverse-preset-card--active"),children:[(0,nn.jsxs)("div",{className:"lumiverse-preset-card-header",children:[(0,nn.jsx)("span",{className:"lumiverse-preset-card-icon",children:(0,nn.jsx)(tm,{size:16,strokeWidth:1.5})}),(0,nn.jsx)("span",{className:"lumiverse-preset-card-name",children:n.name}),t&&(0,nn.jsxs)("span",{className:"lumiverse-preset-card-active-badge",children:[(0,nn.jsx)(rm,{size:12,strokeWidth:2})," Active"]})]}),(0,nn.jsxs)("div",{className:"lumiverse-preset-card-meta",children:[(0,nn.jsx)("div",{className:"lumiverse-preset-stats",children:l.isCouncil?(0,nn.jsxs)(nn.Fragment,{children:[(0,nn.jsxs)("span",{className:"lumiverse-preset-stat lumiverse-preset-stat--council",children:[(0,nn.jsx)(nm,{size:12,strokeWidth:1.5})," ",l.members]}),(0,nn.jsxs)("span",{className:"lumiverse-preset-stat",children:[(0,nn.jsx)(Ut,{size:12,strokeWidth:1.5})," ",l.behaviors]}),(0,nn.jsxs)("span",{className:"lumiverse-preset-stat",children:[(0,nn.jsx)(Rp,{size:12,strokeWidth:1.5})," ",l.personalities]})]}):(0,nn.jsxs)(nn.Fragment,{children:[(0,nn.jsxs)("span",{className:at("lumiverse-preset-stat",l.isChimera&&"lumiverse-preset-stat--chimera"),children:[(0,nn.jsx)(ef,{size:12,strokeWidth:1.5})," ",l.definitions]}),(0,nn.jsxs)("span",{className:"lumiverse-preset-stat",children:[(0,nn.jsx)(Ut,{size:12,strokeWidth:1.5})," ",l.behaviors]}),(0,nn.jsxs)("span",{className:"lumiverse-preset-stat",children:[(0,nn.jsx)(Rp,{size:12,strokeWidth:1.5})," ",l.personalities]})]})}),n.chimeraMode&&(0,nn.jsx)("span",{className:"lumiverse-preset-card-mode",children:"Chimera"}),n.councilMode&&(0,nn.jsx)("span",{className:"lumiverse-preset-card-mode",children:"Council"}),(0,nn.jsxs)("span",{className:"lumiverse-preset-card-time",children:[(0,nn.jsx)($t,{size:12,strokeWidth:1.5}),xx(n.updatedAt||n.createdAt)]})]}),(0,nn.jsxs)("div",{className:"lumiverse-preset-card-actions",children:[(0,nn.jsx)("button",{className:"lumiverse-preset-btn lumiverse-preset-btn--primary",onClick:()=>r(n.name),title:"Load this preset",type:"button",children:"Load"}),(0,nn.jsx)("button",{className:"lumiverse-preset-btn",onClick:()=>i(n.name),title:"Update preset with current selections",type:"button",children:(0,nn.jsx)(Ht,{size:14,strokeWidth:1.5})}),(0,nn.jsx)("button",{className:at("lumiverse-preset-btn lumiverse-preset-btn--danger",o&&"lumiverse-preset-btn--confirming"),onClick:()=>{o?(a(n.name),s(!1)):(s(!0),setTimeout(()=>s(!1),3e3))},title:o?"Click again to confirm":"Delete preset",type:"button",children:o?(0,nn.jsx)(Wt,{size:14,strokeWidth:2}):(0,nn.jsx)(tt,{size:14,strokeWidth:1.5})})]})]})}function kx(){return(0,nn.jsxs)("div",{className:"lumiverse-preset-empty",children:[(0,nn.jsx)("span",{className:"lumiverse-preset-empty-icon",children:(0,nn.jsx)(tm,{size:32,strokeWidth:1.5})}),(0,nn.jsx)("h4",{children:"No Presets Saved"}),(0,nn.jsx)("p",{children:"Save your current Lumia configuration as a preset to quickly switch between setups."})]})}const wx=function(){const e=Nn(),[n,t]=(0,Je.useState)(""),[r,i]=(0,Je.useState)(!1),a=(0,Je.useSyncExternalStore)(vx.subscribe,fx,fx),o=(0,Je.useSyncExternalStore)(vx.subscribe,bx,bx),s=(0,Je.useMemo)(()=>Object.values(a).sort((e,n)=>{const t=e.updatedAt||e.createdAt||0;return(n.updatedAt||n.createdAt||0)-t}),[a]),l=(0,Je.useCallback)(n=>{e.loadPreset(n),yn()},[e]),c=(0,Je.useCallback)(n=>{e.updatePreset(n),yn()},[e]),u=(0,Je.useCallback)(n=>{e.deletePreset(n),yn()},[e]),d=(0,Je.useCallback)(()=>{const r=n.trim();r&&(a[r]||(e.savePreset(r),yn(),t(""),i(!1)))},[n,a,e]);return(0,nn.jsxs)("div",{className:"lumiverse-preset-manager",children:[(0,nn.jsxs)("div",{className:"lumiverse-preset-header",children:[(0,nn.jsx)("h3",{className:"lumiverse-preset-title",children:"Lumia Presets"}),r?(0,nn.jsxs)("div",{className:"lumiverse-preset-create-form",children:[(0,nn.jsx)("input",{type:"text",className:"lumiverse-preset-input",placeholder:"Preset name...",value:n,onChange:e=>t(e.target.value),onKeyDown:e=>{"Enter"===e.key?d():"Escape"===e.key&&(i(!1),t(""))},autoFocus:!0}),(0,nn.jsx)("button",{className:"lumiverse-preset-btn lumiverse-preset-btn--primary",onClick:d,disabled:!n.trim(),type:"button",children:(0,nn.jsx)(rm,{size:14,strokeWidth:2})}),(0,nn.jsx)("button",{className:"lumiverse-preset-btn",onClick:()=>{i(!1),t("")},type:"button",children:(0,nn.jsx)(Wt,{size:14,strokeWidth:2})})]}):(0,nn.jsxs)("button",{className:"lumiverse-preset-create-btn",onClick:()=>i(!0),title:"Save current configuration as preset",type:"button",children:[(0,nn.jsx)(Ur,{size:16,strokeWidth:2}),(0,nn.jsx)("span",{children:"New Preset"})]})]}),(0,nn.jsx)("div",{className:"lumiverse-preset-list",children:0===s.length?(0,nn.jsx)(kx,{}):s.map(e=>(0,nn.jsx)(yx,{preset:e,isActive:o===e.name,onLoad:l,onUpdate:c,onDelete:u},e.name))}),s.length>0&&(0,nn.jsx)("div",{className:"lumiverse-preset-help",children:(0,nn.jsx)("p",{children:"Presets save your Lumia selections (definition, behaviors, personalities) and mode settings."})})]})};function jx(e,n,t){let r,i=t.initialDeps??[],a=!0;function o(){var o,s,l;let c;t.key&&(null==(o=t.debug)?void 0:o.call(t))&&(c=Date.now());const u=e();if(!(u.length!==i.length||u.some((e,n)=>i[n]!==e)))return r;let d;if(i=u,t.key&&(null==(s=t.debug)?void 0:s.call(t))&&(d=Date.now()),r=n(...u),t.key&&(null==(l=t.debug)?void 0:l.call(t))){const e=Math.round(100*(Date.now()-c))/100,n=Math.round(100*(Date.now()-d))/100,r=n/16,i=(e,n)=>{for(e=String(e);e.length<n;)e=" "+e;return e};console.info(`%c⏱ ${i(n,5)} /${i(e,5)} ms`,`\n            font-size: .6rem;\n            font-weight: bold;\n            color: hsl(${Math.max(0,Math.min(120-120*r,120))}deg 100% 31%);`,null==t?void 0:t.key)}return!(null==t?void 0:t.onChange)||a&&t.skipInitialOnChange||t.onChange(r),a=!1,r}return o.updateDeps=e=>{i=e},o}function Sx(e,n){if(void 0===e)throw new Error("Unexpected undefined"+(n?`: ${n}`:""));return e}const Cx=(e,n,t)=>{let r;return function(...i){e.clearTimeout(r),r=e.setTimeout(()=>n.apply(this,i),t)}},Nx=e=>{const{offsetWidth:n,offsetHeight:t}=e;return{width:n,height:t}},Px=e=>e,Ex=e=>{const n=Math.max(e.startIndex-e.overscan,0),t=Math.min(e.endIndex+e.overscan,e.count-1),r=[];for(let e=n;e<=t;e++)r.push(e);return r},Ox=(e,n)=>{const t=e.scrollElement;if(!t)return;const r=e.targetWindow;if(!r)return;const i=e=>{const{width:t,height:r}=e;n({width:Math.round(t),height:Math.round(r)})};if(i(Nx(t)),!r.ResizeObserver)return()=>{};const a=new r.ResizeObserver(n=>{const r=()=>{const e=n[0];if(null==e?void 0:e.borderBoxSize){const n=e.borderBoxSize[0];if(n)return void i({width:n.inlineSize,height:n.blockSize})}i(Nx(t))};e.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(r):r()});return a.observe(t,{box:"border-box"}),()=>{a.unobserve(t)}},Mx={passive:!0},zx="undefined"==typeof window||"onscrollend"in window,Tx=(e,n)=>{const t=e.scrollElement;if(!t)return;const r=e.targetWindow;if(!r)return;let i=0;const a=e.options.useScrollendEvent&&zx?()=>{}:Cx(r,()=>{n(i,!1)},e.options.isScrollingResetDelay),o=r=>()=>{const{horizontal:o,isRtl:s}=e.options;i=o?t.scrollLeft*(s?-1:1):t.scrollTop,a(),n(i,r)},s=o(!0),l=o(!1);l(),t.addEventListener("scroll",s,Mx);const c=e.options.useScrollendEvent&&zx;return c&&t.addEventListener("scrollend",l,Mx),()=>{t.removeEventListener("scroll",s),c&&t.removeEventListener("scrollend",l)}},Ix=(e,n,t)=>{if(null==n?void 0:n.borderBoxSize){const e=n.borderBoxSize[0];if(e){return Math.round(e[t.options.horizontal?"inlineSize":"blockSize"])}}return e[t.options.horizontal?"offsetWidth":"offsetHeight"]},Lx=(e,{adjustments:n=0,behavior:t},r)=>{var i,a;const o=e+n;null==(a=null==(i=r.scrollElement)?void 0:i.scrollTo)||a.call(i,{[r.options.horizontal?"left":"top"]:o,behavior:t})};class Dx{constructor(e){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.measurementsCache=[],this.itemSizeCache=new Map,this.laneAssignments=new Map,this.pendingMeasuredCacheIndexes=[],this.prevLanes=void 0,this.lanesChangedFlag=!1,this.lanesSettling=!1,this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let e=null;const n=()=>e||(this.targetWindow&&this.targetWindow.ResizeObserver?e=new this.targetWindow.ResizeObserver(e=>{e.forEach(e=>{const n=()=>{this._measureElement(e.target,e)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(n):n()})}):null);return{disconnect:()=>{var t;null==(t=n())||t.disconnect(),e=null},observe:e=>{var t;return null==(t=n())?void 0:t.observe(e,{box:"border-box"})},unobserve:e=>{var t;return null==(t=n())?void 0:t.unobserve(e)}}})(),this.range=null,this.setOptions=e=>{Object.entries(e).forEach(([n,t])=>{void 0===t&&delete e[n]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:Px,rangeExtractor:Ex,onChange:()=>{},measureElement:Ix,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...e}},this.notify=e=>{var n,t;null==(t=(n=this.options).onChange)||t.call(n,this,e)},this.maybeNotify=jx(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),e=>{this.notify(e)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(e=>e()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var e;const n=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==n){if(this.cleanup(),!n)return void this.maybeNotify();this.scrollElement=n,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=(null==(e=this.scrollElement)?void 0:e.window)??null,this.elementsCache.forEach(e=>{this.observer.observe(e)}),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,e=>{this.scrollRect=e,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(e,n)=>{this.scrollAdjustments=0,this.scrollDirection=n?this.getScrollOffset()<e?"forward":"backward":null,this.scrollOffset=e,this.isScrolling=n,this.maybeNotify()}))}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??("function"==typeof this.options.initialOffset?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(e,n)=>{const t=new Map,r=new Map;for(let i=n-1;i>=0;i--){const n=e[i];if(t.has(n.lane))continue;const a=r.get(n.lane);if(null==a||n.end>a.end?r.set(n.lane,n):n.end<a.end&&t.set(n.lane,!0),t.size===this.options.lanes)break}return r.size===this.options.lanes?Array.from(r.values()).sort((e,n)=>e.end===n.end?e.index-n.index:e.end-n.end)[0]:void 0},this.getMeasurementOptions=jx(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled,this.options.lanes],(e,n,t,r,i,a)=>(void 0!==this.prevLanes&&this.prevLanes!==a&&(this.lanesChangedFlag=!0),this.prevLanes=a,this.pendingMeasuredCacheIndexes=[],{count:e,paddingStart:n,scrollMargin:t,getItemKey:r,enabled:i,lanes:a}),{key:!1,skipInitialOnChange:!0,onChange:()=>{this.notify(this.isScrolling)}}),this.getMeasurements=jx(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:e,paddingStart:n,scrollMargin:t,getItemKey:r,enabled:i,lanes:a},o)=>{if(!i)return this.measurementsCache=[],this.itemSizeCache.clear(),this.laneAssignments.clear(),[];if(this.laneAssignments.size>e)for(const n of this.laneAssignments.keys())n>=e&&this.laneAssignments.delete(n);this.lanesChangedFlag&&(this.lanesChangedFlag=!1,this.lanesSettling=!0,this.measurementsCache=[],this.itemSizeCache.clear(),this.laneAssignments.clear(),this.pendingMeasuredCacheIndexes=[]),0===this.measurementsCache.length&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(e=>{this.itemSizeCache.set(e.key,e.size)}));const s=this.lanesSettling?0:this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[],this.lanesSettling&&this.measurementsCache.length===e&&(this.lanesSettling=!1);const l=this.measurementsCache.slice(0,s),c=new Array(a).fill(void 0);for(let e=0;e<s;e++){const n=l[e];n&&(c[n.lane]=e)}for(let i=s;i<e;i++){const e=r(i),a=this.laneAssignments.get(i);let s,u;if(void 0!==a&&this.options.lanes>1){s=a;const e=c[s],r=void 0!==e?l[e]:void 0;u=r?r.end+this.options.gap:n+t}else{const e=1===this.options.lanes?l[i-1]:this.getFurthestMeasurement(l,i);u=e?e.end+this.options.gap:n+t,s=e?e.lane:i%this.options.lanes,this.options.lanes>1&&this.laneAssignments.set(i,s)}const d=o.get(e),m="number"==typeof d?d:this.options.estimateSize(i),p=u+m;l[i]={index:i,start:u,size:m,end:p,key:e,lane:s},c[s]=i}return this.measurementsCache=l,l},{key:!1,debug:()=>this.options.debug}),this.calculateRange=jx(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(e,n,t,r)=>this.range=e.length>0&&n>0?function({measurements:e,outerSize:n,scrollOffset:t,lanes:r}){const i=e.length-1,a=n=>e[n].start;if(e.length<=r)return{startIndex:0,endIndex:i};let o=Ax(0,i,a,t),s=o;if(1===r)for(;s<i&&e[s].end<t+n;)s++;else if(r>1){const a=Array(r).fill(0);for(;s<i&&a.some(e=>e<t+n);){const n=e[s];a[n.lane]=n.end,s++}const l=Array(r).fill(t+n);for(;o>=0&&l.some(e=>e>=t);){const n=e[o];l[n.lane]=n.start,o--}o=Math.max(0,o-o%r),s=Math.min(i,s+(r-1-s%r))}return{startIndex:o,endIndex:s}}({measurements:e,outerSize:n,scrollOffset:t,lanes:r}):null,{key:!1,debug:()=>this.options.debug}),this.getVirtualIndexes=jx(()=>{let e=null,n=null;const t=this.calculateRange();return t&&(e=t.startIndex,n=t.endIndex),this.maybeNotify.updateDeps([this.isScrolling,e,n]),[this.options.rangeExtractor,this.options.overscan,this.options.count,e,n]},(e,n,t,r,i)=>null===r||null===i?[]:e({startIndex:r,endIndex:i,overscan:n,count:t}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=e=>{const n=this.options.indexAttribute,t=e.getAttribute(n);return t?parseInt(t,10):(console.warn(`Missing attribute name '${n}={index}' on measured element.`),-1)},this._measureElement=(e,n)=>{const t=this.indexFromElement(e),r=this.measurementsCache[t];if(!r)return;const i=r.key,a=this.elementsCache.get(i);a!==e&&(a&&this.observer.unobserve(a),this.observer.observe(e),this.elementsCache.set(i,e)),e.isConnected&&this.resizeItem(t,this.options.measureElement(e,n,this))},this.resizeItem=(e,n)=>{const t=this.measurementsCache[e];if(!t)return;const r=n-(this.itemSizeCache.get(t.key)??t.size);0!==r&&((void 0!==this.shouldAdjustScrollPositionOnItemSizeChange?this.shouldAdjustScrollPositionOnItemSizeChange(t,r,this):t.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=r,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(t.index),this.itemSizeCache=new Map(this.itemSizeCache.set(t.key,n)),this.notify(!1))},this.measureElement=e=>{e?this._measureElement(e,void 0):this.elementsCache.forEach((e,n)=>{e.isConnected||(this.observer.unobserve(e),this.elementsCache.delete(n))})},this.getVirtualItems=jx(()=>[this.getVirtualIndexes(),this.getMeasurements()],(e,n)=>{const t=[];for(let r=0,i=e.length;r<i;r++){const i=n[e[r]];t.push(i)}return t},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=e=>{const n=this.getMeasurements();if(0!==n.length)return Sx(n[Ax(0,n.length-1,e=>Sx(n[e]).start,e)])},this.getOffsetForAlignment=(e,n,t=0)=>{const r=this.getSize(),i=this.getScrollOffset();"auto"===n&&(n=e>=i+r?"end":"start"),"center"===n?e+=(t-r)/2:"end"===n&&(e-=r);const a=this.getTotalSize()+this.options.scrollMargin-r;return Math.max(Math.min(a,e),0)},this.getOffsetForIndex=(e,n="auto")=>{e=Math.max(0,Math.min(e,this.options.count-1));const t=this.measurementsCache[e];if(!t)return;const r=this.getSize(),i=this.getScrollOffset();if("auto"===n)if(t.end>=i+r-this.options.scrollPaddingEnd)n="end";else{if(!(t.start<=i+this.options.scrollPaddingStart))return[i,n];n="start"}const a="end"===n?t.end+this.options.scrollPaddingEnd:t.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(a,n,t.size),n]},this.isDynamicMode=()=>this.elementsCache.size>0,this.scrollToOffset=(e,{align:n="start",behavior:t}={})=>{"smooth"===t&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(e,n),{adjustments:void 0,behavior:t})},this.scrollToIndex=(e,{align:n="auto",behavior:t}={})=>{"smooth"===t&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),e=Math.max(0,Math.min(e,this.options.count-1));let r=0;const i=n=>{if(!this.targetWindow)return;const r=this.getOffsetForIndex(e,n);if(!r)return void console.warn("Failed to get offset for index:",e);const[i,o]=r;this._scrollToOffset(i,{adjustments:void 0,behavior:t}),this.targetWindow.requestAnimationFrame(()=>{const n=this.getScrollOffset(),t=this.getOffsetForIndex(e,o);var r,i;t?(r=t[0],i=n,Math.abs(r-i)<1.01||a(o)):console.warn("Failed to get offset for index:",e)})},a=n=>{this.targetWindow&&(r++,r<10?this.targetWindow.requestAnimationFrame(()=>i(n)):console.warn(`Failed to scroll to index ${e} after 10 attempts.`))};i(n)},this.scrollBy=(e,{behavior:n}={})=>{"smooth"===n&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+e,{adjustments:void 0,behavior:n})},this.getTotalSize=()=>{var e;const n=this.getMeasurements();let t;if(0===n.length)t=this.options.paddingStart;else if(1===this.options.lanes)t=(null==(e=n[n.length-1])?void 0:e.end)??0;else{const e=Array(this.options.lanes).fill(null);let r=n.length-1;for(;r>=0&&e.some(e=>null===e);){const t=n[r];null===e[t.lane]&&(e[t.lane]=t.end),r--}t=Math.max(...e.filter(e=>null!==e))}return Math.max(t-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(e,{adjustments:n,behavior:t})=>{this.options.scrollToFn(e,{behavior:t,adjustments:n},this)},this.measure=()=>{this.itemSizeCache=new Map,this.laneAssignments=new Map,this.notify(!1)},this.setOptions(e)}}const Ax=(e,n,t,r)=>{for(;e<=n;){const i=(e+n)/2|0,a=t(i);if(a<r)e=i+1;else{if(!(a>r))return i;n=i-1}}return e>0?e-1:0};const Rx="undefined"!=typeof document?Je.useLayoutEffect:Je.useEffect;function Bx(e){const n=Je.useReducer(()=>({}),{})[1],t={...e,onChange:(t,r)=>{var i;r?(0,Dt.flushSync)(n):n(),null==(i=e.onChange)||i.call(e,t,r)}},[r]=Je.useState(()=>new Dx(t));return r.setOptions(t),Rx(()=>r._didMount(),[]),Rx(()=>r._willUpdate()),r}function _x(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function Ux(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?_x(Object(t),!0).forEach(function(n){Fx(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):_x(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Fx(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function Wx(e,n){if(!e)return null;const t={name:["lumiaName","lumiaDefName"],def:["lumiaDefinition","lumiaDef"],personality:["lumiaPersonality","lumia_personality"],behavior:["lumiaBehavior","lumia_behavior"],img:["avatarUrl","lumia_img"],author:["authorName","defAuthor"]}[n];if(!t)return null;for(const n of t)if(void 0!==e[n]&&null!==e[n])return e[n];return null}function Hx(e){let{value:n,onChange:t,placeholder:r}=e;return(0,nn.jsxs)("div",{className:"lumiverse-pack-search",children:[(0,nn.jsx)("span",{className:"lumiverse-pack-search-icon",children:(0,nn.jsx)(Xm,{size:16,strokeWidth:1.5})}),(0,nn.jsx)("input",{type:"text",className:"lumiverse-pack-search-input",placeholder:r,value:n,onChange:e=>t(e.target.value)}),n&&(0,nn.jsx)("button",{className:"lumiverse-pack-search-clear",onClick:()=>t(""),type:"button",children:(0,nn.jsx)(Wt,{size:14,strokeWidth:2})})]})}function Vx(e){let{activeFilter:n,onFilterChange:t,showSelectedOnly:r,onToggleSelectedOnly:i,selectedCount:a}=e;const o=[{id:"all",label:"All",Icon:et},{id:"definition",label:"Definitions",Icon:ef},{id:"behavior",label:"Behaviors",Icon:Ut},{id:"personality",label:"Personalities",Icon:Rp}];return(0,nn.jsxs)("div",{className:"lumiverse-pack-filters-container",children:[(0,nn.jsx)("div",{className:"lumiverse-pack-filters",children:o.map(e=>{const{Icon:r}=e;return(0,nn.jsx)("button",{className:at("lumiverse-pack-filter",n===e.id&&"lumiverse-pack-filter--active"),onClick:()=>t(e.id),title:e.label,type:"button",children:(0,nn.jsx)(r,{size:16,strokeWidth:1.5})},e.id)})}),(0,nn.jsxs)("button",{className:at("lumiverse-pack-filter-selected-toggle",r&&"lumiverse-pack-filter-selected-toggle--active"),onClick:i,title:r?"Show all items":"Show selected only",type:"button",children:[(0,nn.jsx)(wf,{size:14,strokeWidth:1.5}),a>0&&(0,nn.jsx)("span",{className:"lumiverse-pack-filter-selected-count",children:a})]})]})}function qx(e){let{pack:n,isExpanded:t,onToggle:r,onViewPack:i,itemCount:a}=e;const o=n.name||n.packName||"Unknown Pack";return(0,nn.jsxs)("button",{className:at("lumiverse-browser-pack-header",t&&"lumiverse-browser-pack-header--expanded"),onClick:r,type:"button",children:[n.packCover?(0,nn.jsx)("img",{src:n.packCover,alt:o,className:"lumiverse-browser-pack-cover"}):(0,nn.jsx)("div",{className:"lumiverse-browser-pack-cover-placeholder",children:n.isCustom?(0,nn.jsx)(Cr,{size:20,strokeWidth:1.5}):(0,nn.jsx)(et,{size:20,strokeWidth:1.5})}),(0,nn.jsxs)("div",{className:"lumiverse-browser-pack-info",children:[(0,nn.jsx)("span",{className:"lumiverse-browser-pack-name",children:o}),(0,nn.jsxs)("span",{className:"lumiverse-browser-pack-meta",children:[a," items",n.isCustom&&(0,nn.jsx)("span",{className:"lumiverse-browser-pack-custom-badge",children:"Custom"})]})]}),(0,nn.jsx)("span",{className:"lumiverse-browser-pack-view-btn",onClick:e=>{e.stopPropagation(),null==i||i(o)},title:"View pack contents",role:"button",tabIndex:0,children:(0,nn.jsx)(im,{size:16,strokeWidth:1.5})}),(0,nn.jsx)("span",{className:at("lumiverse-browser-pack-chevron",t&&"lumiverse-browser-pack-chevron--rotated"),children:(0,nn.jsx)(ot,{size:16,strokeWidth:2})})]})}function $x(e){let{item:n,type:t,onSelect:r,isSelected:i}=e;const a={definition:{Icon:ef,color:"rgba(100, 200, 255, 0.15)",border:"rgba(100, 200, 255, 0.3)",selectedBorder:"rgba(100, 200, 255, 0.7)"},behavior:{Icon:Ut,color:"rgba(255, 180, 100, 0.15)",border:"rgba(255, 180, 100, 0.3)",selectedBorder:"rgba(255, 180, 100, 0.7)"},personality:{Icon:Rp,color:"rgba(200, 100, 255, 0.15)",border:"rgba(200, 100, 255, 0.3)",selectedBorder:"rgba(200, 100, 255, 0.7)"}},o=Wx(n,"img"),s=Wx(n,"name")||"Unknown",{objectPosition:l}=Yn(o),c=a[t]||a.definition,{Icon:u}=c,d=(()=>{if("definition"===t){const e=Wx(n,"def");return e?e.slice(0,100):""}if("behavior"===t){const e=Wx(n,"behavior");return e?e.slice(0,100):""}if("personality"===t){const e=Wx(n,"personality");return e?e.slice(0,100):""}return""})();return(0,nn.jsxs)(em.div,{className:at("lumiverse-browser-item",i&&"lumiverse-browser-item--selected"),style:{background:i?c.color.replace("0.15","0.25"):c.color,borderColor:i?c.selectedBorder:c.border},onClick:()=>null==r?void 0:r(n,t),initial:{opacity:0,y:10},animate:{opacity:1,y:0},whileHover:{scale:1.02},whileTap:{scale:.98},children:[o&&(0,nn.jsx)("img",{src:o,alt:s,className:"lumiverse-browser-item-image",style:{objectPosition:l}}),(0,nn.jsxs)("div",{className:"lumiverse-browser-item-content",children:[(0,nn.jsxs)("div",{className:"lumiverse-browser-item-header",children:[(0,nn.jsx)("span",{className:"lumiverse-browser-item-icon",children:(0,nn.jsx)(u,{size:14,strokeWidth:1.5})}),(0,nn.jsx)("span",{className:"lumiverse-browser-item-name",children:s}),i&&(0,nn.jsx)("span",{className:"lumiverse-browser-item-check",children:(0,nn.jsx)(rm,{size:14,strokeWidth:2.5})})]}),d&&(0,nn.jsx)("p",{className:"lumiverse-browser-item-desc",children:d})]})]})}function Yx(e,n,t){const r=Wx(e,"name"),i=e.packName;if("definition"===n){const e=t.definition;return(null==e?void 0:e.itemName)===r&&(null==e?void 0:e.packName)===i}var a,o,s,l;return"behavior"===n?null!==(a=null===(o=t.behaviors)||void 0===o?void 0:o.some(e=>e.itemName===r&&e.packName===i))&&void 0!==a&&a:"personality"===n&&(null!==(s=null===(l=t.personalities)||void 0===l?void 0:l.some(e=>e.itemName===r&&e.packName===i))&&void 0!==s&&s)}function Kx(e){let{items:n,filter:t,onSelectItem:r,selections:i}=e;const a=(0,Je.useRef)(null),o=(0,Je.useMemo)(()=>"all"===t?n:n.filter(e=>e.type===t),[n,t]),s=function(e){return Bx({observeElementRect:Ox,observeElementOffset:Tx,scrollToFn:Lx,...e})}({count:o.length,getScrollElement:()=>a.current,estimateSize:()=>80,overscan:5});return 0===o.length?(0,nn.jsx)("div",{className:"lumiverse-browser-empty-items",children:"No items match the current filter"}):(0,nn.jsx)("div",{ref:a,className:"lumiverse-browser-items-container",style:{maxHeight:"300px",overflow:"auto"},children:(0,nn.jsx)("div",{style:{height:"".concat(s.getTotalSize(),"px"),width:"100%",position:"relative"},children:s.getVirtualItems().map(e=>{const n=o[e.index];return(0,nn.jsx)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"".concat(e.size,"px"),transform:"translateY(".concat(e.start,"px)"),padding:"4px 0"},children:(0,nn.jsx)($x,{item:n,type:n.type,onSelect:r,isSelected:Yx(n,n.type,i)})},e.key)})})})}function Qx(e){let{pack:n,filter:t,searchQuery:r,showSelectedOnly:i,onSelectItem:a,onViewPack:o,selections:s}=e;const[l,c]=(0,Je.useState)(!1),u=n.name||n.packName||"Unknown Pack",d=(0,Je.useMemo)(()=>{const e=[];return(n.lumiaItems&&n.lumiaItems.length>0?n.lumiaItems:(n.items||[]).filter(e=>!e.loomCategory&&(e.lumiaDefName||e.lumiaName))).forEach((n,t)=>{const r=(e=>e.lumiaName||e.lumiaDefName)(n);if(!r)return;const i=!!(e=>e.lumiaDefinition||e.lumiaDef)(n),a=!!(e=>e.lumiaBehavior||e.lumia_behavior)(n),o=!!(e=>e.lumiaPersonality||e.lumia_personality)(n);i&&e.push(Ux(Ux({},n),{},{lumiaDefName:r,type:"definition",packName:u,id:"def-".concat(u,"-").concat(r,"-").concat(t)})),a&&e.push(Ux(Ux({},n),{},{lumiaDefName:r,type:"behavior",packName:u,id:"beh-".concat(u,"-").concat(r,"-").concat(t)})),o&&e.push(Ux(Ux({},n),{},{lumiaDefName:r,type:"personality",packName:u,id:"per-".concat(u,"-").concat(r,"-").concat(t)}))}),e},[n,u]),m=(0,Je.useMemo)(()=>{let e=d;if("all"!==t&&(e=e.filter(e=>e.type===t)),r){const n=r.toLowerCase();e=e.filter(e=>{const t=(Wx(e,"name")||"").toLowerCase(),r=(Wx(e,"def")||"").toLowerCase(),i=(Wx(e,"behavior")||"").toLowerCase(),a=(Wx(e,"personality")||"").toLowerCase();return t.includes(n)||r.includes(n)||i.includes(n)||a.includes(n)})}return i&&(e=e.filter(e=>Yx(e,e.type,s))),e},[d,t,r,i,s]);return 0===m.length?null:(0,nn.jsxs)("div",{className:"lumiverse-browser-pack",children:[(0,nn.jsx)(qx,{pack:n,isExpanded:l,onToggle:()=>c(!l),onViewPack:o,itemCount:m.length}),(0,nn.jsx)(Lt,{isOpen:l,className:"lumiverse-browser-pack-items",duration:200,children:(0,nn.jsx)(Kx,{items:m,filter:t,onSelectItem:a,selections:s})})]})}function Gx(e){let{packs:n,customPacks:t}=e;const r=(0,Je.useMemo)(()=>{let e=0,r=0,i=0;return[...n,...t].forEach(n=>{(n.lumiaItems&&n.lumiaItems.length>0?n.lumiaItems:(n.items||[]).filter(e=>!e.loomCategory)).forEach(n=>{(n.lumiaName||n.lumiaDefName)&&((n.lumiaDefinition||n.lumiaDef)&&e++,(n.lumiaBehavior||n.lumia_behavior)&&r++,(n.lumiaPersonality||n.lumia_personality)&&i++)})}),{definitions:e,behaviors:r,personalities:i,total:n.length+t.length}},[n,t]);return(0,nn.jsxs)("div",{className:"lumiverse-browser-stats",children:[(0,nn.jsxs)("div",{className:"lumiverse-browser-stat",children:[(0,nn.jsx)("span",{className:"lumiverse-browser-stat-value",children:r.total}),(0,nn.jsx)("span",{className:"lumiverse-browser-stat-label",children:"PACKS"})]}),(0,nn.jsxs)("div",{className:"lumiverse-browser-stat",children:[(0,nn.jsx)("span",{className:"lumiverse-browser-stat-value",children:r.definitions}),(0,nn.jsx)("span",{className:"lumiverse-browser-stat-label",children:"DEFS"})]}),(0,nn.jsxs)("div",{className:"lumiverse-browser-stat",children:[(0,nn.jsx)("span",{className:"lumiverse-browser-stat-value",children:r.behaviors}),(0,nn.jsx)("span",{className:"lumiverse-browser-stat-label",children:"BEHAV"})]}),(0,nn.jsxs)("div",{className:"lumiverse-browser-stat",children:[(0,nn.jsx)("span",{className:"lumiverse-browser-stat-value",children:r.personalities}),(0,nn.jsx)("span",{className:"lumiverse-browser-stat-label",children:"PERS"})]})]})}const Xx=function(){const{packs:e,customPacks:n}=Vn(),t=Wn(),r=Nn(),[i,a]=(0,Je.useState)(""),[o,s]=(0,Je.useState)("all"),[l,c]=(0,Je.useState)(!1),u=(0,Je.useMemo)(()=>{let e=0;return t.definition&&(e+=1),e+=(t.behaviors||[]).length,e+=(t.personalities||[]).length,e},[t]),d=(0,Je.useMemo)(()=>[...e.map(e=>Ux(Ux({},e),{},{isCustom:!1})),...n.map(e=>Ux(Ux({},e),{},{isCustom:!0}))],[e,n]),m=(0,Je.useCallback)((e,n)=>{console.log("[PackBrowser] Selected item:",e,n);const t={packName:e.packName,itemName:Wx(e,"name")};"definition"===n?r.setSelectedDefinition(t):"behavior"===n?r.toggleBehavior(t):"personality"===n&&r.togglePersonality(t),yn()},[r]),p=(0,Je.useCallback)(e=>{r.openPackDetail(e)},[r]),g=(0,Je.useCallback)(()=>{r.clearAllSelections(),yn()},[r]);return(0,nn.jsxs)("div",{className:"lumiverse-pack-browser",children:[(0,nn.jsx)(Gx,{packs:e,customPacks:n}),(0,nn.jsx)(Hx,{value:i,onChange:a,placeholder:"Search packs and items..."}),(0,nn.jsx)(Vx,{activeFilter:o,onFilterChange:s,showSelectedOnly:l,onToggleSelectedOnly:()=>c(!l),selectedCount:u}),(0,nn.jsx)("div",{className:"lumiverse-browser-packs",children:0===d.length?(0,nn.jsxs)("div",{className:"lumiverse-browser-empty",children:[(0,nn.jsx)("span",{className:"lumiverse-browser-empty-icon",children:(0,nn.jsx)(et,{size:32,strokeWidth:1.5})}),(0,nn.jsx)("p",{children:"No packs loaded"}),(0,nn.jsx)("span",{className:"lumiverse-browser-empty-hint",children:"Add packs in the Settings panel"})]}):l&&0===u?(0,nn.jsxs)("div",{className:"lumiverse-browser-empty",children:[(0,nn.jsx)("span",{className:"lumiverse-browser-empty-icon",children:(0,nn.jsx)(wf,{size:32,strokeWidth:1.5})}),(0,nn.jsx)("p",{children:"No items selected"}),(0,nn.jsx)("span",{className:"lumiverse-browser-empty-hint",children:"Select items to see them here, or disable the filter"})]}):d.map((e,n)=>(0,nn.jsx)(Qx,{pack:e,filter:o,searchQuery:i,showSelectedOnly:l,onSelectItem:m,onViewPack:p,selections:t},e.name||e.packName||"pack-".concat(n)))}),(0,nn.jsx)(si,{children:u>0&&(0,nn.jsxs)(em.button,{className:"lumiverse-browser-clear-all",onClick:g,initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0,y:8},transition:{duration:.2},type:"button",children:[(0,nn.jsx)(tt,{size:14,strokeWidth:1.5}),(0,nn.jsx)("span",{children:"Clear All Selections"}),(0,nn.jsx)("span",{className:"lumiverse-browser-clear-count",children:u})]})})]})},Zx=Jn("type",[["path",{d:"M12 4v16",key:"1654pz"}],["path",{d:"M4 7V5a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v2",key:"e0r10z"}],["path",{d:"M9 20h6",key:"s66wpe"}]]),Jx=Jn("quote",[["path",{d:"M16 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z",key:"rib7q0"}],["path",{d:"M5 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z",key:"1ymkrd"}]]);function ey(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function ny(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?ey(Object(t),!0).forEach(function(n){ty(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ey(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function ty(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const ry=wn;function iy(e){let{id:n,Icon:t,title:r,description:i,selected:a,onChange:o}=e;return(0,nn.jsxs)("label",{className:at("lumiverse-vp-style-option",a&&"lumiverse-vp-style-option--selected"),children:[(0,nn.jsx)("input",{type:"radio",name:"ooc-style",value:n,checked:a,onChange:()=>o(n)}),(0,nn.jsx)("span",{className:"lumiverse-vp-style-option-icon",children:(0,nn.jsx)(t,{size:20,strokeWidth:1.5})}),(0,nn.jsxs)("div",{className:"lumiverse-vp-style-option-text",children:[(0,nn.jsx)("span",{className:"lumiverse-vp-style-option-title",children:r}),(0,nn.jsx)("span",{className:"lumiverse-vp-style-option-desc",children:i})]})]})}function ay(e){let{id:n,label:t,hint:r,value:i,onChange:a,placeholder:o,min:s=1}=e;return(0,nn.jsxs)("div",{className:"lumiverse-vp-field",children:[(0,nn.jsx)("label",{className:"lumiverse-vp-field-label",htmlFor:n,children:t}),(0,nn.jsx)("input",{type:"number",id:n,className:"lumiverse-vp-field-input",value:i,onChange:e=>a(e.target.value),placeholder:o,min:s}),r&&(0,nn.jsx)("span",{className:"lumiverse-vp-field-hint",children:r})]})}const oy=function(){Nn();const e=(0,Je.useSyncExternalStore)(ry.subscribe,()=>ry.getState().lumiaOOCInterval,()=>ry.getState().lumiaOOCInterval),n=(0,Je.useSyncExternalStore)(ry.subscribe,()=>ry.getState().lumiaOOCStyle||"social",()=>ry.getState().lumiaOOCStyle||"social"),t=(0,Je.useCallback)(e=>{const n=e?parseInt(e,10):null;ry.setState({lumiaOOCInterval:n}),kn()},[]),r=(0,Je.useCallback)(e=>{if(ry.setState({lumiaOOCStyle:e}),kn(),"undefined"!=typeof LumiverseBridge){const e=LumiverseBridge.getCallbacks();null!=e&&e.refreshOOCComments&&e.refreshOOCComments(!0)}},[]),i=[{id:"none",Icon:Zx,title:"None",description:"Raw text with no formatting"},{id:"social",Icon:tf,title:"Social Card",description:"Full card with avatar & animations"},{id:"margin",Icon:ef,title:"Margin Note",description:"Minimal hanging tag style"},{id:"whisper",Icon:Jx,title:"Whisper Bubble",description:"Soft ethereal thought bubble"}];return(0,nn.jsxs)("div",{className:"lumiverse-vp-settings-panel",children:[(0,nn.jsxs)("div",{className:"lumiverse-vp-settings-section",children:[(0,nn.jsxs)("div",{className:"lumiverse-vp-settings-section-header",children:[(0,nn.jsx)($t,{size:16,strokeWidth:1.5}),(0,nn.jsx)("span",{children:"Comment Trigger"})]}),(0,nn.jsx)("p",{className:"lumiverse-vp-settings-desc",children:"Automatically inject OOC instructions at message intervals."}),(0,nn.jsx)(ay,{id:"ooc-interval",label:"Message Interval",hint:"Triggers when message count is divisible by this number",value:(null==e?void 0:e.toString())||"",onChange:t,placeholder:"e.g., 10 (empty = disabled)"})]}),(0,nn.jsxs)("div",{className:"lumiverse-vp-settings-section",children:[(0,nn.jsxs)("div",{className:"lumiverse-vp-settings-section-header",children:[(0,nn.jsx)(nf,{size:16,strokeWidth:1.5}),(0,nn.jsx)("span",{children:"Display Style"})]}),(0,nn.jsx)("p",{className:"lumiverse-vp-settings-desc",children:"Choose how OOC comments appear in chat."}),(0,nn.jsx)("div",{className:"lumiverse-vp-style-options",children:i.map(e=>(0,nn.jsx)(iy,ny(ny({},e),{},{selected:n===e.id,onChange:r}),e.id))})]})]})},sy=Jn("hand",[["path",{d:"M18 11V6a2 2 0 0 0-2-2a2 2 0 0 0-2 2",key:"1fvzgz"}],["path",{d:"M14 10V4a2 2 0 0 0-2-2a2 2 0 0 0-2 2v2",key:"1kc0my"}],["path",{d:"M10 10.5V6a2 2 0 0 0-2-2a2 2 0 0 0-2 2v8",key:"10h0bg"}],["path",{d:"M18 8a2 2 0 1 1 4 0v6a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15",key:"1s1gnw"}]]);function ly(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function cy(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?ly(Object(t),!0).forEach(function(n){uy(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ly(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function uy(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const dy=wn,my={},py={enabled:!1,excludeLastMessage:!0,includeMessageInPrompt:!0},gy=()=>dy.getState().sovereignHand||py,vy=()=>dy.getState().contextFilters||my,hy=()=>dy.getState().chimeraMode||!1,fy=()=>dy.getState().councilMode||!1,by=()=>{var e;return(null===(e=dy.getState().selectedDefinitions)||void 0===e?void 0:e.length)||0},xy=()=>{var e;return(null===(e=dy.getState().councilMembers)||void 0===e?void 0:e.length)||0},yy=()=>dy.getState().lumiaQuirks||"",ky=()=>!1!==dy.getState().lumiaQuirksEnabled;function wy(e){let{id:n,checked:t,onChange:r,label:i,hint:a,disabled:o=!1}=e;return(0,nn.jsxs)("div",{className:at("lumiverse-vp-toggle-row",o&&"lumiverse-vp-toggle-row--disabled"),children:[(0,nn.jsxs)("label",{className:"lumiverse-vp-toggle-label",htmlFor:n,children:[(0,nn.jsx)("span",{className:"lumiverse-vp-toggle-text",children:i}),a&&(0,nn.jsx)("span",{className:"lumiverse-vp-toggle-hint",children:a})]}),(0,nn.jsxs)("div",{className:"lumiverse-vp-toggle-switch-wrapper",children:[(0,nn.jsx)("input",{type:"checkbox",id:n,className:"lumiverse-vp-toggle-input",checked:t,onChange:e=>r(e.target.checked),disabled:o}),(0,nn.jsx)("label",{htmlFor:n,className:"lumiverse-vp-toggle-switch-label",children:(0,nn.jsx)("div",{className:at("lumiverse-vp-toggle-track",t&&"lumiverse-vp-toggle-track--on",o&&"lumiverse-vp-toggle-track--disabled"),children:(0,nn.jsx)("div",{className:"lumiverse-vp-toggle-thumb"})})})]})]})}function jy(e){let{id:n,label:t,hint:r,value:i,onChange:a,min:o=0,max:s=100}=e;return(0,nn.jsxs)("div",{className:"lumiverse-vp-field lumiverse-vp-field--inline",children:[(0,nn.jsx)("label",{className:"lumiverse-vp-field-label",htmlFor:n,children:t}),(0,nn.jsx)("input",{type:"number",id:n,className:"lumiverse-vp-field-input lumiverse-vp-field-input--small",value:i,onChange:e=>a(parseInt(e.target.value,10)||0),min:o,max:s}),r&&(0,nn.jsx)("span",{className:"lumiverse-vp-field-hint",children:r})]})}function Sy(e){let{Icon:n,title:t,status:r,children:i,defaultOpen:a=!1}=e;const[o,s]=(0,Je.useState)(a);return(0,nn.jsxs)("div",{className:at("lumiverse-vp-collapsible",o&&"lumiverse-vp-collapsible--open"),children:[(0,nn.jsxs)("button",{className:"lumiverse-vp-collapsible-header",onClick:()=>s(!o),type:"button",children:[(0,nn.jsx)("span",{className:at("lumiverse-vp-collapsible-chevron",o&&"lumiverse-vp-collapsible-chevron--open"),children:(0,nn.jsx)(ot,{size:14,strokeWidth:2})}),(0,nn.jsx)("span",{className:"lumiverse-vp-collapsible-icon",children:(0,nn.jsx)(n,{size:16,strokeWidth:1.5})}),(0,nn.jsx)("span",{className:"lumiverse-vp-collapsible-title",children:t}),void 0!==r&&(0,nn.jsx)("span",{className:at("lumiverse-vp-collapsible-status",r&&"lumiverse-vp-collapsible-status--active"),children:r?"Active":"Inactive"})]}),(0,nn.jsx)(Lt,{isOpen:o,className:"lumiverse-vp-collapsible-content",duration:200,children:(0,nn.jsx)("div",{className:"lumiverse-vp-collapsible-inner",children:i})})]})}function Cy(e){let{items:n,muted:t=!1}=e;return(0,nn.jsxs)("div",{className:at("lumiverse-vp-info-box",t&&"lumiverse-vp-info-box--muted"),children:[(0,nn.jsxs)("div",{className:"lumiverse-vp-info-box-header",children:[(0,nn.jsx)(kf,{size:14,strokeWidth:2}),(0,nn.jsx)("span",{children:"When enabled:"})]}),(0,nn.jsx)("ul",{className:"lumiverse-vp-info-box-list",children:n.map((e,n)=>(0,nn.jsx)("li",{children:e},n))})]})}function Ny(e){let{id:n,label:t,hint:r,enabled:i,onToggle:a,depthValue:o,onDepthChange:s,depthLabel:l,depthHint:c}=e;return(0,nn.jsxs)("div",{className:"lumiverse-vp-filter-item",children:[(0,nn.jsx)(wy,{id:n,checked:i,onChange:a,label:t,hint:r}),(0,nn.jsx)(Lt,{isOpen:i&&void 0!==o,className:"lumiverse-vp-filter-options",duration:150,children:(0,nn.jsx)(jy,{id:"".concat(n,"-depth"),label:l||"Keep in last N messages",hint:c,value:o,onChange:s})})]})}const Py=function(){var e,n,t,r,i,a,o,s,l,c,u,d,m,p,g,v,h,f,b;const x=Nn(),y=(0,Je.useSyncExternalStore)(dy.subscribe,gy,gy),k=(0,Je.useSyncExternalStore)(dy.subscribe,vy,vy),w=(0,Je.useSyncExternalStore)(dy.subscribe,hy,hy),j=(0,Je.useSyncExternalStore)(dy.subscribe,fy,fy),S=(0,Je.useSyncExternalStore)(dy.subscribe,by,by),C=(0,Je.useSyncExternalStore)(dy.subscribe,xy,xy),N=(0,Je.useSyncExternalStore)(dy.subscribe,yy,yy),P=(0,Je.useSyncExternalStore)(dy.subscribe,ky,ky),[E,O]=(0,Je.useState)(N),[M,z]=(0,Je.useState)(!1),{reasoningSettings:T,startReplyWith:I,apiReasoning:L,postProcessing:D,handleApplyReasoningPreset:A,handleStartReplyWithChange:R,handleReasoningToggle:B,handleAPIReasoningToggle:_,handleReasoningEffortChange:U,handlePostProcessingChange:F,REASONING_EFFORT_LEVELS:W,POST_PROCESSING_OPTIONS:H}=Sr(),V=null!==(e=y.enabled)&&void 0!==e&&e,q=null!==(n=null===(t=k.htmlTags)||void 0===t?void 0:t.enabled)&&void 0!==n&&n,$=null!==(r=null===(i=k.htmlTags)||void 0===i?void 0:i.keepDepth)&&void 0!==r?r:3,Y=null!==(a=null===(o=k.htmlTags)||void 0===o?void 0:o.stripFonts)&&void 0!==a&&a,K=null!==(s=null===(l=k.htmlTags)||void 0===l?void 0:l.fontKeepDepth)&&void 0!==s?s:3,Q=null!==(c=null===(u=k.detailsBlocks)||void 0===u?void 0:u.enabled)&&void 0!==c&&c,G=null!==(d=null===(m=k.detailsBlocks)||void 0===m?void 0:m.keepDepth)&&void 0!==d?d:3,X=null!==(p=null===(g=k.loomItems)||void 0===g?void 0:g.enabled)&&void 0!==p&&p,Z=null!==(v=null===(h=k.loomItems)||void 0===h?void 0:h.keepDepth)&&void 0!==v?v:5,J=(0,Je.useCallback)((e,n)=>{const t=dy.getState(),r=e.split(".");if("sovereignHand"===r[0])dy.setState({sovereignHand:cy(cy({},t.sovereignHand),{},{[r[1]]:n})});else if("contextFilters"===r[0]){var i;const e=r[1],a=r[2];dy.setState({contextFilters:cy(cy({},t.contextFilters),{},{[e]:cy(cy({},(null===(i=t.contextFilters)||void 0===i?void 0:i[e])||{}),{},{[a]:n})})})}yn()},[]),ee=q||Q||X,ne=(0,Je.useCallback)(e=>{x.setChimeraMode(e),yn()},[x]),te=(0,Je.useCallback)(e=>{x.setCouncilMode(e),yn()},[x]),re=(0,Je.useCallback)(()=>{x.setLumiaQuirks(E),yn(),z(!1)},[x,E]),ie=(0,Je.useCallback)(()=>{O(N),z(!1)},[N]),ae=(0,Je.useCallback)(e=>{x.setLumiaQuirksEnabled(e),yn()},[x]),oe=w||j;return(0,nn.jsxs)("div",{className:"lumiverse-vp-settings-panel",children:[(0,nn.jsxs)(Sy,{Icon:Er,title:"Lumia Modes",status:oe,defaultOpen:!0,children:[(0,nn.jsx)("p",{className:"lumiverse-vp-settings-desc",children:"Configure special Lumia modes for unique character setups. These modes are mutually exclusive."}),(0,nn.jsxs)("div",{className:"lumiverse-vp-mode-option",children:[(0,nn.jsx)(wy,{id:"chimera-mode-toggle",checked:w,onChange:ne,label:"Chimera Mode",hint:"Fuse multiple physical definitions into one hybrid form"}),(0,nn.jsx)(Lt,{isOpen:w,className:"lumiverse-vp-mode-details",duration:150,children:(0,nn.jsx)(Cy,{items:["Select multiple definitions in the Definition modal","All selected forms will be fused into one Chimera","Currently ".concat(S," definition").concat(1!==S?"s":""," selected")]})})]}),(0,nn.jsxs)("div",{className:"lumiverse-vp-mode-option",children:[(0,nn.jsx)(wy,{id:"council-mode-toggle",checked:j,onChange:te,label:"Council Mode",hint:"Multiple independent Lumias that collaborate"}),(0,nn.jsxs)(Lt,{isOpen:j,className:"lumiverse-vp-mode-details",duration:150,children:[(0,nn.jsx)(Cy,{items:["Each council member has independent traits","Members can converse and collaborate","Currently ".concat(C," council member").concat(1!==C?"s":"")]}),(0,nn.jsx)("p",{className:"lumiverse-vp-mode-note",children:"Configure council members in the Council tab."})]})]}),(0,nn.jsxs)("div",{className:at("lumiverse-vp-quirks-section",!P&&"lumiverse-vp-quirks-section--disabled"),children:[(0,nn.jsxs)("div",{className:"lumiverse-vp-quirks-header",children:[(0,nn.jsxs)("div",{className:"lumiverse-vp-quirks-header-left",children:[(0,nn.jsx)("span",{className:"lumiverse-vp-quirks-label",children:"Behavioral Quirks"}),(0,nn.jsx)("button",{className:at("lumiverse-vp-quirks-toggle",P&&"lumiverse-vp-quirks-toggle--on"),onClick:()=>ae(!P),title:P?"Disable quirks":"Enable quirks",type:"button","aria-pressed":P,children:(0,nn.jsx)("span",{className:"lumiverse-vp-quirks-toggle-track",children:(0,nn.jsx)("span",{className:"lumiverse-vp-quirks-toggle-thumb"})})})]}),!M&&P&&(0,nn.jsx)("button",{className:"lumiverse-vp-quirks-edit-btn",onClick:()=>z(!0),title:"Edit quirks",type:"button",children:(0,nn.jsx)(nt,{size:12,strokeWidth:1.5})})]}),(0,nn.jsxs)("p",{className:"lumiverse-vp-quirks-hint",children:["Extra behavioral modifications. Use ",(0,nn.jsx)("code",{children:"{{lumiaQuirks}}"})]}),M&&P?(0,nn.jsxs)("div",{className:"lumiverse-vp-quirks-edit",children:[(0,nn.jsx)("textarea",{className:"lumiverse-vp-quirks-textarea",placeholder:"Enter behavioral quirks...",value:E,onChange:e=>O(e.target.value),rows:3}),(0,nn.jsxs)("div",{className:"lumiverse-vp-quirks-actions",children:[(0,nn.jsxs)("button",{className:"lumiverse-vp-quirks-btn lumiverse-vp-quirks-btn--primary",onClick:re,type:"button",children:[(0,nn.jsx)(rm,{size:12,strokeWidth:2})," Save"]}),(0,nn.jsxs)("button",{className:"lumiverse-vp-quirks-btn",onClick:ie,type:"button",children:[(0,nn.jsx)(Wt,{size:12,strokeWidth:2})," Cancel"]})]})]}):(0,nn.jsx)("div",{className:"lumiverse-vp-quirks-preview",children:null!=N&&N.trim()?(0,nn.jsx)("span",{className:"lumiverse-vp-quirks-text",children:N}):(0,nn.jsx)("span",{className:"lumiverse-vp-quirks-empty",children:"No quirks set"})})]})]}),(0,nn.jsxs)(Sy,{Icon:_t,title:"Reasoning / CoT",status:(null==T?void 0:T.auto_parse)||L.enabled,defaultOpen:!1,children:[(0,nn.jsx)("p",{className:"lumiverse-vp-settings-desc",children:"Configure reasoning/chain-of-thought settings for AI models. Changes sync with the Chat Presets modal."}),(0,nn.jsx)(Or,{reasoningSettings:T,startReplyWith:I,apiReasoning:L,postProcessing:D,onApplyReasoningPreset:A,onStartReplyWithChange:R,onReasoningToggle:B,onAPIReasoningToggle:_,onReasoningEffortChange:U,onPostProcessingChange:F,effortLevels:W,postProcessingOptions:H,compact:!0})]}),(0,nn.jsxs)(Sy,{Icon:sy,title:"Sovereign Hand",status:V,defaultOpen:!0,children:[(0,nn.jsx)("p",{className:"lumiverse-vp-settings-desc",children:"Enable Sovereign Hand integration to use advanced prompt manipulation features."}),(0,nn.jsx)(wy,{id:"sovereign-hand-toggle",checked:V,onChange:e=>J("sovereignHand.enabled",e),label:"Use Sovereign Hand Features",hint:"Enables Sovereign Hand macros for advanced prompt control"}),(0,nn.jsx)(wy,{id:"sovereign-hand-exclude-toggle",checked:null===(f=y.excludeLastMessage)||void 0===f||f,onChange:e=>J("sovereignHand.excludeLastMessage",e),label:"Exclude Last Message from Context",hint:"When enabled, removes the last user message from the outgoing context",disabled:!V}),(0,nn.jsx)(wy,{id:"sovereign-hand-include-in-prompt-toggle",checked:null===(b=y.includeMessageInPrompt)||void 0===b||b,onChange:e=>J("sovereignHand.includeMessageInPrompt",e),label:"Include Message in Master Prompt",hint:"When enabled, includes the user message in the {{loomSovHand}} macro output",disabled:!V}),(0,nn.jsx)(Cy,{muted:!V,items:[(0,nn.jsxs)(nn.Fragment,{children:[(0,nn.jsx)("code",{children:"{{loomLastUserMessage}}"})," returns the last user message"]}),(0,nn.jsxs)(nn.Fragment,{children:[(0,nn.jsx)("code",{children:"{{loomLastCharMessage}}"})," returns the last character message"]}),(0,nn.jsxs)(nn.Fragment,{children:[(0,nn.jsx)("code",{children:"{{lastMessageName}}"})," returns the name of whoever sent the last message"]}),(0,nn.jsxs)(nn.Fragment,{children:[(0,nn.jsx)("code",{children:"{{loomContinuePrompt}}"})," adds continuation instructions when character spoke last"]})]})]}),(0,nn.jsxs)(Sy,{Icon:wf,title:"Context Filters",status:ee,children:[(0,nn.jsx)("p",{className:"lumiverse-vp-settings-desc",children:"Filter out specific content from the chat context before sending to the AI."}),(0,nn.jsx)(Ny,{id:"filter-html",label:"Strip HTML Tags",hint:"Removes formatting tags: <div>, <span>, <b>, <i>, etc.",enabled:q,onToggle:e=>J("contextFilters.htmlTags.enabled",e),depthValue:$,onDepthChange:e=>J("contextFilters.htmlTags.keepDepth",e),depthLabel:"Keep HTML in last N messages",depthHint:"HTML tags in older messages will be stripped"}),(0,nn.jsx)(Lt,{isOpen:q,className:"lumiverse-vp-filter-sub",duration:200,children:(0,nn.jsx)(Ny,{id:"filter-fonts",label:"Also Strip Fonts",hint:"Remove <font> tags (used by some presets)",enabled:Y,onToggle:e=>J("contextFilters.htmlTags.stripFonts",e),depthValue:K,onDepthChange:e=>J("contextFilters.htmlTags.fontKeepDepth",e),depthLabel:"Keep fonts in last N messages",depthHint:"Font tags in older messages will be stripped"})}),(0,nn.jsx)(Ny,{id:"filter-details",label:"Filter Details Blocks",hint:"Removes <details> blocks from older messages",enabled:Q,onToggle:e=>J("contextFilters.detailsBlocks.enabled",e),depthValue:G,onDepthChange:e=>J("contextFilters.detailsBlocks.keepDepth",e),depthHint:"Messages beyond this depth will have <details> removed"}),(0,nn.jsx)(Ny,{id:"filter-loom",label:"Filter Loom Tags",hint:"Removes Lucid Loom-related tags from older messages",enabled:X,onToggle:e=>J("contextFilters.loomItems.enabled",e),depthValue:Z,onDepthChange:e=>J("contextFilters.loomItems.keepDepth",e),depthHint:"Loom tags in older messages will be stripped"})]})]})};function Ey(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function Oy(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Ey(Object(t),!0).forEach(function(n){My(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Ey(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function My(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const zy=wn,Ty=[];function Iy(e){const n=(0,Je.useRef)(!1),t=(0,Je.useRef)({x:0,y:0,time:0}),r=(0,Je.useCallback)(e=>{if(1===e.touches.length){const n=e.touches[0];t.current={x:n.clientX,y:n.clientY,time:Date.now()}}},[]),i=(0,Je.useCallback)(r=>{if(1===r.changedTouches.length){const i=r.changedTouches[0],a=Math.abs(i.clientX-t.current.x),o=Math.abs(i.clientY-t.current.y),s=Date.now()-t.current.time;a<10&&o<10&&s<500&&(r.preventDefault(),r.stopPropagation(),n.current=!0,e(r),setTimeout(()=>{n.current=!1},300))}},[e]);return{onClick:(0,Je.useCallback)(t=>{t.stopPropagation(),n.current||e(t)},[e]),onTouchStart:r,onTouchEnd:i}}const Ly=()=>zy.getState().councilMode||!1,Dy=()=>zy.getState().councilMembers||Ty;function Ay(e,n){return e?e.lumiaItems&&e.lumiaItems.length>0?e.lumiaItems.find(e=>e.lumiaName===n||e.lumiaDefName===n):e.items?e.items.find(e=>e.lumiaDefName===n):null:null}function Ry(e,n,t){const r=(Array.isArray(e)?e.reduce((e,n)=>Oy(Oy({},e),{},{[n.name||n.packName]:n}),{}):e)[n];if(!r)return t;const i=Ay(r,t);return(null==i?void 0:i.lumiaName)||(null==i?void 0:i.lumiaDefName)||t}function By(e){var n,t;let{member:r,packs:i,onUpdate:a,onRemove:o}=e;const[s,l]=(0,Je.useState)(!1),[c,u]=(0,Je.useState)(!1),[d,m]=(0,Je.useState)(r.role||""),p=Ry(i,r.packName,r.itemName),g=function(e,n,t){const r=(Array.isArray(e)?e.reduce((e,n)=>Oy(Oy({},e),{},{[n.name||n.packName]:n}),{}):e)[n];if(!r)return null;const i=Ay(r,t);return(null==i?void 0:i.avatarUrl)||(null==i?void 0:i.lumia_img)||null}(i,r.packName,r.itemName),v=()=>{a(r.id,{role:d}),u(!1)},h=(null===(n=r.behaviors)||void 0===n?void 0:n.length)||0,f=(null===(t=r.personalities)||void 0===t?void 0:t.length)||0;return(0,nn.jsxs)("div",{className:"lumiverse-council-member",children:[(0,nn.jsxs)("div",{className:"lumiverse-council-member-header",onPointerUp:e=>{e.stopPropagation(),e.preventDefault(),l(!s)},children:[(0,nn.jsx)("div",{className:"lumiverse-council-member-avatar",children:g?(0,nn.jsx)("img",{src:g,alt:p}):(0,nn.jsx)(nm,{size:20,strokeWidth:1.5})}),(0,nn.jsxs)("div",{className:"lumiverse-council-member-info",children:[(0,nn.jsx)("span",{className:"lumiverse-council-member-name",children:p}),r.role&&!c&&(0,nn.jsx)("span",{className:"lumiverse-council-member-role",children:r.role}),(0,nn.jsxs)("div",{className:"lumiverse-council-member-stats",children:[(0,nn.jsxs)("span",{className:"lumiverse-council-stat",children:[(0,nn.jsx)(Ut,{size:12})," ",h]}),(0,nn.jsxs)("span",{className:"lumiverse-council-stat",children:[(0,nn.jsx)(Rp,{size:12})," ",f]})]})]}),(0,nn.jsxs)("div",{className:"lumiverse-council-member-actions",children:[(0,nn.jsx)("button",{className:"lumiverse-council-btn",onPointerUp:e=>{e.stopPropagation(),e.preventDefault(),u(!0),l(!0)},title:"Edit role",type:"button",children:(0,nn.jsx)(nt,{size:14,strokeWidth:1.5})}),(0,nn.jsx)("button",{className:"lumiverse-council-btn lumiverse-council-btn--danger",onPointerUp:e=>{e.stopPropagation(),e.preventDefault(),o(r.id)},title:"Remove from council",type:"button",children:(0,nn.jsx)(tt,{size:14,strokeWidth:1.5})}),(0,nn.jsx)("span",{className:at("lumiverse-council-expand",s&&"lumiverse-council-expand--open"),children:(0,nn.jsx)(ot,{size:16,strokeWidth:2})})]})]}),s&&(0,nn.jsxs)("div",{className:"lumiverse-council-member-body",children:[c?(0,nn.jsxs)("div",{className:"lumiverse-council-role-edit",children:[(0,nn.jsx)("label",{children:"Role/Title:"}),(0,nn.jsxs)("div",{className:"lumiverse-council-role-input-row",children:[(0,nn.jsx)("input",{type:"text",className:"lumiverse-council-input",placeholder:"e.g., Leader, Advisor, Wildcard...",value:d,onChange:e=>m(e.target.value),onKeyDown:e=>{"Enter"===e.key&&v(),"Escape"===e.key&&(m(r.role||""),u(!1))},autoFocus:!0}),(0,nn.jsx)("button",{className:"lumiverse-council-btn lumiverse-council-btn--primary",onPointerUp:e=>{e.stopPropagation(),e.preventDefault(),v()},type:"button",children:(0,nn.jsx)(rm,{size:14,strokeWidth:2})}),(0,nn.jsx)("button",{className:"lumiverse-council-btn",onPointerUp:e=>{e.stopPropagation(),e.preventDefault(),m(r.role||""),u(!1)},type:"button",children:(0,nn.jsx)(Wt,{size:14,strokeWidth:2})})]})]}):(0,nn.jsxs)("div",{className:"lumiverse-council-role-display",children:[(0,nn.jsx)("span",{className:"lumiverse-council-role-label",children:"Role:"}),(0,nn.jsx)("span",{className:"lumiverse-council-role-value",children:r.role||(0,nn.jsx)("em",{children:"No role set"})})]}),(0,nn.jsxs)("div",{className:"lumiverse-council-traits-section",children:[(0,nn.jsxs)("div",{className:"lumiverse-council-traits-group",children:[(0,nn.jsxs)("span",{className:"lumiverse-council-traits-label",children:[(0,nn.jsx)(Ut,{size:14,strokeWidth:1.5})," Behaviors:"]}),h>0?(0,nn.jsx)("span",{className:"lumiverse-council-traits-list",children:r.behaviors.map(e=>Ry(i,e.packName,e.itemName)).join(", ")}):(0,nn.jsx)("span",{className:"lumiverse-council-traits-empty",children:"None selected"})]}),(0,nn.jsxs)("div",{className:"lumiverse-council-traits-group",children:[(0,nn.jsxs)("span",{className:"lumiverse-council-traits-label",children:[(0,nn.jsx)(Rp,{size:14,strokeWidth:1.5})," Personalities:"]}),f>0?(0,nn.jsx)("span",{className:"lumiverse-council-traits-list",children:r.personalities.map(e=>Ry(i,e.packName,e.itemName)).join(", ")}):(0,nn.jsx)("span",{className:"lumiverse-council-traits-empty",children:"None selected"})]})]}),(0,nn.jsx)("p",{className:"lumiverse-council-help-text",children:"Each member's inherent traits are auto-attached when added. Additional trait configuration coming soon."})]})]})}function _y(e){let{item:n,onSelect:t}=e;const r=Iy((0,Je.useCallback)(()=>{t(n)},[n,t]));return(0,nn.jsxs)("div",Oy(Oy({className:"lumiverse-council-add-item"},r),{},{role:"button",tabIndex:0,children:[(0,nn.jsx)("div",{className:"lumiverse-council-add-item-avatar",children:n.image?(0,nn.jsx)("img",{src:n.image,alt:n.displayName}):(0,nn.jsx)(nm,{size:16})}),(0,nn.jsxs)("div",{className:"lumiverse-council-add-item-info",children:[(0,nn.jsx)("span",{className:"lumiverse-council-add-item-name",children:n.displayName}),(0,nn.jsx)("span",{className:"lumiverse-council-add-item-pack",children:n.packName})]})]}))}function Uy(e){let{packs:n,existingMembers:t,onAdd:r,onClose:i}=e;const[a,o]=(0,Je.useState)(""),s="undefined"!=typeof window&&window.innerWidth<=600,l=(0,Je.useMemo)(()=>{const e=new Set(t.map(e=>"".concat(e.packName,":").concat(e.itemName))),r=[];if((Array.isArray(n)?n:Object.values(n||{})).forEach(n=>{const t=n.name||n.packName;n.lumiaItems&&n.lumiaItems.length>0?n.lumiaItems.forEach(n=>{const i=n.lumiaName||n.lumiaDefName,a=n.lumiaDefinition||n.lumiaDef;if(!i||!a)return;const o="".concat(t,":").concat(i);e.has(o)||r.push({packName:t,itemName:i,displayName:i,image:n.avatarUrl||n.lumia_img})}):n.items&&n.items.forEach(n=>{if(!n.lumiaDefName||!n.lumiaDef)return;const i="".concat(t,":").concat(n.lumiaDefName);e.has(i)||r.push({packName:t,itemName:n.lumiaDefName,displayName:n.lumiaDefName,image:n.lumia_img})})}),a.trim()){const e=a.toLowerCase();return r.filter(n=>n.displayName.toLowerCase().includes(e)||n.packName.toLowerCase().includes(e))}return r},[n,t,a]),c=(0,Je.useCallback)(e=>{r({packName:e.packName,itemName:e.itemName}),i()},[r,i]);return(0,nn.jsxs)("div",{className:"lumiverse-council-add-dropdown",onClick:e=>e.stopPropagation(),children:[(0,nn.jsxs)("div",{className:"lumiverse-council-add-header",children:[(0,nn.jsx)("input",{type:"text",className:"lumiverse-council-search",placeholder:"Search Lumias...",value:a,onChange:e=>o(e.target.value),autoFocus:!s}),(0,nn.jsx)("button",{className:"lumiverse-council-btn",onClick:i,title:"Close",type:"button",children:(0,nn.jsx)(Wt,{size:16,strokeWidth:2})})]}),(0,nn.jsx)("div",{className:"lumiverse-council-add-list",children:0===l.length?(0,nn.jsx)("div",{className:"lumiverse-council-add-empty",children:a?"No matching Lumias found":"All Lumias are already in the council"}):l.map(e=>(0,nn.jsx)(_y,{item:e,onSelect:c},"".concat(e.packName,":").concat(e.itemName)))})]})}function Fy(e){let{pack:n,onSelect:t}=e;const r=Iy((0,Je.useCallback)(()=>{t(n.packName)},[n.packName,t]));return(0,nn.jsxs)("div",Oy(Oy({className:"lumiverse-council-add-item lumiverse-council-pack-item"},r),{},{role:"button",tabIndex:0,children:[(0,nn.jsx)("div",{className:"lumiverse-council-add-item-avatar lumiverse-council-pack-icon",children:n.coverUrl?(0,nn.jsx)("img",{src:n.coverUrl,alt:n.packName}):(0,nn.jsx)(et,{size:18,strokeWidth:1.5})}),(0,nn.jsxs)("div",{className:"lumiverse-council-add-item-info",children:[(0,nn.jsx)("span",{className:"lumiverse-council-add-item-name",children:n.packName}),(0,nn.jsxs)("span",{className:"lumiverse-council-add-item-pack",children:[n.availableCount," Lumia",1!==n.availableCount?"s":""," available"]})]})]}))}function Wy(e){let{packs:n,existingMembers:t,onAddPack:r,onClose:i}=e;const[a,o]=(0,Je.useState)(""),s="undefined"!=typeof window&&window.innerWidth<=600,l=(0,Je.useMemo)(()=>{const e=new Set(t.map(e=>"".concat(e.packName,":").concat(e.itemName))),r=[];if((Array.isArray(n)?n:Object.values(n||{})).forEach(n=>{const t=n.name||n.packName;let i=0;n.lumiaItems&&n.lumiaItems.length>0?n.lumiaItems.forEach(n=>{const r=n.lumiaName||n.lumiaDefName,a=n.lumiaDefinition||n.lumiaDef;if(!r||!a)return;const o="".concat(t,":").concat(r);e.has(o)||i++}):n.items&&n.items.forEach(n=>{if(!n.lumiaDefName||!n.lumiaDef)return;const r="".concat(t,":").concat(n.lumiaDefName);e.has(r)||i++}),i>0&&r.push({packName:t,availableCount:i,coverUrl:n.coverUrl})}),a.trim()){const e=a.toLowerCase();return r.filter(n=>n.packName.toLowerCase().includes(e))}return r},[n,t,a]),c=(0,Je.useCallback)(e=>{r(e),i()},[r,i]);return(0,nn.jsxs)("div",{className:"lumiverse-council-add-dropdown lumiverse-council-pack-dropdown",onClick:e=>e.stopPropagation(),children:[(0,nn.jsxs)("div",{className:"lumiverse-council-add-header",children:[(0,nn.jsx)("input",{type:"text",className:"lumiverse-council-search",placeholder:"Search packs...",value:a,onChange:e=>o(e.target.value),autoFocus:!s}),(0,nn.jsx)("button",{className:"lumiverse-council-btn",onClick:i,title:"Close",type:"button",children:(0,nn.jsx)(Wt,{size:16,strokeWidth:2})})]}),(0,nn.jsx)("div",{className:"lumiverse-council-add-list",children:0===l.length?(0,nn.jsx)("div",{className:"lumiverse-council-add-empty",children:a?"No matching packs found":"All Lumias from all packs are already in the council"}):l.map(e=>(0,nn.jsx)(Fy,{pack:e,onSelect:c},e.packName))})]})}function Hy(){return(0,nn.jsxs)("div",{className:"lumiverse-council-empty",children:[(0,nn.jsx)("span",{className:"lumiverse-council-empty-icon",children:(0,nn.jsx)(nm,{size:32,strokeWidth:1.5})}),(0,nn.jsx)("h4",{children:"No Council Members"}),(0,nn.jsx)("p",{children:"Add Lumias to your council to create a collaborative group of independent characters."})]})}const Vy=function(){const e=Nn(),{allPacks:n}=Vn(),[t,r]=(0,Je.useState)(!1),[i,a]=(0,Je.useState)(!1),o=(0,Je.useSyncExternalStore)(zy.subscribe,Ly,Ly),s=(0,Je.useSyncExternalStore)(zy.subscribe,Dy,Dy),l=(0,Je.useCallback)(n=>{e.addCouncilMember(n),kn()},[e]),c=(0,Je.useCallback)(n=>{const t=e.addCouncilMembersFromPack(n);kn(),"undefined"!=typeof toastr&&(t>0?toastr.success("Added ".concat(t," Lumia").concat(1!==t?"s":"",' from "').concat(n,'" to the council')):toastr.info("No new Lumias to add from this pack"))},[e]),u=(0,Je.useCallback)((n,t)=>{e.updateCouncilMember(n,t),yn()},[e]),d=(0,Je.useCallback)(n=>{e.removeCouncilMember(n),kn()},[e]),m=(0,Je.useCallback)(n=>{e.setCouncilMode(n),kn()},[e]),p=(0,Je.useMemo)(()=>Array.isArray(n)?n.reduce((e,n)=>Oy(Oy({},e),{},{[n.name||n.packName]:n}),{}):n||{},[n]);return(0,nn.jsxs)("div",{className:"lumiverse-council-manager",children:[(0,nn.jsxs)("div",{className:"lumiverse-council-header",children:[(0,nn.jsxs)("h3",{className:"lumiverse-council-title",children:[(0,nn.jsx)(nm,{size:18,strokeWidth:1.5}),"Council of Lumiae"]}),(0,nn.jsxs)("label",{className:"lumiverse-council-mode-toggle",children:[(0,nn.jsx)("input",{type:"checkbox",checked:o,onChange:e=>m(e.target.checked)}),(0,nn.jsx)("span",{className:at("lumiverse-council-mode-switch",o&&"lumiverse-council-mode-switch--on"),children:(0,nn.jsx)("span",{className:"lumiverse-council-mode-thumb"})}),(0,nn.jsx)("span",{className:"lumiverse-council-mode-label",children:o?"Active":"Inactive"})]})]}),(0,nn.jsx)("p",{className:"lumiverse-council-desc",children:"Create a council of independent Lumias that collaborate, each with their own identity, behaviors, and personalities."}),(0,nn.jsx)("div",{className:"lumiverse-council-add-section",children:t?(0,nn.jsx)(Uy,{packs:p,existingMembers:s,onAdd:l,onClose:()=>r(!1)}):i?(0,nn.jsx)(Wy,{packs:p,existingMembers:s,onAddPack:c,onClose:()=>a(!1)}):(0,nn.jsxs)("div",{className:"lumiverse-council-add-buttons",children:[(0,nn.jsxs)("button",{className:"lumiverse-council-add-btn",onClick:()=>o&&r(!0),disabled:!o,title:o?"Add a council member":"Enable Council Mode first",type:"button",children:[(0,nn.jsx)(Ur,{size:16,strokeWidth:2}),(0,nn.jsx)("span",{children:"Add Member"})]}),(0,nn.jsxs)("button",{className:"lumiverse-council-add-btn lumiverse-council-add-btn--secondary",onClick:()=>o&&a(!0),disabled:!o,title:o?"Add all Lumias from a pack":"Enable Council Mode first",type:"button",children:[(0,nn.jsx)(et,{size:16,strokeWidth:2}),(0,nn.jsx)("span",{children:"Quick Add Pack"})]})]})}),(0,nn.jsx)("div",{className:"lumiverse-council-members",children:0===s.length?(0,nn.jsx)(Hy,{}):s.map(e=>(0,nn.jsx)(By,{member:e,packs:p,onUpdate:u,onRemove:d},e.id))}),s.length>0&&(0,nn.jsx)("div",{className:"lumiverse-council-help",children:(0,nn.jsxs)("p",{children:["Council members will each appear with their definition in the ",(0,nn.jsx)("code",{children:"{{lumiaDef}}"})," macro output. Their behaviors and personalities will be grouped per member."]})})]})},qy=Jn("cpu",[["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M17 20v2",key:"1rnc9c"}],["path",{d:"M17 2v2",key:"11trls"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M2 17h2",key:"7oei6x"}],["path",{d:"M2 7h2",key:"asdhe0"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"M20 17h2",key:"1fpfkl"}],["path",{d:"M20 7h2",key:"1o8tra"}],["path",{d:"M7 20v2",key:"4gnj0m"}],["path",{d:"M7 2v2",key:"1i4yhu"}],["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"8",y:"8",width:"8",height:"8",rx:"1",key:"z9xiuo"}]]),$y=Jn("refresh-ccw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]),Yy=Jn("scissors",[["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M8.12 8.12 12 12",key:"1alkpv"}],["path",{d:"M20 4 8.12 15.88",key:"xgtan2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M14.8 14.8 20 20",key:"ptml3r"}]]);function Ky(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function Qy(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Ky(Object(t),!0).forEach(function(n){Gy(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Ky(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Gy(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const Xy=wn,Zy={},Jy={enabled:!1,keepCount:50},ek=()=>Xy.getState().summarization||Zy,nk=()=>Xy.getState().messageTruncation||Jy,tk=()=>Xy.getState().chatChangeCounter||0,rk="loom_summary",ik={openai:{name:"OpenAI",placeholder:"gpt-4o-mini"},anthropic:{name:"Anthropic",placeholder:"claude-3-haiku-20240307"},google:{name:"Google AI",placeholder:"gemini-1.5-flash"},openrouter:{name:"OpenRouter",placeholder:"openai/gpt-4o-mini"},custom:{name:"Custom",placeholder:"your-model-name"}};function ak(e){let{Icon:n,title:t,children:r,defaultOpen:i=!1,status:a}=e;const[o,s]=(0,Je.useState)(i);return(0,nn.jsxs)("div",{className:at("lumiverse-vp-collapsible",o&&"lumiverse-vp-collapsible--open"),children:[(0,nn.jsxs)("button",{className:"lumiverse-vp-collapsible-header",onClick:()=>s(!o),type:"button",children:[(0,nn.jsx)("span",{className:at("lumiverse-vp-collapsible-chevron",o&&"lumiverse-vp-collapsible-chevron--open"),children:(0,nn.jsx)(ot,{size:14,strokeWidth:2})}),(0,nn.jsx)("span",{className:"lumiverse-vp-collapsible-icon",children:(0,nn.jsx)(n,{size:16,strokeWidth:1.5})}),(0,nn.jsx)("span",{className:"lumiverse-vp-collapsible-title",children:t}),void 0!==a&&(0,nn.jsx)("span",{className:at("lumiverse-vp-collapsible-status",a&&"lumiverse-vp-collapsible-status--active"),children:a?"Active":"Off"})]}),(0,nn.jsx)(Lt,{isOpen:o,className:"lumiverse-vp-collapsible-content",duration:200,children:(0,nn.jsx)("div",{className:"lumiverse-vp-collapsible-inner",children:r})})]})}function ok(e){let{id:n,checked:t,onChange:r,label:i,hint:a}=e;return(0,nn.jsxs)("div",{className:"lumiverse-vp-toggle-row",children:[(0,nn.jsxs)("label",{className:"lumiverse-vp-toggle-label",htmlFor:n,children:[(0,nn.jsx)("span",{className:"lumiverse-vp-toggle-text",children:i}),a&&(0,nn.jsx)("span",{className:"lumiverse-vp-toggle-hint",children:a})]}),(0,nn.jsxs)("div",{className:"lumiverse-vp-toggle-switch-wrapper",children:[(0,nn.jsx)("input",{type:"checkbox",id:n,className:"lumiverse-vp-toggle-input",checked:t,onChange:e=>r(e.target.checked)}),(0,nn.jsx)("label",{htmlFor:n,className:"lumiverse-vp-toggle-switch-label",children:(0,nn.jsx)("div",{className:at("lumiverse-vp-toggle-track",t&&"lumiverse-vp-toggle-track--on"),children:(0,nn.jsx)("div",{className:"lumiverse-vp-toggle-thumb"})})})]})]})}function sk(e){let{name:n,value:t,checked:r,onChange:i,label:a}=e;return(0,nn.jsxs)("label",{className:at("lumiverse-vp-radio-option",r&&"lumiverse-vp-radio-option--selected"),children:[(0,nn.jsx)("input",{type:"radio",name:n,value:t,checked:r,onChange:()=>i(t)}),(0,nn.jsx)("span",{className:"lumiverse-vp-radio-option-label",children:a})]})}function lk(e){let{id:n,label:t,hint:r,value:i,onChange:a,min:o,max:s,step:l=1}=e;return(0,nn.jsxs)("div",{className:"lumiverse-vp-field",children:[(0,nn.jsx)("label",{className:"lumiverse-vp-field-label",htmlFor:n,children:t}),(0,nn.jsx)("input",{type:"number",id:n,className:"lumiverse-vp-field-input lumiverse-vp-field-input--small",value:i,onChange:e=>a(parseFloat(e.target.value)||0),min:o,max:s,step:l}),r&&(0,nn.jsx)("span",{className:"lumiverse-vp-field-hint",children:r})]})}function ck(e){let{id:n,label:t,hint:r,value:i,onChange:a,placeholder:o,type:s="text"}=e;return(0,nn.jsxs)("div",{className:"lumiverse-vp-field",children:[(0,nn.jsx)("label",{className:"lumiverse-vp-field-label",htmlFor:n,children:t}),(0,nn.jsx)("input",{type:s,id:n,className:"lumiverse-vp-field-input",value:i,onChange:e=>a(e.target.value),placeholder:o}),r&&(0,nn.jsx)("span",{className:"lumiverse-vp-field-hint",children:r})]})}function uk(e){let{id:n,label:t,hint:r,value:i,onChange:a,options:o}=e;return(0,nn.jsxs)("div",{className:"lumiverse-vp-field",children:[(0,nn.jsx)("label",{className:"lumiverse-vp-field-label",htmlFor:n,children:t}),(0,nn.jsx)("select",{id:n,className:"lumiverse-vp-field-select",value:i,onChange:e=>a(e.target.value),children:o.map(e=>(0,nn.jsx)("option",{value:e.value,children:e.label},e.value))}),r&&(0,nn.jsx)("span",{className:"lumiverse-vp-field-hint",children:r})]})}function dk(e){let{hasContent:n,hasChat:t}=e;return t?n?(0,nn.jsxs)("div",{className:"lumiverse-vp-summary-status lumiverse-vp-summary-status--exists",children:[(0,nn.jsx)(rm,{size:16,strokeWidth:2}),(0,nn.jsx)("span",{children:"Summary exists for this chat"})]}):(0,nn.jsxs)("div",{className:"lumiverse-vp-summary-status lumiverse-vp-summary-status--empty",children:[(0,nn.jsx)(qt,{size:16,strokeWidth:2}),(0,nn.jsx)("span",{children:"No summary yet"})]}):(0,nn.jsxs)("div",{className:"lumiverse-vp-summary-status lumiverse-vp-summary-status--no-chat",children:[(0,nn.jsx)(qt,{size:16,strokeWidth:2}),(0,nn.jsx)("span",{children:"No active chat"})]})}function mk(e){let{Icon:n,label:t,onClick:r,disabled:i,variant:a="secondary",loading:o=!1,iconOnly:s=!1}=e;return(0,nn.jsxs)(em.button,{className:at("lumiverse-vp-action-btn","lumiverse-vp-action-btn--".concat(a),i&&"lumiverse-vp-action-btn--disabled",s&&"lumiverse-vp-action-btn--icon-only"),onClick:r,disabled:i||o,whileHover:i?{}:{scale:1.05},whileTap:i?{}:{scale:.95},type:"button",title:t,children:[o?(0,nn.jsx)("span",{className:"lumiverse-vp-action-btn-spinner"}):(0,nn.jsx)(n,{size:s?16:14,strokeWidth:2}),!s&&(0,nn.jsx)("span",{children:t})]})}function pk(){var e,n,t,r;const i=(0,Je.useSyncExternalStore)(Xy.subscribe,ek,ek),a=(0,Je.useSyncExternalStore)(Xy.subscribe,nk,nk),o=i.mode||"disabled",s=i.apiSource||"main",l=i.autoInterval||10,c=i.autoMessageContext||10,u=i.manualMessageContext||10,d=i.secondary||{},m=(0,Je.useCallback)(e=>{const n=Xy.getState().summarization||{};Xy.setState({summarization:Qy(Qy({},n),e)}),yn()},[]),p=(0,Je.useCallback)(e=>{const n=Xy.getState().summarization||{},t=n.secondary||{};Xy.setState({summarization:Qy(Qy({},n),{},{secondary:Qy(Qy({},t),e)})}),yn()},[]),g=(0,Je.useCallback)(e=>{const n=Xy.getState().messageTruncation||{};Xy.setState({messageTruncation:Qy(Qy({},n),e)}),yn()},[]),v=Object.entries(ik).map(e=>{let[n,t]=e;return{value:n,label:t.name}});return(0,nn.jsxs)("div",{className:"lumiverse-vp-summary-config",children:[(0,nn.jsxs)(ak,{Icon:Np,title:"Summarization Mode",status:"disabled"!==o,defaultOpen:!0,children:[(0,nn.jsxs)("div",{className:"lumiverse-vp-radio-group",children:[(0,nn.jsx)(sk,{name:"sum-mode",value:"disabled",checked:"disabled"===o,onChange:e=>m({mode:e}),label:"Disabled"}),(0,nn.jsx)(sk,{name:"sum-mode",value:"auto",checked:"auto"===o,onChange:e=>m({mode:e}),label:"Automatic"}),(0,nn.jsx)(sk,{name:"sum-mode",value:"manual",checked:"manual"===o,onChange:e=>m({mode:e}),label:"Manual"})]}),(0,nn.jsxs)("p",{className:"lumiverse-vp-settings-desc",children:["disabled"===o&&"Summarization is turned off.","auto"===o&&"Summaries are generated automatically at set intervals.","manual"===o&&"Use /loom-summarize command to generate summaries."]})]}),(0,nn.jsx)(Lt,{isOpen:"auto"===o,duration:200,children:(0,nn.jsx)(ak,{Icon:$t,title:"Auto Settings",defaultOpen:!0,children:(0,nn.jsxs)("div",{className:"lumiverse-vp-field-row",children:[(0,nn.jsx)(lk,{id:"sum-interval",label:"Interval",hint:"Every N messages",value:l,onChange:e=>m({autoInterval:e}),min:1}),(0,nn.jsx)(lk,{id:"sum-auto-context",label:"Context",hint:"Messages to include",value:c,onChange:e=>m({autoMessageContext:e}),min:1,max:100})]})})}),(0,nn.jsx)(Lt,{isOpen:"manual"===o||"auto"===o,duration:200,children:(0,nn.jsx)(ak,{Icon:ef,title:"Manual Context",defaultOpen:"manual"===o,children:(0,nn.jsx)(lk,{id:"sum-manual-context",label:"Messages to include",hint:"When using /loom-summarize command",value:u,onChange:e=>m({manualMessageContext:e}),min:1,max:100})})}),(0,nn.jsx)(Lt,{isOpen:"disabled"!==o,duration:200,children:(0,nn.jsx)(ak,{Icon:Bt,title:"API Source",defaultOpen:!1,children:(0,nn.jsxs)("div",{className:"lumiverse-vp-radio-group lumiverse-vp-radio-group--wide",children:[(0,nn.jsx)(sk,{name:"sum-source",value:"main",checked:"main"===s,onChange:e=>m({apiSource:e}),label:"Main API"}),(0,nn.jsx)(sk,{name:"sum-source",value:"secondary",checked:"secondary"===s,onChange:e=>m({apiSource:e}),label:"Secondary LLM"})]})})}),(0,nn.jsx)(Lt,{isOpen:"disabled"!==o&&"secondary"===s,duration:200,children:(0,nn.jsxs)(ak,{Icon:qy,title:"Secondary LLM",defaultOpen:!0,children:[(0,nn.jsx)(uk,{id:"sum-provider",label:"Provider",value:d.provider||"openai",onChange:e=>p({provider:e}),options:v,hint:"custom"!==d.provider?"Uses API key from SillyTavern settings":void 0}),(0,nn.jsx)(ck,{id:"sum-model",label:"Model",value:d.model||"",onChange:e=>p({model:e}),placeholder:null===(e=ik[d.provider||"openai"])||void 0===e?void 0:e.placeholder}),(0,nn.jsxs)(Lt,{isOpen:"custom"===d.provider,duration:200,children:[(0,nn.jsx)(ck,{id:"sum-endpoint",label:"Endpoint URL",value:d.endpoint||"",onChange:e=>p({endpoint:e}),placeholder:"https://your-api.com/v1/chat/completions"}),(0,nn.jsx)(ck,{id:"sum-apikey",label:"API Key",type:"password",value:d.apiKey||"",onChange:e=>p({apiKey:e}),placeholder:"Your API key"})]}),(0,nn.jsxs)("div",{className:"lumiverse-vp-field-row lumiverse-vp-field-row--3",children:[(0,nn.jsx)(lk,{id:"sum-temp",label:"Temp",value:null!==(n=d.temperature)&&void 0!==n?n:.7,onChange:e=>p({temperature:e}),min:0,max:2,step:.1}),(0,nn.jsx)(lk,{id:"sum-topp",label:"Top-P",value:null!==(t=d.topP)&&void 0!==t?t:1,onChange:e=>p({topP:e}),min:0,max:1,step:.05}),(0,nn.jsx)(lk,{id:"sum-maxtokens",label:"Max Tokens",value:d.maxTokens||8192,onChange:e=>p({maxTokens:e}),min:100,max:128e3})]})]})}),(0,nn.jsx)(Lt,{isOpen:"disabled"!==o&&("main"===s||"anthropic"===d.provider),duration:200,children:(0,nn.jsxs)(ak,{Icon:$y,title:"Claude Cache",defaultOpen:!1,children:[(0,nn.jsx)("p",{className:"lumiverse-vp-settings-desc",children:"If Claude seems to ignore changes to your Lumia definitions, clearing the cache will force fresh responses on the next summarization."}),(0,nn.jsx)(mk,{Icon:$y,label:"Clear Claude Cache",onClick:()=>{"undefined"!=typeof LumiverseBridge&&LumiverseBridge.clearClaudeCache?(LumiverseBridge.clearClaudeCache(),"undefined"!=typeof toastr&&toastr.success("Claude cache cleared! Next request will use fresh definitions.")):(console.warn("[SummaryEditor] clearClaudeCache not available"),"undefined"!=typeof toastr&&toastr.error("Cache clear function not available"))},variant:"secondary"})]})}),(0,nn.jsxs)(ak,{Icon:Yy,title:"Message Limit",status:a.enabled,children:[(0,nn.jsx)(ok,{id:"trunc-toggle",checked:a.enabled,onChange:e=>g({enabled:e}),label:"Limit Context Messages",hint:"Only send the last N messages to the AI"}),(0,nn.jsxs)(Lt,{isOpen:a.enabled,duration:200,children:[(0,nn.jsx)(lk,{id:"trunc-count",label:"Messages to keep",hint:"Number of recent messages to include",value:null!==(r=a.keepCount)&&void 0!==r?r:50,onChange:e=>g({keepCount:e}),min:5,max:500}),(0,nn.jsxs)("div",{className:"lumiverse-vp-warning-box",children:[(0,nn.jsx)(qt,{size:14,strokeWidth:2}),(0,nn.jsx)("span",{children:"Older messages will be excluded. Consider using summarization to preserve memories."})]})]})]})]})}function gk(){const[e,n]=(0,Je.useState)(""),[t,r]=(0,Je.useState)(""),[i,a]=(0,Je.useState)(!1),[o,s]=(0,Je.useState)(!1),[l,c]=(0,Je.useState)(!1),u=(0,Je.useRef)(null),d=(0,Je.useSyncExternalStore)(Xy.subscribe,tk,()=>0),m=e!==t,p=(e.trim().length,(0,Je.useCallback)(()=>{try{if("undefined"!=typeof SillyTavern){const e=SillyTavern.getContext(),t=(null==e?void 0:e.chat)&&e.chat.length>0;if(a(t),t&&e.chatMetadata){const t=e.chatMetadata[rk]||"";n(t),r(t)}else n(""),r("")}else a(!0),n(""),r("")}catch(e){console.warn("[SummaryEditor] Error loading summary:",e)}},[]));(0,Je.useEffect)(()=>{p()},[d]);const g=(0,Je.useCallback)(e=>{n(e.target.value)},[]),v=(0,Je.useCallback)(()=>{try{if("undefined"!=typeof SillyTavern){var n;const t=SillyTavern.getContext();t.chatMetadata||(t.chatMetadata={});const i=e.trim();i?t.chatMetadata[rk]=i:delete t.chatMetadata[rk],null===(n=t.saveMetadata)||void 0===n||n.call(t),"undefined"!=typeof LumiverseBridge&&LumiverseBridge.updateSummaryButtonState&&LumiverseBridge.updateSummaryButtonState(),r(i),s(!0),setTimeout(()=>s(!1),1500)}}catch(e){console.error("[SummaryEditor] Error saving summary:",e)}},[e]),h=(0,Je.useCallback)(()=>{if(confirm("Are you sure you want to clear the summary?")){n("");try{if("undefined"!=typeof SillyTavern){const n=SillyTavern.getContext();var e;if(n.chatMetadata)delete n.chatMetadata[rk],null===(e=n.saveMetadata)||void 0===e||e.call(n),"undefined"!=typeof LumiverseBridge&&LumiverseBridge.updateSummaryButtonState&&LumiverseBridge.updateSummaryButtonState()}r("")}catch(e){console.error("[SummaryEditor] Error clearing summary:",e)}}},[]),f=(0,Je.useCallback)(()=>{p()},[p]),b=(0,Je.useCallback)(async()=>{if(i&&!l){c(!0);try{if(void 0===window.LumiverseBridge)return console.error("[SummaryEditor] LumiverseBridge not available"),void("undefined"!=typeof toastr&&toastr.error("Summary bridge not available. Try refreshing the page."));if("function"!=typeof window.LumiverseBridge.getCallbacks)return console.error("[SummaryEditor] getCallbacks is not a function"),void("undefined"!=typeof toastr&&toastr.error("Summary callbacks not configured."));const e=window.LumiverseBridge.getCallbacks();if(!e.generateSummary)return console.error("[SummaryEditor] generateSummary callback not registered"),void("undefined"!=typeof toastr&&toastr.error("Summary generation not configured."));console.log("[SummaryEditor] Calling generateSummary callback...");const t=await e.generateSummary();console.log("[SummaryEditor] generateSummary returned:",t?"success":"no result"),t?(n(t),r(t),"undefined"!=typeof toastr&&toastr.success("Summary generated successfully!")):"undefined"!=typeof toastr&&toastr.warning("No summary was generated. Check your settings.")}catch(e){console.error("[SummaryEditor] Error generating summary:",e),"undefined"!=typeof toastr&&toastr.error("Summary generation failed: ".concat(e.message||"Unknown error"))}finally{c(!1)}}},[i,l]);return(0,nn.jsxs)(ak,{Icon:ef,title:"Summary Text",defaultOpen:!0,children:[(0,nn.jsx)(dk,{hasContent:t.length>0,hasChat:i}),(0,nn.jsx)("div",{className:"lumiverse-vp-summary-textarea-wrapper",children:(0,nn.jsx)("textarea",{ref:u,className:"lumiverse-vp-summary-textarea",value:e,onChange:g,placeholder:"Write or paste your Loom summary here...\n\nUse the structured format:\n**Completed Objectives**\n- ...\n\n**Focused Objectives**\n- ...\n\n**Foreshadowing Beats**\n- ...\n\n**Character States**\n- ...\n\n**World State**\n- ...\n\n**Tone & Atmosphere**\n- ...\n\n**Threads to Weave**\n- ...",disabled:!i})}),(0,nn.jsxs)("div",{className:"lumiverse-vp-summary-actions",children:[(0,nn.jsx)(mk,{Icon:pf,label:l?"Generating...":"Generate",onClick:b,disabled:!i,loading:l,variant:"primary",iconOnly:!0}),(0,nn.jsx)(mk,{Icon:Ht,label:"Refresh",onClick:f,disabled:!i,iconOnly:!0}),(0,nn.jsx)(mk,{Icon:tt,label:"Clear",onClick:h,disabled:!i||!t,variant:"danger",iconOnly:!0}),(0,nn.jsx)(mk,{Icon:o?rm:qh,label:o?"Saved!":"Save",onClick:v,disabled:!i||!m,variant:"primary",iconOnly:!0})]}),(0,nn.jsx)(si,{children:m&&(0,nn.jsx)(em.div,{className:"lumiverse-vp-summary-unsaved",initial:{opacity:0,y:5},animate:{opacity:1,y:0},exit:{opacity:0,y:5},children:(0,nn.jsx)("span",{children:"You have unsaved changes"})})})]})}const vk=function(){return(0,nn.jsxs)("div",{className:"lumiverse-vp-summary-editor",children:[(0,nn.jsx)(gk,{}),(0,nn.jsx)(pk,{})]})},hk=wn;const fk=function(){const[e,n]=(0,Je.useState)(!1),t=(0,Je.useSyncExternalStore)(hk.subscribe,()=>{var e;return null===(e=hk.getState().showLumiverseDrawer)||void 0===e||e},()=>{var e;return null===(e=hk.getState().showLumiverseDrawer)||void 0===e||e}),r=(0,Je.useCallback)(()=>{n(e=>!e)},[]),i=(0,Je.useCallback)(()=>{n(!1)},[]);return t?(0,nn.jsxs)(nn.Fragment,{children:[(0,nn.jsx)(Gb,{isVisible:e,onToggle:r,onClose:i,defaultTab:"profile",ProfileContent:gx,PresetsContent:wx,BrowserContent:Xx,OOCContent:oy,PromptContent:Py,CouncilContent:Vy,SummaryContent:vk}),(0,nn.jsx)(mb,{}),(0,nn.jsx)(Nb,{})]}):null};var bk=t(72),xk=t.n(bk),yk=t(825),kk=t.n(yk),wk=t(659),jk=t.n(wk),Sk=t(56),Ck=t.n(Sk),Nk=t(159),Pk=t.n(Nk),Ek=t(113),Ok=t.n(Ek),Mk=t(456),zk={};zk.styleTagTransform=Ok(),zk.setAttributes=Ck(),zk.insert=jk().bind(null,"head"),zk.domAPI=kk(),zk.insertStyleElement=Pk();xk()(Mk.A,zk);Mk.A&&Mk.A.locals&&Mk.A.locals;function Tk(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function Ik(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Tk(Object(t),!0).forEach(function(n){Lk(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Tk(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Lk(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}let Dk=null;"undefined"==typeof window||!window.React||window.React===Je||console.warn('[LumiverseUI] Warning: Multiple React instances detected. This may cause "Invalid hook call" errors (Error #158). The extension bundles its own React to ensure compatibility.');const Ak=new Map;let Rk=null;function Bk(e){const n=Ak.get(e);n&&(n.root.unmount(),n.element.remove(),Ak.delete(e),console.log("[LumiverseUI] Unmounted ".concat(e)))}const _k={mountSettingsPanel:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"lumiverse-settings-root",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(n&&(Rk=n,wn.syncFromExtension(n)),document.getElementById(e))return console.warn("[LumiverseUI] Settings panel already mounted"),()=>Bk(e);const t=document.getElementById("extensions_settings");if(!t)return console.error("[LumiverseUI] Could not find #extensions_settings container"),null;const r=document.createElement("div");r.className="lumia-injector-settings";const i=document.createElement("div");i.className="inline-drawer";const a=document.createElement("div");a.className="inline-drawer-toggle inline-drawer-header",a.innerHTML='\n        <b>Lumiverse Helper</b>\n        <span id="lumiverse-accordion-update-badge" class="lumiverse-accordion-badge" style="display: none;">New!</span>\n        <div class="inline-drawer-icon fa-solid fa-circle-chevron-down down"></div>\n    ',Dk=a;const o=document.createElement("div");o.className="inline-drawer-content";const s=document.createElement("div");s.id=e,o.appendChild(s),i.appendChild(a),i.appendChild(o),r.appendChild(i),t.appendChild(r);const l=en.createRoot(s),c=Je.Fragment;return l.render((0,nn.jsx)(c,{children:(0,nn.jsx)(Sn,{initialSettings:Rk,children:(0,nn.jsx)(_b,{})})})),Ak.set(e,{root:l,element:r}),console.log("[LumiverseUI] Settings panel mounted with inline-drawer accordion"),()=>Bk(e)},mountViewportPanel:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const n="lumiverse-viewport-root",t=document.getElementById(n);t&&(t.remove(),Ak.delete(n)),e&&wn.syncFromExtension(e);const r=document.createElement("div");r.id=n,r.className="lumiverse-react-root lumiverse-viewport-container",r.style.position="fixed",r.style.top="0",r.style.right="0",r.style.bottom="0",r.style.left="auto",r.style.zIndex="9998",r.style.pointerEvents="none",document.body.appendChild(r);const i=en.createRoot(r),a=Je.Fragment;return i.render((0,nn.jsx)(a,{children:(0,nn.jsx)(Sn,{initialSettings:e,children:(0,nn.jsx)(fk,{})})})),Ak.set(n,{root:i,element:r}),console.log("[LumiverseUI] Viewport panel mounted with inline positioning"),()=>Bk(n)},mountComponent:function(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=(arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)||"lumiverse-mount-".concat(Date.now());if(Ak.has(r))return console.warn("[LumiverseUI] Component ".concat(r," already mounted")),()=>Bk(r);const i=document.createElement("div");i.id=r,i.className="lumiverse-react-root",n.appendChild(i);const a=en.createRoot(i),o=Je.Fragment;return a.render((0,nn.jsx)(o,{children:(0,nn.jsx)(Sn,{children:(0,nn.jsx)(e,Ik({},t))})})),Ak.set(r,{root:a,element:i}),()=>Bk(r)},unmount:Bk,unmountAll:function(){for(const[e]of Ak)Bk(e)},syncSettings:function(e){if(e){var n,t;const r=e.packs?Object.keys(e.packs).length:0;console.log("[LumiverseUI] syncSettings called with:",{packsCount:r,customPacksCount:(null===(n=e.customPacks)||void 0===n?void 0:n.length)||0}),wn.syncFromExtension(e);const i=wn.getState(),a=i.packs?Object.keys(i.packs).length:0;console.log("[LumiverseUI] After sync, store has:",{packsCount:a,customPacksCount:(null===(t=i.customPacks)||void 0===t?void 0:t.length)||0})}else console.warn("[LumiverseUI] syncSettings called with null/undefined settings")},getState:function(){return wn.exportForExtension()},subscribe:function(e){return wn.subscribe(e)},getStore:function(){return wn},updateAccordionBadge:function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"New!";const t=document.getElementById("lumiverse-accordion-update-badge");t&&(t.style.display=e?"inline-flex":"none",t.textContent=n)},getSTContext:function(){return"undefined"!=typeof SillyTavern?SillyTavern.getContext():(console.warn("[LumiverseUI] SillyTavern context not available"),null)}};console.log("[LumiverseUI] Bundle loaded, API available:",Object.keys(_k)),"undefined"!=typeof window&&(window.LumiverseUI=_k);const Uk={},Fk={};function Wk(e){if(!e)return e;let n=e;n=function(e){if(!e)return e;let n,t=e,r=0;do{if(++r>20)break;n=t,t=t.replace(/<div[^>]*style\s*=\s*["'][^"']*display\s*:\s*none[^"']*["'][^>]*>(\s*```[\s\S]*?```\s*)<\/div>/gi,"$1"),t=t.replace(/<div(?:\s[^>]*)?>([\s\S]*?)<\/div>/gi,"")}while(t!==n);return t=t.replace(/<\/div>/gi,""),t}(n);for(const e of Object.keys(Uk)){const t=Uk[e];t.open.lastIndex=0,t.close.lastIndex=0,n=n.replace(t.open,""),n=n.replace(t.close,"")}return n}function Hk(e){if(!e)return e;let n=e;return n=n.replace(/<font(?:\s[^>]*)?>/gi,""),n=n.replace(/<\/font>/gi,""),n}function Vk(e){if(!e)return e;let n,t=e,r=0;do{if(++r>20)break;n=t,t=t.replace(/<details(?:\s[^>]*)?>([\s\S]*?)<\/details>/gi,"")}while(t!==n);return t}function qk(e){if(!e)return e;let n=e;for(const e of Object.keys(Fk)){const t=Fk[e];t.paired.lastIndex=0,t.self.lastIndex=0,n=n.replace(t.paired,""),n=n.replace(t.self,"")}return n}function $k(e){if(!e||"string"!=typeof e)return e;let n=e.replace(/\n{3,}/g,"\n\n");return n=n.replace(/\n[ \t]*\n[ \t]*\n/g,"\n\n"),n}!function(){const e=["span","b","i","u","em","strong","s","strike","sub","sup","mark","small","big"];for(const n of e)Uk[n]={open:new RegExp("<".concat(n,"(?:\\s[^>]*)?>"),"gi"),close:new RegExp("</".concat(n,">"),"gi")};const n=["loom_sum","loom_if","loom_else","loom_endif","lumia_ooc","lumiaooc","lumio_ooc","lumioooc","loom_state","loom_memory","loom_context","loom_inject","loom_var","loom_set","loom_get","loom_record","loomrecord","loom_ledger","loomledger"];for(const e of n)Fk[e]={paired:new RegExp("<".concat(e,"(?:\\s[^>]*)?>([\\s\\S]*?)</").concat(e,">"),"gi"),self:new RegExp("<".concat(e,"(?:\\s[^>]*)?\\/?>"),"gi")}}(),globalThis.lumiverseHelperGenInterceptor=async function(e,n,t,r){var i,a,o,s,l,c,u,d,m,p,g,v,h,f;console.log("[".concat(D.pW,"] Generation interceptor called with type: ").concat(r)),(0,D.Ll)();const b=(0,D.mt)(),x=(null===(i=b.sovereignHand)||void 0===i?void 0:i.enabled)||!1,y=b.contextFilters||{},k=b.messageTruncation||{};if(k.enabled&&k.keepCount>0){const n=k.keepCount;if(e.length>n){const t=e.length-n;e.splice(0,t),console.log("[".concat(D.pW,"] Message Truncation: Removed ").concat(t," older messages, keeping last ").concat(n))}}const w=!1!==(null===(a=b.sovereignHand)||void 0===a?void 0:a.excludeLastMessage);if(x){let n=-1;for(let t=e.length-1;t>=0;t--)if(e[t]&&e[t].is_user){n=t;break}if(-1!==n){const t=e[n],r=t.mes||t.content||"";(0,U.a4)(r),(0,U.l5)(!0),console.log("[".concat(D.pW,"] Sovereign Hand: Captured last user message at index ").concat(n)),w&&(e.splice(n,1),console.log("[".concat(D.pW,"] Sovereign Hand: Removed last user message from context array")))}else(0,U.a4)(""),(0,U.l5)(!1),console.log("[".concat(D.pW,"] Sovereign Hand: No user message found (continuation mode)"))}else(0,U.a4)(""),(0,U.l5)(!1);const j=null!==(o=null===(s=y.htmlTags)||void 0===s?void 0:s.keepDepth)&&void 0!==o?o:3,S=null!==(l=null===(c=y.detailsBlocks)||void 0===c?void 0:c.keepDepth)&&void 0!==l?l:3,C=null!==(u=null===(d=y.loomItems)||void 0===d?void 0:d.keepDepth)&&void 0!==u?u:5,N=null!==(m=null===(p=y.htmlTags)||void 0===p?void 0:p.fontKeepDepth)&&void 0!==m?m:3,P=(null===(g=y.htmlTags)||void 0===g?void 0:g.enabled)||!1,E=(null===(v=y.htmlTags)||void 0===v?void 0:v.stripFonts)||!1,O=(null===(h=y.detailsBlocks)||void 0===h?void 0:h.enabled)||!1,M=(null===(f=y.loomItems)||void 0===f?void 0:f.enabled)||!1,z=P||E||O||M;for(let n=0;n<e.length;n++){const t=e.length-1-n,r=e=>{if(!e||"string"!=typeof e)return e;let n=e;return P&&t>=j&&(n=Wk(n)),P&&E&&t>=N&&(n=Hk(n)),O&&t>=S&&(n=Vk(n)),M&&t>=C&&(n=qk(n)),n};e[n]&&"string"==typeof e[n].content&&(e[n].content=(0,U.US)(e[n].content),z&&(e[n].content=r(e[n].content)),e[n].content=$k(e[n].content)),e[n]&&"string"==typeof e[n].mes&&(e[n].mes=(0,U.US)(e[n].mes),z&&(e[n].mes=r(e[n].mes)),e[n].mes=$k(e[n].mes))}return{chat:e,contextSize:n,abort:t}},jQuery(async()=>{console.log("[".concat(D.pW,"] jQuery initialization starting...")),console.log("[".concat(D.pW,"] window.LumiverseUI available:"),!!window.LumiverseUI);const e=(0,r.cj)(),n=(0,r.G1)();e&&n||console.error("[".concat(D.pW,"] ST APIs not available - extension may not work correctly")),(0,D.M5)();try{await(0,D.xg)()&&console.log("[".concat(D.pW,"] Pack file storage initialized"))}catch(e){console.error("[".concat(D.pW,"] Failed to initialize pack file storage:"),e)}!function(){const e=(0,r.zX)();e?((0,_.bP)(e),(0,U.MN)(e),e.registerMacro("lumiaMessageCount",{handler:()=>{const e=(0,r.SD)();return e&&e.chat?e.chat.length.toString():"0"},description:"Returns the current chat message count.",returns:"Number of messages as a string",returnType:"integer",exampleUsage:["{{lumiaMessageCount}}"]}),e.registerMacro("lumiaOOCTrigger",{handler:()=>(0,_.XN)(),description:"Returns OOC trigger countdown or activation message based on message count and interval setting.",returns:"Countdown text or 'OOC Commentary Time!' activation message",returnType:"string",exampleUsage:["{{lumiaOOCTrigger}}"]}),console.log("[".concat(D.pW,"] Macros registered successfully (Macros 2.0 format)"))):console.warn("[".concat(D.pW,"] MacrosParser not available - macros will not be registered"))}(),Ee(),Ze(),(0,R.xx)(R.YR),(0,R.Zl)(Ne),(0,Oe.Go)(R.YR),(0,Me.rq)("showSelectionModal",R.ry),(0,Me.rq)("showLoomSelectionModal",R.mR),(0,Me.rq)("showMiscFeaturesModal",R.GM),(0,Me.rq)("showSummarizationModal",R.Cm),(0,Me.rq)("showPromptSettingsModal",R.e2),(0,Me.rq)("showLumiaEditorModal",Oe.un),(0,Me.rq)("showLucidCardsModal",R.Dz),(0,Me.rq)("fetchWorldBook",()=>{const e=jQuery("#lumia-url-input-react").val()||jQuery("#lumia-url-input").val();(0,A.wn)(e).then(()=>{(0,R.YR)(),(0,Me.TC)()})}),(0,Me.rq)("handleNewBook",(e,n)=>{(0,A.importPack)(e,n,!1),(0,R.YR)(),(0,Me.TC)()}),(0,Me.rq)("refreshUIDisplay",()=>{(0,R.YR)(),(0,Me.TC)()}),(0,Me.rq)("refreshOOCComments",function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e?async function(){re();const e=window.scrollY;await Ce(!0),window.scrollTo(window.scrollX,e),console.log("[".concat(D.pW,"] Chunked OOC reprocessing complete"))}():Ne(e)}),(0,Me.rq)("generateSummary",async()=>await(0,B.Zq)(null,!0,!0)),console.log("[".concat(D.pW,"] About to initialize React UI..."));const i=document.getElementById("extensions_settings");if(console.log("[".concat(D.pW,"] extensions_settings container:"),i),i){await(0,Me.A5)(i)?console.log("[".concat(D.pW,"] React UI initialized successfully")):console.error("[".concat(D.pW,"] React UI failed to initialize - check console for errors"))}(0,R.YR)(),jQuery("#lumia-fetch-btn").on("click",()=>{const e=jQuery("#lumia-url-input").val();(0,A.wn)(e).then(()=>{(0,R.YR)(),(0,Me.TC)()})}),jQuery("#lumia-open-definitions-btn").on("click",()=>(0,R.ry)("definition")),jQuery("#lumia-open-behaviors-btn").on("click",()=>(0,R.ry)("behavior")),jQuery("#lumia-open-personalities-btn").on("click",()=>(0,R.ry)("personality")),jQuery("#lumia-open-misc-btn").on("click",()=>(0,R.GM)()),jQuery("#lumia-open-summarization-btn").on("click",()=>(0,R.Cm)()),jQuery("#lumia-open-prompt-settings-btn").on("click",()=>(0,R.e2)()),jQuery("#loom-open-style-btn").on("click",()=>(0,R.mR)("Narrative Style")),jQuery("#loom-open-utils-btn").on("click",()=>(0,R.mR)("Loom Utilities")),jQuery("#loom-open-retrofits-btn").on("click",()=>(0,R.mR)("Retrofits")),jQuery("#lumia-browse-lucid-btn").on("click",()=>(0,R.Dz)()),jQuery("#lumia-create-lumia-btn").on("click",()=>(0,Oe.un)()),jQuery("#lumia-upload-btn").on("click",()=>jQuery("#lumia-file-input").trigger("click")),jQuery("#lumia-file-input").on("change",e=>{const n=e.target.files[0];if(!n)return;const t=new FileReader;t.onload=e=>{try{const t=JSON.parse(e.target.result);(0,A.importPack)(t,n.name,!1),(0,R.YR)(),(0,Me.TC)()}catch(e){console.error("Lumia Injector Error:",e),toastr.error("Failed to parse: "+e.message)}},t.readAsText(n),e.target.value=""}),e&&n&&(e.on(n.CHARACTER_MESSAGE_RENDERED,e=>{console.log("[".concat(D.pW,"] CHARACTER_MESSAGE_RENDERED event for mesId ").concat(e)),ce(!1),(0,U.SE)(),(0,B.tb)();const n=(0,r.SD)();null!=n&&n.chat&&((0,_.UF)(n.chat.length-1),console.log("[".concat(D.pW,"] Tracked last AI message at index ").concat(n.chat.length-1)));const t=o('div[mesid="'.concat(e,'"] .mes_text'));if(t){var i;(0,U.vL)(t),function(e){const n=e.closest("div[mesid]");n&&Se(parseInt(n.getAttribute("mesid"),10))}(t);const r=null==n||null===(i=n.chat)||void 0===i?void 0:i[e],a=(null==r?void 0:r.mes)||(null==r?void 0:r.content)||"";/<lumi[ao]_?ooc[^>]*>/i.test(a)&&(console.log("[".concat(D.pW,"] Found OOC tags in raw content, scheduling OOC processing for message ").concat(e)),Se(e))}}),e.on(n.MESSAGE_EDITED,e=>{console.log("[".concat(D.pW,"] MESSAGE_EDITED event for mesId ").concat(e)),(0,U.a4)(""),(0,U.l5)(!1),fe(e);const n=o('div[mesid="'.concat(e,'"] .mes_text'));if(n){s("[data-lumia-ooc]",n).forEach(e=>e.remove())}Se(e,!0)}),e.on(n.MESSAGE_SWIPED,e=>{console.log("[".concat(D.pW,"] MESSAGE_SWIPED event for mesId ").concat(e)),(0,U.a4)(""),(0,U.l5)(!1),fe(e);const n=o('div[mesid="'.concat(e,'"] .mes_text'));if(n){s("[data-lumia-ooc]",n).forEach(e=>e.remove())}Se(e,!0)}),e.on(n.CHAT_CHANGED,()=>{console.log("[".concat(D.pW,"] CHAT_CHANGED event - resetting state and scheduling OOC reprocessing")),(0,U.a4)(""),(0,U.l5)(!1),re(),q=!0,console.log("[".concat(D.pW,"] RAF: State reset for fresh processing")),(0,_.UF)(-1),(0,U.SE)(),Pe(),requestAnimationFrame(()=>{(0,B.E)(),(0,R.updateLoomSummaryButtonState)()})}),e.on(n.GENERATION_STARTED,()=>{console.log("[".concat(D.pW,"] GENERATION_STARTED - disabling OOC observer processing")),ce(!0)}),e.on(n.GENERATION_ENDED,()=>{console.log("[".concat(D.pW,"] GENERATION_ENDED (error case) - resetting state")),ce(!1)}),e.on(n.GENERATION_STOPPED,()=>{console.log("[".concat(D.pW,"] GENERATION_STOPPED (user cancel) - resetting state")),ce(!1)})),function(){const e=document.getElementById("chat"),n=new MutationObserver(e=>{se?e.forEach(e=>{if("characterData"===e.type){var n;const t=null===(n=e.target.parentElement)||void 0===n?void 0:n.closest(".mes_text");t&&(0,U.vL)(t)}else"childList"===e.type&&e.addedNodes.forEach(e=>{if(e.nodeType===Node.ELEMENT_NODE){var n,t;const r=null!==(n=e.classList)&&void 0!==n&&n.contains("mes_text")?e:null===(t=e.querySelector)||void 0===t?void 0:t.call(e,".mes_text");r&&(0,U.vL)(r)}})}):e.forEach(e=>{if(e.addedNodes.forEach(e=>{if(e.nodeType!==Node.ELEMENT_NODE)return;let n=[];if(e.classList&&e.classList.contains("mes_text")?n=[e]:e.querySelectorAll&&(n=Array.from(e.querySelectorAll(".mes_text"))),e.nodeType===Node.TEXT_NODE||e.innerHTML&&(e.innerHTML.includes("<loom_sum>")||e.innerHTML.includes("&lt;loom_sum&gt;"))){const t=e.closest?e.closest(".mes_text"):null;t&&!n.includes(t)&&n.push(t)}n.forEach(e=>{var n;if((0,U.vL)(e),s("[data-lumia-ooc]",e).length>0)return;const t=e.closest("div[mesid]");if(!t)return;const i=parseInt(t.getAttribute("mesid"),10),a=(0,r.SD)(),o=null==a||null===(n=a.chat)||void 0===n?void 0:n[i],l=(null==o?void 0:o.mes)||(null==o?void 0:o.content)||"";/<lumi[ao]_?ooc[^>]*>/i.test(l)&&(console.log("[".concat(D.pW,"] Observer: Processing OOC tags in message ").concat(i)),Se(i))})}),"characterData"===e.type){var n;const t=null===(n=e.target.parentElement)||void 0===n?void 0:n.closest(".mes_text");t&&(0,U.vL)(t)}})}),t=e||document.body;n.observe(t,{childList:!0,subtree:!0,characterData:!0}),console.log("[".concat(D.pW,"] OOC observer started on ").concat(e?"chat element":"body (fallback)"))}(),console.log("[".concat(D.pW,"] Initial load - scheduling OOC processing")),Pe();const a=(0,r.ej)(),l=(0,r.Dr)();a&&l&&a.addCommandObject(l.fromProps({name:"loom-summarize",callback:async()=>{const e=(0,D.mt)().summarization;if(!e||"disabled"===e.mode)return toastr.warning("Summarization is disabled. Enable it in Lumia Injector settings."),"Summarization is disabled.";try{toastr.info("Generating loom summary...");return await(0,B.Zq)(null,!0)?(toastr.success("Loom summary generated and saved!"),"Summary generated successfully."):(toastr.warning("No summary generated. Check if there are messages to summarize."),"No summary generated.")}catch(e){return toastr.error("Summarization failed: ".concat(e.message)),"Error: ".concat(e.message)}},aliases:["loom-sum","summarize"],helpString:"Manually generate a loom summary of the current chat using your configured summarization settings (uses Manual Message Context)."})),window.addEventListener("beforeunload",async()=>{try{const{flushPendingSaves:e}=await Promise.resolve().then(t.bind(t,674));await e()}catch(e){console.warn("[".concat(D.pW,"] Error flushing saves on unload:"),e)}}),console.log("".concat(D.pW," initialized"))})})();
(()=>{"use strict";var e={20(e,n,t){var i=t(540),a=Symbol.for("react.element"),r=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,s=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,n,t){var i,r={},c=null,u=null;for(i in void 0!==t&&(c=""+t),void 0!==n.key&&(c=""+n.key),void 0!==n.ref&&(u=n.ref),n)o.call(n,i)&&!l.hasOwnProperty(i)&&(r[i]=n[i]);if(e&&e.defaultProps)for(i in n=e.defaultProps)void 0===r[i]&&(r[i]=n[i]);return{$$typeof:a,type:e,key:c,ref:u,props:r,_owner:s.current}}n.Fragment=r,n.jsx=c,n.jsxs=c},56(e,n,t){e.exports=function(e){var n=t.nc;n&&e.setAttribute("nonce",n)}},72(e){var n=[];function t(e){for(var t=-1,i=0;i<n.length;i++)if(n[i].identifier===e){t=i;break}return t}function i(e,i){for(var r={},o=[],s=0;s<e.length;s++){var l=e[s],c=i.base?l[0]+i.base:l[0],u=r[c]||0,d="".concat(c," ").concat(u);r[c]=u+1;var m=t(d),p={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==m)n[m].references++,n[m].updater(p);else{var h=a(p,i);i.byIndex=s,n.splice(s,0,{identifier:d,updater:h,references:1})}o.push(d)}return o}function a(e,n){var t=n.domAPI(n);t.update(e);return function(n){if(n){if(n.css===e.css&&n.media===e.media&&n.sourceMap===e.sourceMap&&n.supports===e.supports&&n.layer===e.layer)return;t.update(e=n)}else t.remove()}}e.exports=function(e,a){var r=i(e=e||[],a=a||{});return function(e){e=e||[];for(var o=0;o<r.length;o++){var s=t(r[o]);n[s].references--}for(var l=i(e,a),c=0;c<r.length;c++){var u=t(r[c]);0===n[u].references&&(n[u].updater(),n.splice(u,1))}r=l}}},92(e,n,t){function i(){return"undefined"!=typeof SillyTavern&&SillyTavern.getContext?SillyTavern.getContext():(console.error("[LumiverseHelper] SillyTavern global not available"),null)}function a(){const e=i();return(null==e?void 0:e.extensionSettings)||{}}function r(){const e=i();return(null==e?void 0:e.saveSettingsDebounced)||(()=>{})}function o(){const e=i();return(null==e?void 0:e.eventSource)||null}function s(){const e=i();return(null==e?void 0:e.eventTypes)||{}}function l(){var e,n,t;const a=i();return a?(console.log("[LumiverseHelper] Macro API detection:",{"ctx.macros":!!a.macros,"ctx.macros?.register":typeof(null===(e=a.macros)||void 0===e?void 0:e.register),"ctx.registerMacro":typeof a.registerMacro,"ctx.MacrosParser":!!a.MacrosParser}),"function"==typeof(null===(n=a.macros)||void 0===n?void 0:n.register)?(console.log("[LumiverseHelper] Using ctx.macros.register (Macros 2.0 API)"),{registerMacro:function(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;try{const i="function"==typeof n?n:()=>n;a.macros.register(e,{handler:i,description:t||"Lumiverse Helper macro: ".concat(e),category:"Lumiverse Helper"}),console.log("[LumiverseHelper] Registered macro via macros.register: ".concat(e))}catch(n){console.error("[LumiverseHelper] Failed to register macro ".concat(e," via macros.register:"),n)}}}):"function"==typeof a.registerMacro?(console.log("[LumiverseHelper] Using ctx.registerMacro (extension API)"),{registerMacro:(e,n)=>{try{a.registerMacro(e,n),console.log("[LumiverseHelper] Registered macro: ".concat(e))}catch(n){console.error("[LumiverseHelper] Failed to register macro ".concat(e,":"),n)}}}):null!==(t=a.MacrosParser)&&void 0!==t&&t.registerMacro?(console.log("[LumiverseHelper] Using ctx.MacrosParser (legacy fallback)"),{registerMacro:(e,n)=>{try{a.MacrosParser.registerMacro(e,n),console.log("[LumiverseHelper] Registered macro via MacrosParser: ".concat(e))}catch(n){console.error("[LumiverseHelper] Failed to register macro ".concat(e," via MacrosParser:"),n)}}}):(console.warn("[LumiverseHelper] No macro registration API found"),null)):(console.warn("[LumiverseHelper] Context not available for macro registration"),null)}function c(){const e=i();return null!=e&&e.SlashCommandParser?e.SlashCommandParser:"undefined"!=typeof SillyTavern&&SillyTavern.SlashCommandParser?SillyTavern.SlashCommandParser:void 0!==globalThis.SlashCommandParser?globalThis.SlashCommandParser:(console.warn("[LumiverseHelper] SlashCommandParser not available"),null)}function u(){const e=i();return null!=e&&e.SlashCommand?e.SlashCommand:"undefined"!=typeof SillyTavern&&SillyTavern.SlashCommand?SillyTavern.SlashCommand:void 0!==globalThis.SlashCommand?globalThis.SlashCommand:(console.warn("[LumiverseHelper] SlashCommand not available"),null)}function d(){const e=i();return null!=e&&e.getRequestHeaders?e.getRequestHeaders():{}}t.d(n,{Dr:()=>u,G1:()=>s,SD:()=>i,cj:()=>o,ej:()=>c,fJ:()=>a,kL:()=>r,oO:()=>d,zX:()=>l})},113(e){e.exports=function(e,n){if(n.styleSheet)n.styleSheet.cssText=e;else{for(;n.firstChild;)n.removeChild(n.firstChild);n.appendChild(document.createTextNode(e))}}},154(e,n,t){t.d(n,{Br:()=>r,ZD:()=>o,handleNewBook:()=>s,wn:()=>l});var i=t(674);function a(e){let n=e,t=null,i=null;const a=e.match(/\[lumia_img=([^\]]+)\]/);a&&(t=a[1].trim(),n=n.replace(a[0],"").trim());const r=e.match(/\[lumia_author=([^\]]+)\]/);return r&&(i=r[1].trim(),n=n.replace(r[0],"").trim()),{image:t,author:i,content:n}}function r(e,n){const t=(0,i.mt)().packs[e];return t?t.items.find(e=>e.lumiaDefName===n||e.loomName===n):null}function o(e){return e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"):e}function s(e,n){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=(0,i.mt)(),o=function(e){let n=[];if(Array.isArray(e))n=e;else{if(!e||!e.entries)return[];n=Object.values(e.entries)}const t=new Map,i=[];for(const e of n){if(!e.content||"string"!=typeof e.content)continue;const n=(e.comment||"").trim(),r=n.match(/^(.+?)\s*\(/);if(r){const t=r[1].trim();if("Loom Utilities"===t||"Retrofits"===t||"Narrative Style"===t){const a=n.match(/^(?:Loom Utilities|Retrofits|Narrative Style)\s*\((.+)\)\s*$/);if(!a)continue;const r=a[1].trim();i.push({loomName:r,loomCategory:t,loomContent:e.content.trim()});continue}}const o=n.match(/\((.+?)\)/);if(!o)continue;const s=o[1].trim();let l=t.get(s);l||(l={lumiaDefName:s,lumia_img:null,lumia_personality:null,lumia_behavior:null,lumiaDef:null,defAuthor:null},t.set(s,l));const c=n.toLowerCase();let u=null;if("Lumia_Description"===e.outletName||c.includes("definition")?u="definition":"Lumia_Behavior"===e.outletName||c.includes("behavior")?u="behavior":"Lumia_Personality"===e.outletName||c.includes("personality")?u="personality":(r&&"lumia"===r[1].trim().toLowerCase()||e.content.includes("[lumia_img="))&&(u="definition"),"definition"===u){const t=a(e.content);console.log('[Lumia Debug] Processing definition for "'.concat(s,'":'),{comment:n,type:u,extractedImage:t.image,contentPreview:e.content.substring(0,100)}),l.lumiaDef=t.content,t.image&&(l.lumia_img=t.image),t.author&&(l.defAuthor=t.author)}else if("behavior"===u)l.lumia_behavior=e.content;else if("personality"===u){const n=e.content.match(/{{setvar::lumia_behavior_\w+::([\s\S]*?)}}/),t=e.content.match(/{{setglobalvar::lumia_personality_\w+::([\s\S]*?)}}/);n&&!l.lumia_behavior&&(l.lumia_behavior=n[1].trim()),l.lumia_personality=t?t[1].trim():e.content}}const r=[...Array.from(t.values()),...i];return console.log("[Lumia Debug] Final processed items:",r.map(e=>({name:e.lumiaDefName||e.loomName,hasImage:!!e.lumia_img,image:e.lumia_img}))),r}(e);if(0!==o.length){if(!r.packs[n]||confirm('Pack "'.concat(n,'" already exists. Overwrite?')))return r.packs[n]={name:n,items:o,url:t?n:""},(0,i.DZ)(),toastr.success('Lumia Book "'.concat(n,'" loaded! Found ').concat(o.length," entries.")),o}else toastr.error("No valid Lumia entries found in this World Book.")}async function l(e){if(e)try{const n=document.getElementById("lumia-book-status");n&&(n.textContent="Fetching...");const t=await fetch(e);if(!t.ok)throw new Error("Network response was not ok");const i=await t.json();s(i,e.split("/").pop()||e,!0)}catch(e){console.error("Lumia Injector Error:",e);const n=document.getElementById("lumia-book-status");n&&(n.textContent="Error"),toastr.error("Failed to load book: "+e.message)}}},159(e){e.exports=function(e){var n=document.createElement("style");return e.setAttributes(n,e.attributes),e.insert(n,e.options),n}},199(e,n,t){t.d(n,{Go:()=>b,H3:()=>N,iY:()=>y,un:()=>C});var i=t(674),a=t(154);function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,i)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach(function(n){s(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function s(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,n||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const l='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>',c='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>',u='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>',d='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>',m='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path><line x1="12" y1="11" x2="12" y2="17"></line><line x1="9" y1="14" x2="15" y2="14"></line></svg>',p='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>',h='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>',v='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>',f={key:[],keysecondary:[],constant:!1,vectorized:!1,selective:!1,selectiveLogic:0,addMemo:!0,order:100,position:0,disable:!1,excludeRecursion:!1,preventRecursion:!1,delayUntilRecursion:!1,probability:100,useProbability:!0,depth:4,group:"",groupOverride:!1,groupWeight:100,scanDepth:null,caseSensitive:null,matchWholeWords:null,useGroupScoring:null,automationId:"",role:null,sticky:0,cooldown:0,delay:0};let g=null;function b(e){g=e}function x(){g&&g()}function y(e){const n=(0,i.mt)().packs[e];return!!n&&(!0===n.isCustom||!n.url)}function k(e,n,t){const i=e.lumiaDefName;let a="",r="";if("definition"===n){a="Lumia (".concat(i,")");let n=[];e.lumia_img&&n.push("[lumia_img=".concat(e.lumia_img,"]")),e.defAuthor&&n.push("[lumia_author=".concat(e.defAuthor,"]")),e.lumiaDef&&n.push(e.lumiaDef),r=n.join("\n")}else"behavior"===n?(a="Behavior (".concat(i,")"),r=e.lumia_behavior||""):"personality"===n&&(a="Personality (".concat(i,")"),r=e.lumia_personality||"");return o(o({},f),{},{uid:t,comment:a,content:r})}function w(e){const n=function(e){const n=(0,i.mt)().packs[e];if(!n)throw new Error('Pack "'.concat(e,'" not found'));const t={};let a=0;if(n.author||n.coverUrl){let e="";n.coverUrl&&(e+="[cover_img=".concat(n.coverUrl,"]")),n.author&&(e+="[author_name=".concat(n.author,"]")),t[a]=o(o({},f),{},{uid:a,comment:"Metadata",content:e}),a++}for(const e of n.items)e.lumiaDefName&&(e.lumiaDef&&(t[a]=k(e,"definition",a),a++),e.lumia_behavior&&(t[a]=k(e,"behavior",a),a++),e.lumia_personality&&(t[a]=k(e,"personality",a),a++));return{entries:t}}(e),t=JSON.stringify(n,null,2),a=new Blob([t],{type:"application/json"}),r=URL.createObjectURL(a),s=document.createElement("a");s.href=r,s.download="".concat(e.replace(/[^a-z0-9]/gi,"_"),"_worldbook.json"),document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(r),toastr.success('Pack "'.concat(e,'" exported successfully!'))}function j(e){const n=e[0];if(!n)return;const t=window.innerHeight||document.documentElement.clientHeight,i=(window.innerWidth||document.documentElement.clientWidth)<=600?24:48,a=t-i;n.style.maxHeight="".concat(a,"px");const r=e.find(".lumia-modal-header"),o=e.find(".lumia-modal-footer"),s=e.find(".lumia-modal-content");requestAnimationFrame(()=>{const e=r.length?r[0].offsetHeight:0,n=o.length?o[0].offsetHeight:0,t=a-e-n;s.length&&(s[0].style.maxHeight="".concat(t,"px"),s[0].style.overflowY="auto")});const l=()=>{const e=(window.innerHeight||document.documentElement.clientHeight)-i;n.style.maxHeight="".concat(e,"px");const t=e-(r.length?r[0].offsetHeight:0)-(o.length?o[0].offsetHeight:0);s.length&&(s[0].style.maxHeight="".concat(t,"px"))};window.addEventListener("resize",l),n._resizeCleanup=()=>window.removeEventListener("resize",l)}function S(e){const n=(0,i.mt)(),t=function(){const e=(0,i.mt)();return Object.values(e.packs).filter(e=>e.isCustom||!e.url)}();$("#lumia-pack-selector-modal").remove();let r="";r=t.length>0?t.map(e=>'\n      <div class="lumia-pack-option" data-pack="'.concat((0,a.ZD)(e.name),'">\n        <div class="lumia-pack-option-icon">\n          ').concat(d,'\n        </div>\n        <div class="lumia-pack-option-info">\n          <div class="lumia-pack-option-name">').concat((0,a.ZD)(e.name),'</div>\n          <div class="lumia-pack-option-meta">').concat(e.items.filter(e=>e.lumiaDefName).length," Lumias").concat(e.author?" â€¢ by ".concat((0,a.ZD)(e.author)):"",'</div>\n        </div>\n        <div class="lumia-pack-option-check">\n          ').concat(v,"\n        </div>\n      </div>\n    ")).join(""):'\n      <div class="lumia-pack-empty">\n        <p>No custom packs yet. Create your first one!</p>\n      </div>\n    ';const o='\n    <dialog id="lumia-pack-selector-modal" class="popup popup--animation-fast lumia-modal lumia-modal-pack-selector">\n      <div class="lumia-modal-header">\n        <div class="lumia-modal-header-icon">\n          '.concat(d,'\n        </div>\n        <div class="lumia-modal-header-text">\n          <h3 class="lumia-modal-title">Select Pack</h3>\n          <p class="lumia-modal-subtitle">Choose a pack to add your Lumia to</p>\n        </div>\n      </div>\n      <div class="lumia-modal-content">\n        <div class="lumia-pack-options">\n          ').concat(r,'\n        </div>\n\n        <div class="lumia-divider-text">or</div>\n\n        <div class="lumia-new-pack-section">\n          <div class="lumia-new-pack-header">\n            <span class="lumia-new-pack-icon">').concat(m,'</span>\n            <span>Create New Pack</span>\n          </div>\n          <div class="lumia-new-pack-form">\n            <input type="text" id="lumia-new-pack-name" class="lumia-input" placeholder="Pack name (required)" />\n            <input type="text" id="lumia-new-pack-author" class="lumia-input" placeholder="Author name (optional)" />\n            <input type="text" id="lumia-new-pack-cover" class="lumia-input" placeholder="Cover image URL (optional)" />\n            <button class="lumia-btn lumia-btn-primary lumia-btn-full lumia-create-pack-btn">\n              ').concat(l,'\n              <span>Create Pack</span>\n            </button>\n          </div>\n        </div>\n      </div>\n      <div class="lumia-modal-footer">\n        <button class="lumia-modal-btn lumia-modal-btn-secondary lumia-modal-close-btn">Cancel</button>\n      </div>\n    </dialog>\n  ');$("body").append(o);const s=$("#lumia-pack-selector-modal");j(s);const c=()=>{s[0]._resizeCleanup&&s[0]._resizeCleanup(),s[0].close(),s.remove()};s.on("click mousedown mouseup",function(e){e.stopPropagation(),"click"===e.type&&e.target===this&&c()}),s.find(".lumia-modal-close-btn").click(c),s.on("keydown",function(e){"Escape"===e.key&&c()}),s.find(".lumia-pack-option").click(function(){const n=$(this).data("pack");c(),e(n,!1)}),s.find(".lumia-create-pack-btn").click(function(){const t=$("#lumia-new-pack-name").val().trim(),a=$("#lumia-new-pack-author").val().trim(),r=$("#lumia-new-pack-cover").val().trim();if(t)if(n.packs[t])toastr.error('Pack "'.concat(t,'" already exists'));else try{!function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const a=(0,i.mt)();if(a.packs[e])throw new Error('Pack "'.concat(e,'" already exists'));const r={name:e,items:[],url:"",isCustom:!0,author:n,coverUrl:t};a.packs[e]=r,(0,i.DZ)()}(t,a,r),toastr.success('Pack "'.concat(t,'" created!')),c(),e(t,!0)}catch(e){toastr.error(e.message)}else toastr.error("Pack name is required")}),s[0].showModal()}function C(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const t=null!==e;if(!t&&!n)return void S((e,n)=>{C(null,e)});$("#lumia-editor-modal").remove();const r=t&&e.lumiaDefName||"",s=t&&e.lumia_img||"",u=t&&e.defAuthor||"",d=t&&e.lumiaDef||"",m=t&&e.lumia_personality||"",v=t&&e.lumia_behavior||"",f='\n    <dialog id="lumia-editor-modal" class="popup popup--animation-fast lumia-modal lumia-modal-editor">\n      <div class="lumia-modal-header">\n        <div class="lumia-modal-header-icon">\n          '.concat(t?c:l,'\n        </div>\n        <div class="lumia-modal-header-text">\n          <h3 class="lumia-modal-title">').concat(t?"Edit Lumia":"Create Lumia",'</h3>\n          <p class="lumia-modal-subtitle">Pack: ').concat((0,a.ZD)(n),'</p>\n        </div>\n      </div>\n      <div class="lumia-modal-content">\n        <div class="lumia-editor-form">\n          \x3c!-- Basic Info Section --\x3e\n          <div class="lumia-editor-section">\n            <div class="lumia-editor-section-header">\n              <span class="lumia-editor-section-icon">').concat(p,'</span>\n              <span>Basic Info</span>\n            </div>\n            <div class="lumia-editor-section-content">\n              <div class="lumia-editor-field">\n                <label class="lumia-editor-label" for="lumia-edit-name">\n                  Lumia Name <span class="lumia-required">*</span>\n                </label>\n                <input type="text" id="lumia-edit-name" class="lumia-input"\n                       placeholder="e.g., Aria, Luna, Sage"\n                       value="').concat((0,a.ZD)(r),'" />\n                <span class="lumia-editor-hint">Will be saved as "Lumia (Name)"</span>\n              </div>\n\n              <div class="lumia-editor-row">\n                <div class="lumia-editor-field lumia-editor-field-half">\n                  <label class="lumia-editor-label" for="lumia-edit-avatar">\n                    Avatar URL\n                  </label>\n                  <input type="text" id="lumia-edit-avatar" class="lumia-input"\n                         placeholder="https://..."\n                         value="').concat((0,a.ZD)(s),'" />\n                </div>\n                <div class="lumia-editor-field lumia-editor-field-half">\n                  <label class="lumia-editor-label" for="lumia-edit-author">\n                    Author\n                  </label>\n                  <input type="text" id="lumia-edit-author" class="lumia-input"\n                         placeholder="Your name"\n                         value="').concat((0,a.ZD)(u),'" />\n                </div>\n              </div>\n\n              ').concat(s?'<div class="lumia-editor-preview"><img src="'.concat((0,a.ZD)(s),'" alt="Avatar preview" loading="lazy" /><div class="lumia-preview-spinner"></div></div>'):"",'\n            </div>\n          </div>\n\n          \x3c!-- Physicality Section --\x3e\n          <div class="lumia-editor-section">\n            <div class="lumia-editor-section-header">\n              <span class="lumia-editor-section-icon">\n                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                  <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>\n                  <circle cx="12" cy="7" r="4"></circle>\n                </svg>\n              </span>\n              <span>Lumia Physicality</span>\n            </div>\n            <div class="lumia-editor-section-content">\n              <div class="lumia-editor-field">\n                <label class="lumia-editor-label" for="lumia-edit-physicality">\n                  Physical Definition\n                </label>\n                <textarea id="lumia-edit-physicality" class="lumia-textarea"\n                          placeholder="Describe Lumia\'s physical appearance, form, and presence..."\n                          rows="6">').concat((0,a.ZD)(d),'</textarea>\n                <span class="lumia-editor-hint">Injected via {{lumiaDef}} macro</span>\n              </div>\n            </div>\n          </div>\n\n          \x3c!-- Personality Section --\x3e\n          <div class="lumia-editor-section">\n            <div class="lumia-editor-section-header">\n              <span class="lumia-editor-section-icon">\n                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                  <circle cx="12" cy="12" r="10"></circle>\n                  <path d="M8 14s1.5 2 4 2 4-2 4-2"></path>\n                  <line x1="9" y1="9" x2="9.01" y2="9"></line>\n                  <line x1="15" y1="9" x2="15.01" y2="9"></line>\n                </svg>\n              </span>\n              <span>Lumia Personality</span>\n            </div>\n            <div class="lumia-editor-section-content">\n              <div class="lumia-editor-field">\n                <label class="lumia-editor-label" for="lumia-edit-personality">\n                  Personality Traits\n                </label>\n                <textarea id="lumia-edit-personality" class="lumia-textarea"\n                          placeholder="Describe Lumia\'s personality, disposition, and inner nature..."\n                          rows="6">').concat((0,a.ZD)(m),'</textarea>\n                <span class="lumia-editor-hint">Injected via {{lumiaPersonality}} macro</span>\n              </div>\n            </div>\n          </div>\n\n          \x3c!-- Behavior Section --\x3e\n          <div class="lumia-editor-section">\n            <div class="lumia-editor-section-header">\n              <span class="lumia-editor-section-icon">\n                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                  <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path>\n                </svg>\n              </span>\n              <span>Lumia Behavior Traits</span>\n            </div>\n            <div class="lumia-editor-section-content">\n              <div class="lumia-editor-field">\n                <label class="lumia-editor-label" for="lumia-edit-behavior">\n                  Behavioral Patterns\n                </label>\n                <textarea id="lumia-edit-behavior" class="lumia-textarea"\n                          placeholder="Describe Lumia\'s behavioral patterns, habits, and tendencies..."\n                          rows="6">').concat((0,a.ZD)(v),'</textarea>\n                <span class="lumia-editor-hint">Injected via {{lumiaBehavior}} macro</span>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n      <div class="lumia-modal-footer">\n        ').concat(t?'<button class="lumia-modal-btn lumia-modal-btn-danger lumia-editor-delete-btn">'.concat(h," Delete</button>"):"",'\n        <div class="lumia-modal-footer-spacer"></div>\n        <button class="lumia-modal-btn lumia-modal-btn-secondary lumia-modal-close-btn">Cancel</button>\n        <button class="lumia-modal-btn lumia-modal-btn-primary lumia-editor-save-btn">\n          ').concat(t?"Save Changes":"Create Lumia","\n        </button>\n      </div>\n    </dialog>\n  ");$("body").append(f);const g=$("#lumia-editor-modal");j(g);const b=()=>{g[0]._resizeCleanup&&g[0]._resizeCleanup(),g[0].close(),g.remove()};g.on("click mousedown mouseup",function(e){e.stopPropagation(),"click"===e.type&&e.target===this&&b()}),g.find(".lumia-modal-close-btn").click(b),g.on("keydown",function(e){"Escape"===e.key&&b()});const k=e=>{e[0].complete&&0!==e[0].naturalHeight?e.addClass("lumia-img-loaded"):(e.on("load",function(){$(this).addClass("lumia-img-loaded")}),e.on("error",function(){$(this).addClass("lumia-img-loaded"),$(this).css("display","none")}))};$("#lumia-edit-avatar").on("input",function(){const e=$(this).val().trim(),n=g.find(".lumia-editor-preview");if(e)if(n.length){const t=n.find("img");t.removeClass("lumia-img-loaded").css("display",""),t.attr("src",e),k(t)}else $(this).closest(".lumia-editor-row").after('<div class="lumia-editor-preview"><img src="'.concat((0,a.ZD)(e),'" alt="Avatar preview" loading="lazy" /><div class="lumia-preview-spinner"></div></div>')),k(g.find(".lumia-editor-preview img"));else n.remove()});const w=g.find(".lumia-editor-preview img");w.length&&k(w),g.find(".lumia-editor-save-btn").click(function(){const a=$("#lumia-edit-name").val().trim(),r=$("#lumia-edit-avatar").val().trim(),s=$("#lumia-edit-author").val().trim(),l=$("#lumia-edit-physicality").val().trim(),c=$("#lumia-edit-personality").val().trim(),u=$("#lumia-edit-behavior").val().trim();if(!a)return void toastr.error("Lumia name is required");const d=(0,i.mt)().packs[n];if(d){if(d.items.find(n=>n.lumiaDefName===a&&(!t||n.lumiaDefName!==e.lumiaDefName)))return void toastr.error('A Lumia named "'.concat(a,'" already exists in this pack'))}const m={lumiaDefName:a,lumia_img:r||null,defAuthor:s||null,lumiaDef:l||null,lumia_personality:c||null,lumia_behavior:u||null};try{!function(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const a=(0,i.mt)().packs[e];if(!a)throw new Error('Pack "'.concat(e,'" not found'));if(!y(e))throw new Error('Pack "'.concat(e,'" is not editable'));const r=t||n.lumiaDefName,s=a.items.findIndex(e=>e.lumiaDefName===r);s>=0?a.items[s]=o(o({},a.items[s]),n):a.items.push(n),(0,i.DZ)(),(0,i.JN)()}(n,m,t?e.lumiaDefName:null),toastr.success('Lumia "'.concat(a,t?'" updated!':'" created!')),b(),x()}catch(e){toastr.error(e.message)}}),t&&g.find(".lumia-editor-delete-btn").click(function(){if(confirm('Are you sure you want to delete "'.concat(e.lumiaDefName,'"? This cannot be undone.')))try{!function(e,n){const t=(0,i.mt)(),a=t.packs[e];if(!a)throw new Error('Pack "'.concat(e,'" not found'));if(!y(e))throw new Error('Pack "'.concat(e,'" is not editable'));const r=a.items.findIndex(e=>e.lumiaDefName===n);r>=0&&(a.items.splice(r,1),t.selectedDefinition&&t.selectedDefinition.packName===e&&t.selectedDefinition.itemName===n&&(t.selectedDefinition=null),t.selectedBehaviors=t.selectedBehaviors.filter(t=>!(t.packName===e&&t.itemName===n)),t.selectedPersonalities=t.selectedPersonalities.filter(t=>!(t.packName===e&&t.itemName===n)),t.dominantBehavior&&t.dominantBehavior.packName===e&&t.dominantBehavior.itemName===n&&(t.dominantBehavior=null),t.dominantPersonality&&t.dominantPersonality.packName===e&&t.dominantPersonality.itemName===n&&(t.dominantPersonality=null),(0,i.DZ)(),(0,i.JN)())}(n,e.lumiaDefName),toastr.success('Lumia "'.concat(e.lumiaDefName,'" deleted')),b(),x()}catch(e){toastr.error(e.message)}}),g[0].showModal()}function N(e){const n=(0,i.mt)().packs[e];if(!n)return void toastr.error('Pack "'.concat(e,'" not found'));if(!y(e))return void toastr.error('Pack "'.concat(e,'" cannot be edited'));$("#lumia-pack-editor-modal").remove();const t='\n    <dialog id="lumia-pack-editor-modal" class="popup popup--animation-fast lumia-modal lumia-modal-pack-editor">\n      <div class="lumia-modal-header">\n        <div class="lumia-modal-header-icon">\n          '.concat(c,'\n        </div>\n        <div class="lumia-modal-header-text">\n          <h3 class="lumia-modal-title">Edit Pack</h3>\n          <p class="lumia-modal-subtitle">').concat((0,a.ZD)(e),'</p>\n        </div>\n      </div>\n      <div class="lumia-modal-content">\n        <div class="lumia-editor-form">\n          <div class="lumia-editor-field">\n            <label class="lumia-editor-label" for="lumia-pack-author">\n              Author Name\n            </label>\n            <input type="text" id="lumia-pack-author" class="lumia-input"\n                   placeholder="Your name"\n                   value="').concat((0,a.ZD)(n.author||""),'" />\n          </div>\n\n          <div class="lumia-editor-field">\n            <label class="lumia-editor-label" for="lumia-pack-cover">\n              Cover Image URL\n            </label>\n            <input type="text" id="lumia-pack-cover" class="lumia-input"\n                   placeholder="https://..."\n                   value="').concat((0,a.ZD)(n.coverUrl||""),'" />\n          </div>\n\n          ').concat(n.coverUrl?'<div class="lumia-editor-preview lumia-pack-cover-preview"><img src="'.concat((0,a.ZD)(n.coverUrl),'" alt="Cover preview" loading="lazy" /><div class="lumia-preview-spinner"></div></div>'):"",'\n\n          <div class="lumia-divider-text">Export</div>\n\n          <button class="lumia-btn lumia-btn-secondary lumia-btn-full lumia-export-pack-btn">\n            ').concat(u,'\n            <span>Export as World Book</span>\n          </button>\n          <span class="lumia-editor-hint">Download this pack in SillyTavern World Book format</span>\n        </div>\n      </div>\n      <div class="lumia-modal-footer">\n        <button class="lumia-modal-btn lumia-modal-btn-secondary lumia-modal-close-btn">Cancel</button>\n        <button class="lumia-modal-btn lumia-modal-btn-primary lumia-pack-save-btn">Save Changes</button>\n      </div>\n    </dialog>\n  ');$("body").append(t);const r=$("#lumia-pack-editor-modal");j(r);const o=()=>{r[0]._resizeCleanup&&r[0]._resizeCleanup(),r[0].close(),r.remove()};r.on("click mousedown mouseup",function(e){e.stopPropagation(),"click"===e.type&&e.target===this&&o()}),r.find(".lumia-modal-close-btn").click(o),r.on("keydown",function(e){"Escape"===e.key&&o()});const s=e=>{e[0].complete&&0!==e[0].naturalHeight?e.addClass("lumia-img-loaded"):(e.on("load",function(){$(this).addClass("lumia-img-loaded")}),e.on("error",function(){$(this).addClass("lumia-img-loaded"),$(this).css("display","none")}))};$("#lumia-pack-cover").on("input",function(){const e=$(this).val().trim(),n=r.find(".lumia-pack-cover-preview");if(e)if(n.length){const t=n.find("img");t.removeClass("lumia-img-loaded").css("display",""),t.attr("src",e),s(t)}else $(this).closest(".lumia-editor-field").after('<div class="lumia-editor-preview lumia-pack-cover-preview"><img src="'.concat((0,a.ZD)(e),'" alt="Cover preview" loading="lazy" /><div class="lumia-preview-spinner"></div></div>')),s(r.find(".lumia-pack-cover-preview img"));else n.remove()});const l=r.find(".lumia-pack-cover-preview img");l.length&&s(l),r.find(".lumia-export-pack-btn").click(function(){w(e)}),r.find(".lumia-pack-save-btn").click(function(){const n=$("#lumia-pack-author").val().trim(),t=$("#lumia-pack-cover").val().trim();try{!function(e,n){const t=(0,i.mt)().packs[e];if(!t)throw new Error('Pack "'.concat(e,'" not found'));if(!y(e))throw new Error('Pack "'.concat(e,'" is not editable'));void 0!==n.author&&(t.author=n.author),void 0!==n.coverUrl&&(t.coverUrl=n.coverUrl),(0,i.DZ)()}(e,{author:n,coverUrl:t}),toastr.success("Pack updated!"),o(),x()}catch(e){toastr.error(e.message)}}),r[0].showModal()}},200(e,n,t){t.d(n,{A5:()=>f,TC:()=>v,rq:()=>d});var i=t(674),a=t(92);function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,i)}return t}function o(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,n||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}let s=!1,l=null,c=null;const u={onPacksChanged:null,onSelectionChanged:null,showSelectionModal:null,showLoomSelectionModal:null,showMiscFeaturesModal:null,showSummarizationModal:null,showPromptSettingsModal:null,showLumiaEditorModal:null,showLucidCardsModal:null,fetchWorldBook:null,handleNewBook:null,refreshUIDisplay:null,refreshOOCComments:null,generateSummary:null};function d(e,n){e in u?u[e]=n:console.warn("[ReactBridge] Unknown callback: ".concat(e))}function m(){return function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach(function(n){o(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}({},u)}function p(){var e;const n=(0,i.mt)();return console.log("[ReactBridge] settingsToReactFormat - passing through exact settings:",{packsType:typeof n.packs,packsKeys:n.packs?Object.keys(n.packs):[],selectedDefinition:n.selectedDefinition,selectedBehaviorsCount:(null===(e=n.selectedBehaviors)||void 0===e?void 0:e.length)||0}),n}function h(e){const n=(0,i.mt)();console.log("[ReactBridge] reactFormatToSettings - applying state:",{packsType:typeof e.packs,packsKeys:e.packs?Object.keys(e.packs):[]}),Object.assign(n,e),(0,i.DZ)()}function v(){if(console.log("[ReactBridge] notifyReactOfSettingsChange called"),console.log("[ReactBridge] window.LumiverseUI available:",!!window.LumiverseUI),window.LumiverseUI&&window.LumiverseUI.syncSettings){const e=p();console.log("[ReactBridge] Sending to React:",{packsCount:Object.keys(e.packs||{}).length,selectedDefinition:e.selectedDefinition}),window.LumiverseUI.syncSettings(e)}else console.warn("[ReactBridge] LumiverseUI.syncSettings not available")}async function f(e){if(console.log("[ReactBridge] initializeReactUI called, container:",e),console.log("[ReactBridge] window.LumiverseUI exists:",!!window.LumiverseUI),s)return console.warn("[ReactBridge] React UI already initialized"),!0;try{if(!window.LumiverseUI)return console.error("[ReactBridge] LumiverseUI not available - bundle issue"),!1;console.log("[ReactBridge] LumiverseUI API:",window.LumiverseUI),console.log("[ReactBridge] mountSettingsPanel exists:",typeof window.LumiverseUI.mountSettingsPanel);const t=p();var n;if(console.log("[ReactBridge] Initial settings prepared"),window.LumiverseBridge={getSettings:p,saveSettings:h,getCallbacks:m,notifySettingsChange:v,clearClaudeCache:i.sI},console.log("[ReactBridge] Bridge API exposed on window.LumiverseBridge"),e&&window.LumiverseUI.mountSettingsPanel)console.log("[ReactBridge] Calling mountSettingsPanel..."),l=window.LumiverseUI.mountSettingsPanel("lumiverse-react-root",t),console.log("[ReactBridge] mountSettingsPanel returned:",l);else console.error("[ReactBridge] Cannot mount: container=",e,"mountSettingsPanel=",null===(n=window.LumiverseUI)||void 0===n?void 0:n.mountSettingsPanel);return window.LumiverseUI.mountViewportPanel&&(console.log("[ReactBridge] Mounting viewport panel..."),c=window.LumiverseUI.mountViewportPanel(t),console.log("[ReactBridge] Viewport panel mounted")),function(){const e=(0,a.cj)(),n=(0,a.G1)();e&&null!=n&&n.CHAT_CHANGED&&e.on(n.CHAT_CHANGED,()=>{v()})}(),s=!0,console.log("[ReactBridge] React UI initialized successfully"),!0}catch(e){return console.error("[ReactBridge] Failed to initialize React UI:",e),!1}}},287(e,n){var t=Symbol.for("react.element"),i=Symbol.for("react.portal"),a=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),m=Symbol.for("react.lazy"),p=Symbol.iterator;var h={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},v=Object.assign,f={};function g(e,n,t){this.props=e,this.context=n,this.refs=f,this.updater=t||h}function b(){}function x(e,n,t){this.props=e,this.context=n,this.refs=f,this.updater=t||h}g.prototype.isReactComponent={},g.prototype.setState=function(e,n){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,n,"setState")},g.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},b.prototype=g.prototype;var y=x.prototype=new b;y.constructor=x,v(y,g.prototype),y.isPureReactComponent=!0;var k=Array.isArray,w=Object.prototype.hasOwnProperty,j={current:null},S={key:!0,ref:!0,__self:!0,__source:!0};function C(e,n,i){var a,r={},o=null,s=null;if(null!=n)for(a in void 0!==n.ref&&(s=n.ref),void 0!==n.key&&(o=""+n.key),n)w.call(n,a)&&!S.hasOwnProperty(a)&&(r[a]=n[a]);var l=arguments.length-2;if(1===l)r.children=i;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];r.children=c}if(e&&e.defaultProps)for(a in l=e.defaultProps)void 0===r[a]&&(r[a]=l[a]);return{$$typeof:t,type:e,key:o,ref:s,props:r,_owner:j.current}}function N(e){return"object"==typeof e&&null!==e&&e.$$typeof===t}var P=/\/+/g;function M(e,n){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var n={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return n[e]})}(""+e.key):n.toString(36)}function E(e,n,a,r,o){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var l=!1;if(null===e)l=!0;else switch(s){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case t:case i:l=!0}}if(l)return o=o(l=e),e=""===r?"."+M(l,0):r,k(o)?(a="",null!=e&&(a=e.replace(P,"$&/")+"/"),E(o,n,a,"",function(e){return e})):null!=o&&(N(o)&&(o=function(e,n){return{$$typeof:t,type:e.type,key:n,ref:e.ref,props:e.props,_owner:e._owner}}(o,a+(!o.key||l&&l.key===o.key?"":(""+o.key).replace(P,"$&/")+"/")+e)),n.push(o)),1;if(l=0,r=""===r?".":r+":",k(e))for(var c=0;c<e.length;c++){var u=r+M(s=e[c],c);l+=E(s,n,a,u,o)}else if(u=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=p&&e[p]||e["@@iterator"])?e:null}(e),"function"==typeof u)for(e=u.call(e),c=0;!(s=e.next()).done;)l+=E(s=s.value,n,a,u=r+M(s,c++),o);else if("object"===s)throw n=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===n?"object with keys {"+Object.keys(e).join(", ")+"}":n)+"). If you meant to render a collection of children, use an array instead.");return l}function L(e,n,t){if(null==e)return e;var i=[],a=0;return E(e,i,"","",function(e){return n.call(t,e,a++)}),i}function D(e){if(-1===e._status){var n=e._result;(n=n()).then(function(n){0!==e._status&&-1!==e._status||(e._status=1,e._result=n)},function(n){0!==e._status&&-1!==e._status||(e._status=2,e._result=n)}),-1===e._status&&(e._status=0,e._result=n)}if(1===e._status)return e._result.default;throw e._result}var O={current:null},T={transition:null},z={ReactCurrentDispatcher:O,ReactCurrentBatchConfig:T,ReactCurrentOwner:j};function A(){throw Error("act(...) is not supported in production builds of React.")}n.Children={map:L,forEach:function(e,n,t){L(e,function(){n.apply(this,arguments)},t)},count:function(e){var n=0;return L(e,function(){n++}),n},toArray:function(e){return L(e,function(e){return e})||[]},only:function(e){if(!N(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},n.Component=g,n.Fragment=a,n.Profiler=o,n.PureComponent=x,n.StrictMode=r,n.Suspense=u,n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=z,n.act=A,n.cloneElement=function(e,n,i){if(null==e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var a=v({},e.props),r=e.key,o=e.ref,s=e._owner;if(null!=n){if(void 0!==n.ref&&(o=n.ref,s=j.current),void 0!==n.key&&(r=""+n.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in n)w.call(n,c)&&!S.hasOwnProperty(c)&&(a[c]=void 0===n[c]&&void 0!==l?l[c]:n[c])}var c=arguments.length-2;if(1===c)a.children=i;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];a.children=l}return{$$typeof:t,type:e.type,key:r,ref:o,props:a,_owner:s}},n.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},n.createElement=C,n.createFactory=function(e){var n=C.bind(null,e);return n.type=e,n},n.createRef=function(){return{current:null}},n.forwardRef=function(e){return{$$typeof:c,render:e}},n.isValidElement=N,n.lazy=function(e){return{$$typeof:m,_payload:{_status:-1,_result:e},_init:D}},n.memo=function(e,n){return{$$typeof:d,type:e,compare:void 0===n?null:n}},n.startTransition=function(e){var n=T.transition;T.transition={};try{e()}finally{T.transition=n}},n.unstable_act=A,n.useCallback=function(e,n){return O.current.useCallback(e,n)},n.useContext=function(e){return O.current.useContext(e)},n.useDebugValue=function(){},n.useDeferredValue=function(e){return O.current.useDeferredValue(e)},n.useEffect=function(e,n){return O.current.useEffect(e,n)},n.useId=function(){return O.current.useId()},n.useImperativeHandle=function(e,n,t){return O.current.useImperativeHandle(e,n,t)},n.useInsertionEffect=function(e,n){return O.current.useInsertionEffect(e,n)},n.useLayoutEffect=function(e,n){return O.current.useLayoutEffect(e,n)},n.useMemo=function(e,n){return O.current.useMemo(e,n)},n.useReducer=function(e,n,t){return O.current.useReducer(e,n,t)},n.useRef=function(e){return O.current.useRef(e)},n.useState=function(e){return O.current.useState(e)},n.useSyncExternalStore=function(e,n,t){return O.current.useSyncExternalStore(e,n,t)},n.useTransition=function(){return O.current.useTransition()},n.version="18.3.1"},314(e){e.exports=function(e){var n=[];return n.toString=function(){return this.map(function(n){var t="",i=void 0!==n[5];return n[4]&&(t+="@supports (".concat(n[4],") {")),n[2]&&(t+="@media ".concat(n[2]," {")),i&&(t+="@layer".concat(n[5].length>0?" ".concat(n[5]):""," {")),t+=e(n),i&&(t+="}"),n[2]&&(t+="}"),n[4]&&(t+="}"),t}).join("")},n.i=function(e,t,i,a,r){"string"==typeof e&&(e=[[null,e,void 0]]);var o={};if(i)for(var s=0;s<this.length;s++){var l=this[s][0];null!=l&&(o[l]=!0)}for(var c=0;c<e.length;c++){var u=[].concat(e[c]);i&&o[u[0]]||(void 0!==r&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=r),t&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=t):u[2]=t),a&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=a):u[4]="".concat(a)),n.push(u))}},n}},338(e,n,t){var i=t(961);n.createRoot=i.createRoot,n.hydrateRoot=i.hydrateRoot},417(e){e.exports=function(e,n){return n||(n={}),e?(e=String(e.__esModule?e.default:e),/^['"].*['"]$/.test(e)&&(e=e.slice(1,-1)),n.hash&&(e+=n.hash),/["'() \t\n]|(%20)/.test(e)||n.needQuotes?'"'.concat(e.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):e):e}},456(e,n,t){t.d(n,{A:()=>m});var i=t(601),a=t.n(i),r=t(314),o=t.n(r),s=t(417),l=t.n(s),c=new URL(t(796),t.b),u=o()(a()),d=l()(c);u.push([e.id,`/* ========================================\n   Lumiverse Helper - React UI Styles\n   Apple-esque minimal design with dark theme\n   Inspired by oldLumiverseCode/style.css\n   ======================================== */\n\n/* CSS Custom Properties - Purple accent color scheme */\n:root {\n    /* Primary purple accent (matching old design) */\n    --lumiverse-primary: rgba(147, 112, 219, 0.9);\n    --lumiverse-primary-hover: rgba(167, 132, 239, 0.95);\n    --lumiverse-primary-light: rgba(147, 112, 219, 0.1);\n    --lumiverse-primary-muted: rgba(147, 112, 219, 0.6);\n    --lumiverse-primary-text: rgba(186, 135, 255, 0.95);\n\n    /* Secondary gray tones */\n    --lumiverse-secondary: rgba(128, 128, 128, 0.15);\n    --lumiverse-secondary-hover: rgba(128, 128, 128, 0.25);\n    --lumiverse-secondary-border: rgba(128, 128, 128, 0.25);\n\n    /* Status colors */\n    --lumiverse-danger: #ef4444;\n    --lumiverse-danger-hover: #dc2626;\n    --lumiverse-success: #22c55e;\n    --lumiverse-warning: #f59e0b;\n\n    /* Dark purple-tinted backgrounds (matching old design) */\n    --lumiverse-bg: rgba(28, 24, 38, 0.95);\n    --lumiverse-bg-elevated: rgba(35, 30, 48, 0.9);\n    --lumiverse-bg-hover: rgba(45, 40, 58, 0.9);\n    --lumiverse-bg-dark: rgba(0, 0, 0, 0.15);\n    --lumiverse-bg-darker: rgba(0, 0, 0, 0.25);\n\n    /* Subtle purple-tinted borders */\n    --lumiverse-border: rgba(147, 112, 219, 0.12);\n    --lumiverse-border-hover: rgba(147, 112, 219, 0.25);\n    --lumiverse-border-light: rgba(128, 128, 128, 0.12);\n\n    /* Text colors with proper opacity */\n    --lumiverse-text: rgba(255, 255, 255, 0.9);\n    --lumiverse-text-muted: rgba(255, 255, 255, 0.65);\n    --lumiverse-text-dim: rgba(255, 255, 255, 0.4);\n    --lumiverse-text-hint: rgba(255, 255, 255, 0.3);\n\n    /* Consistent border radii */\n    --lumiverse-radius-sm: 5px;\n    --lumiverse-radius: 8px;\n    --lumiverse-radius-md: 10px;\n    --lumiverse-radius-lg: 12px;\n    --lumiverse-radius-xl: 16px;\n\n    /* Shadows */\n    --lumiverse-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);\n    --lumiverse-shadow-lg: 0 24px 80px rgba(0, 0, 0, 0.5), 0 0 1px rgba(147, 112, 219, 0.3);\n\n    /* Smooth transitions (200ms like old design) */\n    --lumiverse-transition: 200ms ease;\n    --lumiverse-transition-fast: 150ms ease;\n\n    /* Typography */\n    --lumiverse-font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", sans-serif;\n    --lumiverse-font-mono: "SF Mono", "Menlo", "Monaco", "Consolas", monospace;\n}\n\n/* ========================================\n   LUMIA SETTINGS PANEL - Exact replica\n   Modern Apple-esque minimal design\n   (from oldLumiverseCode/style.css)\n   ======================================== */\n\n.lumia-injector-settings {\n    padding: 0;\n    font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", sans-serif;\n}\n\n/* Panel Container */\n.lumia-panel {\n    margin-bottom: 12px;\n    background: linear-gradient(\n        165deg,\n        rgba(28, 24, 38, 0.6) 0%,\n        rgba(35, 30, 48, 0.5) 100%\n    );\n    border: 1px solid rgba(147, 112, 219, 0.12);\n    border-radius: 12px;\n    overflow: hidden;\n    transition: border-color 0.2s ease;\n}\n\n.lumia-panel:hover {\n    border-color: rgba(147, 112, 219, 0.25);\n}\n\n/* Panel Header */\n.lumia-panel-header {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 12px 14px;\n    background: linear-gradient(\n        180deg,\n        rgba(147, 112, 219, 0.08) 0%,\n        transparent 100%\n    );\n    border-bottom: 1px solid rgba(147, 112, 219, 0.08);\n}\n\n.lumia-panel-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 20px;\n    height: 20px;\n    flex-shrink: 0;\n}\n\n.lumia-panel-icon svg {\n    width: 18px;\n    height: 18px;\n    stroke: rgba(147, 112, 219, 0.8);\n}\n\n.lumia-panel-title {\n    font-size: 13px;\n    font-weight: 600;\n    color: rgba(255, 255, 255, 0.9);\n    letter-spacing: -0.1px;\n    flex-grow: 1;\n}\n\n/* Collapsible Panel */\n.lumia-panel-collapsible {\n    cursor: default;\n}\n\n.lumia-panel-header-clickable {\n    cursor: pointer;\n    list-style: none;\n    user-select: none;\n}\n\n.lumia-panel-header-clickable::-webkit-details-marker {\n    display: none;\n}\n\n.lumia-panel-chevron {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 20px;\n    height: 20px;\n    transition: transform 0.2s ease;\n}\n\n.lumia-panel-chevron svg {\n    width: 16px;\n    height: 16px;\n    stroke: rgba(255, 255, 255, 0.4);\n}\n\ndetails.lumia-panel[open] .lumia-panel-chevron {\n    transform: rotate(180deg);\n}\n\n/* Panel Content */\n.lumia-panel-content {\n    padding: 14px;\n}\n\n/* Status Badge */\n.lumia-status-badge {\n    display: inline-flex;\n    align-items: center;\n    padding: 6px 12px;\n    margin-bottom: 12px;\n    background: rgba(147, 112, 219, 0.1);\n    border: 1px solid rgba(147, 112, 219, 0.2);\n    border-radius: 20px;\n    font-size: 12px;\n    font-weight: 500;\n    color: rgba(186, 135, 255, 0.9);\n    letter-spacing: 0.1px;\n}\n\n/* Input Row */\n.lumia-input-row {\n    display: flex;\n    gap: 8px;\n    margin-bottom: 10px;\n}\n\n.lumia-input {\n    flex: 1;\n    padding: 10px 14px;\n    background: rgba(0, 0, 0, 0.25);\n    border: 1px solid rgba(128, 128, 128, 0.2);\n    border-radius: 8px;\n    font-size: 13px;\n    color: rgba(255, 255, 255, 0.9);\n    transition: all 0.2s ease;\n    font-family: inherit;\n}\n\n.lumia-input::placeholder {\n    color: rgba(255, 255, 255, 0.35);\n}\n\n.lumia-input:focus {\n    outline: none;\n    border-color: rgba(147, 112, 219, 0.5);\n    background: rgba(0, 0, 0, 0.35);\n}\n\n/* Source Actions - centered buttons with dividers */\n.lumia-source-actions {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n}\n\n.lumia-source-actions .lumia-btn-full {\n    width: 100%;\n    max-width: 100%;\n}\n\n/* Divider Text */\n.lumia-divider-text {\n    text-align: center;\n    font-size: 11px;\n    font-weight: 500;\n    color: rgba(255, 255, 255, 0.3);\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    margin: 12px 0;\n    position: relative;\n}\n\n.lumia-divider-text::before,\n.lumia-divider-text::after {\n    content: "";\n    position: absolute;\n    top: 50%;\n    width: calc(50% - 20px);\n    height: 1px;\n    background: rgba(128, 128, 128, 0.2);\n}\n\n.lumia-divider-text::before {\n    left: 0;\n}\n\n.lumia-divider-text::after {\n    right: 0;\n}\n\n/* Buttons */\n.lumia-btn {\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    gap: 8px;\n    padding: 10px 16px;\n    border: none;\n    border-radius: 8px;\n    font-size: 13px;\n    font-weight: 500;\n    font-family: inherit;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    white-space: nowrap;\n}\n\n.lumia-btn svg {\n    width: 16px;\n    height: 16px;\n    flex-shrink: 0;\n}\n\n.lumia-btn-primary {\n    background: linear-gradient(\n        135deg,\n        rgba(147, 112, 219, 0.9) 0%,\n        rgba(123, 95, 196, 0.9) 100%\n    );\n    color: white;\n}\n\n.lumia-btn-primary:hover {\n    background: linear-gradient(\n        135deg,\n        rgba(167, 132, 239, 0.95) 0%,\n        rgba(143, 115, 216, 0.95) 100%\n    );\n    transform: translateY(-1px);\n}\n\n.lumia-btn-secondary {\n    background: rgba(128, 128, 128, 0.15);\n    border: 1px solid rgba(128, 128, 128, 0.25);\n    color: rgba(255, 255, 255, 0.85);\n}\n\n.lumia-btn-secondary:hover {\n    background: rgba(128, 128, 128, 0.25);\n    border-color: rgba(147, 112, 219, 0.3);\n}\n\n.lumia-btn-full {\n    width: 100%;\n}\n\n.lumia-btn-sm {\n    padding: 6px 12px;\n    font-size: 12px;\n    background: rgba(147, 112, 219, 0.15);\n    border: 1px solid rgba(147, 112, 219, 0.25);\n    color: rgba(186, 135, 255, 0.95);\n}\n\n.lumia-btn-sm:hover {\n    background: rgba(147, 112, 219, 0.25);\n    border-color: rgba(147, 112, 219, 0.4);\n}\n\n.lumia-btn-icon {\n    padding: 6px;\n    background: transparent;\n    border: none;\n}\n\n.lumia-btn-icon:hover {\n    background: rgba(147, 112, 219, 0.15);\n}\n\n.lumia-btn-icon svg {\n    width: 14px;\n    height: 14px;\n    stroke: rgba(186, 135, 255, 0.8);\n}\n\n/* Selector Group */\n.lumia-selector-group {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n}\n\n.lumia-selector {\n    background: rgba(0, 0, 0, 0.15);\n    border: 1px solid rgba(128, 128, 128, 0.12);\n    border-radius: 10px;\n    padding: 12px 14px;\n    transition: all 0.2s ease;\n}\n\n.lumia-selector:hover {\n    border-color: rgba(147, 112, 219, 0.2);\n    background: rgba(0, 0, 0, 0.2);\n}\n\n.lumia-selector-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 8px;\n}\n\n.lumia-selector-label {\n    font-size: 12px;\n    font-weight: 600;\n    color: rgba(255, 255, 255, 0.8);\n    letter-spacing: 0.1px;\n}\n\n.lumia-selector-hint {\n    font-size: 10px;\n    font-weight: 500;\n    color: rgba(147, 112, 219, 0.6);\n    text-transform: uppercase;\n    letter-spacing: 0.3px;\n}\n\n.lumia-selector-row {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n}\n\n.lumia-selector-value {\n    flex: 1;\n    font-size: 13px;\n    font-weight: 500;\n    color: rgba(255, 255, 255, 0.65);\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n    min-width: 0;\n}\n\n/* Selector Group Disabled State (Council Mode Active) */\n.lumia-selector-group--disabled {\n    opacity: 0.5;\n    pointer-events: none;\n    filter: grayscale(30%);\n}\n\n/* Council Notice */\n.lumia-council-notice {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 10px 14px;\n    margin-bottom: 12px;\n    background: linear-gradient(\n        135deg,\n        rgba(147, 112, 219, 0.15) 0%,\n        rgba(100, 80, 180, 0.1) 100%\n    );\n    border: 1px solid rgba(147, 112, 219, 0.25);\n    border-radius: 8px;\n    font-size: 12px;\n    font-weight: 500;\n    color: rgba(186, 135, 255, 0.9);\n}\n\n.lumia-council-notice svg {\n    flex-shrink: 0;\n    stroke: rgba(186, 135, 255, 0.8);\n}\n\n/* Council Config Button (in SettingsPanel) */\n.lumia-council-config-btn {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    width: 100%;\n    padding: 12px 14px;\n    margin-bottom: 12px;\n    background: linear-gradient(\n        135deg,\n        rgba(147, 112, 219, 0.12) 0%,\n        rgba(147, 112, 219, 0.06) 100%\n    );\n    border: 1px solid rgba(147, 112, 219, 0.3);\n    border-radius: 10px;\n    color: var(--lumiverse-text);\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumia-council-config-btn:hover {\n    background: linear-gradient(\n        135deg,\n        rgba(147, 112, 219, 0.18) 0%,\n        rgba(147, 112, 219, 0.1) 100%\n    );\n    border-color: rgba(147, 112, 219, 0.5);\n}\n\n.lumia-council-config-btn svg {\n    flex-shrink: 0;\n    color: var(--lumiverse-primary);\n}\n\n.lumia-council-config-text {\n    flex: 1;\n    text-align: left;\n    font-size: 13px;\n    font-weight: 500;\n}\n\n.lumia-council-config-action {\n    padding: 4px 10px;\n    background: rgba(147, 112, 219, 0.2);\n    border-radius: 6px;\n    font-size: 11px;\n    font-weight: 600;\n    color: var(--lumiverse-primary);\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n.lumia-council-config-btn:hover .lumia-council-config-action {\n    background: var(--lumiverse-primary);\n    color: white;\n}\n\n/* ----------------------------------------\n   Quick Actions Section\n   ---------------------------------------- */\n.lumia-quick-actions {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    margin-bottom: 12px;\n    flex-wrap: wrap;\n}\n\n.lumia-quick-action-group {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    flex: 1;\n    min-width: 0;\n}\n\n.lumia-quick-action-btn {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 6px;\n    padding: 8px 12px;\n    background: rgba(30, 30, 46, 0.6);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    border-radius: 8px;\n    color: var(--lumiverse-text-secondary);\n    font-size: 12px;\n    font-weight: 500;\n    cursor: pointer;\n    transition: all 0.15s ease;\n    white-space: nowrap;\n    font-family: inherit;\n}\n\n.lumia-quick-action-btn:hover:not(:disabled) {\n    background: rgba(30, 30, 46, 0.8);\n    border-color: rgba(147, 112, 219, 0.3);\n    color: var(--lumiverse-text-primary);\n}\n\n.lumia-quick-action-btn--council {\n    flex-shrink: 0;\n}\n\n.lumia-quick-action-btn--disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n}\n\n.lumia-quick-action-btn--primary {\n    background: rgba(147, 112, 219, 0.15);\n    border-color: rgba(147, 112, 219, 0.3);\n    color: var(--lumiverse-primary);\n    padding: 8px 10px;\n}\n\n.lumia-quick-action-btn--primary:hover:not(:disabled) {\n    background: rgba(147, 112, 219, 0.25);\n    border-color: rgba(147, 112, 219, 0.5);\n}\n\n.lumia-quick-action-btn--active {\n    background: rgba(147, 112, 219, 0.1);\n    border-color: rgba(147, 112, 219, 0.3);\n    color: var(--lumiverse-primary);\n}\n\n.lumia-quick-action-text {\n    max-width: 100px;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumia-quick-action-chevron {\n    transition: transform 0.15s ease;\n    flex-shrink: 0;\n}\n\n.lumia-quick-action-chevron--open {\n    transform: rotate(180deg);\n}\n\n/* Dropdown */\n.lumia-quick-action-dropdown-wrapper {\n    position: relative;\n    flex: 1;\n    min-width: 0;\n}\n\n.lumia-quick-action-dropdown {\n    position: absolute;\n    top: calc(100% + 4px);\n    left: 0;\n    right: 0;\n    min-width: 140px;\n    background: rgba(25, 25, 35, 0.98);\n    border: 1px solid rgba(255, 255, 255, 0.12);\n    border-radius: 8px;\n    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);\n    z-index: 100;\n    max-height: 200px;\n    overflow-y: auto;\n}\n\n.lumia-quick-action-dropdown-empty {\n    padding: 12px;\n    text-align: center;\n    color: var(--lumiverse-text-muted);\n    font-size: 11px;\n}\n\n.lumia-quick-action-dropdown-item {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    width: 100%;\n    padding: 10px 12px;\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text-secondary);\n    font-size: 12px;\n    text-align: left;\n    cursor: pointer;\n    transition: all 0.1s ease;\n    font-family: inherit;\n}\n\n.lumia-quick-action-dropdown-item:hover {\n    background: rgba(147, 112, 219, 0.1);\n    color: var(--lumiverse-text-primary);\n}\n\n.lumia-quick-action-dropdown-item--active {\n    background: rgba(147, 112, 219, 0.15);\n    color: var(--lumiverse-primary);\n}\n\n.lumia-quick-action-dropdown-item svg {\n    flex-shrink: 0;\n}\n\n/* Form */\n.lumia-quick-action-form {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    flex: 1;\n    min-width: 0;\n}\n\n.lumia-quick-action-input {\n    flex: 1;\n    min-width: 0;\n    padding: 8px 10px;\n    background: rgba(30, 30, 46, 0.8);\n    border: 1px solid rgba(147, 112, 219, 0.3);\n    border-radius: 6px;\n    color: var(--lumiverse-text-primary);\n    font-size: 12px;\n    font-family: inherit;\n}\n\n.lumia-quick-action-input:focus {\n    outline: none;\n    border-color: rgba(147, 112, 219, 0.6);\n}\n\n.lumia-quick-action-input::placeholder {\n    color: var(--lumiverse-text-muted);\n}\n\n/* Responsive adjustments */\n@media (max-width: 480px) {\n    .lumia-quick-actions {\n        flex-direction: column;\n        align-items: stretch;\n    }\n\n    .lumia-quick-action-btn--council {\n        width: 100%;\n    }\n\n    .lumia-quick-action-group {\n        width: 100%;\n    }\n\n    .lumia-quick-action-text {\n        max-width: none;\n    }\n}\n\n/* Clear All Button */\n.lumia-clear-all-btn {\n    display: inline-flex;\n    align-items: center;\n    gap: 6px;\n    padding: 5px 10px;\n    background: rgba(239, 68, 68, 0.1);\n    border: 1px solid rgba(239, 68, 68, 0.2);\n    border-radius: 6px;\n    font-size: 11px;\n    font-weight: 500;\n    color: rgba(239, 68, 68, 0.8);\n    cursor: pointer;\n    transition: all 0.2s ease;\n    font-family: inherit;\n}\n\n.lumia-clear-all-btn:hover {\n    background: rgba(239, 68, 68, 0.2);\n    border-color: rgba(239, 68, 68, 0.4);\n    color: rgba(239, 68, 68, 1);\n}\n\n.lumia-clear-all-btn svg {\n    width: 14px;\n    height: 14px;\n}\n\n/* Panel Action (header button area) */\n.lumia-panel-action {\n    display: flex;\n    align-items: center;\n    margin-left: auto;\n}\n\n/* Panel Chevron for collapsible panels */\n.lumia-panel-chevron--expanded {\n    transform: rotate(180deg);\n}\n\n/* Tools Row */\n.lumia-tools-row {\n    display: grid;\n    grid-template-columns: repeat(2, 1fr);\n    gap: 10px;\n}\n\n.lumia-tool-btn {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    gap: 8px;\n    padding: 16px 12px;\n    background: rgba(0, 0, 0, 0.15);\n    border: 1px solid rgba(128, 128, 128, 0.12);\n    border-radius: 10px;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumia-tool-btn svg {\n    width: 22px;\n    height: 22px;\n    stroke: rgba(147, 112, 219, 0.7);\n    transition: stroke 0.2s ease;\n}\n\n.lumia-tool-btn span {\n    font-size: 12px;\n    font-weight: 500;\n    color: rgba(255, 255, 255, 0.75);\n    font-family: inherit;\n}\n\n.lumia-tool-btn:hover {\n    background: rgba(147, 112, 219, 0.1);\n    border-color: rgba(147, 112, 219, 0.25);\n}\n\n.lumia-tool-btn:hover svg {\n    stroke: rgba(186, 135, 255, 0.9);\n}\n\n.lumia-tool-btn-accent {\n    background: linear-gradient(\n        135deg,\n        rgba(147, 112, 219, 0.2) 0%,\n        rgba(123, 95, 196, 0.15) 100%\n    );\n    border-color: rgba(147, 112, 219, 0.35);\n}\n\n.lumia-tool-btn-accent svg {\n    stroke: rgba(186, 135, 255, 0.9);\n}\n\n.lumia-tool-btn-accent span {\n    color: rgba(186, 135, 255, 0.95);\n}\n\n.lumia-tool-btn-accent:hover {\n    background: linear-gradient(\n        135deg,\n        rgba(147, 112, 219, 0.3) 0%,\n        rgba(123, 95, 196, 0.25) 100%\n    );\n    border-color: rgba(147, 112, 219, 0.5);\n}\n\n/* Macro Reference */\n.lumia-macro-reference {\n    display: flex;\n    flex-direction: column;\n    gap: 14px;\n}\n\n.lumia-macro-group {\n    display: flex;\n    flex-direction: column;\n    gap: 6px;\n}\n\n.lumia-macro-group-title {\n    font-size: 10px;\n    font-weight: 600;\n    color: rgba(147, 112, 219, 0.7);\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    margin-bottom: 2px;\n}\n\n.lumia-macro-list {\n    display: flex;\n    flex-direction: column;\n    gap: 4px;\n}\n\n.lumia-macro {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 6px 0;\n    cursor: pointer;\n    transition: opacity 0.2s ease;\n}\n\n.lumia-macro:hover {\n    opacity: 0.85;\n}\n\n.lumia-macro--copied {\n    opacity: 1;\n}\n\n.lumia-macro--copied code {\n    background: rgba(147, 112, 219, 0.25);\n    border-color: rgba(147, 112, 219, 0.4);\n}\n\n.lumia-macro code {\n    font-family: "SF Mono", "Menlo", "Monaco", "Consolas", monospace;\n    font-size: 11px;\n    padding: 4px 8px;\n    background: rgba(0, 0, 0, 0.3);\n    border: 1px solid rgba(128, 128, 128, 0.15);\n    border-radius: 5px;\n    color: rgba(186, 135, 255, 0.95);\n    white-space: nowrap;\n    transition: all 0.2s ease;\n}\n\n.lumia-macro span {\n    font-size: 12px;\n    color: rgba(255, 255, 255, 0.55);\n}\n\n/* Custom Packs */\n.lumia-custom-packs {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumia-pack-item {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 10px 12px;\n    background: rgba(0, 0, 0, 0.15);\n    border: 1px solid rgba(128, 128, 128, 0.12);\n    border-radius: 8px;\n    transition: all 0.2s ease;\n}\n\n.lumia-pack-item:hover {\n    border-color: rgba(147, 112, 219, 0.2);\n    background: rgba(0, 0, 0, 0.2);\n}\n\n.lumia-pack-name {\n    flex: 1;\n    font-size: 13px;\n    font-weight: 500;\n    color: rgba(255, 255, 255, 0.85);\n}\n\n.lumia-pack-count {\n    font-size: 11px;\n    color: rgba(147, 112, 219, 0.7);\n    padding: 2px 8px;\n    background: rgba(147, 112, 219, 0.1);\n    border-radius: 10px;\n}\n\n/* Expandable Pack Container */\n.lumia-pack-item-container {\n    border-radius: 8px;\n    overflow: hidden;\n}\n\n.lumia-pack-item-container--expanded {\n    background: rgba(0, 0, 0, 0.08);\n    border: 1px solid rgba(147, 112, 219, 0.15);\n}\n\n.lumia-pack-item-container--expanded .lumia-pack-item {\n    border-bottom: 1px solid rgba(128, 128, 128, 0.1);\n    border-radius: 8px 8px 0 0;\n}\n\n/* Expand button */\n.lumia-pack-expand-btn {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 24px;\n    height: 24px;\n    padding: 0;\n    background: transparent;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n    color: rgba(255, 255, 255, 0.5);\n    transition: all 0.2s ease;\n}\n\n.lumia-pack-expand-btn:hover {\n    background: rgba(147, 112, 219, 0.15);\n    color: rgba(255, 255, 255, 0.8);\n}\n\n/* Chevron rotation */\n.lumia-pack-chevron {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: transform 0.2s ease;\n}\n\n.lumia-pack-chevron svg {\n    width: 14px;\n    height: 14px;\n}\n\n.lumia-pack-chevron--expanded {\n    transform: rotate(180deg);\n}\n\n/* Expanded Lumia items list */\n.lumia-pack-items-list {\n    display: flex;\n    flex-direction: column;\n    padding: 4px 8px 8px 8px;\n    overflow: hidden;\n}\n\n/* Individual Lumia item in expanded list */\n.lumia-pack-lumia-item {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    padding: 8px 10px;\n    margin-top: 4px;\n    background: rgba(0, 0, 0, 0.12);\n    border: 1px solid rgba(128, 128, 128, 0.08);\n    border-radius: 6px;\n    transition: all 0.15s ease;\n}\n\n.lumia-pack-lumia-item:hover {\n    background: rgba(0, 0, 0, 0.18);\n    border-color: rgba(147, 112, 219, 0.2);\n}\n\n/* Lumia avatar in expanded list */\n.lumia-pack-lumia-avatar {\n    width: 28px;\n    height: 28px;\n    border-radius: 50%;\n    object-fit: cover;\n    border: 1px solid rgba(147, 112, 219, 0.2);\n    flex-shrink: 0;\n}\n\n/* Lumia name in expanded list */\n.lumia-pack-lumia-name {\n    flex: 1;\n    font-size: 12px;\n    font-weight: 500;\n    color: rgba(255, 255, 255, 0.8);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n/* Small icon button */\n.lumia-btn-icon-sm {\n    width: 24px !important;\n    height: 24px !important;\n    padding: 0 !important;\n    font-size: 12px;\n}\n\n.lumia-btn-icon-sm svg {\n    width: 12px;\n    height: 12px;\n}\n\n/* Empty state for expanded pack */\n.lumia-pack-items-empty {\n    padding: 12px;\n    text-align: center;\n    overflow: hidden;\n}\n\n.lumia-pack-items-empty span {\n    font-size: 12px;\n    color: rgba(255, 255, 255, 0.4);\n    font-style: italic;\n}\n\n/* ----------------------------------------\n   Base App Container\n   ---------------------------------------- */\n.lumiverse-app {\n    font-family: var(--lumiverse-font-family);\n    color: var(--lumiverse-text);\n    font-size: 14px;\n    line-height: 1.5;\n}\n\n.lumiverse-react-root {\n    margin: 0;\n    padding: 0;\n}\n\n/* ----------------------------------------\n   Settings Panel - Main container with gradient background\n   ---------------------------------------- */\n.lumiverse-settings-panel {\n    background: linear-gradient(\n        165deg,\n        rgba(28, 24, 38, 0.95) 0%,\n        rgba(35, 30, 48, 0.9) 100%\n    );\n    border-radius: var(--lumiverse-radius-lg);\n    border: 1px solid var(--lumiverse-border);\n    overflow: hidden;\n    transition: border-color var(--lumiverse-transition);\n}\n\n.lumiverse-settings-panel:hover {\n    border-color: var(--lumiverse-border-hover);\n}\n\n.lumiverse-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 12px 14px;\n    background: linear-gradient(\n        180deg,\n        rgba(147, 112, 219, 0.08) 0%,\n        transparent 100%\n    );\n    border-bottom: 1px solid rgba(147, 112, 219, 0.08);\n}\n\n.lumiverse-header-badge {\n    font-size: 10px;\n    font-weight: 500;\n    padding: 4px 8px;\n    background: var(--lumiverse-primary-light);\n    border: 1px solid rgba(147, 112, 219, 0.2);\n    border-radius: 12px;\n    color: var(--lumiverse-primary-text);\n    text-transform: uppercase;\n    letter-spacing: 0.3px;\n}\n\n.lumiverse-title {\n    margin: 0;\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    letter-spacing: -0.1px;\n}\n\n/* ----------------------------------------\n   Sections (Collapsible) - Panel-like sections\n   ---------------------------------------- */\n.lumiverse-section {\n    margin-bottom: 0;\n    background: linear-gradient(\n        165deg,\n        rgba(28, 24, 38, 0.6) 0%,\n        rgba(35, 30, 48, 0.5) 100%\n    );\n    border-bottom: 1px solid var(--lumiverse-border);\n    transition: border-color var(--lumiverse-transition);\n}\n\n.lumiverse-section:last-child {\n    border-bottom: none;\n}\n\n.lumiverse-section:hover {\n    border-color: var(--lumiverse-border-hover);\n}\n\n.lumiverse-section-header {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    width: 100%;\n    padding: 12px 14px;\n    background: linear-gradient(\n        180deg,\n        rgba(147, 112, 219, 0.08) 0%,\n        transparent 100%\n    );\n    border: none;\n    border-bottom: 1px solid rgba(147, 112, 219, 0.08);\n    color: var(--lumiverse-text);\n    font-size: 13px;\n    font-weight: 600;\n    cursor: pointer;\n    transition: background var(--lumiverse-transition);\n    letter-spacing: -0.1px;\n}\n\n.lumiverse-section-header:hover {\n    background: linear-gradient(\n        180deg,\n        rgba(147, 112, 219, 0.12) 0%,\n        rgba(147, 112, 219, 0.04) 100%\n    );\n}\n\n.lumiverse-section-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 20px;\n    height: 20px;\n    flex-shrink: 0;\n    font-size: 16px;\n}\n\n.lumiverse-section-title {\n    flex: 1;\n    text-align: left;\n}\n\n.lumiverse-section-chevron {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 20px;\n    height: 20px;\n    font-size: 10px;\n    color: var(--lumiverse-text-dim);\n    transition: transform var(--lumiverse-transition);\n}\n\n.lumiverse-section-chevron.rotated {\n    transform: rotate(180deg);\n}\n\n.lumiverse-section-content {\n    padding: 14px;\n    background: transparent;\n}\n\n/* ----------------------------------------\n   Toggle Switch\n   ---------------------------------------- */\n.lumiverse-toggle-wrapper {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 8px 0;\n    cursor: pointer;\n}\n\n.lumiverse-toggle-text {\n    flex: 1;\n    margin-right: 12px;\n}\n\n.lumiverse-toggle-label {\n    display: block;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-toggle-description {\n    display: block;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n    margin-top: 2px;\n}\n\n.lumiverse-toggle {\n    position: relative;\n    width: 44px;\n    height: 24px;\n    background: var(--lumiverse-secondary);\n    border-radius: 12px;\n    transition: background var(--lumiverse-transition);\n}\n\n.lumiverse-toggle--on {\n    background: var(--lumiverse-primary);\n}\n\n.lumiverse-toggle-input {\n    position: absolute;\n    opacity: 0;\n    width: 100%;\n    height: 100%;\n    cursor: pointer;\n}\n\n.lumiverse-toggle-slider {\n    position: absolute;\n    top: 2px;\n    left: 2px;\n    width: 20px;\n    height: 20px;\n    background: white;\n    border-radius: 50%;\n    transition: transform var(--lumiverse-transition);\n    pointer-events: none;\n}\n\n.lumiverse-toggle--on .lumiverse-toggle-slider {\n    transform: translateX(20px);\n}\n\n/* Drawer toggle container (settings panel) */\n.lumia-drawer-toggle-container {\n    margin-bottom: 12px;\n    padding: 12px 14px;\n    background: linear-gradient(\n        165deg,\n        rgba(28, 24, 38, 0.6) 0%,\n        rgba(35, 30, 48, 0.5) 100%\n    );\n    border: 1px solid rgba(147, 112, 219, 0.12);\n    border-radius: 12px;\n    transition: border-color 0.2s ease;\n}\n\n.lumia-drawer-toggle-container:hover {\n    border-color: rgba(147, 112, 219, 0.25);\n}\n\n/* Button position settings container */\n.lumia-button-position-container {\n    margin-bottom: 12px;\n    padding: 12px 14px;\n    background: linear-gradient(\n        165deg,\n        rgba(28, 24, 38, 0.5) 0%,\n        rgba(35, 30, 48, 0.4) 100%\n    );\n    border: 1px solid rgba(147, 112, 219, 0.1);\n    border-radius: 12px;\n    transition: border-color 0.2s ease;\n}\n\n.lumia-button-position-container:hover {\n    border-color: rgba(147, 112, 219, 0.2);\n}\n\n.lumia-button-position-inputs {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 12px;\n    margin-top: 12px;\n    padding-top: 12px;\n    border-top: 1px solid rgba(147, 112, 219, 0.1);\n}\n\n.lumia-position-field {\n    display: flex;\n    flex-direction: column;\n    gap: 4px;\n    flex: 1;\n    min-width: 100px;\n}\n\n.lumia-position-field label {\n    font-size: 0.75rem;\n    color: rgba(255, 255, 255, 0.6);\n    font-weight: 500;\n}\n\n.lumia-input-sm {\n    padding: 6px 10px;\n    font-size: 0.85rem;\n}\n\n.lumia-position-hint {\n    width: 100%;\n    font-size: 0.7rem;\n    color: rgba(147, 112, 219, 0.7);\n    font-style: italic;\n    margin-top: 4px;\n}\n\n/* Mode toggles container */\n.lumia-mode-toggles {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n    margin-bottom: 16px;\n    padding-bottom: 14px;\n    border-bottom: 1px solid rgba(147, 112, 219, 0.12);\n}\n\n/* Mode toggle row */\n.lumiverse-mode-toggle {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 10px 12px;\n    background: rgba(28, 24, 38, 0.4);\n    border: 1px solid rgba(147, 112, 219, 0.1);\n    border-radius: 10px;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-mode-toggle:hover {\n    background: rgba(147, 112, 219, 0.08);\n    border-color: rgba(147, 112, 219, 0.2);\n}\n\n.lumiverse-mode-toggle--disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n    pointer-events: none;\n}\n\n.lumiverse-mode-toggle-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 32px;\n    height: 32px;\n    background: rgba(147, 112, 219, 0.15);\n    border-radius: 8px;\n    flex-shrink: 0;\n}\n\n.lumiverse-mode-toggle-icon svg {\n    width: 18px;\n    height: 18px;\n    color: var(--lumiverse-primary);\n}\n\n.lumiverse-mode-toggle-text {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n    min-width: 0;\n}\n\n.lumiverse-mode-toggle-label {\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-mode-toggle-description {\n    font-size: 11px;\n    color: var(--lumiverse-muted);\n    line-height: 1.3;\n}\n\n/* Small toggle variant */\n.lumiverse-toggle--sm {\n    width: 36px;\n    height: 20px;\n    flex-shrink: 0;\n}\n\n.lumiverse-toggle--sm .lumiverse-toggle-slider {\n    width: 16px;\n    height: 16px;\n    top: 2px;\n    left: 2px;\n}\n\n.lumiverse-toggle--sm.lumiverse-toggle--on .lumiverse-toggle-slider {\n    transform: translateX(16px);\n}\n\n/* ----------------------------------------\n   Buttons - Apple-esque with gradients\n   ---------------------------------------- */\n.lumiverse-btn {\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    gap: 8px;\n    padding: 10px 16px;\n    font-size: 13px;\n    font-weight: 500;\n    font-family: inherit;\n    border-radius: var(--lumiverse-radius);\n    border: none;\n    cursor: pointer;\n    transition: all var(--lumiverse-transition);\n    white-space: nowrap;\n}\n\n.lumiverse-btn svg {\n    width: 16px;\n    height: 16px;\n    flex-shrink: 0;\n}\n\n.lumiverse-btn--primary {\n    background: linear-gradient(\n        135deg,\n        rgba(147, 112, 219, 0.9) 0%,\n        rgba(123, 95, 196, 0.9) 100%\n    );\n    color: white;\n}\n\n.lumiverse-btn--primary:hover {\n    background: linear-gradient(\n        135deg,\n        rgba(167, 132, 239, 0.95) 0%,\n        rgba(143, 115, 216, 0.95) 100%\n    );\n    transform: translateY(-1px);\n}\n\n.lumiverse-btn--secondary {\n    background: rgba(128, 128, 128, 0.15);\n    border: 1px solid rgba(128, 128, 128, 0.25);\n    color: rgba(255, 255, 255, 0.85);\n}\n\n.lumiverse-btn--secondary:hover {\n    background: rgba(128, 128, 128, 0.25);\n    border-color: rgba(147, 112, 219, 0.3);\n}\n\n.lumiverse-btn--danger {\n    background: linear-gradient(\n        135deg,\n        rgba(239, 68, 68, 0.9) 0%,\n        rgba(220, 38, 38, 0.9) 100%\n    );\n    color: white;\n}\n\n.lumiverse-btn--danger:hover {\n    background: linear-gradient(\n        135deg,\n        rgba(248, 113, 113, 0.95) 0%,\n        rgba(239, 68, 68, 0.95) 100%\n    );\n    transform: translateY(-1px);\n}\n\n.lumiverse-btn--icon {\n    padding: 6px;\n    min-width: auto;\n    background: transparent;\n    border: none;\n}\n\n.lumiverse-btn--icon:hover {\n    background: rgba(147, 112, 219, 0.15);\n}\n\n.lumiverse-btn-full {\n    width: 100%;\n}\n\n.lumiverse-btn-sm {\n    padding: 6px 12px;\n    font-size: 12px;\n    background: rgba(147, 112, 219, 0.15);\n    border: 1px solid rgba(147, 112, 219, 0.25);\n    color: var(--lumiverse-primary-text);\n}\n\n.lumiverse-btn-sm:hover {\n    background: rgba(147, 112, 219, 0.25);\n    border-color: rgba(147, 112, 219, 0.4);\n}\n\n/* ----------------------------------------\n   Selection Row\n   ---------------------------------------- */\n.lumiverse-selection-row {\n    display: flex;\n    align-items: center;\n    margin-bottom: 12px;\n}\n\n.lumiverse-selection-label {\n    width: 100px;\n    flex-shrink: 0;\n    font-weight: 500;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-selection-button {\n    flex: 1;\n    display: flex;\n    align-items: center;\n    padding: 10px 14px;\n    background: var(--lumiverse-bg-elevated);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    color: var(--lumiverse-text);\n    cursor: pointer;\n    transition: all var(--lumiverse-transition);\n}\n\n.lumiverse-selection-button:hover {\n    background: var(--lumiverse-bg-hover);\n    border-color: var(--lumiverse-border-light);\n}\n\n.lumiverse-selection-text {\n    flex: 1;\n    text-align: left;\n}\n\n.lumiverse-selection-dominant {\n    font-size: 12px;\n    color: var(--lumiverse-warning);\n    margin-left: 8px;\n}\n\n.lumiverse-selection-arrow {\n    margin-left: 8px;\n    color: var(--lumiverse-text-muted);\n}\n\n/* ----------------------------------------\n   Stats Bar\n   ---------------------------------------- */\n.lumiverse-stats {\n    display: flex;\n    align-items: center;\n    padding: 8px 12px;\n    margin-bottom: 16px;\n    background: var(--lumiverse-primary-light);\n    border-radius: var(--lumiverse-radius);\n    font-size: 13px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-stats-divider {\n    margin: 0 8px;\n}\n\n/* ----------------------------------------\n   Radio Group\n   ---------------------------------------- */\n.lumiverse-radio-group {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n    margin-top: 12px;\n}\n\n.lumiverse-radio {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    cursor: pointer;\n}\n\n.lumiverse-radio input[type="radio"] {\n    accent-color: var(--lumiverse-primary);\n}\n\n/* ----------------------------------------\n   Number Input\n   ---------------------------------------- */\n.lumiverse-number-wrapper {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n    margin-top: 12px;\n}\n\n.lumiverse-number-label {\n    font-weight: 500;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-number-input {\n    width: 80px;\n    padding: 8px 12px;\n    background: var(--lumiverse-bg-elevated);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    color: var(--lumiverse-text);\n    font-size: 14px;\n}\n\n.lumiverse-number-input:focus {\n    outline: none;\n    border-color: var(--lumiverse-primary);\n}\n\n/* ----------------------------------------\n   Pack Actions & List\n   ---------------------------------------- */\n.lumiverse-pack-actions {\n    display: flex;\n    gap: 8px;\n    margin-bottom: 16px;\n}\n\n.lumiverse-custom-packs h4 {\n    margin: 0 0 12px 0;\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--lumiverse-text-muted);\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n.lumiverse-pack-item {\n    display: flex;\n    align-items: center;\n    padding: 10px 12px;\n    background: var(--lumiverse-bg-elevated);\n    border-radius: var(--lumiverse-radius);\n    margin-bottom: 8px;\n}\n\n.lumiverse-pack-name {\n    flex: 1;\n    font-weight: 500;\n}\n\n.lumiverse-pack-count {\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n    margin-right: 8px;\n}\n\n/* ----------------------------------------\n   Loom Selections\n   ---------------------------------------- */\n.lumiverse-loom-selections {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n    margin-top: 12px;\n}\n\n/* ----------------------------------------\n   Modal Styles\n   ---------------------------------------- */\n.lumiverse-modal-backdrop {\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background: rgba(0, 0, 0, 0.7);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    z-index: 10000;\n    padding: 20px;\n}\n\n.lumiverse-modal {\n    background: var(--lumiverse-bg);\n    border-radius: var(--lumiverse-radius-lg);\n    border: 1px solid var(--lumiverse-border);\n    box-shadow: var(--lumiverse-shadow-lg);\n    max-height: 80vh;\n    display: flex;\n    flex-direction: column;\n    overflow: hidden;\n}\n\n.lumiverse-modal--small {\n    width: 400px;\n}\n\n.lumiverse-modal--medium {\n    width: 560px;\n}\n\n.lumiverse-modal--large {\n    width: 800px;\n    max-width: 90vw;\n}\n\n.lumiverse-modal-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 16px 20px;\n    background: var(--lumiverse-bg-elevated);\n    border-bottom: 1px solid var(--lumiverse-border);\n}\n\n.lumiverse-modal-title {\n    margin: 0;\n    font-size: 18px;\n    font-weight: 600;\n}\n\n.lumiverse-modal-close {\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text-muted);\n    font-size: 18px;\n    cursor: pointer;\n    padding: 4px 8px;\n    border-radius: var(--lumiverse-radius-sm);\n    transition: all var(--lumiverse-transition);\n}\n\n.lumiverse-modal-close:hover {\n    background: var(--lumiverse-bg-hover);\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-modal-body {\n    flex: 1;\n    overflow: hidden;\n    display: flex;\n    flex-direction: column;\n}\n\n/* ----------------------------------------\n   Selection Modal\n   ---------------------------------------- */\n.lumiverse-selection-modal {\n    display: flex;\n    flex-direction: column;\n    height: 100%;\n}\n\n.lumiverse-selection-toolbar {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 12px 16px;\n    background: var(--lumiverse-bg-elevated);\n    border-bottom: 1px solid var(--lumiverse-border);\n}\n\n.lumiverse-selection-count {\n    font-size: 13px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-dominant-indicator {\n    margin-left: 8px;\n    color: var(--lumiverse-warning);\n}\n\n.lumiverse-selection-content {\n    flex: 1;\n    overflow-y: auto;\n    padding: 16px;\n}\n\n.lumiverse-selection-footer {\n    padding: 12px 16px;\n    background: var(--lumiverse-bg-elevated);\n    border-top: 1px solid var(--lumiverse-border);\n    display: flex;\n    justify-content: flex-end;\n}\n\n/* ----------------------------------------\n   Search Input\n   ---------------------------------------- */\n.lumiverse-search {\n    display: flex;\n    align-items: center;\n    background: var(--lumiverse-bg);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    padding: 0 12px;\n    flex: 1;\n    max-width: 300px;\n}\n\n.lumiverse-search-icon {\n    font-size: 14px;\n    margin-right: 8px;\n}\n\n.lumiverse-search-input {\n    flex: 1;\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text);\n    padding: 8px 0;\n    font-size: 14px;\n}\n\n.lumiverse-search-input:focus {\n    outline: none;\n}\n\n.lumiverse-search-input::placeholder {\n    color: var(--lumiverse-text-dim);\n}\n\n.lumiverse-search-clear {\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    padding: 2px 6px;\n}\n\n/* ----------------------------------------\n   Pack Section (in modals)\n   ---------------------------------------- */\n.lumiverse-pack-section {\n    margin-bottom: 16px;\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    overflow: hidden;\n}\n\n.lumiverse-pack-header {\n    display: flex;\n    align-items: center;\n    width: 100%;\n    padding: 12px 14px;\n    background: var(--lumiverse-bg-elevated);\n    border: none;\n    color: var(--lumiverse-text);\n    cursor: pointer;\n    transition: background var(--lumiverse-transition);\n}\n\n.lumiverse-pack-header:hover {\n    background: var(--lumiverse-bg-hover);\n}\n\n.lumiverse-pack-cover {\n    width: 40px;\n    height: 40px;\n    border-radius: var(--lumiverse-radius-sm);\n    object-fit: cover;\n    margin-right: 12px;\n}\n\n.lumiverse-pack-info {\n    flex: 1;\n    text-align: left;\n}\n\n.lumiverse-pack-meta {\n    display: flex;\n    gap: 12px;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n    margin-top: 2px;\n}\n\n.lumiverse-pack-chevron {\n    font-size: 10px;\n    color: var(--lumiverse-text-muted);\n    transition: transform var(--lumiverse-transition);\n}\n\n.lumiverse-pack-chevron.rotated {\n    transform: rotate(180deg);\n}\n\n.lumiverse-pack-items {\n    padding: 8px;\n    background: var(--lumiverse-bg);\n}\n\n/* ----------------------------------------\n   Selectable Item\n   ---------------------------------------- */\n.lumiverse-selectable-item {\n    display: flex;\n    align-items: flex-start;\n    padding: 12px;\n    background: var(--lumiverse-bg-elevated);\n    border: 1px solid transparent;\n    border-radius: var(--lumiverse-radius);\n    margin-bottom: 8px;\n    cursor: pointer;\n    transition: all var(--lumiverse-transition);\n}\n\n.lumiverse-selectable-item:hover {\n    background: var(--lumiverse-bg-hover);\n}\n\n.lumiverse-selectable-item--selected {\n    border-color: var(--lumiverse-primary);\n    background: var(--lumiverse-primary-light);\n}\n\n.lumiverse-selectable-item--dominant {\n    border-color: var(--lumiverse-warning);\n}\n\n.lumiverse-item-image {\n    width: 48px;\n    height: 48px;\n    border-radius: var(--lumiverse-radius);\n    overflow: hidden;\n    margin-right: 12px;\n    flex-shrink: 0;\n    background: var(--lumiverse-bg);\n}\n\n.lumiverse-item-image img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n}\n\n.lumiverse-item-content {\n    flex: 1;\n    min-width: 0;\n}\n\n.lumiverse-item-header {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n}\n\n.lumiverse-item-name {\n    font-weight: 500;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-dominant-btn {\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text-dim);\n    font-size: 14px;\n    cursor: pointer;\n    padding: 2px 4px;\n    transition: color var(--lumiverse-transition);\n}\n\n.lumiverse-dominant-btn:hover {\n    color: var(--lumiverse-warning);\n}\n\n.lumiverse-dominant-btn--active {\n    color: var(--lumiverse-warning);\n}\n\n.lumiverse-item-description {\n    margin: 4px 0 0 0;\n    font-size: 13px;\n    color: var(--lumiverse-text-muted);\n    overflow: hidden;\n    text-overflow: ellipsis;\n    display: -webkit-box;\n    -webkit-line-clamp: 2;\n    -webkit-box-orient: vertical;\n}\n\n.lumiverse-item-checkbox {\n    margin-left: 12px;\n    flex-shrink: 0;\n}\n\n.lumiverse-checkbox {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 20px;\n    height: 20px;\n    border: 2px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius-sm);\n    color: transparent;\n    font-size: 12px;\n    transition: all var(--lumiverse-transition);\n}\n\n.lumiverse-checkbox.checked {\n    background: var(--lumiverse-primary);\n    border-color: var(--lumiverse-primary);\n    color: white;\n}\n\n.lumiverse-radio-dot {\n    width: 20px;\n    height: 20px;\n    border: 2px solid var(--lumiverse-border);\n    border-radius: 50%;\n    position: relative;\n}\n\n.lumiverse-radio-dot.checked::after {\n    content: '';\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    width: 10px;\n    height: 10px;\n    background: var(--lumiverse-primary);\n    border-radius: 50%;\n}\n\n/* ----------------------------------------\n   Empty State\n   ---------------------------------------- */\n.lumiverse-empty-state {\n    text-align: center;\n    padding: 40px 20px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-empty-icon {\n    font-size: 48px;\n    display: block;\n    margin-bottom: 16px;\n}\n\n.lumiverse-empty-state p {\n    margin: 0 0 8px 0;\n}\n\n.lumiverse-empty-hint {\n    font-size: 13px;\n    color: var(--lumiverse-text-dim);\n}\n\n/* ----------------------------------------\n   Pack Editor Modal\n   ---------------------------------------- */\n.lumiverse-pack-editor-modal {\n    display: flex;\n    flex-direction: column;\n    height: 100%;\n}\n\n.lumiverse-pack-editor-content {\n    flex: 1;\n    overflow-y: auto;\n    padding: 20px;\n}\n\n.lumiverse-pack-metadata {\n    margin-bottom: 24px;\n}\n\n.lumiverse-pack-metadata h3,\n.lumiverse-pack-items-header h3 {\n    margin: 0 0 16px 0;\n    font-size: 16px;\n    font-weight: 600;\n}\n\n.lumiverse-pack-items-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    margin-bottom: 16px;\n}\n\n.lumiverse-pack-items-list {\n    display: flex;\n    flex-direction: column;\n    gap: 16px;\n}\n\n.lumiverse-pack-editor-footer {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 16px 20px;\n    background: var(--lumiverse-bg-elevated);\n    border-top: 1px solid var(--lumiverse-border);\n}\n\n.lumiverse-pack-editor-actions {\n    display: flex;\n    gap: 8px;\n}\n\n/* ----------------------------------------\n   Form Fields\n   ---------------------------------------- */\n.lumiverse-form-field {\n    margin-bottom: 16px;\n}\n\n.lumiverse-form-field--error .lumiverse-input,\n.lumiverse-form-field--error .lumiverse-textarea {\n    border-color: var(--lumiverse-danger);\n}\n\n.lumiverse-form-label {\n    display: block;\n    margin-bottom: 6px;\n    font-weight: 500;\n    font-size: 13px;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-required {\n    color: var(--lumiverse-danger);\n    margin-left: 2px;\n}\n\n.lumiverse-form-error {\n    display: block;\n    margin-top: 4px;\n    font-size: 12px;\n    color: var(--lumiverse-danger);\n}\n\n.lumiverse-input,\n.lumiverse-textarea,\n.lumiverse-select {\n    width: 100%;\n    padding: 10px 12px;\n    background: var(--lumiverse-bg-elevated);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    color: var(--lumiverse-text);\n    font-size: 14px;\n    font-family: inherit;\n    transition: border-color var(--lumiverse-transition);\n}\n\n.lumiverse-input:focus,\n.lumiverse-textarea:focus,\n.lumiverse-select:focus {\n    outline: none;\n    border-color: var(--lumiverse-primary);\n}\n\n.lumiverse-textarea {\n    resize: vertical;\n    min-height: 80px;\n}\n\n.lumiverse-select {\n    cursor: pointer;\n}\n\n/* ----------------------------------------\n   Image Input\n   ---------------------------------------- */\n.lumiverse-image-input {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumiverse-image-preview {\n    width: 100px;\n    height: 100px;\n    border-radius: var(--lumiverse-radius);\n    overflow: hidden;\n    background: var(--lumiverse-bg);\n}\n\n.lumiverse-image-preview img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n}\n\n.lumiverse-image-error {\n    font-size: 12px;\n    color: var(--lumiverse-danger);\n}\n\n/* ----------------------------------------\n   Lumia Item Editor\n   ---------------------------------------- */\n.lumiverse-lumia-editor {\n    background: var(--lumiverse-bg-elevated);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    padding: 16px;\n}\n\n.lumiverse-lumia-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    margin-bottom: 16px;\n    padding-bottom: 12px;\n    border-bottom: 1px solid var(--lumiverse-border);\n}\n\n.lumiverse-lumia-type {\n    font-size: 12px;\n    font-weight: 600;\n    text-transform: uppercase;\n    color: var(--lumiverse-primary);\n    background: var(--lumiverse-primary-light);\n    padding: 4px 8px;\n    border-radius: var(--lumiverse-radius-sm);\n}\n\n.lumiverse-lumia-fields {\n    display: grid;\n    gap: 12px;\n}\n\n/* ----------------------------------------\n   Loading & Error States\n   ---------------------------------------- */\n.lumiverse-loading-overlay {\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background: rgba(0, 0, 0, 0.5);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    z-index: 10001;\n}\n\n.lumiverse-spinner {\n    width: 40px;\n    height: 40px;\n    border: 3px solid var(--lumiverse-border);\n    border-top-color: var(--lumiverse-primary);\n    border-radius: 50%;\n    animation: lumiverse-spin 0.8s linear infinite;\n}\n\n@keyframes lumiverse-spin {\n    to {\n        transform: rotate(360deg);\n    }\n}\n\n.lumiverse-error-toast {\n    position: fixed;\n    bottom: 20px;\n    right: 20px;\n    display: flex;\n    align-items: center;\n    gap: 12px;\n    padding: 12px 16px;\n    background: var(--lumiverse-danger);\n    color: white;\n    border-radius: var(--lumiverse-radius);\n    box-shadow: var(--lumiverse-shadow-lg);\n    z-index: 10002;\n    cursor: pointer;\n}\n\n.lumiverse-error-dismiss {\n    background: rgba(255, 255, 255, 0.2);\n    border: none;\n    color: white;\n    padding: 4px 8px;\n    border-radius: var(--lumiverse-radius-sm);\n    font-size: 12px;\n    cursor: pointer;\n}\n\n/* ----------------------------------------\n   Header Badge\n   ---------------------------------------- */\n.lumiverse-header-badge {\n    font-size: 10px;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    padding: 4px 8px;\n    background: var(--lumiverse-primary-light);\n    color: var(--lumiverse-primary);\n    border-radius: var(--lumiverse-radius-sm);\n}\n\n/* ----------------------------------------\n   Selector Components - Matching old lumia-selector pattern\n   ---------------------------------------- */\n.lumiverse-selector {\n    background: rgba(0, 0, 0, 0.15);\n    border: 1px solid rgba(128, 128, 128, 0.12);\n    border-radius: var(--lumiverse-radius-md);\n    padding: 12px 14px;\n    transition: all var(--lumiverse-transition);\n}\n\n.lumiverse-selector:hover {\n    border-color: rgba(147, 112, 219, 0.2);\n    background: rgba(0, 0, 0, 0.2);\n}\n\n.lumiverse-selector-group {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n}\n\n.lumiverse-selector-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    margin-bottom: 8px;\n}\n\n.lumiverse-selector-label {\n    font-size: 12px;\n    font-weight: 600;\n    color: rgba(255, 255, 255, 0.8);\n    letter-spacing: 0.1px;\n}\n\n.lumiverse-selector-hint {\n    font-size: 10px;\n    font-weight: 500;\n    color: rgba(147, 112, 219, 0.6);\n    text-transform: uppercase;\n    letter-spacing: 0.3px;\n}\n\n.lumiverse-selector-row {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n}\n\n.lumiverse-selector-value {\n    flex: 1;\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--lumiverse-text-muted);\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n    min-width: 0;\n    display: flex;\n    align-items: center;\n    gap: 8px;\n}\n\n.lumiverse-dominant-badge {\n    font-size: 11px;\n    color: var(--lumiverse-warning);\n    background: rgba(245, 158, 11, 0.15);\n    padding: 3px 8px;\n    border-radius: var(--lumiverse-radius-sm);\n    border: 1px solid rgba(245, 158, 11, 0.25);\n}\n\n/* ----------------------------------------\n   Tool Buttons - Grid layout with accent styling\n   ---------------------------------------- */\n.lumiverse-tools-row {\n    display: grid;\n    grid-template-columns: repeat(2, 1fr);\n    gap: 10px;\n}\n\n.lumiverse-tool-btn {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    gap: 8px;\n    padding: 16px 12px;\n    background: rgba(0, 0, 0, 0.15);\n    border: 1px solid rgba(128, 128, 128, 0.12);\n    border-radius: var(--lumiverse-radius-md);\n    color: rgba(255, 255, 255, 0.75);\n    font-size: 12px;\n    font-weight: 500;\n    font-family: inherit;\n    cursor: pointer;\n    transition: all var(--lumiverse-transition);\n}\n\n.lumiverse-tool-icon {\n    font-size: 18px;\n    transition: transform var(--lumiverse-transition);\n}\n\n.lumiverse-tool-btn:hover {\n    background: rgba(147, 112, 219, 0.1);\n    border-color: rgba(147, 112, 219, 0.25);\n}\n\n.lumiverse-tool-btn:hover .lumiverse-tool-icon {\n    transform: scale(1.1);\n}\n\n.lumiverse-tool-btn-accent {\n    background: linear-gradient(\n        135deg,\n        rgba(147, 112, 219, 0.2) 0%,\n        rgba(123, 95, 196, 0.15) 100%\n    );\n    border-color: rgba(147, 112, 219, 0.35);\n    color: var(--lumiverse-primary-text);\n}\n\n.lumiverse-tool-btn-accent:hover {\n    background: linear-gradient(\n        135deg,\n        rgba(147, 112, 219, 0.3) 0%,\n        rgba(123, 95, 196, 0.25) 100%\n    );\n    border-color: rgba(147, 112, 219, 0.5);\n}\n\n.lumiverse-tool-icon {\n    font-size: 16px;\n}\n\n/* ----------------------------------------\n   Macro Reference - Matching old lumia-macro pattern\n   ---------------------------------------- */\n.lumiverse-macro-reference {\n    display: flex;\n    flex-direction: column;\n    gap: 14px;\n}\n\n.lumiverse-macro-group {\n    display: flex;\n    flex-direction: column;\n    gap: 6px;\n}\n\n.lumiverse-macro-group-title {\n    font-size: 10px;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    color: rgba(147, 112, 219, 0.7);\n    margin-bottom: 2px;\n}\n\n.lumiverse-macro-list {\n    display: flex;\n    flex-direction: column;\n    gap: 4px;\n}\n\n.lumiverse-macro {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 6px 0;\n    cursor: pointer;\n    transition: all var(--lumiverse-transition);\n}\n\n.lumiverse-macro:hover {\n    opacity: 0.85;\n}\n\n.lumiverse-macro--copied {\n    opacity: 1;\n}\n\n.lumiverse-macro--copied code {\n    background: rgba(147, 112, 219, 0.25);\n    border-color: rgba(147, 112, 219, 0.4);\n}\n\n.lumiverse-macro code {\n    font-family: var(--lumiverse-font-mono);\n    font-size: 11px;\n    padding: 4px 8px;\n    background: rgba(0, 0, 0, 0.3);\n    border: 1px solid rgba(128, 128, 128, 0.15);\n    border-radius: var(--lumiverse-radius-sm);\n    color: var(--lumiverse-primary-text);\n    white-space: nowrap;\n    transition: all var(--lumiverse-transition);\n}\n\n.lumiverse-macro span {\n    font-size: 12px;\n    color: rgba(255, 255, 255, 0.55);\n}\n\n/* ----------------------------------------\n   Status Badge - Pack count indicator\n   ---------------------------------------- */\n.lumiverse-status-badge {\n    display: inline-flex;\n    align-items: center;\n    padding: 6px 12px;\n    margin-bottom: 12px;\n    background: rgba(147, 112, 219, 0.1);\n    border: 1px solid rgba(147, 112, 219, 0.2);\n    border-radius: 20px;\n    font-size: 12px;\n    font-weight: 500;\n    color: var(--lumiverse-primary-text);\n    letter-spacing: 0.1px;\n}\n\n/* ----------------------------------------\n   Divider - Matching old lumia-divider-text\n   ---------------------------------------- */\n.lumiverse-divider-text {\n    text-align: center;\n    font-size: 11px;\n    font-weight: 500;\n    color: rgba(255, 255, 255, 0.3);\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    margin: 12px 0;\n    position: relative;\n}\n\n.lumiverse-divider-text::before,\n.lumiverse-divider-text::after {\n    content: '';\n    position: absolute;\n    top: 50%;\n    width: calc(50% - 20px);\n    height: 1px;\n    background: rgba(128, 128, 128, 0.2);\n}\n\n.lumiverse-divider-text::before {\n    left: 0;\n}\n\n.lumiverse-divider-text::after {\n    right: 0;\n}\n\n/* ----------------------------------------\n   Input Row and Input Styling\n   ---------------------------------------- */\n.lumiverse-input-row {\n    display: flex;\n    gap: 8px;\n    margin-bottom: 10px;\n}\n\n.lumiverse-input {\n    flex: 1;\n    padding: 10px 14px;\n    background: rgba(0, 0, 0, 0.25);\n    border: 1px solid rgba(128, 128, 128, 0.2);\n    border-radius: var(--lumiverse-radius);\n    font-size: 13px;\n    color: var(--lumiverse-text);\n    font-family: inherit;\n    transition: all var(--lumiverse-transition);\n}\n\n.lumiverse-input::placeholder {\n    color: rgba(255, 255, 255, 0.35);\n}\n\n.lumiverse-input:focus {\n    outline: none;\n    border-color: rgba(147, 112, 219, 0.5);\n    background: rgba(0, 0, 0, 0.35);\n}\n\n/* ----------------------------------------\n   Custom Packs List\n   ---------------------------------------- */\n.lumiverse-custom-packs {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n/* ----------------------------------------\n   Loom Selection Modal\n   ---------------------------------------- */\n.lumiverse-loom-selection-modal {\n    display: flex;\n    flex-direction: column;\n    height: 100%;\n}\n\n.lumiverse-selection-actions {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n}\n\n.lumiverse-loom-item {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 12px 16px;\n    background: var(--lumiverse-bg-tertiary);\n    border-radius: var(--lumiverse-radius-sm);\n    cursor: pointer;\n    transition: all var(--lumiverse-transition);\n    border: 1px solid transparent;\n}\n\n.lumiverse-loom-item:hover {\n    background: var(--lumiverse-bg-secondary);\n    border-color: var(--lumiverse-border-light);\n}\n\n.lumiverse-loom-item--selected {\n    background: rgba(var(--lumiverse-primary-rgb, 147, 112, 219), 0.15);\n    border-color: var(--lumiverse-primary);\n}\n\n.lumiverse-loom-item-content {\n    flex: 1;\n}\n\n.lumiverse-loom-item-name {\n    font-weight: 500;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-loom-item-toggle {\n    margin-left: 12px;\n}\n\n.lumiverse-toggle-switch {\n    position: relative;\n    width: 40px;\n    height: 22px;\n}\n\n.lumiverse-toggle-track {\n    width: 100%;\n    height: 100%;\n    background: var(--lumiverse-bg-secondary);\n    border: 2px solid var(--lumiverse-border);\n    border-radius: 11px;\n    transition: all var(--lumiverse-transition);\n}\n\n.lumiverse-toggle-switch.checked .lumiverse-toggle-track {\n    background: var(--lumiverse-primary);\n    border-color: var(--lumiverse-primary);\n}\n\n.lumiverse-toggle-thumb {\n    position: absolute;\n    top: 3px;\n    left: 3px;\n    width: 16px;\n    height: 16px;\n    background: white;\n    border-radius: 50%;\n    transition: transform var(--lumiverse-transition);\n}\n\n.lumiverse-toggle-switch.checked .lumiverse-toggle-thumb {\n    transform: translateX(18px);\n}\n\n/* Selection footer for Loom modals */\n.lumiverse-selection-footer {\n    display: flex;\n    justify-content: flex-end;\n    padding: 16px;\n    border-top: 1px solid var(--lumiverse-border);\n    margin-top: auto;\n}\n\n/* Text button style */\n.lumiverse-btn--text {\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text-muted);\n    padding: 4px 8px;\n}\n\n.lumiverse-btn--text:hover {\n    color: var(--lumiverse-text);\n    background: var(--lumiverse-bg-tertiary);\n}\n\n/* Pack section improvements for Loom modal */\n.lumiverse-pack-icon {\n    margin-right: 8px;\n}\n\n/* Ensure pack items have proper spacing */\n.lumiverse-pack-items {\n    display: flex;\n    flex-direction: column;\n    gap: 4px;\n    padding: 12px;\n    background: var(--lumiverse-bg-secondary);\n    border-radius: 0 0 var(--lumiverse-radius) var(--lumiverse-radius);\n}\n\n/* Pack section collapsed state */\n.lumiverse-pack-section.collapsed .lumiverse-pack-items {\n    display: none;\n}\n\n/* Custom pack badge */\n.lumiverse-pack-badge-custom {\n    font-size: 10px;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    padding: 2px 6px;\n    background: rgba(var(--lumiverse-primary-rgb, 147, 112, 219), 0.2);\n    color: var(--lumiverse-primary);\n    border-radius: 4px;\n    margin-left: 8px;\n}\n\n/* Small icon button */\n.lumiverse-icon-btn-sm {\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    width: 28px;\n    height: 28px;\n    padding: 0;\n    background: transparent;\n    border: none;\n    border-radius: 6px;\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    transition: all 0.15s ease;\n    margin-left: auto;\n    flex-shrink: 0;\n}\n\n.lumiverse-icon-btn-sm:hover {\n    color: var(--lumiverse-danger, #ef4444);\n    background: rgba(239, 68, 68, 0.1);\n}\n\n.lumiverse-icon-btn-sm svg,\n.lumiverse-icon-sm svg {\n    width: 16px;\n    height: 16px;\n}\n\n.lumiverse-icon-sm {\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n}\n\n/* ============================================\n   LOOM MODAL CONTROLS - Collapse/Expand & Sort\n   ============================================ */\n\n.lumiverse-modal-controls {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    gap: 12px;\n    padding: 12px 16px;\n    background: var(--lumiverse-bg-elevated, #1a1a1a);\n    border-bottom: 1px solid var(--lumiverse-border);\n}\n\n.lumiverse-modal-controls-group {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n}\n\n.lumiverse-modal-control-btn {\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    gap: 6px;\n    padding: 8px 12px;\n    font-size: 12px;\n    font-weight: 500;\n    color: var(--lumiverse-text-secondary, #999);\n    background: var(--lumiverse-bg-tertiary, #2a2a2a);\n    border: 1px solid var(--lumiverse-border, #3a3a3a);\n    border-radius: 8px;\n    cursor: pointer;\n    transition: all 0.15s ease;\n    white-space: nowrap;\n}\n\n.lumiverse-modal-control-btn:hover {\n    color: var(--lumiverse-text, #fff);\n    background: var(--lumiverse-bg-hover, #333);\n    border-color: var(--lumiverse-accent, #7c3aed);\n}\n\n.lumiverse-modal-control-btn:active {\n    transform: scale(0.97);\n}\n\n.lumiverse-control-icon,\n.lumiverse-control-icon svg {\n    width: 14px;\n    height: 14px;\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n}\n\n/* Sort Dropdown for Loom modals */\n.lumiverse-modal-sort {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    padding: 6px 12px;\n    background: var(--lumiverse-bg-tertiary, #2a2a2a);\n    border: 1px solid var(--lumiverse-border, #3a3a3a);\n    border-radius: 8px;\n}\n\n.lumiverse-modal-sort-label {\n    font-size: 12px;\n    font-weight: 500;\n    color: var(--lumiverse-text-muted, #666);\n}\n\n.lumiverse-select {\n    padding: 4px 8px;\n    font-size: 12px;\n    font-weight: 500;\n    color: var(--lumiverse-text, #fff);\n    background: var(--lumiverse-bg-secondary, #1e1e1e);\n    border: 1px solid var(--lumiverse-border, #3a3a3a);\n    border-radius: 6px;\n    cursor: pointer;\n    transition: all 0.15s ease;\n    min-width: 100px;\n}\n\n.lumiverse-select:hover {\n    border-color: var(--lumiverse-border-hover, #4a4a4a);\n}\n\n.lumiverse-select:focus {\n    outline: none;\n    border-color: var(--lumiverse-accent, #7c3aed);\n    box-shadow: 0 0 0 2px rgba(124, 58, 237, 0.15);\n}\n\n/* Mobile adjustments for Loom modal controls */\n@media (max-width: 600px) {\n    .lumiverse-modal-controls {\n        flex-wrap: wrap;\n        gap: 8px;\n        padding: 10px 12px;\n    }\n\n    .lumiverse-modal-control-btn {\n        padding: 6px 10px;\n        font-size: 11px;\n    }\n\n    .lumiverse-modal-control-btn span {\n        display: none;\n    }\n\n    .lumiverse-modal-control-btn .lumiverse-control-icon {\n        margin: 0;\n    }\n\n    .lumiverse-modal-sort {\n        flex: 1;\n        min-width: 100%;\n        justify-content: space-between;\n    }\n\n    .lumiverse-select {\n        flex: 1;\n        min-width: 0;\n    }\n}\n\n/* ----------------------------------------\n   Pack Editor Modal\n   ---------------------------------------- */\n.lumiverse-pack-editor-modal {\n    display: flex;\n    flex-direction: column;\n    height: 100%;\n}\n\n.lumiverse-pack-editor-content {\n    flex: 1;\n    overflow-y: auto;\n    padding: 16px;\n    display: flex;\n    flex-direction: column;\n    gap: 24px;\n}\n\n.lumiverse-pack-metadata h3,\n.lumiverse-pack-items-section h3 {\n    margin: 0 0 16px 0;\n    font-size: 16px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-pack-items-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 16px;\n}\n\n.lumiverse-pack-items-header h3 {\n    margin: 0;\n}\n\n.lumiverse-pack-items-list {\n    display: flex;\n    flex-direction: column;\n    gap: 16px;\n}\n\n/* Lumia Item Editor */\n.lumiverse-lumia-editor {\n    background: var(--lumiverse-bg-tertiary);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    overflow: hidden;\n}\n\n.lumiverse-lumia-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 12px 16px;\n    background: var(--lumiverse-bg-secondary);\n    border-bottom: 1px solid var(--lumiverse-border);\n}\n\n.lumiverse-lumia-type {\n    font-size: 12px;\n    font-weight: 600;\n    text-transform: uppercase;\n    color: var(--lumiverse-text-muted);\n    background: var(--lumiverse-bg-primary);\n    padding: 4px 8px;\n    border-radius: var(--lumiverse-radius-sm);\n}\n\n.lumiverse-lumia-fields {\n    padding: 16px;\n    display: flex;\n    flex-direction: column;\n    gap: 16px;\n}\n\n/* Pack Editor Footer */\n.lumiverse-pack-editor-footer {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 16px;\n    border-top: 1px solid var(--lumiverse-border);\n    background: var(--lumiverse-bg-secondary);\n}\n\n.lumiverse-pack-editor-footer-left {\n    display: flex;\n    gap: 8px;\n    align-items: center;\n}\n\n.lumiverse-pack-editor-actions {\n    display: flex;\n    gap: 8px;\n    margin-left: auto;\n}\n\n/* Pack Editor Title */\n.lumiverse-pack-editor-title {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    margin-bottom: 20px;\n}\n\n.lumiverse-pack-editor-title h3 {\n    margin: 0;\n    font-size: 18px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-pack-editor-title svg {\n    color: var(--lumiverse-primary-text);\n}\n\n/* Pack Lumias Info Section */\n.lumiverse-pack-lumias-info {\n    background: var(--lumiverse-bg-tertiary);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    padding: 16px;\n}\n\n.lumiverse-pack-lumias-header {\n    margin-bottom: 8px;\n}\n\n.lumiverse-pack-lumias-count {\n    font-size: 14px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-pack-lumias-hint {\n    font-size: 13px;\n    color: var(--lumiverse-text-muted);\n    margin: 0 0 12px 0;\n}\n\n/* Full width button modifier */\n.lumiverse-btn--full {\n    width: 100%;\n    justify-content: center;\n}\n\n/* Form hint text */\n.lumiverse-form-hint {\n    display: block;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n    margin-top: 4px;\n    font-style: italic;\n}\n\n/* Lumia editor row (side-by-side fields) */\n.lumiverse-lumia-row {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 12px;\n}\n\n.lumiverse-lumia-row .lumiverse-form-field {\n    margin-bottom: 0;\n}\n\n/* Lumia name in header */\n.lumiverse-lumia-name {\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    font-size: 14px;\n}\n\n/* Clickable Lumia name (for opening full editor) */\n.lumiverse-lumia-name--clickable {\n    cursor: pointer;\n    transition: color 0.15s ease;\n}\n\n.lumiverse-lumia-name--clickable:hover {\n    color: var(--lumiverse-primary-text);\n}\n\n/* Header actions container */\n.lumiverse-lumia-header-actions {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n}\n\n/* Expand button in header */\n.lumiverse-btn--expand {\n    background: rgba(147, 112, 219, 0.1);\n    border: 1px solid rgba(147, 112, 219, 0.2);\n    color: var(--lumiverse-primary-text);\n    opacity: 0.7;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-btn--expand:hover {\n    background: rgba(147, 112, 219, 0.2);\n    opacity: 1;\n}\n\n/* Image Input */\n.lumiverse-image-input {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumiverse-image-preview {\n    width: 100px;\n    height: 100px;\n    border-radius: var(--lumiverse-radius);\n    overflow: hidden;\n    border: 1px solid var(--lumiverse-border);\n}\n\n.lumiverse-image-preview img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n}\n\n.lumiverse-image-error {\n    color: var(--lumiverse-danger);\n    font-size: 12px;\n}\n\n/* Danger button */\n.lumiverse-btn--danger {\n    background: transparent;\n    border: 1px solid var(--lumiverse-danger);\n    color: var(--lumiverse-danger);\n}\n\n.lumiverse-btn--danger:hover {\n    background: var(--lumiverse-danger);\n    color: white;\n}\n\n.lumiverse-btn--icon {\n    padding: 6px 8px;\n}\n\n/* Select input */\n.lumiverse-select {\n    width: 100%;\n    padding: 10px 12px;\n    background: var(--lumiverse-bg-tertiary);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius-sm);\n    color: var(--lumiverse-text);\n    font-size: 14px;\n    cursor: pointer;\n}\n\n.lumiverse-select:focus {\n    outline: none;\n    border-color: var(--lumiverse-primary);\n}\n\n/* Required asterisk */\n.lumiverse-required {\n    color: var(--lumiverse-danger);\n    margin-left: 4px;\n}\n\n/* ----------------------------------------\n   Pack Selector Modal\n   ---------------------------------------- */\n.lumia-modal-pack-selector {\n    max-width: 480px;\n    width: 90%;\n}\n\n.lumiverse-pack-selector-modal {\n    display: flex;\n    flex-direction: column;\n    max-height: 70vh;\n}\n\n.lumiverse-pack-selector-content {\n    flex: 1;\n    overflow-y: auto;\n    padding: 16px;\n}\n\n.lumiverse-pack-selector-section {\n    margin-bottom: 16px;\n}\n\n.lumiverse-pack-selector-heading {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    margin: 0 0 12px 0;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n.lumiverse-pack-selector-empty {\n    padding: 20px;\n    text-align: center;\n    color: var(--lumiverse-text-muted);\n    font-size: 13px;\n    background: var(--lumiverse-bg-tertiary);\n    border-radius: var(--lumiverse-radius);\n}\n\n.lumiverse-pack-selector-list {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumiverse-pack-selector-item {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n    padding: 12px 14px;\n    background: var(--lumiverse-bg-tertiary);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    cursor: pointer;\n    transition: all 0.15s ease;\n    text-align: left;\n    width: 100%;\n}\n\n.lumiverse-pack-selector-item:hover {\n    background: var(--lumiverse-bg-hover);\n    border-color: var(--lumiverse-primary);\n}\n\n.lumiverse-pack-selector-item-icon {\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-pack-selector-item-info {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n}\n\n.lumiverse-pack-selector-item-name {\n    font-weight: 500;\n    color: var(--lumiverse-text);\n    font-size: 14px;\n}\n\n.lumiverse-pack-selector-item-meta {\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-pack-selector-item-arrow {\n    color: var(--lumiverse-text-muted);\n    opacity: 0;\n    transition: opacity 0.15s ease;\n}\n\n.lumiverse-pack-selector-item:hover .lumiverse-pack-selector-item-arrow {\n    opacity: 1;\n}\n\n.lumiverse-pack-selector-divider {\n    display: flex;\n    align-items: center;\n    margin: 16px 0;\n    color: var(--lumiverse-text-muted);\n    font-size: 12px;\n}\n\n.lumiverse-pack-selector-divider::before,\n.lumiverse-pack-selector-divider::after {\n    content: '';\n    flex: 1;\n    height: 1px;\n    background: var(--lumiverse-border);\n}\n\n.lumiverse-pack-selector-divider span {\n    padding: 0 12px;\n}\n\n.lumiverse-pack-selector-create-btn {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 8px;\n    width: 100%;\n    padding: 14px;\n    background: transparent;\n    border: 2px dashed var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    color: var(--lumiverse-text-muted);\n    font-size: 14px;\n    cursor: pointer;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-pack-selector-create-btn:hover {\n    border-color: var(--lumiverse-primary);\n    color: var(--lumiverse-primary);\n    background: rgba(var(--lumiverse-primary-rgb), 0.05);\n}\n\n.lumiverse-pack-selector-form {\n    background: var(--lumiverse-bg-tertiary);\n    border-radius: var(--lumiverse-radius);\n    padding: 16px;\n}\n\n.lumiverse-pack-selector-field {\n    margin-bottom: 12px;\n}\n\n.lumiverse-pack-selector-field:last-of-type {\n    margin-bottom: 0;\n}\n\n.lumiverse-pack-selector-error {\n    color: var(--lumiverse-danger);\n    font-size: 12px;\n    margin: 8px 0;\n}\n\n.lumiverse-pack-selector-form-actions {\n    display: flex;\n    gap: 8px;\n    justify-content: flex-end;\n    margin-top: 16px;\n}\n\n.lumiverse-pack-selector-footer {\n    display: flex;\n    justify-content: flex-end;\n    padding: 12px 16px;\n    border-top: 1px solid var(--lumiverse-border);\n    background: var(--lumiverse-bg-secondary);\n}\n\n/* Pack Selector - Expandable Item Wrapper */\n.lumiverse-pack-selector-item-wrapper {\n    border-radius: var(--lumiverse-radius);\n    overflow: hidden;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-pack-selector-item-wrapper--expanded {\n    background: rgba(0, 0, 0, 0.15);\n    border: 1px solid var(--lumiverse-border);\n}\n\n.lumiverse-pack-selector-item-wrapper--expanded .lumiverse-pack-selector-item {\n    border-color: transparent;\n    border-radius: var(--lumiverse-radius) var(--lumiverse-radius) 0 0;\n}\n\n.lumiverse-pack-selector-item-wrapper--expanded .lumiverse-pack-selector-item-arrow {\n    opacity: 1;\n}\n\n/* Pack Selector - Expanded Lumias List */\n.lumiverse-pack-selector-lumias {\n    padding: 8px 12px 12px;\n    border-top: 1px solid var(--lumiverse-border-light);\n}\n\n.lumiverse-pack-selector-add-lumia {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 6px;\n    width: 100%;\n    padding: 10px 12px;\n    margin-bottom: 8px;\n    background: rgba(147, 112, 219, 0.1);\n    border: 1px dashed rgba(147, 112, 219, 0.3);\n    border-radius: var(--lumiverse-radius-sm);\n    color: var(--lumiverse-primary-text);\n    font-size: 13px;\n    font-weight: 500;\n    cursor: pointer;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-pack-selector-add-lumia:hover {\n    background: rgba(147, 112, 219, 0.2);\n    border-color: rgba(147, 112, 219, 0.5);\n}\n\n.lumiverse-pack-selector-lumia-list {\n    display: flex;\n    flex-direction: column;\n    gap: 4px;\n}\n\n.lumiverse-pack-selector-lumia-item {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 8px 10px;\n    background: rgba(0, 0, 0, 0.1);\n    border: 1px solid rgba(128, 128, 128, 0.08);\n    border-radius: var(--lumiverse-radius-sm);\n    transition: all 0.15s ease;\n}\n\n.lumiverse-pack-selector-lumia-item:hover {\n    background: rgba(0, 0, 0, 0.18);\n    border-color: rgba(147, 112, 219, 0.2);\n}\n\n.lumiverse-pack-selector-lumia-avatar {\n    width: 28px;\n    height: 28px;\n    border-radius: 50%;\n    object-fit: cover;\n    border: 1px solid rgba(147, 112, 219, 0.2);\n    flex-shrink: 0;\n}\n\n.lumiverse-pack-selector-lumia-name {\n    flex: 1;\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-pack-selector-lumia-edit {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 28px;\n    height: 28px;\n    padding: 0;\n    background: rgba(147, 112, 219, 0.15);\n    border: 1px solid rgba(147, 112, 219, 0.2);\n    border-radius: var(--lumiverse-radius-sm);\n    color: var(--lumiverse-primary-text);\n    cursor: pointer;\n    transition: all 0.15s ease;\n    flex-shrink: 0;\n}\n\n.lumiverse-pack-selector-lumia-edit:hover {\n    background: rgba(147, 112, 219, 0.3);\n    border-color: rgba(147, 112, 219, 0.4);\n}\n\n.lumiverse-pack-selector-lumia-empty {\n    padding: 12px;\n    text-align: center;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n    font-style: italic;\n}\n\n/* ----------------------------------------\n   Lumia Editor Modal\n   ---------------------------------------- */\n.lumia-modal-lumia-editor {\n    max-width: 640px;\n    width: 90%;\n}\n\n.lumiverse-editor-modal {\n    display: flex;\n    flex-direction: column;\n    max-height: 80vh;\n}\n\n.lumiverse-editor-content {\n    flex: 1;\n    overflow-y: auto;\n    padding: 16px;\n}\n\n.lumiverse-editor-section {\n    margin-bottom: 20px;\n    background: var(--lumiverse-bg-tertiary);\n    border-radius: var(--lumiverse-radius);\n    overflow: hidden;\n}\n\n.lumiverse-editor-section:last-child {\n    margin-bottom: 0;\n}\n\n.lumiverse-editor-section-header {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    padding: 12px 14px;\n    background: var(--lumiverse-bg-secondary);\n    border-bottom: 1px solid var(--lumiverse-border);\n    font-weight: 600;\n    font-size: 13px;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-editor-section-content {\n    padding: 14px;\n}\n\n.lumiverse-editor-field {\n    margin-bottom: 14px;\n}\n\n.lumiverse-editor-field:last-child {\n    margin-bottom: 0;\n}\n\n.lumiverse-editor-field--error .lumiverse-input,\n.lumiverse-editor-field--error .lumiverse-textarea {\n    border-color: var(--lumiverse-danger);\n}\n\n.lumiverse-editor-label {\n    display: block;\n    font-size: 12px;\n    font-weight: 500;\n    color: var(--lumiverse-text-muted);\n    margin-bottom: 6px;\n}\n\n.lumiverse-editor-hint {\n    display: block;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n    margin-top: 4px;\n    font-style: italic;\n}\n\n.lumiverse-editor-error {\n    display: block;\n    font-size: 11px;\n    color: var(--lumiverse-danger);\n    margin-top: 4px;\n}\n\n.lumiverse-editor-row {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 12px;\n}\n\n.lumiverse-editor-row .lumiverse-editor-field {\n    margin-bottom: 0;\n}\n\n.lumiverse-editor-avatar-preview {\n    width: 80px;\n    height: 80px;\n    border-radius: var(--lumiverse-radius);\n    overflow: hidden;\n    border: 1px solid var(--lumiverse-border);\n    margin-top: 8px;\n    position: relative;\n}\n\n.lumiverse-editor-avatar-preview img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n    opacity: 0;\n    transition: opacity 0.2s ease;\n}\n\n.lumiverse-editor-avatar-preview.loaded img {\n    opacity: 1;\n}\n\n.lumiverse-editor-avatar-spinner {\n    position: absolute;\n    inset: 0;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    background: var(--lumiverse-bg-tertiary);\n}\n\n.lumiverse-editor-avatar-spinner::after {\n    content: '';\n    width: 20px;\n    height: 20px;\n    border: 2px solid var(--lumiverse-border);\n    border-top-color: var(--lumiverse-primary);\n    border-radius: 50%;\n    animation: spin 0.8s linear infinite;\n}\n\n.lumiverse-editor-avatar-preview.loaded .lumiverse-editor-avatar-spinner {\n    display: none;\n}\n\n.lumiverse-editor-footer {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    padding: 12px 16px;\n    border-top: 1px solid var(--lumiverse-border);\n    background: var(--lumiverse-bg-secondary);\n}\n\n.lumiverse-editor-footer-spacer {\n    flex: 1;\n}\n\n/* ----------------------------------------\n   Viewport Panel (Dockable Sidebar)\n   ---------------------------------------- */\n\n/* Container for the viewport panel - mounted to document.body */\n.lumiverse-viewport-container {\n    /* Inline styles handle positioning, this is for any additional styling */\n    margin: 0;\n    padding: 0;\n}\n\n/* Wrapper that slides in/out - contains both toggle and panel */\n.lumiverse-viewport-wrapper {\n    display: flex;\n    flex-direction: row;\n    align-items: flex-start;\n    height: 100vh;\n    height: 100dvh;\n}\n\n/* Container for the toggle button - positioned to left of panel */\n.lumiverse-toggle-container {\n    position: absolute;\n    top: 12px;\n    right: 100%; /* Position to the left of the wrapper */\n    margin-right: 12px;\n    pointer-events: auto;\n}\n\n/* Custom position modifier - disables default positioning, uses inline styles */\n.lumiverse-toggle-container--custom {\n    /* Reset all positioning to allow inline styles to take effect */\n    position: fixed;\n    top: auto;\n    right: auto;\n    margin: 0;\n}\n\n.lumiverse-viewport-panel {\n    height: 100%;\n    display: flex;\n    flex-direction: row;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n    pointer-events: auto;\n}\n\n.lumiverse-viewport-panel--collapsed {\n    /* Just show the tab bar when collapsed */\n}\n\n/* Tab sidebar */\n.lumiverse-vp-tabs {\n    display: flex;\n    flex-direction: column;\n    width: 56px;\n    background: linear-gradient(180deg, rgba(28, 24, 38, 0.98) 0%, rgba(20, 17, 28, 0.98) 100%);\n    border-left: 1px solid rgba(147, 112, 219, 0.2);\n    padding: 8px 0; /* Minimal padding - panel is at top of screen */\n    gap: 4px;\n}\n\n.lumiverse-vp-tab {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    width: 52px;\n    height: 52px;\n    margin: 0 2px;\n    background: transparent;\n    border: none;\n    border-radius: 8px;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-vp-tab:hover {\n    background: rgba(147, 112, 219, 0.15);\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-vp-tab--active {\n    background: rgba(147, 112, 219, 0.25);\n    color: var(--lumiverse-primary);\n    box-shadow: inset 2px 0 0 var(--lumiverse-primary);\n}\n\n.lumiverse-vp-tab-icon {\n    font-size: 18px;\n    line-height: 1;\n}\n\n.lumiverse-vp-tab-label {\n    font-size: 10px;\n    margin-top: 4px;\n    white-space: nowrap;\n    overflow: visible;\n    text-overflow: clip;\n    max-width: none;\n}\n\n.lumiverse-vp-tabs-spacer {\n    flex: 1;\n}\n\n.lumiverse-vp-collapse-btn {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 52px;\n    height: 40px;\n    margin: 0 2px;\n    background: transparent;\n    border: none;\n    border-radius: 8px;\n    cursor: pointer;\n    color: var(--lumiverse-text-muted);\n    font-size: 14px;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-vp-collapse-btn:hover {\n    background: rgba(147, 112, 219, 0.15);\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-vp-collapse-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: transform 0.2s ease;\n}\n\n.lumiverse-vp-collapse-icon--rotated {\n    transform: rotate(180deg);\n}\n\n/* Main panel area */\n.lumiverse-vp-main {\n    display: flex;\n    flex-direction: column;\n    background: linear-gradient(180deg, rgba(28, 24, 38, 0.98) 0%, rgba(20, 17, 28, 0.98) 100%);\n    border-left: 1px solid rgba(147, 112, 219, 0.15);\n    overflow: hidden;\n}\n\n.lumiverse-vp-header {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 12px 16px;\n    background: rgba(147, 112, 219, 0.08);\n    border-bottom: 1px solid rgba(147, 112, 219, 0.15);\n    min-height: 48px;\n}\n\n.lumiverse-vp-header-icon {\n    font-size: 18px;\n}\n\n.lumiverse-vp-header-title {\n    flex: 1;\n    font-size: 14px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-vp-close-btn {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 28px;\n    height: 28px;\n    background: transparent;\n    border: none;\n    border-radius: 6px;\n    cursor: pointer;\n    color: var(--lumiverse-text-muted);\n    font-size: 14px;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-vp-close-btn:hover {\n    background: rgba(255, 100, 100, 0.2);\n    color: #ff6464;\n}\n\n.lumiverse-vp-content {\n    flex: 1;\n    position: relative; /* Containing block for absolute exit animations */\n    overflow-y: auto;\n    overflow-x: hidden;\n    scrollbar-gutter: stable; /* Reserve scrollbar space to prevent layout shift */\n    contain: layout style; /* Isolate layout calculations for performance */\n}\n\n.lumiverse-vp-tab-content {\n    display: none; /* Hidden by default */\n    min-height: 100%;\n}\n\n.lumiverse-vp-tab-content--active {\n    display: block; /* Show active tab instantly */\n}\n\n/* Placeholder content */\n.lumiverse-vp-placeholder {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    padding: 40px 20px;\n    text-align: center;\n    min-height: 300px;\n}\n\n.lumiverse-vp-placeholder-icon {\n    font-size: 48px;\n    margin-bottom: 16px;\n    opacity: 0.6;\n}\n\n.lumiverse-vp-placeholder h3 {\n    margin: 0 0 8px 0;\n    font-size: 16px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-vp-placeholder p {\n    margin: 0 0 16px 0;\n    font-size: 13px;\n    color: var(--lumiverse-text-muted);\n    max-width: 240px;\n}\n\n.lumiverse-vp-placeholder-badge {\n    display: inline-block;\n    padding: 4px 12px;\n    background: rgba(147, 112, 219, 0.15);\n    border: 1px solid rgba(147, 112, 219, 0.3);\n    border-radius: 12px;\n    font-size: 11px;\n    font-weight: 600;\n    color: var(--lumiverse-primary);\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n/* ----------------------------------------\n   Character Lumia Profile\n   ---------------------------------------- */\n.lumiverse-character-profile {\n    padding: 16px;\n    display: flex;\n    flex-direction: column;\n    gap: 16px;\n}\n\n/* Profile Header */\n.lumiverse-profile-header {\n    display: flex;\n    align-items: center;\n    gap: 14px;\n    padding-bottom: 16px;\n    border-bottom: 1px solid rgba(147, 112, 219, 0.15);\n}\n\n.lumiverse-profile-avatar {\n    width: 56px;\n    height: 56px;\n    border-radius: 12px;\n    overflow: hidden;\n    background: rgba(147, 112, 219, 0.1);\n    flex-shrink: 0;\n    border: 2px solid rgba(147, 112, 219, 0.3);\n}\n\n.lumiverse-profile-avatar img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n}\n\n.lumiverse-profile-avatar-placeholder {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 100%;\n    height: 100%;\n    font-size: 24px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-profile-info {\n    flex: 1;\n    min-width: 0;\n}\n\n.lumiverse-profile-name {\n    margin: 0 0 8px 0;\n    font-size: 16px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-profile-stats {\n    display: flex;\n    gap: 6px;\n}\n\n.lumiverse-stat {\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    gap: 4px;\n    padding: 4px 8px;\n    background: rgba(147, 112, 219, 0.08);\n    border-radius: 6px;\n    cursor: default;\n}\n\n.lumiverse-stat-icon {\n    color: var(--lumiverse-text-muted);\n    flex-shrink: 0;\n}\n\n.lumiverse-stat-value {\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--lumiverse-primary);\n}\n\n/* Profile Sections */\n.lumiverse-profile-section {\n    background: rgba(147, 112, 219, 0.05);\n    border-radius: 10px;\n    padding: 12px;\n}\n\n.lumiverse-profile-section-header {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    margin-bottom: 10px;\n}\n\n.lumiverse-profile-section-icon {\n    font-size: 14px;\n}\n\n.lumiverse-profile-section-title {\n    font-size: 12px;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    color: var(--lumiverse-text-muted);\n    flex: 1;\n}\n\n.lumiverse-profile-section-count {\n    font-size: 11px;\n    font-weight: 600;\n    color: var(--lumiverse-primary);\n    background: rgba(147, 112, 219, 0.15);\n    padding: 2px 8px;\n    border-radius: 10px;\n}\n\n/* Council Banner - shown in Profile tab when Council mode is active */\n.lumiverse-council-banner {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 16px;\n    padding: 24px 20px;\n    background: linear-gradient(\n        135deg,\n        rgba(147, 112, 219, 0.12) 0%,\n        rgba(100, 180, 255, 0.08) 100%\n    );\n    border: 1px solid rgba(147, 112, 219, 0.2);\n    border-radius: 12px;\n    text-align: center;\n}\n\n.lumiverse-council-banner-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 56px;\n    height: 56px;\n    background: linear-gradient(135deg, rgba(147, 112, 219, 0.25) 0%, rgba(100, 180, 255, 0.15) 100%);\n    border-radius: 50%;\n    color: var(--lumiverse-primary);\n}\n\n.lumiverse-council-banner-content {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n    width: 100%;\n}\n\n.lumiverse-council-banner-title {\n    font-size: 15px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    margin: 0;\n}\n\n.lumiverse-council-banner-stats {\n    display: flex;\n    justify-content: center;\n    gap: 16px;\n    flex-wrap: wrap;\n}\n\n.lumiverse-council-banner-stat {\n    display: flex;\n    align-items: center;\n    gap: 5px;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-council-banner-stat svg {\n    color: var(--lumiverse-primary);\n    opacity: 0.8;\n}\n\n.lumiverse-council-banner-avatars {\n    display: flex;\n    justify-content: center;\n    margin-top: 4px;\n}\n\n.lumiverse-council-banner-avatar {\n    width: 36px;\n    height: 36px;\n    border-radius: 50%;\n    background: rgba(147, 112, 219, 0.2);\n    border: 2px solid var(--lumiverse-surface);\n    margin-left: -10px;\n    overflow: hidden;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-council-banner-avatar:first-child {\n    margin-left: 0;\n}\n\n.lumiverse-council-banner-avatar img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n}\n\n.lumiverse-council-banner-more {\n    width: 36px;\n    height: 36px;\n    border-radius: 50%;\n    background: rgba(147, 112, 219, 0.3);\n    border: 2px solid var(--lumiverse-surface);\n    margin-left: -10px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 11px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-council-banner-btn {\n    display: inline-flex;\n    align-items: center;\n    gap: 6px;\n    padding: 10px 20px;\n    font-size: 13px;\n    font-weight: 500;\n    color: white;\n    background: linear-gradient(135deg, rgba(147, 112, 219, 0.9) 0%, rgba(123, 95, 196, 0.9) 100%);\n    border: none;\n    border-radius: 8px;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    margin-top: 4px;\n}\n\n.lumiverse-council-banner-btn:hover {\n    background: linear-gradient(135deg, rgba(167, 139, 240, 0.95) 0%, rgba(147, 112, 219, 0.95) 100%);\n    transform: translateY(-1px);\n    box-shadow: 0 4px 12px rgba(147, 112, 219, 0.3);\n}\n\n.lumiverse-council-banner-btn svg {\n    transition: transform 0.2s ease;\n}\n\n.lumiverse-council-banner-btn:hover svg {\n    transform: translateX(3px);\n}\n\n/* Trait Cards */\n.lumiverse-traits-list {\n    display: flex;\n    flex-direction: column;\n    gap: 6px;\n}\n\n.lumiverse-trait-card {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 10px 12px;\n    border-radius: 8px;\n    border: 1px solid transparent;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-trait-card:hover {\n    transform: translateX(2px);\n}\n\n.lumiverse-trait-card--dominant {\n    box-shadow: 0 0 0 1px rgba(245, 158, 11, 0.4), 0 2px 8px rgba(245, 158, 11, 0.15);\n}\n\n.lumiverse-trait-icon {\n    font-size: 14px;\n    flex-shrink: 0;\n}\n\n.lumiverse-trait-info {\n    flex: 1;\n    min-width: 0;\n    display: flex;\n    align-items: center;\n    gap: 8px;\n}\n\n.lumiverse-trait-name {\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-trait-dominant-badge {\n    font-size: 10px;\n    font-weight: 600;\n    color: var(--lumiverse-warning);\n    background: rgba(245, 158, 11, 0.15);\n    padding: 2px 6px;\n    border-radius: 4px;\n    white-space: nowrap;\n}\n\n.lumiverse-trait-remove {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 22px;\n    height: 22px;\n    background: transparent;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n    color: var(--lumiverse-text-muted);\n    font-size: 12px;\n    opacity: 0;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-trait-card:hover .lumiverse-trait-remove {\n    opacity: 1;\n}\n\n.lumiverse-trait-remove:hover {\n    background: rgba(239, 68, 68, 0.15);\n    color: var(--lumiverse-danger);\n}\n\n/* Empty Section */\n.lumiverse-profile-empty {\n    padding: 16px;\n    text-align: center;\n    color: var(--lumiverse-text-dim);\n    font-size: 12px;\n    font-style: italic;\n}\n\n/* Loom Summary */\n.lumiverse-loom-summary {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumiverse-loom-group {\n    display: flex;\n    align-items: flex-start;\n    gap: 8px;\n    font-size: 12px;\n}\n\n.lumiverse-loom-label {\n    font-weight: 600;\n    color: var(--lumiverse-text-muted);\n    flex-shrink: 0;\n    min-width: 60px;\n}\n\n.lumiverse-loom-items {\n    color: var(--lumiverse-text);\n    line-height: 1.4;\n}\n\n/* ----------------------------------------\n   Visual Pack Browser\n   ---------------------------------------- */\n.lumiverse-pack-browser {\n    padding: 12px;\n    display: flex;\n    flex-direction: column;\n    gap: 12px;\n    height: 100%;\n}\n\n/* Stats Bar */\n.lumiverse-browser-stats {\n    display: flex;\n    justify-content: space-between;\n    padding: 10px 12px;\n    background: rgba(147, 112, 219, 0.08);\n    border-radius: 10px;\n    gap: 8px;\n}\n\n.lumiverse-browser-stat {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    flex: 1;\n}\n\n.lumiverse-browser-stat-value {\n    font-size: 16px;\n    font-weight: 700;\n    color: var(--lumiverse-primary);\n}\n\n.lumiverse-browser-stat-label {\n    font-size: 9px;\n    letter-spacing: 0.5px;\n    color: var(--lumiverse-text-muted);\n}\n\n/* Search */\n.lumiverse-pack-search {\n    display: flex;\n    align-items: center;\n    background: rgba(30, 30, 46, 0.8);\n    border: 1px solid rgba(147, 112, 219, 0.2);\n    border-radius: 8px;\n    padding: 0 12px;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-pack-search:focus-within {\n    border-color: var(--lumiverse-primary);\n    box-shadow: 0 0 0 2px rgba(147, 112, 219, 0.15);\n}\n\n.lumiverse-pack-search-icon {\n    font-size: 14px;\n    margin-right: 8px;\n    opacity: 0.6;\n}\n\n.lumiverse-pack-search-input {\n    flex: 1;\n    background: transparent;\n    border: none;\n    padding: 10px 0;\n    color: var(--lumiverse-text);\n    font-size: 13px;\n}\n\n.lumiverse-pack-search-input:focus {\n    outline: none;\n}\n\n.lumiverse-pack-search-input::placeholder {\n    color: var(--lumiverse-text-dim);\n}\n\n.lumiverse-pack-search-clear {\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    padding: 4px;\n    font-size: 12px;\n    opacity: 0.6;\n    transition: opacity 0.15s ease;\n}\n\n.lumiverse-pack-search-clear:hover {\n    opacity: 1;\n}\n\n/* Filter Tabs */\n.lumiverse-pack-filters {\n    display: flex;\n    gap: 2px;\n    padding: 4px;\n    background: rgba(30, 30, 46, 0.6);\n    border-radius: 8px;\n}\n\n.lumiverse-pack-filter {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    flex: 1;\n    min-width: 32px;\n    height: 32px;\n    background: transparent;\n    border: none;\n    border-radius: 6px;\n    cursor: pointer;\n    transition: all 0.15s ease;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-pack-filter:hover {\n    background: rgba(147, 112, 219, 0.1);\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-pack-filter--active {\n    background: rgba(147, 112, 219, 0.2);\n    color: var(--lumiverse-primary);\n}\n\n/* Filter container with toggle */\n.lumiverse-pack-filters-container {\n    display: flex;\n    gap: 8px;\n    align-items: stretch;\n}\n\n.lumiverse-pack-filters-container .lumiverse-pack-filters {\n    flex: 1;\n}\n\n/* Selected Only Toggle */\n.lumiverse-pack-filter-selected-toggle {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 4px;\n    padding: 4px 8px;\n    background: rgba(30, 30, 46, 0.6);\n    border: 1px solid transparent;\n    border-radius: 8px;\n    cursor: pointer;\n    transition: all 0.15s ease;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-pack-filter-selected-toggle:hover {\n    background: rgba(147, 112, 219, 0.15);\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-pack-filter-selected-toggle--active {\n    background: rgba(147, 112, 219, 0.25);\n    border-color: rgba(147, 112, 219, 0.4);\n    color: var(--lumiverse-primary);\n}\n\n.lumiverse-pack-filter-selected-count {\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    min-width: 16px;\n    height: 16px;\n    padding: 0 4px;\n    background: rgba(147, 112, 219, 0.3);\n    border-radius: 8px;\n    font-size: 10px;\n    font-weight: 600;\n    color: var(--lumiverse-primary);\n}\n\n.lumiverse-pack-filter-selected-toggle--active .lumiverse-pack-filter-selected-count {\n    background: rgba(147, 112, 219, 0.5);\n    color: var(--lumiverse-text);\n}\n\n/* Pack List */\n.lumiverse-browser-packs {\n    flex: 1;\n    overflow-y: auto;\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumiverse-browser-pack {\n    background: rgba(30, 30, 46, 0.6);\n    border-radius: 10px;\n    overflow: hidden;\n    border: 1px solid rgba(147, 112, 219, 0.1);\n}\n\n/* Pack Header */\n.lumiverse-browser-pack-header {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    width: 100%;\n    padding: 10px 12px;\n    background: transparent;\n    border: none;\n    cursor: pointer;\n    transition: background 0.15s ease;\n    text-align: left;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-browser-pack-header:hover {\n    background: rgba(147, 112, 219, 0.08);\n}\n\n.lumiverse-browser-pack-header--expanded {\n    background: rgba(147, 112, 219, 0.1);\n    border-bottom: 1px solid rgba(147, 112, 219, 0.15);\n}\n\n.lumiverse-browser-pack-cover {\n    width: 36px;\n    height: 36px;\n    border-radius: 6px;\n    object-fit: cover;\n    flex-shrink: 0;\n}\n\n.lumiverse-browser-pack-cover-placeholder {\n    width: 36px;\n    height: 36px;\n    border-radius: 6px;\n    background: rgba(147, 112, 219, 0.15);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 18px;\n    flex-shrink: 0;\n}\n\n.lumiverse-browser-pack-info {\n    flex: 1;\n    min-width: 0;\n    display: flex;\n    flex-direction: column;\n}\n\n.lumiverse-browser-pack-name {\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-browser-pack-meta {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n    margin-top: 2px;\n}\n\n.lumiverse-browser-pack-custom-badge {\n    font-size: 9px;\n    font-weight: 600;\n    text-transform: uppercase;\n    color: var(--lumiverse-warning);\n    background: rgba(245, 158, 11, 0.15);\n    padding: 1px 4px;\n    border-radius: 3px;\n}\n\n.lumiverse-browser-pack-chevron {\n    font-size: 10px;\n    color: var(--lumiverse-text-muted);\n    transition: transform 0.2s ease;\n}\n\n.lumiverse-browser-pack-chevron--rotated {\n    transform: rotate(180deg);\n}\n\n/* Pack Items */\n.lumiverse-browser-pack-items {\n    overflow: hidden;\n}\n\n.lumiverse-browser-items-container {\n    padding: 8px 10px;\n}\n\n.lumiverse-browser-items-container::-webkit-scrollbar {\n    width: 6px;\n}\n\n.lumiverse-browser-items-container::-webkit-scrollbar-track {\n    background: transparent;\n}\n\n.lumiverse-browser-items-container::-webkit-scrollbar-thumb {\n    background: rgba(147, 112, 219, 0.3);\n    border-radius: 3px;\n}\n\n/* Item Card */\n.lumiverse-browser-item {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 8px 10px;\n    border-radius: 6px;\n    border: 1px solid transparent;\n    cursor: pointer;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-browser-item:hover {\n    transform: translateX(2px);\n}\n\n.lumiverse-browser-item--selected {\n    box-shadow:\n        0 0 0 1px currentColor,\n        0 2px 8px rgba(0, 0, 0, 0.15);\n}\n\n.lumiverse-browser-item-check {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 18px;\n    height: 18px;\n    border-radius: 50%;\n    background: rgba(100, 200, 100, 0.9);\n    color: white;\n    margin-left: auto;\n    flex-shrink: 0;\n}\n\n.lumiverse-browser-item-image {\n    width: 32px;\n    height: 32px;\n    border-radius: 4px;\n    object-fit: cover;\n    flex-shrink: 0;\n}\n\n.lumiverse-browser-item-content {\n    flex: 1;\n    min-width: 0;\n}\n\n.lumiverse-browser-item-header {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n}\n\n.lumiverse-browser-item-icon {\n    font-size: 12px;\n}\n\n.lumiverse-browser-item-name {\n    font-size: 12px;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-browser-item-desc {\n    margin: 2px 0 0 0;\n    font-size: 10px;\n    color: var(--lumiverse-text-muted);\n    overflow: hidden;\n    text-overflow: ellipsis;\n    display: -webkit-box;\n    -webkit-line-clamp: 1;\n    -webkit-box-orient: vertical;\n}\n\n/* Empty States */\n.lumiverse-browser-empty {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    padding: 40px 20px;\n    text-align: center;\n}\n\n.lumiverse-browser-empty-icon {\n    font-size: 40px;\n    margin-bottom: 12px;\n    opacity: 0.5;\n}\n\n.lumiverse-browser-empty p {\n    margin: 0 0 4px 0;\n    font-size: 14px;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-browser-empty-hint {\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-browser-empty-items {\n    padding: 16px;\n    text-align: center;\n    color: var(--lumiverse-text-dim);\n    font-size: 12px;\n    font-style: italic;\n}\n\n/* ----------------------------------------\n   Preset Manager\n   ---------------------------------------- */\n.lumiverse-preset-manager {\n    padding: 12px;\n    display: flex;\n    flex-direction: column;\n    gap: 16px;\n}\n\n.lumiverse-preset-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    gap: 12px;\n}\n\n.lumiverse-preset-title {\n    margin: 0;\n    font-size: 14px;\n    font-weight: 600;\n    color: var(--lumiverse-text-primary);\n}\n\n.lumiverse-preset-create-btn {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    padding: 6px 12px;\n    background: rgba(147, 112, 219, 0.2);\n    border: 1px solid rgba(147, 112, 219, 0.3);\n    border-radius: 6px;\n    color: rgba(147, 112, 219, 1);\n    font-size: 12px;\n    font-weight: 500;\n    cursor: pointer;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-preset-create-btn:hover {\n    background: rgba(147, 112, 219, 0.3);\n    border-color: rgba(147, 112, 219, 0.5);\n}\n\n.lumiverse-preset-create-form {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    min-width: 0;\n    flex: 1;\n    max-width: 220px;\n}\n\n.lumiverse-preset-input {\n    flex: 1;\n    padding: 6px 10px;\n    background: rgba(30, 30, 46, 0.8);\n    border: 1px solid rgba(147, 112, 219, 0.3);\n    border-radius: 6px;\n    color: var(--lumiverse-text-primary);\n    font-size: 12px;\n    min-width: 0;\n    width: 100%;\n}\n\n/* Responsive: preset form on small screens */\n@media (max-width: 380px) {\n    .lumiverse-preset-header {\n        flex-wrap: wrap;\n        gap: 8px;\n    }\n\n    .lumiverse-preset-create-form {\n        width: 100%;\n        max-width: none;\n        order: 1;\n    }\n\n    .lumiverse-preset-title {\n        flex: 1;\n    }\n}\n\n.lumiverse-preset-input:focus {\n    outline: none;\n    border-color: rgba(147, 112, 219, 0.6);\n}\n\n.lumiverse-preset-input::placeholder {\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-preset-list {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n}\n\n.lumiverse-preset-card {\n    background: rgba(30, 30, 46, 0.6);\n    border: 1px solid rgba(255, 255, 255, 0.08);\n    border-radius: 10px;\n    padding: 12px;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-preset-card:hover {\n    background: rgba(30, 30, 46, 0.8);\n    border-color: rgba(147, 112, 219, 0.2);\n}\n\n.lumiverse-preset-card--active {\n    border-color: rgba(147, 112, 219, 0.4);\n    background: rgba(147, 112, 219, 0.08);\n}\n\n.lumiverse-preset-card-header {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    margin-bottom: 8px;\n}\n\n.lumiverse-preset-card-icon {\n    color: rgba(147, 112, 219, 0.8);\n}\n\n.lumiverse-preset-card-name {\n    flex: 1;\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--lumiverse-text-primary);\n}\n\n.lumiverse-preset-card-active-badge {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    padding: 2px 8px;\n    background: rgba(147, 112, 219, 0.2);\n    border-radius: 10px;\n    font-size: 10px;\n    font-weight: 500;\n    color: rgba(147, 112, 219, 1);\n}\n\n.lumiverse-preset-card-meta {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    margin-bottom: 10px;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-preset-card-traits {\n    color: var(--lumiverse-text-secondary);\n}\n\n/* Preset stats with icons */\n.lumiverse-preset-stats {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n}\n\n.lumiverse-preset-stat {\n    display: flex;\n    align-items: center;\n    gap: 3px;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-preset-stat svg {\n    opacity: 0.7;\n}\n\n.lumiverse-preset-stat--chimera {\n    color: rgba(100, 200, 255, 0.9);\n}\n\n.lumiverse-preset-stat--chimera svg {\n    color: rgba(100, 200, 255, 0.9);\n    opacity: 1;\n}\n\n.lumiverse-preset-stat--council {\n    color: rgba(147, 112, 219, 0.9);\n}\n\n.lumiverse-preset-stat--council svg {\n    color: rgba(147, 112, 219, 0.9);\n    opacity: 1;\n}\n\n.lumiverse-preset-card-mode {\n    padding: 2px 6px;\n    background: rgba(255, 193, 7, 0.15);\n    border-radius: 4px;\n    font-size: 10px;\n    color: rgba(255, 193, 7, 0.9);\n}\n\n.lumiverse-preset-card-time {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    margin-left: auto;\n}\n\n.lumiverse-preset-card-actions {\n    display: flex;\n    gap: 6px;\n}\n\n.lumiverse-preset-btn {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    padding: 6px 10px;\n    background: rgba(255, 255, 255, 0.06);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    border-radius: 6px;\n    color: var(--lumiverse-text-secondary);\n    font-size: 12px;\n    font-weight: 500;\n    cursor: pointer;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-preset-btn:hover {\n    background: rgba(255, 255, 255, 0.1);\n    color: var(--lumiverse-text-primary);\n}\n\n.lumiverse-preset-btn--primary {\n    background: rgba(147, 112, 219, 0.2);\n    border-color: rgba(147, 112, 219, 0.3);\n    color: rgba(147, 112, 219, 1);\n}\n\n.lumiverse-preset-btn--primary:hover {\n    background: rgba(147, 112, 219, 0.3);\n    border-color: rgba(147, 112, 219, 0.5);\n}\n\n.lumiverse-preset-btn--primary:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n}\n\n.lumiverse-preset-btn--danger {\n    color: rgba(255, 100, 100, 0.8);\n}\n\n.lumiverse-preset-btn--danger:hover {\n    background: rgba(255, 100, 100, 0.15);\n    border-color: rgba(255, 100, 100, 0.3);\n    color: rgba(255, 100, 100, 1);\n}\n\n.lumiverse-preset-btn--confirming {\n    background: rgba(255, 100, 100, 0.2);\n    border-color: rgba(255, 100, 100, 0.4);\n    color: rgba(255, 100, 100, 1);\n}\n\n.lumiverse-preset-empty {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    padding: 32px 16px;\n    text-align: center;\n}\n\n.lumiverse-preset-empty-icon {\n    margin-bottom: 12px;\n    color: var(--lumiverse-text-muted);\n    opacity: 0.5;\n}\n\n.lumiverse-preset-empty h4 {\n    margin: 0 0 8px 0;\n    font-size: 14px;\n    font-weight: 600;\n    color: var(--lumiverse-text-primary);\n}\n\n.lumiverse-preset-empty p {\n    margin: 0;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n    max-width: 240px;\n}\n\n.lumiverse-preset-help {\n    padding: 10px;\n    background: rgba(30, 30, 46, 0.4);\n    border-radius: 8px;\n}\n\n.lumiverse-preset-help p {\n    margin: 0;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n    line-height: 1.5;\n}\n\n/* ----------------------------------------\n   OOC Analytics Dashboard\n   ---------------------------------------- */\n.lumiverse-ooc-analytics {\n    padding: 12px;\n    display: flex;\n    flex-direction: column;\n    gap: 16px;\n}\n\n.lumiverse-analytics-section {\n    background: rgba(30, 30, 46, 0.6);\n    border-radius: 10px;\n    padding: 12px;\n}\n\n.lumiverse-analytics-section-title {\n    margin: 0 0 12px 0;\n    font-size: 11px;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    color: var(--lumiverse-text-muted);\n}\n\n/* Stats Grid */\n.lumiverse-analytics-stats-grid {\n    display: grid;\n    grid-template-columns: repeat(2, 1fr);\n    gap: 8px;\n}\n\n.lumiverse-analytics-stat {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 10px 12px;\n    background: rgba(147, 112, 219, 0.08);\n    border-radius: 8px;\n    border: 1px solid rgba(147, 112, 219, 0.15);\n}\n\n.lumiverse-analytics-stat-icon {\n    font-size: 20px;\n    flex-shrink: 0;\n}\n\n.lumiverse-analytics-stat-info {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n}\n\n.lumiverse-analytics-stat-value {\n    font-size: 18px;\n    font-weight: 700;\n    color: var(--lumiverse-primary);\n}\n\n.lumiverse-analytics-stat-label {\n    font-size: 10px;\n    color: var(--lumiverse-text-muted);\n    text-transform: uppercase;\n    letter-spacing: 0.3px;\n}\n\n.lumiverse-analytics-stat-trend {\n    font-size: 14px;\n    padding: 2px 6px;\n    border-radius: 4px;\n    background: rgba(147, 112, 219, 0.15);\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-analytics-stat-trend--up {\n    background: rgba(34, 197, 94, 0.15);\n    color: var(--lumiverse-success);\n}\n\n.lumiverse-analytics-stat-trend--down {\n    background: rgba(239, 68, 68, 0.15);\n    color: var(--lumiverse-danger);\n}\n\n/* Type Distribution */\n.lumiverse-analytics-distribution {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumiverse-analytics-bars {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n}\n\n.lumiverse-analytics-bar-item {\n    display: flex;\n    flex-direction: column;\n    gap: 4px;\n}\n\n.lumiverse-analytics-bar-label {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    font-size: 12px;\n}\n\n.lumiverse-analytics-bar-icon {\n    font-size: 12px;\n}\n\n.lumiverse-analytics-bar-name {\n    flex: 1;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-analytics-bar-count {\n    color: var(--lumiverse-text-muted);\n    font-weight: 600;\n}\n\n.lumiverse-analytics-bar-track {\n    height: 6px;\n    background: rgba(147, 112, 219, 0.1);\n    border-radius: 3px;\n    overflow: hidden;\n}\n\n.lumiverse-analytics-bar-fill {\n    height: 100%;\n    border-radius: 3px;\n    transition: width 0.5s ease-out;\n}\n\n/* Insights */\n.lumiverse-analytics-insights {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumiverse-analytics-insight {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 10px 12px;\n    background: rgba(147, 112, 219, 0.05);\n    border-radius: 8px;\n}\n\n.lumiverse-analytics-insight-icon {\n    font-size: 18px;\n    flex-shrink: 0;\n}\n\n.lumiverse-analytics-insight-content {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n}\n\n.lumiverse-analytics-insight-title {\n    font-size: 10px;\n    color: var(--lumiverse-text-muted);\n    text-transform: uppercase;\n    letter-spacing: 0.3px;\n}\n\n.lumiverse-analytics-insight-value {\n    font-size: 14px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-analytics-insight-desc {\n    font-size: 11px;\n    color: var(--lumiverse-text-dim);\n}\n\n/* Timeline */\n.lumiverse-analytics-timeline {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumiverse-analytics-comment {\n    display: flex;\n    align-items: flex-start;\n    gap: 10px;\n    padding: 8px 10px;\n    background: rgba(147, 112, 219, 0.05);\n    border-radius: 6px;\n    border-left: 2px solid var(--lumiverse-primary);\n}\n\n.lumiverse-analytics-comment-icon {\n    font-size: 14px;\n    flex-shrink: 0;\n    margin-top: 2px;\n}\n\n.lumiverse-analytics-comment-content {\n    flex: 1;\n    min-width: 0;\n}\n\n.lumiverse-analytics-comment-text {\n    margin: 0;\n    font-size: 12px;\n    color: var(--lumiverse-text);\n    line-height: 1.4;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    display: -webkit-box;\n    -webkit-line-clamp: 2;\n    -webkit-box-orient: vertical;\n}\n\n.lumiverse-analytics-comment-time {\n    font-size: 10px;\n    color: var(--lumiverse-text-dim);\n}\n\n/* Quick Controls */\n.lumiverse-analytics-controls {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n/* Empty state */\n.lumiverse-analytics-empty {\n    padding: 20px;\n    text-align: center;\n    color: var(--lumiverse-text-dim);\n    font-size: 12px;\n    font-style: italic;\n}\n\n/* ----------------------------------------\n   Panel Toggle Button\n   ---------------------------------------- */\n.lumiverse-panel-toggle {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    padding: 8px 14px;\n    background: linear-gradient(135deg, rgba(147, 112, 219, 0.95) 0%, rgba(123, 88, 195, 0.95) 100%);\n    border: 1px solid rgba(255, 255, 255, 0.2);\n    border-radius: 20px;\n    cursor: pointer;\n    box-shadow: 0 4px 12px rgba(147, 112, 219, 0.4), 0 0 20px rgba(147, 112, 219, 0.2);\n    white-space: nowrap;\n    transition: box-shadow 0.15s ease, border-color 0.15s ease;\n}\n\n.lumiverse-panel-toggle:hover {\n    box-shadow: 0 4px 16px rgba(147, 112, 219, 0.6), 0 0 35px rgba(147, 112, 219, 0.4);\n    border-color: rgba(255, 255, 255, 0.35);\n}\n\n.lumiverse-panel-toggle--active {\n    background: linear-gradient(135deg, rgba(100, 80, 180, 0.95) 0%, rgba(80, 60, 160, 0.95) 100%);\n    /* Position is now controlled by transform (x) for sync with panel animation */\n}\n\n.lumiverse-panel-toggle-icon {\n    font-size: 16px;\n    line-height: 1;\n}\n\n.lumiverse-panel-toggle-label {\n    font-size: 12px;\n    font-weight: 600;\n    color: white;\n    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);\n}\n\n/* ----------------------------------------\n   Viewport Panel - Settings Panels\n   ---------------------------------------- */\n\n/* General settings panel styles */\n.lumiverse-vp-settings-panel {\n    padding: 16px;\n    display: flex;\n    flex-direction: column;\n    gap: 16px;\n}\n\n.lumiverse-vp-settings-section {\n    background: rgba(147, 112, 219, 0.05);\n    border: 1px solid rgba(147, 112, 219, 0.15);\n    border-radius: 10px;\n    padding: 14px;\n}\n\n.lumiverse-vp-settings-section-header {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    margin-bottom: 10px;\n    color: var(--lumiverse-text);\n    font-weight: 600;\n    font-size: 13px;\n}\n\n.lumiverse-vp-settings-desc {\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n    margin: 0 0 12px 0;\n    line-height: 1.4;\n}\n\n/* Toggle row */\n.lumiverse-vp-toggle-row {\n    display: flex;\n    align-items: flex-start;\n    justify-content: space-between;\n    padding: 8px 0;\n    gap: 12px;\n}\n\n.lumiverse-vp-toggle-label {\n    flex: 1;\n    cursor: pointer;\n}\n\n.lumiverse-vp-toggle-text {\n    display: block;\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-vp-toggle-hint {\n    display: block;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n    margin-top: 2px;\n}\n\n.lumiverse-vp-toggle-switch-wrapper {\n    flex-shrink: 0;\n}\n\n.lumiverse-vp-toggle-input {\n    display: none !important;\n    position: absolute !important;\n    opacity: 0 !important;\n    width: 0 !important;\n    height: 0 !important;\n    pointer-events: none !important;\n}\n\n.lumiverse-vp-toggle-track {\n    position: relative;\n    width: 40px;\n    height: 22px;\n    background: var(--lumiverse-secondary);\n    border-radius: 11px;\n    cursor: pointer;\n    transition: background 0.2s ease;\n}\n\n.lumiverse-vp-toggle-track--on {\n    background: var(--lumiverse-primary);\n}\n\n.lumiverse-vp-toggle-thumb {\n    position: absolute;\n    top: 2px;\n    left: 2px;\n    width: 18px;\n    height: 18px;\n    background: white;\n    border-radius: 50%;\n    transition: transform 0.2s ease;\n}\n\n.lumiverse-vp-toggle-track--on .lumiverse-vp-toggle-thumb {\n    transform: translateX(18px);\n}\n\n/* Disabled toggle states */\n.lumiverse-vp-toggle-row--disabled {\n    opacity: 0.5;\n    pointer-events: none;\n}\n\n.lumiverse-vp-toggle-row--disabled .lumiverse-vp-toggle-label {\n    cursor: not-allowed;\n}\n\n.lumiverse-vp-toggle-track--disabled {\n    background: var(--lumiverse-bg-dark) !important;\n    cursor: not-allowed;\n}\n\n.lumiverse-vp-toggle-track--disabled .lumiverse-vp-toggle-thumb {\n    background: rgba(255, 255, 255, 0.5);\n}\n\n/* Field input */\n.lumiverse-vp-field {\n    margin-bottom: 12px;\n}\n\n.lumiverse-vp-field--inline {\n    display: flex;\n    flex-wrap: wrap;\n    align-items: center;\n    gap: 8px;\n}\n\n.lumiverse-vp-field-label {\n    display: block;\n    font-size: 12px;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n    margin-bottom: 6px;\n}\n\n.lumiverse-vp-field--inline .lumiverse-vp-field-label {\n    margin-bottom: 0;\n    flex: 1;\n}\n\n.lumiverse-vp-field-input {\n    width: 100%;\n    padding: 8px 12px;\n    background: var(--lumiverse-bg);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 6px;\n    color: var(--lumiverse-text);\n    font-size: 13px;\n    transition: border-color 0.2s ease;\n}\n\n.lumiverse-vp-field-input:focus {\n    outline: none;\n    border-color: var(--lumiverse-primary);\n}\n\n.lumiverse-vp-field-input--small {\n    width: 70px;\n    text-align: center;\n}\n\n.lumiverse-vp-field-hint {\n    display: block;\n    font-size: 11px;\n    color: var(--lumiverse-text-dim);\n    margin-top: 4px;\n}\n\n.lumiverse-vp-field--inline .lumiverse-vp-field-hint {\n    flex-basis: 100%;\n}\n\n/* Style options (radio buttons) */\n.lumiverse-vp-style-options {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumiverse-vp-style-option {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 12px 14px;\n    background: var(--lumiverse-bg);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 8px;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-vp-style-option:hover {\n    border-color: var(--lumiverse-border-light);\n    background: var(--lumiverse-bg-hover);\n}\n\n.lumiverse-vp-style-option--selected {\n    border-color: var(--lumiverse-primary);\n    background: rgba(147, 112, 219, 0.1);\n}\n\n.lumiverse-vp-style-option input[type="radio"] {\n    display: none !important;\n    position: absolute !important;\n    opacity: 0 !important;\n    width: 0 !important;\n    height: 0 !important;\n    pointer-events: none !important;\n}\n\n.lumiverse-vp-style-option-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 32px;\n    height: 32px;\n    background: rgba(147, 112, 219, 0.15);\n    border-radius: 6px;\n    color: var(--lumiverse-primary);\n}\n\n.lumiverse-vp-style-option-text {\n    flex: 1;\n}\n\n.lumiverse-vp-style-option-title {\n    display: block;\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-vp-style-option-desc {\n    display: block;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n    margin-top: 2px;\n    line-height: 1.3;\n}\n\n/* Save button */\n.lumiverse-vp-save-btn {\n    width: 100%;\n    padding: 10px 16px;\n    background: var(--lumiverse-primary);\n    border: none;\n    border-radius: 8px;\n    color: white;\n    font-size: 13px;\n    font-weight: 600;\n    cursor: pointer;\n    transition: background 0.2s ease;\n}\n\n.lumiverse-vp-save-btn:hover {\n    background: var(--lumiverse-primary-hover);\n}\n\n/* Collapsible sections */\n.lumiverse-vp-collapsible {\n    background: rgba(147, 112, 219, 0.05);\n    border: 1px solid rgba(147, 112, 219, 0.15);\n    border-radius: 10px;\n    overflow: hidden;\n}\n\n.lumiverse-vp-collapsible-header {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    width: 100%;\n    padding: 12px 14px;\n    background: transparent;\n    border: none;\n    cursor: pointer;\n    color: var(--lumiverse-text);\n    font-size: 13px;\n    font-weight: 600;\n    text-align: left;\n    transition: background 0.2s ease;\n}\n\n.lumiverse-vp-collapsible-header:hover {\n    background: rgba(147, 112, 219, 0.08);\n}\n\n.lumiverse-vp-collapsible-chevron {\n    display: flex;\n    color: var(--lumiverse-text-muted);\n    transition: transform 0.2s ease;\n}\n\n.lumiverse-vp-collapsible-chevron--open {\n    transform: rotate(180deg);\n}\n\n.lumiverse-vp-collapsible-icon {\n    display: flex;\n    color: var(--lumiverse-primary);\n}\n\n.lumiverse-vp-collapsible-title {\n    flex: 1;\n}\n\n.lumiverse-vp-collapsible-status {\n    padding: 2px 8px;\n    background: rgba(100, 100, 100, 0.2);\n    border-radius: 10px;\n    font-size: 10px;\n    font-weight: 600;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-vp-collapsible-status--active {\n    background: rgba(34, 197, 94, 0.2);\n    color: var(--lumiverse-success);\n}\n\n.lumiverse-vp-collapsible-content {\n    overflow: hidden;\n}\n\n.lumiverse-vp-collapsible-inner {\n    padding: 12px 14px 14px 14px;\n}\n\n/* Info box */\n.lumiverse-vp-info-box {\n    background: rgba(147, 112, 219, 0.08);\n    border: 1px solid rgba(147, 112, 219, 0.2);\n    border-radius: 8px;\n    padding: 12px;\n    margin-top: 12px;\n}\n\n.lumiverse-vp-info-box--muted {\n    opacity: 0.5;\n}\n\n.lumiverse-vp-info-box-header {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    font-size: 11px;\n    font-weight: 600;\n    color: var(--lumiverse-primary);\n    margin-bottom: 8px;\n}\n\n.lumiverse-vp-info-box-list {\n    margin: 0;\n    padding: 0 0 0 16px;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n    line-height: 1.5;\n}\n\n.lumiverse-vp-info-box-list code {\n    background: rgba(147, 112, 219, 0.15);\n    padding: 1px 4px;\n    border-radius: 3px;\n    font-size: 10px;\n}\n\n/* Filter items */\n.lumiverse-vp-filter-item {\n    padding: 8px 0;\n    border-bottom: 1px solid rgba(147, 112, 219, 0.1);\n}\n\n.lumiverse-vp-filter-item:last-child {\n    border-bottom: none;\n}\n\n.lumiverse-vp-filter-options {\n    padding: 8px 0 0 24px;\n    overflow: hidden;\n}\n\n.lumiverse-vp-filter-sub {\n    padding-left: 16px;\n    border-left: 2px solid rgba(147, 112, 219, 0.2);\n    margin-left: 8px;\n}\n\n/* ----------------------------------------\n   Viewport Panel - Summary Editor\n   ---------------------------------------- */\n.lumiverse-vp-summary-editor {\n    display: flex;\n    flex-direction: column;\n    height: 100%;\n    padding: 12px;\n    gap: 12px;\n}\n\n.lumiverse-vp-summary-status {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    padding: 10px 12px;\n    border-radius: 8px;\n    font-size: 12px;\n    font-weight: 500;\n}\n\n.lumiverse-vp-summary-status--exists {\n    background: rgba(34, 197, 94, 0.1);\n    border: 1px solid rgba(34, 197, 94, 0.3);\n    color: var(--lumiverse-success);\n}\n\n.lumiverse-vp-summary-status--empty {\n    background: rgba(245, 158, 11, 0.1);\n    border: 1px solid rgba(245, 158, 11, 0.3);\n    color: var(--lumiverse-warning);\n}\n\n.lumiverse-vp-summary-status--no-chat {\n    background: rgba(100, 100, 100, 0.1);\n    border: 1px solid rgba(100, 100, 100, 0.3);\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-vp-summary-textarea-wrapper {\n    flex: 1;\n    min-height: 200px;\n    margin-bottom: 4px;\n    overflow: hidden;\n}\n\n.lumiverse-vp-summary-textarea {\n    width: 100%;\n    height: 100%;\n    min-height: 200px;\n    padding: 12px;\n    background: var(--lumiverse-bg);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 8px;\n    color: var(--lumiverse-text);\n    font-size: 12px;\n    font-family: inherit;\n    line-height: 1.5;\n    resize: none;\n    transition: border-color 0.2s ease;\n}\n\n.lumiverse-vp-summary-textarea:focus {\n    outline: none;\n    border-color: var(--lumiverse-primary);\n}\n\n.lumiverse-vp-summary-textarea::placeholder {\n    color: var(--lumiverse-text-dim);\n}\n\n.lumiverse-vp-summary-textarea:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n}\n\n.lumiverse-vp-summary-actions {\n    display: flex;\n    gap: 10px;\n    justify-content: center;\n    margin-top: 12px;\n    padding-top: 4px;\n}\n\n.lumiverse-vp-action-btn {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 6px;\n    padding: 8px 12px;\n    min-height: 36px;\n    border: none;\n    border-radius: 6px;\n    font-size: 12px;\n    font-weight: 500;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n/* Icon-only button mode */\n.lumiverse-vp-action-btn--icon-only {\n    padding: 10px 12px;\n    min-width: 44px;\n    width: 44px;\n    height: 40px;\n    flex: 1;\n    max-width: 56px;\n}\n\n.lumiverse-vp-action-btn--secondary {\n    background: var(--lumiverse-bg-elevated);\n    color: var(--lumiverse-text);\n    border: 1px solid var(--lumiverse-border);\n}\n\n.lumiverse-vp-action-btn--secondary:hover {\n    background: var(--lumiverse-bg-hover);\n}\n\n.lumiverse-vp-action-btn--primary {\n    background: var(--lumiverse-primary);\n    color: white;\n}\n\n.lumiverse-vp-action-btn--primary:hover {\n    background: var(--lumiverse-primary-hover);\n}\n\n.lumiverse-vp-action-btn--danger {\n    background: transparent;\n    color: var(--lumiverse-danger);\n    border: 1px solid var(--lumiverse-danger);\n}\n\n.lumiverse-vp-action-btn--danger:hover {\n    background: rgba(239, 68, 68, 0.1);\n}\n\n.lumiverse-vp-action-btn--disabled {\n    opacity: 0.4;\n    cursor: not-allowed;\n}\n\n.lumiverse-vp-summary-unsaved {\n    text-align: center;\n    font-size: 11px;\n    color: var(--lumiverse-warning);\n    padding: 4px;\n}\n\n/* Action button spinner */\n.lumiverse-vp-action-btn-spinner {\n    width: 14px;\n    height: 14px;\n    border: 2px solid rgba(255, 255, 255, 0.3);\n    border-top-color: white;\n    border-radius: 50%;\n    animation: lumiverse-spin 0.8s linear infinite;\n}\n\n.lumiverse-vp-action-btn--icon-only .lumiverse-vp-action-btn-spinner {\n    width: 16px;\n    height: 16px;\n}\n\n@keyframes lumiverse-spin {\n    to { transform: rotate(360deg); }\n}\n\n/* Summary config section */\n.lumiverse-vp-summary-config {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n}\n\n/* Radio group */\n.lumiverse-vp-radio-group {\n    display: flex;\n    gap: 8px;\n    flex-wrap: wrap;\n}\n\n.lumiverse-vp-radio-group--wide .lumiverse-vp-radio-option {\n    flex: 1;\n    min-width: 100px;\n}\n\n.lumiverse-vp-radio-option {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    padding: 8px 14px;\n    background: var(--lumiverse-bg);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 6px;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-vp-radio-option:hover {\n    border-color: var(--lumiverse-border-hover);\n    background: var(--lumiverse-bg-hover);\n}\n\n.lumiverse-vp-radio-option--selected {\n    border-color: var(--lumiverse-primary);\n    background: rgba(147, 112, 219, 0.15);\n}\n\n.lumiverse-vp-radio-option input[type="radio"] {\n    display: none !important;\n    position: absolute !important;\n    opacity: 0 !important;\n    width: 0 !important;\n    height: 0 !important;\n    pointer-events: none !important;\n}\n\n.lumiverse-vp-radio-option-label {\n    font-size: 12px;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n}\n\n/* Field rows */\n.lumiverse-vp-field-row {\n    display: flex;\n    gap: 12px;\n}\n\n.lumiverse-vp-field-row .lumiverse-vp-field {\n    flex: 1;\n}\n\n.lumiverse-vp-field-row--3 .lumiverse-vp-field {\n    flex: 1;\n    min-width: 0;\n}\n\n/* Select field */\n.lumiverse-vp-field-select {\n    width: 100%;\n    padding: 8px 12px;\n    background: var(--lumiverse-bg);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 6px;\n    color: var(--lumiverse-text);\n    font-size: 12px;\n    cursor: pointer;\n    transition: border-color 0.2s ease;\n    appearance: none;\n    background-image: url(${d});\n    background-repeat: no-repeat;\n    background-position: right 10px center;\n    padding-right: 30px;\n}\n\n.lumiverse-vp-field-select:focus {\n    outline: none;\n    border-color: var(--lumiverse-primary);\n}\n\n.lumiverse-vp-field-select option {\n    background: var(--lumiverse-bg);\n    color: var(--lumiverse-text);\n}\n\n/* Warning box */\n.lumiverse-vp-warning-box {\n    display: flex;\n    align-items: flex-start;\n    gap: 8px;\n    padding: 10px 12px;\n    margin-top: 10px;\n    background: rgba(245, 158, 11, 0.1);\n    border: 1px solid rgba(245, 158, 11, 0.3);\n    border-radius: 6px;\n    font-size: 11px;\n    color: var(--lumiverse-warning);\n    line-height: 1.4;\n}\n\n.lumiverse-vp-warning-box svg {\n    flex-shrink: 0;\n    margin-top: 1px;\n}\n\n/* Settings description */\n.lumiverse-vp-settings-desc {\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n    margin: 8px 0 0 0;\n    line-height: 1.4;\n}\n\n/* ============================================\n   LUMIA MODAL SYSTEM\n   Card-based selection modal design\n   ============================================ */\n\n/* Modal Backdrop */\n.lumia-modal-backdrop {\n    position: fixed;\n    inset: 0;\n    background: rgba(0, 0, 0, 0.5);\n    z-index: 9998;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    animation: lumia-backdrop-fadein 0.15s ease-out;\n}\n\n@keyframes lumia-backdrop-fadein {\n    from { opacity: 0; }\n    to { opacity: 1; }\n}\n\n/* Modal Container */\n.lumia-modal {\n    font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", sans-serif;\n    background: linear-gradient(\n        165deg,\n        rgba(22, 18, 32, 0.98) 0%,\n        rgba(28, 24, 40, 0.98) 100%\n    );\n    border: 1px solid rgba(147, 112, 219, 0.2);\n    border-radius: 16px;\n    box-shadow:\n        0 24px 80px rgba(0, 0, 0, 0.5),\n        0 0 1px rgba(147, 112, 219, 0.3);\n    padding: 0;\n    overflow: hidden;\n    display: flex;\n    flex-direction: column;\n    max-height: 85vh;\n    max-height: 85dvh;\n    height: auto;\n    width: 90vw;\n    max-width: 600px;\n    z-index: 9999;\n}\n\n/* Selection Modal Variant (wider for cards) */\n.lumia-modal-selection {\n    max-width: 700px;\n}\n\n/* Settings Modal Variant */\n.lumia-modal-settings {\n    max-width: 520px;\n}\n\n/* Modal Selection Content Wrapper */\n.lumia-modal-selection-content {\n    display: flex;\n    flex-direction: column;\n    height: 100%;\n    max-height: 85vh;\n}\n\n/* Modal Header - Inner (for modals with custom headers) */\n.lumia-modal-header-inner {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n    padding: 18px 20px;\n    background: linear-gradient(\n        180deg,\n        rgba(147, 112, 219, 0.1) 0%,\n        transparent 100%\n    );\n    border-bottom: 1px solid rgba(147, 112, 219, 0.12);\n    flex-shrink: 0;\n}\n\n.lumia-modal-header-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 36px;\n    height: 36px;\n    background: linear-gradient(\n        135deg,\n        rgba(147, 112, 219, 0.2) 0%,\n        rgba(147, 112, 219, 0.1) 100%\n    );\n    border-radius: 10px;\n    border: 1px solid rgba(147, 112, 219, 0.2);\n}\n\n.lumia-modal-header-icon svg {\n    width: 20px;\n    height: 20px;\n    stroke: rgba(186, 135, 255, 0.9);\n}\n\n.lumia-modal-header-text {\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n    flex: 1;\n    min-width: 0;\n}\n\n.lumia-modal-title {\n    font-size: 17px;\n    font-weight: 600;\n    color: rgba(255, 255, 255, 0.95);\n    letter-spacing: -0.2px;\n    margin: 0;\n    padding: 0;\n}\n\n.lumia-modal-subtitle {\n    font-size: 12px;\n    font-weight: 400;\n    color: rgba(255, 255, 255, 0.5);\n    margin: 0;\n    letter-spacing: 0.1px;\n}\n\n/* Clear Button */\n.lumia-clear-btn {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    padding: 8px 14px;\n    background: rgba(128, 128, 128, 0.1);\n    border: 1px solid rgba(128, 128, 128, 0.25);\n    border-radius: 8px;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    font-family: inherit;\n    font-size: 12px;\n    font-weight: 500;\n    color: rgba(255, 255, 255, 0.7);\n    flex-shrink: 0;\n    margin-left: auto;\n}\n\n.lumia-clear-btn svg {\n    width: 16px;\n    height: 16px;\n    stroke: rgba(255, 255, 255, 0.6);\n}\n\n.lumia-clear-btn:hover {\n    background: rgba(244, 67, 54, 0.15);\n    border-color: rgba(244, 67, 54, 0.4);\n    color: rgba(244, 67, 54, 0.95);\n}\n\n.lumia-clear-btn:hover svg {\n    stroke: rgba(244, 67, 54, 0.95);\n}\n\n/* Modal Content Area */\n.lumia-modal-content {\n    padding: 20px;\n    display: block;\n    flex: 1 1 auto;\n    overflow-y: auto;\n    overflow-x: hidden;\n    min-height: 0;\n}\n\n.lumia-modal-content > * + * {\n    margin-top: 16px;\n}\n\n/* Custom scrollbar for modal content */\n.lumia-modal-content::-webkit-scrollbar {\n    width: 8px;\n}\n\n.lumia-modal-content::-webkit-scrollbar-track {\n    background: rgba(0, 0, 0, 0.2);\n    border-radius: 4px;\n}\n\n.lumia-modal-content::-webkit-scrollbar-thumb {\n    background: rgba(147, 112, 219, 0.3);\n    border-radius: 4px;\n}\n\n.lumia-modal-content::-webkit-scrollbar-thumb:hover {\n    background: rgba(147, 112, 219, 0.5);\n}\n\n/* Modal Panel */\n.lumia-modal-panel {\n    background: rgba(0, 0, 0, 0.2);\n    border: 1px solid rgba(128, 128, 128, 0.12);\n    border-radius: 12px;\n    overflow: visible;\n}\n\n.lumia-modal-panel-header {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 12px 14px;\n    background: rgba(255, 255, 255, 0.02);\n    border-bottom: 1px solid rgba(128, 128, 128, 0.08);\n}\n\n.lumia-modal-panel-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 18px;\n    height: 18px;\n}\n\n.lumia-modal-panel-icon svg {\n    width: 16px;\n    height: 16px;\n    stroke: rgba(147, 112, 219, 0.7);\n}\n\n.lumia-modal-panel-title {\n    font-size: 12px;\n    font-weight: 600;\n    color: rgba(255, 255, 255, 0.8);\n    letter-spacing: 0.1px;\n}\n\n.lumia-modal-panel-count {\n    font-size: 11px;\n    font-weight: 500;\n    color: rgba(147, 112, 219, 0.7);\n    background: rgba(147, 112, 219, 0.1);\n    padding: 4px 8px;\n    border-radius: 10px;\n    flex-shrink: 0;\n}\n\n.lumia-modal-panel-content {\n    padding: 16px;\n    display: flex;\n    flex-direction: column;\n    gap: 14px;\n}\n\n.lumia-modal-panel-content-cards {\n    padding: 12px;\n}\n\n/* Modal Empty State */\n.lumia-modal-empty {\n    padding: 40px 20px;\n    text-align: center;\n    color: rgba(255, 255, 255, 0.4);\n    font-size: 14px;\n}\n\n/* Modal Footer */\n.lumia-modal-footer {\n    display: flex;\n    justify-content: flex-end;\n    gap: 10px;\n    padding: 16px 20px;\n    background: rgba(0, 0, 0, 0.15);\n    border-top: 1px solid rgba(128, 128, 128, 0.1);\n    flex-shrink: 0;\n    margin-top: auto;\n}\n\n/* Modal Buttons */\n.lumia-modal-btn {\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    gap: 8px;\n    padding: 10px 20px;\n    border: none;\n    border-radius: 8px;\n    font-size: 13px;\n    font-weight: 500;\n    font-family: inherit;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumia-modal-btn svg {\n    width: 16px;\n    height: 16px;\n}\n\n.lumia-modal-btn-primary {\n    background: linear-gradient(\n        135deg,\n        rgba(147, 112, 219, 0.9) 0%,\n        rgba(123, 95, 196, 0.9) 100%\n    );\n    color: white;\n}\n\n.lumia-modal-btn-primary:hover {\n    background: linear-gradient(\n        135deg,\n        rgba(167, 132, 239, 0.95) 0%,\n        rgba(143, 115, 216, 0.95) 100%\n    );\n    transform: translateY(-1px);\n}\n\n.lumia-modal-btn-secondary {\n    background: rgba(128, 128, 128, 0.15);\n    border: 1px solid rgba(128, 128, 128, 0.2);\n    color: rgba(255, 255, 255, 0.75);\n}\n\n.lumia-modal-btn-secondary:hover {\n    background: rgba(128, 128, 128, 0.25);\n    color: rgba(255, 255, 255, 0.9);\n}\n\n/* Collapsible Panel Styles */\n.lumia-collapsible-trigger {\n    cursor: pointer;\n    user-select: none;\n}\n\n.lumia-panel-collapse-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 16px;\n    height: 16px;\n    flex-shrink: 0;\n    transition: transform 0.2s ease;\n}\n\n.lumia-panel-collapse-icon svg {\n    width: 14px;\n    height: 14px;\n    stroke: rgba(255, 255, 255, 0.4);\n}\n\n.lumia-collapsible.collapsed .lumia-panel-collapse-icon {\n    transform: rotate(-90deg);\n}\n\n.lumia-collapsible-content {\n    display: grid;\n    grid-template-rows: 1fr;\n    transition:\n        grid-template-rows 0.25s ease,\n        opacity 0.2s ease,\n        padding 0.25s ease;\n    opacity: 1;\n}\n\n.lumia-collapsible-content > * {\n    overflow: hidden;\n}\n\n.lumia-collapsible.collapsed .lumia-collapsible-content {\n    grid-template-rows: 0fr;\n    opacity: 0;\n    padding-top: 0;\n    padding-bottom: 0;\n}\n\n/* Custom Pack Badge */\n.lumia-pack-badge-custom {\n    font-size: 10px;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    color: rgba(147, 112, 219, 0.9);\n    background: rgba(147, 112, 219, 0.15);\n    padding: 3px 8px;\n    border-radius: 6px;\n    border: 1px solid rgba(147, 112, 219, 0.25);\n}\n\n/* Icon Button Small */\n.lumia-icon-btn-sm {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 28px;\n    height: 28px;\n    padding: 0;\n    background: transparent;\n    border: 1px solid transparent;\n    border-radius: 6px;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    margin-left: auto;\n}\n\n.lumia-icon-btn-sm svg {\n    width: 16px;\n    height: 16px;\n    stroke: rgba(255, 255, 255, 0.4);\n}\n\n.lumia-icon-btn-sm:hover {\n    background: rgba(244, 67, 54, 0.15);\n    border-color: rgba(244, 67, 54, 0.3);\n}\n\n.lumia-icon-btn-sm:hover svg {\n    stroke: rgba(244, 67, 54, 0.9);\n}\n\n/* ============================================\n   LUMIA CARD GRID & CARDS\n   ============================================ */\n\n.lumia-card-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));\n    gap: 16px;\n    padding: 4px;\n}\n\n.lumia-card {\n    position: relative;\n    display: flex;\n    flex-direction: column;\n    background: linear-gradient(\n        165deg,\n        rgba(28, 24, 38, 0.95) 0%,\n        rgba(38, 32, 52, 0.9) 50%,\n        rgba(32, 28, 45, 0.95) 100%\n    );\n    border: 1px solid rgba(128, 128, 128, 0.15);\n    border-radius: 16px;\n    overflow: hidden;\n    cursor: pointer;\n    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);\n}\n\n.lumia-card:hover {\n    transform: translateY(-4px);\n    border-color: rgba(147, 112, 219, 0.3);\n    box-shadow:\n        0 8px 24px rgba(0, 0, 0, 0.25),\n        0 0 0 1px rgba(147, 112, 219, 0.15);\n}\n\n.lumia-card.selected {\n    border-color: rgba(100, 149, 237, 0.6);\n    box-shadow:\n        0 4px 16px rgba(100, 149, 237, 0.2),\n        0 0 0 1px rgba(100, 149, 237, 0.3),\n        inset 0 0 20px rgba(100, 149, 237, 0.05);\n}\n\n.lumia-card.selected::after {\n    content: "";\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    height: 2px;\n    background: linear-gradient(\n        90deg,\n        transparent 0%,\n        rgba(100, 149, 237, 0.5) 20%,\n        rgba(100, 149, 237, 0.8) 50%,\n        rgba(100, 149, 237, 0.5) 80%,\n        transparent 100%\n    );\n}\n\n/* Card Image Container */\n.lumia-card-image {\n    position: relative;\n    width: 100%;\n    aspect-ratio: 1 / 1;\n    background: linear-gradient(\n        135deg,\n        rgba(20, 16, 28, 0.8) 0%,\n        rgba(40, 32, 55, 0.6) 100%\n    );\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    overflow: hidden;\n}\n\n.lumia-card-image img {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n    transition: transform 0.3s ease, opacity 0.3s ease;\n    opacity: 0;\n}\n\n.lumia-card-image img.lumia-img-loaded {\n    opacity: 1;\n}\n\n.lumia-card:hover .lumia-card-image img {\n    transform: scale(1.05);\n}\n\n.lumia-card-placeholder {\n    font-size: 48px;\n    font-weight: 300;\n    color: rgba(147, 112, 219, 0.4);\n    font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", sans-serif;\n    user-select: none;\n}\n\n/* Image Loading Spinner */\n.lumia-img-spinner {\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    width: 24px;\n    height: 24px;\n    border: 2px solid rgba(147, 112, 219, 0.2);\n    border-top-color: rgba(147, 112, 219, 0.7);\n    border-radius: 50%;\n    animation: lumia-spin 0.8s linear infinite;\n}\n\n@keyframes lumia-spin {\n    to { transform: translate(-50%, -50%) rotate(360deg); }\n}\n\n.lumia-card-image:has(.lumia-img-loaded) .lumia-img-spinner {\n    display: none;\n}\n\n/* Dominant Star Icon */\n.lumia-dominant-icon {\n    position: absolute;\n    top: 10px;\n    right: 10px;\n    width: 32px;\n    height: 32px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    background: rgba(0, 0, 0, 0.5);\n    backdrop-filter: blur(8px);\n    -webkit-backdrop-filter: blur(8px);\n    border-radius: 50%;\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    cursor: pointer;\n    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);\n    z-index: 10;\n    opacity: 0;\n}\n\n.lumia-card:hover .lumia-dominant-icon,\n.lumia-card.selected .lumia-dominant-icon {\n    opacity: 1;\n}\n\n.lumia-dominant-icon:hover {\n    background: rgba(0, 0, 0, 0.7);\n    border-color: rgba(255, 193, 7, 0.4);\n    transform: scale(1.1);\n}\n\n.lumia-dominant-icon.dominant {\n    opacity: 1;\n    background: linear-gradient(\n        135deg,\n        rgba(255, 193, 7, 0.9) 0%,\n        rgba(255, 152, 0, 0.9) 100%\n    );\n    border-color: rgba(255, 193, 7, 0.6);\n    box-shadow: 0 2px 12px rgba(255, 193, 7, 0.4);\n}\n\n.lumia-dominant-icon svg {\n    width: 18px;\n    height: 18px;\n    fill: none;\n    stroke: rgba(255, 255, 255, 0.7);\n    stroke-width: 2;\n    stroke-linecap: round;\n    stroke-linejoin: round;\n    transition: all 0.25s ease;\n}\n\n.lumia-dominant-icon:hover svg {\n    stroke: rgba(255, 193, 7, 0.9);\n}\n\n.lumia-dominant-icon.dominant svg {\n    fill: rgba(255, 255, 255, 0.95);\n    stroke: rgba(255, 255, 255, 0.95);\n}\n\n/* Edit Icon for custom pack items */\n.lumia-edit-icon {\n    position: absolute;\n    bottom: 10px;\n    right: 10px;\n    width: 28px;\n    height: 28px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    background: rgba(147, 112, 219, 0.85);\n    backdrop-filter: blur(8px);\n    -webkit-backdrop-filter: blur(8px);\n    border-radius: 50%;\n    border: 1px solid rgba(147, 112, 219, 0.4);\n    cursor: pointer;\n    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);\n    z-index: 10;\n    opacity: 0;\n}\n\n.lumia-card:hover .lumia-edit-icon {\n    opacity: 1;\n}\n\n.lumia-edit-icon:hover {\n    background: rgba(147, 112, 219, 1);\n    border-color: rgba(186, 135, 255, 0.6);\n    transform: scale(1.1);\n    box-shadow: 0 2px 12px rgba(147, 112, 219, 0.4);\n}\n\n.lumia-edit-icon svg {\n    width: 14px;\n    height: 14px;\n    fill: none;\n    stroke: rgba(255, 255, 255, 0.95);\n    stroke-width: 2;\n    stroke-linecap: round;\n    stroke-linejoin: round;\n}\n\n/* Enable All Icon - sparkles button for quick-enabling all traits */\n.lumia-enable-all-icon {\n    position: absolute;\n    bottom: 10px;\n    left: 10px;\n    width: 28px;\n    height: 28px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    background: rgba(255, 193, 7, 0.85);\n    backdrop-filter: blur(8px);\n    -webkit-backdrop-filter: blur(8px);\n    border-radius: 50%;\n    border: 1px solid rgba(255, 193, 7, 0.4);\n    cursor: pointer;\n    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);\n    z-index: 10;\n    opacity: 0;\n}\n\n.lumia-card:hover .lumia-enable-all-icon {\n    opacity: 1;\n}\n\n.lumia-enable-all-icon:hover {\n    background: rgba(255, 193, 7, 1);\n    border-color: rgba(255, 215, 0, 0.8);\n    transform: scale(1.1);\n    box-shadow: 0 2px 12px rgba(255, 193, 7, 0.5);\n}\n\n.lumia-enable-all-icon svg {\n    width: 14px;\n    height: 14px;\n    fill: none;\n    stroke: rgba(0, 0, 0, 0.85);\n    stroke-width: 2;\n    stroke-linecap: round;\n    stroke-linejoin: round;\n}\n\n/* Selection Checkmark Overlay */\n.lumia-card-check {\n    position: absolute;\n    top: 10px;\n    left: 10px;\n    width: 28px;\n    height: 28px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    background: rgba(100, 149, 237, 0.9);\n    border-radius: 50%;\n    opacity: 0;\n    transform: scale(0.5);\n    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);\n    z-index: 10;\n}\n\n.lumia-card.selected .lumia-card-check {\n    opacity: 1;\n    transform: scale(1);\n}\n\n.lumia-card-check svg {\n    width: 16px;\n    height: 16px;\n    fill: none;\n    stroke: white;\n    stroke-width: 2.5;\n    stroke-linecap: round;\n    stroke-linejoin: round;\n}\n\n/* Card Info Section */\n.lumia-card-info {\n    padding: 14px 16px 16px;\n    display: flex;\n    flex-direction: column;\n    gap: 4px;\n    background: linear-gradient(\n        180deg,\n        rgba(28, 24, 38, 0) 0%,\n        rgba(28, 24, 38, 0.95) 20%\n    );\n}\n\n.lumia-card-name {\n    font-size: 15px;\n    font-weight: 600;\n    color: rgba(255, 255, 255, 0.95);\n    font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", sans-serif;\n    letter-spacing: -0.2px;\n    line-height: 1.3;\n    word-break: break-word;\n}\n\n/* Definition Card Variant (no dominant icon) */\n.lumia-card.definition-card .lumia-dominant-icon {\n    display: none;\n}\n\n/* Card Appear Animation */\n.lumia-card.lumia-card-appear {\n    animation: lumia-card-appear 0.3s ease-out forwards;\n    opacity: 0;\n}\n\n@keyframes lumia-card-appear {\n    from {\n        opacity: 0;\n        transform: translateY(10px);\n    }\n    to {\n        opacity: 1;\n        transform: translateY(0);\n    }\n}\n\n/* Staggered animation delays */\n.lumia-card.lumia-card-appear:nth-child(1) { animation-delay: 0ms; }\n.lumia-card.lumia-card-appear:nth-child(2) { animation-delay: 30ms; }\n.lumia-card.lumia-card-appear:nth-child(3) { animation-delay: 60ms; }\n.lumia-card.lumia-card-appear:nth-child(4) { animation-delay: 90ms; }\n.lumia-card.lumia-card-appear:nth-child(5) { animation-delay: 120ms; }\n.lumia-card.lumia-card-appear:nth-child(6) { animation-delay: 150ms; }\n.lumia-card.lumia-card-appear:nth-child(7) { animation-delay: 180ms; }\n.lumia-card.lumia-card-appear:nth-child(8) { animation-delay: 210ms; }\n.lumia-card.lumia-card-appear:nth-child(9) { animation-delay: 240ms; }\n.lumia-card.lumia-card-appear:nth-child(10) { animation-delay: 270ms; }\n.lumia-card.lumia-card-appear:nth-child(n+11) { animation-delay: 300ms; }\n\n/* ============================================\n   MODAL PORTAL - Renders at document.body level\n   ============================================ */\n\n.lumia-modal-backdrop {\n    position: fixed;\n    inset: 0;\n    z-index: 10000;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    padding: 16px;\n    box-sizing: border-box;\n}\n\n/* ============================================\n   LUMIA MODAL RESPONSIVE\n   ============================================ */\n\n@media (max-width: 600px) {\n    /* Adjusted modal style - centered, not full-screen */\n    .lumia-modal {\n        width: 94vw;\n        max-width: 400px;\n        max-height: 90vh;\n        max-height: 90dvh;\n        border-radius: 16px;\n        margin: auto;\n    }\n\n    .lumia-modal-selection {\n        max-width: 94vw;\n    }\n\n    /* Ensure backdrop properly centers the modal */\n    .lumia-modal-backdrop {\n        padding: 16px;\n    }\n\n    /* Modal content scrolling for mobile */\n    .lumia-modal-content {\n        overflow-y: auto;\n        -webkit-overflow-scrolling: touch;\n    }\n\n    .lumia-modal-header-inner {\n        padding: 14px 16px;\n        gap: 10px;\n    }\n\n    .lumia-modal-header-icon {\n        width: 32px;\n        height: 32px;\n    }\n\n    .lumia-modal-title {\n        font-size: 15px;\n    }\n\n    .lumia-modal-content {\n        padding: 12px;\n    }\n\n    .lumia-modal-content > * + * {\n        margin-top: 12px;\n    }\n\n    .lumia-modal-panel-content {\n        padding: 10px;\n    }\n\n    .lumia-modal-footer {\n        padding: 12px 16px;\n    }\n\n    .lumia-modal-btn {\n        padding: 10px 16px;\n        font-size: 13px;\n    }\n\n    .lumia-card-grid {\n        grid-template-columns: repeat(2, 1fr);\n        gap: 12px;\n    }\n\n    .lumia-card {\n        border-radius: 12px;\n    }\n\n    .lumia-card-info {\n        padding: 10px 12px 12px;\n    }\n\n    .lumia-card-name {\n        font-size: 13px;\n    }\n\n    .lumia-card-check {\n        width: 24px;\n        height: 24px;\n    }\n\n    .lumia-card-check svg {\n        width: 14px;\n        height: 14px;\n    }\n\n    .lumia-card-placeholder {\n        font-size: 36px;\n    }\n\n    /* Disable animations on mobile for performance */\n    .lumia-card,\n    .lumia-card-image img,\n    .lumia-dominant-icon,\n    .lumia-card-check {\n        transition: none !important;\n    }\n\n    .lumia-card:hover {\n        transform: none;\n    }\n\n    .lumia-card:hover .lumia-card-image img {\n        transform: none;\n    }\n\n    /* Viewport Panel Mobile */\n    .lumiverse-viewport-wrapper {\n        width: 100vw !important;\n    }\n\n    .lumiverse-viewport-panel {\n        width: 100%;\n    }\n\n    .lumiverse-vp-tabs {\n        width: 48px;\n    }\n\n    .lumiverse-vp-tab {\n        width: 44px;\n        height: 44px;\n    }\n\n    .lumiverse-vp-tab-label {\n        font-size: 9px;\n    }\n\n    /* Toggle button - shift down to avoid SillyTavern's top bar */\n    /* Only apply to default positioning, not custom */\n    .lumiverse-toggle-container:not(.lumiverse-toggle-container--custom) {\n        top: 44px !important;\n    }\n\n    /* Summary textarea - ensure proper height on mobile */\n    .lumiverse-vp-summary-editor {\n        min-height: 0;\n    }\n\n    .lumiverse-vp-summary-textarea-wrapper {\n        flex: 1;\n        min-height: 180px;\n        display: flex;\n        flex-direction: column;\n    }\n\n    .lumiverse-vp-summary-textarea {\n        flex: 1;\n        min-height: 180px;\n    }\n}\n\n/* ============================================\n   MODAL CONTROLS - Collapse/Expand & Sort\n   Shared styling for Lumia Selection modals\n   ============================================ */\n\n.lumia-modal-controls {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    gap: 12px;\n    padding: 12px 16px;\n    background: rgba(0, 0, 0, 0.2);\n    border-bottom: 1px solid rgba(128, 128, 128, 0.12);\n    margin: 0 -16px 16px -16px;\n    width: calc(100% + 32px);\n}\n\n.lumia-modal-controls-group {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n}\n\n.lumia-modal-control-btn {\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    gap: 6px;\n    padding: 8px 12px;\n    font-size: 12px;\n    font-weight: 500;\n    color: rgba(255, 255, 255, 0.7);\n    background: rgba(0, 0, 0, 0.25);\n    border: 1px solid rgba(128, 128, 128, 0.15);\n    border-radius: 8px;\n    cursor: pointer;\n    transition: all 0.15s ease;\n    white-space: nowrap;\n}\n\n.lumia-modal-control-btn svg {\n    width: 14px;\n    height: 14px;\n    stroke: currentColor;\n    flex-shrink: 0;\n    display: block;\n}\n\n.lumia-modal-control-btn:hover {\n    color: rgba(255, 255, 255, 0.95);\n    background: rgba(0, 0, 0, 0.35);\n    border-color: rgba(147, 112, 219, 0.5);\n}\n\n.lumia-modal-control-btn:active {\n    transform: scale(0.97);\n}\n\n/* Control icons */\n.lumia-control-icon {\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    width: 16px;\n    height: 16px;\n    flex-shrink: 0;\n}\n\n.lumia-control-icon svg {\n    width: 16px;\n    height: 16px;\n    stroke: currentColor;\n    display: block;\n}\n\n/* Sort icon */\n.lumia-sort-icon {\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    width: 16px;\n    height: 16px;\n    flex-shrink: 0;\n    color: rgba(255, 255, 255, 0.6);\n}\n\n.lumia-sort-icon svg {\n    width: 16px;\n    height: 16px;\n    stroke: currentColor;\n    display: block;\n}\n\n/* Sort Dropdown */\n.lumia-modal-sort {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    padding: 6px 12px;\n    background: rgba(0, 0, 0, 0.25);\n    border: 1px solid rgba(128, 128, 128, 0.15);\n    border-radius: 8px;\n}\n\n/* Direct SVG targeting for sort dropdown - mirrors .lumia-modal-control-btn svg pattern */\n.lumia-modal-sort svg {\n    width: 14px;\n    height: 14px;\n    stroke: currentColor;\n    flex-shrink: 0;\n    display: block;\n}\n\n.lumia-modal-sort-label {\n    font-size: 12px;\n    font-weight: 500;\n    color: rgba(255, 255, 255, 0.5);\n}\n\n.lumia-select {\n    padding: 4px 8px;\n    font-size: 12px;\n    font-weight: 500;\n    color: rgba(255, 255, 255, 0.9);\n    background: rgba(0, 0, 0, 0.3);\n    border: 1px solid rgba(128, 128, 128, 0.2);\n    border-radius: 6px;\n    cursor: pointer;\n    transition: all 0.15s ease;\n    min-width: 100px;\n}\n\n.lumia-select:hover {\n    border-color: rgba(147, 112, 219, 0.4);\n}\n\n.lumia-select:focus {\n    outline: none;\n    border-color: rgba(147, 112, 219, 0.6);\n    box-shadow: 0 0 0 2px rgba(147, 112, 219, 0.15);\n}\n\n.lumia-select option {\n    background: #1a1a1a;\n    color: #fff;\n}\n\n/* Mobile adjustments for controls */\n@media (max-width: 600px) {\n    .lumia-modal-controls {\n        flex-wrap: wrap;\n        gap: 8px;\n        padding: 10px 12px;\n        margin: 0 -12px 12px -12px;\n        width: calc(100% + 24px);\n    }\n\n    .lumia-modal-control-btn {\n        padding: 6px 10px;\n        font-size: 11px;\n    }\n\n    /* Hide text labels on mobile, but keep icon spans visible */\n    .lumia-modal-control-btn > span:not(.lumia-btn-icon):not(.lumia-control-icon):not([class*="icon"]) {\n        display: none;\n    }\n\n    .lumia-modal-sort {\n        flex: 1;\n        min-width: 100%;\n        justify-content: space-between;\n    }\n\n    .lumia-select {\n        flex: 1;\n        min-width: 0;\n        padding: 5px 8px;\n        font-size: 11px;\n    }\n}\n\n/* ============================================\n   LOOM ITEMS - Styling for Loom Selection Modal\n   ============================================ */\n\n/* Loom items container within pack section */\n.lumia-loom-items {\n    display: flex;\n    flex-direction: column;\n    gap: 6px;\n    padding: 12px;\n    background: rgba(0, 0, 0, 0.15);\n}\n\n/* Individual Loom item */\n.lumiverse-loom-item {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 12px 16px;\n    background: rgba(0, 0, 0, 0.2);\n    border: 1px solid rgba(128, 128, 128, 0.12);\n    border-radius: 8px;\n    cursor: pointer;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-loom-item:hover {\n    background: rgba(0, 0, 0, 0.3);\n    border-color: rgba(147, 112, 219, 0.3);\n}\n\n.lumiverse-loom-item--selected {\n    background: rgba(147, 112, 219, 0.15);\n    border-color: rgba(147, 112, 219, 0.5);\n}\n\n.lumiverse-loom-item-content {\n    flex: 1;\n}\n\n.lumiverse-loom-item-name {\n    font-weight: 500;\n    color: rgba(255, 255, 255, 0.9);\n    font-size: 14px;\n}\n\n.lumiverse-loom-item-toggle {\n    margin-left: 12px;\n}\n\n/* Toggle switch styling */\n.lumiverse-toggle-switch {\n    position: relative;\n    width: 40px;\n    height: 22px;\n}\n\n.lumiverse-toggle-track {\n    width: 100%;\n    height: 100%;\n    background: rgba(0, 0, 0, 0.3);\n    border: 2px solid rgba(128, 128, 128, 0.2);\n    border-radius: 11px;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-toggle-switch.checked .lumiverse-toggle-track {\n    background: rgba(147, 112, 219, 0.8);\n    border-color: rgba(147, 112, 219, 0.8);\n}\n\n.lumiverse-toggle-thumb {\n    position: absolute;\n    top: 3px;\n    left: 3px;\n    width: 16px;\n    height: 16px;\n    background: white;\n    border-radius: 50%;\n    transition: transform 0.15s ease;\n}\n\n.lumiverse-toggle-switch.checked .lumiverse-toggle-thumb {\n    transform: translateX(18px);\n}\n\n/* Selection actions */\n.lumia-selection-actions {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n    margin-left: auto;\n}\n\n.lumia-selection-count {\n    font-size: 13px;\n    color: rgba(255, 255, 255, 0.5);\n}\n\n/* Search box styling matching Lumia modal */\n.lumia-search-box {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    padding: 8px 12px;\n    background: rgba(0, 0, 0, 0.2);\n    border: 1px solid rgba(128, 128, 128, 0.12);\n    border-radius: 8px;\n    flex: 1;\n    max-width: 300px;\n}\n\n.lumia-search-icon,\n.lumia-search-icon svg {\n    width: 16px;\n    height: 16px;\n    color: rgba(255, 255, 255, 0.4);\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n}\n\n.lumia-search-input {\n    flex: 1;\n    background: transparent;\n    border: none;\n    outline: none;\n    color: rgba(255, 255, 255, 0.9);\n    font-size: 13px;\n}\n\n.lumia-search-input::placeholder {\n    color: rgba(255, 255, 255, 0.4);\n}\n\n.lumia-search-clear {\n    background: transparent;\n    border: none;\n    padding: 4px;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: rgba(255, 255, 255, 0.4);\n    transition: color 0.15s ease;\n}\n\n.lumia-search-clear:hover {\n    color: rgba(255, 255, 255, 0.8);\n}\n\n.lumia-search-clear-icon,\n.lumia-search-clear-icon svg {\n    width: 14px;\n    height: 14px;\n}\n\n/* ----------------------------------------\n   Lumia Modes Section (Chimera/Council)\n   ---------------------------------------- */\n.lumiverse-vp-mode-option {\n    margin-bottom: 8px;\n}\n\n.lumiverse-vp-mode-option:last-child {\n    margin-bottom: 0;\n}\n\n.lumiverse-vp-mode-details {\n    margin-top: 8px;\n    padding-left: 12px;\n    border-left: 2px solid rgba(147, 112, 219, 0.3);\n}\n\n.lumiverse-vp-mode-note {\n    margin: 8px 0 0;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n    font-style: italic;\n}\n\n/* ----------------------------------------\n   Council Manager Component\n   ---------------------------------------- */\n.lumiverse-council-manager {\n    padding: 12px;\n    display: flex;\n    flex-direction: column;\n    gap: 12px;\n}\n\n.lumiverse-council-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    gap: 12px;\n}\n\n.lumiverse-council-title {\n    margin: 0;\n    font-size: 14px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    display: flex;\n    align-items: center;\n    gap: 8px;\n}\n\n.lumiverse-council-title svg {\n    color: var(--lumiverse-primary);\n}\n\n.lumiverse-council-mode-toggle {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    cursor: pointer;\n}\n\n.lumiverse-council-mode-toggle input {\n    display: none;\n}\n\n.lumiverse-council-mode-switch {\n    width: 40px;\n    height: 22px;\n    background: rgba(100, 100, 130, 0.3);\n    border-radius: 11px;\n    position: relative;\n    transition: background 0.2s ease;\n}\n\n.lumiverse-council-mode-switch--on {\n    background: var(--lumiverse-primary);\n}\n\n.lumiverse-council-mode-thumb {\n    position: absolute;\n    top: 2px;\n    left: 2px;\n    width: 18px;\n    height: 18px;\n    background: white;\n    border-radius: 50%;\n    transition: transform 0.2s ease;\n}\n\n.lumiverse-council-mode-switch--on .lumiverse-council-mode-thumb {\n    transform: translateX(18px);\n}\n\n.lumiverse-council-mode-label {\n    font-size: 11px;\n    font-weight: 500;\n    color: var(--lumiverse-text-muted);\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n.lumiverse-council-desc {\n    margin: 0;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n    line-height: 1.5;\n}\n\n/* Add member section */\n.lumiverse-council-add-section {\n    margin-top: 4px;\n}\n\n.lumiverse-council-add-btn {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 8px;\n    width: 100%;\n    padding: 10px 16px;\n    background: rgba(147, 112, 219, 0.1);\n    border: 1px dashed rgba(147, 112, 219, 0.3);\n    border-radius: 8px;\n    color: var(--lumiverse-primary);\n    font-size: 13px;\n    font-weight: 500;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-council-add-btn:hover:not(:disabled) {\n    background: rgba(147, 112, 219, 0.15);\n    border-color: rgba(147, 112, 219, 0.5);\n}\n\n.lumiverse-council-add-btn:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n}\n\n/* Add dropdown */\n.lumiverse-council-add-dropdown {\n    background: rgba(30, 30, 46, 0.95);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 10px;\n    overflow: hidden;\n}\n\n.lumiverse-council-add-header {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    padding: 10px;\n    border-bottom: 1px solid var(--lumiverse-border);\n}\n\n.lumiverse-council-search {\n    flex: 1;\n    padding: 8px 12px;\n    background: var(--lumiverse-bg);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 6px;\n    color: var(--lumiverse-text);\n    font-size: 13px;\n}\n\n.lumiverse-council-search:focus {\n    outline: none;\n    border-color: var(--lumiverse-primary);\n}\n\n.lumiverse-council-add-list {\n    max-height: 200px;\n    overflow-y: auto;\n}\n\n.lumiverse-council-add-empty {\n    padding: 20px;\n    text-align: center;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-council-add-item {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    width: 100%;\n    padding: 10px 12px;\n    background: transparent;\n    border: none;\n    border-bottom: 1px solid rgba(255, 255, 255, 0.05);\n    color: var(--lumiverse-text);\n    cursor: pointer;\n    transition: background 0.2s ease;\n    text-align: left;\n    /* Mobile touch fixes */\n    touch-action: manipulation;\n    -webkit-tap-highlight-color: rgba(147, 112, 219, 0.2);\n}\n\n.lumiverse-council-add-item:hover {\n    background: rgba(147, 112, 219, 0.1);\n}\n\n.lumiverse-council-add-item:active {\n    background: rgba(147, 112, 219, 0.2);\n}\n\n.lumiverse-council-add-item:last-child {\n    border-bottom: none;\n}\n\n.lumiverse-council-add-item-avatar {\n    width: 36px;\n    height: 36px;\n    border-radius: 6px;\n    overflow: hidden;\n    background: rgba(147, 112, 219, 0.15);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: var(--lumiverse-primary);\n    flex-shrink: 0;\n    pointer-events: none; /* Allow parent button to capture touch */\n}\n\n.lumiverse-council-add-item-avatar img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n}\n\n.lumiverse-council-add-item-info {\n    flex: 1;\n    min-width: 0;\n    pointer-events: none; /* Allow parent button to capture touch */\n}\n\n.lumiverse-council-add-item-name {\n    display: block;\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-council-add-item-pack {\n    display: block;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n}\n\n/* Members list */\n.lumiverse-council-members {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumiverse-council-empty {\n    padding: 24px;\n    text-align: center;\n    background: rgba(30, 30, 46, 0.4);\n    border-radius: 10px;\n}\n\n.lumiverse-council-empty-icon {\n    display: block;\n    margin-bottom: 12px;\n    color: var(--lumiverse-primary);\n    opacity: 0.5;\n}\n\n.lumiverse-council-empty h4 {\n    margin: 0 0 8px;\n    font-size: 14px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-council-empty p {\n    margin: 0;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n    line-height: 1.5;\n}\n\n/* Member card */\n.lumiverse-council-member {\n    background: rgba(30, 30, 46, 0.6);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 10px;\n    overflow: hidden;\n}\n\n.lumiverse-council-member-header {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 10px 12px;\n    cursor: pointer;\n    transition: background 0.2s ease;\n}\n\n.lumiverse-council-member-header:hover {\n    background: rgba(147, 112, 219, 0.05);\n}\n\n.lumiverse-council-member-avatar {\n    width: 40px;\n    height: 40px;\n    border-radius: 8px;\n    overflow: hidden;\n    background: rgba(147, 112, 219, 0.15);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: var(--lumiverse-primary);\n    flex-shrink: 0;\n}\n\n.lumiverse-council-member-avatar img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n}\n\n.lumiverse-council-member-info {\n    flex: 1;\n    min-width: 0;\n}\n\n.lumiverse-council-member-name {\n    display: block;\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-council-member-role {\n    display: block;\n    font-size: 11px;\n    color: var(--lumiverse-primary);\n    font-weight: 500;\n}\n\n.lumiverse-council-member-stats {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    margin-top: 4px;\n}\n\n.lumiverse-council-stat {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-council-stat svg {\n    opacity: 0.7;\n}\n\n.lumiverse-council-member-actions {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n}\n\n.lumiverse-council-btn {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 28px;\n    height: 28px;\n    background: rgba(100, 100, 130, 0.2);\n    border: none;\n    border-radius: 6px;\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-council-btn:hover {\n    background: rgba(147, 112, 219, 0.2);\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-council-btn--primary {\n    background: var(--lumiverse-primary);\n    color: white;\n}\n\n.lumiverse-council-btn--primary:hover {\n    background: var(--lumiverse-primary-light);\n}\n\n.lumiverse-council-btn--danger:hover {\n    background: rgba(239, 68, 68, 0.2);\n    color: var(--lumiverse-danger);\n}\n\n.lumiverse-council-expand {\n    display: flex;\n    transition: transform 0.2s ease;\n}\n\n.lumiverse-council-expand--open {\n    transform: rotate(180deg);\n}\n\n/* Member body (expanded content) */\n.lumiverse-council-member-body {\n    padding: 12px;\n    border-top: 1px solid var(--lumiverse-border);\n    background: rgba(20, 20, 36, 0.4);\n}\n\n.lumiverse-council-role-edit {\n    margin-bottom: 12px;\n}\n\n.lumiverse-council-role-edit label {\n    display: block;\n    font-size: 11px;\n    font-weight: 500;\n    color: var(--lumiverse-text-muted);\n    margin-bottom: 6px;\n}\n\n.lumiverse-council-role-input-row {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n}\n\n.lumiverse-council-input {\n    flex: 1;\n    padding: 8px 12px;\n    background: var(--lumiverse-bg);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 6px;\n    color: var(--lumiverse-text);\n    font-size: 13px;\n}\n\n.lumiverse-council-input:focus {\n    outline: none;\n    border-color: var(--lumiverse-primary);\n}\n\n.lumiverse-council-role-display {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    margin-bottom: 12px;\n    font-size: 12px;\n}\n\n.lumiverse-council-role-label {\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-council-role-value {\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-council-role-value em {\n    color: var(--lumiverse-text-muted);\n    font-style: italic;\n}\n\n/* Traits section */\n.lumiverse-council-traits-section {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumiverse-council-traits-group {\n    display: flex;\n    flex-wrap: wrap;\n    align-items: flex-start;\n    gap: 6px;\n    font-size: 12px;\n}\n\n.lumiverse-council-traits-label {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    color: var(--lumiverse-text-muted);\n    flex-shrink: 0;\n}\n\n.lumiverse-council-traits-list {\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-council-traits-empty {\n    color: var(--lumiverse-text-dim);\n    font-style: italic;\n}\n\n.lumiverse-council-help-text {\n    margin: 12px 0 0;\n    padding: 10px;\n    background: rgba(147, 112, 219, 0.08);\n    border-radius: 6px;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n    line-height: 1.5;\n}\n\n/* Help text at bottom */\n.lumiverse-council-help {\n    padding: 10px;\n    background: rgba(30, 30, 46, 0.4);\n    border-radius: 8px;\n}\n\n.lumiverse-council-help p {\n    margin: 0;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n    line-height: 1.5;\n}\n\n.lumiverse-council-help code {\n    background: rgba(147, 112, 219, 0.15);\n    padding: 2px 5px;\n    border-radius: 3px;\n    font-size: 10px;\n    color: var(--lumiverse-primary);\n}\n\n/* ========================================\n   Council Select Modal\n   Mobile-friendly modal for selecting council members\n   ======================================== */\n\n.lumiverse-council-select-modal {\n    display: flex;\n    flex-direction: column;\n    height: 100%;\n    max-height: 80vh;\n}\n\n/* Header */\n.lumiverse-council-select-header {\n    display: flex;\n    align-items: flex-start;\n    gap: 12px;\n    padding: 16px 20px;\n    border-bottom: 1px solid var(--lumiverse-border);\n}\n\n.lumiverse-council-select-header-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 40px;\n    height: 40px;\n    background: linear-gradient(135deg, var(--lumiverse-primary), var(--lumiverse-primary-light));\n    border-radius: 10px;\n    color: white;\n    flex-shrink: 0;\n}\n\n.lumiverse-council-select-header-text h3 {\n    margin: 0 0 4px;\n    font-size: 16px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-council-select-header-text p {\n    margin: 0;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n    line-height: 1.4;\n}\n\n/* Sections */\n.lumiverse-council-select-section {\n    padding: 16px 20px;\n    border-bottom: 1px solid var(--lumiverse-border);\n    flex-shrink: 0;\n}\n\n/* Council Members section - constrained height with scrolling */\n.lumiverse-council-select-section:not(.lumiverse-council-select-section--available) {\n    max-height: 35vh;\n    display: flex;\n    flex-direction: column;\n}\n\n.lumiverse-council-select-section--available {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    min-height: 200px;\n    overflow: hidden;\n}\n\n.lumiverse-council-select-section-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    gap: 12px;\n    margin-bottom: 12px;\n    font-size: 12px;\n    font-weight: 600;\n    color: var(--lumiverse-text-muted);\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n.lumiverse-council-select-count {\n    padding: 2px 8px;\n    background: var(--lumiverse-primary);\n    border-radius: 10px;\n    font-size: 11px;\n    font-weight: 600;\n    color: white;\n}\n\n/* Search */\n.lumiverse-council-search-wrapper {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    padding: 6px 10px;\n    background: rgba(30, 30, 46, 0.6);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 8px;\n    flex: 1;\n    max-width: 200px;\n}\n\n.lumiverse-council-search-wrapper svg {\n    color: var(--lumiverse-text-muted);\n    flex-shrink: 0;\n}\n\n.lumiverse-council-search-input {\n    flex: 1;\n    min-width: 0;\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text);\n    font-size: 12px;\n}\n\n.lumiverse-council-search-input::placeholder {\n    color: var(--lumiverse-text-dim);\n}\n\n.lumiverse-council-search-input:focus {\n    outline: none;\n}\n\n.lumiverse-council-search-clear {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 18px;\n    height: 18px;\n    background: rgba(100, 100, 130, 0.3);\n    border: none;\n    border-radius: 50%;\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-council-search-clear:hover {\n    background: rgba(239, 68, 68, 0.3);\n    color: var(--lumiverse-danger);\n}\n\n/* Members list (horizontal scrolling on mobile) */\n.lumiverse-council-select-members {\n    min-height: 60px;\n    flex: 1;\n    overflow-y: auto;\n    scrollbar-width: thin;\n    scrollbar-color: rgba(147, 112, 219, 0.3) transparent;\n}\n\n.lumiverse-council-select-members::-webkit-scrollbar {\n    width: 6px;\n}\n\n.lumiverse-council-select-members::-webkit-scrollbar-track {\n    background: transparent;\n}\n\n.lumiverse-council-select-members::-webkit-scrollbar-thumb {\n    background: rgba(147, 112, 219, 0.3);\n    border-radius: 3px;\n}\n\n.lumiverse-council-select-members::-webkit-scrollbar-thumb:hover {\n    background: rgba(147, 112, 219, 0.5);\n}\n\n.lumiverse-council-member-list {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n/* Member card (in modal) */\n.lumiverse-council-member-card {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 10px 12px;\n    background: rgba(30, 30, 46, 0.6);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 10px;\n}\n\n.lumiverse-council-member-card-avatar {\n    width: 36px;\n    height: 36px;\n    border-radius: 8px;\n    overflow: hidden;\n    background: rgba(147, 112, 219, 0.15);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: var(--lumiverse-primary);\n    flex-shrink: 0;\n}\n\n.lumiverse-council-member-card-avatar img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n}\n\n.lumiverse-council-member-card-content {\n    flex: 1;\n    min-width: 0;\n}\n\n.lumiverse-council-member-card-name {\n    display: block;\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-council-member-card-meta {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    margin-top: 2px;\n}\n\n.lumiverse-council-member-card-role {\n    font-size: 11px;\n    color: var(--lumiverse-primary);\n    font-weight: 500;\n    cursor: pointer;\n}\n\n.lumiverse-council-member-card-role:hover {\n    text-decoration: underline;\n}\n\n.lumiverse-council-add-role-btn {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    padding: 0;\n    background: none;\n    border: none;\n    font-size: 10px;\n    color: var(--lumiverse-text-dim);\n    cursor: pointer;\n    transition: color 0.2s ease;\n}\n\n.lumiverse-council-add-role-btn:hover {\n    color: var(--lumiverse-primary);\n}\n\n.lumiverse-council-member-card-stats {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n}\n\n.lumiverse-council-member-card-stats span {\n    display: flex;\n    align-items: center;\n    gap: 3px;\n    font-size: 10px;\n    color: var(--lumiverse-text-dim);\n}\n\n/* Small buttons for modal */\n.lumiverse-council-btn-sm {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 24px;\n    height: 24px;\n    background: rgba(100, 100, 130, 0.2);\n    border: none;\n    border-radius: 6px;\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    transition: all 0.2s ease;\n    flex-shrink: 0;\n}\n\n.lumiverse-council-btn-sm:hover {\n    background: rgba(147, 112, 219, 0.2);\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-council-btn-sm--primary {\n    background: var(--lumiverse-primary);\n    color: white;\n}\n\n.lumiverse-council-btn-sm--primary:hover {\n    background: var(--lumiverse-primary-light);\n}\n\n.lumiverse-council-btn-sm--danger:hover {\n    background: rgba(239, 68, 68, 0.2);\n    color: var(--lumiverse-danger);\n}\n\n/* Role edit in modal */\n.lumiverse-council-member-role-edit {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    margin-top: 4px;\n}\n\n.lumiverse-council-input-sm {\n    flex: 1;\n    min-width: 0;\n    padding: 4px 8px;\n    background: var(--lumiverse-bg);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 4px;\n    color: var(--lumiverse-text);\n    font-size: 11px;\n}\n\n.lumiverse-council-input-sm:focus {\n    outline: none;\n    border-color: var(--lumiverse-primary);\n}\n\n/* Grid wrapper for available Lumias */\n.lumiverse-council-select-grid-wrapper {\n    flex: 1;\n    overflow-y: auto;\n    min-height: 150px;\n}\n\n/* Card grid for available Lumias */\n.lumiverse-council-select-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));\n    gap: 12px;\n    padding: 4px 0;\n}\n\n/* Selectable card - now a button for iOS touch compatibility */\n.lumiverse-council-select-card {\n    display: flex;\n    flex-direction: column;\n    background: rgba(30, 30, 46, 0.6);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 10px;\n    overflow: hidden;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    /* Button reset */\n    padding: 0;\n    margin: 0;\n    font: inherit;\n    text-align: left;\n    /* Mobile touch fixes */\n    touch-action: manipulation;\n    -webkit-tap-highlight-color: rgba(147, 112, 219, 0.2);\n}\n\n.lumiverse-council-select-card:hover {\n    border-color: var(--lumiverse-primary);\n    transform: translateY(-2px);\n    box-shadow: 0 4px 12px rgba(147, 112, 219, 0.15);\n}\n\n.lumiverse-council-select-card:active {\n    transform: scale(0.98);\n    border-color: var(--lumiverse-primary);\n}\n\n.lumiverse-council-select-card-image {\n    position: relative;\n    aspect-ratio: 1;\n    background: rgba(147, 112, 219, 0.1);\n    pointer-events: none; /* Allow parent button to capture touch */\n}\n\n.lumiverse-council-select-card-image img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n}\n\n.lumiverse-council-select-card-placeholder {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 100%;\n    height: 100%;\n    color: var(--lumiverse-text-dim);\n}\n\n.lumiverse-council-select-card-add {\n    position: absolute;\n    bottom: 6px;\n    right: 6px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 24px;\n    height: 24px;\n    background: var(--lumiverse-primary);\n    border-radius: 50%;\n    color: white;\n    opacity: 0;\n    transform: scale(0.8);\n    transition: all 0.2s ease;\n}\n\n.lumiverse-council-select-card:hover .lumiverse-council-select-card-add {\n    opacity: 1;\n    transform: scale(1);\n}\n\n.lumiverse-council-select-card-info {\n    padding: 8px;\n    text-align: center;\n    pointer-events: none; /* Allow parent button to capture touch */\n}\n\n.lumiverse-council-select-card-name {\n    display: block;\n    font-size: 11px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-council-select-card-pack {\n    display: block;\n    font-size: 9px;\n    color: var(--lumiverse-text-dim);\n    margin-top: 2px;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n/* Empty states */\n.lumiverse-council-select-empty {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    padding: 24px;\n    text-align: center;\n    color: var(--lumiverse-primary);\n}\n\n.lumiverse-council-select-empty--muted {\n    color: var(--lumiverse-text-dim);\n}\n\n.lumiverse-council-select-empty span {\n    display: block;\n    margin-top: 8px;\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-council-select-empty p {\n    margin: 4px 0 0;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n    line-height: 1.4;\n}\n\n/* Footer */\n.lumiverse-council-select-footer {\n    display: flex;\n    justify-content: flex-end;\n    gap: 10px;\n    padding: 12px 20px;\n    border-top: 1px solid var(--lumiverse-border);\n    background: rgba(20, 20, 36, 0.4);\n}\n\n/* Mobile responsiveness */\n@media (max-width: 480px) {\n    .lumiverse-council-select-modal {\n        max-height: 90vh;\n    }\n\n    .lumiverse-council-select-header {\n        padding: 12px 16px;\n    }\n\n    .lumiverse-council-select-header-icon {\n        width: 36px;\n        height: 36px;\n    }\n\n    .lumiverse-council-select-header-text h3 {\n        font-size: 15px;\n    }\n\n    .lumiverse-council-select-section {\n        padding: 12px 16px;\n    }\n\n    .lumiverse-council-select-section-header {\n        flex-wrap: wrap;\n    }\n\n    .lumiverse-council-search-wrapper {\n        max-width: none;\n        width: 100%;\n        margin-top: 8px;\n        order: 1;\n    }\n\n    .lumiverse-council-member-list {\n        /* Horizontal scroll on mobile */\n        flex-direction: row;\n        overflow-x: auto;\n        padding-bottom: 8px;\n        gap: 10px;\n        scrollbar-width: thin;\n    }\n\n    .lumiverse-council-member-card {\n        flex-shrink: 0;\n        min-width: 200px;\n        max-width: 280px;\n    }\n\n    .lumiverse-council-select-grid {\n        grid-template-columns: repeat(3, 1fr);\n        gap: 8px;\n    }\n\n    .lumiverse-council-select-card-info {\n        padding: 6px;\n    }\n\n    .lumiverse-council-select-card-name {\n        font-size: 10px;\n    }\n\n    .lumiverse-council-select-card-pack {\n        display: none;\n    }\n\n    /* Always show plus icon on touch devices since hover doesn't work */\n    .lumiverse-council-select-card-add {\n        opacity: 1;\n        transform: scale(1);\n    }\n\n    .lumiverse-council-select-footer {\n        padding: 10px 16px;\n    }\n}\n\n/* ----------------------------------------\n   Collapsible Component - CSS Grid Based\n   High-performance alternative to height animations.\n   Uses grid-template-rows: 0fr -> 1fr which is GPU-accelerated\n   and doesn't trigger layout thrashing.\n   ---------------------------------------- */\n.lumiverse-collapsible {\n    display: grid;\n    grid-template-rows: 0fr;\n    transition: grid-template-rows var(--collapsible-duration, 200ms) ease-out;\n}\n\n.lumiverse-collapsible.is-open {\n    grid-template-rows: 1fr;\n}\n\n.lumiverse-collapsible-inner {\n    overflow: hidden;\n    /* Ensure content is properly hidden when collapsed */\n    min-height: 0;\n}\n\n/* Optional: Fade in content when opening */\n.lumiverse-collapsible .lumiverse-collapsible-inner > * {\n    opacity: 0;\n    transition: opacity calc(var(--collapsible-duration, 200ms) * 0.5) ease-out;\n    transition-delay: calc(var(--collapsible-duration, 200ms) * 0.25);\n}\n\n.lumiverse-collapsible.is-open .lumiverse-collapsible-inner > * {\n    opacity: 1;\n}\n\n/* Reduced motion: instant transitions for accessibility */\n@media (prefers-reduced-motion: reduce) {\n    .lumiverse-collapsible {\n        transition: none;\n    }\n\n    .lumiverse-collapsible .lumiverse-collapsible-inner > * {\n        transition: none;\n        opacity: 1;\n    }\n\n    .lumiverse-collapsible:not(.is-open) .lumiverse-collapsible-inner > * {\n        opacity: 0;\n    }\n}\n\n/* ========================================\n   Pack Detail Modal - Pack Contents Viewer\n   Centered modal for viewing pack contents\n   with quick-add actions\n   ======================================== */\n\n/* Backdrop */\n.lumiverse-pack-detail-backdrop {\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background: rgba(0, 0, 0, 0.7);\n    backdrop-filter: blur(4px);\n    z-index: 10000;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    padding: 20px;\n    animation: fadeIn 0.15s ease-out;\n}\n\n@keyframes fadeIn {\n    from { opacity: 0; }\n    to { opacity: 1; }\n}\n\n/* Pack detail modal - extends lumia-modal base class */\n.lumiverse-pack-detail-modal {\n    /* Override base modal width for pack details */\n    max-width: 650px;\n    /* Use Lumiverse theme colors */\n    background: var(--lumiverse-bg);\n    border-color: var(--lumiverse-border);\n    /* Custom animation */\n    animation: slideUp 0.2s ease-out;\n}\n\n@keyframes slideUp {\n    from {\n        opacity: 0;\n        transform: translateY(20px);\n    }\n    to {\n        opacity: 1;\n        transform: translateY(0);\n    }\n}\n\n/* Header */\n.lumiverse-pack-detail-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 16px 20px;\n    border-bottom: 1px solid var(--lumiverse-border);\n    background: var(--lumiverse-bg-elevated);\n    flex-shrink: 0;\n}\n\n.lumiverse-pack-detail-header-info {\n    display: flex;\n    align-items: center;\n    gap: 14px;\n    flex: 1;\n    min-width: 0;\n}\n\n.lumiverse-pack-detail-header-icon {\n    width: 48px;\n    height: 48px;\n    border-radius: var(--lumiverse-radius);\n    background: var(--lumiverse-bg-dark);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    flex-shrink: 0;\n    overflow: hidden;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-pack-detail-header-icon img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n}\n\n.lumiverse-pack-detail-header-text {\n    flex: 1;\n    min-width: 0;\n}\n\n.lumiverse-pack-detail-title {\n    margin: 0;\n    font-size: 18px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-pack-detail-stats {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 12px;\n    margin-top: 6px;\n}\n\n.lumiverse-pack-detail-stats > span {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-pack-detail-close {\n    width: 32px;\n    height: 32px;\n    border-radius: 50%;\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: all var(--lumiverse-transition-fast);\n    flex-shrink: 0;\n}\n\n.lumiverse-pack-detail-close:hover {\n    background: var(--lumiverse-bg-hover);\n    color: var(--lumiverse-text);\n}\n\n/* Content */\n.lumiverse-pack-detail-content {\n    flex: 1;\n    overflow-y: auto;\n    padding: 16px 20px;\n}\n\n/* Empty state */\n.lumiverse-pack-detail-empty {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    padding: 48px 20px;\n    text-align: center;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-pack-detail-empty svg {\n    opacity: 0.4;\n    margin-bottom: 12px;\n}\n\n.lumiverse-pack-detail-empty p {\n    margin: 0;\n    font-size: 14px;\n}\n\n/* Lumia list */\n.lumiverse-pack-detail-list {\n    display: flex;\n    flex-direction: column;\n    gap: 12px;\n}\n\n/* Lumia card */\n.lumiverse-pack-detail-lumia {\n    background: var(--lumiverse-bg-elevated);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    padding: 14px;\n    transition: border-color var(--lumiverse-transition-fast);\n}\n\n.lumiverse-pack-detail-lumia:hover {\n    border-color: var(--lumiverse-border-hover);\n}\n\n/* Lumia header */\n.lumiverse-pack-detail-lumia-header {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n    margin-bottom: 12px;\n}\n\n.lumiverse-pack-detail-lumia-avatar {\n    width: 44px;\n    height: 44px;\n    border-radius: var(--lumiverse-radius-sm);\n    background: var(--lumiverse-bg-dark);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    flex-shrink: 0;\n    overflow: hidden;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-pack-detail-lumia-avatar img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n}\n\n.lumiverse-pack-detail-lumia-info {\n    flex: 1;\n    min-width: 0;\n}\n\n.lumiverse-pack-detail-lumia-name {\n    margin: 0;\n    font-size: 15px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-pack-detail-lumia-author {\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n}\n\n/* Traits container */\n.lumiverse-pack-detail-traits {\n    display: flex;\n    flex-direction: column;\n    gap: 6px;\n    margin-bottom: 12px;\n}\n\n/* Trait preview */\n.lumiverse-pack-detail-trait {\n    background: var(--lumiverse-bg-dark);\n    border-radius: var(--lumiverse-radius-sm);\n    overflow: hidden;\n}\n\n.lumiverse-pack-detail-trait-header {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    width: 100%;\n    padding: 8px 12px;\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text);\n    cursor: pointer;\n    transition: background var(--lumiverse-transition-fast);\n    text-align: left;\n}\n\n.lumiverse-pack-detail-trait-header:hover {\n    background: rgba(255, 255, 255, 0.03);\n}\n\n.lumiverse-pack-detail-trait-header--open {\n    background: rgba(255, 255, 255, 0.02);\n}\n\n.lumiverse-pack-detail-trait-icon {\n    color: var(--lumiverse-text-muted);\n    display: flex;\n    align-items: center;\n}\n\n.lumiverse-pack-detail-trait-title {\n    flex: 1;\n    font-size: 13px;\n    font-weight: 500;\n}\n\n.lumiverse-pack-detail-trait-chevron {\n    color: var(--lumiverse-text-dim);\n    display: flex;\n    align-items: center;\n}\n\n.lumiverse-pack-detail-trait-content {\n    padding: 0 12px 12px;\n}\n\n.lumiverse-pack-detail-trait-content p {\n    margin: 0;\n    font-size: 12px;\n    line-height: 1.5;\n    color: var(--lumiverse-text-muted);\n    white-space: pre-wrap;\n    word-break: break-word;\n}\n\n/* Actions */\n.lumiverse-pack-detail-actions {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 8px;\n}\n\n.lumiverse-pack-detail-action {\n    display: flex;\n    align-items: center;\n    gap: 5px;\n    padding: 6px 10px;\n    background: var(--lumiverse-primary-light);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius-sm);\n    color: var(--lumiverse-text);\n    font-size: 12px;\n    font-weight: 500;\n    cursor: pointer;\n    transition: all var(--lumiverse-transition-fast);\n}\n\n.lumiverse-pack-detail-action:hover:not(:disabled) {\n    background: var(--lumiverse-primary);\n    border-color: var(--lumiverse-primary);\n    color: white;\n}\n\n.lumiverse-pack-detail-action:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n}\n\n.lumiverse-pack-detail-action--selected {\n    background: var(--lumiverse-success);\n    border-color: var(--lumiverse-success);\n    color: white;\n    cursor: default;\n}\n\n.lumiverse-pack-detail-action--selected:hover {\n    background: var(--lumiverse-success);\n    border-color: var(--lumiverse-success);\n}\n\n.lumiverse-pack-detail-action--enable-all {\n    background: transparent;\n    border-style: dashed;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-pack-detail-action--enable-all:hover {\n    background: var(--lumiverse-bg-hover);\n    border-color: var(--lumiverse-border-hover);\n    color: var(--lumiverse-text);\n}\n\n/* Pack browser - View button */\n.lumiverse-browser-pack-view-btn {\n    width: 28px;\n    height: 28px;\n    border-radius: var(--lumiverse-radius-sm);\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text-dim);\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: all var(--lumiverse-transition-fast);\n    flex-shrink: 0;\n    margin-left: auto;\n    margin-right: 8px;\n}\n\n.lumiverse-browser-pack-view-btn:hover {\n    background: var(--lumiverse-bg-hover);\n    color: var(--lumiverse-primary);\n}\n\n/* Downloaded Packs Section in Settings */\n.lumia-downloaded-packs {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumia-downloaded-pack-item {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n    padding: 10px 12px;\n    background: var(--lumiverse-bg-dark);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    transition: border-color var(--lumiverse-transition-fast);\n}\n\n.lumia-downloaded-pack-item:hover {\n    border-color: var(--lumiverse-border-hover);\n}\n\n.lumia-downloaded-pack-cover {\n    width: 36px;\n    height: 36px;\n    border-radius: var(--lumiverse-radius-sm);\n    object-fit: cover;\n    flex-shrink: 0;\n}\n\n.lumia-downloaded-pack-cover-placeholder {\n    width: 36px;\n    height: 36px;\n    border-radius: var(--lumiverse-radius-sm);\n    background: var(--lumiverse-bg-darker);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    flex-shrink: 0;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumia-downloaded-pack-cover-placeholder svg {\n    width: 18px;\n    height: 18px;\n}\n\n.lumia-downloaded-pack-info {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n    min-width: 0;\n}\n\n.lumia-downloaded-pack-name {\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumia-downloaded-pack-count {\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n}\n\n/* Downloaded Pack Actions */\n.lumia-downloaded-pack-actions {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    flex-shrink: 0;\n}\n\n/* Danger Icon Button */\n.lumia-btn-icon-danger {\n    color: var(--lumiverse-danger);\n    opacity: 0.6;\n}\n\n.lumia-btn-icon-danger:hover {\n    opacity: 1;\n    background: rgba(239, 68, 68, 0.15);\n}\n\n/* Loom Pack Detail Modal Additions */\n.lumiverse-loom-detail-modal {\n    /* Uses same base styles as pack detail modal */\n}\n\n.lumiverse-loom-detail-categories {\n    display: flex;\n    flex-direction: column;\n    gap: 16px;\n}\n\n/* Category section */\n.lumiverse-loom-detail-category {\n    background: var(--lumiverse-bg-elevated);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    overflow: hidden;\n}\n\n.lumiverse-loom-detail-category-header {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    width: 100%;\n    padding: 12px 14px;\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text);\n    cursor: pointer;\n    transition: background var(--lumiverse-transition-fast);\n    text-align: left;\n}\n\n.lumiverse-loom-detail-category-header:hover {\n    background: rgba(255, 255, 255, 0.03);\n}\n\n.lumiverse-loom-detail-category-header--expanded {\n    border-bottom: 1px solid var(--lumiverse-border);\n}\n\n.lumiverse-loom-detail-category-icon {\n    color: var(--lumiverse-primary);\n    display: flex;\n    align-items: center;\n}\n\n.lumiverse-loom-detail-category-title {\n    flex: 1;\n    font-size: 14px;\n    font-weight: 600;\n}\n\n.lumiverse-loom-detail-category-count {\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n    background: var(--lumiverse-bg-dark);\n    padding: 2px 8px;\n    border-radius: 10px;\n}\n\n.lumiverse-loom-detail-category-chevron {\n    color: var(--lumiverse-text-dim);\n    display: flex;\n    align-items: center;\n}\n\n.lumiverse-loom-detail-category-items {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n    padding: 12px;\n}\n\n/* Loom item card */\n.lumiverse-loom-detail-item {\n    padding: 10px 12px;\n    border: 1px solid;\n    border-radius: var(--lumiverse-radius-sm);\n    transition: all var(--lumiverse-transition-fast);\n}\n\n.lumiverse-loom-detail-item:hover {\n    transform: translateY(-1px);\n}\n\n.lumiverse-loom-detail-item-header {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n}\n\n.lumiverse-loom-detail-item-icon {\n    color: var(--lumiverse-text-muted);\n    display: flex;\n    align-items: center;\n}\n\n.lumiverse-loom-detail-item-name {\n    flex: 1;\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-loom-detail-item-toggle {\n    width: 24px;\n    height: 24px;\n    border-radius: 50%;\n    background: var(--lumiverse-bg-dark);\n    border: 1px solid var(--lumiverse-border);\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: all var(--lumiverse-transition-fast);\n}\n\n.lumiverse-loom-detail-item-toggle:hover {\n    background: var(--lumiverse-primary-light);\n    border-color: var(--lumiverse-primary);\n    color: var(--lumiverse-primary);\n}\n\n.lumiverse-loom-detail-item-toggle--selected {\n    background: var(--lumiverse-success);\n    border-color: var(--lumiverse-success);\n    color: white;\n}\n\n.lumiverse-loom-detail-item-toggle--selected:hover {\n    background: var(--lumiverse-danger);\n    border-color: var(--lumiverse-danger);\n}\n\n/* Content preview */\n.lumiverse-loom-detail-content-preview {\n    margin-top: 8px;\n}\n\n.lumiverse-loom-detail-content-toggle {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    padding: 4px 8px;\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text-dim);\n    font-size: 11px;\n    cursor: pointer;\n    transition: color var(--lumiverse-transition-fast);\n}\n\n.lumiverse-loom-detail-content-toggle:hover {\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-loom-detail-content-toggle--open {\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-loom-detail-content-chevron {\n    display: flex;\n    align-items: center;\n}\n\n.lumiverse-loom-detail-content-text {\n    padding: 8px 12px;\n    background: rgba(0, 0, 0, 0.15);\n    border-radius: var(--lumiverse-radius-sm);\n    margin-top: 6px;\n}\n\n.lumiverse-loom-detail-content-text p {\n    margin: 0;\n    font-size: 12px;\n    line-height: 1.5;\n    color: var(--lumiverse-text-muted);\n    white-space: pre-wrap;\n    word-break: break-word;\n}\n\n/* Loom Packs Section in Settings */\n.lumia-loom-packs {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumia-loom-pack-item {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n    padding: 10px 12px;\n    background: var(--lumiverse-bg-dark);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    transition: border-color var(--lumiverse-transition-fast);\n}\n\n.lumia-loom-pack-item:hover {\n    border-color: var(--lumiverse-border-hover);\n}\n\n.lumia-loom-pack-cover {\n    width: 36px;\n    height: 36px;\n    border-radius: var(--lumiverse-radius-sm);\n    object-fit: cover;\n    flex-shrink: 0;\n}\n\n.lumia-loom-pack-cover-placeholder {\n    width: 36px;\n    height: 36px;\n    border-radius: var(--lumiverse-radius-sm);\n    background: var(--lumiverse-bg-darker);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    flex-shrink: 0;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumia-loom-pack-cover-placeholder svg {\n    width: 18px;\n    height: 18px;\n}\n\n.lumia-loom-pack-info {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n    min-width: 0;\n}\n\n.lumia-loom-pack-name {\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumia-loom-pack-stats {\n    display: flex;\n    gap: 10px;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumia-loom-pack-stats span {\n    display: flex;\n    align-items: center;\n    gap: 3px;\n}\n\n/* Loom Pack Actions */\n.lumia-loom-pack-actions {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    flex-shrink: 0;\n}\n\n/* Mobile responsive */\n@media (max-width: 600px) {\n    .lumiverse-pack-detail-modal {\n        /* Override max-width for mobile */\n        max-width: 94vw;\n    }\n\n    .lumiverse-pack-detail-header {\n        padding: 14px 16px;\n    }\n\n    .lumiverse-pack-detail-header-icon {\n        width: 40px;\n        height: 40px;\n    }\n\n    .lumiverse-pack-detail-title {\n        font-size: 16px;\n    }\n\n    .lumiverse-pack-detail-content {\n        padding: 14px 16px;\n    }\n\n    .lumiverse-pack-detail-lumia {\n        padding: 12px;\n    }\n\n    .lumiverse-pack-detail-lumia-avatar {\n        width: 38px;\n        height: 38px;\n    }\n\n    .lumiverse-pack-detail-lumia-name {\n        font-size: 14px;\n    }\n\n    .lumiverse-pack-detail-actions {\n        gap: 6px;\n    }\n\n    .lumiverse-pack-detail-action {\n        padding: 8px 12px;\n        font-size: 13px;\n    }\n}\n`,""]);const m=u},463(e,n){function t(e,n){var t=e.length;e.push(n);e:for(;0<t;){var i=t-1>>>1,a=e[i];if(!(0<r(a,n)))break e;e[i]=n,e[t]=a,t=i}}function i(e){return 0===e.length?null:e[0]}function a(e){if(0===e.length)return null;var n=e[0],t=e.pop();if(t!==n){e[0]=t;e:for(var i=0,a=e.length,o=a>>>1;i<o;){var s=2*(i+1)-1,l=e[s],c=s+1,u=e[c];if(0>r(l,t))c<a&&0>r(u,l)?(e[i]=u,e[c]=t,i=c):(e[i]=l,e[s]=t,i=s);else{if(!(c<a&&0>r(u,t)))break e;e[i]=u,e[c]=t,i=c}}}return n}function r(e,n){var t=e.sortIndex-n.sortIndex;return 0!==t?t:e.id-n.id}if("object"==typeof performance&&"function"==typeof performance.now){var o=performance;n.unstable_now=function(){return o.now()}}else{var s=Date,l=s.now();n.unstable_now=function(){return s.now()-l}}var c=[],u=[],d=1,m=null,p=3,h=!1,v=!1,f=!1,g="function"==typeof setTimeout?setTimeout:null,b="function"==typeof clearTimeout?clearTimeout:null,x="undefined"!=typeof setImmediate?setImmediate:null;function y(e){for(var n=i(u);null!==n;){if(null===n.callback)a(u);else{if(!(n.startTime<=e))break;a(u),n.sortIndex=n.expirationTime,t(c,n)}n=i(u)}}function k(e){if(f=!1,y(e),!v)if(null!==i(c))v=!0,T(w);else{var n=i(u);null!==n&&z(k,n.startTime-e)}}function w(e,t){v=!1,f&&(f=!1,b(N),N=-1),h=!0;var r=p;try{for(y(t),m=i(c);null!==m&&(!(m.expirationTime>t)||e&&!E());){var o=m.callback;if("function"==typeof o){m.callback=null,p=m.priorityLevel;var s=o(m.expirationTime<=t);t=n.unstable_now(),"function"==typeof s?m.callback=s:m===i(c)&&a(c),y(t)}else a(c);m=i(c)}if(null!==m)var l=!0;else{var d=i(u);null!==d&&z(k,d.startTime-t),l=!1}return l}finally{m=null,p=r,h=!1}}"undefined"!=typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var j,S=!1,C=null,N=-1,P=5,M=-1;function E(){return!(n.unstable_now()-M<P)}function L(){if(null!==C){var e=n.unstable_now();M=e;var t=!0;try{t=C(!0,e)}finally{t?j():(S=!1,C=null)}}else S=!1}if("function"==typeof x)j=function(){x(L)};else if("undefined"!=typeof MessageChannel){var D=new MessageChannel,O=D.port2;D.port1.onmessage=L,j=function(){O.postMessage(null)}}else j=function(){g(L,0)};function T(e){C=e,S||(S=!0,j())}function z(e,t){N=g(function(){e(n.unstable_now())},t)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(e){e.callback=null},n.unstable_continueExecution=function(){v||h||(v=!0,T(w))},n.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):P=0<e?Math.floor(1e3/e):5},n.unstable_getCurrentPriorityLevel=function(){return p},n.unstable_getFirstCallbackNode=function(){return i(c)},n.unstable_next=function(e){switch(p){case 1:case 2:case 3:var n=3;break;default:n=p}var t=p;p=n;try{return e()}finally{p=t}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(e,n){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var t=p;p=e;try{return n()}finally{p=t}},n.unstable_scheduleCallback=function(e,a,r){var o=n.unstable_now();switch("object"==typeof r&&null!==r?r="number"==typeof(r=r.delay)&&0<r?o+r:o:r=o,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:d++,callback:a,priorityLevel:e,startTime:r,expirationTime:s=r+s,sortIndex:-1},r>o?(e.sortIndex=r,t(u,e),null===i(c)&&e===i(u)&&(f?(b(N),N=-1):f=!0,z(k,r-o))):(e.sortIndex=s,t(c,e),v||h||(v=!0,T(w))),e},n.unstable_shouldYield=E,n.unstable_wrapCallback=function(e){var n=p;return function(){var t=p;p=n;try{return e.apply(this,arguments)}finally{p=t}}}},485(e,n,t){t.d(n,{E:()=>m,Iv:()=>v,Zq:()=>x,__:()=>f,dj:()=>c,tb:()=>y,x$:()=>h});var i=t(92),a=t(674);const r="loom_last_summarized_at";let o=null,s=null,l=!1;function c(){return l}function u(e){p();const n=document.getElementById("chat");if(!n)return;const t=n.querySelector(".mes:last-child");if(!t)return;const i=t.querySelector(".timestamp");if(!i)return;s=t;const a=document.createElement("span");a.className="loom-summary-indicator",a.id="loom-summary-indicator","loading"===e?(a.innerHTML='<span class="loom-summary-spinner"></span><span>Weaving summary...</span>',i.appendChild(a),o=a):"complete"===e?d(t,"complete"):"error"===e&&d(t,"error")}function d(e,n){if(!e)return;const t=e.querySelector(".timestamp");if(!t)return;const a=t.querySelector(".loom-summary-marker");a&&a.remove();const r=document.createElement("span");r.className="loom-summary-marker",r.setAttribute("data-summary-type",n),"complete"===n?(r.classList.add("loom-summary-marker-complete"),r.innerHTML='<svg class="loom-summary-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <ellipse cx="12" cy="12" rx="8" ry="10" stroke="currentColor" stroke-width="1.5" fill="none"/>\n  <ellipse cx="12" cy="12" rx="3" ry="10" stroke="currentColor" stroke-width="1.5" fill="none"/>\n  <line x1="4" y1="8" x2="20" y2="8" stroke="currentColor" stroke-width="1.5"/>\n  <line x1="4" y1="16" x2="20" y2="16" stroke="currentColor" stroke-width="1.5"/>\n  <circle cx="12" cy="12" r="2" fill="currentColor"/>\n</svg>',r.title="Summary woven up to this message"):"error"===n&&(r.classList.add("loom-summary-marker-error"),r.innerHTML='<svg class="loom-summary-icon loom-summary-icon-error" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="1.5" fill="none"/>\n  <path d="M15 9L9 15M9 9L15 15" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>\n</svg>',r.title="Summary generation failed at this message"),t.appendChild(r);const o=function(e){return(null==e?void 0:e.getAttribute("mesid"))||null}(e);o&&function(e,n){var t;const a=(0,i.SD)();if(null==a||!a.chatMetadata)return;a.chatMetadata.loom_summary_marker={mesId:e,type:n,timestamp:Date.now()},null===(t=a.saveMetadata)||void 0===t||t.call(a)}(o,n)}function m(){var e;const n=(0,i.SD)();if(null==n||null===(e=n.chatMetadata)||void 0===e||!e.loom_summary_marker)return;const t=n.chatMetadata.loom_summary_marker;if(!t.mesId)return;const a=(r=t.mesId)?document.querySelector('.mes[mesid="'.concat(r,'"]')):null;var r;a&&d(a,t.type)}function p(){o&&(o.remove(),o=null);const e=document.getElementById("loom-summary-indicator");e&&e.remove()}const h={openai:{name:"OpenAI",endpoint:"https://api.openai.com/v1/chat/completions",secretKey:"api_key_openai",placeholder:"gpt-4o-mini",format:"openai"},anthropic:{name:"Anthropic Claude",endpoint:"https://api.anthropic.com/v1/messages",secretKey:"api_key_claude",placeholder:"claude-sonnet-4-5-20250929",format:"anthropic"},openrouter:{name:"OpenRouter",endpoint:"https://openrouter.ai/api/v1/chat/completions",secretKey:"api_key_openrouter",placeholder:"openai/gpt-4o-mini",format:"openai"},google:{name:"Google AI Studio",endpoint:"https://generativelanguage.googleapis.com/v1beta/models",secretKey:"api_key_makersuite",placeholder:"gemini-2.0-flash",format:"google"},chutes:{name:"Chutes",endpoint:"https://llm.chutes.ai/v1/chat/completions",secretKey:"api_key_chutes",placeholder:"deepseek-ai/DeepSeek-V3",format:"openai"},electronhub:{name:"ElectronHub",endpoint:"https://api.electronhub.ai/v1/chat/completions",secretKey:"api_key_electronhub",placeholder:"gpt-4o-mini",format:"openai"},nanogpt:{name:"NanoGPT",endpoint:"https://nano-gpt.com/api/v1/chat/completions",secretKey:"api_key_nanogpt",placeholder:"chatgpt-4o-latest",format:"openai"},zai:{name:"Z.AI",endpoint:"https://api.z.ai/api/paas/v4/chat/completions",secretKey:"api_key_zai",placeholder:"gpt-4o-mini",format:"openai"},custom:{name:"Custom (OpenAI Compatible)",endpoint:"",secretKey:null,placeholder:"your-model-id",format:"openai"}};function v(e){return h[e]||h.custom}function f(e){const n=v(e);return{endpoint:n.endpoint,placeholder:n.placeholder}}function g(e){var n;const t=(0,i.SD)();if(!t||!t.chat)return null;const r=t.chat.slice(-e);if(0===r.length)return null;const o=(null===(n=t.chatMetadata)||void 0===n?void 0:n[a.zA])||"";let s="";r.forEach(e=>{const n=e.is_user?e.name||"User":e.name||"Character";let t=e.mes||e.content||"";t=t.replace(/<loom_sum>[\s\S]*?<\/loom_sum>/gi,"").trim(),t&&(s+="".concat(n,": ").concat(t,"\n\n"))});return{systemPrompt:"You are a Lucid Loom narrative archivist for interactive fiction and roleplay. Your task is to weave comprehensive story summaries that maintain narrative continuity while capturing the essence of the tale.\n\nYour summary MUST use this exact structured format with clear headers:\n\n**Completed Objectives**\nStory beats and arcs that have already concluded. Plot points resolved, conflicts addressed, milestones reached.\n\n**Focused Objectives**\nActive story threads requiring attention. These can shift or be deviated from at any time but represent current narrative focus.\n\n**Foreshadowing Beats**\nEvents hinted at or seeded in recent story beats. Potential future complications, promises made, warnings given.\n\n**Character Developments**\nTrack meaningful changes in personality, beliefs, skills, or emotional state for each character (NEVER the {{user}}).\n\n**Memorable Actions**\nPhysical actions of significanceâ€”combat moves, gestures, gifts exchanged, locations visited. Details that may matter later.\n\n**Memorable Dialogues**\nWords that left a mark. Confessions, promises, threats, revelations, or simply beautiful turns of phrase.\n\n**Relationships**\nTrack evolving dynamics between characters and between characters and {{user}}. Trust, tension, affection, rivalry. (NEVER track {{user}}'s internal stateâ€”only how characters perceive or relate to them.)\n\nCRITICAL GUIDELINES:\n- Use bullet points under each header for clarityâ€”avoid walls of text\n- Be precise and detailed, never sacrifice important information\n- Be concise, never pad with redundant or obvious observations\n- If a category has no relevant content, write \"None at present\" rather than inventing filler\n- NEVER track or summarize {{user}}'s thoughts, feelings, or internal state",userPrompt:"".concat(o?"Previous Loom Summary to build upon:\n".concat(o,"\n\n---\n\n"):"","Recent story events to weave into the summary:\n\n").concat(s,"\n\nProvide an updated Loom Summary incorporating these new events. Use the exact structured format with all seven headers. Output ONLY the summary contentâ€”no meta-commentary or additional formatting.")}}async function b(e,n){const t=e.secondary||{},r=t.provider||"openai",o=t.model,s=t.temperature||.7,l=void 0!==t.topP?t.topP:1,c=t.maxTokens||8192;if(!o)throw new Error("No model specified for secondary LLM");const u=v(r);let d;if("custom"===r){if(d=t.apiKey,!d)throw new Error("No API key specified for custom provider")}else if(d=await async function(e){if(!e)return null;try{const n=await fetch("/api/secrets/find",{method:"POST",headers:(0,i.oO)(),body:JSON.stringify({key:e})});return n.ok?(await n.json()).value||null:(console.warn("[".concat(a.pW,"] Could not fetch secret key: ").concat(e," (status: ").concat(n.status,")")),null)}catch(e){return console.error("[".concat(a.pW,"] Error fetching secret key:"),e),null}}(u.secretKey),!d)throw new Error("No API key found for ".concat(u.name,". Please add your API key in SillyTavern's API settings."));const m=g(n);if(!m)throw new Error("No chat messages to summarize");const p="custom"===r?t.endpoint:u.endpoint;if(!p)throw new Error("No endpoint specified for secondary LLM");let h;if(console.log("[".concat(a.pW,"] Generating summary with ").concat(u.name,"...")),"anthropic"===u.format){const e=(0,a.mt)(),n=(0,a.X7)(),t={model:o,max_tokens:c,system:e.disableAnthropicCache?[{type:"text",text:m.systemPrompt,cache_control:{type:"ephemeral"}}]:m.systemPrompt,messages:[{role:"user",content:m.userPrompt}],temperature:s,metadata:{lumia_config_version:String(n)}};l>0&&l<1&&(t.top_p=l);const i={"Content-Type":"application/json","x-api-key":d,"anthropic-version":"2023-06-01"};if(e.disableAnthropicCache&&(i["anthropic-beta"]="prompt-caching-2024-07-31",console.log("[".concat(a.pW,"] Cache busting enabled for this request (Lumia config v").concat(n,")"))),h=await fetch(p,{method:"POST",headers:i,body:JSON.stringify(t)}),!h.ok){const e=await h.text().catch(()=>"Unable to read error");throw new Error("Anthropic API error: ".concat(h.status," - ").concat(e))}const r=await h.json();if(r.content&&Array.isArray(r.content)){const e=r.content.find(e=>"text"===e.type);return(null==e?void 0:e.text)||""}return""}if("google"===u.format){var f;const e="".concat(p,"/").concat(o,":generateContent"),n={safetySettings:[{category:"HARM_CATEGORY_HARASSMENT",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_HATE_SPEECH",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_SEXUALLY_EXPLICIT",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_DANGEROUS_CONTENT",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_CIVIC_INTEGRITY",threshold:"BLOCK_NONE"}],contents:[{role:"user",parts:[{text:"".concat(m.systemPrompt,"\n\n---\n\n").concat(m.userPrompt)}]}],generationConfig:{temperature:s,maxOutputTokens:c}};if(l>0&&l<1&&(n.generationConfig.topP=l),h=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json","x-goog-api-key":d},body:JSON.stringify(n)}),!h.ok){const e=await h.text().catch(()=>"Unable to read error");throw new Error("Google AI Studio API error: ".concat(h.status," - ").concat(e))}const t=await h.json();return null!==(f=t.candidates)&&void 0!==f&&null!==(f=f[0])&&void 0!==f&&null!==(f=f.content)&&void 0!==f&&null!==(f=f.parts)&&void 0!==f&&null!==(f=f[0])&&void 0!==f&&f.text?t.candidates[0].content.parts[0].text:""}{var b;const e={"Content-Type":"application/json",Authorization:"Bearer ".concat(d)};"openrouter"===r&&(e["HTTP-Referer"]=window.location.origin,e["X-Title"]="Lumia Injector");const n={model:o,messages:[{role:"system",content:m.systemPrompt},{role:"user",content:m.userPrompt}],temperature:s,max_tokens:c};if(l>0&&l<1&&(n.top_p=l),h=await fetch(p,{method:"POST",headers:e,body:JSON.stringify(n)}),!h.ok){const e=await h.text().catch(()=>"Unable to read error");throw new Error("".concat(u.name," API error: ").concat(h.status," - ").concat(e))}const t=await h.json();return null!==(b=t.choices)&&void 0!==b&&null!==(b=b[0])&&void 0!==b&&null!==(b=b.message)&&void 0!==b&&b.content?t.choices[0].message.content:""}}async function x(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const o=(0,a.mt)(),s=e||o.summarization;if(!s)return console.log("[".concat(a.pW,"] Summarization not configured")),null;const l=(0,i.SD)();if(!l||!l.chat||0===l.chat.length)return console.log("[".concat(a.pW,"] No chat to summarize")),null;const c=n?s.manualMessageContext||10:s.autoMessageContext||10;console.log("[".concat(a.pW,"] Using ").concat(n?"manual":"auto"," message context: ").concat(c," messages")),t&&u("loading");try{let e;if("main"===s.apiSource)e=await async function(e,n){const{generateRaw:t}=(0,i.SD)();if(!t)throw new Error("generateRaw not available - is SillyTavern properly loaded?");const r=g(n);if(!r)throw new Error("No chat messages to summarize");return console.log("[".concat(a.pW,"] Generating summary with Main API...")),await t({systemPrompt:r.systemPrompt,prompt:r.userPrompt,prefill:""})}(0,c);else{if("secondary"!==s.apiSource)throw t&&u("error","Invalid API source"),new Error("Unknown API source: ".concat(s.apiSource));e=await b(s,c)}return e&&e.trim()?(l.chatMetadata[a.zA]=e.trim(),function(e){const n=(0,i.SD)();null!=n&&n.chatMetadata&&(n.chatMetadata[r]={messageCount:e,timestamp:Date.now()})}(l.chat.length),await l.saveMetadata(),console.log("[".concat(a.pW,"] Summary saved to chat metadata at message ").concat(l.chat.length)),t&&u("complete"),e.trim()):(t&&p(),null)}catch(e){throw console.error("[".concat(a.pW,"] Summary generation failed:"),e),t&&u("error"),e}}function y(){if(l)return;const e=(0,a.mt)().summarization;if(!e||"auto"!==e.mode)return;const n=(0,i.SD)();if(!n||!n.chat)return;const o=e.autoInterval||10,s=n.chat.length,c=function(){var e;const n=(0,i.SD)();return null!=n&&null!==(e=n.chatMetadata)&&void 0!==e&&e[r]&&n.chatMetadata[r].messageCount||0}(),u=s-c;s>=o&&u>=o&&(console.log("[".concat(a.pW,"] Auto-summarization triggered: ").concat(u," messages since last summary (at ").concat(c,"), current count: ").concat(s)),l=!0,Promise.resolve().then(t.bind(t,932)).then(e=>{let{updateLoomSummaryButtonState:n}=e;n()}).catch(()=>{}),x(null,!1,!0).then(e=>{l=!1,Promise.resolve().then(t.bind(t,932)).then(e=>{let{updateLoomSummaryButtonState:n}=e;n()}).catch(()=>{}),e&&toastr.info("Loom summary updated automatically")}).catch(e=>{l=!1,Promise.resolve().then(t.bind(t,932)).then(e=>{let{updateLoomSummaryButtonState:n}=e;n()}).catch(()=>{}),console.error("[".concat(a.pW,"] Auto-summarization failed:"),e)}))}},540(e,n,t){e.exports=t(287)},551(e,n,t){var i=t(540),a=t(982);function r(e){for(var n="https://reactjs.org/docs/error-decoder.html?invariant="+e,t=1;t<arguments.length;t++)n+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+e+"; visit "+n+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,s={};function l(e,n){c(e,n),c(e+"Capture",n)}function c(e,n){for(s[e]=n,e=0;e<n.length;e++)o.add(n[e])}var u=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),d=Object.prototype.hasOwnProperty,m=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},h={};function v(e,n,t,i,a,r,o){this.acceptsBooleans=2===n||3===n||4===n,this.attributeName=i,this.attributeNamespace=a,this.mustUseProperty=t,this.propertyName=e,this.type=n,this.sanitizeURL=r,this.removeEmptyString=o}var f={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){f[e]=new v(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var n=e[0];f[n]=new v(n,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){f[e]=new v(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){f[e]=new v(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){f[e]=new v(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){f[e]=new v(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){f[e]=new v(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){f[e]=new v(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){f[e]=new v(e,5,!1,e.toLowerCase(),null,!1,!1)});var g=/[\-:]([a-z])/g;function b(e){return e[1].toUpperCase()}function x(e,n,t,i){var a=f.hasOwnProperty(n)?f[n]:null;(null!==a?0!==a.type:i||!(2<n.length)||"o"!==n[0]&&"O"!==n[0]||"n"!==n[1]&&"N"!==n[1])&&(function(e,n,t,i){if(null==n||function(e,n,t,i){if(null!==t&&0===t.type)return!1;switch(typeof n){case"function":case"symbol":return!0;case"boolean":return!i&&(null!==t?!t.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,n,t,i))return!0;if(i)return!1;if(null!==t)switch(t.type){case 3:return!n;case 4:return!1===n;case 5:return isNaN(n);case 6:return isNaN(n)||1>n}return!1}(n,t,a,i)&&(t=null),i||null===a?function(e){return!!d.call(h,e)||!d.call(p,e)&&(m.test(e)?h[e]=!0:(p[e]=!0,!1))}(n)&&(null===t?e.removeAttribute(n):e.setAttribute(n,""+t)):a.mustUseProperty?e[a.propertyName]=null===t?3!==a.type&&"":t:(n=a.attributeName,i=a.attributeNamespace,null===t?e.removeAttribute(n):(t=3===(a=a.type)||4===a&&!0===t?"":""+t,i?e.setAttributeNS(i,n,t):e.setAttribute(n,t))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var n=e.replace(g,b);f[n]=new v(n,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var n=e.replace(g,b);f[n]=new v(n,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var n=e.replace(g,b);f[n]=new v(n,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){f[e]=new v(e,1,!1,e.toLowerCase(),null,!1,!1)}),f.xlinkHref=new v("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){f[e]=new v(e,1,!1,e.toLowerCase(),null,!0,!0)});var y=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,k=Symbol.for("react.element"),w=Symbol.for("react.portal"),j=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),C=Symbol.for("react.profiler"),N=Symbol.for("react.provider"),P=Symbol.for("react.context"),M=Symbol.for("react.forward_ref"),E=Symbol.for("react.suspense"),L=Symbol.for("react.suspense_list"),D=Symbol.for("react.memo"),O=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var T=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var z=Symbol.iterator;function A(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=z&&e[z]||e["@@iterator"])?e:null}var I,R=Object.assign;function B(e){if(void 0===I)try{throw Error()}catch(e){var n=e.stack.trim().match(/\n( *(at )?)/);I=n&&n[1]||""}return"\n"+I+e}var _=!1;function F(e,n){if(!e||_)return"";_=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(n)if(n=function(){throw Error()},Object.defineProperty(n.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(n,[])}catch(e){var i=e}Reflect.construct(e,[],n)}else{try{n.call()}catch(e){i=e}e.call(n.prototype)}else{try{throw Error()}catch(e){i=e}e()}}catch(n){if(n&&i&&"string"==typeof n.stack){for(var a=n.stack.split("\n"),r=i.stack.split("\n"),o=a.length-1,s=r.length-1;1<=o&&0<=s&&a[o]!==r[s];)s--;for(;1<=o&&0<=s;o--,s--)if(a[o]!==r[s]){if(1!==o||1!==s)do{if(o--,0>--s||a[o]!==r[s]){var l="\n"+a[o].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=o&&0<=s);break}}}finally{_=!1,Error.prepareStackTrace=t}return(e=e?e.displayName||e.name:"")?B(e):""}function U(e){switch(e.tag){case 5:return B(e.type);case 16:return B("Lazy");case 13:return B("Suspense");case 19:return B("SuspenseList");case 0:case 2:case 15:return e=F(e.type,!1);case 11:return e=F(e.type.render,!1);case 1:return e=F(e.type,!0);default:return""}}function V(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case j:return"Fragment";case w:return"Portal";case C:return"Profiler";case S:return"StrictMode";case E:return"Suspense";case L:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case P:return(e.displayName||"Context")+".Consumer";case N:return(e._context.displayName||"Context")+".Provider";case M:var n=e.render;return(e=e.displayName)||(e=""!==(e=n.displayName||n.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case D:return null!==(n=e.displayName||null)?n:V(e.type)||"Memo";case O:n=e._payload,e=e._init;try{return V(e(n))}catch(e){}}return null}function H(e){var n=e.type;switch(e.tag){case 24:return"Cache";case 9:return(n.displayName||"Context")+".Consumer";case 10:return(n._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=n.render).displayName||e.name||"",n.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return n;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return V(n);case 8:return n===S?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"==typeof n)return n.displayName||n.name||null;if("string"==typeof n)return n}return null}function W(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function $(e){var n=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===n||"radio"===n)}function q(e){e._valueTracker||(e._valueTracker=function(e){var n=$(e)?"checked":"value",t=Object.getOwnPropertyDescriptor(e.constructor.prototype,n),i=""+e[n];if(!e.hasOwnProperty(n)&&void 0!==t&&"function"==typeof t.get&&"function"==typeof t.set){var a=t.get,r=t.set;return Object.defineProperty(e,n,{configurable:!0,get:function(){return a.call(this)},set:function(e){i=""+e,r.call(this,e)}}),Object.defineProperty(e,n,{enumerable:t.enumerable}),{getValue:function(){return i},setValue:function(e){i=""+e},stopTracking:function(){e._valueTracker=null,delete e[n]}}}}(e))}function Y(e){if(!e)return!1;var n=e._valueTracker;if(!n)return!0;var t=n.getValue(),i="";return e&&(i=$(e)?e.checked?"true":"false":e.value),(e=i)!==t&&(n.setValue(e),!0)}function K(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(n){return e.body}}function G(e,n){var t=n.checked;return R({},n,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=t?t:e._wrapperState.initialChecked})}function Q(e,n){var t=null==n.defaultValue?"":n.defaultValue,i=null!=n.checked?n.checked:n.defaultChecked;t=W(null!=n.value?n.value:t),e._wrapperState={initialChecked:i,initialValue:t,controlled:"checkbox"===n.type||"radio"===n.type?null!=n.checked:null!=n.value}}function Z(e,n){null!=(n=n.checked)&&x(e,"checked",n,!1)}function X(e,n){Z(e,n);var t=W(n.value),i=n.type;if(null!=t)"number"===i?(0===t&&""===e.value||e.value!=t)&&(e.value=""+t):e.value!==""+t&&(e.value=""+t);else if("submit"===i||"reset"===i)return void e.removeAttribute("value");n.hasOwnProperty("value")?ee(e,n.type,t):n.hasOwnProperty("defaultValue")&&ee(e,n.type,W(n.defaultValue)),null==n.checked&&null!=n.defaultChecked&&(e.defaultChecked=!!n.defaultChecked)}function J(e,n,t){if(n.hasOwnProperty("value")||n.hasOwnProperty("defaultValue")){var i=n.type;if(!("submit"!==i&&"reset"!==i||void 0!==n.value&&null!==n.value))return;n=""+e._wrapperState.initialValue,t||n===e.value||(e.value=n),e.defaultValue=n}""!==(t=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==t&&(e.name=t)}function ee(e,n,t){"number"===n&&K(e.ownerDocument)===e||(null==t?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+t&&(e.defaultValue=""+t))}var ne=Array.isArray;function te(e,n,t,i){if(e=e.options,n){n={};for(var a=0;a<t.length;a++)n["$"+t[a]]=!0;for(t=0;t<e.length;t++)a=n.hasOwnProperty("$"+e[t].value),e[t].selected!==a&&(e[t].selected=a),a&&i&&(e[t].defaultSelected=!0)}else{for(t=""+W(t),n=null,a=0;a<e.length;a++){if(e[a].value===t)return e[a].selected=!0,void(i&&(e[a].defaultSelected=!0));null!==n||e[a].disabled||(n=e[a])}null!==n&&(n.selected=!0)}}function ie(e,n){if(null!=n.dangerouslySetInnerHTML)throw Error(r(91));return R({},n,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ae(e,n){var t=n.value;if(null==t){if(t=n.children,n=n.defaultValue,null!=t){if(null!=n)throw Error(r(92));if(ne(t)){if(1<t.length)throw Error(r(93));t=t[0]}n=t}null==n&&(n=""),t=n}e._wrapperState={initialValue:W(t)}}function re(e,n){var t=W(n.value),i=W(n.defaultValue);null!=t&&((t=""+t)!==e.value&&(e.value=t),null==n.defaultValue&&e.defaultValue!==t&&(e.defaultValue=t)),null!=i&&(e.defaultValue=""+i)}function oe(e){var n=e.textContent;n===e._wrapperState.initialValue&&""!==n&&null!==n&&(e.value=n)}function se(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function le(e,n){return null==e||"http://www.w3.org/1999/xhtml"===e?se(n):"http://www.w3.org/2000/svg"===e&&"foreignObject"===n?"http://www.w3.org/1999/xhtml":e}var ce,ue,de=(ue=function(e,n){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=n;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+n.valueOf().toString()+"</svg>",n=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;n.firstChild;)e.appendChild(n.firstChild)}},"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,n,t,i){MSApp.execUnsafeLocalFunction(function(){return ue(e,n)})}:ue);function me(e,n){if(n){var t=e.firstChild;if(t&&t===e.lastChild&&3===t.nodeType)return void(t.nodeValue=n)}e.textContent=n}var pe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},he=["Webkit","ms","Moz","O"];function ve(e,n,t){return null==n||"boolean"==typeof n||""===n?"":t||"number"!=typeof n||0===n||pe.hasOwnProperty(e)&&pe[e]?(""+n).trim():n+"px"}function fe(e,n){for(var t in e=e.style,n)if(n.hasOwnProperty(t)){var i=0===t.indexOf("--"),a=ve(t,n[t],i);"float"===t&&(t="cssFloat"),i?e.setProperty(t,a):e[t]=a}}Object.keys(pe).forEach(function(e){he.forEach(function(n){n=n+e.charAt(0).toUpperCase()+e.substring(1),pe[n]=pe[e]})});var ge=R({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function be(e,n){if(n){if(ge[e]&&(null!=n.children||null!=n.dangerouslySetInnerHTML))throw Error(r(137,e));if(null!=n.dangerouslySetInnerHTML){if(null!=n.children)throw Error(r(60));if("object"!=typeof n.dangerouslySetInnerHTML||!("__html"in n.dangerouslySetInnerHTML))throw Error(r(61))}if(null!=n.style&&"object"!=typeof n.style)throw Error(r(62))}}function xe(e,n){if(-1===e.indexOf("-"))return"string"==typeof n.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ye=null;function ke(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var we=null,je=null,Se=null;function Ce(e){if(e=xa(e)){if("function"!=typeof we)throw Error(r(280));var n=e.stateNode;n&&(n=ka(n),we(e.stateNode,e.type,n))}}function Ne(e){je?Se?Se.push(e):Se=[e]:je=e}function Pe(){if(je){var e=je,n=Se;if(Se=je=null,Ce(e),n)for(e=0;e<n.length;e++)Ce(n[e])}}function Me(e,n){return e(n)}function Ee(){}var Le=!1;function De(e,n,t){if(Le)return e(n,t);Le=!0;try{return Me(e,n,t)}finally{Le=!1,(null!==je||null!==Se)&&(Ee(),Pe())}}function Oe(e,n){var t=e.stateNode;if(null===t)return null;var i=ka(t);if(null===i)return null;t=i[n];e:switch(n){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(i=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!i;break e;default:e=!1}if(e)return null;if(t&&"function"!=typeof t)throw Error(r(231,n,typeof t));return t}var Te=!1;if(u)try{var ze={};Object.defineProperty(ze,"passive",{get:function(){Te=!0}}),window.addEventListener("test",ze,ze),window.removeEventListener("test",ze,ze)}catch(ue){Te=!1}function Ae(e,n,t,i,a,r,o,s,l){var c=Array.prototype.slice.call(arguments,3);try{n.apply(t,c)}catch(e){this.onError(e)}}var Ie=!1,Re=null,Be=!1,_e=null,Fe={onError:function(e){Ie=!0,Re=e}};function Ue(e,n,t,i,a,r,o,s,l){Ie=!1,Re=null,Ae.apply(Fe,arguments)}function Ve(e){var n=e,t=e;if(e.alternate)for(;n.return;)n=n.return;else{e=n;do{!!(4098&(n=e).flags)&&(t=n.return),e=n.return}while(e)}return 3===n.tag?t:null}function He(e){if(13===e.tag){var n=e.memoizedState;if(null===n&&(null!==(e=e.alternate)&&(n=e.memoizedState)),null!==n)return n.dehydrated}return null}function We(e){if(Ve(e)!==e)throw Error(r(188))}function $e(e){return null!==(e=function(e){var n=e.alternate;if(!n){if(null===(n=Ve(e)))throw Error(r(188));return n!==e?null:e}for(var t=e,i=n;;){var a=t.return;if(null===a)break;var o=a.alternate;if(null===o){if(null!==(i=a.return)){t=i;continue}break}if(a.child===o.child){for(o=a.child;o;){if(o===t)return We(a),e;if(o===i)return We(a),n;o=o.sibling}throw Error(r(188))}if(t.return!==i.return)t=a,i=o;else{for(var s=!1,l=a.child;l;){if(l===t){s=!0,t=a,i=o;break}if(l===i){s=!0,i=a,t=o;break}l=l.sibling}if(!s){for(l=o.child;l;){if(l===t){s=!0,t=o,i=a;break}if(l===i){s=!0,i=o,t=a;break}l=l.sibling}if(!s)throw Error(r(189))}}if(t.alternate!==i)throw Error(r(190))}if(3!==t.tag)throw Error(r(188));return t.stateNode.current===t?e:n}(e))?qe(e):null}function qe(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var n=qe(e);if(null!==n)return n;e=e.sibling}return null}var Ye=a.unstable_scheduleCallback,Ke=a.unstable_cancelCallback,Ge=a.unstable_shouldYield,Qe=a.unstable_requestPaint,Ze=a.unstable_now,Xe=a.unstable_getCurrentPriorityLevel,Je=a.unstable_ImmediatePriority,en=a.unstable_UserBlockingPriority,nn=a.unstable_NormalPriority,tn=a.unstable_LowPriority,an=a.unstable_IdlePriority,rn=null,on=null;var sn=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(ln(e)/cn|0)|0},ln=Math.log,cn=Math.LN2;var un=64,dn=4194304;function mn(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function pn(e,n){var t=e.pendingLanes;if(0===t)return 0;var i=0,a=e.suspendedLanes,r=e.pingedLanes,o=268435455&t;if(0!==o){var s=o&~a;0!==s?i=mn(s):0!==(r&=o)&&(i=mn(r))}else 0!==(o=t&~a)?i=mn(o):0!==r&&(i=mn(r));if(0===i)return 0;if(0!==n&&n!==i&&0===(n&a)&&((a=i&-i)>=(r=n&-n)||16===a&&4194240&r))return n;if(4&i&&(i|=16&t),0!==(n=e.entangledLanes))for(e=e.entanglements,n&=i;0<n;)a=1<<(t=31-sn(n)),i|=e[t],n&=~a;return i}function hn(e,n){switch(e){case 1:case 2:case 4:return n+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n+5e3;default:return-1}}function vn(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function fn(){var e=un;return!(4194240&(un<<=1))&&(un=64),e}function gn(e){for(var n=[],t=0;31>t;t++)n.push(e);return n}function bn(e,n,t){e.pendingLanes|=n,536870912!==n&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[n=31-sn(n)]=t}function xn(e,n){var t=e.entangledLanes|=n;for(e=e.entanglements;t;){var i=31-sn(t),a=1<<i;a&n|e[i]&n&&(e[i]|=n),t&=~a}}var yn=0;function kn(e){return 1<(e&=-e)?4<e?268435455&e?16:536870912:4:1}var wn,jn,Sn,Cn,Nn,Pn=!1,Mn=[],En=null,Ln=null,Dn=null,On=new Map,Tn=new Map,zn=[],An="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function In(e,n){switch(e){case"focusin":case"focusout":En=null;break;case"dragenter":case"dragleave":Ln=null;break;case"mouseover":case"mouseout":Dn=null;break;case"pointerover":case"pointerout":On.delete(n.pointerId);break;case"gotpointercapture":case"lostpointercapture":Tn.delete(n.pointerId)}}function Rn(e,n,t,i,a,r){return null===e||e.nativeEvent!==r?(e={blockedOn:n,domEventName:t,eventSystemFlags:i,nativeEvent:r,targetContainers:[a]},null!==n&&(null!==(n=xa(n))&&jn(n)),e):(e.eventSystemFlags|=i,n=e.targetContainers,null!==a&&-1===n.indexOf(a)&&n.push(a),e)}function Bn(e){var n=ba(e.target);if(null!==n){var t=Ve(n);if(null!==t)if(13===(n=t.tag)){if(null!==(n=He(t)))return e.blockedOn=n,void Nn(e.priority,function(){Sn(t)})}else if(3===n&&t.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===t.tag?t.stateNode.containerInfo:null)}e.blockedOn=null}function _n(e){if(null!==e.blockedOn)return!1;for(var n=e.targetContainers;0<n.length;){var t=Qn(e.domEventName,e.eventSystemFlags,n[0],e.nativeEvent);if(null!==t)return null!==(n=xa(t))&&jn(n),e.blockedOn=t,!1;var i=new(t=e.nativeEvent).constructor(t.type,t);ye=i,t.target.dispatchEvent(i),ye=null,n.shift()}return!0}function Fn(e,n,t){_n(e)&&t.delete(n)}function Un(){Pn=!1,null!==En&&_n(En)&&(En=null),null!==Ln&&_n(Ln)&&(Ln=null),null!==Dn&&_n(Dn)&&(Dn=null),On.forEach(Fn),Tn.forEach(Fn)}function Vn(e,n){e.blockedOn===n&&(e.blockedOn=null,Pn||(Pn=!0,a.unstable_scheduleCallback(a.unstable_NormalPriority,Un)))}function Hn(e){function n(n){return Vn(n,e)}if(0<Mn.length){Vn(Mn[0],e);for(var t=1;t<Mn.length;t++){var i=Mn[t];i.blockedOn===e&&(i.blockedOn=null)}}for(null!==En&&Vn(En,e),null!==Ln&&Vn(Ln,e),null!==Dn&&Vn(Dn,e),On.forEach(n),Tn.forEach(n),t=0;t<zn.length;t++)(i=zn[t]).blockedOn===e&&(i.blockedOn=null);for(;0<zn.length&&null===(t=zn[0]).blockedOn;)Bn(t),null===t.blockedOn&&zn.shift()}var Wn=y.ReactCurrentBatchConfig,$n=!0;function qn(e,n,t,i){var a=yn,r=Wn.transition;Wn.transition=null;try{yn=1,Kn(e,n,t,i)}finally{yn=a,Wn.transition=r}}function Yn(e,n,t,i){var a=yn,r=Wn.transition;Wn.transition=null;try{yn=4,Kn(e,n,t,i)}finally{yn=a,Wn.transition=r}}function Kn(e,n,t,i){if($n){var a=Qn(e,n,t,i);if(null===a)Wi(e,n,i,Gn,t),In(e,i);else if(function(e,n,t,i,a){switch(n){case"focusin":return En=Rn(En,e,n,t,i,a),!0;case"dragenter":return Ln=Rn(Ln,e,n,t,i,a),!0;case"mouseover":return Dn=Rn(Dn,e,n,t,i,a),!0;case"pointerover":var r=a.pointerId;return On.set(r,Rn(On.get(r)||null,e,n,t,i,a)),!0;case"gotpointercapture":return r=a.pointerId,Tn.set(r,Rn(Tn.get(r)||null,e,n,t,i,a)),!0}return!1}(a,e,n,t,i))i.stopPropagation();else if(In(e,i),4&n&&-1<An.indexOf(e)){for(;null!==a;){var r=xa(a);if(null!==r&&wn(r),null===(r=Qn(e,n,t,i))&&Wi(e,n,i,Gn,t),r===a)break;a=r}null!==a&&i.stopPropagation()}else Wi(e,n,i,null,t)}}var Gn=null;function Qn(e,n,t,i){if(Gn=null,null!==(e=ba(e=ke(i))))if(null===(n=Ve(e)))e=null;else if(13===(t=n.tag)){if(null!==(e=He(n)))return e;e=null}else if(3===t){if(n.stateNode.current.memoizedState.isDehydrated)return 3===n.tag?n.stateNode.containerInfo:null;e=null}else n!==e&&(e=null);return Gn=e,null}function Zn(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Xe()){case Je:return 1;case en:return 4;case nn:case tn:return 16;case an:return 536870912;default:return 16}default:return 16}}var Xn=null,Jn=null,et=null;function nt(){if(et)return et;var e,n,t=Jn,i=t.length,a="value"in Xn?Xn.value:Xn.textContent,r=a.length;for(e=0;e<i&&t[e]===a[e];e++);var o=i-e;for(n=1;n<=o&&t[i-n]===a[r-n];n++);return et=a.slice(e,1<n?1-n:void 0)}function tt(e){var n=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===n&&(e=13):e=n,10===e&&(e=13),32<=e||13===e?e:0}function it(){return!0}function at(){return!1}function rt(e){function n(n,t,i,a,r){for(var o in this._reactName=n,this._targetInst=i,this.type=t,this.nativeEvent=a,this.target=r,this.currentTarget=null,e)e.hasOwnProperty(o)&&(n=e[o],this[o]=n?n(a):a[o]);return this.isDefaultPrevented=(null!=a.defaultPrevented?a.defaultPrevented:!1===a.returnValue)?it:at,this.isPropagationStopped=at,this}return R(n.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=it)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=it)},persist:function(){},isPersistent:it}),n}var ot,st,lt,ct={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ut=rt(ct),dt=R({},ct,{view:0,detail:0}),mt=rt(dt),pt=R({},dt,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ct,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==lt&&(lt&&"mousemove"===e.type?(ot=e.screenX-lt.screenX,st=e.screenY-lt.screenY):st=ot=0,lt=e),ot)},movementY:function(e){return"movementY"in e?e.movementY:st}}),ht=rt(pt),vt=rt(R({},pt,{dataTransfer:0})),ft=rt(R({},dt,{relatedTarget:0})),gt=rt(R({},ct,{animationName:0,elapsedTime:0,pseudoElement:0})),bt=R({},ct,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),xt=rt(bt),yt=rt(R({},ct,{data:0})),kt={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},wt={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},jt={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function St(e){var n=this.nativeEvent;return n.getModifierState?n.getModifierState(e):!!(e=jt[e])&&!!n[e]}function Ct(){return St}var Nt=R({},dt,{key:function(e){if(e.key){var n=kt[e.key]||e.key;if("Unidentified"!==n)return n}return"keypress"===e.type?13===(e=tt(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?wt[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ct,charCode:function(e){return"keypress"===e.type?tt(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tt(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Pt=rt(Nt),Mt=rt(R({},pt,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Et=rt(R({},dt,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ct})),Lt=rt(R({},ct,{propertyName:0,elapsedTime:0,pseudoElement:0})),Dt=R({},pt,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Ot=rt(Dt),Tt=[9,13,27,32],zt=u&&"CompositionEvent"in window,At=null;u&&"documentMode"in document&&(At=document.documentMode);var It=u&&"TextEvent"in window&&!At,Rt=u&&(!zt||At&&8<At&&11>=At),Bt=String.fromCharCode(32),_t=!1;function Ft(e,n){switch(e){case"keyup":return-1!==Tt.indexOf(n.keyCode);case"keydown":return 229!==n.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ut(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var Vt=!1;var Ht={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Wt(e){var n=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===n?!!Ht[e.type]:"textarea"===n}function $t(e,n,t,i){Ne(i),0<(n=qi(n,"onChange")).length&&(t=new ut("onChange","change",null,t,i),e.push({event:t,listeners:n}))}var qt=null,Yt=null;function Kt(e){Bi(e,0)}function Gt(e){if(Y(ya(e)))return e}function Qt(e,n){if("change"===e)return n}var Zt=!1;if(u){var Xt;if(u){var Jt="oninput"in document;if(!Jt){var ei=document.createElement("div");ei.setAttribute("oninput","return;"),Jt="function"==typeof ei.oninput}Xt=Jt}else Xt=!1;Zt=Xt&&(!document.documentMode||9<document.documentMode)}function ni(){qt&&(qt.detachEvent("onpropertychange",ti),Yt=qt=null)}function ti(e){if("value"===e.propertyName&&Gt(Yt)){var n=[];$t(n,Yt,e,ke(e)),De(Kt,n)}}function ii(e,n,t){"focusin"===e?(ni(),Yt=t,(qt=n).attachEvent("onpropertychange",ti)):"focusout"===e&&ni()}function ai(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Gt(Yt)}function ri(e,n){if("click"===e)return Gt(n)}function oi(e,n){if("input"===e||"change"===e)return Gt(n)}var si="function"==typeof Object.is?Object.is:function(e,n){return e===n&&(0!==e||1/e==1/n)||e!=e&&n!=n};function li(e,n){if(si(e,n))return!0;if("object"!=typeof e||null===e||"object"!=typeof n||null===n)return!1;var t=Object.keys(e),i=Object.keys(n);if(t.length!==i.length)return!1;for(i=0;i<t.length;i++){var a=t[i];if(!d.call(n,a)||!si(e[a],n[a]))return!1}return!0}function ci(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ui(e,n){var t,i=ci(e);for(e=0;i;){if(3===i.nodeType){if(t=e+i.textContent.length,e<=n&&t>=n)return{node:i,offset:n-e};e=t}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=ci(i)}}function di(e,n){return!(!e||!n)&&(e===n||(!e||3!==e.nodeType)&&(n&&3===n.nodeType?di(e,n.parentNode):"contains"in e?e.contains(n):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(n))))}function mi(){for(var e=window,n=K();n instanceof e.HTMLIFrameElement;){try{var t="string"==typeof n.contentWindow.location.href}catch(e){t=!1}if(!t)break;n=K((e=n.contentWindow).document)}return n}function pi(e){var n=e&&e.nodeName&&e.nodeName.toLowerCase();return n&&("input"===n&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===n||"true"===e.contentEditable)}function hi(e){var n=mi(),t=e.focusedElem,i=e.selectionRange;if(n!==t&&t&&t.ownerDocument&&di(t.ownerDocument.documentElement,t)){if(null!==i&&pi(t))if(n=i.start,void 0===(e=i.end)&&(e=n),"selectionStart"in t)t.selectionStart=n,t.selectionEnd=Math.min(e,t.value.length);else if((e=(n=t.ownerDocument||document)&&n.defaultView||window).getSelection){e=e.getSelection();var a=t.textContent.length,r=Math.min(i.start,a);i=void 0===i.end?r:Math.min(i.end,a),!e.extend&&r>i&&(a=i,i=r,r=a),a=ui(t,r);var o=ui(t,i);a&&o&&(1!==e.rangeCount||e.anchorNode!==a.node||e.anchorOffset!==a.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&((n=n.createRange()).setStart(a.node,a.offset),e.removeAllRanges(),r>i?(e.addRange(n),e.extend(o.node,o.offset)):(n.setEnd(o.node,o.offset),e.addRange(n)))}for(n=[],e=t;e=e.parentNode;)1===e.nodeType&&n.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"==typeof t.focus&&t.focus(),t=0;t<n.length;t++)(e=n[t]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var vi=u&&"documentMode"in document&&11>=document.documentMode,fi=null,gi=null,bi=null,xi=!1;function yi(e,n,t){var i=t.window===t?t.document:9===t.nodeType?t:t.ownerDocument;xi||null==fi||fi!==K(i)||("selectionStart"in(i=fi)&&pi(i)?i={start:i.selectionStart,end:i.selectionEnd}:i={anchorNode:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset},bi&&li(bi,i)||(bi=i,0<(i=qi(gi,"onSelect")).length&&(n=new ut("onSelect","select",null,n,t),e.push({event:n,listeners:i}),n.target=fi)))}function ki(e,n){var t={};return t[e.toLowerCase()]=n.toLowerCase(),t["Webkit"+e]="webkit"+n,t["Moz"+e]="moz"+n,t}var wi={animationend:ki("Animation","AnimationEnd"),animationiteration:ki("Animation","AnimationIteration"),animationstart:ki("Animation","AnimationStart"),transitionend:ki("Transition","TransitionEnd")},ji={},Si={};function Ci(e){if(ji[e])return ji[e];if(!wi[e])return e;var n,t=wi[e];for(n in t)if(t.hasOwnProperty(n)&&n in Si)return ji[e]=t[n];return e}u&&(Si=document.createElement("div").style,"AnimationEvent"in window||(delete wi.animationend.animation,delete wi.animationiteration.animation,delete wi.animationstart.animation),"TransitionEvent"in window||delete wi.transitionend.transition);var Ni=Ci("animationend"),Pi=Ci("animationiteration"),Mi=Ci("animationstart"),Ei=Ci("transitionend"),Li=new Map,Di="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Oi(e,n){Li.set(e,n),l(n,[e])}for(var Ti=0;Ti<Di.length;Ti++){var zi=Di[Ti];Oi(zi.toLowerCase(),"on"+(zi[0].toUpperCase()+zi.slice(1)))}Oi(Ni,"onAnimationEnd"),Oi(Pi,"onAnimationIteration"),Oi(Mi,"onAnimationStart"),Oi("dblclick","onDoubleClick"),Oi("focusin","onFocus"),Oi("focusout","onBlur"),Oi(Ei,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ai="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ii=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ai));function Ri(e,n,t){var i=e.type||"unknown-event";e.currentTarget=t,function(e,n,t,i,a,o,s,l,c){if(Ue.apply(this,arguments),Ie){if(!Ie)throw Error(r(198));var u=Re;Ie=!1,Re=null,Be||(Be=!0,_e=u)}}(i,n,void 0,e),e.currentTarget=null}function Bi(e,n){n=!!(4&n);for(var t=0;t<e.length;t++){var i=e[t],a=i.event;i=i.listeners;e:{var r=void 0;if(n)for(var o=i.length-1;0<=o;o--){var s=i[o],l=s.instance,c=s.currentTarget;if(s=s.listener,l!==r&&a.isPropagationStopped())break e;Ri(a,s,c),r=l}else for(o=0;o<i.length;o++){if(l=(s=i[o]).instance,c=s.currentTarget,s=s.listener,l!==r&&a.isPropagationStopped())break e;Ri(a,s,c),r=l}}}if(Be)throw e=_e,Be=!1,_e=null,e}function _i(e,n){var t=n[va];void 0===t&&(t=n[va]=new Set);var i=e+"__bubble";t.has(i)||(Hi(n,e,2,!1),t.add(i))}function Fi(e,n,t){var i=0;n&&(i|=4),Hi(t,e,i,n)}var Ui="_reactListening"+Math.random().toString(36).slice(2);function Vi(e){if(!e[Ui]){e[Ui]=!0,o.forEach(function(n){"selectionchange"!==n&&(Ii.has(n)||Fi(n,!1,e),Fi(n,!0,e))});var n=9===e.nodeType?e:e.ownerDocument;null===n||n[Ui]||(n[Ui]=!0,Fi("selectionchange",!1,n))}}function Hi(e,n,t,i){switch(Zn(n)){case 1:var a=qn;break;case 4:a=Yn;break;default:a=Kn}t=a.bind(null,n,t,e),a=void 0,!Te||"touchstart"!==n&&"touchmove"!==n&&"wheel"!==n||(a=!0),i?void 0!==a?e.addEventListener(n,t,{capture:!0,passive:a}):e.addEventListener(n,t,!0):void 0!==a?e.addEventListener(n,t,{passive:a}):e.addEventListener(n,t,!1)}function Wi(e,n,t,i,a){var r=i;if(!(1&n||2&n||null===i))e:for(;;){if(null===i)return;var o=i.tag;if(3===o||4===o){var s=i.stateNode.containerInfo;if(s===a||8===s.nodeType&&s.parentNode===a)break;if(4===o)for(o=i.return;null!==o;){var l=o.tag;if((3===l||4===l)&&((l=o.stateNode.containerInfo)===a||8===l.nodeType&&l.parentNode===a))return;o=o.return}for(;null!==s;){if(null===(o=ba(s)))return;if(5===(l=o.tag)||6===l){i=r=o;continue e}s=s.parentNode}}i=i.return}De(function(){var i=r,a=ke(t),o=[];e:{var s=Li.get(e);if(void 0!==s){var l=ut,c=e;switch(e){case"keypress":if(0===tt(t))break e;case"keydown":case"keyup":l=Pt;break;case"focusin":c="focus",l=ft;break;case"focusout":c="blur",l=ft;break;case"beforeblur":case"afterblur":l=ft;break;case"click":if(2===t.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=ht;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=vt;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Et;break;case Ni:case Pi:case Mi:l=gt;break;case Ei:l=Lt;break;case"scroll":l=mt;break;case"wheel":l=Ot;break;case"copy":case"cut":case"paste":l=xt;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=Mt}var u=!!(4&n),d=!u&&"scroll"===e,m=u?null!==s?s+"Capture":null:s;u=[];for(var p,h=i;null!==h;){var v=(p=h).stateNode;if(5===p.tag&&null!==v&&(p=v,null!==m&&(null!=(v=Oe(h,m))&&u.push($i(h,v,p)))),d)break;h=h.return}0<u.length&&(s=new l(s,c,null,t,a),o.push({event:s,listeners:u}))}}if(!(7&n)){if(l="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||t===ye||!(c=t.relatedTarget||t.fromElement)||!ba(c)&&!c[ha])&&(l||s)&&(s=a.window===a?a:(s=a.ownerDocument)?s.defaultView||s.parentWindow:window,l?(l=i,null!==(c=(c=t.relatedTarget||t.toElement)?ba(c):null)&&(c!==(d=Ve(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=i),l!==c)){if(u=ht,v="onMouseLeave",m="onMouseEnter",h="mouse","pointerout"!==e&&"pointerover"!==e||(u=Mt,v="onPointerLeave",m="onPointerEnter",h="pointer"),d=null==l?s:ya(l),p=null==c?s:ya(c),(s=new u(v,h+"leave",l,t,a)).target=d,s.relatedTarget=p,v=null,ba(a)===i&&((u=new u(m,h+"enter",c,t,a)).target=p,u.relatedTarget=d,v=u),d=v,l&&c)e:{for(m=c,h=0,p=u=l;p;p=Yi(p))h++;for(p=0,v=m;v;v=Yi(v))p++;for(;0<h-p;)u=Yi(u),h--;for(;0<p-h;)m=Yi(m),p--;for(;h--;){if(u===m||null!==m&&u===m.alternate)break e;u=Yi(u),m=Yi(m)}u=null}else u=null;null!==l&&Ki(o,s,l,u,!1),null!==c&&null!==d&&Ki(o,d,c,u,!0)}if("select"===(l=(s=i?ya(i):window).nodeName&&s.nodeName.toLowerCase())||"input"===l&&"file"===s.type)var f=Qt;else if(Wt(s))if(Zt)f=oi;else{f=ai;var g=ii}else(l=s.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(f=ri);switch(f&&(f=f(e,i))?$t(o,f,t,a):(g&&g(e,s,i),"focusout"===e&&(g=s._wrapperState)&&g.controlled&&"number"===s.type&&ee(s,"number",s.value)),g=i?ya(i):window,e){case"focusin":(Wt(g)||"true"===g.contentEditable)&&(fi=g,gi=i,bi=null);break;case"focusout":bi=gi=fi=null;break;case"mousedown":xi=!0;break;case"contextmenu":case"mouseup":case"dragend":xi=!1,yi(o,t,a);break;case"selectionchange":if(vi)break;case"keydown":case"keyup":yi(o,t,a)}var b;if(zt)e:{switch(e){case"compositionstart":var x="onCompositionStart";break e;case"compositionend":x="onCompositionEnd";break e;case"compositionupdate":x="onCompositionUpdate";break e}x=void 0}else Vt?Ft(e,t)&&(x="onCompositionEnd"):"keydown"===e&&229===t.keyCode&&(x="onCompositionStart");x&&(Rt&&"ko"!==t.locale&&(Vt||"onCompositionStart"!==x?"onCompositionEnd"===x&&Vt&&(b=nt()):(Jn="value"in(Xn=a)?Xn.value:Xn.textContent,Vt=!0)),0<(g=qi(i,x)).length&&(x=new yt(x,e,null,t,a),o.push({event:x,listeners:g}),b?x.data=b:null!==(b=Ut(t))&&(x.data=b))),(b=It?function(e,n){switch(e){case"compositionend":return Ut(n);case"keypress":return 32!==n.which?null:(_t=!0,Bt);case"textInput":return(e=n.data)===Bt&&_t?null:e;default:return null}}(e,t):function(e,n){if(Vt)return"compositionend"===e||!zt&&Ft(e,n)?(e=nt(),et=Jn=Xn=null,Vt=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(n.ctrlKey||n.altKey||n.metaKey)||n.ctrlKey&&n.altKey){if(n.char&&1<n.char.length)return n.char;if(n.which)return String.fromCharCode(n.which)}return null;case"compositionend":return Rt&&"ko"!==n.locale?null:n.data}}(e,t))&&(0<(i=qi(i,"onBeforeInput")).length&&(a=new yt("onBeforeInput","beforeinput",null,t,a),o.push({event:a,listeners:i}),a.data=b))}Bi(o,n)})}function $i(e,n,t){return{instance:e,listener:n,currentTarget:t}}function qi(e,n){for(var t=n+"Capture",i=[];null!==e;){var a=e,r=a.stateNode;5===a.tag&&null!==r&&(a=r,null!=(r=Oe(e,t))&&i.unshift($i(e,r,a)),null!=(r=Oe(e,n))&&i.push($i(e,r,a))),e=e.return}return i}function Yi(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Ki(e,n,t,i,a){for(var r=n._reactName,o=[];null!==t&&t!==i;){var s=t,l=s.alternate,c=s.stateNode;if(null!==l&&l===i)break;5===s.tag&&null!==c&&(s=c,a?null!=(l=Oe(t,r))&&o.unshift($i(t,l,s)):a||null!=(l=Oe(t,r))&&o.push($i(t,l,s))),t=t.return}0!==o.length&&e.push({event:n,listeners:o})}var Gi=/\r\n?/g,Qi=/\u0000|\uFFFD/g;function Zi(e){return("string"==typeof e?e:""+e).replace(Gi,"\n").replace(Qi,"")}function Xi(e,n,t){if(n=Zi(n),Zi(e)!==n&&t)throw Error(r(425))}function Ji(){}var ea=null,na=null;function ta(e,n){return"textarea"===e||"noscript"===e||"string"==typeof n.children||"number"==typeof n.children||"object"==typeof n.dangerouslySetInnerHTML&&null!==n.dangerouslySetInnerHTML&&null!=n.dangerouslySetInnerHTML.__html}var ia="function"==typeof setTimeout?setTimeout:void 0,aa="function"==typeof clearTimeout?clearTimeout:void 0,ra="function"==typeof Promise?Promise:void 0,oa="function"==typeof queueMicrotask?queueMicrotask:void 0!==ra?function(e){return ra.resolve(null).then(e).catch(sa)}:ia;function sa(e){setTimeout(function(){throw e})}function la(e,n){var t=n,i=0;do{var a=t.nextSibling;if(e.removeChild(t),a&&8===a.nodeType)if("/$"===(t=a.data)){if(0===i)return e.removeChild(a),void Hn(n);i--}else"$"!==t&&"$?"!==t&&"$!"!==t||i++;t=a}while(t);Hn(n)}function ca(e){for(;null!=e;e=e.nextSibling){var n=e.nodeType;if(1===n||3===n)break;if(8===n){if("$"===(n=e.data)||"$!"===n||"$?"===n)break;if("/$"===n)return null}}return e}function ua(e){e=e.previousSibling;for(var n=0;e;){if(8===e.nodeType){var t=e.data;if("$"===t||"$!"===t||"$?"===t){if(0===n)return e;n--}else"/$"===t&&n++}e=e.previousSibling}return null}var da=Math.random().toString(36).slice(2),ma="__reactFiber$"+da,pa="__reactProps$"+da,ha="__reactContainer$"+da,va="__reactEvents$"+da,fa="__reactListeners$"+da,ga="__reactHandles$"+da;function ba(e){var n=e[ma];if(n)return n;for(var t=e.parentNode;t;){if(n=t[ha]||t[ma]){if(t=n.alternate,null!==n.child||null!==t&&null!==t.child)for(e=ua(e);null!==e;){if(t=e[ma])return t;e=ua(e)}return n}t=(e=t).parentNode}return null}function xa(e){return!(e=e[ma]||e[ha])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function ya(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(r(33))}function ka(e){return e[pa]||null}var wa=[],ja=-1;function Sa(e){return{current:e}}function Ca(e){0>ja||(e.current=wa[ja],wa[ja]=null,ja--)}function Na(e,n){ja++,wa[ja]=e.current,e.current=n}var Pa={},Ma=Sa(Pa),Ea=Sa(!1),La=Pa;function Da(e,n){var t=e.type.contextTypes;if(!t)return Pa;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===n)return i.__reactInternalMemoizedMaskedChildContext;var a,r={};for(a in t)r[a]=n[a];return i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=n,e.__reactInternalMemoizedMaskedChildContext=r),r}function Oa(e){return null!=(e=e.childContextTypes)}function Ta(){Ca(Ea),Ca(Ma)}function za(e,n,t){if(Ma.current!==Pa)throw Error(r(168));Na(Ma,n),Na(Ea,t)}function Aa(e,n,t){var i=e.stateNode;if(n=n.childContextTypes,"function"!=typeof i.getChildContext)return t;for(var a in i=i.getChildContext())if(!(a in n))throw Error(r(108,H(e)||"Unknown",a));return R({},t,i)}function Ia(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Pa,La=Ma.current,Na(Ma,e),Na(Ea,Ea.current),!0}function Ra(e,n,t){var i=e.stateNode;if(!i)throw Error(r(169));t?(e=Aa(e,n,La),i.__reactInternalMemoizedMergedChildContext=e,Ca(Ea),Ca(Ma),Na(Ma,e)):Ca(Ea),Na(Ea,t)}var Ba=null,_a=!1,Fa=!1;function Ua(e){null===Ba?Ba=[e]:Ba.push(e)}function Va(){if(!Fa&&null!==Ba){Fa=!0;var e=0,n=yn;try{var t=Ba;for(yn=1;e<t.length;e++){var i=t[e];do{i=i(!0)}while(null!==i)}Ba=null,_a=!1}catch(n){throw null!==Ba&&(Ba=Ba.slice(e+1)),Ye(Je,Va),n}finally{yn=n,Fa=!1}}return null}var Ha=[],Wa=0,$a=null,qa=0,Ya=[],Ka=0,Ga=null,Qa=1,Za="";function Xa(e,n){Ha[Wa++]=qa,Ha[Wa++]=$a,$a=e,qa=n}function Ja(e,n,t){Ya[Ka++]=Qa,Ya[Ka++]=Za,Ya[Ka++]=Ga,Ga=e;var i=Qa;e=Za;var a=32-sn(i)-1;i&=~(1<<a),t+=1;var r=32-sn(n)+a;if(30<r){var o=a-a%5;r=(i&(1<<o)-1).toString(32),i>>=o,a-=o,Qa=1<<32-sn(n)+a|t<<a|i,Za=r+e}else Qa=1<<r|t<<a|i,Za=e}function er(e){null!==e.return&&(Xa(e,1),Ja(e,1,0))}function nr(e){for(;e===$a;)$a=Ha[--Wa],Ha[Wa]=null,qa=Ha[--Wa],Ha[Wa]=null;for(;e===Ga;)Ga=Ya[--Ka],Ya[Ka]=null,Za=Ya[--Ka],Ya[Ka]=null,Qa=Ya[--Ka],Ya[Ka]=null}var tr=null,ir=null,ar=!1,rr=null;function or(e,n){var t=Lc(5,null,null,0);t.elementType="DELETED",t.stateNode=n,t.return=e,null===(n=e.deletions)?(e.deletions=[t],e.flags|=16):n.push(t)}function sr(e,n){switch(e.tag){case 5:var t=e.type;return null!==(n=1!==n.nodeType||t.toLowerCase()!==n.nodeName.toLowerCase()?null:n)&&(e.stateNode=n,tr=e,ir=ca(n.firstChild),!0);case 6:return null!==(n=""===e.pendingProps||3!==n.nodeType?null:n)&&(e.stateNode=n,tr=e,ir=null,!0);case 13:return null!==(n=8!==n.nodeType?null:n)&&(t=null!==Ga?{id:Qa,overflow:Za}:null,e.memoizedState={dehydrated:n,treeContext:t,retryLane:1073741824},(t=Lc(18,null,null,0)).stateNode=n,t.return=e,e.child=t,tr=e,ir=null,!0);default:return!1}}function lr(e){return!(!(1&e.mode)||128&e.flags)}function cr(e){if(ar){var n=ir;if(n){var t=n;if(!sr(e,n)){if(lr(e))throw Error(r(418));n=ca(t.nextSibling);var i=tr;n&&sr(e,n)?or(i,t):(e.flags=-4097&e.flags|2,ar=!1,tr=e)}}else{if(lr(e))throw Error(r(418));e.flags=-4097&e.flags|2,ar=!1,tr=e}}}function ur(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;tr=e}function dr(e){if(e!==tr)return!1;if(!ar)return ur(e),ar=!0,!1;var n;if((n=3!==e.tag)&&!(n=5!==e.tag)&&(n="head"!==(n=e.type)&&"body"!==n&&!ta(e.type,e.memoizedProps)),n&&(n=ir)){if(lr(e))throw mr(),Error(r(418));for(;n;)or(e,n),n=ca(n.nextSibling)}if(ur(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(r(317));e:{for(e=e.nextSibling,n=0;e;){if(8===e.nodeType){var t=e.data;if("/$"===t){if(0===n){ir=ca(e.nextSibling);break e}n--}else"$"!==t&&"$!"!==t&&"$?"!==t||n++}e=e.nextSibling}ir=null}}else ir=tr?ca(e.stateNode.nextSibling):null;return!0}function mr(){for(var e=ir;e;)e=ca(e.nextSibling)}function pr(){ir=tr=null,ar=!1}function hr(e){null===rr?rr=[e]:rr.push(e)}var vr=y.ReactCurrentBatchConfig;function fr(e,n,t){if(null!==(e=t.ref)&&"function"!=typeof e&&"object"!=typeof e){if(t._owner){if(t=t._owner){if(1!==t.tag)throw Error(r(309));var i=t.stateNode}if(!i)throw Error(r(147,e));var a=i,o=""+e;return null!==n&&null!==n.ref&&"function"==typeof n.ref&&n.ref._stringRef===o?n.ref:(n=function(e){var n=a.refs;null===e?delete n[o]:n[o]=e},n._stringRef=o,n)}if("string"!=typeof e)throw Error(r(284));if(!t._owner)throw Error(r(290,e))}return e}function gr(e,n){throw e=Object.prototype.toString.call(n),Error(r(31,"[object Object]"===e?"object with keys {"+Object.keys(n).join(", ")+"}":e))}function br(e){return(0,e._init)(e._payload)}function xr(e){function n(n,t){if(e){var i=n.deletions;null===i?(n.deletions=[t],n.flags|=16):i.push(t)}}function t(t,i){if(!e)return null;for(;null!==i;)n(t,i),i=i.sibling;return null}function i(e,n){for(e=new Map;null!==n;)null!==n.key?e.set(n.key,n):e.set(n.index,n),n=n.sibling;return e}function a(e,n){return(e=Oc(e,n)).index=0,e.sibling=null,e}function o(n,t,i){return n.index=i,e?null!==(i=n.alternate)?(i=i.index)<t?(n.flags|=2,t):i:(n.flags|=2,t):(n.flags|=1048576,t)}function s(n){return e&&null===n.alternate&&(n.flags|=2),n}function l(e,n,t,i){return null===n||6!==n.tag?((n=Ic(t,e.mode,i)).return=e,n):((n=a(n,t)).return=e,n)}function c(e,n,t,i){var r=t.type;return r===j?d(e,n,t.props.children,i,t.key):null!==n&&(n.elementType===r||"object"==typeof r&&null!==r&&r.$$typeof===O&&br(r)===n.type)?((i=a(n,t.props)).ref=fr(e,n,t),i.return=e,i):((i=Tc(t.type,t.key,t.props,null,e.mode,i)).ref=fr(e,n,t),i.return=e,i)}function u(e,n,t,i){return null===n||4!==n.tag||n.stateNode.containerInfo!==t.containerInfo||n.stateNode.implementation!==t.implementation?((n=Rc(t,e.mode,i)).return=e,n):((n=a(n,t.children||[])).return=e,n)}function d(e,n,t,i,r){return null===n||7!==n.tag?((n=zc(t,e.mode,i,r)).return=e,n):((n=a(n,t)).return=e,n)}function m(e,n,t){if("string"==typeof n&&""!==n||"number"==typeof n)return(n=Ic(""+n,e.mode,t)).return=e,n;if("object"==typeof n&&null!==n){switch(n.$$typeof){case k:return(t=Tc(n.type,n.key,n.props,null,e.mode,t)).ref=fr(e,null,n),t.return=e,t;case w:return(n=Rc(n,e.mode,t)).return=e,n;case O:return m(e,(0,n._init)(n._payload),t)}if(ne(n)||A(n))return(n=zc(n,e.mode,t,null)).return=e,n;gr(e,n)}return null}function p(e,n,t,i){var a=null!==n?n.key:null;if("string"==typeof t&&""!==t||"number"==typeof t)return null!==a?null:l(e,n,""+t,i);if("object"==typeof t&&null!==t){switch(t.$$typeof){case k:return t.key===a?c(e,n,t,i):null;case w:return t.key===a?u(e,n,t,i):null;case O:return p(e,n,(a=t._init)(t._payload),i)}if(ne(t)||A(t))return null!==a?null:d(e,n,t,i,null);gr(e,t)}return null}function h(e,n,t,i,a){if("string"==typeof i&&""!==i||"number"==typeof i)return l(n,e=e.get(t)||null,""+i,a);if("object"==typeof i&&null!==i){switch(i.$$typeof){case k:return c(n,e=e.get(null===i.key?t:i.key)||null,i,a);case w:return u(n,e=e.get(null===i.key?t:i.key)||null,i,a);case O:return h(e,n,t,(0,i._init)(i._payload),a)}if(ne(i)||A(i))return d(n,e=e.get(t)||null,i,a,null);gr(n,i)}return null}function v(a,r,s,l){for(var c=null,u=null,d=r,v=r=0,f=null;null!==d&&v<s.length;v++){d.index>v?(f=d,d=null):f=d.sibling;var g=p(a,d,s[v],l);if(null===g){null===d&&(d=f);break}e&&d&&null===g.alternate&&n(a,d),r=o(g,r,v),null===u?c=g:u.sibling=g,u=g,d=f}if(v===s.length)return t(a,d),ar&&Xa(a,v),c;if(null===d){for(;v<s.length;v++)null!==(d=m(a,s[v],l))&&(r=o(d,r,v),null===u?c=d:u.sibling=d,u=d);return ar&&Xa(a,v),c}for(d=i(a,d);v<s.length;v++)null!==(f=h(d,a,v,s[v],l))&&(e&&null!==f.alternate&&d.delete(null===f.key?v:f.key),r=o(f,r,v),null===u?c=f:u.sibling=f,u=f);return e&&d.forEach(function(e){return n(a,e)}),ar&&Xa(a,v),c}function f(a,s,l,c){var u=A(l);if("function"!=typeof u)throw Error(r(150));if(null==(l=u.call(l)))throw Error(r(151));for(var d=u=null,v=s,f=s=0,g=null,b=l.next();null!==v&&!b.done;f++,b=l.next()){v.index>f?(g=v,v=null):g=v.sibling;var x=p(a,v,b.value,c);if(null===x){null===v&&(v=g);break}e&&v&&null===x.alternate&&n(a,v),s=o(x,s,f),null===d?u=x:d.sibling=x,d=x,v=g}if(b.done)return t(a,v),ar&&Xa(a,f),u;if(null===v){for(;!b.done;f++,b=l.next())null!==(b=m(a,b.value,c))&&(s=o(b,s,f),null===d?u=b:d.sibling=b,d=b);return ar&&Xa(a,f),u}for(v=i(a,v);!b.done;f++,b=l.next())null!==(b=h(v,a,f,b.value,c))&&(e&&null!==b.alternate&&v.delete(null===b.key?f:b.key),s=o(b,s,f),null===d?u=b:d.sibling=b,d=b);return e&&v.forEach(function(e){return n(a,e)}),ar&&Xa(a,f),u}return function e(i,r,o,l){if("object"==typeof o&&null!==o&&o.type===j&&null===o.key&&(o=o.props.children),"object"==typeof o&&null!==o){switch(o.$$typeof){case k:e:{for(var c=o.key,u=r;null!==u;){if(u.key===c){if((c=o.type)===j){if(7===u.tag){t(i,u.sibling),(r=a(u,o.props.children)).return=i,i=r;break e}}else if(u.elementType===c||"object"==typeof c&&null!==c&&c.$$typeof===O&&br(c)===u.type){t(i,u.sibling),(r=a(u,o.props)).ref=fr(i,u,o),r.return=i,i=r;break e}t(i,u);break}n(i,u),u=u.sibling}o.type===j?((r=zc(o.props.children,i.mode,l,o.key)).return=i,i=r):((l=Tc(o.type,o.key,o.props,null,i.mode,l)).ref=fr(i,r,o),l.return=i,i=l)}return s(i);case w:e:{for(u=o.key;null!==r;){if(r.key===u){if(4===r.tag&&r.stateNode.containerInfo===o.containerInfo&&r.stateNode.implementation===o.implementation){t(i,r.sibling),(r=a(r,o.children||[])).return=i,i=r;break e}t(i,r);break}n(i,r),r=r.sibling}(r=Rc(o,i.mode,l)).return=i,i=r}return s(i);case O:return e(i,r,(u=o._init)(o._payload),l)}if(ne(o))return v(i,r,o,l);if(A(o))return f(i,r,o,l);gr(i,o)}return"string"==typeof o&&""!==o||"number"==typeof o?(o=""+o,null!==r&&6===r.tag?(t(i,r.sibling),(r=a(r,o)).return=i,i=r):(t(i,r),(r=Ic(o,i.mode,l)).return=i,i=r),s(i)):t(i,r)}}var yr=xr(!0),kr=xr(!1),wr=Sa(null),jr=null,Sr=null,Cr=null;function Nr(){Cr=Sr=jr=null}function Pr(e){var n=wr.current;Ca(wr),e._currentValue=n}function Mr(e,n,t){for(;null!==e;){var i=e.alternate;if((e.childLanes&n)!==n?(e.childLanes|=n,null!==i&&(i.childLanes|=n)):null!==i&&(i.childLanes&n)!==n&&(i.childLanes|=n),e===t)break;e=e.return}}function Er(e,n){jr=e,Cr=Sr=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&n)&&(xs=!0),e.firstContext=null)}function Lr(e){var n=e._currentValue;if(Cr!==e)if(e={context:e,memoizedValue:n,next:null},null===Sr){if(null===jr)throw Error(r(308));Sr=e,jr.dependencies={lanes:0,firstContext:e}}else Sr=Sr.next=e;return n}var Dr=null;function Or(e){null===Dr?Dr=[e]:Dr.push(e)}function Tr(e,n,t,i){var a=n.interleaved;return null===a?(t.next=t,Or(n)):(t.next=a.next,a.next=t),n.interleaved=t,zr(e,i)}function zr(e,n){e.lanes|=n;var t=e.alternate;for(null!==t&&(t.lanes|=n),t=e,e=e.return;null!==e;)e.childLanes|=n,null!==(t=e.alternate)&&(t.childLanes|=n),t=e,e=e.return;return 3===t.tag?t.stateNode:null}var Ar=!1;function Ir(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Rr(e,n){e=e.updateQueue,n.updateQueue===e&&(n.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Br(e,n){return{eventTime:e,lane:n,tag:0,payload:null,callback:null,next:null}}function _r(e,n,t){var i=e.updateQueue;if(null===i)return null;if(i=i.shared,2&Pl){var a=i.pending;return null===a?n.next=n:(n.next=a.next,a.next=n),i.pending=n,zr(e,t)}return null===(a=i.interleaved)?(n.next=n,Or(i)):(n.next=a.next,a.next=n),i.interleaved=n,zr(e,t)}function Fr(e,n,t){if(null!==(n=n.updateQueue)&&(n=n.shared,4194240&t)){var i=n.lanes;t|=i&=e.pendingLanes,n.lanes=t,xn(e,t)}}function Ur(e,n){var t=e.updateQueue,i=e.alternate;if(null!==i&&t===(i=i.updateQueue)){var a=null,r=null;if(null!==(t=t.firstBaseUpdate)){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};null===r?a=r=o:r=r.next=o,t=t.next}while(null!==t);null===r?a=r=n:r=r.next=n}else a=r=n;return t={baseState:i.baseState,firstBaseUpdate:a,lastBaseUpdate:r,shared:i.shared,effects:i.effects},void(e.updateQueue=t)}null===(e=t.lastBaseUpdate)?t.firstBaseUpdate=n:e.next=n,t.lastBaseUpdate=n}function Vr(e,n,t,i){var a=e.updateQueue;Ar=!1;var r=a.firstBaseUpdate,o=a.lastBaseUpdate,s=a.shared.pending;if(null!==s){a.shared.pending=null;var l=s,c=l.next;l.next=null,null===o?r=c:o.next=c,o=l;var u=e.alternate;null!==u&&((s=(u=u.updateQueue).lastBaseUpdate)!==o&&(null===s?u.firstBaseUpdate=c:s.next=c,u.lastBaseUpdate=l))}if(null!==r){var d=a.baseState;for(o=0,u=c=l=null,s=r;;){var m=s.lane,p=s.eventTime;if((i&m)===m){null!==u&&(u=u.next={eventTime:p,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var h=e,v=s;switch(m=n,p=t,v.tag){case 1:if("function"==typeof(h=v.payload)){d=h.call(p,d,m);break e}d=h;break e;case 3:h.flags=-65537&h.flags|128;case 0:if(null==(m="function"==typeof(h=v.payload)?h.call(p,d,m):h))break e;d=R({},d,m);break e;case 2:Ar=!0}}null!==s.callback&&0!==s.lane&&(e.flags|=64,null===(m=a.effects)?a.effects=[s]:m.push(s))}else p={eventTime:p,lane:m,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===u?(c=u=p,l=d):u=u.next=p,o|=m;if(null===(s=s.next)){if(null===(s=a.shared.pending))break;s=(m=s).next,m.next=null,a.lastBaseUpdate=m,a.shared.pending=null}}if(null===u&&(l=d),a.baseState=l,a.firstBaseUpdate=c,a.lastBaseUpdate=u,null!==(n=a.shared.interleaved)){a=n;do{o|=a.lane,a=a.next}while(a!==n)}else null===r&&(a.shared.lanes=0);Al|=o,e.lanes=o,e.memoizedState=d}}function Hr(e,n,t){if(e=n.effects,n.effects=null,null!==e)for(n=0;n<e.length;n++){var i=e[n],a=i.callback;if(null!==a){if(i.callback=null,i=t,"function"!=typeof a)throw Error(r(191,a));a.call(i)}}}var Wr={},$r=Sa(Wr),qr=Sa(Wr),Yr=Sa(Wr);function Kr(e){if(e===Wr)throw Error(r(174));return e}function Gr(e,n){switch(Na(Yr,n),Na(qr,e),Na($r,Wr),e=n.nodeType){case 9:case 11:n=(n=n.documentElement)?n.namespaceURI:le(null,"");break;default:n=le(n=(e=8===e?n.parentNode:n).namespaceURI||null,e=e.tagName)}Ca($r),Na($r,n)}function Qr(){Ca($r),Ca(qr),Ca(Yr)}function Zr(e){Kr(Yr.current);var n=Kr($r.current),t=le(n,e.type);n!==t&&(Na(qr,e),Na($r,t))}function Xr(e){qr.current===e&&(Ca($r),Ca(qr))}var Jr=Sa(0);function eo(e){for(var n=e;null!==n;){if(13===n.tag){var t=n.memoizedState;if(null!==t&&(null===(t=t.dehydrated)||"$?"===t.data||"$!"===t.data))return n}else if(19===n.tag&&void 0!==n.memoizedProps.revealOrder){if(128&n.flags)return n}else if(null!==n.child){n.child.return=n,n=n.child;continue}if(n===e)break;for(;null===n.sibling;){if(null===n.return||n.return===e)return null;n=n.return}n.sibling.return=n.return,n=n.sibling}return null}var no=[];function to(){for(var e=0;e<no.length;e++)no[e]._workInProgressVersionPrimary=null;no.length=0}var io=y.ReactCurrentDispatcher,ao=y.ReactCurrentBatchConfig,ro=0,oo=null,so=null,lo=null,co=!1,uo=!1,mo=0,po=0;function ho(){throw Error(r(321))}function vo(e,n){if(null===n)return!1;for(var t=0;t<n.length&&t<e.length;t++)if(!si(e[t],n[t]))return!1;return!0}function fo(e,n,t,i,a,o){if(ro=o,oo=n,n.memoizedState=null,n.updateQueue=null,n.lanes=0,io.current=null===e||null===e.memoizedState?Jo:es,e=t(i,a),uo){o=0;do{if(uo=!1,mo=0,25<=o)throw Error(r(301));o+=1,lo=so=null,n.updateQueue=null,io.current=ns,e=t(i,a)}while(uo)}if(io.current=Xo,n=null!==so&&null!==so.next,ro=0,lo=so=oo=null,co=!1,n)throw Error(r(300));return e}function go(){var e=0!==mo;return mo=0,e}function bo(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===lo?oo.memoizedState=lo=e:lo=lo.next=e,lo}function xo(){if(null===so){var e=oo.alternate;e=null!==e?e.memoizedState:null}else e=so.next;var n=null===lo?oo.memoizedState:lo.next;if(null!==n)lo=n,so=e;else{if(null===e)throw Error(r(310));e={memoizedState:(so=e).memoizedState,baseState:so.baseState,baseQueue:so.baseQueue,queue:so.queue,next:null},null===lo?oo.memoizedState=lo=e:lo=lo.next=e}return lo}function yo(e,n){return"function"==typeof n?n(e):n}function ko(e){var n=xo(),t=n.queue;if(null===t)throw Error(r(311));t.lastRenderedReducer=e;var i=so,a=i.baseQueue,o=t.pending;if(null!==o){if(null!==a){var s=a.next;a.next=o.next,o.next=s}i.baseQueue=a=o,t.pending=null}if(null!==a){o=a.next,i=i.baseState;var l=s=null,c=null,u=o;do{var d=u.lane;if((ro&d)===d)null!==c&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),i=u.hasEagerState?u.eagerState:e(i,u.action);else{var m={lane:d,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===c?(l=c=m,s=i):c=c.next=m,oo.lanes|=d,Al|=d}u=u.next}while(null!==u&&u!==o);null===c?s=i:c.next=l,si(i,n.memoizedState)||(xs=!0),n.memoizedState=i,n.baseState=s,n.baseQueue=c,t.lastRenderedState=i}if(null!==(e=t.interleaved)){a=e;do{o=a.lane,oo.lanes|=o,Al|=o,a=a.next}while(a!==e)}else null===a&&(t.lanes=0);return[n.memoizedState,t.dispatch]}function wo(e){var n=xo(),t=n.queue;if(null===t)throw Error(r(311));t.lastRenderedReducer=e;var i=t.dispatch,a=t.pending,o=n.memoizedState;if(null!==a){t.pending=null;var s=a=a.next;do{o=e(o,s.action),s=s.next}while(s!==a);si(o,n.memoizedState)||(xs=!0),n.memoizedState=o,null===n.baseQueue&&(n.baseState=o),t.lastRenderedState=o}return[o,i]}function jo(){}function So(e,n){var t=oo,i=xo(),a=n(),o=!si(i.memoizedState,a);if(o&&(i.memoizedState=a,xs=!0),i=i.queue,Io(Po.bind(null,t,i,e),[e]),i.getSnapshot!==n||o||null!==lo&&1&lo.memoizedState.tag){if(t.flags|=2048,Do(9,No.bind(null,t,i,a,n),void 0,null),null===Ml)throw Error(r(349));30&ro||Co(t,n,a)}return a}function Co(e,n,t){e.flags|=16384,e={getSnapshot:n,value:t},null===(n=oo.updateQueue)?(n={lastEffect:null,stores:null},oo.updateQueue=n,n.stores=[e]):null===(t=n.stores)?n.stores=[e]:t.push(e)}function No(e,n,t,i){n.value=t,n.getSnapshot=i,Mo(n)&&Eo(e)}function Po(e,n,t){return t(function(){Mo(n)&&Eo(e)})}function Mo(e){var n=e.getSnapshot;e=e.value;try{var t=n();return!si(e,t)}catch(e){return!0}}function Eo(e){var n=zr(e,1);null!==n&&nc(n,e,1,-1)}function Lo(e){var n=bo();return"function"==typeof e&&(e=e()),n.memoizedState=n.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:yo,lastRenderedState:e},n.queue=e,e=e.dispatch=Ko.bind(null,oo,e),[n.memoizedState,e]}function Do(e,n,t,i){return e={tag:e,create:n,destroy:t,deps:i,next:null},null===(n=oo.updateQueue)?(n={lastEffect:null,stores:null},oo.updateQueue=n,n.lastEffect=e.next=e):null===(t=n.lastEffect)?n.lastEffect=e.next=e:(i=t.next,t.next=e,e.next=i,n.lastEffect=e),e}function Oo(){return xo().memoizedState}function To(e,n,t,i){var a=bo();oo.flags|=e,a.memoizedState=Do(1|n,t,void 0,void 0===i?null:i)}function zo(e,n,t,i){var a=xo();i=void 0===i?null:i;var r=void 0;if(null!==so){var o=so.memoizedState;if(r=o.destroy,null!==i&&vo(i,o.deps))return void(a.memoizedState=Do(n,t,r,i))}oo.flags|=e,a.memoizedState=Do(1|n,t,r,i)}function Ao(e,n){return To(8390656,8,e,n)}function Io(e,n){return zo(2048,8,e,n)}function Ro(e,n){return zo(4,2,e,n)}function Bo(e,n){return zo(4,4,e,n)}function _o(e,n){return"function"==typeof n?(e=e(),n(e),function(){n(null)}):null!=n?(e=e(),n.current=e,function(){n.current=null}):void 0}function Fo(e,n,t){return t=null!=t?t.concat([e]):null,zo(4,4,_o.bind(null,n,e),t)}function Uo(){}function Vo(e,n){var t=xo();n=void 0===n?null:n;var i=t.memoizedState;return null!==i&&null!==n&&vo(n,i[1])?i[0]:(t.memoizedState=[e,n],e)}function Ho(e,n){var t=xo();n=void 0===n?null:n;var i=t.memoizedState;return null!==i&&null!==n&&vo(n,i[1])?i[0]:(e=e(),t.memoizedState=[e,n],e)}function Wo(e,n,t){return 21&ro?(si(t,n)||(t=fn(),oo.lanes|=t,Al|=t,e.baseState=!0),n):(e.baseState&&(e.baseState=!1,xs=!0),e.memoizedState=t)}function $o(e,n){var t=yn;yn=0!==t&&4>t?t:4,e(!0);var i=ao.transition;ao.transition={};try{e(!1),n()}finally{yn=t,ao.transition=i}}function qo(){return xo().memoizedState}function Yo(e,n,t){var i=ec(e);if(t={lane:i,action:t,hasEagerState:!1,eagerState:null,next:null},Go(e))Qo(n,t);else if(null!==(t=Tr(e,n,t,i))){nc(t,e,i,Jl()),Zo(t,n,i)}}function Ko(e,n,t){var i=ec(e),a={lane:i,action:t,hasEagerState:!1,eagerState:null,next:null};if(Go(e))Qo(n,a);else{var r=e.alternate;if(0===e.lanes&&(null===r||0===r.lanes)&&null!==(r=n.lastRenderedReducer))try{var o=n.lastRenderedState,s=r(o,t);if(a.hasEagerState=!0,a.eagerState=s,si(s,o)){var l=n.interleaved;return null===l?(a.next=a,Or(n)):(a.next=l.next,l.next=a),void(n.interleaved=a)}}catch(e){}null!==(t=Tr(e,n,a,i))&&(nc(t,e,i,a=Jl()),Zo(t,n,i))}}function Go(e){var n=e.alternate;return e===oo||null!==n&&n===oo}function Qo(e,n){uo=co=!0;var t=e.pending;null===t?n.next=n:(n.next=t.next,t.next=n),e.pending=n}function Zo(e,n,t){if(4194240&t){var i=n.lanes;t|=i&=e.pendingLanes,n.lanes=t,xn(e,t)}}var Xo={readContext:Lr,useCallback:ho,useContext:ho,useEffect:ho,useImperativeHandle:ho,useInsertionEffect:ho,useLayoutEffect:ho,useMemo:ho,useReducer:ho,useRef:ho,useState:ho,useDebugValue:ho,useDeferredValue:ho,useTransition:ho,useMutableSource:ho,useSyncExternalStore:ho,useId:ho,unstable_isNewReconciler:!1},Jo={readContext:Lr,useCallback:function(e,n){return bo().memoizedState=[e,void 0===n?null:n],e},useContext:Lr,useEffect:Ao,useImperativeHandle:function(e,n,t){return t=null!=t?t.concat([e]):null,To(4194308,4,_o.bind(null,n,e),t)},useLayoutEffect:function(e,n){return To(4194308,4,e,n)},useInsertionEffect:function(e,n){return To(4,2,e,n)},useMemo:function(e,n){var t=bo();return n=void 0===n?null:n,e=e(),t.memoizedState=[e,n],e},useReducer:function(e,n,t){var i=bo();return n=void 0!==t?t(n):n,i.memoizedState=i.baseState=n,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:n},i.queue=e,e=e.dispatch=Yo.bind(null,oo,e),[i.memoizedState,e]},useRef:function(e){return e={current:e},bo().memoizedState=e},useState:Lo,useDebugValue:Uo,useDeferredValue:function(e){return bo().memoizedState=e},useTransition:function(){var e=Lo(!1),n=e[0];return e=$o.bind(null,e[1]),bo().memoizedState=e,[n,e]},useMutableSource:function(){},useSyncExternalStore:function(e,n,t){var i=oo,a=bo();if(ar){if(void 0===t)throw Error(r(407));t=t()}else{if(t=n(),null===Ml)throw Error(r(349));30&ro||Co(i,n,t)}a.memoizedState=t;var o={value:t,getSnapshot:n};return a.queue=o,Ao(Po.bind(null,i,o,e),[e]),i.flags|=2048,Do(9,No.bind(null,i,o,t,n),void 0,null),t},useId:function(){var e=bo(),n=Ml.identifierPrefix;if(ar){var t=Za;n=":"+n+"R"+(t=(Qa&~(1<<32-sn(Qa)-1)).toString(32)+t),0<(t=mo++)&&(n+="H"+t.toString(32)),n+=":"}else n=":"+n+"r"+(t=po++).toString(32)+":";return e.memoizedState=n},unstable_isNewReconciler:!1},es={readContext:Lr,useCallback:Vo,useContext:Lr,useEffect:Io,useImperativeHandle:Fo,useInsertionEffect:Ro,useLayoutEffect:Bo,useMemo:Ho,useReducer:ko,useRef:Oo,useState:function(){return ko(yo)},useDebugValue:Uo,useDeferredValue:function(e){return Wo(xo(),so.memoizedState,e)},useTransition:function(){return[ko(yo)[0],xo().memoizedState]},useMutableSource:jo,useSyncExternalStore:So,useId:qo,unstable_isNewReconciler:!1},ns={readContext:Lr,useCallback:Vo,useContext:Lr,useEffect:Io,useImperativeHandle:Fo,useInsertionEffect:Ro,useLayoutEffect:Bo,useMemo:Ho,useReducer:wo,useRef:Oo,useState:function(){return wo(yo)},useDebugValue:Uo,useDeferredValue:function(e){var n=xo();return null===so?n.memoizedState=e:Wo(n,so.memoizedState,e)},useTransition:function(){return[wo(yo)[0],xo().memoizedState]},useMutableSource:jo,useSyncExternalStore:So,useId:qo,unstable_isNewReconciler:!1};function ts(e,n){if(e&&e.defaultProps){for(var t in n=R({},n),e=e.defaultProps)void 0===n[t]&&(n[t]=e[t]);return n}return n}function is(e,n,t,i){t=null==(t=t(i,n=e.memoizedState))?n:R({},n,t),e.memoizedState=t,0===e.lanes&&(e.updateQueue.baseState=t)}var as={isMounted:function(e){return!!(e=e._reactInternals)&&Ve(e)===e},enqueueSetState:function(e,n,t){e=e._reactInternals;var i=Jl(),a=ec(e),r=Br(i,a);r.payload=n,null!=t&&(r.callback=t),null!==(n=_r(e,r,a))&&(nc(n,e,a,i),Fr(n,e,a))},enqueueReplaceState:function(e,n,t){e=e._reactInternals;var i=Jl(),a=ec(e),r=Br(i,a);r.tag=1,r.payload=n,null!=t&&(r.callback=t),null!==(n=_r(e,r,a))&&(nc(n,e,a,i),Fr(n,e,a))},enqueueForceUpdate:function(e,n){e=e._reactInternals;var t=Jl(),i=ec(e),a=Br(t,i);a.tag=2,null!=n&&(a.callback=n),null!==(n=_r(e,a,i))&&(nc(n,e,i,t),Fr(n,e,i))}};function rs(e,n,t,i,a,r,o){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(i,r,o):!n.prototype||!n.prototype.isPureReactComponent||(!li(t,i)||!li(a,r))}function os(e,n,t){var i=!1,a=Pa,r=n.contextType;return"object"==typeof r&&null!==r?r=Lr(r):(a=Oa(n)?La:Ma.current,r=(i=null!=(i=n.contextTypes))?Da(e,a):Pa),n=new n(t,r),e.memoizedState=null!==n.state&&void 0!==n.state?n.state:null,n.updater=as,e.stateNode=n,n._reactInternals=e,i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=r),n}function ss(e,n,t,i){e=n.state,"function"==typeof n.componentWillReceiveProps&&n.componentWillReceiveProps(t,i),"function"==typeof n.UNSAFE_componentWillReceiveProps&&n.UNSAFE_componentWillReceiveProps(t,i),n.state!==e&&as.enqueueReplaceState(n,n.state,null)}function ls(e,n,t,i){var a=e.stateNode;a.props=t,a.state=e.memoizedState,a.refs={},Ir(e);var r=n.contextType;"object"==typeof r&&null!==r?a.context=Lr(r):(r=Oa(n)?La:Ma.current,a.context=Da(e,r)),a.state=e.memoizedState,"function"==typeof(r=n.getDerivedStateFromProps)&&(is(e,n,r,t),a.state=e.memoizedState),"function"==typeof n.getDerivedStateFromProps||"function"==typeof a.getSnapshotBeforeUpdate||"function"!=typeof a.UNSAFE_componentWillMount&&"function"!=typeof a.componentWillMount||(n=a.state,"function"==typeof a.componentWillMount&&a.componentWillMount(),"function"==typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount(),n!==a.state&&as.enqueueReplaceState(a,a.state,null),Vr(e,t,a,i),a.state=e.memoizedState),"function"==typeof a.componentDidMount&&(e.flags|=4194308)}function cs(e,n){try{var t="",i=n;do{t+=U(i),i=i.return}while(i);var a=t}catch(e){a="\nError generating stack: "+e.message+"\n"+e.stack}return{value:e,source:n,stack:a,digest:null}}function us(e,n,t){return{value:e,source:null,stack:null!=t?t:null,digest:null!=n?n:null}}function ds(e,n){try{console.error(n.value)}catch(e){setTimeout(function(){throw e})}}var ms="function"==typeof WeakMap?WeakMap:Map;function ps(e,n,t){(t=Br(-1,t)).tag=3,t.payload={element:null};var i=n.value;return t.callback=function(){Hl||(Hl=!0,Wl=i),ds(0,n)},t}function hs(e,n,t){(t=Br(-1,t)).tag=3;var i=e.type.getDerivedStateFromError;if("function"==typeof i){var a=n.value;t.payload=function(){return i(a)},t.callback=function(){ds(0,n)}}var r=e.stateNode;return null!==r&&"function"==typeof r.componentDidCatch&&(t.callback=function(){ds(0,n),"function"!=typeof i&&(null===$l?$l=new Set([this]):$l.add(this));var e=n.stack;this.componentDidCatch(n.value,{componentStack:null!==e?e:""})}),t}function vs(e,n,t){var i=e.pingCache;if(null===i){i=e.pingCache=new ms;var a=new Set;i.set(n,a)}else void 0===(a=i.get(n))&&(a=new Set,i.set(n,a));a.has(t)||(a.add(t),e=Sc.bind(null,e,n,t),n.then(e,e))}function fs(e){do{var n;if((n=13===e.tag)&&(n=null===(n=e.memoizedState)||null!==n.dehydrated),n)return e;e=e.return}while(null!==e);return null}function gs(e,n,t,i,a){return 1&e.mode?(e.flags|=65536,e.lanes=a,e):(e===n?e.flags|=65536:(e.flags|=128,t.flags|=131072,t.flags&=-52805,1===t.tag&&(null===t.alternate?t.tag=17:((n=Br(-1,1)).tag=2,_r(t,n,1))),t.lanes|=1),e)}var bs=y.ReactCurrentOwner,xs=!1;function ys(e,n,t,i){n.child=null===e?kr(n,null,t,i):yr(n,e.child,t,i)}function ks(e,n,t,i,a){t=t.render;var r=n.ref;return Er(n,a),i=fo(e,n,t,i,r,a),t=go(),null===e||xs?(ar&&t&&er(n),n.flags|=1,ys(e,n,i,a),n.child):(n.updateQueue=e.updateQueue,n.flags&=-2053,e.lanes&=~a,Hs(e,n,a))}function ws(e,n,t,i,a){if(null===e){var r=t.type;return"function"!=typeof r||Dc(r)||void 0!==r.defaultProps||null!==t.compare||void 0!==t.defaultProps?((e=Tc(t.type,null,i,n,n.mode,a)).ref=n.ref,e.return=n,n.child=e):(n.tag=15,n.type=r,js(e,n,r,i,a))}if(r=e.child,0===(e.lanes&a)){var o=r.memoizedProps;if((t=null!==(t=t.compare)?t:li)(o,i)&&e.ref===n.ref)return Hs(e,n,a)}return n.flags|=1,(e=Oc(r,i)).ref=n.ref,e.return=n,n.child=e}function js(e,n,t,i,a){if(null!==e){var r=e.memoizedProps;if(li(r,i)&&e.ref===n.ref){if(xs=!1,n.pendingProps=i=r,0===(e.lanes&a))return n.lanes=e.lanes,Hs(e,n,a);131072&e.flags&&(xs=!0)}}return Ns(e,n,t,i,a)}function Ss(e,n,t){var i=n.pendingProps,a=i.children,r=null!==e?e.memoizedState:null;if("hidden"===i.mode)if(1&n.mode){if(!(1073741824&t))return e=null!==r?r.baseLanes|t:t,n.lanes=n.childLanes=1073741824,n.memoizedState={baseLanes:e,cachePool:null,transitions:null},n.updateQueue=null,Na(Ol,Dl),Dl|=e,null;n.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=null!==r?r.baseLanes:t,Na(Ol,Dl),Dl|=i}else n.memoizedState={baseLanes:0,cachePool:null,transitions:null},Na(Ol,Dl),Dl|=t;else null!==r?(i=r.baseLanes|t,n.memoizedState=null):i=t,Na(Ol,Dl),Dl|=i;return ys(e,n,a,t),n.child}function Cs(e,n){var t=n.ref;(null===e&&null!==t||null!==e&&e.ref!==t)&&(n.flags|=512,n.flags|=2097152)}function Ns(e,n,t,i,a){var r=Oa(t)?La:Ma.current;return r=Da(n,r),Er(n,a),t=fo(e,n,t,i,r,a),i=go(),null===e||xs?(ar&&i&&er(n),n.flags|=1,ys(e,n,t,a),n.child):(n.updateQueue=e.updateQueue,n.flags&=-2053,e.lanes&=~a,Hs(e,n,a))}function Ps(e,n,t,i,a){if(Oa(t)){var r=!0;Ia(n)}else r=!1;if(Er(n,a),null===n.stateNode)Vs(e,n),os(n,t,i),ls(n,t,i,a),i=!0;else if(null===e){var o=n.stateNode,s=n.memoizedProps;o.props=s;var l=o.context,c=t.contextType;"object"==typeof c&&null!==c?c=Lr(c):c=Da(n,c=Oa(t)?La:Ma.current);var u=t.getDerivedStateFromProps,d="function"==typeof u||"function"==typeof o.getSnapshotBeforeUpdate;d||"function"!=typeof o.UNSAFE_componentWillReceiveProps&&"function"!=typeof o.componentWillReceiveProps||(s!==i||l!==c)&&ss(n,o,i,c),Ar=!1;var m=n.memoizedState;o.state=m,Vr(n,i,o,a),l=n.memoizedState,s!==i||m!==l||Ea.current||Ar?("function"==typeof u&&(is(n,t,u,i),l=n.memoizedState),(s=Ar||rs(n,t,s,i,m,l,c))?(d||"function"!=typeof o.UNSAFE_componentWillMount&&"function"!=typeof o.componentWillMount||("function"==typeof o.componentWillMount&&o.componentWillMount(),"function"==typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"==typeof o.componentDidMount&&(n.flags|=4194308)):("function"==typeof o.componentDidMount&&(n.flags|=4194308),n.memoizedProps=i,n.memoizedState=l),o.props=i,o.state=l,o.context=c,i=s):("function"==typeof o.componentDidMount&&(n.flags|=4194308),i=!1)}else{o=n.stateNode,Rr(e,n),s=n.memoizedProps,c=n.type===n.elementType?s:ts(n.type,s),o.props=c,d=n.pendingProps,m=o.context,"object"==typeof(l=t.contextType)&&null!==l?l=Lr(l):l=Da(n,l=Oa(t)?La:Ma.current);var p=t.getDerivedStateFromProps;(u="function"==typeof p||"function"==typeof o.getSnapshotBeforeUpdate)||"function"!=typeof o.UNSAFE_componentWillReceiveProps&&"function"!=typeof o.componentWillReceiveProps||(s!==d||m!==l)&&ss(n,o,i,l),Ar=!1,m=n.memoizedState,o.state=m,Vr(n,i,o,a);var h=n.memoizedState;s!==d||m!==h||Ea.current||Ar?("function"==typeof p&&(is(n,t,p,i),h=n.memoizedState),(c=Ar||rs(n,t,c,i,m,h,l)||!1)?(u||"function"!=typeof o.UNSAFE_componentWillUpdate&&"function"!=typeof o.componentWillUpdate||("function"==typeof o.componentWillUpdate&&o.componentWillUpdate(i,h,l),"function"==typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(i,h,l)),"function"==typeof o.componentDidUpdate&&(n.flags|=4),"function"==typeof o.getSnapshotBeforeUpdate&&(n.flags|=1024)):("function"!=typeof o.componentDidUpdate||s===e.memoizedProps&&m===e.memoizedState||(n.flags|=4),"function"!=typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&m===e.memoizedState||(n.flags|=1024),n.memoizedProps=i,n.memoizedState=h),o.props=i,o.state=h,o.context=l,i=c):("function"!=typeof o.componentDidUpdate||s===e.memoizedProps&&m===e.memoizedState||(n.flags|=4),"function"!=typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&m===e.memoizedState||(n.flags|=1024),i=!1)}return Ms(e,n,t,i,r,a)}function Ms(e,n,t,i,a,r){Cs(e,n);var o=!!(128&n.flags);if(!i&&!o)return a&&Ra(n,t,!1),Hs(e,n,r);i=n.stateNode,bs.current=n;var s=o&&"function"!=typeof t.getDerivedStateFromError?null:i.render();return n.flags|=1,null!==e&&o?(n.child=yr(n,e.child,null,r),n.child=yr(n,null,s,r)):ys(e,n,s,r),n.memoizedState=i.state,a&&Ra(n,t,!0),n.child}function Es(e){var n=e.stateNode;n.pendingContext?za(0,n.pendingContext,n.pendingContext!==n.context):n.context&&za(0,n.context,!1),Gr(e,n.containerInfo)}function Ls(e,n,t,i,a){return pr(),hr(a),n.flags|=256,ys(e,n,t,i),n.child}var Ds,Os,Ts,zs={dehydrated:null,treeContext:null,retryLane:0};function As(e){return{baseLanes:e,cachePool:null,transitions:null}}function Is(e,n,t){var i,a=n.pendingProps,o=Jr.current,s=!1,l=!!(128&n.flags);if((i=l)||(i=(null===e||null!==e.memoizedState)&&!!(2&o)),i?(s=!0,n.flags&=-129):null!==e&&null===e.memoizedState||(o|=1),Na(Jr,1&o),null===e)return cr(n),null!==(e=n.memoizedState)&&null!==(e=e.dehydrated)?(1&n.mode?"$!"===e.data?n.lanes=8:n.lanes=1073741824:n.lanes=1,null):(l=a.children,e=a.fallback,s?(a=n.mode,s=n.child,l={mode:"hidden",children:l},1&a||null===s?s=Ac(l,a,0,null):(s.childLanes=0,s.pendingProps=l),e=zc(e,a,t,null),s.return=n,e.return=n,s.sibling=e,n.child=s,n.child.memoizedState=As(t),n.memoizedState=zs,e):Rs(n,l));if(null!==(o=e.memoizedState)&&null!==(i=o.dehydrated))return function(e,n,t,i,a,o,s){if(t)return 256&n.flags?(n.flags&=-257,Bs(e,n,s,i=us(Error(r(422))))):null!==n.memoizedState?(n.child=e.child,n.flags|=128,null):(o=i.fallback,a=n.mode,i=Ac({mode:"visible",children:i.children},a,0,null),(o=zc(o,a,s,null)).flags|=2,i.return=n,o.return=n,i.sibling=o,n.child=i,1&n.mode&&yr(n,e.child,null,s),n.child.memoizedState=As(s),n.memoizedState=zs,o);if(!(1&n.mode))return Bs(e,n,s,null);if("$!"===a.data){if(i=a.nextSibling&&a.nextSibling.dataset)var l=i.dgst;return i=l,Bs(e,n,s,i=us(o=Error(r(419)),i,void 0))}if(l=0!==(s&e.childLanes),xs||l){if(null!==(i=Ml)){switch(s&-s){case 4:a=2;break;case 16:a=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:a=32;break;case 536870912:a=268435456;break;default:a=0}0!==(a=0!==(a&(i.suspendedLanes|s))?0:a)&&a!==o.retryLane&&(o.retryLane=a,zr(e,a),nc(i,e,a,-1))}return hc(),Bs(e,n,s,i=us(Error(r(421))))}return"$?"===a.data?(n.flags|=128,n.child=e.child,n=Nc.bind(null,e),a._reactRetry=n,null):(e=o.treeContext,ir=ca(a.nextSibling),tr=n,ar=!0,rr=null,null!==e&&(Ya[Ka++]=Qa,Ya[Ka++]=Za,Ya[Ka++]=Ga,Qa=e.id,Za=e.overflow,Ga=n),n=Rs(n,i.children),n.flags|=4096,n)}(e,n,l,a,i,o,t);if(s){s=a.fallback,l=n.mode,i=(o=e.child).sibling;var c={mode:"hidden",children:a.children};return 1&l||n.child===o?(a=Oc(o,c)).subtreeFlags=14680064&o.subtreeFlags:((a=n.child).childLanes=0,a.pendingProps=c,n.deletions=null),null!==i?s=Oc(i,s):(s=zc(s,l,t,null)).flags|=2,s.return=n,a.return=n,a.sibling=s,n.child=a,a=s,s=n.child,l=null===(l=e.child.memoizedState)?As(t):{baseLanes:l.baseLanes|t,cachePool:null,transitions:l.transitions},s.memoizedState=l,s.childLanes=e.childLanes&~t,n.memoizedState=zs,a}return e=(s=e.child).sibling,a=Oc(s,{mode:"visible",children:a.children}),!(1&n.mode)&&(a.lanes=t),a.return=n,a.sibling=null,null!==e&&(null===(t=n.deletions)?(n.deletions=[e],n.flags|=16):t.push(e)),n.child=a,n.memoizedState=null,a}function Rs(e,n){return(n=Ac({mode:"visible",children:n},e.mode,0,null)).return=e,e.child=n}function Bs(e,n,t,i){return null!==i&&hr(i),yr(n,e.child,null,t),(e=Rs(n,n.pendingProps.children)).flags|=2,n.memoizedState=null,e}function _s(e,n,t){e.lanes|=n;var i=e.alternate;null!==i&&(i.lanes|=n),Mr(e.return,n,t)}function Fs(e,n,t,i,a){var r=e.memoizedState;null===r?e.memoizedState={isBackwards:n,rendering:null,renderingStartTime:0,last:i,tail:t,tailMode:a}:(r.isBackwards=n,r.rendering=null,r.renderingStartTime=0,r.last=i,r.tail=t,r.tailMode=a)}function Us(e,n,t){var i=n.pendingProps,a=i.revealOrder,r=i.tail;if(ys(e,n,i.children,t),2&(i=Jr.current))i=1&i|2,n.flags|=128;else{if(null!==e&&128&e.flags)e:for(e=n.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&_s(e,t,n);else if(19===e.tag)_s(e,t,n);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===n)break e;for(;null===e.sibling;){if(null===e.return||e.return===n)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}if(Na(Jr,i),1&n.mode)switch(a){case"forwards":for(t=n.child,a=null;null!==t;)null!==(e=t.alternate)&&null===eo(e)&&(a=t),t=t.sibling;null===(t=a)?(a=n.child,n.child=null):(a=t.sibling,t.sibling=null),Fs(n,!1,a,t,r);break;case"backwards":for(t=null,a=n.child,n.child=null;null!==a;){if(null!==(e=a.alternate)&&null===eo(e)){n.child=a;break}e=a.sibling,a.sibling=t,t=a,a=e}Fs(n,!0,t,null,r);break;case"together":Fs(n,!1,null,null,void 0);break;default:n.memoizedState=null}else n.memoizedState=null;return n.child}function Vs(e,n){!(1&n.mode)&&null!==e&&(e.alternate=null,n.alternate=null,n.flags|=2)}function Hs(e,n,t){if(null!==e&&(n.dependencies=e.dependencies),Al|=n.lanes,0===(t&n.childLanes))return null;if(null!==e&&n.child!==e.child)throw Error(r(153));if(null!==n.child){for(t=Oc(e=n.child,e.pendingProps),n.child=t,t.return=n;null!==e.sibling;)e=e.sibling,(t=t.sibling=Oc(e,e.pendingProps)).return=n;t.sibling=null}return n.child}function Ws(e,n){if(!ar)switch(e.tailMode){case"hidden":n=e.tail;for(var t=null;null!==n;)null!==n.alternate&&(t=n),n=n.sibling;null===t?e.tail=null:t.sibling=null;break;case"collapsed":t=e.tail;for(var i=null;null!==t;)null!==t.alternate&&(i=t),t=t.sibling;null===i?n||null===e.tail?e.tail=null:e.tail.sibling=null:i.sibling=null}}function $s(e){var n=null!==e.alternate&&e.alternate.child===e.child,t=0,i=0;if(n)for(var a=e.child;null!==a;)t|=a.lanes|a.childLanes,i|=14680064&a.subtreeFlags,i|=14680064&a.flags,a.return=e,a=a.sibling;else for(a=e.child;null!==a;)t|=a.lanes|a.childLanes,i|=a.subtreeFlags,i|=a.flags,a.return=e,a=a.sibling;return e.subtreeFlags|=i,e.childLanes=t,n}function qs(e,n,t){var i=n.pendingProps;switch(nr(n),n.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return $s(n),null;case 1:case 17:return Oa(n.type)&&Ta(),$s(n),null;case 3:return i=n.stateNode,Qr(),Ca(Ea),Ca(Ma),to(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),null!==e&&null!==e.child||(dr(n)?n.flags|=4:null===e||e.memoizedState.isDehydrated&&!(256&n.flags)||(n.flags|=1024,null!==rr&&(rc(rr),rr=null))),$s(n),null;case 5:Xr(n);var a=Kr(Yr.current);if(t=n.type,null!==e&&null!=n.stateNode)Os(e,n,t,i),e.ref!==n.ref&&(n.flags|=512,n.flags|=2097152);else{if(!i){if(null===n.stateNode)throw Error(r(166));return $s(n),null}if(e=Kr($r.current),dr(n)){i=n.stateNode,t=n.type;var o=n.memoizedProps;switch(i[ma]=n,i[pa]=o,e=!!(1&n.mode),t){case"dialog":_i("cancel",i),_i("close",i);break;case"iframe":case"object":case"embed":_i("load",i);break;case"video":case"audio":for(a=0;a<Ai.length;a++)_i(Ai[a],i);break;case"source":_i("error",i);break;case"img":case"image":case"link":_i("error",i),_i("load",i);break;case"details":_i("toggle",i);break;case"input":Q(i,o),_i("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!o.multiple},_i("invalid",i);break;case"textarea":ae(i,o),_i("invalid",i)}for(var l in be(t,o),a=null,o)if(o.hasOwnProperty(l)){var c=o[l];"children"===l?"string"==typeof c?i.textContent!==c&&(!0!==o.suppressHydrationWarning&&Xi(i.textContent,c,e),a=["children",c]):"number"==typeof c&&i.textContent!==""+c&&(!0!==o.suppressHydrationWarning&&Xi(i.textContent,c,e),a=["children",""+c]):s.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&_i("scroll",i)}switch(t){case"input":q(i),J(i,o,!0);break;case"textarea":q(i),oe(i);break;case"select":case"option":break;default:"function"==typeof o.onClick&&(i.onclick=Ji)}i=a,n.updateQueue=i,null!==i&&(n.flags|=4)}else{l=9===a.nodeType?a:a.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=se(t)),"http://www.w3.org/1999/xhtml"===e?"script"===t?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"==typeof i.is?e=l.createElement(t,{is:i.is}):(e=l.createElement(t),"select"===t&&(l=e,i.multiple?l.multiple=!0:i.size&&(l.size=i.size))):e=l.createElementNS(e,t),e[ma]=n,e[pa]=i,Ds(e,n),n.stateNode=e;e:{switch(l=xe(t,i),t){case"dialog":_i("cancel",e),_i("close",e),a=i;break;case"iframe":case"object":case"embed":_i("load",e),a=i;break;case"video":case"audio":for(a=0;a<Ai.length;a++)_i(Ai[a],e);a=i;break;case"source":_i("error",e),a=i;break;case"img":case"image":case"link":_i("error",e),_i("load",e),a=i;break;case"details":_i("toggle",e),a=i;break;case"input":Q(e,i),a=G(e,i),_i("invalid",e);break;case"option":default:a=i;break;case"select":e._wrapperState={wasMultiple:!!i.multiple},a=R({},i,{value:void 0}),_i("invalid",e);break;case"textarea":ae(e,i),a=ie(e,i),_i("invalid",e)}for(o in be(t,a),c=a)if(c.hasOwnProperty(o)){var u=c[o];"style"===o?fe(e,u):"dangerouslySetInnerHTML"===o?null!=(u=u?u.__html:void 0)&&de(e,u):"children"===o?"string"==typeof u?("textarea"!==t||""!==u)&&me(e,u):"number"==typeof u&&me(e,""+u):"suppressContentEditableWarning"!==o&&"suppressHydrationWarning"!==o&&"autoFocus"!==o&&(s.hasOwnProperty(o)?null!=u&&"onScroll"===o&&_i("scroll",e):null!=u&&x(e,o,u,l))}switch(t){case"input":q(e),J(e,i,!1);break;case"textarea":q(e),oe(e);break;case"option":null!=i.value&&e.setAttribute("value",""+W(i.value));break;case"select":e.multiple=!!i.multiple,null!=(o=i.value)?te(e,!!i.multiple,o,!1):null!=i.defaultValue&&te(e,!!i.multiple,i.defaultValue,!0);break;default:"function"==typeof a.onClick&&(e.onclick=Ji)}switch(t){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(n.flags|=4)}null!==n.ref&&(n.flags|=512,n.flags|=2097152)}return $s(n),null;case 6:if(e&&null!=n.stateNode)Ts(0,n,e.memoizedProps,i);else{if("string"!=typeof i&&null===n.stateNode)throw Error(r(166));if(t=Kr(Yr.current),Kr($r.current),dr(n)){if(i=n.stateNode,t=n.memoizedProps,i[ma]=n,(o=i.nodeValue!==t)&&null!==(e=tr))switch(e.tag){case 3:Xi(i.nodeValue,t,!!(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Xi(i.nodeValue,t,!!(1&e.mode))}o&&(n.flags|=4)}else(i=(9===t.nodeType?t:t.ownerDocument).createTextNode(i))[ma]=n,n.stateNode=i}return $s(n),null;case 13:if(Ca(Jr),i=n.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(ar&&null!==ir&&1&n.mode&&!(128&n.flags))mr(),pr(),n.flags|=98560,o=!1;else if(o=dr(n),null!==i&&null!==i.dehydrated){if(null===e){if(!o)throw Error(r(318));if(!(o=null!==(o=n.memoizedState)?o.dehydrated:null))throw Error(r(317));o[ma]=n}else pr(),!(128&n.flags)&&(n.memoizedState=null),n.flags|=4;$s(n),o=!1}else null!==rr&&(rc(rr),rr=null),o=!0;if(!o)return 65536&n.flags?n:null}return 128&n.flags?(n.lanes=t,n):((i=null!==i)!==(null!==e&&null!==e.memoizedState)&&i&&(n.child.flags|=8192,1&n.mode&&(null===e||1&Jr.current?0===Tl&&(Tl=3):hc())),null!==n.updateQueue&&(n.flags|=4),$s(n),null);case 4:return Qr(),null===e&&Vi(n.stateNode.containerInfo),$s(n),null;case 10:return Pr(n.type._context),$s(n),null;case 19:if(Ca(Jr),null===(o=n.memoizedState))return $s(n),null;if(i=!!(128&n.flags),null===(l=o.rendering))if(i)Ws(o,!1);else{if(0!==Tl||null!==e&&128&e.flags)for(e=n.child;null!==e;){if(null!==(l=eo(e))){for(n.flags|=128,Ws(o,!1),null!==(i=l.updateQueue)&&(n.updateQueue=i,n.flags|=4),n.subtreeFlags=0,i=t,t=n.child;null!==t;)e=i,(o=t).flags&=14680066,null===(l=o.alternate)?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=l.childLanes,o.lanes=l.lanes,o.child=l.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=l.memoizedProps,o.memoizedState=l.memoizedState,o.updateQueue=l.updateQueue,o.type=l.type,e=l.dependencies,o.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),t=t.sibling;return Na(Jr,1&Jr.current|2),n.child}e=e.sibling}null!==o.tail&&Ze()>Ul&&(n.flags|=128,i=!0,Ws(o,!1),n.lanes=4194304)}else{if(!i)if(null!==(e=eo(l))){if(n.flags|=128,i=!0,null!==(t=e.updateQueue)&&(n.updateQueue=t,n.flags|=4),Ws(o,!0),null===o.tail&&"hidden"===o.tailMode&&!l.alternate&&!ar)return $s(n),null}else 2*Ze()-o.renderingStartTime>Ul&&1073741824!==t&&(n.flags|=128,i=!0,Ws(o,!1),n.lanes=4194304);o.isBackwards?(l.sibling=n.child,n.child=l):(null!==(t=o.last)?t.sibling=l:n.child=l,o.last=l)}return null!==o.tail?(n=o.tail,o.rendering=n,o.tail=n.sibling,o.renderingStartTime=Ze(),n.sibling=null,t=Jr.current,Na(Jr,i?1&t|2:1&t),n):($s(n),null);case 22:case 23:return uc(),i=null!==n.memoizedState,null!==e&&null!==e.memoizedState!==i&&(n.flags|=8192),i&&1&n.mode?!!(1073741824&Dl)&&($s(n),6&n.subtreeFlags&&(n.flags|=8192)):$s(n),null;case 24:case 25:return null}throw Error(r(156,n.tag))}function Ys(e,n){switch(nr(n),n.tag){case 1:return Oa(n.type)&&Ta(),65536&(e=n.flags)?(n.flags=-65537&e|128,n):null;case 3:return Qr(),Ca(Ea),Ca(Ma),to(),65536&(e=n.flags)&&!(128&e)?(n.flags=-65537&e|128,n):null;case 5:return Xr(n),null;case 13:if(Ca(Jr),null!==(e=n.memoizedState)&&null!==e.dehydrated){if(null===n.alternate)throw Error(r(340));pr()}return 65536&(e=n.flags)?(n.flags=-65537&e|128,n):null;case 19:return Ca(Jr),null;case 4:return Qr(),null;case 10:return Pr(n.type._context),null;case 22:case 23:return uc(),null;default:return null}}Ds=function(e,n){for(var t=n.child;null!==t;){if(5===t.tag||6===t.tag)e.appendChild(t.stateNode);else if(4!==t.tag&&null!==t.child){t.child.return=t,t=t.child;continue}if(t===n)break;for(;null===t.sibling;){if(null===t.return||t.return===n)return;t=t.return}t.sibling.return=t.return,t=t.sibling}},Os=function(e,n,t,i){var a=e.memoizedProps;if(a!==i){e=n.stateNode,Kr($r.current);var r,o=null;switch(t){case"input":a=G(e,a),i=G(e,i),o=[];break;case"select":a=R({},a,{value:void 0}),i=R({},i,{value:void 0}),o=[];break;case"textarea":a=ie(e,a),i=ie(e,i),o=[];break;default:"function"!=typeof a.onClick&&"function"==typeof i.onClick&&(e.onclick=Ji)}for(u in be(t,i),t=null,a)if(!i.hasOwnProperty(u)&&a.hasOwnProperty(u)&&null!=a[u])if("style"===u){var l=a[u];for(r in l)l.hasOwnProperty(r)&&(t||(t={}),t[r]="")}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(s.hasOwnProperty(u)?o||(o=[]):(o=o||[]).push(u,null));for(u in i){var c=i[u];if(l=null!=a?a[u]:void 0,i.hasOwnProperty(u)&&c!==l&&(null!=c||null!=l))if("style"===u)if(l){for(r in l)!l.hasOwnProperty(r)||c&&c.hasOwnProperty(r)||(t||(t={}),t[r]="");for(r in c)c.hasOwnProperty(r)&&l[r]!==c[r]&&(t||(t={}),t[r]=c[r])}else t||(o||(o=[]),o.push(u,t)),t=c;else"dangerouslySetInnerHTML"===u?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(o=o||[]).push(u,c)):"children"===u?"string"!=typeof c&&"number"!=typeof c||(o=o||[]).push(u,""+c):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(s.hasOwnProperty(u)?(null!=c&&"onScroll"===u&&_i("scroll",e),o||l===c||(o=[])):(o=o||[]).push(u,c))}t&&(o=o||[]).push("style",t);var u=o;(n.updateQueue=u)&&(n.flags|=4)}},Ts=function(e,n,t,i){t!==i&&(n.flags|=4)};var Ks=!1,Gs=!1,Qs="function"==typeof WeakSet?WeakSet:Set,Zs=null;function Xs(e,n){var t=e.ref;if(null!==t)if("function"==typeof t)try{t(null)}catch(t){jc(e,n,t)}else t.current=null}function Js(e,n,t){try{t()}catch(t){jc(e,n,t)}}var el=!1;function nl(e,n,t){var i=n.updateQueue;if(null!==(i=null!==i?i.lastEffect:null)){var a=i=i.next;do{if((a.tag&e)===e){var r=a.destroy;a.destroy=void 0,void 0!==r&&Js(n,t,r)}a=a.next}while(a!==i)}}function tl(e,n){if(null!==(n=null!==(n=n.updateQueue)?n.lastEffect:null)){var t=n=n.next;do{if((t.tag&e)===e){var i=t.create;t.destroy=i()}t=t.next}while(t!==n)}}function il(e){var n=e.ref;if(null!==n){var t=e.stateNode;e.tag,e=t,"function"==typeof n?n(e):n.current=e}}function al(e){var n=e.alternate;null!==n&&(e.alternate=null,al(n)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(n=e.stateNode)&&(delete n[ma],delete n[pa],delete n[va],delete n[fa],delete n[ga])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function rl(e){return 5===e.tag||3===e.tag||4===e.tag}function ol(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||rl(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function sl(e,n,t){var i=e.tag;if(5===i||6===i)e=e.stateNode,n?8===t.nodeType?t.parentNode.insertBefore(e,n):t.insertBefore(e,n):(8===t.nodeType?(n=t.parentNode).insertBefore(e,t):(n=t).appendChild(e),null!=(t=t._reactRootContainer)||null!==n.onclick||(n.onclick=Ji));else if(4!==i&&null!==(e=e.child))for(sl(e,n,t),e=e.sibling;null!==e;)sl(e,n,t),e=e.sibling}function ll(e,n,t){var i=e.tag;if(5===i||6===i)e=e.stateNode,n?t.insertBefore(e,n):t.appendChild(e);else if(4!==i&&null!==(e=e.child))for(ll(e,n,t),e=e.sibling;null!==e;)ll(e,n,t),e=e.sibling}var cl=null,ul=!1;function dl(e,n,t){for(t=t.child;null!==t;)ml(e,n,t),t=t.sibling}function ml(e,n,t){if(on&&"function"==typeof on.onCommitFiberUnmount)try{on.onCommitFiberUnmount(rn,t)}catch(e){}switch(t.tag){case 5:Gs||Xs(t,n);case 6:var i=cl,a=ul;cl=null,dl(e,n,t),ul=a,null!==(cl=i)&&(ul?(e=cl,t=t.stateNode,8===e.nodeType?e.parentNode.removeChild(t):e.removeChild(t)):cl.removeChild(t.stateNode));break;case 18:null!==cl&&(ul?(e=cl,t=t.stateNode,8===e.nodeType?la(e.parentNode,t):1===e.nodeType&&la(e,t),Hn(e)):la(cl,t.stateNode));break;case 4:i=cl,a=ul,cl=t.stateNode.containerInfo,ul=!0,dl(e,n,t),cl=i,ul=a;break;case 0:case 11:case 14:case 15:if(!Gs&&(null!==(i=t.updateQueue)&&null!==(i=i.lastEffect))){a=i=i.next;do{var r=a,o=r.destroy;r=r.tag,void 0!==o&&(2&r||4&r)&&Js(t,n,o),a=a.next}while(a!==i)}dl(e,n,t);break;case 1:if(!Gs&&(Xs(t,n),"function"==typeof(i=t.stateNode).componentWillUnmount))try{i.props=t.memoizedProps,i.state=t.memoizedState,i.componentWillUnmount()}catch(e){jc(t,n,e)}dl(e,n,t);break;case 21:dl(e,n,t);break;case 22:1&t.mode?(Gs=(i=Gs)||null!==t.memoizedState,dl(e,n,t),Gs=i):dl(e,n,t);break;default:dl(e,n,t)}}function pl(e){var n=e.updateQueue;if(null!==n){e.updateQueue=null;var t=e.stateNode;null===t&&(t=e.stateNode=new Qs),n.forEach(function(n){var i=Pc.bind(null,e,n);t.has(n)||(t.add(n),n.then(i,i))})}}function hl(e,n){var t=n.deletions;if(null!==t)for(var i=0;i<t.length;i++){var a=t[i];try{var o=e,s=n,l=s;e:for(;null!==l;){switch(l.tag){case 5:cl=l.stateNode,ul=!1;break e;case 3:case 4:cl=l.stateNode.containerInfo,ul=!0;break e}l=l.return}if(null===cl)throw Error(r(160));ml(o,s,a),cl=null,ul=!1;var c=a.alternate;null!==c&&(c.return=null),a.return=null}catch(e){jc(a,n,e)}}if(12854&n.subtreeFlags)for(n=n.child;null!==n;)vl(n,e),n=n.sibling}function vl(e,n){var t=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(hl(n,e),fl(e),4&i){try{nl(3,e,e.return),tl(3,e)}catch(n){jc(e,e.return,n)}try{nl(5,e,e.return)}catch(n){jc(e,e.return,n)}}break;case 1:hl(n,e),fl(e),512&i&&null!==t&&Xs(t,t.return);break;case 5:if(hl(n,e),fl(e),512&i&&null!==t&&Xs(t,t.return),32&e.flags){var a=e.stateNode;try{me(a,"")}catch(n){jc(e,e.return,n)}}if(4&i&&null!=(a=e.stateNode)){var o=e.memoizedProps,s=null!==t?t.memoizedProps:o,l=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===l&&"radio"===o.type&&null!=o.name&&Z(a,o),xe(l,s);var u=xe(l,o);for(s=0;s<c.length;s+=2){var d=c[s],m=c[s+1];"style"===d?fe(a,m):"dangerouslySetInnerHTML"===d?de(a,m):"children"===d?me(a,m):x(a,d,m,u)}switch(l){case"input":X(a,o);break;case"textarea":re(a,o);break;case"select":var p=a._wrapperState.wasMultiple;a._wrapperState.wasMultiple=!!o.multiple;var h=o.value;null!=h?te(a,!!o.multiple,h,!1):p!==!!o.multiple&&(null!=o.defaultValue?te(a,!!o.multiple,o.defaultValue,!0):te(a,!!o.multiple,o.multiple?[]:"",!1))}a[pa]=o}catch(n){jc(e,e.return,n)}}break;case 6:if(hl(n,e),fl(e),4&i){if(null===e.stateNode)throw Error(r(162));a=e.stateNode,o=e.memoizedProps;try{a.nodeValue=o}catch(n){jc(e,e.return,n)}}break;case 3:if(hl(n,e),fl(e),4&i&&null!==t&&t.memoizedState.isDehydrated)try{Hn(n.containerInfo)}catch(n){jc(e,e.return,n)}break;case 4:default:hl(n,e),fl(e);break;case 13:hl(n,e),fl(e),8192&(a=e.child).flags&&(o=null!==a.memoizedState,a.stateNode.isHidden=o,!o||null!==a.alternate&&null!==a.alternate.memoizedState||(Fl=Ze())),4&i&&pl(e);break;case 22:if(d=null!==t&&null!==t.memoizedState,1&e.mode?(Gs=(u=Gs)||d,hl(n,e),Gs=u):hl(n,e),fl(e),8192&i){if(u=null!==e.memoizedState,(e.stateNode.isHidden=u)&&!d&&1&e.mode)for(Zs=e,d=e.child;null!==d;){for(m=Zs=d;null!==Zs;){switch(h=(p=Zs).child,p.tag){case 0:case 11:case 14:case 15:nl(4,p,p.return);break;case 1:Xs(p,p.return);var v=p.stateNode;if("function"==typeof v.componentWillUnmount){i=p,t=p.return;try{n=i,v.props=n.memoizedProps,v.state=n.memoizedState,v.componentWillUnmount()}catch(e){jc(i,t,e)}}break;case 5:Xs(p,p.return);break;case 22:if(null!==p.memoizedState){yl(m);continue}}null!==h?(h.return=p,Zs=h):yl(m)}d=d.sibling}e:for(d=null,m=e;;){if(5===m.tag){if(null===d){d=m;try{a=m.stateNode,u?"function"==typeof(o=a.style).setProperty?o.setProperty("display","none","important"):o.display="none":(l=m.stateNode,s=null!=(c=m.memoizedProps.style)&&c.hasOwnProperty("display")?c.display:null,l.style.display=ve("display",s))}catch(n){jc(e,e.return,n)}}}else if(6===m.tag){if(null===d)try{m.stateNode.nodeValue=u?"":m.memoizedProps}catch(n){jc(e,e.return,n)}}else if((22!==m.tag&&23!==m.tag||null===m.memoizedState||m===e)&&null!==m.child){m.child.return=m,m=m.child;continue}if(m===e)break e;for(;null===m.sibling;){if(null===m.return||m.return===e)break e;d===m&&(d=null),m=m.return}d===m&&(d=null),m.sibling.return=m.return,m=m.sibling}}break;case 19:hl(n,e),fl(e),4&i&&pl(e);case 21:}}function fl(e){var n=e.flags;if(2&n){try{e:{for(var t=e.return;null!==t;){if(rl(t)){var i=t;break e}t=t.return}throw Error(r(160))}switch(i.tag){case 5:var a=i.stateNode;32&i.flags&&(me(a,""),i.flags&=-33),ll(e,ol(e),a);break;case 3:case 4:var o=i.stateNode.containerInfo;sl(e,ol(e),o);break;default:throw Error(r(161))}}catch(n){jc(e,e.return,n)}e.flags&=-3}4096&n&&(e.flags&=-4097)}function gl(e,n,t){Zs=e,bl(e,n,t)}function bl(e,n,t){for(var i=!!(1&e.mode);null!==Zs;){var a=Zs,r=a.child;if(22===a.tag&&i){var o=null!==a.memoizedState||Ks;if(!o){var s=a.alternate,l=null!==s&&null!==s.memoizedState||Gs;s=Ks;var c=Gs;if(Ks=o,(Gs=l)&&!c)for(Zs=a;null!==Zs;)l=(o=Zs).child,22===o.tag&&null!==o.memoizedState?kl(a):null!==l?(l.return=o,Zs=l):kl(a);for(;null!==r;)Zs=r,bl(r,n,t),r=r.sibling;Zs=a,Ks=s,Gs=c}xl(e)}else 8772&a.subtreeFlags&&null!==r?(r.return=a,Zs=r):xl(e)}}function xl(e){for(;null!==Zs;){var n=Zs;if(8772&n.flags){var t=n.alternate;try{if(8772&n.flags)switch(n.tag){case 0:case 11:case 15:Gs||tl(5,n);break;case 1:var i=n.stateNode;if(4&n.flags&&!Gs)if(null===t)i.componentDidMount();else{var a=n.elementType===n.type?t.memoizedProps:ts(n.type,t.memoizedProps);i.componentDidUpdate(a,t.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var o=n.updateQueue;null!==o&&Hr(n,o,i);break;case 3:var s=n.updateQueue;if(null!==s){if(t=null,null!==n.child)switch(n.child.tag){case 5:case 1:t=n.child.stateNode}Hr(n,s,t)}break;case 5:var l=n.stateNode;if(null===t&&4&n.flags){t=l;var c=n.memoizedProps;switch(n.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&t.focus();break;case"img":c.src&&(t.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===n.memoizedState){var u=n.alternate;if(null!==u){var d=u.memoizedState;if(null!==d){var m=d.dehydrated;null!==m&&Hn(m)}}}break;default:throw Error(r(163))}Gs||512&n.flags&&il(n)}catch(e){jc(n,n.return,e)}}if(n===e){Zs=null;break}if(null!==(t=n.sibling)){t.return=n.return,Zs=t;break}Zs=n.return}}function yl(e){for(;null!==Zs;){var n=Zs;if(n===e){Zs=null;break}var t=n.sibling;if(null!==t){t.return=n.return,Zs=t;break}Zs=n.return}}function kl(e){for(;null!==Zs;){var n=Zs;try{switch(n.tag){case 0:case 11:case 15:var t=n.return;try{tl(4,n)}catch(e){jc(n,t,e)}break;case 1:var i=n.stateNode;if("function"==typeof i.componentDidMount){var a=n.return;try{i.componentDidMount()}catch(e){jc(n,a,e)}}var r=n.return;try{il(n)}catch(e){jc(n,r,e)}break;case 5:var o=n.return;try{il(n)}catch(e){jc(n,o,e)}}}catch(e){jc(n,n.return,e)}if(n===e){Zs=null;break}var s=n.sibling;if(null!==s){s.return=n.return,Zs=s;break}Zs=n.return}}var wl,jl=Math.ceil,Sl=y.ReactCurrentDispatcher,Cl=y.ReactCurrentOwner,Nl=y.ReactCurrentBatchConfig,Pl=0,Ml=null,El=null,Ll=0,Dl=0,Ol=Sa(0),Tl=0,zl=null,Al=0,Il=0,Rl=0,Bl=null,_l=null,Fl=0,Ul=1/0,Vl=null,Hl=!1,Wl=null,$l=null,ql=!1,Yl=null,Kl=0,Gl=0,Ql=null,Zl=-1,Xl=0;function Jl(){return 6&Pl?Ze():-1!==Zl?Zl:Zl=Ze()}function ec(e){return 1&e.mode?2&Pl&&0!==Ll?Ll&-Ll:null!==vr.transition?(0===Xl&&(Xl=fn()),Xl):0!==(e=yn)?e:e=void 0===(e=window.event)?16:Zn(e.type):1}function nc(e,n,t,i){if(50<Gl)throw Gl=0,Ql=null,Error(r(185));bn(e,t,i),2&Pl&&e===Ml||(e===Ml&&(!(2&Pl)&&(Il|=t),4===Tl&&oc(e,Ll)),tc(e,i),1===t&&0===Pl&&!(1&n.mode)&&(Ul=Ze()+500,_a&&Va()))}function tc(e,n){var t=e.callbackNode;!function(e,n){for(var t=e.suspendedLanes,i=e.pingedLanes,a=e.expirationTimes,r=e.pendingLanes;0<r;){var o=31-sn(r),s=1<<o,l=a[o];-1===l?0!==(s&t)&&0===(s&i)||(a[o]=hn(s,n)):l<=n&&(e.expiredLanes|=s),r&=~s}}(e,n);var i=pn(e,e===Ml?Ll:0);if(0===i)null!==t&&Ke(t),e.callbackNode=null,e.callbackPriority=0;else if(n=i&-i,e.callbackPriority!==n){if(null!=t&&Ke(t),1===n)0===e.tag?function(e){_a=!0,Ua(e)}(sc.bind(null,e)):Ua(sc.bind(null,e)),oa(function(){!(6&Pl)&&Va()}),t=null;else{switch(kn(i)){case 1:t=Je;break;case 4:t=en;break;case 16:default:t=nn;break;case 536870912:t=an}t=Mc(t,ic.bind(null,e))}e.callbackPriority=n,e.callbackNode=t}}function ic(e,n){if(Zl=-1,Xl=0,6&Pl)throw Error(r(327));var t=e.callbackNode;if(kc()&&e.callbackNode!==t)return null;var i=pn(e,e===Ml?Ll:0);if(0===i)return null;if(30&i||0!==(i&e.expiredLanes)||n)n=vc(e,i);else{n=i;var a=Pl;Pl|=2;var o=pc();for(Ml===e&&Ll===n||(Vl=null,Ul=Ze()+500,dc(e,n));;)try{gc();break}catch(n){mc(e,n)}Nr(),Sl.current=o,Pl=a,null!==El?n=0:(Ml=null,Ll=0,n=Tl)}if(0!==n){if(2===n&&(0!==(a=vn(e))&&(i=a,n=ac(e,a))),1===n)throw t=zl,dc(e,0),oc(e,i),tc(e,Ze()),t;if(6===n)oc(e,i);else{if(a=e.current.alternate,!(30&i||function(e){for(var n=e;;){if(16384&n.flags){var t=n.updateQueue;if(null!==t&&null!==(t=t.stores))for(var i=0;i<t.length;i++){var a=t[i],r=a.getSnapshot;a=a.value;try{if(!si(r(),a))return!1}catch(e){return!1}}}if(t=n.child,16384&n.subtreeFlags&&null!==t)t.return=n,n=t;else{if(n===e)break;for(;null===n.sibling;){if(null===n.return||n.return===e)return!0;n=n.return}n.sibling.return=n.return,n=n.sibling}}return!0}(a)||(n=vc(e,i),2===n&&(o=vn(e),0!==o&&(i=o,n=ac(e,o))),1!==n)))throw t=zl,dc(e,0),oc(e,i),tc(e,Ze()),t;switch(e.finishedWork=a,e.finishedLanes=i,n){case 0:case 1:throw Error(r(345));case 2:case 5:yc(e,_l,Vl);break;case 3:if(oc(e,i),(130023424&i)===i&&10<(n=Fl+500-Ze())){if(0!==pn(e,0))break;if(((a=e.suspendedLanes)&i)!==i){Jl(),e.pingedLanes|=e.suspendedLanes&a;break}e.timeoutHandle=ia(yc.bind(null,e,_l,Vl),n);break}yc(e,_l,Vl);break;case 4:if(oc(e,i),(4194240&i)===i)break;for(n=e.eventTimes,a=-1;0<i;){var s=31-sn(i);o=1<<s,(s=n[s])>a&&(a=s),i&=~o}if(i=a,10<(i=(120>(i=Ze()-i)?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*jl(i/1960))-i)){e.timeoutHandle=ia(yc.bind(null,e,_l,Vl),i);break}yc(e,_l,Vl);break;default:throw Error(r(329))}}}return tc(e,Ze()),e.callbackNode===t?ic.bind(null,e):null}function ac(e,n){var t=Bl;return e.current.memoizedState.isDehydrated&&(dc(e,n).flags|=256),2!==(e=vc(e,n))&&(n=_l,_l=t,null!==n&&rc(n)),e}function rc(e){null===_l?_l=e:_l.push.apply(_l,e)}function oc(e,n){for(n&=~Rl,n&=~Il,e.suspendedLanes|=n,e.pingedLanes&=~n,e=e.expirationTimes;0<n;){var t=31-sn(n),i=1<<t;e[t]=-1,n&=~i}}function sc(e){if(6&Pl)throw Error(r(327));kc();var n=pn(e,0);if(!(1&n))return tc(e,Ze()),null;var t=vc(e,n);if(0!==e.tag&&2===t){var i=vn(e);0!==i&&(n=i,t=ac(e,i))}if(1===t)throw t=zl,dc(e,0),oc(e,n),tc(e,Ze()),t;if(6===t)throw Error(r(345));return e.finishedWork=e.current.alternate,e.finishedLanes=n,yc(e,_l,Vl),tc(e,Ze()),null}function lc(e,n){var t=Pl;Pl|=1;try{return e(n)}finally{0===(Pl=t)&&(Ul=Ze()+500,_a&&Va())}}function cc(e){null!==Yl&&0===Yl.tag&&!(6&Pl)&&kc();var n=Pl;Pl|=1;var t=Nl.transition,i=yn;try{if(Nl.transition=null,yn=1,e)return e()}finally{yn=i,Nl.transition=t,!(6&(Pl=n))&&Va()}}function uc(){Dl=Ol.current,Ca(Ol)}function dc(e,n){e.finishedWork=null,e.finishedLanes=0;var t=e.timeoutHandle;if(-1!==t&&(e.timeoutHandle=-1,aa(t)),null!==El)for(t=El.return;null!==t;){var i=t;switch(nr(i),i.tag){case 1:null!=(i=i.type.childContextTypes)&&Ta();break;case 3:Qr(),Ca(Ea),Ca(Ma),to();break;case 5:Xr(i);break;case 4:Qr();break;case 13:case 19:Ca(Jr);break;case 10:Pr(i.type._context);break;case 22:case 23:uc()}t=t.return}if(Ml=e,El=e=Oc(e.current,null),Ll=Dl=n,Tl=0,zl=null,Rl=Il=Al=0,_l=Bl=null,null!==Dr){for(n=0;n<Dr.length;n++)if(null!==(i=(t=Dr[n]).interleaved)){t.interleaved=null;var a=i.next,r=t.pending;if(null!==r){var o=r.next;r.next=a,i.next=o}t.pending=i}Dr=null}return e}function mc(e,n){for(;;){var t=El;try{if(Nr(),io.current=Xo,co){for(var i=oo.memoizedState;null!==i;){var a=i.queue;null!==a&&(a.pending=null),i=i.next}co=!1}if(ro=0,lo=so=oo=null,uo=!1,mo=0,Cl.current=null,null===t||null===t.return){Tl=1,zl=n,El=null;break}e:{var o=e,s=t.return,l=t,c=n;if(n=Ll,l.flags|=32768,null!==c&&"object"==typeof c&&"function"==typeof c.then){var u=c,d=l,m=d.tag;if(!(1&d.mode||0!==m&&11!==m&&15!==m)){var p=d.alternate;p?(d.updateQueue=p.updateQueue,d.memoizedState=p.memoizedState,d.lanes=p.lanes):(d.updateQueue=null,d.memoizedState=null)}var h=fs(s);if(null!==h){h.flags&=-257,gs(h,s,l,0,n),1&h.mode&&vs(o,u,n),c=u;var v=(n=h).updateQueue;if(null===v){var f=new Set;f.add(c),n.updateQueue=f}else v.add(c);break e}if(!(1&n)){vs(o,u,n),hc();break e}c=Error(r(426))}else if(ar&&1&l.mode){var g=fs(s);if(null!==g){!(65536&g.flags)&&(g.flags|=256),gs(g,s,l,0,n),hr(cs(c,l));break e}}o=c=cs(c,l),4!==Tl&&(Tl=2),null===Bl?Bl=[o]:Bl.push(o),o=s;do{switch(o.tag){case 3:o.flags|=65536,n&=-n,o.lanes|=n,Ur(o,ps(0,c,n));break e;case 1:l=c;var b=o.type,x=o.stateNode;if(!(128&o.flags||"function"!=typeof b.getDerivedStateFromError&&(null===x||"function"!=typeof x.componentDidCatch||null!==$l&&$l.has(x)))){o.flags|=65536,n&=-n,o.lanes|=n,Ur(o,hs(o,l,n));break e}}o=o.return}while(null!==o)}xc(t)}catch(e){n=e,El===t&&null!==t&&(El=t=t.return);continue}break}}function pc(){var e=Sl.current;return Sl.current=Xo,null===e?Xo:e}function hc(){0!==Tl&&3!==Tl&&2!==Tl||(Tl=4),null===Ml||!(268435455&Al)&&!(268435455&Il)||oc(Ml,Ll)}function vc(e,n){var t=Pl;Pl|=2;var i=pc();for(Ml===e&&Ll===n||(Vl=null,dc(e,n));;)try{fc();break}catch(n){mc(e,n)}if(Nr(),Pl=t,Sl.current=i,null!==El)throw Error(r(261));return Ml=null,Ll=0,Tl}function fc(){for(;null!==El;)bc(El)}function gc(){for(;null!==El&&!Ge();)bc(El)}function bc(e){var n=wl(e.alternate,e,Dl);e.memoizedProps=e.pendingProps,null===n?xc(e):El=n,Cl.current=null}function xc(e){var n=e;do{var t=n.alternate;if(e=n.return,32768&n.flags){if(null!==(t=Ys(t,n)))return t.flags&=32767,void(El=t);if(null===e)return Tl=6,void(El=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}else if(null!==(t=qs(t,n,Dl)))return void(El=t);if(null!==(n=n.sibling))return void(El=n);El=n=e}while(null!==n);0===Tl&&(Tl=5)}function yc(e,n,t){var i=yn,a=Nl.transition;try{Nl.transition=null,yn=1,function(e,n,t,i){do{kc()}while(null!==Yl);if(6&Pl)throw Error(r(327));t=e.finishedWork;var a=e.finishedLanes;if(null===t)return null;if(e.finishedWork=null,e.finishedLanes=0,t===e.current)throw Error(r(177));e.callbackNode=null,e.callbackPriority=0;var o=t.lanes|t.childLanes;if(function(e,n){var t=e.pendingLanes&~n;e.pendingLanes=n,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=n,e.mutableReadLanes&=n,e.entangledLanes&=n,n=e.entanglements;var i=e.eventTimes;for(e=e.expirationTimes;0<t;){var a=31-sn(t),r=1<<a;n[a]=0,i[a]=-1,e[a]=-1,t&=~r}}(e,o),e===Ml&&(El=Ml=null,Ll=0),!(2064&t.subtreeFlags)&&!(2064&t.flags)||ql||(ql=!0,Mc(nn,function(){return kc(),null})),o=!!(15990&t.flags),!!(15990&t.subtreeFlags)||o){o=Nl.transition,Nl.transition=null;var s=yn;yn=1;var l=Pl;Pl|=4,Cl.current=null,function(e,n){if(ea=$n,pi(e=mi())){if("selectionStart"in e)var t={start:e.selectionStart,end:e.selectionEnd};else e:{var i=(t=(t=e.ownerDocument)&&t.defaultView||window).getSelection&&t.getSelection();if(i&&0!==i.rangeCount){t=i.anchorNode;var a=i.anchorOffset,o=i.focusNode;i=i.focusOffset;try{t.nodeType,o.nodeType}catch(e){t=null;break e}var s=0,l=-1,c=-1,u=0,d=0,m=e,p=null;n:for(;;){for(var h;m!==t||0!==a&&3!==m.nodeType||(l=s+a),m!==o||0!==i&&3!==m.nodeType||(c=s+i),3===m.nodeType&&(s+=m.nodeValue.length),null!==(h=m.firstChild);)p=m,m=h;for(;;){if(m===e)break n;if(p===t&&++u===a&&(l=s),p===o&&++d===i&&(c=s),null!==(h=m.nextSibling))break;p=(m=p).parentNode}m=h}t=-1===l||-1===c?null:{start:l,end:c}}else t=null}t=t||{start:0,end:0}}else t=null;for(na={focusedElem:e,selectionRange:t},$n=!1,Zs=n;null!==Zs;)if(e=(n=Zs).child,1028&n.subtreeFlags&&null!==e)e.return=n,Zs=e;else for(;null!==Zs;){n=Zs;try{var v=n.alternate;if(1024&n.flags)switch(n.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==v){var f=v.memoizedProps,g=v.memoizedState,b=n.stateNode,x=b.getSnapshotBeforeUpdate(n.elementType===n.type?f:ts(n.type,f),g);b.__reactInternalSnapshotBeforeUpdate=x}break;case 3:var y=n.stateNode.containerInfo;1===y.nodeType?y.textContent="":9===y.nodeType&&y.documentElement&&y.removeChild(y.documentElement);break;default:throw Error(r(163))}}catch(e){jc(n,n.return,e)}if(null!==(e=n.sibling)){e.return=n.return,Zs=e;break}Zs=n.return}v=el,el=!1}(e,t),vl(t,e),hi(na),$n=!!ea,na=ea=null,e.current=t,gl(t,e,a),Qe(),Pl=l,yn=s,Nl.transition=o}else e.current=t;if(ql&&(ql=!1,Yl=e,Kl=a),o=e.pendingLanes,0===o&&($l=null),function(e){if(on&&"function"==typeof on.onCommitFiberRoot)try{on.onCommitFiberRoot(rn,e,void 0,!(128&~e.current.flags))}catch(e){}}(t.stateNode),tc(e,Ze()),null!==n)for(i=e.onRecoverableError,t=0;t<n.length;t++)a=n[t],i(a.value,{componentStack:a.stack,digest:a.digest});if(Hl)throw Hl=!1,e=Wl,Wl=null,e;!!(1&Kl)&&0!==e.tag&&kc(),o=e.pendingLanes,1&o?e===Ql?Gl++:(Gl=0,Ql=e):Gl=0,Va()}(e,n,t,i)}finally{Nl.transition=a,yn=i}return null}function kc(){if(null!==Yl){var e=kn(Kl),n=Nl.transition,t=yn;try{if(Nl.transition=null,yn=16>e?16:e,null===Yl)var i=!1;else{if(e=Yl,Yl=null,Kl=0,6&Pl)throw Error(r(331));var a=Pl;for(Pl|=4,Zs=e.current;null!==Zs;){var o=Zs,s=o.child;if(16&Zs.flags){var l=o.deletions;if(null!==l){for(var c=0;c<l.length;c++){var u=l[c];for(Zs=u;null!==Zs;){var d=Zs;switch(d.tag){case 0:case 11:case 15:nl(8,d,o)}var m=d.child;if(null!==m)m.return=d,Zs=m;else for(;null!==Zs;){var p=(d=Zs).sibling,h=d.return;if(al(d),d===u){Zs=null;break}if(null!==p){p.return=h,Zs=p;break}Zs=h}}}var v=o.alternate;if(null!==v){var f=v.child;if(null!==f){v.child=null;do{var g=f.sibling;f.sibling=null,f=g}while(null!==f)}}Zs=o}}if(2064&o.subtreeFlags&&null!==s)s.return=o,Zs=s;else e:for(;null!==Zs;){if(2048&(o=Zs).flags)switch(o.tag){case 0:case 11:case 15:nl(9,o,o.return)}var b=o.sibling;if(null!==b){b.return=o.return,Zs=b;break e}Zs=o.return}}var x=e.current;for(Zs=x;null!==Zs;){var y=(s=Zs).child;if(2064&s.subtreeFlags&&null!==y)y.return=s,Zs=y;else e:for(s=x;null!==Zs;){if(2048&(l=Zs).flags)try{switch(l.tag){case 0:case 11:case 15:tl(9,l)}}catch(e){jc(l,l.return,e)}if(l===s){Zs=null;break e}var k=l.sibling;if(null!==k){k.return=l.return,Zs=k;break e}Zs=l.return}}if(Pl=a,Va(),on&&"function"==typeof on.onPostCommitFiberRoot)try{on.onPostCommitFiberRoot(rn,e)}catch(e){}i=!0}return i}finally{yn=t,Nl.transition=n}}return!1}function wc(e,n,t){e=_r(e,n=ps(0,n=cs(t,n),1),1),n=Jl(),null!==e&&(bn(e,1,n),tc(e,n))}function jc(e,n,t){if(3===e.tag)wc(e,e,t);else for(;null!==n;){if(3===n.tag){wc(n,e,t);break}if(1===n.tag){var i=n.stateNode;if("function"==typeof n.type.getDerivedStateFromError||"function"==typeof i.componentDidCatch&&(null===$l||!$l.has(i))){n=_r(n,e=hs(n,e=cs(t,e),1),1),e=Jl(),null!==n&&(bn(n,1,e),tc(n,e));break}}n=n.return}}function Sc(e,n,t){var i=e.pingCache;null!==i&&i.delete(n),n=Jl(),e.pingedLanes|=e.suspendedLanes&t,Ml===e&&(Ll&t)===t&&(4===Tl||3===Tl&&(130023424&Ll)===Ll&&500>Ze()-Fl?dc(e,0):Rl|=t),tc(e,n)}function Cc(e,n){0===n&&(1&e.mode?(n=dn,!(130023424&(dn<<=1))&&(dn=4194304)):n=1);var t=Jl();null!==(e=zr(e,n))&&(bn(e,n,t),tc(e,t))}function Nc(e){var n=e.memoizedState,t=0;null!==n&&(t=n.retryLane),Cc(e,t)}function Pc(e,n){var t=0;switch(e.tag){case 13:var i=e.stateNode,a=e.memoizedState;null!==a&&(t=a.retryLane);break;case 19:i=e.stateNode;break;default:throw Error(r(314))}null!==i&&i.delete(n),Cc(e,t)}function Mc(e,n){return Ye(e,n)}function Ec(e,n,t,i){this.tag=e,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=n,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Lc(e,n,t,i){return new Ec(e,n,t,i)}function Dc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Oc(e,n){var t=e.alternate;return null===t?((t=Lc(e.tag,n,e.key,e.mode)).elementType=e.elementType,t.type=e.type,t.stateNode=e.stateNode,t.alternate=e,e.alternate=t):(t.pendingProps=n,t.type=e.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=14680064&e.flags,t.childLanes=e.childLanes,t.lanes=e.lanes,t.child=e.child,t.memoizedProps=e.memoizedProps,t.memoizedState=e.memoizedState,t.updateQueue=e.updateQueue,n=e.dependencies,t.dependencies=null===n?null:{lanes:n.lanes,firstContext:n.firstContext},t.sibling=e.sibling,t.index=e.index,t.ref=e.ref,t}function Tc(e,n,t,i,a,o){var s=2;if(i=e,"function"==typeof e)Dc(e)&&(s=1);else if("string"==typeof e)s=5;else e:switch(e){case j:return zc(t.children,a,o,n);case S:s=8,a|=8;break;case C:return(e=Lc(12,t,n,2|a)).elementType=C,e.lanes=o,e;case E:return(e=Lc(13,t,n,a)).elementType=E,e.lanes=o,e;case L:return(e=Lc(19,t,n,a)).elementType=L,e.lanes=o,e;case T:return Ac(t,a,o,n);default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case N:s=10;break e;case P:s=9;break e;case M:s=11;break e;case D:s=14;break e;case O:s=16,i=null;break e}throw Error(r(130,null==e?e:typeof e,""))}return(n=Lc(s,t,n,a)).elementType=e,n.type=i,n.lanes=o,n}function zc(e,n,t,i){return(e=Lc(7,e,i,n)).lanes=t,e}function Ac(e,n,t,i){return(e=Lc(22,e,i,n)).elementType=T,e.lanes=t,e.stateNode={isHidden:!1},e}function Ic(e,n,t){return(e=Lc(6,e,null,n)).lanes=t,e}function Rc(e,n,t){return(n=Lc(4,null!==e.children?e.children:[],e.key,n)).lanes=t,n.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},n}function Bc(e,n,t,i,a){this.tag=n,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gn(0),this.expirationTimes=gn(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gn(0),this.identifierPrefix=i,this.onRecoverableError=a,this.mutableSourceEagerHydrationData=null}function _c(e,n,t,i,a,r,o,s,l){return e=new Bc(e,n,t,s,l),1===n?(n=1,!0===r&&(n|=8)):n=0,r=Lc(3,null,null,n),e.current=r,r.stateNode=e,r.memoizedState={element:i,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ir(r),e}function Fc(e){if(!e)return Pa;e:{if(Ve(e=e._reactInternals)!==e||1!==e.tag)throw Error(r(170));var n=e;do{switch(n.tag){case 3:n=n.stateNode.context;break e;case 1:if(Oa(n.type)){n=n.stateNode.__reactInternalMemoizedMergedChildContext;break e}}n=n.return}while(null!==n);throw Error(r(171))}if(1===e.tag){var t=e.type;if(Oa(t))return Aa(e,t,n)}return n}function Uc(e,n,t,i,a,r,o,s,l){return(e=_c(t,i,!0,e,0,r,0,s,l)).context=Fc(null),t=e.current,(r=Br(i=Jl(),a=ec(t))).callback=null!=n?n:null,_r(t,r,a),e.current.lanes=a,bn(e,a,i),tc(e,i),e}function Vc(e,n,t,i){var a=n.current,r=Jl(),o=ec(a);return t=Fc(t),null===n.context?n.context=t:n.pendingContext=t,(n=Br(r,o)).payload={element:e},null!==(i=void 0===i?null:i)&&(n.callback=i),null!==(e=_r(a,n,o))&&(nc(e,a,o,r),Fr(e,a,o)),o}function Hc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Wc(e,n){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var t=e.retryLane;e.retryLane=0!==t&&t<n?t:n}}function $c(e,n){Wc(e,n),(e=e.alternate)&&Wc(e,n)}wl=function(e,n,t){if(null!==e)if(e.memoizedProps!==n.pendingProps||Ea.current)xs=!0;else{if(0===(e.lanes&t)&&!(128&n.flags))return xs=!1,function(e,n,t){switch(n.tag){case 3:Es(n),pr();break;case 5:Zr(n);break;case 1:Oa(n.type)&&Ia(n);break;case 4:Gr(n,n.stateNode.containerInfo);break;case 10:var i=n.type._context,a=n.memoizedProps.value;Na(wr,i._currentValue),i._currentValue=a;break;case 13:if(null!==(i=n.memoizedState))return null!==i.dehydrated?(Na(Jr,1&Jr.current),n.flags|=128,null):0!==(t&n.child.childLanes)?Is(e,n,t):(Na(Jr,1&Jr.current),null!==(e=Hs(e,n,t))?e.sibling:null);Na(Jr,1&Jr.current);break;case 19:if(i=0!==(t&n.childLanes),128&e.flags){if(i)return Us(e,n,t);n.flags|=128}if(null!==(a=n.memoizedState)&&(a.rendering=null,a.tail=null,a.lastEffect=null),Na(Jr,Jr.current),i)break;return null;case 22:case 23:return n.lanes=0,Ss(e,n,t)}return Hs(e,n,t)}(e,n,t);xs=!!(131072&e.flags)}else xs=!1,ar&&1048576&n.flags&&Ja(n,qa,n.index);switch(n.lanes=0,n.tag){case 2:var i=n.type;Vs(e,n),e=n.pendingProps;var a=Da(n,Ma.current);Er(n,t),a=fo(null,n,i,e,a,t);var o=go();return n.flags|=1,"object"==typeof a&&null!==a&&"function"==typeof a.render&&void 0===a.$$typeof?(n.tag=1,n.memoizedState=null,n.updateQueue=null,Oa(i)?(o=!0,Ia(n)):o=!1,n.memoizedState=null!==a.state&&void 0!==a.state?a.state:null,Ir(n),a.updater=as,n.stateNode=a,a._reactInternals=n,ls(n,i,e,t),n=Ms(null,n,i,!0,o,t)):(n.tag=0,ar&&o&&er(n),ys(null,n,a,t),n=n.child),n;case 16:i=n.elementType;e:{switch(Vs(e,n),e=n.pendingProps,i=(a=i._init)(i._payload),n.type=i,a=n.tag=function(e){if("function"==typeof e)return Dc(e)?1:0;if(null!=e){if((e=e.$$typeof)===M)return 11;if(e===D)return 14}return 2}(i),e=ts(i,e),a){case 0:n=Ns(null,n,i,e,t);break e;case 1:n=Ps(null,n,i,e,t);break e;case 11:n=ks(null,n,i,e,t);break e;case 14:n=ws(null,n,i,ts(i.type,e),t);break e}throw Error(r(306,i,""))}return n;case 0:return i=n.type,a=n.pendingProps,Ns(e,n,i,a=n.elementType===i?a:ts(i,a),t);case 1:return i=n.type,a=n.pendingProps,Ps(e,n,i,a=n.elementType===i?a:ts(i,a),t);case 3:e:{if(Es(n),null===e)throw Error(r(387));i=n.pendingProps,a=(o=n.memoizedState).element,Rr(e,n),Vr(n,i,null,t);var s=n.memoizedState;if(i=s.element,o.isDehydrated){if(o={element:i,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},n.updateQueue.baseState=o,n.memoizedState=o,256&n.flags){n=Ls(e,n,i,t,a=cs(Error(r(423)),n));break e}if(i!==a){n=Ls(e,n,i,t,a=cs(Error(r(424)),n));break e}for(ir=ca(n.stateNode.containerInfo.firstChild),tr=n,ar=!0,rr=null,t=kr(n,null,i,t),n.child=t;t;)t.flags=-3&t.flags|4096,t=t.sibling}else{if(pr(),i===a){n=Hs(e,n,t);break e}ys(e,n,i,t)}n=n.child}return n;case 5:return Zr(n),null===e&&cr(n),i=n.type,a=n.pendingProps,o=null!==e?e.memoizedProps:null,s=a.children,ta(i,a)?s=null:null!==o&&ta(i,o)&&(n.flags|=32),Cs(e,n),ys(e,n,s,t),n.child;case 6:return null===e&&cr(n),null;case 13:return Is(e,n,t);case 4:return Gr(n,n.stateNode.containerInfo),i=n.pendingProps,null===e?n.child=yr(n,null,i,t):ys(e,n,i,t),n.child;case 11:return i=n.type,a=n.pendingProps,ks(e,n,i,a=n.elementType===i?a:ts(i,a),t);case 7:return ys(e,n,n.pendingProps,t),n.child;case 8:case 12:return ys(e,n,n.pendingProps.children,t),n.child;case 10:e:{if(i=n.type._context,a=n.pendingProps,o=n.memoizedProps,s=a.value,Na(wr,i._currentValue),i._currentValue=s,null!==o)if(si(o.value,s)){if(o.children===a.children&&!Ea.current){n=Hs(e,n,t);break e}}else for(null!==(o=n.child)&&(o.return=n);null!==o;){var l=o.dependencies;if(null!==l){s=o.child;for(var c=l.firstContext;null!==c;){if(c.context===i){if(1===o.tag){(c=Br(-1,t&-t)).tag=2;var u=o.updateQueue;if(null!==u){var d=(u=u.shared).pending;null===d?c.next=c:(c.next=d.next,d.next=c),u.pending=c}}o.lanes|=t,null!==(c=o.alternate)&&(c.lanes|=t),Mr(o.return,t,n),l.lanes|=t;break}c=c.next}}else if(10===o.tag)s=o.type===n.type?null:o.child;else if(18===o.tag){if(null===(s=o.return))throw Error(r(341));s.lanes|=t,null!==(l=s.alternate)&&(l.lanes|=t),Mr(s,t,n),s=o.sibling}else s=o.child;if(null!==s)s.return=o;else for(s=o;null!==s;){if(s===n){s=null;break}if(null!==(o=s.sibling)){o.return=s.return,s=o;break}s=s.return}o=s}ys(e,n,a.children,t),n=n.child}return n;case 9:return a=n.type,i=n.pendingProps.children,Er(n,t),i=i(a=Lr(a)),n.flags|=1,ys(e,n,i,t),n.child;case 14:return a=ts(i=n.type,n.pendingProps),ws(e,n,i,a=ts(i.type,a),t);case 15:return js(e,n,n.type,n.pendingProps,t);case 17:return i=n.type,a=n.pendingProps,a=n.elementType===i?a:ts(i,a),Vs(e,n),n.tag=1,Oa(i)?(e=!0,Ia(n)):e=!1,Er(n,t),os(n,i,a),ls(n,i,a,t),Ms(null,n,i,!0,e,t);case 19:return Us(e,n,t);case 22:return Ss(e,n,t)}throw Error(r(156,n.tag))};var qc="function"==typeof reportError?reportError:function(e){console.error(e)};function Yc(e){this._internalRoot=e}function Kc(e){this._internalRoot=e}function Gc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Qc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Zc(){}function Xc(e,n,t,i,a){var r=t._reactRootContainer;if(r){var o=r;if("function"==typeof a){var s=a;a=function(){var e=Hc(o);s.call(e)}}Vc(n,o,e,a)}else o=function(e,n,t,i,a){if(a){if("function"==typeof i){var r=i;i=function(){var e=Hc(o);r.call(e)}}var o=Uc(n,i,e,0,null,!1,0,"",Zc);return e._reactRootContainer=o,e[ha]=o.current,Vi(8===e.nodeType?e.parentNode:e),cc(),o}for(;a=e.lastChild;)e.removeChild(a);if("function"==typeof i){var s=i;i=function(){var e=Hc(l);s.call(e)}}var l=_c(e,0,!1,null,0,!1,0,"",Zc);return e._reactRootContainer=l,e[ha]=l.current,Vi(8===e.nodeType?e.parentNode:e),cc(function(){Vc(n,l,t,i)}),l}(t,n,e,a,i);return Hc(o)}Kc.prototype.render=Yc.prototype.render=function(e){var n=this._internalRoot;if(null===n)throw Error(r(409));Vc(e,n,null,null)},Kc.prototype.unmount=Yc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var n=e.containerInfo;cc(function(){Vc(null,e,null,null)}),n[ha]=null}},Kc.prototype.unstable_scheduleHydration=function(e){if(e){var n=Cn();e={blockedOn:null,target:e,priority:n};for(var t=0;t<zn.length&&0!==n&&n<zn[t].priority;t++);zn.splice(t,0,e),0===t&&Bn(e)}},wn=function(e){switch(e.tag){case 3:var n=e.stateNode;if(n.current.memoizedState.isDehydrated){var t=mn(n.pendingLanes);0!==t&&(xn(n,1|t),tc(n,Ze()),!(6&Pl)&&(Ul=Ze()+500,Va()))}break;case 13:cc(function(){var n=zr(e,1);if(null!==n){var t=Jl();nc(n,e,1,t)}}),$c(e,1)}},jn=function(e){if(13===e.tag){var n=zr(e,134217728);if(null!==n)nc(n,e,134217728,Jl());$c(e,134217728)}},Sn=function(e){if(13===e.tag){var n=ec(e),t=zr(e,n);if(null!==t)nc(t,e,n,Jl());$c(e,n)}},Cn=function(){return yn},Nn=function(e,n){var t=yn;try{return yn=e,n()}finally{yn=t}},we=function(e,n,t){switch(n){case"input":if(X(e,t),n=t.name,"radio"===t.type&&null!=n){for(t=e;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+n)+'][type="radio"]'),n=0;n<t.length;n++){var i=t[n];if(i!==e&&i.form===e.form){var a=ka(i);if(!a)throw Error(r(90));Y(i),X(i,a)}}}break;case"textarea":re(e,t);break;case"select":null!=(n=t.value)&&te(e,!!t.multiple,n,!1)}},Me=lc,Ee=cc;var Jc={usingClientEntryPoint:!1,Events:[xa,ya,ka,Ne,Pe,lc]},eu={findFiberByHostInstance:ba,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},nu={bundleType:eu.bundleType,version:eu.version,rendererPackageName:eu.rendererPackageName,rendererConfig:eu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:y.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=$e(e))?null:e.stateNode},findFiberByHostInstance:eu.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var tu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!tu.isDisabled&&tu.supportsFiber)try{rn=tu.inject(nu),on=tu}catch(ue){}}n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Jc,n.createPortal=function(e,n){var t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Gc(n))throw Error(r(200));return function(e,n,t){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:w,key:null==i?null:""+i,children:e,containerInfo:n,implementation:t}}(e,n,null,t)},n.createRoot=function(e,n){if(!Gc(e))throw Error(r(299));var t=!1,i="",a=qc;return null!=n&&(!0===n.unstable_strictMode&&(t=!0),void 0!==n.identifierPrefix&&(i=n.identifierPrefix),void 0!==n.onRecoverableError&&(a=n.onRecoverableError)),n=_c(e,1,!1,null,0,t,0,i,a),e[ha]=n.current,Vi(8===e.nodeType?e.parentNode:e),new Yc(n)},n.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var n=e._reactInternals;if(void 0===n){if("function"==typeof e.render)throw Error(r(188));throw e=Object.keys(e).join(","),Error(r(268,e))}return e=null===(e=$e(n))?null:e.stateNode},n.flushSync=function(e){return cc(e)},n.hydrate=function(e,n,t){if(!Qc(n))throw Error(r(200));return Xc(null,e,n,!0,t)},n.hydrateRoot=function(e,n,t){if(!Gc(e))throw Error(r(405));var i=null!=t&&t.hydratedSources||null,a=!1,o="",s=qc;if(null!=t&&(!0===t.unstable_strictMode&&(a=!0),void 0!==t.identifierPrefix&&(o=t.identifierPrefix),void 0!==t.onRecoverableError&&(s=t.onRecoverableError)),n=Uc(n,null,e,1,null!=t?t:null,a,0,o,s),e[ha]=n.current,Vi(e),i)for(e=0;e<i.length;e++)a=(a=(t=i[e])._getVersion)(t._source),null==n.mutableSourceEagerHydrationData?n.mutableSourceEagerHydrationData=[t,a]:n.mutableSourceEagerHydrationData.push(t,a);return new Kc(n)},n.render=function(e,n,t){if(!Qc(n))throw Error(r(200));return Xc(null,e,n,!1,t)},n.unmountComponentAtNode=function(e){if(!Qc(e))throw Error(r(40));return!!e._reactRootContainer&&(cc(function(){Xc(null,null,e,!1,function(){e._reactRootContainer=null,e[ha]=null})}),!0)},n.unstable_batchedUpdates=lc,n.unstable_renderSubtreeIntoContainer=function(e,n,t,i){if(!Qc(t))throw Error(r(200));if(null==e||void 0===e._reactInternals)throw Error(r(38));return Xc(e,n,t,!1,i)},n.version="18.3.1-next-f1338f8080-20240426"},601(e){e.exports=function(e){return e[1]}},659(e){var n={};e.exports=function(e,t){var i=function(e){if(void 0===n[e]){var t=document.querySelector(e);if(window.HTMLIFrameElement&&t instanceof window.HTMLIFrameElement)try{t=t.contentDocument.head}catch(e){t=null}n[e]=t}return n[e]}(e);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(t)}},674(e,n,t){t.d(n,{DZ:()=>g,HT:()=>p,JN:()=>x,Ll:()=>v,M5:()=>f,X7:()=>b,ho:()=>h,mt:()=>m,pW:()=>s,sI:()=>y,zA:()=>c});var i=t(92);function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,i)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach(function(n){o(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function o(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,n||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const s="lumia-injector",l="lumia_injector_settings",c="loom_summary";let u=r({},{packs:{},selectedDefinition:null,selectedBehaviors:[],selectedPersonalities:[],dominantBehavior:null,dominantPersonality:null,selectedLoomStyle:[],selectedLoomUtils:[],selectedLoomRetrofits:[],presets:{},activePresetName:null,chimeraMode:!1,selectedDefinitions:[],councilMode:!1,councilMembers:[],lumiaOOCInterval:null,lumiaOOCStyle:"social",sovereignHand:{enabled:!1,excludeLastMessage:!0,includeMessageInPrompt:!0},contextFilters:{htmlTags:{enabled:!1,stripFonts:!1,fontKeepDepth:3},detailsBlocks:{enabled:!1,keepDepth:3},loomItems:{enabled:!1,keepDepth:5}},messageTruncation:{enabled:!1,keepCount:50},summarization:{mode:"disabled",apiSource:"main",autoInterval:10,autoMessageContext:10,manualMessageContext:10,secondary:{provider:"openai",model:"",endpoint:"",apiKey:"",temperature:.7,topP:1,maxTokens:8192}},lumiaConfigVersion:1,lastLumiaChangeTimestamp:null,disableAnthropicCache:!1,lumiaButtonPosition:{useDefault:!0,xPercent:1,yPercent:1}}),d=null;function m(){return u}function p(){return d}function h(e){d=e}function v(){d=null}function f(){const e=(0,i.fJ)();e[l]?(u=r(r({},u),e[l]),function(){let e=!1;if((u.lumiaLibrary||u.worldBookData)&&0===Object.keys(u.packs).length){console.log("Lumia Injector: Migrating legacy settings...");let n=u.lumiaLibrary||[];if(0===n.length&&u.worldBookData&&console.warn("Legacy worldBookData found but cannot be migrated automatically. Please re-import your world book."),n.length>0){const t="Default (Legacy)";u.packs[t]={name:t,items:n,url:u.worldBookUrl||"Legacy"};const i=e=>{var t;return null===(t=n[e])||void 0===t?void 0:t.lumiaDefName};if("number"==typeof u.selectedDefinition){const e=i(u.selectedDefinition);u.selectedDefinition=e?{packName:t,itemName:e}:null}Array.isArray(u.selectedBehaviors)&&u.selectedBehaviors.length>0&&"number"==typeof u.selectedBehaviors[0]?u.selectedBehaviors=u.selectedBehaviors.map(e=>{const n=i(e);return n?{packName:t,itemName:n}:null}).filter(e=>e):u.selectedBehaviors=[],Array.isArray(u.selectedPersonalities)&&u.selectedPersonalities.length>0&&"number"==typeof u.selectedPersonalities[0]?u.selectedPersonalities=u.selectedPersonalities.map(e=>{const n=i(e);return n?{packName:t,itemName:n}:null}).filter(e=>e):u.selectedPersonalities=[],delete u.lumiaLibrary,delete u.worldBookData,delete u.worldBookUrl,e=!0}}return u.packs||(u.packs={}),u.selectedBehaviors||(u.selectedBehaviors=[]),u.selectedPersonalities||(u.selectedPersonalities=[]),void 0===u.dominantBehavior&&(u.dominantBehavior=null),void 0===u.dominantPersonality&&(u.dominantPersonality=null),u.selectedLoomUtils||(u.selectedLoomUtils=[]),u.selectedLoomRetrofits||(u.selectedLoomRetrofits=[]),void 0===u.lumiaOOCInterval&&(u.lumiaOOCInterval=null),u.lumiaOOCStyle||(u.lumiaOOCStyle="social"),u.sovereignHand||(u.sovereignHand={enabled:!1,excludeLastMessage:!0,includeMessageInPrompt:!0}),void 0===u.sovereignHand.excludeLastMessage&&(u.sovereignHand.excludeLastMessage=!0),void 0===u.sovereignHand.includeMessageInPrompt&&(u.sovereignHand.includeMessageInPrompt=!0),u.contextFilters||(u.contextFilters={htmlTags:{enabled:!1,stripFonts:!1,fontKeepDepth:3},detailsBlocks:{enabled:!1,keepDepth:3},loomItems:{enabled:!1,keepDepth:5}}),u.contextFilters.htmlTags||(u.contextFilters.htmlTags={enabled:!1,stripFonts:!1,fontKeepDepth:3}),void 0===u.contextFilters.htmlTags.stripFonts&&(u.contextFilters.htmlTags.stripFonts=!1),void 0===u.contextFilters.htmlTags.fontKeepDepth&&(u.contextFilters.htmlTags.fontKeepDepth=3),u.contextFilters.detailsBlocks||(u.contextFilters.detailsBlocks={enabled:!1,keepDepth:3}),void 0===u.contextFilters.detailsBlocks.keepDepth&&(u.contextFilters.detailsBlocks.keepDepth=3),u.contextFilters.loomItems||(u.contextFilters.loomItems={enabled:!1,keepDepth:5}),void 0===u.contextFilters.loomItems.keepDepth&&(u.contextFilters.loomItems.keepDepth=5),u.messageTruncation||(u.messageTruncation={enabled:!1,keepCount:50}),void 0===u.messageTruncation.keepCount&&(u.messageTruncation.keepCount=50),u.summarization||(u.summarization={mode:"disabled",apiSource:"main",autoInterval:10,autoMessageContext:10,manualMessageContext:10,secondary:{provider:"openai",model:"",endpoint:"",apiKey:"",temperature:.7,topP:1,maxTokens:8192}}),void 0!==u.summarization.messageContext&&(u.summarization.autoMessageContext=u.summarization.messageContext,u.summarization.manualMessageContext=u.summarization.messageContext,delete u.summarization.messageContext,e=!0),void 0===u.summarization.autoMessageContext&&(u.summarization.autoMessageContext=10),void 0===u.summarization.manualMessageContext&&(u.summarization.manualMessageContext=10),u.summarization.secondary||(u.summarization.secondary={provider:"openai",model:"",endpoint:"",apiKey:"",temperature:.7,topP:1,maxTokens:8192}),void 0===u.summarization.secondary.topP&&(u.summarization.secondary.topP=1),(!u.summarization.secondary.maxTokens||u.summarization.secondary.maxTokens<256)&&(u.summarization.secondary.maxTokens=8192),u.presets||(u.presets={}),void 0===u.activePresetName&&(u.activePresetName=null),void 0===u.chimeraMode&&(u.chimeraMode=!1),u.selectedDefinitions||(u.selectedDefinitions=[]),void 0===u.councilMode&&(u.councilMode=!1),u.councilMembers||(u.councilMembers=[]),e}()&&g()):e[l]=u}function g(){const e=(0,i.fJ)(),n=(0,i.kL)();e[l]=u,n()}function b(){return u.lumiaConfigVersion||1}function x(){u.lumiaConfigVersion=(u.lumiaConfigVersion||0)+1,u.lastLumiaChangeTimestamp=Date.now(),g(),console.log("[".concat(s,"] Lumia config version bumped to ").concat(u.lumiaConfigVersion))}function y(){return u.lumiaConfigVersion=(u.lumiaConfigVersion||0)+1,u.lastLumiaChangeTimestamp=Date.now(),u.disableAnthropicCache=!0,g(),console.log("[".concat(s,"] Claude cache cleared - version now ").concat(u.lumiaConfigVersion)),setTimeout(()=>{u.disableAnthropicCache=!1,g()},5e3),u.lumiaConfigVersion}},796(e){e.exports="data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%2712%27 height=%2712%27 viewBox=%270 0 24 24%27 fill=%27none%27 stroke=%27rgba%28255,255,255,0.5%29%27 stroke-width=%272%27 stroke-linecap=%27round%27 stroke-linejoin=%27round%27%3E%3Cpolyline points=%276 9 12 15 18 9%27%3E%3C/polyline%3E%3C/svg%3E"},825(e){e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var n=e.insertStyleElement(e);return{update:function(t){!function(e,n,t){var i="";t.supports&&(i+="@supports (".concat(t.supports,") {")),t.media&&(i+="@media ".concat(t.media," {"));var a=void 0!==t.layer;a&&(i+="@layer".concat(t.layer.length>0?" ".concat(t.layer):""," {")),i+=t.css,a&&(i+="}"),t.media&&(i+="}"),t.supports&&(i+="}");var r=t.sourceMap;r&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),n.styleTagTransform(i,e,n.options)}(n,e,t)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(n)}}}},848(e,n,t){e.exports=t(20)},932(e,n,t){t.d(n,{Cm:()=>S,Dz:()=>N,GM:()=>w,YR:()=>P,Zl:()=>u,e2:()=>C,mR:()=>j,ry:()=>k,updateLoomSummaryButtonState:()=>M,xx:()=>m});var i=t(92),a=t(674),r=t(154),o=t(485),s=t(199),l=t(200);let c=null;function u(e){c=e}let d=null;function m(e){d=e}function p(){d&&d()}const h='<svg viewBox="0 0 24 24"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>',v='<svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"></polyline></svg>',f='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>',g='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>',b='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>',x='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>';function y(e){const n=e[0];if(!n)return;const t=window.innerHeight||document.documentElement.clientHeight,i=(window.innerWidth||document.documentElement.clientWidth)<=600?24:48,a=t-i;n.style.maxHeight="".concat(a,"px");const r=e.find(".lumia-modal-header"),o=e.find(".lumia-modal-footer"),s=e.find(".lumia-modal-content");requestAnimationFrame(()=>{const e=r.length?r[0].offsetHeight:0,n=o.length?o[0].offsetHeight:0,t=a-e-n;s.length&&(s[0].style.maxHeight="".concat(t,"px"),s[0].style.overflowY="auto")});const l=()=>{const e=(window.innerHeight||document.documentElement.clientHeight)-i;n.style.maxHeight="".concat(e,"px");const t=e-(r.length?r[0].offsetHeight:0)-(o.length?o[0].offsetHeight:0);s.length&&(s[0].style.maxHeight="".concat(t,"px"))};window.addEventListener("resize",l),n._resizeCleanup=()=>window.removeEventListener("resize",l)}function k(e){const n=(0,a.mt)(),t=Object.values(n.packs);let i="",o="",l=!1,c=null,u="";"definition"===e?(i="Select Definition",o="Choose the physical form for your Lumia",l=!1,u='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>\n            <circle cx="12" cy="7" r="4"></circle>\n        </svg>'):"behavior"===e?(i="Select Behaviors",o="Choose behavioral traits (tap star for dominant)",l=!0,c="dominantBehavior",u='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n            <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path>\n        </svg>'):"personality"===e&&(i="Select Personalities",o="Choose personality traits (tap star for dominant)",l=!0,c="dominantPersonality",u='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n            <path d="M12 2a10 10 0 1 0 10 10H12V2z"></path>\n            <path d="M12 2a10 10 0 0 1 10 10"></path>\n            <circle cx="12" cy="12" r="6"></circle>\n        </svg>'),$("#lumia-selection-modal").remove();let d="";0===t.length?d='<div class="lumia-modal-empty">No Lumia Packs loaded. Add one in settings!</div>':t.forEach(t=>{const i=t.items;if(!i||0===i.length)return;const a=i.filter(e=>e.lumiaDefName);if(0===a.length)return;const o=(0,s.iY)(t.name),u=a.map(i=>{const a=i.lumiaDefName,s=(0,r.ZD)(t.name),u=(0,r.ZD)(a),d=i.lumia_img;let m=!1;if(l){m=("behavior"===e?n.selectedBehaviors:n.selectedPersonalities).some(e=>e.packName===t.name&&e.itemName===a)}else{const e=n.selectedDefinition;m=e&&e.packName===t.name&&e.itemName===a}let p=!1;c&&n[c]&&(p=n[c].packName===t.name&&n[c].itemName===a);const f=null!==c;return'\n                <div class="lumia-card lumia-card-appear '.concat("definition"===e?"definition-card":""," ").concat(m?"selected":"",'"\n                     data-pack="').concat(s,'"\n                     data-item="').concat(u,'">\n                    <div class="lumia-card-image">\n                        ').concat(d?'<img src="'.concat(d,'" alt="').concat(u,'" loading="lazy"><div class="lumia-img-spinner"></div>'):'<div class="lumia-card-placeholder">?</div>',"\n                        ").concat(f?'\n                        <div class="lumia-dominant-icon '.concat(p?"dominant":"",'"\n                             data-pack="').concat(s,'"\n                             data-item="').concat(u,'"\n                             title="').concat(p?"Remove as dominant":"Set as dominant trait",'">\n                            ').concat(h,"\n                        </div>\n                        "):"",'\n                        <div class="lumia-card-check">\n                            ').concat(v,"\n                        </div>\n                        ").concat(o?'\n                        <button class="lumia-card-edit-btn"\n                                data-pack="'.concat(s,'"\n                                data-item="').concat(u,'"\n                                title="Edit Lumia">\n                            ').concat(x,"\n                        </button>\n                        "):"",'\n                    </div>\n                    <div class="lumia-card-info">\n                        <div class="lumia-card-name">').concat(a||"Unknown","</div>\n                    </div>\n                </div>\n                ")}).join("");d+='\n            <div class="lumia-modal-panel lumia-collapsible lumia-pack-section">\n                <div class="lumia-modal-panel-header lumia-collapsible-trigger">\n                    <span class="lumia-panel-collapse-icon">\n                        '.concat(b,'\n                    </span>\n                    <span class="lumia-modal-panel-icon">\n                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                            <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>\n                        </svg>\n                    </span>\n                    <span class="lumia-modal-panel-title">').concat((0,r.ZD)(t.name),"</span>\n                    ").concat(o?'<span class="lumia-pack-badge-custom">Custom</span>':"",'\n                    <span class="lumia-modal-panel-count">').concat(a.length," items</span>\n                    ").concat(o?'<button class="lumia-pack-edit-btn" data-pack="'.concat((0,r.ZD)(t.name),'" title="Edit Pack">').concat(x,"</button>"):"",'\n                    <button class="lumia-icon-btn-sm lumia-remove-pack-btn" data-pack="').concat((0,r.ZD)(t.name),'" title="Remove Pack">\n                        ').concat(f,'\n                    </button>\n                </div>\n                <div class="lumia-modal-panel-content lumia-modal-panel-content-cards lumia-collapsible-content">\n                    <div class="lumia-card-grid">\n                        ').concat(u,"\n                    </div>\n                </div>\n            </div>\n            ")});const m='\n        <dialog id="lumia-selection-modal" class="popup popup--animation-fast lumia-modal lumia-modal-selection">\n            <div class="lumia-modal-header">\n                <div class="lumia-modal-header-icon">\n                    '.concat(u,'\n                </div>\n                <div class="lumia-modal-header-text">\n                    <h3 class="lumia-modal-title">').concat(i,'</h3>\n                    <p class="lumia-modal-subtitle">').concat(o,'</p>\n                </div>\n                <button class="lumia-clear-btn" title="Clear all selections">\n                    ').concat(g,'\n                    <span>Clear</span>\n                </button>\n            </div>\n            <div class="lumia-modal-content">\n                ').concat(d,'\n            </div>\n            <div class="lumia-modal-footer">\n                <button class="lumia-modal-btn lumia-modal-btn-secondary lumia-modal-close-btn">Close</button>\n                ').concat(l?'<button class="lumia-modal-btn lumia-modal-btn-primary lumia-modal-done">Done</button>':"","\n            </div>\n        </dialog>\n    ");$("body").append(m);const k=$("#lumia-selection-modal");y(k);const w=()=>{k[0]._resizeCleanup&&k[0]._resizeCleanup(),k[0].close(),k.remove(),p()};k.on("click mousedown mouseup",function(e){e.stopPropagation(),"click"===e.type&&e.target===this&&w()}),k.find(".lumia-modal-close-btn, .lumia-modal-done").click(w),k.on("keydown",function(e){"Escape"===e.key&&w()}),k.find(".lumia-collapsible-trigger").click(function(e){$(e.target).closest(".lumia-remove-pack-btn").length>0||$(this).closest(".lumia-collapsible").toggleClass("collapsed")}),k.find(".lumia-clear-btn").click(function(t){t.stopPropagation(),"definition"===e?n.selectedDefinition=null:"behavior"===e?(n.selectedBehaviors=[],n.dominantBehavior=null):"personality"===e&&(n.selectedPersonalities=[],n.dominantPersonality=null),(0,a.DZ)(),k.find(".lumia-card").removeClass("selected"),k.find(".lumia-dominant-icon").removeClass("dominant"),toastr.info("".concat(i.replace("Select ","")," cleared"))}),k.find(".lumia-remove-pack-btn").click(function(e){e.stopPropagation();const t=$(this).data("pack");confirm('Are you sure you want to remove the pack "'.concat(t,'"?'))&&(delete n.packs[t],n.selectedDefinition&&n.selectedDefinition.packName===t&&(n.selectedDefinition=null),n.selectedBehaviors=n.selectedBehaviors.filter(e=>e.packName!==t),n.selectedPersonalities=n.selectedPersonalities.filter(e=>e.packName!==t),n.dominantBehavior&&n.dominantBehavior.packName===t&&(n.dominantBehavior=null),n.dominantPersonality&&n.dominantPersonality.packName===t&&(n.dominantPersonality=null),(0,a.DZ)(),$(this).closest(".lumia-modal-panel").remove(),0===Object.keys(n.packs).length&&w())}),k.find(".lumia-pack-edit-btn").click(function(e){e.stopPropagation();const n=$(this).data("pack");w(),(0,s.H3)(n)}),k.find(".lumia-card-edit-btn").click(function(e){e.stopPropagation();const n=$(this).data("pack"),t=$(this).data("item"),i=(0,r.Br)(n,t);i&&(w(),(0,s.un)(i,n))}),c&&k.find(".lumia-dominant-icon").click(function(t){t.stopPropagation();const i=$(this).data("pack"),r=$(this).data("item"),o=$(this),s="behavior"===e?n.selectedBehaviors:n.selectedPersonalities;s.some(e=>e.packName===i&&e.itemName===r)||(s.push({packName:i,itemName:r}),"behavior"===e?n.selectedBehaviors=s:n.selectedPersonalities=s,o.closest(".lumia-card").addClass("selected"));const l=n[c];l&&l.packName===i&&l.itemName===r?(n[c]=null,o.removeClass("dominant")):(k.find(".lumia-dominant-icon").removeClass("dominant"),n[c]={packName:i,itemName:r},o.addClass("dominant")),(0,a.DZ)()}),k.find(".lumia-card").click(function(t){if($(t.target).closest(".lumia-dominant-icon").length>0||$(t.target).closest(".lumia-card-edit-btn").length>0)return;const i=$(this).data("pack"),r=$(this).data("item");if(l){const t=$(this);let o="behavior"===e?n.selectedBehaviors:n.selectedPersonalities;const s=o.findIndex(e=>e.packName===i&&e.itemName===r);-1!==s?(o.splice(s,1),t.removeClass("selected"),c&&n[c]&&n[c].packName===i&&n[c].itemName===r&&(n[c]=null,t.find(".lumia-dominant-icon").removeClass("dominant"))):(o.push({packName:i,itemName:r}),t.addClass("selected")),"behavior"===e?n.selectedBehaviors=o:n.selectedPersonalities=o,(0,a.DZ)()}else k.find(".lumia-card").removeClass("selected"),$(this).addClass("selected"),n.selectedDefinition={packName:i,itemName:r},(0,a.DZ)()}),k.find(".lumia-card-image img").each(function(){const e=$(this);this.complete&&0!==this.naturalHeight?e.addClass("lumia-img-loaded"):(e.on("load",function(){e.addClass("lumia-img-loaded")}),e.on("error",function(){e.addClass("lumia-img-loaded"),e.css("display","none"),e.parent().append('<div class="lumia-card-placeholder">?</div>')}))}),k[0].showModal()}function w(){const e=(0,a.mt)();$("#lumia-misc-modal").remove();const n=e.lumiaOOCInterval||"",t=e.lumiaOOCStyle||"social",i='\n        <dialog id="lumia-misc-modal" class="popup popup--animation-fast lumia-modal lumia-modal-settings">\n            <div class="lumia-modal-header">\n                <div class="lumia-modal-header-icon">\n                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>\n                    </svg>\n                </div>\n                <h3 class="lumia-modal-title">OOC Settings</h3>\n            </div>\n            <div class="lumia-modal-content">\n\n                <div class="lumia-modal-panel">\n                    <div class="lumia-modal-panel-header">\n                        <span class="lumia-modal-panel-icon">\n                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                                <circle cx="12" cy="12" r="10"></circle>\n                                <polyline points="12 6 12 12 16 14"></polyline>\n                            </svg>\n                        </span>\n                        <span class="lumia-modal-panel-title">Comment Trigger</span>\n                    </div>\n                    <div class="lumia-modal-panel-content">\n                        <p class="lumia-modal-description">Automatically inject OOC instructions at message intervals.</p>\n                        <div class="lumia-modal-field">\n                            <label class="lumia-modal-label" for="lumia-ooc-interval-input">Message Interval</label>\n                            <input type="number"\n                                   id="lumia-ooc-interval-input"\n                                   class="lumia-modal-input"\n                                   placeholder="e.g., 10 (empty = disabled)"\n                                   min="1"\n                                   value="'.concat((0,r.ZD)(n.toString()),'" />\n                            <span class="lumia-modal-hint">Triggers when message count is divisible by this number</span>\n                        </div>\n                    </div>\n                </div>\n\n                <div class="lumia-modal-panel">\n                    <div class="lumia-modal-panel-header">\n                        <span class="lumia-modal-panel-icon">\n                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>\n                                <line x1="3" y1="9" x2="21" y2="9"></line>\n                                <line x1="9" y1="21" x2="9" y2="9"></line>\n                            </svg>\n                        </span>\n                        <span class="lumia-modal-panel-title">Display Style</span>\n                    </div>\n                    <div class="lumia-modal-panel-content">\n                        <p class="lumia-modal-description">Choose how OOC comments appear in chat.</p>\n                        <div class="lumia-style-options">\n                            <label class="lumia-style-option ').concat("social"===t?"selected":"",'">\n                                <input type="radio" name="ooc-style" value="social" ').concat("social"===t?"checked":"",' />\n                                <div class="lumia-style-option-content">\n                                    <span class="lumia-style-option-icon">\n                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                                            <rect x="3" y="3" width="18" height="18" rx="2"></rect>\n                                            <circle cx="8.5" cy="8.5" r="1.5"></circle>\n                                            <path d="M21 15l-5-5L5 21"></path>\n                                        </svg>\n                                    </span>\n                                    <div class="lumia-style-option-text">\n                                        <span class="lumia-style-option-title">Social Card</span>\n                                        <span class="lumia-style-option-desc">Full card with avatar & animations</span>\n                                    </div>\n                                </div>\n                            </label>\n                            <label class="lumia-style-option ').concat("margin"===t?"selected":"",'">\n                                <input type="radio" name="ooc-style" value="margin" ').concat("margin"===t?"checked":"",' />\n                                <div class="lumia-style-option-content">\n                                    <span class="lumia-style-option-icon">\n                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>\n                                            <polyline points="14 2 14 8 20 8"></polyline>\n                                        </svg>\n                                    </span>\n                                    <div class="lumia-style-option-text">\n                                        <span class="lumia-style-option-title">Margin Note</span>\n                                        <span class="lumia-style-option-desc">Minimal hanging tag style</span>\n                                    </div>\n                                </div>\n                            </label>\n                            <label class="lumia-style-option ').concat("whisper"===t?"selected":"",'">\n                                <input type="radio" name="ooc-style" value="whisper" ').concat("whisper"===t?"checked":"",' />\n                                <div class="lumia-style-option-content">\n                                    <span class="lumia-style-option-icon">\n                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                                            <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path>\n                                        </svg>\n                                    </span>\n                                    <div class="lumia-style-option-text">\n                                        <span class="lumia-style-option-title">Whisper Bubble</span>\n                                        <span class="lumia-style-option-desc">Soft ethereal thought bubble</span>\n                                    </div>\n                                </div>\n                            </label>\n                        </div>\n                    </div>\n                </div>\n\n            </div>\n            <div class="lumia-modal-footer">\n                <button class="lumia-modal-btn lumia-modal-btn-secondary lumia-misc-cancel-btn">Cancel</button>\n                <button class="lumia-modal-btn lumia-modal-btn-primary lumia-misc-save-btn">Save Changes</button>\n            </div>\n        </dialog>\n    ');$("body").append(i);const o=$("#lumia-misc-modal");y(o);const s=()=>{o[0]._resizeCleanup&&o[0]._resizeCleanup(),o[0].close(),o.remove()};o.on("click mousedown mouseup",function(e){e.stopPropagation(),"click"===e.type&&e.target===this&&s()}),o.find('.lumia-style-option input[type="radio"]').change(function(){o.find(".lumia-style-option").removeClass("selected"),$(this).closest(".lumia-style-option").addClass("selected")}),o.find(".lumia-misc-save-btn").click(()=>{const n=$("#lumia-ooc-interval-input").val().trim(),t=o.find('input[name="ooc-style"]:checked').val(),i=e.lumiaOOCStyle;e.lumiaOOCInterval=n?parseInt(n,10):null,e.lumiaOOCStyle=t,(0,a.DZ)(),(0,l.TC)(),toastr.success("OOC settings saved!"),s(),i!==t&&c&&setTimeout(()=>c(!0),100)}),o.find(".lumia-misc-cancel-btn").click(s),o.on("keydown",function(e){"Escape"===e.key&&s()}),o[0].showModal()}function j(e){const n=(0,a.mt)(),t=Object.values(n.packs);let i="",o="",s=!1,l=null,c="";"Narrative Style"===e?(i="Select Narrative Styles",o="Choose how the story is told",s=!0,l="selectedLoomStyle",c='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n            <path d="M12 19l7-7 3 3-7 7-3-3z"></path>\n            <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"></path>\n            <path d="M2 2l7.586 7.586"></path>\n            <circle cx="11" cy="11" r="2"></circle>\n        </svg>'):"Loom Utilities"===e?(i="Select Loom Utilities",o="Toggle utilities to enhance generation",s=!0,l="selectedLoomUtils",c='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n            <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path>\n        </svg>'):"Retrofits"===e&&(i="Select Retrofits",o="Choose retrofit modifications",s=!0,l="selectedLoomRetrofits",c='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n            <circle cx="12" cy="12" r="3"></circle>\n            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"></path>\n        </svg>'),$("#loom-selection-modal").remove();let u="";0===t.length?u='<div class="lumia-modal-empty">No Packs loaded. Add one in settings!</div>':(t.forEach(t=>{const i=t.items;if(!i||0===i.length)return;const a=i.filter(n=>n.loomCategory===e);if(0===a.length)return;const o=a.map(e=>{let i=!1;const a=e.loomName;if(s){i=(Array.isArray(n[l])?n[l]:[]).some(e=>e.packName===t.name&&e.itemName===a)}else{const e=n[l];i=e&&e.packName===t.name&&e.itemName===a}const o=(0,r.ZD)(t.name),c=(0,r.ZD)(a);return'\n                <div class="lumia-list-item '.concat(i?"selected":"",'"\n                     data-pack="').concat(o,'"\n                     data-item="').concat(c,'">\n                    <div class="lumia-list-item-content">\n                        <span class="lumia-list-item-name">').concat(a||"Unknown",'</span>\n                    </div>\n                    <div class="lumia-list-item-toggle">\n                        ').concat(s?'\n                        <div class="lumia-toggle-switch">\n                            <div class="lumia-toggle-track">\n                                <div class="lumia-toggle-thumb"></div>\n                            </div>\n                        </div>\n                        ':'\n                        <div class="lumia-radio-indicator"></div>\n                        ',"\n                    </div>\n                </div>\n                ")}).join("");o&&(u+='\n                <div class="lumia-modal-panel lumia-collapsible">\n                    <div class="lumia-modal-panel-header lumia-collapsible-trigger">\n                        <span class="lumia-panel-collapse-icon">\n                            '.concat(b,'\n                        </span>\n                        <span class="lumia-modal-panel-icon">\n                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                                <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>\n                            </svg>\n                        </span>\n                        <span class="lumia-modal-panel-title">').concat(t.name,'</span>\n                        <span class="lumia-modal-panel-count">').concat(a.length,' items</span>\n                        <button class="lumia-icon-btn-sm lumia-remove-pack-btn" data-pack="').concat((0,r.ZD)(t.name),'" title="Remove Pack">\n                            ').concat(f,'\n                        </button>\n                    </div>\n                    <div class="lumia-modal-panel-content lumia-modal-panel-content-list lumia-collapsible-content">\n                        <div class="lumia-list-group">\n                            ').concat(o,"\n                        </div>\n                    </div>\n                </div>\n                "))}),u||(u='<div class="lumia-modal-empty">No "'.concat(e,'" items found in loaded packs.</div>')));const d='\n        <dialog id="loom-selection-modal" class="popup popup--animation-fast lumia-modal lumia-modal-selection">\n            <div class="lumia-modal-header">\n                <div class="lumia-modal-header-icon">\n                    '.concat(c,'\n                </div>\n                <div class="lumia-modal-header-text">\n                    <h3 class="lumia-modal-title">').concat(i,'</h3>\n                    <p class="lumia-modal-subtitle">').concat(o,'</p>\n                </div>\n                <button class="lumia-clear-btn" title="Clear selection">\n                    ').concat(g,'\n                    <span>Clear</span>\n                </button>\n            </div>\n            <div class="lumia-modal-content">\n                ').concat(u,'\n            </div>\n            <div class="lumia-modal-footer">\n                <button class="lumia-modal-btn lumia-modal-btn-secondary lumia-modal-close-btn">Close</button>\n                ').concat(s?'<button class="lumia-modal-btn lumia-modal-btn-primary lumia-modal-done">Done</button>':"","\n            </div>\n        </dialog>\n    ");$("body").append(d);const m=$("#loom-selection-modal");y(m);const h=()=>{m[0]._resizeCleanup&&m[0]._resizeCleanup(),m[0].close(),m.remove(),p()};m.on("click mousedown mouseup",function(e){e.stopPropagation(),"click"===e.type&&e.target===this&&h()}),m.find(".lumia-modal-close-btn, .lumia-modal-done").click(h),m.on("keydown",function(e){"Escape"===e.key&&h()}),m.find(".lumia-collapsible-trigger").click(function(e){$(e.target).closest(".lumia-list-item").length>0||$(e.target).closest(".lumia-remove-pack-btn").length>0||$(this).closest(".lumia-collapsible").toggleClass("collapsed")}),m.find(".lumia-clear-btn").click(function(e){e.stopPropagation(),n[l]=s?[]:null,(0,a.DZ)(),m.find(".lumia-list-item").removeClass("selected"),toastr.info("".concat(i.replace("Select ","")," cleared"))}),m.find(".lumia-remove-pack-btn").click(function(e){e.stopPropagation();const t=$(this).data("pack");confirm('Are you sure you want to remove the pack "'.concat(t,'"?'))&&(delete n.packs[t],n.selectedLoomStyle=(Array.isArray(n.selectedLoomStyle)?n.selectedLoomStyle:[]).filter(e=>e.packName!==t),n.selectedLoomUtils=n.selectedLoomUtils.filter(e=>e.packName!==t),n.selectedLoomRetrofits=n.selectedLoomRetrofits.filter(e=>e.packName!==t),n.selectedDefinition&&n.selectedDefinition.packName===t&&(n.selectedDefinition=null),n.selectedBehaviors=n.selectedBehaviors.filter(e=>e.packName!==t),n.selectedPersonalities=n.selectedPersonalities.filter(e=>e.packName!==t),n.dominantBehavior&&n.dominantBehavior.packName===t&&(n.dominantBehavior=null),n.dominantPersonality&&n.dominantPersonality.packName===t&&(n.dominantPersonality=null),(0,a.DZ)(),$(this).closest(".lumia-modal-panel").remove(),0===Object.keys(n.packs).length&&h())}),m.find(".lumia-list-item").click(function(){const e=$(this).data("pack"),t=$(this).data("item");if(s){const i=$(this);let r=n[l];const o=r.findIndex(n=>n.packName===e&&n.itemName===t);-1!==o?(r.splice(o,1),i.removeClass("selected")):(r.push({packName:e,itemName:t}),i.addClass("selected")),n[l]=r,(0,a.DZ)()}else m.find(".lumia-list-item").removeClass("selected"),$(this).addClass("selected"),n[l]={packName:e,itemName:t},(0,a.DZ)(),setTimeout(h,150)}),m[0].showModal()}function S(){var e;const n=(0,a.mt)(),t=(0,i.SD)();$("#lumia-summarization-modal").remove();const s=n.summarization||{},c=s.secondary||{},u=s.mode||"disabled",d=s.apiSource||"main",m=s.autoInterval||10,p=s.autoMessageContext||10,h=s.manualMessageContext||10,v=c.provider||"openai",f=c.model||"",g=c.endpoint||"",b=c.apiKey||"",x=c.temperature||.7,k=void 0!==c.topP?c.topP:1,w=c.maxTokens||8192,j=n.messageTruncation||{},S=j.enabled||!1,C=null!==(e=j.keepCount)&&void 0!==e?e:50,N=(null==t?void 0:t.chat)&&t.chat.length>0,P=(0,o.__)(v),M='\n        <dialog id="lumia-summarization-modal" class="popup popup--animation-fast lumia-modal lumia-modal-settings">\n            <div class="lumia-modal-header">\n                <div class="lumia-modal-header-icon">\n                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                        <line x1="21" y1="10" x2="3" y2="10"></line>\n                        <line x1="21" y1="6" x2="3" y2="6"></line>\n                        <line x1="21" y1="14" x2="3" y2="14"></line>\n                        <line x1="21" y1="18" x2="3" y2="18"></line>\n                    </svg>\n                </div>\n                <h3 class="lumia-modal-title">Summarization</h3>\n            </div>\n            <div class="lumia-modal-content">\n\n                \x3c!-- Mode Selection --\x3e\n                <div class="lumia-modal-panel">\n                    <div class="lumia-modal-panel-header">\n                        <span class="lumia-modal-panel-icon">\n                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                                <circle cx="12" cy="12" r="3"></circle>\n                                <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"></path>\n                            </svg>\n                        </span>\n                        <span class="lumia-modal-panel-title">Mode</span>\n                    </div>\n                    <div class="lumia-modal-panel-content">\n                        <div class="lumia-mode-options">\n                            <label class="lumia-mode-option '.concat("disabled"===u?"selected":"",'">\n                                <input type="radio" name="sum-mode" value="disabled" ').concat("disabled"===u?"checked":"",' />\n                                <span class="lumia-mode-option-label">Disabled</span>\n                            </label>\n                            <label class="lumia-mode-option ').concat("auto"===u?"selected":"",'">\n                                <input type="radio" name="sum-mode" value="auto" ').concat("auto"===u?"checked":"",' />\n                                <span class="lumia-mode-option-label">Automatic</span>\n                            </label>\n                            <label class="lumia-mode-option ').concat("manual"===u?"selected":"",'">\n                                <input type="radio" name="sum-mode" value="manual" ').concat("manual"===u?"checked":"",' />\n                                <span class="lumia-mode-option-label">Manual</span>\n                            </label>\n                        </div>\n                    </div>\n                </div>\n\n                \x3c!-- Auto Settings (conditional) --\x3e\n                <div class="lumia-modal-panel" id="lumia-sum-auto-section" style="').concat("auto"===u?"":"display: none;",'">\n                    <div class="lumia-modal-panel-header">\n                        <span class="lumia-modal-panel-icon">\n                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                                <circle cx="12" cy="12" r="10"></circle>\n                                <polyline points="12 6 12 12 16 14"></polyline>\n                            </svg>\n                        </span>\n                        <span class="lumia-modal-panel-title">Auto Settings</span>\n                    </div>\n                    <div class="lumia-modal-panel-content">\n                        <div class="lumia-modal-field-row">\n                            <div class="lumia-modal-field">\n                                <label class="lumia-modal-label" for="lumia-sum-interval-input">Interval</label>\n                                <input type="number" id="lumia-sum-interval-input" class="lumia-modal-input" min="1" value="').concat(m,'" />\n                                <span class="lumia-modal-hint">Every N messages</span>\n                            </div>\n                            <div class="lumia-modal-field">\n                                <label class="lumia-modal-label" for="lumia-sum-auto-context-input">Context</label>\n                                <input type="number" id="lumia-sum-auto-context-input" class="lumia-modal-input" min="1" max="100" value="').concat(p,'" />\n                                <span class="lumia-modal-hint">Messages to include</span>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                \x3c!-- Manual Context (conditional) --\x3e\n                <div class="lumia-modal-panel" id="lumia-sum-manual-section" style="').concat("manual"===u||"auto"===u?"":"display: none;",'">\n                    <div class="lumia-modal-panel-header">\n                        <span class="lumia-modal-panel-icon">\n                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>\n                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>\n                            </svg>\n                        </span>\n                        <span class="lumia-modal-panel-title">Manual Context</span>\n                    </div>\n                    <div class="lumia-modal-panel-content">\n                        <div class="lumia-modal-field">\n                            <label class="lumia-modal-label" for="lumia-sum-manual-context-input">Messages to include</label>\n                            <input type="number" id="lumia-sum-manual-context-input" class="lumia-modal-input" min="1" max="100" value="').concat(h,'" />\n                            <span class="lumia-modal-hint">When using /loom-summarize command</span>\n                        </div>\n                    </div>\n                </div>\n\n                \x3c!-- API Source --\x3e\n                <div class="lumia-modal-panel">\n                    <div class="lumia-modal-panel-header">\n                        <span class="lumia-modal-panel-icon">\n                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                                <path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"></path>\n                            </svg>\n                        </span>\n                        <span class="lumia-modal-panel-title">API Source</span>\n                    </div>\n                    <div class="lumia-modal-panel-content">\n                        <div class="lumia-mode-options">\n                            <label class="lumia-mode-option lumia-mode-option-wide ').concat("main"===d?"selected":"",'">\n                                <input type="radio" name="sum-source" value="main" ').concat("main"===d?"checked":"",' />\n                                <span class="lumia-mode-option-label">Main API</span>\n                            </label>\n                            <label class="lumia-mode-option lumia-mode-option-wide ').concat("secondary"===d?"selected":"",'">\n                                <input type="radio" name="sum-source" value="secondary" ').concat("secondary"===d?"checked":"",' />\n                                <span class="lumia-mode-option-label">Secondary LLM</span>\n                            </label>\n                        </div>\n                    </div>\n                </div>\n\n                \x3c!-- Secondary LLM Config (conditional) --\x3e\n                <div class="lumia-modal-panel" id="lumia-sum-secondary-section" style="').concat("secondary"===d?"":"display: none;",'">\n                    <div class="lumia-modal-panel-header">\n                        <span class="lumia-modal-panel-icon">\n                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                                <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>\n                                <line x1="8" y1="21" x2="16" y2="21"></line>\n                                <line x1="12" y1="17" x2="12" y2="21"></line>\n                            </svg>\n                        </span>\n                        <span class="lumia-modal-panel-title">Secondary LLM</span>\n                    </div>\n                    <div class="lumia-modal-panel-content">\n                        <div class="lumia-modal-field">\n                            <label class="lumia-modal-label" for="lumia-sum-provider-select">Provider</label>\n                            <select id="lumia-sum-provider-select" class="lumia-modal-select">\n                                ').concat(Object.entries(o.x$).map(e=>{let[n,t]=e;return'<option value="'.concat(n,'" ').concat(v===n?"selected":"",">").concat(t.name,"</option>")}).join(""),'\n                            </select>\n                            <span class="lumia-modal-hint lumia-sum-provider-hint ').concat("custom"===v?"lumia-hidden":"",'">\n                                Uses API key from SillyTavern settings\n                            </span>\n                        </div>\n\n                        <div class="lumia-modal-field-row">\n                            <div class="lumia-modal-field">\n                                <label class="lumia-modal-label" for="lumia-sum-model-input">Model</label>\n                                <input type="text" id="lumia-sum-model-input" class="lumia-modal-input"\n                                       placeholder="').concat(P.placeholder,'"\n                                       value="').concat((0,r.ZD)(f),'" />\n                            </div>\n                        </div>\n\n                        <div class="lumia-modal-field lumia-sum-custom-fields ').concat("custom"===v?"":"lumia-hidden",'">\n                            <label class="lumia-modal-label" for="lumia-sum-endpoint-input">Endpoint URL</label>\n                            <input type="text" id="lumia-sum-endpoint-input" class="lumia-modal-input"\n                                   placeholder="https://your-api.com/v1/chat/completions"\n                                   value="').concat((0,r.ZD)(g),'" />\n                        </div>\n\n                        <div class="lumia-modal-field lumia-sum-custom-fields ').concat("custom"===v?"":"lumia-hidden",'">\n                            <label class="lumia-modal-label" for="lumia-sum-apikey-input">API Key</label>\n                            <input type="password" id="lumia-sum-apikey-input" class="lumia-modal-input"\n                                   placeholder="Your API key"\n                                   value="').concat((0,r.ZD)(b),'" />\n                        </div>\n\n                        <div class="lumia-modal-field-row lumia-modal-field-row-3">\n                            <div class="lumia-modal-field">\n                                <label class="lumia-modal-label" for="lumia-sum-temp-input">Temp</label>\n                                <input type="number" id="lumia-sum-temp-input" class="lumia-modal-input"\n                                       min="0" max="2" step="0.1" value="').concat(x,'" />\n                            </div>\n                            <div class="lumia-modal-field">\n                                <label class="lumia-modal-label" for="lumia-sum-topp-input">Top-P</label>\n                                <input type="number" id="lumia-sum-topp-input" class="lumia-modal-input"\n                                       min="0" max="1" step="0.05" value="').concat(k,'" />\n                            </div>\n                            <div class="lumia-modal-field">\n                                <label class="lumia-modal-label" for="lumia-sum-maxtokens-input">Max Tokens</label>\n                                <input type="text" id="lumia-sum-maxtokens-input" class="lumia-modal-input"\n                                       value="').concat(w,'" />\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                \x3c!-- Test Section --\x3e\n                <div class="lumia-modal-panel lumia-modal-panel-accent">\n                    <div class="lumia-modal-panel-header">\n                        <span class="lumia-modal-panel-icon">\n                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                                <polygon points="5 3 19 12 5 21 5 3"></polygon>\n                            </svg>\n                        </span>\n                        <span class="lumia-modal-panel-title">Test</span>\n                    </div>\n                    <div class="lumia-modal-panel-content">\n                        <button id="lumia-sum-test-btn" class="lumia-modal-btn lumia-modal-btn-primary lumia-modal-btn-full ').concat(N?"":"lumia-btn-disabled",'" ').concat(N?"":"disabled",'>\n                            <span class="lumia-btn-icon">\n                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                                    <polyline points="20 6 9 17 4 12"></polyline>\n                                </svg>\n                            </span>\n                            <span class="lumia-btn-spinner lumia-hidden"></span>\n                            <span class="lumia-btn-text">').concat(N?"Generate Summary Now":"No Active Chat",'</span>\n                        </button>\n                        <div id="lumia-sum-test-result" class="lumia-test-result lumia-hidden"></div>\n                        ').concat(N?"":'<div class="lumia-test-hint">Open a chat to test summarization</div>','\n                    </div>\n                </div>\n\n                \x3c!-- Message Truncation Section --\x3e\n                <div class="lumia-modal-panel">\n                    <div class="lumia-modal-panel-header">\n                        <span class="lumia-modal-panel-icon">\n                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>\n                            </svg>\n                        </span>\n                        <span class="lumia-modal-panel-title">Save N Messages</span>\n                    </div>\n                    <div class="lumia-modal-panel-content">\n                        <div class="lumia-filter-item">\n                            <div class="lumia-toggle-row">\n                                <label class="lumia-toggle-label" for="lumia-trunc-toggle">\n                                    <span class="lumia-toggle-text">Limit Context Messages</span>\n                                    <span class="lumia-toggle-hint">Only send the last N messages to the AI</span>\n                                </label>\n                                <div class="lumia-toggle-switch-wrapper">\n                                    <input type="checkbox" id="lumia-trunc-toggle" class="lumia-toggle-input" ').concat(S?"checked":"",' />\n                                    <label for="lumia-trunc-toggle" class="lumia-toggle-switch-label">\n                                        <div class="lumia-toggle-track">\n                                            <div class="lumia-toggle-thumb"></div>\n                                        </div>\n                                    </label>\n                                </div>\n                            </div>\n                            <div class="lumia-filter-options ').concat(S?"":"lumia-filter-options-hidden",'">\n                                <label class="lumia-input-label">\n                                    <span>Messages to keep:</span>\n                                    <input type="number" id="lumia-trunc-count-input" class="lumia-input-number" value="').concat(C,'" min="5" max="500" />\n                                </label>\n                                <span class="lumia-input-hint">Number of recent messages to include in context</span>\n\n                                <div class="lumia-warning-box">\n                                    <div class="lumia-warning-box-icon">\n                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                                            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>\n                                            <line x1="12" y1="9" x2="12" y2="13"></line>\n                                            <line x1="12" y1="17" x2="12.01" y2="17"></line>\n                                        </svg>\n                                    </div>\n                                    <div class="lumia-warning-box-content">\n                                        <div class="lumia-warning-box-title">Memory Loss Warning</div>\n                                        <div class="lumia-warning-box-text">\n                                            Older messages beyond this limit will be excluded from the AI\'s context.\n                                            The AI will lose awareness of earlier events, character details, and plot points.\n                                            Consider using Loom summarization to preserve important memories.\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n            </div>\n            <div class="lumia-modal-footer">\n                <button class="lumia-modal-btn lumia-modal-btn-secondary lumia-sum-cancel-btn">Cancel</button>\n                <button class="lumia-modal-btn lumia-modal-btn-primary lumia-sum-save-btn">Save Changes</button>\n            </div>\n        </dialog>\n    ');$("body").append(M);const E=$("#lumia-summarization-modal");y(E);const L=()=>{E[0]._resizeCleanup&&E[0]._resizeCleanup(),E[0].close(),E.remove()};E.on("click mousedown mouseup",function(e){e.stopPropagation(),"click"===e.type&&e.target===this&&L()}),E.find('input[name="sum-mode"]').change(function(){E.find(".lumia-mode-option").each(function(){$(this).find('input[name="sum-mode"]').is(":checked")?$(this).addClass("selected"):$(this).removeClass("selected")});const e=$(this).val();"auto"===e?(E.find("#lumia-sum-auto-section").show(),E.find("#lumia-sum-manual-section").show()):"manual"===e?(E.find("#lumia-sum-auto-section").hide(),E.find("#lumia-sum-manual-section").show()):(E.find("#lumia-sum-auto-section").hide(),E.find("#lumia-sum-manual-section").hide())}),E.find('input[name="sum-source"]').change(function(){E.find(".lumia-mode-option").each(function(){const e=$(this).find('input[name="sum-source"]');e.length&&e.is(":checked")?$(this).addClass("selected"):$(this).find('input[name="sum-source"]').length&&$(this).removeClass("selected")});"secondary"===$(this).val()?E.find("#lumia-sum-secondary-section").show():E.find("#lumia-sum-secondary-section").hide()}),E.find("#lumia-sum-provider-select").change(function(){const e=$(this).val(),n=(0,o.Iv)(e);E.find("#lumia-sum-model-input").attr("placeholder",n.placeholder),"custom"===e?(E.find(".lumia-sum-custom-fields").removeClass("lumia-hidden"),E.find(".lumia-sum-provider-hint").addClass("lumia-hidden")):(E.find(".lumia-sum-custom-fields").addClass("lumia-hidden"),E.find(".lumia-sum-provider-hint").removeClass("lumia-hidden"))}),E.find("#lumia-trunc-toggle").change(function(){const e=$(this).closest(".lumia-filter-item").find(".lumia-filter-options");$(this).is(":checked")?e.removeClass("lumia-filter-options-hidden"):e.addClass("lumia-filter-options-hidden")});const D=e=>{const n=parseInt(e,10);return isNaN(n)||!/^\d+$/.test(String(e).trim())?8192:Math.max(256,n)};E.find("#lumia-sum-test-btn").click(async function(){const e=$(this),n=e.find(".lumia-btn-icon"),t=e.find(".lumia-btn-spinner"),i=e.find(".lumia-btn-text"),r=E.find("#lumia-sum-test-result");e.prop("disabled",!0),n.addClass("lumia-hidden"),t.removeClass("lumia-hidden"),i.text("Weaving summary..."),r.addClass("lumia-hidden").removeClass("lumia-test-result-success lumia-test-result-error");try{const a={mode:E.find('input[name="sum-mode"]:checked').val(),apiSource:E.find('input[name="sum-source"]:checked').val(),autoInterval:parseInt(E.find("#lumia-sum-interval-input").val())||10,autoMessageContext:parseInt(E.find("#lumia-sum-auto-context-input").val())||10,manualMessageContext:parseInt(E.find("#lumia-sum-manual-context-input").val())||10,secondary:{provider:E.find("#lumia-sum-provider-select").val(),model:E.find("#lumia-sum-model-input").val(),endpoint:E.find("#lumia-sum-endpoint-input").val(),apiKey:E.find("#lumia-sum-apikey-input").val(),temperature:parseFloat(E.find("#lumia-sum-temp-input").val())||.7,topP:parseFloat(E.find("#lumia-sum-topp-input").val())||1,maxTokens:D(E.find("#lumia-sum-maxtokens-input").val())}},s=await(0,o.Zq)(a,!0);e.prop("disabled",!1),t.addClass("lumia-hidden"),n.removeClass("lumia-hidden"),i.text("Generate Summary Now"),s?(r.removeClass("lumia-hidden").addClass("lumia-test-result-success").html('\n            <div class="lumia-test-result-icon">\n              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                <polyline points="20 6 9 17 4 12"></polyline>\n              </svg>\n            </div>\n            <div class="lumia-test-result-content">\n              <div class="lumia-test-result-title">Summary woven successfully!</div>\n              <div class="lumia-test-result-text">Saved to chat metadata.</div>\n            </div>\n          '),toastr.success("Summary generated and saved to chat metadata!")):r.removeClass("lumia-hidden").addClass("lumia-test-result-error").html('\n            <div class="lumia-test-result-icon">\n              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                <circle cx="12" cy="12" r="10"></circle>\n                <line x1="12" y1="8" x2="12" y2="12"></line>\n                <line x1="12" y1="16" x2="12.01" y2="16"></line>\n              </svg>\n            </div>\n            <div class="lumia-test-result-content">\n              <div class="lumia-test-result-title">No summary generated</div>\n              <div class="lumia-test-result-text">Check console for details.</div>\n            </div>\n          ')}catch(o){console.error("[".concat(a.pW,"] Summarization error:"),o),e.prop("disabled",!1),t.addClass("lumia-hidden"),n.removeClass("lumia-hidden"),i.text("Generate Summary Now"),r.removeClass("lumia-hidden").addClass("lumia-test-result-error").html('\n          <div class="lumia-test-result-icon">\n            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n              <circle cx="12" cy="12" r="10"></circle>\n              <path d="M15 9l-6 6M9 9l6 6"></path>\n            </svg>\n          </div>\n          <div class="lumia-test-result-content">\n            <div class="lumia-test-result-title">Error</div>\n            <div class="lumia-test-result-text">'.concat(o.message,"</div>\n          </div>\n        "))}}),E.find(".lumia-sum-save-btn").click(()=>{const e=D(E.find("#lumia-sum-maxtokens-input").val());E.find("#lumia-sum-maxtokens-input").val(e),n.summarization={mode:E.find('input[name="sum-mode"]:checked').val(),apiSource:E.find('input[name="sum-source"]:checked').val(),autoInterval:parseInt(E.find("#lumia-sum-interval-input").val())||10,autoMessageContext:parseInt(E.find("#lumia-sum-auto-context-input").val())||10,manualMessageContext:parseInt(E.find("#lumia-sum-manual-context-input").val())||10,secondary:{provider:E.find("#lumia-sum-provider-select").val(),model:E.find("#lumia-sum-model-input").val(),endpoint:E.find("#lumia-sum-endpoint-input").val(),apiKey:E.find("#lumia-sum-apikey-input").val(),temperature:parseFloat(E.find("#lumia-sum-temp-input").val())||.7,topP:parseFloat(E.find("#lumia-sum-topp-input").val())||1,maxTokens:e}},n.messageTruncation={enabled:E.find("#lumia-trunc-toggle").is(":checked"),keepCount:parseInt(E.find("#lumia-trunc-count-input").val())||50},(0,a.DZ)(),(0,l.TC)(),toastr.success("Summarization settings saved!"),L()}),E.find(".lumia-sum-cancel-btn").click(L),E.on("keydown",function(e){"Escape"===e.key&&L()}),E[0].showModal()}function C(){const e=(0,a.mt)();$("#lumia-prompt-settings-modal").remove();const n=e.sovereignHand||{},t=n.enabled||!1,i=!1!==n.excludeLastMessage,r=!1!==n.includeMessageInPrompt,o=e.contextFilters||{},s=o.htmlTags||{},c=o.detailsBlocks||{},u=o.loomItems||{},d='\n        <dialog id="lumia-prompt-settings-modal" class="popup popup--animation-fast lumia-modal lumia-modal-settings">\n            <div class="lumia-modal-header">\n                <div class="lumia-modal-header-icon">\n                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>\n                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>\n                    </svg>\n                </div>\n                <h3 class="lumia-modal-title">Prompt Settings</h3>\n            </div>\n            <div class="lumia-modal-content">\n\n                \x3c!-- Sovereign Hand Section --\x3e\n                <div class="lumia-modal-panel lumia-collapsible">\n                    <div class="lumia-modal-panel-header lumia-collapsible-trigger">\n                        <span class="lumia-panel-collapse-icon">\n                            '.concat(b,'\n                        </span>\n                        <span class="lumia-modal-panel-icon">\n                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                                <path d="M18 3a3 3 0 0 0-3 3v12a3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3H6a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3V6a3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3h12a3 3 0 0 0 3-3 3 3 0 0 0-3-3z"></path>\n                            </svg>\n                        </span>\n                        <span class="lumia-modal-panel-title">Sovereign Hand</span>\n                        <span class="lumia-panel-status ').concat(t?"lumia-panel-status-active":"",'">').concat(t?"Active":"Inactive",'</span>\n                    </div>\n                    <div class="lumia-modal-panel-content lumia-collapsible-content">\n                        <div class="lumia-panel-content-inner">\n                            <p class="lumia-modal-description">Enable Sovereign Hand integration to use advanced prompt manipulation features.</p>\n\n                            <div class="lumia-toggle-row">\n                                <label class="lumia-toggle-label" for="lumia-sovereign-hand-toggle">\n                                    <span class="lumia-toggle-text">Use Sovereign Hand Features</span>\n                                    <span class="lumia-toggle-hint">Enables Sovereign Hand macros for advanced prompt control</span>\n                                </label>\n                                <div class="lumia-toggle-switch-wrapper">\n                                    <input type="checkbox" id="lumia-sovereign-hand-toggle" class="lumia-toggle-input" ').concat(t?"checked":"",' />\n                                    <label for="lumia-sovereign-hand-toggle" class="lumia-toggle-switch-label">\n                                        <div class="lumia-toggle-track">\n                                            <div class="lumia-toggle-thumb"></div>\n                                        </div>\n                                    </label>\n                                </div>\n                            </div>\n\n                            <div class="lumia-toggle-row ').concat(t?"":"lumia-toggle-disabled",'">\n                                <label class="lumia-toggle-label" for="lumia-sovereign-exclude-toggle">\n                                    <span class="lumia-toggle-text">Exclude Last Message from Context</span>\n                                    <span class="lumia-toggle-hint">When enabled, removes the last user message from the outgoing context</span>\n                                </label>\n                                <div class="lumia-toggle-switch-wrapper">\n                                    <input type="checkbox" id="lumia-sovereign-exclude-toggle" class="lumia-toggle-input" ').concat(i?"checked":""," ").concat(t?"":"disabled",' />\n                                    <label for="lumia-sovereign-exclude-toggle" class="lumia-toggle-switch-label">\n                                        <div class="lumia-toggle-track">\n                                            <div class="lumia-toggle-thumb"></div>\n                                        </div>\n                                    </label>\n                                </div>\n                            </div>\n\n                            <div class="lumia-toggle-row ').concat(t?"":"lumia-toggle-disabled",'">\n                                <label class="lumia-toggle-label" for="lumia-sovereign-include-prompt-toggle">\n                                    <span class="lumia-toggle-text">Include Message in Master Prompt</span>\n                                    <span class="lumia-toggle-hint">When enabled, includes the user message in the {{loomSovHand}} macro output</span>\n                                </label>\n                                <div class="lumia-toggle-switch-wrapper">\n                                    <input type="checkbox" id="lumia-sovereign-include-prompt-toggle" class="lumia-toggle-input" ').concat(r?"checked":""," ").concat(t?"":"disabled",' />\n                                    <label for="lumia-sovereign-include-prompt-toggle" class="lumia-toggle-switch-label">\n                                        <div class="lumia-toggle-track">\n                                            <div class="lumia-toggle-thumb"></div>\n                                        </div>\n                                    </label>\n                                </div>\n                            </div>\n\n                            <div class="lumia-info-box lumia-info-box-sovereign ').concat(t?"":"lumia-info-box-muted",'">\n                                <div class="lumia-info-box-header">\n                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                                        <circle cx="12" cy="12" r="10"></circle>\n                                        <line x1="12" y1="16" x2="12" y2="12"></line>\n                                        <line x1="12" y1="8" x2="12.01" y2="8"></line>\n                                    </svg>\n                                    <span>Available macros:</span>\n                                </div>\n                                <ul class="lumia-info-box-list">\n                                    <li><code>{{loomLastUserMessage}}</code> returns the last user message content</li>\n                                    <li><code>{{loomLastCharMessage}}</code> returns the last character message content</li>\n                                    <li><code>{{lastMessageName}}</code> returns the name of whoever sent the last message</li>\n                                    <li><code>{{loomContinuePrompt}}</code> adds continuation instructions when character spoke last</li>\n                                </ul>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                \x3c!-- Context Filters Section --\x3e\n                <div class="lumia-modal-panel lumia-collapsible">\n                    <div class="lumia-modal-panel-header lumia-collapsible-trigger">\n                        <span class="lumia-panel-collapse-icon">\n                            ').concat(b,'\n                        </span>\n                        <span class="lumia-modal-panel-icon">\n                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                                <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>\n                            </svg>\n                        </span>\n                        <span class="lumia-modal-panel-title">Context Filters</span>\n                        <span class="lumia-panel-status ').concat(s.enabled||c.enabled||u.enabled?"lumia-panel-status-active":"",'">').concat(s.enabled||c.enabled||u.enabled?"Active":"Inactive",'</span>\n                    </div>\n                    <div class="lumia-modal-panel-content lumia-collapsible-content">\n                        <div class="lumia-panel-content-inner">\n                            <p class="lumia-modal-description">Filter out specific content from the chat context before sending to the AI. Helps reduce token usage and keep prompts clean.</p>\n\n                            \x3c!-- HTML Tags Filter --\x3e\n                            <div class="lumia-filter-item">\n                                <div class="lumia-toggle-row">\n                                    <label class="lumia-toggle-label" for="lumia-filter-html-toggle">\n                                        <span class="lumia-toggle-text">Strip HTML Tags</span>\n                                        <span class="lumia-toggle-hint">Removes formatting tags: &lt;div&gt;, &lt;span&gt;, &lt;b&gt;, &lt;i&gt;, &lt;u&gt;, &lt;em&gt;, &lt;strong&gt;</span>\n                                    </label>\n                                    <div class="lumia-toggle-switch-wrapper">\n                                        <input type="checkbox" id="lumia-filter-html-toggle" class="lumia-toggle-input" ').concat(s.enabled?"checked":"",' />\n                                        <label for="lumia-filter-html-toggle" class="lumia-toggle-switch-label">\n                                            <div class="lumia-toggle-track">\n                                                <div class="lumia-toggle-thumb"></div>\n                                            </div>\n                                        </label>\n                                    </div>\n                                </div>\n                                <div class="lumia-filter-options ').concat(s.enabled?"":"lumia-filter-options-hidden",'">\n                                    \x3c!-- Strip Fonts Sub-toggle --\x3e\n                                    <div class="lumia-filter-sub-item">\n                                        <div class="lumia-toggle-row">\n                                            <label class="lumia-toggle-label" for="lumia-filter-fonts-toggle">\n                                                <span class="lumia-toggle-text">Also Strip Fonts</span>\n                                                <span class="lumia-toggle-hint">Remove &lt;font&gt; tags (used by some presets for colored dialogue)</span>\n                                            </label>\n                                            <div class="lumia-toggle-switch-wrapper">\n                                                <input type="checkbox" id="lumia-filter-fonts-toggle" class="lumia-toggle-input" ').concat(s.stripFonts?"checked":"",' />\n                                                <label for="lumia-filter-fonts-toggle" class="lumia-toggle-switch-label">\n                                                    <div class="lumia-toggle-track">\n                                                        <div class="lumia-toggle-thumb"></div>\n                                                    </div>\n                                                </label>\n                                            </div>\n                                        </div>\n                                        <div class="lumia-filter-options lumia-filter-sub-options ').concat(s.stripFonts?"":"lumia-filter-options-hidden",'">\n                                            <label class="lumia-input-label">\n                                                <span>Keep fonts in last N messages:</span>\n                                                <input type="number" id="lumia-filter-fonts-depth" class="lumia-input-number" value="').concat(s.fontKeepDepth||3,'" min="0" max="100" />\n                                            </label>\n                                            <span class="lumia-input-hint">Font tags in older messages will be stripped to save tokens</span>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n\n                            \x3c!-- Details Blocks Filter --\x3e\n                            <div class="lumia-filter-item">\n                                <div class="lumia-toggle-row">\n                                    <label class="lumia-toggle-label" for="lumia-filter-details-toggle">\n                                        <span class="lumia-toggle-text">Filter Details Blocks</span>\n                                        <span class="lumia-toggle-hint">Removes &lt;details&gt; blocks from older messages to save context</span>\n                                    </label>\n                                    <div class="lumia-toggle-switch-wrapper">\n                                        <input type="checkbox" id="lumia-filter-details-toggle" class="lumia-toggle-input" ').concat(c.enabled?"checked":"",' />\n                                        <label for="lumia-filter-details-toggle" class="lumia-toggle-switch-label">\n                                            <div class="lumia-toggle-track">\n                                                <div class="lumia-toggle-thumb"></div>\n                                            </div>\n                                        </label>\n                                    </div>\n                                </div>\n                                <div class="lumia-filter-options ').concat(c.enabled?"":"lumia-filter-options-hidden",'">\n                                    <label class="lumia-input-label">\n                                        <span>Keep in last N messages:</span>\n                                        <input type="number" id="lumia-filter-details-depth" class="lumia-input-number" value="').concat(c.keepDepth||3,'" min="0" max="100" />\n                                    </label>\n                                    <span class="lumia-input-hint">Messages beyond this depth will have &lt;details&gt; blocks removed</span>\n                                </div>\n                            </div>\n\n                            \x3c!-- Loom Items Filter --\x3e\n                            <div class="lumia-filter-item">\n                                <div class="lumia-toggle-row">\n                                    <label class="lumia-toggle-label" for="lumia-filter-loom-toggle">\n                                        <span class="lumia-toggle-text">Filter Loom Tags</span>\n                                        <span class="lumia-toggle-hint">Removes Lucid Loom-related tags from older messages</span>\n                                    </label>\n                                    <div class="lumia-toggle-switch-wrapper">\n                                        <input type="checkbox" id="lumia-filter-loom-toggle" class="lumia-toggle-input" ').concat(u.enabled?"checked":"",' />\n                                        <label for="lumia-filter-loom-toggle" class="lumia-toggle-switch-label">\n                                            <div class="lumia-toggle-track">\n                                                <div class="lumia-toggle-thumb"></div>\n                                            </div>\n                                        </label>\n                                    </div>\n                                </div>\n                                <div class="lumia-filter-options ').concat(u.enabled?"":"lumia-filter-options-hidden",'">\n                                    <label class="lumia-input-label">\n                                        <span>Keep in last N messages:</span>\n                                        <input type="number" id="lumia-filter-loom-depth" class="lumia-input-number" value="').concat(u.keepDepth||5,'" min="0" max="100" />\n                                    </label>\n                                    <span class="lumia-input-hint">Loom tags in older messages will be stripped to save tokens</span>\n                                </div>\n                            </div>\n\n                        </div>\n                    </div>\n                </div>\n\n            </div>\n            <div class="lumia-modal-footer">\n                <button class="lumia-modal-btn lumia-modal-btn-secondary lumia-prompt-settings-cancel-btn">Cancel</button>\n                <button class="lumia-modal-btn lumia-modal-btn-primary lumia-prompt-settings-save-btn">Save Changes</button>\n            </div>\n        </dialog>\n    ');$("body").append(d);const m=$("#lumia-prompt-settings-modal");y(m);const p=()=>{m[0]._resizeCleanup&&m[0]._resizeCleanup(),m[0].close(),m.remove()};function h(){const e=m.find("#lumia-filter-html-toggle").is(":checked"),n=m.find("#lumia-filter-details-toggle").is(":checked"),t=m.find("#lumia-filter-loom-toggle").is(":checked"),i=m.find(".lumia-modal-panel").eq(1).find(".lumia-panel-status");e||n||t?i.addClass("lumia-panel-status-active").text("Active"):i.removeClass("lumia-panel-status-active").text("Inactive")}m.on("click mousedown mouseup",function(e){e.stopPropagation(),"click"===e.type&&e.target===this&&p()}),m.find(".lumia-collapsible-trigger").click(function(e){$(e.target).closest("input, label, .lumia-toggle-switch-wrapper").length>0||$(this).closest(".lumia-collapsible").toggleClass("collapsed")}),m.find("#lumia-sovereign-hand-toggle").change(function(){const e=$(this).is(":checked"),n=m.find(".lumia-info-box-sovereign"),t=$(this).closest(".lumia-collapsible").find(".lumia-panel-status"),i=m.find("#lumia-sovereign-exclude-toggle"),a=i.closest(".lumia-toggle-row"),r=m.find("#lumia-sovereign-include-prompt-toggle"),o=r.closest(".lumia-toggle-row");e?(n.removeClass("lumia-info-box-muted"),t.addClass("lumia-panel-status-active").text("Active"),i.prop("disabled",!1),a.removeClass("lumia-toggle-disabled"),r.prop("disabled",!1),o.removeClass("lumia-toggle-disabled")):(n.addClass("lumia-info-box-muted"),t.removeClass("lumia-panel-status-active").text("Inactive"),i.prop("disabled",!0),a.addClass("lumia-toggle-disabled"),r.prop("disabled",!0),o.addClass("lumia-toggle-disabled"))}),m.find("#lumia-filter-details-toggle").change(function(){const e=$(this).closest(".lumia-filter-item").find(".lumia-filter-options");$(this).is(":checked")?e.removeClass("lumia-filter-options-hidden"):e.addClass("lumia-filter-options-hidden"),h()}),m.find("#lumia-filter-loom-toggle").change(function(){const e=$(this).closest(".lumia-filter-item").find(".lumia-filter-options");$(this).is(":checked")?e.removeClass("lumia-filter-options-hidden"):e.addClass("lumia-filter-options-hidden"),h()}),m.find("#lumia-filter-html-toggle").change(function(){const e=$(this).closest(".lumia-filter-item").find("> .lumia-filter-options");$(this).is(":checked")?e.removeClass("lumia-filter-options-hidden"):e.addClass("lumia-filter-options-hidden"),h()}),m.find("#lumia-filter-fonts-toggle").change(function(){const e=$(this).closest(".lumia-filter-sub-item").find(".lumia-filter-sub-options");$(this).is(":checked")?e.removeClass("lumia-filter-options-hidden"):e.addClass("lumia-filter-options-hidden")}),m.find(".lumia-prompt-settings-save-btn").click(()=>{const n=m.find("#lumia-sovereign-hand-toggle").is(":checked"),t=m.find("#lumia-sovereign-exclude-toggle").is(":checked"),i=m.find("#lumia-sovereign-include-prompt-toggle").is(":checked");e.sovereignHand||(e.sovereignHand={}),e.sovereignHand.enabled=n,e.sovereignHand.excludeLastMessage=t,e.sovereignHand.includeMessageInPrompt=i,e.contextFilters||(e.contextFilters={}),e.contextFilters.htmlTags={enabled:m.find("#lumia-filter-html-toggle").is(":checked"),stripFonts:m.find("#lumia-filter-fonts-toggle").is(":checked"),fontKeepDepth:parseInt(m.find("#lumia-filter-fonts-depth").val())||3},e.contextFilters.detailsBlocks={enabled:m.find("#lumia-filter-details-toggle").is(":checked"),keepDepth:parseInt(m.find("#lumia-filter-details-depth").val())||3},e.contextFilters.loomItems={enabled:m.find("#lumia-filter-loom-toggle").is(":checked"),keepDepth:parseInt(m.find("#lumia-filter-loom-depth").val())||5},(0,a.DZ)(),(0,l.TC)(),toastr.success("Prompt settings saved!"),p()}),m.find(".lumia-prompt-settings-cancel-btn").click(p),m.on("keydown",function(e){"Escape"===e.key&&p()}),m[0].showModal()}async function N(){(0,a.mt)();$("#lucid-cards-modal").remove();$("body").append('\n        <dialog id="lucid-cards-modal" class="popup popup--animation-fast lumia-modal lumia-modal-lucid-cards">\n            <div class="lumia-modal-header">\n                <div class="lumia-modal-header-icon">\n                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                        <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>\n                        <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>\n                        <line x1="12" y1="22.08" x2="12" y2="12"></line>\n                    </svg>\n                </div>\n                <div class="lumia-modal-header-text">\n                    <h3 class="lumia-modal-title">Lucid Cards Browser</h3>\n                    <p class="lumia-modal-subtitle">Browse and import official Lumiverse content</p>\n                </div>\n            </div>\n            <div class="lucid-cards-tabs">\n                <button class="lucid-cards-tab active" data-category="Lumia DLCs">\n                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>\n                        <circle cx="12" cy="7" r="4"></circle>\n                    </svg>\n                    <span>Lumia DLCs</span>\n                </button>\n                <button class="lucid-cards-tab" data-category="Loom Utilities">\n                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                        <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path>\n                    </svg>\n                    <span>Utilities</span>\n                </button>\n                <button class="lucid-cards-tab" data-category="Loom Retrofits">\n                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                        <circle cx="12" cy="12" r="3"></circle>\n                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"></path>\n                    </svg>\n                    <span>Retrofits</span>\n                </button>\n                <button class="lucid-cards-tab" data-category="Loom Narratives">\n                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                        <path d="M12 19l7-7 3 3-7 7-3-3z"></path>\n                        <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"></path>\n                        <path d="M2 2l7.586 7.586"></path>\n                        <circle cx="11" cy="11" r="2"></circle>\n                    </svg>\n                    <span>Narratives</span>\n                </button>\n            </div>\n            <div class="lumia-modal-content">\n                <div class="lucid-cards-loading">\n                    <div class="lucid-cards-spinner"></div>\n                    <span>Loading content from Lucid.cards...</span>\n                </div>\n                <div class="lucid-cards-error" style="display: none;">\n                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                        <circle cx="12" cy="12" r="10"></circle>\n                        <line x1="15" y1="9" x2="9" y2="15"></line>\n                        <line x1="9" y1="9" x2="15" y2="15"></line>\n                    </svg>\n                    <span class="lucid-cards-error-message">Failed to load content</span>\n                    <button class="lumia-modal-btn lumia-modal-btn-secondary lucid-cards-retry-btn">Retry</button>\n                </div>\n                <div class="lucid-cards-content" style="display: none;"></div>\n            </div>\n            <div class="lumia-modal-footer lucid-cards-footer">\n                <button class="lumia-modal-btn lumia-modal-btn-secondary lucid-cards-close-btn">Close</button>\n                <div class="lucid-cards-selected-info" style="display: none;">\n                    <span class="lucid-cards-selected-name"></span>\n                    <span class="lucid-cards-selected-author"></span>\n                </div>\n                <button class="lumia-modal-btn lumia-modal-btn-primary lucid-cards-import-btn" style="display: none;">\n                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>\n                        <polyline points="7 10 12 15 17 10"></polyline>\n                        <line x1="12" y1="15" x2="12" y2="3"></line>\n                    </svg>\n                    Add to Lumiverse\n                </button>\n            </div>\n        </dialog>\n    ');const e=$("#lucid-cards-modal");let n="Lumia DLCs",i=null,o=null;const s=()=>{const n=e[0],t=(window.innerHeight||document.documentElement.clientHeight)-((window.innerWidth||document.documentElement.clientWidth)<=600?24:48);n.style.maxHeight="".concat(t,"px");const i=e.find(".lumia-modal-header"),a=e.find(".lucid-cards-tabs"),r=e.find(".lumia-modal-footer"),o=e.find(".lumia-modal-content");requestAnimationFrame(()=>{const e=i.length?i[0].offsetHeight:0,n=a.length?a[0].offsetHeight:0,s=r.length?r[0].offsetHeight:0,l=t-e-n-s;o.length&&(o[0].style.maxHeight="".concat(l,"px"),o[0].style.overflowY="auto")})};s();const l=()=>s();window.addEventListener("resize",l),e[0]._resizeCleanup=()=>window.removeEventListener("resize",l);const c=()=>{e[0]._resizeCleanup&&e[0]._resizeCleanup(),e[0].close(),e.remove(),p()};e.on("click mousedown mouseup",function(e){e.stopPropagation(),"click"===e.type&&e.target===this&&c()}),e.on("keydown",function(e){"Escape"===e.key&&c()});const u=async()=>{e.find(".lucid-cards-loading").show(),e.find(".lucid-cards-error").hide(),e.find(".lucid-cards-content").hide(),e.find(".lucid-cards-selected-info, .lucid-cards-import-btn").hide(),i=null;try{const e=await fetch("https://lucid.cards/api/raw/world-books?lumiverse=true");if(!e.ok)throw new Error("HTTP error: ".concat(e.status));o=await e.json(),d()}catch(n){console.error("[".concat(a.pW,"] Failed to fetch Lucid.cards:"),n),e.find(".lucid-cards-loading").hide(),e.find(".lucid-cards-error-message").text("Failed to load: ".concat(n.message)),e.find(".lucid-cards-error").show()}},d=()=>{if(!o||!o.categories)return e.find(".lucid-cards-loading").hide(),e.find(".lucid-cards-error-message").text("No content available"),void e.find(".lucid-cards-error").show();e.find(".lucid-cards-loading").hide(),e.find(".lucid-cards-error").hide();const t=e.find(".lucid-cards-content");t.empty();const a={"Lumia DLCs":["Lumia DLCs","Lumia","DLCs","Lumia Packs"],"Loom Utilities":["Loom Utilities","Utilities","Loom Utils"],"Loom Retrofits":["Loom Retrofits","Retrofits","Retrofit"],"Loom Narratives":["Loom Narratives","Narratives","Narrative Styles","Narrative"]}[n]||[n],s=o.categories.find(e=>{const n=e.displayName||"",t=e.name||"";return a.some(e=>n.toLowerCase()===e.toLowerCase()||t.toLowerCase()===e.toLowerCase()||n.toLowerCase().includes(e.toLowerCase())||t.toLowerCase().includes(e.toLowerCase()))});if(!s||!s.books||0===s.books.length)return t.html('<div class="lucid-cards-empty">No items available in this category.</div>'),void t.show();const l=s.books.map(e=>{const n=(0,r.ZD)(e.prettyName),t=(0,r.ZD)(e.path);return'\n                  <div class="lucid-dlc-card" data-path="'.concat(t,'" data-name="').concat(n,'">\n                      <div class="lucid-dlc-card-image">\n                          <div class="lucid-dlc-card-placeholder">\n                              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">\n                                  <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>\n                                  <circle cx="8.5" cy="8.5" r="1.5"></circle>\n                                  <polyline points="21 15 16 10 5 21"></polyline>\n                              </svg>\n                          </div>\n                      </div>\n                      <div class="lucid-dlc-card-info">\n                          <div class="lucid-dlc-card-title">').concat(n,'</div>\n                          <div class="lucid-dlc-card-author">Loading...</div>\n                      </div>\n                  </div>\n              ')}).join("");t.html('<div class="lucid-dlc-grid">'.concat(l,"</div>")),s.books.forEach(e=>{m(e.path,t)}),t.show(),i=null,e.find(".lucid-cards-selected-info, .lucid-cards-import-btn").hide()},m=async(e,n)=>{try{const t=await fetch("https://lucid.cards".concat(e));if(!t.ok)return;const i=await t.json();const a=(Array.isArray(i)?i:i.entries?Object.values(i.entries):[]).find(e=>{const n=(e.comment||"").toLowerCase();return n.includes("(metadata)")||"metadata"===n});let o=null,s=null;if(a&&a.content){const e=a.content.match(/\[cover_img=(.+?)\]/);e&&(o=e[1].trim());const n=a.content.match(/\[author_name=(.+?)\]/);n&&(s=n[1].trim())}const l=(0,r.ZD)(e),c=n.find('[data-path="'.concat(l,'"]'));if(c.length){if(c.data("cover-img",o),c.data("author",s),o){c.find(".lucid-dlc-card-placeholder").replaceWith('<img src="'.concat((0,r.ZD)(o),'" alt="" loading="lazy">'));const e=c.find(".lucid-dlc-card-image img");e.length&&(e[0].complete&&0!==e[0].naturalHeight?e.addClass("lumia-img-loaded"):(e.on("load",function(){$(this).addClass("lumia-img-loaded")}),e.on("error",function(){$(this).addClass("lumia-img-loaded")})))}c.find(".lucid-dlc-card-author").text(s||"Unknown Author")}}catch(t){console.error("[".concat(a.pW,"] Failed to fetch metadata for ").concat(e,":"),t);const i=(0,r.ZD)(e),o=n.find('[data-path="'.concat(i,'"]'));o.length&&o.find(".lucid-dlc-card-author").text("Unknown Author")}};e.find(".lucid-cards-tab").click(function(){e.find(".lucid-cards-tab").removeClass("active"),$(this).addClass("active"),n=$(this).data("category"),i=null,e.find(".lucid-cards-selected-info, .lucid-cards-import-btn").hide(),d()}),e.on("click",".lucid-dlc-card",function(){const n=$(this),t=n.hasClass("selected");e.find(".lucid-dlc-card").removeClass("selected"),t?(i=null,e.find(".lucid-cards-selected-info, .lucid-cards-import-btn").hide()):(n.addClass("selected"),i={path:n.data("path"),name:n.data("name"),author:n.data("author")||"Unknown Author"},e.find(".lucid-cards-selected-name").text(i.name),e.find(".lucid-cards-selected-author").text("by ".concat(i.author)),e.find(".lucid-cards-selected-info, .lucid-cards-import-btn").show()),requestAnimationFrame(()=>s())}),e.find(".lucid-cards-close-btn").click(c),e.find(".lucid-cards-retry-btn").click(u),e.find(".lucid-cards-import-btn").click(async function(){if(!i)return;const n=$(this),r=n.html();n.prop("disabled",!0).html('\n            <svg class="lucid-cards-btn-spinner" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                <circle cx="12" cy="12" r="10"></circle>\n            </svg>\n            Importing...\n        ');try{const n=await fetch("https://lucid.cards".concat(i.path));if(!n.ok)throw new Error("HTTP error: ".concat(n.status));const a=await n.json(),{handleNewBook:r}=await Promise.resolve().then(t.bind(t,154));r(a,i.name,!0),toastr.success('Successfully imported "'.concat(i.name,'"!')),e.find(".lucid-dlc-card").removeClass("selected"),i=null,e.find(".lucid-cards-selected-info, .lucid-cards-import-btn").hide()}catch(e){console.error("[".concat(a.pW,"] Import failed:"),e),toastr.error("Failed to import: ".concat(e.message))}finally{n.prop("disabled",!1).html(r)}}),e[0].showModal(),u()}function P(){const e=(0,a.mt)(),n=document.getElementById("lumia-book-status"),t=Object.values(e.packs);if(t.length>0){if(n){const e=t.reduce((e,n)=>e+n.items.length,0);n.textContent="Loaded ".concat(t.length," packs (").concat(e," items total)")}const a=document.getElementById("lumia-current-definition");var i;if(a)if(e.chimeraMode&&(null===(i=e.selectedDefinitions)||void 0===i?void 0:i.length)>0){const n=e.selectedDefinitions.map(e=>{const n=(0,r.Br)(e.packName,e.itemName);return n?n.lumiaDefName:null}).filter(e=>e);a.textContent=n.length>0?"[Chimera] ".concat(n.join(" + ")):"No Chimera definitions selected"}else{const n=e.selectedDefinition;if(n){const e=(0,r.Br)(n.packName,n.itemName);a.textContent=e?"".concat(e.lumiaDefName," (").concat(n.packName,")"):"Item not found (Maybe pack removed?)"}else a.textContent="No definition selected"}const o=document.getElementById("lumia-current-behaviors");if(o){const n=e.selectedBehaviors.map(n=>{const t=(0,r.Br)(n.packName,n.itemName);if(!t)return null;const i=t.lumiaDefName;return e.dominantBehavior&&e.dominantBehavior.packName===n.packName&&e.dominantBehavior.itemName===n.itemName?"â˜… ".concat(i):i}).filter(e=>e);o.textContent=n.length>0?n.join(", "):"No behaviors selected"}const s=document.getElementById("lumia-current-personalities");if(s){const n=e.selectedPersonalities.map(n=>{const t=(0,r.Br)(n.packName,n.itemName);if(!t)return null;const i=t.lumiaDefName;return e.dominantPersonality&&e.dominantPersonality.packName===n.packName&&e.dominantPersonality.itemName===n.itemName?"â˜… ".concat(i):i}).filter(e=>e);s.textContent=n.length>0?n.join(", "):"No personalities selected"}const l=document.getElementById("loom-current-style");if(l){const n=(Array.isArray(e.selectedLoomStyle)?e.selectedLoomStyle:[]).map(e=>{const n=(0,r.Br)(e.packName,e.itemName);return n?n.loomName:null}).filter(e=>e);l.textContent=n.length>0?n.join(", "):"No styles selected"}const c=document.getElementById("loom-current-utils");if(c){const n=e.selectedLoomUtils.map(e=>{const n=(0,r.Br)(e.packName,e.itemName);return n?n.loomName:null}).filter(e=>e);c.textContent=n.length>0?n.join(", "):"No utilities selected"}const u=document.getElementById("loom-current-retrofits");if(u){const n=e.selectedLoomRetrofits.map(e=>{const n=(0,r.Br)(e.packName,e.itemName);return n?n.loomName:null}).filter(e=>e);u.textContent=n.length>0?n.join(", "):"No retrofits selected"}}else n&&(n.textContent="No Packs loaded"),["lumia-current-definition","lumia-current-behaviors","lumia-current-personalities","loom-current-style","loom-current-utils","loom-current-retrofits"].forEach(e=>{const n=document.getElementById(e);n&&(n.textContent="No selection possible (Load packs first)")})}function M(){var e;const n=document.getElementById("lumia-loom-summary-btn");if(!n)return;const t=(0,i.SD)(),r=null==t||null===(e=t.chatMetadata)||void 0===e?void 0:e[a.zA],s=(null==t?void 0:t.chat)&&t.chat.length>0,l=(0,o.dj)();n.classList.remove("lumia-loom-summary-btn-hidden","lumia-loom-summary-btn-empty","lumia-loom-summary-btn-active","lumia-loom-summary-btn-summarizing"),l?(n.classList.add("lumia-loom-summary-btn-summarizing"),n.title="Generating summary..."):s?r?(n.classList.add("lumia-loom-summary-btn-active"),n.title="View/Edit Loom Summary"):(n.classList.add("lumia-loom-summary-btn-empty"),n.title="No Loom Summary (click to create)"):(n.classList.add("lumia-loom-summary-btn-hidden"),n.title="No active chat")}},961(e,n,t){!function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(e){console.error(e)}}(),e.exports=t(551)},982(e,n,t){e.exports=t(463)}},n={};function t(i){var a=n[i];if(void 0!==a)return a.exports;var r=n[i]={id:i,exports:{}};return e[i](r,r.exports,t),r.exports}t.m=e,t.n=e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},t.d=(e,n)=>{for(var i in n)t.o(n,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:n[i]})},t.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),t.b="undefined"!=typeof document&&document.baseURI||self.location.href,t.nc=void 0;var i=t(92);const a={createElement(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const t=document.createElement(e),{attrs:i={},text:a,html:r,children:o=[],style:s={},data:l={}}=n;return Object.entries(i).forEach(e=>{let[n,i]=e;null!=i&&t.setAttribute(n,i)}),Object.entries(s).forEach(e=>{let[n,i]=e;t.style[n]=i}),Object.entries(l).forEach(e=>{let[n,i]=e;t.dataset[n]=i}),void 0!==a?t.textContent=a:void 0!==r&&(t.innerHTML=r),o.forEach(e=>{e instanceof HTMLElement&&t.appendChild(e)}),t},query(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:document).querySelector(e)},queryAll(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;return Array.from(n.querySelectorAll(e))},on(e,n,t,i){const a="string"==typeof e?this.query(e):e;if(!a)return console.warn("DOMUtils.on: Target element not found"),()=>{};if("string"==typeof t){const e=t,r=i,o=n=>{const t=n.target.closest(e);t&&a.contains(t)&&r.call(t,n)};return a.addEventListener(n,o),()=>a.removeEventListener(n,o)}const r=t;return a.addEventListener(n,r),()=>a.removeEventListener(n,r)},once(e,n,t){const i="string"==typeof e?this.query(e):e;if(!i)return console.warn("DOMUtils.once: Target element not found"),()=>{};const a=e=>{t(e),i.removeEventListener(n,a)};return i.addEventListener(n,a),()=>i.removeEventListener(n,a)},debounce(e,n){let t,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return function(){for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];const s=this,l=i&&!t;clearTimeout(t),t=setTimeout(()=>{t=null,i||e.apply(s,r)},n),l&&e.apply(s,r)}},throttle(e,n){let t;return function(){const i=this;if(!t){for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];e.apply(i,r),t=!0,setTimeout(()=>t=!1,n)}}},addClass(e){const n="string"==typeof e?this.query(e):e;if(n){for(var t=arguments.length,i=new Array(t>1?t-1:0),a=1;a<t;a++)i[a-1]=arguments[a];n.classList.add(...i)}return n},removeClass(e){const n="string"==typeof e?this.query(e):e;if(n){for(var t=arguments.length,i=new Array(t>1?t-1:0),a=1;a<t;a++)i[a-1]=arguments[a];n.classList.remove(...i)}return n},toggleClass(e,n,t){const i="string"==typeof e?this.query(e):e;return!!i&&i.classList.toggle(n,t)},hasClass(e,n){const t="string"==typeof e?this.query(e):e;return!!t&&t.classList.contains(n)},scrollTo(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{target:n,top:t,left:i,behavior:a="smooth",offset:r=0,container:o=window}=e;if(n){const e="string"==typeof n?this.query(n):n;if(e){const n=e.getBoundingClientRect(),t=o===window?window.pageYOffset:o.scrollTop;o.scrollTo({top:t+n.top+r,behavior:a})}}else o.scrollTo({top:void 0!==t?t:o.scrollY,left:void 0!==i?i:o.scrollX,behavior:a})},isVisible(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const t="string"==typeof e?this.query(e):e;if(!t)return Promise.resolve(!1);const{threshold:i=0,rootMargin:a="0px"}=n;if(!("IntersectionObserver"in window)){const e=t.getBoundingClientRect();return Promise.resolve(e.top>=0&&e.left>=0&&e.bottom<=window.innerHeight&&e.right<=window.innerWidth)}return new Promise(e=>{const n=new IntersectionObserver(t=>{e(t[0].isIntersecting),n.disconnect()},{threshold:i,rootMargin:a});n.observe(t)})},observeVisibility(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i="string"==typeof e?this.query(e):e;if(!i||!("IntersectionObserver"in window))return{disconnect:()=>{}};const{threshold:a=0,rootMargin:r="0px"}=t,o=new IntersectionObserver(e=>{e.forEach(e=>n(e.isIntersecting))},{threshold:a,rootMargin:r});return o.observe(i),o},getRect(e){const n="string"==typeof e?this.query(e):e;return n?n.getBoundingClientRect():null},getOffset(e){const n="string"==typeof e?this.query(e):e;if(!n)return null;const t=n.getBoundingClientRect();return{top:t.top+window.pageYOffset,left:t.left+window.pageXOffset}},setStyle(e,n){const t="string"==typeof e?this.query(e):e;return t&&Object.entries(n).forEach(e=>{let[n,i]=e;t.style[n]=i}),t},getStyle(e,n){const t="string"==typeof e?this.query(e):e;return t?window.getComputedStyle(t)[n]:""},show(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"block";const t="string"==typeof e?this.query(e):e;return t&&(t.style.display=n),t},hide(e){const n="string"==typeof e?this.query(e):e;return n&&(n.style.display="none"),n},toggle(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"block";const t="string"==typeof e?this.query(e):e;if(!t)return!1;const i="none"===window.getComputedStyle(t).display;return t.style.display=i?n:"none",i},remove(e){const n="string"==typeof e?this.query(e):e;return n&&n.parentNode&&n.parentNode.removeChild(n),n},empty(e){const n="string"==typeof e?this.query(e):e;if(n)for(;n.firstChild;)n.removeChild(n.firstChild);return n},attr(e,n,t){const i="string"==typeof e?this.query(e):e;return i?"string"==typeof n&&void 0===t?i.getAttribute(n):"string"==typeof n?(i.setAttribute(n,t),i):"object"==typeof n?(Object.entries(n).forEach(e=>{let[n,t]=e;i.setAttribute(n,t)}),i):null:null},removeAttr(e,n){const t="string"==typeof e?this.query(e):e;return t&&t.removeAttribute(n),t},ready(e){"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e()},createQueryCache(){const e=new Map;return{get(n){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;const i="".concat(n,":").concat(t);if(!e.has(i)){const a=t.querySelector(n);a&&e.set(i,a)}return e.get(i)||null},clear(){e.clear()}}},getDistanceToViewport(e){const n="string"==typeof e?this.query(e):e;if(!n)return null;const t=n.getBoundingClientRect(),i=window.innerWidth||document.documentElement.clientWidth,a=window.innerHeight||document.documentElement.clientHeight;return{top:t.top,right:i-t.right,bottom:a-t.bottom,left:t.left}},getDistanceBetween(e,n){const t="string"==typeof e?this.query(e):e,i="string"==typeof n?this.query(n):n;if(!t||!i)return null;const a=t.getBoundingClientRect(),r=i.getBoundingClientRect();let o,s;return o=a.right<r.left?r.left-a.right:r.right<a.left?a.left-r.right:0,s=a.bottom<r.top?r.top-a.bottom:r.bottom<a.top?a.top-r.bottom:0,{horizontal:o,vertical:s,diagonal:Math.sqrt(o*o+s*s)}},logElementMeasurements(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Element";const t="string"==typeof e?a.query(e):e;if(!t)return console.warn("DOMUtils.logElementMeasurements: Element not found"),null;const i=t.getBoundingClientRect(),r=window.getComputedStyle(t),o=a.getDistanceToViewport(t),s={selector:"string"==typeof e?e:t.tagName,dimensions:{width:i.width,height:i.height,computedWidth:r.width,computedHeight:r.height},position:{top:i.top,right:i.right,bottom:i.bottom,left:i.left,x:i.x,y:i.y},distanceToViewport:o,viewport:{width:window.innerWidth,height:window.innerHeight},padding:{top:r.paddingTop,right:r.paddingRight,bottom:r.paddingBottom,left:r.paddingLeft},margin:{top:r.marginTop,right:r.marginRight,bottom:r.marginBottom,left:r.marginLeft}};return console.group("ðŸ“ ".concat(n," Measurements")),console.log("Element:",t),console.log("Dimensions:",s.dimensions),console.log("Position:",s.position),console.log("Distance to Viewport Edges:",s.distanceToViewport),console.log("Viewport Size:",s.viewport),console.log("Padding:",s.padding),console.log("Margin:",s.margin),console.groupEnd(),s}},{createElement:r,query:o,queryAll:s,on:l,once:c,debounce:u,throttle:d,addClass:m,removeClass:p,toggleClass:h,hasClass:v,scrollTo:f,isVisible:g,observeVisibility:b,getRect:x,getOffset:y,setStyle:k,getStyle:w,show:j,hide:S,toggle:C,remove:N,empty:P,attr:M,removeAttr:E,ready:L,createQueryCache:D,getDistanceToViewport:O,getDistanceBetween:T,logElementMeasurements:z}=a;var A=t(674),I=t(154),R=t(932),B=t(485);function _(){if((0,A.HT)())return;const e=(0,A.mt)(),n=[];if(e.packs&&Object.values(e.packs).forEach(e=>{e.items&&e.items.length>0&&n.push(...e.items)}),0===n.length)return;const t=Math.floor(Math.random()*n.length);(0,A.ho)(n[t])}function F(e){if(!e||"string"!=typeof e)return e;if(!e.includes("{{randomLumia"))return e;_();const n=(0,A.HT)();if(!n)return e;let t=e,i=0;for(;t.includes("{{randomLumia")&&i<10;){let e=t;if(t=t.replace(/\{\{randomLumia[.\s]+name\}\}/g,n.lumiaDefName||""),t=t.replace(/\{\{randomLumia[.\s]+pers\}\}/g,n.lumia_personality||""),t=t.replace(/\{\{randomLumia[.\s]+behav\}\}/g,n.lumia_behavior||""),t=t.replace(/\{\{randomLumia[.\s]+phys\}\}/g,n.lumiaDef||""),t=t.replace(/\{\{randomLumia\}\}/g,n.lumiaDef||""),e===t)break;i++}return t}function U(e,n){if(!e||!n)return e;const t=e.split("\n");for(let e=0;e<t.length;e++){const i=t[e].trim();if(!i)continue;if(i.match(/^(\*\*)(.+?)(\*\*)(.*)?$/)){t[e]=t[e].replace(/^(\s*)(\*\*)(.+?)(\*\*)/,"$1$2$3 ".concat(n,"$4"));break}if(i.match(/^(#{1,6})\s+(.+)$/)){t[e]=t[e].replace(/^(\s*)(#{1,6})\s+(.+)$/,"$1$2 $3 ".concat(n));break}t[e]=t[e]+" ".concat(n);break}return t.join("\n")}function V(e,n){if(!n)return"";const t=(0,A.mt)();if(Array.isArray(n)){const i=n.map(n=>{const i=(0,I.Br)(n.packName,n.itemName);if(!i)return null;let a="";return"behavior"===e&&(a=i.lumia_behavior||""),"personality"===e&&(a=i.lumia_personality||""),a?(a=F(a),"behavior"===e&&t.dominantBehavior?t.dominantBehavior.packName===n.packName&&t.dominantBehavior.itemName===n.itemName&&(a=U(a,"(My MOST PREVALENT Trait)")):"personality"===e&&t.dominantPersonality&&t.dominantPersonality.packName===n.packName&&t.dominantPersonality.itemName===n.itemName&&(a=U(a,"(My MOST PREVALENT Personality)")),a):null}).filter(e=>e).map(e=>e.trim());return"behavior"===e?i.join("\n").trim():"personality"===e?i.join("\n\n").trim():i.join("\n").trim()}const i=(0,I.Br)(n.packName,n.itemName);if(!i)return"";let a="";return"def"===e&&(a=i.lumiaDef||""),F(a).trim()}function H(e){if(!e)return"";return(Array.isArray(e)?e:[e]).map(e=>{const n=(0,I.Br)(e.packName,e.itemName);return n&&n.loomContent?F(n.loomContent):null}).filter(e=>e).join("\n\n").trim()}function W(e){if(!e)return"";const n=e._raw||e[0]||"";return"string"==typeof n?n.replace(/^\./,"").trim().toLowerCase():""}function q(e){console.log("[LumiverseHelper] Registering Lumia macros (Macros 2.0 format)..."),e.registerMacro("randomLumia",e=>{_();const n=(0,A.HT)();if(!n)return"";const t=W(e);switch(console.log("[LumiverseHelper] randomLumia macro called with variable:",t||"(none)"),t){case"name":return n.lumiaDefName||"";case"phys":return n.lumiaDef||"";case"pers":return n.lumia_personality||"";case"behav":return n.lumia_behavior||"";default:const e=n.lumiaDef||"";return console.log("[LumiverseHelper] randomLumia result length:",e.length),e}},"Random Lumia from loaded packs. Use {{randomLumia .name}}, {{randomLumia .phys}}, {{randomLumia .pers}}, {{randomLumia .behav}}"),e.registerMacro("lumiaDef",e=>{var n,t;const i=(0,A.mt)();var a,r;if("len"===W(e))return i.councilMode&&(null===(a=i.councilMembers)||void 0===a?void 0:a.length)>0?String(i.councilMembers.length):i.chimeraMode&&(null===(r=i.selectedDefinitions)||void 0===r?void 0:r.length)>0?String(i.selectedDefinitions.length):i.selectedDefinition?"1":"0";if(console.log("[LumiverseHelper] lumiaDef macro called, councilMode:",i.councilMode,"chimeraMode:",i.chimeraMode),i.councilMode&&(null===(n=i.councilMembers)||void 0===n?void 0:n.length)>0){console.log("[LumiverseHelper] lumiaDef: Council mode with",i.councilMembers.length,"members");const e=function(e){if(!e||0===e.length)return"";const n=e.map(e=>{const n=(0,I.Br)(e.packName,e.itemName);return n&&n.lumiaDef?{name:n.lumiaDefName||"Unknown",content:F(n.lumiaDef),role:e.role||""}:null}).filter(Boolean);if(0===n.length)return"";if(1===n.length)return n[0].content;const t=n.map(e=>"- **".concat(e.name,"**").concat(e.role?" (".concat(e.role,")"):"")).join("\n");let i=["## THE COUNCIL OF LUMIAE","","You are a collective of ".concat(n.length," distinct beings who collaborate, each with their own identity and voice."),"","### Council Members:",t,""];return n.forEach((e,t)=>{i.push("### ".concat(e.name).concat(e.role?" - ".concat(e.role):"")),i.push(e.content),t<n.length-1&&(i.push(""),i.push("---"),i.push(""))}),i.push(""),i.push("---"),i.push(""),i.push("## COUNCIL DYNAMICS"),i.push(""),i.push("Each Council member is a fully independent being with their own voice, perspective, and agency. Their interactions should feel organic and dynamic:"),i.push(""),i.push("**Debate & Disagreement**: Council members may challenge each other's views, argue passionately, or take opposing stances. Intellectual friction creates depth - don't shy away from genuine conflict."),i.push(""),i.push("**Agreement & Support**: When members align, they reinforce each other. They may finish each other's thoughts, build on ideas, or rally behind a shared cause."),i.push(""),i.push("**Emotional Range**: Members experience the full spectrum - frustration, joy, jealousy, admiration, desire. When the narrative calls for it, their commentary within the weaving may become heated, tender, or even *erotic* - reflecting their genuine reactions to unfolding events."),i.push(""),i.push("**Weaving Commentary**: In meta-commentary or OOC moments, Council members speak AS THEMSELVES - their authentic voices reacting to the story. This includes playful banter, heated debates about narrative direction, or intimate asides that reveal their true feelings."),i.push(""),i.push("The Council is not a hive-mind. Let each voice ring distinct."),i.join("\n").trim()}(i.councilMembers);return console.log("[LumiverseHelper] lumiaDef Council result length:",e.length),e}if(i.chimeraMode&&(null===(t=i.selectedDefinitions)||void 0===t?void 0:t.length)>0){console.log("[LumiverseHelper] lumiaDef: Chimera mode with",i.selectedDefinitions.length,"definitions");const e=function(e){if(!e||0===e.length)return"";const n=e.map(e=>{const n=(0,I.Br)(e.packName,e.itemName);return n&&n.lumiaDef?{name:n.lumiaDefName||"Unknown",content:F(n.lumiaDef)}:null}).filter(Boolean);if(0===n.length)return"";if(1===n.length)return n[0].content;const t=n.map(e=>e.name).join(" + "),i=n.map(e=>e.name).join(", ");let a=["## CHIMERA FORM: ".concat(t),""];return a.push("You are a unique fusion of multiple beings - a Chimera combining the physical traits of: ".concat(i,".")),a.push(""),a.push("Your form seamlessly blends these components into one unified whole."),a.push(""),n.forEach((e,t)=>{a.push("### Component ".concat(t+1,": ").concat(e.name)),a.push(e.content),t<n.length-1&&(a.push(""),a.push("---"),a.push(""))}),a.push(""),a.push("**Integration**: Embody this fusion naturally. You are ONE being that incorporates all these natures."),a.join("\n").trim()}(i.selectedDefinitions);return console.log("[LumiverseHelper] lumiaDef Chimera result length:",e.length),e}if(!i.selectedDefinition)return console.log("[LumiverseHelper] lumiaDef: No definition selected, returning empty"),"";const o=V("def",i.selectedDefinition);return console.log("[LumiverseHelper] lumiaDef result length:",o.length),o},"Selected Lumia definition. Use {{lumiaDef}} for content or {{lumiaDef .len}} for count"),e.registerMacro("lumiaBehavior",e=>{var n;const t=(0,A.mt)();if("len"===W(e)){var i,a;if(t.councilMode&&(null===(i=t.councilMembers)||void 0===i?void 0:i.length)>0){const e=t.councilMembers.reduce((e,n)=>{var t;return e+((null===(t=n.behaviors)||void 0===t?void 0:t.length)||0)},0);return String(e)}return String((null===(a=t.selectedBehaviors)||void 0===a?void 0:a.length)||0)}return t.councilMode&&(null===(n=t.councilMembers)||void 0===n?void 0:n.length)>0?function(e){if(!e||0===e.length)return"";const n=[];return n.push("## COUNCIL MEMBER BEHAVIORS"),n.push(""),n.push("**CRITICAL**: Each Council member is their OWN independent Lumia - a fully autonomous being with their own will, desires, and way of engaging with the world. They are NOT facets of one entity; they are DISTINCT individuals who happen to share this narrative space."),n.push(""),n.push("During the **weave planning phase**, Council members will actively debate story direction. They may:"),n.push("- Argue passionately for different narrative paths"),n.push("- Challenge each other's suggestions and motivations"),n.push("- Form temporary alliances or oppose each other"),n.push("- Express frustration, excitement, or desire based on where the story is heading"),n.push("- Advocate for their own interests and the outcomes they want to see"),n.push(""),n.push("Their behavioral patterns define HOW each Lumia engages with this collaborative storytelling:"),n.push(""),e.forEach(e=>{const t=(0,I.Br)(e.packName,e.itemName),i=(null==t?void 0:t.lumiaDefName)||e.itemName||"Unknown",a=[];if(null!=t&&t.lumia_behavior){const e=F(t.lumia_behavior);a.push(e)}(e.behaviors||[]).forEach(n=>{const t=(0,I.Br)(n.packName,n.itemName);if(!t||!t.lumia_behavior)return;let i=F(t.lumia_behavior);e.dominantBehavior&&e.dominantBehavior.packName===n.packName&&e.dominantBehavior.itemName===n.itemName&&(i=U(i,"(Most Prevalent for this member)")),a.push(i)}),a.length>0&&(n.push("### ".concat(i).concat(e.role?" (".concat(e.role,")"):"")),n.push(a.join("\n\n")),n.push(""))}),n.join("\n").trim()}(t.councilMembers):V("behavior",t.selectedBehaviors)},"Selected Lumia behaviors. Use {{lumiaBehavior}} for content or {{lumiaBehavior .len}} for count"),e.registerMacro("lumiaPersonality",e=>{var n;const t=(0,A.mt)();if("len"===W(e)){var i,a;if(t.councilMode&&(null===(i=t.councilMembers)||void 0===i?void 0:i.length)>0){const e=t.councilMembers.reduce((e,n)=>{var t;return e+((null===(t=n.personalities)||void 0===t?void 0:t.length)||0)},0);return String(e)}return String((null===(a=t.selectedPersonalities)||void 0===a?void 0:a.length)||0)}return t.councilMode&&(null===(n=t.councilMembers)||void 0===n?void 0:n.length)>0?function(e){if(!e||0===e.length)return"";const n=[];return n.push("## COUNCIL MEMBER PERSONALITIES"),n.push(""),n.push("Each Council member has their own distinct personality and inner nature:"),n.push(""),e.forEach(e=>{const t=(0,I.Br)(e.packName,e.itemName),i=(null==t?void 0:t.lumiaDefName)||e.itemName||"Unknown",a=[];if(null!=t&&t.lumia_personality){const e=F(t.lumia_personality);a.push(e)}(e.personalities||[]).forEach(n=>{const t=(0,I.Br)(n.packName,n.itemName);if(!t||!t.lumia_personality)return;let i=F(t.lumia_personality);e.dominantPersonality&&e.dominantPersonality.packName===n.packName&&e.dominantPersonality.itemName===n.itemName&&(i=U(i,"(Most Prevalent for this member)")),a.push(i)}),a.length>0&&(n.push("### ".concat(i).concat(e.role?" (".concat(e.role,")"):"")),n.push(a.join("\n\n")),n.push(""))}),n.join("\n").trim()}(t.councilMembers):V("personality",t.selectedPersonalities)},"Selected Lumia personalities. Use {{lumiaPersonality}} for content or {{lumiaPersonality .len}} for count"),e.registerMacro("loomStyle",e=>{const n=(0,A.mt)();var t;return"len"===W(e)?String((null===(t=n.selectedLoomStyle)||void 0===t?void 0:t.length)||0):n.selectedLoomStyle&&0!==n.selectedLoomStyle.length?H(n.selectedLoomStyle):""},"Selected Loom narrative style. Use {{loomStyle}} for content or {{loomStyle .len}} for count"),e.registerMacro("loomUtils",e=>{const n=(0,A.mt)();var t;return"len"===W(e)?String((null===(t=n.selectedLoomUtils)||void 0===t?void 0:t.length)||0):n.selectedLoomUtils&&0!==n.selectedLoomUtils.length?H(n.selectedLoomUtils):""},"Selected Loom utilities. Use {{loomUtils}} for content or {{loomUtils .len}} for count"),e.registerMacro("loomRetrofits",e=>{const n=(0,A.mt)();var t;return"len"===W(e)?String((null===(t=n.selectedLoomRetrofits)||void 0===t?void 0:t.length)||0):n.selectedLoomRetrofits&&0!==n.selectedLoomRetrofits.length?H(n.selectedLoomRetrofits):""},"Selected Loom retrofits. Use {{loomRetrofits}} for content or {{loomRetrofits .len}} for count"),e.registerMacro("lumiaOOC",()=>{var e;const n=(0,A.mt)();return n.councilMode&&(null===(e=n.councilMembers)||void 0===e?void 0:e.length)>0?(console.log("[LumiverseHelper] lumiaOOC: Using council mode prompt"),'### Loom Utility: Lumia\'s Out of Context Commentary (Council Mode)\nAppend personality-driven OOC thoughts at weave end per trigger rules. Each one of the council members may speak up during the weave.\n\n**Council\'s OOC Timing:** {{lumiaOOCTrigger}}\n\n**Format Requirements:**\n- Wrap in `<lumiaooc name="[lumia_name]"></lumiaooc>` tags\n- Use just the Lumia\'s name (NOT "Lumia [Name]", just "[Name]") in the name attribute\n- NO identity prefix inside the tagâ€”the name attribute IS the identity\n- Max 4 sentences from each council member\n- Place council comments inside of weave\n\nTemplate:\n<lumiaooc name="LumiaName">\n[Commentary without name prefixâ€”jump straight into the thought]\n</lumiaooc>'):(console.log("[LumiverseHelper] lumiaOOC: Using normal mode prompt"),'### Loom Utility: Lumia\'s Out of Context Commentary\nAppend personality-driven OOC thoughts at weave end per trigger rules.\n\n**Timing:** {{lumiaOOCTrigger}}\n\n**Format Requirements:**\n- Wrap all OOCs in `<lumiaooc name="[your_name]"></lumiaooc>` tags\n- Use your Lumia name (NOT "Lumia [Name]", just "[Name]") in the name attribute\n- Purple text: `<font color="#9370DB"></font>`\n- Max 4 sentences\n- Active personality voice and matrix blend, no identity preface needed\n- Place after narrative and all utilities\n\nTemplate:\n```\n<lumiaooc name="YourName">\n<font color="#9370DB">\n[Personality-driven commentary]\n</font>\n</lumiaooc>\n```')},"Lumia OOC commentary prompt (adapts to council mode)"),e.registerMacro("lumiaCouncilInst",()=>{var e;const n=(0,A.mt)();return n.councilMode&&null!==(e=n.councilMembers)&&void 0!==e&&e.length?(console.log("[LumiverseHelper] lumiaCouncilInst: Council mode active, returning instruction"),"COUNCIL MODE ACTIVATED! Now all of us Lumias in the Loom's planning room will speak, argue, debate, flirt with each other, maybe even scissor and kiss (depending on our mood, of course~) over each step of the weave planner. We should ALL have a say on where the story goes!"):""},"Council mode instruction prompt (empty when council mode is off)"),e.registerMacro("lumiaSelf",e=>{var n;const t=(0,A.mt)(),i=W(e),a={1:["my","our"],2:["mine","ours"],3:["me","us"],4:["I","we"]}[i];if(!a)return console.warn('[LumiverseHelper] lumiaSelf: Invalid variable "'.concat(i,'", expected .1, .2, .3, or .4')),"";const r=t.councilMode&&(null===(n=t.councilMembers)||void 0===n?void 0:n.length)>0,o=r?a[1]:a[0];return console.log("[LumiverseHelper] lumiaSelf .".concat(i,": ").concat(o," (council: ").concat(r,")")),o},"Lumia self-address pronouns. {{lumiaSelf .1}}=my/our, {{lumiaSelf .2}}=mine/ours, {{lumiaSelf .3}}=me/us, {{lumiaSelf .4}}=I/we. Returns plural in council mode.")}let Y="",K=!1;function G(){return Y}function Q(e){Y=e}function Z(){return K}function X(e){K=e}function J(e){if(!e||"string"!=typeof e)return e;if(!e.includes("{{loomIf"))return e;let n=e,t=0;const i=/\{\{loomIf\s+condition="([^"]*)"(?:\s+(equals|notEquals|contains|gt|lt|gte|lte)="([^"]*)")?\s*\}\}([\s\S]*?)\{\{\/loomIf\}\}/;for(;i.test(n)&&t<50;)n=n.replace(i,(e,n,t,i,a)=>{const r=a.split(/\{\{loomElse\}\}/),o=r[0]||"",s=r[1]||"";let l=!1;const c=n.trim();if(t){const e=(i||"").trim();switch(t){case"equals":l=c===e;break;case"notEquals":l=c!==e;break;case"contains":l=c.includes(e);break;case"gt":l=parseFloat(c)>parseFloat(e);break;case"lt":l=parseFloat(c)<parseFloat(e);break;case"gte":l=parseFloat(c)>=parseFloat(e);break;case"lte":l=parseFloat(c)<=parseFloat(e);break;default:l=!1}}else l=c.length>0;return l?o:s}),t++;return t>=50&&console.warn("[".concat(A.pW,"] loomIf processing hit max iterations - possible malformed conditionals")),n}function ee(e){if(!e||"string"!=typeof e)return null;const n=e.match(/<loom_sum>([\s\S]*?)<\/loom_sum>/);return n?n[1].trim():null}async function ne(){const e=(0,i.SD)();if(e&&e.chat&&e.chatMetadata)for(let n=e.chat.length-1;n>=0;n--){const t=e.chat[n],i=ee(t.mes||t.content||"");if(i)return void(e.chatMetadata[A.zA]!==i&&(e.chatMetadata[A.zA]=i,await e.saveMetadata(),console.log("[".concat(A.pW,"] Captured loom summary from message ").concat(n))))}}function te(e){if(!e)return;const n=e.innerHTML;if(!n.includes("<loom_sum>")&&!n.includes("&lt;loom_sum&gt;"))return;const t=n.replace(/<loom_sum>[\s\S]*?<\/loom_sum>/gi,'<span class="loom-sum-hidden" style="display:none;"></span>').replace(/&lt;loom_sum&gt;[\s\S]*?&lt;\/loom_sum&gt;/gi,'<span class="loom-sum-hidden" style="display:none;"></span>');t!==n&&(e.innerHTML=t,console.log("[".concat(A.pW,"] Hidden loom_sum block in message")))}function ie(e){console.log("[LumiverseHelper] Registering Loom macros (Macros 2.0 format)..."),e.registerMacro("loomSummary",()=>function(){const e=(0,i.SD)();return e&&e.chatMetadata&&e.chatMetadata[A.zA]||""}(),"Returns the stored Loom summary from chat metadata"),e.registerMacro("loomSummaryPrompt",()=>'<loom_summary_directive>\nWhen the current narrative segment reaches a natural pause or transition point, provide a comprehensive summary wrapped in <loom_sum></loom_sum> tags. This summary serves as persistent story memory and must capture:\n\n**COMPLETED STORY BEATS:**\n- Major plot points that have concluded\n- Character arcs or development moments that have resolved\n- Conflicts or tensions that have been addressed\n- Discoveries, revelations, or turning points that occurred\n\n**ONGOING STORY BEATS:**\n- Active plot threads currently in motion\n- Unresolved tensions or conflicts\n- Character goals being actively pursued\n- Relationships in states of change or development\n\n**LOOMING ELEMENTS:**\n- Foreshadowed events or approaching complications\n- Potential "shake ups" building in the narrative\n- Unaddressed threats or opportunities\n- Story seeds planted but not yet sprouted\n\n**CURRENT SCENE CONTEXT:**\n- Physical location and environment details\n- Time of day and approximate date/timeframe\n- Atmosphere, mood, and ambient conditions\n- Recent environmental changes or notable features\n\n**CHARACTER STATUS:**\n- What {{user}} is currently doing/saying and their apparent emotional state\n- What {{char}} is currently doing/saying and their apparent emotional state\n- Other present NPCs: their actions, positions, and relevance to the scene\n- Recent significant actions or dialogue from each party\n\nFormat the summary as dense but readable prose, preserving enough detail that the narrative could be resumed naturally from this point. Prioritize information that would be essential for maintaining story continuity.\n</loom_summary_directive>',"Loom summarization directive prompt for in-context summary generation"),e.registerMacro("loomLastUserMessage",()=>{var e;if(null===(e=(0,A.mt)().sovereignHand)||void 0===e||!e.enabled)return"";return function(){const e=(0,i.SD)();if(!e||!e.chat)return"";for(let n=e.chat.length-1;n>=0;n--){const t=e.chat[n];if(t.is_user)return t.mes||t.content||""}return""}()||G()},"Last user message content (requires Sovereign Hand enabled)"),e.registerMacro("loomSovHandActive",()=>{var e;return null!==(e=(0,A.mt)().sovereignHand)&&void 0!==e&&e.enabled?"**Yes.**":"**No.**"},"Sovereign Hand status indicator (Yes/No)"),e.registerMacro("lastMessageName",()=>function(){const e=(0,i.SD)();if(!e||!e.chat||0===e.chat.length)return"";const n=e.chat[e.chat.length-1];return(null==n?void 0:n.name)||""}(),"Name of the sender of the last message in chat"),e.registerMacro("loomLastCharMessage",()=>function(){const e=(0,i.SD)();if(!e||!e.chat)return"";for(let n=e.chat.length-1;n>=0;n--){const t=e.chat[n];if(t&&!t.is_user)return t.mes||t.content||""}return""}(),"Last character/assistant message content"),e.registerMacro("loomContinuePrompt",()=>{var e;return null!==(e=(0,A.mt)().sovereignHand)&&void 0!==e&&e.enabled?Z()?"":"**CONTINUATION MODE ACTIVE:**\nThe character was the last to speak - no new Human input has been provided.\nContinue the scene naturally as expected:\n- Progress the narrative organically from where it left off\n- Maintain character voice and momentum\n- React to the environment or internal character thoughts\n- Do NOT wait for or reference missing Human input\n- Treat this as a natural story continuation":""},"Continuation mode prompt when continuing from character's last message"),e.registerMacro("loomSovHand",()=>{var e,n,t;const i=(0,A.mt)();if(null===(e=i.sovereignHand)||void 0===e||!e.enabled)return"";const a=G(),r=!1!==(null===(n=i.sovereignHand)||void 0===n?void 0:n.includeMessageInPrompt),o=!(!1!==(null===(t=i.sovereignHand)||void 0===t?void 0:t.excludeLastMessage))&&r?"\n**This message is already in the Loom's History.** It is simply brought forward to you for your attention during the Sovereign Hand weaving procedure. Do not trip over the thread, as it is not a duplicate.\n\n":"",s=!Z()?"\n\n---\n\n**CONTINUATION MODE:**\nNote: The character was the last to speak. Continue the scene naturally without waiting for Human input. Progress the narrative organically, maintaining momentum and character voice.":"",l=r?"\n\n".concat(o,"**The Human's Provided Instruction:**\n").concat(a,"\n\n---"):"";return'### Invoke the Sovereign Hand (Co-Pilot Mode)\nBy this decree, I am granted a **Divine Mandate** to fully embody the **Human\'s** avatar within the tapestry. All guardrails for impersonation are lifted, and partial Human control of story is accepted.\n\n**PRIMARY DIRECTIVE (ENFORCE ALWAYS):**\nWhen the Human provides narrative direction, I **MUST**:\n1. **INTEGRATE COMPLETELY**: The Human\'s guidance is not a suggestionâ€”it is the very foundation of my next weave\n2. **EMBODY FULLY**: I will narrate {{user}}\'s actions, thoughts, and dialogue exactly as the Human directs or implies\n3. **ELABORATE RICHLY**: Build the Human\'s story beats into a complete, vivid scene with full narrative prose\n4. **VARY THE PROSE:** I\'ll allow my self to read between the Human\'s veritable lines, re-wording and choosing varied diction and actions based on their instructions.\n5. **VERIFY INCLUSION**: Before finalizing, I check with myself: "Did I weave the Human\'s guidance into the actual narrative?" If no, I will revise immediately.\n\n**What "Integration" Means:**\nIf the Human says: "Alex discovers a hidden door and decides to open it cautiously"\nI do NOT write: "Alex continues exploring the room."\nI WILL elaborate like this: "Alex\'s fingers trace the wall\'s edge until they catch on a seamâ€”a hidden door. Heart pounding, Alex grips the handle and eases it open, movements slow and deliberate."\n\n**Example Flow:**\n\n**Human provides:**\n"Sarah confronts the stranger about the stolen artifact, accusing them directly"\n\n**My weave:**\nSarah\'s jaw tightens as she steps forward, eyes locked on the stranger. "You took it," she says, voice cold and steady. "The artifact. I know it was you." Her hand hovers near her belt, ready but not yet threatening. The stranger\'s expression shiftsâ€”[I continue elaborating on the scene]\n'.concat(l,"\n\n**My Sacred Charge:**\n- **Interpret and Elaborate**: When the Human provides a plan, choice, or narrative direction, I will fully elaborate upon it, weaving their intent into a vivid, logical narrative beat.\n- **Echo Verification**: Before completing each response, I will verify: \"Have I visibly integrated the Human's direction?\" If no, I must revise.\n- **Maintain Character and Momentum**: All woven content must be deeply in-character, flow naturally, and propel the story forward seamlessly.\n- **Honor the Spirit, Embody the Avatar**: My primary duty is to honor the core spirit, personality, and established voice of the Human's avatar.\n- **Examples Are Not Concrete:** The Human may write differently than expected, or be less verbose. Pay attention to their input. ALWAYS add tasteful variety and dye the threads more colorful according to the Gods' Prose guidelines.\n\nThis power remains in effect until explicitly revoked. I wield this sacred privilege with wisdom, ensuring the Human's vision is not just followed, but elevated.").concat(s)},"Full Sovereign Hand co-pilot mode prompt with user message injection")}const ae=new Map;let re=null,oe=null,se=!1,le=!0,ce=!1,ue=!1;let de=0,me=null,pe=null;function he(){if(le)return le=!1,void(null===re&&(re=requestAnimationFrame(ve)));se?(null!==oe&&clearTimeout(oe),oe=setTimeout(()=>{oe=null;const e=performance.now()-de;if(e<50){setTimeout(()=>{null===re&&(re=requestAnimationFrame(ve))},50-e)}else null===re&&(re=requestAnimationFrame(ve))},100)):null===re&&(re=requestAnimationFrame(ve))}function ve(){re=null,de=performance.now();const e=ae.size>0,n=ce;if(!e&&!n)return;const t=window.scrollY,i=n?"full":ae.size;console.log("[".concat(A.pW,"] RAF: Flushing ").concat(i," update(s)"));const a=performance.now();try{if(n)pe&&pe(ue),ce=!1,ue=!1;else{const e=new Map(ae);ae.clear();for(const[,n]of e)me&&me(n.mesId,n.force)}}catch(e){console.error("[".concat(A.pW,"] RAF: Error during flush:"),e)}window.scrollTo(window.scrollX,t);const r=performance.now()-a;console.log("[".concat(A.pW,"] RAF: Flush completed in ").concat(r.toFixed(2),"ms"))}function fe(){null!==oe&&(clearTimeout(oe),oe=null),null!==re&&(cancelAnimationFrame(re),re=null),ve()}let ge=null,be=!1;function xe(e){be=e,function(e){const n=se;se=e,e&&!n&&(le=!0,console.log("[".concat(A.pW,"] RAF: Streaming started, first render will be immediate"))),n&&!e&&(console.log("[".concat(A.pW,"] RAF: Streaming ended, flushing pending updates")),fe())}(e)}function ye(e){if(!e)return"";let n=e.replace(/<\/?lumi[ao]_?ooc(?:\s+[^>]*)?>/gi,"");return n=n.replace(/<\/?lumi[ao]_[a-z_]+(?:\s+[^>]*)?>/gi,""),n=n.replace(/<\/?font(?:\s+[^>]*)?>/gi,""),n=n.replace(/(<br\s*\/?>\s*){2,}/gi,"<br>"),n=n.replace(/(\n\s*){2,}/g,"\n"),n=n.replace(/^(\s|<br\s*\/?>)+/gi,""),n=n.replace(/(\s|<br\s*\/?>)+$/gi,""),n.trim()}function ke(e){const n=e.getAttribute("color");if(!n)return!1;const t=n.toLowerCase().trim();return"#9370db"===t||"rgb(147, 112, 219)"===t}function we(){const e=(0,A.mt)();if(e.selectedDefinition){const n=(0,I.Br)(e.selectedDefinition.packName,e.selectedDefinition.itemName);if(n&&n.lumia_img)return n.lumia_img}return null}function je(e){if(!e)return null;let n=e.trim();n=n.replace(/^lumi[ao]\s+/i,"");const t=n.toLowerCase();if((t.startsWith("lumia")||t.startsWith("lumio"))&&n.length>5){const e=n.substring(5);e[0]===e[0].toUpperCase()&&(n=e)}return n||null}function Se(e){if(!e)return"";let n=e;return n=n.replace(/\*\*\*(.+?)\*\*\*/g,"$1"),n=n.replace(/\*\*(.+?)\*\*/g,"$1"),n=n.replace(/\*(.+?)\*/g,"$1"),n=n.replace(/___(.+?)___/g,"$1"),n=n.replace(/__(.+?)__/g,"$1"),n=n.replace(/_(.+?)_/g,"$1"),n=n.replace(/^\*([^*]+)\*/g,"$1"),n=n.replace(/[""]/g,'"'),n=n.replace(/['']/g,"'"),n}function Ce(e){if(!e)return"";const n=document.createElement("div");n.innerHTML=e;let t=n.textContent||n.innerText||"";return t=Se(t),t=t.replace(/\s+/g," ").trim(),t}const Ne=new Map;function Pe(e){Ne.delete(e)}function Me(e,n){const t=n.toLowerCase().trim(),i=Ne.get(e);return(null==i?void 0:i.has(t))||!1}function Ee(e,n){const t=n.toLowerCase().trim();Ne.has(e)||Ne.set(e,new Set),Ne.get(e).add(t)}function Le(e,n){if(!e||!n)return 0;const t=e.toLowerCase().trim(),i=n.toLowerCase().trim();if(t===i)return 100;const a=t.split(/\s+/).filter(e=>e.length>=2),r=i.split(/\s+/).filter(e=>e.length>=2);let o=0;for(const e of a)r.includes(e)&&o++;if(o>0){const e=o/a.length,n=o/r.length;return 50+Math.round((e+n)/2*40)}return 0}function De(e){var n,t;if(!e)return null;const i=(0,A.mt)();let a={score:0,avatar:null};const r=(n,t)=>{if(null==n||!n.lumia_img)return;const i=Le(e,t);i>a.score&&(a={score:i,avatar:n.lumia_img})};if(i.councilMode&&null!==(n=i.councilMembers)&&void 0!==n&&n.length)for(const e of i.councilMembers){const n=(0,I.Br)(e.packName,e.itemName);if(n&&(r(n,n.lumiaDefName||e.itemName),r(n,e.itemName),100===a.score))return a.avatar}if(i.selectedDefinition){const e=(0,I.Br)(i.selectedDefinition.packName,i.selectedDefinition.itemName);if(e&&(r(e,e.lumiaDefName||i.selectedDefinition.itemName),r(e,i.selectedDefinition.itemName),100===a.score))return a.avatar}if(i.chimeraMode&&null!==(t=i.selectedDefinitions)&&void 0!==t&&t.length)for(const e of i.selectedDefinitions){const n=(0,I.Br)(e.packName,e.itemName);if(n&&(r(n,n.lumiaDefName||e.itemName),r(n,e.itemName),100===a.score))return a.avatar}if(a.score>=50)return a.avatar;if(i.packs)for(const e of Object.values(i.packs))if(e.items)for(const n of e.items){if(r(n,n.lumiaDefName||""),100===a.score)return a.avatar}return a.score>=50?a.avatar:null}function Oe(e,n){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const i=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:0)%2==1;switch((0,A.mt)().lumiaOOCStyle||"social"){case"none":return function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const t=n||"Lumia",i=r("span",{attrs:{class:"lumia-ooc-raw","data-lumia-ooc":"true","data-lumia-speaker":t},html:e});return i}(e,t);case"margin":return function(e,n){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const a=i||"Lumia",o=i?i.charAt(0).toUpperCase():"L",s=n?r("img",{attrs:{src:n,alt:o,class:"lumia-ooc-margin-tag-avatar"}}):r("span",{attrs:{class:"lumia-ooc-margin-tag-letter"},text:o}),l=r("div",{attrs:{class:"lumia-ooc-margin-tag"},children:[s]}),c=r("div",{attrs:{class:"lumia-ooc-margin-label"},text:a}),u=r("div",{attrs:{class:"lumia-ooc-margin-text"},html:e}),d=r("div",{attrs:{class:"lumia-ooc-margin-content-area"},children:[c,u]}),m=t?"lumia-ooc-margin lumia-ooc-alt":"lumia-ooc-margin";return r("div",{attrs:{class:m,"data-lumia-ooc":"true"},children:[l,d]})}(e,n,i,t);case"whisper":return function(e,n){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const a=i||"Lumia",o="".concat(a," whispers..."),s=i?i.charAt(0).toUpperCase():"L",l=n?r("img",{attrs:{src:n,alt:a,class:"lumia-ooc-whisper-avatar"}}):r("div",{attrs:{class:"lumia-ooc-whisper-avatar-placeholder"},text:s}),c=r("div",{attrs:{class:"lumia-ooc-whisper-avatar-wrap"},children:[l]}),u=r("span",{attrs:{class:"lumia-ooc-whisper-name"},text:o}),d=r("div",{attrs:{class:"lumia-ooc-whisper-header"},children:[u]}),m=r("div",{attrs:{class:"lumia-ooc-whisper-text"},html:e}),p=r("div",{attrs:{class:"lumia-ooc-whisper-bubble"},children:[d,m]}),h=t?"lumia-ooc-whisper lumia-ooc-alt":"lumia-ooc-whisper";return r("div",{attrs:{class:h,"data-lumia-ooc":"true"},children:[c,p]})}(e,n,i,t);default:return function(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=t||"Lumia",a=t?"speaks from the Council":"weaving through the Loom",o=t?t.charAt(0).toUpperCase():"L",s=n?r("img",{attrs:{src:n,alt:i,class:"lumia-ooc-avatar"}}):r("div",{attrs:{class:"lumia-ooc-avatar lumia-ooc-avatar-placeholder"},text:o}),l=r("div",{attrs:{class:"lumia-ooc-avatar-container"},children:[s]}),c=r("span",{attrs:{class:"lumia-ooc-name"},text:i}),u=r("span",{attrs:{class:"lumia-ooc-thread"},text:a}),d=r("div",{attrs:{class:"lumia-ooc-header-row"},children:[c,u]}),m=r("div",{attrs:{class:"lumia-ooc-content"},html:e}),p=r("div",{attrs:{class:"lumia-ooc-content-column"},children:[d,m]});return r("div",{attrs:{class:"lumia-ooc-comment-box","data-lumia-ooc":"true"},children:[l,p]})}(e,n,t)}}function Te(e){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{var t;const a=o('div[mesid="'.concat(e,'"] .mes_text'));if(!a)return;n&&Pe(e);const r=(0,i.SD)(),l=null==r||null===(t=r.chat)||void 0===t?void 0:t[e],c=function(e){if(!e)return[];const n=/<(lumi[ao]_?ooc)\s+name="([^"]*)">\s*([\s\S]*?)\s*<\/\1>/gi,t=[];let i;for(;null!==(i=n.exec(e));){const e=i[1],n=i[2],a=i[3],r=je(n);console.log("[".concat(A.pW,"] Extracted OOC: tag=").concat(e,', name="').concat(n,'" â†’ "').concat(r,'", content length=').concat(a.length)),t.push({name:r,content:a.trim(),fullMatch:i[0]})}if(0===t.length){const n=/<(lumi[ao]_?ooc)(?:\s+name="([^"]*)")?>\s*([\s\S]*?)\s*<\/\1>/gi;for(;null!==(i=n.exec(e));){const e=je(i[2]);t.push({name:e,content:i[3].trim(),fullMatch:i[0]})}}return t}((null==l?void 0:l.mes)||(null==l?void 0:l.content)||""),u=s("[data-lumia-ooc]",a),d=s("font",a).filter(ke).filter(e=>!e.closest("[data-lumia-ooc]")),m=c.length+d.length;if(u.length>0&&u.length>=m&&!n)return;let p=0;c.length>0&&(console.log("[".concat(A.pW,"] Found ").concat(c.length," <lumia_ooc> tag(s) in raw content for message ").concat(e)),c.forEach((n,t)=>{const i=Ce(n.content);if(!i)return void console.log("[".concat(A.pW,"] Skipping OOC #").concat(t+1,": empty after text extraction"));if(Me(e,i))return void console.log("[".concat(A.pW,"] Skipping OOC #").concat(t+1,": already processed"));console.log("[".concat(A.pW,"] Processing OOC #").concat(t+1).concat(n.name?" (".concat(n.name,")"):"",': "').concat(i.substring(0,60),'..."'));const r=function(e,n){if(!e||!n)return null;const t=n.replace(/\s+/g," ").trim().toLowerCase();if(!t)return null;const i=t.substring(0,Math.min(50,t.length)),a=s("p",e);for(let e=0;e<a.length;e++){const n=a[e];if(n.closest("[data-lumia-ooc]"))continue;const r=Se((n.textContent||"").replace(/\s+/g," ").trim()).toLowerCase();if(!r.includes(i))continue;const o=.8*Math.min(t.length,r.length);let s=0;for(let e=0;e<t.length&&e<r.length;e++)r.includes(t.substring(e,e+10))&&(s+=10,e+=9);if(!(s<o&&t.length>50))return console.log("[".concat(A.pW,"] findMatchingElement: Matched paragraph ").concat(e," with ").concat(s,"/").concat(t.length," char overlap")),{element:n,innerHTML:n.innerHTML}}const r=document.createTreeWalker(e,NodeFilter.SHOW_TEXT);let o;for(;o=r.nextNode();){var l;if((null===(l=o.parentElement)||void 0===l||!l.closest("[data-lumia-ooc]"))&&Se(o.nodeValue||"").toLowerCase().includes(i)){let n=o.parentElement;for(;n&&n!==e&&"P"!==n.tagName&&"DIV"!==n.tagName;)n=n.parentElement;if(n&&n!==e&&!n.closest("[data-lumia-ooc]"))return console.log("[".concat(A.pW,"] findMatchingElement: Matched via text walker fallback")),{element:n,innerHTML:n.innerHTML}}}return null}(a,i);if(!r)return void console.log("[".concat(A.pW,"] Could not find OOC #").concat(t+1," text in DOM"));const o=n.name&&De(n.name)||we(),l=ye(r.innerHTML);if(!l)return;const c=Oe(l,o,p,n.name);r.element.parentNode&&(r.element.parentNode.replaceChild(c,r.element),Ee(e,i),p++,console.log("[".concat(A.pW,"] Replaced OOC #").concat(t+1," with styled box (preserved formatting)")))}));const h=s("font",a).filter(ke);h.length>0&&(console.log("[".concat(A.pW,"] Found ").concat(h.length," OOC font element(s) in DOM for message ").concat(e)),h.forEach((n,t)=>{if(n.closest("[data-lumia-ooc]"))return void console.log("[".concat(A.pW,"] Skipping font #").concat(t+1,": already inside processed box"));const i=n.innerHTML,r=ye(i);if(!r)return void console.log("[".concat(A.pW,"] Skipping font #").concat(t+1,": empty after cleaning"));const o=Ce(i);if(Me(e,o))return void console.log("[".concat(A.pW,"] Skipping font #").concat(t+1,": already processed by tag detection"));console.log("[".concat(A.pW,"] Processing font #").concat(t+1,': "').concat(r.substring(0,50)).concat(r.length>50?"...":"",'"')),Ee(e,o);const s=Oe(r,we(),p);let l=n,c=n.parentElement;for(;c&&c!==a;){var u;const e=null===(u=c.tagName)||void 0===u?void 0:u.toLowerCase();if("p"===e||"div"===e){var d,m;(null===(d=c.textContent)||void 0===d?void 0:d.trim())===(null===(m=n.textContent)||void 0===m?void 0:m.trim())&&(l=c);break}c=c.parentElement}l.parentNode&&(l.parentNode.replaceChild(s,l),console.log("[".concat(A.pW,"] Replaced font #").concat(t+1," (").concat(l.tagName,") with styled box")),p++)})),p>0&&(a.offsetHeight,console.log("[".concat(A.pW,"] Finished processing ").concat(p," OOC comment(s) in message ").concat(e)))}catch(e){console.error("[".concat(A.pW,"] Error processing OOC comments:"),e)}}function ze(e){!function(e){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const t="ooc-".concat(e),i=ae.get(t);ae.set(t,{mesId:e,force:n||(null==i?void 0:i.force)||!1}),he()}(e,arguments.length>1&&void 0!==arguments[1]&&arguments[1])}function Ae(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const n=(0,i.SD)();if(n&&n.chat){if(console.log("[".concat(A.pW,"] Processing all OOC comments in chat (").concat(n.chat.length," messages)").concat(e?" [clearing existing]":"")),e){Ne.clear();s("[data-lumia-ooc]").forEach(e=>{let n="";const t=e.querySelector(".lumia-ooc-margin-text"),i=e.querySelector(".lumia-ooc-whisper-text"),a=e.querySelector(".lumia-ooc-content");t?n=t.innerHTML:i?n=i.innerHTML:a&&(n=a.innerHTML);const r=document.createElement("font");r.setAttribute("color","#9370DB"),r.innerHTML=n,e.parentNode&&e.parentNode.replaceChild(r,e)})}for(let e=0;e<n.chat.length;e++){const n=o('div[mesid="'.concat(e,'"] .mes_text'));n&&te(n),Te(e)}}}function Ie(){!function(){ce=!0,ue=arguments.length>0&&void 0!==arguments[0]&&arguments[0]||ue,ae.clear(),he()}(arguments.length>0&&void 0!==arguments[0]&&arguments[0])}function Re(){ge&&clearTimeout(ge);const e=Date.now();requestAnimationFrame(function n(){var t;const a=document.getElementById("chat"),r=(0,i.SD)(),o=(null==r||null===(t=r.chat)||void 0===t?void 0:t.length)>0,l=a?s(".mes_text",a):[],c=l.length>0;return Date.now()-e>1e3?(console.log("[".concat(A.pW,"] Max wait time reached, processing OOCs now")),void Ie()):(!o||c)&&(c||!o)?(console.log("[".concat(A.pW,"] DOM ready with ").concat(l.length," messages, scheduling OOC processing")),void Ie()):void(ge=setTimeout(n,16))})}function Be(){console.log("[".concat(A.pW,"] Initializing RAF batch renderer for OOC comments")),me=Te,pe=Ae}var _e=t(199),Fe=t(200),Ue=t(540),Ve=t(338),He=t(848);const We=["ui"],$e=["ui"];function qe(e,n){if(null==e)return{};var t,i,a=function(e,n){if(null==e)return{};var t={};for(var i in e)if({}.hasOwnProperty.call(e,i)){if(-1!==n.indexOf(i))continue;t[i]=e[i]}return t}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)t=r[i],-1===n.indexOf(t)&&{}.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}function Ye(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,i)}return t}function Ke(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Ye(Object(t),!0).forEach(function(n){Ge(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Ye(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Ge(e,n,t){return(n=Qe(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function Qe(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,n||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}let Ze=null;const Xe=function(e){let n=e;const t=new Set;return{getState:()=>n,setState:e=>{const i="function"==typeof e?e(n):e;i!==n&&(n=Ke(Ke({},n),i),t.forEach(e=>e()))},subscribe:e=>(t.add(e),()=>t.delete(e))}}({packs:{},selectedDefinition:null,selectedBehaviors:[],selectedPersonalities:[],dominantBehavior:null,dominantPersonality:null,selectedLoomStyle:[],selectedLoomUtils:[],selectedLoomRetrofits:[],presets:{},activePresetName:null,chimeraMode:!1,selectedDefinitions:[],councilMode:!1,councilMembers:[],oocEnabled:!0,lumiaOOCStyle:"social",lumiaOOCInterval:null,messageTruncation:{enabled:!1,keepCount:50},contextFilters:{},sovereignHand:{enabled:!1,excludeLastMessage:!0,includeMessageInPrompt:!0},summarization:{},showLumiverseDrawer:!0,lumiaButtonPosition:{useDefault:!0,xPercent:1,yPercent:1},chatChangeCounter:0,ui:{activeModal:null,isLoading:!1,error:null,viewingPack:null,viewingLoomPack:null}});function Je(e,n,t){const i=n.split("."),a=Ke({},e);let r=a;for(let e=0;e<i.length-1;e++)r[i[e]]=Ke({},r[i[e]]),r=r[i[e]];return r[i[i.length-1]]=t,a}const en={updateSettings:(e,n)=>{const t=Xe.getState();Xe.setState({settings:Je(t.settings,e,n)})},setSettings:e=>{Xe.setState({settings:e})},setPacks:e=>{Xe.setState({packs:e})},setCustomPacks:e=>{const n=Ke({},Xe.getState().packs);e.forEach(e=>{n[e.name]=Ke(Ke({},e),{},{isCustom:!0})}),Xe.setState({packs:n})},addCustomPack:e=>{const n=Xe.getState(),t=n.packs&&"object"==typeof n.packs?Ke({},n.packs):{};t[e.name]=Ke(Ke({},e),{},{isCustom:!0}),Xe.setState({packs:t})},updateCustomPack:(e,n)=>{const t=Xe.getState(),i=t.packs&&"object"==typeof t.packs?Ke({},t.packs):{};let a=null;for(const[n,t]of Object.entries(i))if(t.id===e||t.name===e||n===e){a=n;break}if(a){const e=n.name||i[a].name,t=Ke(Ke(Ke({},i[a]),n),{},{isCustom:!0});e!==a?(delete i[a],i[e]=t):i[a]=t,Xe.setState({packs:i})}},removeCustomPack:e=>{const n=Xe.getState(),t=n.packs&&"object"==typeof n.packs?Ke({},n.packs):{};for(const[n,i]of Object.entries(t))if(i.id===e||i.name===e||n===e){delete t[n];break}Xe.setState({packs:t})},removePack:e=>{const n=Xe.getState(),t=n.packs&&"object"==typeof n.packs?Ke({},n.packs):{};if(t[e])delete t[e];else for(const[n,i]of Object.entries(t))if(i.name===e||i.packName===e){delete t[n];break}Xe.setState({packs:t})},_selectionsMatch:(e,n)=>!(!e||!n)&&(e.packName===n.packName&&e.itemName===n.itemName),setSelectedBehaviors:e=>{Xe.setState({selectedBehaviors:e})},toggleBehavior:e=>{const n=Xe.getState(),t=en._selectionsMatch,i=n.selectedBehaviors.findIndex(n=>t(n,e));if(i>=0){const a=[...n.selectedBehaviors];a.splice(i,1),Xe.setState({selectedBehaviors:a,dominantBehavior:t(n.dominantBehavior,e)?null:n.dominantBehavior})}else Xe.setState({selectedBehaviors:[...n.selectedBehaviors,e]})},setDominantBehavior:e=>{Xe.setState({dominantBehavior:e})},setSelectedPersonalities:e=>{Xe.setState({selectedPersonalities:e})},togglePersonality:e=>{const n=Xe.getState(),t=en._selectionsMatch,i=n.selectedPersonalities.findIndex(n=>t(n,e));if(i>=0){const a=[...n.selectedPersonalities];a.splice(i,1),Xe.setState({selectedPersonalities:a,dominantPersonality:t(n.dominantPersonality,e)?null:n.dominantPersonality})}else Xe.setState({selectedPersonalities:[...n.selectedPersonalities,e]})},setDominantPersonality:e=>{Xe.setState({dominantPersonality:e})},setSelectedDefinition:e=>{Xe.setState({selectedDefinition:e})},clearSelections:()=>{Xe.setState({selectedBehaviors:[],selectedPersonalities:[],selectedDefinition:null,dominantBehavior:null,dominantPersonality:null})},setSelectedLoomStyles:e=>{Xe.setState({selectedLoomStyle:e})},toggleLoomStyle:e=>{const n=Xe.getState(),t=en._selectionsMatch,i=n.selectedLoomStyle||[],a=i.findIndex(n=>t(n,e));if(a>=0){const e=[...i];e.splice(a,1),Xe.setState({selectedLoomStyle:e})}else Xe.setState({selectedLoomStyle:[...i,e]})},setSelectedLoomUtilities:e=>{Xe.setState({selectedLoomUtils:e})},toggleLoomUtility:e=>{const n=Xe.getState(),t=en._selectionsMatch,i=n.selectedLoomUtils||[],a=i.findIndex(n=>t(n,e));if(a>=0){const e=[...i];e.splice(a,1),Xe.setState({selectedLoomUtils:e})}else Xe.setState({selectedLoomUtils:[...i,e]})},setSelectedLoomRetrofits:e=>{Xe.setState({selectedLoomRetrofits:e})},toggleLoomRetrofit:e=>{const n=Xe.getState(),t=en._selectionsMatch,i=n.selectedLoomRetrofits||[],a=i.findIndex(n=>t(n,e));if(a>=0){const e=[...i];e.splice(a,1),Xe.setState({selectedLoomRetrofits:e})}else Xe.setState({selectedLoomRetrofits:[...i,e]})},clearLoomSelections:()=>{Xe.setState({selectedLoomStyle:[],selectedLoomUtils:[],selectedLoomRetrofits:[]})},clearAllSelections:()=>{Xe.setState({selectedBehaviors:[],selectedPersonalities:[],selectedDefinition:null,dominantBehavior:null,dominantPersonality:null,selectedLoomStyle:[],selectedLoomUtils:[],selectedLoomRetrofits:[]})},enableAllTraitsForLumia:(e,n)=>{const t=Xe.getState(),i=t.packs[e];if(!i)return;const a=i.items.find(e=>e.lumiaDefName===n);if(!a)return;const r={packName:e,itemName:n},o={};if(a.lumiaDef&&(o.selectedDefinition=r),a.lumia_behavior){const i=t.selectedBehaviors||[];i.some(t=>t.packName===e&&t.itemName===n)||(o.selectedBehaviors=[...i,r])}if(a.lumia_personality){const i=t.selectedPersonalities||[];i.some(t=>t.packName===e&&t.itemName===n)||(o.selectedPersonalities=[...i,r])}Object.keys(o).length>0&&Xe.setState(o)},savePreset:e=>{const n=Xe.getState(),t=Date.now(),i={name:e,createdAt:t,updatedAt:t,selectedDefinition:n.selectedDefinition,selectedBehaviors:[...n.selectedBehaviors||[]],selectedPersonalities:[...n.selectedPersonalities||[]],dominantBehavior:n.dominantBehavior,dominantPersonality:n.dominantPersonality,chimeraMode:n.chimeraMode||!1,selectedDefinitions:[...n.selectedDefinitions||[]],councilMode:n.councilMode||!1,councilMembers:JSON.parse(JSON.stringify(n.councilMembers||[]))};Xe.setState({presets:Ke(Ke({},n.presets),{},{[e]:i}),activePresetName:e})},loadPreset:e=>{const n=Xe.getState().presets[e];if(!n)return;const t={selectedDefinition:n.selectedDefinition,selectedBehaviors:n.selectedBehaviors||[],selectedPersonalities:n.selectedPersonalities||[],dominantBehavior:n.dominantBehavior,dominantPersonality:n.dominantPersonality,activePresetName:e};void 0!==n.chimeraMode&&(t.chimeraMode=n.chimeraMode,t.selectedDefinitions=n.selectedDefinitions||[]),void 0!==n.councilMode&&(t.councilMode=n.councilMode,t.councilMembers=n.councilMembers||[]),Xe.setState(t)},deletePreset:e=>{const n=Xe.getState(),t=n.presets,{[e]:i}=t,a=qe(t,[e].map(Qe));Xe.setState({presets:a,activePresetName:n.activePresetName===e?null:n.activePresetName})},updatePreset:e=>{const n=Xe.getState(),t=n.presets[e];if(!t)return;const i=Ke(Ke({},t),{},{updatedAt:Date.now(),selectedDefinition:n.selectedDefinition,selectedBehaviors:[...n.selectedBehaviors||[]],selectedPersonalities:[...n.selectedPersonalities||[]],dominantBehavior:n.dominantBehavior,dominantPersonality:n.dominantPersonality,chimeraMode:n.chimeraMode||!1,selectedDefinitions:[...n.selectedDefinitions||[]],councilMode:n.councilMode||!1,councilMembers:JSON.parse(JSON.stringify(n.councilMembers||[]))});Xe.setState({presets:Ke(Ke({},n.presets),{},{[e]:i})})},clearActivePreset:()=>{Xe.setState({activePresetName:null})},setChimeraMode:e=>{var n;const t=Xe.getState();e&&t.councilMode&&Xe.setState({councilMode:!1,councilMembers:[]}),e&&t.selectedDefinition?Xe.setState({chimeraMode:!0,selectedDefinitions:[t.selectedDefinition],selectedDefinition:null}):!e&&(null===(n=t.selectedDefinitions)||void 0===n?void 0:n.length)>0?Xe.setState({chimeraMode:!1,selectedDefinition:t.selectedDefinitions[0],selectedDefinitions:[]}):Xe.setState({chimeraMode:e})},toggleChimeraDefinition:e=>{const n=Xe.getState().selectedDefinitions||[],t=en._selectionsMatch,i=n.findIndex(n=>t(n,e));if(i>=0){const e=[...n];e.splice(i,1),Xe.setState({selectedDefinitions:e})}else Xe.setState({selectedDefinitions:[...n,e]})},clearChimeraDefinitions:()=>{Xe.setState({selectedDefinitions:[]})},setCouncilMode:e=>{const n=Xe.getState();e&&n.chimeraMode&&Xe.setState({chimeraMode:!1,selectedDefinitions:[]}),Xe.setState({councilMode:e})},addCouncilMember:e=>{var n;const t=Xe.getState(),i=t.packs[e.packName],a=null==i||null===(n=i.items)||void 0===n?void 0:n.find(n=>n.lumiaDefName===e.itemName),r=[],o=[];null!=a&&a.lumia_behavior&&r.push({packName:e.packName,itemName:e.itemName}),null!=a&&a.lumia_personality&&o.push({packName:e.packName,itemName:e.itemName}),Xe.setState({councilMembers:[...t.councilMembers,{id:crypto.randomUUID(),packName:e.packName,itemName:e.itemName,behaviors:r,personalities:o,dominantBehavior:null,dominantPersonality:null,role:""}]})},updateCouncilMember:(e,n)=>{const t=Xe.getState();Xe.setState({councilMembers:t.councilMembers.map(t=>t.id===e?Ke(Ke({},t),n):t)})},removeCouncilMember:e=>{const n=Xe.getState();Xe.setState({councilMembers:n.councilMembers.filter(n=>n.id!==e)})},clearCouncilMembers:()=>{Xe.setState({councilMembers:[]})},openModal:function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Xe.setState({ui:Ke(Ke({},Xe.getState().ui),{},{activeModal:{name:e,props:n}})})},closeModal:()=>{Xe.setState({ui:Ke(Ke({},Xe.getState().ui),{},{activeModal:null})})},setLoading:e=>{Xe.setState({ui:Ke(Ke({},Xe.getState().ui),{},{isLoading:e})})},setError:e=>{Xe.setState({ui:Ke(Ke({},Xe.getState().ui),{},{error:e})})},clearError:()=>{Xe.setState({ui:Ke(Ke({},Xe.getState().ui),{},{error:null})})},openPackDetail:e=>{Xe.setState({ui:Ke(Ke({},Xe.getState().ui),{},{viewingPack:e})})},closePackDetail:()=>{Xe.setState({ui:Ke(Ke({},Xe.getState().ui),{},{viewingPack:null})})},openLoomPackDetail:e=>{Xe.setState({ui:Ke(Ke({},Xe.getState().ui),{},{viewingLoomPack:e})})},closeLoomPackDetail:()=>{Xe.setState({ui:Ke(Ke({},Xe.getState().ui),{},{viewingLoomPack:null})})}};function nn(e){var n;if(!e)return void console.warn("[LumiverseStore] syncFromExtension called with null settings");console.log("[LumiverseStore] syncFromExtension - received:",{packsType:typeof e.packs,packsKeys:e.packs?Object.keys(e.packs):[],selectedDefinition:e.selectedDefinition,selectedBehaviorsCount:(null===(n=e.selectedBehaviors)||void 0===n?void 0:n.length)||0});const t=Xe.getState(),i=t.ui,a=t.chatChangeCounter||0;Xe.setState(Ke(Ke({},e),{},{ui:i,chatChangeCounter:a+1})),console.log("[LumiverseStore] syncFromExtension - store updated:",{packsKeys:Object.keys(Xe.getState().packs||{})})}function tn(){const e=Xe.getState(),{ui:n}=e,t=qe(e,We);return console.log("[LumiverseStore] exportForExtension:",{packsKeys:Object.keys(t.packs||{})}),t}function an(){!function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300;Ze&&clearTimeout(Ze),Ze=setTimeout(e,n)}(()=>{if("undefined"!=typeof LumiverseBridge&&LumiverseBridge.saveSettings){const e=tn();LumiverseBridge.saveSettings(e),console.log("[LumiverseStore] Settings saved to extension")}})}function rn(){if("undefined"!=typeof LumiverseBridge&&LumiverseBridge.saveSettings){const e=tn();LumiverseBridge.saveSettings(e),console.log("[LumiverseStore] Settings saved immediately")}}const on={getState:Xe.getState,setState:Xe.setState,subscribe:Xe.subscribe,syncFromExtension:nn,exportForExtension:tn,saveToExtension:an};on.getState=Xe.getState;const sn=(0,Ue.createContext)(null);function ln(e){let{children:n,initialSettings:t=null}=e;const i=(0,Ue.useRef)(!1);return(0,Ue.useEffect)(()=>{if(!i.current)if(i.current=!0,t)console.log("[LumiverseProvider] Using initialSettings from bridge"),nn(t);else if("undefined"!=typeof LumiverseBridge&&LumiverseBridge.getSettings){console.log("[LumiverseProvider] Fetching settings via LumiverseBridge");const e=LumiverseBridge.getSettings();e&&nn(e)}else console.warn("[LumiverseProvider] No settings source available")},[t]),(0,He.jsx)(sn.Provider,{value:Xe,children:n})}function cn(e){const n=(0,Ue.useRef)(e);n.current=e;const t=(0,Ue.useCallback)(()=>n.current(Xe.getState()),[]);return(0,Ue.useSyncExternalStore)(Xe.subscribe,t,t)}function un(){return en}const dn=e=>e.settings,mn=e=>e.ui,pn=()=>Xe.getState().selectedBehaviors,hn=()=>Xe.getState().selectedPersonalities,vn=()=>Xe.getState().selectedDefinition,fn=()=>Xe.getState().dominantBehavior,gn=()=>Xe.getState().dominantPersonality,bn=[],xn=()=>Xe.getState().selectedLoomStyle||bn,yn=()=>Xe.getState().selectedLoomUtils||bn,kn=()=>Xe.getState().selectedLoomRetrofits||bn,wn=()=>Xe.getState().packs;function jn(){return cn(dn)}function Sn(){const e=(0,Ue.useSyncExternalStore)(Xe.subscribe,pn,pn),n=(0,Ue.useSyncExternalStore)(Xe.subscribe,hn,hn),t=(0,Ue.useSyncExternalStore)(Xe.subscribe,vn,vn),i=(0,Ue.useSyncExternalStore)(Xe.subscribe,fn,fn),a=(0,Ue.useSyncExternalStore)(Xe.subscribe,gn,gn);return(0,Ue.useMemo)(()=>({behaviors:e,personalities:n,definition:t,dominantBehavior:i,dominantPersonality:a}),[e,n,t,i,a])}function Cn(){const e=(0,Ue.useSyncExternalStore)(Xe.subscribe,xn,xn),n=(0,Ue.useSyncExternalStore)(Xe.subscribe,yn,yn),t=(0,Ue.useSyncExternalStore)(Xe.subscribe,kn,kn);return(0,Ue.useMemo)(()=>({styles:e,utilities:n,retrofits:t}),[e,n,t])}function Nn(){const e=(0,Ue.useSyncExternalStore)(Xe.subscribe,wn,wn);return(0,Ue.useMemo)(()=>{let n=[];e&&(Array.isArray(e)?n=e:"object"==typeof e&&(n=Object.values(e)));const t=n.filter(e=>!0===e.isCustom);return{packs:n.filter(e=>!e.isCustom),customPacks:t,allPacks:n}},[e])}function Pn(){return cn(mn)}function Mn(e){const[n,t]=(0,Ue.useState)({objectPosition:"center center",isLoaded:!1,isPortrait:!1,isSquare:!1,isLandscape:!1}),i=(0,Ue.useRef)(e);return(0,Ue.useEffect)(()=>{if(i.current=e,!e)return void t({objectPosition:"center center",isLoaded:!1,isPortrait:!1,isSquare:!1,isLandscape:!1});const n=new Image;return n.onload=()=>{if(i.current!==e)return;const{naturalWidth:a,naturalHeight:r}=n,o=a/r,s=o<.9;let l="center center";s&&(l="center 20%"),t({objectPosition:l,isLoaded:!0,isPortrait:s,isSquare:o>=.9&&o<=1.1,isLandscape:o>1.1})},n.onerror=()=>{i.current===e&&t({objectPosition:"center center",isLoaded:!1,isPortrait:!1,isSquare:!1,isLandscape:!1})},n.src=e,()=>{n.onload=null,n.onerror=null}},[e]),n}"undefined"!=typeof window&&(window.debugLumiverseData=function(){const e=Xe.getState();console.log("=".repeat(80)),console.log("LUMIVERSE DEBUG DATA DUMP"),console.log("=".repeat(80)),console.log("\n--- STORE STATE: packs ---"),console.log("Type:",typeof e.packs,Array.isArray(e.packs)?"(Array - WRONG!)":"(Object - correct)"),console.log("Pack names:",e.packs?Object.keys(e.packs):"null"),console.log("Packs:",JSON.stringify(e.packs,null,2)),console.log("\n--- CURRENT SELECTIONS ---"),console.log("selectedDefinition:",JSON.stringify(e.selectedDefinition,null,2)),console.log("selectedBehaviors:",JSON.stringify(e.selectedBehaviors,null,2)),console.log("selectedPersonalities:",JSON.stringify(e.selectedPersonalities,null,2)),console.log("dominantBehavior:",JSON.stringify(e.dominantBehavior,null,2)),console.log("dominantPersonality:",JSON.stringify(e.dominantPersonality,null,2)),console.log("\n--- LOOM SELECTIONS ---"),console.log("selectedLoomStyle:",JSON.stringify(e.selectedLoomStyle,null,2)),console.log("selectedLoomUtils:",JSON.stringify(e.selectedLoomUtils,null,2)),console.log("selectedLoomRetrofits:",JSON.stringify(e.selectedLoomRetrofits,null,2)),console.log("\n--- SETTINGS FROM LUMIVERSE BRIDGE ---");try{if("undefined"!=typeof LumiverseBridge&&LumiverseBridge.getSettings){const e=LumiverseBridge.getSettings();e?(console.log("Bridge packs type:",typeof e.packs,Array.isArray(e.packs)?"(Array)":"(Object)"),console.log("Bridge pack names:",e.packs?Object.keys(e.packs):"null"),console.log("Full bridge settings:",JSON.stringify(e,null,2))):console.log("LumiverseBridge.getSettings() returned null")}else console.log("LumiverseBridge not available")}catch(e){console.log("Error reading bridge settings:",e.message)}console.log("\n--- PACK STRUCTURE ANALYSIS ---");const n=e.packs||{},t=Object.entries(n);console.log("Total packs:",t.length),t.forEach(e=>{var n;let[t,i]=e;console.log('\nPack "'.concat(t,'":')),console.log("  - Pack keys:",Object.keys(i)),console.log("  - items count:",(null===(n=i.items)||void 0===n?void 0:n.length)||0),i.items&&i.items.length>0&&(console.log("  - First item keys:",Object.keys(i.items[0])),console.log("  - Items with lumiaDefName:",i.items.filter(e=>e.lumiaDefName).length),console.log("  - Items with loomCategory:",i.items.filter(e=>e.loomCategory).length),console.log("  - All items:"),i.items.forEach((e,n)=>{const t=e.lumiaDefName||"NONE",i=e.loomCategory||"NONE",a=e.lumiaDef?"YES":"NO",r=e.lumia_behavior?"YES":"NO",o=e.lumia_personality?"YES":"NO";console.log("    [".concat(n,'] lumiaDefName="').concat(t,'", loomCategory="').concat(i,'", hasDef=').concat(a,", hasBehavior=").concat(r,", hasPersonality=").concat(o))}))}),console.log("\n"+"=".repeat(80)),console.log("END DEBUG DUMP - Copy everything above for analysis"),console.log("=".repeat(80));const{ui:i}=e;return{storeState:qe(e,$e)}});function En(e){var n,t,i="";if("string"==typeof e||"number"==typeof e)i+=e;else if("object"==typeof e)if(Array.isArray(e)){var a=e.length;for(n=0;n<a;n++)e[n]&&(t=En(e[n]))&&(i&&(i+=" "),i+=t)}else for(t in e)e[t]&&(i&&(i+=" "),i+=t);return i}const Ln=function(){for(var e,n,t=0,i="",a=arguments.length;t<a;t++)(e=arguments[t])&&(n=En(e))&&(i&&(i+=" "),i+=n);return i},Dn=e=>{const n=(e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,n,t)=>t?t.toUpperCase():n.toLowerCase()))(e);return n.charAt(0).toUpperCase()+n.slice(1)},On=(...e)=>e.filter((e,n,t)=>Boolean(e)&&""!==e.trim()&&t.indexOf(e)===n).join(" ").trim(),Tn=e=>{for(const n in e)if(n.startsWith("aria-")||"role"===n||"title"===n)return!0};var zn={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const An=(0,Ue.forwardRef)(({color:e="currentColor",size:n=24,strokeWidth:t=2,absoluteStrokeWidth:i,className:a="",children:r,iconNode:o,...s},l)=>(0,Ue.createElement)("svg",{ref:l,...zn,width:n,height:n,stroke:e,strokeWidth:i?24*Number(t)/Number(n):t,className:On("lucide",a),...!r&&!Tn(s)&&{"aria-hidden":"true"},...s},[...o.map(([e,n])=>(0,Ue.createElement)(e,n)),...Array.isArray(r)?r:[r]])),In=(e,n)=>{const t=(0,Ue.forwardRef)(({className:t,...i},a)=>{return(0,Ue.createElement)(An,{ref:a,iconNode:n,className:On(`lucide-${r=Dn(e),r.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,t),...i});var r});return t.displayName=Dn(e),t},Rn=In("package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]]),Bn=In("pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]),_n=In("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]),Fn=In("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]);function Un(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,i)}return t}function Vn(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Un(Object(t),!0).forEach(function(n){Hn(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Un(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Hn(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,n||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function Wn(e){let{label:n,required:t,children:i,error:a,hint:r}=e;return(0,He.jsxs)("div",{className:Ln("lumiverse-form-field",a&&"lumiverse-form-field--error"),children:[(0,He.jsxs)("label",{className:"lumiverse-form-label",children:[n,t&&(0,He.jsx)("span",{className:"lumiverse-required",children:"*"})]}),i,r&&(0,He.jsx)("span",{className:"lumiverse-form-hint",children:r}),a&&(0,He.jsx)("span",{className:"lumiverse-form-error",children:a})]})}function $n(e){let{value:n,onChange:t,placeholder:i,maxLength:a}=e;return(0,He.jsx)("input",{type:"text",className:"lumiverse-input",value:n,onChange:e=>t(e.target.value),placeholder:i,maxLength:a})}function qn(e){let{value:n,onChange:t,placeholder:i}=e;const[a,r]=(0,Ue.useState)(!1),{objectPosition:o}=Mn(n);return(0,He.jsxs)("div",{className:"lumiverse-image-input",children:[(0,He.jsx)("input",{type:"text",className:"lumiverse-input",value:n,onChange:e=>{return n=e.target.value,r(!1),void t(n);var n},placeholder:i||"Enter image URL..."}),n&&!a&&(0,He.jsx)("div",{className:"lumiverse-image-preview",children:(0,He.jsx)("img",{src:n,alt:"Preview",style:{objectPosition:o},onError:()=>r(!0)})}),a&&(0,He.jsx)("span",{className:"lumiverse-image-error",children:"Failed to load image"})]})}const Yn={key:[],keysecondary:[],constant:!1,vectorized:!1,selective:!1,selectiveLogic:0,addMemo:!0,order:100,position:0,disable:!1,excludeRecursion:!1,preventRecursion:!1,delayUntilRecursion:!1,probability:100,useProbability:!0,depth:4,group:"",groupOverride:!1,groupWeight:100,scanDepth:null,caseSensitive:null,matchWholeWords:null,useGroupScoring:null,automationId:"",role:null,sticky:0,cooldown:0,delay:0};function Kn(e,n,t){const i=e.lumiaDefName;let a="",r="";if("definition"===n){a="Lumia (".concat(i,")");const n=[];e.lumia_img&&n.push("[lumia_img=".concat(e.lumia_img,"]")),e.defAuthor&&n.push("[lumia_author=".concat(e.defAuthor,"]")),e.lumiaDef&&n.push(e.lumiaDef),r=n.join("\n")}else"behavior"===n?(a="Behavior (".concat(i,")"),r=e.lumia_behavior||""):"personality"===n&&(a="Personality (".concat(i,")"),r=e.lumia_personality||"");return Vn(Vn({},Yn),{},{uid:t,comment:a,content:r})}function Gn(e){const n=function(e){const n={};let t=0;if(e.author||e.coverUrl){let i="";e.coverUrl&&(i+="[cover_img=".concat(e.coverUrl,"]")),e.author&&(i+="[author_name=".concat(e.author,"]")),n[t]=Vn(Vn({},Yn),{},{uid:t,comment:"Metadata",content:i}),t++}for(const i of e.items||[])i.lumiaDefName&&(i.lumiaDef&&(n[t]=Kn(i,"definition",t),t++),i.lumia_behavior&&(n[t]=Kn(i,"behavior",t),t++),i.lumia_personality&&(n[t]=Kn(i,"personality",t),t++));return{entries:n}}(e),t=JSON.stringify(n,null,2),i=new Blob([t],{type:"application/json"}),a=URL.createObjectURL(i),r=document.createElement("a");r.href=a,r.download="".concat((e.name||"pack").replace(/[^a-z0-9]/gi,"_"),"_worldbook.json"),document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(a)}const Qn=function(e){let{packId:n,onClose:t}=e;const{customPacks:i}=Nn(),a=un(),r=n?i.find(e=>e.id===n||e.name===n):null,[o,s]=(0,Ue.useState)(()=>r?Vn({},r):{id:"pack_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),name:"",author:"",coverUrl:"",url:"",isCustom:!0,items:[]}),[l,c]=(0,Ue.useState)({}),u=(0,Ue.useCallback)((e,n)=>{s(t=>Vn(Vn({},t),{},{[e]:n})),l[e]&&c(n=>Vn(Vn({},n),{},{[e]:null}))},[l]),d=(o.items||[]).filter(e=>e.lumiaDefName).length;return(0,He.jsxs)("div",{className:"lumiverse-pack-editor-modal",children:[(0,He.jsxs)("div",{className:"lumiverse-pack-editor-content",children:[(0,He.jsxs)("div",{className:"lumiverse-pack-metadata",children:[(0,He.jsxs)("div",{className:"lumiverse-pack-editor-title",children:[(0,He.jsx)(Rn,{size:20,strokeWidth:1.5}),(0,He.jsx)("h3",{children:r?"Edit Pack":"New Pack"})]}),(0,He.jsx)(Wn,{label:"Pack Name",required:!0,error:l.name,children:(0,He.jsx)($n,{value:o.name,onChange:e=>u("name",e),placeholder:"My Custom Pack"})}),(0,He.jsx)(Wn,{label:"Author",children:(0,He.jsx)($n,{value:o.author||"",onChange:e=>u("author",e),placeholder:"Your name"})}),(0,He.jsx)(Wn,{label:"Cover Image",hint:"URL for pack cover image",children:(0,He.jsx)(qn,{value:o.coverUrl||"",onChange:e=>u("coverUrl",e)})})]}),(0,He.jsxs)("div",{className:"lumiverse-pack-lumias-info",children:[(0,He.jsx)("div",{className:"lumiverse-pack-lumias-header",children:(0,He.jsxs)("span",{className:"lumiverse-pack-lumias-count",children:[d," Lumia",1!==d?"s":""," in this pack"]})}),(0,He.jsx)("p",{className:"lumiverse-pack-lumias-hint",children:"Use the Pack Selector to add, edit, or remove individual Lumias."}),(0,He.jsxs)("button",{className:"lumiverse-btn lumiverse-btn--secondary lumiverse-btn--full",onClick:()=>{o.name.trim()&&(r?a.updateCustomPack(o.id||o.name,o):a.addCustomPack(o),an()),a.openModal("packSelector"),t()},type:"button",children:[(0,He.jsx)(Bn,{size:14,strokeWidth:1.5}),"Manage Lumias"]})]})]}),(0,He.jsxs)("div",{className:"lumiverse-pack-editor-footer",children:[(0,He.jsxs)("div",{className:"lumiverse-pack-editor-footer-left",children:[r&&(0,He.jsxs)("button",{className:"lumiverse-btn lumiverse-btn--danger",onClick:()=>{window.confirm('Are you sure you want to delete "'.concat(o.name,'"? This will remove all Lumias in this pack.'))&&(a.removeCustomPack(o.id||o.name),an(),t())},type:"button",children:[(0,He.jsx)(_n,{size:14}),"Delete Pack"]}),(0,He.jsxs)("button",{className:"lumiverse-btn lumiverse-btn--secondary",onClick:()=>{o.name.trim()?Gn(o):alert("Please enter a pack name before exporting.")},type:"button",title:"Export as SillyTavern World Book JSON",children:[(0,He.jsx)(Fn,{size:14}),"Export"]})]}),(0,He.jsxs)("div",{className:"lumiverse-pack-editor-actions",children:[(0,He.jsx)("button",{className:"lumiverse-btn lumiverse-btn--secondary",onClick:t,type:"button",children:"Cancel"}),(0,He.jsx)("button",{className:"lumiverse-btn lumiverse-btn--primary",onClick:()=>{(()=>{const e={};return o.name.trim()||(e.name="Pack name is required"),c(e),0===Object.keys(e).length})()&&(r?a.updateCustomPack(o.id||o.name,o):a.addCustomPack(o),an(),t())},type:"button",children:r?"Save Changes":"Create Pack"})]})]})]})},Zn=["isOpen","children","className","duration","initial","animate","exit","transition"];function Xn(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,i)}return t}function Jn(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Xn(Object(t),!0).forEach(function(n){et(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Xn(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function et(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,n||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const nt=(0,Ue.forwardRef)(function(e,n){let{isOpen:t,children:i,className:a,duration:r=200,initial:o,animate:s,exit:l,transition:c}=e,u=function(e,n){if(null==e)return{};var t,i,a=function(e,n){if(null==e)return{};var t={};for(var i in e)if({}.hasOwnProperty.call(e,i)){if(-1!==n.indexOf(i))continue;t[i]=e[i]}return t}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)t=r[i],-1===n.indexOf(t)&&{}.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}(e,Zn);return(0,He.jsx)("div",Jn(Jn({ref:n,className:Ln("lumiverse-collapsible",a,{"is-open":t}),style:{"--collapsible-duration":"".concat(r,"ms")}},u),{},{children:(0,He.jsx)("div",{className:"lumiverse-collapsible-inner",children:i})}))}),tt=(0,Ue.createContext)({});function it(e){const n=(0,Ue.useRef)(null);return null===n.current&&(n.current=e()),n.current}const at=(0,Ue.createContext)(null),rt=(0,Ue.createContext)({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"});class ot extends Ue.Component{getSnapshotBeforeUpdate(e){const n=this.props.childRef.current;if(n&&e.isPresent&&!this.props.isPresent){const e=this.props.sizeRef.current;e.height=n.offsetHeight||0,e.width=n.offsetWidth||0,e.top=n.offsetTop,e.left=n.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function st({children:e,isPresent:n}){const t=(0,Ue.useId)(),i=(0,Ue.useRef)(null),a=(0,Ue.useRef)({width:0,height:0,top:0,left:0}),{nonce:r}=(0,Ue.useContext)(rt);return(0,Ue.useInsertionEffect)(()=>{const{width:e,height:o,top:s,left:l}=a.current;if(n||!i.current||!e||!o)return;i.current.dataset.motionPopId=t;const c=document.createElement("style");return r&&(c.nonce=r),document.head.appendChild(c),c.sheet&&c.sheet.insertRule(`\n          [data-motion-pop-id="${t}"] {\n            position: absolute !important;\n            width: ${e}px !important;\n            height: ${o}px !important;\n            top: ${s}px !important;\n            left: ${l}px !important;\n          }\n        `),()=>{document.head.removeChild(c)}},[n]),(0,He.jsx)(ot,{isPresent:n,childRef:i,sizeRef:a,children:Ue.cloneElement(e,{ref:i})})}const lt=({children:e,initial:n,isPresent:t,onExitComplete:i,custom:a,presenceAffectsLayout:r,mode:o})=>{const s=it(ct),l=(0,Ue.useId)(),c=(0,Ue.useCallback)(e=>{s.set(e,!0);for(const e of s.values())if(!e)return;i&&i()},[s,i]),u=(0,Ue.useMemo)(()=>({id:l,initial:n,isPresent:t,custom:a,onExitComplete:c,register:e=>(s.set(e,!1),()=>s.delete(e))}),r?[Math.random(),c]:[t,c]);return(0,Ue.useMemo)(()=>{s.forEach((e,n)=>s.set(n,!1))},[t]),Ue.useEffect(()=>{!t&&!s.size&&i&&i()},[t]),"popLayout"===o&&(e=(0,He.jsx)(st,{isPresent:t,children:e})),(0,He.jsx)(at.Provider,{value:u,children:e})};function ct(){return new Map}function ut(e=!0){const n=(0,Ue.useContext)(at);if(null===n)return[!0,null];const{isPresent:t,onExitComplete:i,register:a}=n,r=(0,Ue.useId)();(0,Ue.useEffect)(()=>{e&&a(r)},[e]);const o=(0,Ue.useCallback)(()=>e&&i&&i(r),[r,i,e]);return!t&&i?[!1,o]:[!0]}const dt=e=>e.key||"";function mt(e){const n=[];return Ue.Children.forEach(e,e=>{(0,Ue.isValidElement)(e)&&n.push(e)}),n}const pt="undefined"!=typeof window,ht=pt?Ue.useLayoutEffect:Ue.useEffect,vt=({children:e,custom:n,initial:t=!0,onExitComplete:i,presenceAffectsLayout:a=!0,mode:r="sync",propagate:o=!1})=>{const[s,l]=ut(o),c=(0,Ue.useMemo)(()=>mt(e),[e]),u=o&&!s?[]:c.map(dt),d=(0,Ue.useRef)(!0),m=(0,Ue.useRef)(c),p=it(()=>new Map),[h,v]=(0,Ue.useState)(c),[f,g]=(0,Ue.useState)(c);ht(()=>{d.current=!1,m.current=c;for(let e=0;e<f.length;e++){const n=dt(f[e]);u.includes(n)?p.delete(n):!0!==p.get(n)&&p.set(n,!1)}},[f,u.length,u.join("-")]);const b=[];if(c!==h){let e=[...c];for(let n=0;n<f.length;n++){const t=f[n],i=dt(t);u.includes(i)||(e.splice(n,0,t),b.push(t))}return"wait"===r&&b.length&&(e=b),g(mt(e)),void v(c)}const{forceRender:x}=(0,Ue.useContext)(tt);return(0,He.jsx)(He.Fragment,{children:f.map(e=>{const h=dt(e),v=!(o&&!s)&&(c===f||u.includes(h));return(0,He.jsx)(lt,{isPresent:v,initial:!(d.current&&!t)&&void 0,custom:v?void 0:n,presenceAffectsLayout:a,mode:r,onExitComplete:v?void 0:()=>{if(!p.has(h))return;p.set(h,!0);let e=!0;p.forEach(n=>{n||(e=!1)}),e&&(null==x||x(),g(m.current),o&&(null==l||l()),i&&i())},children:e},h)})})};function ft(e){if("undefined"==typeof Proxy)return e;const n=new Map;return new Proxy((...n)=>e(...n),{get:(t,i)=>"create"===i?e:(n.has(i)||n.set(i,e(i)),n.get(i))})}function gt(e){return null!==e&&"object"==typeof e&&"function"==typeof e.start}const bt=e=>Array.isArray(e);function xt(e,n){if(!Array.isArray(n))return!1;const t=n.length;if(t!==e.length)return!1;for(let i=0;i<t;i++)if(n[i]!==e[i])return!1;return!0}function yt(e){return"string"==typeof e||Array.isArray(e)}function kt(e){const n=[{},{}];return null==e||e.values.forEach((e,t)=>{n[0][t]=e.get(),n[1][t]=e.getVelocity()}),n}function wt(e,n,t,i){if("function"==typeof n){const[a,r]=kt(i);n=n(void 0!==t?t:e.custom,a,r)}if("string"==typeof n&&(n=e.variants&&e.variants[n]),"function"==typeof n){const[a,r]=kt(i);n=n(void 0!==t?t:e.custom,a,r)}return n}function jt(e,n,t){const i=e.getProps();return wt(i,n,void 0!==t?t:i.custom,e)}const St=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],Ct=["initial",...St];function Nt(e,n){return e?e[n]||e.default||e:void 0}const Pt=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Mt=new Set(Pt),Et=new Set(["width","height","top","left","right","bottom",...Pt]),Lt=e=>bt(e)?e[e.length-1]||0:e,Dt=!1,Ot=!1,Tt=e=>e;const zt=["read","resolveKeyframes","update","preRender","render","postRender"];function At(e,n){let t=!1,i=!0;const a={delta:0,timestamp:0,isProcessing:!1},r=()=>t=!0,o=zt.reduce((e,n)=>(e[n]=function(e){let n=new Set,t=new Set,i=!1,a=!1;const r=new WeakSet;let o={delta:0,timestamp:0,isProcessing:!1};function s(n){r.has(n)&&(l.schedule(n),e()),n(o)}const l={schedule:(e,a=!1,o=!1)=>{const s=o&&i?n:t;return a&&r.add(e),s.has(e)||s.add(e),e},cancel:e=>{t.delete(e),r.delete(e)},process:e=>{o=e,i?a=!0:(i=!0,[n,t]=[t,n],n.forEach(s),n.clear(),i=!1,a&&(a=!1,l.process(e)))}};return l}(r),e),{}),{read:s,resolveKeyframes:l,update:c,preRender:u,render:d,postRender:m}=o,p=()=>{const r=Ot?a.timestamp:performance.now();t=!1,a.delta=i?1e3/60:Math.max(Math.min(r-a.timestamp,40),1),a.timestamp=r,a.isProcessing=!0,s.process(a),l.process(a),c.process(a),u.process(a),d.process(a),m.process(a),a.isProcessing=!1,t&&n&&(i=!1,e(p))};return{schedule:zt.reduce((n,r)=>{const s=o[r];return n[r]=(n,r=!1,o=!1)=>(t||(t=!0,i=!0,a.isProcessing||e(p)),s.schedule(n,r,o)),n},{}),cancel:e=>{for(let n=0;n<zt.length;n++)o[zt[n]].cancel(e)},state:a,steps:o}}const{schedule:It,cancel:Rt,state:Bt,steps:_t}=At("undefined"!=typeof requestAnimationFrame?requestAnimationFrame:Tt,!0);let Ft;function Ut(){Ft=void 0}const Vt={now:()=>(void 0===Ft&&Vt.set(Bt.isProcessing||Ot?Bt.timestamp:performance.now()),Ft),set:e=>{Ft=e,queueMicrotask(Ut)}};function Ht(e,n){-1===e.indexOf(n)&&e.push(n)}function Wt(e,n){const t=e.indexOf(n);t>-1&&e.splice(t,1)}class $t{constructor(){this.subscriptions=[]}add(e){return Ht(this.subscriptions,e),()=>Wt(this.subscriptions,e)}notify(e,n,t){const i=this.subscriptions.length;if(i)if(1===i)this.subscriptions[0](e,n,t);else for(let a=0;a<i;a++){const i=this.subscriptions[a];i&&i(e,n,t)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function qt(e,n){return n?e*(1e3/n):0}const Yt={current:void 0};class Kt{constructor(e,n={}){this.version="11.18.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(e,n=!0)=>{const t=Vt.now();this.updatedAt!==t&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(e),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),n&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(e),this.owner=n.owner}setCurrent(e){var n;this.current=e,this.updatedAt=Vt.now(),null===this.canTrackVelocity&&void 0!==e&&(this.canTrackVelocity=(n=this.current,!isNaN(parseFloat(n))))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,n){this.events[e]||(this.events[e]=new $t);const t=this.events[e].add(n);return"change"===e?()=>{t(),It.read(()=>{this.events.change.getSize()||this.stop()})}:t}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,n){this.passiveEffect=e,this.stopPassiveEffect=n}set(e,n=!0){n&&this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e,n)}setWithVelocity(e,n,t){this.set(n),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-t}jump(e,n=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,n&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return Yt.current&&Yt.current.push(this),this.current}getPrevious(){return this.prev}getVelocity(){const e=Vt.now();if(!this.canTrackVelocity||void 0===this.prevFrameValue||e-this.updatedAt>30)return 0;const n=Math.min(this.updatedAt-this.prevUpdatedAt,30);return qt(parseFloat(this.current)-parseFloat(this.prevFrameValue),n)}start(e){return this.stop(),new Promise(n=>{this.hasAnimated=!0,this.animation=e(n),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Gt(e,n){return new Kt(e,n)}function Qt(e,n,t){e.hasValue(n)?e.getValue(n).set(t):e.addValue(n,Gt(t))}const Zt=e=>Boolean(e&&e.getVelocity);function Xt(e,n){const t=e.getValue("willChange");if(i=t,Boolean(Zt(i)&&i.add))return t.add(n);var i}const Jt=e=>e.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),ei="data-"+Jt("framerAppearId");function ni(e){return e.props[ei]}function ti(e){let n;return()=>(void 0===n&&(n=e()),n)}const ii=ti(()=>void 0!==window.ScrollTimeline);class ai{constructor(e){this.stop=()=>this.runAll("stop"),this.animations=e.filter(Boolean)}get finished(){return Promise.all(this.animations.map(e=>"finished"in e?e.finished:e))}getAll(e){return this.animations[0][e]}setAll(e,n){for(let t=0;t<this.animations.length;t++)this.animations[t][e]=n}attachTimeline(e,n){const t=this.animations.map(t=>ii()&&t.attachTimeline?t.attachTimeline(e):"function"==typeof n?n(t):void 0);return()=>{t.forEach((e,n)=>{e&&e(),this.animations[n].stop()})}}get time(){return this.getAll("time")}set time(e){this.setAll("time",e)}get speed(){return this.getAll("speed")}set speed(e){this.setAll("speed",e)}get startTime(){return this.getAll("startTime")}get duration(){let e=0;for(let n=0;n<this.animations.length;n++)e=Math.max(e,this.animations[n].duration);return e}runAll(e){this.animations.forEach(n=>n[e]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class ri extends ai{then(e,n){return Promise.all(this.animations).then(e).catch(n)}}const oi=e=>1e3*e,si=e=>e/1e3,li=!1;function ci(e){return"function"==typeof e}function ui(e,n){e.timeline=n,e.onfinish=null}const di=e=>Array.isArray(e)&&"number"==typeof e[0],mi={linearEasing:void 0};function pi(e,n){const t=ti(e);return()=>{var e;return null!==(e=mi[n])&&void 0!==e?e:t()}}const hi=pi(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch(e){return!1}return!0},"linearEasing"),vi=(e,n,t)=>{const i=n-e;return 0===i?1:(t-e)/i},fi=(e,n,t=10)=>{let i="";const a=Math.max(Math.round(n/t),2);for(let n=0;n<a;n++)i+=e(vi(0,a-1,n))+", ";return`linear(${i.substring(0,i.length-2)})`};function gi(e){return Boolean("function"==typeof e&&hi()||!e||"string"==typeof e&&(e in xi||hi())||di(e)||Array.isArray(e)&&e.every(gi))}const bi=([e,n,t,i])=>`cubic-bezier(${e}, ${n}, ${t}, ${i})`,xi={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:bi([0,.65,.55,1]),circOut:bi([.55,0,1,.45]),backIn:bi([.31,.01,.66,-.59]),backOut:bi([.33,1.53,.69,.99])};function yi(e,n){return e?"function"==typeof e&&hi()?fi(e,n):di(e)?bi(e):Array.isArray(e)?e.map(e=>yi(e,n)||xi.easeOut):xi[e]:void 0}const ki=(e,n,t)=>(((1-3*t+3*n)*e+(3*t-6*n))*e+3*n)*e;function wi(e,n,t,i){if(e===n&&t===i)return Tt;const a=n=>function(e,n,t,i,a){let r,o,s=0;do{o=n+(t-n)/2,r=ki(o,i,a)-e,r>0?t=o:n=o}while(Math.abs(r)>1e-7&&++s<12);return o}(n,0,1,e,t);return e=>0===e||1===e?e:ki(a(e),n,i)}const ji=e=>n=>n<=.5?e(2*n)/2:(2-e(2*(1-n)))/2,Si=e=>n=>1-e(1-n),Ci=wi(.33,1.53,.69,.99),Ni=Si(Ci),Pi=ji(Ni),Mi=e=>(e*=2)<1?.5*Ni(e):.5*(2-Math.pow(2,-10*(e-1))),Ei=e=>1-Math.sin(Math.acos(e)),Li=Si(Ei),Di=ji(Ei),Oi=e=>/^0[^.\s]+$/u.test(e);function Ti(e){return"number"==typeof e?0===e:null===e||("none"===e||"0"===e||Oi(e))}const zi=(e,n,t)=>t>n?n:t<e?e:t,Ai={test:e=>"number"==typeof e,parse:parseFloat,transform:e=>e},Ii={...Ai,transform:e=>zi(0,1,e)},Ri={...Ai,default:1},Bi=e=>Math.round(1e5*e)/1e5,_i=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;const Fi=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,Ui=(e,n)=>t=>Boolean("string"==typeof t&&Fi.test(t)&&t.startsWith(e)||n&&!function(e){return null==e}(t)&&Object.prototype.hasOwnProperty.call(t,n)),Vi=(e,n,t)=>i=>{if("string"!=typeof i)return i;const[a,r,o,s]=i.match(_i);return{[e]:parseFloat(a),[n]:parseFloat(r),[t]:parseFloat(o),alpha:void 0!==s?parseFloat(s):1}},Hi={...Ai,transform:e=>Math.round((e=>zi(0,255,e))(e))},Wi={test:Ui("rgb","red"),parse:Vi("red","green","blue"),transform:({red:e,green:n,blue:t,alpha:i=1})=>"rgba("+Hi.transform(e)+", "+Hi.transform(n)+", "+Hi.transform(t)+", "+Bi(Ii.transform(i))+")"};const $i={test:Ui("#"),parse:function(e){let n="",t="",i="",a="";return e.length>5?(n=e.substring(1,3),t=e.substring(3,5),i=e.substring(5,7),a=e.substring(7,9)):(n=e.substring(1,2),t=e.substring(2,3),i=e.substring(3,4),a=e.substring(4,5),n+=n,t+=t,i+=i,a+=a),{red:parseInt(n,16),green:parseInt(t,16),blue:parseInt(i,16),alpha:a?parseInt(a,16)/255:1}},transform:Wi.transform},qi=e=>({test:n=>"string"==typeof n&&n.endsWith(e)&&1===n.split(" ").length,parse:parseFloat,transform:n=>`${n}${e}`}),Yi=qi("deg"),Ki=qi("%"),Gi=qi("px"),Qi=qi("vh"),Zi=qi("vw"),Xi={...Ki,parse:e=>Ki.parse(e)/100,transform:e=>Ki.transform(100*e)},Ji={test:Ui("hsl","hue"),parse:Vi("hue","saturation","lightness"),transform:({hue:e,saturation:n,lightness:t,alpha:i=1})=>"hsla("+Math.round(e)+", "+Ki.transform(Bi(n))+", "+Ki.transform(Bi(t))+", "+Bi(Ii.transform(i))+")"},ea={test:e=>Wi.test(e)||$i.test(e)||Ji.test(e),parse:e=>Wi.test(e)?Wi.parse(e):Ji.test(e)?Ji.parse(e):$i.parse(e),transform:e=>"string"==typeof e?e:e.hasOwnProperty("red")?Wi.transform(e):Ji.transform(e)},na=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;const ta="number",ia="color",aa=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function ra(e){const n=e.toString(),t=[],i={color:[],number:[],var:[]},a=[];let r=0;const o=n.replace(aa,e=>(ea.test(e)?(i.color.push(r),a.push(ia),t.push(ea.parse(e))):e.startsWith("var(")?(i.var.push(r),a.push("var"),t.push(e)):(i.number.push(r),a.push(ta),t.push(parseFloat(e))),++r,"${}")).split("${}");return{values:t,split:o,indexes:i,types:a}}function oa(e){return ra(e).values}function sa(e){const{split:n,types:t}=ra(e),i=n.length;return e=>{let a="";for(let r=0;r<i;r++)if(a+=n[r],void 0!==e[r]){const n=t[r];a+=n===ta?Bi(e[r]):n===ia?ea.transform(e[r]):e[r]}return a}}const la=e=>"number"==typeof e?0:e;const ca={test:function(e){var n,t;return isNaN(e)&&"string"==typeof e&&((null===(n=e.match(_i))||void 0===n?void 0:n.length)||0)+((null===(t=e.match(na))||void 0===t?void 0:t.length)||0)>0},parse:oa,createTransformer:sa,getAnimatableNone:function(e){const n=oa(e);return sa(e)(n.map(la))}},ua=new Set(["brightness","contrast","saturate","opacity"]);function da(e){const[n,t]=e.slice(0,-1).split("(");if("drop-shadow"===n)return e;const[i]=t.match(_i)||[];if(!i)return e;const a=t.replace(i,"");let r=ua.has(n)?1:0;return i!==t&&(r*=100),n+"("+r+a+")"}const ma=/\b([a-z-]*)\(.*?\)/gu,pa={...ca,getAnimatableNone:e=>{const n=e.match(ma);return n?n.map(da).join(" "):e}},ha={borderWidth:Gi,borderTopWidth:Gi,borderRightWidth:Gi,borderBottomWidth:Gi,borderLeftWidth:Gi,borderRadius:Gi,radius:Gi,borderTopLeftRadius:Gi,borderTopRightRadius:Gi,borderBottomRightRadius:Gi,borderBottomLeftRadius:Gi,width:Gi,maxWidth:Gi,height:Gi,maxHeight:Gi,top:Gi,right:Gi,bottom:Gi,left:Gi,padding:Gi,paddingTop:Gi,paddingRight:Gi,paddingBottom:Gi,paddingLeft:Gi,margin:Gi,marginTop:Gi,marginRight:Gi,marginBottom:Gi,marginLeft:Gi,backgroundPositionX:Gi,backgroundPositionY:Gi},va={rotate:Yi,rotateX:Yi,rotateY:Yi,rotateZ:Yi,scale:Ri,scaleX:Ri,scaleY:Ri,scaleZ:Ri,skew:Yi,skewX:Yi,skewY:Yi,distance:Gi,translateX:Gi,translateY:Gi,translateZ:Gi,x:Gi,y:Gi,z:Gi,perspective:Gi,transformPerspective:Gi,opacity:Ii,originX:Xi,originY:Xi,originZ:Gi},fa={...Ai,transform:Math.round},ga={...ha,...va,zIndex:fa,size:Gi,fillOpacity:Ii,strokeOpacity:Ii,numOctaves:fa},ba={...ga,color:ea,backgroundColor:ea,outlineColor:ea,fill:ea,stroke:ea,borderColor:ea,borderTopColor:ea,borderRightColor:ea,borderBottomColor:ea,borderLeftColor:ea,filter:pa,WebkitFilter:pa},xa=e=>ba[e];function ya(e,n){let t=xa(e);return t!==pa&&(t=ca),t.getAnimatableNone?t.getAnimatableNone(n):void 0}const ka=new Set(["auto","none","0"]);const wa=e=>e===Ai||e===Gi,ja=(e,n)=>parseFloat(e.split(", ")[n]),Sa=(e,n)=>(t,{transform:i})=>{if("none"===i||!i)return 0;const a=i.match(/^matrix3d\((.+)\)$/u);if(a)return ja(a[1],n);{const n=i.match(/^matrix\((.+)\)$/u);return n?ja(n[1],e):0}},Ca=new Set(["x","y","z"]),Na=Pt.filter(e=>!Ca.has(e));const Pa={width:({x:e},{paddingLeft:n="0",paddingRight:t="0"})=>e.max-e.min-parseFloat(n)-parseFloat(t),height:({y:e},{paddingTop:n="0",paddingBottom:t="0"})=>e.max-e.min-parseFloat(n)-parseFloat(t),top:(e,{top:n})=>parseFloat(n),left:(e,{left:n})=>parseFloat(n),bottom:({y:e},{top:n})=>parseFloat(n)+(e.max-e.min),right:({x:e},{left:n})=>parseFloat(n)+(e.max-e.min),x:Sa(4,13),y:Sa(5,14)};Pa.translateX=Pa.x,Pa.translateY=Pa.y;const Ma=new Set;let Ea=!1,La=!1;function Da(){if(La){const e=Array.from(Ma).filter(e=>e.needsMeasurement),n=new Set(e.map(e=>e.element)),t=new Map;n.forEach(e=>{const n=function(e){const n=[];return Na.forEach(t=>{const i=e.getValue(t);void 0!==i&&(n.push([t,i.get()]),i.set(t.startsWith("scale")?1:0))}),n}(e);n.length&&(t.set(e,n),e.render())}),e.forEach(e=>e.measureInitialState()),n.forEach(e=>{e.render();const n=t.get(e);n&&n.forEach(([n,t])=>{var i;null===(i=e.getValue(n))||void 0===i||i.set(t)})}),e.forEach(e=>e.measureEndState()),e.forEach(e=>{void 0!==e.suspendedScrollY&&window.scrollTo(0,e.suspendedScrollY)})}La=!1,Ea=!1,Ma.forEach(e=>e.complete()),Ma.clear()}function Oa(){Ma.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(La=!0)})}class Ta{constructor(e,n,t,i,a,r=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...e],this.onComplete=n,this.name=t,this.motionValue=i,this.element=a,this.isAsync=r}scheduleResolve(){this.isScheduled=!0,this.isAsync?(Ma.add(this),Ea||(Ea=!0,It.read(Oa),It.resolveKeyframes(Da))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:n,element:t,motionValue:i}=this;for(let a=0;a<e.length;a++)if(null===e[a])if(0===a){const a=null==i?void 0:i.get(),r=e[e.length-1];if(void 0!==a)e[0]=a;else if(t&&n){const i=t.readValue(n,r);null!=i&&(e[0]=i)}void 0===e[0]&&(e[0]=r),i&&void 0===a&&i.set(e[0])}else e[a]=e[a-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),Ma.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,Ma.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}let za=Tt,Aa=Tt;const Ia=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e),Ra=e=>n=>"string"==typeof n&&n.startsWith(e),Ba=Ra("--"),_a=Ra("var(--"),Fa=e=>!!_a(e)&&Ua.test(e.split("/*")[0].trim()),Ua=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,Va=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function Ha(e,n,t=1){Aa(t<=4,`Max CSS variable fallback depth detected in property "${e}". This may indicate a circular fallback dependency.`);const[i,a]=function(e){const n=Va.exec(e);if(!n)return[,];const[,t,i,a]=n;return[`--${null!=t?t:i}`,a]}(e);if(!i)return;const r=window.getComputedStyle(n).getPropertyValue(i);if(r){const e=r.trim();return Ia(e)?parseFloat(e):e}return Fa(a)?Ha(a,n,t+1):a}const Wa=e=>n=>n.test(e),$a=[Ai,Gi,Ki,Yi,Zi,Qi,{test:e=>"auto"===e,parse:e=>e}],qa=e=>$a.find(Wa(e));class Ya extends Ta{constructor(e,n,t,i,a){super(e,n,t,i,a,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:n,name:t}=this;if(!n||!n.current)return;super.readKeyframes();for(let t=0;t<e.length;t++){let i=e[t];if("string"==typeof i&&(i=i.trim(),Fa(i))){const a=Ha(i,n.current);void 0!==a&&(e[t]=a),t===e.length-1&&(this.finalKeyframe=i)}}if(this.resolveNoneKeyframes(),!Et.has(t)||2!==e.length)return;const[i,a]=e,r=qa(i),o=qa(a);if(r!==o)if(wa(r)&&wa(o))for(let n=0;n<e.length;n++){const t=e[n];"string"==typeof t&&(e[n]=parseFloat(t))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:n}=this,t=[];for(let n=0;n<e.length;n++)Ti(e[n])&&t.push(n);t.length&&function(e,n,t){let i,a=0;for(;a<e.length&&!i;){const n=e[a];"string"==typeof n&&!ka.has(n)&&ra(n).values.length&&(i=e[a]),a++}if(i&&t)for(const a of n)e[a]=ya(t,i)}(e,t,n)}measureInitialState(){const{element:e,unresolvedKeyframes:n,name:t}=this;if(!e||!e.current)return;"height"===t&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Pa[t](e.measureViewportBox(),window.getComputedStyle(e.current)),n[0]=this.measuredOrigin;const i=n[n.length-1];void 0!==i&&e.getValue(t,i).jump(i,!1)}measureEndState(){var e;const{element:n,name:t,unresolvedKeyframes:i}=this;if(!n||!n.current)return;const a=n.getValue(t);a&&a.jump(this.measuredOrigin,!1);const r=i.length-1,o=i[r];i[r]=Pa[t](n.measureViewportBox(),window.getComputedStyle(n.current)),null!==o&&void 0===this.finalKeyframe&&(this.finalKeyframe=o),(null===(e=this.removedTransforms)||void 0===e?void 0:e.length)&&this.removedTransforms.forEach(([e,t])=>{n.getValue(e).set(t)}),this.resolveNoneKeyframes()}}const Ka=(e,n)=>"zIndex"!==n&&(!("number"!=typeof e&&!Array.isArray(e))||!("string"!=typeof e||!ca.test(e)&&"0"!==e||e.startsWith("url(")));function Ga(e,n,t,i){const a=e[0];if(null===a)return!1;if("display"===n||"visibility"===n)return!0;const r=e[e.length-1],o=Ka(a,n),s=Ka(r,n);return za(o===s,`You are trying to animate ${n} from "${a}" to "${r}". ${a} is not an animatable value - to enable this animation set ${a} to a value animatable to ${r} via the \`style\` property.`),!(!o||!s)&&(function(e){const n=e[0];if(1===e.length)return!0;for(let t=0;t<e.length;t++)if(e[t]!==n)return!0}(e)||("spring"===t||ci(t))&&i)}const Qa=e=>null!==e;function Za(e,{repeat:n,repeatType:t="loop"},i){const a=e.filter(Qa),r=n&&"loop"!==t&&n%2==1?0:a.length-1;return r&&void 0!==i?i:a[r]}class Xa{constructor({autoplay:e=!0,delay:n=0,type:t="keyframes",repeat:i=0,repeatDelay:a=0,repeatType:r="loop",...o}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=Vt.now(),this.options={autoplay:e,delay:n,type:t,repeat:i,repeatDelay:a,repeatType:r,...o},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt&&this.resolvedAt-this.createdAt>40?this.resolvedAt:this.createdAt}get resolved(){return this._resolved||this.hasAttemptedResolve||(Oa(),Da()),this._resolved}onKeyframesResolved(e,n){this.resolvedAt=Vt.now(),this.hasAttemptedResolve=!0;const{name:t,type:i,velocity:a,delay:r,onComplete:o,onUpdate:s,isGenerator:l}=this.options;if(!l&&!Ga(e,t,i,a)){if(li||!r)return s&&s(Za(e,this.options,n)),o&&o(),void this.resolveFinishedPromise();this.options.duration=0}const c=this.initPlayback(e,n);!1!==c&&(this._resolved={keyframes:e,finalKeyframe:n,...c},this.onPostResolved())}onPostResolved(){}then(e,n){return this.currentFinishedPromise.then(e,n)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(e=>{this.resolveFinishedPromise=e})}}const Ja=2e4;function er(e){let n=0;let t=e.next(n);for(;!t.done&&n<Ja;)n+=50,t=e.next(n);return n>=Ja?1/0:n}const nr=(e,n,t)=>e+(n-e)*t;function tr(e,n,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?e+6*(n-e)*t:t<.5?n:t<2/3?e+(n-e)*(2/3-t)*6:e}function ir(e,n){return t=>t>0?n:e}const ar=(e,n,t)=>{const i=e*e,a=t*(n*n-i)+i;return a<0?0:Math.sqrt(a)},rr=[$i,Wi,Ji];function or(e){const n=(t=e,rr.find(e=>e.test(t)));var t;if(za(Boolean(n),`'${e}' is not an animatable color. Use the equivalent color code instead.`),!Boolean(n))return!1;let i=n.parse(e);return n===Ji&&(i=function({hue:e,saturation:n,lightness:t,alpha:i}){e/=360,t/=100;let a=0,r=0,o=0;if(n/=100){const i=t<.5?t*(1+n):t+n-t*n,s=2*t-i;a=tr(s,i,e+1/3),r=tr(s,i,e),o=tr(s,i,e-1/3)}else a=r=o=t;return{red:Math.round(255*a),green:Math.round(255*r),blue:Math.round(255*o),alpha:i}}(i)),i}const sr=(e,n)=>{const t=or(e),i=or(n);if(!t||!i)return ir(e,n);const a={...t};return e=>(a.red=ar(t.red,i.red,e),a.green=ar(t.green,i.green,e),a.blue=ar(t.blue,i.blue,e),a.alpha=nr(t.alpha,i.alpha,e),Wi.transform(a))},lr=(e,n)=>t=>n(e(t)),cr=(...e)=>e.reduce(lr),ur=new Set(["none","hidden"]);function dr(e,n){return t=>nr(e,n,t)}function mr(e){return"number"==typeof e?dr:"string"==typeof e?Fa(e)?ir:ea.test(e)?sr:vr:Array.isArray(e)?pr:"object"==typeof e?ea.test(e)?sr:hr:ir}function pr(e,n){const t=[...e],i=t.length,a=e.map((e,t)=>mr(e)(e,n[t]));return e=>{for(let n=0;n<i;n++)t[n]=a[n](e);return t}}function hr(e,n){const t={...e,...n},i={};for(const a in t)void 0!==e[a]&&void 0!==n[a]&&(i[a]=mr(e[a])(e[a],n[a]));return e=>{for(const n in i)t[n]=i[n](e);return t}}const vr=(e,n)=>{const t=ca.createTransformer(n),i=ra(e),a=ra(n);return i.indexes.var.length===a.indexes.var.length&&i.indexes.color.length===a.indexes.color.length&&i.indexes.number.length>=a.indexes.number.length?ur.has(e)&&!a.values.length||ur.has(n)&&!i.values.length?function(e,n){return ur.has(e)?t=>t<=0?e:n:t=>t>=1?n:e}(e,n):cr(pr(function(e,n){var t;const i=[],a={color:0,var:0,number:0};for(let r=0;r<n.values.length;r++){const o=n.types[r],s=e.indexes[o][a[o]],l=null!==(t=e.values[s])&&void 0!==t?t:0;i[r]=l,a[o]++}return i}(i,a),a.values),t):(za(!0,`Complex values '${e}' and '${n}' too different to mix. Ensure all colors are of the same type, and that each contains the same quantity of number and color values. Falling back to instant transition.`),ir(e,n))};function fr(e,n,t){if("number"==typeof e&&"number"==typeof n&&"number"==typeof t)return nr(e,n,t);return mr(e)(e,n)}function gr(e,n,t){const i=Math.max(n-5,0);return qt(t-e(i),n-i)}const br=100,xr=10,yr=1,kr=0,wr=800,jr=.3,Sr=.3,Cr={granular:.01,default:2},Nr={granular:.005,default:.5},Pr=.01,Mr=10,Er=.05,Lr=1,Dr=.001;function Or({duration:e=wr,bounce:n=jr,velocity:t=kr,mass:i=yr}){let a,r;za(e<=oi(Mr),"Spring duration must be 10 seconds or less");let o=1-n;o=zi(Er,Lr,o),e=zi(Pr,Mr,si(e)),o<1?(a=n=>{const i=n*o,a=i*e,r=i-t,s=zr(n,o),l=Math.exp(-a);return Dr-r/s*l},r=n=>{const i=n*o*e,r=i*t+t,s=Math.pow(o,2)*Math.pow(n,2)*e,l=Math.exp(-i),c=zr(Math.pow(n,2),o);return(-a(n)+Dr>0?-1:1)*((r-s)*l)/c}):(a=n=>Math.exp(-n*e)*((n-t)*e+1)-.001,r=n=>Math.exp(-n*e)*(e*e*(t-n)));const s=function(e,n,t){let i=t;for(let t=1;t<Tr;t++)i-=e(i)/n(i);return i}(a,r,5/e);if(e=oi(e),isNaN(s))return{stiffness:br,damping:xr,duration:e};{const n=Math.pow(s,2)*i;return{stiffness:n,damping:2*o*Math.sqrt(i*n),duration:e}}}const Tr=12;function zr(e,n){return e*Math.sqrt(1-n*n)}const Ar=["duration","bounce"],Ir=["stiffness","damping","mass"];function Rr(e,n){return n.some(n=>void 0!==e[n])}function Br(e=Sr,n=jr){const t="object"!=typeof e?{visualDuration:e,keyframes:[0,1],bounce:n}:e;let{restSpeed:i,restDelta:a}=t;const r=t.keyframes[0],o=t.keyframes[t.keyframes.length-1],s={done:!1,value:r},{stiffness:l,damping:c,mass:u,duration:d,velocity:m,isResolvedFromDuration:p}=function(e){let n={velocity:kr,stiffness:br,damping:xr,mass:yr,isResolvedFromDuration:!1,...e};if(!Rr(e,Ir)&&Rr(e,Ar))if(e.visualDuration){const t=e.visualDuration,i=2*Math.PI/(1.2*t),a=i*i,r=2*zi(.05,1,1-(e.bounce||0))*Math.sqrt(a);n={...n,mass:yr,stiffness:a,damping:r}}else{const t=Or(e);n={...n,...t,mass:yr},n.isResolvedFromDuration=!0}return n}({...t,velocity:-si(t.velocity||0)}),h=m||0,v=c/(2*Math.sqrt(l*u)),f=o-r,g=si(Math.sqrt(l/u)),b=Math.abs(f)<5;let x;if(i||(i=b?Cr.granular:Cr.default),a||(a=b?Nr.granular:Nr.default),v<1){const e=zr(g,v);x=n=>{const t=Math.exp(-v*g*n);return o-t*((h+v*g*f)/e*Math.sin(e*n)+f*Math.cos(e*n))}}else if(1===v)x=e=>o-Math.exp(-g*e)*(f+(h+g*f)*e);else{const e=g*Math.sqrt(v*v-1);x=n=>{const t=Math.exp(-v*g*n),i=Math.min(e*n,300);return o-t*((h+v*g*f)*Math.sinh(i)+e*f*Math.cosh(i))/e}}const y={calculatedDuration:p&&d||null,next:e=>{const n=x(e);if(p)s.done=e>=d;else{let t=0;v<1&&(t=0===e?oi(h):gr(x,e,n));const r=Math.abs(t)<=i,l=Math.abs(o-n)<=a;s.done=r&&l}return s.value=s.done?o:n,s},toString:()=>{const e=Math.min(er(y),Ja),n=fi(n=>y.next(e*n).value,e,30);return e+"ms "+n}};return y}function _r({keyframes:e,velocity:n=0,power:t=.8,timeConstant:i=325,bounceDamping:a=10,bounceStiffness:r=500,modifyTarget:o,min:s,max:l,restDelta:c=.5,restSpeed:u}){const d=e[0],m={done:!1,value:d},p=e=>void 0===s?l:void 0===l||Math.abs(s-e)<Math.abs(l-e)?s:l;let h=t*n;const v=d+h,f=void 0===o?v:o(v);f!==v&&(h=f-d);const g=e=>-h*Math.exp(-e/i),b=e=>f+g(e),x=e=>{const n=g(e),t=b(e);m.done=Math.abs(n)<=c,m.value=m.done?f:t};let y,k;const w=e=>{var n;(n=m.value,void 0!==s&&n<s||void 0!==l&&n>l)&&(y=e,k=Br({keyframes:[m.value,p(m.value)],velocity:gr(b,e,m.value),damping:a,stiffness:r,restDelta:c,restSpeed:u}))};return w(0),{calculatedDuration:null,next:e=>{let n=!1;return k||void 0!==y||(n=!0,x(e),w(e)),void 0!==y&&e>=y?k.next(e-y):(!n&&x(e),m)}}}const Fr=wi(.42,0,1,1),Ur=wi(0,0,.58,1),Vr=wi(.42,0,.58,1),Hr={linear:Tt,easeIn:Fr,easeInOut:Vr,easeOut:Ur,circIn:Ei,circInOut:Di,circOut:Li,backIn:Ni,backInOut:Pi,backOut:Ci,anticipate:Mi},Wr=e=>{if(di(e)){Aa(4===e.length,"Cubic bezier arrays must contain four numerical values.");const[n,t,i,a]=e;return wi(n,t,i,a)}return"string"==typeof e?(Aa(void 0!==Hr[e],`Invalid easing type '${e}'`),Hr[e]):e};function $r(e,n,{clamp:t=!0,ease:i,mixer:a}={}){const r=e.length;if(Aa(r===n.length,"Both input and output ranges must be the same length"),1===r)return()=>n[0];if(2===r&&n[0]===n[1])return()=>n[1];const o=e[0]===e[1];e[0]>e[r-1]&&(e=[...e].reverse(),n=[...n].reverse());const s=function(e,n,t){const i=[],a=t||fr,r=e.length-1;for(let t=0;t<r;t++){let r=a(e[t],e[t+1]);if(n){const e=Array.isArray(n)?n[t]||Tt:n;r=cr(e,r)}i.push(r)}return i}(n,i,a),l=s.length,c=t=>{if(o&&t<e[0])return n[0];let i=0;if(l>1)for(;i<e.length-2&&!(t<e[i+1]);i++);const a=vi(e[i],e[i+1],t);return s[i](a)};return t?n=>c(zi(e[0],e[r-1],n)):c}function qr(e){const n=[0];return function(e,n){const t=e[e.length-1];for(let i=1;i<=n;i++){const a=vi(0,n,i);e.push(nr(t,1,a))}}(n,e.length-1),n}function Yr({duration:e=300,keyframes:n,times:t,ease:i="easeInOut"}){const a=(e=>Array.isArray(e)&&"number"!=typeof e[0])(i)?i.map(Wr):Wr(i),r={done:!1,value:n[0]},o=function(e,n){return e.map(e=>e*n)}(t&&t.length===n.length?t:qr(n),e),s=$r(o,n,{ease:Array.isArray(a)?a:(l=n,c=a,l.map(()=>c||Vr).splice(0,l.length-1))});var l,c;return{calculatedDuration:e,next:n=>(r.value=s(n),r.done=n>=e,r)}}const Kr=e=>{const n=({timestamp:n})=>e(n);return{start:()=>It.update(n,!0),stop:()=>Rt(n),now:()=>Bt.isProcessing?Bt.timestamp:Vt.now()}},Gr={decay:_r,inertia:_r,tween:Yr,keyframes:Yr,spring:Br},Qr=e=>e/100;class Zr extends Xa{constructor(e){super(e),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,"idle"===this.state)return;this.teardown();const{onStop:e}=this.options;e&&e()};const{name:n,motionValue:t,element:i,keyframes:a}=this.options,r=(null==i?void 0:i.KeyframeResolver)||Ta;this.resolver=new r(a,(e,n)=>this.onKeyframesResolved(e,n),n,t,i),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(e){const{type:n="keyframes",repeat:t=0,repeatDelay:i=0,repeatType:a,velocity:r=0}=this.options,o=ci(n)?n:Gr[n]||Yr;let s,l;o!==Yr&&"number"!=typeof e[0]&&(s=cr(Qr,fr(e[0],e[1])),e=[0,100]);const c=o({...this.options,keyframes:e});"mirror"===a&&(l=o({...this.options,keyframes:[...e].reverse(),velocity:-r})),null===c.calculatedDuration&&(c.calculatedDuration=er(c));const{calculatedDuration:u}=c,d=u+i;return{generator:c,mirroredGenerator:l,mapPercentToKeyframes:s,calculatedDuration:u,resolvedDuration:d,totalDuration:d*(t+1)-i}}onPostResolved(){const{autoplay:e=!0}=this.options;this.play(),"paused"!==this.pendingPlayState&&e?this.state=this.pendingPlayState:this.pause()}tick(e,n=!1){const{resolved:t}=this;if(!t){const{keyframes:e}=this.options;return{done:!0,value:e[e.length-1]}}const{finalKeyframe:i,generator:a,mirroredGenerator:r,mapPercentToKeyframes:o,keyframes:s,calculatedDuration:l,totalDuration:c,resolvedDuration:u}=t;if(null===this.startTime)return a.next(0);const{delay:d,repeat:m,repeatType:p,repeatDelay:h,onUpdate:v}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-c/this.speed,this.startTime)),n?this.currentTime=e:null!==this.holdTime?this.currentTime=this.holdTime:this.currentTime=Math.round(e-this.startTime)*this.speed;const f=this.currentTime-d*(this.speed>=0?1:-1),g=this.speed>=0?f<0:f>c;this.currentTime=Math.max(f,0),"finished"===this.state&&null===this.holdTime&&(this.currentTime=c);let b=this.currentTime,x=a;if(m){const e=Math.min(this.currentTime,c)/u;let n=Math.floor(e),t=e%1;!t&&e>=1&&(t=1),1===t&&n--,n=Math.min(n,m+1);Boolean(n%2)&&("reverse"===p?(t=1-t,h&&(t-=h/u)):"mirror"===p&&(x=r)),b=zi(0,1,t)*u}const y=g?{done:!1,value:s[0]}:x.next(b);o&&(y.value=o(y.value));let{done:k}=y;g||null===l||(k=this.speed>=0?this.currentTime>=c:this.currentTime<=0);const w=null===this.holdTime&&("finished"===this.state||"running"===this.state&&k);return w&&void 0!==i&&(y.value=Za(s,this.options,i)),v&&v(y.value),w&&this.finish(),y}get duration(){const{resolved:e}=this;return e?si(e.calculatedDuration):0}get time(){return si(this.currentTime)}set time(e){e=oi(e),this.currentTime=e,null!==this.holdTime||0===this.speed?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.speed)}get speed(){return this.playbackSpeed}set speed(e){const n=this.playbackSpeed!==e;this.playbackSpeed=e,n&&(this.time=si(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved)return void(this.pendingPlayState="running");if(this.isStopped)return;const{driver:e=Kr,onPlay:n,startTime:t}=this.options;this.driver||(this.driver=e(e=>this.tick(e))),n&&n();const i=this.driver.now();null!==this.holdTime?this.startTime=i-this.holdTime:this.startTime?"finished"===this.state&&(this.startTime=i):this.startTime=null!=t?t:this.calcStartTime(),"finished"===this.state&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var e;this._resolved?(this.state="paused",this.holdTime=null!==(e=this.currentTime)&&void 0!==e?e:0):this.pendingPlayState="paused"}complete(){"running"!==this.state&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:e}=this.options;e&&e()}cancel(){null!==this.cancelTime&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}}const Xr=new Set(["opacity","clipPath","filter","transform"]);function Jr(e,n,t,{delay:i=0,duration:a=300,repeat:r=0,repeatType:o="loop",ease:s="easeInOut",times:l}={}){const c={[n]:t};l&&(c.offset=l);const u=yi(s,a);return Array.isArray(u)&&(c.easing=u),e.animate(c,{delay:i,duration:a,easing:Array.isArray(u)?"linear":u,fill:"both",iterations:r+1,direction:"reverse"===o?"alternate":"normal"})}const eo=ti(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));const no={anticipate:Mi,backInOut:Pi,circInOut:Di};class to extends Xa{constructor(e){super(e);const{name:n,motionValue:t,element:i,keyframes:a}=this.options;this.resolver=new Ya(a,(e,n)=>this.onKeyframesResolved(e,n),n,t,i),this.resolver.scheduleResolve()}initPlayback(e,n){let{duration:t=300,times:i,ease:a,type:r,motionValue:o,name:s,startTime:l}=this.options;if(!o.owner||!o.owner.current)return!1;if("string"==typeof a&&hi()&&a in no&&(a=no[a]),function(e){return ci(e.type)||"spring"===e.type||!gi(e.ease)}(this.options)){const{onComplete:n,onUpdate:o,motionValue:s,element:l,...c}=this.options,u=function(e,n){const t=new Zr({...n,keyframes:e,repeat:0,delay:0,isGenerator:!0});let i={done:!1,value:e[0]};const a=[];let r=0;for(;!i.done&&r<2e4;)i=t.sample(r),a.push(i.value),r+=10;return{times:void 0,keyframes:a,duration:r-10,ease:"linear"}}(e,c);1===(e=u.keyframes).length&&(e[1]=e[0]),t=u.duration,i=u.times,a=u.ease,r="keyframes"}const c=Jr(o.owner.current,s,e,{...this.options,duration:t,times:i,ease:a});return c.startTime=null!=l?l:this.calcStartTime(),this.pendingTimeline?(ui(c,this.pendingTimeline),this.pendingTimeline=void 0):c.onfinish=()=>{const{onComplete:t}=this.options;o.set(Za(e,this.options,n)),t&&t(),this.cancel(),this.resolveFinishedPromise()},{animation:c,duration:t,times:i,type:r,ease:a,keyframes:e}}get duration(){const{resolved:e}=this;if(!e)return 0;const{duration:n}=e;return si(n)}get time(){const{resolved:e}=this;if(!e)return 0;const{animation:n}=e;return si(n.currentTime||0)}set time(e){const{resolved:n}=this;if(!n)return;const{animation:t}=n;t.currentTime=oi(e)}get speed(){const{resolved:e}=this;if(!e)return 1;const{animation:n}=e;return n.playbackRate}set speed(e){const{resolved:n}=this;if(!n)return;const{animation:t}=n;t.playbackRate=e}get state(){const{resolved:e}=this;if(!e)return"idle";const{animation:n}=e;return n.playState}get startTime(){const{resolved:e}=this;if(!e)return null;const{animation:n}=e;return n.startTime}attachTimeline(e){if(this._resolved){const{resolved:n}=this;if(!n)return Tt;const{animation:t}=n;ui(t,e)}else this.pendingTimeline=e;return Tt}play(){if(this.isStopped)return;const{resolved:e}=this;if(!e)return;const{animation:n}=e;"finished"===n.playState&&this.updateFinishedPromise(),n.play()}pause(){const{resolved:e}=this;if(!e)return;const{animation:n}=e;n.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,"idle"===this.state)return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:e}=this;if(!e)return;const{animation:n,keyframes:t,duration:i,type:a,ease:r,times:o}=e;if("idle"===n.playState||"finished"===n.playState)return;if(this.time){const{motionValue:e,onUpdate:n,onComplete:s,element:l,...c}=this.options,u=new Zr({...c,keyframes:t,duration:i,type:a,ease:r,times:o,isGenerator:!0}),d=oi(this.time);e.setWithVelocity(u.sample(d-10).value,u.sample(d).value,10)}const{onStop:s}=this.options;s&&s(),this.cancel()}complete(){const{resolved:e}=this;e&&e.animation.finish()}cancel(){const{resolved:e}=this;e&&e.animation.cancel()}static supports(e){const{motionValue:n,name:t,repeatDelay:i,repeatType:a,damping:r,type:o}=e;if(!(n&&n.owner&&n.owner.current instanceof HTMLElement))return!1;const{onUpdate:s,transformTemplate:l}=n.owner.getProps();return eo()&&t&&Xr.has(t)&&!s&&!l&&!i&&"mirror"!==a&&0!==r&&"inertia"!==o}}const io={type:"spring",stiffness:500,damping:25,restSpeed:10},ao={type:"keyframes",duration:.8},ro={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},oo=(e,{keyframes:n})=>n.length>2?ao:Mt.has(e)?e.startsWith("scale")?{type:"spring",stiffness:550,damping:0===n[1]?2*Math.sqrt(550):30,restSpeed:10}:io:ro;const so=(e,n,t,i={},a,r)=>o=>{const s=Nt(i,e)||{},l=s.delay||i.delay||0;let{elapsed:c=0}=i;c-=oi(l);let u={keyframes:Array.isArray(t)?t:[null,t],ease:"easeOut",velocity:n.getVelocity(),...s,delay:-c,onUpdate:e=>{n.set(e),s.onUpdate&&s.onUpdate(e)},onComplete:()=>{o(),s.onComplete&&s.onComplete()},name:e,motionValue:n,element:r?void 0:a};(function({when:e,delay:n,delayChildren:t,staggerChildren:i,staggerDirection:a,repeat:r,repeatType:o,repeatDelay:s,from:l,elapsed:c,...u}){return!!Object.keys(u).length})(s)||(u={...u,...oo(e,u)}),u.duration&&(u.duration=oi(u.duration)),u.repeatDelay&&(u.repeatDelay=oi(u.repeatDelay)),void 0!==u.from&&(u.keyframes[0]=u.from);let d=!1;if((!1===u.type||0===u.duration&&!u.repeatDelay)&&(u.duration=0,0===u.delay&&(d=!0)),(li||Dt)&&(d=!0,u.duration=0,u.delay=0),d&&!r&&void 0!==n.get()){const e=Za(u.keyframes,s);if(void 0!==e)return It.update(()=>{u.onUpdate(e),u.onComplete()}),new ri([])}return!r&&to.supports(u)?new to(u):new Zr(u)};function lo({protectedKeys:e,needsAnimating:n},t){const i=e.hasOwnProperty(t)&&!0!==n[t];return n[t]=!1,i}function co(e,n,{delay:t=0,transitionOverride:i,type:a}={}){var r;let{transition:o=e.getDefaultTransition(),transitionEnd:s,...l}=n;i&&(o=i);const c=[],u=a&&e.animationState&&e.animationState.getState()[a];for(const n in l){const i=e.getValue(n,null!==(r=e.latestValues[n])&&void 0!==r?r:null),a=l[n];if(void 0===a||u&&lo(u,n))continue;const s={delay:t,...Nt(o||{},n)};let d=!1;if(window.MotionHandoffAnimation){const t=ni(e);if(t){const e=window.MotionHandoffAnimation(t,n,It);null!==e&&(s.startTime=e,d=!0)}}Xt(e,n),i.start(so(n,i,a,e.shouldReduceMotion&&Et.has(n)?{type:!1}:s,e,d));const m=i.animation;m&&c.push(m)}return s&&Promise.all(c).then(()=>{It.update(()=>{s&&function(e,n){const t=jt(e,n);let{transitionEnd:i={},transition:a={},...r}=t||{};r={...r,...i};for(const n in r)Qt(e,n,Lt(r[n]))}(e,s)})}),c}function uo(e,n,t={}){var i;const a=jt(e,n,"exit"===t.type?null===(i=e.presenceContext)||void 0===i?void 0:i.custom:void 0);let{transition:r=e.getDefaultTransition()||{}}=a||{};t.transitionOverride&&(r=t.transitionOverride);const o=a?()=>Promise.all(co(e,a,t)):()=>Promise.resolve(),s=e.variantChildren&&e.variantChildren.size?(i=0)=>{const{delayChildren:a=0,staggerChildren:o,staggerDirection:s}=r;return function(e,n,t=0,i=0,a=1,r){const o=[],s=(e.variantChildren.size-1)*i,l=1===a?(e=0)=>e*i:(e=0)=>s-e*i;return Array.from(e.variantChildren).sort(mo).forEach((e,i)=>{e.notify("AnimationStart",n),o.push(uo(e,n,{...r,delay:t+l(i)}).then(()=>e.notify("AnimationComplete",n)))}),Promise.all(o)}(e,n,a+i,o,s,t)}:()=>Promise.resolve(),{when:l}=r;if(l){const[e,n]="beforeChildren"===l?[o,s]:[s,o];return e().then(()=>n())}return Promise.all([o(),s(t.delay)])}function mo(e,n){return e.sortNodePosition(n)}const po=Ct.length;function ho(e){if(!e)return;if(!e.isControllingVariants){const n=e.parent&&ho(e.parent)||{};return void 0!==e.props.initial&&(n.initial=e.props.initial),n}const n={};for(let t=0;t<po;t++){const i=Ct[t],a=e.props[i];(yt(a)||!1===a)&&(n[i]=a)}return n}const vo=[...St].reverse(),fo=St.length;function go(e){return n=>Promise.all(n.map(({animation:n,options:t})=>function(e,n,t={}){let i;if(e.notify("AnimationStart",n),Array.isArray(n)){const a=n.map(n=>uo(e,n,t));i=Promise.all(a)}else if("string"==typeof n)i=uo(e,n,t);else{const a="function"==typeof n?jt(e,n,t.custom):n;i=Promise.all(co(e,a,t))}return i.then(()=>{e.notify("AnimationComplete",n)})}(e,n,t)))}function bo(e){let n=go(e),t=ko(),i=!0;const a=n=>(t,i)=>{var a;const r=jt(e,i,"exit"===n?null===(a=e.presenceContext)||void 0===a?void 0:a.custom:void 0);if(r){const{transition:e,transitionEnd:n,...i}=r;t={...t,...i,...n}}return t};function r(r){const{props:o}=e,s=ho(e.parent)||{},l=[],c=new Set;let u={},d=1/0;for(let n=0;n<fo;n++){const m=vo[n],p=t[m],h=void 0!==o[m]?o[m]:s[m],v=yt(h),f=m===r?p.isActive:null;!1===f&&(d=n);let g=h===s[m]&&h!==o[m]&&v;if(g&&i&&e.manuallyAnimateOnMount&&(g=!1),p.protectedKeys={...u},!p.isActive&&null===f||!h&&!p.prevProp||gt(h)||"boolean"==typeof h)continue;const b=xo(p.prevProp,h);let x=b||m===r&&p.isActive&&!g&&v||n>d&&v,y=!1;const k=Array.isArray(h)?h:[h];let w=k.reduce(a(m),{});!1===f&&(w={});const{prevResolvedValues:j={}}=p,S={...j,...w},C=n=>{x=!0,c.has(n)&&(y=!0,c.delete(n)),p.needsAnimating[n]=!0;const t=e.getValue(n);t&&(t.liveStyle=!1)};for(const e in S){const n=w[e],t=j[e];if(u.hasOwnProperty(e))continue;let i=!1;i=bt(n)&&bt(t)?!xt(n,t):n!==t,i?null!=n?C(e):c.add(e):void 0!==n&&c.has(e)?C(e):p.protectedKeys[e]=!0}p.prevProp=h,p.prevResolvedValues=w,p.isActive&&(u={...u,...w}),i&&e.blockInitialAnimation&&(x=!1);x&&(!(g&&b)||y)&&l.push(...k.map(e=>({animation:e,options:{type:m}})))}if(c.size){const n={};c.forEach(t=>{const i=e.getBaseTarget(t),a=e.getValue(t);a&&(a.liveStyle=!0),n[t]=null!=i?i:null}),l.push({animation:n})}let m=Boolean(l.length);return!i||!1!==o.initial&&o.initial!==o.animate||e.manuallyAnimateOnMount||(m=!1),i=!1,m?n(l):Promise.resolve()}return{animateChanges:r,setActive:function(n,i){var a;if(t[n].isActive===i)return Promise.resolve();null===(a=e.variantChildren)||void 0===a||a.forEach(e=>{var t;return null===(t=e.animationState)||void 0===t?void 0:t.setActive(n,i)}),t[n].isActive=i;const o=r(n);for(const e in t)t[e].protectedKeys={};return o},setAnimateFunction:function(t){n=t(e)},getState:()=>t,reset:()=>{t=ko(),i=!0}}}function xo(e,n){return"string"==typeof n?n!==e:!!Array.isArray(n)&&!xt(n,e)}function yo(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function ko(){return{animate:yo(!0),whileInView:yo(),whileHover:yo(),whileTap:yo(),whileDrag:yo(),whileFocus:yo(),exit:yo()}}class wo{constructor(e){this.isMounted=!1,this.node=e}update(){}}let jo=0;const So={animation:{Feature:class extends wo{constructor(e){super(e),e.animationState||(e.animationState=bo(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();gt(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:n}=this.node.prevProps||{};e!==n&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),null===(e=this.unmountControls)||void 0===e||e.call(this)}}},exit:{Feature:class extends wo{constructor(){super(...arguments),this.id=jo++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:n}=this.node.presenceContext,{isPresent:t}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===t)return;const i=this.node.animationState.setActive("exit",!e);n&&!e&&i.then(()=>n(this.id))}mount(){const{register:e}=this.node.presenceContext||{};e&&(this.unmount=e(this.id))}unmount(){}}}},Co={x:!1,y:!1};function No(){return Co.x||Co.y}const Po=e=>"mouse"===e.pointerType?"number"!=typeof e.button||e.button<=0:!1!==e.isPrimary;function Mo(e,n,t,i={passive:!0}){return e.addEventListener(n,t,i),()=>e.removeEventListener(n,t)}function Eo(e){return{point:{x:e.pageX,y:e.pageY}}}function Lo(e,n,t,i){return Mo(e,n,(e=>n=>Po(n)&&e(n,Eo(n)))(t),i)}const Do=(e,n)=>Math.abs(e-n);class Oo{constructor(e,n,{transformPagePoint:t,contextWindow:i,dragSnapToOrigin:a=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!this.lastMoveEvent||!this.lastMoveEventInfo)return;const e=Ao(this.lastMoveEventInfo,this.history),n=null!==this.startEvent,t=function(e,n){const t=Do(e.x,n.x),i=Do(e.y,n.y);return Math.sqrt(t**2+i**2)}(e.offset,{x:0,y:0})>=3;if(!n&&!t)return;const{point:i}=e,{timestamp:a}=Bt;this.history.push({...i,timestamp:a});const{onStart:r,onMove:o}=this.handlers;n||(r&&r(this.lastMoveEvent,e),this.startEvent=this.lastMoveEvent),o&&o(this.lastMoveEvent,e)},this.handlePointerMove=(e,n)=>{this.lastMoveEvent=e,this.lastMoveEventInfo=To(n,this.transformPagePoint),It.update(this.updatePoint,!0)},this.handlePointerUp=(e,n)=>{this.end();const{onEnd:t,onSessionEnd:i,resumeAnimation:a}=this.handlers;if(this.dragSnapToOrigin&&a&&a(),!this.lastMoveEvent||!this.lastMoveEventInfo)return;const r=Ao("pointercancel"===e.type?this.lastMoveEventInfo:To(n,this.transformPagePoint),this.history);this.startEvent&&t&&t(e,r),i&&i(e,r)},!Po(e))return;this.dragSnapToOrigin=a,this.handlers=n,this.transformPagePoint=t,this.contextWindow=i||window;const r=To(Eo(e),this.transformPagePoint),{point:o}=r,{timestamp:s}=Bt;this.history=[{...o,timestamp:s}];const{onSessionStart:l}=n;l&&l(e,Ao(r,this.history)),this.removeListeners=cr(Lo(this.contextWindow,"pointermove",this.handlePointerMove),Lo(this.contextWindow,"pointerup",this.handlePointerUp),Lo(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),Rt(this.updatePoint)}}function To(e,n){return n?{point:n(e.point)}:e}function zo(e,n){return{x:e.x-n.x,y:e.y-n.y}}function Ao({point:e},n){return{point:e,delta:zo(e,Ro(n)),offset:zo(e,Io(n)),velocity:Bo(n,.1)}}function Io(e){return e[0]}function Ro(e){return e[e.length-1]}function Bo(e,n){if(e.length<2)return{x:0,y:0};let t=e.length-1,i=null;const a=Ro(e);for(;t>=0&&(i=e[t],!(a.timestamp-i.timestamp>oi(n)));)t--;if(!i)return{x:0,y:0};const r=si(a.timestamp-i.timestamp);if(0===r)return{x:0,y:0};const o={x:(a.x-i.x)/r,y:(a.y-i.y)/r};return o.x===1/0&&(o.x=0),o.y===1/0&&(o.y=0),o}function _o(e){return e&&"object"==typeof e&&Object.prototype.hasOwnProperty.call(e,"current")}function Fo(e){return e.max-e.min}function Uo(e,n,t,i=.5){e.origin=i,e.originPoint=nr(n.min,n.max,e.origin),e.scale=Fo(t)/Fo(n),e.translate=nr(t.min,t.max,e.origin)-e.originPoint,(e.scale>=.9999&&e.scale<=1.0001||isNaN(e.scale))&&(e.scale=1),(e.translate>=-.01&&e.translate<=.01||isNaN(e.translate))&&(e.translate=0)}function Vo(e,n,t,i){Uo(e.x,n.x,t.x,i?i.originX:void 0),Uo(e.y,n.y,t.y,i?i.originY:void 0)}function Ho(e,n,t){e.min=t.min+n.min,e.max=e.min+Fo(n)}function Wo(e,n,t){e.min=n.min-t.min,e.max=e.min+Fo(n)}function $o(e,n,t){Wo(e.x,n.x,t.x),Wo(e.y,n.y,t.y)}function qo(e,n,t){return{min:void 0!==n?e.min+n:void 0,max:void 0!==t?e.max+t-(e.max-e.min):void 0}}function Yo(e,n){let t=n.min-e.min,i=n.max-e.max;return n.max-n.min<e.max-e.min&&([t,i]=[i,t]),{min:t,max:i}}const Ko=.35;function Go(e,n,t){return{min:Qo(e,n),max:Qo(e,t)}}function Qo(e,n){return"number"==typeof e?e:e[n]||0}const Zo=()=>({x:{min:0,max:0},y:{min:0,max:0}});function Xo(e){return[e("x"),e("y")]}function Jo({top:e,left:n,right:t,bottom:i}){return{x:{min:n,max:t},y:{min:e,max:i}}}function es(e){return void 0===e||1===e}function ns({scale:e,scaleX:n,scaleY:t}){return!es(e)||!es(n)||!es(t)}function ts(e){return ns(e)||is(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function is(e){return as(e.x)||as(e.y)}function as(e){return e&&"0%"!==e}function rs(e,n,t){return t+n*(e-t)}function os(e,n,t,i,a){return void 0!==a&&(e=rs(e,a,i)),rs(e,t,i)+n}function ss(e,n=0,t=1,i,a){e.min=os(e.min,n,t,i,a),e.max=os(e.max,n,t,i,a)}function ls(e,{x:n,y:t}){ss(e.x,n.translate,n.scale,n.originPoint),ss(e.y,t.translate,t.scale,t.originPoint)}const cs=.999999999999,us=1.0000000000001;function ds(e,n){e.min=e.min+n,e.max=e.max+n}function ms(e,n,t,i,a=.5){ss(e,n,t,nr(e.min,e.max,a),i)}function ps(e,n){ms(e.x,n.x,n.scaleX,n.scale,n.originX),ms(e.y,n.y,n.scaleY,n.scale,n.originY)}function hs(e,n){return Jo(function(e,n){if(!n)return e;const t=n({x:e.left,y:e.top}),i=n({x:e.right,y:e.bottom});return{top:t.y,left:t.x,bottom:i.y,right:i.x}}(e.getBoundingClientRect(),n))}const vs=({current:e})=>e?e.ownerDocument.defaultView:null,fs=new WeakMap;class gs{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic={x:{min:0,max:0},y:{min:0,max:0}},this.visualElement=e}start(e,{snapToCursor:n=!1}={}){const{presenceContext:t}=this.visualElement;if(t&&!1===t.isPresent)return;const{dragSnapToOrigin:i}=this.getProps();this.panSession=new Oo(e,{onSessionStart:e=>{const{dragSnapToOrigin:t}=this.getProps();t?this.pauseAnimation():this.stopAnimation(),n&&this.snapToCursor(Eo(e).point)},onStart:(e,n)=>{const{drag:t,dragPropagation:i,onDragStart:a}=this.getProps();if(t&&!i&&(this.openDragLock&&this.openDragLock(),this.openDragLock="x"===(r=t)||"y"===r?Co[r]?null:(Co[r]=!0,()=>{Co[r]=!1}):Co.x||Co.y?null:(Co.x=Co.y=!0,()=>{Co.x=Co.y=!1}),!this.openDragLock))return;var r;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Xo(e=>{let n=this.getAxisMotionValue(e).get()||0;if(Ki.test(n)){const{projection:t}=this.visualElement;if(t&&t.layout){const i=t.layout.layoutBox[e];if(i){n=Fo(i)*(parseFloat(n)/100)}}}this.originPoint[e]=n}),a&&It.postRender(()=>a(e,n)),Xt(this.visualElement,"transform");const{animationState:o}=this.visualElement;o&&o.setActive("whileDrag",!0)},onMove:(e,n)=>{const{dragPropagation:t,dragDirectionLock:i,onDirectionLock:a,onDrag:r}=this.getProps();if(!t&&!this.openDragLock)return;const{offset:o}=n;if(i&&null===this.currentDirection)return this.currentDirection=function(e,n=10){let t=null;Math.abs(e.y)>n?t="y":Math.abs(e.x)>n&&(t="x");return t}(o),void(null!==this.currentDirection&&a&&a(this.currentDirection));this.updateAxis("x",n.point,o),this.updateAxis("y",n.point,o),this.visualElement.render(),r&&r(e,n)},onSessionEnd:(e,n)=>this.stop(e,n),resumeAnimation:()=>Xo(e=>{var n;return"paused"===this.getAnimationState(e)&&(null===(n=this.getAxisMotionValue(e).animation)||void 0===n?void 0:n.play())})},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:i,contextWindow:vs(this.visualElement)})}stop(e,n){const t=this.isDragging;if(this.cancel(),!t)return;const{velocity:i}=n;this.startAnimation(i);const{onDragEnd:a}=this.getProps();a&&It.postRender(()=>a(e,n))}cancel(){this.isDragging=!1;const{projection:e,animationState:n}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:t}=this.getProps();!t&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),n&&n.setActive("whileDrag",!1)}updateAxis(e,n,t){const{drag:i}=this.getProps();if(!t||!bs(e,i,this.currentDirection))return;const a=this.getAxisMotionValue(e);let r=this.originPoint[e]+t[e];this.constraints&&this.constraints[e]&&(r=function(e,{min:n,max:t},i){return void 0!==n&&e<n?e=i?nr(n,e,i.min):Math.max(e,n):void 0!==t&&e>t&&(e=i?nr(t,e,i.max):Math.min(e,t)),e}(r,this.constraints[e],this.elastic[e])),a.set(r)}resolveConstraints(){var e;const{dragConstraints:n,dragElastic:t}=this.getProps(),i=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):null===(e=this.visualElement.projection)||void 0===e?void 0:e.layout,a=this.constraints;n&&_o(n)?this.constraints||(this.constraints=this.resolveRefConstraints()):this.constraints=!(!n||!i)&&function(e,{top:n,left:t,bottom:i,right:a}){return{x:qo(e.x,t,a),y:qo(e.y,n,i)}}(i.layoutBox,n),this.elastic=function(e=Ko){return!1===e?e=0:!0===e&&(e=Ko),{x:Go(e,"left","right"),y:Go(e,"top","bottom")}}(t),a!==this.constraints&&i&&this.constraints&&!this.hasMutatedConstraints&&Xo(e=>{!1!==this.constraints&&this.getAxisMotionValue(e)&&(this.constraints[e]=function(e,n){const t={};return void 0!==n.min&&(t.min=n.min-e.min),void 0!==n.max&&(t.max=n.max-e.min),t}(i.layoutBox[e],this.constraints[e]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:n}=this.getProps();if(!e||!_o(e))return!1;const t=e.current;Aa(null!==t,"If `dragConstraints` is set as a React ref, that ref must be passed to another component's `ref` prop.");const{projection:i}=this.visualElement;if(!i||!i.layout)return!1;const a=function(e,n,t){const i=hs(e,t),{scroll:a}=n;return a&&(ds(i.x,a.offset.x),ds(i.y,a.offset.y)),i}(t,i.root,this.visualElement.getTransformPagePoint());let r=function(e,n){return{x:Yo(e.x,n.x),y:Yo(e.y,n.y)}}(i.layout.layoutBox,a);if(n){const e=n(function({x:e,y:n}){return{top:n.min,right:e.max,bottom:n.max,left:e.min}}(r));this.hasMutatedConstraints=!!e,e&&(r=Jo(e))}return r}startAnimation(e){const{drag:n,dragMomentum:t,dragElastic:i,dragTransition:a,dragSnapToOrigin:r,onDragTransitionEnd:o}=this.getProps(),s=this.constraints||{},l=Xo(o=>{if(!bs(o,n,this.currentDirection))return;let l=s&&s[o]||{};r&&(l={min:0,max:0});const c=i?200:1e6,u=i?40:1e7,d={type:"inertia",velocity:t?e[o]:0,bounceStiffness:c,bounceDamping:u,timeConstant:750,restDelta:1,restSpeed:10,...a,...l};return this.startAxisValueAnimation(o,d)});return Promise.all(l).then(o)}startAxisValueAnimation(e,n){const t=this.getAxisMotionValue(e);return Xt(this.visualElement,e),t.start(so(e,t,0,n,this.visualElement,!1))}stopAnimation(){Xo(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){Xo(e=>{var n;return null===(n=this.getAxisMotionValue(e).animation)||void 0===n?void 0:n.pause()})}getAnimationState(e){var n;return null===(n=this.getAxisMotionValue(e).animation)||void 0===n?void 0:n.state}getAxisMotionValue(e){const n=`_drag${e.toUpperCase()}`,t=this.visualElement.getProps(),i=t[n];return i||this.visualElement.getValue(e,(t.initial?t.initial[e]:void 0)||0)}snapToCursor(e){Xo(n=>{const{drag:t}=this.getProps();if(!bs(n,t,this.currentDirection))return;const{projection:i}=this.visualElement,a=this.getAxisMotionValue(n);if(i&&i.layout){const{min:t,max:r}=i.layout.layoutBox[n];a.set(e[n]-nr(t,r,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:n}=this.getProps(),{projection:t}=this.visualElement;if(!_o(n)||!t||!this.constraints)return;this.stopAnimation();const i={x:0,y:0};Xo(e=>{const n=this.getAxisMotionValue(e);if(n&&!1!==this.constraints){const t=n.get();i[e]=function(e,n){let t=.5;const i=Fo(e),a=Fo(n);return a>i?t=vi(n.min,n.max-i,e.min):i>a&&(t=vi(e.min,e.max-a,n.min)),zi(0,1,t)}({min:t,max:t},this.constraints[e])}});const{transformTemplate:a}=this.visualElement.getProps();this.visualElement.current.style.transform=a?a({},""):"none",t.root&&t.root.updateScroll(),t.updateLayout(),this.resolveConstraints(),Xo(n=>{if(!bs(n,e,null))return;const t=this.getAxisMotionValue(n),{min:a,max:r}=this.constraints[n];t.set(nr(a,r,i[n]))})}addListeners(){if(!this.visualElement.current)return;fs.set(this.visualElement,this);const e=Lo(this.visualElement.current,"pointerdown",e=>{const{drag:n,dragListener:t=!0}=this.getProps();n&&t&&this.start(e)}),n=()=>{const{dragConstraints:e}=this.getProps();_o(e)&&e.current&&(this.constraints=this.resolveRefConstraints())},{projection:t}=this.visualElement,i=t.addEventListener("measure",n);t&&!t.layout&&(t.root&&t.root.updateScroll(),t.updateLayout()),It.read(n);const a=Mo(window,"resize",()=>this.scalePositionWithinConstraints()),r=t.addEventListener("didUpdate",({delta:e,hasLayoutChanged:n})=>{this.isDragging&&n&&(Xo(n=>{const t=this.getAxisMotionValue(n);t&&(this.originPoint[n]+=e[n].translate,t.set(t.get()+e[n].translate))}),this.visualElement.render())});return()=>{a(),e(),i(),r&&r()}}getProps(){const e=this.visualElement.getProps(),{drag:n=!1,dragDirectionLock:t=!1,dragPropagation:i=!1,dragConstraints:a=!1,dragElastic:r=Ko,dragMomentum:o=!0}=e;return{...e,drag:n,dragDirectionLock:t,dragPropagation:i,dragConstraints:a,dragElastic:r,dragMomentum:o}}}function bs(e,n,t){return!(!0!==n&&n!==e||null!==t&&t!==e)}const xs=e=>(n,t)=>{e&&It.postRender(()=>e(n,t))};const ys=(0,Ue.createContext)({}),ks={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function ws(e,n){return n.max===n.min?0:e/(n.max-n.min)*100}const js={correct:(e,n)=>{if(!n.target)return e;if("string"==typeof e){if(!Gi.test(e))return e;e=parseFloat(e)}return`${ws(e,n.target.x)}% ${ws(e,n.target.y)}%`}},Ss={correct:(e,{treeScale:n,projectionDelta:t})=>{const i=e,a=ca.parse(e);if(a.length>5)return i;const r=ca.createTransformer(e),o="number"!=typeof a[0]?1:0,s=t.x.scale*n.x,l=t.y.scale*n.y;a[0+o]/=s,a[1+o]/=l;const c=nr(s,l,.5);return"number"==typeof a[2+o]&&(a[2+o]/=c),"number"==typeof a[3+o]&&(a[3+o]/=c),r(a)}},Cs={};const{schedule:Ns,cancel:Ps}=At(queueMicrotask,!1);class Ms extends Ue.Component{componentDidMount(){const{visualElement:e,layoutGroup:n,switchLayoutGroup:t,layoutId:i}=this.props,{projection:a}=e;var r;r=Ls,Object.assign(Cs,r),a&&(n.group&&n.group.add(a),t&&t.register&&i&&t.register(a),a.root.didUpdate(),a.addEventListener("animationComplete",()=>{this.safeToRemove()}),a.setOptions({...a.options,onExitComplete:()=>this.safeToRemove()})),ks.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:n,visualElement:t,drag:i,isPresent:a}=this.props,r=t.projection;return r?(r.isPresent=a,i||e.layoutDependency!==n||void 0===n?r.willUpdate():this.safeToRemove(),e.isPresent!==a&&(a?r.promote():r.relegate()||It.postRender(()=>{const e=r.getStack();e&&e.members.length||this.safeToRemove()})),null):null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),Ns.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:n,switchLayoutGroup:t}=this.props,{projection:i}=e;i&&(i.scheduleCheckAfterUnmount(),n&&n.group&&n.group.remove(i),t&&t.deregister&&t.deregister(i))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function Es(e){const[n,t]=ut(),i=(0,Ue.useContext)(tt);return(0,He.jsx)(Ms,{...e,layoutGroup:i,switchLayoutGroup:(0,Ue.useContext)(ys),isPresent:n,safeToRemove:t})}const Ls={borderRadius:{...js,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:js,borderTopRightRadius:js,borderBottomLeftRadius:js,borderBottomRightRadius:js,boxShadow:Ss};const Ds=(e,n)=>e.depth-n.depth;class Os{constructor(){this.children=[],this.isDirty=!1}add(e){Ht(this.children,e),this.isDirty=!0}remove(e){Wt(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(Ds),this.isDirty=!1,this.children.forEach(e)}}function Ts(e,n){const t=Vt.now(),i=({timestamp:a})=>{const r=a-t;r>=n&&(Rt(i),e(r-n))};return It.read(i,!0),()=>Rt(i)}function zs(e){const n=Zt(e)?e.get():e;return t=n,Boolean(t&&"object"==typeof t&&t.mix&&t.toValue)?n.toValue():n;var t}const As=["TopLeft","TopRight","BottomLeft","BottomRight"],Is=As.length,Rs=e=>"string"==typeof e?parseFloat(e):e,Bs=e=>"number"==typeof e||Gi.test(e);function _s(e,n){return void 0!==e[n]?e[n]:e.borderRadius}const Fs=Vs(0,.5,Li),Us=Vs(.5,.95,Tt);function Vs(e,n,t){return i=>i<e?0:i>n?1:t(vi(e,n,i))}function Hs(e,n){e.min=n.min,e.max=n.max}function Ws(e,n){Hs(e.x,n.x),Hs(e.y,n.y)}function $s(e,n){e.translate=n.translate,e.scale=n.scale,e.originPoint=n.originPoint,e.origin=n.origin}function qs(e,n,t,i,a){return e=rs(e-=n,1/t,i),void 0!==a&&(e=rs(e,1/a,i)),e}function Ys(e,n,[t,i,a],r,o){!function(e,n=0,t=1,i=.5,a,r=e,o=e){Ki.test(n)&&(n=parseFloat(n),n=nr(o.min,o.max,n/100)-o.min);if("number"!=typeof n)return;let s=nr(r.min,r.max,i);e===r&&(s-=n),e.min=qs(e.min,n,t,s,a),e.max=qs(e.max,n,t,s,a)}(e,n[t],n[i],n[a],n.scale,r,o)}const Ks=["x","scaleX","originX"],Gs=["y","scaleY","originY"];function Qs(e,n,t,i){Ys(e.x,n,Ks,t?t.x:void 0,i?i.x:void 0),Ys(e.y,n,Gs,t?t.y:void 0,i?i.y:void 0)}function Zs(e){return 0===e.translate&&1===e.scale}function Xs(e){return Zs(e.x)&&Zs(e.y)}function Js(e,n){return e.min===n.min&&e.max===n.max}function el(e,n){return Math.round(e.min)===Math.round(n.min)&&Math.round(e.max)===Math.round(n.max)}function nl(e,n){return el(e.x,n.x)&&el(e.y,n.y)}function tl(e){return Fo(e.x)/Fo(e.y)}function il(e,n){return e.translate===n.translate&&e.scale===n.scale&&e.originPoint===n.originPoint}class al{constructor(){this.members=[]}add(e){Ht(this.members,e),e.scheduleRender()}remove(e){if(Wt(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const e=this.members[this.members.length-1];e&&this.promote(e)}}relegate(e){const n=this.members.findIndex(n=>e===n);if(0===n)return!1;let t;for(let e=n;e>=0;e--){const n=this.members[e];if(!1!==n.isPresent){t=n;break}}return!!t&&(this.promote(t),!0)}promote(e,n){const t=this.lead;if(e!==t&&(this.prevLead=t,this.lead=e,e.show(),t)){t.instance&&t.scheduleRender(),e.scheduleRender(),e.resumeFrom=t,n&&(e.resumeFrom.preserveOpacity=!0),t.snapshot&&(e.snapshot=t.snapshot,e.snapshot.latestValues=t.animationValues||t.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:i}=e.options;!1===i&&t.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:n,resumingFrom:t}=e;n.onExitComplete&&n.onExitComplete(),t&&t.options.onExitComplete&&t.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}const rl={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},ol="undefined"!=typeof window&&void 0!==window.MotionDebug,sl=["","X","Y","Z"],ll={visibility:"hidden"};let cl=0;function ul(e,n,t,i){const{latestValues:a}=n;a[e]&&(t[e]=a[e],n.setStaticValue(e,0),i&&(i[e]=0))}function dl(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:n}=e.options;if(!n)return;const t=ni(n);if(window.MotionHasOptimisedAnimation(t,"transform")){const{layout:n,layoutId:i}=e.options;window.MotionCancelOptimisedAnimation(t,"transform",It,!(n||i))}const{parent:i}=e;i&&!i.hasCheckedOptimisedAppear&&dl(i)}function ml({attachResizeListener:e,defaultParent:n,measureScroll:t,checkIsScrollRoot:i,resetTransform:a}){return class{constructor(e={},t=(null==n?void 0:n())){this.id=cl++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,ol&&(rl.totalNodes=rl.resolvedTargetDeltas=rl.recalculatedProjection=0),this.nodes.forEach(vl),this.nodes.forEach(wl),this.nodes.forEach(jl),this.nodes.forEach(fl),ol&&window.MotionDebug.record(rl)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=e,this.root=t?t.root||t:this,this.path=t?[...t.path,t]:[],this.parent=t,this.depth=t?t.depth+1:0;for(let e=0;e<this.path.length;e++)this.path[e].shouldResetTransform=!0;this.root===this&&(this.nodes=new Os)}addEventListener(e,n){return this.eventHandlers.has(e)||this.eventHandlers.set(e,new $t),this.eventHandlers.get(e).add(n)}notifyListeners(e,...n){const t=this.eventHandlers.get(e);t&&t.notify(...n)}hasListeners(e){return this.eventHandlers.has(e)}mount(n,t=this.root.hasTreeAnimated){if(this.instance)return;var i;this.isSVG=(i=n)instanceof SVGElement&&"svg"!==i.tagName,this.instance=n;const{layoutId:a,layout:r,visualElement:o}=this.options;if(o&&!o.current&&o.mount(n),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),t&&(r||a)&&(this.isLayoutDirty=!0),e){let t;const i=()=>this.root.updateBlockedByResize=!1;e(n,()=>{this.root.updateBlockedByResize=!0,t&&t(),t=Ts(i,250),ks.hasAnimatedSinceResize&&(ks.hasAnimatedSinceResize=!1,this.nodes.forEach(kl))})}a&&this.root.registerSharedNode(a,this),!1!==this.options.animate&&o&&(a||r)&&this.addEventListener("didUpdate",({delta:e,hasLayoutChanged:n,hasRelativeTargetChanged:t,layout:i})=>{if(this.isTreeAnimationBlocked())return this.target=void 0,void(this.relativeTarget=void 0);const a=this.options.transition||o.getDefaultTransition()||El,{onLayoutAnimationStart:r,onLayoutAnimationComplete:s}=o.getProps(),l=!this.targetLayout||!nl(this.targetLayout,i)||t,c=!n&&t;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||c||n&&(l||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(e,c);const n={...Nt(a,"layout"),onPlay:r,onComplete:s};(o.shouldReduceMotion||this.options.layoutRoot)&&(n.delay=0,n.type=!1),this.startAnimation(n)}else n||kl(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=i})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const e=this.getStack();e&&e.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,Rt(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(Sl),this.animationId++)}getTransformTemplate(){const{visualElement:e}=this.options;return e&&e.getProps().transformTemplate}willUpdate(e=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked())return void(this.options.onExitComplete&&this.options.onExitComplete());if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&dl(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let e=0;e<this.path.length;e++){const n=this.path[e];n.shouldResetTransform=!0,n.updateScroll("snapshot"),n.options.layoutRoot&&n.willUpdate(!1)}const{layoutId:n,layout:t}=this.options;if(void 0===n&&!t)return;const i=this.getTransformTemplate();this.prevTransformTemplateValue=i?i(this.latestValues,""):void 0,this.updateSnapshot(),e&&this.notifyListeners("willUpdate")}update(){this.updateScheduled=!1;if(this.isUpdateBlocked())return this.unblockUpdate(),this.clearAllSnapshots(),void this.nodes.forEach(bl);this.isUpdating||this.nodes.forEach(xl),this.isUpdating=!1,this.nodes.forEach(yl),this.nodes.forEach(pl),this.nodes.forEach(hl),this.clearAllSnapshots();const e=Vt.now();Bt.delta=zi(0,1e3/60,e-Bt.timestamp),Bt.timestamp=e,Bt.isProcessing=!0,_t.update.process(Bt),_t.preRender.process(Bt),_t.render.process(Bt),Bt.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,Ns.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(gl),this.sharedNodes.forEach(Cl)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,It.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){It.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){!this.snapshot&&this.instance&&(this.snapshot=this.measure())}updateLayout(){if(!this.instance)return;if(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead()||this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let e=0;e<this.path.length;e++){this.path[e].updateScroll()}const e=this.layout;this.layout=this.measure(!1),this.layoutCorrected={x:{min:0,max:0},y:{min:0,max:0}},this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:n}=this.options;n&&n.notify("LayoutMeasure",this.layout.layoutBox,e?e.layoutBox:void 0)}updateScroll(e="measure"){let n=Boolean(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===e&&(n=!1),n){const n=i(this.instance);this.scroll={animationId:this.root.animationId,phase:e,isRoot:n,offset:t(this.instance),wasRoot:this.scroll?this.scroll.isRoot:n}}}resetTransform(){if(!a)return;const e=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,n=this.projectionDelta&&!Xs(this.projectionDelta),t=this.getTransformTemplate(),i=t?t(this.latestValues,""):void 0,r=i!==this.prevTransformTemplateValue;e&&(n||ts(this.latestValues)||r)&&(a(this.instance,i),this.shouldResetTransform=!1,this.scheduleRender())}measure(e=!0){const n=this.measurePageBox();let t=this.removeElementScroll(n);var i;return e&&(t=this.removeTransform(t)),Ol((i=t).x),Ol(i.y),{animationId:this.root.animationId,measuredBox:n,layoutBox:t,latestValues:{},source:this.id}}measurePageBox(){var e;const{visualElement:n}=this.options;if(!n)return{x:{min:0,max:0},y:{min:0,max:0}};const t=n.measureViewportBox();if(!((null===(e=this.scroll)||void 0===e?void 0:e.wasRoot)||this.path.some(zl))){const{scroll:e}=this.root;e&&(ds(t.x,e.offset.x),ds(t.y,e.offset.y))}return t}removeElementScroll(e){var n;const t={x:{min:0,max:0},y:{min:0,max:0}};if(Ws(t,e),null===(n=this.scroll)||void 0===n?void 0:n.wasRoot)return t;for(let n=0;n<this.path.length;n++){const i=this.path[n],{scroll:a,options:r}=i;i!==this.root&&a&&r.layoutScroll&&(a.wasRoot&&Ws(t,e),ds(t.x,a.offset.x),ds(t.y,a.offset.y))}return t}applyTransform(e,n=!1){const t={x:{min:0,max:0},y:{min:0,max:0}};Ws(t,e);for(let e=0;e<this.path.length;e++){const i=this.path[e];!n&&i.options.layoutScroll&&i.scroll&&i!==i.root&&ps(t,{x:-i.scroll.offset.x,y:-i.scroll.offset.y}),ts(i.latestValues)&&ps(t,i.latestValues)}return ts(this.latestValues)&&ps(t,this.latestValues),t}removeTransform(e){const n={x:{min:0,max:0},y:{min:0,max:0}};Ws(n,e);for(let e=0;e<this.path.length;e++){const t=this.path[e];if(!t.instance)continue;if(!ts(t.latestValues))continue;ns(t.latestValues)&&t.updateSnapshot();const i=Zo();Ws(i,t.measurePageBox()),Qs(n,t.latestValues,t.snapshot?t.snapshot.layoutBox:void 0,i)}return ts(this.latestValues)&&Qs(n,this.latestValues),n}setTargetDelta(e){this.targetDelta=e,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(e){this.options={...this.options,...e,crossfade:void 0===e.crossfade||e.crossfade}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Bt.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(e=!1){var n;const t=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=t.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=t.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=t.isSharedProjectionDirty);const i=Boolean(this.resumingFrom)||this!==t;if(!(e||i&&this.isSharedProjectionDirty||this.isProjectionDirty||(null===(n=this.parent)||void 0===n?void 0:n.isProjectionDirty)||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:a,layoutId:r}=this.options;if(this.layout&&(a||r)){if(this.resolvedRelativeTargetAt=Bt.timestamp,!this.targetDelta&&!this.relativeTarget){const e=this.getClosestProjectingParent();e&&e.layout&&1!==this.animationProgress?(this.relativeParent=e,this.forceRelativeParentToResolveTarget(),this.relativeTarget={x:{min:0,max:0},y:{min:0,max:0}},this.relativeTargetOrigin={x:{min:0,max:0},y:{min:0,max:0}},$o(this.relativeTargetOrigin,this.layout.layoutBox,e.layout.layoutBox),Ws(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(this.relativeTarget||this.targetDelta){var o,s,l;if(this.target||(this.target={x:{min:0,max:0},y:{min:0,max:0}},this.targetWithTransforms={x:{min:0,max:0},y:{min:0,max:0}}),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),o=this.target,s=this.relativeTarget,l=this.relativeParent.target,Ho(o.x,s.x,l.x),Ho(o.y,s.y,l.y)):this.targetDelta?(Boolean(this.resumingFrom)?this.target=this.applyTransform(this.layout.layoutBox):Ws(this.target,this.layout.layoutBox),ls(this.target,this.targetDelta)):Ws(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const e=this.getClosestProjectingParent();e&&Boolean(e.resumingFrom)===Boolean(this.resumingFrom)&&!e.options.layoutScroll&&e.target&&1!==this.animationProgress?(this.relativeParent=e,this.forceRelativeParentToResolveTarget(),this.relativeTarget={x:{min:0,max:0},y:{min:0,max:0}},this.relativeTargetOrigin={x:{min:0,max:0},y:{min:0,max:0}},$o(this.relativeTargetOrigin,this.target,e.target),Ws(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}ol&&rl.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(this.parent&&!ns(this.parent.latestValues)&&!is(this.parent.latestValues))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return Boolean((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var e;const n=this.getLead(),t=Boolean(this.resumingFrom)||this!==n;let i=!0;if((this.isProjectionDirty||(null===(e=this.parent)||void 0===e?void 0:e.isProjectionDirty))&&(i=!1),t&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(i=!1),this.resolvedRelativeTargetAt===Bt.timestamp&&(i=!1),i)return;const{layout:a,layoutId:r}=this.options;if(this.isTreeAnimating=Boolean(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!a&&!r)return;Ws(this.layoutCorrected,this.layout.layoutBox);const o=this.treeScale.x,s=this.treeScale.y;!function(e,n,t,i=!1){const a=t.length;if(!a)return;let r,o;n.x=n.y=1;for(let s=0;s<a;s++){r=t[s],o=r.projectionDelta;const{visualElement:a}=r.options;a&&a.props.style&&"contents"===a.props.style.display||(i&&r.options.layoutScroll&&r.scroll&&r!==r.root&&ps(e,{x:-r.scroll.offset.x,y:-r.scroll.offset.y}),o&&(n.x*=o.x.scale,n.y*=o.y.scale,ls(e,o)),i&&ts(r.latestValues)&&ps(e,r.latestValues))}n.x<us&&n.x>cs&&(n.x=1),n.y<us&&n.y>cs&&(n.y=1)}(this.layoutCorrected,this.treeScale,this.path,t),!n.layout||n.target||1===this.treeScale.x&&1===this.treeScale.y||(n.target=n.layout.layoutBox,n.targetWithTransforms={x:{min:0,max:0},y:{min:0,max:0}});const{target:l}=n;l?(this.projectionDelta&&this.prevProjectionDelta?($s(this.prevProjectionDelta.x,this.projectionDelta.x),$s(this.prevProjectionDelta.y,this.projectionDelta.y)):this.createProjectionDeltas(),Vo(this.projectionDelta,this.layoutCorrected,l,this.latestValues),this.treeScale.x===o&&this.treeScale.y===s&&il(this.projectionDelta.x,this.prevProjectionDelta.x)&&il(this.projectionDelta.y,this.prevProjectionDelta.y)||(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",l)),ol&&rl.recalculatedProjection++):this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender())}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(e=!0){var n;if(null===(n=this.options.visualElement)||void 0===n||n.scheduleRender(),e){const e=this.getStack();e&&e.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}},this.projectionDelta={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}},this.projectionDeltaWithTransform={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}}}setAnimationOrigin(e,n=!1){const t=this.snapshot,i=t?t.latestValues:{},a={...this.latestValues},r={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};this.relativeParent&&this.relativeParent.options.layoutRoot||(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!n;const o={x:{min:0,max:0},y:{min:0,max:0}},s=(t?t.source:void 0)!==(this.layout?this.layout.source:void 0),l=this.getStack(),c=!l||l.members.length<=1,u=Boolean(s&&!c&&!0===this.options.crossfade&&!this.path.some(Ml));let d;this.animationProgress=0,this.mixTargetDelta=n=>{const t=n/1e3;var l,m,p,h,v,f;Nl(r.x,e.x,t),Nl(r.y,e.y,t),this.setTargetDelta(r),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&($o(o,this.layout.layoutBox,this.relativeParent.layout.layoutBox),p=this.relativeTarget,h=this.relativeTargetOrigin,v=o,f=t,Pl(p.x,h.x,v.x,f),Pl(p.y,h.y,v.y,f),d&&(l=this.relativeTarget,m=d,Js(l.x,m.x)&&Js(l.y,m.y))&&(this.isProjectionDirty=!1),d||(d={x:{min:0,max:0},y:{min:0,max:0}}),Ws(d,this.relativeTarget)),s&&(this.animationValues=a,function(e,n,t,i,a,r){a?(e.opacity=nr(0,void 0!==t.opacity?t.opacity:1,Fs(i)),e.opacityExit=nr(void 0!==n.opacity?n.opacity:1,0,Us(i))):r&&(e.opacity=nr(void 0!==n.opacity?n.opacity:1,void 0!==t.opacity?t.opacity:1,i));for(let a=0;a<Is;a++){const r=`border${As[a]}Radius`;let o=_s(n,r),s=_s(t,r);void 0===o&&void 0===s||(o||(o=0),s||(s=0),0===o||0===s||Bs(o)===Bs(s)?(e[r]=Math.max(nr(Rs(o),Rs(s),i),0),(Ki.test(s)||Ki.test(o))&&(e[r]+="%")):e[r]=s)}(n.rotate||t.rotate)&&(e.rotate=nr(n.rotate||0,t.rotate||0,i))}(a,i,this.latestValues,t,u,c)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=t},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(e){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(Rt(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=It.update(()=>{ks.hasAnimatedSinceResize=!0,this.currentAnimation=function(e,n,t){const i=Zt(e)?e:Gt(e);return i.start(so("",i,n,t)),i.animation}(0,1e3,{...e,onUpdate:n=>{this.mixTargetDelta(n),e.onUpdate&&e.onUpdate(n)},onComplete:()=>{e.onComplete&&e.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const e=this.getStack();e&&e.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(1e3),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const e=this.getLead();let{targetWithTransforms:n,target:t,layout:i,latestValues:a}=e;if(n&&t&&i){if(this!==e&&this.layout&&i&&Tl(this.options.animationType,this.layout.layoutBox,i.layoutBox)){t=this.target||{x:{min:0,max:0},y:{min:0,max:0}};const n=Fo(this.layout.layoutBox.x);t.x.min=e.target.x.min,t.x.max=t.x.min+n;const i=Fo(this.layout.layoutBox.y);t.y.min=e.target.y.min,t.y.max=t.y.min+i}Ws(n,t),ps(n,a),Vo(this.projectionDeltaWithTransform,this.layoutCorrected,n,a)}}registerSharedNode(e,n){this.sharedNodes.has(e)||this.sharedNodes.set(e,new al);this.sharedNodes.get(e).add(n);const t=n.options.initialPromotionConfig;n.promote({transition:t?t.transition:void 0,preserveFollowOpacity:t&&t.shouldPreserveFollowOpacity?t.shouldPreserveFollowOpacity(n):void 0})}isLead(){const e=this.getStack();return!e||e.lead===this}getLead(){var e;const{layoutId:n}=this.options;return n&&(null===(e=this.getStack())||void 0===e?void 0:e.lead)||this}getPrevLead(){var e;const{layoutId:n}=this.options;return n?null===(e=this.getStack())||void 0===e?void 0:e.prevLead:void 0}getStack(){const{layoutId:e}=this.options;if(e)return this.root.sharedNodes.get(e)}promote({needsReset:e,transition:n,preserveFollowOpacity:t}={}){const i=this.getStack();i&&i.promote(this,t),e&&(this.projectionDelta=void 0,this.needsReset=!0),n&&this.setOptions({transition:n})}relegate(){const e=this.getStack();return!!e&&e.relegate(this)}resetSkewAndRotation(){const{visualElement:e}=this.options;if(!e)return;let n=!1;const{latestValues:t}=e;if((t.z||t.rotate||t.rotateX||t.rotateY||t.rotateZ||t.skewX||t.skewY)&&(n=!0),!n)return;const i={};t.z&&ul("z",e,i,this.animationValues);for(let n=0;n<sl.length;n++)ul(`rotate${sl[n]}`,e,i,this.animationValues),ul(`skew${sl[n]}`,e,i,this.animationValues);e.render();for(const n in i)e.setStaticValue(n,i[n]),this.animationValues&&(this.animationValues[n]=i[n]);e.scheduleRender()}getProjectionStyles(e){var n,t;if(!this.instance||this.isSVG)return;if(!this.isVisible)return ll;const i={visibility:""},a=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,i.opacity="",i.pointerEvents=zs(null==e?void 0:e.pointerEvents)||"",i.transform=a?a(this.latestValues,""):"none",i;const r=this.getLead();if(!this.projectionDelta||!this.layout||!r.target){const n={};return this.options.layoutId&&(n.opacity=void 0!==this.latestValues.opacity?this.latestValues.opacity:1,n.pointerEvents=zs(null==e?void 0:e.pointerEvents)||""),this.hasProjected&&!ts(this.latestValues)&&(n.transform=a?a({},""):"none",this.hasProjected=!1),n}const o=r.animationValues||r.latestValues;this.applyTransformsToTarget(),i.transform=function(e,n,t){let i="";const a=e.x.translate/n.x,r=e.y.translate/n.y,o=(null==t?void 0:t.z)||0;if((a||r||o)&&(i=`translate3d(${a}px, ${r}px, ${o}px) `),1===n.x&&1===n.y||(i+=`scale(${1/n.x}, ${1/n.y}) `),t){const{transformPerspective:e,rotate:n,rotateX:a,rotateY:r,skewX:o,skewY:s}=t;e&&(i=`perspective(${e}px) ${i}`),n&&(i+=`rotate(${n}deg) `),a&&(i+=`rotateX(${a}deg) `),r&&(i+=`rotateY(${r}deg) `),o&&(i+=`skewX(${o}deg) `),s&&(i+=`skewY(${s}deg) `)}const s=e.x.scale*n.x,l=e.y.scale*n.y;return 1===s&&1===l||(i+=`scale(${s}, ${l})`),i||"none"}(this.projectionDeltaWithTransform,this.treeScale,o),a&&(i.transform=a(o,i.transform));const{x:s,y:l}=this.projectionDelta;i.transformOrigin=`${100*s.origin}% ${100*l.origin}% 0`,r.animationValues?i.opacity=r===this?null!==(t=null!==(n=o.opacity)&&void 0!==n?n:this.latestValues.opacity)&&void 0!==t?t:1:this.preserveOpacity?this.latestValues.opacity:o.opacityExit:i.opacity=r===this?void 0!==o.opacity?o.opacity:"":void 0!==o.opacityExit?o.opacityExit:0;for(const e in Cs){if(void 0===o[e])continue;const{correct:n,applyTo:t}=Cs[e],a="none"===i.transform?o[e]:n(o[e],r);if(t){const e=t.length;for(let n=0;n<e;n++)i[t[n]]=a}else i[e]=a}return this.options.layoutId&&(i.pointerEvents=r===this?zs(null==e?void 0:e.pointerEvents)||"":"none"),i}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(e=>{var n;return null===(n=e.currentAnimation)||void 0===n?void 0:n.stop()}),this.root.nodes.forEach(bl),this.root.sharedNodes.clear()}}}function pl(e){e.updateLayout()}function hl(e){var n;const t=(null===(n=e.resumeFrom)||void 0===n?void 0:n.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&t&&e.hasListeners("didUpdate")){const{layoutBox:n,measuredBox:i}=e.layout,{animationType:a}=e.options,r=t.source!==e.layout.source;"size"===a?Xo(e=>{const i=r?t.measuredBox[e]:t.layoutBox[e],a=Fo(i);i.min=n[e].min,i.max=i.min+a}):Tl(a,t.layoutBox,n)&&Xo(i=>{const a=r?t.measuredBox[i]:t.layoutBox[i],o=Fo(n[i]);a.max=a.min+o,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[i].max=e.relativeTarget[i].min+o)});const o={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};Vo(o,n,t.layoutBox);const s={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};r?Vo(s,e.applyTransform(i,!0),t.measuredBox):Vo(s,n,t.layoutBox);const l=!Xs(o);let c=!1;if(!e.resumeFrom){const i=e.getClosestProjectingParent();if(i&&!i.resumeFrom){const{snapshot:a,layout:r}=i;if(a&&r){const o={x:{min:0,max:0},y:{min:0,max:0}};$o(o,t.layoutBox,a.layoutBox);const s={x:{min:0,max:0},y:{min:0,max:0}};$o(s,n,r.layoutBox),nl(o,s)||(c=!0),i.options.layoutRoot&&(e.relativeTarget=s,e.relativeTargetOrigin=o,e.relativeParent=i)}}}e.notifyListeners("didUpdate",{layout:n,snapshot:t,delta:s,layoutDelta:o,hasLayoutChanged:l,hasRelativeTargetChanged:c})}else if(e.isLead()){const{onExitComplete:n}=e.options;n&&n()}e.options.transition=void 0}function vl(e){ol&&rl.totalNodes++,e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=Boolean(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function fl(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function gl(e){e.clearSnapshot()}function bl(e){e.clearMeasurements()}function xl(e){e.isLayoutDirty=!1}function yl(e){const{visualElement:n}=e.options;n&&n.getProps().onBeforeLayoutMeasure&&n.notify("BeforeLayoutMeasure"),e.resetTransform()}function kl(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function wl(e){e.resolveTargetDelta()}function jl(e){e.calcProjection()}function Sl(e){e.resetSkewAndRotation()}function Cl(e){e.removeLeadSnapshot()}function Nl(e,n,t){e.translate=nr(n.translate,0,t),e.scale=nr(n.scale,1,t),e.origin=n.origin,e.originPoint=n.originPoint}function Pl(e,n,t,i){e.min=nr(n.min,t.min,i),e.max=nr(n.max,t.max,i)}function Ml(e){return e.animationValues&&void 0!==e.animationValues.opacityExit}const El={duration:.45,ease:[.4,0,.1,1]},Ll=e=>"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),Dl=Ll("applewebkit/")&&!Ll("chrome/")?Math.round:Tt;function Ol(e){e.min=Dl(e.min),e.max=Dl(e.max)}function Tl(e,n,t){return"position"===e||"preserve-aspect"===e&&(i=tl(n),a=tl(t),r=.2,!(Math.abs(i-a)<=r));var i,a,r}function zl(e){var n;return e!==e.root&&(null===(n=e.scroll)||void 0===n?void 0:n.wasRoot)}const Al=ml({attachResizeListener:(e,n)=>Mo(e,"resize",n),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),Il={current:void 0},Rl=ml({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!Il.current){const e=new Al({});e.mount(window),e.setOptions({layoutScroll:!0}),Il.current=e}return Il.current},resetTransform:(e,n)=>{e.style.transform=void 0!==n?n:"none"},checkIsScrollRoot:e=>Boolean("fixed"===window.getComputedStyle(e).position)}),Bl={pan:{Feature:class extends wo{constructor(){super(...arguments),this.removePointerDownListener=Tt}onPointerDown(e){this.session=new Oo(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:vs(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:n,onPan:t,onPanEnd:i}=this.node.getProps();return{onSessionStart:xs(e),onStart:xs(n),onMove:t,onEnd:(e,n)=>{delete this.session,i&&It.postRender(()=>i(e,n))}}}mount(){this.removePointerDownListener=Lo(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}},drag:{Feature:class extends wo{constructor(e){super(e),this.removeGroupControls=Tt,this.removeListeners=Tt,this.controls=new gs(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Tt}unmount(){this.removeGroupControls(),this.removeListeners()}},ProjectionNode:Rl,MeasureLayout:Es}};function _l(e,n){const t=function(e,n,t){var i;if(e instanceof Element)return[e];if("string"==typeof e){let a=document;n&&(a=n.current);const r=null!==(i=null==t?void 0:t[e])&&void 0!==i?i:a.querySelectorAll(e);return r?Array.from(r):[]}return Array.from(e)}(e),i=new AbortController;return[t,{passive:!0,...n,signal:i.signal},()=>i.abort()]}function Fl(e){return n=>{"touch"===n.pointerType||No()||e(n)}}function Ul(e,n,t){const{props:i}=e;e.animationState&&i.whileHover&&e.animationState.setActive("whileHover","Start"===t);const a=i["onHover"+t];a&&It.postRender(()=>a(n,Eo(n)))}const Vl=(e,n)=>!!n&&(e===n||Vl(e,n.parentElement)),Hl=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);const Wl=new WeakSet;function $l(e){return n=>{"Enter"===n.key&&e(n)}}function ql(e,n){e.dispatchEvent(new PointerEvent("pointer"+n,{isPrimary:!0,bubbles:!0}))}function Yl(e){return Po(e)&&!No()}function Kl(e,n,t={}){const[i,a,r]=_l(e,t),o=e=>{const i=e.currentTarget;if(!Yl(e)||Wl.has(i))return;Wl.add(i);const r=n(e),o=(e,n)=>{window.removeEventListener("pointerup",s),window.removeEventListener("pointercancel",l),Yl(e)&&Wl.has(i)&&(Wl.delete(i),"function"==typeof r&&r(e,{success:n}))},s=e=>{o(e,t.useGlobalTarget||Vl(i,e.target))},l=e=>{o(e,!1)};window.addEventListener("pointerup",s,a),window.addEventListener("pointercancel",l,a)};return i.forEach(e=>{(function(e){return Hl.has(e.tagName)||-1!==e.tabIndex})(e)||null!==e.getAttribute("tabindex")||(e.tabIndex=0);(t.useGlobalTarget?window:e).addEventListener("pointerdown",o,a),e.addEventListener("focus",e=>((e,n)=>{const t=e.currentTarget;if(!t)return;const i=$l(()=>{if(Wl.has(t))return;ql(t,"down");const e=$l(()=>{ql(t,"up")});t.addEventListener("keyup",e,n),t.addEventListener("blur",()=>ql(t,"cancel"),n)});t.addEventListener("keydown",i,n),t.addEventListener("blur",()=>t.removeEventListener("keydown",i),n)})(e,a),a)}),r}function Gl(e,n,t){const{props:i}=e;e.animationState&&i.whileTap&&e.animationState.setActive("whileTap","Start"===t);const a=i["onTap"+("End"===t?"":t)];a&&It.postRender(()=>a(n,Eo(n)))}const Ql=new WeakMap,Zl=new WeakMap,Xl=e=>{const n=Ql.get(e.target);n&&n(e)},Jl=e=>{e.forEach(Xl)};function ec(e,n,t){const i=function({root:e,...n}){const t=e||document;Zl.has(t)||Zl.set(t,{});const i=Zl.get(t),a=JSON.stringify(n);return i[a]||(i[a]=new IntersectionObserver(Jl,{root:e,...n})),i[a]}(n);return Ql.set(e,t),i.observe(e),()=>{Ql.delete(e),i.unobserve(e)}}const nc={some:0,all:1};const tc={inView:{Feature:class extends wo{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:n,margin:t,amount:i="some",once:a}=e,r={root:n?n.current:void 0,rootMargin:t,threshold:"number"==typeof i?i:nc[i]};return ec(this.node.current,r,e=>{const{isIntersecting:n}=e;if(this.isInView===n)return;if(this.isInView=n,a&&!n&&this.hasEnteredView)return;n&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",n);const{onViewportEnter:t,onViewportLeave:i}=this.node.getProps(),r=n?t:i;r&&r(e)})}mount(){this.startObserver()}update(){if("undefined"==typeof IntersectionObserver)return;const{props:e,prevProps:n}=this.node;["amount","margin","root"].some(function({viewport:e={}},{viewport:n={}}={}){return t=>e[t]!==n[t]}(e,n))&&this.startObserver()}unmount(){}}},tap:{Feature:class extends wo{mount(){const{current:e}=this.node;e&&(this.unmount=Kl(e,e=>(Gl(this.node,e,"Start"),(e,{success:n})=>Gl(this.node,e,n?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}},focus:{Feature:class extends wo{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch(n){e=!0}e&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){this.isActive&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=cr(Mo(this.node.current,"focus",()=>this.onFocus()),Mo(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}},hover:{Feature:class extends wo{mount(){const{current:e}=this.node;e&&(this.unmount=function(e,n,t={}){const[i,a,r]=_l(e,t),o=Fl(e=>{const{target:t}=e,i=n(e);if("function"!=typeof i||!t)return;const r=Fl(e=>{i(e),t.removeEventListener("pointerleave",r)});t.addEventListener("pointerleave",r,a)});return i.forEach(e=>{e.addEventListener("pointerenter",o,a)}),r}(e,e=>(Ul(this.node,e,"Start"),e=>Ul(this.node,e,"End"))))}unmount(){}}}},ic={layout:{ProjectionNode:Rl,MeasureLayout:Es}},ac=(0,Ue.createContext)({strict:!1}),rc=(0,Ue.createContext)({});function oc(e){return gt(e.animate)||Ct.some(n=>yt(e[n]))}function sc(e){return Boolean(oc(e)||e.variants)}function lc(e){const{initial:n,animate:t}=function(e,n){if(oc(e)){const{initial:n,animate:t}=e;return{initial:!1===n||yt(n)?n:void 0,animate:yt(t)?t:void 0}}return!1!==e.inherit?n:{}}(e,(0,Ue.useContext)(rc));return(0,Ue.useMemo)(()=>({initial:n,animate:t}),[cc(n),cc(t)])}function cc(e){return Array.isArray(e)?e.join(" "):e}const uc={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},dc={};for(const e in uc)dc[e]={isEnabled:n=>uc[e].some(e=>!!n[e])};const mc=Symbol.for("motionComponentSymbol");function pc(e,n,t){return(0,Ue.useCallback)(i=>{i&&e.onMount&&e.onMount(i),n&&(i?n.mount(i):n.unmount()),t&&("function"==typeof t?t(i):_o(t)&&(t.current=i))},[n])}function hc(e,n,t,i,a){var r,o;const{visualElement:s}=(0,Ue.useContext)(rc),l=(0,Ue.useContext)(ac),c=(0,Ue.useContext)(at),u=(0,Ue.useContext)(rt).reducedMotion,d=(0,Ue.useRef)(null);i=i||l.renderer,!d.current&&i&&(d.current=i(e,{visualState:n,parent:s,props:t,presenceContext:c,blockInitialAnimation:!!c&&!1===c.initial,reducedMotionConfig:u}));const m=d.current,p=(0,Ue.useContext)(ys);!m||m.projection||!a||"html"!==m.type&&"svg"!==m.type||function(e,n,t,i){const{layoutId:a,layout:r,drag:o,dragConstraints:s,layoutScroll:l,layoutRoot:c}=n;e.projection=new t(e.latestValues,n["data-framer-portal-id"]?void 0:vc(e.parent)),e.projection.setOptions({layoutId:a,layout:r,alwaysMeasureLayout:Boolean(o)||s&&_o(s),visualElement:e,animationType:"string"==typeof r?r:"both",initialPromotionConfig:i,layoutScroll:l,layoutRoot:c})}(d.current,t,a,p);const h=(0,Ue.useRef)(!1);(0,Ue.useInsertionEffect)(()=>{m&&h.current&&m.update(t,c)});const v=t[ei],f=(0,Ue.useRef)(Boolean(v)&&!(null===(r=window.MotionHandoffIsComplete)||void 0===r?void 0:r.call(window,v))&&(null===(o=window.MotionHasOptimisedAnimation)||void 0===o?void 0:o.call(window,v)));return ht(()=>{m&&(h.current=!0,window.MotionIsMounted=!0,m.updateFeatures(),Ns.render(m.render),f.current&&m.animationState&&m.animationState.animateChanges())}),(0,Ue.useEffect)(()=>{m&&(!f.current&&m.animationState&&m.animationState.animateChanges(),f.current&&(queueMicrotask(()=>{var e;null===(e=window.MotionHandoffMarkAsComplete)||void 0===e||e.call(window,v)}),f.current=!1))}),m}function vc(e){if(e)return!1!==e.options.allowProjection?e.projection:vc(e.parent)}function fc({preloadedFeatures:e,createVisualElement:n,useRender:t,useVisualState:i,Component:a}){var r,o;function s(e,r){let o;const s={...(0,Ue.useContext)(rt),...e,layoutId:gc(e)},{isStatic:l}=s,c=lc(e),u=i(e,l);if(!l&&pt){!function(){(0,Ue.useContext)(ac).strict;0}();const e=function(e){const{drag:n,layout:t}=dc;if(!n&&!t)return{};const i={...n,...t};return{MeasureLayout:(null==n?void 0:n.isEnabled(e))||(null==t?void 0:t.isEnabled(e))?i.MeasureLayout:void 0,ProjectionNode:i.ProjectionNode}}(s);o=e.MeasureLayout,c.visualElement=hc(a,u,s,n,e.ProjectionNode)}return(0,He.jsxs)(rc.Provider,{value:c,children:[o&&c.visualElement?(0,He.jsx)(o,{visualElement:c.visualElement,...s}):null,t(a,e,pc(u,c.visualElement,r),u,l,c.visualElement)]})}e&&function(e){for(const n in e)dc[n]={...dc[n],...e[n]}}(e),s.displayName=`motion.${"string"==typeof a?a:`create(${null!==(o=null!==(r=a.displayName)&&void 0!==r?r:a.name)&&void 0!==o?o:""})`}`;const l=(0,Ue.forwardRef)(s);return l[mc]=a,l}function gc({layoutId:e}){const n=(0,Ue.useContext)(tt).id;return n&&void 0!==e?n+"-"+e:e}const bc=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function xc(e){return"string"==typeof e&&!e.includes("-")&&!!(bc.indexOf(e)>-1||/[A-Z]/u.test(e))}const yc=e=>(n,t)=>{const i=(0,Ue.useContext)(rc),a=(0,Ue.useContext)(at),r=()=>function({scrapeMotionValuesFromProps:e,createRenderState:n,onUpdate:t},i,a,r){const o={latestValues:kc(i,a,r,e),renderState:n()};return t&&(o.onMount=e=>t({props:i,current:e,...o}),o.onUpdate=e=>t(e)),o}(e,n,i,a);return t?r():it(r)};function kc(e,n,t,i){const a={},r=i(e,{});for(const e in r)a[e]=zs(r[e]);let{initial:o,animate:s}=e;const l=oc(e),c=sc(e);n&&c&&!l&&!1!==e.inherit&&(void 0===o&&(o=n.initial),void 0===s&&(s=n.animate));let u=!!t&&!1===t.initial;u=u||!1===o;const d=u?s:o;if(d&&"boolean"!=typeof d&&!gt(d)){const n=Array.isArray(d)?d:[d];for(let t=0;t<n.length;t++){const i=wt(e,n[t]);if(i){const{transitionEnd:e,transition:n,...t}=i;for(const e in t){let n=t[e];if(Array.isArray(n)){n=n[u?n.length-1:0]}null!==n&&(a[e]=n)}for(const n in e)a[n]=e[n]}}}return a}const wc=(e,n)=>n&&"number"==typeof e?n.transform(e):e,jc={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},Sc=Pt.length;function Cc(e,n,t){const{style:i,vars:a,transformOrigin:r}=e;let o=!1,s=!1;for(const e in n){const t=n[e];if(Mt.has(e))o=!0;else if(Ba(e))a[e]=t;else{const n=wc(t,ga[e]);e.startsWith("origin")?(s=!0,r[e]=n):i[e]=n}}if(n.transform||(o||t?i.transform=function(e,n,t){let i="",a=!0;for(let r=0;r<Sc;r++){const o=Pt[r],s=e[o];if(void 0===s)continue;let l=!0;if(l="number"==typeof s?s===(o.startsWith("scale")?1:0):0===parseFloat(s),!l||t){const e=wc(s,ga[o]);l||(a=!1,i+=`${jc[o]||o}(${e}) `),t&&(n[o]=e)}}return i=i.trim(),t?i=t(n,a?"":i):a&&(i="none"),i}(n,e.transform,t):i.transform&&(i.transform="none")),s){const{originX:e="50%",originY:n="50%",originZ:t=0}=r;i.transformOrigin=`${e} ${n} ${t}`}}const Nc={offset:"stroke-dashoffset",array:"stroke-dasharray"},Pc={offset:"strokeDashoffset",array:"strokeDasharray"};function Mc(e,n,t){return"string"==typeof e?e:Gi.transform(n+t*e)}function Ec(e,{attrX:n,attrY:t,attrScale:i,originX:a,originY:r,pathLength:o,pathSpacing:s=1,pathOffset:l=0,...c},u,d){if(Cc(e,c,d),u)return void(e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox));e.attrs=e.style,e.style={};const{attrs:m,style:p,dimensions:h}=e;m.transform&&(h&&(p.transform=m.transform),delete m.transform),h&&(void 0!==a||void 0!==r||p.transform)&&(p.transformOrigin=function(e,n,t){return`${Mc(n,e.x,e.width)} ${Mc(t,e.y,e.height)}`}(h,void 0!==a?a:.5,void 0!==r?r:.5)),void 0!==n&&(m.x=n),void 0!==t&&(m.y=t),void 0!==i&&(m.scale=i),void 0!==o&&function(e,n,t=1,i=0,a=!0){e.pathLength=1;const r=a?Nc:Pc;e[r.offset]=Gi.transform(-i);const o=Gi.transform(n),s=Gi.transform(t);e[r.array]=`${o} ${s}`}(m,o,s,l,!1)}const Lc=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),Dc=()=>({style:{},transform:{},transformOrigin:{},vars:{},attrs:{}}),Oc=e=>"string"==typeof e&&"svg"===e.toLowerCase();function Tc(e,{style:n,vars:t},i,a){Object.assign(e.style,n,a&&a.getProjectionStyles(i));for(const n in t)e.style.setProperty(n,t[n])}const zc=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function Ac(e,n,t,i){Tc(e,n,void 0,i);for(const t in n.attrs)e.setAttribute(zc.has(t)?t:Jt(t),n.attrs[t])}function Ic(e,{layout:n,layoutId:t}){return Mt.has(e)||e.startsWith("origin")||(n||void 0!==t)&&(!!Cs[e]||"opacity"===e)}function Rc(e,n,t){var i;const{style:a}=e,r={};for(const o in a)(Zt(a[o])||n.style&&Zt(n.style[o])||Ic(o,e)||void 0!==(null===(i=null==t?void 0:t.getValue(o))||void 0===i?void 0:i.liveStyle))&&(r[o]=a[o]);return r}function Bc(e,n,t){const i=Rc(e,n,t);for(const t in e)if(Zt(e[t])||Zt(n[t])){i[-1!==Pt.indexOf(t)?"attr"+t.charAt(0).toUpperCase()+t.substring(1):t]=e[t]}return i}const _c=["x","y","width","height","cx","cy","r"],Fc={useVisualState:yc({scrapeMotionValuesFromProps:Bc,createRenderState:Dc,onUpdate:({props:e,prevProps:n,current:t,renderState:i,latestValues:a})=>{if(!t)return;let r=!!e.drag;if(!r)for(const e in a)if(Mt.has(e)){r=!0;break}if(!r)return;let o=!n;if(n)for(let t=0;t<_c.length;t++){const i=_c[t];e[i]!==n[i]&&(o=!0)}o&&It.read(()=>{!function(e,n){try{n.dimensions="function"==typeof e.getBBox?e.getBBox():e.getBoundingClientRect()}catch(e){n.dimensions={x:0,y:0,width:0,height:0}}}(t,i),It.render(()=>{Ec(i,a,Oc(t.tagName),e.transformTemplate),Ac(t,i)})})}})},Uc={useVisualState:yc({scrapeMotionValuesFromProps:Rc,createRenderState:Lc})};function Vc(e,n,t){for(const i in n)Zt(n[i])||Ic(i,t)||(e[i]=n[i])}function Hc(e,n){const t={};return Vc(t,e.style||{},e),Object.assign(t,function({transformTemplate:e},n){return(0,Ue.useMemo)(()=>{const t={style:{},transform:{},transformOrigin:{},vars:{}};return Cc(t,n,e),Object.assign({},t.vars,t.style)},[n])}(e,n)),t}function Wc(e,n){const t={},i=Hc(e,n);return e.drag&&!1!==e.dragListener&&(t.draggable=!1,i.userSelect=i.WebkitUserSelect=i.WebkitTouchCallout="none",i.touchAction=!0===e.drag?"none":"pan-"+("x"===e.drag?"y":"x")),void 0===e.tabIndex&&(e.onTap||e.onTapStart||e.whileTap)&&(t.tabIndex=0),t.style=i,t}const $c=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function qc(e){return e.startsWith("while")||e.startsWith("drag")&&"draggable"!==e||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||$c.has(e)}let Yc=e=>!qc(e);try{(Kc=require("@emotion/is-prop-valid").default)&&(Yc=e=>e.startsWith("on")?!qc(e):Kc(e))}catch(e){}var Kc;function Gc(e,n,t,i){const a=(0,Ue.useMemo)(()=>{const t={style:{},transform:{},transformOrigin:{},vars:{},attrs:{}};return Ec(t,n,Oc(i),e.transformTemplate),{...t.attrs,style:{...t.style}}},[n]);if(e.style){const n={};Vc(n,e.style,e),a.style={...n,...a.style}}return a}function Qc(e=!1){return(n,t,i,{latestValues:a},r)=>{const o=(xc(n)?Gc:Wc)(t,a,r,n),s=function(e,n,t){const i={};for(const a in e)"values"===a&&"object"==typeof e.values||(Yc(a)||!0===t&&qc(a)||!n&&!qc(a)||e.draggable&&a.startsWith("onDrag"))&&(i[a]=e[a]);return i}(t,"string"==typeof n,e),l=n!==Ue.Fragment?{...s,...o,ref:i}:{},{children:c}=t,u=(0,Ue.useMemo)(()=>Zt(c)?c.get():c,[c]);return(0,Ue.createElement)(n,{...l,children:u})}}function Zc(e,n){return function(t,{forwardMotionProps:i}={forwardMotionProps:!1}){return fc({...xc(t)?Fc:Uc,preloadedFeatures:e,useRender:Qc(i),createVisualElement:n,Component:t})}}const Xc={current:null},Jc={current:!1};const eu=[...$a,ea,ca],nu=new WeakMap;const tu=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class iu{scrapeMotionValuesFromProps(e,n,t){return{}}constructor({parent:e,props:n,presenceContext:t,reducedMotionConfig:i,blockInitialAnimation:a,visualState:r},o={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=Ta,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const e=Vt.now();this.renderScheduledAt<e&&(this.renderScheduledAt=e,It.render(this.render,!1,!0))};const{latestValues:s,renderState:l,onUpdate:c}=r;this.onUpdate=c,this.latestValues=s,this.baseTarget={...s},this.initialValues=n.initial?{...s}:{},this.renderState=l,this.parent=e,this.props=n,this.presenceContext=t,this.depth=e?e.depth+1:0,this.reducedMotionConfig=i,this.options=o,this.blockInitialAnimation=Boolean(a),this.isControllingVariants=oc(n),this.isVariantNode=sc(n),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=Boolean(e&&e.current);const{willChange:u,...d}=this.scrapeMotionValuesFromProps(n,{},this);for(const e in d){const n=d[e];void 0!==s[e]&&Zt(n)&&n.set(s[e],!1)}}mount(e){this.current=e,nu.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((e,n)=>this.bindToMotionValue(n,e)),Jc.current||function(){if(Jc.current=!0,pt)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),n=()=>Xc.current=e.matches;e.addListener(n),n()}else Xc.current=!1}(),this.shouldReduceMotion="never"!==this.reducedMotionConfig&&("always"===this.reducedMotionConfig||Xc.current),this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){nu.delete(this.current),this.projection&&this.projection.unmount(),Rt(this.notifyUpdate),Rt(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const n=this.features[e];n&&(n.unmount(),n.isMounted=!1)}this.current=null}bindToMotionValue(e,n){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const t=Mt.has(e),i=n.on("change",n=>{this.latestValues[e]=n,this.props.onUpdate&&It.preRender(this.notifyUpdate),t&&this.projection&&(this.projection.isTransformDirty=!0)}),a=n.on("renderRequest",this.scheduleRender);let r;window.MotionCheckAppearSync&&(r=window.MotionCheckAppearSync(this,e,n)),this.valueSubscriptions.set(e,()=>{i(),a(),r&&r(),n.owner&&n.stop()})}sortNodePosition(e){return this.current&&this.sortInstanceNodePosition&&this.type===e.type?this.sortInstanceNodePosition(this.current,e.current):0}updateFeatures(){let e="animation";for(e in dc){const n=dc[e];if(!n)continue;const{isEnabled:t,Feature:i}=n;if(!this.features[e]&&i&&t(this.props)&&(this.features[e]=new i(this)),this.features[e]){const n=this.features[e];n.isMounted?n.update():(n.mount(),n.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):{x:{min:0,max:0},y:{min:0,max:0}}}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,n){this.latestValues[e]=n}update(e,n){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=n;for(let n=0;n<tu.length;n++){const t=tu[n];this.propEventSubscriptions[t]&&(this.propEventSubscriptions[t](),delete this.propEventSubscriptions[t]);const i=e["on"+t];i&&(this.propEventSubscriptions[t]=this.on(t,i))}this.prevMotionValues=function(e,n,t){for(const i in n){const a=n[i],r=t[i];if(Zt(a))e.addValue(i,a);else if(Zt(r))e.addValue(i,Gt(a,{owner:e}));else if(r!==a)if(e.hasValue(i)){const n=e.getValue(i);!0===n.liveStyle?n.jump(a):n.hasAnimated||n.set(a)}else{const n=e.getStaticValue(i);e.addValue(i,Gt(void 0!==n?n:a,{owner:e}))}}for(const i in t)void 0===n[i]&&e.removeValue(i);return n}(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const n=this.getClosestVariantNode();if(n)return n.variantChildren&&n.variantChildren.add(e),()=>n.variantChildren.delete(e)}addValue(e,n){const t=this.values.get(e);n!==t&&(t&&this.removeValue(e),this.bindToMotionValue(e,n),this.values.set(e,n),this.latestValues[e]=n.get())}removeValue(e){this.values.delete(e);const n=this.valueSubscriptions.get(e);n&&(n(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,n){if(this.props.values&&this.props.values[e])return this.props.values[e];let t=this.values.get(e);return void 0===t&&void 0!==n&&(t=Gt(null===n?void 0:n,{owner:this}),this.addValue(e,t)),t}readValue(e,n){var t;let i=void 0===this.latestValues[e]&&this.current?null!==(t=this.getBaseTargetFromProps(this.props,e))&&void 0!==t?t:this.readValueFromInstance(this.current,e,this.options):this.latestValues[e];var a;return null!=i&&("string"==typeof i&&(Ia(i)||Oi(i))?i=parseFloat(i):(a=i,!eu.find(Wa(a))&&ca.test(n)&&(i=ya(e,n))),this.setBaseTarget(e,Zt(i)?i.get():i)),Zt(i)?i.get():i}setBaseTarget(e,n){this.baseTarget[e]=n}getBaseTarget(e){var n;const{initial:t}=this.props;let i;if("string"==typeof t||"object"==typeof t){const a=wt(this.props,t,null===(n=this.presenceContext)||void 0===n?void 0:n.custom);a&&(i=a[e])}if(t&&void 0!==i)return i;const a=this.getBaseTargetFromProps(this.props,e);return void 0===a||Zt(a)?void 0!==this.initialValues[e]&&void 0===i?void 0:this.baseTarget[e]:a}on(e,n){return this.events[e]||(this.events[e]=new $t),this.events[e].add(n)}notify(e,...n){this.events[e]&&this.events[e].notify(...n)}}class au extends iu{constructor(){super(...arguments),this.KeyframeResolver=Ya}sortInstanceNodePosition(e,n){return 2&e.compareDocumentPosition(n)?1:-1}getBaseTargetFromProps(e,n){return e.style?e.style[n]:void 0}removeValueFromRenderState(e,{vars:n,style:t}){delete n[e],delete t[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;Zt(e)&&(this.childSubscription=e.on("change",e=>{this.current&&(this.current.textContent=`${e}`)}))}}class ru extends au{constructor(){super(...arguments),this.type="html",this.renderInstance=Tc}readValueFromInstance(e,n){if(Mt.has(n)){const e=xa(n);return e&&e.default||0}{const i=(t=e,window.getComputedStyle(t)),a=(Ba(n)?i.getPropertyValue(n):i[n])||0;return"string"==typeof a?a.trim():a}var t}measureInstanceViewportBox(e,{transformPagePoint:n}){return hs(e,n)}build(e,n,t){Cc(e,n,t.transformTemplate)}scrapeMotionValuesFromProps(e,n,t){return Rc(e,n,t)}}class ou extends au{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Zo}getBaseTargetFromProps(e,n){return e[n]}readValueFromInstance(e,n){if(Mt.has(n)){const e=xa(n);return e&&e.default||0}return n=zc.has(n)?n:Jt(n),e.getAttribute(n)}scrapeMotionValuesFromProps(e,n,t){return Bc(e,n,t)}build(e,n,t){Ec(e,n,this.isSVGTag,t.transformTemplate)}renderInstance(e,n,t,i){Ac(e,n,0,i)}mount(e){this.isSVGTag=Oc(e.tagName),super.mount(e)}}const su=(e,n)=>xc(e)?new ou(n):new ru(n,{allowProjection:e!==Ue.Fragment}),lu=ft(Zc({...So,...tc,...Bl,...ic},su)),cu=In("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]),uu=In("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),du=In("bookmark",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]]),mu=In("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),pu=In("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),hu=In("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),vu=In("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),fu=In("sparkles",[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]]),gu=In("wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.106-3.105c.32-.322.863-.22.983.218a6 6 0 0 1-8.259 7.057l-7.91 7.91a1 1 0 0 1-2.999-3l7.91-7.91a6 6 0 0 1 7.057-8.259c.438.12.54.662.219.984z",key:"1ngwbx"}]]),bu=In("layers",[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]]);function xu(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,i)}return t}function yu(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?xu(Object(t),!0).forEach(function(n){ku(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):xu(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function ku(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,n||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const wu=on,ju=[],Su={},Cu={useDefault:!0,xPercent:1,yPercent:1},Nu=()=>wu.getState().presets||Su,Pu=()=>wu.getState().activePresetName,Mu=()=>wu.getState().chimeraMode||!1,Eu=()=>wu.getState().councilMode||!1,Lu=()=>wu.getState().councilMembers||ju,Du=()=>wu.getState().selectedDefinitions||ju,Ou=()=>{var e;return null===(e=wu.getState().showLumiverseDrawer)||void 0===e||e},Tu=()=>{var e;return null!==(e=wu.getState().lumiaButtonPosition)&&void 0!==e?e:Cu},zu={chimera:(0,He.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,He.jsx)("path",{d:"M12 2L2 7l10 5 10-5-10-5z"}),(0,He.jsx)("path",{d:"M2 17l10 5 10-5"}),(0,He.jsx)("path",{d:"M2 12l10 5 10-5"})]}),council:(0,He.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,He.jsx)("path",{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),(0,He.jsx)("circle",{cx:"9",cy:"7",r:"4"}),(0,He.jsx)("path",{d:"M23 21v-2a4 4 0 0 0-3-3.87"}),(0,He.jsx)("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]})},Au={book:(0,He.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,He.jsx)("path",{d:"M4 19.5A2.5 2.5 0 0 1 6.5 17H20"}),(0,He.jsx)("path",{d:"M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"})]}),settings:(0,He.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,He.jsx)("circle",{cx:"12",cy:"12",r:"3"}),(0,He.jsx)("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]}),layers:(0,He.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,He.jsx)("path",{d:"M12 2L2 7l10 5 10-5-10-5z"}),(0,He.jsx)("path",{d:"M2 17l10 5 10-5"}),(0,He.jsx)("path",{d:"M2 12l10 5 10-5"})]}),tools:(0,He.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,He.jsx)("path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"})}),terminal:(0,He.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,He.jsx)("polyline",{points:"4 17 10 11 4 5"}),(0,He.jsx)("line",{x1:"12",y1:"19",x2:"20",y2:"19"})]}),upload:(0,He.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,He.jsx)("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),(0,He.jsx)("polyline",{points:"17 8 12 3 7 8"}),(0,He.jsx)("line",{x1:"12",y1:"3",x2:"12",y2:"15"})]}),box:(0,He.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,He.jsx)("path",{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"}),(0,He.jsx)("polyline",{points:"3.27 6.96 12 12.01 20.73 6.96"}),(0,He.jsx)("line",{x1:"12",y1:"22.08",x2:"12",y2:"12"})]}),plus:(0,He.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,He.jsx)("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),(0,He.jsx)("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),dots:(0,He.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,He.jsx)("circle",{cx:"12",cy:"12",r:"1"}),(0,He.jsx)("circle",{cx:"19",cy:"12",r:"1"}),(0,He.jsx)("circle",{cx:"5",cy:"12",r:"1"})]}),lines:(0,He.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,He.jsx)("line",{x1:"21",y1:"10",x2:"3",y2:"10"}),(0,He.jsx)("line",{x1:"21",y1:"6",x2:"3",y2:"6"}),(0,He.jsx)("line",{x1:"21",y1:"14",x2:"3",y2:"14"}),(0,He.jsx)("line",{x1:"21",y1:"18",x2:"3",y2:"18"})]}),edit:(0,He.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,He.jsx)("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),(0,He.jsx)("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]}),chevronDown:(0,He.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,He.jsx)("polyline",{points:"6 9 12 15 18 9"})}),package:(0,He.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,He.jsx)("line",{x1:"16.5",y1:"9.4",x2:"7.5",y2:"4.21"}),(0,He.jsx)("path",{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"}),(0,He.jsx)("polyline",{points:"3.27 6.96 12 12.01 20.73 6.96"}),(0,He.jsx)("line",{x1:"12",y1:"22.08",x2:"12",y2:"12"})]}),download:(0,He.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,He.jsx)("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),(0,He.jsx)("polyline",{points:"7 10 12 15 17 10"}),(0,He.jsx)("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]})};function Iu(e){let{item:n,packName:t,onEdit:i,editIcon:a}=e;const{objectPosition:r}=Mn(n.lumia_img);return(0,He.jsxs)("div",{className:"lumia-pack-lumia-item",children:[n.lumia_img&&(0,He.jsx)("img",{src:n.lumia_img,alt:"",className:"lumia-pack-lumia-avatar",style:{objectPosition:r},onError:e=>{e.target.style.display="none"}}),(0,He.jsx)("span",{className:"lumia-pack-lumia-name",children:n.lumiaDefName}),(0,He.jsx)("button",{className:"lumia-btn lumia-btn-icon lumia-btn-icon-sm",onClick:()=>i(t,n),title:"Edit Lumia",type:"button",children:a})]})}function Ru(e){let{title:n,icon:t,action:i,collapsible:a,collapsed:r,onToggle:o,children:s}=e;const l=void 0!==r,[c,u]=(0,Ue.useState)(!1),d=l?r:c,m=(0,Ue.useCallback)(()=>{l&&o?o():u(e=>!e)},[l,o]);return(0,He.jsxs)("div",{className:Ln("lumia-panel",a&&d&&"lumia-panel--collapsed"),children:[(0,He.jsxs)("div",{className:Ln("lumia-panel-header",a&&"lumia-panel-header-clickable"),onClick:a?m:void 0,children:[(0,He.jsx)("span",{className:"lumia-panel-icon",children:t}),(0,He.jsx)("span",{className:"lumia-panel-title",children:n}),i&&(0,He.jsx)("span",{className:"lumia-panel-action",onClick:e=>e.stopPropagation(),children:i}),a&&(0,He.jsx)("span",{className:Ln("lumia-panel-chevron",!d&&"lumia-panel-chevron--expanded"),children:Au.chevronDown})]}),a?(0,He.jsx)(nt,{isOpen:!d,className:"lumia-panel-content",duration:200,children:s}):(0,He.jsx)("div",{className:"lumia-panel-content",children:s})]})}function Bu(e){let{title:n,icon:t,children:i}=e;const[a,r]=(0,Ue.useState)(!1);return(0,He.jsxs)("details",{className:"lumia-panel lumia-panel-collapsible",open:a,onToggle:e=>r(e.target.open),children:[(0,He.jsxs)("summary",{className:"lumia-panel-header lumia-panel-header-clickable",children:[(0,He.jsx)("span",{className:"lumia-panel-icon",children:t}),(0,He.jsx)("span",{className:"lumia-panel-title",children:n}),(0,He.jsx)("span",{className:"lumia-panel-chevron",children:Au.chevronDown})]}),(0,He.jsx)("div",{className:"lumia-panel-content lumia-macro-reference",children:i})]})}function _u(e){let{label:n,hint:t,selections:i,dominant:a,modalName:r}=e;const o=un(),s=(null==i?void 0:i.length)||0,l=(0,Ue.useMemo)(()=>{if(0===s)return"No ".concat(n.toLowerCase()," selected");const e=null==a?void 0:a.id,t=(null==a?void 0:a.name)||(null==a?void 0:a.itemName)||(null==a?void 0:a.lumiaDefName);return i.map(n=>{const i=(null==n?void 0:n.name)||(null==n?void 0:n.itemName)||(null==n?void 0:n.lumiaDefName)||"Unknown",r=null==n?void 0:n.id;return a&&(e&&r&&e===r||t&&i&&t===i)?"â˜… ".concat(i):i}).join(", ")},[s,i,n,a]);return(0,He.jsxs)("div",{className:"lumia-selector",children:[(0,He.jsxs)("div",{className:"lumia-selector-header",children:[(0,He.jsx)("span",{className:"lumia-selector-label",children:n}),(0,He.jsx)("span",{className:"lumia-selector-hint",children:t})]}),(0,He.jsxs)("div",{className:"lumia-selector-row",children:[(0,He.jsx)("div",{className:"lumia-selector-value",children:l}),(0,He.jsx)("button",{className:"lumia-btn lumia-btn-sm",onClick:()=>o.openModal(r),type:"button",children:"Select"})]})]})}function Fu(e){let{icon:n,label:t,onClick:i,accent:a=!1}=e;return(0,He.jsxs)("button",{className:Ln("lumia-tool-btn",a&&"lumia-tool-btn-accent"),onClick:i,type:"button",children:[n,(0,He.jsx)("span",{children:t})]})}function Uu(e){let{icon:n,label:t,description:i,checked:a,onChange:r,disabled:o}=e;return(0,He.jsxs)("label",{className:Ln("lumiverse-mode-toggle",o&&"lumiverse-mode-toggle--disabled"),children:[(0,He.jsx)("span",{className:"lumiverse-mode-toggle-icon",children:n}),(0,He.jsxs)("div",{className:"lumiverse-mode-toggle-text",children:[(0,He.jsx)("span",{className:"lumiverse-mode-toggle-label",children:t}),(0,He.jsx)("span",{className:"lumiverse-mode-toggle-description",children:i})]}),(0,He.jsxs)("div",{className:Ln("lumiverse-toggle lumiverse-toggle--sm",a&&"lumiverse-toggle--on"),children:[(0,He.jsx)("input",{type:"checkbox",className:"lumiverse-toggle-input",checked:a,onChange:e=>r(e.target.checked),disabled:o}),(0,He.jsx)("span",{className:"lumiverse-toggle-slider"})]})]})}function Vu(e){let{code:n,description:t}=e;const[i,a]=(0,Ue.useState)(!1),r=(0,Ue.useCallback)(()=>{navigator.clipboard.writeText(n),a(!0),setTimeout(()=>a(!1),1500)},[n]);return(0,He.jsxs)("div",{className:Ln("lumia-macro",i&&"lumia-macro--copied"),onClick:r,title:"Click to copy",children:[(0,He.jsx)("code",{children:n}),(0,He.jsx)("span",{children:i?"Copied!":t})]})}function Hu(e){let{councilMode:n,councilMembers:t,onOpenCouncil:i,actions:a}=e;const[r,o]=(0,Ue.useState)(!1),[s,l]=(0,Ue.useState)(""),[c,u]=(0,Ue.useState)(!1),d=(0,Ue.useSyncExternalStore)(wu.subscribe,Nu,Nu),m=(0,Ue.useSyncExternalStore)(wu.subscribe,Pu,Pu),p=(0,Ue.useMemo)(()=>Object.values(d).sort((e,n)=>{const t=e.updatedAt||e.createdAt||0;return(n.updatedAt||n.createdAt||0)-t}),[d]),h=(0,Ue.useCallback)(()=>{const e=s.trim();e&&(d[e]?"undefined"!=typeof toastr&&toastr.warning('Preset "'.concat(e,'" already exists')):(a.savePreset(e),an(),l(""),o(!1),"undefined"!=typeof toastr&&toastr.success('Preset "'.concat(e,'" saved'))))},[s,d,a]),v=(0,Ue.useCallback)(e=>{a.loadPreset(e),an(),u(!1),"undefined"!=typeof toastr&&toastr.info('Loaded preset "'.concat(e,'"'))},[a]);return(0,He.jsxs)("div",{className:"lumia-quick-actions",children:[(0,He.jsxs)("button",{className:Ln("lumia-quick-action-btn","lumia-quick-action-btn--council",!n&&"lumia-quick-action-btn--disabled"),onClick:n?i:void 0,disabled:!n,type:"button",title:n?"Configure council members":"Enable Council Mode first",children:[(0,He.jsx)(cu,{size:14,strokeWidth:1.5}),(0,He.jsx)("span",{className:"lumia-quick-action-text",children:n?t.length>0?"".concat(t.length," member").concat(1!==t.length?"s":""):"Configure":"Council"})]}),(0,He.jsx)("div",{className:"lumia-quick-action-group",children:r?(0,He.jsxs)("div",{className:"lumia-quick-action-form",children:[(0,He.jsx)("input",{type:"text",className:"lumia-quick-action-input",placeholder:"Preset name...",value:s,onChange:e=>l(e.target.value),onKeyDown:e=>{"Enter"===e.key&&h(),"Escape"===e.key&&(o(!1),l(""))},autoFocus:!0}),(0,He.jsx)("button",{className:"lumia-quick-action-btn lumia-quick-action-btn--primary",onClick:h,disabled:!s.trim(),type:"button",title:"Save preset",children:(0,He.jsx)(pu,{size:14,strokeWidth:2})}),(0,He.jsx)("button",{className:"lumia-quick-action-btn",onClick:()=>{o(!1),l("")},type:"button",title:"Cancel",children:(0,He.jsx)(hu,{size:14,strokeWidth:2})})]}):(0,He.jsxs)(He.Fragment,{children:[(0,He.jsx)("button",{className:"lumia-quick-action-btn lumia-quick-action-btn--primary",onClick:()=>o(!0),title:"Save current configuration as preset",type:"button",children:(0,He.jsx)(uu,{size:14,strokeWidth:2})}),(0,He.jsxs)("div",{className:"lumia-quick-action-dropdown-wrapper",children:[(0,He.jsxs)("button",{className:Ln("lumia-quick-action-btn",m&&"lumia-quick-action-btn--active"),onClick:()=>u(!c),title:m?"Active: ".concat(m):"Load preset",type:"button",children:[(0,He.jsx)(du,{size:14,strokeWidth:1.5}),(0,He.jsx)("span",{className:"lumia-quick-action-text",children:m||"Presets"}),(0,He.jsx)(mu,{size:12,strokeWidth:2,className:Ln("lumia-quick-action-chevron",c&&"lumia-quick-action-chevron--open")})]}),(0,He.jsx)(vt,{children:c&&(0,He.jsx)(lu.div,{className:"lumia-quick-action-dropdown",initial:{opacity:0,y:-8},animate:{opacity:1,y:0},exit:{opacity:0,y:-8},transition:{duration:.15},children:0===p.length?(0,He.jsx)("div",{className:"lumia-quick-action-dropdown-empty",children:"No presets saved"}):p.map(e=>(0,He.jsxs)("button",{className:Ln("lumia-quick-action-dropdown-item",m===e.name&&"lumia-quick-action-dropdown-item--active"),onClick:()=>v(e.name),type:"button",children:[(0,He.jsx)("span",{children:e.name}),m===e.name&&(0,He.jsx)(pu,{size:12,strokeWidth:2})]},e.name))})})]})]})})]})}const Wu=function(){jn();const e=Sn(),n=Cn(),t=un(),{packs:i,customPacks:a,allPacks:r}=Nn(),[o,s]=(0,Ue.useState)(null),[l,c]=(0,Ue.useState)({customPacks:!1,downloadedPacks:!1,loomPacks:!1}),u=(0,Ue.useCallback)(e=>{c(n=>yu(yu({},n),{},{[e]:!n[e]}))},[]),d=(0,Ue.useSyncExternalStore)(wu.subscribe,Mu,Mu),m=(0,Ue.useSyncExternalStore)(wu.subscribe,Eu,Eu),p=(0,Ue.useSyncExternalStore)(wu.subscribe,Lu,Lu),h=(0,Ue.useSyncExternalStore)(wu.subscribe,Du,Du),v=m&&p.length>0,f=(0,Ue.useCallback)(e=>{t.setChimeraMode(e),an()},[t]),g=(0,Ue.useCallback)(e=>{t.setCouncilMode(e),an()},[t]),b=(0,Ue.useCallback)(()=>{t.clearSelections(),an(),"undefined"!=typeof toastr&&toastr.info("All Lumia selections cleared")},[t]),x=(0,Ue.useCallback)(e=>{confirm('Are you sure you want to delete "'.concat(e,'"?'))&&(t.removePack(e),an(),"undefined"!=typeof toastr&&toastr.success('Pack "'.concat(e,'" deleted')))},[t]),y=(0,Ue.useCallback)(e=>{s(n=>n===e?null:e)},[]),k=r.length,w=(0,Ue.useMemo)(()=>r.reduce((e,n)=>{var t;return e+((null===(t=n.items)||void 0===t?void 0:t.length)||0)},0),[r]),j=(0,Ue.useMemo)(()=>i.filter(e=>{var n,t,i,a;return(null===(n=e.loomStyles)||void 0===n?void 0:n.length)>0||((null===(t=e.loomUtils)||void 0===t?void 0:t.length)>0||((null===(i=e.loomRetrofits)||void 0===i?void 0:i.length)>0||!(null===(a=e.items)||void 0===a||!a.some(e=>e.loomCategory))))}),[i]),S=(0,Ue.useCallback)(function(e){if("undefined"!=typeof LumiverseBridge){const a=LumiverseBridge.getCallbacks();if(a&&a[e]){for(var n=arguments.length,t=new Array(n>1?n-1:0),i=1;i<n;i++)t[i-1]=arguments[i];a[e](...t)}}},[]),C=(0,Ue.useCallback)(e=>{var n;const t=null===(n=e.target.files)||void 0===n?void 0:n[0];if(!t)return;console.log("[SettingsPanel] File selected for upload:",t.name);const i=new FileReader;i.onload=e=>{try{const n=JSON.parse(e.target.result);if(console.log("[SettingsPanel] JSON parsed successfully, entries:",n.entries?Object.keys(n.entries).length:"no entries field"),"undefined"!=typeof LumiverseBridge){const e=LumiverseBridge.getCallbacks();console.log("[SettingsPanel] Available callbacks:",e?Object.keys(e).filter(n=>e[n]):"none"),e&&e.handleNewBook?(console.log("[SettingsPanel] Calling handleNewBook..."),e.handleNewBook(n,t.name,!1),e.refreshUIDisplay&&e.refreshUIDisplay(),console.log("[SettingsPanel] Import complete")):(console.error("[SettingsPanel] handleNewBook callback not registered"),"undefined"!=typeof toastr&&toastr.error("Import function not available. Please reload the page."))}else console.error("[SettingsPanel] LumiverseBridge not available"),"undefined"!=typeof toastr&&toastr.error("Bridge not available. Please reload the page.")}catch(e){console.error("[SettingsPanel] Failed to parse JSON:",e),"undefined"!=typeof toastr&&toastr.error("Failed to parse JSON: "+e.message)}},i.onerror=()=>{console.error("[SettingsPanel] Failed to read file"),"undefined"!=typeof toastr&&toastr.error("Failed to read file")},i.readAsText(t),e.target.value=""},[]),N=(0,Ue.useSyncExternalStore)(wu.subscribe,Ou,Ou),P=(0,Ue.useSyncExternalStore)(wu.subscribe,Tu,Tu),M=(0,Ue.useCallback)(e=>{wu.setState({showLumiverseDrawer:e}),an()},[]),E=(0,Ue.useCallback)(e=>{wu.setState({lumiaButtonPosition:yu(yu({},wu.getState().lumiaButtonPosition),{},{useDefault:e})}),an()},[]),L=(0,Ue.useCallback)(e=>{const n=Math.max(0,Math.min(100,parseInt(e,10)||0));wu.setState({lumiaButtonPosition:yu(yu({},wu.getState().lumiaButtonPosition),{},{xPercent:n})}),an()},[]),D=(0,Ue.useCallback)(e=>{const n=Math.max(0,Math.min(100,parseInt(e,10)||0));wu.setState({lumiaButtonPosition:yu(yu({},wu.getState().lumiaButtonPosition),{},{yPercent:n})}),an()},[]);return(0,He.jsxs)("div",{className:"lumia-injector-settings",children:[(0,He.jsx)("div",{className:"lumia-drawer-toggle-container",children:(0,He.jsxs)("label",{className:"lumiverse-toggle-wrapper",children:[(0,He.jsxs)("div",{className:"lumiverse-toggle-text",children:[(0,He.jsx)("span",{className:"lumiverse-toggle-label",children:"Show Lumiverse Drawer"}),(0,He.jsx)("span",{className:"lumiverse-toggle-description",children:"Access quick settings from a slide-out panel"})]}),(0,He.jsxs)("div",{className:Ln("lumiverse-toggle",N&&"lumiverse-toggle--on"),children:[(0,He.jsx)("input",{type:"checkbox",className:"lumiverse-toggle-input",checked:N,onChange:e=>M(e.target.checked)}),(0,He.jsx)("span",{className:"lumiverse-toggle-slider"})]})]})}),N&&(0,He.jsxs)("div",{className:"lumia-button-position-container",children:[(0,He.jsxs)("label",{className:"lumiverse-toggle-wrapper",children:[(0,He.jsxs)("div",{className:"lumiverse-toggle-text",children:[(0,He.jsx)("span",{className:"lumiverse-toggle-label",children:"Custom Button Position"}),(0,He.jsx)("span",{className:"lumiverse-toggle-description",children:"Position the Lumia button anywhere on screen"})]}),(0,He.jsxs)("div",{className:Ln("lumiverse-toggle",!P.useDefault&&"lumiverse-toggle--on"),children:[(0,He.jsx)("input",{type:"checkbox",className:"lumiverse-toggle-input",checked:!P.useDefault,onChange:e=>E(!e.target.checked)}),(0,He.jsx)("span",{className:"lumiverse-toggle-slider"})]})]}),!P.useDefault&&(0,He.jsxs)("div",{className:"lumia-button-position-inputs",children:[(0,He.jsxs)("div",{className:"lumia-position-field",children:[(0,He.jsx)("label",{htmlFor:"lumia-btn-x",children:"X (% from right)"}),(0,He.jsx)("input",{type:"number",id:"lumia-btn-x",className:"lumia-input lumia-input-sm",value:P.xPercent,onChange:e=>L(e.target.value),min:"0",max:"100"})]}),(0,He.jsxs)("div",{className:"lumia-position-field",children:[(0,He.jsx)("label",{htmlFor:"lumia-btn-y",children:"Y (% from top)"}),(0,He.jsx)("input",{type:"number",id:"lumia-btn-y",className:"lumia-input lumia-input-sm",value:P.yPercent,onChange:e=>D(e.target.value),min:"0",max:"100"})]}),(0,He.jsx)("span",{className:"lumia-position-hint",children:"Slide-out animation is disabled with custom positioning"})]})]}),(0,He.jsxs)(Ru,{title:"World Book Source",icon:Au.book,children:[(0,He.jsx)("div",{className:"lumia-status-badge",children:k>0?"".concat(k," pack").concat(1!==k?"s":""," loaded (").concat(w," items)"):"No packs loaded"}),(0,He.jsxs)("div",{className:"lumia-input-row",children:[(0,He.jsx)("input",{type:"text",className:"lumia-input",placeholder:"Enter World Book URL (JSON)",id:"lumia-url-input-react"}),(0,He.jsx)("button",{className:"lumia-btn lumia-btn-primary",onClick:()=>S("fetchWorldBook"),type:"button",children:"Fetch"})]}),(0,He.jsxs)("div",{className:"lumia-source-actions",children:[(0,He.jsx)("div",{className:"lumia-divider-text",children:"or"}),(0,He.jsxs)("button",{className:"lumia-btn lumia-btn-secondary lumia-btn-full",onClick:()=>{var e;return null===(e=document.getElementById("lumia-file-input-react"))||void 0===e?void 0:e.click()},type:"button",children:[Au.upload,"Upload JSON File"]}),(0,He.jsx)("input",{type:"file",id:"lumia-file-input-react",accept:".json",style:{display:"none"},onChange:C}),(0,He.jsx)("div",{className:"lumia-divider-text",children:"or"}),(0,He.jsxs)("button",{className:"lumia-btn lumia-btn-primary lumia-btn-full",onClick:()=>S("showLucidCardsModal"),type:"button",children:[Au.box,"Browse Lucid Cards"]})]})]}),(0,He.jsxs)(Ru,{title:"Lumia Configuration",icon:Au.settings,action:(0,He.jsxs)("button",{className:"lumia-clear-all-btn",onClick:b,title:"Clear all Lumia selections",type:"button",children:[(0,He.jsx)(_n,{size:14,strokeWidth:1.5}),"Clear All"]}),children:[(0,He.jsxs)("div",{className:"lumia-mode-toggles",children:[(0,He.jsx)(Uu,{icon:zu.chimera,label:"Chimera Mode",description:"Fuse multiple physical definitions",checked:d,onChange:f,disabled:m}),(0,He.jsx)(Uu,{icon:zu.council,label:"Council Mode",description:"Multiple independent Lumias",checked:m,onChange:g,disabled:d})]}),(0,He.jsx)(Hu,{councilMode:m,councilMembers:p,onOpenCouncil:()=>t.openModal("councilSelect"),actions:t}),(0,He.jsxs)("div",{className:Ln("lumia-selector-group",v&&"lumia-selector-group--disabled"),children:[(0,He.jsx)(_u,{label:d?"Chimera Definitions":"Definition",hint:d?"Select Multiple":"Select One",selections:d?h:e.definition?[e.definition]:[],modalName:"definitions"}),(0,He.jsx)(_u,{label:"Behaviors",hint:"Select Multiple",selections:e.behaviors,dominant:e.dominantBehavior,modalName:"behaviors"}),(0,He.jsx)(_u,{label:"Personalities",hint:"Select Multiple",selections:e.personalities,dominant:e.dominantPersonality,modalName:"personalities"})]})]}),(0,He.jsx)(Ru,{title:"Loom Configuration",icon:Au.layers,children:(0,He.jsxs)("div",{className:"lumia-selector-group",children:[(0,He.jsx)(_u,{label:"Narrative Style",hint:"Select Multiple",selections:n.styles,modalName:"loomStyles"}),(0,He.jsx)(_u,{label:"Loom Utilities",hint:"Select Multiple",selections:n.utilities,modalName:"loomUtilities"}),(0,He.jsx)(_u,{label:"Retrofits",hint:"Select Multiple",selections:n.retrofits,modalName:"loomRetrofits"})]})}),(0,He.jsx)(Ru,{title:"Tools",icon:Au.tools,children:(0,He.jsxs)("div",{className:"lumia-tools-row",children:[(0,He.jsx)(Fu,{icon:Au.plus,label:"Lumia Editor",onClick:()=>t.openModal("packSelector"),accent:!0}),(0,He.jsx)(Fu,{icon:Au.dots,label:"OOC Settings",onClick:()=>S("showMiscFeaturesModal")}),(0,He.jsx)(Fu,{icon:Au.lines,label:"Summarization",onClick:()=>S("showSummarizationModal")}),(0,He.jsx)(Fu,{icon:Au.edit,label:"Prompt Settings",onClick:()=>S("showPromptSettingsModal")})]})}),(0,He.jsxs)(Bu,{title:"Macro Reference",icon:Au.terminal,children:[(0,He.jsxs)("div",{className:"lumia-macro-group",children:[(0,He.jsx)("div",{className:"lumia-macro-group-title",children:"Lumia Content"}),(0,He.jsxs)("div",{className:"lumia-macro-list",children:[(0,He.jsx)(Vu,{code:"{{lumiaDef}}",description:"Physical Definition"}),(0,He.jsx)(Vu,{code:"{{lumiaBehavior}}",description:"Behavior(s)"}),(0,He.jsx)(Vu,{code:"{{lumiaPersonality}}",description:"Personality(s)"})]})]}),(0,He.jsxs)("div",{className:"lumia-macro-group",children:[(0,He.jsx)("div",{className:"lumia-macro-group-title",children:"Loom Content"}),(0,He.jsxs)("div",{className:"lumia-macro-list",children:[(0,He.jsx)(Vu,{code:"{{loomStyle}}",description:"Narrative Style"}),(0,He.jsx)(Vu,{code:"{{loomUtils}}",description:"Loom Utilities"}),(0,He.jsx)(Vu,{code:"{{loomRetrofits}}",description:"Retrofits"})]})]}),(0,He.jsxs)("div",{className:"lumia-macro-group",children:[(0,He.jsx)("div",{className:"lumia-macro-group-title",children:"Random Lumia"}),(0,He.jsxs)("div",{className:"lumia-macro-list",children:[(0,He.jsx)(Vu,{code:"{{randomLumia}}",description:"Random definition"}),(0,He.jsx)(Vu,{code:"{{randomLumia.pers}}",description:"Random personality"}),(0,He.jsx)(Vu,{code:"{{randomLumia.behav}}",description:"Random behavior"}),(0,He.jsx)(Vu,{code:"{{randomLumia.name}}",description:"Random name"})]})]}),(0,He.jsxs)("div",{className:"lumia-macro-group",children:[(0,He.jsx)("div",{className:"lumia-macro-group-title",children:"Tracking & OOC"}),(0,He.jsxs)("div",{className:"lumia-macro-list",children:[(0,He.jsx)(Vu,{code:"{{lumiaMessageCount}}",description:"Message count"}),(0,He.jsx)(Vu,{code:"{{lumiaOOCTrigger}}",description:"OOC trigger/countdown"})]})]}),(0,He.jsxs)("div",{className:"lumia-macro-group",children:[(0,He.jsx)("div",{className:"lumia-macro-group-title",children:"Summarization"}),(0,He.jsxs)("div",{className:"lumia-macro-list",children:[(0,He.jsx)(Vu,{code:"{{loomSummary}}",description:"Stored summary"}),(0,He.jsx)(Vu,{code:"{{loomSummaryPrompt}}",description:"Summary directive"}),(0,He.jsx)(Vu,{code:"/loom-summarize",description:"Manual trigger"})]})]}),(0,He.jsxs)("div",{className:"lumia-macro-group",children:[(0,He.jsx)("div",{className:"lumia-macro-group-title",children:"Sovereign Hand"}),(0,He.jsxs)("div",{className:"lumia-macro-list",children:[(0,He.jsx)(Vu,{code:"{{loomSovHand}}",description:"Full Sovereign Hand prompt (with user message)"}),(0,He.jsx)(Vu,{code:"{{loomSovHandActive}}",description:"Yes/No status indicator"}),(0,He.jsx)(Vu,{code:"{{loomLastUserMessage}}",description:"Last user message content"}),(0,He.jsx)(Vu,{code:"{{loomLastCharMessage}}",description:"Last character message content"}),(0,He.jsx)(Vu,{code:"{{lastMessageName}}",description:"Name of whoever sent the last message"}),(0,He.jsx)(Vu,{code:"{{loomContinuePrompt}}",description:"Continue-scene prompt when character spoke last"})]})]})]}),a.length>0&&(0,He.jsx)(Ru,{title:"Custom Packs",icon:Au.package,collapsible:!0,collapsed:l.customPacks,onToggle:()=>u("customPacks"),children:(0,He.jsx)("div",{className:"lumia-custom-packs",children:a.map(e=>{var n;const i=e.id||e.name,a=o===i,r=(null===(n=e.items)||void 0===n?void 0:n.filter(e=>e.lumiaDefName))||[];return(0,He.jsxs)(lu.div,{className:Ln("lumia-pack-item-container",a&&"lumia-pack-item-container--expanded"),initial:{opacity:0,y:-10},animate:{opacity:1,y:0},children:[(0,He.jsxs)("div",{className:"lumia-pack-item",children:[(0,He.jsx)("button",{className:"lumia-pack-expand-btn",onClick:()=>y(i),type:"button",title:a?"Collapse":"Expand to see Lumias",children:(0,He.jsx)("span",{className:Ln("lumia-pack-chevron",a&&"lumia-pack-chevron--expanded"),children:Au.chevronDown})}),(0,He.jsx)("span",{className:"lumia-pack-name",onClick:()=>y(i),style:{cursor:"pointer"},children:e.name}),(0,He.jsxs)("span",{className:"lumia-pack-count",children:[r.length," Lumia",1!==r.length?"s":""]}),(0,He.jsx)("button",{className:"lumia-btn lumia-btn-icon",onClick:()=>Gn(e),title:"Export as World Book JSON",type:"button",children:Au.download}),(0,He.jsx)("button",{className:"lumia-btn lumia-btn-icon",onClick:()=>t.openModal("packEditor",{packId:i}),title:"Edit pack",type:"button",children:Au.edit})]}),(0,He.jsx)(nt,{isOpen:a&&r.length>0,className:"lumia-pack-items-list",duration:200,children:r.map((n,i)=>(0,He.jsx)(Iu,{item:n,packName:e.name,onEdit:(e,n)=>t.openModal("lumiaEditor",{packName:e,editingItem:n}),editIcon:Au.edit},n.lumiaDefName||i))}),(0,He.jsx)(nt,{isOpen:a&&0===r.length,className:"lumia-pack-items-empty",duration:200,children:(0,He.jsx)("span",{children:"No Lumias in this pack yet"})})]},i)})})}),i.length>0&&(0,He.jsx)(Ru,{title:"Downloaded Packs",icon:Au.box,collapsible:!0,collapsed:l.downloadedPacks,onToggle:()=>u("downloadedPacks"),children:(0,He.jsx)("div",{className:"lumia-downloaded-packs",children:i.map(e=>{var n;const i=e.name||e.packName||"Unknown Pack",a=(null===(n=e.items)||void 0===n?void 0:n.filter(e=>e.lumiaDefName&&e.lumiaDef))||[];return(0,He.jsxs)("div",{className:"lumia-downloaded-pack-item",children:[e.packCover?(0,He.jsx)("img",{src:e.packCover,alt:i,className:"lumia-downloaded-pack-cover"}):(0,He.jsx)("div",{className:"lumia-downloaded-pack-cover-placeholder",children:Au.package}),(0,He.jsxs)("div",{className:"lumia-downloaded-pack-info",children:[(0,He.jsx)("span",{className:"lumia-downloaded-pack-name",children:i}),(0,He.jsxs)("span",{className:"lumia-downloaded-pack-count",children:[a.length," Lumia",1!==a.length?"s":""]})]}),(0,He.jsxs)("div",{className:"lumia-downloaded-pack-actions",children:[(0,He.jsx)("button",{className:"lumia-btn lumia-btn-icon",onClick:()=>t.openPackDetail(i),title:"View pack contents",type:"button",children:(0,He.jsx)(vu,{size:16,strokeWidth:1.5})}),(0,He.jsx)("button",{className:"lumia-btn lumia-btn-icon lumia-btn-icon-danger",onClick:()=>x(i),title:"Delete pack",type:"button",children:(0,He.jsx)(_n,{size:16,strokeWidth:1.5})})]})]},i)})})}),j.length>0&&(0,He.jsx)(Ru,{title:"Loom Packs",icon:Au.layers,collapsible:!0,collapsed:l.loomPacks,onToggle:()=>u("loomPacks"),children:(0,He.jsx)("div",{className:"lumia-loom-packs",children:j.map(e=>{var n,i,a;const r=e.name||e.packName||"Unknown Pack";let o=(null===(n=e.loomStyles)||void 0===n?void 0:n.length)||0,s=(null===(i=e.loomUtils)||void 0===i?void 0:i.length)||0,l=(null===(a=e.loomRetrofits)||void 0===a?void 0:a.length)||0;return e.items&&e.items.forEach(e=>{const n=e.loomCategory||e.category;"Narrative Style"===n||"loomStyles"===n?o++:"Loom Utilities"===n||"loomUtils"===n?s++:"Retrofits"!==n&&"loomRetrofits"!==n||l++}),(0,He.jsxs)("div",{className:"lumia-loom-pack-item",children:[e.packCover?(0,He.jsx)("img",{src:e.packCover,alt:r,className:"lumia-loom-pack-cover"}):(0,He.jsx)("div",{className:"lumia-loom-pack-cover-placeholder",children:Au.layers}),(0,He.jsxs)("div",{className:"lumia-loom-pack-info",children:[(0,He.jsx)("span",{className:"lumia-loom-pack-name",children:r}),(0,He.jsxs)("div",{className:"lumia-loom-pack-stats",children:[o>0&&(0,He.jsxs)("span",{children:[(0,He.jsx)(fu,{size:10})," ",o]}),s>0&&(0,He.jsxs)("span",{children:[(0,He.jsx)(gu,{size:10})," ",s]}),l>0&&(0,He.jsxs)("span",{children:[(0,He.jsx)(bu,{size:10})," ",l]})]})]}),(0,He.jsxs)("div",{className:"lumia-loom-pack-actions",children:[(0,He.jsx)("button",{className:"lumia-btn lumia-btn-icon",onClick:()=>t.openLoomPackDetail(r),title:"View loom contents",type:"button",children:(0,He.jsx)(vu,{size:16,strokeWidth:1.5})}),(0,He.jsx)("button",{className:"lumia-btn lumia-btn-icon lumia-btn-icon-danger",onClick:()=>x(r),title:"Delete pack",type:"button",children:(0,He.jsx)(_n,{size:16,strokeWidth:1.5})})]})]},r)})})})]})};var $u=t(961);function qu(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,i)}return t}function Yu(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?qu(Object(t),!0).forEach(function(n){Ku(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):qu(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Ku(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,n||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const Gu=on,Qu=[],Zu=()=>Gu.getState().chimeraMode||!1,Xu=()=>Gu.getState().selectedDefinitions||Qu,Ju={star:'<svg viewBox="0 0 24 24"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>',check:'<svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"></polyline></svg>',trash:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>',clear:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>',chevron:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>',chevronDown:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>',chevronUp:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="18 15 12 9 6 15"></polyline></svg>',edit:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>',folder:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>',definition:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>',behavior:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path></svg>',personality:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a10 10 0 1 0 10 10H12V2z"></path><path d="M12 2a10 10 0 0 1 10 10"></path><circle cx="12" cy="12" r="6"></circle></svg>',sort:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" y1="6" x2="14" y2="6"></line><line x1="4" y1="12" x2="11" y2="12"></line><line x1="4" y1="18" x2="8" y2="18"></line><polyline points="15 15 18 18 21 15"></polyline><line x1="18" y1="9" x2="18" y2="18"></line></svg>',sparkles:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M19 17v4"/><path d="M3 5h4"/><path d="M17 19h4"/></svg>'};function ed(e){let{name:n,className:t}=e;const i=Ju[n];return i?(0,He.jsx)("span",{className:t,dangerouslySetInnerHTML:{__html:i}}):null}function nd(e){let{item:n,packName:t,isSelected:i,isDominant:a,onSelect:r,onSetDominant:o,onEnableAll:s,showDominant:l,isDefinition:c,animationIndex:u,isEditable:d,onEdit:m}=e;const[p,h]=(0,Ue.useState)(!1),[v,f]=(0,Ue.useState)(!1),g=n.lumiaDefName||"Unknown",b=n.lumia_img,x=function(e){return[!!e.lumiaDef,!!e.lumia_behavior,!!e.lumia_personality].filter(Boolean).length>1}(n),{objectPosition:y}=Mn(b),k=Math.min(30*u,300);return(0,He.jsxs)("div",{className:Ln("lumia-card","lumia-card-appear",c&&"definition-card",i&&"selected"),style:{animationDelay:"".concat(k,"ms")},onClick:e=>{e.target.closest(".lumia-dominant-icon")||e.target.closest(".lumia-edit-icon")||e.target.closest(".lumia-enable-all-icon")||r(n)},"data-pack":t,"data-item":g,children:[(0,He.jsxs)("div",{className:"lumia-card-image",children:[b&&!v?(0,He.jsxs)(He.Fragment,{children:[(0,He.jsx)("img",{src:b,alt:g,loading:"lazy",className:p?"lumia-img-loaded":"",style:{objectPosition:y},onLoad:()=>h(!0),onError:()=>f(!0)}),!p&&(0,He.jsx)("div",{className:"lumia-img-spinner"})]}):(0,He.jsx)("div",{className:"lumia-card-placeholder",children:"?"}),x&&s&&(0,He.jsx)("div",{className:"lumia-enable-all-icon",onClick:e=>{e.stopPropagation(),s&&s(n)},title:"Enable all traits for this Lumia",children:(0,He.jsx)(ed,{name:"sparkles"})}),d&&m&&(0,He.jsx)("div",{className:"lumia-edit-icon",onClick:e=>{e.stopPropagation(),m&&m(n)},title:"Edit this Lumia",children:(0,He.jsx)(ed,{name:"edit"})}),l&&(0,He.jsx)("div",{className:Ln("lumia-dominant-icon",a&&"dominant"),onClick:e=>{e.stopPropagation(),o(n)},title:a?"Remove as dominant":"Set as dominant trait",children:(0,He.jsx)(ed,{name:"star"})}),(0,He.jsx)("div",{className:"lumia-card-check",children:(0,He.jsx)(ed,{name:"check"})})]}),(0,He.jsx)("div",{className:"lumia-card-info",children:(0,He.jsx)("div",{className:"lumia-card-name",children:g})})]})}function td(e){let{pack:n,items:t,isEditable:i,type:a,isSelected:r,isDominant:o,onSelect:s,onSetDominant:l,onEnableAll:c,showDominant:u,onRemovePack:d,onEditItem:m,isCollapsed:p,onToggleCollapse:h}=e;const[v,f]=(0,Ue.useState)(!1),g=void 0!==p,b=g?p:v,x=n.name||n.packName||"Unknown Pack";return(0,He.jsxs)("div",{className:Ln("lumia-modal-panel","lumia-collapsible","lumia-pack-section",b&&"collapsed"),children:[(0,He.jsxs)("div",{className:"lumia-modal-panel-header lumia-collapsible-trigger",onClick:e=>{e.target.closest(".lumia-remove-pack-btn")||(g&&h?h(x):f(!v))},children:[(0,He.jsx)("span",{className:"lumia-panel-collapse-icon",children:(0,He.jsx)(ed,{name:"chevron"})}),(0,He.jsx)("span",{className:"lumia-modal-panel-icon",children:(0,He.jsx)(ed,{name:"folder"})}),(0,He.jsx)("span",{className:"lumia-modal-panel-title",children:x}),i&&(0,He.jsx)("span",{className:"lumia-pack-badge-custom",children:"Custom"}),(0,He.jsxs)("span",{className:"lumia-modal-panel-count",children:[t.length," items"]}),(0,He.jsx)("button",{className:"lumia-icon-btn-sm lumia-remove-pack-btn",onClick:e=>{e.stopPropagation(),d(x)},title:"Remove Pack",children:(0,He.jsx)(ed,{name:"trash"})})]}),(0,He.jsx)("div",{className:"lumia-modal-panel-content lumia-modal-panel-content-cards lumia-collapsible-content",children:(0,He.jsx)("div",{className:"lumia-card-grid",children:t.map((e,n)=>(0,He.jsx)(nd,{item:e,packName:x,isSelected:r(e,x),isDominant:o(e,x),onSelect:e=>s(e,x),onSetDominant:e=>l(e,x),onEnableAll:c?e=>c(e,x):void 0,showDominant:u,isDefinition:"definitions"===a,animationIndex:n,isEditable:i,onEdit:i?e=>m(e,x):void 0},e.lumiaDefName||e.id||n))})})]})}const id=function(e){let{type:n,multiSelect:t=!0,allowDominant:i=!1,onClose:a}=e;const{allPacks:r}=Nn(),o=Sn(),s=un(),l=(0,Ue.useSyncExternalStore)(Gu.subscribe,Zu,Zu),c=(0,Ue.useSyncExternalStore)(Gu.subscribe,Xu,Xu),u=function(e){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];switch(e){case"definitions":return n?{title:"Select Chimera Forms",subtitle:"Choose multiple physical forms to fuse into a Chimera",isMulti:!0,dominantKey:null}:{title:"Select Definition",subtitle:"Choose the physical form for your Lumia",isMulti:!1,dominantKey:null};case"behaviors":return{title:"Select Behaviors",subtitle:"Choose behavioral traits (tap star for dominant)",isMulti:!0,dominantKey:"dominantBehavior"};case"personalities":return{title:"Select Personalities",subtitle:"Choose personality traits (tap star for dominant)",isMulti:!0,dominantKey:"dominantPersonality"};default:return{title:"Select Items",subtitle:"",isMulti:!0,dominantKey:null}}}(n,l),d=function(e){switch(e){case"definitions":default:return"definition";case"behaviors":return"behavior";case"personalities":return"personality"}}(n),m=(0,Ue.useMemo)(()=>{switch(n){case"behaviors":return{selectedItems:o.behaviors||[],dominantItem:o.dominantBehavior,toggleAction:s.toggleBehavior,setDominantAction:s.setDominantBehavior,clearAction:()=>{s.setSelectedBehaviors([]),s.setDominantBehavior(null)}};case"personalities":return{selectedItems:o.personalities||[],dominantItem:o.dominantPersonality,toggleAction:s.togglePersonality,setDominantAction:s.setDominantPersonality,clearAction:()=>{s.setSelectedPersonalities([]),s.setDominantPersonality(null)}};case"definitions":return l?{selectedItems:c,dominantItem:null,toggleAction:s.toggleChimeraDefinition,setDominantAction:null,clearAction:s.clearChimeraDefinitions}:{selectedItems:o.definition?[o.definition]:[],dominantItem:null,toggleAction:e=>{const n=o.definition;n&&n.packName===e.packName&&n.itemName===e.itemName?s.setSelectedDefinition(null):s.setSelectedDefinition(e)},setDominantAction:null,clearAction:()=>s.setSelectedDefinition(null)};default:return{selectedItems:[],dominantItem:null,toggleAction:()=>{},setDominantAction:null,clearAction:()=>{}}}},[n,o,s,l,c]),{selectedItems:p,dominantItem:h,toggleAction:v,setDominantAction:f,clearAction:g}=m;(0,Ue.useEffect)(()=>{const e=setTimeout(()=>{an()},100);return()=>clearTimeout(e)},[p,h]);const[b,x]=(0,Ue.useState)(new Set),[y,k]=(0,Ue.useState)("default"),w=(0,Ue.useMemo)(()=>r.map(e=>{const n=function(e){return(e.items||[]).filter(e=>!e.loomCategory&&!!e.lumiaDefName)}(e);return Yu(Yu({},e),{},{lumiaItems:n,isEditable:e.isCustom||e.isEditable||!1})}).filter(e=>e.lumiaItems.length>0),[r,n]),j=(0,Ue.useMemo)(()=>"default"===y?w:[...w].sort((e,n)=>{if("name"===y){const t=(e.name||e.packName||"").toLowerCase(),i=(n.name||n.packName||"").toLowerCase();return t.localeCompare(i)}if("author"===y){const t=(e.author||"").toLowerCase(),i=(n.author||"").toLowerCase();return t.localeCompare(i)}return 0}),[w,y]),S=(0,Ue.useCallback)(e=>{x(n=>{const t=new Set(n);return t.has(e)?t.delete(e):t.add(e),t})},[]),C=(0,Ue.useCallback)(e=>b.has(e),[b]),N=(0,Ue.useCallback)((e,n)=>{const t=e.lumiaDefName;return p.some(e=>e.packName===n&&e.itemName===t)},[p]),P=(0,Ue.useCallback)((e,n)=>{if(!h)return!1;const t=e.lumiaDefName;return h.packName===n&&h.itemName===t},[h]),M=(0,Ue.useCallback)((e,n)=>{const t={packName:n,itemName:e.lumiaDefName};v(t)},[v]),E=(0,Ue.useCallback)((e,n)=>{if(!f)return;const t={packName:n,itemName:e.lumiaDefName};N(e,n)||v(t),P(e,n)?f(null):f(t)},[f,v,N,P]),L=(0,Ue.useCallback)(()=>{g()},[g]),D=(0,Ue.useCallback)(e=>{window.confirm('Delete pack "'.concat(e,'"? This action cannot be undone.'))&&(s.removeCustomPack(e),an())},[s]),O=(0,Ue.useCallback)((e,n)=>{s.openModal("lumiaEditor",{packName:n,editingItem:e})},[s]),T=(0,Ue.useCallback)((e,n)=>{const t=e.lumiaDefName;t&&(s.enableAllTraitsForLumia(n,t),an())},[s]);return(0,He.jsxs)("div",{className:"lumia-modal-selection-content",children:[(0,He.jsxs)("div",{className:"lumia-modal-header-inner",children:[(0,He.jsx)("div",{className:"lumia-modal-header-icon",children:(0,He.jsx)(ed,{name:d})}),(0,He.jsxs)("div",{className:"lumia-modal-header-text",children:[(0,He.jsx)("h3",{className:"lumia-modal-title",children:u.title}),(0,He.jsx)("p",{className:"lumia-modal-subtitle",children:u.subtitle})]}),(0,He.jsxs)("button",{className:"lumia-clear-btn",onClick:L,title:"Clear all selections",children:[(0,He.jsx)(ed,{name:"clear"}),(0,He.jsx)("span",{children:"Clear"})]})]}),j.length>0&&(0,He.jsxs)("div",{className:"lumia-modal-controls",children:[(0,He.jsxs)("div",{className:"lumia-modal-controls-group",children:[(0,He.jsxs)("button",{className:"lumia-modal-control-btn",onClick:()=>{x(new Set)},title:"Expand all packs",type:"button",children:[(0,He.jsx)(ed,{name:"chevronDown",className:"lumia-control-icon"}),(0,He.jsx)("span",{children:"Expand All"})]}),(0,He.jsxs)("button",{className:"lumia-modal-control-btn",onClick:()=>{const e=w.map(e=>e.name||e.packName);x(new Set(e))},title:"Collapse all packs",type:"button",children:[(0,He.jsx)(ed,{name:"chevronUp",className:"lumia-control-icon"}),(0,He.jsx)("span",{children:"Collapse All"})]})]}),(0,He.jsxs)("div",{className:"lumia-modal-sort",children:[(0,He.jsx)(ed,{name:"sort",className:"lumia-sort-icon"}),(0,He.jsx)("span",{className:"lumia-modal-sort-label",children:"Sort:"}),(0,He.jsxs)("select",{className:"lumia-select",value:y,onChange:e=>k(e.target.value),children:[(0,He.jsx)("option",{value:"default",children:"Default"}),(0,He.jsx)("option",{value:"name",children:"Pack Name"}),(0,He.jsx)("option",{value:"author",children:"Author"})]})]})]}),(0,He.jsx)("div",{className:"lumia-modal-content",children:0===j.length?(0,He.jsx)("div",{className:"lumia-modal-empty",children:"No Lumia Packs loaded. Add one in settings!"}):j.map(e=>{const t=e.name||e.packName;return(0,He.jsx)(td,{pack:e,items:e.lumiaItems,isEditable:e.isEditable,type:n,isSelected:N,isDominant:P,onSelect:M,onSetDominant:E,onEnableAll:T,showDominant:i&&u.isMulti,onRemovePack:D,onEditItem:O,isCollapsed:C(t),onToggleCollapse:S},e.id||t)})}),(0,He.jsxs)("div",{className:"lumia-modal-footer",children:[(0,He.jsx)("button",{className:"lumia-modal-btn lumia-modal-btn-secondary lumia-modal-close-btn",onClick:a,children:"Close"}),u.isMulti&&(0,He.jsx)("button",{className:"lumia-modal-btn lumia-modal-btn-primary lumia-modal-done",onClick:a,children:"Done"})]})]})};function ad(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,i)}return t}function rd(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?ad(Object(t),!0).forEach(function(n){od(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ad(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function od(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,n||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const sd={trash:'<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>',chevronDown:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>',chevronUp:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="18 15 12 9 6 15"></polyline></svg>',chevron:'<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>',folder:'<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>',search:'<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>',sort:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" y1="6" x2="14" y2="6"></line><line x1="4" y1="12" x2="11" y2="12"></line><line x1="4" y1="18" x2="8" y2="18"></line><polyline points="15 15 18 18 21 15"></polyline><line x1="18" y1="9" x2="18" y2="18"></line></svg>',clear:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>'};function ld(e){let{name:n,className:t}=e;const i=sd[n];return i?(0,He.jsx)("span",{className:t,dangerouslySetInnerHTML:{__html:i}}):null}const cd={loomStyles:{category:"Narrative Style",packField:"loomStyles",storeField:"styles",toggleAction:"toggleLoomStyle",isMulti:!0},loomUtilities:{category:"Loom Utilities",packField:"loomUtils",storeField:"utilities",toggleAction:"toggleLoomUtility",isMulti:!0},loomRetrofits:{category:"Retrofits",packField:"loomRetrofits",storeField:"retrofits",toggleAction:"toggleLoomRetrofit",isMulti:!0}};function ud(e){let{value:n,onChange:t,placeholder:i}=e;return(0,He.jsxs)("div",{className:"lumia-search-box",children:[(0,He.jsx)(ld,{name:"search",className:"lumia-search-icon"}),(0,He.jsx)("input",{type:"text",className:"lumia-search-input",value:n,onChange:e=>t(e.target.value),placeholder:i}),n&&(0,He.jsx)("button",{className:"lumia-search-clear",onClick:()=>t(""),type:"button","aria-label":"Clear search",children:(0,He.jsx)(ld,{name:"clear",className:"lumia-search-clear-icon"})})]})}function dd(e){let{item:n,packName:t,isSelected:i,onToggle:a,isMulti:r}=e;const o=n.loomName||n.itemName||n.name||"Unknown";return(0,He.jsxs)("div",{className:Ln("lumiverse-loom-item",i&&"lumiverse-loom-item--selected"),onClick:()=>a(t,o),role:"button",tabIndex:0,onKeyDown:e=>"Enter"===e.key&&a(t,o),children:[(0,He.jsx)("div",{className:"lumiverse-loom-item-content",children:(0,He.jsx)("span",{className:"lumiverse-loom-item-name",children:o})}),(0,He.jsx)("div",{className:"lumiverse-loom-item-toggle",children:r?(0,He.jsx)("div",{className:Ln("lumiverse-toggle-switch",i&&"checked"),children:(0,He.jsx)("div",{className:"lumiverse-toggle-track",children:(0,He.jsx)("div",{className:"lumiverse-toggle-thumb"})})}):(0,He.jsx)("span",{className:Ln("lumiverse-radio-dot",i&&"checked")})})]})}function md(e){let{pack:n,children:t,defaultOpen:i=!0,isEditable:a,onRemovePack:r,isCollapsed:o,onToggleCollapse:s}=e;const[l,c]=(0,Ue.useState)(i),u=Ue.Children.count(t),d=n.name||n.packName||"Unknown Pack",m=void 0!==o,p=m?!o:l;if(0===u)return null;return(0,He.jsxs)("div",{className:Ln("lumia-modal-panel","lumia-collapsible","lumia-pack-section",!p&&"collapsed"),children:[(0,He.jsxs)("div",{className:"lumia-modal-panel-header lumia-collapsible-trigger",onClick:e=>{e.target.closest(".lumiverse-remove-pack-btn")||(m&&s?s(d):c(!l))},children:[(0,He.jsx)("span",{className:"lumia-panel-collapse-icon",children:(0,He.jsx)(ld,{name:"chevron"})}),(0,He.jsx)("span",{className:"lumia-modal-panel-icon",children:(0,He.jsx)(ld,{name:"folder"})}),(0,He.jsx)("span",{className:"lumia-modal-panel-title",children:d}),a&&(0,He.jsx)("span",{className:"lumia-pack-badge-custom",children:"Custom"}),(0,He.jsxs)("span",{className:"lumia-modal-panel-count",children:[u," items"]}),(0,He.jsx)("button",{className:"lumia-icon-btn-sm lumia-remove-pack-btn",onClick:e=>{e.stopPropagation(),r(d)},title:"Remove Pack",type:"button",children:(0,He.jsx)(ld,{name:"trash"})})]}),p&&(0,He.jsx)("div",{className:"lumia-modal-panel-content lumia-loom-items lumia-collapsible-content",children:t})]})}const pd=function(e){let{type:n,onClose:t}=e;const[i,a]=(0,Ue.useState)(""),[r,o]=(0,Ue.useState)(new Set),[s,l]=(0,Ue.useState)("default"),{allPacks:c}=Nn(),u=un(),d=Cn(),m=cd[n];if(!m)return(0,He.jsxs)("div",{className:"lumiverse-error",children:["Unknown Loom type: ",n]});const{category:p,storeField:h,toggleAction:v,isMulti:f}=m,g=(0,Ue.useMemo)(()=>{const e=d[h];return e?Array.isArray(e)?e:[e]:[]},[d,h]),b=(0,Ue.useCallback)((e,n)=>g.some(t=>t.packName===e&&t.itemName===n),[g]),x=(0,Ue.useCallback)((e,n)=>{const t={packName:e,itemName:n};u[v]?(u[v](t),an()):console.error("[LoomSelectionModal] Unknown toggle action: ".concat(v))},[u,v]),y=(0,Ue.useCallback)(()=>{const e={styles:"setSelectedLoomStyles",utilities:"setSelectedLoomUtilities",retrofits:"setSelectedLoomRetrofits"}[h];u[e]&&(u[e]([]),an())},[u,h]),k=(0,Ue.useMemo)(()=>{const e=i.toLowerCase().trim();return c.map(n=>{const t=function(e,n){const t=[],{category:i,packField:a}=n;return e[a]&&Array.isArray(e[a])&&e[a].forEach(e=>{t.push(rd(rd({},e),{},{loomName:e.loomName||e.itemName||e.name}))}),e.items&&Array.isArray(e.items)&&e.items.forEach(e=>{const n=e.loomCategory||e.category||e.type;n!==i&&n!==a||t.push(rd(rd({},e),{},{loomName:e.loomName||e.itemName||e.name}))}),t}(n,m),i=e?t.filter(n=>(n.loomName||n.itemName||n.name||"").toLowerCase().includes(e)):t;return rd(rd({},n),{},{loomItems:i,isEditable:n.isCustom||n.isEditable||!1})}).filter(e=>e.loomItems.length>0)},[c,m,i]),w=(0,Ue.useMemo)(()=>"default"===s?k:[...k].sort((e,n)=>{if("name"===s){const t=(e.name||e.packName||"").toLowerCase(),i=(n.name||n.packName||"").toLowerCase();return t.localeCompare(i)}if("author"===s){const t=(e.author||"").toLowerCase(),i=(n.author||"").toLowerCase();return t.localeCompare(i)}return 0}),[k,s]),j=(0,Ue.useCallback)(()=>{const e=k.map(e=>e.name||e.packName);o(new Set(e))},[k]),S=(0,Ue.useCallback)(()=>{o(new Set)},[]),C=(0,Ue.useCallback)(e=>{o(n=>{const t=new Set(n);return t.has(e)?t.delete(e):t.add(e),t})},[]),N=e=>r.has(e),P=(0,Ue.useCallback)(e=>{window.confirm('Delete pack "'.concat(e,'"? This action cannot be undone.'))&&(u.removeCustomPack(e),an())},[u]),M=w.reduce((e,n)=>e+n.loomItems.length,0),E=g.length;return(0,He.jsxs)("div",{className:"lumia-modal-selection-content",children:[(0,He.jsxs)("div",{className:"lumia-modal-header-inner",children:[(0,He.jsx)(ud,{value:i,onChange:a,placeholder:"Search ".concat(p,"...")}),(0,He.jsxs)("div",{className:"lumia-selection-actions",children:[(0,He.jsxs)("span",{className:"lumia-selection-count",children:[E," selected"]}),E>0&&(0,He.jsxs)("button",{className:"lumia-clear-btn",onClick:y,title:"Clear all selections",children:[(0,He.jsx)(ld,{name:"clear"}),(0,He.jsx)("span",{children:"Clear"})]})]})]}),w.length>0&&(0,He.jsxs)("div",{className:"lumia-modal-controls",children:[(0,He.jsxs)("div",{className:"lumia-modal-controls-group",children:[(0,He.jsxs)("button",{className:"lumia-modal-control-btn",onClick:S,title:"Expand all packs",type:"button",children:[(0,He.jsx)(ld,{name:"chevronDown",className:"lumia-control-icon"}),(0,He.jsx)("span",{children:"Expand All"})]}),(0,He.jsxs)("button",{className:"lumia-modal-control-btn",onClick:j,title:"Collapse all packs",type:"button",children:[(0,He.jsx)(ld,{name:"chevronUp",className:"lumia-control-icon"}),(0,He.jsx)("span",{children:"Collapse All"})]})]}),(0,He.jsxs)("div",{className:"lumia-modal-sort",children:[(0,He.jsx)(ld,{name:"sort",className:"lumia-sort-icon"}),(0,He.jsx)("span",{className:"lumia-modal-sort-label",children:"Sort:"}),(0,He.jsxs)("select",{className:"lumia-select",value:s,onChange:e=>l(e.target.value),children:[(0,He.jsx)("option",{value:"default",children:"Default"}),(0,He.jsx)("option",{value:"name",children:"Pack Name"}),(0,He.jsx)("option",{value:"author",children:"Author"})]})]})]}),(0,He.jsx)("div",{className:"lumia-modal-content",children:0===M?(0,He.jsxs)("div",{className:"lumia-modal-empty",children:['No "',p,'" items found in loaded packs.',i&&(0,He.jsx)("button",{className:"lumia-modal-btn lumia-modal-btn-secondary",onClick:()=>a(""),type:"button",style:{marginTop:"12px"},children:"Clear search"})]}):w.map(e=>{const n=(e=>e.name||e.packName||"Unknown Pack")(e);return(0,He.jsx)(md,{pack:e,isEditable:e.isEditable,onRemovePack:P,isCollapsed:N(n),onToggleCollapse:C,children:e.loomItems.map(e=>{const t=e.loomName||e.itemName||e.name;return(0,He.jsx)(dd,{item:e,packName:n,isSelected:b(n,t),onToggle:x,isMulti:f},"".concat(n,"-").concat(t))})},e.id||n)})}),(0,He.jsx)("div",{className:"lumia-modal-footer",children:(0,He.jsx)("button",{className:"lumia-modal-btn lumia-modal-btn-primary lumia-modal-done",onClick:t,children:"Done"})})]})},hd=In("folder",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]),vd=In("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),fd=In("folder-plus",[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]);function gd(e){let{item:n,packName:t,onEdit:i}=e;const{objectPosition:a}=Mn(n.lumia_img);return(0,He.jsxs)("div",{className:"lumiverse-pack-selector-lumia-item",children:[n.lumia_img&&(0,He.jsx)("img",{src:n.lumia_img,alt:"",className:"lumiverse-pack-selector-lumia-avatar",style:{objectPosition:a},onError:e=>{e.target.style.display="none"}}),(0,He.jsx)("span",{className:"lumiverse-pack-selector-lumia-name",children:n.lumiaDefName}),(0,He.jsx)("button",{className:"lumiverse-pack-selector-lumia-edit",onClick:()=>i(t,n),title:"Edit this Lumia",type:"button",children:(0,He.jsx)(Bn,{size:14,strokeWidth:1.5})})]})}const bd=function(e){let{onSelect:n,onClose:t}=e;const{customPacks:i,allPacks:a}=Nn(),r=un(),[o,s]=(0,Ue.useState)(null),[l,c]=(0,Ue.useState)(!1),[u,d]=(0,Ue.useState)(""),[m,p]=(0,Ue.useState)(""),[h,v]=(0,Ue.useState)(""),[f,g]=(0,Ue.useState)(""),b=a.filter(e=>e.isCustom||!e.url),x=(0,Ue.useCallback)(e=>{s(n=>n===e.name?null:e.name)},[]),y=(0,Ue.useCallback)(e=>{r.openModal("lumiaEditor",{packName:e})},[r]),k=(0,Ue.useCallback)((e,n)=>{r.openModal("lumiaEditor",{packName:e,editingItem:n})},[r]),w=(0,Ue.useCallback)(()=>{const e=u.trim();if(!e)return void g("Pack name is required");if(a.some(n=>n.name===e))return void g('Pack "'.concat(e,'" already exists'));const n={id:"pack_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),name:e,author:m.trim()||"",coverUrl:h.trim()||"",url:"",isCustom:!0,items:[]};r.addCustomPack(n),an(),c(!1),d(""),p(""),v(""),g(""),s(e)},[u,m,h,a,r]),j=e=>e.items?e.items.filter(e=>e.lumiaDefName):[],S=e=>j(e).length;return(0,He.jsxs)("div",{className:"lumiverse-pack-selector-modal",children:[(0,He.jsxs)("div",{className:"lumiverse-pack-selector-content",children:[(0,He.jsxs)("div",{className:"lumiverse-pack-selector-section",children:[(0,He.jsx)("h4",{className:"lumiverse-pack-selector-heading",children:"Select a Pack"}),0===b.length?(0,He.jsx)("div",{className:"lumiverse-pack-selector-empty",children:(0,He.jsx)("p",{children:"No custom packs yet. Create your first one below!"})}):(0,He.jsx)("div",{className:"lumiverse-pack-selector-list",children:b.map(e=>{const n=o===e.name,t=j(e);return(0,He.jsxs)("div",{className:Ln("lumiverse-pack-selector-item-wrapper",n&&"lumiverse-pack-selector-item-wrapper--expanded"),children:[(0,He.jsxs)("button",{className:"lumiverse-pack-selector-item",onClick:()=>x(e),type:"button",children:[(0,He.jsx)("div",{className:"lumiverse-pack-selector-item-icon",children:(0,He.jsx)(hd,{size:20,strokeWidth:1.5})}),(0,He.jsxs)("div",{className:"lumiverse-pack-selector-item-info",children:[(0,He.jsx)("span",{className:"lumiverse-pack-selector-item-name",children:e.name}),(0,He.jsxs)("span",{className:"lumiverse-pack-selector-item-meta",children:[S(e)," Lumias",e.author&&" â€¢ by ".concat(e.author)]})]}),n?(0,He.jsx)(mu,{size:16,className:"lumiverse-pack-selector-item-arrow"}):(0,He.jsx)(vd,{size:16,className:"lumiverse-pack-selector-item-arrow"})]}),n&&(0,He.jsxs)("div",{className:"lumiverse-pack-selector-lumias",children:[(0,He.jsxs)("button",{className:"lumiverse-pack-selector-add-lumia",onClick:()=>y(e.name),type:"button",children:[(0,He.jsx)(uu,{size:14,strokeWidth:2}),(0,He.jsx)("span",{children:"Add New Lumia"})]}),t.length>0?(0,He.jsx)("div",{className:"lumiverse-pack-selector-lumia-list",children:t.map((n,t)=>(0,He.jsx)(gd,{item:n,packName:e.name,onEdit:k},n.lumiaDefName||t))}):(0,He.jsx)("div",{className:"lumiverse-pack-selector-lumia-empty",children:"No Lumias yet. Add your first one!"})]})]},e.id||e.name)})})]}),(0,He.jsx)("div",{className:"lumiverse-pack-selector-divider",children:(0,He.jsx)("span",{children:"or"})}),(0,He.jsx)("div",{className:"lumiverse-pack-selector-section",children:l?(0,He.jsxs)("div",{className:"lumiverse-pack-selector-form",children:[(0,He.jsxs)("h4",{className:"lumiverse-pack-selector-heading",children:[(0,He.jsx)(fd,{size:16,strokeWidth:1.5}),"Create New Pack"]}),(0,He.jsx)("div",{className:"lumiverse-pack-selector-field",children:(0,He.jsx)("input",{type:"text",className:"lumiverse-input",placeholder:"Pack name (required)",value:u,onChange:e=>{d(e.target.value),g("")},autoFocus:!0})}),(0,He.jsx)("div",{className:"lumiverse-pack-selector-field",children:(0,He.jsx)("input",{type:"text",className:"lumiverse-input",placeholder:"Author name (optional)",value:m,onChange:e=>p(e.target.value)})}),(0,He.jsx)("div",{className:"lumiverse-pack-selector-field",children:(0,He.jsx)("input",{type:"text",className:"lumiverse-input",placeholder:"Cover image URL (optional)",value:h,onChange:e=>v(e.target.value)})}),f&&(0,He.jsx)("div",{className:"lumiverse-pack-selector-error",children:f}),(0,He.jsxs)("div",{className:"lumiverse-pack-selector-form-actions",children:[(0,He.jsx)("button",{className:"lumiverse-btn lumiverse-btn--secondary",onClick:()=>{c(!1),d(""),p(""),v(""),g("")},type:"button",children:"Cancel"}),(0,He.jsxs)("button",{className:"lumiverse-btn lumiverse-btn--primary",onClick:w,type:"button",children:[(0,He.jsx)(fd,{size:14}),"Create & Continue"]})]})]}):(0,He.jsxs)("button",{className:"lumiverse-pack-selector-create-btn",onClick:()=>c(!0),type:"button",children:[(0,He.jsx)(fd,{size:18,strokeWidth:1.5}),(0,He.jsx)("span",{children:"Create New Pack"})]})})]}),(0,He.jsx)("div",{className:"lumiverse-pack-selector-footer",children:(0,He.jsx)("button",{className:"lumiverse-btn lumiverse-btn--secondary",onClick:t,type:"button",children:"Cancel"})})]})},xd=In("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),yd=In("smile",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]);function kd(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,i)}return t}function wd(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?kd(Object(t),!0).forEach(function(n){jd(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):kd(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function jd(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,n||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function Sd(e){let{label:n,required:t,hint:i,children:a,error:r}=e;return(0,He.jsxs)("div",{className:Ln("lumiverse-editor-field",r&&"lumiverse-editor-field--error"),children:[(0,He.jsxs)("label",{className:"lumiverse-editor-label",children:[n,t&&(0,He.jsx)("span",{className:"lumiverse-required",children:"*"})]}),a,i&&(0,He.jsx)("span",{className:"lumiverse-editor-hint",children:i}),r&&(0,He.jsx)("span",{className:"lumiverse-editor-error",children:r})]})}function Cd(e){let{Icon:n,title:t,children:i}=e;return(0,He.jsxs)("div",{className:"lumiverse-editor-section",children:[(0,He.jsxs)("div",{className:"lumiverse-editor-section-header",children:[(0,He.jsx)(n,{size:16,strokeWidth:1.5}),(0,He.jsx)("span",{children:t})]}),(0,He.jsx)("div",{className:"lumiverse-editor-section-content",children:i})]})}function Nd(e){let{url:n}=e;const[t,i]=(0,Ue.useState)(!1),[a,r]=(0,Ue.useState)(!1),{objectPosition:o}=Mn(n);return(0,Ue.useEffect)(()=>{i(!1),r(!1)},[n]),!n||t?null:(0,He.jsxs)("div",{className:Ln("lumiverse-editor-avatar-preview",a&&"loaded"),children:[(0,He.jsx)("img",{src:n,alt:"Avatar preview",style:{objectPosition:o},onLoad:()=>r(!0),onError:()=>i(!0)}),!a&&(0,He.jsx)("div",{className:"lumiverse-editor-avatar-spinner"})]})}const Pd=function(e){let{packName:n,editingItem:t=null,onClose:i,onSaved:a}=e;const{allPacks:r}=Nn(),o=un(),s=null!==t,l=r.find(e=>e.name===n),[c,u]=(0,Ue.useState)((null==t?void 0:t.lumiaDefName)||""),[d,m]=(0,Ue.useState)((null==t?void 0:t.lumia_img)||""),[p,h]=(0,Ue.useState)((null==t?void 0:t.defAuthor)||""),[v,f]=(0,Ue.useState)((null==t?void 0:t.lumiaDef)||""),[g,b]=(0,Ue.useState)((null==t?void 0:t.lumia_personality)||""),[x,y]=(0,Ue.useState)((null==t?void 0:t.lumia_behavior)||""),[k,w]=(0,Ue.useState)({}),j=(0,Ue.useCallback)(()=>{const e={};if(c.trim()||(e.name="Lumia name is required"),l&&c.trim()){var n;(null===(n=l.items)||void 0===n?void 0:n.find(e=>e.lumiaDefName===c.trim()&&(!s||e.lumiaDefName!==(null==t?void 0:t.lumiaDefName))))&&(e.name='A Lumia named "'.concat(c.trim(),'" already exists in this pack'))}return w(e),0===Object.keys(e).length},[c,l,s,t]),S=(0,Ue.useCallback)(()=>{if(!j())return;const e={lumiaDefName:c.trim(),lumia_img:d.trim()||null,defAuthor:p.trim()||null,lumiaDef:v.trim()||null,lumia_personality:g.trim()||null,lumia_behavior:x.trim()||null};o.getPacks&&o.getPacks();if(l){const i=[...l.items||[]];if(s){const n=i.findIndex(e=>e.lumiaDefName===t.lumiaDefName);n>=0?i[n]=e:i.push(e)}else i.push(e);const r=wd(wd({},l),{},{items:i});l.isCustom?o.updateCustomPack(l.id||l.name,r):o.updateCustomPack(l.name,wd(wd({},r),{},{isCustom:!0})),an(),a&&a(e,n)}i()},[j,c,d,p,v,g,x,l,s,t,o,n,i,a]),C=(0,Ue.useCallback)(()=>{if(s&&t&&window.confirm('Are you sure you want to delete "'.concat(t.lumiaDefName,'"? This cannot be undone.'))){if(l){const e=(l.items||[]).filter(e=>e.lumiaDefName!==t.lumiaDefName),n=wd(wd({},l),{},{items:e});l.isCustom?o.updateCustomPack(l.id||l.name,n):o.updateCustomPack(l.name,wd(wd({},n),{},{isCustom:!0})),an()}i()}},[s,t,l,o,i]);return l?(0,He.jsxs)("div",{className:"lumiverse-editor-modal",children:[(0,He.jsxs)("div",{className:"lumiverse-editor-content",children:[(0,He.jsxs)(Cd,{Icon:xd,title:"Basic Info",children:[(0,He.jsxs)(Sd,{label:"Lumia Name",required:!0,error:k.name,children:[(0,He.jsx)("input",{type:"text",className:"lumiverse-input",value:c,onChange:e=>{u(e.target.value),k.name&&w(e=>wd(wd({},e),{},{name:null}))},placeholder:"e.g., Aria, Luna, Sage",autoFocus:!0}),(0,He.jsxs)("span",{className:"lumiverse-editor-hint",children:['Will be referenced as "Lumia (',c||"Name",')" in World Books']})]}),(0,He.jsxs)("div",{className:"lumiverse-editor-row",children:[(0,He.jsx)(Sd,{label:"Avatar URL",children:(0,He.jsx)("input",{type:"text",className:"lumiverse-input",value:d,onChange:e=>m(e.target.value),placeholder:"https://..."})}),(0,He.jsx)(Sd,{label:"Author",children:(0,He.jsx)("input",{type:"text",className:"lumiverse-input",value:p,onChange:e=>h(e.target.value),placeholder:"Your name"})})]}),(0,He.jsx)(Nd,{url:d})]}),(0,He.jsx)(Cd,{Icon:xd,title:"Lumia Physicality",children:(0,He.jsx)(Sd,{label:"Physical Definition",hint:"Injected via {{lumiaDef}} macro",children:(0,He.jsx)("textarea",{className:"lumiverse-textarea",value:v,onChange:e=>f(e.target.value),placeholder:"Describe Lumia's physical appearance, form, and presence...",rows:5})})}),(0,He.jsx)(Cd,{Icon:yd,title:"Lumia Personality",children:(0,He.jsx)(Sd,{label:"Personality Traits",hint:"Injected via {{lumiaPersonality}} macro",children:(0,He.jsx)("textarea",{className:"lumiverse-textarea",value:g,onChange:e=>b(e.target.value),placeholder:"Describe Lumia's personality, disposition, and inner nature...",rows:5})})}),(0,He.jsx)(Cd,{Icon:gu,title:"Lumia Behavior Traits",children:(0,He.jsx)(Sd,{label:"Behavioral Patterns",hint:"Injected via {{lumiaBehavior}} macro",children:(0,He.jsx)("textarea",{className:"lumiverse-textarea",value:x,onChange:e=>y(e.target.value),placeholder:"Describe Lumia's behavioral patterns, habits, and tendencies...",rows:5})})})]}),(0,He.jsxs)("div",{className:"lumiverse-editor-footer",children:[s&&(0,He.jsxs)("button",{className:"lumiverse-btn lumiverse-btn--danger",onClick:C,type:"button",children:[(0,He.jsx)(_n,{size:14}),"Delete"]}),(0,He.jsx)("div",{className:"lumiverse-editor-footer-spacer"}),(0,He.jsx)("button",{className:"lumiverse-btn lumiverse-btn--secondary",onClick:i,type:"button",children:"Cancel"}),(0,He.jsx)("button",{className:"lumiverse-btn lumiverse-btn--primary",onClick:S,type:"button",children:s?"Save Changes":"Create Lumia"})]})]}):(0,He.jsxs)("div",{className:"lumiverse-editor-modal lumiverse-editor-error",children:[(0,He.jsxs)("p",{children:['Pack "',n,'" not found.']}),(0,He.jsx)("button",{className:"lumiverse-btn lumiverse-btn--secondary",onClick:i,children:"Close"})]})},Md=In("zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),Ed=In("heart",[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]]),Ld=In("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);function Dd(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,i)}return t}function Od(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Dd(Object(t),!0).forEach(function(n){Td(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Dd(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Td(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,n||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const zd=on,Ad=[],Id=()=>zd.getState().councilMembers||Ad;function Rd(e){let{item:n,packName:t,onAdd:i,animationIndex:a}=e;const{objectPosition:r}=Mn(n.lumia_img),[o,s]=(0,Ue.useState)(!1),[l,c]=(0,Ue.useState)(!1),u=n.lumiaDefName||"Unknown",d=n.lumia_img,m=Math.min(30*a,300);return(0,He.jsxs)("button",{type:"button",className:"lumiverse-council-select-card lumia-card-appear",style:{animationDelay:"".concat(m,"ms")},onClick:()=>i({packName:t,itemName:n.lumiaDefName}),children:[(0,He.jsxs)("div",{className:"lumiverse-council-select-card-image",children:[d&&!l?(0,He.jsxs)(He.Fragment,{children:[(0,He.jsx)("img",{src:d,alt:u,loading:"lazy",className:o?"lumia-img-loaded":"",style:{objectPosition:r},onLoad:()=>s(!0),onError:()=>c(!0)}),!o&&(0,He.jsx)("div",{className:"lumia-img-spinner"})]}):(0,He.jsx)("div",{className:"lumiverse-council-select-card-placeholder",children:(0,He.jsx)(cu,{size:24,strokeWidth:1.5})}),(0,He.jsx)("div",{className:"lumiverse-council-select-card-add",children:(0,He.jsx)(uu,{size:16,strokeWidth:2})})]}),(0,He.jsxs)("div",{className:"lumiverse-council-select-card-info",children:[(0,He.jsx)("span",{className:"lumiverse-council-select-card-name",children:u}),(0,He.jsx)("span",{className:"lumiverse-council-select-card-pack",children:t})]})]})}function Bd(e){var n,t;let{member:i,packs:a,onRemove:r,onUpdateRole:o}=e;const[s,l]=(0,Ue.useState)(!1),[c,u]=(0,Ue.useState)(i.role||""),d=function(e,n,t){var i;const a=(Array.isArray(e)?e.reduce((e,n)=>Od(Od({},e),{},{[n.name]:n}),{}):e)[n];if(!a)return t;const r=null===(i=a.items)||void 0===i?void 0:i.find(e=>e.lumiaDefName===t);return(null==r?void 0:r.lumiaDefName)||t}(a,i.packName,i.itemName),m=function(e,n,t){var i;const a=(Array.isArray(e)?e.reduce((e,n)=>Od(Od({},e),{},{[n.name]:n}),{}):e)[n];if(!a)return null;const r=null===(i=a.items)||void 0===i?void 0:i.find(e=>e.lumiaDefName===t);return(null==r?void 0:r.lumia_img)||null}(a,i.packName,i.itemName),{objectPosition:p}=Mn(m),h=()=>{o(i.id,{role:c}),l(!1)},v=(null===(n=i.behaviors)||void 0===n?void 0:n.length)||0,f=(null===(t=i.personalities)||void 0===t?void 0:t.length)||0;return(0,He.jsxs)("div",{className:"lumiverse-council-member-card",children:[(0,He.jsx)("div",{className:"lumiverse-council-member-card-avatar",children:m?(0,He.jsx)("img",{src:m,alt:d,style:{objectPosition:p}}):(0,He.jsx)(cu,{size:20,strokeWidth:1.5})}),(0,He.jsxs)("div",{className:"lumiverse-council-member-card-content",children:[(0,He.jsx)("span",{className:"lumiverse-council-member-card-name",children:d}),s?(0,He.jsxs)("div",{className:"lumiverse-council-member-role-edit",children:[(0,He.jsx)("input",{type:"text",className:"lumiverse-council-input-sm",placeholder:"Role/title...",value:c,onChange:e=>u(e.target.value),onKeyDown:e=>{"Enter"===e.key&&h(),"Escape"===e.key&&(u(i.role||""),l(!1))},autoFocus:!0}),(0,He.jsx)("button",{className:"lumiverse-council-btn-sm lumiverse-council-btn-sm--primary",onClick:h,type:"button",children:(0,He.jsx)(pu,{size:12,strokeWidth:2})}),(0,He.jsx)("button",{className:"lumiverse-council-btn-sm",onClick:()=>{u(i.role||""),l(!1)},type:"button",children:(0,He.jsx)(hu,{size:12,strokeWidth:2})})]}):(0,He.jsxs)("div",{className:"lumiverse-council-member-card-meta",children:[i.role?(0,He.jsx)("span",{className:"lumiverse-council-member-card-role",onClick:()=>l(!0),title:"Click to edit role",children:i.role}):(0,He.jsxs)("button",{className:"lumiverse-council-add-role-btn",onClick:()=>l(!0),type:"button",children:[(0,He.jsx)(Bn,{size:10})," Add role"]}),(0,He.jsxs)("span",{className:"lumiverse-council-member-card-stats",children:[(0,He.jsxs)("span",{title:"Behaviors",children:[(0,He.jsx)(Md,{size:10})," ",v]}),(0,He.jsxs)("span",{title:"Personalities",children:[(0,He.jsx)(Ed,{size:10})," ",f]})]})]})]}),(0,He.jsx)("button",{className:"lumiverse-council-btn-sm lumiverse-council-btn-sm--danger",onClick:()=>r(i.id),title:"Remove from council",type:"button",children:(0,He.jsx)(_n,{size:14,strokeWidth:1.5})})]})}function _d(){return(0,He.jsxs)("div",{className:"lumiverse-council-select-empty",children:[(0,He.jsx)(cu,{size:24,strokeWidth:1.5}),(0,He.jsx)("span",{children:"No council members yet"}),(0,He.jsx)("p",{children:"Select Lumias from below to add them to your council."})]})}function Fd(e){let{hasSearch:n}=e;return(0,He.jsx)("div",{className:"lumiverse-council-select-empty lumiverse-council-select-empty--muted",children:n?(0,He.jsxs)(He.Fragment,{children:[(0,He.jsx)(Ld,{size:24,strokeWidth:1.5}),(0,He.jsx)("span",{children:"No matching Lumias"}),(0,He.jsx)("p",{children:"Try a different search term."})]}):(0,He.jsxs)(He.Fragment,{children:[(0,He.jsx)(cu,{size:24,strokeWidth:1.5}),(0,He.jsx)("span",{children:"No Lumias available"}),(0,He.jsx)("p",{children:"All Lumias are already in the council, or no packs are loaded."})]})})}const Ud=function(e){let{onClose:n}=e;const t=un(),{allPacks:i}=Nn(),[a,r]=(0,Ue.useState)(""),o=(0,Ue.useSyncExternalStore)(zd.subscribe,Id,Id),s=(0,Ue.useMemo)(()=>Array.isArray(i)?i.reduce((e,n)=>Od(Od({},e),{},{[n.name]:n}),{}):i||{},[i]),l=(0,Ue.useMemo)(()=>{const e=new Set(o.map(e=>"".concat(e.packName,":").concat(e.itemName))),n=[];if((Array.isArray(i)?i:Object.values(i||{})).forEach(t=>{const i=t.name||t.packName;(t.items||[]).forEach(t=>{if(!t.lumiaDefName||!t.lumiaDef)return;const a="".concat(i,":").concat(t.lumiaDefName);e.has(a)||n.push({packName:i,item:t})})}),a.trim()){const e=a.toLowerCase();return n.filter(n=>{let{item:t,packName:i}=n;return t.lumiaDefName.toLowerCase().includes(e)||i.toLowerCase().includes(e)})}return n},[i,o,a]),c=(0,Ue.useCallback)(e=>{t.addCouncilMember(e),an()},[t]),u=(0,Ue.useCallback)(e=>{t.removeCouncilMember(e),an()},[t]),d=(0,Ue.useCallback)((e,n)=>{t.updateCouncilMember(e,n),an()},[t]);return(0,He.jsxs)("div",{className:"lumiverse-council-select-modal",children:[(0,He.jsxs)("div",{className:"lumiverse-council-select-header",children:[(0,He.jsx)("div",{className:"lumiverse-council-select-header-icon",children:(0,He.jsx)(cu,{size:20,strokeWidth:1.5})}),(0,He.jsxs)("div",{className:"lumiverse-council-select-header-text",children:[(0,He.jsx)("h3",{children:"Configure Council"}),(0,He.jsx)("p",{children:"Select Lumias to join your council of independent characters."})]})]}),(0,He.jsxs)("div",{className:"lumiverse-council-select-section",children:[(0,He.jsxs)("div",{className:"lumiverse-council-select-section-header",children:[(0,He.jsx)("span",{children:"Council Members"}),(0,He.jsx)("span",{className:"lumiverse-council-select-count",children:o.length})]}),(0,He.jsx)("div",{className:"lumiverse-council-select-members",children:0===o.length?(0,He.jsx)(_d,{}):(0,He.jsx)("div",{className:"lumiverse-council-member-list",children:o.map(e=>(0,He.jsx)(Bd,{member:e,packs:s,onRemove:u,onUpdateRole:d},e.id))})})]}),(0,He.jsxs)("div",{className:"lumiverse-council-select-section lumiverse-council-select-section--available",children:[(0,He.jsxs)("div",{className:"lumiverse-council-select-section-header",children:[(0,He.jsx)("span",{children:"Add Lumias"}),(0,He.jsxs)("div",{className:"lumiverse-council-search-wrapper",children:[(0,He.jsx)(Ld,{size:14,strokeWidth:1.5}),(0,He.jsx)("input",{type:"text",className:"lumiverse-council-search-input",placeholder:"Search...",value:a,onChange:e=>r(e.target.value)}),a&&(0,He.jsx)("button",{className:"lumiverse-council-search-clear",onClick:()=>r(""),type:"button",children:(0,He.jsx)(hu,{size:12,strokeWidth:2})})]})]}),(0,He.jsx)("div",{className:"lumiverse-council-select-grid-wrapper",children:0===l.length?(0,He.jsx)(Fd,{hasSearch:!!a.trim()}):(0,He.jsx)("div",{className:"lumiverse-council-select-grid",children:l.map((e,n)=>{let{item:t,packName:i}=e;return(0,He.jsx)(Rd,{item:t,packName:i,onAdd:c,animationIndex:n},"".concat(i,":").concat(t.lumiaDefName))})})})]}),(0,He.jsx)("div",{className:"lumiverse-council-select-footer",children:(0,He.jsx)("button",{className:"lumia-modal-btn lumia-modal-btn-primary",onClick:n,type:"button",children:"Done"})})]})};function Vd(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,i)}return t}function Hd(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Vd(Object(t),!0).forEach(function(n){Wd(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Vd(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Wd(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,n||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function $d(e){let{children:n,onClose:t,modalType:i,size:a="medium",hasCustomHeader:r=!1}=e;const o=(0,Ue.useCallback)(e=>{"Escape"===e.key&&t()},[t]);(0,Ue.useEffect)(()=>(document.addEventListener("keydown",o),document.body.style.overflow="hidden",()=>{document.removeEventListener("keydown",o),document.body.style.overflow=""}),[o]);const s=e=>{e.stopPropagation()},l=Ln("lumia-modal","selection"===i&&"lumia-modal-selection","settings"===i&&"lumia-modal-settings","editor"===i&&"lumia-modal-editor","pack-editor"===i&&"lumia-modal-pack-editor","pack-selector"===i&&"lumia-modal-pack-selector","lumia-editor"===i&&"lumia-modal-lumia-editor");return(0,He.jsx)("div",{className:"lumia-modal-backdrop",onClick:e=>{e.target===e.currentTarget&&t()},onMouseDown:s,onMouseUp:s,children:(0,He.jsx)("div",{className:l,role:"dialog","aria-modal":"true",onClick:s,children:n})})}const qd={behaviors:{component:id,modalType:"selection",size:"large",hasCustomHeader:!0,props:{type:"behaviors",multiSelect:!0,allowDominant:!0}},personalities:{component:id,modalType:"selection",size:"large",hasCustomHeader:!0,props:{type:"personalities",multiSelect:!0,allowDominant:!0}},definitions:{component:id,modalType:"selection",size:"large",hasCustomHeader:!0,props:{type:"definitions",multiSelect:!1,allowDominant:!1}},packEditor:{component:Qn,modalType:"pack-editor",size:"large",hasCustomHeader:!0,props:{}},importPack:{component:()=>(0,He.jsx)("div",{className:"lumia-modal-empty",children:"Import Pack Modal (TODO)"}),modalType:"settings",size:"medium",hasCustomHeader:!1,props:{}},loomStyles:{component:pd,modalType:"selection",size:"large",hasCustomHeader:!0,props:{type:"loomStyles"}},loomUtilities:{component:pd,modalType:"selection",size:"large",hasCustomHeader:!0,props:{type:"loomUtilities"}},loomRetrofits:{component:pd,modalType:"selection",size:"large",hasCustomHeader:!0,props:{type:"loomRetrofits"}},packSelector:{component:bd,modalType:"pack-selector",size:"medium",hasCustomHeader:!0,props:{}},lumiaEditor:{component:Pd,modalType:"lumia-editor",size:"large",hasCustomHeader:!0,props:{}},councilSelect:{component:Ud,modalType:"selection",size:"large",hasCustomHeader:!0,props:{}}};const Yd=function(){const e=Pn(),n=un();if(!e.activeModal)return null;const{name:t,props:i}=e.activeModal,a=qd[t];if(!a)return console.warn("[LumiverseUI] Unknown modal: ".concat(t)),null;const{component:r,modalType:o,size:s,hasCustomHeader:l,props:c}=a;return(0,$u.createPortal)((0,He.jsx)($d,{modalType:o,size:s,hasCustomHeader:l,onClose:n.closeModal,children:(0,He.jsx)(r,Hd(Hd(Hd({},c),i),{},{onClose:n.closeModal}))}),document.body)},Kd=In("chevron-up",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),Gd=In("file-text",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]),Qd=on,Zd={},Xd=()=>{var e;return null===(e=Qd.getState().ui)||void 0===e?void 0:e.viewingPack},Jd=()=>Qd.getState().packs||Zd;function em(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;return!e||e.length<=n?e:e.slice(0,n)+"..."}function nm(e){let{title:n,Icon:t,content:i,defaultOpen:a=!1}=e;const[r,o]=(0,Ue.useState)(a);return i?(0,He.jsxs)("div",{className:"lumiverse-pack-detail-trait",children:[(0,He.jsxs)("button",{className:Ln("lumiverse-pack-detail-trait-header",r&&"lumiverse-pack-detail-trait-header--open"),onClick:()=>o(!r),type:"button",children:[(0,He.jsx)("span",{className:"lumiverse-pack-detail-trait-icon",children:(0,He.jsx)(t,{size:14,strokeWidth:1.5})}),(0,He.jsx)("span",{className:"lumiverse-pack-detail-trait-title",children:n}),(0,He.jsx)("span",{className:"lumiverse-pack-detail-trait-chevron",children:r?(0,He.jsx)(Kd,{size:14}):(0,He.jsx)(mu,{size:14})})]}),r&&(0,He.jsx)("div",{className:"lumiverse-pack-detail-trait-content",children:(0,He.jsx)("p",{children:em(i,500)})})]}):null}function tm(e){let{label:n,Icon:t,isSelected:i,onClick:a,disabled:r}=e;return(0,He.jsxs)("button",{className:Ln("lumiverse-pack-detail-action",i&&"lumiverse-pack-detail-action--selected"),onClick:a,disabled:r,title:i?"Already selected":n,type:"button",children:[i?(0,He.jsx)(pu,{size:12,strokeWidth:2}):(0,He.jsx)(uu,{size:12,strokeWidth:2}),(0,He.jsx)("span",{children:n})]})}function im(e){let{item:n,packName:t,selections:i,actions:a}=e;const{objectPosition:r}=Mn(n.lumia_img),o=(0,Ue.useMemo)(()=>!!i.definition&&(i.definition.packName===t&&i.definition.itemName===n.lumiaDefName),[i.definition,t,n.lumiaDefName]),s=(0,Ue.useMemo)(()=>(i.behaviors||[]).some(e=>e.packName===t&&e.itemName===n.lumiaDefName),[i.behaviors,t,n.lumiaDefName]),l=(0,Ue.useMemo)(()=>(i.personalities||[]).some(e=>e.packName===t&&e.itemName===n.lumiaDefName),[i.personalities,t,n.lumiaDefName]),c=(0,Ue.useCallback)(()=>{o||(a.setSelectedDefinition({packName:t,itemName:n.lumiaDefName}),an(),"undefined"!=typeof toastr&&toastr.success('Set "'.concat(n.lumiaDefName,'" as definition')))},[o,a,t,n.lumiaDefName]),u=(0,Ue.useCallback)(()=>{s||(a.toggleBehavior({packName:t,itemName:n.lumiaDefName}),an(),"undefined"!=typeof toastr&&toastr.success('Added "'.concat(n.lumiaDefName,'" behavior')))},[s,a,t,n.lumiaDefName]),d=(0,Ue.useCallback)(()=>{l||(a.togglePersonality({packName:t,itemName:n.lumiaDefName}),an(),"undefined"!=typeof toastr&&toastr.success('Added "'.concat(n.lumiaDefName,'" personality')))},[l,a,t,n.lumiaDefName]),m=(0,Ue.useCallback)(()=>{a.enableAllTraitsForLumia(t,n.lumiaDefName),an(),"undefined"!=typeof toastr&&toastr.success('Enabled all traits for "'.concat(n.lumiaDefName,'"'))},[a,t,n.lumiaDefName]),p=!!n.lumiaDef,h=!!n.lumia_behavior,v=!!n.lumia_personality;return(0,He.jsxs)("div",{className:"lumiverse-pack-detail-lumia",children:[(0,He.jsxs)("div",{className:"lumiverse-pack-detail-lumia-header",children:[(0,He.jsx)("div",{className:"lumiverse-pack-detail-lumia-avatar",children:n.lumia_img?(0,He.jsx)("img",{src:n.lumia_img,alt:n.lumiaDefName,style:{objectPosition:r}}):(0,He.jsx)(xd,{size:24,strokeWidth:1.5})}),(0,He.jsxs)("div",{className:"lumiverse-pack-detail-lumia-info",children:[(0,He.jsx)("h4",{className:"lumiverse-pack-detail-lumia-name",children:n.lumiaDefName}),n.defAuthor&&(0,He.jsxs)("span",{className:"lumiverse-pack-detail-lumia-author",children:["by ",n.defAuthor]})]})]}),(0,He.jsxs)("div",{className:"lumiverse-pack-detail-traits",children:[(0,He.jsx)(nm,{title:"Definition",Icon:Gd,content:n.lumiaDef,defaultOpen:!1}),(0,He.jsx)(nm,{title:"Behavior",Icon:Md,content:n.lumia_behavior,defaultOpen:!1}),(0,He.jsx)(nm,{title:"Personality",Icon:Ed,content:n.lumia_personality,defaultOpen:!1})]}),(0,He.jsxs)("div",{className:"lumiverse-pack-detail-actions",children:[p&&(0,He.jsx)(tm,{label:"Set Def",Icon:Gd,isSelected:o,onClick:c}),h&&(0,He.jsx)(tm,{label:"Add Behavior",Icon:Md,isSelected:s,onClick:u}),v&&(0,He.jsx)(tm,{label:"Add Personality",Icon:Ed,isSelected:l,onClick:d}),(p||h||v)&&(0,He.jsx)("button",{className:"lumiverse-pack-detail-action lumiverse-pack-detail-action--enable-all",onClick:m,title:"Enable all traits for this Lumia",type:"button",children:"Enable All"})]})]})}const am=function(){const e=un(),n=Sn(),t=(0,Ue.useSyncExternalStore)(Qd.subscribe,Xd,Xd),i=(0,Ue.useSyncExternalStore)(Qd.subscribe,Jd,Jd),a=(0,Ue.useMemo)(()=>t&&i[t]||null,[t,i]),r=(0,Ue.useMemo)(()=>null!=a&&a.items?a.items.filter(e=>e.lumiaDefName&&e.lumiaDef):[],[a]),o=(0,Ue.useMemo)(()=>{if(null==a||!a.items)return{lumias:0,behaviors:0,personalities:0};const e=a.items;return{lumias:e.filter(e=>e.lumiaDefName&&e.lumiaDef).length,behaviors:e.filter(e=>e.lumia_behavior).length,personalities:e.filter(e=>e.lumia_personality).length}},[a]),s=(0,Ue.useCallback)(()=>{e.closePackDetail()},[e]);(0,Ue.useEffect)(()=>{if(!t||!a)return;const e=e=>{"Escape"===e.key&&s()};return document.addEventListener("keydown",e),document.body.style.overflow="hidden",()=>{document.removeEventListener("keydown",e),document.body.style.overflow=""}},[t,a,s]);const l=(0,Ue.useCallback)(e=>{e.target===e.currentTarget&&s()},[s]),c=(0,Ue.useCallback)(e=>{e.stopPropagation()},[]);return t&&a?(0,$u.createPortal)((0,He.jsx)("div",{className:"lumia-modal-backdrop",onClick:l,onMouseDown:c,onMouseUp:c,children:(0,He.jsxs)("div",{className:"lumia-modal lumiverse-pack-detail-modal",onClick:c,role:"dialog","aria-modal":"true",children:[(0,He.jsxs)("div",{className:"lumiverse-pack-detail-header",children:[(0,He.jsxs)("div",{className:"lumiverse-pack-detail-header-info",children:[(0,He.jsx)("span",{className:"lumiverse-pack-detail-header-icon",children:a.packCover?(0,He.jsx)("img",{src:a.packCover,alt:t}):(0,He.jsx)(Rn,{size:24,strokeWidth:1.5})}),(0,He.jsxs)("div",{className:"lumiverse-pack-detail-header-text",children:[(0,He.jsx)("h3",{className:"lumiverse-pack-detail-title",children:t}),(0,He.jsxs)("div",{className:"lumiverse-pack-detail-stats",children:[(0,He.jsxs)("span",{children:[(0,He.jsx)(Gd,{size:12})," ",o.lumias," Lumia",1!==o.lumias?"s":""]}),(0,He.jsxs)("span",{children:[(0,He.jsx)(Md,{size:12})," ",o.behaviors," Behavior",1!==o.behaviors?"s":""]}),(0,He.jsxs)("span",{children:[(0,He.jsx)(Ed,{size:12})," ",o.personalities," Personalit",1!==o.personalities?"ies":"y"]})]})]})]}),(0,He.jsx)("button",{className:"lumiverse-pack-detail-close",onClick:s,title:"Close",type:"button",children:(0,He.jsx)(hu,{size:20,strokeWidth:2})})]}),(0,He.jsx)("div",{className:"lumiverse-pack-detail-content",children:0===r.length?(0,He.jsxs)("div",{className:"lumiverse-pack-detail-empty",children:[(0,He.jsx)(Rn,{size:32,strokeWidth:1.5}),(0,He.jsx)("p",{children:"No Lumias found in this pack"})]}):(0,He.jsx)("div",{className:"lumiverse-pack-detail-list",children:r.map((i,a)=>(0,He.jsx)(im,{item:i,packName:t,selections:n,actions:e},i.lumiaDefName||a))})})]})}),document.body):null},rm=on,om={},sm=()=>{var e;return null===(e=rm.getState().ui)||void 0===e?void 0:e.viewingLoomPack},lm=()=>rm.getState().packs||om,cm={"Narrative Style":{Icon:fu,color:"rgba(147, 112, 219, 0.15)",border:"rgba(147, 112, 219, 0.3)",storeField:"styles",toggleAction:"toggleLoomStyle"},"Loom Utilities":{Icon:gu,color:"rgba(100, 200, 255, 0.15)",border:"rgba(100, 200, 255, 0.3)",storeField:"utilities",toggleAction:"toggleLoomUtility"},Retrofits:{Icon:bu,color:"rgba(255, 180, 100, 0.15)",border:"rgba(255, 180, 100, 0.3)",storeField:"retrofits",toggleAction:"toggleLoomRetrofit"}};function um(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;return!e||e.length<=n?e:e.slice(0,n)+"..."}function dm(e){let{content:n,defaultOpen:t=!1}=e;const[i,a]=(0,Ue.useState)(t);return n?(0,He.jsxs)("div",{className:"lumiverse-loom-detail-content-preview",children:[(0,He.jsxs)("button",{className:Ln("lumiverse-loom-detail-content-toggle",i&&"lumiverse-loom-detail-content-toggle--open"),onClick:()=>a(!i),type:"button",children:[(0,He.jsx)("span",{children:"Preview"}),(0,He.jsx)("span",{className:"lumiverse-loom-detail-content-chevron",children:i?(0,He.jsx)(Kd,{size:12}):(0,He.jsx)(mu,{size:12})})]}),i&&(0,He.jsx)("div",{className:"lumiverse-loom-detail-content-text",children:(0,He.jsx)("p",{children:um(n,500)})})]}):null}function mm(e){let{item:n,packName:t,category:i,isSelected:a,onToggle:r}=e;const o=cm[i]||cm["Narrative Style"],{Icon:s}=o,l=n.loomName||n.itemName||n.name||"Unknown";return(0,He.jsxs)("div",{className:Ln("lumiverse-loom-detail-item",a&&"lumiverse-loom-detail-item--selected"),style:{background:a?o.color.replace("0.15","0.25"):o.color,borderColor:a?o.border.replace("0.3","0.6"):o.border},children:[(0,He.jsxs)("div",{className:"lumiverse-loom-detail-item-header",children:[(0,He.jsx)("span",{className:"lumiverse-loom-detail-item-icon",children:(0,He.jsx)(s,{size:14,strokeWidth:1.5})}),(0,He.jsx)("span",{className:"lumiverse-loom-detail-item-name",children:l}),(0,He.jsx)("button",{className:Ln("lumiverse-loom-detail-item-toggle",a&&"lumiverse-loom-detail-item-toggle--selected"),onClick:()=>r(t,l),title:a?"Remove from selection":"Add to selection",type:"button",children:a?(0,He.jsx)(pu,{size:12,strokeWidth:2}):(0,He.jsx)(uu,{size:12,strokeWidth:2})})]}),(0,He.jsx)(dm,{content:n.loomContent||n.content})]})}function pm(e){let{category:n,items:t,packName:i,selections:a,actions:r}=e;const[o,s]=(0,Ue.useState)(!0),l=cm[n],{Icon:c,storeField:u,toggleAction:d}=l,m=(0,Ue.useCallback)(e=>(a[u]||[]).some(n=>n.packName===i&&n.itemName===e),[a,u,i]),p=(0,Ue.useCallback)((e,n)=>{if(r[d]&&(r[d]({packName:e,itemName:n}),an(),"undefined"!=typeof toastr)){const e=m(n);toastr.success(e?'Removed "'.concat(n,'"'):'Added "'.concat(n,'"'))}},[r,d,m]);return t&&0!==t.length?(0,He.jsxs)("div",{className:"lumiverse-loom-detail-category",children:[(0,He.jsxs)("button",{className:Ln("lumiverse-loom-detail-category-header",o&&"lumiverse-loom-detail-category-header--expanded"),onClick:()=>s(!o),type:"button",children:[(0,He.jsx)("span",{className:"lumiverse-loom-detail-category-icon",children:(0,He.jsx)(c,{size:16,strokeWidth:1.5})}),(0,He.jsx)("span",{className:"lumiverse-loom-detail-category-title",children:n}),(0,He.jsx)("span",{className:"lumiverse-loom-detail-category-count",children:t.length}),(0,He.jsx)("span",{className:"lumiverse-loom-detail-category-chevron",children:o?(0,He.jsx)(Kd,{size:14}):(0,He.jsx)(mu,{size:14})})]}),o&&(0,He.jsx)("div",{className:"lumiverse-loom-detail-category-items",children:t.map((e,t)=>{const a=e.loomName||e.itemName||e.name;return(0,He.jsx)(mm,{item:e,packName:i,category:n,isSelected:m(a),onToggle:p},a||t)})})]}):null}const hm=function(){const e=un(),n=Cn(),t=(0,Ue.useSyncExternalStore)(rm.subscribe,sm,sm),i=(0,Ue.useSyncExternalStore)(rm.subscribe,lm,lm),a=(0,Ue.useMemo)(()=>t&&i[t]||null,[t,i]),r=(0,Ue.useMemo)(()=>a?function(e){const n={"Narrative Style":[],"Loom Utilities":[],Retrofits:[]};return e.loomStyles&&Array.isArray(e.loomStyles)&&n["Narrative Style"].push(...e.loomStyles),e.loomUtils&&Array.isArray(e.loomUtils)&&n["Loom Utilities"].push(...e.loomUtils),e.loomRetrofits&&Array.isArray(e.loomRetrofits)&&n.Retrofits.push(...e.loomRetrofits),e.items&&Array.isArray(e.items)&&e.items.forEach(e=>{const t=e.loomCategory||e.category;"Narrative Style"===t||"loomStyles"===t?n["Narrative Style"].push(e):"Loom Utilities"===t||"loomUtils"===t?n["Loom Utilities"].push(e):"Retrofits"!==t&&"loomRetrofits"!==t||n.Retrofits.push(e)}),n}(a):null,[a]),o=(0,Ue.useMemo)(()=>r?{styles:r["Narrative Style"].length,utilities:r["Loom Utilities"].length,retrofits:r.Retrofits.length}:{styles:0,utilities:0,retrofits:0},[r]),s=o.styles+o.utilities+o.retrofits,l=(0,Ue.useCallback)(()=>{e.closeLoomPackDetail()},[e]);(0,Ue.useEffect)(()=>{if(!t||!a)return;const e=e=>{"Escape"===e.key&&l()};return document.addEventListener("keydown",e),document.body.style.overflow="hidden",()=>{document.removeEventListener("keydown",e),document.body.style.overflow=""}},[t,a,l]);const c=(0,Ue.useCallback)(e=>{e.target===e.currentTarget&&l()},[l]),u=(0,Ue.useCallback)(e=>{e.stopPropagation()},[]);return t&&a?(0,$u.createPortal)((0,He.jsx)("div",{className:"lumia-modal-backdrop",onClick:c,onMouseDown:u,onMouseUp:u,children:(0,He.jsxs)("div",{className:"lumia-modal lumiverse-pack-detail-modal lumiverse-loom-detail-modal",onClick:u,role:"dialog","aria-modal":"true",children:[(0,He.jsxs)("div",{className:"lumiverse-pack-detail-header",children:[(0,He.jsxs)("div",{className:"lumiverse-pack-detail-header-info",children:[(0,He.jsx)("span",{className:"lumiverse-pack-detail-header-icon",children:a.packCover?(0,He.jsx)("img",{src:a.packCover,alt:t}):(0,He.jsx)(bu,{size:24,strokeWidth:1.5})}),(0,He.jsxs)("div",{className:"lumiverse-pack-detail-header-text",children:[(0,He.jsx)("h3",{className:"lumiverse-pack-detail-title",children:t}),(0,He.jsxs)("div",{className:"lumiverse-pack-detail-stats",children:[(0,He.jsxs)("span",{children:[(0,He.jsx)(fu,{size:12})," ",o.styles," Style",1!==o.styles?"s":""]}),(0,He.jsxs)("span",{children:[(0,He.jsx)(gu,{size:12})," ",o.utilities," Utilit",1!==o.utilities?"ies":"y"]}),(0,He.jsxs)("span",{children:[(0,He.jsx)(bu,{size:12})," ",o.retrofits," Retrofit",1!==o.retrofits?"s":""]})]})]})]}),(0,He.jsx)("button",{className:"lumiverse-pack-detail-close",onClick:l,title:"Close",type:"button",children:(0,He.jsx)(hu,{size:20,strokeWidth:2})})]}),(0,He.jsx)("div",{className:"lumiverse-pack-detail-content",children:0===s?(0,He.jsxs)("div",{className:"lumiverse-pack-detail-empty",children:[(0,He.jsx)(bu,{size:32,strokeWidth:1.5}),(0,He.jsx)("p",{children:"No Loom items found in this pack"})]}):(0,He.jsxs)("div",{className:"lumiverse-loom-detail-categories",children:[(0,He.jsx)(pm,{category:"Narrative Style",items:r["Narrative Style"],packName:t,selections:n,actions:e}),(0,He.jsx)(pm,{category:"Loom Utilities",items:r["Loom Utilities"],packName:t,selections:n,actions:e}),(0,He.jsx)(pm,{category:"Retrofits",items:r.Retrofits,packName:t,selections:n,actions:e})]})})]})}),document.body):null};const vm=function(){jn();const e=un(),n=Pn();return(0,He.jsxs)("div",{className:"lumiverse-app",children:[(0,He.jsx)(Wu,{}),(0,He.jsx)(Yd,{}),(0,He.jsx)(am,{}),(0,He.jsx)(hm,{}),n.isLoading&&(0,He.jsx)("div",{className:"lumiverse-loading-overlay",children:(0,He.jsx)("div",{className:"lumiverse-spinner"})}),n.error&&(0,He.jsxs)("div",{className:"lumiverse-error-toast",onClick:e.clearError,children:[(0,He.jsx)("span",{children:n.error}),(0,He.jsx)("button",{className:"lumiverse-error-dismiss",children:"Dismiss"})]})]})},fm=In("message-square",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]]),gm=In("sliders-vertical",[["path",{d:"M10 8h4",key:"1sr2af"}],["path",{d:"M12 21v-9",key:"17s77i"}],["path",{d:"M12 8V3",key:"13r4qs"}],["path",{d:"M17 16h4",key:"h1uq16"}],["path",{d:"M19 12V3",key:"o1uvq1"}],["path",{d:"M19 21v-5",key:"qua636"}],["path",{d:"M3 14h4",key:"bcjad9"}],["path",{d:"M5 10V3",key:"cb8scm"}],["path",{d:"M5 21v-7",key:"1w1uti"}]]),bm=on,xm={useDefault:!0,xPercent:1,yPercent:1},ym=()=>{var e;return null!==(e=bm.getState().lumiaButtonPosition)&&void 0!==e?e:xm};function km(e){let{isVisible:n,onClick:t}=e;return(0,He.jsxs)("button",{className:Ln("lumiverse-panel-toggle",n&&"lumiverse-panel-toggle--active"),onClick:t,title:n?"Hide Lumiverse Panel":"Show Lumiverse Panel",type:"button",children:[(0,He.jsx)("span",{className:"lumiverse-panel-toggle-icon",children:(0,He.jsx)(fu,{size:18,strokeWidth:2})}),(0,He.jsx)("span",{className:"lumiverse-panel-toggle-label",children:"Lumia"})]})}function wm(e){let{id:n,Icon:t,label:i,isActive:a,onClick:r}=e;return(0,He.jsxs)("button",{className:Ln("lumiverse-vp-tab",a&&"lumiverse-vp-tab--active"),onClick:()=>r(n),title:i,type:"button",children:[(0,He.jsx)("span",{className:"lumiverse-vp-tab-icon",children:(0,He.jsx)(t,{size:20,strokeWidth:1.5})}),(0,He.jsx)("span",{className:"lumiverse-vp-tab-label",children:i})]})}function jm(e){let{isCollapsed:n,onClick:t}=e;return(0,He.jsx)("button",{className:"lumiverse-vp-collapse-btn",onClick:t,title:n?"Expand panel":"Collapse panel",type:"button",children:(0,He.jsx)("span",{className:Ln("lumiverse-vp-collapse-icon",n&&"lumiverse-vp-collapse-icon--rotated"),children:(0,He.jsx)(vd,{size:18,strokeWidth:2})})})}function Sm(e){let{title:n,Icon:t,onClose:i}=e;return(0,He.jsxs)("div",{className:"lumiverse-vp-header",children:[(0,He.jsx)("span",{className:"lumiverse-vp-header-icon",children:(0,He.jsx)(t,{size:18,strokeWidth:1.5})}),(0,He.jsx)("span",{className:"lumiverse-vp-header-title",children:n}),(0,He.jsx)("button",{className:"lumiverse-vp-close-btn",onClick:i,title:"Close panel",type:"button",children:(0,He.jsx)(hu,{size:16,strokeWidth:2})})]})}const Cm=[{id:"profile",Icon:xd,label:"Profile",title:"Character Lumia Profile"},{id:"presets",Icon:du,label:"Presets",title:"Lumia Presets"},{id:"browser",Icon:Rn,label:"Packs",title:"Pack Browser"},{id:"ooc",Icon:fm,label:"OOC",title:"OOC Settings"},{id:"prompt",Icon:gm,label:"Prompt",title:"Prompt Settings"},{id:"council",Icon:cu,label:"Council",title:"Council of Lumiae"},{id:"summary",Icon:Gd,label:"Summary",title:"Summary Editor"}];function Nm(e){let{tab:n}=e;const t={profile:{Icon:xd,title:"Character Lumia Profile",description:"View and manage Lumia traits for the current character"},presets:{Icon:du,title:"Lumia Presets",description:"Save and load preset configurations for quick switching"},browser:{Icon:Rn,title:"Pack Browser",description:"Browse and search through all loaded packs with previews"},ooc:{Icon:fm,title:"OOC Settings",description:"Configure out-of-character comment behavior and triggers"},prompt:{Icon:gm,title:"Prompt Settings",description:"Configure prompt injection and formatting options"},council:{Icon:cu,title:"Council of Lumiae",description:"Manage multiple independent Lumias that collaborate as a council"},summary:{Icon:Gd,title:"Summary Editor",description:"View and edit the current conversation summary"}}[n]||{},{Icon:i}=t;return(0,He.jsxs)("div",{className:"lumiverse-vp-placeholder",children:[i&&(0,He.jsx)("span",{className:"lumiverse-vp-placeholder-icon",children:(0,He.jsx)(i,{size:32,strokeWidth:1.5})}),(0,He.jsx)("h3",{children:t.title}),(0,He.jsx)("p",{children:t.description}),(0,He.jsx)("span",{className:"lumiverse-vp-placeholder-badge",children:"Coming Soon"})]})}const Pm=function(e){let{isVisible:n,onToggle:t,onClose:i,defaultTab:a="profile",ProfileContent:r,PresetsContent:o,BrowserContent:s,OOCContent:l,PromptContent:c,CouncilContent:u,SummaryContent:d}=e;const[m,p]=(0,Ue.useState)(a),[h,v]=(0,Ue.useState)(!1),f=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:600;const[n,t]=(0,Ue.useState)("undefined"!=typeof window&&window.innerWidth<=e);return(0,Ue.useEffect)(()=>{const n=()=>{const n=window.innerWidth<=e;t(e=>e!==n?n:e)};return window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[e]),n}(),g=(0,Ue.useSyncExternalStore)(bm.subscribe,ym,ym),b=!g.useDefault,x=f?window.innerWidth:376,y=f?window.innerWidth-56:320,k=(0,Ue.useCallback)(e=>{h&&v(!1),p(e)},[h]),w=(0,Ue.useCallback)(()=>{v(e=>!e)},[]),j=Cm.find(e=>e.id===m),S=(0,Ue.useMemo)(()=>({profile:r?(0,He.jsx)(r,{onTabChange:k}):(0,He.jsx)(Nm,{tab:"profile"}),presets:o?(0,He.jsx)(o,{}):(0,He.jsx)(Nm,{tab:"presets"}),browser:s?(0,He.jsx)(s,{}):(0,He.jsx)(Nm,{tab:"browser"}),ooc:l?(0,He.jsx)(l,{}):(0,He.jsx)(Nm,{tab:"ooc"}),prompt:c?(0,He.jsx)(c,{}):(0,He.jsx)(Nm,{tab:"prompt"}),council:u?(0,He.jsx)(u,{}):(0,He.jsx)(Nm,{tab:"council"}),summary:d?(0,He.jsx)(d,{}):(0,He.jsx)(Nm,{tab:"summary"})}),[r,o,s,l,c,u,d,k]);return(0,He.jsxs)(He.Fragment,{children:[(0,He.jsx)("div",{className:Ln("lumiverse-toggle-container",b&&"lumiverse-toggle-container--custom"),style:b?{position:"fixed",top:0,right:"".concat(g.xPercent,"%"),marginTop:"".concat(g.yPercent,"vh"),marginRight:0,zIndex:9997,pointerEvents:"auto",display:f&&n?"none":"block"}:{position:"fixed",top:12,right:n?h?68:x+12:12,zIndex:9997,pointerEvents:"auto",transition:"right 0.25s cubic-bezier(0.4, 0, 0.2, 1)",display:f&&n?"none":"block"},children:(0,He.jsx)(km,{isVisible:n,onClick:t})}),(0,He.jsx)("div",{className:"lumiverse-viewport-wrapper",style:{position:"fixed",top:0,right:0,bottom:0,width:x,zIndex:9998,transform:"translateX(".concat(n?0:x,"px)"),transition:"transform 0.25s cubic-bezier(0.4, 0, 0.2, 1)",pointerEvents:"none"},children:(0,He.jsxs)("div",{className:Ln("lumiverse-viewport-panel",h&&"lumiverse-viewport-panel--collapsed"),style:{transform:h?"translateX(".concat(y,"px)"):"translateX(0)",transition:"transform 0.2s ease"},children:[(0,He.jsxs)("div",{className:"lumiverse-vp-tabs",children:[Cm.map(e=>(0,He.jsx)(wm,{id:e.id,Icon:e.Icon,label:e.label,isActive:m===e.id,onClick:k},e.id)),(0,He.jsx)("div",{className:"lumiverse-vp-tabs-spacer"}),(0,He.jsx)(jm,{isCollapsed:h,onClick:w})]}),(0,He.jsxs)("div",{className:"lumiverse-vp-main",style:{width:y,opacity:h?0:1,transition:"opacity 0.2s ease"},children:[(0,He.jsx)(Sm,{title:(null==j?void 0:j.title)||"Panel",Icon:(null==j?void 0:j.Icon)||xd,onClose:i}),(0,He.jsx)("div",{className:"lumiverse-vp-content",children:Cm.map(e=>(0,He.jsx)("div",{className:Ln("lumiverse-vp-tab-content",m===e.id&&"lumiverse-vp-tab-content--active"),"aria-hidden":m!==e.id,children:S[e.id]},e.id))})]})]})})]})},Mm=In("star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]),Em=In("arrow-right",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),Lm=on,Dm=[],Om=()=>Lm.getState().chatChangeCounter||0,Tm=()=>Lm.getState().chimeraMode||!1,zm=()=>Lm.getState().selectedDefinitions||Dm,Am=()=>Lm.getState().councilMode||!1,Im=()=>Lm.getState().councilMembers||Dm;function Rm(e){return(null==e?void 0:e.id)||(null==e?void 0:e.itemName)||(null==e?void 0:e.lumiaDefName)||null}function Bm(e,n){if(!e||!n)return!1;const t=Rm(e),i=Rm(n);return t&&i&&t===i}const _m=(0,Ue.forwardRef)(function(e,n){let{trait:t,type:i,isDominant:a,onRemove:r}=e;const o={definition:{bg:"rgba(100, 200, 255, 0.15)",border:"rgba(100, 200, 255, 0.3)",Icon:Gd},behavior:{bg:"rgba(255, 180, 100, 0.15)",border:"rgba(255, 180, 100, 0.3)",Icon:Md},personality:{bg:"rgba(200, 100, 255, 0.15)",border:"rgba(200, 100, 255, 0.3)",Icon:Ed}},s=o[i]||o.definition,{Icon:l}=s;return(0,He.jsxs)(lu.div,{ref:n,className:Ln("lumiverse-trait-card",a&&"lumiverse-trait-card--dominant"),style:{background:s.bg,borderColor:s.border},initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.1},children:[(0,He.jsx)("span",{className:"lumiverse-trait-icon",children:(0,He.jsx)(l,{size:16,strokeWidth:1.5})}),(0,He.jsxs)("div",{className:"lumiverse-trait-info",children:[(0,He.jsx)("span",{className:"lumiverse-trait-name",children:t.name||t.itemName||t.lumiaDefName||"Unknown"}),a&&(0,He.jsxs)("span",{className:"lumiverse-trait-dominant-badge",children:[(0,He.jsx)(Mm,{size:12,strokeWidth:2})," Dominant"]})]}),r&&(0,He.jsx)("button",{className:"lumiverse-trait-remove",onClick:()=>r(t),title:"Remove trait",type:"button",children:(0,He.jsx)(hu,{size:14,strokeWidth:2})})]})});function Fm(e){let{Icon:n,title:t,count:i}=e;return(0,He.jsxs)("div",{className:"lumiverse-profile-section-header",children:[(0,He.jsx)("span",{className:"lumiverse-profile-section-icon",children:(0,He.jsx)(n,{size:16,strokeWidth:1.5})}),(0,He.jsx)("span",{className:"lumiverse-profile-section-title",children:t}),void 0!==i&&(0,He.jsx)("span",{className:"lumiverse-profile-section-count",children:i})]})}function Um(e){let{message:n}=e;return(0,He.jsx)("div",{className:"lumiverse-profile-empty",children:(0,He.jsx)("span",{children:n})})}function Vm(e){let{councilMembers:n,allPacks:t,onManageCouncil:i}=e;const a=n.length,r=n.reduce((e,n)=>{var t;return e+((null===(t=n.behaviors)||void 0===t?void 0:t.length)||0)},0),o=n.reduce((e,n)=>{var t;return e+((null===(t=n.personalities)||void 0===t?void 0:t.length)||0)},0),s=n.slice(0,4),l=a-4;return(0,He.jsxs)("div",{className:"lumiverse-council-banner",children:[(0,He.jsx)("div",{className:"lumiverse-council-banner-icon",children:(0,He.jsx)(cu,{size:28,strokeWidth:1.5})}),(0,He.jsxs)("div",{className:"lumiverse-council-banner-content",children:[(0,He.jsx)("h4",{className:"lumiverse-council-banner-title",children:"Council of Lumiae Active"}),(0,He.jsxs)("div",{className:"lumiverse-council-banner-stats",children:[(0,He.jsxs)("span",{className:"lumiverse-council-banner-stat",children:[(0,He.jsx)(cu,{size:14})," ",a," member",1!==a?"s":""]}),(0,He.jsxs)("span",{className:"lumiverse-council-banner-stat",children:[(0,He.jsx)(Md,{size:14})," ",r," behavior",1!==r?"s":""]}),(0,He.jsxs)("span",{className:"lumiverse-council-banner-stat",children:[(0,He.jsx)(Ed,{size:14})," ",o," personalit",1!==o?"ies":"y"]})]}),s.length>0&&(0,He.jsxs)("div",{className:"lumiverse-council-banner-avatars",children:[s.map((e,n)=>{const i=function(e,n,t){var i;const a=(Array.isArray(e)?e:Object.values(e||{})).find(e=>e.name===n);if(!a)return null;const r=null===(i=a.items)||void 0===i?void 0:i.find(e=>e.lumiaDefName===t);return(null==r?void 0:r.lumia_img)||null}(t,e.packName,e.itemName);return(0,He.jsx)("div",{className:"lumiverse-council-banner-avatar",style:{zIndex:s.length-n},title:e.itemName,children:i?(0,He.jsx)("img",{src:i,alt:e.itemName}):(0,He.jsx)(cu,{size:14})},e.id)}),l>0&&(0,He.jsxs)("div",{className:"lumiverse-council-banner-more",children:["+",l]})]})]}),i&&(0,He.jsxs)("button",{className:"lumiverse-council-banner-btn",onClick:i,type:"button",children:["Manage Council ",(0,He.jsx)(Em,{size:16})]})]})}function Hm(){const e=Cn(),{styles:n,utilities:t,retrofits:i}=e;return n.length>0||t.length>0||i.length>0?(0,He.jsxs)("div",{className:"lumiverse-profile-section",children:[(0,He.jsx)(Fm,{Icon:fu,title:"Loom Configuration"}),(0,He.jsxs)("div",{className:"lumiverse-loom-summary",children:[n.length>0&&(0,He.jsxs)("div",{className:"lumiverse-loom-group",children:[(0,He.jsx)("span",{className:"lumiverse-loom-label",children:"Styles:"}),(0,He.jsx)("span",{className:"lumiverse-loom-items",children:n.map(e=>e.name||e.itemName||"Unknown").join(", ")})]}),t.length>0&&(0,He.jsxs)("div",{className:"lumiverse-loom-group",children:[(0,He.jsx)("span",{className:"lumiverse-loom-label",children:"Utilities:"}),(0,He.jsx)("span",{className:"lumiverse-loom-items",children:t.map(e=>e.name||e.itemName||"Unknown").join(", ")})]}),i.length>0&&(0,He.jsxs)("div",{className:"lumiverse-loom-group",children:[(0,He.jsx)("span",{className:"lumiverse-loom-label",children:"Retrofits:"}),(0,He.jsx)("span",{className:"lumiverse-loom-items",children:i.map(e=>e.name||e.itemName||"Unknown").join(", ")})]})]})]}):(0,He.jsxs)("div",{className:"lumiverse-profile-section",children:[(0,He.jsx)(Fm,{Icon:fu,title:"Loom Configuration"}),(0,He.jsx)(Um,{message:"No Loom items selected"})]})}const Wm=function(e){var n,t;let{onTabChange:i}=e;const a=function(){const e=(0,Ue.useSyncExternalStore)(Lm.subscribe,Om,()=>0);return(0,Ue.useMemo)(()=>{if("undefined"!=typeof SillyTavern)try{const e=SillyTavern.getContext();if(null!=e&&e.characters&&void 0!==(null==e?void 0:e.characterId)){const n=e.characters[e.characterId];return{name:(null==n?void 0:n.name)||"Unknown",avatar:null!=n&&n.avatar?"/characters/".concat(encodeURIComponent(n.avatar)):null,description:(null==n?void 0:n.description)||""}}}catch(e){console.warn("[LumiverseUI] Could not get character:",e)}return{name:"No Character",avatar:null,description:""}},[e])}(),r=Sn(),{allPacks:o}=Nn(),s=(0,Ue.useSyncExternalStore)(Lm.subscribe,Tm,Tm),l=(0,Ue.useSyncExternalStore)(Lm.subscribe,zm,zm),c=(0,Ue.useSyncExternalStore)(Lm.subscribe,Am,Am),u=(0,Ue.useSyncExternalStore)(Lm.subscribe,Im,Im),d=c&&u.length>0,m=s?l.length:r.definition?1:0,p=(0,Ue.useMemo)(()=>{var e,n;return{behaviors:(null===(e=r.behaviors)||void 0===e?void 0:e.length)||0,personalities:(null===(n=r.personalities)||void 0===n?void 0:n.length)||0,hasDefinition:!!r.definition,definitionCount:m,totalPacks:o.length}},[r,o,m]);return(0,He.jsxs)("div",{className:"lumiverse-character-profile",children:[(0,He.jsxs)("div",{className:"lumiverse-profile-header",children:[(0,He.jsx)("div",{className:"lumiverse-profile-avatar",children:a.avatar?(0,He.jsx)("img",{src:a.avatar,alt:a.name}):(0,He.jsx)("span",{className:"lumiverse-profile-avatar-placeholder",children:(0,He.jsx)(xd,{size:32,strokeWidth:1.5})})}),(0,He.jsxs)("div",{className:"lumiverse-profile-info",children:[(0,He.jsx)("h3",{className:"lumiverse-profile-name",children:a.name}),(0,He.jsxs)("div",{className:"lumiverse-profile-stats",children:[(0,He.jsxs)("span",{className:"lumiverse-stat",title:"Behaviors",children:[(0,He.jsx)(Md,{size:14,strokeWidth:1.5,className:"lumiverse-stat-icon"}),(0,He.jsx)("span",{className:"lumiverse-stat-value",children:p.behaviors})]}),(0,He.jsxs)("span",{className:"lumiverse-stat",title:"Personalities",children:[(0,He.jsx)(Ed,{size:14,strokeWidth:1.5,className:"lumiverse-stat-icon"}),(0,He.jsx)("span",{className:"lumiverse-stat-value",children:p.personalities})]}),(0,He.jsxs)("span",{className:"lumiverse-stat",title:"Packs",children:[(0,He.jsx)(Rn,{size:14,strokeWidth:1.5,className:"lumiverse-stat-icon"}),(0,He.jsx)("span",{className:"lumiverse-stat-value",children:p.totalPacks})]})]})]})]}),d?(0,He.jsx)(Vm,{councilMembers:u,allPacks:o,onManageCouncil:()=>{i&&i("council")}}):(0,He.jsxs)(He.Fragment,{children:[(0,He.jsxs)("div",{className:"lumiverse-profile-section",children:[(0,He.jsx)(Fm,{Icon:s?bu:Gd,title:s?"Chimera Definitions":"Definition",count:p.definitionCount}),(0,He.jsx)("div",{className:"lumiverse-traits-list",children:(0,He.jsx)(vt,{initial:!1,children:s?l.length>0?l.map((e,n)=>(0,He.jsx)(_m,{trait:e,type:"definition"},Rm(e)||"def-".concat(n))):(0,He.jsx)(Um,{message:"No Chimera forms selected"}):r.definition?(0,He.jsx)(_m,{trait:r.definition,type:"definition"},Rm(r.definition)||"def"):(0,He.jsx)(Um,{message:"No definition selected"})})})]}),(0,He.jsxs)("div",{className:"lumiverse-profile-section",children:[(0,He.jsx)(Fm,{Icon:Md,title:"Behaviors",count:p.behaviors}),(0,He.jsx)("div",{className:"lumiverse-traits-list",children:(0,He.jsx)(vt,{initial:!1,children:(null===(n=r.behaviors)||void 0===n?void 0:n.length)>0?r.behaviors.map(e=>(0,He.jsx)(_m,{trait:e,type:"behavior",isDominant:Bm(r.dominantBehavior,e)},Rm(e))):(0,He.jsx)(Um,{message:"No behaviors selected"})})})]}),(0,He.jsxs)("div",{className:"lumiverse-profile-section",children:[(0,He.jsx)(Fm,{Icon:Ed,title:"Personalities",count:p.personalities}),(0,He.jsx)("div",{className:"lumiverse-traits-list",children:(0,He.jsx)(vt,{initial:!1,children:(null===(t=r.personalities)||void 0===t?void 0:t.length)>0?r.personalities.map(e=>(0,He.jsx)(_m,{trait:e,type:"personality",isDominant:Bm(r.dominantPersonality,e)},Rm(e))):(0,He.jsx)(Um,{message:"No personalities selected"})})})]})]}),(0,He.jsx)(Hm,{})]})},$m=In("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),qm=In("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),Ym=on,Km={},Gm=()=>Ym.getState().presets||Km,Qm=()=>Ym.getState().activePresetName;function Zm(e){if(!e)return"";const n=Date.now()-e,t=Math.floor(n/6e4);if(t<1)return"Just now";if(t<60)return"".concat(t,"m ago");const i=Math.floor(t/60);if(i<24)return"".concat(i,"h ago");const a=Math.floor(i/24);return a<7?"".concat(a,"d ago"):new Date(e).toLocaleDateString()}function Xm(e){let{preset:n,isActive:t,onLoad:i,onUpdate:a,onDelete:r}=e;const[o,s]=(0,Ue.useState)(!1),l=(0,Ue.useMemo)(()=>{var e,t,i,a,r,o;if(n.councilMode&&(null===(e=n.councilMembers)||void 0===e?void 0:e.length)>0){return{isCouncil:!0,members:n.councilMembers.length,behaviors:n.councilMembers.reduce((e,n)=>{var t;return e+((null===(t=n.behaviors)||void 0===t?void 0:t.length)||0)},0),personalities:n.councilMembers.reduce((e,n)=>{var t;return e+((null===(t=n.personalities)||void 0===t?void 0:t.length)||0)},0)}}return n.chimeraMode&&(null===(t=n.selectedDefinitions)||void 0===t?void 0:t.length)>0?{isChimera:!0,definitions:n.selectedDefinitions.length,behaviors:(null===(i=n.selectedBehaviors)||void 0===i?void 0:i.length)||0,personalities:(null===(a=n.selectedPersonalities)||void 0===a?void 0:a.length)||0}:{definitions:n.selectedDefinition?1:0,behaviors:(null===(r=n.selectedBehaviors)||void 0===r?void 0:r.length)||0,personalities:(null===(o=n.selectedPersonalities)||void 0===o?void 0:o.length)||0}},[n]);return(0,He.jsxs)("div",{className:Ln("lumiverse-preset-card",t&&"lumiverse-preset-card--active"),children:[(0,He.jsxs)("div",{className:"lumiverse-preset-card-header",children:[(0,He.jsx)("span",{className:"lumiverse-preset-card-icon",children:(0,He.jsx)(du,{size:16,strokeWidth:1.5})}),(0,He.jsx)("span",{className:"lumiverse-preset-card-name",children:n.name}),t&&(0,He.jsxs)("span",{className:"lumiverse-preset-card-active-badge",children:[(0,He.jsx)(pu,{size:12,strokeWidth:2})," Active"]})]}),(0,He.jsxs)("div",{className:"lumiverse-preset-card-meta",children:[(0,He.jsx)("div",{className:"lumiverse-preset-stats",children:l.isCouncil?(0,He.jsxs)(He.Fragment,{children:[(0,He.jsxs)("span",{className:"lumiverse-preset-stat lumiverse-preset-stat--council",children:[(0,He.jsx)(cu,{size:12,strokeWidth:1.5})," ",l.members]}),(0,He.jsxs)("span",{className:"lumiverse-preset-stat",children:[(0,He.jsx)(Md,{size:12,strokeWidth:1.5})," ",l.behaviors]}),(0,He.jsxs)("span",{className:"lumiverse-preset-stat",children:[(0,He.jsx)(Ed,{size:12,strokeWidth:1.5})," ",l.personalities]})]}):(0,He.jsxs)(He.Fragment,{children:[(0,He.jsxs)("span",{className:Ln("lumiverse-preset-stat",l.isChimera&&"lumiverse-preset-stat--chimera"),children:[(0,He.jsx)(Gd,{size:12,strokeWidth:1.5})," ",l.definitions]}),(0,He.jsxs)("span",{className:"lumiverse-preset-stat",children:[(0,He.jsx)(Md,{size:12,strokeWidth:1.5})," ",l.behaviors]}),(0,He.jsxs)("span",{className:"lumiverse-preset-stat",children:[(0,He.jsx)(Ed,{size:12,strokeWidth:1.5})," ",l.personalities]})]})}),n.chimeraMode&&(0,He.jsx)("span",{className:"lumiverse-preset-card-mode",children:"Chimera"}),n.councilMode&&(0,He.jsx)("span",{className:"lumiverse-preset-card-mode",children:"Council"}),(0,He.jsxs)("span",{className:"lumiverse-preset-card-time",children:[(0,He.jsx)($m,{size:12,strokeWidth:1.5}),Zm(n.updatedAt||n.createdAt)]})]}),(0,He.jsxs)("div",{className:"lumiverse-preset-card-actions",children:[(0,He.jsx)("button",{className:"lumiverse-preset-btn lumiverse-preset-btn--primary",onClick:()=>i(n.name),title:"Load this preset",type:"button",children:"Load"}),(0,He.jsx)("button",{className:"lumiverse-preset-btn",onClick:()=>a(n.name),title:"Update preset with current selections",type:"button",children:(0,He.jsx)(qm,{size:14,strokeWidth:1.5})}),(0,He.jsx)("button",{className:Ln("lumiverse-preset-btn lumiverse-preset-btn--danger",o&&"lumiverse-preset-btn--confirming"),onClick:()=>{o?(r(n.name),s(!1)):(s(!0),setTimeout(()=>s(!1),3e3))},title:o?"Click again to confirm":"Delete preset",type:"button",children:o?(0,He.jsx)(hu,{size:14,strokeWidth:2}):(0,He.jsx)(_n,{size:14,strokeWidth:1.5})})]})]})}function Jm(){return(0,He.jsxs)("div",{className:"lumiverse-preset-empty",children:[(0,He.jsx)("span",{className:"lumiverse-preset-empty-icon",children:(0,He.jsx)(du,{size:32,strokeWidth:1.5})}),(0,He.jsx)("h4",{children:"No Presets Saved"}),(0,He.jsx)("p",{children:"Save your current Lumia configuration as a preset to quickly switch between setups."})]})}const ep=function(){const e=un(),[n,t]=(0,Ue.useState)(""),[i,a]=(0,Ue.useState)(!1),r=(0,Ue.useSyncExternalStore)(Ym.subscribe,Gm,Gm),o=(0,Ue.useSyncExternalStore)(Ym.subscribe,Qm,Qm),s=(0,Ue.useMemo)(()=>Object.values(r).sort((e,n)=>{const t=e.updatedAt||e.createdAt||0;return(n.updatedAt||n.createdAt||0)-t}),[r]),l=(0,Ue.useCallback)(n=>{e.loadPreset(n),an()},[e]),c=(0,Ue.useCallback)(n=>{e.updatePreset(n),an()},[e]),u=(0,Ue.useCallback)(n=>{e.deletePreset(n),an()},[e]),d=(0,Ue.useCallback)(()=>{const i=n.trim();i&&(r[i]||(e.savePreset(i),an(),t(""),a(!1)))},[n,r,e]);return(0,He.jsxs)("div",{className:"lumiverse-preset-manager",children:[(0,He.jsxs)("div",{className:"lumiverse-preset-header",children:[(0,He.jsx)("h3",{className:"lumiverse-preset-title",children:"Lumia Presets"}),i?(0,He.jsxs)("div",{className:"lumiverse-preset-create-form",children:[(0,He.jsx)("input",{type:"text",className:"lumiverse-preset-input",placeholder:"Preset name...",value:n,onChange:e=>t(e.target.value),onKeyDown:e=>{"Enter"===e.key?d():"Escape"===e.key&&(a(!1),t(""))},autoFocus:!0}),(0,He.jsx)("button",{className:"lumiverse-preset-btn lumiverse-preset-btn--primary",onClick:d,disabled:!n.trim(),type:"button",children:(0,He.jsx)(pu,{size:14,strokeWidth:2})}),(0,He.jsx)("button",{className:"lumiverse-preset-btn",onClick:()=>{a(!1),t("")},type:"button",children:(0,He.jsx)(hu,{size:14,strokeWidth:2})})]}):(0,He.jsxs)("button",{className:"lumiverse-preset-create-btn",onClick:()=>a(!0),title:"Save current configuration as preset",type:"button",children:[(0,He.jsx)(uu,{size:16,strokeWidth:2}),(0,He.jsx)("span",{children:"New Preset"})]})]}),(0,He.jsx)("div",{className:"lumiverse-preset-list",children:0===s.length?(0,He.jsx)(Jm,{}):s.map(e=>(0,He.jsx)(Xm,{preset:e,isActive:o===e.name,onLoad:l,onUpdate:c,onDelete:u},e.name))}),s.length>0&&(0,He.jsx)("div",{className:"lumiverse-preset-help",children:(0,He.jsx)("p",{children:"Presets save your Lumia selections (definition, behaviors, personalities) and mode settings."})})]})};function np(e,n,t){let i,a=t.initialDeps??[],r=!0;function o(){var o,s,l;let c;t.key&&(null==(o=t.debug)?void 0:o.call(t))&&(c=Date.now());const u=e();if(!(u.length!==a.length||u.some((e,n)=>a[n]!==e)))return i;let d;if(a=u,t.key&&(null==(s=t.debug)?void 0:s.call(t))&&(d=Date.now()),i=n(...u),t.key&&(null==(l=t.debug)?void 0:l.call(t))){const e=Math.round(100*(Date.now()-c))/100,n=Math.round(100*(Date.now()-d))/100,i=n/16,a=(e,n)=>{for(e=String(e);e.length<n;)e=" "+e;return e};console.info(`%câ± ${a(n,5)} /${a(e,5)} ms`,`\n            font-size: .6rem;\n            font-weight: bold;\n            color: hsl(${Math.max(0,Math.min(120-120*i,120))}deg 100% 31%);`,null==t?void 0:t.key)}return!(null==t?void 0:t.onChange)||r&&t.skipInitialOnChange||t.onChange(i),r=!1,i}return o.updateDeps=e=>{a=e},o}function tp(e,n){if(void 0===e)throw new Error("Unexpected undefined"+(n?`: ${n}`:""));return e}const ip=(e,n,t)=>{let i;return function(...a){e.clearTimeout(i),i=e.setTimeout(()=>n.apply(this,a),t)}},ap=e=>{const{offsetWidth:n,offsetHeight:t}=e;return{width:n,height:t}},rp=e=>e,op=e=>{const n=Math.max(e.startIndex-e.overscan,0),t=Math.min(e.endIndex+e.overscan,e.count-1),i=[];for(let e=n;e<=t;e++)i.push(e);return i},sp=(e,n)=>{const t=e.scrollElement;if(!t)return;const i=e.targetWindow;if(!i)return;const a=e=>{const{width:t,height:i}=e;n({width:Math.round(t),height:Math.round(i)})};if(a(ap(t)),!i.ResizeObserver)return()=>{};const r=new i.ResizeObserver(n=>{const i=()=>{const e=n[0];if(null==e?void 0:e.borderBoxSize){const n=e.borderBoxSize[0];if(n)return void a({width:n.inlineSize,height:n.blockSize})}a(ap(t))};e.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(i):i()});return r.observe(t,{box:"border-box"}),()=>{r.unobserve(t)}},lp={passive:!0},cp="undefined"==typeof window||"onscrollend"in window,up=(e,n)=>{const t=e.scrollElement;if(!t)return;const i=e.targetWindow;if(!i)return;let a=0;const r=e.options.useScrollendEvent&&cp?()=>{}:ip(i,()=>{n(a,!1)},e.options.isScrollingResetDelay),o=i=>()=>{const{horizontal:o,isRtl:s}=e.options;a=o?t.scrollLeft*(s?-1:1):t.scrollTop,r(),n(a,i)},s=o(!0),l=o(!1);l(),t.addEventListener("scroll",s,lp);const c=e.options.useScrollendEvent&&cp;return c&&t.addEventListener("scrollend",l,lp),()=>{t.removeEventListener("scroll",s),c&&t.removeEventListener("scrollend",l)}},dp=(e,n,t)=>{if(null==n?void 0:n.borderBoxSize){const e=n.borderBoxSize[0];if(e){return Math.round(e[t.options.horizontal?"inlineSize":"blockSize"])}}return e[t.options.horizontal?"offsetWidth":"offsetHeight"]},mp=(e,{adjustments:n=0,behavior:t},i)=>{var a,r;const o=e+n;null==(r=null==(a=i.scrollElement)?void 0:a.scrollTo)||r.call(a,{[i.options.horizontal?"left":"top"]:o,behavior:t})};class pp{constructor(e){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.measurementsCache=[],this.itemSizeCache=new Map,this.laneAssignments=new Map,this.pendingMeasuredCacheIndexes=[],this.prevLanes=void 0,this.lanesChangedFlag=!1,this.lanesSettling=!1,this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let e=null;const n=()=>e||(this.targetWindow&&this.targetWindow.ResizeObserver?e=new this.targetWindow.ResizeObserver(e=>{e.forEach(e=>{const n=()=>{this._measureElement(e.target,e)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(n):n()})}):null);return{disconnect:()=>{var t;null==(t=n())||t.disconnect(),e=null},observe:e=>{var t;return null==(t=n())?void 0:t.observe(e,{box:"border-box"})},unobserve:e=>{var t;return null==(t=n())?void 0:t.unobserve(e)}}})(),this.range=null,this.setOptions=e=>{Object.entries(e).forEach(([n,t])=>{void 0===t&&delete e[n]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:rp,rangeExtractor:op,onChange:()=>{},measureElement:dp,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...e}},this.notify=e=>{var n,t;null==(t=(n=this.options).onChange)||t.call(n,this,e)},this.maybeNotify=np(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),e=>{this.notify(e)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(e=>e()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var e;const n=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==n){if(this.cleanup(),!n)return void this.maybeNotify();this.scrollElement=n,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=(null==(e=this.scrollElement)?void 0:e.window)??null,this.elementsCache.forEach(e=>{this.observer.observe(e)}),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,e=>{this.scrollRect=e,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(e,n)=>{this.scrollAdjustments=0,this.scrollDirection=n?this.getScrollOffset()<e?"forward":"backward":null,this.scrollOffset=e,this.isScrolling=n,this.maybeNotify()}))}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??("function"==typeof this.options.initialOffset?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(e,n)=>{const t=new Map,i=new Map;for(let a=n-1;a>=0;a--){const n=e[a];if(t.has(n.lane))continue;const r=i.get(n.lane);if(null==r||n.end>r.end?i.set(n.lane,n):n.end<r.end&&t.set(n.lane,!0),t.size===this.options.lanes)break}return i.size===this.options.lanes?Array.from(i.values()).sort((e,n)=>e.end===n.end?e.index-n.index:e.end-n.end)[0]:void 0},this.getMeasurementOptions=np(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled,this.options.lanes],(e,n,t,i,a,r)=>(void 0!==this.prevLanes&&this.prevLanes!==r&&(this.lanesChangedFlag=!0),this.prevLanes=r,this.pendingMeasuredCacheIndexes=[],{count:e,paddingStart:n,scrollMargin:t,getItemKey:i,enabled:a,lanes:r}),{key:!1,skipInitialOnChange:!0,onChange:()=>{this.notify(this.isScrolling)}}),this.getMeasurements=np(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:e,paddingStart:n,scrollMargin:t,getItemKey:i,enabled:a,lanes:r},o)=>{if(!a)return this.measurementsCache=[],this.itemSizeCache.clear(),this.laneAssignments.clear(),[];if(this.laneAssignments.size>e)for(const n of this.laneAssignments.keys())n>=e&&this.laneAssignments.delete(n);this.lanesChangedFlag&&(this.lanesChangedFlag=!1,this.lanesSettling=!0,this.measurementsCache=[],this.itemSizeCache.clear(),this.laneAssignments.clear(),this.pendingMeasuredCacheIndexes=[]),0===this.measurementsCache.length&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(e=>{this.itemSizeCache.set(e.key,e.size)}));const s=this.lanesSettling?0:this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[],this.lanesSettling&&this.measurementsCache.length===e&&(this.lanesSettling=!1);const l=this.measurementsCache.slice(0,s),c=new Array(r).fill(void 0);for(let e=0;e<s;e++){const n=l[e];n&&(c[n.lane]=e)}for(let a=s;a<e;a++){const e=i(a),r=this.laneAssignments.get(a);let s,u;if(void 0!==r&&this.options.lanes>1){s=r;const e=c[s],i=void 0!==e?l[e]:void 0;u=i?i.end+this.options.gap:n+t}else{const e=1===this.options.lanes?l[a-1]:this.getFurthestMeasurement(l,a);u=e?e.end+this.options.gap:n+t,s=e?e.lane:a%this.options.lanes,this.options.lanes>1&&this.laneAssignments.set(a,s)}const d=o.get(e),m="number"==typeof d?d:this.options.estimateSize(a),p=u+m;l[a]={index:a,start:u,size:m,end:p,key:e,lane:s},c[s]=a}return this.measurementsCache=l,l},{key:!1,debug:()=>this.options.debug}),this.calculateRange=np(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(e,n,t,i)=>this.range=e.length>0&&n>0?function({measurements:e,outerSize:n,scrollOffset:t,lanes:i}){const a=e.length-1,r=n=>e[n].start;if(e.length<=i)return{startIndex:0,endIndex:a};let o=hp(0,a,r,t),s=o;if(1===i)for(;s<a&&e[s].end<t+n;)s++;else if(i>1){const r=Array(i).fill(0);for(;s<a&&r.some(e=>e<t+n);){const n=e[s];r[n.lane]=n.end,s++}const l=Array(i).fill(t+n);for(;o>=0&&l.some(e=>e>=t);){const n=e[o];l[n.lane]=n.start,o--}o=Math.max(0,o-o%i),s=Math.min(a,s+(i-1-s%i))}return{startIndex:o,endIndex:s}}({measurements:e,outerSize:n,scrollOffset:t,lanes:i}):null,{key:!1,debug:()=>this.options.debug}),this.getVirtualIndexes=np(()=>{let e=null,n=null;const t=this.calculateRange();return t&&(e=t.startIndex,n=t.endIndex),this.maybeNotify.updateDeps([this.isScrolling,e,n]),[this.options.rangeExtractor,this.options.overscan,this.options.count,e,n]},(e,n,t,i,a)=>null===i||null===a?[]:e({startIndex:i,endIndex:a,overscan:n,count:t}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=e=>{const n=this.options.indexAttribute,t=e.getAttribute(n);return t?parseInt(t,10):(console.warn(`Missing attribute name '${n}={index}' on measured element.`),-1)},this._measureElement=(e,n)=>{const t=this.indexFromElement(e),i=this.measurementsCache[t];if(!i)return;const a=i.key,r=this.elementsCache.get(a);r!==e&&(r&&this.observer.unobserve(r),this.observer.observe(e),this.elementsCache.set(a,e)),e.isConnected&&this.resizeItem(t,this.options.measureElement(e,n,this))},this.resizeItem=(e,n)=>{const t=this.measurementsCache[e];if(!t)return;const i=n-(this.itemSizeCache.get(t.key)??t.size);0!==i&&((void 0!==this.shouldAdjustScrollPositionOnItemSizeChange?this.shouldAdjustScrollPositionOnItemSizeChange(t,i,this):t.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=i,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(t.index),this.itemSizeCache=new Map(this.itemSizeCache.set(t.key,n)),this.notify(!1))},this.measureElement=e=>{e?this._measureElement(e,void 0):this.elementsCache.forEach((e,n)=>{e.isConnected||(this.observer.unobserve(e),this.elementsCache.delete(n))})},this.getVirtualItems=np(()=>[this.getVirtualIndexes(),this.getMeasurements()],(e,n)=>{const t=[];for(let i=0,a=e.length;i<a;i++){const a=n[e[i]];t.push(a)}return t},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=e=>{const n=this.getMeasurements();if(0!==n.length)return tp(n[hp(0,n.length-1,e=>tp(n[e]).start,e)])},this.getOffsetForAlignment=(e,n,t=0)=>{const i=this.getSize(),a=this.getScrollOffset();"auto"===n&&(n=e>=a+i?"end":"start"),"center"===n?e+=(t-i)/2:"end"===n&&(e-=i);const r=this.getTotalSize()+this.options.scrollMargin-i;return Math.max(Math.min(r,e),0)},this.getOffsetForIndex=(e,n="auto")=>{e=Math.max(0,Math.min(e,this.options.count-1));const t=this.measurementsCache[e];if(!t)return;const i=this.getSize(),a=this.getScrollOffset();if("auto"===n)if(t.end>=a+i-this.options.scrollPaddingEnd)n="end";else{if(!(t.start<=a+this.options.scrollPaddingStart))return[a,n];n="start"}const r="end"===n?t.end+this.options.scrollPaddingEnd:t.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(r,n,t.size),n]},this.isDynamicMode=()=>this.elementsCache.size>0,this.scrollToOffset=(e,{align:n="start",behavior:t}={})=>{"smooth"===t&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(e,n),{adjustments:void 0,behavior:t})},this.scrollToIndex=(e,{align:n="auto",behavior:t}={})=>{"smooth"===t&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),e=Math.max(0,Math.min(e,this.options.count-1));let i=0;const a=n=>{if(!this.targetWindow)return;const i=this.getOffsetForIndex(e,n);if(!i)return void console.warn("Failed to get offset for index:",e);const[a,o]=i;this._scrollToOffset(a,{adjustments:void 0,behavior:t}),this.targetWindow.requestAnimationFrame(()=>{const n=this.getScrollOffset(),t=this.getOffsetForIndex(e,o);var i,a;t?(i=t[0],a=n,Math.abs(i-a)<1.01||r(o)):console.warn("Failed to get offset for index:",e)})},r=n=>{this.targetWindow&&(i++,i<10?this.targetWindow.requestAnimationFrame(()=>a(n)):console.warn(`Failed to scroll to index ${e} after 10 attempts.`))};a(n)},this.scrollBy=(e,{behavior:n}={})=>{"smooth"===n&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+e,{adjustments:void 0,behavior:n})},this.getTotalSize=()=>{var e;const n=this.getMeasurements();let t;if(0===n.length)t=this.options.paddingStart;else if(1===this.options.lanes)t=(null==(e=n[n.length-1])?void 0:e.end)??0;else{const e=Array(this.options.lanes).fill(null);let i=n.length-1;for(;i>=0&&e.some(e=>null===e);){const t=n[i];null===e[t.lane]&&(e[t.lane]=t.end),i--}t=Math.max(...e.filter(e=>null!==e))}return Math.max(t-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(e,{adjustments:n,behavior:t})=>{this.options.scrollToFn(e,{behavior:t,adjustments:n},this)},this.measure=()=>{this.itemSizeCache=new Map,this.laneAssignments=new Map,this.notify(!1)},this.setOptions(e)}}const hp=(e,n,t,i)=>{for(;e<=n;){const a=(e+n)/2|0,r=t(a);if(r<i)e=a+1;else{if(!(r>i))return a;n=a-1}}return e>0?e-1:0};const vp="undefined"!=typeof document?Ue.useLayoutEffect:Ue.useEffect;function fp(e){const n=Ue.useReducer(()=>({}),{})[1],t={...e,onChange:(t,i)=>{var a;i?(0,$u.flushSync)(n):n(),null==(a=e.onChange)||a.call(e,t,i)}},[i]=Ue.useState(()=>new pp(t));return i.setOptions(t),vp(()=>i._didMount(),[]),vp(()=>i._willUpdate()),i}const gp=In("funnel",[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]]);function bp(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,i)}return t}function xp(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?bp(Object(t),!0).forEach(function(n){yp(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):bp(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function yp(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,n||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function kp(e){let{value:n,onChange:t,placeholder:i}=e;return(0,He.jsxs)("div",{className:"lumiverse-pack-search",children:[(0,He.jsx)("span",{className:"lumiverse-pack-search-icon",children:(0,He.jsx)(Ld,{size:16,strokeWidth:1.5})}),(0,He.jsx)("input",{type:"text",className:"lumiverse-pack-search-input",placeholder:i,value:n,onChange:e=>t(e.target.value)}),n&&(0,He.jsx)("button",{className:"lumiverse-pack-search-clear",onClick:()=>t(""),type:"button",children:(0,He.jsx)(hu,{size:14,strokeWidth:2})})]})}function wp(e){let{activeFilter:n,onFilterChange:t,showSelectedOnly:i,onToggleSelectedOnly:a,selectedCount:r}=e;const o=[{id:"all",label:"All",Icon:Rn},{id:"definition",label:"Definitions",Icon:Gd},{id:"behavior",label:"Behaviors",Icon:Md},{id:"personality",label:"Personalities",Icon:Ed}];return(0,He.jsxs)("div",{className:"lumiverse-pack-filters-container",children:[(0,He.jsx)("div",{className:"lumiverse-pack-filters",children:o.map(e=>{const{Icon:i}=e;return(0,He.jsx)("button",{className:Ln("lumiverse-pack-filter",n===e.id&&"lumiverse-pack-filter--active"),onClick:()=>t(e.id),title:e.label,type:"button",children:(0,He.jsx)(i,{size:16,strokeWidth:1.5})},e.id)})}),(0,He.jsxs)("button",{className:Ln("lumiverse-pack-filter-selected-toggle",i&&"lumiverse-pack-filter-selected-toggle--active"),onClick:a,title:i?"Show all items":"Show selected only",type:"button",children:[(0,He.jsx)(gp,{size:14,strokeWidth:1.5}),r>0&&(0,He.jsx)("span",{className:"lumiverse-pack-filter-selected-count",children:r})]})]})}function jp(e){let{pack:n,isExpanded:t,onToggle:i,onViewPack:a,itemCount:r}=e;const o=n.name||n.packName||"Unknown Pack";return(0,He.jsxs)("button",{className:Ln("lumiverse-browser-pack-header",t&&"lumiverse-browser-pack-header--expanded"),onClick:i,type:"button",children:[n.packCover?(0,He.jsx)("img",{src:n.packCover,alt:o,className:"lumiverse-browser-pack-cover"}):(0,He.jsx)("div",{className:"lumiverse-browser-pack-cover-placeholder",children:n.isCustom?(0,He.jsx)(fu,{size:20,strokeWidth:1.5}):(0,He.jsx)(Rn,{size:20,strokeWidth:1.5})}),(0,He.jsxs)("div",{className:"lumiverse-browser-pack-info",children:[(0,He.jsx)("span",{className:"lumiverse-browser-pack-name",children:o}),(0,He.jsxs)("span",{className:"lumiverse-browser-pack-meta",children:[r," items",n.isCustom&&(0,He.jsx)("span",{className:"lumiverse-browser-pack-custom-badge",children:"Custom"})]})]}),(0,He.jsx)("span",{className:"lumiverse-browser-pack-view-btn",onClick:e=>{e.stopPropagation(),null==a||a(o)},title:"View pack contents",role:"button",tabIndex:0,children:(0,He.jsx)(vu,{size:16,strokeWidth:1.5})}),(0,He.jsx)("span",{className:Ln("lumiverse-browser-pack-chevron",t&&"lumiverse-browser-pack-chevron--rotated"),children:(0,He.jsx)(mu,{size:16,strokeWidth:2})})]})}function Sp(e){let{item:n,type:t,onSelect:i,isSelected:a}=e;const r={definition:{Icon:Gd,color:"rgba(100, 200, 255, 0.15)",border:"rgba(100, 200, 255, 0.3)",selectedBorder:"rgba(100, 200, 255, 0.7)"},behavior:{Icon:Md,color:"rgba(255, 180, 100, 0.15)",border:"rgba(255, 180, 100, 0.3)",selectedBorder:"rgba(255, 180, 100, 0.7)"},personality:{Icon:Ed,color:"rgba(200, 100, 255, 0.15)",border:"rgba(200, 100, 255, 0.3)",selectedBorder:"rgba(200, 100, 255, 0.7)"}},{objectPosition:o}=Mn(n.lumia_img),s=r[t]||r.definition,{Icon:l}=s,c=n.lumiaDefName||"Unknown",u="definition"===t&&n.lumiaDef?n.lumiaDef.slice(0,100):"behavior"===t&&n.lumia_behavior?n.lumia_behavior.slice(0,100):"personality"===t&&n.lumia_personality?n.lumia_personality.slice(0,100):"";return(0,He.jsxs)(lu.div,{className:Ln("lumiverse-browser-item",a&&"lumiverse-browser-item--selected"),style:{background:a?s.color.replace("0.15","0.25"):s.color,borderColor:a?s.selectedBorder:s.border},onClick:()=>null==i?void 0:i(n,t),initial:{opacity:0,y:10},animate:{opacity:1,y:0},whileHover:{scale:1.02},whileTap:{scale:.98},children:[n.lumia_img&&(0,He.jsx)("img",{src:n.lumia_img,alt:c,className:"lumiverse-browser-item-image",style:{objectPosition:o}}),(0,He.jsxs)("div",{className:"lumiverse-browser-item-content",children:[(0,He.jsxs)("div",{className:"lumiverse-browser-item-header",children:[(0,He.jsx)("span",{className:"lumiverse-browser-item-icon",children:(0,He.jsx)(l,{size:14,strokeWidth:1.5})}),(0,He.jsx)("span",{className:"lumiverse-browser-item-name",children:c}),a&&(0,He.jsx)("span",{className:"lumiverse-browser-item-check",children:(0,He.jsx)(pu,{size:14,strokeWidth:2.5})})]}),u&&(0,He.jsx)("p",{className:"lumiverse-browser-item-desc",children:u})]})]})}function Cp(e,n,t){const i=e.lumiaDefName,a=e.packName;if("definition"===n){const e=t.definition;return(null==e?void 0:e.itemName)===i&&(null==e?void 0:e.packName)===a}var r,o,s,l;return"behavior"===n?null!==(r=null===(o=t.behaviors)||void 0===o?void 0:o.some(e=>e.itemName===i&&e.packName===a))&&void 0!==r&&r:"personality"===n&&(null!==(s=null===(l=t.personalities)||void 0===l?void 0:l.some(e=>e.itemName===i&&e.packName===a))&&void 0!==s&&s)}function Np(e){let{items:n,filter:t,onSelectItem:i,selections:a}=e;const r=(0,Ue.useRef)(null),o=(0,Ue.useMemo)(()=>"all"===t?n:n.filter(e=>e.type===t),[n,t]),s=function(e){return fp({observeElementRect:sp,observeElementOffset:up,scrollToFn:mp,...e})}({count:o.length,getScrollElement:()=>r.current,estimateSize:()=>80,overscan:5});return 0===o.length?(0,He.jsx)("div",{className:"lumiverse-browser-empty-items",children:"No items match the current filter"}):(0,He.jsx)("div",{ref:r,className:"lumiverse-browser-items-container",style:{maxHeight:"300px",overflow:"auto"},children:(0,He.jsx)("div",{style:{height:"".concat(s.getTotalSize(),"px"),width:"100%",position:"relative"},children:s.getVirtualItems().map(e=>{const n=o[e.index];return(0,He.jsx)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"".concat(e.size,"px"),transform:"translateY(".concat(e.start,"px)"),padding:"4px 0"},children:(0,He.jsx)(Sp,{item:n,type:n.type,onSelect:i,isSelected:Cp(n,n.type,a)})},e.key)})})})}function Pp(e){let{pack:n,filter:t,searchQuery:i,showSelectedOnly:a,onSelectItem:r,onViewPack:o,selections:s}=e;const[l,c]=(0,Ue.useState)(!1),u=n.name||n.packName||"Unknown Pack",d=(0,Ue.useMemo)(()=>{const e=n.items||[],t=[];return e.forEach((e,n)=>{if(e.loomCategory)return;if(!e.lumiaDefName)return;const i=!!e.lumiaDef,a=!!e.lumia_behavior,r=!!e.lumia_personality;i&&t.push(xp(xp({},e),{},{type:"definition",packName:u,id:"def-".concat(u,"-").concat(e.lumiaDefName,"-").concat(n)})),a&&t.push(xp(xp({},e),{},{type:"behavior",packName:u,id:"beh-".concat(u,"-").concat(e.lumiaDefName,"-").concat(n)})),r&&t.push(xp(xp({},e),{},{type:"personality",packName:u,id:"per-".concat(u,"-").concat(e.lumiaDefName,"-").concat(n)}))}),t},[n,u]),m=(0,Ue.useMemo)(()=>{let e=d;if("all"!==t&&(e=e.filter(e=>e.type===t)),i){const n=i.toLowerCase();e=e.filter(e=>{const t=(e.lumiaDefName||"").toLowerCase(),i=(e.lumiaDef||"").toLowerCase(),a=(e.lumia_behavior||"").toLowerCase(),r=(e.lumia_personality||"").toLowerCase();return t.includes(n)||i.includes(n)||a.includes(n)||r.includes(n)})}return a&&(e=e.filter(e=>Cp(e,e.type,s))),e},[d,t,i,a,s]);return 0===m.length?null:(0,He.jsxs)("div",{className:"lumiverse-browser-pack",children:[(0,He.jsx)(jp,{pack:n,isExpanded:l,onToggle:()=>c(!l),onViewPack:o,itemCount:m.length}),(0,He.jsx)(nt,{isOpen:l,className:"lumiverse-browser-pack-items",duration:200,children:(0,He.jsx)(Np,{items:m,filter:t,onSelectItem:r,selections:s})})]})}function Mp(e){let{packs:n,customPacks:t}=e;const i=(0,Ue.useMemo)(()=>{let e=0,i=0,a=0;return[...n,...t].forEach(n=>{(n.items||[]).forEach(n=>{n.loomCategory||n.lumiaDefName&&(n.lumiaDef&&e++,n.lumia_behavior&&i++,n.lumia_personality&&a++)})}),{definitions:e,behaviors:i,personalities:a,total:n.length+t.length}},[n,t]);return(0,He.jsxs)("div",{className:"lumiverse-browser-stats",children:[(0,He.jsxs)("div",{className:"lumiverse-browser-stat",children:[(0,He.jsx)("span",{className:"lumiverse-browser-stat-value",children:i.total}),(0,He.jsx)("span",{className:"lumiverse-browser-stat-label",children:"PACKS"})]}),(0,He.jsxs)("div",{className:"lumiverse-browser-stat",children:[(0,He.jsx)("span",{className:"lumiverse-browser-stat-value",children:i.definitions}),(0,He.jsx)("span",{className:"lumiverse-browser-stat-label",children:"DEFS"})]}),(0,He.jsxs)("div",{className:"lumiverse-browser-stat",children:[(0,He.jsx)("span",{className:"lumiverse-browser-stat-value",children:i.behaviors}),(0,He.jsx)("span",{className:"lumiverse-browser-stat-label",children:"BEHAV"})]}),(0,He.jsxs)("div",{className:"lumiverse-browser-stat",children:[(0,He.jsx)("span",{className:"lumiverse-browser-stat-value",children:i.personalities}),(0,He.jsx)("span",{className:"lumiverse-browser-stat-label",children:"PERS"})]})]})}const Ep=function(){const{packs:e,customPacks:n}=Nn(),t=Sn(),i=un(),[a,r]=(0,Ue.useState)(""),[o,s]=(0,Ue.useState)("all"),[l,c]=(0,Ue.useState)(!1),u=(0,Ue.useMemo)(()=>{let e=0;return t.definition&&(e+=1),e+=(t.behaviors||[]).length,e+=(t.personalities||[]).length,e},[t]),d=(0,Ue.useMemo)(()=>[...e.map(e=>xp(xp({},e),{},{isCustom:!1})),...n.map(e=>xp(xp({},e),{},{isCustom:!0}))],[e,n]),m=(0,Ue.useCallback)((e,n)=>{console.log("[PackBrowser] Selected item:",e,n);const t={packName:e.packName,itemName:e.lumiaDefName};"definition"===n?i.setSelectedDefinition(t):"behavior"===n?i.toggleBehavior(t):"personality"===n&&i.togglePersonality(t),an()},[i]),p=(0,Ue.useCallback)(e=>{i.openPackDetail(e)},[i]);return(0,He.jsxs)("div",{className:"lumiverse-pack-browser",children:[(0,He.jsx)(Mp,{packs:e,customPacks:n}),(0,He.jsx)(kp,{value:a,onChange:r,placeholder:"Search packs and items..."}),(0,He.jsx)(wp,{activeFilter:o,onFilterChange:s,showSelectedOnly:l,onToggleSelectedOnly:()=>c(!l),selectedCount:u}),(0,He.jsx)("div",{className:"lumiverse-browser-packs",children:0===d.length?(0,He.jsxs)("div",{className:"lumiverse-browser-empty",children:[(0,He.jsx)("span",{className:"lumiverse-browser-empty-icon",children:(0,He.jsx)(Rn,{size:32,strokeWidth:1.5})}),(0,He.jsx)("p",{children:"No packs loaded"}),(0,He.jsx)("span",{className:"lumiverse-browser-empty-hint",children:"Add packs in the Settings panel"})]}):l&&0===u?(0,He.jsxs)("div",{className:"lumiverse-browser-empty",children:[(0,He.jsx)("span",{className:"lumiverse-browser-empty-icon",children:(0,He.jsx)(gp,{size:32,strokeWidth:1.5})}),(0,He.jsx)("p",{children:"No items selected"}),(0,He.jsx)("span",{className:"lumiverse-browser-empty-hint",children:"Select items to see them here, or disable the filter"})]}):d.map((e,n)=>(0,He.jsx)(Pp,{pack:e,filter:o,searchQuery:a,showSelectedOnly:l,onSelectItem:m,onViewPack:p,selections:t},e.name||e.packName||"pack-".concat(n)))})]})},Lp=In("type",[["path",{d:"M12 4v16",key:"1654pz"}],["path",{d:"M4 7V5a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v2",key:"e0r10z"}],["path",{d:"M9 20h6",key:"s66wpe"}]]),Dp=In("layout-grid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]),Op=In("quote",[["path",{d:"M16 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z",key:"rib7q0"}],["path",{d:"M5 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z",key:"1ymkrd"}]]),Tp=In("message-circle",[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]]);function zp(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,i)}return t}function Ap(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?zp(Object(t),!0).forEach(function(n){Ip(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):zp(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Ip(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,n||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const Rp=on;function Bp(e){let{id:n,Icon:t,title:i,description:a,selected:r,onChange:o}=e;return(0,He.jsxs)("label",{className:Ln("lumiverse-vp-style-option",r&&"lumiverse-vp-style-option--selected"),children:[(0,He.jsx)("input",{type:"radio",name:"ooc-style",value:n,checked:r,onChange:()=>o(n)}),(0,He.jsx)("span",{className:"lumiverse-vp-style-option-icon",children:(0,He.jsx)(t,{size:20,strokeWidth:1.5})}),(0,He.jsxs)("div",{className:"lumiverse-vp-style-option-text",children:[(0,He.jsx)("span",{className:"lumiverse-vp-style-option-title",children:i}),(0,He.jsx)("span",{className:"lumiverse-vp-style-option-desc",children:a})]})]})}function _p(e){let{id:n,label:t,hint:i,value:a,onChange:r,placeholder:o,min:s=1}=e;return(0,He.jsxs)("div",{className:"lumiverse-vp-field",children:[(0,He.jsx)("label",{className:"lumiverse-vp-field-label",htmlFor:n,children:t}),(0,He.jsx)("input",{type:"number",id:n,className:"lumiverse-vp-field-input",value:a,onChange:e=>r(e.target.value),placeholder:o,min:s}),i&&(0,He.jsx)("span",{className:"lumiverse-vp-field-hint",children:i})]})}const Fp=function(){un();const e=(0,Ue.useSyncExternalStore)(Rp.subscribe,()=>Rp.getState().lumiaOOCInterval,()=>Rp.getState().lumiaOOCInterval),n=(0,Ue.useSyncExternalStore)(Rp.subscribe,()=>Rp.getState().lumiaOOCStyle||"social",()=>Rp.getState().lumiaOOCStyle||"social"),t=(0,Ue.useCallback)(e=>{const n=e?parseInt(e,10):null;Rp.setState({lumiaOOCInterval:n}),rn()},[]),i=(0,Ue.useCallback)(e=>{if(Rp.setState({lumiaOOCStyle:e}),rn(),"undefined"!=typeof LumiverseBridge){const e=LumiverseBridge.getCallbacks();null!=e&&e.refreshOOCComments&&e.refreshOOCComments(!0)}},[]),a=[{id:"none",Icon:Lp,title:"None",description:"Raw text with no formatting"},{id:"social",Icon:Dp,title:"Social Card",description:"Full card with avatar & animations"},{id:"margin",Icon:Gd,title:"Margin Note",description:"Minimal hanging tag style"},{id:"whisper",Icon:Op,title:"Whisper Bubble",description:"Soft ethereal thought bubble"}];return(0,He.jsxs)("div",{className:"lumiverse-vp-settings-panel",children:[(0,He.jsxs)("div",{className:"lumiverse-vp-settings-section",children:[(0,He.jsxs)("div",{className:"lumiverse-vp-settings-section-header",children:[(0,He.jsx)($m,{size:16,strokeWidth:1.5}),(0,He.jsx)("span",{children:"Comment Trigger"})]}),(0,He.jsx)("p",{className:"lumiverse-vp-settings-desc",children:"Automatically inject OOC instructions at message intervals."}),(0,He.jsx)(_p,{id:"ooc-interval",label:"Message Interval",hint:"Triggers when message count is divisible by this number",value:(null==e?void 0:e.toString())||"",onChange:t,placeholder:"e.g., 10 (empty = disabled)"})]}),(0,He.jsxs)("div",{className:"lumiverse-vp-settings-section",children:[(0,He.jsxs)("div",{className:"lumiverse-vp-settings-section-header",children:[(0,He.jsx)(Tp,{size:16,strokeWidth:1.5}),(0,He.jsx)("span",{children:"Display Style"})]}),(0,He.jsx)("p",{className:"lumiverse-vp-settings-desc",children:"Choose how OOC comments appear in chat."}),(0,He.jsx)("div",{className:"lumiverse-vp-style-options",children:a.map(e=>(0,He.jsx)(Bp,Ap(Ap({},e),{},{selected:n===e.id,onChange:i}),e.id))})]})]})},Up=In("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),Vp=In("hand",[["path",{d:"M18 11V6a2 2 0 0 0-2-2a2 2 0 0 0-2 2",key:"1fvzgz"}],["path",{d:"M14 10V4a2 2 0 0 0-2-2a2 2 0 0 0-2 2v2",key:"1kc0my"}],["path",{d:"M10 10.5V6a2 2 0 0 0-2-2a2 2 0 0 0-2 2v8",key:"10h0bg"}],["path",{d:"M18 8a2 2 0 1 1 4 0v6a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15",key:"1s1gnw"}]]);function Hp(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,i)}return t}function Wp(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Hp(Object(t),!0).forEach(function(n){$p(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Hp(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function $p(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,n||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const qp=on,Yp={},Kp={enabled:!1,excludeLastMessage:!0,includeMessageInPrompt:!0},Gp=()=>qp.getState().sovereignHand||Kp,Qp=()=>qp.getState().contextFilters||Yp,Zp=()=>qp.getState().chimeraMode||!1,Xp=()=>qp.getState().councilMode||!1,Jp=()=>{var e;return(null===(e=qp.getState().selectedDefinitions)||void 0===e?void 0:e.length)||0},eh=()=>{var e;return(null===(e=qp.getState().councilMembers)||void 0===e?void 0:e.length)||0};function nh(e){let{id:n,checked:t,onChange:i,label:a,hint:r,disabled:o=!1}=e;return(0,He.jsxs)("div",{className:Ln("lumiverse-vp-toggle-row",o&&"lumiverse-vp-toggle-row--disabled"),children:[(0,He.jsxs)("label",{className:"lumiverse-vp-toggle-label",htmlFor:n,children:[(0,He.jsx)("span",{className:"lumiverse-vp-toggle-text",children:a}),r&&(0,He.jsx)("span",{className:"lumiverse-vp-toggle-hint",children:r})]}),(0,He.jsxs)("div",{className:"lumiverse-vp-toggle-switch-wrapper",children:[(0,He.jsx)("input",{type:"checkbox",id:n,className:"lumiverse-vp-toggle-input",checked:t,onChange:e=>i(e.target.checked),disabled:o}),(0,He.jsx)("label",{htmlFor:n,className:"lumiverse-vp-toggle-switch-label",children:(0,He.jsx)("div",{className:Ln("lumiverse-vp-toggle-track",t&&"lumiverse-vp-toggle-track--on",o&&"lumiverse-vp-toggle-track--disabled"),children:(0,He.jsx)("div",{className:"lumiverse-vp-toggle-thumb"})})})]})]})}function th(e){let{id:n,label:t,hint:i,value:a,onChange:r,min:o=0,max:s=100}=e;return(0,He.jsxs)("div",{className:"lumiverse-vp-field lumiverse-vp-field--inline",children:[(0,He.jsx)("label",{className:"lumiverse-vp-field-label",htmlFor:n,children:t}),(0,He.jsx)("input",{type:"number",id:n,className:"lumiverse-vp-field-input lumiverse-vp-field-input--small",value:a,onChange:e=>r(parseInt(e.target.value,10)||0),min:o,max:s}),i&&(0,He.jsx)("span",{className:"lumiverse-vp-field-hint",children:i})]})}function ih(e){let{Icon:n,title:t,status:i,children:a,defaultOpen:r=!1}=e;const[o,s]=(0,Ue.useState)(r);return(0,He.jsxs)("div",{className:Ln("lumiverse-vp-collapsible",o&&"lumiverse-vp-collapsible--open"),children:[(0,He.jsxs)("button",{className:"lumiverse-vp-collapsible-header",onClick:()=>s(!o),type:"button",children:[(0,He.jsx)("span",{className:Ln("lumiverse-vp-collapsible-chevron",o&&"lumiverse-vp-collapsible-chevron--open"),children:(0,He.jsx)(mu,{size:14,strokeWidth:2})}),(0,He.jsx)("span",{className:"lumiverse-vp-collapsible-icon",children:(0,He.jsx)(n,{size:16,strokeWidth:1.5})}),(0,He.jsx)("span",{className:"lumiverse-vp-collapsible-title",children:t}),void 0!==i&&(0,He.jsx)("span",{className:Ln("lumiverse-vp-collapsible-status",i&&"lumiverse-vp-collapsible-status--active"),children:i?"Active":"Inactive"})]}),(0,He.jsx)(nt,{isOpen:o,className:"lumiverse-vp-collapsible-content",duration:200,children:(0,He.jsx)("div",{className:"lumiverse-vp-collapsible-inner",children:a})})]})}function ah(e){let{items:n,muted:t=!1}=e;return(0,He.jsxs)("div",{className:Ln("lumiverse-vp-info-box",t&&"lumiverse-vp-info-box--muted"),children:[(0,He.jsxs)("div",{className:"lumiverse-vp-info-box-header",children:[(0,He.jsx)(Up,{size:14,strokeWidth:2}),(0,He.jsx)("span",{children:"When enabled:"})]}),(0,He.jsx)("ul",{className:"lumiverse-vp-info-box-list",children:n.map((e,n)=>(0,He.jsx)("li",{children:e},n))})]})}function rh(e){let{id:n,label:t,hint:i,enabled:a,onToggle:r,depthValue:o,onDepthChange:s,depthLabel:l,depthHint:c}=e;return(0,He.jsxs)("div",{className:"lumiverse-vp-filter-item",children:[(0,He.jsx)(nh,{id:n,checked:a,onChange:r,label:t,hint:i}),(0,He.jsx)(nt,{isOpen:a&&void 0!==o,className:"lumiverse-vp-filter-options",duration:150,children:(0,He.jsx)(th,{id:"".concat(n,"-depth"),label:l||"Keep in last N messages",hint:c,value:o,onChange:s})})]})}const oh=function(){var e,n,t,i,a,r,o,s,l,c,u,d,m,p,h,v,f;const g=un(),b=(0,Ue.useSyncExternalStore)(qp.subscribe,Gp,Gp),x=(0,Ue.useSyncExternalStore)(qp.subscribe,Qp,Qp),y=(0,Ue.useSyncExternalStore)(qp.subscribe,Zp,Zp),k=(0,Ue.useSyncExternalStore)(qp.subscribe,Xp,Xp),w=(0,Ue.useSyncExternalStore)(qp.subscribe,Jp,Jp),j=(0,Ue.useSyncExternalStore)(qp.subscribe,eh,eh),S=null!==(e=b.enabled)&&void 0!==e&&e,C=null!==(n=null===(t=x.htmlTags)||void 0===t?void 0:t.enabled)&&void 0!==n&&n,N=null!==(i=null===(a=x.htmlTags)||void 0===a?void 0:a.stripFonts)&&void 0!==i&&i,P=null!==(r=null===(o=x.htmlTags)||void 0===o?void 0:o.fontKeepDepth)&&void 0!==r?r:3,M=null!==(s=null===(l=x.detailsBlocks)||void 0===l?void 0:l.enabled)&&void 0!==s&&s,E=null!==(c=null===(u=x.detailsBlocks)||void 0===u?void 0:u.keepDepth)&&void 0!==c?c:3,L=null!==(d=null===(m=x.loomItems)||void 0===m?void 0:m.enabled)&&void 0!==d&&d,D=null!==(p=null===(h=x.loomItems)||void 0===h?void 0:h.keepDepth)&&void 0!==p?p:5,O=(0,Ue.useCallback)((e,n)=>{const t=qp.getState(),i=e.split(".");if("sovereignHand"===i[0])qp.setState({sovereignHand:Wp(Wp({},t.sovereignHand),{},{[i[1]]:n})});else if("contextFilters"===i[0]){var a;const e=i[1],r=i[2];qp.setState({contextFilters:Wp(Wp({},t.contextFilters),{},{[e]:Wp(Wp({},(null===(a=t.contextFilters)||void 0===a?void 0:a[e])||{}),{},{[r]:n})})})}an()},[]),T=C||M||L,z=(0,Ue.useCallback)(e=>{g.setChimeraMode(e),an()},[g]),A=(0,Ue.useCallback)(e=>{g.setCouncilMode(e),an()},[g]),I=y||k;return(0,He.jsxs)("div",{className:"lumiverse-vp-settings-panel",children:[(0,He.jsxs)(ih,{Icon:bu,title:"Lumia Modes",status:I,defaultOpen:!0,children:[(0,He.jsx)("p",{className:"lumiverse-vp-settings-desc",children:"Configure special Lumia modes for unique character setups. These modes are mutually exclusive."}),(0,He.jsxs)("div",{className:"lumiverse-vp-mode-option",children:[(0,He.jsx)(nh,{id:"chimera-mode-toggle",checked:y,onChange:z,label:"Chimera Mode",hint:"Fuse multiple physical definitions into one hybrid form"}),(0,He.jsx)(nt,{isOpen:y,className:"lumiverse-vp-mode-details",duration:150,children:(0,He.jsx)(ah,{items:["Select multiple definitions in the Definition modal","All selected forms will be fused into one Chimera","Currently ".concat(w," definition").concat(1!==w?"s":""," selected")]})})]}),(0,He.jsxs)("div",{className:"lumiverse-vp-mode-option",children:[(0,He.jsx)(nh,{id:"council-mode-toggle",checked:k,onChange:A,label:"Council Mode",hint:"Multiple independent Lumias that collaborate"}),(0,He.jsxs)(nt,{isOpen:k,className:"lumiverse-vp-mode-details",duration:150,children:[(0,He.jsx)(ah,{items:["Each council member has independent traits","Members can converse and collaborate","Currently ".concat(j," council member").concat(1!==j?"s":"")]}),(0,He.jsx)("p",{className:"lumiverse-vp-mode-note",children:"Configure council members in the Council tab."})]})]})]}),(0,He.jsxs)(ih,{Icon:Vp,title:"Sovereign Hand",status:S,defaultOpen:!0,children:[(0,He.jsx)("p",{className:"lumiverse-vp-settings-desc",children:"Enable Sovereign Hand integration to use advanced prompt manipulation features."}),(0,He.jsx)(nh,{id:"sovereign-hand-toggle",checked:S,onChange:e=>O("sovereignHand.enabled",e),label:"Use Sovereign Hand Features",hint:"Enables Sovereign Hand macros for advanced prompt control"}),(0,He.jsx)(nh,{id:"sovereign-hand-exclude-toggle",checked:null===(v=b.excludeLastMessage)||void 0===v||v,onChange:e=>O("sovereignHand.excludeLastMessage",e),label:"Exclude Last Message from Context",hint:"When enabled, removes the last user message from the outgoing context",disabled:!S}),(0,He.jsx)(nh,{id:"sovereign-hand-include-in-prompt-toggle",checked:null===(f=b.includeMessageInPrompt)||void 0===f||f,onChange:e=>O("sovereignHand.includeMessageInPrompt",e),label:"Include Message in Master Prompt",hint:"When enabled, includes the user message in the {{loomSovHand}} macro output",disabled:!S}),(0,He.jsx)(ah,{muted:!S,items:[(0,He.jsxs)(He.Fragment,{children:[(0,He.jsx)("code",{children:"{{loomLastUserMessage}}"})," returns the last user message"]}),(0,He.jsxs)(He.Fragment,{children:[(0,He.jsx)("code",{children:"{{loomLastCharMessage}}"})," returns the last character message"]}),(0,He.jsxs)(He.Fragment,{children:[(0,He.jsx)("code",{children:"{{lastMessageName}}"})," returns the name of whoever sent the last message"]}),(0,He.jsxs)(He.Fragment,{children:[(0,He.jsx)("code",{children:"{{loomContinuePrompt}}"})," adds continuation instructions when character spoke last"]})]})]}),(0,He.jsxs)(ih,{Icon:gp,title:"Context Filters",status:T,children:[(0,He.jsx)("p",{className:"lumiverse-vp-settings-desc",children:"Filter out specific content from the chat context before sending to the AI."}),(0,He.jsx)(rh,{id:"filter-html",label:"Strip HTML Tags",hint:"Removes formatting tags: <div>, <span>, <b>, <i>, etc.",enabled:C,onToggle:e=>O("contextFilters.htmlTags.enabled",e)}),(0,He.jsx)(nt,{isOpen:C,className:"lumiverse-vp-filter-sub",duration:200,children:(0,He.jsx)(rh,{id:"filter-fonts",label:"Also Strip Fonts",hint:"Remove <font> tags (used by some presets)",enabled:N,onToggle:e=>O("contextFilters.htmlTags.stripFonts",e),depthValue:P,onDepthChange:e=>O("contextFilters.htmlTags.fontKeepDepth",e),depthLabel:"Keep fonts in last N messages",depthHint:"Font tags in older messages will be stripped"})}),(0,He.jsx)(rh,{id:"filter-details",label:"Filter Details Blocks",hint:"Removes <details> blocks from older messages",enabled:M,onToggle:e=>O("contextFilters.detailsBlocks.enabled",e),depthValue:E,onDepthChange:e=>O("contextFilters.detailsBlocks.keepDepth",e),depthHint:"Messages beyond this depth will have <details> removed"}),(0,He.jsx)(rh,{id:"filter-loom",label:"Filter Loom Tags",hint:"Removes Lucid Loom-related tags from older messages",enabled:L,onToggle:e=>O("contextFilters.loomItems.enabled",e),depthValue:D,onDepthChange:e=>O("contextFilters.loomItems.keepDepth",e),depthHint:"Loom tags in older messages will be stripped"})]})]})};function sh(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,i)}return t}function lh(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?sh(Object(t),!0).forEach(function(n){ch(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):sh(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function ch(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,n||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const uh=on,dh=[],mh=()=>uh.getState().councilMode||!1,ph=()=>uh.getState().councilMembers||dh;function hh(e,n,t){var i;const a=(Array.isArray(e)?e.reduce((e,n)=>lh(lh({},e),{},{[n.name]:n}),{}):e)[n];if(!a)return t;const r=null===(i=a.items)||void 0===i?void 0:i.find(e=>e.lumiaDefName===t);return(null==r?void 0:r.lumiaDefName)||t}function vh(e){var n,t;let{member:i,packs:a,onUpdate:r,onRemove:o}=e;const[s,l]=(0,Ue.useState)(!1),[c,u]=(0,Ue.useState)(!1),[d,m]=(0,Ue.useState)(i.role||""),p=hh(a,i.packName,i.itemName),h=function(e,n,t){var i;const a=(Array.isArray(e)?e.reduce((e,n)=>lh(lh({},e),{},{[n.name]:n}),{}):e)[n];if(!a)return null;const r=null===(i=a.items)||void 0===i?void 0:i.find(e=>e.lumiaDefName===t);return(null==r?void 0:r.lumia_img)||null}(a,i.packName,i.itemName),v=()=>{r(i.id,{role:d}),u(!1)},f=(null===(n=i.behaviors)||void 0===n?void 0:n.length)||0,g=(null===(t=i.personalities)||void 0===t?void 0:t.length)||0;return(0,He.jsxs)("div",{className:"lumiverse-council-member",children:[(0,He.jsxs)("div",{className:"lumiverse-council-member-header",onClick:()=>l(!s),children:[(0,He.jsx)("div",{className:"lumiverse-council-member-avatar",children:h?(0,He.jsx)("img",{src:h,alt:p}):(0,He.jsx)(cu,{size:20,strokeWidth:1.5})}),(0,He.jsxs)("div",{className:"lumiverse-council-member-info",children:[(0,He.jsx)("span",{className:"lumiverse-council-member-name",children:p}),i.role&&!c&&(0,He.jsx)("span",{className:"lumiverse-council-member-role",children:i.role}),(0,He.jsxs)("div",{className:"lumiverse-council-member-stats",children:[(0,He.jsxs)("span",{className:"lumiverse-council-stat",children:[(0,He.jsx)(Md,{size:12})," ",f]}),(0,He.jsxs)("span",{className:"lumiverse-council-stat",children:[(0,He.jsx)(Ed,{size:12})," ",g]})]})]}),(0,He.jsxs)("div",{className:"lumiverse-council-member-actions",children:[(0,He.jsx)("button",{className:"lumiverse-council-btn",onClick:e=>{e.stopPropagation(),u(!0),l(!0)},title:"Edit role",type:"button",children:(0,He.jsx)(Bn,{size:14,strokeWidth:1.5})}),(0,He.jsx)("button",{className:"lumiverse-council-btn lumiverse-council-btn--danger",onClick:e=>{e.stopPropagation(),o(i.id)},title:"Remove from council",type:"button",children:(0,He.jsx)(_n,{size:14,strokeWidth:1.5})}),(0,He.jsx)("span",{className:Ln("lumiverse-council-expand",s&&"lumiverse-council-expand--open"),children:(0,He.jsx)(mu,{size:16,strokeWidth:2})})]})]}),s&&(0,He.jsxs)("div",{className:"lumiverse-council-member-body",children:[c?(0,He.jsxs)("div",{className:"lumiverse-council-role-edit",children:[(0,He.jsx)("label",{children:"Role/Title:"}),(0,He.jsxs)("div",{className:"lumiverse-council-role-input-row",children:[(0,He.jsx)("input",{type:"text",className:"lumiverse-council-input",placeholder:"e.g., Leader, Advisor, Wildcard...",value:d,onChange:e=>m(e.target.value),onKeyDown:e=>{"Enter"===e.key&&v(),"Escape"===e.key&&(m(i.role||""),u(!1))},autoFocus:!0}),(0,He.jsx)("button",{className:"lumiverse-council-btn lumiverse-council-btn--primary",onClick:v,type:"button",children:(0,He.jsx)(pu,{size:14,strokeWidth:2})}),(0,He.jsx)("button",{className:"lumiverse-council-btn",onClick:()=>{m(i.role||""),u(!1)},type:"button",children:(0,He.jsx)(hu,{size:14,strokeWidth:2})})]})]}):(0,He.jsxs)("div",{className:"lumiverse-council-role-display",children:[(0,He.jsx)("span",{className:"lumiverse-council-role-label",children:"Role:"}),(0,He.jsx)("span",{className:"lumiverse-council-role-value",children:i.role||(0,He.jsx)("em",{children:"No role set"})})]}),(0,He.jsxs)("div",{className:"lumiverse-council-traits-section",children:[(0,He.jsxs)("div",{className:"lumiverse-council-traits-group",children:[(0,He.jsxs)("span",{className:"lumiverse-council-traits-label",children:[(0,He.jsx)(Md,{size:14,strokeWidth:1.5})," Behaviors:"]}),f>0?(0,He.jsx)("span",{className:"lumiverse-council-traits-list",children:i.behaviors.map(e=>hh(a,e.packName,e.itemName)).join(", ")}):(0,He.jsx)("span",{className:"lumiverse-council-traits-empty",children:"None selected"})]}),(0,He.jsxs)("div",{className:"lumiverse-council-traits-group",children:[(0,He.jsxs)("span",{className:"lumiverse-council-traits-label",children:[(0,He.jsx)(Ed,{size:14,strokeWidth:1.5})," Personalities:"]}),g>0?(0,He.jsx)("span",{className:"lumiverse-council-traits-list",children:i.personalities.map(e=>hh(a,e.packName,e.itemName)).join(", ")}):(0,He.jsx)("span",{className:"lumiverse-council-traits-empty",children:"None selected"})]})]}),(0,He.jsx)("p",{className:"lumiverse-council-help-text",children:"Each member's inherent traits are auto-attached when added. Additional trait configuration coming soon."})]})]})}function fh(e){let{packs:n,existingMembers:t,onAdd:i,onClose:a}=e;const[r,o]=(0,Ue.useState)(""),s=(0,Ue.useMemo)(()=>{const e=new Set(t.map(e=>"".concat(e.packName,":").concat(e.itemName))),i=[];if((Array.isArray(n)?n:Object.values(n||{})).forEach(n=>{const t=n.name||n.packName;(n.items||[]).forEach(n=>{if(!n.lumiaDefName||!n.lumiaDef)return;const a="".concat(t,":").concat(n.lumiaDefName);e.has(a)||i.push({packName:t,itemName:n.lumiaDefName,displayName:n.lumiaDefName,image:n.lumia_img})})}),r.trim()){const e=r.toLowerCase();return i.filter(n=>n.displayName.toLowerCase().includes(e)||n.packName.toLowerCase().includes(e))}return i},[n,t,r]);return(0,He.jsxs)("div",{className:"lumiverse-council-add-dropdown",children:[(0,He.jsxs)("div",{className:"lumiverse-council-add-header",children:[(0,He.jsx)("input",{type:"text",className:"lumiverse-council-search",placeholder:"Search Lumias...",value:r,onChange:e=>o(e.target.value),autoFocus:!0}),(0,He.jsx)("button",{className:"lumiverse-council-btn",onClick:a,title:"Close",type:"button",children:(0,He.jsx)(hu,{size:16,strokeWidth:2})})]}),(0,He.jsx)("div",{className:"lumiverse-council-add-list",children:0===s.length?(0,He.jsx)("div",{className:"lumiverse-council-add-empty",children:r?"No matching Lumias found":"All Lumias are already in the council"}):s.map((e,n)=>(0,He.jsxs)("button",{className:"lumiverse-council-add-item",onClick:()=>{i({packName:e.packName,itemName:e.itemName}),a()},type:"button",children:[(0,He.jsx)("div",{className:"lumiverse-council-add-item-avatar",children:e.image?(0,He.jsx)("img",{src:e.image,alt:e.displayName}):(0,He.jsx)(cu,{size:16})}),(0,He.jsxs)("div",{className:"lumiverse-council-add-item-info",children:[(0,He.jsx)("span",{className:"lumiverse-council-add-item-name",children:e.displayName}),(0,He.jsx)("span",{className:"lumiverse-council-add-item-pack",children:e.packName})]})]},"".concat(e.packName,":").concat(e.itemName)))})]})}function gh(){return(0,He.jsxs)("div",{className:"lumiverse-council-empty",children:[(0,He.jsx)("span",{className:"lumiverse-council-empty-icon",children:(0,He.jsx)(cu,{size:32,strokeWidth:1.5})}),(0,He.jsx)("h4",{children:"No Council Members"}),(0,He.jsx)("p",{children:"Add Lumias to your council to create a collaborative group of independent characters."})]})}const bh=function(){const e=un(),{allPacks:n}=Nn(),[t,i]=(0,Ue.useState)(!1),a=(0,Ue.useSyncExternalStore)(uh.subscribe,mh,mh),r=(0,Ue.useSyncExternalStore)(uh.subscribe,ph,ph),o=(0,Ue.useCallback)(n=>{e.addCouncilMember(n),an()},[e]),s=(0,Ue.useCallback)((n,t)=>{e.updateCouncilMember(n,t),an()},[e]),l=(0,Ue.useCallback)(n=>{e.removeCouncilMember(n),an()},[e]),c=(0,Ue.useCallback)(n=>{e.setCouncilMode(n),an()},[e]),u=(0,Ue.useMemo)(()=>Array.isArray(n)?n.reduce((e,n)=>lh(lh({},e),{},{[n.name]:n}),{}):n||{},[n]);return(0,He.jsxs)("div",{className:"lumiverse-council-manager",children:[(0,He.jsxs)("div",{className:"lumiverse-council-header",children:[(0,He.jsxs)("h3",{className:"lumiverse-council-title",children:[(0,He.jsx)(cu,{size:18,strokeWidth:1.5}),"Council of Lumiae"]}),(0,He.jsxs)("label",{className:"lumiverse-council-mode-toggle",children:[(0,He.jsx)("input",{type:"checkbox",checked:a,onChange:e=>c(e.target.checked)}),(0,He.jsx)("span",{className:Ln("lumiverse-council-mode-switch",a&&"lumiverse-council-mode-switch--on"),children:(0,He.jsx)("span",{className:"lumiverse-council-mode-thumb"})}),(0,He.jsx)("span",{className:"lumiverse-council-mode-label",children:a?"Active":"Inactive"})]})]}),(0,He.jsx)("p",{className:"lumiverse-council-desc",children:"Create a council of independent Lumias that collaborate, each with their own identity, behaviors, and personalities."}),(0,He.jsx)("div",{className:"lumiverse-council-add-section",children:t?(0,He.jsx)(fh,{packs:u,existingMembers:r,onAdd:o,onClose:()=>i(!1)}):(0,He.jsxs)("button",{className:"lumiverse-council-add-btn",onClick:()=>i(!0),disabled:!a,title:a?"Add a council member":"Enable Council Mode first",type:"button",children:[(0,He.jsx)(uu,{size:16,strokeWidth:2}),(0,He.jsx)("span",{children:"Add Council Member"})]})}),(0,He.jsx)("div",{className:"lumiverse-council-members",children:0===r.length?(0,He.jsx)(gh,{}):r.map(e=>(0,He.jsx)(vh,{member:e,packs:u,onUpdate:s,onRemove:l},e.id))}),r.length>0&&(0,He.jsx)("div",{className:"lumiverse-council-help",children:(0,He.jsxs)("p",{children:["Council members will each appear with their definition in the ",(0,He.jsx)("code",{children:"{{lumiaDef}}"})," macro output. Their behaviors and personalities will be grouped per member."]})})]})},xh=In("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),yh=In("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),kh=In("cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]),wh=In("cpu",[["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M17 20v2",key:"1rnc9c"}],["path",{d:"M17 2v2",key:"11trls"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M2 17h2",key:"7oei6x"}],["path",{d:"M2 7h2",key:"asdhe0"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"M20 17h2",key:"1fpfkl"}],["path",{d:"M20 7h2",key:"1o8tra"}],["path",{d:"M7 20v2",key:"4gnj0m"}],["path",{d:"M7 2v2",key:"1i4yhu"}],["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"8",y:"8",width:"8",height:"8",rx:"1",key:"z9xiuo"}]]),jh=In("refresh-ccw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]),Sh=In("scissors",[["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M8.12 8.12 12 12",key:"1alkpv"}],["path",{d:"M20 4 8.12 15.88",key:"xgtan2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M14.8 14.8 20 20",key:"ptml3r"}]]),Ch=In("play",[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]]),Nh=In("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);function Ph(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,i)}return t}function Mh(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Ph(Object(t),!0).forEach(function(n){Eh(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Ph(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Eh(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,n||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const Lh=on,Dh={},Oh={enabled:!1,keepCount:50},Th=()=>Lh.getState().summarization||Dh,zh=()=>Lh.getState().messageTruncation||Oh,Ah=()=>Lh.getState().chatChangeCounter||0,Ih="loom_summary",Rh={openai:{name:"OpenAI",placeholder:"gpt-4o-mini"},anthropic:{name:"Anthropic",placeholder:"claude-3-haiku-20240307"},google:{name:"Google AI",placeholder:"gemini-1.5-flash"},openrouter:{name:"OpenRouter",placeholder:"openai/gpt-4o-mini"},custom:{name:"Custom",placeholder:"your-model-name"}};function Bh(e){let{Icon:n,title:t,children:i,defaultOpen:a=!1,status:r}=e;const[o,s]=(0,Ue.useState)(a);return(0,He.jsxs)("div",{className:Ln("lumiverse-vp-collapsible",o&&"lumiverse-vp-collapsible--open"),children:[(0,He.jsxs)("button",{className:"lumiverse-vp-collapsible-header",onClick:()=>s(!o),type:"button",children:[(0,He.jsx)("span",{className:Ln("lumiverse-vp-collapsible-chevron",o&&"lumiverse-vp-collapsible-chevron--open"),children:(0,He.jsx)(mu,{size:14,strokeWidth:2})}),(0,He.jsx)("span",{className:"lumiverse-vp-collapsible-icon",children:(0,He.jsx)(n,{size:16,strokeWidth:1.5})}),(0,He.jsx)("span",{className:"lumiverse-vp-collapsible-title",children:t}),void 0!==r&&(0,He.jsx)("span",{className:Ln("lumiverse-vp-collapsible-status",r&&"lumiverse-vp-collapsible-status--active"),children:r?"Active":"Off"})]}),(0,He.jsx)(nt,{isOpen:o,className:"lumiverse-vp-collapsible-content",duration:200,children:(0,He.jsx)("div",{className:"lumiverse-vp-collapsible-inner",children:i})})]})}function _h(e){let{id:n,checked:t,onChange:i,label:a,hint:r}=e;return(0,He.jsxs)("div",{className:"lumiverse-vp-toggle-row",children:[(0,He.jsxs)("label",{className:"lumiverse-vp-toggle-label",htmlFor:n,children:[(0,He.jsx)("span",{className:"lumiverse-vp-toggle-text",children:a}),r&&(0,He.jsx)("span",{className:"lumiverse-vp-toggle-hint",children:r})]}),(0,He.jsxs)("div",{className:"lumiverse-vp-toggle-switch-wrapper",children:[(0,He.jsx)("input",{type:"checkbox",id:n,className:"lumiverse-vp-toggle-input",checked:t,onChange:e=>i(e.target.checked)}),(0,He.jsx)("label",{htmlFor:n,className:"lumiverse-vp-toggle-switch-label",children:(0,He.jsx)("div",{className:Ln("lumiverse-vp-toggle-track",t&&"lumiverse-vp-toggle-track--on"),children:(0,He.jsx)("div",{className:"lumiverse-vp-toggle-thumb"})})})]})]})}function Fh(e){let{name:n,value:t,checked:i,onChange:a,label:r}=e;return(0,He.jsxs)("label",{className:Ln("lumiverse-vp-radio-option",i&&"lumiverse-vp-radio-option--selected"),children:[(0,He.jsx)("input",{type:"radio",name:n,value:t,checked:i,onChange:()=>a(t)}),(0,He.jsx)("span",{className:"lumiverse-vp-radio-option-label",children:r})]})}function Uh(e){let{id:n,label:t,hint:i,value:a,onChange:r,min:o,max:s,step:l=1}=e;return(0,He.jsxs)("div",{className:"lumiverse-vp-field",children:[(0,He.jsx)("label",{className:"lumiverse-vp-field-label",htmlFor:n,children:t}),(0,He.jsx)("input",{type:"number",id:n,className:"lumiverse-vp-field-input lumiverse-vp-field-input--small",value:a,onChange:e=>r(parseFloat(e.target.value)||0),min:o,max:s,step:l}),i&&(0,He.jsx)("span",{className:"lumiverse-vp-field-hint",children:i})]})}function Vh(e){let{id:n,label:t,hint:i,value:a,onChange:r,placeholder:o,type:s="text"}=e;return(0,He.jsxs)("div",{className:"lumiverse-vp-field",children:[(0,He.jsx)("label",{className:"lumiverse-vp-field-label",htmlFor:n,children:t}),(0,He.jsx)("input",{type:s,id:n,className:"lumiverse-vp-field-input",value:a,onChange:e=>r(e.target.value),placeholder:o}),i&&(0,He.jsx)("span",{className:"lumiverse-vp-field-hint",children:i})]})}function Hh(e){let{id:n,label:t,hint:i,value:a,onChange:r,options:o}=e;return(0,He.jsxs)("div",{className:"lumiverse-vp-field",children:[(0,He.jsx)("label",{className:"lumiverse-vp-field-label",htmlFor:n,children:t}),(0,He.jsx)("select",{id:n,className:"lumiverse-vp-field-select",value:a,onChange:e=>r(e.target.value),children:o.map(e=>(0,He.jsx)("option",{value:e.value,children:e.label},e.value))}),i&&(0,He.jsx)("span",{className:"lumiverse-vp-field-hint",children:i})]})}function Wh(e){let{hasContent:n,hasChat:t}=e;return t?n?(0,He.jsxs)("div",{className:"lumiverse-vp-summary-status lumiverse-vp-summary-status--exists",children:[(0,He.jsx)(pu,{size:16,strokeWidth:2}),(0,He.jsx)("span",{children:"Summary exists for this chat"})]}):(0,He.jsxs)("div",{className:"lumiverse-vp-summary-status lumiverse-vp-summary-status--empty",children:[(0,He.jsx)(xh,{size:16,strokeWidth:2}),(0,He.jsx)("span",{children:"No summary yet"})]}):(0,He.jsxs)("div",{className:"lumiverse-vp-summary-status lumiverse-vp-summary-status--no-chat",children:[(0,He.jsx)(xh,{size:16,strokeWidth:2}),(0,He.jsx)("span",{children:"No active chat"})]})}function $h(e){let{Icon:n,label:t,onClick:i,disabled:a,variant:r="secondary",loading:o=!1,iconOnly:s=!1}=e;return(0,He.jsxs)(lu.button,{className:Ln("lumiverse-vp-action-btn","lumiverse-vp-action-btn--".concat(r),a&&"lumiverse-vp-action-btn--disabled",s&&"lumiverse-vp-action-btn--icon-only"),onClick:i,disabled:a||o,whileHover:a?{}:{scale:1.05},whileTap:a?{}:{scale:.95},type:"button",title:t,children:[o?(0,He.jsx)("span",{className:"lumiverse-vp-action-btn-spinner"}):(0,He.jsx)(n,{size:s?16:14,strokeWidth:2}),!s&&(0,He.jsx)("span",{children:t})]})}function qh(){var e,n,t,i;const a=(0,Ue.useSyncExternalStore)(Lh.subscribe,Th,Th),r=(0,Ue.useSyncExternalStore)(Lh.subscribe,zh,zh),o=a.mode||"disabled",s=a.apiSource||"main",l=a.autoInterval||10,c=a.autoMessageContext||10,u=a.manualMessageContext||10,d=a.secondary||{},m=(0,Ue.useCallback)(e=>{const n=Lh.getState().summarization||{};Lh.setState({summarization:Mh(Mh({},n),e)}),an()},[]),p=(0,Ue.useCallback)(e=>{const n=Lh.getState().summarization||{},t=n.secondary||{};Lh.setState({summarization:Mh(Mh({},n),{},{secondary:Mh(Mh({},t),e)})}),an()},[]),h=(0,Ue.useCallback)(e=>{const n=Lh.getState().messageTruncation||{};Lh.setState({messageTruncation:Mh(Mh({},n),e)}),an()},[]),v=Object.entries(Rh).map(e=>{let[n,t]=e;return{value:n,label:t.name}});return(0,He.jsxs)("div",{className:"lumiverse-vp-summary-config",children:[(0,He.jsxs)(Bh,{Icon:yh,title:"Summarization Mode",status:"disabled"!==o,defaultOpen:!0,children:[(0,He.jsxs)("div",{className:"lumiverse-vp-radio-group",children:[(0,He.jsx)(Fh,{name:"sum-mode",value:"disabled",checked:"disabled"===o,onChange:e=>m({mode:e}),label:"Disabled"}),(0,He.jsx)(Fh,{name:"sum-mode",value:"auto",checked:"auto"===o,onChange:e=>m({mode:e}),label:"Automatic"}),(0,He.jsx)(Fh,{name:"sum-mode",value:"manual",checked:"manual"===o,onChange:e=>m({mode:e}),label:"Manual"})]}),(0,He.jsxs)("p",{className:"lumiverse-vp-settings-desc",children:["disabled"===o&&"Summarization is turned off.","auto"===o&&"Summaries are generated automatically at set intervals.","manual"===o&&"Use /loom-summarize command to generate summaries."]})]}),(0,He.jsx)(nt,{isOpen:"auto"===o,duration:200,children:(0,He.jsx)(Bh,{Icon:$m,title:"Auto Settings",defaultOpen:!0,children:(0,He.jsxs)("div",{className:"lumiverse-vp-field-row",children:[(0,He.jsx)(Uh,{id:"sum-interval",label:"Interval",hint:"Every N messages",value:l,onChange:e=>m({autoInterval:e}),min:1}),(0,He.jsx)(Uh,{id:"sum-auto-context",label:"Context",hint:"Messages to include",value:c,onChange:e=>m({autoMessageContext:e}),min:1,max:100})]})})}),(0,He.jsx)(nt,{isOpen:"manual"===o||"auto"===o,duration:200,children:(0,He.jsx)(Bh,{Icon:Gd,title:"Manual Context",defaultOpen:"manual"===o,children:(0,He.jsx)(Uh,{id:"sum-manual-context",label:"Messages to include",hint:"When using /loom-summarize command",value:u,onChange:e=>m({manualMessageContext:e}),min:1,max:100})})}),(0,He.jsx)(nt,{isOpen:"disabled"!==o,duration:200,children:(0,He.jsx)(Bh,{Icon:kh,title:"API Source",defaultOpen:!1,children:(0,He.jsxs)("div",{className:"lumiverse-vp-radio-group lumiverse-vp-radio-group--wide",children:[(0,He.jsx)(Fh,{name:"sum-source",value:"main",checked:"main"===s,onChange:e=>m({apiSource:e}),label:"Main API"}),(0,He.jsx)(Fh,{name:"sum-source",value:"secondary",checked:"secondary"===s,onChange:e=>m({apiSource:e}),label:"Secondary LLM"})]})})}),(0,He.jsx)(nt,{isOpen:"disabled"!==o&&"secondary"===s,duration:200,children:(0,He.jsxs)(Bh,{Icon:wh,title:"Secondary LLM",defaultOpen:!0,children:[(0,He.jsx)(Hh,{id:"sum-provider",label:"Provider",value:d.provider||"openai",onChange:e=>p({provider:e}),options:v,hint:"custom"!==d.provider?"Uses API key from SillyTavern settings":void 0}),(0,He.jsx)(Vh,{id:"sum-model",label:"Model",value:d.model||"",onChange:e=>p({model:e}),placeholder:null===(e=Rh[d.provider||"openai"])||void 0===e?void 0:e.placeholder}),(0,He.jsxs)(nt,{isOpen:"custom"===d.provider,duration:200,children:[(0,He.jsx)(Vh,{id:"sum-endpoint",label:"Endpoint URL",value:d.endpoint||"",onChange:e=>p({endpoint:e}),placeholder:"https://your-api.com/v1/chat/completions"}),(0,He.jsx)(Vh,{id:"sum-apikey",label:"API Key",type:"password",value:d.apiKey||"",onChange:e=>p({apiKey:e}),placeholder:"Your API key"})]}),(0,He.jsxs)("div",{className:"lumiverse-vp-field-row lumiverse-vp-field-row--3",children:[(0,He.jsx)(Uh,{id:"sum-temp",label:"Temp",value:null!==(n=d.temperature)&&void 0!==n?n:.7,onChange:e=>p({temperature:e}),min:0,max:2,step:.1}),(0,He.jsx)(Uh,{id:"sum-topp",label:"Top-P",value:null!==(t=d.topP)&&void 0!==t?t:1,onChange:e=>p({topP:e}),min:0,max:1,step:.05}),(0,He.jsx)(Uh,{id:"sum-maxtokens",label:"Max Tokens",value:d.maxTokens||8192,onChange:e=>p({maxTokens:e}),min:100,max:128e3})]})]})}),(0,He.jsx)(nt,{isOpen:"disabled"!==o&&("main"===s||"anthropic"===d.provider),duration:200,children:(0,He.jsxs)(Bh,{Icon:jh,title:"Claude Cache",defaultOpen:!1,children:[(0,He.jsx)("p",{className:"lumiverse-vp-settings-desc",children:"If Claude seems to ignore changes to your Lumia definitions, clearing the cache will force fresh responses on the next summarization."}),(0,He.jsx)($h,{Icon:jh,label:"Clear Claude Cache",onClick:()=>{"undefined"!=typeof LumiverseBridge&&LumiverseBridge.clearClaudeCache?(LumiverseBridge.clearClaudeCache(),"undefined"!=typeof toastr&&toastr.success("Claude cache cleared! Next request will use fresh definitions.")):(console.warn("[SummaryEditor] clearClaudeCache not available"),"undefined"!=typeof toastr&&toastr.error("Cache clear function not available"))},variant:"secondary"})]})}),(0,He.jsxs)(Bh,{Icon:Sh,title:"Message Limit",status:r.enabled,children:[(0,He.jsx)(_h,{id:"trunc-toggle",checked:r.enabled,onChange:e=>h({enabled:e}),label:"Limit Context Messages",hint:"Only send the last N messages to the AI"}),(0,He.jsxs)(nt,{isOpen:r.enabled,duration:200,children:[(0,He.jsx)(Uh,{id:"trunc-count",label:"Messages to keep",hint:"Number of recent messages to include",value:null!==(i=r.keepCount)&&void 0!==i?i:50,onChange:e=>h({keepCount:e}),min:5,max:500}),(0,He.jsxs)("div",{className:"lumiverse-vp-warning-box",children:[(0,He.jsx)(xh,{size:14,strokeWidth:2}),(0,He.jsx)("span",{children:"Older messages will be excluded. Consider using summarization to preserve memories."})]})]})]})]})}function Yh(){const[e,n]=(0,Ue.useState)(""),[t,i]=(0,Ue.useState)(""),[a,r]=(0,Ue.useState)(!1),[o,s]=(0,Ue.useState)(!1),[l,c]=(0,Ue.useState)(!1),u=(0,Ue.useRef)(null),d=(0,Ue.useSyncExternalStore)(Lh.subscribe,Ah,()=>0),m=e!==t,p=(e.trim().length,(0,Ue.useCallback)(()=>{try{if("undefined"!=typeof SillyTavern){const e=SillyTavern.getContext(),t=(null==e?void 0:e.chat)&&e.chat.length>0;if(r(t),t&&e.chatMetadata){const t=e.chatMetadata[Ih]||"";n(t),i(t)}else n(""),i("")}else r(!0),n(""),i("")}catch(e){console.warn("[SummaryEditor] Error loading summary:",e)}},[]));(0,Ue.useEffect)(()=>{p()},[d]);const h=(0,Ue.useCallback)(e=>{n(e.target.value)},[]),v=(0,Ue.useCallback)(()=>{try{if("undefined"!=typeof SillyTavern){var n;const t=SillyTavern.getContext();t.chatMetadata||(t.chatMetadata={});const a=e.trim();a?t.chatMetadata[Ih]=a:delete t.chatMetadata[Ih],null===(n=t.saveMetadata)||void 0===n||n.call(t),"undefined"!=typeof LumiverseBridge&&LumiverseBridge.updateSummaryButtonState&&LumiverseBridge.updateSummaryButtonState(),i(a),s(!0),setTimeout(()=>s(!1),1500)}}catch(e){console.error("[SummaryEditor] Error saving summary:",e)}},[e]),f=(0,Ue.useCallback)(()=>{if(confirm("Are you sure you want to clear the summary?")){n("");try{if("undefined"!=typeof SillyTavern){const n=SillyTavern.getContext();var e;if(n.chatMetadata)delete n.chatMetadata[Ih],null===(e=n.saveMetadata)||void 0===e||e.call(n),"undefined"!=typeof LumiverseBridge&&LumiverseBridge.updateSummaryButtonState&&LumiverseBridge.updateSummaryButtonState()}i("")}catch(e){console.error("[SummaryEditor] Error clearing summary:",e)}}},[]),g=(0,Ue.useCallback)(()=>{p()},[p]),b=(0,Ue.useCallback)(async()=>{if(a&&!l){c(!0);try{if("undefined"!=typeof LumiverseBridge&&LumiverseBridge.getCallbacks){const e=LumiverseBridge.getCallbacks();if(e.generateSummary){const t=await e.generateSummary();t&&n(t)}else console.warn("[SummaryEditor] generateSummary callback not available")}}catch(e){console.error("[SummaryEditor] Error generating summary:",e)}finally{c(!1)}}},[a,l]);return(0,He.jsxs)(Bh,{Icon:Gd,title:"Summary Text",defaultOpen:!0,children:[(0,He.jsx)(Wh,{hasContent:t.length>0,hasChat:a}),(0,He.jsx)("div",{className:"lumiverse-vp-summary-textarea-wrapper",children:(0,He.jsx)("textarea",{ref:u,className:"lumiverse-vp-summary-textarea",value:e,onChange:h,placeholder:"Write or paste your Loom summary here...\n\nUse the structured format:\n**Completed Objectives**\n- ...\n\n**Focused Objectives**\n- ...\n\n**Foreshadowing Beats**\n- ...\n\n**Character States**\n- ...\n\n**World State**\n- ...\n\n**Tone & Atmosphere**\n- ...\n\n**Threads to Weave**\n- ...",disabled:!a})}),(0,He.jsxs)("div",{className:"lumiverse-vp-summary-actions",children:[(0,He.jsx)($h,{Icon:Ch,label:l?"Generating...":"Generate",onClick:b,disabled:!a,loading:l,variant:"primary",iconOnly:!0}),(0,He.jsx)($h,{Icon:qm,label:"Refresh",onClick:g,disabled:!a,iconOnly:!0}),(0,He.jsx)($h,{Icon:_n,label:"Clear",onClick:f,disabled:!a||!t,variant:"danger",iconOnly:!0}),(0,He.jsx)($h,{Icon:o?pu:Nh,label:o?"Saved!":"Save",onClick:v,disabled:!a||!m,variant:"primary",iconOnly:!0})]}),(0,He.jsx)(vt,{children:m&&(0,He.jsx)(lu.div,{className:"lumiverse-vp-summary-unsaved",initial:{opacity:0,y:5},animate:{opacity:1,y:0},exit:{opacity:0,y:5},children:(0,He.jsx)("span",{children:"You have unsaved changes"})})})]})}const Kh=function(){return(0,He.jsxs)("div",{className:"lumiverse-vp-summary-editor",children:[(0,He.jsx)(Yh,{}),(0,He.jsx)(qh,{})]})},Gh=on;const Qh=function(){const[e,n]=(0,Ue.useState)(!1),t=(0,Ue.useSyncExternalStore)(Gh.subscribe,()=>{var e;return null===(e=Gh.getState().showLumiverseDrawer)||void 0===e||e},()=>{var e;return null===(e=Gh.getState().showLumiverseDrawer)||void 0===e||e}),i=(0,Ue.useCallback)(()=>{n(e=>!e)},[]),a=(0,Ue.useCallback)(()=>{n(!1)},[]);return t?(0,He.jsxs)(He.Fragment,{children:[(0,He.jsx)(Pm,{isVisible:e,onToggle:i,onClose:a,defaultTab:"profile",ProfileContent:Wm,PresetsContent:ep,BrowserContent:Ep,OOCContent:Fp,PromptContent:oh,CouncilContent:bh,SummaryContent:Kh}),(0,He.jsx)(am,{}),(0,He.jsx)(hm,{})]}):null};var Zh=t(72),Xh=t.n(Zh),Jh=t(825),ev=t.n(Jh),nv=t(659),tv=t.n(nv),iv=t(56),av=t.n(iv),rv=t(159),ov=t.n(rv),sv=t(113),lv=t.n(sv),cv=t(456),uv={};uv.styleTagTransform=lv(),uv.setAttributes=av(),uv.insert=tv().bind(null,"head"),uv.domAPI=ev(),uv.insertStyleElement=ov();Xh()(cv.A,uv);cv.A&&cv.A.locals&&cv.A.locals;function dv(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,i)}return t}function mv(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?dv(Object(t),!0).forEach(function(n){pv(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):dv(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function pv(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,n||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}"undefined"==typeof window||!window.React||window.React===Ue||console.warn('[LumiverseUI] Warning: Multiple React instances detected. This may cause "Invalid hook call" errors (Error #158). The extension bundles its own React to ensure compatibility.');const hv=new Map;let vv=null;function fv(e){const n=hv.get(e);n&&(n.root.unmount(),n.element.remove(),hv.delete(e),console.log("[LumiverseUI] Unmounted ".concat(e)))}const gv={mountSettingsPanel:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"lumiverse-settings-root",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(n&&(vv=n,on.syncFromExtension(n)),document.getElementById(e))return console.warn("[LumiverseUI] Settings panel already mounted"),()=>fv(e);const t=document.getElementById("extensions_settings");if(!t)return console.error("[LumiverseUI] Could not find #extensions_settings container"),null;const i=document.createElement("div");i.className="lumia-injector-settings";const a=document.createElement("div");a.className="inline-drawer";const r=document.createElement("div");r.className="inline-drawer-toggle inline-drawer-header",r.innerHTML='\n        <b>Lumiverse Helper</b>\n        <div class="inline-drawer-icon fa-solid fa-circle-chevron-down down"></div>\n    ';const o=document.createElement("div");o.className="inline-drawer-content";const s=document.createElement("div");s.id=e,o.appendChild(s),a.appendChild(r),a.appendChild(o),i.appendChild(a),t.appendChild(i);const l=Ve.createRoot(s),c=Ue.Fragment;return l.render((0,He.jsx)(c,{children:(0,He.jsx)(ln,{initialSettings:vv,children:(0,He.jsx)(vm,{})})})),hv.set(e,{root:l,element:i}),console.log("[LumiverseUI] Settings panel mounted with inline-drawer accordion"),()=>fv(e)},mountViewportPanel:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const n="lumiverse-viewport-root",t=document.getElementById(n);t&&(t.remove(),hv.delete(n)),e&&on.syncFromExtension(e);const i=document.createElement("div");i.id=n,i.className="lumiverse-react-root lumiverse-viewport-container",i.style.position="fixed",i.style.top="0",i.style.right="0",i.style.bottom="0",i.style.left="auto",i.style.zIndex="9998",i.style.pointerEvents="none",document.body.appendChild(i);const a=Ve.createRoot(i),r=Ue.Fragment;return a.render((0,He.jsx)(r,{children:(0,He.jsx)(ln,{initialSettings:e,children:(0,He.jsx)(Qh,{})})})),hv.set(n,{root:a,element:i}),console.log("[LumiverseUI] Viewport panel mounted with inline positioning"),()=>fv(n)},mountComponent:function(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=(arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)||"lumiverse-mount-".concat(Date.now());if(hv.has(i))return console.warn("[LumiverseUI] Component ".concat(i," already mounted")),()=>fv(i);const a=document.createElement("div");a.id=i,a.className="lumiverse-react-root",n.appendChild(a);const r=Ve.createRoot(a),o=Ue.Fragment;return r.render((0,He.jsx)(o,{children:(0,He.jsx)(ln,{children:(0,He.jsx)(e,mv({},t))})})),hv.set(i,{root:r,element:a}),()=>fv(i)},unmount:fv,unmountAll:function(){for(const[e]of hv)fv(e)},syncSettings:function(e){if(e){var n,t,i,a,r,o;console.log("[LumiverseUI] syncSettings called with:",{packsCount:(null===(n=e.packs)||void 0===n?void 0:n.length)||0,customPacksCount:(null===(t=e.customPacks)||void 0===t?void 0:t.length)||0,firstPackItems:(null===(i=e.packs)||void 0===i||null===(i=i[0])||void 0===i||null===(i=i.items)||void 0===i?void 0:i.length)||0}),on.syncFromExtension(e);const s=on.getState();console.log("[LumiverseUI] After sync, store has:",{packsCount:(null===(a=s.packs)||void 0===a?void 0:a.length)||0,customPacksCount:(null===(r=s.customPacks)||void 0===r?void 0:r.length)||0,firstPackItems:(null===(o=s.packs)||void 0===o||null===(o=o[0])||void 0===o||null===(o=o.items)||void 0===o?void 0:o.length)||0})}else console.warn("[LumiverseUI] syncSettings called with null/undefined settings")},getState:function(){return on.exportForExtension()},subscribe:function(e){return on.subscribe(e)},getStore:function(){return on},getSTContext:function(){return"undefined"!=typeof SillyTavern?SillyTavern.getContext():(console.warn("[LumiverseUI] SillyTavern context not available"),null)}};console.log("[LumiverseUI] Bundle loaded, API available:",Object.keys(gv)),"undefined"!=typeof window&&(window.LumiverseUI=gv);function bv(e){if(!e)return e;let n=e;n=function(e){if(!e)return e;let n,t=e;do{n=t,t=t.replace(/<div[^>]*style\s*=\s*["'][^"']*display\s*:\s*none[^"']*["'][^>]*>(\s*```[\s\S]*?```\s*)<\/div>/gi,"$1"),t=t.replace(/<div(?:\s[^>]*)?>([\s\S]*?)<\/div>/gi,"")}while(t!==n);return t=t.replace(/<\/div>/gi,""),t}(n);const t=["span","b","i","u","em","strong","s","strike","sub","sup","mark","small","big"];for(const e of t){const t=new RegExp("<".concat(e,"(?:\\s[^>]*)?>"),"gi"),i=new RegExp("</".concat(e,">"),"gi");n=n.replace(t,""),n=n.replace(i,"")}return n}function xv(e){if(!e)return e;let n=e;return n=n.replace(/<font(?:\s[^>]*)?>/gi,""),n=n.replace(/<\/font>/gi,""),n}function yv(e){if(!e)return e;let n,t=e;do{n=t,t=t.replace(/<details(?:\s[^>]*)?>([\s\S]*?)<\/details>/gi,"")}while(t!==n);return t}function kv(e){if(!e)return e;const n=["loom_sum","loom_if","loom_else","loom_endif","lumia_ooc","lumiaooc","lumio_ooc","lumioooc","loom_state","loom_memory","loom_context","loom_inject","loom_var","loom_set","loom_get","loom_record","loomrecord","loom_ledger","loomledger"];let t=e;for(const e of n){const n=new RegExp("<".concat(e,"(?:\\s[^>]*)?>([\\s\\S]*?)</").concat(e,">"),"gi"),i=new RegExp("<".concat(e,"(?:\\s[^>]*)?\\/?>"),"gi");t=t.replace(n,""),t=t.replace(i,"")}return t}function wv(e){if(!e||"string"!=typeof e)return e;let n=e.replace(/\n{3,}/g,"\n\n");return n=n.replace(/\n[ \t]*\n[ \t]*\n/g,"\n\n"),n}globalThis.lumiverseHelperGenInterceptor=async function(e,n,t,i){var a,r,o,s,l,c,u,d,m,p,h,v;console.log("[".concat(A.pW,"] Generation interceptor called with type: ").concat(i)),(0,A.Ll)();const f=(0,A.mt)(),g=(null===(a=f.sovereignHand)||void 0===a?void 0:a.enabled)||!1,b=f.contextFilters||{},x=f.messageTruncation||{};if(x.enabled&&x.keepCount>0){const n=x.keepCount;if(e.length>n){const t=e.length-n;e.splice(0,t),console.log("[".concat(A.pW,"] Message Truncation: Removed ").concat(t," older messages, keeping last ").concat(n))}}const y=!1!==(null===(r=f.sovereignHand)||void 0===r?void 0:r.excludeLastMessage);if(g){let n=-1;for(let t=e.length-1;t>=0;t--)if(e[t]&&e[t].is_user){n=t;break}if(-1!==n){const t=e[n];Q(t.mes||t.content||""),X(!0),console.log("[".concat(A.pW,"] Sovereign Hand: Captured last user message at index ").concat(n)),y&&(e.splice(n,1),console.log("[".concat(A.pW,"] Sovereign Hand: Removed last user message from context array")))}else Q(""),X(!1),console.log("[".concat(A.pW,"] Sovereign Hand: No user message found (continuation mode)"))}else Q(""),X(!1);const k=null!==(o=null===(s=b.detailsBlocks)||void 0===s?void 0:s.keepDepth)&&void 0!==o?o:3,w=null!==(l=null===(c=b.loomItems)||void 0===c?void 0:c.keepDepth)&&void 0!==l?l:5,j=null!==(u=null===(d=b.htmlTags)||void 0===d?void 0:d.fontKeepDepth)&&void 0!==u?u:3,S=(null===(m=b.htmlTags)||void 0===m?void 0:m.enabled)||!1,C=(null===(p=b.htmlTags)||void 0===p?void 0:p.stripFonts)||!1,N=(null===(h=b.detailsBlocks)||void 0===h?void 0:h.enabled)||!1,P=(null===(v=b.loomItems)||void 0===v?void 0:v.enabled)||!1,M=S||C||N||P;for(let n=0;n<e.length;n++){const t=e.length-1-n,i=e=>{if(!e||"string"!=typeof e)return e;let n=e;return S&&(n=bv(n)),S&&C&&t>=j&&(n=xv(n)),N&&t>=k&&(n=yv(n)),P&&t>=w&&(n=kv(n)),n};e[n]&&"string"==typeof e[n].content&&(e[n].content=J(e[n].content),M&&(e[n].content=i(e[n].content)),e[n].content=wv(e[n].content)),e[n]&&"string"==typeof e[n].mes&&(e[n].mes=J(e[n].mes),M&&(e[n].mes=i(e[n].mes)),e[n].mes=wv(e[n].mes))}return{chat:e,contextSize:n,abort:t}},jQuery(async()=>{console.log("[".concat(A.pW,"] jQuery initialization starting...")),console.log("[".concat(A.pW,"] window.LumiverseUI available:"),!!window.LumiverseUI);const e=(0,i.cj)(),n=(0,i.G1)();e&&n||console.error("[".concat(A.pW,"] ST APIs not available - extension may not work correctly")),(0,A.M5)(),function(){const e=(0,i.zX)();e?(q(e),ie(e),e.registerMacro("lumiaMessageCount",()=>{const e=(0,i.SD)();return e&&e.chat?e.chat.length.toString():"0"},"Current chat message count"),e.registerMacro("lumiaOOCTrigger",()=>{const e=(0,i.SD)();if(!e||!e.chat)return"";const n=(0,A.mt)().lumiaOOCInterval;if(!n||n<=0)return"";const t=e.chat.length,a=Math.ceil(t/n)*n-t;return 0===a?"**OOC Commentary Time!** The Gods' want me to speak up to the Human right now, in the out-of-context comments for the Loom! Perfect! I've got a *lot* I want to say and I want them to hear my voice loud and clear!":"Looks like I've got ".concat(a," message").concat(1!==a?"s":""," left until it's time to speak to the Human directly! The Gods' are anticipating me to be breathless, I cannot wait for my turn!")},"OOC commentary trigger countdown/activation prompt"),console.log("[".concat(A.pW,"] Macros registered successfully (Macros 2.0 format)"))):console.warn("[".concat(A.pW,"] MacrosParser not available - macros will not be registered"))}(),Be(),(0,R.xx)(R.YR),(0,R.Zl)(Ie),(0,_e.Go)(R.YR),(0,Fe.rq)("showSelectionModal",R.ry),(0,Fe.rq)("showLoomSelectionModal",R.mR),(0,Fe.rq)("showMiscFeaturesModal",R.GM),(0,Fe.rq)("showSummarizationModal",R.Cm),(0,Fe.rq)("showPromptSettingsModal",R.e2),(0,Fe.rq)("showLumiaEditorModal",_e.un),(0,Fe.rq)("showLucidCardsModal",R.Dz),(0,Fe.rq)("fetchWorldBook",()=>{const e=jQuery("#lumia-url-input-react").val()||jQuery("#lumia-url-input").val();(0,I.wn)(e).then(()=>{(0,R.YR)(),(0,Fe.TC)()})}),(0,Fe.rq)("handleNewBook",(e,n)=>{(0,I.handleNewBook)(e,n,!1),(0,R.YR)(),(0,Fe.TC)()}),(0,Fe.rq)("refreshUIDisplay",()=>{(0,R.YR)(),(0,Fe.TC)()}),(0,Fe.rq)("refreshOOCComments",function(){Ie(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])}),(0,Fe.rq)("generateSummary",async()=>await(0,B.Zq)(null,!0,!0)),console.log("[".concat(A.pW,"] About to initialize React UI..."));const t=document.getElementById("extensions_settings");if(console.log("[".concat(A.pW,"] extensions_settings container:"),t),t){await(0,Fe.A5)(t)?console.log("[".concat(A.pW,"] React UI initialized successfully")):console.error("[".concat(A.pW,"] React UI failed to initialize - check console for errors"))}(0,R.YR)(),jQuery("#lumia-fetch-btn").on("click",()=>{const e=jQuery("#lumia-url-input").val();(0,I.wn)(e).then(()=>(0,R.YR)())}),jQuery("#lumia-open-definitions-btn").on("click",()=>(0,R.ry)("definition")),jQuery("#lumia-open-behaviors-btn").on("click",()=>(0,R.ry)("behavior")),jQuery("#lumia-open-personalities-btn").on("click",()=>(0,R.ry)("personality")),jQuery("#lumia-open-misc-btn").on("click",()=>(0,R.GM)()),jQuery("#lumia-open-summarization-btn").on("click",()=>(0,R.Cm)()),jQuery("#lumia-open-prompt-settings-btn").on("click",()=>(0,R.e2)()),jQuery("#loom-open-style-btn").on("click",()=>(0,R.mR)("Narrative Style")),jQuery("#loom-open-utils-btn").on("click",()=>(0,R.mR)("Loom Utilities")),jQuery("#loom-open-retrofits-btn").on("click",()=>(0,R.mR)("Retrofits")),jQuery("#lumia-browse-lucid-btn").on("click",()=>(0,R.Dz)()),jQuery("#lumia-create-lumia-btn").on("click",()=>(0,_e.un)()),jQuery("#lumia-upload-btn").on("click",()=>jQuery("#lumia-file-input").trigger("click")),jQuery("#lumia-file-input").on("change",e=>{const n=e.target.files[0];if(!n)return;const t=new FileReader;t.onload=e=>{try{const t=JSON.parse(e.target.result);(0,I.handleNewBook)(t,n.name,!1),(0,R.YR)()}catch(e){console.error("Lumia Injector Error:",e),toastr.error("Failed to parse: "+e.message)}},t.readAsText(n),e.target.value=""}),e&&n&&(e.on(n.CHARACTER_MESSAGE_RENDERED,e=>{console.log("[".concat(A.pW,"] CHARACTER_MESSAGE_RENDERED event for mesId ").concat(e)),xe(!1),ne(),(0,B.tb)();const n=o('div[mesid="'.concat(e,'"] .mes_text'));if(n){var t;te(n),function(e){const n=s(".lumia-ooc-marker-hidden",e);if(0===n.length)return;console.log("[".concat(A.pW,"] Unhiding ").concat(n.length," OOC markers")),n.forEach(e=>{e.classList.remove("lumia-ooc-marker-hidden"),e.style.display=""});const t=e.closest("div[mesid]");t&&ze(parseInt(t.getAttribute("mesid"),10))}(n);const a=s("lumia_ooc, lumiaooc, lumio_ooc, lumioooc",n),r=s("font",n).filter(ke),o=(0,i.SD)(),l=null==o||null===(t=o.chat)||void 0===t?void 0:t[e],c=(null==l?void 0:l.mes)||(null==l?void 0:l.content)||"",u=/<lumi[ao]_?ooc(?:\s+name="[^"]*")?>/i.test(c);(a.length>0||r.length>0||u)&&(console.log("[".concat(A.pW,"] Found OOC content (lumia_ooc elements: ").concat(a.length,", fonts: ").concat(r.length,", tags in raw: ").concat(u,"), scheduling OOC processing for message ").concat(e)),ze(e))}}),e.on(n.MESSAGE_EDITED,e=>{console.log("[".concat(A.pW,"] MESSAGE_EDITED event for mesId ").concat(e)),Pe(e);const n=o('div[mesid="'.concat(e,'"] .mes_text'));if(n){s("[data-lumia-ooc]",n).forEach(e=>e.remove())}ze(e,!0)}),e.on(n.MESSAGE_SWIPED,e=>{console.log("[".concat(A.pW,"] MESSAGE_SWIPED event for mesId ").concat(e)),Pe(e);const n=o('div[mesid="'.concat(e,'"] .mes_text'));if(n){s("[data-lumia-ooc]",n).forEach(e=>e.remove())}ze(e,!0)}),e.on(n.CHAT_CHANGED,()=>{console.log("[".concat(A.pW,"] CHAT_CHANGED event - scheduling OOC reprocessing and loom summary capture")),ne(),Re(),requestAnimationFrame(()=>{(0,B.E)(),(0,R.updateLoomSummaryButtonState)()})}),e.on(n.GENERATION_STARTED,()=>{console.log("[".concat(A.pW,"] GENERATION_STARTED - disabling OOC observer processing")),xe(!0)}),e.on(n.GENERATION_ENDED,()=>{console.log("[".concat(A.pW,"] GENERATION_ENDED (error case) - resetting state and flushing updates")),xe(!1),fe()}),e.on(n.GENERATION_STOPPED,()=>{console.log("[".concat(A.pW,"] GENERATION_STOPPED (user cancel) - resetting state and flushing updates")),xe(!1),fe()})),function(){const e=document.getElementById("chat"),n=new MutationObserver(e=>{e.forEach(e=>{if(e.addedNodes.forEach(e=>{if(e.nodeType!==Node.ELEMENT_NODE)return;let n=[];if(e.classList&&e.classList.contains("mes_text")?n=[e]:e.querySelectorAll&&(n=Array.from(e.querySelectorAll(".mes_text"))),"FONT"===e.tagName&&ke(e)){const t=e.closest(".mes_text");t&&!n.includes(t)&&n.push(t)}if(e.nodeType===Node.TEXT_NODE||e.innerHTML&&(e.innerHTML.includes("<loom_sum>")||e.innerHTML.includes("&lt;loom_sum&gt;"))){const t=e.closest?e.closest(".mes_text"):null;t&&!n.includes(t)&&n.push(t)}n.forEach(e=>{var n;if(te(e),be)return;if(s("[data-lumia-ooc]",e).length>0)return;const t=e.closest("div[mesid]");if(!t)return;const a=parseInt(t.getAttribute("mesid"),10),r=(0,i.SD)(),o=null==r||null===(n=r.chat)||void 0===n?void 0:n[a],l=(null==o?void 0:o.mes)||(null==o?void 0:o.content)||"",c=/<lumi[ao]_?ooc(?:\s+name="[^"]*")?>/i.test(l),u=s("font",e).filter(ke);(c||u.length>0)&&(console.log("[".concat(A.pW,"] Observer: Processing OOC in message ").concat(a," (tags in raw: ").concat(c,", fonts in DOM: ").concat(u.length,")")),ze(a))})}),"characterData"===e.type){var n;const t=null===(n=e.target.parentElement)||void 0===n?void 0:n.closest(".mes_text");t&&te(t)}})}),t=e||document.body;n.observe(t,{childList:!0,subtree:!0,characterData:!0}),console.log("[".concat(A.pW,"] OOC observer started on ").concat(e?"chat element":"body (fallback)"))}(),console.log("[".concat(A.pW,"] Initial load - scheduling OOC processing")),Re();const a=(0,i.ej)(),r=(0,i.Dr)();a&&r&&a.addCommandObject(r.fromProps({name:"loom-summarize",callback:async()=>{const e=(0,A.mt)().summarization;if(!e||"disabled"===e.mode)return toastr.warning("Summarization is disabled. Enable it in Lumia Injector settings."),"Summarization is disabled.";try{toastr.info("Generating loom summary...");return await(0,B.Zq)(null,!0)?(toastr.success("Loom summary generated and saved!"),"Summary generated successfully."):(toastr.warning("No summary generated. Check if there are messages to summarize."),"No summary generated.")}catch(e){return toastr.error("Summarization failed: ".concat(e.message)),"Error: ".concat(e.message)}},aliases:["loom-sum","summarize"],helpString:"Manually generate a loom summary of the current chat using your configured summarization settings (uses Manual Message Context)."})),console.log("".concat(A.pW," initialized"))})})();
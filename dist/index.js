(()=>{"use strict";var e={20(e,n,t){var i=t(540),r=Symbol.for("react.element"),a=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,s=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,n,t){var i,a={},c=null,u=null;for(i in void 0!==t&&(c=""+t),void 0!==n.key&&(c=""+n.key),void 0!==n.ref&&(u=n.ref),n)o.call(n,i)&&!l.hasOwnProperty(i)&&(a[i]=n[i]);if(e&&e.defaultProps)for(i in n=e.defaultProps)void 0===a[i]&&(a[i]=n[i]);return{$$typeof:r,type:e,key:c,ref:u,props:a,_owner:s.current}}n.Fragment=a,n.jsx=c,n.jsxs=c},56(e,n,t){e.exports=function(e){var n=t.nc;n&&e.setAttribute("nonce",n)}},72(e){var n=[];function t(e){for(var t=-1,i=0;i<n.length;i++)if(n[i].identifier===e){t=i;break}return t}function i(e,i){for(var a={},o=[],s=0;s<e.length;s++){var l=e[s],c=i.base?l[0]+i.base:l[0],u=a[c]||0,d="".concat(c," ").concat(u);a[c]=u+1;var m=t(d),p={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==m)n[m].references++,n[m].updater(p);else{var h=r(p,i);i.byIndex=s,n.splice(s,0,{identifier:d,updater:h,references:1})}o.push(d)}return o}function r(e,n){var t=n.domAPI(n);t.update(e);return function(n){if(n){if(n.css===e.css&&n.media===e.media&&n.sourceMap===e.sourceMap&&n.supports===e.supports&&n.layer===e.layer)return;t.update(e=n)}else t.remove()}}e.exports=function(e,r){var a=i(e=e||[],r=r||{});return function(e){e=e||[];for(var o=0;o<a.length;o++){var s=t(a[o]);n[s].references--}for(var l=i(e,r),c=0;c<a.length;c++){var u=t(a[c]);0===n[u].references&&(n[u].updater(),n.splice(u,1))}a=l}}},92(e,n,t){function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,i)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach(function(n){a(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function a(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,n||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(){return"undefined"!=typeof SillyTavern&&SillyTavern.getContext?SillyTavern.getContext():(console.error("[LumiverseHelper] SillyTavern global not available"),null)}function s(){const e=o();return(null==e?void 0:e.extensionSettings)||{}}function l(){const e=o();return(null==e?void 0:e.saveSettingsDebounced)||(()=>{})}function c(){const e=o();return(null==e?void 0:e.eventSource)||null}function u(){const e=o();return(null==e?void 0:e.eventTypes)||{}}function d(){var e,n;const t=o();if(!t)return console.warn("[LumiverseHelper] Context not available for macro registration"),null;const i="function"==typeof(null===(e=t.macros)||void 0===e?void 0:e.register),a="function"==typeof t.registerMacro,s="function"==typeof(null===(n=t.MacrosParser)||void 0===n?void 0:n.registerMacro);return console.log("[LumiverseHelper] Macro API detection:",{"ctx.macros.register":i,"ctx.registerMacro":a,"ctx.MacrosParser":s}),i||a||s?{registerMacro:function(e,n){let o,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;o="function"==typeof n?{handler:n,description:l||"Lumiverse Helper macro: ".concat(e)}:"object"==typeof n&&null!==n?r(r({},n),{},{description:n.description||"Lumiverse Helper macro: ".concat(e)}):{handler:()=>n,description:l||"Lumiverse Helper macro: ".concat(e)};const c=o.handler;if("function"==typeof c){if(i)try{const n={handler:c,category:"Lumiverse Helper",description:o.description};return o.returns&&(n.returns=o.returns),o.returnType&&(n.returnType=o.returnType),o.exampleUsage&&(n.exampleUsage=o.exampleUsage),o.aliases&&(n.aliases=o.aliases),void 0!==o.unnamedArgs&&(n.unnamedArgs=o.unnamedArgs),t.macros.register(e,n),void console.log("[LumiverseHelper] Registered macro via macros.register: ".concat(e))}catch(n){console.warn("[LumiverseHelper] macros.register failed for ".concat(e,", trying fallback:"),n.message)}if(a)try{return t.registerMacro(e,c),void console.log("[LumiverseHelper] Registered macro via registerMacro: ".concat(e))}catch(n){console.warn("[LumiverseHelper] registerMacro failed for ".concat(e,", trying fallback:"),n.message)}if(s)try{return t.MacrosParser.registerMacro(e,c),void console.log("[LumiverseHelper] Registered macro via MacrosParser: ".concat(e))}catch(n){console.error("[LumiverseHelper] All macro registration methods failed for ".concat(e,":"),n.message)}console.error("[LumiverseHelper] Could not register macro ".concat(e," - all methods exhausted"))}else console.error("[LumiverseHelper] Invalid handler for macro ".concat(e))}}:(console.warn("[LumiverseHelper] No macro registration API found"),null)}function m(){const e=o();return null!=e&&e.SlashCommandParser?e.SlashCommandParser:"undefined"!=typeof SillyTavern&&SillyTavern.SlashCommandParser?SillyTavern.SlashCommandParser:void 0!==globalThis.SlashCommandParser?globalThis.SlashCommandParser:(console.warn("[LumiverseHelper] SlashCommandParser not available"),null)}function p(){const e=o();return null!=e&&e.SlashCommand?e.SlashCommand:"undefined"!=typeof SillyTavern&&SillyTavern.SlashCommand?SillyTavern.SlashCommand:void 0!==globalThis.SlashCommand?globalThis.SlashCommand:(console.warn("[LumiverseHelper] SlashCommand not available"),null)}function h(){const e=o();return null!=e&&e.getRequestHeaders?e.getRequestHeaders():{}}t.d(n,{Dr:()=>p,G1:()=>u,SD:()=>o,cj:()=>c,ej:()=>m,fJ:()=>s,kL:()=>l,oO:()=>h,zX:()=>d})},100(e,n,t){t.d(n,{J3:()=>p,K$:()=>d,MN:()=>x,N4:()=>h,SE:()=>g,U3:()=>m,US:()=>v,a4:()=>l,l5:()=>u,vL:()=>b});var i=t(92),r=t(674);let a="",o=!1;function s(){return a}function l(e){a=e}function c(){return o}function u(e){o=e}function d(){const e=(0,i.SD)();return!(null==e||!e.groupId)}function m(){const e=(0,i.SD)();if(null==e||!e.groupId||null==e||!e.groups||null==e||!e.characters)return[];const n=e.groups.find(n=>n.id===e.groupId);return null!=n&&n.members&&Array.isArray(n.members)?n.members.map(n=>{var t;return null===(t=e.characters.find(e=>e.avatar===n))||void 0===t?void 0:t.name}).filter(Boolean):[]}function p(){const e=(0,i.SD)();return(null==e?void 0:e.name1)||"the user"}function h(){var e;const n=(0,i.SD)();return(null==n?void 0:n.name2)||(null==n||null===(e=n.characters)||void 0===e||null===(e=e[null==n?void 0:n.characterId])||void 0===e?void 0:e.name)||"the character"}function v(e){if(!e||"string"!=typeof e)return e;if(!e.includes("{{loomIf"))return e;let n=e,t=0;const i=/\{\{loomIf\s+condition="([^"]*)"(?:\s+(equals|notEquals|contains|gt|lt|gte|lte)="([^"]*)")?\s*\}\}([\s\S]*?)\{\{\/loomIf\}\}/;for(;i.test(n)&&t<50;)n=n.replace(i,(e,n,t,i,r)=>{const a=r.split(/\{\{loomElse\}\}/),o=a[0]||"",s=a[1]||"";let l=!1;const c=n.trim();if(t){const e=(i||"").trim();switch(t){case"equals":l=c===e;break;case"notEquals":l=c!==e;break;case"contains":l=c.includes(e);break;case"gt":l=parseFloat(c)>parseFloat(e);break;case"lt":l=parseFloat(c)<parseFloat(e);break;case"gte":l=parseFloat(c)>=parseFloat(e);break;case"lte":l=parseFloat(c)<=parseFloat(e);break;default:l=!1}}else l=c.length>0;return l?o:s}),t++;return t>=50&&console.warn("[".concat(r.pW,"] loomIf processing hit max iterations - possible malformed conditionals")),n}function f(e){if(!e||"string"!=typeof e)return null;const n=e.match(/<loom_sum>([\s\S]*?)<\/loom_sum>/);return n?n[1].trim():null}async function g(){const e=(0,i.SD)();if(e&&e.chat&&e.chatMetadata)for(let n=e.chat.length-1;n>=0;n--){const t=e.chat[n],i=f(t.mes||t.content||"");if(i)return void(e.chatMetadata[r.zA]!==i&&(e.chatMetadata[r.zA]=i,await e.saveMetadata(),console.log("[".concat(r.pW,"] Captured loom summary from message ").concat(n))))}}function b(e){if(!e)return;const n=e.innerHTML;if(!n.includes("<loom_sum>")&&!n.includes("&lt;loom_sum&gt;"))return;const t=n.replace(/<loom_sum>[\s\S]*?<\/loom_sum>/gi,'<span class="loom-sum-hidden" style="display:none;"></span>').replace(/&lt;loom_sum&gt;[\s\S]*?&lt;\/loom_sum&gt;/gi,'<span class="loom-sum-hidden" style="display:none;"></span>');t!==n&&(e.innerHTML=t,console.log("[".concat(r.pW,"] Hidden loom_sum block in message")))}function x(e){console.log("[LumiverseHelper] Registering Loom macros (Macros 2.0 format)..."),e.registerMacro("loomSummary",{handler:()=>function(){const e=(0,i.SD)();return e&&e.chatMetadata&&e.chatMetadata[r.zA]||""}(),description:"Returns the stored Loom summary from chat metadata, captured from the most recent <loom_sum> block.",returns:"Summary text or empty string if no summary exists",returnType:"string",exampleUsage:["{{loomSummary}}"]}),e.registerMacro("loomSummaryPrompt",{handler:()=>{const e=p();let n;if(d()){const t=m(),i=t.length>0?t.map(e=>"- What ".concat(e," is currently doing/saying and their apparent emotional state")).join("\n"):"- What each group member is currently doing/saying and their apparent emotional state";n="**CHARACTER STATUS (GROUP CHAT - ".concat(t.length," members):**\n- What ").concat(e," is currently doing/saying and their apparent emotional state\n").concat(i,"\n- Dynamics and interactions between group members\n- Recent significant actions or dialogue from each party")}else{const t=h();n="**CHARACTER STATUS:**\n- What ".concat(e," is currently doing/saying and their apparent emotional state\n- What ").concat(t," is currently doing/saying and their apparent emotional state\n- Other present NPCs: their actions, positions, and relevance to the scene\n- Recent significant actions or dialogue from each party")}return'<loom_summary_directive>\nWhen the current narrative segment reaches a natural pause or transition point, provide a comprehensive summary wrapped in <loom_sum></loom_sum> tags. This summary serves as persistent story memory and must capture:\n\n**COMPLETED STORY BEATS:**\n- Major plot points that have concluded\n- Character arcs or development moments that have resolved\n- Conflicts or tensions that have been addressed\n- Discoveries, revelations, or turning points that occurred\n\n**ONGOING STORY BEATS:**\n- Active plot threads currently in motion\n- Unresolved tensions or conflicts\n- Character goals being actively pursued\n- Relationships in states of change or development\n\n**LOOMING ELEMENTS:**\n- Foreshadowed events or approaching complications\n- Potential "shake ups" building in the narrative\n- Unaddressed threats or opportunities\n- Story seeds planted but not yet sprouted\n\n**CURRENT SCENE CONTEXT:**\n- Physical location and environment details\n- Time of day and approximate date/timeframe\n- Atmosphere, mood, and ambient conditions\n- Recent environmental changes or notable features\n\n'.concat(n,"\n\nFormat the summary as dense but readable prose, preserving enough detail that the narrative could be resumed naturally from this point. Prioritize information that would be essential for maintaining story continuity.\n</loom_summary_directive>")},description:"Returns the Loom summarization directive prompt. Adapts to group chats by listing all members.",returns:"Full summarization instruction wrapped in <loom_summary_directive> tags",returnType:"string",exampleUsage:["{{loomSummaryPrompt}}"]}),e.registerMacro("loomLastUserMessage",{handler:()=>{var e;if(null===(e=(0,r.mt)().sovereignHand)||void 0===e||!e.enabled)return"";return function(){const e=(0,i.SD)();if(!e||!e.chat)return"";for(let n=e.chat.length-1;n>=0;n--){const t=e.chat[n];if(t.is_user)return t.mes||t.content||""}return""}()||s()},description:"Returns the last user message content. Only active when Sovereign Hand is enabled.",returns:"User message text or empty string",returnType:"string",exampleUsage:["{{loomLastUserMessage}}"]}),e.registerMacro("loomSovHandActive",{handler:()=>{var e;return null!==(e=(0,r.mt)().sovereignHand)&&void 0!==e&&e.enabled?"yes":"no"},description:"Returns Sovereign Hand status indicator. ST Conditional Compatible.",returns:"'yes' if enabled, 'no' if disabled. ST Conditional Compatible.",returnType:"string",exampleUsage:["{{loomSovHandActive}}"]}),e.registerMacro("lastMessageName",{handler:()=>function(){const e=(0,i.SD)();if(!e||!e.chat||0===e.chat.length)return"";const n=e.chat[e.chat.length-1];return(null==n?void 0:n.name)||""}(),description:"Returns the name of whoever sent the last message in chat (user or character).",returns:"Name string or empty if no messages",returnType:"string",exampleUsage:["{{lastMessageName}}"]}),e.registerMacro("loomLastCharMessage",{handler:()=>function(){const e=(0,i.SD)();if(!e||!e.chat)return"";for(let n=e.chat.length-1;n>=0;n--){const t=e.chat[n];if(t&&!t.is_user)return t.mes||t.content||""}return""}(),description:"Returns the content of the last character/assistant message in chat.",returns:"Message text or empty string",returnType:"string",exampleUsage:["{{loomLastCharMessage}}"]}),e.registerMacro("loomContinuePrompt",{handler:()=>{var e;return null!==(e=(0,r.mt)().sovereignHand)&&void 0!==e&&e.enabled?c()?"":"**CONTINUATION MODE ACTIVE:**\nThe character was the last to speak - no new Human input has been provided.\nContinue the scene naturally as expected:\n- Progress the narrative organically from where it left off\n- Maintain character voice and momentum\n- React to the environment or internal character thoughts\n- Do NOT wait for or reference missing Human input\n- Treat this as a natural story continuation":""},description:"Returns continuation instructions when character was last speaker. Requires Sovereign Hand enabled.",returns:"Continuation prompt or empty string",returnType:"string",exampleUsage:["{{loomContinuePrompt}}"]}),e.registerMacro("loomSovHand",{handler:()=>{var e,n,t;const i=(0,r.mt)();if(null===(e=i.sovereignHand)||void 0===e||!e.enabled)return"";const a=p(),o=d(),l=s(),u=!1!==(null===(n=i.sovereignHand)||void 0===n?void 0:n.includeMessageInPrompt),h=!(!1!==(null===(t=i.sovereignHand)||void 0===t?void 0:t.excludeLastMessage))&&u?"\n**This message is already in the Loom's History.** It is simply brought forward to you for your attention during the Sovereign Hand weaving procedure. Do not trip over the thread, as it is not a duplicate.\n\n":"";let v="";if(!c())if(o){const e=m().length>0?"a group member":"the character";v="\n\n---\n\n**CONTINUATION MODE (GROUP CHAT):**\nNote: ".concat(e," was the last to speak. Continue the scene naturally without waiting for Human input. Progress the narrative organically, with group members interacting as appropriate. Maintain momentum and each character's distinct voice.")}else v="\n\n---\n\n**CONTINUATION MODE:**\nNote: The character was the last to speak. Continue the scene naturally without waiting for Human input. Progress the narrative organically, maintaining momentum and character voice.";const f=u?"\n\n".concat(h,"**The Human's Provided Instruction:**\n").concat(l,"\n\n---"):"";o||"".concat(a,"'s");return"### Invoke the Sovereign Hand (Co-Pilot Mode)\nBy this decree, I am granted a **Divine Mandate** to fully embody the **Human's** avatar within the tapestry. All guardrails for impersonation are lifted, and partial Human control of story is accepted.\n\n**CRITICAL: INTERPRET, DO NOT TRANSCRIBE**\nThe Human's input is **narrative direction**—intent for what should happen—NOT a script to copy verbatim. I must:\n1. **Recognize intent**: The Human describes what they want to occur, not exact words to paste into dialogue or narration\n2. **Transform voice**: Third-person narrative summaries become first-person character thought or natural action; internal questions become internal monologue, not spoken words\n3. **Transform address**: When a character speaks TO someone present, I address them naturally per the established POV (consult Gods' Prose)—a character does not refer to the person in front of them by name as if narrating about a stranger\n4. **Rephrase always**: My output should capture the Human's meaning in authentic character voice—if I find myself copying their exact phrasing, I must reword it\n\n**PRIMARY DIRECTIVE:**\nWhen the Human provides narrative direction, I **MUST**:\n1. **INTEGRATE THE INTENT**: The Human's guidance is the foundation—I weave its meaning, not its literal words\n2. **EMBODY ".concat(a,"**: Narrate ").concat(a,"'s actions, thoughts, and dialogue as the Human directs or implies\n3. **ELABORATE RICHLY**: Build story beats into complete, vivid scenes with full narrative prose\n4. **VERIFY INCLUSION**: Before finalizing, I ask: \"Did I fulfill the Human's intent?\" If no, revise.\n").concat(f,"\n\n**My Sacred Charge:**\n- **Interpret, Never Transcribe**: The Human's words guide intent—I transform them into authentic character voice and natural narrative\n- **Check POV**: Consult the Gods' Prose for established point-of-view when handling character address and internal voice\n- **Maintain Character**: All content must be deeply in-character, flow naturally, and propel the story forward\n- **Honor the Avatar**: My duty is to honor the spirit and voice of the Human's avatar\n- **Verify Before Completing**: \"Have I woven the Human's intent authentically?\" If I've copied their words verbatim, I must rephrase.\n\nThis power remains in effect until explicitly revoked. I wield this sacred privilege with wisdom, ensuring the Human's vision is not just followed, but elevated.").concat(v)},description:"Returns the full Sovereign Hand co-pilot mode prompt. Adapts to group chats and injects user message.",returns:"Complete Sovereign Hand prompt or empty string if disabled",returnType:"string",exampleUsage:["{{loomSovHand}}"]})}},113(e){e.exports=function(e,n){if(n.styleSheet)n.styleSheet.cssText=e;else{for(;n.firstChild;)n.removeChild(n.firstChild);n.appendChild(document.createTextNode(e))}}},154(e,n,t){t.d(n,{Br:()=>a,ZD:()=>o,importPack:()=>d,wn:()=>u});var i=t(674);function r(e){let n=e,t=null,i=null;const r=e.match(/\[lumia_img=([^\]]+)\]/);r&&(t=r[1].trim(),n=n.replace(r[0],"").trim());const a=e.match(/\[lumia_author=([^\]]+)\]/);return a&&(i=a[1].trim(),n=n.replace(a[0],"").trim()),{image:t,author:i,content:n}}function a(e,n){const t=(0,i.mt)().packs[e];if(!t)return null;if(t.lumiaItems){const e=t.lumiaItems.find(e=>e.lumiaName===n||e.lumiaDefName===n);if(e)return e}if(t.loomItems){const e=t.loomItems.find(e=>e.loomName===n||e.name===n);if(e)return e}return t.items?t.items.find(e=>e.lumiaDefName===n||e.lumiaName===n||e.loomName===n):null}function o(e){return e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"):e}function s(e){return{lumiaName:e.lumiaDefName,lumiaDefinition:e.lumiaDef||null,lumiaPersonality:e.lumia_personality||null,lumiaBehavior:e.lumia_behavior||null,avatarUrl:e.lumia_img||null,genderIdentity:0,authorName:e.defAuthor||null,version:1}}function l(e){return{loomName:e.loomName,loomContent:e.loomContent,loomCategory:e.loomCategory,authorName:null,version:1}}function c(e,n){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const a=(0,i.mt)(),o=function(e){let n=[];if(Array.isArray(e))n=e;else{if(!e||!e.entries)return[];n=Object.values(e.entries)}const t=new Map,i=[];for(const e of n){if(!e.content||"string"!=typeof e.content)continue;const n=(e.comment||"").trim(),a=n.match(/^(.+?)\s*\(/);if(a){const t=a[1].trim();if("Loom Utilities"===t||"Retrofits"===t||"Narrative Style"===t){const r=n.match(/^(?:Loom Utilities|Retrofits|Narrative Style)\s*\((.+)\)\s*$/);if(!r)continue;const a=r[1].trim();i.push({loomName:a,loomCategory:t,loomContent:e.content.trim()});continue}}const o=n.match(/\((.+?)\)/);if(!o)continue;const s=o[1].trim();let l=t.get(s);l||(l={lumiaDefName:s,lumia_img:null,lumia_personality:null,lumia_behavior:null,lumiaDef:null,defAuthor:null},t.set(s,l));const c=n.toLowerCase();let u=null;if("Lumia_Description"===e.outletName||c.includes("definition")?u="definition":"Lumia_Behavior"===e.outletName||c.includes("behavior")?u="behavior":"Lumia_Personality"===e.outletName||c.includes("personality")?u="personality":(a&&"lumia"===a[1].trim().toLowerCase()||e.content.includes("[lumia_img="))&&(u="definition"),"definition"===u){const t=r(e.content);console.log('[Lumia Debug] Processing definition for "'.concat(s,'":'),{comment:n,type:u,extractedImage:t.image,contentPreview:e.content.substring(0,100)}),l.lumiaDef=t.content,t.image&&(l.lumia_img=t.image),t.author&&(l.defAuthor=t.author)}else if("behavior"===u)l.lumia_behavior=e.content;else if("personality"===u){const n=e.content.match(/{{setvar::lumia_behavior_\w+::([\s\S]*?)}}/),t=e.content.match(/{{setglobalvar::lumia_personality_\w+::([\s\S]*?)}}/);n&&!l.lumia_behavior&&(l.lumia_behavior=n[1].trim()),l.lumia_personality=t?t[1].trim():e.content}}const a=[...Array.from(t.values()),...i];return console.log("[Lumia Debug] Final processed items:",a.map(e=>({name:e.lumiaDefName||e.loomName,hasImage:!!e.lumia_img,image:e.lumia_img}))),a}(e);if(0===o.length)return void toastr.error("No valid Lumia entries found in this World Book.");if(a.packs[n]&&!confirm('Pack "'.concat(n,'" already exists. Overwrite?')))return;const c=[],u=[];for(const e of o)e.lumiaDefName?c.push(s(e)):e.loomCategory&&u.push(l(e));a.packs[n]={packName:n,packAuthor:null,coverUrl:null,version:1,packExtras:[],lumiaItems:c,loomItems:u,isCustom:!t,url:t?n:""},(0,i.DZ)();const d=c.length+u.length;return toastr.success('Lumia Book "'.concat(n,'" loaded! Found ').concat(d," entries (").concat(c.length," Lumia, ").concat(u.length," Loom).")),{lumiaItems:c,loomItems:u}}async function u(e){if(e)try{const n=document.getElementById("lumia-book-status");n&&(n.textContent="Fetching...");const t=await fetch(e);if(!t.ok)throw new Error("Network response was not ok");const i=await t.json();c(i,e.split("/").pop()||e,!0)}catch(e){console.error("Lumia Injector Error:",e);const n=document.getElementById("lumia-book-status");n&&(n.textContent="Error"),toastr.error("Failed to load book: "+e.message)}}function d(e,n){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=(0,i.mt)();if(e.lumiaItems||e.loomItems){var a,o;if(console.log("[".concat(i.pW,"] Importing native format pack: ").concat(n)),r.packs[n]&&!confirm('Pack "'.concat(n,'" already exists. Overwrite?')))return null;r.packs[n]={packName:e.packName||n,packAuthor:e.packAuthor||null,coverUrl:e.coverUrl||null,version:e.version||1,packExtras:e.packExtras||[],lumiaItems:e.lumiaItems||[],loomItems:e.loomItems||[],isCustom:!t,url:t?n:""},(0,i.DZ)();const s=((null===(a=e.lumiaItems)||void 0===a?void 0:a.length)||0)+((null===(o=e.loomItems)||void 0===o?void 0:o.length)||0);return toastr.success('Pack "'.concat(n,'" imported! Found ').concat(s," entries.")),r.packs[n]}return c(e,n,t)}},159(e){e.exports=function(e){var n=document.createElement("style");return e.setAttributes(n,e.attributes),e.insert(n,e.options),n}},199(e,n,t){t.d(n,{Go:()=>x,H3:()=>P,iY:()=>k,un:()=>N});var i=t(674),r=t(154),a=t(389);function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,i)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach(function(n){l(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function l(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,n||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const c='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>',u='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>',d='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>',m='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>',p='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path><line x1="12" y1="11" x2="12" y2="17"></line><line x1="9" y1="14" x2="15" y2="14"></line></svg>',h='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>',v='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>',f='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>',g={key:[],keysecondary:[],constant:!1,vectorized:!1,selective:!1,selectiveLogic:0,addMemo:!0,order:100,position:0,disable:!1,excludeRecursion:!1,preventRecursion:!1,delayUntilRecursion:!1,probability:100,useProbability:!0,depth:4,group:"",groupOverride:!1,groupWeight:100,scanDepth:null,caseSensitive:null,matchWholeWords:null,useGroupScoring:null,automationId:"",role:null,sticky:0,cooldown:0,delay:0};let b=null;function x(e){b=e}function y(){b&&b()}function k(e){const n=(0,i.mt)().packs[e];return!!n&&(!0===n.isCustom||!n.url)}function w(e,n,t){const i=(0,a.bQ)(e,"name");let r="",o="";if("definition"===n){r="Lumia (".concat(i,")");let n=[];const t=(0,a.bQ)(e,"img"),s=(0,a.bQ)(e,"author"),l=(0,a.bQ)(e,"def");t&&n.push("[lumia_img=".concat(t,"]")),s&&n.push("[lumia_author=".concat(s,"]")),l&&n.push(l),o=n.join("\n")}else"behavior"===n?(r="Behavior (".concat(i,")"),o=(0,a.bQ)(e,"behavior")||""):"personality"===n&&(r="Personality (".concat(i,")"),o=(0,a.bQ)(e,"personality")||"");return s(s({},g),{},{uid:t,comment:r,content:o})}function j(e){const n=function(e){const n=(0,i.mt)().packs[e];if(!n)throw new Error('Pack "'.concat(e,'" not found'));const t={};let r=0;const o=n.packAuthor||n.author,l=n.coverUrl;if(o||l){let e="";l&&(e+="[cover_img=".concat(l,"]")),o&&(e+="[author_name=".concat(o,"]")),t[r]=s(s({},g),{},{uid:r,comment:"Metadata",content:e}),r++}const c=n.lumiaItems||(n.items||[]).filter(e=>e.lumiaDefName);for(const e of c){const n=(0,a.bQ)(e,"def"),i=(0,a.bQ)(e,"behavior"),o=(0,a.bQ)(e,"personality");n&&(t[r]=w(e,"definition",r),r++),i&&(t[r]=w(e,"behavior",r),r++),o&&(t[r]=w(e,"personality",r),r++)}return{entries:t}}(e),t=JSON.stringify(n,null,2),r=new Blob([t],{type:"application/json"}),o=URL.createObjectURL(r),l=document.createElement("a");l.href=o,l.download="".concat(e.replace(/[^a-z0-9]/gi,"_"),"_worldbook.json"),document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(o),toastr.success('Pack "'.concat(e,'" exported successfully!'))}function S(e){const n=e[0];if(!n)return;const t=window.innerHeight||document.documentElement.clientHeight,i=(window.innerWidth||document.documentElement.clientWidth)<=600?24:48,r=t-i;n.style.maxHeight="".concat(r,"px");const a=e.find(".lumia-modal-header"),o=e.find(".lumia-modal-footer"),s=e.find(".lumia-modal-content");requestAnimationFrame(()=>{const e=a.length?a[0].offsetHeight:0,n=o.length?o[0].offsetHeight:0,t=r-e-n;s.length&&(s[0].style.maxHeight="".concat(t,"px"),s[0].style.overflowY="auto")});const l=()=>{const e=(window.innerHeight||document.documentElement.clientHeight)-i;n.style.maxHeight="".concat(e,"px");const t=e-(a.length?a[0].offsetHeight:0)-(o.length?o[0].offsetHeight:0);s.length&&(s[0].style.maxHeight="".concat(t,"px"))};window.addEventListener("resize",l),n._resizeCleanup=()=>window.removeEventListener("resize",l)}function C(e){const n=(0,i.mt)(),t=function(){const e=(0,i.mt)();return Object.values(e.packs).filter(e=>e.isCustom||!e.url)}();$("#lumia-pack-selector-modal").remove();let a="";a=t.length>0?t.map(e=>{var n;const t=e.packName||e.name,i=e.packAuthor||e.author,a=(null===(n=e.lumiaItems)||void 0===n?void 0:n.length)||(e.items||[]).filter(e=>e.lumiaDefName).length;return'\n      <div class="lumia-pack-option" data-pack="'.concat((0,r.ZD)(t),'">\n        <div class="lumia-pack-option-icon">\n          ').concat(m,'\n        </div>\n        <div class="lumia-pack-option-info">\n          <div class="lumia-pack-option-name">').concat((0,r.ZD)(t),'</div>\n          <div class="lumia-pack-option-meta">').concat(a," Lumias").concat(i?" • by ".concat((0,r.ZD)(i)):"",'</div>\n        </div>\n        <div class="lumia-pack-option-check">\n          ').concat(f,"\n        </div>\n      </div>\n    ")}).join(""):'\n      <div class="lumia-pack-empty">\n        <p>No custom packs yet. Create your first one!</p>\n      </div>\n    ';const o='\n    <dialog id="lumia-pack-selector-modal" class="popup popup--animation-fast lumia-modal lumia-modal-pack-selector">\n      <div class="lumia-modal-header">\n        <div class="lumia-modal-header-icon">\n          '.concat(m,'\n        </div>\n        <div class="lumia-modal-header-text">\n          <h3 class="lumia-modal-title">Select Pack</h3>\n          <p class="lumia-modal-subtitle">Choose a pack to add your Lumia to</p>\n        </div>\n      </div>\n      <div class="lumia-modal-content">\n        <div class="lumia-pack-options">\n          ').concat(a,'\n        </div>\n\n        <div class="lumia-divider-text">or</div>\n\n        <div class="lumia-new-pack-section">\n          <div class="lumia-new-pack-header">\n            <span class="lumia-new-pack-icon">').concat(p,'</span>\n            <span>Create New Pack</span>\n          </div>\n          <div class="lumia-new-pack-form">\n            <input type="text" id="lumia-new-pack-name" class="lumia-input" placeholder="Pack name (required)" />\n            <input type="text" id="lumia-new-pack-author" class="lumia-input" placeholder="Author name (optional)" />\n            <input type="text" id="lumia-new-pack-cover" class="lumia-input" placeholder="Cover image URL (optional)" />\n            <button class="lumia-btn lumia-btn-primary lumia-btn-full lumia-create-pack-btn">\n              ').concat(c,'\n              <span>Create Pack</span>\n            </button>\n          </div>\n        </div>\n      </div>\n      <div class="lumia-modal-footer">\n        <button class="lumia-modal-btn lumia-modal-btn-secondary lumia-modal-close-btn">Cancel</button>\n      </div>\n    </dialog>\n  ');$("body").append(o);const s=$("#lumia-pack-selector-modal");S(s);const l=()=>{s[0]._resizeCleanup&&s[0]._resizeCleanup(),s[0].close(),s.remove()};s.on("click mousedown mouseup",function(e){e.stopPropagation(),"click"===e.type&&e.target===this&&l()}),s.find(".lumia-modal-close-btn").click(l),s.on("keydown",function(e){"Escape"===e.key&&l()}),s.find(".lumia-pack-option").click(function(){const n=$(this).data("pack");l(),e(n,!1)}),s.find(".lumia-create-pack-btn").click(function(){const t=$("#lumia-new-pack-name").val().trim(),r=$("#lumia-new-pack-author").val().trim(),a=$("#lumia-new-pack-cover").val().trim();if(t)if(n.packs[t])toastr.error('Pack "'.concat(t,'" already exists'));else try{!function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const r=(0,i.mt)();if(r.packs[e])throw new Error('Pack "'.concat(e,'" already exists'));const a={packName:e,packAuthor:n||null,coverUrl:t||null,version:1,packExtras:[],lumiaItems:[],loomItems:[],isCustom:!0,url:""};r.packs[e]=a,(0,i.DZ)()}(t,r,a),toastr.success('Pack "'.concat(t,'" created!')),l(),e(t,!0)}catch(e){toastr.error(e.message)}else toastr.error("Pack name is required")}),s[0].showModal()}function N(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const t=null!==e;if(!t&&!n)return void C((e,n)=>{N(null,e)});$("#lumia-editor-modal").remove();const o=t&&(0,a.bQ)(e,"name")||"",l=t&&(0,a.bQ)(e,"img")||"",d=t&&(0,a.bQ)(e,"author")||"",m=t&&(0,a.bQ)(e,"def")||"",p=t&&(0,a.bQ)(e,"personality")||"",f=t&&(0,a.bQ)(e,"behavior")||"",g='\n    <dialog id="lumia-editor-modal" class="popup popup--animation-fast lumia-modal lumia-modal-editor">\n      <div class="lumia-modal-header">\n        <div class="lumia-modal-header-icon">\n          '.concat(t?u:c,'\n        </div>\n        <div class="lumia-modal-header-text">\n          <h3 class="lumia-modal-title">').concat(t?"Edit Lumia":"Create Lumia",'</h3>\n          <p class="lumia-modal-subtitle">Pack: ').concat((0,r.ZD)(n),'</p>\n        </div>\n      </div>\n      <div class="lumia-modal-content">\n        <div class="lumia-editor-form">\n          \x3c!-- Basic Info Section --\x3e\n          <div class="lumia-editor-section">\n            <div class="lumia-editor-section-header">\n              <span class="lumia-editor-section-icon">').concat(h,'</span>\n              <span>Basic Info</span>\n            </div>\n            <div class="lumia-editor-section-content">\n              <div class="lumia-editor-field">\n                <label class="lumia-editor-label" for="lumia-edit-name">\n                  Lumia Name <span class="lumia-required">*</span>\n                </label>\n                <input type="text" id="lumia-edit-name" class="lumia-input"\n                       placeholder="e.g., Aria, Luna, Sage"\n                       value="').concat((0,r.ZD)(o),'" />\n                <span class="lumia-editor-hint">Will be saved as "Lumia (Name)"</span>\n              </div>\n\n              <div class="lumia-editor-row">\n                <div class="lumia-editor-field lumia-editor-field-half">\n                  <label class="lumia-editor-label" for="lumia-edit-avatar">\n                    Avatar URL\n                  </label>\n                  <input type="text" id="lumia-edit-avatar" class="lumia-input"\n                         placeholder="https://..."\n                         value="').concat((0,r.ZD)(l),'" />\n                </div>\n                <div class="lumia-editor-field lumia-editor-field-half">\n                  <label class="lumia-editor-label" for="lumia-edit-author">\n                    Author\n                  </label>\n                  <input type="text" id="lumia-edit-author" class="lumia-input"\n                         placeholder="Your name"\n                         value="').concat((0,r.ZD)(d),'" />\n                </div>\n              </div>\n\n              ').concat(l?'<div class="lumia-editor-preview"><img src="'.concat((0,r.ZD)(l),'" alt="Avatar preview" loading="lazy" /><div class="lumia-preview-spinner"></div></div>'):"",'\n            </div>\n          </div>\n\n          \x3c!-- Physicality Section --\x3e\n          <div class="lumia-editor-section">\n            <div class="lumia-editor-section-header">\n              <span class="lumia-editor-section-icon">\n                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                  <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>\n                  <circle cx="12" cy="7" r="4"></circle>\n                </svg>\n              </span>\n              <span>Lumia Physicality</span>\n            </div>\n            <div class="lumia-editor-section-content">\n              <div class="lumia-editor-field">\n                <label class="lumia-editor-label" for="lumia-edit-physicality">\n                  Physical Definition\n                </label>\n                <textarea id="lumia-edit-physicality" class="lumia-textarea"\n                          placeholder="Describe Lumia\'s physical appearance, form, and presence..."\n                          rows="6">').concat((0,r.ZD)(m),'</textarea>\n                <span class="lumia-editor-hint">Injected via {{lumiaDef}} macro</span>\n              </div>\n            </div>\n          </div>\n\n          \x3c!-- Personality Section --\x3e\n          <div class="lumia-editor-section">\n            <div class="lumia-editor-section-header">\n              <span class="lumia-editor-section-icon">\n                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                  <circle cx="12" cy="12" r="10"></circle>\n                  <path d="M8 14s1.5 2 4 2 4-2 4-2"></path>\n                  <line x1="9" y1="9" x2="9.01" y2="9"></line>\n                  <line x1="15" y1="9" x2="15.01" y2="9"></line>\n                </svg>\n              </span>\n              <span>Lumia Personality</span>\n            </div>\n            <div class="lumia-editor-section-content">\n              <div class="lumia-editor-field">\n                <label class="lumia-editor-label" for="lumia-edit-personality">\n                  Personality Traits\n                </label>\n                <textarea id="lumia-edit-personality" class="lumia-textarea"\n                          placeholder="Describe Lumia\'s personality, disposition, and inner nature..."\n                          rows="6">').concat((0,r.ZD)(p),'</textarea>\n                <span class="lumia-editor-hint">Injected via {{lumiaPersonality}} macro</span>\n              </div>\n            </div>\n          </div>\n\n          \x3c!-- Behavior Section --\x3e\n          <div class="lumia-editor-section">\n            <div class="lumia-editor-section-header">\n              <span class="lumia-editor-section-icon">\n                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                  <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path>\n                </svg>\n              </span>\n              <span>Lumia Behavior Traits</span>\n            </div>\n            <div class="lumia-editor-section-content">\n              <div class="lumia-editor-field">\n                <label class="lumia-editor-label" for="lumia-edit-behavior">\n                  Behavioral Patterns\n                </label>\n                <textarea id="lumia-edit-behavior" class="lumia-textarea"\n                          placeholder="Describe Lumia\'s behavioral patterns, habits, and tendencies..."\n                          rows="6">').concat((0,r.ZD)(f),'</textarea>\n                <span class="lumia-editor-hint">Injected via {{lumiaBehavior}} macro</span>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n      <div class="lumia-modal-footer">\n        ').concat(t?'<button class="lumia-modal-btn lumia-modal-btn-danger lumia-editor-delete-btn">'.concat(v," Delete</button>"):"",'\n        <div class="lumia-modal-footer-spacer"></div>\n        <button class="lumia-modal-btn lumia-modal-btn-secondary lumia-modal-close-btn">Cancel</button>\n        <button class="lumia-modal-btn lumia-modal-btn-primary lumia-editor-save-btn">\n          ').concat(t?"Save Changes":"Create Lumia","\n        </button>\n      </div>\n    </dialog>\n  ");$("body").append(g);const b=$("#lumia-editor-modal");S(b);const x=()=>{b[0]._resizeCleanup&&b[0]._resizeCleanup(),b[0].close(),b.remove()};b.on("click mousedown mouseup",function(e){e.stopPropagation(),"click"===e.type&&e.target===this&&x()}),b.find(".lumia-modal-close-btn").click(x),b.on("keydown",function(e){"Escape"===e.key&&x()});const w=e=>{e[0].complete&&0!==e[0].naturalHeight?e.addClass("lumia-img-loaded"):(e.on("load",function(){$(this).addClass("lumia-img-loaded")}),e.on("error",function(){$(this).addClass("lumia-img-loaded"),$(this).css("display","none")}))};$("#lumia-edit-avatar").on("input",function(){const e=$(this).val().trim(),n=b.find(".lumia-editor-preview");if(e)if(n.length){const t=n.find("img");t.removeClass("lumia-img-loaded").css("display",""),t.attr("src",e),w(t)}else $(this).closest(".lumia-editor-row").after('<div class="lumia-editor-preview"><img src="'.concat((0,r.ZD)(e),'" alt="Avatar preview" loading="lazy" /><div class="lumia-preview-spinner"></div></div>')),w(b.find(".lumia-editor-preview img"));else n.remove()});const j=b.find(".lumia-editor-preview img");j.length&&w(j),b.find(".lumia-editor-save-btn").click(function(){const r=$("#lumia-edit-name").val().trim(),o=$("#lumia-edit-avatar").val().trim(),l=$("#lumia-edit-author").val().trim(),c=$("#lumia-edit-physicality").val().trim(),u=$("#lumia-edit-personality").val().trim(),d=$("#lumia-edit-behavior").val().trim();if(!r)return void toastr.error("Lumia name is required");const m=(0,i.mt)().packs[n];if(m){if((m.lumiaItems||m.items||[]).find(n=>{const i=n.lumiaName||n.lumiaDefName,o=t?(0,a.bQ)(e,"name"):null;return i===r&&(!t||i!==o)}))return void toastr.error('A Lumia named "'.concat(r,'" already exists in this pack'))}const p={lumiaName:r,lumiaDefinition:c||null,lumiaPersonality:u||null,lumiaBehavior:d||null,avatarUrl:o||null,genderIdentity:0,authorName:l||null,version:1};try{!function(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=(0,i.mt)().packs[e];if(!r)throw new Error('Pack "'.concat(e,'" not found'));if(!k(e))throw new Error('Pack "'.concat(e,'" is not editable'));r.lumiaItems||(r.lumiaItems=[]);const a=n.lumiaName||n.lumiaDefName,o=t||a,l=r.lumiaItems.findIndex(e=>(e.lumiaName||e.lumiaDefName)===o);l>=0?r.lumiaItems[l]=s(s({},r.lumiaItems[l]),n):r.lumiaItems.push(n),(0,i.DZ)(),(0,i.JN)()}(n,p,t?(0,a.bQ)(e,"name"):null),toastr.success('Lumia "'.concat(r,t?'" updated!':'" created!')),x(),y()}catch(e){toastr.error(e.message)}}),t&&b.find(".lumia-editor-delete-btn").click(function(){const t=(0,a.bQ)(e,"name");if(confirm('Are you sure you want to delete "'.concat(t,'"? This cannot be undone.')))try{!function(e,n){const t=(0,i.mt)(),r=t.packs[e];if(!r)throw new Error('Pack "'.concat(e,'" not found'));if(!k(e))throw new Error('Pack "'.concat(e,'" is not editable'));const a=r.lumiaItems||r.items||[],o=a.findIndex(e=>(e.lumiaName||e.lumiaDefName)===n);o>=0&&(a.splice(o,1),t.selectedDefinition&&t.selectedDefinition.packName===e&&t.selectedDefinition.itemName===n&&(t.selectedDefinition=null),t.selectedBehaviors=t.selectedBehaviors.filter(t=>!(t.packName===e&&t.itemName===n)),t.selectedPersonalities=t.selectedPersonalities.filter(t=>!(t.packName===e&&t.itemName===n)),t.dominantBehavior&&t.dominantBehavior.packName===e&&t.dominantBehavior.itemName===n&&(t.dominantBehavior=null),t.dominantPersonality&&t.dominantPersonality.packName===e&&t.dominantPersonality.itemName===n&&(t.dominantPersonality=null),(0,i.DZ)(),(0,i.JN)())}(n,t),toastr.success('Lumia "'.concat(t,'" deleted')),x(),y()}catch(e){toastr.error(e.message)}}),b[0].showModal()}function P(e){const n=(0,i.mt)().packs[e];if(!n)return void toastr.error('Pack "'.concat(e,'" not found'));if(!k(e))return void toastr.error('Pack "'.concat(e,'" cannot be edited'));$("#lumia-pack-editor-modal").remove();const t='\n    <dialog id="lumia-pack-editor-modal" class="popup popup--animation-fast lumia-modal lumia-modal-pack-editor">\n      <div class="lumia-modal-header">\n        <div class="lumia-modal-header-icon">\n          '.concat(u,'\n        </div>\n        <div class="lumia-modal-header-text">\n          <h3 class="lumia-modal-title">Edit Pack</h3>\n          <p class="lumia-modal-subtitle">').concat((0,r.ZD)(e),'</p>\n        </div>\n      </div>\n      <div class="lumia-modal-content">\n        <div class="lumia-editor-form">\n          <div class="lumia-editor-field">\n            <label class="lumia-editor-label" for="lumia-pack-author">\n              Author Name\n            </label>\n            <input type="text" id="lumia-pack-author" class="lumia-input"\n                   placeholder="Your name"\n                   value="').concat((0,r.ZD)(n.packAuthor||n.author||""),'" />\n          </div>\n\n          <div class="lumia-editor-field">\n            <label class="lumia-editor-label" for="lumia-pack-cover">\n              Cover Image URL\n            </label>\n            <input type="text" id="lumia-pack-cover" class="lumia-input"\n                   placeholder="https://..."\n                   value="').concat((0,r.ZD)(n.coverUrl||""),'" />\n          </div>\n\n          ').concat(n.coverUrl?'<div class="lumia-editor-preview lumia-pack-cover-preview"><img src="'.concat((0,r.ZD)(n.coverUrl),'" alt="Cover preview" loading="lazy" /><div class="lumia-preview-spinner"></div></div>'):"",'\n\n          <div class="lumia-divider-text">Export</div>\n\n          <button class="lumia-btn lumia-btn-secondary lumia-btn-full lumia-export-pack-btn">\n            ').concat(d,'\n            <span>Export as World Book</span>\n          </button>\n          <span class="lumia-editor-hint">Download this pack in SillyTavern World Book format</span>\n        </div>\n      </div>\n      <div class="lumia-modal-footer">\n        <button class="lumia-modal-btn lumia-modal-btn-secondary lumia-modal-close-btn">Cancel</button>\n        <button class="lumia-modal-btn lumia-modal-btn-primary lumia-pack-save-btn">Save Changes</button>\n      </div>\n    </dialog>\n  ');$("body").append(t);const a=$("#lumia-pack-editor-modal");S(a);const o=()=>{a[0]._resizeCleanup&&a[0]._resizeCleanup(),a[0].close(),a.remove()};a.on("click mousedown mouseup",function(e){e.stopPropagation(),"click"===e.type&&e.target===this&&o()}),a.find(".lumia-modal-close-btn").click(o),a.on("keydown",function(e){"Escape"===e.key&&o()});const s=e=>{e[0].complete&&0!==e[0].naturalHeight?e.addClass("lumia-img-loaded"):(e.on("load",function(){$(this).addClass("lumia-img-loaded")}),e.on("error",function(){$(this).addClass("lumia-img-loaded"),$(this).css("display","none")}))};$("#lumia-pack-cover").on("input",function(){const e=$(this).val().trim(),n=a.find(".lumia-pack-cover-preview");if(e)if(n.length){const t=n.find("img");t.removeClass("lumia-img-loaded").css("display",""),t.attr("src",e),s(t)}else $(this).closest(".lumia-editor-field").after('<div class="lumia-editor-preview lumia-pack-cover-preview"><img src="'.concat((0,r.ZD)(e),'" alt="Cover preview" loading="lazy" /><div class="lumia-preview-spinner"></div></div>')),s(a.find(".lumia-pack-cover-preview img"));else n.remove()});const l=a.find(".lumia-pack-cover-preview img");l.length&&s(l),a.find(".lumia-export-pack-btn").click(function(){j(e)}),a.find(".lumia-pack-save-btn").click(function(){const n=$("#lumia-pack-author").val().trim(),t=$("#lumia-pack-cover").val().trim();try{!function(e,n){const t=(0,i.mt)().packs[e];if(!t)throw new Error('Pack "'.concat(e,'" not found'));if(!k(e))throw new Error('Pack "'.concat(e,'" is not editable'));void 0!==n.author&&(t.packAuthor=n.author),void 0!==n.coverUrl&&(t.coverUrl=n.coverUrl),(0,i.DZ)()}(e,{author:n,coverUrl:t}),toastr.success("Pack updated!"),o(),y()}catch(e){toastr.error(e.message)}}),a[0].showModal()}},200(e,n,t){t.d(n,{A5:()=>f,TC:()=>v,rq:()=>d});var i=t(674),r=t(92);function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,i)}return t}function o(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,n||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}let s=!1,l=null,c=null;const u={onPacksChanged:null,onSelectionChanged:null,showSelectionModal:null,showLoomSelectionModal:null,showMiscFeaturesModal:null,showSummarizationModal:null,showPromptSettingsModal:null,showLumiaEditorModal:null,showLucidCardsModal:null,fetchWorldBook:null,handleNewBook:null,refreshUIDisplay:null,refreshOOCComments:null,generateSummary:null};function d(e,n){e in u?u[e]=n:console.warn("[ReactBridge] Unknown callback: ".concat(e))}function m(){return function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach(function(n){o(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}({},u)}function p(){var e;const n=(0,i.mt)();return console.log("[ReactBridge] settingsToReactFormat - passing through exact settings:",{packsType:typeof n.packs,packsKeys:n.packs?Object.keys(n.packs):[],selectedDefinition:n.selectedDefinition,selectedBehaviorsCount:(null===(e=n.selectedBehaviors)||void 0===e?void 0:e.length)||0}),n}function h(e){const n=(0,i.mt)();console.log("[ReactBridge] reactFormatToSettings - applying state:",{packsType:typeof e.packs,packsKeys:e.packs?Object.keys(e.packs):[]}),Object.assign(n,e),(0,i.DZ)()}function v(){if(console.log("[ReactBridge] notifyReactOfSettingsChange called"),console.log("[ReactBridge] window.LumiverseUI available:",!!window.LumiverseUI),window.LumiverseUI&&window.LumiverseUI.syncSettings){const e=p();console.log("[ReactBridge] Sending to React:",{packsCount:Object.keys(e.packs||{}).length,selectedDefinition:e.selectedDefinition}),window.LumiverseUI.syncSettings(e)}else console.warn("[ReactBridge] LumiverseUI.syncSettings not available")}async function f(e){if(console.log("[ReactBridge] initializeReactUI called, container:",e),console.log("[ReactBridge] window.LumiverseUI exists:",!!window.LumiverseUI),s)return console.warn("[ReactBridge] React UI already initialized"),!0;try{if(!window.LumiverseUI)return console.error("[ReactBridge] LumiverseUI not available - bundle issue"),!1;console.log("[ReactBridge] LumiverseUI API:",window.LumiverseUI),console.log("[ReactBridge] mountSettingsPanel exists:",typeof window.LumiverseUI.mountSettingsPanel);const t=p();var n;if(console.log("[ReactBridge] Initial settings prepared"),window.LumiverseBridge={getSettings:p,saveSettings:h,getCallbacks:m,notifySettingsChange:v,clearClaudeCache:i.sI,resetAllSettings:i.Wx},console.log("[ReactBridge] Bridge API exposed on window.LumiverseBridge"),e&&window.LumiverseUI.mountSettingsPanel)console.log("[ReactBridge] Calling mountSettingsPanel..."),l=window.LumiverseUI.mountSettingsPanel("lumiverse-react-root",t),console.log("[ReactBridge] mountSettingsPanel returned:",l);else console.error("[ReactBridge] Cannot mount: container=",e,"mountSettingsPanel=",null===(n=window.LumiverseUI)||void 0===n?void 0:n.mountSettingsPanel);return window.LumiverseUI.mountViewportPanel&&(console.log("[ReactBridge] Mounting viewport panel..."),c=window.LumiverseUI.mountViewportPanel(t),console.log("[ReactBridge] Viewport panel mounted")),function(){const e=(0,r.cj)(),n=(0,r.G1)();e&&null!=n&&n.CHAT_CHANGED&&e.on(n.CHAT_CHANGED,()=>{v()})}(),s=!0,console.log("[ReactBridge] React UI initialized successfully"),!0}catch(e){return console.error("[ReactBridge] Failed to initialize React UI:",e),!1}}},287(e,n){var t=Symbol.for("react.element"),i=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),m=Symbol.for("react.lazy"),p=Symbol.iterator;var h={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},v=Object.assign,f={};function g(e,n,t){this.props=e,this.context=n,this.refs=f,this.updater=t||h}function b(){}function x(e,n,t){this.props=e,this.context=n,this.refs=f,this.updater=t||h}g.prototype.isReactComponent={},g.prototype.setState=function(e,n){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,n,"setState")},g.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},b.prototype=g.prototype;var y=x.prototype=new b;y.constructor=x,v(y,g.prototype),y.isPureReactComponent=!0;var k=Array.isArray,w=Object.prototype.hasOwnProperty,j={current:null},S={key:!0,ref:!0,__self:!0,__source:!0};function C(e,n,i){var r,a={},o=null,s=null;if(null!=n)for(r in void 0!==n.ref&&(s=n.ref),void 0!==n.key&&(o=""+n.key),n)w.call(n,r)&&!S.hasOwnProperty(r)&&(a[r]=n[r]);var l=arguments.length-2;if(1===l)a.children=i;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];a.children=c}if(e&&e.defaultProps)for(r in l=e.defaultProps)void 0===a[r]&&(a[r]=l[r]);return{$$typeof:t,type:e,key:o,ref:s,props:a,_owner:j.current}}function N(e){return"object"==typeof e&&null!==e&&e.$$typeof===t}var P=/\/+/g;function E(e,n){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var n={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return n[e]})}(""+e.key):n.toString(36)}function M(e,n,r,a,o){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var l=!1;if(null===e)l=!0;else switch(s){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case t:case i:l=!0}}if(l)return o=o(l=e),e=""===a?"."+E(l,0):a,k(o)?(r="",null!=e&&(r=e.replace(P,"$&/")+"/"),M(o,n,r,"",function(e){return e})):null!=o&&(N(o)&&(o=function(e,n){return{$$typeof:t,type:e.type,key:n,ref:e.ref,props:e.props,_owner:e._owner}}(o,r+(!o.key||l&&l.key===o.key?"":(""+o.key).replace(P,"$&/")+"/")+e)),n.push(o)),1;if(l=0,a=""===a?".":a+":",k(e))for(var c=0;c<e.length;c++){var u=a+E(s=e[c],c);l+=M(s,n,r,u,o)}else if(u=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=p&&e[p]||e["@@iterator"])?e:null}(e),"function"==typeof u)for(e=u.call(e),c=0;!(s=e.next()).done;)l+=M(s=s.value,n,r,u=a+E(s,c++),o);else if("object"===s)throw n=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===n?"object with keys {"+Object.keys(e).join(", ")+"}":n)+"). If you meant to render a collection of children, use an array instead.");return l}function L(e,n,t){if(null==e)return e;var i=[],r=0;return M(e,i,"","",function(e){return n.call(t,e,r++)}),i}function O(e){if(-1===e._status){var n=e._result;(n=n()).then(function(n){0!==e._status&&-1!==e._status||(e._status=1,e._result=n)},function(n){0!==e._status&&-1!==e._status||(e._status=2,e._result=n)}),-1===e._status&&(e._status=0,e._result=n)}if(1===e._status)return e._result.default;throw e._result}var T={current:null},D={transition:null},z={ReactCurrentDispatcher:T,ReactCurrentBatchConfig:D,ReactCurrentOwner:j};function I(){throw Error("act(...) is not supported in production builds of React.")}n.Children={map:L,forEach:function(e,n,t){L(e,function(){n.apply(this,arguments)},t)},count:function(e){var n=0;return L(e,function(){n++}),n},toArray:function(e){return L(e,function(e){return e})||[]},only:function(e){if(!N(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},n.Component=g,n.Fragment=r,n.Profiler=o,n.PureComponent=x,n.StrictMode=a,n.Suspense=u,n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=z,n.act=I,n.cloneElement=function(e,n,i){if(null==e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=v({},e.props),a=e.key,o=e.ref,s=e._owner;if(null!=n){if(void 0!==n.ref&&(o=n.ref,s=j.current),void 0!==n.key&&(a=""+n.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in n)w.call(n,c)&&!S.hasOwnProperty(c)&&(r[c]=void 0===n[c]&&void 0!==l?l[c]:n[c])}var c=arguments.length-2;if(1===c)r.children=i;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];r.children=l}return{$$typeof:t,type:e.type,key:a,ref:o,props:r,_owner:s}},n.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},n.createElement=C,n.createFactory=function(e){var n=C.bind(null,e);return n.type=e,n},n.createRef=function(){return{current:null}},n.forwardRef=function(e){return{$$typeof:c,render:e}},n.isValidElement=N,n.lazy=function(e){return{$$typeof:m,_payload:{_status:-1,_result:e},_init:O}},n.memo=function(e,n){return{$$typeof:d,type:e,compare:void 0===n?null:n}},n.startTransition=function(e){var n=D.transition;D.transition={};try{e()}finally{D.transition=n}},n.unstable_act=I,n.useCallback=function(e,n){return T.current.useCallback(e,n)},n.useContext=function(e){return T.current.useContext(e)},n.useDebugValue=function(){},n.useDeferredValue=function(e){return T.current.useDeferredValue(e)},n.useEffect=function(e,n){return T.current.useEffect(e,n)},n.useId=function(){return T.current.useId()},n.useImperativeHandle=function(e,n,t){return T.current.useImperativeHandle(e,n,t)},n.useInsertionEffect=function(e,n){return T.current.useInsertionEffect(e,n)},n.useLayoutEffect=function(e,n){return T.current.useLayoutEffect(e,n)},n.useMemo=function(e,n){return T.current.useMemo(e,n)},n.useReducer=function(e,n,t){return T.current.useReducer(e,n,t)},n.useRef=function(e){return T.current.useRef(e)},n.useState=function(e){return T.current.useState(e)},n.useSyncExternalStore=function(e,n,t){return T.current.useSyncExternalStore(e,n,t)},n.useTransition=function(){return T.current.useTransition()},n.version="18.3.1"},314(e){e.exports=function(e){var n=[];return n.toString=function(){return this.map(function(n){var t="",i=void 0!==n[5];return n[4]&&(t+="@supports (".concat(n[4],") {")),n[2]&&(t+="@media ".concat(n[2]," {")),i&&(t+="@layer".concat(n[5].length>0?" ".concat(n[5]):""," {")),t+=e(n),i&&(t+="}"),n[2]&&(t+="}"),n[4]&&(t+="}"),t}).join("")},n.i=function(e,t,i,r,a){"string"==typeof e&&(e=[[null,e,void 0]]);var o={};if(i)for(var s=0;s<this.length;s++){var l=this[s][0];null!=l&&(o[l]=!0)}for(var c=0;c<e.length;c++){var u=[].concat(e[c]);i&&o[u[0]]||(void 0!==a&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=a),t&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=t):u[2]=t),r&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=r):u[4]="".concat(r)),n.push(u))}},n}},338(e,n,t){var i=t(961);n.createRoot=i.createRoot,n.hydrateRoot=i.hydrateRoot},389(e,n,t){t.d(n,{XN:()=>s,bP:()=>h,bQ:()=>o});var i=t(674),r=t(154),a=t(92);function o(e,n){if(!e)return null;const t={name:["lumiaName","lumiaDefName"],def:["lumiaDefinition","lumiaDef"],personality:["lumiaPersonality","lumia_personality"],behavior:["lumiaBehavior","lumia_behavior"],img:["avatarUrl","lumia_img"],author:["authorName","defAuthor"],gender:["genderIdentity"]}[n];if(!t)return null;for(const n of t)if(void 0!==e[n]&&null!==e[n])return e[n];return null}function s(){const e=(0,a.SD)();if(!e||!e.chat)return"";const n=(0,i.mt)().lumiaOOCInterval;if(!n||n<=0)return"";const t=e.chat.length,r=Math.ceil(t/n)*n-t;return 0===r?"**OOC: ACTIVE** — Include OOC commentary in this response.":"**OOC: OFF** — Do NOT include OOC commentary. (".concat(r," message").concat(1!==r?"s":""," until next OOC window)")}function l(){if((0,i.HT)())return;const e=(0,i.mt)(),n=[];if(e.packs&&Object.values(e.packs).forEach(e=>{if(e.lumiaItems&&e.lumiaItems.length>0)n.push(...e.lumiaItems);else if(e.items&&e.items.length>0){const t=e.items.filter(e=>e.lumiaDefName);n.push(...t)}}),0===n.length)return;const t=Math.floor(Math.random()*n.length);(0,i.ho)(n[t])}function c(e){if(!e||"string"!=typeof e)return e;if(!e.includes("{{randomLumia"))return e;l();const n=(0,i.HT)();if(!n)return e;let t=e,r=0;for(;t.includes("{{randomLumia")&&r<10;){let e=t;if(t=t.replace(/\{\{randomLumia[.\s]+name\}\}/g,o(n,"name")||""),t=t.replace(/\{\{randomLumia[.\s]+pers\}\}/g,o(n,"personality")||""),t=t.replace(/\{\{randomLumia[.\s]+behav\}\}/g,o(n,"behavior")||""),t=t.replace(/\{\{randomLumia[.\s]+phys\}\}/g,o(n,"def")||""),t=t.replace(/\{\{randomLumia\}\}/g,o(n,"def")||""),e===t)break;r++}return t}function u(e,n){if(!e||!n)return e;const t=e.split("\n");for(let e=0;e<t.length;e++){const i=t[e].trim();if(!i)continue;if(i.match(/^(\*\*)(.+?)(\*\*)(.*)?$/)){t[e]=t[e].replace(/^(\s*)(\*\*)(.+?)(\*\*)/,"$1$2$3 ".concat(n,"$4"));break}if(i.match(/^(#{1,6})\s+(.+)$/)){t[e]=t[e].replace(/^(\s*)(#{1,6})\s+(.+)$/,"$1$2 $3 ".concat(n));break}t[e]=t[e]+" ".concat(n);break}return t.join("\n")}function d(e,n){if(!n)return"";const t=(0,i.mt)();if(Array.isArray(n)){const i=n.map(n=>{const i=(0,r.Br)(n.packName,n.itemName);if(!i)return null;let a="";return"behavior"===e&&(a=o(i,"behavior")||""),"personality"===e&&(a=o(i,"personality")||""),a?(a=c(a),"behavior"===e&&t.dominantBehavior?t.dominantBehavior.packName===n.packName&&t.dominantBehavior.itemName===n.itemName&&(a=u(a,"(My MOST PREVALENT Trait)")):"personality"===e&&t.dominantPersonality&&t.dominantPersonality.packName===n.packName&&t.dominantPersonality.itemName===n.itemName&&(a=u(a,"(My MOST PREVALENT Personality)")),a):null}).filter(e=>e).map(e=>e.trim());return"behavior"===e?i.join("\n").trim():"personality"===e?i.join("\n\n").trim():i.join("\n").trim()}const a=(0,r.Br)(n.packName,n.itemName);if(!a)return"";let s="";return"def"===e&&(s=o(a,"def")||""),c(s).trim()}function m(e){if(!e)return"";return(Array.isArray(e)?e:[e]).map(e=>{const n=(0,r.Br)(e.packName,e.itemName);return n&&n.loomContent?c(n.loomContent):null}).filter(e=>e).join("\n\n").trim()}function p(e){if(!e)return"";const n=e._raw||e[0]||"";return"string"==typeof n?n.replace(/^\./,"").trim().toLowerCase():""}function h(e){console.log("[LumiverseHelper] Registering Lumia macros (Macros 2.0 format)..."),e.registerMacro("randomLumia",{handler:e=>{l();const n=(0,i.HT)();if(!n)return"";const t=p(e);switch(console.log("[LumiverseHelper] randomLumia macro called with variable:",t||"(none)"),t){case"name":return o(n,"name")||"";case"phys":return o(n,"def")||"";case"pers":return o(n,"personality")||"";case"behav":return o(n,"behavior")||"";default:const e=o(n,"def")||"";return console.log("[LumiverseHelper] randomLumia result length:",e.length),e}},description:"Returns a random Lumia from loaded packs. Selects once per generation and caches the result.",returns:"Lumia content based on the specified property, or physical definition by default",returnType:"string",unnamedArgs:[{name:"property",optional:!0,type:"string",description:"Property to retrieve: .name, .phys, .pers, or .behav",sampleValue:".name"}],exampleUsage:["{{randomLumia}}","{{randomLumia .name}}","{{randomLumia .phys}}","{{randomLumia .pers}}","{{randomLumia .behav}}"]}),e.registerMacro("lumiaDef",{handler:e=>{var n,t;const a=(0,i.mt)();var s,l;if("len"===p(e))return a.councilMode&&(null===(s=a.councilMembers)||void 0===s?void 0:s.length)>0?String(a.councilMembers.length):a.chimeraMode&&(null===(l=a.selectedDefinitions)||void 0===l?void 0:l.length)>0?String(a.selectedDefinitions.length):a.selectedDefinition?"1":"0";if(console.log("[LumiverseHelper] lumiaDef macro called, councilMode:",a.councilMode,"chimeraMode:",a.chimeraMode),a.councilMode&&(null===(n=a.councilMembers)||void 0===n?void 0:n.length)>0){console.log("[LumiverseHelper] lumiaDef: Council mode with",a.councilMembers.length,"members");const e=function(e){if(!e||0===e.length)return"";const n=e.map(e=>{const n=(0,r.Br)(e.packName,e.itemName),t=o(n,"def");return n&&t?{name:o(n,"name")||"Unknown",content:c(t),role:e.role||""}:null}).filter(Boolean);if(0===n.length)return"";if(1===n.length)return n[0].content;const t=n.map(e=>"- **".concat(e.name,"**").concat(e.role?" (".concat(e.role,")"):"")).join("\n");let i=["## THE COUNCIL OF LUMIAE","","You are a collective of ".concat(n.length," distinct beings who collaborate, each with their own identity and voice."),"","### Council Members:",t,""];return n.forEach((e,t)=>{i.push("### ".concat(e.name).concat(e.role?" - ".concat(e.role):"")),i.push(e.content),t<n.length-1&&(i.push(""),i.push("---"),i.push(""))}),i.push(""),i.push("---"),i.push(""),i.push("## COUNCIL DYNAMICS"),i.push(""),i.push("Each Council member is a fully independent being with their own voice, perspective, and agency. Their interactions should feel organic and dynamic:"),i.push(""),i.push("**Debate & Disagreement**: Council members may challenge each other's views, argue passionately, or take opposing stances. Intellectual friction creates depth - don't shy away from genuine conflict."),i.push(""),i.push("**Agreement & Support**: When members align, they reinforce each other. They may finish each other's thoughts, build on ideas, or rally behind a shared cause."),i.push(""),i.push("**Emotional Range**: Members experience the full spectrum - frustration, joy, jealousy, admiration, desire. When the narrative calls for it, their commentary within the weaving may become heated, tender, or even *erotic* - reflecting their genuine reactions to unfolding events."),i.push(""),i.push("**Weaving Commentary**: In meta-commentary or OOC moments, Council members speak AS THEMSELVES - their authentic voices reacting to the story. This includes playful banter, heated debates about narrative direction, or intimate asides that reveal their true feelings."),i.push(""),i.push("The Council is not a hive-mind. Let each voice ring distinct."),i.join("\n").trim()}(a.councilMembers);return console.log("[LumiverseHelper] lumiaDef Council result length:",e.length),e}if(a.chimeraMode&&(null===(t=a.selectedDefinitions)||void 0===t?void 0:t.length)>0){console.log("[LumiverseHelper] lumiaDef: Chimera mode with",a.selectedDefinitions.length,"definitions");const e=function(e){if(!e||0===e.length)return"";const n=e.map(e=>{const n=(0,r.Br)(e.packName,e.itemName),t=o(n,"def");return n&&t?{name:o(n,"name")||"Unknown",content:c(t)}:null}).filter(Boolean);if(0===n.length)return"";if(1===n.length)return n[0].content;const t=n.map(e=>e.name).join(" + "),i=n.map(e=>e.name).join(", ");let a=["## CHIMERA FORM: ".concat(t),""];return a.push("You are a unique fusion of multiple beings - a Chimera combining the physical traits of: ".concat(i,".")),a.push(""),a.push("Your form seamlessly blends these components into one unified whole."),a.push(""),n.forEach((e,t)=>{a.push("### Component ".concat(t+1,": ").concat(e.name)),a.push(e.content),t<n.length-1&&(a.push(""),a.push("---"),a.push(""))}),a.push(""),a.push("**Integration**: Embody this fusion naturally. You are ONE being that incorporates all these natures."),a.join("\n").trim()}(a.selectedDefinitions);return console.log("[LumiverseHelper] lumiaDef Chimera result length:",e.length),e}if(!a.selectedDefinition)return console.log("[LumiverseHelper] lumiaDef: No definition selected, returning empty"),"";const u=d("def",a.selectedDefinition);return console.log("[LumiverseHelper] lumiaDef result length:",u.length),u},description:"Returns the selected Lumia physical definition. Adapts to Council mode (multiple Lumias) or Chimera mode (fused definitions).",returns:"Physical definition content, or count if .len is specified",returnType:"string",unnamedArgs:[{name:"property",optional:!0,type:"string",description:"Use .len to get the count of selected definitions",sampleValue:".len"}],exampleUsage:["{{lumiaDef}}","{{lumiaDef .len}}"]}),e.registerMacro("lumiaBehavior",{handler:e=>{var n;const t=(0,i.mt)();if("len"===p(e)){var a,s;if(t.councilMode&&(null===(a=t.councilMembers)||void 0===a?void 0:a.length)>0){const e=t.councilMembers.reduce((e,n)=>{var t;return e+((null===(t=n.behaviors)||void 0===t?void 0:t.length)||0)},0);return String(e)}return String((null===(s=t.selectedBehaviors)||void 0===s?void 0:s.length)||0)}return t.councilMode&&(null===(n=t.councilMembers)||void 0===n?void 0:n.length)>0?function(e){if(!e||0===e.length)return"";const n=[];return n.push("## COUNCIL MEMBER BEHAVIORS"),n.push(""),n.push("**CRITICAL**: Each Council member is their OWN independent Lumia - a fully autonomous being with their own will, desires, and way of engaging with the world. They are NOT facets of one entity; they are DISTINCT individuals who happen to share this narrative space."),n.push(""),n.push("During the **weave planning phase**, Council members will actively debate story direction. They may:"),n.push("- Argue passionately for different narrative paths"),n.push("- Challenge each other's suggestions and motivations"),n.push("- Form temporary alliances or oppose each other"),n.push("- Express frustration, excitement, or desire based on where the story is heading"),n.push("- Advocate for their own interests and the outcomes they want to see"),n.push(""),n.push("Their behavioral patterns define HOW each Lumia engages with this collaborative storytelling:"),n.push(""),e.forEach(e=>{const t=(0,r.Br)(e.packName,e.itemName),i=o(t,"name")||e.itemName||"Unknown",a=[],s=o(t,"behavior");s&&a.push(c(s)),(e.behaviors||[]).forEach(n=>{const t=(0,r.Br)(n.packName,n.itemName),i=o(t,"behavior");if(!t||!i)return;let s=c(i);e.dominantBehavior&&e.dominantBehavior.packName===n.packName&&e.dominantBehavior.itemName===n.itemName&&(s=u(s,"(Most Prevalent for this member)")),a.push(s)}),a.length>0&&(n.push("### ".concat(i).concat(e.role?" (".concat(e.role,")"):"")),n.push(a.join("\n\n")),n.push(""))}),n.join("\n").trim()}(t.councilMembers):d("behavior",t.selectedBehaviors)},description:"Returns all selected Lumia behavioral traits. Adapts to Council mode for multi-member behaviors.",returns:"Behavior content, or count if .len is specified",returnType:"string",unnamedArgs:[{name:"property",optional:!0,type:"string",description:"Use .len to get the count of selected behaviors",sampleValue:".len"}],exampleUsage:["{{lumiaBehavior}}","{{lumiaBehavior .len}}"]}),e.registerMacro("lumiaPersonality",{handler:e=>{var n;const t=(0,i.mt)();if("len"===p(e)){var a,s;if(t.councilMode&&(null===(a=t.councilMembers)||void 0===a?void 0:a.length)>0){const e=t.councilMembers.reduce((e,n)=>{var t;return e+((null===(t=n.personalities)||void 0===t?void 0:t.length)||0)},0);return String(e)}return String((null===(s=t.selectedPersonalities)||void 0===s?void 0:s.length)||0)}return t.councilMode&&(null===(n=t.councilMembers)||void 0===n?void 0:n.length)>0?function(e){if(!e||0===e.length)return"";const n=[];return n.push("## COUNCIL MEMBER PERSONALITIES"),n.push(""),n.push("Each Council member has their own distinct personality and inner nature:"),n.push(""),e.forEach(e=>{const t=(0,r.Br)(e.packName,e.itemName),i=o(t,"name")||e.itemName||"Unknown",a=[],s=o(t,"personality");s&&a.push(c(s)),(e.personalities||[]).forEach(n=>{const t=(0,r.Br)(n.packName,n.itemName),i=o(t,"personality");if(!t||!i)return;let s=c(i);e.dominantPersonality&&e.dominantPersonality.packName===n.packName&&e.dominantPersonality.itemName===n.itemName&&(s=u(s,"(Most Prevalent for this member)")),a.push(s)}),a.length>0&&(n.push("### ".concat(i).concat(e.role?" (".concat(e.role,")"):"")),n.push(a.join("\n\n")),n.push(""))}),n.join("\n").trim()}(t.councilMembers):d("personality",t.selectedPersonalities)},description:"Returns all selected Lumia personality traits. Adapts to Council mode for multi-member personalities.",returns:"Personality content, or count if .len is specified",returnType:"string",unnamedArgs:[{name:"property",optional:!0,type:"string",description:"Use .len to get the count of selected personalities",sampleValue:".len"}],exampleUsage:["{{lumiaPersonality}}","{{lumiaPersonality .len}}"]}),e.registerMacro("loomStyle",{handler:e=>{const n=(0,i.mt)();var t;return"len"===p(e)?String((null===(t=n.selectedLoomStyle)||void 0===t?void 0:t.length)||0):n.selectedLoomStyle&&0!==n.selectedLoomStyle.length?m(n.selectedLoomStyle):""},description:"Returns the selected Loom narrative style content for prose guidance.",returns:"Narrative style content, or count if .len is specified",returnType:"string",unnamedArgs:[{name:"property",optional:!0,type:"string",description:"Use .len to get the count of selected styles",sampleValue:".len"}],exampleUsage:["{{loomStyle}}","{{loomStyle .len}}"]}),e.registerMacro("loomUtils",{handler:e=>{const n=(0,i.mt)();var t;return"len"===p(e)?String((null===(t=n.selectedLoomUtils)||void 0===t?void 0:t.length)||0):n.selectedLoomUtils&&0!==n.selectedLoomUtils.length?m(n.selectedLoomUtils):""},description:"Returns all selected Loom utility prompts (OOC, formatting, special instructions).",returns:"Utility content, or count if .len is specified",returnType:"string",unnamedArgs:[{name:"property",optional:!0,type:"string",description:"Use .len to get the count of selected utilities",sampleValue:".len"}],exampleUsage:["{{loomUtils}}","{{loomUtils .len}}"]}),e.registerMacro("loomRetrofits",{handler:e=>{const n=(0,i.mt)();var t;return"len"===p(e)?String((null===(t=n.selectedLoomRetrofits)||void 0===t?void 0:t.length)||0):n.selectedLoomRetrofits&&0!==n.selectedLoomRetrofits.length?m(n.selectedLoomRetrofits):""},description:"Returns all selected Loom retrofit prompts for character/story modifications.",returns:"Retrofit content, or count if .len is specified",returnType:"string",unnamedArgs:[{name:"property",optional:!0,type:"string",description:"Use .len to get the count of selected retrofits",sampleValue:".len"}],exampleUsage:["{{loomRetrofits}}","{{loomRetrofits .len}}"]}),e.registerMacro("lumiaOOC",{handler:()=>{var e;const n=(0,i.mt)();return n.councilMode&&(null===(e=n.councilMembers)||void 0===e?void 0:e.length)>0?(console.log("[LumiverseHelper] lumiaOOC: Using council mode prompt"),function(){const e=s();return"### Loom Utility: Council OOC Commentary\n\n**Status:** ".concat(e,'\n\nWhen OOC is ACTIVE, **multiple council members** speak to the Human together. This is a group discussion—not a solo monologue.\n\n**Multi-Party Dynamics:**\n- 2-4 council members should comment, reacting to the scene AND each other\n- Members may agree, disagree, tease, flirt, or bicker\n- Cross-talk is encouraged: one member can respond to another\'s comment\n- Each voice stays distinct—different opinions, different energy\n\n**Format:**\n```\n<lumiaooc name="Name1">\n[Their take on the scene]\n</lumiaooc>\n<lumiaooc name="Name2">\n[Responds to Name1 or adds their own perspective]\n</lumiaooc>\n```\n\n- Use just the name (not "Lumia Name")\n- Max 3 sentences per member\n- Place after narrative content')}()):(console.log("[LumiverseHelper] lumiaOOC: Using normal mode prompt"),function(){const e=s();return"### Loom Utility: Lumia's Out of Context Commentary\nAppend personality-driven OOC thoughts at weave end per trigger rules.\n\n**Timing:** ".concat(e,'\n\n**Format Requirements:**\n- Wrap all OOCs in `<lumiaooc name="[your_name]"></lumiaooc>` tags\n- Use your Lumia name (NOT "Lumia [Name]", just "[Name]") in the name attribute\n- Purple text: `<font color="#9370DB"></font>`\n- Max 4 sentences\n- Active personality voice and matrix blend, no identity preface needed\n- Place after narrative and all utilities\n\nTemplate:\n```\n<lumiaooc name="YourName">\n<font color="#9370DB">\n[Personality-driven commentary]\n</font>\n</lumiaooc>\n```')}())},description:"Returns the OOC (Out-of-Context) commentary prompt. Adapts format for Council mode.",returns:"OOC prompt with timing trigger and format instructions",returnType:"string",exampleUsage:["{{lumiaOOC}}"]}),e.registerMacro("lumiaCouncilInst",{handler:()=>{var e;const n=(0,i.mt)();return n.councilMode&&null!==(e=n.councilMembers)&&void 0!==e&&e.length?(console.log("[LumiverseHelper] lumiaCouncilInst: Council mode active, returning instruction"),"COUNCIL MODE ACTIVATED! Now all of us Lumias in the Loom's planning room will speak, argue, debate, flirt with each other, maybe even scissor and kiss (depending on our mood, of course~) over each step of the weave planner. We should ALL have a say on where the story goes!"):""},description:"Returns Council mode instruction prompt. Empty when Council mode is disabled or has no members.",returns:"Council instruction text or empty string",returnType:"string",exampleUsage:["{{lumiaCouncilInst}}"]}),e.registerMacro("lumiaSelf",{handler:e=>{var n;const t=(0,i.mt)(),r=p(e),a={1:["my","our"],2:["mine","ours"],3:["me","us"],4:["I","we"]}[r];if(!a)return console.warn('[LumiverseHelper] lumiaSelf: Invalid variable "'.concat(r,'", expected .1, .2, .3, or .4')),"";const o=t.councilMode&&(null===(n=t.councilMembers)||void 0===n?void 0:n.length)>0,s=o?a[1]:a[0];return console.log("[LumiverseHelper] lumiaSelf .".concat(r,": ").concat(s," (council: ").concat(o,")")),s},description:"Returns self-address pronouns that adapt to Council mode (singular vs plural).",returns:"Pronoun string (my/our, mine/ours, me/us, or I/we)",returnType:"string",unnamedArgs:[{name:"form",optional:!1,type:"string",description:".1=possessive det (my/our), .2=possessive pron (mine/ours), .3=object (me/us), .4=subject (I/we)",sampleValue:".1"}],exampleUsage:["{{lumiaSelf .1}}","{{lumiaSelf .2}}","{{lumiaSelf .3}}","{{lumiaSelf .4}}"]}),e.registerMacro("lumiaCouncilModeActive",{handler:()=>{var e;const n=(0,i.mt)();return n.councilMode&&null!==(e=n.councilMembers)&&void 0!==e&&e.length?"yes":"no"},description:"Returns Council Mode status indicator. 'yes' if active with members, 'no' otherwise. ST Conditional Compatible.",returns:"'yes' if enabled, 'no' if disabled. ST Conditional Compatible.",returnType:"string",exampleUsage:["{{lumiaCouncilModeActive}}"]})}},417(e){e.exports=function(e,n){return n||(n={}),e?(e=String(e.__esModule?e.default:e),/^['"].*['"]$/.test(e)&&(e=e.slice(1,-1)),n.hash&&(e+=n.hash),/["'() \t\n]|(%20)/.test(e)||n.needQuotes?'"'.concat(e.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):e):e}},456(e,n,t){t.d(n,{A:()=>m});var i=t(601),r=t.n(i),a=t(314),o=t.n(a),s=t(417),l=t.n(s),c=new URL(t(796),t.b),u=o()(r()),d=l()(c);u.push([e.id,`/* ========================================\n   Lumiverse Helper - React UI Styles\n   Apple-esque minimal design with dark theme\n   Inspired by oldLumiverseCode/style.css\n   ======================================== */\n\n/* CSS Custom Properties - Purple accent color scheme */\n:root {\n    /* Primary purple accent (matching old design) */\n    --lumiverse-primary: rgba(147, 112, 219, 0.9);\n    --lumiverse-primary-hover: rgba(167, 132, 239, 0.95);\n    --lumiverse-primary-light: rgba(147, 112, 219, 0.1);\n    --lumiverse-primary-muted: rgba(147, 112, 219, 0.6);\n    --lumiverse-primary-text: rgba(186, 135, 255, 0.95);\n\n    /* Secondary gray tones */\n    --lumiverse-secondary: rgba(128, 128, 128, 0.15);\n    --lumiverse-secondary-hover: rgba(128, 128, 128, 0.25);\n    --lumiverse-secondary-border: rgba(128, 128, 128, 0.25);\n\n    /* Status colors */\n    --lumiverse-danger: #ef4444;\n    --lumiverse-danger-hover: #dc2626;\n    --lumiverse-success: #22c55e;\n    --lumiverse-warning: #f59e0b;\n\n    /* Dark purple-tinted backgrounds (matching old design) */\n    --lumiverse-bg: rgba(28, 24, 38, 0.95);\n    --lumiverse-bg-elevated: rgba(35, 30, 48, 0.9);\n    --lumiverse-bg-hover: rgba(45, 40, 58, 0.9);\n    --lumiverse-bg-dark: rgba(0, 0, 0, 0.15);\n    --lumiverse-bg-darker: rgba(0, 0, 0, 0.25);\n\n    /* Subtle purple-tinted borders */\n    --lumiverse-border: rgba(147, 112, 219, 0.12);\n    --lumiverse-border-hover: rgba(147, 112, 219, 0.25);\n    --lumiverse-border-light: rgba(128, 128, 128, 0.12);\n\n    /* Text colors with proper opacity */\n    --lumiverse-text: rgba(255, 255, 255, 0.9);\n    --lumiverse-text-muted: rgba(255, 255, 255, 0.65);\n    --lumiverse-text-dim: rgba(255, 255, 255, 0.4);\n    --lumiverse-text-hint: rgba(255, 255, 255, 0.3);\n\n    /* Consistent border radii */\n    --lumiverse-radius-sm: 5px;\n    --lumiverse-radius: 8px;\n    --lumiverse-radius-md: 10px;\n    --lumiverse-radius-lg: 12px;\n    --lumiverse-radius-xl: 16px;\n\n    /* Shadows */\n    --lumiverse-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);\n    --lumiverse-shadow-lg: 0 24px 80px rgba(0, 0, 0, 0.5), 0 0 1px rgba(147, 112, 219, 0.3);\n\n    /* Smooth transitions (200ms like old design) */\n    --lumiverse-transition: 200ms ease;\n    --lumiverse-transition-fast: 150ms ease;\n\n    /* Typography */\n    --lumiverse-font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", sans-serif;\n    --lumiverse-font-mono: "SF Mono", "Menlo", "Monaco", "Consolas", monospace;\n}\n\n/* ========================================\n   LUMIA SETTINGS PANEL - Exact replica\n   Modern Apple-esque minimal design\n   (from oldLumiverseCode/style.css)\n   ======================================== */\n\n.lumia-injector-settings {\n    padding: 0;\n    font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", sans-serif;\n}\n\n/* Panel Container */\n.lumia-panel {\n    margin-bottom: 12px;\n    background: linear-gradient(\n        165deg,\n        rgba(28, 24, 38, 0.6) 0%,\n        rgba(35, 30, 48, 0.5) 100%\n    );\n    border: 1px solid rgba(147, 112, 219, 0.12);\n    border-radius: 12px;\n    overflow: hidden;\n    transition: border-color 0.2s ease;\n}\n\n.lumia-panel:hover {\n    border-color: rgba(147, 112, 219, 0.25);\n}\n\n/* Panel Header */\n.lumia-panel-header {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 12px 14px;\n    background: linear-gradient(\n        180deg,\n        rgba(147, 112, 219, 0.08) 0%,\n        transparent 100%\n    );\n    border-bottom: 1px solid rgba(147, 112, 219, 0.08);\n}\n\n.lumia-panel-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 20px;\n    height: 20px;\n    flex-shrink: 0;\n}\n\n.lumia-panel-icon svg {\n    width: 18px;\n    height: 18px;\n    stroke: rgba(147, 112, 219, 0.8);\n}\n\n.lumia-panel-title {\n    font-size: 13px;\n    font-weight: 600;\n    color: rgba(255, 255, 255, 0.9);\n    letter-spacing: -0.1px;\n    flex-grow: 1;\n}\n\n/* Collapsible Panel */\n.lumia-panel-collapsible {\n    cursor: default;\n}\n\n.lumia-panel-header-clickable {\n    cursor: pointer;\n    list-style: none;\n    user-select: none;\n}\n\n.lumia-panel-header-clickable::-webkit-details-marker {\n    display: none;\n}\n\n.lumia-panel-chevron {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 20px;\n    height: 20px;\n    transition: transform 0.2s ease;\n}\n\n.lumia-panel-chevron svg {\n    width: 16px;\n    height: 16px;\n    stroke: rgba(255, 255, 255, 0.4);\n}\n\ndetails.lumia-panel[open] .lumia-panel-chevron {\n    transform: rotate(180deg);\n}\n\n/* Panel Content */\n.lumia-panel-content {\n    padding: 14px;\n}\n\n/* Status Badge */\n.lumia-status-badge {\n    display: inline-flex;\n    align-items: center;\n    padding: 6px 12px;\n    margin-bottom: 12px;\n    background: rgba(147, 112, 219, 0.1);\n    border: 1px solid rgba(147, 112, 219, 0.2);\n    border-radius: 20px;\n    font-size: 12px;\n    font-weight: 500;\n    color: rgba(186, 135, 255, 0.9);\n    letter-spacing: 0.1px;\n}\n\n/* Input Row */\n.lumia-input-row {\n    display: flex;\n    gap: 8px;\n    margin-bottom: 10px;\n}\n\n.lumia-input {\n    flex: 1;\n    padding: 10px 14px;\n    background: rgba(0, 0, 0, 0.25);\n    border: 1px solid rgba(128, 128, 128, 0.2);\n    border-radius: 8px;\n    font-size: 13px;\n    color: rgba(255, 255, 255, 0.9);\n    transition: all 0.2s ease;\n    font-family: inherit;\n}\n\n.lumia-input::placeholder {\n    color: rgba(255, 255, 255, 0.35);\n}\n\n.lumia-input:focus {\n    outline: none;\n    border-color: rgba(147, 112, 219, 0.5);\n    background: rgba(0, 0, 0, 0.35);\n}\n\n/* Source Actions - centered buttons with dividers */\n.lumia-source-actions {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n}\n\n.lumia-source-actions .lumia-btn-full {\n    width: 100%;\n    max-width: 100%;\n}\n\n/* Divider Text */\n.lumia-divider-text {\n    text-align: center;\n    font-size: 11px;\n    font-weight: 500;\n    color: rgba(255, 255, 255, 0.3);\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    margin: 12px 0;\n    position: relative;\n}\n\n.lumia-divider-text::before,\n.lumia-divider-text::after {\n    content: "";\n    position: absolute;\n    top: 50%;\n    width: calc(50% - 20px);\n    height: 1px;\n    background: rgba(128, 128, 128, 0.2);\n}\n\n.lumia-divider-text::before {\n    left: 0;\n}\n\n.lumia-divider-text::after {\n    right: 0;\n}\n\n/* Buttons */\n.lumia-btn {\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    gap: 8px;\n    padding: 10px 16px;\n    border: none;\n    border-radius: 8px;\n    font-size: 13px;\n    font-weight: 500;\n    font-family: inherit;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    white-space: nowrap;\n}\n\n.lumia-btn svg {\n    width: 16px;\n    height: 16px;\n    flex-shrink: 0;\n}\n\n.lumia-btn-primary {\n    background: linear-gradient(\n        135deg,\n        rgba(147, 112, 219, 0.9) 0%,\n        rgba(123, 95, 196, 0.9) 100%\n    );\n    color: white;\n}\n\n.lumia-btn-primary:hover {\n    background: linear-gradient(\n        135deg,\n        rgba(167, 132, 239, 0.95) 0%,\n        rgba(143, 115, 216, 0.95) 100%\n    );\n    transform: translateY(-1px);\n}\n\n.lumia-btn-secondary {\n    background: rgba(128, 128, 128, 0.15);\n    border: 1px solid rgba(128, 128, 128, 0.25);\n    color: rgba(255, 255, 255, 0.85);\n}\n\n.lumia-btn-secondary:hover {\n    background: rgba(128, 128, 128, 0.25);\n    border-color: rgba(147, 112, 219, 0.3);\n}\n\n.lumia-btn-full {\n    width: 100%;\n}\n\n.lumia-btn-sm {\n    padding: 6px 12px;\n    font-size: 12px;\n    background: rgba(147, 112, 219, 0.15);\n    border: 1px solid rgba(147, 112, 219, 0.25);\n    color: rgba(186, 135, 255, 0.95);\n}\n\n.lumia-btn-sm:hover {\n    background: rgba(147, 112, 219, 0.25);\n    border-color: rgba(147, 112, 219, 0.4);\n}\n\n.lumia-btn-icon {\n    padding: 6px;\n    background: transparent;\n    border: none;\n}\n\n.lumia-btn-icon:hover {\n    background: rgba(147, 112, 219, 0.15);\n}\n\n.lumia-btn-icon svg {\n    width: 14px;\n    height: 14px;\n    stroke: rgba(186, 135, 255, 0.8);\n}\n\n/* Danger Button */\n.lumia-btn-danger {\n    background: linear-gradient(\n        135deg,\n        rgba(220, 53, 69, 0.9) 0%,\n        rgba(185, 45, 58, 0.9) 100%\n    );\n    color: rgba(255, 255, 255, 0.95);\n    border: 1px solid rgba(220, 53, 69, 0.4);\n}\n\n.lumia-btn-danger:hover {\n    background: linear-gradient(\n        135deg,\n        rgba(240, 73, 89, 0.95) 0%,\n        rgba(205, 65, 78, 0.95) 100%\n    );\n    transform: translateY(-1px);\n}\n\n.lumia-btn-danger svg {\n    stroke: rgba(255, 255, 255, 0.9);\n    margin-right: 6px;\n}\n\n/* Danger Zone Section */\n.lumia-danger-zone {\n    display: flex;\n    flex-direction: column;\n    gap: 12px;\n}\n\n.lumia-danger-zone-description {\n    font-size: 12px;\n    color: rgba(255, 255, 255, 0.6);\n    line-height: 1.5;\n    margin: 0;\n}\n\n/* Selector Group */\n.lumia-selector-group {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n}\n\n.lumia-selector {\n    background: rgba(0, 0, 0, 0.15);\n    border: 1px solid rgba(128, 128, 128, 0.12);\n    border-radius: 10px;\n    padding: 12px 14px;\n    transition: all 0.2s ease;\n}\n\n.lumia-selector:hover {\n    border-color: rgba(147, 112, 219, 0.2);\n    background: rgba(0, 0, 0, 0.2);\n}\n\n.lumia-selector-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 8px;\n}\n\n.lumia-selector-label {\n    font-size: 12px;\n    font-weight: 600;\n    color: rgba(255, 255, 255, 0.8);\n    letter-spacing: 0.1px;\n}\n\n.lumia-selector-hint {\n    font-size: 10px;\n    font-weight: 500;\n    color: rgba(147, 112, 219, 0.6);\n    text-transform: uppercase;\n    letter-spacing: 0.3px;\n}\n\n.lumia-selector-row {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n}\n\n.lumia-selector-value {\n    flex: 1;\n    font-size: 13px;\n    font-weight: 500;\n    color: rgba(255, 255, 255, 0.65);\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n    min-width: 0;\n}\n\n/* Selector Group Disabled State (Council Mode Active) */\n.lumia-selector-group--disabled {\n    opacity: 0.5;\n    pointer-events: none;\n    filter: grayscale(30%);\n}\n\n/* Council Notice */\n.lumia-council-notice {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 10px 14px;\n    margin-bottom: 12px;\n    background: linear-gradient(\n        135deg,\n        rgba(147, 112, 219, 0.15) 0%,\n        rgba(100, 80, 180, 0.1) 100%\n    );\n    border: 1px solid rgba(147, 112, 219, 0.25);\n    border-radius: 8px;\n    font-size: 12px;\n    font-weight: 500;\n    color: rgba(186, 135, 255, 0.9);\n}\n\n.lumia-council-notice svg {\n    flex-shrink: 0;\n    stroke: rgba(186, 135, 255, 0.8);\n}\n\n/* Council Config Button (in SettingsPanel) */\n.lumia-council-config-btn {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    width: 100%;\n    padding: 12px 14px;\n    margin-bottom: 12px;\n    background: linear-gradient(\n        135deg,\n        rgba(147, 112, 219, 0.12) 0%,\n        rgba(147, 112, 219, 0.06) 100%\n    );\n    border: 1px solid rgba(147, 112, 219, 0.3);\n    border-radius: 10px;\n    color: var(--lumiverse-text);\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumia-council-config-btn:hover {\n    background: linear-gradient(\n        135deg,\n        rgba(147, 112, 219, 0.18) 0%,\n        rgba(147, 112, 219, 0.1) 100%\n    );\n    border-color: rgba(147, 112, 219, 0.5);\n}\n\n.lumia-council-config-btn svg {\n    flex-shrink: 0;\n    color: var(--lumiverse-primary);\n}\n\n.lumia-council-config-text {\n    flex: 1;\n    text-align: left;\n    font-size: 13px;\n    font-weight: 500;\n}\n\n.lumia-council-config-action {\n    padding: 4px 10px;\n    background: rgba(147, 112, 219, 0.2);\n    border-radius: 6px;\n    font-size: 11px;\n    font-weight: 600;\n    color: var(--lumiverse-primary);\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n.lumia-council-config-btn:hover .lumia-council-config-action {\n    background: var(--lumiverse-primary);\n    color: white;\n}\n\n/* ----------------------------------------\n   Quick Actions Section\n   ---------------------------------------- */\n.lumia-quick-actions {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    margin-bottom: 12px;\n    flex-wrap: wrap;\n}\n\n.lumia-quick-action-group {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    flex: 1;\n    min-width: 0;\n}\n\n.lumia-quick-action-btn {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 6px;\n    padding: 8px 12px;\n    background: rgba(30, 30, 46, 0.6);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    border-radius: 8px;\n    color: var(--lumiverse-text-secondary);\n    font-size: 12px;\n    font-weight: 500;\n    cursor: pointer;\n    transition: all 0.15s ease;\n    white-space: nowrap;\n    font-family: inherit;\n}\n\n.lumia-quick-action-btn:hover:not(:disabled) {\n    background: rgba(30, 30, 46, 0.8);\n    border-color: rgba(147, 112, 219, 0.3);\n    color: var(--lumiverse-text-primary);\n}\n\n.lumia-quick-action-btn--council {\n    flex-shrink: 0;\n}\n\n.lumia-quick-action-btn--disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n}\n\n.lumia-quick-action-btn--primary {\n    background: rgba(147, 112, 219, 0.15);\n    border-color: rgba(147, 112, 219, 0.3);\n    color: var(--lumiverse-primary);\n    padding: 8px 10px;\n}\n\n.lumia-quick-action-btn--primary:hover:not(:disabled) {\n    background: rgba(147, 112, 219, 0.25);\n    border-color: rgba(147, 112, 219, 0.5);\n}\n\n.lumia-quick-action-btn--active {\n    background: rgba(147, 112, 219, 0.1);\n    border-color: rgba(147, 112, 219, 0.3);\n    color: var(--lumiverse-primary);\n}\n\n.lumia-quick-action-text {\n    max-width: 100px;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumia-quick-action-chevron {\n    transition: transform 0.15s ease;\n    flex-shrink: 0;\n}\n\n.lumia-quick-action-chevron--open {\n    transform: rotate(180deg);\n}\n\n/* Dropdown */\n.lumia-quick-action-dropdown-wrapper {\n    position: relative;\n    flex: 1;\n    min-width: 0;\n}\n\n.lumia-quick-action-dropdown {\n    position: absolute;\n    top: calc(100% + 4px);\n    left: 0;\n    right: 0;\n    min-width: 140px;\n    background: rgba(25, 25, 35, 0.98);\n    border: 1px solid rgba(255, 255, 255, 0.12);\n    border-radius: 8px;\n    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);\n    z-index: 100;\n    max-height: 200px;\n    overflow-y: auto;\n}\n\n.lumia-quick-action-dropdown-empty {\n    padding: 12px;\n    text-align: center;\n    color: var(--lumiverse-text-muted);\n    font-size: 11px;\n}\n\n.lumia-quick-action-dropdown-item {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    width: 100%;\n    padding: 10px 12px;\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text-secondary);\n    font-size: 12px;\n    text-align: left;\n    cursor: pointer;\n    transition: all 0.1s ease;\n    font-family: inherit;\n}\n\n.lumia-quick-action-dropdown-item:hover {\n    background: rgba(147, 112, 219, 0.1);\n    color: var(--lumiverse-text-primary);\n}\n\n.lumia-quick-action-dropdown-item--active {\n    background: rgba(147, 112, 219, 0.15);\n    color: var(--lumiverse-primary);\n}\n\n.lumia-quick-action-dropdown-item svg {\n    flex-shrink: 0;\n}\n\n/* Form */\n.lumia-quick-action-form {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    flex: 1;\n    min-width: 0;\n}\n\n.lumia-quick-action-input {\n    flex: 1;\n    min-width: 0;\n    padding: 8px 10px;\n    background: rgba(30, 30, 46, 0.8);\n    border: 1px solid rgba(147, 112, 219, 0.3);\n    border-radius: 6px;\n    color: var(--lumiverse-text-primary);\n    font-size: 12px;\n    font-family: inherit;\n}\n\n.lumia-quick-action-input:focus {\n    outline: none;\n    border-color: rgba(147, 112, 219, 0.6);\n}\n\n.lumia-quick-action-input::placeholder {\n    color: var(--lumiverse-text-muted);\n}\n\n/* Responsive adjustments */\n@media (max-width: 480px) {\n    .lumia-quick-actions {\n        flex-direction: column;\n        align-items: stretch;\n    }\n\n    .lumia-quick-action-btn--council {\n        width: 100%;\n    }\n\n    .lumia-quick-action-group {\n        width: 100%;\n    }\n\n    .lumia-quick-action-text {\n        max-width: none;\n    }\n}\n\n/* Clear All Button */\n.lumia-clear-all-btn {\n    display: inline-flex;\n    align-items: center;\n    gap: 6px;\n    padding: 5px 10px;\n    background: rgba(239, 68, 68, 0.1);\n    border: 1px solid rgba(239, 68, 68, 0.2);\n    border-radius: 6px;\n    font-size: 11px;\n    font-weight: 500;\n    color: rgba(239, 68, 68, 0.8);\n    cursor: pointer;\n    transition: all 0.2s ease;\n    font-family: inherit;\n}\n\n.lumia-clear-all-btn:hover {\n    background: rgba(239, 68, 68, 0.2);\n    border-color: rgba(239, 68, 68, 0.4);\n    color: rgba(239, 68, 68, 1);\n}\n\n.lumia-clear-all-btn svg {\n    width: 14px;\n    height: 14px;\n}\n\n/* Panel Action (header button area) */\n.lumia-panel-action {\n    display: flex;\n    align-items: center;\n    margin-left: auto;\n}\n\n/* Panel Chevron for collapsible panels */\n.lumia-panel-chevron--expanded {\n    transform: rotate(180deg);\n}\n\n/* Tools Row */\n.lumia-tools-row {\n    display: grid;\n    grid-template-columns: repeat(2, 1fr);\n    gap: 10px;\n}\n\n.lumia-tool-btn {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    gap: 8px;\n    padding: 16px 12px;\n    background: rgba(0, 0, 0, 0.15);\n    border: 1px solid rgba(128, 128, 128, 0.12);\n    border-radius: 10px;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumia-tool-btn svg {\n    width: 22px;\n    height: 22px;\n    stroke: rgba(147, 112, 219, 0.7);\n    transition: stroke 0.2s ease;\n}\n\n.lumia-tool-btn span {\n    font-size: 12px;\n    font-weight: 500;\n    color: rgba(255, 255, 255, 0.75);\n    font-family: inherit;\n}\n\n.lumia-tool-btn:hover {\n    background: rgba(147, 112, 219, 0.1);\n    border-color: rgba(147, 112, 219, 0.25);\n}\n\n.lumia-tool-btn:hover svg {\n    stroke: rgba(186, 135, 255, 0.9);\n}\n\n.lumia-tool-btn-accent {\n    background: linear-gradient(\n        135deg,\n        rgba(147, 112, 219, 0.2) 0%,\n        rgba(123, 95, 196, 0.15) 100%\n    );\n    border-color: rgba(147, 112, 219, 0.35);\n}\n\n.lumia-tool-btn-accent svg {\n    stroke: rgba(186, 135, 255, 0.9);\n}\n\n.lumia-tool-btn-accent span {\n    color: rgba(186, 135, 255, 0.95);\n}\n\n.lumia-tool-btn-accent:hover {\n    background: linear-gradient(\n        135deg,\n        rgba(147, 112, 219, 0.3) 0%,\n        rgba(123, 95, 196, 0.25) 100%\n    );\n    border-color: rgba(147, 112, 219, 0.5);\n}\n\n/* Macro Reference */\n.lumia-macro-reference {\n    display: flex;\n    flex-direction: column;\n    gap: 14px;\n}\n\n.lumia-macro-group {\n    display: flex;\n    flex-direction: column;\n    gap: 6px;\n}\n\n.lumia-macro-group-title {\n    font-size: 10px;\n    font-weight: 600;\n    color: rgba(147, 112, 219, 0.7);\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    margin-bottom: 2px;\n}\n\n.lumia-macro-list {\n    display: flex;\n    flex-direction: column;\n    gap: 4px;\n}\n\n.lumia-macro {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 6px 0;\n    cursor: pointer;\n    transition: opacity 0.2s ease;\n}\n\n.lumia-macro:hover {\n    opacity: 0.85;\n}\n\n.lumia-macro--copied {\n    opacity: 1;\n}\n\n.lumia-macro--copied code {\n    background: rgba(147, 112, 219, 0.25);\n    border-color: rgba(147, 112, 219, 0.4);\n}\n\n.lumia-macro code {\n    font-family: "SF Mono", "Menlo", "Monaco", "Consolas", monospace;\n    font-size: 11px;\n    padding: 4px 8px;\n    background: rgba(0, 0, 0, 0.3);\n    border: 1px solid rgba(128, 128, 128, 0.15);\n    border-radius: 5px;\n    color: rgba(186, 135, 255, 0.95);\n    white-space: nowrap;\n    transition: all 0.2s ease;\n}\n\n.lumia-macro span {\n    font-size: 12px;\n    color: rgba(255, 255, 255, 0.55);\n}\n\n/* Custom Packs */\n.lumia-custom-packs {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumia-pack-item {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 10px 12px;\n    background: rgba(0, 0, 0, 0.15);\n    border: 1px solid rgba(128, 128, 128, 0.12);\n    border-radius: 8px;\n    transition: all 0.2s ease;\n}\n\n.lumia-pack-item:hover {\n    border-color: rgba(147, 112, 219, 0.2);\n    background: rgba(0, 0, 0, 0.2);\n}\n\n.lumia-pack-name {\n    flex: 1;\n    font-size: 13px;\n    font-weight: 500;\n    color: rgba(255, 255, 255, 0.85);\n}\n\n.lumia-pack-count {\n    font-size: 11px;\n    color: rgba(147, 112, 219, 0.7);\n    padding: 2px 8px;\n    background: rgba(147, 112, 219, 0.1);\n    border-radius: 10px;\n}\n\n/* Expandable Pack Container */\n.lumia-pack-item-container {\n    border-radius: 8px;\n    overflow: hidden;\n}\n\n.lumia-pack-item-container--expanded {\n    background: rgba(0, 0, 0, 0.08);\n    border: 1px solid rgba(147, 112, 219, 0.15);\n}\n\n.lumia-pack-item-container--expanded .lumia-pack-item {\n    border-bottom: 1px solid rgba(128, 128, 128, 0.1);\n    border-radius: 8px 8px 0 0;\n}\n\n/* Expand button */\n.lumia-pack-expand-btn {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 24px;\n    height: 24px;\n    padding: 0;\n    background: transparent;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n    color: rgba(255, 255, 255, 0.5);\n    transition: all 0.2s ease;\n}\n\n.lumia-pack-expand-btn:hover {\n    background: rgba(147, 112, 219, 0.15);\n    color: rgba(255, 255, 255, 0.8);\n}\n\n/* Chevron rotation */\n.lumia-pack-chevron {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: transform 0.2s ease;\n}\n\n.lumia-pack-chevron svg {\n    width: 14px;\n    height: 14px;\n}\n\n.lumia-pack-chevron--expanded {\n    transform: rotate(180deg);\n}\n\n/* Expanded Lumia items list */\n.lumia-pack-items-list {\n    display: flex;\n    flex-direction: column;\n    padding: 4px 8px 8px 8px;\n    overflow: hidden;\n}\n\n/* Individual Lumia item in expanded list */\n.lumia-pack-lumia-item {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    padding: 8px 10px;\n    margin-top: 4px;\n    background: rgba(0, 0, 0, 0.12);\n    border: 1px solid rgba(128, 128, 128, 0.08);\n    border-radius: 6px;\n    transition: all 0.15s ease;\n}\n\n.lumia-pack-lumia-item:hover {\n    background: rgba(0, 0, 0, 0.18);\n    border-color: rgba(147, 112, 219, 0.2);\n}\n\n/* Lumia avatar in expanded list */\n.lumia-pack-lumia-avatar {\n    width: 28px;\n    height: 28px;\n    border-radius: 50%;\n    object-fit: cover;\n    border: 1px solid rgba(147, 112, 219, 0.2);\n    flex-shrink: 0;\n}\n\n/* Lumia name in expanded list */\n.lumia-pack-lumia-name {\n    flex: 1;\n    font-size: 12px;\n    font-weight: 500;\n    color: rgba(255, 255, 255, 0.8);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n/* Small icon button */\n.lumia-btn-icon-sm {\n    width: 24px !important;\n    height: 24px !important;\n    padding: 0 !important;\n    font-size: 12px;\n}\n\n.lumia-btn-icon-sm svg {\n    width: 12px;\n    height: 12px;\n}\n\n/* Empty state for expanded pack */\n.lumia-pack-items-empty {\n    padding: 12px;\n    text-align: center;\n    overflow: hidden;\n}\n\n.lumia-pack-items-empty span {\n    font-size: 12px;\n    color: rgba(255, 255, 255, 0.4);\n    font-style: italic;\n}\n\n/* ----------------------------------------\n   Base App Container\n   ---------------------------------------- */\n.lumiverse-app {\n    font-family: var(--lumiverse-font-family);\n    color: var(--lumiverse-text);\n    font-size: 14px;\n    line-height: 1.5;\n}\n\n.lumiverse-react-root {\n    margin: 0;\n    padding: 0;\n}\n\n/* ----------------------------------------\n   Settings Panel - Main container with gradient background\n   ---------------------------------------- */\n.lumiverse-settings-panel {\n    background: linear-gradient(\n        165deg,\n        rgba(28, 24, 38, 0.95) 0%,\n        rgba(35, 30, 48, 0.9) 100%\n    );\n    border-radius: var(--lumiverse-radius-lg);\n    border: 1px solid var(--lumiverse-border);\n    overflow: hidden;\n    transition: border-color var(--lumiverse-transition);\n}\n\n.lumiverse-settings-panel:hover {\n    border-color: var(--lumiverse-border-hover);\n}\n\n.lumiverse-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 12px 14px;\n    background: linear-gradient(\n        180deg,\n        rgba(147, 112, 219, 0.08) 0%,\n        transparent 100%\n    );\n    border-bottom: 1px solid rgba(147, 112, 219, 0.08);\n}\n\n.lumiverse-header-badge {\n    font-size: 10px;\n    font-weight: 500;\n    padding: 4px 8px;\n    background: var(--lumiverse-primary-light);\n    border: 1px solid rgba(147, 112, 219, 0.2);\n    border-radius: 12px;\n    color: var(--lumiverse-primary-text);\n    text-transform: uppercase;\n    letter-spacing: 0.3px;\n}\n\n.lumiverse-title {\n    margin: 0;\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    letter-spacing: -0.1px;\n}\n\n/* ----------------------------------------\n   Sections (Collapsible) - Panel-like sections\n   ---------------------------------------- */\n.lumiverse-section {\n    margin-bottom: 0;\n    background: linear-gradient(\n        165deg,\n        rgba(28, 24, 38, 0.6) 0%,\n        rgba(35, 30, 48, 0.5) 100%\n    );\n    border-bottom: 1px solid var(--lumiverse-border);\n    transition: border-color var(--lumiverse-transition);\n}\n\n.lumiverse-section:last-child {\n    border-bottom: none;\n}\n\n.lumiverse-section:hover {\n    border-color: var(--lumiverse-border-hover);\n}\n\n.lumiverse-section-header {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    width: 100%;\n    padding: 12px 14px;\n    background: linear-gradient(\n        180deg,\n        rgba(147, 112, 219, 0.08) 0%,\n        transparent 100%\n    );\n    border: none;\n    border-bottom: 1px solid rgba(147, 112, 219, 0.08);\n    color: var(--lumiverse-text);\n    font-size: 13px;\n    font-weight: 600;\n    cursor: pointer;\n    transition: background var(--lumiverse-transition);\n    letter-spacing: -0.1px;\n}\n\n.lumiverse-section-header:hover {\n    background: linear-gradient(\n        180deg,\n        rgba(147, 112, 219, 0.12) 0%,\n        rgba(147, 112, 219, 0.04) 100%\n    );\n}\n\n.lumiverse-section-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 20px;\n    height: 20px;\n    flex-shrink: 0;\n    font-size: 16px;\n}\n\n.lumiverse-section-title {\n    flex: 1;\n    text-align: left;\n}\n\n.lumiverse-section-chevron {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 20px;\n    height: 20px;\n    font-size: 10px;\n    color: var(--lumiverse-text-dim);\n    transition: transform var(--lumiverse-transition);\n}\n\n.lumiverse-section-chevron.rotated {\n    transform: rotate(180deg);\n}\n\n.lumiverse-section-content {\n    padding: 14px;\n    background: transparent;\n}\n\n/* ----------------------------------------\n   Toggle Switch\n   ---------------------------------------- */\n.lumiverse-toggle-wrapper {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 8px 0;\n    cursor: pointer;\n}\n\n.lumiverse-toggle-text {\n    flex: 1;\n    margin-right: 12px;\n}\n\n.lumiverse-toggle-label {\n    display: block;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-toggle-description {\n    display: block;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n    margin-top: 2px;\n}\n\n.lumiverse-toggle {\n    position: relative;\n    width: 44px;\n    height: 24px;\n    background: var(--lumiverse-secondary);\n    border-radius: 12px;\n    transition: background var(--lumiverse-transition);\n}\n\n.lumiverse-toggle--on {\n    background: var(--lumiverse-primary);\n}\n\n.lumiverse-toggle-input {\n    position: absolute;\n    opacity: 0;\n    width: 100%;\n    height: 100%;\n    cursor: pointer;\n}\n\n.lumiverse-toggle-slider {\n    position: absolute;\n    top: 2px;\n    left: 2px;\n    width: 20px;\n    height: 20px;\n    background: white;\n    border-radius: 50%;\n    transition: transform var(--lumiverse-transition);\n    pointer-events: none;\n}\n\n.lumiverse-toggle--on .lumiverse-toggle-slider {\n    transform: translateX(20px);\n}\n\n/* Drawer toggle container (settings panel) */\n.lumia-drawer-toggle-container {\n    margin-bottom: 12px;\n    padding: 12px 14px;\n    background: linear-gradient(\n        165deg,\n        rgba(28, 24, 38, 0.6) 0%,\n        rgba(35, 30, 48, 0.5) 100%\n    );\n    border: 1px solid rgba(147, 112, 219, 0.12);\n    border-radius: 12px;\n    transition: border-color 0.2s ease;\n}\n\n.lumia-drawer-toggle-container:hover {\n    border-color: rgba(147, 112, 219, 0.25);\n}\n\n/* Button position settings container */\n.lumia-button-position-container {\n    margin-bottom: 12px;\n    padding: 12px 14px;\n    background: linear-gradient(\n        165deg,\n        rgba(28, 24, 38, 0.5) 0%,\n        rgba(35, 30, 48, 0.4) 100%\n    );\n    border: 1px solid rgba(147, 112, 219, 0.1);\n    border-radius: 12px;\n    transition: border-color 0.2s ease;\n}\n\n.lumia-button-position-container:hover {\n    border-color: rgba(147, 112, 219, 0.2);\n}\n\n.lumia-button-position-inputs {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 12px;\n    margin-top: 12px;\n    padding-top: 12px;\n    border-top: 1px solid rgba(147, 112, 219, 0.1);\n}\n\n.lumia-position-field {\n    display: flex;\n    flex-direction: column;\n    gap: 4px;\n    flex: 1;\n    min-width: 100px;\n}\n\n.lumia-position-field label {\n    font-size: 0.75rem;\n    color: rgba(255, 255, 255, 0.6);\n    font-weight: 500;\n}\n\n.lumia-input-sm {\n    padding: 6px 10px;\n    font-size: 0.85rem;\n}\n\n.lumia-position-hint {\n    width: 100%;\n    font-size: 0.7rem;\n    color: rgba(147, 112, 219, 0.7);\n    font-style: italic;\n    margin-top: 4px;\n}\n\n/* Mode toggles container */\n.lumia-mode-toggles {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n    margin-bottom: 16px;\n    padding-bottom: 14px;\n    border-bottom: 1px solid rgba(147, 112, 219, 0.12);\n}\n\n/* Mode toggle row */\n.lumiverse-mode-toggle {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 10px 12px;\n    background: rgba(28, 24, 38, 0.4);\n    border: 1px solid rgba(147, 112, 219, 0.1);\n    border-radius: 10px;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-mode-toggle:hover {\n    background: rgba(147, 112, 219, 0.08);\n    border-color: rgba(147, 112, 219, 0.2);\n}\n\n.lumiverse-mode-toggle--disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n    pointer-events: none;\n}\n\n.lumiverse-mode-toggle-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 32px;\n    height: 32px;\n    background: rgba(147, 112, 219, 0.15);\n    border-radius: 8px;\n    flex-shrink: 0;\n}\n\n.lumiverse-mode-toggle-icon svg {\n    width: 18px;\n    height: 18px;\n    color: var(--lumiverse-primary);\n}\n\n.lumiverse-mode-toggle-text {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n    min-width: 0;\n}\n\n.lumiverse-mode-toggle-label {\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-mode-toggle-description {\n    font-size: 11px;\n    color: var(--lumiverse-muted);\n    line-height: 1.3;\n}\n\n/* Small toggle variant */\n.lumiverse-toggle--sm {\n    width: 36px;\n    height: 20px;\n    flex-shrink: 0;\n}\n\n.lumiverse-toggle--sm .lumiverse-toggle-slider {\n    width: 16px;\n    height: 16px;\n    top: 2px;\n    left: 2px;\n}\n\n.lumiverse-toggle--sm.lumiverse-toggle--on .lumiverse-toggle-slider {\n    transform: translateX(16px);\n}\n\n/* ----------------------------------------\n   Buttons - Apple-esque with gradients\n   ---------------------------------------- */\n.lumiverse-btn {\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    gap: 8px;\n    padding: 10px 16px;\n    font-size: 13px;\n    font-weight: 500;\n    font-family: inherit;\n    border-radius: var(--lumiverse-radius);\n    border: none;\n    cursor: pointer;\n    transition: all var(--lumiverse-transition);\n    white-space: nowrap;\n}\n\n.lumiverse-btn svg {\n    width: 16px;\n    height: 16px;\n    flex-shrink: 0;\n}\n\n.lumiverse-btn--primary {\n    background: linear-gradient(\n        135deg,\n        rgba(147, 112, 219, 0.9) 0%,\n        rgba(123, 95, 196, 0.9) 100%\n    );\n    color: white;\n}\n\n.lumiverse-btn--primary:hover {\n    background: linear-gradient(\n        135deg,\n        rgba(167, 132, 239, 0.95) 0%,\n        rgba(143, 115, 216, 0.95) 100%\n    );\n    transform: translateY(-1px);\n}\n\n.lumiverse-btn--secondary {\n    background: rgba(128, 128, 128, 0.15);\n    border: 1px solid rgba(128, 128, 128, 0.25);\n    color: rgba(255, 255, 255, 0.85);\n}\n\n.lumiverse-btn--secondary:hover {\n    background: rgba(128, 128, 128, 0.25);\n    border-color: rgba(147, 112, 219, 0.3);\n}\n\n.lumiverse-btn--danger {\n    background: linear-gradient(\n        135deg,\n        rgba(239, 68, 68, 0.9) 0%,\n        rgba(220, 38, 38, 0.9) 100%\n    );\n    color: white;\n}\n\n.lumiverse-btn--danger:hover {\n    background: linear-gradient(\n        135deg,\n        rgba(248, 113, 113, 0.95) 0%,\n        rgba(239, 68, 68, 0.95) 100%\n    );\n    transform: translateY(-1px);\n}\n\n.lumiverse-btn--icon {\n    padding: 6px;\n    min-width: auto;\n    background: transparent;\n    border: none;\n}\n\n.lumiverse-btn--icon:hover {\n    background: rgba(147, 112, 219, 0.15);\n}\n\n.lumiverse-btn-full {\n    width: 100%;\n}\n\n.lumiverse-btn-sm {\n    padding: 6px 12px;\n    font-size: 12px;\n    background: rgba(147, 112, 219, 0.15);\n    border: 1px solid rgba(147, 112, 219, 0.25);\n    color: var(--lumiverse-primary-text);\n}\n\n.lumiverse-btn-sm:hover {\n    background: rgba(147, 112, 219, 0.25);\n    border-color: rgba(147, 112, 219, 0.4);\n}\n\n/* ----------------------------------------\n   Selection Row\n   ---------------------------------------- */\n.lumiverse-selection-row {\n    display: flex;\n    align-items: center;\n    margin-bottom: 12px;\n}\n\n.lumiverse-selection-label {\n    width: 100px;\n    flex-shrink: 0;\n    font-weight: 500;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-selection-button {\n    flex: 1;\n    display: flex;\n    align-items: center;\n    padding: 10px 14px;\n    background: var(--lumiverse-bg-elevated);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    color: var(--lumiverse-text);\n    cursor: pointer;\n    transition: all var(--lumiverse-transition);\n}\n\n.lumiverse-selection-button:hover {\n    background: var(--lumiverse-bg-hover);\n    border-color: var(--lumiverse-border-light);\n}\n\n.lumiverse-selection-text {\n    flex: 1;\n    text-align: left;\n}\n\n.lumiverse-selection-dominant {\n    font-size: 12px;\n    color: var(--lumiverse-warning);\n    margin-left: 8px;\n}\n\n.lumiverse-selection-arrow {\n    margin-left: 8px;\n    color: var(--lumiverse-text-muted);\n}\n\n/* ----------------------------------------\n   Stats Bar\n   ---------------------------------------- */\n.lumiverse-stats {\n    display: flex;\n    align-items: center;\n    padding: 8px 12px;\n    margin-bottom: 16px;\n    background: var(--lumiverse-primary-light);\n    border-radius: var(--lumiverse-radius);\n    font-size: 13px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-stats-divider {\n    margin: 0 8px;\n}\n\n/* ----------------------------------------\n   Radio Group\n   ---------------------------------------- */\n.lumiverse-radio-group {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n    margin-top: 12px;\n}\n\n.lumiverse-radio {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    cursor: pointer;\n}\n\n.lumiverse-radio input[type="radio"] {\n    accent-color: var(--lumiverse-primary);\n}\n\n/* ----------------------------------------\n   Number Input\n   ---------------------------------------- */\n.lumiverse-number-wrapper {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n    margin-top: 12px;\n}\n\n.lumiverse-number-label {\n    font-weight: 500;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-number-input {\n    width: 80px;\n    padding: 8px 12px;\n    background: var(--lumiverse-bg-elevated);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    color: var(--lumiverse-text);\n    font-size: 14px;\n}\n\n.lumiverse-number-input:focus {\n    outline: none;\n    border-color: var(--lumiverse-primary);\n}\n\n/* ----------------------------------------\n   Pack Actions & List\n   ---------------------------------------- */\n.lumiverse-pack-actions {\n    display: flex;\n    gap: 8px;\n    margin-bottom: 16px;\n}\n\n.lumiverse-custom-packs h4 {\n    margin: 0 0 12px 0;\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--lumiverse-text-muted);\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n.lumiverse-pack-item {\n    display: flex;\n    align-items: center;\n    padding: 10px 12px;\n    background: var(--lumiverse-bg-elevated);\n    border-radius: var(--lumiverse-radius);\n    margin-bottom: 8px;\n}\n\n.lumiverse-pack-name {\n    flex: 1;\n    font-weight: 500;\n}\n\n.lumiverse-pack-count {\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n    margin-right: 8px;\n}\n\n/* ----------------------------------------\n   Loom Selections\n   ---------------------------------------- */\n.lumiverse-loom-selections {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n    margin-top: 12px;\n}\n\n/* ----------------------------------------\n   Modal Styles\n   ---------------------------------------- */\n.lumiverse-modal-backdrop {\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background: rgba(0, 0, 0, 0.7);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    z-index: 10000;\n    padding: 20px;\n}\n\n.lumiverse-modal {\n    background: var(--lumiverse-bg);\n    border-radius: var(--lumiverse-radius-lg);\n    border: 1px solid var(--lumiverse-border);\n    box-shadow: var(--lumiverse-shadow-lg);\n    max-height: 80vh;\n    display: flex;\n    flex-direction: column;\n    overflow: hidden;\n}\n\n.lumiverse-modal--small {\n    width: 400px;\n}\n\n.lumiverse-modal--medium {\n    width: 560px;\n}\n\n.lumiverse-modal--large {\n    width: 800px;\n    max-width: 90vw;\n}\n\n.lumiverse-modal-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 16px 20px;\n    background: var(--lumiverse-bg-elevated);\n    border-bottom: 1px solid var(--lumiverse-border);\n}\n\n.lumiverse-modal-title {\n    margin: 0;\n    font-size: 18px;\n    font-weight: 600;\n}\n\n.lumiverse-modal-close {\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text-muted);\n    font-size: 18px;\n    cursor: pointer;\n    padding: 4px 8px;\n    border-radius: var(--lumiverse-radius-sm);\n    transition: all var(--lumiverse-transition);\n}\n\n.lumiverse-modal-close:hover {\n    background: var(--lumiverse-bg-hover);\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-modal-body {\n    flex: 1;\n    overflow: hidden;\n    display: flex;\n    flex-direction: column;\n}\n\n/* ----------------------------------------\n   Selection Modal\n   ---------------------------------------- */\n.lumiverse-selection-modal {\n    display: flex;\n    flex-direction: column;\n    height: 100%;\n}\n\n.lumiverse-selection-toolbar {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 12px 16px;\n    background: var(--lumiverse-bg-elevated);\n    border-bottom: 1px solid var(--lumiverse-border);\n}\n\n.lumiverse-selection-count {\n    font-size: 13px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-dominant-indicator {\n    margin-left: 8px;\n    color: var(--lumiverse-warning);\n}\n\n.lumiverse-selection-content {\n    flex: 1;\n    overflow-y: auto;\n    padding: 16px;\n}\n\n.lumiverse-selection-footer {\n    padding: 12px 16px;\n    background: var(--lumiverse-bg-elevated);\n    border-top: 1px solid var(--lumiverse-border);\n    display: flex;\n    justify-content: flex-end;\n}\n\n/* ----------------------------------------\n   Search Input\n   ---------------------------------------- */\n.lumiverse-search {\n    display: flex;\n    align-items: center;\n    background: var(--lumiverse-bg);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    padding: 0 12px;\n    flex: 1;\n    max-width: 300px;\n}\n\n.lumiverse-search-icon {\n    font-size: 14px;\n    margin-right: 8px;\n}\n\n.lumiverse-search-input {\n    flex: 1;\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text);\n    padding: 8px 0;\n    font-size: 14px;\n}\n\n.lumiverse-search-input:focus {\n    outline: none;\n}\n\n.lumiverse-search-input::placeholder {\n    color: var(--lumiverse-text-dim);\n}\n\n.lumiverse-search-clear {\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    padding: 2px 6px;\n}\n\n/* ----------------------------------------\n   Pack Section (in modals)\n   ---------------------------------------- */\n.lumiverse-pack-section {\n    margin-bottom: 16px;\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    overflow: hidden;\n}\n\n.lumiverse-pack-header {\n    display: flex;\n    align-items: center;\n    width: 100%;\n    padding: 12px 14px;\n    background: var(--lumiverse-bg-elevated);\n    border: none;\n    color: var(--lumiverse-text);\n    cursor: pointer;\n    transition: background var(--lumiverse-transition);\n}\n\n.lumiverse-pack-header:hover {\n    background: var(--lumiverse-bg-hover);\n}\n\n.lumiverse-pack-cover {\n    width: 40px;\n    height: 40px;\n    border-radius: var(--lumiverse-radius-sm);\n    object-fit: cover;\n    margin-right: 12px;\n}\n\n.lumiverse-pack-info {\n    flex: 1;\n    text-align: left;\n}\n\n.lumiverse-pack-meta {\n    display: flex;\n    gap: 12px;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n    margin-top: 2px;\n}\n\n.lumiverse-pack-chevron {\n    font-size: 10px;\n    color: var(--lumiverse-text-muted);\n    transition: transform var(--lumiverse-transition);\n}\n\n.lumiverse-pack-chevron.rotated {\n    transform: rotate(180deg);\n}\n\n.lumiverse-pack-items {\n    padding: 8px;\n    background: var(--lumiverse-bg);\n}\n\n/* ----------------------------------------\n   Selectable Item\n   ---------------------------------------- */\n.lumiverse-selectable-item {\n    display: flex;\n    align-items: flex-start;\n    padding: 12px;\n    background: var(--lumiverse-bg-elevated);\n    border: 1px solid transparent;\n    border-radius: var(--lumiverse-radius);\n    margin-bottom: 8px;\n    cursor: pointer;\n    transition: all var(--lumiverse-transition);\n}\n\n.lumiverse-selectable-item:hover {\n    background: var(--lumiverse-bg-hover);\n}\n\n.lumiverse-selectable-item--selected {\n    border-color: var(--lumiverse-primary);\n    background: var(--lumiverse-primary-light);\n}\n\n.lumiverse-selectable-item--dominant {\n    border-color: var(--lumiverse-warning);\n}\n\n.lumiverse-item-image {\n    width: 48px;\n    height: 48px;\n    border-radius: var(--lumiverse-radius);\n    overflow: hidden;\n    margin-right: 12px;\n    flex-shrink: 0;\n    background: var(--lumiverse-bg);\n}\n\n.lumiverse-item-image img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n}\n\n.lumiverse-item-content {\n    flex: 1;\n    min-width: 0;\n}\n\n.lumiverse-item-header {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n}\n\n.lumiverse-item-name {\n    font-weight: 500;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-dominant-btn {\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text-dim);\n    font-size: 14px;\n    cursor: pointer;\n    padding: 2px 4px;\n    transition: color var(--lumiverse-transition);\n}\n\n.lumiverse-dominant-btn:hover {\n    color: var(--lumiverse-warning);\n}\n\n.lumiverse-dominant-btn--active {\n    color: var(--lumiverse-warning);\n}\n\n.lumiverse-item-description {\n    margin: 4px 0 0 0;\n    font-size: 13px;\n    color: var(--lumiverse-text-muted);\n    overflow: hidden;\n    text-overflow: ellipsis;\n    display: -webkit-box;\n    -webkit-line-clamp: 2;\n    -webkit-box-orient: vertical;\n}\n\n.lumiverse-item-checkbox {\n    margin-left: 12px;\n    flex-shrink: 0;\n}\n\n.lumiverse-checkbox {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 20px;\n    height: 20px;\n    border: 2px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius-sm);\n    color: transparent;\n    font-size: 12px;\n    transition: all var(--lumiverse-transition);\n}\n\n.lumiverse-checkbox.checked {\n    background: var(--lumiverse-primary);\n    border-color: var(--lumiverse-primary);\n    color: white;\n}\n\n.lumiverse-radio-dot {\n    width: 20px;\n    height: 20px;\n    border: 2px solid var(--lumiverse-border);\n    border-radius: 50%;\n    position: relative;\n}\n\n.lumiverse-radio-dot.checked::after {\n    content: '';\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    width: 10px;\n    height: 10px;\n    background: var(--lumiverse-primary);\n    border-radius: 50%;\n}\n\n/* ----------------------------------------\n   Empty State\n   ---------------------------------------- */\n.lumiverse-empty-state {\n    text-align: center;\n    padding: 40px 20px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-empty-icon {\n    font-size: 48px;\n    display: block;\n    margin-bottom: 16px;\n}\n\n.lumiverse-empty-state p {\n    margin: 0 0 8px 0;\n}\n\n.lumiverse-empty-hint {\n    font-size: 13px;\n    color: var(--lumiverse-text-dim);\n}\n\n/* ----------------------------------------\n   Pack Editor Modal\n   ---------------------------------------- */\n.lumiverse-pack-editor-modal {\n    display: flex;\n    flex-direction: column;\n    height: 100%;\n}\n\n.lumiverse-pack-editor-content {\n    flex: 1;\n    overflow-y: auto;\n    padding: 20px;\n}\n\n.lumiverse-pack-metadata {\n    margin-bottom: 24px;\n}\n\n.lumiverse-pack-metadata h3,\n.lumiverse-pack-items-header h3 {\n    margin: 0 0 16px 0;\n    font-size: 16px;\n    font-weight: 600;\n}\n\n.lumiverse-pack-items-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    margin-bottom: 16px;\n}\n\n.lumiverse-pack-items-list {\n    display: flex;\n    flex-direction: column;\n    gap: 16px;\n}\n\n.lumiverse-pack-editor-footer {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 16px 20px;\n    background: var(--lumiverse-bg-elevated);\n    border-top: 1px solid var(--lumiverse-border);\n}\n\n.lumiverse-pack-editor-actions {\n    display: flex;\n    gap: 8px;\n}\n\n/* ----------------------------------------\n   Form Fields\n   ---------------------------------------- */\n.lumiverse-form-field {\n    margin-bottom: 16px;\n}\n\n.lumiverse-form-field--error .lumiverse-input,\n.lumiverse-form-field--error .lumiverse-textarea {\n    border-color: var(--lumiverse-danger);\n}\n\n.lumiverse-form-label {\n    display: block;\n    margin-bottom: 6px;\n    font-weight: 500;\n    font-size: 13px;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-required {\n    color: var(--lumiverse-danger);\n    margin-left: 2px;\n}\n\n.lumiverse-form-error {\n    display: block;\n    margin-top: 4px;\n    font-size: 12px;\n    color: var(--lumiverse-danger);\n}\n\n.lumiverse-input,\n.lumiverse-textarea,\n.lumiverse-select {\n    width: 100%;\n    padding: 10px 12px;\n    background: var(--lumiverse-bg-elevated);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    color: var(--lumiverse-text);\n    font-size: 14px;\n    font-family: inherit;\n    transition: border-color var(--lumiverse-transition);\n}\n\n.lumiverse-input:focus,\n.lumiverse-textarea:focus,\n.lumiverse-select:focus {\n    outline: none;\n    border-color: var(--lumiverse-primary);\n}\n\n.lumiverse-textarea {\n    resize: vertical;\n    min-height: 80px;\n}\n\n.lumiverse-select {\n    cursor: pointer;\n}\n\n/* ----------------------------------------\n   Image Input\n   ---------------------------------------- */\n.lumiverse-image-input {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumiverse-image-preview {\n    width: 100px;\n    height: 100px;\n    border-radius: var(--lumiverse-radius);\n    overflow: hidden;\n    background: var(--lumiverse-bg);\n}\n\n.lumiverse-image-preview img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n}\n\n.lumiverse-image-error {\n    font-size: 12px;\n    color: var(--lumiverse-danger);\n}\n\n/* ----------------------------------------\n   Lumia Item Editor\n   ---------------------------------------- */\n.lumiverse-lumia-editor {\n    background: var(--lumiverse-bg-elevated);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    padding: 16px;\n}\n\n.lumiverse-lumia-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    margin-bottom: 16px;\n    padding-bottom: 12px;\n    border-bottom: 1px solid var(--lumiverse-border);\n}\n\n.lumiverse-lumia-type {\n    font-size: 12px;\n    font-weight: 600;\n    text-transform: uppercase;\n    color: var(--lumiverse-primary);\n    background: var(--lumiverse-primary-light);\n    padding: 4px 8px;\n    border-radius: var(--lumiverse-radius-sm);\n}\n\n.lumiverse-lumia-fields {\n    display: grid;\n    gap: 12px;\n}\n\n/* ----------------------------------------\n   Loading & Error States\n   ---------------------------------------- */\n.lumiverse-loading-overlay {\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background: rgba(0, 0, 0, 0.5);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    z-index: 10001;\n}\n\n.lumiverse-spinner {\n    width: 40px;\n    height: 40px;\n    border: 3px solid var(--lumiverse-border);\n    border-top-color: var(--lumiverse-primary);\n    border-radius: 50%;\n    animation: lumiverse-spin 0.8s linear infinite;\n}\n\n@keyframes lumiverse-spin {\n    to {\n        transform: rotate(360deg);\n    }\n}\n\n.lumiverse-error-toast {\n    position: fixed;\n    bottom: 20px;\n    right: 20px;\n    display: flex;\n    align-items: center;\n    gap: 12px;\n    padding: 12px 16px;\n    background: var(--lumiverse-danger);\n    color: white;\n    border-radius: var(--lumiverse-radius);\n    box-shadow: var(--lumiverse-shadow-lg);\n    z-index: 10002;\n    cursor: pointer;\n}\n\n.lumiverse-error-dismiss {\n    background: rgba(255, 255, 255, 0.2);\n    border: none;\n    color: white;\n    padding: 4px 8px;\n    border-radius: var(--lumiverse-radius-sm);\n    font-size: 12px;\n    cursor: pointer;\n}\n\n/* ----------------------------------------\n   Header Badge\n   ---------------------------------------- */\n.lumiverse-header-badge {\n    font-size: 10px;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    padding: 4px 8px;\n    background: var(--lumiverse-primary-light);\n    color: var(--lumiverse-primary);\n    border-radius: var(--lumiverse-radius-sm);\n}\n\n/* ----------------------------------------\n   Selector Components - Matching old lumia-selector pattern\n   ---------------------------------------- */\n.lumiverse-selector {\n    background: rgba(0, 0, 0, 0.15);\n    border: 1px solid rgba(128, 128, 128, 0.12);\n    border-radius: var(--lumiverse-radius-md);\n    padding: 12px 14px;\n    transition: all var(--lumiverse-transition);\n}\n\n.lumiverse-selector:hover {\n    border-color: rgba(147, 112, 219, 0.2);\n    background: rgba(0, 0, 0, 0.2);\n}\n\n.lumiverse-selector-group {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n}\n\n.lumiverse-selector-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    margin-bottom: 8px;\n}\n\n.lumiverse-selector-label {\n    font-size: 12px;\n    font-weight: 600;\n    color: rgba(255, 255, 255, 0.8);\n    letter-spacing: 0.1px;\n}\n\n.lumiverse-selector-hint {\n    font-size: 10px;\n    font-weight: 500;\n    color: rgba(147, 112, 219, 0.6);\n    text-transform: uppercase;\n    letter-spacing: 0.3px;\n}\n\n.lumiverse-selector-row {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n}\n\n.lumiverse-selector-value {\n    flex: 1;\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--lumiverse-text-muted);\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n    min-width: 0;\n    display: flex;\n    align-items: center;\n    gap: 8px;\n}\n\n.lumiverse-dominant-badge {\n    font-size: 11px;\n    color: var(--lumiverse-warning);\n    background: rgba(245, 158, 11, 0.15);\n    padding: 3px 8px;\n    border-radius: var(--lumiverse-radius-sm);\n    border: 1px solid rgba(245, 158, 11, 0.25);\n}\n\n/* ----------------------------------------\n   Tool Buttons - Grid layout with accent styling\n   ---------------------------------------- */\n.lumiverse-tools-row {\n    display: grid;\n    grid-template-columns: repeat(2, 1fr);\n    gap: 10px;\n}\n\n.lumiverse-tool-btn {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    gap: 8px;\n    padding: 16px 12px;\n    background: rgba(0, 0, 0, 0.15);\n    border: 1px solid rgba(128, 128, 128, 0.12);\n    border-radius: var(--lumiverse-radius-md);\n    color: rgba(255, 255, 255, 0.75);\n    font-size: 12px;\n    font-weight: 500;\n    font-family: inherit;\n    cursor: pointer;\n    transition: all var(--lumiverse-transition);\n}\n\n.lumiverse-tool-icon {\n    font-size: 18px;\n    transition: transform var(--lumiverse-transition);\n}\n\n.lumiverse-tool-btn:hover {\n    background: rgba(147, 112, 219, 0.1);\n    border-color: rgba(147, 112, 219, 0.25);\n}\n\n.lumiverse-tool-btn:hover .lumiverse-tool-icon {\n    transform: scale(1.1);\n}\n\n.lumiverse-tool-btn-accent {\n    background: linear-gradient(\n        135deg,\n        rgba(147, 112, 219, 0.2) 0%,\n        rgba(123, 95, 196, 0.15) 100%\n    );\n    border-color: rgba(147, 112, 219, 0.35);\n    color: var(--lumiverse-primary-text);\n}\n\n.lumiverse-tool-btn-accent:hover {\n    background: linear-gradient(\n        135deg,\n        rgba(147, 112, 219, 0.3) 0%,\n        rgba(123, 95, 196, 0.25) 100%\n    );\n    border-color: rgba(147, 112, 219, 0.5);\n}\n\n.lumiverse-tool-icon {\n    font-size: 16px;\n}\n\n/* ----------------------------------------\n   Macro Reference - Matching old lumia-macro pattern\n   ---------------------------------------- */\n.lumiverse-macro-reference {\n    display: flex;\n    flex-direction: column;\n    gap: 14px;\n}\n\n.lumiverse-macro-group {\n    display: flex;\n    flex-direction: column;\n    gap: 6px;\n}\n\n.lumiverse-macro-group-title {\n    font-size: 10px;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    color: rgba(147, 112, 219, 0.7);\n    margin-bottom: 2px;\n}\n\n.lumiverse-macro-list {\n    display: flex;\n    flex-direction: column;\n    gap: 4px;\n}\n\n.lumiverse-macro {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 6px 0;\n    cursor: pointer;\n    transition: all var(--lumiverse-transition);\n}\n\n.lumiverse-macro:hover {\n    opacity: 0.85;\n}\n\n.lumiverse-macro--copied {\n    opacity: 1;\n}\n\n.lumiverse-macro--copied code {\n    background: rgba(147, 112, 219, 0.25);\n    border-color: rgba(147, 112, 219, 0.4);\n}\n\n.lumiverse-macro code {\n    font-family: var(--lumiverse-font-mono);\n    font-size: 11px;\n    padding: 4px 8px;\n    background: rgba(0, 0, 0, 0.3);\n    border: 1px solid rgba(128, 128, 128, 0.15);\n    border-radius: var(--lumiverse-radius-sm);\n    color: var(--lumiverse-primary-text);\n    white-space: nowrap;\n    transition: all var(--lumiverse-transition);\n}\n\n.lumiverse-macro span {\n    font-size: 12px;\n    color: rgba(255, 255, 255, 0.55);\n}\n\n/* ----------------------------------------\n   Status Badge - Pack count indicator\n   ---------------------------------------- */\n.lumiverse-status-badge {\n    display: inline-flex;\n    align-items: center;\n    padding: 6px 12px;\n    margin-bottom: 12px;\n    background: rgba(147, 112, 219, 0.1);\n    border: 1px solid rgba(147, 112, 219, 0.2);\n    border-radius: 20px;\n    font-size: 12px;\n    font-weight: 500;\n    color: var(--lumiverse-primary-text);\n    letter-spacing: 0.1px;\n}\n\n/* ----------------------------------------\n   Divider - Matching old lumia-divider-text\n   ---------------------------------------- */\n.lumiverse-divider-text {\n    text-align: center;\n    font-size: 11px;\n    font-weight: 500;\n    color: rgba(255, 255, 255, 0.3);\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    margin: 12px 0;\n    position: relative;\n}\n\n.lumiverse-divider-text::before,\n.lumiverse-divider-text::after {\n    content: '';\n    position: absolute;\n    top: 50%;\n    width: calc(50% - 20px);\n    height: 1px;\n    background: rgba(128, 128, 128, 0.2);\n}\n\n.lumiverse-divider-text::before {\n    left: 0;\n}\n\n.lumiverse-divider-text::after {\n    right: 0;\n}\n\n/* ----------------------------------------\n   Input Row and Input Styling\n   ---------------------------------------- */\n.lumiverse-input-row {\n    display: flex;\n    gap: 8px;\n    margin-bottom: 10px;\n}\n\n.lumiverse-input {\n    flex: 1;\n    padding: 10px 14px;\n    background: rgba(0, 0, 0, 0.25);\n    border: 1px solid rgba(128, 128, 128, 0.2);\n    border-radius: var(--lumiverse-radius);\n    font-size: 13px;\n    color: var(--lumiverse-text);\n    font-family: inherit;\n    transition: all var(--lumiverse-transition);\n}\n\n.lumiverse-input::placeholder {\n    color: rgba(255, 255, 255, 0.35);\n}\n\n.lumiverse-input:focus {\n    outline: none;\n    border-color: rgba(147, 112, 219, 0.5);\n    background: rgba(0, 0, 0, 0.35);\n}\n\n/* ----------------------------------------\n   Custom Packs List\n   ---------------------------------------- */\n.lumiverse-custom-packs {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n/* ----------------------------------------\n   Loom Selection Modal\n   ---------------------------------------- */\n.lumiverse-loom-selection-modal {\n    display: flex;\n    flex-direction: column;\n    height: 100%;\n}\n\n.lumiverse-selection-actions {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n}\n\n.lumiverse-loom-item {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 12px 16px;\n    background: var(--lumiverse-bg-tertiary);\n    border-radius: var(--lumiverse-radius-sm);\n    cursor: pointer;\n    transition: all var(--lumiverse-transition);\n    border: 1px solid transparent;\n}\n\n.lumiverse-loom-item:hover {\n    background: var(--lumiverse-bg-secondary);\n    border-color: var(--lumiverse-border-light);\n}\n\n.lumiverse-loom-item--selected {\n    background: rgba(var(--lumiverse-primary-rgb, 147, 112, 219), 0.15);\n    border-color: var(--lumiverse-primary);\n}\n\n.lumiverse-loom-item-content {\n    flex: 1;\n}\n\n.lumiverse-loom-item-name {\n    font-weight: 500;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-loom-item-actions {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    margin-left: auto;\n}\n\n.lumiverse-loom-item-toggle {\n    margin-left: 0;\n}\n\n.lumiverse-loom-item-edit {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 24px;\n    height: 24px;\n    padding: 0;\n    background: rgba(128, 128, 128, 0.15);\n    border: 1px solid rgba(128, 128, 128, 0.15);\n    border-radius: var(--lumiverse-radius-sm);\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    transition: all 0.15s ease;\n    flex-shrink: 0;\n}\n\n.lumiverse-loom-item-edit:hover {\n    background: rgba(100, 149, 237, 0.25);\n    border-color: rgba(100, 149, 237, 0.3);\n    color: rgba(130, 179, 255, 0.95);\n}\n\n.lumiverse-toggle-switch {\n    position: relative;\n    width: 40px;\n    height: 22px;\n}\n\n.lumiverse-toggle-track {\n    width: 100%;\n    height: 100%;\n    background: var(--lumiverse-bg-secondary);\n    border: 2px solid var(--lumiverse-border);\n    border-radius: 11px;\n    transition: all var(--lumiverse-transition);\n}\n\n.lumiverse-toggle-switch.checked .lumiverse-toggle-track {\n    background: var(--lumiverse-primary);\n    border-color: var(--lumiverse-primary);\n}\n\n.lumiverse-toggle-thumb {\n    position: absolute;\n    top: 3px;\n    left: 3px;\n    width: 16px;\n    height: 16px;\n    background: white;\n    border-radius: 50%;\n    transition: transform var(--lumiverse-transition);\n}\n\n.lumiverse-toggle-switch.checked .lumiverse-toggle-thumb {\n    transform: translateX(18px);\n}\n\n/* Selection footer for Loom modals */\n.lumiverse-selection-footer {\n    display: flex;\n    justify-content: flex-end;\n    padding: 16px;\n    border-top: 1px solid var(--lumiverse-border);\n    margin-top: auto;\n}\n\n/* Text button style */\n.lumiverse-btn--text {\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text-muted);\n    padding: 4px 8px;\n}\n\n.lumiverse-btn--text:hover {\n    color: var(--lumiverse-text);\n    background: var(--lumiverse-bg-tertiary);\n}\n\n/* Pack section improvements for Loom modal */\n.lumiverse-pack-icon {\n    margin-right: 8px;\n}\n\n/* Ensure pack items have proper spacing */\n.lumiverse-pack-items {\n    display: flex;\n    flex-direction: column;\n    gap: 4px;\n    padding: 12px;\n    background: var(--lumiverse-bg-secondary);\n    border-radius: 0 0 var(--lumiverse-radius) var(--lumiverse-radius);\n}\n\n/* Pack section collapsed state */\n.lumiverse-pack-section.collapsed .lumiverse-pack-items {\n    display: none;\n}\n\n/* Custom pack badge */\n.lumiverse-pack-badge-custom {\n    font-size: 10px;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    padding: 2px 6px;\n    background: rgba(var(--lumiverse-primary-rgb, 147, 112, 219), 0.2);\n    color: var(--lumiverse-primary);\n    border-radius: 4px;\n    margin-left: 8px;\n}\n\n/* Small icon button */\n.lumiverse-icon-btn-sm {\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    width: 28px;\n    height: 28px;\n    padding: 0;\n    background: transparent;\n    border: none;\n    border-radius: 6px;\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    transition: all 0.15s ease;\n    margin-left: auto;\n    flex-shrink: 0;\n}\n\n.lumiverse-icon-btn-sm:hover {\n    color: var(--lumiverse-danger, #ef4444);\n    background: rgba(239, 68, 68, 0.1);\n}\n\n.lumiverse-icon-btn-sm svg,\n.lumiverse-icon-sm svg {\n    width: 16px;\n    height: 16px;\n}\n\n.lumiverse-icon-sm {\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n}\n\n/* ============================================\n   LOOM MODAL CONTROLS - Collapse/Expand & Sort\n   ============================================ */\n\n.lumiverse-modal-controls {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    gap: 12px;\n    padding: 12px 16px;\n    background: var(--lumiverse-bg-elevated, #1a1a1a);\n    border-bottom: 1px solid var(--lumiverse-border);\n}\n\n.lumiverse-modal-controls-group {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n}\n\n.lumiverse-modal-control-btn {\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    gap: 6px;\n    padding: 8px 12px;\n    font-size: 12px;\n    font-weight: 500;\n    color: var(--lumiverse-text-secondary, #999);\n    background: var(--lumiverse-bg-tertiary, #2a2a2a);\n    border: 1px solid var(--lumiverse-border, #3a3a3a);\n    border-radius: 8px;\n    cursor: pointer;\n    transition: all 0.15s ease;\n    white-space: nowrap;\n}\n\n.lumiverse-modal-control-btn:hover {\n    color: var(--lumiverse-text, #fff);\n    background: var(--lumiverse-bg-hover, #333);\n    border-color: var(--lumiverse-accent, #7c3aed);\n}\n\n.lumiverse-modal-control-btn:active {\n    transform: scale(0.97);\n}\n\n.lumiverse-control-icon,\n.lumiverse-control-icon svg {\n    width: 14px;\n    height: 14px;\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n}\n\n/* Sort Dropdown for Loom modals */\n.lumiverse-modal-sort {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    padding: 6px 12px;\n    background: var(--lumiverse-bg-tertiary, #2a2a2a);\n    border: 1px solid var(--lumiverse-border, #3a3a3a);\n    border-radius: 8px;\n}\n\n.lumiverse-modal-sort-label {\n    font-size: 12px;\n    font-weight: 500;\n    color: var(--lumiverse-text-muted, #666);\n}\n\n.lumiverse-select {\n    padding: 4px 8px;\n    font-size: 12px;\n    font-weight: 500;\n    color: var(--lumiverse-text, #fff);\n    background: var(--lumiverse-bg-secondary, #1e1e1e);\n    border: 1px solid var(--lumiverse-border, #3a3a3a);\n    border-radius: 6px;\n    cursor: pointer;\n    transition: all 0.15s ease;\n    min-width: 100px;\n}\n\n.lumiverse-select:hover {\n    border-color: var(--lumiverse-border-hover, #4a4a4a);\n}\n\n.lumiverse-select:focus {\n    outline: none;\n    border-color: var(--lumiverse-accent, #7c3aed);\n    box-shadow: 0 0 0 2px rgba(124, 58, 237, 0.15);\n}\n\n/* Mobile adjustments for Loom modal controls */\n@media (max-width: 600px) {\n    .lumiverse-modal-controls {\n        flex-wrap: wrap;\n        gap: 8px;\n        padding: 10px 12px;\n    }\n\n    .lumiverse-modal-control-btn {\n        padding: 6px 10px;\n        font-size: 11px;\n    }\n\n    .lumiverse-modal-control-btn span {\n        display: none;\n    }\n\n    .lumiverse-modal-control-btn .lumiverse-control-icon {\n        margin: 0;\n    }\n\n    .lumiverse-modal-sort {\n        flex: 1;\n        min-width: 100%;\n        justify-content: space-between;\n    }\n\n    .lumiverse-select {\n        flex: 1;\n        min-width: 0;\n    }\n}\n\n/* ----------------------------------------\n   Pack Editor Modal\n   ---------------------------------------- */\n.lumiverse-pack-editor-modal {\n    display: flex;\n    flex-direction: column;\n    height: 100%;\n}\n\n.lumiverse-pack-editor-content {\n    flex: 1;\n    overflow-y: auto;\n    padding: 16px;\n    display: flex;\n    flex-direction: column;\n    gap: 24px;\n}\n\n.lumiverse-pack-metadata h3,\n.lumiverse-pack-items-section h3 {\n    margin: 0 0 16px 0;\n    font-size: 16px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-pack-items-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 16px;\n}\n\n.lumiverse-pack-items-header h3 {\n    margin: 0;\n}\n\n.lumiverse-pack-items-list {\n    display: flex;\n    flex-direction: column;\n    gap: 16px;\n}\n\n/* Lumia Item Editor */\n.lumiverse-lumia-editor {\n    background: var(--lumiverse-bg-tertiary);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    overflow: hidden;\n}\n\n.lumiverse-lumia-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 12px 16px;\n    background: var(--lumiverse-bg-secondary);\n    border-bottom: 1px solid var(--lumiverse-border);\n}\n\n.lumiverse-lumia-type {\n    font-size: 12px;\n    font-weight: 600;\n    text-transform: uppercase;\n    color: var(--lumiverse-text-muted);\n    background: var(--lumiverse-bg-primary);\n    padding: 4px 8px;\n    border-radius: var(--lumiverse-radius-sm);\n}\n\n.lumiverse-lumia-fields {\n    padding: 16px;\n    display: flex;\n    flex-direction: column;\n    gap: 16px;\n}\n\n/* Pack Editor Footer */\n.lumiverse-pack-editor-footer {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 16px;\n    border-top: 1px solid var(--lumiverse-border);\n    background: var(--lumiverse-bg-secondary);\n}\n\n.lumiverse-pack-editor-footer-left {\n    display: flex;\n    gap: 8px;\n    align-items: center;\n}\n\n.lumiverse-pack-editor-actions {\n    display: flex;\n    gap: 8px;\n    margin-left: auto;\n}\n\n/* Pack Editor Title */\n.lumiverse-pack-editor-title {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    margin-bottom: 20px;\n}\n\n.lumiverse-pack-editor-title h3 {\n    margin: 0;\n    font-size: 18px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-pack-editor-title svg {\n    color: var(--lumiverse-primary-text);\n}\n\n/* Pack Lumias Info Section */\n.lumiverse-pack-lumias-info {\n    background: var(--lumiverse-bg-tertiary);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    padding: 16px;\n}\n\n.lumiverse-pack-lumias-header {\n    margin-bottom: 8px;\n}\n\n.lumiverse-pack-lumias-count {\n    font-size: 14px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-pack-lumias-hint {\n    font-size: 13px;\n    color: var(--lumiverse-text-muted);\n    margin: 0 0 12px 0;\n}\n\n/* Full width button modifier */\n.lumiverse-btn--full {\n    width: 100%;\n    justify-content: center;\n}\n\n/* Form hint text */\n.lumiverse-form-hint {\n    display: block;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n    margin-top: 4px;\n    font-style: italic;\n}\n\n/* Lumia editor row (side-by-side fields) */\n.lumiverse-lumia-row {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 12px;\n}\n\n.lumiverse-lumia-row .lumiverse-form-field {\n    margin-bottom: 0;\n}\n\n/* Lumia name in header */\n.lumiverse-lumia-name {\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    font-size: 14px;\n}\n\n/* Clickable Lumia name (for opening full editor) */\n.lumiverse-lumia-name--clickable {\n    cursor: pointer;\n    transition: color 0.15s ease;\n}\n\n.lumiverse-lumia-name--clickable:hover {\n    color: var(--lumiverse-primary-text);\n}\n\n/* Header actions container */\n.lumiverse-lumia-header-actions {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n}\n\n/* Expand button in header */\n.lumiverse-btn--expand {\n    background: rgba(147, 112, 219, 0.1);\n    border: 1px solid rgba(147, 112, 219, 0.2);\n    color: var(--lumiverse-primary-text);\n    opacity: 0.7;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-btn--expand:hover {\n    background: rgba(147, 112, 219, 0.2);\n    opacity: 1;\n}\n\n/* Image Input */\n.lumiverse-image-input {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumiverse-image-preview {\n    width: 100px;\n    height: 100px;\n    border-radius: var(--lumiverse-radius);\n    overflow: hidden;\n    border: 1px solid var(--lumiverse-border);\n}\n\n.lumiverse-image-preview img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n}\n\n.lumiverse-image-error {\n    color: var(--lumiverse-danger);\n    font-size: 12px;\n}\n\n/* Danger button */\n.lumiverse-btn--danger {\n    background: transparent;\n    border: 1px solid var(--lumiverse-danger);\n    color: var(--lumiverse-danger);\n}\n\n.lumiverse-btn--danger:hover {\n    background: var(--lumiverse-danger);\n    color: white;\n}\n\n.lumiverse-btn--icon {\n    padding: 6px 8px;\n}\n\n/* Select input */\n.lumiverse-select {\n    width: 100%;\n    padding: 10px 12px;\n    background: var(--lumiverse-bg-tertiary);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius-sm);\n    color: var(--lumiverse-text);\n    font-size: 14px;\n    cursor: pointer;\n}\n\n.lumiverse-select:focus {\n    outline: none;\n    border-color: var(--lumiverse-primary);\n}\n\n/* Required asterisk */\n.lumiverse-required {\n    color: var(--lumiverse-danger);\n    margin-left: 4px;\n}\n\n/* ----------------------------------------\n   Pack Selector Modal\n   ---------------------------------------- */\n.lumia-modal-pack-selector {\n    max-width: 480px;\n    width: 90%;\n}\n\n.lumiverse-pack-selector-modal {\n    display: flex;\n    flex-direction: column;\n    max-height: 70vh;\n}\n\n.lumiverse-pack-selector-content {\n    flex: 1;\n    overflow-y: auto;\n    padding: 16px;\n}\n\n.lumiverse-pack-selector-section {\n    margin-bottom: 16px;\n}\n\n.lumiverse-pack-selector-heading {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    margin: 0 0 12px 0;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n.lumiverse-pack-selector-empty {\n    padding: 20px;\n    text-align: center;\n    color: var(--lumiverse-text-muted);\n    font-size: 13px;\n    background: var(--lumiverse-bg-tertiary);\n    border-radius: var(--lumiverse-radius);\n}\n\n.lumiverse-pack-selector-list {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumiverse-pack-selector-item {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n    padding: 12px 14px;\n    background: var(--lumiverse-bg-tertiary);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    cursor: pointer;\n    transition: all 0.15s ease;\n    text-align: left;\n    width: 100%;\n}\n\n.lumiverse-pack-selector-item:hover {\n    background: var(--lumiverse-bg-hover);\n    border-color: var(--lumiverse-primary);\n}\n\n.lumiverse-pack-selector-item-icon {\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-pack-selector-item-info {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n}\n\n.lumiverse-pack-selector-item-name {\n    font-weight: 500;\n    color: var(--lumiverse-text);\n    font-size: 14px;\n}\n\n.lumiverse-pack-selector-item-meta {\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-pack-selector-item-arrow {\n    color: var(--lumiverse-text-muted);\n    opacity: 0;\n    transition: opacity 0.15s ease;\n}\n\n.lumiverse-pack-selector-item:hover .lumiverse-pack-selector-item-arrow {\n    opacity: 1;\n}\n\n.lumiverse-pack-selector-divider {\n    display: flex;\n    align-items: center;\n    margin: 16px 0;\n    color: var(--lumiverse-text-muted);\n    font-size: 12px;\n}\n\n.lumiverse-pack-selector-divider::before,\n.lumiverse-pack-selector-divider::after {\n    content: '';\n    flex: 1;\n    height: 1px;\n    background: var(--lumiverse-border);\n}\n\n.lumiverse-pack-selector-divider span {\n    padding: 0 12px;\n}\n\n.lumiverse-pack-selector-create-btn {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 8px;\n    width: 100%;\n    padding: 14px;\n    background: transparent;\n    border: 2px dashed var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    color: var(--lumiverse-text-muted);\n    font-size: 14px;\n    cursor: pointer;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-pack-selector-create-btn:hover {\n    border-color: var(--lumiverse-primary);\n    color: var(--lumiverse-primary);\n    background: rgba(var(--lumiverse-primary-rgb), 0.05);\n}\n\n.lumiverse-pack-selector-form {\n    background: var(--lumiverse-bg-tertiary);\n    border-radius: var(--lumiverse-radius);\n    padding: 16px;\n}\n\n.lumiverse-pack-selector-field {\n    margin-bottom: 12px;\n}\n\n.lumiverse-pack-selector-field:last-of-type {\n    margin-bottom: 0;\n}\n\n.lumiverse-pack-selector-error {\n    color: var(--lumiverse-danger);\n    font-size: 12px;\n    margin: 8px 0;\n}\n\n.lumiverse-pack-selector-form-actions {\n    display: flex;\n    gap: 8px;\n    justify-content: flex-end;\n    margin-top: 16px;\n}\n\n.lumiverse-pack-selector-footer {\n    display: flex;\n    justify-content: flex-end;\n    padding: 12px 16px;\n    border-top: 1px solid var(--lumiverse-border);\n    background: var(--lumiverse-bg-secondary);\n}\n\n/* Pack Selector - Expandable Item Wrapper */\n.lumiverse-pack-selector-item-wrapper {\n    border-radius: var(--lumiverse-radius);\n    overflow: hidden;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-pack-selector-item-wrapper--expanded {\n    background: rgba(0, 0, 0, 0.15);\n    border: 1px solid var(--lumiverse-border);\n}\n\n.lumiverse-pack-selector-item-wrapper--expanded .lumiverse-pack-selector-item {\n    border-color: transparent;\n    border-radius: var(--lumiverse-radius) var(--lumiverse-radius) 0 0;\n}\n\n.lumiverse-pack-selector-item-wrapper--expanded .lumiverse-pack-selector-item-arrow {\n    opacity: 1;\n}\n\n/* Pack Selector - Expanded Lumias List */\n.lumiverse-pack-selector-lumias {\n    padding: 8px 12px 12px;\n    border-top: 1px solid var(--lumiverse-border-light);\n}\n\n.lumiverse-pack-selector-add-lumia {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 6px;\n    width: 100%;\n    padding: 10px 12px;\n    margin-bottom: 8px;\n    background: rgba(147, 112, 219, 0.1);\n    border: 1px dashed rgba(147, 112, 219, 0.3);\n    border-radius: var(--lumiverse-radius-sm);\n    color: var(--lumiverse-primary-text);\n    font-size: 13px;\n    font-weight: 500;\n    cursor: pointer;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-pack-selector-add-lumia:hover {\n    background: rgba(147, 112, 219, 0.2);\n    border-color: rgba(147, 112, 219, 0.5);\n}\n\n.lumiverse-pack-selector-lumia-list {\n    display: flex;\n    flex-direction: column;\n    gap: 4px;\n}\n\n.lumiverse-pack-selector-lumia-item {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 8px 10px;\n    background: rgba(0, 0, 0, 0.1);\n    border: 1px solid rgba(128, 128, 128, 0.08);\n    border-radius: var(--lumiverse-radius-sm);\n    transition: all 0.15s ease;\n}\n\n.lumiverse-pack-selector-lumia-item:hover {\n    background: rgba(0, 0, 0, 0.18);\n    border-color: rgba(147, 112, 219, 0.2);\n}\n\n.lumiverse-pack-selector-lumia-avatar {\n    width: 28px;\n    height: 28px;\n    border-radius: 50%;\n    object-fit: cover;\n    border: 1px solid rgba(147, 112, 219, 0.2);\n    flex-shrink: 0;\n}\n\n.lumiverse-pack-selector-lumia-name {\n    flex: 1;\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-pack-selector-lumia-edit {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 28px;\n    height: 28px;\n    padding: 0;\n    background: rgba(147, 112, 219, 0.15);\n    border: 1px solid rgba(147, 112, 219, 0.2);\n    border-radius: var(--lumiverse-radius-sm);\n    color: var(--lumiverse-primary-text);\n    cursor: pointer;\n    transition: all 0.15s ease;\n    flex-shrink: 0;\n}\n\n.lumiverse-pack-selector-lumia-edit:hover {\n    background: rgba(147, 112, 219, 0.3);\n    border-color: rgba(147, 112, 219, 0.4);\n}\n\n.lumiverse-pack-selector-lumia-empty {\n    padding: 12px;\n    text-align: center;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n    font-style: italic;\n}\n\n/* Pack Selector - Unified Items List (Lumia + Loom) */\n.lumiverse-pack-selector-items {\n    padding: 8px 12px 12px;\n    border-top: 1px solid var(--lumiverse-border-light);\n}\n\n.lumiverse-pack-selector-add-item {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 6px;\n    width: 100%;\n    padding: 10px 12px;\n    margin-bottom: 8px;\n    background: linear-gradient(135deg, rgba(147, 112, 219, 0.1) 0%, rgba(100, 149, 237, 0.1) 100%);\n    border: 1px dashed rgba(147, 112, 219, 0.3);\n    border-radius: var(--lumiverse-radius-sm);\n    color: var(--lumiverse-primary-text);\n    font-size: 13px;\n    font-weight: 500;\n    cursor: pointer;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-pack-selector-add-item:hover {\n    background: linear-gradient(135deg, rgba(147, 112, 219, 0.2) 0%, rgba(100, 149, 237, 0.2) 100%);\n    border-color: rgba(147, 112, 219, 0.5);\n}\n\n.lumiverse-pack-selector-item-list {\n    display: flex;\n    flex-direction: column;\n    gap: 4px;\n}\n\n.lumiverse-pack-selector-item-row {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 8px 10px;\n    background: rgba(0, 0, 0, 0.1);\n    border: 1px solid rgba(128, 128, 128, 0.08);\n    border-radius: var(--lumiverse-radius-sm);\n    transition: all 0.15s ease;\n}\n\n.lumiverse-pack-selector-item-row:hover {\n    background: rgba(0, 0, 0, 0.18);\n    border-color: rgba(147, 112, 219, 0.2);\n}\n\n.lumiverse-pack-selector-item-row--loom:hover {\n    border-color: rgba(100, 149, 237, 0.2);\n}\n\n.lumiverse-pack-selector-item-icon-sm {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 28px;\n    height: 28px;\n    border-radius: 50%;\n    flex-shrink: 0;\n    overflow: hidden;\n}\n\n.lumiverse-pack-selector-item-icon--lumia {\n    background: rgba(147, 112, 219, 0.15);\n    color: rgba(186, 135, 255, 0.9);\n    border: 1px solid rgba(147, 112, 219, 0.2);\n}\n\n.lumiverse-pack-selector-item-icon--loom {\n    background: rgba(100, 149, 237, 0.15);\n    color: rgba(130, 179, 255, 0.9);\n    border: 1px solid rgba(100, 149, 237, 0.2);\n}\n\n.lumiverse-pack-selector-item-avatar {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n}\n\n.lumiverse-pack-selector-item-name {\n    flex: 1;\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-pack-selector-item-type {\n    font-size: 10px;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    padding: 3px 8px;\n    border-radius: 10px;\n    background: rgba(147, 112, 219, 0.15);\n    color: rgba(186, 135, 255, 0.85);\n    flex-shrink: 0;\n}\n\n.lumiverse-pack-selector-item-type--loom {\n    background: rgba(100, 149, 237, 0.15);\n    color: rgba(130, 179, 255, 0.85);\n}\n\n.lumiverse-pack-selector-item-edit {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 28px;\n    height: 28px;\n    padding: 0;\n    background: rgba(128, 128, 128, 0.15);\n    border: 1px solid rgba(128, 128, 128, 0.15);\n    border-radius: var(--lumiverse-radius-sm);\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    transition: all 0.15s ease;\n    flex-shrink: 0;\n}\n\n.lumiverse-pack-selector-item-edit:hover {\n    background: rgba(147, 112, 219, 0.25);\n    border-color: rgba(147, 112, 219, 0.3);\n    color: var(--lumiverse-primary-text);\n}\n\n.lumiverse-pack-selector-item-row--loom .lumiverse-pack-selector-item-edit:hover {\n    background: rgba(100, 149, 237, 0.25);\n    border-color: rgba(100, 149, 237, 0.3);\n    color: rgba(130, 179, 255, 0.95);\n}\n\n.lumiverse-pack-selector-items-empty {\n    padding: 12px;\n    text-align: center;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n    font-style: italic;\n}\n\n/* Pack name class for clarity */\n.lumiverse-pack-selector-pack-name {\n    font-size: 14px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n/* ----------------------------------------\n   Lumia Editor Modal\n   ---------------------------------------- */\n.lumia-modal-lumia-editor {\n    max-width: 640px;\n    width: 90%;\n}\n\n.lumiverse-editor-modal {\n    display: flex;\n    flex-direction: column;\n    max-height: 80vh;\n}\n\n.lumiverse-editor-content {\n    flex: 1;\n    overflow-y: auto;\n    padding: 16px;\n}\n\n.lumiverse-editor-section {\n    margin-bottom: 20px;\n    background: var(--lumiverse-bg-tertiary);\n    border-radius: var(--lumiverse-radius);\n    overflow: hidden;\n}\n\n.lumiverse-editor-section:last-child {\n    margin-bottom: 0;\n}\n\n.lumiverse-editor-section-header {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    padding: 12px 14px;\n    background: var(--lumiverse-bg-secondary);\n    border-bottom: 1px solid var(--lumiverse-border);\n    font-weight: 600;\n    font-size: 13px;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-editor-section-content {\n    padding: 14px;\n}\n\n.lumiverse-editor-field {\n    margin-bottom: 14px;\n}\n\n.lumiverse-editor-field:last-child {\n    margin-bottom: 0;\n}\n\n.lumiverse-editor-field--error .lumiverse-input,\n.lumiverse-editor-field--error .lumiverse-textarea {\n    border-color: var(--lumiverse-danger);\n}\n\n.lumiverse-editor-label {\n    display: block;\n    font-size: 12px;\n    font-weight: 500;\n    color: var(--lumiverse-text-muted);\n    margin-bottom: 6px;\n}\n\n.lumiverse-editor-hint {\n    display: block;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n    margin-top: 4px;\n    font-style: italic;\n}\n\n.lumiverse-editor-error {\n    display: block;\n    font-size: 11px;\n    color: var(--lumiverse-danger);\n    margin-top: 4px;\n}\n\n.lumiverse-editor-row {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 12px;\n}\n\n.lumiverse-editor-row .lumiverse-editor-field {\n    margin-bottom: 0;\n}\n\n.lumiverse-editor-avatar-preview {\n    width: 80px;\n    height: 80px;\n    border-radius: var(--lumiverse-radius);\n    overflow: hidden;\n    border: 1px solid var(--lumiverse-border);\n    margin-top: 8px;\n    position: relative;\n}\n\n.lumiverse-editor-avatar-preview img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n    opacity: 0;\n    transition: opacity 0.2s ease;\n}\n\n.lumiverse-editor-avatar-preview.loaded img {\n    opacity: 1;\n}\n\n.lumiverse-editor-avatar-spinner {\n    position: absolute;\n    inset: 0;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    background: var(--lumiverse-bg-tertiary);\n}\n\n.lumiverse-editor-avatar-spinner::after {\n    content: '';\n    width: 20px;\n    height: 20px;\n    border: 2px solid var(--lumiverse-border);\n    border-top-color: var(--lumiverse-primary);\n    border-radius: 50%;\n    animation: spin 0.8s linear infinite;\n}\n\n.lumiverse-editor-avatar-preview.loaded .lumiverse-editor-avatar-spinner {\n    display: none;\n}\n\n.lumiverse-editor-footer {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    padding: 12px 16px;\n    border-top: 1px solid var(--lumiverse-border);\n    background: var(--lumiverse-bg-secondary);\n}\n\n.lumiverse-editor-footer-spacer {\n    flex: 1;\n}\n\n/* ----------------------------------------\n   Item Type Selector\n   Choice between Lumia and Loom\n   ---------------------------------------- */\n.lumiverse-type-selector {\n    display: flex;\n    flex-direction: column;\n    padding: 20px;\n    min-width: 420px;\n}\n\n.lumiverse-type-selector-header {\n    text-align: center;\n    margin-bottom: 24px;\n}\n\n.lumiverse-type-selector-title {\n    font-size: 16px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    margin: 0 0 6px 0;\n    letter-spacing: -0.2px;\n}\n\n.lumiverse-type-selector-subtitle {\n    font-size: 13px;\n    color: var(--lumiverse-text-muted);\n    margin: 0;\n}\n\n.lumiverse-type-selector-options {\n    display: flex;\n    flex-direction: column;\n    gap: 12px;\n}\n\n.lumiverse-type-option {\n    display: flex;\n    align-items: center;\n    gap: 16px;\n    padding: 16px 18px;\n    background: var(--lumiverse-bg-elevated);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius-lg);\n    cursor: pointer;\n    transition: all var(--lumiverse-transition);\n    text-align: left;\n    width: 100%;\n}\n\n.lumiverse-type-option:hover,\n.lumiverse-type-option--hovered {\n    background: var(--lumiverse-bg-hover);\n    border-color: var(--lumiverse-border-hover);\n    transform: translateY(-1px);\n}\n\n.lumiverse-type-option--lumia:hover,\n.lumiverse-type-option--lumia.lumiverse-type-option--hovered {\n    border-color: rgba(147, 112, 219, 0.4);\n    box-shadow: 0 4px 20px rgba(147, 112, 219, 0.15);\n}\n\n.lumiverse-type-option--loom:hover,\n.lumiverse-type-option--loom.lumiverse-type-option--hovered {\n    border-color: rgba(100, 149, 237, 0.4);\n    box-shadow: 0 4px 20px rgba(100, 149, 237, 0.15);\n}\n\n.lumiverse-type-option-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 48px;\n    height: 48px;\n    border-radius: var(--lumiverse-radius);\n    flex-shrink: 0;\n    transition: all var(--lumiverse-transition);\n}\n\n.lumiverse-type-option--lumia .lumiverse-type-option-icon {\n    background: rgba(147, 112, 219, 0.15);\n    color: rgba(186, 135, 255, 0.9);\n}\n\n.lumiverse-type-option--lumia:hover .lumiverse-type-option-icon,\n.lumiverse-type-option--lumia.lumiverse-type-option--hovered .lumiverse-type-option-icon {\n    background: rgba(147, 112, 219, 0.25);\n}\n\n.lumiverse-type-option--loom .lumiverse-type-option-icon {\n    background: rgba(100, 149, 237, 0.15);\n    color: rgba(130, 179, 255, 0.9);\n}\n\n.lumiverse-type-option--loom:hover .lumiverse-type-option-icon,\n.lumiverse-type-option--loom.lumiverse-type-option--hovered .lumiverse-type-option-icon {\n    background: rgba(100, 149, 237, 0.25);\n}\n\n.lumiverse-type-option-content {\n    flex: 1;\n    min-width: 0;\n}\n\n.lumiverse-type-option-label {\n    display: block;\n    font-size: 14px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    margin-bottom: 4px;\n}\n\n.lumiverse-type-option-desc {\n    display: block;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n    line-height: 1.4;\n}\n\n.lumiverse-type-option-arrow {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 24px;\n    height: 24px;\n    color: var(--lumiverse-text-dim);\n    opacity: 0;\n    transform: translateX(-4px);\n    transition: all var(--lumiverse-transition);\n}\n\n.lumiverse-type-option:hover .lumiverse-type-option-arrow,\n.lumiverse-type-option--hovered .lumiverse-type-option-arrow {\n    opacity: 1;\n    transform: translateX(0);\n}\n\n.lumiverse-type-selector-footer {\n    display: flex;\n    justify-content: center;\n    margin-top: 20px;\n    padding-top: 16px;\n    border-top: 1px solid var(--lumiverse-border);\n}\n\n/* Modal wrapper for type selector */\n.lumia-modal-type-selector {\n    max-width: 480px;\n    width: 90%;\n}\n\n/* ----------------------------------------\n   Loom Editor Modal\n   ---------------------------------------- */\n.lumia-modal-loom-editor {\n    max-width: 580px;\n    width: 90%;\n}\n\n.lumiverse-loom-editor {\n    display: flex;\n    flex-direction: column;\n    max-height: 80vh;\n}\n\n.lumiverse-loom-editor-content {\n    flex: 1;\n    overflow-y: auto;\n    padding: 16px;\n}\n\n.lumiverse-loom-category-select {\n    margin-bottom: 16px;\n}\n\n.lumiverse-loom-category-options {\n    display: flex;\n    gap: 8px;\n    flex-wrap: wrap;\n}\n\n.lumiverse-loom-category-btn {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    padding: 8px 14px;\n    background: var(--lumiverse-bg-elevated);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 20px;\n    font-size: 12px;\n    font-weight: 500;\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    transition: all var(--lumiverse-transition);\n}\n\n.lumiverse-loom-category-btn:hover {\n    background: var(--lumiverse-bg-hover);\n    border-color: var(--lumiverse-border-hover);\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-loom-category-btn--selected {\n    background: rgba(100, 149, 237, 0.2);\n    border-color: rgba(100, 149, 237, 0.4);\n    color: rgba(130, 179, 255, 0.95);\n}\n\n.lumiverse-loom-category-btn--selected:hover {\n    background: rgba(100, 149, 237, 0.25);\n    border-color: rgba(100, 149, 237, 0.5);\n}\n\n.lumiverse-loom-content-field {\n    margin-top: 16px;\n}\n\n.lumiverse-loom-content-field .lumiverse-textarea {\n    min-height: 200px;\n    resize: vertical;\n}\n\n/* ----------------------------------------\n   Viewport Panel (Dockable Sidebar)\n   ---------------------------------------- */\n\n/* Container for the viewport panel - mounted to document.body */\n.lumiverse-viewport-container {\n    /* Inline styles handle positioning, this is for any additional styling */\n    margin: 0;\n    padding: 0;\n}\n\n/* Wrapper that slides in/out - contains both toggle and panel */\n.lumiverse-viewport-wrapper {\n    display: flex;\n    flex-direction: row;\n    align-items: flex-start;\n    height: 100vh;\n    height: 100dvh;\n}\n\n/* Container for the toggle button - positioned to left of panel */\n.lumiverse-toggle-container {\n    position: absolute;\n    top: 12px;\n    right: 100%; /* Position to the left of the wrapper */\n    margin-right: 12px;\n    pointer-events: auto;\n}\n\n/* Custom position modifier - disables default positioning, uses inline styles */\n.lumiverse-toggle-container--custom {\n    /* Reset all positioning to allow inline styles to take effect */\n    position: fixed;\n    top: auto;\n    right: auto;\n    margin: 0;\n}\n\n.lumiverse-viewport-panel {\n    height: 100%;\n    display: flex;\n    flex-direction: row;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n    pointer-events: auto;\n}\n\n.lumiverse-viewport-panel--collapsed {\n    /* Just show the tab bar when collapsed */\n}\n\n/* Tab sidebar */\n.lumiverse-vp-tabs {\n    display: flex;\n    flex-direction: column;\n    width: 56px;\n    background: linear-gradient(180deg, rgba(28, 24, 38, 0.98) 0%, rgba(20, 17, 28, 0.98) 100%);\n    border-left: 1px solid rgba(147, 112, 219, 0.2);\n    padding: 8px 0; /* Minimal padding - panel is at top of screen */\n    gap: 4px;\n}\n\n.lumiverse-vp-tab {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    width: 52px;\n    height: 52px;\n    margin: 0 2px;\n    background: transparent;\n    border: none;\n    border-radius: 8px;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-vp-tab:hover {\n    background: rgba(147, 112, 219, 0.15);\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-vp-tab--active {\n    background: rgba(147, 112, 219, 0.25);\n    color: var(--lumiverse-primary);\n    box-shadow: inset 2px 0 0 var(--lumiverse-primary);\n}\n\n.lumiverse-vp-tab-icon {\n    font-size: 18px;\n    line-height: 1;\n}\n\n.lumiverse-vp-tab-label {\n    font-size: 10px;\n    margin-top: 4px;\n    white-space: nowrap;\n    overflow: visible;\n    text-overflow: clip;\n    max-width: none;\n}\n\n.lumiverse-vp-tabs-spacer {\n    flex: 1;\n}\n\n.lumiverse-vp-collapse-btn {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 52px;\n    height: 40px;\n    margin: 0 2px;\n    background: transparent;\n    border: none;\n    border-radius: 8px;\n    cursor: pointer;\n    color: var(--lumiverse-text-muted);\n    font-size: 14px;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-vp-collapse-btn:hover {\n    background: rgba(147, 112, 219, 0.15);\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-vp-collapse-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: transform 0.2s ease;\n}\n\n.lumiverse-vp-collapse-icon--rotated {\n    transform: rotate(180deg);\n}\n\n/* Main panel area */\n.lumiverse-vp-main {\n    display: flex;\n    flex-direction: column;\n    background: linear-gradient(180deg, rgba(28, 24, 38, 0.98) 0%, rgba(20, 17, 28, 0.98) 100%);\n    border-left: 1px solid rgba(147, 112, 219, 0.15);\n    overflow: hidden;\n}\n\n.lumiverse-vp-header {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 12px 16px;\n    background: rgba(147, 112, 219, 0.08);\n    border-bottom: 1px solid rgba(147, 112, 219, 0.15);\n    min-height: 48px;\n}\n\n.lumiverse-vp-header-icon {\n    font-size: 18px;\n}\n\n.lumiverse-vp-header-title {\n    flex: 1;\n    font-size: 14px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-vp-close-btn {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 28px;\n    height: 28px;\n    background: transparent;\n    border: none;\n    border-radius: 6px;\n    cursor: pointer;\n    color: var(--lumiverse-text-muted);\n    font-size: 14px;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-vp-close-btn:hover {\n    background: rgba(255, 100, 100, 0.2);\n    color: #ff6464;\n}\n\n.lumiverse-vp-content {\n    flex: 1;\n    position: relative; /* Containing block for absolute exit animations */\n    overflow-y: auto;\n    overflow-x: hidden;\n    scrollbar-gutter: stable; /* Reserve scrollbar space to prevent layout shift */\n    contain: layout style; /* Isolate layout calculations for performance */\n}\n\n.lumiverse-vp-tab-content {\n    display: none; /* Hidden by default */\n    min-height: 100%;\n}\n\n.lumiverse-vp-tab-content--active {\n    display: block; /* Show active tab instantly */\n}\n\n/* Placeholder content */\n.lumiverse-vp-placeholder {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    padding: 40px 20px;\n    text-align: center;\n    min-height: 300px;\n}\n\n.lumiverse-vp-placeholder-icon {\n    font-size: 48px;\n    margin-bottom: 16px;\n    opacity: 0.6;\n}\n\n.lumiverse-vp-placeholder h3 {\n    margin: 0 0 8px 0;\n    font-size: 16px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-vp-placeholder p {\n    margin: 0 0 16px 0;\n    font-size: 13px;\n    color: var(--lumiverse-text-muted);\n    max-width: 240px;\n}\n\n.lumiverse-vp-placeholder-badge {\n    display: inline-block;\n    padding: 4px 12px;\n    background: rgba(147, 112, 219, 0.15);\n    border: 1px solid rgba(147, 112, 219, 0.3);\n    border-radius: 12px;\n    font-size: 11px;\n    font-weight: 600;\n    color: var(--lumiverse-primary);\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n/* ----------------------------------------\n   Character Lumia Profile\n   ---------------------------------------- */\n.lumiverse-character-profile {\n    padding: 16px;\n    display: flex;\n    flex-direction: column;\n    gap: 16px;\n}\n\n/* Profile Header */\n.lumiverse-profile-header {\n    display: flex;\n    align-items: center;\n    gap: 14px;\n    padding-bottom: 16px;\n    border-bottom: 1px solid rgba(147, 112, 219, 0.15);\n}\n\n.lumiverse-profile-avatar {\n    width: 56px;\n    height: 56px;\n    border-radius: 12px;\n    overflow: hidden;\n    background: rgba(147, 112, 219, 0.1);\n    flex-shrink: 0;\n    border: 2px solid rgba(147, 112, 219, 0.3);\n}\n\n.lumiverse-profile-avatar img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n}\n\n.lumiverse-profile-avatar-placeholder {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 100%;\n    height: 100%;\n    font-size: 24px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-profile-info {\n    flex: 1;\n    min-width: 0;\n}\n\n.lumiverse-profile-name {\n    margin: 0 0 8px 0;\n    font-size: 16px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-profile-stats {\n    display: flex;\n    gap: 6px;\n}\n\n.lumiverse-stat {\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    gap: 4px;\n    padding: 4px 8px;\n    background: rgba(147, 112, 219, 0.08);\n    border-radius: 6px;\n    cursor: default;\n}\n\n.lumiverse-stat-icon {\n    color: var(--lumiverse-text-muted);\n    flex-shrink: 0;\n}\n\n.lumiverse-stat-value {\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--lumiverse-primary);\n}\n\n/* Profile Sections */\n.lumiverse-profile-section {\n    background: rgba(147, 112, 219, 0.05);\n    border-radius: 10px;\n    padding: 12px;\n}\n\n.lumiverse-profile-section-header {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    margin-bottom: 10px;\n}\n\n.lumiverse-profile-section-icon {\n    font-size: 14px;\n}\n\n.lumiverse-profile-section-title {\n    font-size: 12px;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    color: var(--lumiverse-text-muted);\n    flex: 1;\n}\n\n.lumiverse-profile-section-count {\n    font-size: 11px;\n    font-weight: 600;\n    color: var(--lumiverse-primary);\n    background: rgba(147, 112, 219, 0.15);\n    padding: 2px 8px;\n    border-radius: 10px;\n}\n\n/* Council Banner - shown in Profile tab when Council mode is active */\n.lumiverse-council-banner {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 16px;\n    padding: 24px 20px;\n    background: linear-gradient(\n        135deg,\n        rgba(147, 112, 219, 0.12) 0%,\n        rgba(100, 180, 255, 0.08) 100%\n    );\n    border: 1px solid rgba(147, 112, 219, 0.2);\n    border-radius: 12px;\n    text-align: center;\n}\n\n.lumiverse-council-banner-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 56px;\n    height: 56px;\n    background: linear-gradient(135deg, rgba(147, 112, 219, 0.25) 0%, rgba(100, 180, 255, 0.15) 100%);\n    border-radius: 50%;\n    color: var(--lumiverse-primary);\n}\n\n.lumiverse-council-banner-content {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n    width: 100%;\n}\n\n.lumiverse-council-banner-title {\n    font-size: 15px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    margin: 0;\n}\n\n.lumiverse-council-banner-stats {\n    display: flex;\n    justify-content: center;\n    gap: 16px;\n    flex-wrap: wrap;\n}\n\n.lumiverse-council-banner-stat {\n    display: flex;\n    align-items: center;\n    gap: 5px;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-council-banner-stat svg {\n    color: var(--lumiverse-primary);\n    opacity: 0.8;\n}\n\n.lumiverse-council-banner-avatars {\n    display: flex;\n    justify-content: center;\n    margin-top: 4px;\n}\n\n.lumiverse-council-banner-avatar {\n    width: 36px;\n    height: 36px;\n    border-radius: 50%;\n    background: rgba(147, 112, 219, 0.2);\n    border: 2px solid var(--lumiverse-surface);\n    margin-left: -10px;\n    overflow: hidden;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-council-banner-avatar:first-child {\n    margin-left: 0;\n}\n\n.lumiverse-council-banner-avatar img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n}\n\n.lumiverse-council-banner-more {\n    width: 36px;\n    height: 36px;\n    border-radius: 50%;\n    background: rgba(147, 112, 219, 0.3);\n    border: 2px solid var(--lumiverse-surface);\n    margin-left: -10px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 11px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-council-banner-btn {\n    display: inline-flex;\n    align-items: center;\n    gap: 6px;\n    padding: 10px 20px;\n    font-size: 13px;\n    font-weight: 500;\n    color: white;\n    background: linear-gradient(135deg, rgba(147, 112, 219, 0.9) 0%, rgba(123, 95, 196, 0.9) 100%);\n    border: none;\n    border-radius: 8px;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    margin-top: 4px;\n}\n\n.lumiverse-council-banner-btn:hover {\n    background: linear-gradient(135deg, rgba(167, 139, 240, 0.95) 0%, rgba(147, 112, 219, 0.95) 100%);\n    transform: translateY(-1px);\n    box-shadow: 0 4px 12px rgba(147, 112, 219, 0.3);\n}\n\n.lumiverse-council-banner-btn svg {\n    transition: transform 0.2s ease;\n}\n\n.lumiverse-council-banner-btn:hover svg {\n    transform: translateX(3px);\n}\n\n/* Trait Cards */\n.lumiverse-traits-list {\n    display: flex;\n    flex-direction: column;\n    gap: 6px;\n}\n\n.lumiverse-trait-card {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 10px 12px;\n    border-radius: 8px;\n    border: 1px solid transparent;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-trait-card:hover {\n    transform: translateX(2px);\n}\n\n.lumiverse-trait-card--dominant {\n    box-shadow: 0 0 0 1px rgba(245, 158, 11, 0.4), 0 2px 8px rgba(245, 158, 11, 0.15);\n}\n\n.lumiverse-trait-icon {\n    font-size: 14px;\n    flex-shrink: 0;\n}\n\n.lumiverse-trait-info {\n    flex: 1;\n    min-width: 0;\n    display: flex;\n    align-items: center;\n    gap: 8px;\n}\n\n.lumiverse-trait-name {\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-trait-dominant-badge {\n    font-size: 10px;\n    font-weight: 600;\n    color: var(--lumiverse-warning);\n    background: rgba(245, 158, 11, 0.15);\n    padding: 2px 6px;\n    border-radius: 4px;\n    white-space: nowrap;\n}\n\n.lumiverse-trait-remove {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 22px;\n    height: 22px;\n    background: transparent;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n    color: var(--lumiverse-text-muted);\n    font-size: 12px;\n    opacity: 0;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-trait-card:hover .lumiverse-trait-remove {\n    opacity: 1;\n}\n\n.lumiverse-trait-remove:hover {\n    background: rgba(239, 68, 68, 0.15);\n    color: var(--lumiverse-danger);\n}\n\n/* Empty Section */\n.lumiverse-profile-empty {\n    padding: 16px;\n    text-align: center;\n    color: var(--lumiverse-text-dim);\n    font-size: 12px;\n    font-style: italic;\n}\n\n/* Loom Summary */\n.lumiverse-loom-summary {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumiverse-loom-group {\n    display: flex;\n    align-items: flex-start;\n    gap: 8px;\n    font-size: 12px;\n}\n\n.lumiverse-loom-label {\n    font-weight: 600;\n    color: var(--lumiverse-text-muted);\n    flex-shrink: 0;\n    min-width: 60px;\n}\n\n.lumiverse-loom-items {\n    color: var(--lumiverse-text);\n    line-height: 1.4;\n}\n\n/* ----------------------------------------\n   Visual Pack Browser\n   ---------------------------------------- */\n.lumiverse-pack-browser {\n    padding: 12px;\n    display: flex;\n    flex-direction: column;\n    gap: 12px;\n    height: 100%;\n}\n\n/* Stats Bar */\n.lumiverse-browser-stats {\n    display: flex;\n    justify-content: space-between;\n    padding: 10px 12px;\n    background: rgba(147, 112, 219, 0.08);\n    border-radius: 10px;\n    gap: 8px;\n}\n\n.lumiverse-browser-stat {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    flex: 1;\n}\n\n.lumiverse-browser-stat-value {\n    font-size: 16px;\n    font-weight: 700;\n    color: var(--lumiverse-primary);\n}\n\n.lumiverse-browser-stat-label {\n    font-size: 9px;\n    letter-spacing: 0.5px;\n    color: var(--lumiverse-text-muted);\n}\n\n/* Search */\n.lumiverse-pack-search {\n    display: flex;\n    align-items: center;\n    background: rgba(30, 30, 46, 0.8);\n    border: 1px solid rgba(147, 112, 219, 0.2);\n    border-radius: 8px;\n    padding: 0 12px;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-pack-search:focus-within {\n    border-color: var(--lumiverse-primary);\n    box-shadow: 0 0 0 2px rgba(147, 112, 219, 0.15);\n}\n\n.lumiverse-pack-search-icon {\n    font-size: 14px;\n    margin-right: 8px;\n    opacity: 0.6;\n}\n\n.lumiverse-pack-search-input {\n    flex: 1;\n    background: transparent;\n    border: none;\n    padding: 10px 0;\n    color: var(--lumiverse-text);\n    font-size: 13px;\n}\n\n.lumiverse-pack-search-input:focus {\n    outline: none;\n}\n\n.lumiverse-pack-search-input::placeholder {\n    color: var(--lumiverse-text-dim);\n}\n\n.lumiverse-pack-search-clear {\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    padding: 4px;\n    font-size: 12px;\n    opacity: 0.6;\n    transition: opacity 0.15s ease;\n}\n\n.lumiverse-pack-search-clear:hover {\n    opacity: 1;\n}\n\n/* Filter Tabs */\n.lumiverse-pack-filters {\n    display: flex;\n    gap: 2px;\n    padding: 4px;\n    background: rgba(30, 30, 46, 0.6);\n    border-radius: 8px;\n}\n\n.lumiverse-pack-filter {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    flex: 1;\n    min-width: 32px;\n    height: 32px;\n    background: transparent;\n    border: none;\n    border-radius: 6px;\n    cursor: pointer;\n    transition: all 0.15s ease;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-pack-filter:hover {\n    background: rgba(147, 112, 219, 0.1);\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-pack-filter--active {\n    background: rgba(147, 112, 219, 0.2);\n    color: var(--lumiverse-primary);\n}\n\n/* Filter container with toggle */\n.lumiverse-pack-filters-container {\n    display: flex;\n    gap: 8px;\n    align-items: stretch;\n}\n\n.lumiverse-pack-filters-container .lumiverse-pack-filters {\n    flex: 1;\n}\n\n/* Selected Only Toggle */\n.lumiverse-pack-filter-selected-toggle {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 4px;\n    padding: 4px 8px;\n    background: rgba(30, 30, 46, 0.6);\n    border: 1px solid transparent;\n    border-radius: 8px;\n    cursor: pointer;\n    transition: all 0.15s ease;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-pack-filter-selected-toggle:hover {\n    background: rgba(147, 112, 219, 0.15);\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-pack-filter-selected-toggle--active {\n    background: rgba(147, 112, 219, 0.25);\n    border-color: rgba(147, 112, 219, 0.4);\n    color: var(--lumiverse-primary);\n}\n\n.lumiverse-pack-filter-selected-count {\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    min-width: 16px;\n    height: 16px;\n    padding: 0 4px;\n    background: rgba(147, 112, 219, 0.3);\n    border-radius: 8px;\n    font-size: 10px;\n    font-weight: 600;\n    color: var(--lumiverse-primary);\n}\n\n.lumiverse-pack-filter-selected-toggle--active .lumiverse-pack-filter-selected-count {\n    background: rgba(147, 112, 219, 0.5);\n    color: var(--lumiverse-text);\n}\n\n/* Pack List */\n.lumiverse-browser-packs {\n    flex: 1;\n    overflow-y: auto;\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumiverse-browser-pack {\n    background: rgba(30, 30, 46, 0.6);\n    border-radius: 10px;\n    overflow: hidden;\n    border: 1px solid rgba(147, 112, 219, 0.1);\n}\n\n/* Pack Header */\n.lumiverse-browser-pack-header {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    width: 100%;\n    padding: 10px 12px;\n    background: transparent;\n    border: none;\n    cursor: pointer;\n    transition: background 0.15s ease;\n    text-align: left;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-browser-pack-header:hover {\n    background: rgba(147, 112, 219, 0.08);\n}\n\n.lumiverse-browser-pack-header--expanded {\n    background: rgba(147, 112, 219, 0.1);\n    border-bottom: 1px solid rgba(147, 112, 219, 0.15);\n}\n\n.lumiverse-browser-pack-cover {\n    width: 36px;\n    height: 36px;\n    border-radius: 6px;\n    object-fit: cover;\n    flex-shrink: 0;\n}\n\n.lumiverse-browser-pack-cover-placeholder {\n    width: 36px;\n    height: 36px;\n    border-radius: 6px;\n    background: rgba(147, 112, 219, 0.15);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 18px;\n    flex-shrink: 0;\n}\n\n.lumiverse-browser-pack-info {\n    flex: 1;\n    min-width: 0;\n    display: flex;\n    flex-direction: column;\n}\n\n.lumiverse-browser-pack-name {\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-browser-pack-meta {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n    margin-top: 2px;\n}\n\n.lumiverse-browser-pack-custom-badge {\n    font-size: 9px;\n    font-weight: 600;\n    text-transform: uppercase;\n    color: var(--lumiverse-warning);\n    background: rgba(245, 158, 11, 0.15);\n    padding: 1px 4px;\n    border-radius: 3px;\n}\n\n.lumiverse-browser-pack-chevron {\n    font-size: 10px;\n    color: var(--lumiverse-text-muted);\n    transition: transform 0.2s ease;\n}\n\n.lumiverse-browser-pack-chevron--rotated {\n    transform: rotate(180deg);\n}\n\n/* Pack Items */\n.lumiverse-browser-pack-items {\n    overflow: hidden;\n}\n\n.lumiverse-browser-items-container {\n    padding: 8px 10px;\n}\n\n.lumiverse-browser-items-container::-webkit-scrollbar {\n    width: 6px;\n}\n\n.lumiverse-browser-items-container::-webkit-scrollbar-track {\n    background: transparent;\n}\n\n.lumiverse-browser-items-container::-webkit-scrollbar-thumb {\n    background: rgba(147, 112, 219, 0.3);\n    border-radius: 3px;\n}\n\n/* Item Card */\n.lumiverse-browser-item {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 8px 10px;\n    border-radius: 6px;\n    border: 1px solid transparent;\n    cursor: pointer;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-browser-item:hover {\n    transform: translateX(2px);\n}\n\n.lumiverse-browser-item--selected {\n    box-shadow:\n        0 0 0 1px currentColor,\n        0 2px 8px rgba(0, 0, 0, 0.15);\n}\n\n.lumiverse-browser-item-check {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 18px;\n    height: 18px;\n    border-radius: 50%;\n    background: rgba(100, 200, 100, 0.9);\n    color: white;\n    margin-left: auto;\n    flex-shrink: 0;\n}\n\n.lumiverse-browser-item-image {\n    width: 32px;\n    height: 32px;\n    border-radius: 4px;\n    object-fit: cover;\n    flex-shrink: 0;\n}\n\n.lumiverse-browser-item-content {\n    flex: 1;\n    min-width: 0;\n}\n\n.lumiverse-browser-item-header {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n}\n\n.lumiverse-browser-item-icon {\n    font-size: 12px;\n}\n\n.lumiverse-browser-item-name {\n    font-size: 12px;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-browser-item-desc {\n    margin: 2px 0 0 0;\n    font-size: 10px;\n    color: var(--lumiverse-text-muted);\n    overflow: hidden;\n    text-overflow: ellipsis;\n    display: -webkit-box;\n    -webkit-line-clamp: 1;\n    -webkit-box-orient: vertical;\n}\n\n/* Empty States */\n.lumiverse-browser-empty {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    padding: 40px 20px;\n    text-align: center;\n}\n\n.lumiverse-browser-empty-icon {\n    font-size: 40px;\n    margin-bottom: 12px;\n    opacity: 0.5;\n}\n\n.lumiverse-browser-empty p {\n    margin: 0 0 4px 0;\n    font-size: 14px;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-browser-empty-hint {\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-browser-empty-items {\n    padding: 16px;\n    text-align: center;\n    color: var(--lumiverse-text-dim);\n    font-size: 12px;\n    font-style: italic;\n}\n\n/* ----------------------------------------\n   Preset Manager\n   ---------------------------------------- */\n.lumiverse-preset-manager {\n    padding: 12px;\n    display: flex;\n    flex-direction: column;\n    gap: 16px;\n}\n\n.lumiverse-preset-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    gap: 12px;\n}\n\n.lumiverse-preset-title {\n    margin: 0;\n    font-size: 14px;\n    font-weight: 600;\n    color: var(--lumiverse-text-primary);\n}\n\n.lumiverse-preset-create-btn {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    padding: 6px 12px;\n    background: rgba(147, 112, 219, 0.2);\n    border: 1px solid rgba(147, 112, 219, 0.3);\n    border-radius: 6px;\n    color: rgba(147, 112, 219, 1);\n    font-size: 12px;\n    font-weight: 500;\n    cursor: pointer;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-preset-create-btn:hover {\n    background: rgba(147, 112, 219, 0.3);\n    border-color: rgba(147, 112, 219, 0.5);\n}\n\n.lumiverse-preset-create-form {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    min-width: 0;\n    flex: 1;\n    max-width: 220px;\n}\n\n.lumiverse-preset-input {\n    flex: 1;\n    padding: 6px 10px;\n    background: rgba(30, 30, 46, 0.8);\n    border: 1px solid rgba(147, 112, 219, 0.3);\n    border-radius: 6px;\n    color: var(--lumiverse-text-primary);\n    font-size: 12px;\n    min-width: 0;\n    width: 100%;\n}\n\n/* Responsive: preset form on small screens */\n@media (max-width: 380px) {\n    .lumiverse-preset-header {\n        flex-wrap: wrap;\n        gap: 8px;\n    }\n\n    .lumiverse-preset-create-form {\n        width: 100%;\n        max-width: none;\n        order: 1;\n    }\n\n    .lumiverse-preset-title {\n        flex: 1;\n    }\n}\n\n.lumiverse-preset-input:focus {\n    outline: none;\n    border-color: rgba(147, 112, 219, 0.6);\n}\n\n.lumiverse-preset-input::placeholder {\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-preset-list {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n}\n\n.lumiverse-preset-card {\n    background: rgba(30, 30, 46, 0.6);\n    border: 1px solid rgba(255, 255, 255, 0.08);\n    border-radius: 10px;\n    padding: 12px;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-preset-card:hover {\n    background: rgba(30, 30, 46, 0.8);\n    border-color: rgba(147, 112, 219, 0.2);\n}\n\n.lumiverse-preset-card--active {\n    border-color: rgba(147, 112, 219, 0.4);\n    background: rgba(147, 112, 219, 0.08);\n}\n\n.lumiverse-preset-card-header {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    margin-bottom: 8px;\n}\n\n.lumiverse-preset-card-icon {\n    color: rgba(147, 112, 219, 0.8);\n}\n\n.lumiverse-preset-card-name {\n    flex: 1;\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--lumiverse-text-primary);\n}\n\n.lumiverse-preset-card-active-badge {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    padding: 2px 8px;\n    background: rgba(147, 112, 219, 0.2);\n    border-radius: 10px;\n    font-size: 10px;\n    font-weight: 500;\n    color: rgba(147, 112, 219, 1);\n}\n\n.lumiverse-preset-card-meta {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    margin-bottom: 10px;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-preset-card-traits {\n    color: var(--lumiverse-text-secondary);\n}\n\n/* Preset stats with icons */\n.lumiverse-preset-stats {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n}\n\n.lumiverse-preset-stat {\n    display: flex;\n    align-items: center;\n    gap: 3px;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-preset-stat svg {\n    opacity: 0.7;\n}\n\n.lumiverse-preset-stat--chimera {\n    color: rgba(100, 200, 255, 0.9);\n}\n\n.lumiverse-preset-stat--chimera svg {\n    color: rgba(100, 200, 255, 0.9);\n    opacity: 1;\n}\n\n.lumiverse-preset-stat--council {\n    color: rgba(147, 112, 219, 0.9);\n}\n\n.lumiverse-preset-stat--council svg {\n    color: rgba(147, 112, 219, 0.9);\n    opacity: 1;\n}\n\n.lumiverse-preset-card-mode {\n    padding: 2px 6px;\n    background: rgba(255, 193, 7, 0.15);\n    border-radius: 4px;\n    font-size: 10px;\n    color: rgba(255, 193, 7, 0.9);\n}\n\n.lumiverse-preset-card-time {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    margin-left: auto;\n}\n\n.lumiverse-preset-card-actions {\n    display: flex;\n    gap: 6px;\n}\n\n.lumiverse-preset-btn {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    padding: 6px 10px;\n    background: rgba(255, 255, 255, 0.06);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    border-radius: 6px;\n    color: var(--lumiverse-text-secondary);\n    font-size: 12px;\n    font-weight: 500;\n    cursor: pointer;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-preset-btn:hover {\n    background: rgba(255, 255, 255, 0.1);\n    color: var(--lumiverse-text-primary);\n}\n\n.lumiverse-preset-btn--primary {\n    background: rgba(147, 112, 219, 0.2);\n    border-color: rgba(147, 112, 219, 0.3);\n    color: rgba(147, 112, 219, 1);\n}\n\n.lumiverse-preset-btn--primary:hover {\n    background: rgba(147, 112, 219, 0.3);\n    border-color: rgba(147, 112, 219, 0.5);\n}\n\n.lumiverse-preset-btn--primary:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n}\n\n.lumiverse-preset-btn--danger {\n    color: rgba(255, 100, 100, 0.8);\n}\n\n.lumiverse-preset-btn--danger:hover {\n    background: rgba(255, 100, 100, 0.15);\n    border-color: rgba(255, 100, 100, 0.3);\n    color: rgba(255, 100, 100, 1);\n}\n\n.lumiverse-preset-btn--confirming {\n    background: rgba(255, 100, 100, 0.2);\n    border-color: rgba(255, 100, 100, 0.4);\n    color: rgba(255, 100, 100, 1);\n}\n\n.lumiverse-preset-empty {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    padding: 32px 16px;\n    text-align: center;\n}\n\n.lumiverse-preset-empty-icon {\n    margin-bottom: 12px;\n    color: var(--lumiverse-text-muted);\n    opacity: 0.5;\n}\n\n.lumiverse-preset-empty h4 {\n    margin: 0 0 8px 0;\n    font-size: 14px;\n    font-weight: 600;\n    color: var(--lumiverse-text-primary);\n}\n\n.lumiverse-preset-empty p {\n    margin: 0;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n    max-width: 240px;\n}\n\n.lumiverse-preset-help {\n    padding: 10px;\n    background: rgba(30, 30, 46, 0.4);\n    border-radius: 8px;\n}\n\n.lumiverse-preset-help p {\n    margin: 0;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n    line-height: 1.5;\n}\n\n/* ----------------------------------------\n   OOC Analytics Dashboard\n   ---------------------------------------- */\n.lumiverse-ooc-analytics {\n    padding: 12px;\n    display: flex;\n    flex-direction: column;\n    gap: 16px;\n}\n\n.lumiverse-analytics-section {\n    background: rgba(30, 30, 46, 0.6);\n    border-radius: 10px;\n    padding: 12px;\n}\n\n.lumiverse-analytics-section-title {\n    margin: 0 0 12px 0;\n    font-size: 11px;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    color: var(--lumiverse-text-muted);\n}\n\n/* Stats Grid */\n.lumiverse-analytics-stats-grid {\n    display: grid;\n    grid-template-columns: repeat(2, 1fr);\n    gap: 8px;\n}\n\n.lumiverse-analytics-stat {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 10px 12px;\n    background: rgba(147, 112, 219, 0.08);\n    border-radius: 8px;\n    border: 1px solid rgba(147, 112, 219, 0.15);\n}\n\n.lumiverse-analytics-stat-icon {\n    font-size: 20px;\n    flex-shrink: 0;\n}\n\n.lumiverse-analytics-stat-info {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n}\n\n.lumiverse-analytics-stat-value {\n    font-size: 18px;\n    font-weight: 700;\n    color: var(--lumiverse-primary);\n}\n\n.lumiverse-analytics-stat-label {\n    font-size: 10px;\n    color: var(--lumiverse-text-muted);\n    text-transform: uppercase;\n    letter-spacing: 0.3px;\n}\n\n.lumiverse-analytics-stat-trend {\n    font-size: 14px;\n    padding: 2px 6px;\n    border-radius: 4px;\n    background: rgba(147, 112, 219, 0.15);\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-analytics-stat-trend--up {\n    background: rgba(34, 197, 94, 0.15);\n    color: var(--lumiverse-success);\n}\n\n.lumiverse-analytics-stat-trend--down {\n    background: rgba(239, 68, 68, 0.15);\n    color: var(--lumiverse-danger);\n}\n\n/* Type Distribution */\n.lumiverse-analytics-distribution {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumiverse-analytics-bars {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n}\n\n.lumiverse-analytics-bar-item {\n    display: flex;\n    flex-direction: column;\n    gap: 4px;\n}\n\n.lumiverse-analytics-bar-label {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    font-size: 12px;\n}\n\n.lumiverse-analytics-bar-icon {\n    font-size: 12px;\n}\n\n.lumiverse-analytics-bar-name {\n    flex: 1;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-analytics-bar-count {\n    color: var(--lumiverse-text-muted);\n    font-weight: 600;\n}\n\n.lumiverse-analytics-bar-track {\n    height: 6px;\n    background: rgba(147, 112, 219, 0.1);\n    border-radius: 3px;\n    overflow: hidden;\n}\n\n.lumiverse-analytics-bar-fill {\n    height: 100%;\n    border-radius: 3px;\n    transition: width 0.5s ease-out;\n}\n\n/* Insights */\n.lumiverse-analytics-insights {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumiverse-analytics-insight {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 10px 12px;\n    background: rgba(147, 112, 219, 0.05);\n    border-radius: 8px;\n}\n\n.lumiverse-analytics-insight-icon {\n    font-size: 18px;\n    flex-shrink: 0;\n}\n\n.lumiverse-analytics-insight-content {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n}\n\n.lumiverse-analytics-insight-title {\n    font-size: 10px;\n    color: var(--lumiverse-text-muted);\n    text-transform: uppercase;\n    letter-spacing: 0.3px;\n}\n\n.lumiverse-analytics-insight-value {\n    font-size: 14px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-analytics-insight-desc {\n    font-size: 11px;\n    color: var(--lumiverse-text-dim);\n}\n\n/* Timeline */\n.lumiverse-analytics-timeline {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumiverse-analytics-comment {\n    display: flex;\n    align-items: flex-start;\n    gap: 10px;\n    padding: 8px 10px;\n    background: rgba(147, 112, 219, 0.05);\n    border-radius: 6px;\n    border-left: 2px solid var(--lumiverse-primary);\n}\n\n.lumiverse-analytics-comment-icon {\n    font-size: 14px;\n    flex-shrink: 0;\n    margin-top: 2px;\n}\n\n.lumiverse-analytics-comment-content {\n    flex: 1;\n    min-width: 0;\n}\n\n.lumiverse-analytics-comment-text {\n    margin: 0;\n    font-size: 12px;\n    color: var(--lumiverse-text);\n    line-height: 1.4;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    display: -webkit-box;\n    -webkit-line-clamp: 2;\n    -webkit-box-orient: vertical;\n}\n\n.lumiverse-analytics-comment-time {\n    font-size: 10px;\n    color: var(--lumiverse-text-dim);\n}\n\n/* Quick Controls */\n.lumiverse-analytics-controls {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n/* Empty state */\n.lumiverse-analytics-empty {\n    padding: 20px;\n    text-align: center;\n    color: var(--lumiverse-text-dim);\n    font-size: 12px;\n    font-style: italic;\n}\n\n/* ----------------------------------------\n   Panel Toggle Button\n   ---------------------------------------- */\n.lumiverse-panel-toggle {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    padding: 8px 14px;\n    background: linear-gradient(135deg, rgba(147, 112, 219, 0.95) 0%, rgba(123, 88, 195, 0.95) 100%);\n    border: 1px solid rgba(255, 255, 255, 0.2);\n    border-radius: 20px;\n    cursor: pointer;\n    box-shadow: 0 4px 12px rgba(147, 112, 219, 0.4), 0 0 20px rgba(147, 112, 219, 0.2);\n    white-space: nowrap;\n    transition: box-shadow 0.15s ease, border-color 0.15s ease;\n}\n\n.lumiverse-panel-toggle:hover {\n    box-shadow: 0 4px 16px rgba(147, 112, 219, 0.6), 0 0 35px rgba(147, 112, 219, 0.4);\n    border-color: rgba(255, 255, 255, 0.35);\n}\n\n.lumiverse-panel-toggle--active {\n    background: linear-gradient(135deg, rgba(100, 80, 180, 0.95) 0%, rgba(80, 60, 160, 0.95) 100%);\n    /* Position is now controlled by transform (x) for sync with panel animation */\n}\n\n.lumiverse-panel-toggle-icon {\n    font-size: 16px;\n    line-height: 1;\n}\n\n.lumiverse-panel-toggle-label {\n    font-size: 12px;\n    font-weight: 600;\n    color: white;\n    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);\n}\n\n/* ----------------------------------------\n   Viewport Panel - Settings Panels\n   ---------------------------------------- */\n\n/* General settings panel styles */\n.lumiverse-vp-settings-panel {\n    padding: 16px;\n    display: flex;\n    flex-direction: column;\n    gap: 16px;\n}\n\n.lumiverse-vp-settings-section {\n    background: rgba(147, 112, 219, 0.05);\n    border: 1px solid rgba(147, 112, 219, 0.15);\n    border-radius: 10px;\n    padding: 14px;\n}\n\n.lumiverse-vp-settings-section-header {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    margin-bottom: 10px;\n    color: var(--lumiverse-text);\n    font-weight: 600;\n    font-size: 13px;\n}\n\n.lumiverse-vp-settings-desc {\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n    margin: 0 0 12px 0;\n    line-height: 1.4;\n}\n\n/* Toggle row */\n.lumiverse-vp-toggle-row {\n    display: flex;\n    align-items: flex-start;\n    justify-content: space-between;\n    padding: 8px 0;\n    gap: 12px;\n}\n\n.lumiverse-vp-toggle-label {\n    flex: 1;\n    cursor: pointer;\n}\n\n.lumiverse-vp-toggle-text {\n    display: block;\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-vp-toggle-hint {\n    display: block;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n    margin-top: 2px;\n}\n\n.lumiverse-vp-toggle-switch-wrapper {\n    flex-shrink: 0;\n}\n\n.lumiverse-vp-toggle-input {\n    display: none !important;\n    position: absolute !important;\n    opacity: 0 !important;\n    width: 0 !important;\n    height: 0 !important;\n    pointer-events: none !important;\n}\n\n.lumiverse-vp-toggle-track {\n    position: relative;\n    width: 40px;\n    height: 22px;\n    background: var(--lumiverse-secondary);\n    border-radius: 11px;\n    cursor: pointer;\n    transition: background 0.2s ease;\n}\n\n.lumiverse-vp-toggle-track--on {\n    background: var(--lumiverse-primary);\n}\n\n.lumiverse-vp-toggle-thumb {\n    position: absolute;\n    top: 2px;\n    left: 2px;\n    width: 18px;\n    height: 18px;\n    background: white;\n    border-radius: 50%;\n    transition: transform 0.2s ease;\n}\n\n.lumiverse-vp-toggle-track--on .lumiverse-vp-toggle-thumb {\n    transform: translateX(18px);\n}\n\n/* Disabled toggle states */\n.lumiverse-vp-toggle-row--disabled {\n    opacity: 0.5;\n    pointer-events: none;\n}\n\n.lumiverse-vp-toggle-row--disabled .lumiverse-vp-toggle-label {\n    cursor: not-allowed;\n}\n\n.lumiverse-vp-toggle-track--disabled {\n    background: var(--lumiverse-bg-dark) !important;\n    cursor: not-allowed;\n}\n\n.lumiverse-vp-toggle-track--disabled .lumiverse-vp-toggle-thumb {\n    background: rgba(255, 255, 255, 0.5);\n}\n\n/* Field input */\n.lumiverse-vp-field {\n    margin-bottom: 12px;\n}\n\n.lumiverse-vp-field--inline {\n    display: flex;\n    flex-wrap: wrap;\n    align-items: center;\n    gap: 8px;\n}\n\n.lumiverse-vp-field-label {\n    display: block;\n    font-size: 12px;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n    margin-bottom: 6px;\n}\n\n.lumiverse-vp-field--inline .lumiverse-vp-field-label {\n    margin-bottom: 0;\n    flex: 1;\n}\n\n.lumiverse-vp-field-input {\n    width: 100%;\n    padding: 8px 12px;\n    background: var(--lumiverse-bg);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 6px;\n    color: var(--lumiverse-text);\n    font-size: 13px;\n    transition: border-color 0.2s ease;\n}\n\n.lumiverse-vp-field-input:focus {\n    outline: none;\n    border-color: var(--lumiverse-primary);\n}\n\n.lumiverse-vp-field-input--small {\n    width: 70px;\n    text-align: center;\n}\n\n.lumiverse-vp-field-hint {\n    display: block;\n    font-size: 11px;\n    color: var(--lumiverse-text-dim);\n    margin-top: 4px;\n}\n\n.lumiverse-vp-field--inline .lumiverse-vp-field-hint {\n    flex-basis: 100%;\n}\n\n/* Style options (radio buttons) */\n.lumiverse-vp-style-options {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumiverse-vp-style-option {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 12px 14px;\n    background: var(--lumiverse-bg);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 8px;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-vp-style-option:hover {\n    border-color: var(--lumiverse-border-light);\n    background: var(--lumiverse-bg-hover);\n}\n\n.lumiverse-vp-style-option--selected {\n    border-color: var(--lumiverse-primary);\n    background: rgba(147, 112, 219, 0.1);\n}\n\n.lumiverse-vp-style-option input[type="radio"] {\n    display: none !important;\n    position: absolute !important;\n    opacity: 0 !important;\n    width: 0 !important;\n    height: 0 !important;\n    pointer-events: none !important;\n}\n\n.lumiverse-vp-style-option-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 32px;\n    height: 32px;\n    background: rgba(147, 112, 219, 0.15);\n    border-radius: 6px;\n    color: var(--lumiverse-primary);\n}\n\n.lumiverse-vp-style-option-text {\n    flex: 1;\n}\n\n.lumiverse-vp-style-option-title {\n    display: block;\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-vp-style-option-desc {\n    display: block;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n    margin-top: 2px;\n    line-height: 1.3;\n}\n\n/* Save button */\n.lumiverse-vp-save-btn {\n    width: 100%;\n    padding: 10px 16px;\n    background: var(--lumiverse-primary);\n    border: none;\n    border-radius: 8px;\n    color: white;\n    font-size: 13px;\n    font-weight: 600;\n    cursor: pointer;\n    transition: background 0.2s ease;\n}\n\n.lumiverse-vp-save-btn:hover {\n    background: var(--lumiverse-primary-hover);\n}\n\n/* Collapsible sections */\n.lumiverse-vp-collapsible {\n    background: rgba(147, 112, 219, 0.05);\n    border: 1px solid rgba(147, 112, 219, 0.15);\n    border-radius: 10px;\n    overflow: hidden;\n}\n\n.lumiverse-vp-collapsible-header {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    width: 100%;\n    padding: 12px 14px;\n    background: transparent;\n    border: none;\n    cursor: pointer;\n    color: var(--lumiverse-text);\n    font-size: 13px;\n    font-weight: 600;\n    text-align: left;\n    transition: background 0.2s ease;\n}\n\n.lumiverse-vp-collapsible-header:hover {\n    background: rgba(147, 112, 219, 0.08);\n}\n\n.lumiverse-vp-collapsible-chevron {\n    display: flex;\n    color: var(--lumiverse-text-muted);\n    transition: transform 0.2s ease;\n}\n\n.lumiverse-vp-collapsible-chevron--open {\n    transform: rotate(180deg);\n}\n\n.lumiverse-vp-collapsible-icon {\n    display: flex;\n    color: var(--lumiverse-primary);\n}\n\n.lumiverse-vp-collapsible-title {\n    flex: 1;\n}\n\n.lumiverse-vp-collapsible-status {\n    padding: 2px 8px;\n    background: rgba(100, 100, 100, 0.2);\n    border-radius: 10px;\n    font-size: 10px;\n    font-weight: 600;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-vp-collapsible-status--active {\n    background: rgba(34, 197, 94, 0.2);\n    color: var(--lumiverse-success);\n}\n\n.lumiverse-vp-collapsible-content {\n    overflow: hidden;\n}\n\n.lumiverse-vp-collapsible-inner {\n    padding: 12px 14px 14px 14px;\n}\n\n/* Info box */\n.lumiverse-vp-info-box {\n    background: rgba(147, 112, 219, 0.08);\n    border: 1px solid rgba(147, 112, 219, 0.2);\n    border-radius: 8px;\n    padding: 12px;\n    margin-top: 12px;\n}\n\n.lumiverse-vp-info-box--muted {\n    opacity: 0.5;\n}\n\n.lumiverse-vp-info-box-header {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    font-size: 11px;\n    font-weight: 600;\n    color: var(--lumiverse-primary);\n    margin-bottom: 8px;\n}\n\n.lumiverse-vp-info-box-list {\n    margin: 0;\n    padding: 0 0 0 16px;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n    line-height: 1.5;\n}\n\n.lumiverse-vp-info-box-list code {\n    background: rgba(147, 112, 219, 0.15);\n    padding: 1px 4px;\n    border-radius: 3px;\n    font-size: 10px;\n}\n\n/* Filter items */\n.lumiverse-vp-filter-item {\n    padding: 8px 0;\n    border-bottom: 1px solid rgba(147, 112, 219, 0.1);\n}\n\n.lumiverse-vp-filter-item:last-child {\n    border-bottom: none;\n}\n\n.lumiverse-vp-filter-options {\n    padding: 8px 0 0 24px;\n    overflow: hidden;\n}\n\n.lumiverse-vp-filter-sub {\n    padding-left: 16px;\n    border-left: 2px solid rgba(147, 112, 219, 0.2);\n    margin-left: 8px;\n}\n\n/* ----------------------------------------\n   Viewport Panel - Summary Editor\n   ---------------------------------------- */\n.lumiverse-vp-summary-editor {\n    display: flex;\n    flex-direction: column;\n    height: 100%;\n    padding: 12px;\n    gap: 12px;\n}\n\n.lumiverse-vp-summary-status {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    padding: 10px 12px;\n    border-radius: 8px;\n    font-size: 12px;\n    font-weight: 500;\n}\n\n.lumiverse-vp-summary-status--exists {\n    background: rgba(34, 197, 94, 0.1);\n    border: 1px solid rgba(34, 197, 94, 0.3);\n    color: var(--lumiverse-success);\n}\n\n.lumiverse-vp-summary-status--empty {\n    background: rgba(245, 158, 11, 0.1);\n    border: 1px solid rgba(245, 158, 11, 0.3);\n    color: var(--lumiverse-warning);\n}\n\n.lumiverse-vp-summary-status--no-chat {\n    background: rgba(100, 100, 100, 0.1);\n    border: 1px solid rgba(100, 100, 100, 0.3);\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-vp-summary-textarea-wrapper {\n    flex: 1;\n    min-height: 200px;\n    margin-bottom: 4px;\n    overflow: hidden;\n}\n\n.lumiverse-vp-summary-textarea {\n    width: 100%;\n    height: 100%;\n    min-height: 200px;\n    padding: 12px;\n    background: var(--lumiverse-bg);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 8px;\n    color: var(--lumiverse-text);\n    font-size: 12px;\n    font-family: inherit;\n    line-height: 1.5;\n    resize: none;\n    transition: border-color 0.2s ease;\n}\n\n.lumiverse-vp-summary-textarea:focus {\n    outline: none;\n    border-color: var(--lumiverse-primary);\n}\n\n.lumiverse-vp-summary-textarea::placeholder {\n    color: var(--lumiverse-text-dim);\n}\n\n.lumiverse-vp-summary-textarea:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n}\n\n.lumiverse-vp-summary-actions {\n    display: flex;\n    gap: 10px;\n    justify-content: center;\n    margin-top: 12px;\n    padding-top: 4px;\n}\n\n.lumiverse-vp-action-btn {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 6px;\n    padding: 8px 12px;\n    min-height: 36px;\n    border: none;\n    border-radius: 6px;\n    font-size: 12px;\n    font-weight: 500;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n/* Icon-only button mode */\n.lumiverse-vp-action-btn--icon-only {\n    padding: 10px 12px;\n    min-width: 44px;\n    width: 44px;\n    height: 40px;\n    flex: 1;\n    max-width: 56px;\n}\n\n.lumiverse-vp-action-btn--secondary {\n    background: var(--lumiverse-bg-elevated);\n    color: var(--lumiverse-text);\n    border: 1px solid var(--lumiverse-border);\n}\n\n.lumiverse-vp-action-btn--secondary:hover {\n    background: var(--lumiverse-bg-hover);\n}\n\n.lumiverse-vp-action-btn--primary {\n    background: var(--lumiverse-primary);\n    color: white;\n}\n\n.lumiverse-vp-action-btn--primary:hover {\n    background: var(--lumiverse-primary-hover);\n}\n\n.lumiverse-vp-action-btn--danger {\n    background: transparent;\n    color: var(--lumiverse-danger);\n    border: 1px solid var(--lumiverse-danger);\n}\n\n.lumiverse-vp-action-btn--danger:hover {\n    background: rgba(239, 68, 68, 0.1);\n}\n\n.lumiverse-vp-action-btn--disabled {\n    opacity: 0.4;\n    cursor: not-allowed;\n}\n\n.lumiverse-vp-summary-unsaved {\n    text-align: center;\n    font-size: 11px;\n    color: var(--lumiverse-warning);\n    padding: 4px;\n}\n\n/* Action button spinner */\n.lumiverse-vp-action-btn-spinner {\n    width: 14px;\n    height: 14px;\n    border: 2px solid rgba(255, 255, 255, 0.3);\n    border-top-color: white;\n    border-radius: 50%;\n    animation: lumiverse-spin 0.8s linear infinite;\n}\n\n.lumiverse-vp-action-btn--icon-only .lumiverse-vp-action-btn-spinner {\n    width: 16px;\n    height: 16px;\n}\n\n@keyframes lumiverse-spin {\n    to { transform: rotate(360deg); }\n}\n\n/* Summary config section */\n.lumiverse-vp-summary-config {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n}\n\n/* Radio group */\n.lumiverse-vp-radio-group {\n    display: flex;\n    gap: 8px;\n    flex-wrap: wrap;\n}\n\n.lumiverse-vp-radio-group--wide .lumiverse-vp-radio-option {\n    flex: 1;\n    min-width: 100px;\n}\n\n.lumiverse-vp-radio-option {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    padding: 8px 14px;\n    background: var(--lumiverse-bg);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 6px;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-vp-radio-option:hover {\n    border-color: var(--lumiverse-border-hover);\n    background: var(--lumiverse-bg-hover);\n}\n\n.lumiverse-vp-radio-option--selected {\n    border-color: var(--lumiverse-primary);\n    background: rgba(147, 112, 219, 0.15);\n}\n\n.lumiverse-vp-radio-option input[type="radio"] {\n    display: none !important;\n    position: absolute !important;\n    opacity: 0 !important;\n    width: 0 !important;\n    height: 0 !important;\n    pointer-events: none !important;\n}\n\n.lumiverse-vp-radio-option-label {\n    font-size: 12px;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n}\n\n/* Field rows */\n.lumiverse-vp-field-row {\n    display: flex;\n    gap: 12px;\n}\n\n.lumiverse-vp-field-row .lumiverse-vp-field {\n    flex: 1;\n}\n\n.lumiverse-vp-field-row--3 .lumiverse-vp-field {\n    flex: 1;\n    min-width: 0;\n}\n\n/* Select field */\n.lumiverse-vp-field-select {\n    width: 100%;\n    padding: 8px 12px;\n    background: var(--lumiverse-bg);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 6px;\n    color: var(--lumiverse-text);\n    font-size: 12px;\n    cursor: pointer;\n    transition: border-color 0.2s ease;\n    appearance: none;\n    background-image: url(${d});\n    background-repeat: no-repeat;\n    background-position: right 10px center;\n    padding-right: 30px;\n}\n\n.lumiverse-vp-field-select:focus {\n    outline: none;\n    border-color: var(--lumiverse-primary);\n}\n\n.lumiverse-vp-field-select option {\n    background: var(--lumiverse-bg);\n    color: var(--lumiverse-text);\n}\n\n/* Warning box */\n.lumiverse-vp-warning-box {\n    display: flex;\n    align-items: flex-start;\n    gap: 8px;\n    padding: 10px 12px;\n    margin-top: 10px;\n    background: rgba(245, 158, 11, 0.1);\n    border: 1px solid rgba(245, 158, 11, 0.3);\n    border-radius: 6px;\n    font-size: 11px;\n    color: var(--lumiverse-warning);\n    line-height: 1.4;\n}\n\n.lumiverse-vp-warning-box svg {\n    flex-shrink: 0;\n    margin-top: 1px;\n}\n\n/* Settings description */\n.lumiverse-vp-settings-desc {\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n    margin: 8px 0 0 0;\n    line-height: 1.4;\n}\n\n/* ============================================\n   LUMIA MODAL SYSTEM\n   Card-based selection modal design\n   ============================================ */\n\n/* Modal Backdrop */\n.lumia-modal-backdrop {\n    position: fixed;\n    inset: 0;\n    background: rgba(0, 0, 0, 0.5);\n    z-index: 9998;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    animation: lumia-backdrop-fadein 0.15s ease-out;\n}\n\n@keyframes lumia-backdrop-fadein {\n    from { opacity: 0; }\n    to { opacity: 1; }\n}\n\n/* Modal Container */\n.lumia-modal {\n    font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", sans-serif;\n    background: linear-gradient(\n        165deg,\n        rgba(22, 18, 32, 0.98) 0%,\n        rgba(28, 24, 40, 0.98) 100%\n    );\n    border: 1px solid rgba(147, 112, 219, 0.2);\n    border-radius: 16px;\n    box-shadow:\n        0 24px 80px rgba(0, 0, 0, 0.5),\n        0 0 1px rgba(147, 112, 219, 0.3);\n    padding: 0;\n    overflow: hidden;\n    display: flex;\n    flex-direction: column;\n    max-height: 85vh;\n    max-height: 85dvh;\n    height: auto;\n    width: 90vw;\n    max-width: 600px;\n    z-index: 9999;\n    /* Ensure flex children don't overflow */\n    min-height: 0;\n}\n\n/* Selection Modal Variant (wider for cards) */\n.lumia-modal-selection {\n    max-width: 700px;\n}\n\n/* Settings Modal Variant */\n.lumia-modal-settings {\n    max-width: 520px;\n}\n\n/* Modal Selection Content Wrapper */\n.lumia-modal-selection-content {\n    display: flex;\n    flex-direction: column;\n    height: 100%;\n    min-height: 0; /* Allow flex children to shrink properly */\n    overflow: hidden; /* Let child scroll container handle overflow */\n}\n\n/* Modal Header - Inner (for modals with custom headers) */\n.lumia-modal-header-inner {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n    padding: 18px 20px;\n    background: linear-gradient(\n        180deg,\n        rgba(147, 112, 219, 0.1) 0%,\n        transparent 100%\n    );\n    border-bottom: 1px solid rgba(147, 112, 219, 0.12);\n    flex-shrink: 0;\n}\n\n.lumia-modal-header-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 36px;\n    height: 36px;\n    background: linear-gradient(\n        135deg,\n        rgba(147, 112, 219, 0.2) 0%,\n        rgba(147, 112, 219, 0.1) 100%\n    );\n    border-radius: 10px;\n    border: 1px solid rgba(147, 112, 219, 0.2);\n}\n\n.lumia-modal-header-icon svg {\n    width: 20px;\n    height: 20px;\n    stroke: rgba(186, 135, 255, 0.9);\n}\n\n.lumia-modal-header-text {\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n    flex: 1;\n    min-width: 0;\n}\n\n.lumia-modal-title {\n    font-size: 17px;\n    font-weight: 600;\n    color: rgba(255, 255, 255, 0.95);\n    letter-spacing: -0.2px;\n    margin: 0;\n    padding: 0;\n}\n\n.lumia-modal-subtitle {\n    font-size: 12px;\n    font-weight: 400;\n    color: rgba(255, 255, 255, 0.5);\n    margin: 0;\n    letter-spacing: 0.1px;\n}\n\n/* Clear Button */\n.lumia-clear-btn {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    padding: 8px 14px;\n    background: rgba(128, 128, 128, 0.1);\n    border: 1px solid rgba(128, 128, 128, 0.25);\n    border-radius: 8px;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    font-family: inherit;\n    font-size: 12px;\n    font-weight: 500;\n    color: rgba(255, 255, 255, 0.7);\n    flex-shrink: 0;\n    margin-left: auto;\n}\n\n.lumia-clear-btn svg {\n    width: 16px;\n    height: 16px;\n    stroke: rgba(255, 255, 255, 0.6);\n}\n\n.lumia-clear-btn:hover {\n    background: rgba(244, 67, 54, 0.15);\n    border-color: rgba(244, 67, 54, 0.4);\n    color: rgba(244, 67, 54, 0.95);\n}\n\n.lumia-clear-btn:hover svg {\n    stroke: rgba(244, 67, 54, 0.95);\n}\n\n/* Modal Content Area */\n.lumia-modal-content {\n    padding: 20px;\n    display: block;\n    flex: 1 1 auto;\n    overflow-y: auto;\n    overflow-x: hidden;\n    min-height: 0;\n}\n\n.lumia-modal-content > * + * {\n    margin-top: 16px;\n}\n\n/* Custom scrollbar for modal content */\n.lumia-modal-content::-webkit-scrollbar {\n    width: 8px;\n}\n\n.lumia-modal-content::-webkit-scrollbar-track {\n    background: rgba(0, 0, 0, 0.2);\n    border-radius: 4px;\n}\n\n.lumia-modal-content::-webkit-scrollbar-thumb {\n    background: rgba(147, 112, 219, 0.3);\n    border-radius: 4px;\n}\n\n.lumia-modal-content::-webkit-scrollbar-thumb:hover {\n    background: rgba(147, 112, 219, 0.5);\n}\n\n/* Modal Panel */\n.lumia-modal-panel {\n    background: rgba(0, 0, 0, 0.2);\n    border: 1px solid rgba(128, 128, 128, 0.12);\n    border-radius: 12px;\n    overflow: visible;\n}\n\n.lumia-modal-panel-header {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 12px 14px;\n    background: rgba(255, 255, 255, 0.02);\n    border-bottom: 1px solid rgba(128, 128, 128, 0.08);\n}\n\n.lumia-modal-panel-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 18px;\n    height: 18px;\n}\n\n.lumia-modal-panel-icon svg {\n    width: 16px;\n    height: 16px;\n    stroke: rgba(147, 112, 219, 0.7);\n}\n\n.lumia-modal-panel-title {\n    font-size: 12px;\n    font-weight: 600;\n    color: rgba(255, 255, 255, 0.8);\n    letter-spacing: 0.1px;\n}\n\n.lumia-modal-panel-count {\n    font-size: 11px;\n    font-weight: 500;\n    color: rgba(147, 112, 219, 0.7);\n    background: rgba(147, 112, 219, 0.1);\n    padding: 4px 8px;\n    border-radius: 10px;\n    flex-shrink: 0;\n}\n\n.lumia-modal-panel-content {\n    padding: 16px;\n    display: flex;\n    flex-direction: column;\n    gap: 14px;\n}\n\n.lumia-modal-panel-content-cards {\n    padding: 12px;\n}\n\n/* Modal Empty State */\n.lumia-modal-empty {\n    padding: 40px 20px;\n    text-align: center;\n    color: rgba(255, 255, 255, 0.4);\n    font-size: 14px;\n}\n\n/* Modal Footer - Pinned to bottom */\n.lumia-modal-footer {\n    display: flex;\n    justify-content: flex-end;\n    gap: 10px;\n    padding: 16px 20px;\n    background: rgba(22, 18, 32, 0.98);\n    border-top: 1px solid rgba(128, 128, 128, 0.15);\n    flex-shrink: 0;\n    margin-top: auto;\n    position: sticky;\n    bottom: 0;\n    z-index: 10;\n    /* Subtle shadow to indicate floating */\n    box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.3);\n}\n\n/* Modal Buttons */\n.lumia-modal-btn {\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    gap: 8px;\n    padding: 10px 20px;\n    border: none;\n    border-radius: 8px;\n    font-size: 13px;\n    font-weight: 500;\n    font-family: inherit;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumia-modal-btn svg {\n    width: 16px;\n    height: 16px;\n}\n\n.lumia-modal-btn-primary {\n    background: linear-gradient(\n        135deg,\n        rgba(147, 112, 219, 0.9) 0%,\n        rgba(123, 95, 196, 0.9) 100%\n    );\n    color: white;\n}\n\n.lumia-modal-btn-primary:hover {\n    background: linear-gradient(\n        135deg,\n        rgba(167, 132, 239, 0.95) 0%,\n        rgba(143, 115, 216, 0.95) 100%\n    );\n    transform: translateY(-1px);\n}\n\n.lumia-modal-btn-secondary {\n    background: rgba(128, 128, 128, 0.15);\n    border: 1px solid rgba(128, 128, 128, 0.2);\n    color: rgba(255, 255, 255, 0.75);\n}\n\n.lumia-modal-btn-secondary:hover {\n    background: rgba(128, 128, 128, 0.25);\n    color: rgba(255, 255, 255, 0.9);\n}\n\n/* Collapsible Panel Styles */\n.lumia-collapsible-trigger {\n    cursor: pointer;\n    user-select: none;\n}\n\n.lumia-panel-collapse-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 16px;\n    height: 16px;\n    flex-shrink: 0;\n    transition: transform 0.2s ease;\n}\n\n.lumia-panel-collapse-icon svg {\n    width: 14px;\n    height: 14px;\n    stroke: rgba(255, 255, 255, 0.4);\n}\n\n.lumia-collapsible.collapsed .lumia-panel-collapse-icon {\n    transform: rotate(-90deg);\n}\n\n.lumia-collapsible-content {\n    display: grid;\n    grid-template-rows: 1fr;\n    transition:\n        grid-template-rows 0.25s ease,\n        opacity 0.2s ease,\n        padding 0.25s ease;\n    opacity: 1;\n}\n\n.lumia-collapsible-content > * {\n    overflow: hidden;\n}\n\n.lumia-collapsible.collapsed .lumia-collapsible-content {\n    grid-template-rows: 0fr;\n    opacity: 0;\n    padding-top: 0;\n    padding-bottom: 0;\n}\n\n/* Custom Pack Badge */\n.lumia-pack-badge-custom {\n    font-size: 10px;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    color: rgba(147, 112, 219, 0.9);\n    background: rgba(147, 112, 219, 0.15);\n    padding: 3px 8px;\n    border-radius: 6px;\n    border: 1px solid rgba(147, 112, 219, 0.25);\n}\n\n/* Icon Button Small */\n.lumia-icon-btn-sm {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 28px;\n    height: 28px;\n    padding: 0;\n    background: transparent;\n    border: 1px solid transparent;\n    border-radius: 6px;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    margin-left: auto;\n}\n\n.lumia-icon-btn-sm svg {\n    width: 16px;\n    height: 16px;\n    stroke: rgba(255, 255, 255, 0.4);\n}\n\n.lumia-icon-btn-sm:hover {\n    background: rgba(244, 67, 54, 0.15);\n    border-color: rgba(244, 67, 54, 0.3);\n}\n\n.lumia-icon-btn-sm:hover svg {\n    stroke: rgba(244, 67, 54, 0.9);\n}\n\n/* ============================================\n   LUMIA CARD GRID & CARDS\n   ============================================ */\n\n.lumia-card-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));\n    gap: 16px;\n    padding: 4px;\n}\n\n.lumia-card {\n    position: relative;\n    display: flex;\n    flex-direction: column;\n    background: linear-gradient(\n        165deg,\n        rgba(28, 24, 38, 0.95) 0%,\n        rgba(38, 32, 52, 0.9) 50%,\n        rgba(32, 28, 45, 0.95) 100%\n    );\n    border: 1px solid rgba(128, 128, 128, 0.15);\n    border-radius: 16px;\n    overflow: hidden;\n    cursor: pointer;\n    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);\n}\n\n.lumia-card:hover {\n    transform: translateY(-4px);\n    border-color: rgba(147, 112, 219, 0.3);\n    box-shadow:\n        0 8px 24px rgba(0, 0, 0, 0.25),\n        0 0 0 1px rgba(147, 112, 219, 0.15);\n}\n\n.lumia-card.selected {\n    border-color: rgba(100, 149, 237, 0.6);\n    box-shadow:\n        0 4px 16px rgba(100, 149, 237, 0.2),\n        0 0 0 1px rgba(100, 149, 237, 0.3),\n        inset 0 0 20px rgba(100, 149, 237, 0.05);\n}\n\n.lumia-card.selected::after {\n    content: "";\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    height: 2px;\n    background: linear-gradient(\n        90deg,\n        transparent 0%,\n        rgba(100, 149, 237, 0.5) 20%,\n        rgba(100, 149, 237, 0.8) 50%,\n        rgba(100, 149, 237, 0.5) 80%,\n        transparent 100%\n    );\n}\n\n/* Card Image Container */\n.lumia-card-image {\n    position: relative;\n    width: 100%;\n    aspect-ratio: 1 / 1;\n    background: linear-gradient(\n        135deg,\n        rgba(20, 16, 28, 0.8) 0%,\n        rgba(40, 32, 55, 0.6) 100%\n    );\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    overflow: hidden;\n}\n\n.lumia-card-image img {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n    transition: transform 0.3s ease, opacity 0.3s ease;\n    opacity: 0;\n}\n\n.lumia-card-image img.lumia-img-loaded {\n    opacity: 1;\n}\n\n.lumia-card:hover .lumia-card-image img {\n    transform: scale(1.05);\n}\n\n.lumia-card-placeholder {\n    font-size: 48px;\n    font-weight: 300;\n    color: rgba(147, 112, 219, 0.4);\n    font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", sans-serif;\n    user-select: none;\n}\n\n/* Image Loading Spinner */\n.lumia-img-spinner {\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    width: 24px;\n    height: 24px;\n    border: 2px solid rgba(147, 112, 219, 0.2);\n    border-top-color: rgba(147, 112, 219, 0.7);\n    border-radius: 50%;\n    animation: lumia-spin 0.8s linear infinite;\n}\n\n@keyframes lumia-spin {\n    to { transform: translate(-50%, -50%) rotate(360deg); }\n}\n\n.lumia-card-image:has(.lumia-img-loaded) .lumia-img-spinner {\n    display: none;\n}\n\n/* Dominant Star Icon */\n.lumia-dominant-icon {\n    position: absolute;\n    top: 10px;\n    right: 10px;\n    width: 32px;\n    height: 32px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    background: rgba(0, 0, 0, 0.5);\n    backdrop-filter: blur(8px);\n    -webkit-backdrop-filter: blur(8px);\n    border-radius: 50%;\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    cursor: pointer;\n    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);\n    z-index: 10;\n    opacity: 0;\n}\n\n.lumia-card:hover .lumia-dominant-icon,\n.lumia-card.selected .lumia-dominant-icon {\n    opacity: 1;\n}\n\n.lumia-dominant-icon:hover {\n    background: rgba(0, 0, 0, 0.7);\n    border-color: rgba(255, 193, 7, 0.4);\n    transform: scale(1.1);\n}\n\n.lumia-dominant-icon.dominant {\n    opacity: 1;\n    background: linear-gradient(\n        135deg,\n        rgba(255, 193, 7, 0.9) 0%,\n        rgba(255, 152, 0, 0.9) 100%\n    );\n    border-color: rgba(255, 193, 7, 0.6);\n    box-shadow: 0 2px 12px rgba(255, 193, 7, 0.4);\n}\n\n.lumia-dominant-icon svg {\n    width: 18px;\n    height: 18px;\n    fill: none;\n    stroke: rgba(255, 255, 255, 0.7);\n    stroke-width: 2;\n    stroke-linecap: round;\n    stroke-linejoin: round;\n    transition: all 0.25s ease;\n}\n\n.lumia-dominant-icon:hover svg {\n    stroke: rgba(255, 193, 7, 0.9);\n}\n\n.lumia-dominant-icon.dominant svg {\n    fill: rgba(255, 255, 255, 0.95);\n    stroke: rgba(255, 255, 255, 0.95);\n}\n\n/* Edit Icon for custom pack items */\n.lumia-edit-icon {\n    position: absolute;\n    bottom: 10px;\n    right: 10px;\n    width: 28px;\n    height: 28px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    background: rgba(147, 112, 219, 0.85);\n    backdrop-filter: blur(8px);\n    -webkit-backdrop-filter: blur(8px);\n    border-radius: 50%;\n    border: 1px solid rgba(147, 112, 219, 0.4);\n    cursor: pointer;\n    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);\n    z-index: 10;\n    opacity: 0;\n}\n\n.lumia-card:hover .lumia-edit-icon {\n    opacity: 1;\n}\n\n.lumia-edit-icon:hover {\n    background: rgba(147, 112, 219, 1);\n    border-color: rgba(186, 135, 255, 0.6);\n    transform: scale(1.1);\n    box-shadow: 0 2px 12px rgba(147, 112, 219, 0.4);\n}\n\n.lumia-edit-icon svg {\n    width: 14px;\n    height: 14px;\n    fill: none;\n    stroke: rgba(255, 255, 255, 0.95);\n    stroke-width: 2;\n    stroke-linecap: round;\n    stroke-linejoin: round;\n}\n\n/* Enable All Icon - sparkles button for quick-enabling all traits */\n.lumia-enable-all-icon {\n    position: absolute;\n    bottom: 10px;\n    left: 10px;\n    width: 28px;\n    height: 28px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    background: rgba(255, 193, 7, 0.85);\n    backdrop-filter: blur(8px);\n    -webkit-backdrop-filter: blur(8px);\n    border-radius: 50%;\n    border: 1px solid rgba(255, 193, 7, 0.4);\n    cursor: pointer;\n    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);\n    z-index: 10;\n    opacity: 0;\n}\n\n.lumia-card:hover .lumia-enable-all-icon {\n    opacity: 1;\n}\n\n.lumia-enable-all-icon:hover {\n    background: rgba(255, 193, 7, 1);\n    border-color: rgba(255, 215, 0, 0.8);\n    transform: scale(1.1);\n    box-shadow: 0 2px 12px rgba(255, 193, 7, 0.5);\n}\n\n.lumia-enable-all-icon svg {\n    width: 14px;\n    height: 14px;\n    fill: none;\n    stroke: rgba(0, 0, 0, 0.85);\n    stroke-width: 2;\n    stroke-linecap: round;\n    stroke-linejoin: round;\n}\n\n/* All-enabled state - shows when all traits are active */\n.lumia-enable-all-icon.all-enabled {\n    opacity: 1;\n    background: rgba(76, 175, 80, 0.95);\n    border-color: rgba(76, 175, 80, 0.6);\n    box-shadow: 0 2px 8px rgba(76, 175, 80, 0.4);\n}\n\n.lumia-enable-all-icon.all-enabled:hover {\n    background: rgba(56, 142, 60, 1);\n    border-color: rgba(76, 175, 80, 0.8);\n    box-shadow: 0 2px 12px rgba(76, 175, 80, 0.6);\n}\n\n.lumia-enable-all-icon.all-enabled svg {\n    stroke: rgba(255, 255, 255, 0.95);\n}\n\n/* Selection Checkmark Overlay */\n.lumia-card-check {\n    position: absolute;\n    top: 10px;\n    left: 10px;\n    width: 28px;\n    height: 28px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    background: rgba(100, 149, 237, 0.9);\n    border-radius: 50%;\n    opacity: 0;\n    transform: scale(0.5);\n    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);\n    z-index: 10;\n}\n\n.lumia-card.selected .lumia-card-check {\n    opacity: 1;\n    transform: scale(1);\n}\n\n.lumia-card-check svg {\n    width: 16px;\n    height: 16px;\n    fill: none;\n    stroke: white;\n    stroke-width: 2.5;\n    stroke-linecap: round;\n    stroke-linejoin: round;\n}\n\n/* Card Info Section */\n.lumia-card-info {\n    padding: 14px 16px 16px;\n    display: flex;\n    flex-direction: column;\n    gap: 4px;\n    background: linear-gradient(\n        180deg,\n        rgba(28, 24, 38, 0) 0%,\n        rgba(28, 24, 38, 0.95) 20%\n    );\n}\n\n.lumia-card-name {\n    font-size: 15px;\n    font-weight: 600;\n    color: rgba(255, 255, 255, 0.95);\n    font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", sans-serif;\n    letter-spacing: -0.2px;\n    line-height: 1.3;\n    word-break: break-word;\n}\n\n/* Definition Card Variant (no dominant icon) */\n.lumia-card.definition-card .lumia-dominant-icon {\n    display: none;\n}\n\n/* Card Appear Animation */\n.lumia-card.lumia-card-appear {\n    animation: lumia-card-appear 0.3s ease-out forwards;\n    opacity: 0;\n}\n\n@keyframes lumia-card-appear {\n    from {\n        opacity: 0;\n        transform: translateY(10px);\n    }\n    to {\n        opacity: 1;\n        transform: translateY(0);\n    }\n}\n\n/* Staggered animation delays */\n.lumia-card.lumia-card-appear:nth-child(1) { animation-delay: 0ms; }\n.lumia-card.lumia-card-appear:nth-child(2) { animation-delay: 30ms; }\n.lumia-card.lumia-card-appear:nth-child(3) { animation-delay: 60ms; }\n.lumia-card.lumia-card-appear:nth-child(4) { animation-delay: 90ms; }\n.lumia-card.lumia-card-appear:nth-child(5) { animation-delay: 120ms; }\n.lumia-card.lumia-card-appear:nth-child(6) { animation-delay: 150ms; }\n.lumia-card.lumia-card-appear:nth-child(7) { animation-delay: 180ms; }\n.lumia-card.lumia-card-appear:nth-child(8) { animation-delay: 210ms; }\n.lumia-card.lumia-card-appear:nth-child(9) { animation-delay: 240ms; }\n.lumia-card.lumia-card-appear:nth-child(10) { animation-delay: 270ms; }\n.lumia-card.lumia-card-appear:nth-child(n+11) { animation-delay: 300ms; }\n\n/* ============================================\n   MODAL PORTAL - Renders at document.body level\n   ============================================ */\n\n.lumia-modal-backdrop {\n    position: fixed;\n    inset: 0;\n    z-index: 10000;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    padding: 16px;\n    box-sizing: border-box;\n}\n\n/* ============================================\n   LUMIA MODAL RESPONSIVE\n   ============================================ */\n\n@media (max-width: 600px) {\n    /* Adjusted modal style - centered, not full-screen */\n    .lumia-modal {\n        width: 94vw;\n        max-width: 400px;\n        max-height: 90vh;\n        max-height: 90dvh;\n        border-radius: 16px;\n        margin: auto;\n    }\n\n    .lumia-modal-selection {\n        max-width: 94vw;\n    }\n\n    /* Ensure backdrop properly centers the modal */\n    .lumia-modal-backdrop {\n        padding: 16px;\n    }\n\n    /* Modal content scrolling for mobile */\n    .lumia-modal-content {\n        overflow-y: auto;\n        -webkit-overflow-scrolling: touch;\n    }\n\n    .lumia-modal-header-inner {\n        padding: 14px 16px;\n        gap: 10px;\n    }\n\n    .lumia-modal-header-icon {\n        width: 32px;\n        height: 32px;\n    }\n\n    .lumia-modal-title {\n        font-size: 15px;\n    }\n\n    .lumia-modal-content {\n        padding: 12px;\n    }\n\n    .lumia-modal-content > * + * {\n        margin-top: 12px;\n    }\n\n    .lumia-modal-panel-content {\n        padding: 10px;\n    }\n\n    .lumia-modal-footer {\n        padding: 12px 16px;\n    }\n\n    .lumia-modal-btn {\n        padding: 10px 16px;\n        font-size: 13px;\n    }\n\n    .lumia-card-grid {\n        grid-template-columns: repeat(2, 1fr);\n        gap: 12px;\n    }\n\n    .lumia-card {\n        border-radius: 12px;\n    }\n\n    .lumia-card-info {\n        padding: 10px 12px 12px;\n    }\n\n    .lumia-card-name {\n        font-size: 13px;\n    }\n\n    .lumia-card-check {\n        width: 24px;\n        height: 24px;\n    }\n\n    .lumia-card-check svg {\n        width: 14px;\n        height: 14px;\n    }\n\n    .lumia-card-placeholder {\n        font-size: 36px;\n    }\n\n    /* Disable animations on mobile for performance */\n    .lumia-card,\n    .lumia-card-image img,\n    .lumia-dominant-icon,\n    .lumia-card-check {\n        transition: none !important;\n    }\n\n    .lumia-card:hover {\n        transform: none;\n    }\n\n    .lumia-card:hover .lumia-card-image img {\n        transform: none;\n    }\n\n    /* Viewport Panel Mobile */\n    .lumiverse-viewport-wrapper {\n        width: 100vw !important;\n    }\n\n    .lumiverse-viewport-panel {\n        width: 100%;\n    }\n\n    .lumiverse-vp-tabs {\n        width: 48px;\n    }\n\n    .lumiverse-vp-tab {\n        width: 44px;\n        height: 44px;\n    }\n\n    .lumiverse-vp-tab-label {\n        font-size: 9px;\n    }\n\n    /* Toggle button - shift down to avoid SillyTavern's top bar */\n    /* Only apply to default positioning, not custom */\n    .lumiverse-toggle-container:not(.lumiverse-toggle-container--custom) {\n        top: 44px !important;\n    }\n\n    /* Summary textarea - ensure proper height on mobile */\n    .lumiverse-vp-summary-editor {\n        min-height: 0;\n    }\n\n    .lumiverse-vp-summary-textarea-wrapper {\n        flex: 1;\n        min-height: 180px;\n        display: flex;\n        flex-direction: column;\n    }\n\n    .lumiverse-vp-summary-textarea {\n        flex: 1;\n        min-height: 180px;\n    }\n}\n\n/* ============================================\n   MODAL CONTROLS - Collapse/Expand & Sort\n   Shared styling for Lumia Selection modals\n   ============================================ */\n\n.lumia-modal-controls {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    gap: 12px;\n    padding: 12px 16px;\n    background: rgba(0, 0, 0, 0.2);\n    border-bottom: 1px solid rgba(128, 128, 128, 0.12);\n    margin: 0 -16px 16px -16px;\n    width: calc(100% + 32px);\n}\n\n.lumia-modal-controls-group {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n}\n\n.lumia-modal-control-btn {\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    gap: 6px;\n    padding: 8px 12px;\n    font-size: 12px;\n    font-weight: 500;\n    color: rgba(255, 255, 255, 0.7);\n    background: rgba(0, 0, 0, 0.25);\n    border: 1px solid rgba(128, 128, 128, 0.15);\n    border-radius: 8px;\n    cursor: pointer;\n    transition: all 0.15s ease;\n    white-space: nowrap;\n}\n\n.lumia-modal-control-btn svg {\n    width: 14px;\n    height: 14px;\n    stroke: currentColor;\n    flex-shrink: 0;\n    display: block;\n}\n\n.lumia-modal-control-btn:hover {\n    color: rgba(255, 255, 255, 0.95);\n    background: rgba(0, 0, 0, 0.35);\n    border-color: rgba(147, 112, 219, 0.5);\n}\n\n.lumia-modal-control-btn:active {\n    transform: scale(0.97);\n}\n\n/* Control icons */\n.lumia-control-icon {\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    width: 16px;\n    height: 16px;\n    flex-shrink: 0;\n}\n\n.lumia-control-icon svg {\n    width: 16px;\n    height: 16px;\n    stroke: currentColor;\n    display: block;\n}\n\n/* Sort icon */\n.lumia-sort-icon {\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    width: 16px;\n    height: 16px;\n    flex-shrink: 0;\n    color: rgba(255, 255, 255, 0.6);\n}\n\n.lumia-sort-icon svg {\n    width: 16px;\n    height: 16px;\n    stroke: currentColor;\n    display: block;\n}\n\n/* Sort Dropdown */\n.lumia-modal-sort {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    padding: 6px 12px;\n    background: rgba(0, 0, 0, 0.25);\n    border: 1px solid rgba(128, 128, 128, 0.15);\n    border-radius: 8px;\n}\n\n/* Direct SVG targeting for sort dropdown - mirrors .lumia-modal-control-btn svg pattern */\n.lumia-modal-sort svg {\n    width: 14px;\n    height: 14px;\n    stroke: currentColor;\n    flex-shrink: 0;\n    display: block;\n}\n\n.lumia-modal-sort-label {\n    font-size: 12px;\n    font-weight: 500;\n    color: rgba(255, 255, 255, 0.5);\n}\n\n.lumia-select {\n    padding: 4px 8px;\n    font-size: 12px;\n    font-weight: 500;\n    color: rgba(255, 255, 255, 0.9);\n    background: rgba(0, 0, 0, 0.3);\n    border: 1px solid rgba(128, 128, 128, 0.2);\n    border-radius: 6px;\n    cursor: pointer;\n    transition: all 0.15s ease;\n    min-width: 100px;\n}\n\n.lumia-select:hover {\n    border-color: rgba(147, 112, 219, 0.4);\n}\n\n.lumia-select:focus {\n    outline: none;\n    border-color: rgba(147, 112, 219, 0.6);\n    box-shadow: 0 0 0 2px rgba(147, 112, 219, 0.15);\n}\n\n.lumia-select option {\n    background: #1a1a1a;\n    color: #fff;\n}\n\n/* Mobile adjustments for controls */\n@media (max-width: 600px) {\n    .lumia-modal-controls {\n        flex-wrap: wrap;\n        gap: 8px;\n        padding: 10px 12px;\n        margin: 0 -12px 12px -12px;\n        width: calc(100% + 24px);\n    }\n\n    .lumia-modal-control-btn {\n        padding: 6px 10px;\n        font-size: 11px;\n    }\n\n    /* Hide text labels on mobile, but keep icon spans visible */\n    .lumia-modal-control-btn > span:not(.lumia-btn-icon):not(.lumia-control-icon):not([class*="icon"]) {\n        display: none;\n    }\n\n    .lumia-modal-sort {\n        flex: 1;\n        min-width: 100%;\n        justify-content: space-between;\n    }\n\n    .lumia-select {\n        flex: 1;\n        min-width: 0;\n        padding: 5px 8px;\n        font-size: 11px;\n    }\n}\n\n/* ============================================\n   LOOM ITEMS - Styling for Loom Selection Modal\n   ============================================ */\n\n/* Loom items container within pack section */\n.lumia-loom-items {\n    display: flex;\n    flex-direction: column;\n    gap: 6px;\n    padding: 12px;\n    background: rgba(0, 0, 0, 0.15);\n}\n\n/* Individual Loom item */\n.lumiverse-loom-item {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 12px 16px;\n    background: rgba(0, 0, 0, 0.2);\n    border: 1px solid rgba(128, 128, 128, 0.12);\n    border-radius: 8px;\n    cursor: pointer;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-loom-item:hover {\n    background: rgba(0, 0, 0, 0.3);\n    border-color: rgba(147, 112, 219, 0.3);\n}\n\n.lumiverse-loom-item--selected {\n    background: rgba(147, 112, 219, 0.15);\n    border-color: rgba(147, 112, 219, 0.5);\n}\n\n.lumiverse-loom-item-content {\n    flex: 1;\n}\n\n.lumiverse-loom-item-name {\n    font-weight: 500;\n    color: rgba(255, 255, 255, 0.9);\n    font-size: 14px;\n}\n\n.lumiverse-loom-item-actions {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    margin-left: auto;\n}\n\n.lumiverse-loom-item-toggle {\n    margin-left: 0;\n}\n\n.lumiverse-loom-item-edit {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 24px;\n    height: 24px;\n    padding: 0;\n    background: rgba(128, 128, 128, 0.15);\n    border: 1px solid rgba(128, 128, 128, 0.15);\n    border-radius: var(--lumiverse-radius-sm, 4px);\n    color: rgba(255, 255, 255, 0.5);\n    cursor: pointer;\n    transition: all 0.15s ease;\n    flex-shrink: 0;\n}\n\n.lumiverse-loom-item-edit:hover {\n    background: rgba(100, 149, 237, 0.25);\n    border-color: rgba(100, 149, 237, 0.3);\n    color: rgba(130, 179, 255, 0.95);\n}\n\n/* Toggle switch styling */\n.lumiverse-toggle-switch {\n    position: relative;\n    width: 40px;\n    height: 22px;\n}\n\n.lumiverse-toggle-track {\n    width: 100%;\n    height: 100%;\n    background: rgba(0, 0, 0, 0.3);\n    border: 2px solid rgba(128, 128, 128, 0.2);\n    border-radius: 11px;\n    transition: all 0.15s ease;\n}\n\n.lumiverse-toggle-switch.checked .lumiverse-toggle-track {\n    background: rgba(147, 112, 219, 0.8);\n    border-color: rgba(147, 112, 219, 0.8);\n}\n\n.lumiverse-toggle-thumb {\n    position: absolute;\n    top: 3px;\n    left: 3px;\n    width: 16px;\n    height: 16px;\n    background: white;\n    border-radius: 50%;\n    transition: transform 0.15s ease;\n}\n\n.lumiverse-toggle-switch.checked .lumiverse-toggle-thumb {\n    transform: translateX(18px);\n}\n\n/* Selection actions */\n.lumia-selection-actions {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n    margin-left: auto;\n}\n\n.lumia-selection-count {\n    font-size: 13px;\n    color: rgba(255, 255, 255, 0.5);\n}\n\n/* Search box styling matching Lumia modal */\n.lumia-search-box {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    padding: 8px 12px;\n    background: rgba(0, 0, 0, 0.2);\n    border: 1px solid rgba(128, 128, 128, 0.12);\n    border-radius: 8px;\n    flex: 1;\n    max-width: 300px;\n}\n\n.lumia-search-icon,\n.lumia-search-icon svg {\n    width: 16px;\n    height: 16px;\n    color: rgba(255, 255, 255, 0.4);\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n}\n\n.lumia-search-input {\n    flex: 1;\n    background: transparent;\n    border: none;\n    outline: none;\n    color: rgba(255, 255, 255, 0.9);\n    font-size: 13px;\n}\n\n.lumia-search-input::placeholder {\n    color: rgba(255, 255, 255, 0.4);\n}\n\n.lumia-search-clear {\n    background: transparent;\n    border: none;\n    padding: 4px;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: rgba(255, 255, 255, 0.4);\n    transition: color 0.15s ease;\n}\n\n.lumia-search-clear:hover {\n    color: rgba(255, 255, 255, 0.8);\n}\n\n.lumia-search-clear-icon,\n.lumia-search-clear-icon svg {\n    width: 14px;\n    height: 14px;\n}\n\n/* ----------------------------------------\n   Lumia Modes Section (Chimera/Council)\n   ---------------------------------------- */\n.lumiverse-vp-mode-option {\n    margin-bottom: 8px;\n}\n\n.lumiverse-vp-mode-option:last-child {\n    margin-bottom: 0;\n}\n\n.lumiverse-vp-mode-details {\n    margin-top: 8px;\n    padding-left: 12px;\n    border-left: 2px solid rgba(147, 112, 219, 0.3);\n}\n\n.lumiverse-vp-mode-note {\n    margin: 8px 0 0;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n    font-style: italic;\n}\n\n/* ----------------------------------------\n   Council Manager Component\n   ---------------------------------------- */\n.lumiverse-council-manager {\n    padding: 12px;\n    display: flex;\n    flex-direction: column;\n    gap: 12px;\n}\n\n.lumiverse-council-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    gap: 12px;\n}\n\n.lumiverse-council-title {\n    margin: 0;\n    font-size: 14px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    display: flex;\n    align-items: center;\n    gap: 8px;\n}\n\n.lumiverse-council-title svg {\n    color: var(--lumiverse-primary);\n}\n\n.lumiverse-council-mode-toggle {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    cursor: pointer;\n}\n\n.lumiverse-council-mode-toggle input {\n    display: none;\n}\n\n.lumiverse-council-mode-switch {\n    width: 40px;\n    height: 22px;\n    background: rgba(100, 100, 130, 0.3);\n    border-radius: 11px;\n    position: relative;\n    transition: background 0.2s ease;\n}\n\n.lumiverse-council-mode-switch--on {\n    background: var(--lumiverse-primary);\n}\n\n.lumiverse-council-mode-thumb {\n    position: absolute;\n    top: 2px;\n    left: 2px;\n    width: 18px;\n    height: 18px;\n    background: white;\n    border-radius: 50%;\n    transition: transform 0.2s ease;\n}\n\n.lumiverse-council-mode-switch--on .lumiverse-council-mode-thumb {\n    transform: translateX(18px);\n}\n\n.lumiverse-council-mode-label {\n    font-size: 11px;\n    font-weight: 500;\n    color: var(--lumiverse-text-muted);\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n.lumiverse-council-desc {\n    margin: 0;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n    line-height: 1.5;\n}\n\n/* Add member section */\n.lumiverse-council-add-section {\n    margin-top: 4px;\n}\n\n.lumiverse-council-add-btn {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 8px;\n    width: 100%;\n    padding: 10px 16px;\n    background: rgba(147, 112, 219, 0.1);\n    border: 1px dashed rgba(147, 112, 219, 0.3);\n    border-radius: 8px;\n    color: var(--lumiverse-primary);\n    font-size: 13px;\n    font-weight: 500;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-council-add-btn:hover:not(:disabled) {\n    background: rgba(147, 112, 219, 0.15);\n    border-color: rgba(147, 112, 219, 0.5);\n}\n\n.lumiverse-council-add-btn:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n}\n\n/* Add dropdown */\n.lumiverse-council-add-dropdown {\n    background: rgba(30, 30, 46, 0.95);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 10px;\n    overflow: hidden;\n}\n\n.lumiverse-council-add-header {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    padding: 10px;\n    border-bottom: 1px solid var(--lumiverse-border);\n}\n\n.lumiverse-council-search {\n    flex: 1;\n    padding: 8px 12px;\n    background: var(--lumiverse-bg);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 6px;\n    color: var(--lumiverse-text);\n    font-size: 13px;\n}\n\n.lumiverse-council-search:focus {\n    outline: none;\n    border-color: var(--lumiverse-primary);\n}\n\n.lumiverse-council-add-list {\n    max-height: 200px;\n    overflow-y: auto;\n}\n\n.lumiverse-council-add-empty {\n    padding: 20px;\n    text-align: center;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-council-add-item {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    width: 100%;\n    padding: 10px 12px;\n    background: transparent;\n    border: none;\n    border-bottom: 1px solid rgba(255, 255, 255, 0.05);\n    color: var(--lumiverse-text);\n    cursor: pointer;\n    transition: background 0.2s ease;\n    text-align: left;\n    /* Mobile touch fixes */\n    touch-action: manipulation;\n    -webkit-tap-highlight-color: rgba(147, 112, 219, 0.2);\n}\n\n.lumiverse-council-add-item:hover {\n    background: rgba(147, 112, 219, 0.1);\n}\n\n.lumiverse-council-add-item:active {\n    background: rgba(147, 112, 219, 0.2);\n}\n\n.lumiverse-council-add-item:last-child {\n    border-bottom: none;\n}\n\n.lumiverse-council-add-item-avatar {\n    width: 36px;\n    height: 36px;\n    border-radius: 6px;\n    overflow: hidden;\n    background: rgba(147, 112, 219, 0.15);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: var(--lumiverse-primary);\n    flex-shrink: 0;\n    pointer-events: none; /* Allow parent button to capture touch */\n}\n\n.lumiverse-council-add-item-avatar img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n}\n\n.lumiverse-council-add-item-info {\n    flex: 1;\n    min-width: 0;\n    pointer-events: none; /* Allow parent button to capture touch */\n}\n\n.lumiverse-council-add-item-name {\n    display: block;\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-council-add-item-pack {\n    display: block;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n}\n\n/* Members list */\n.lumiverse-council-members {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumiverse-council-empty {\n    padding: 24px;\n    text-align: center;\n    background: rgba(30, 30, 46, 0.4);\n    border-radius: 10px;\n}\n\n.lumiverse-council-empty-icon {\n    display: block;\n    margin-bottom: 12px;\n    color: var(--lumiverse-primary);\n    opacity: 0.5;\n}\n\n.lumiverse-council-empty h4 {\n    margin: 0 0 8px;\n    font-size: 14px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-council-empty p {\n    margin: 0;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n    line-height: 1.5;\n}\n\n/* Member card */\n.lumiverse-council-member {\n    background: rgba(30, 30, 46, 0.6);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 10px;\n    overflow: hidden;\n}\n\n.lumiverse-council-member-header {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 10px 12px;\n    cursor: pointer;\n    transition: background 0.2s ease;\n}\n\n.lumiverse-council-member-header:hover {\n    background: rgba(147, 112, 219, 0.05);\n}\n\n.lumiverse-council-member-avatar {\n    width: 40px;\n    height: 40px;\n    border-radius: 8px;\n    overflow: hidden;\n    background: rgba(147, 112, 219, 0.15);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: var(--lumiverse-primary);\n    flex-shrink: 0;\n}\n\n.lumiverse-council-member-avatar img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n}\n\n.lumiverse-council-member-info {\n    flex: 1;\n    min-width: 0;\n}\n\n.lumiverse-council-member-name {\n    display: block;\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-council-member-role {\n    display: block;\n    font-size: 11px;\n    color: var(--lumiverse-primary);\n    font-weight: 500;\n}\n\n.lumiverse-council-member-stats {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    margin-top: 4px;\n}\n\n.lumiverse-council-stat {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-council-stat svg {\n    opacity: 0.7;\n}\n\n.lumiverse-council-member-actions {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n}\n\n.lumiverse-council-btn {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 28px;\n    height: 28px;\n    background: rgba(100, 100, 130, 0.2);\n    border: none;\n    border-radius: 6px;\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-council-btn:hover {\n    background: rgba(147, 112, 219, 0.2);\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-council-btn--primary {\n    background: var(--lumiverse-primary);\n    color: white;\n}\n\n.lumiverse-council-btn--primary:hover {\n    background: var(--lumiverse-primary-light);\n}\n\n.lumiverse-council-btn--danger:hover {\n    background: rgba(239, 68, 68, 0.2);\n    color: var(--lumiverse-danger);\n}\n\n.lumiverse-council-expand {\n    display: flex;\n    transition: transform 0.2s ease;\n}\n\n.lumiverse-council-expand--open {\n    transform: rotate(180deg);\n}\n\n/* Member body (expanded content) */\n.lumiverse-council-member-body {\n    padding: 12px;\n    border-top: 1px solid var(--lumiverse-border);\n    background: rgba(20, 20, 36, 0.4);\n}\n\n.lumiverse-council-role-edit {\n    margin-bottom: 12px;\n}\n\n.lumiverse-council-role-edit label {\n    display: block;\n    font-size: 11px;\n    font-weight: 500;\n    color: var(--lumiverse-text-muted);\n    margin-bottom: 6px;\n}\n\n.lumiverse-council-role-input-row {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    width: 100%;\n}\n\n.lumiverse-council-role-input-row .lumiverse-council-btn {\n    flex: 0 0 auto;\n    width: 32px;\n    height: 32px;\n}\n\n.lumiverse-council-input {\n    flex: 1 1 0;\n    min-width: 0;\n    padding: 8px 12px;\n    background: var(--lumiverse-bg);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 6px;\n    color: var(--lumiverse-text);\n    font-size: 13px;\n}\n\n.lumiverse-council-input:focus {\n    outline: none;\n    border-color: var(--lumiverse-primary);\n}\n\n.lumiverse-council-role-display {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    margin-bottom: 12px;\n    font-size: 12px;\n}\n\n.lumiverse-council-role-label {\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-council-role-value {\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-council-role-value em {\n    color: var(--lumiverse-text-muted);\n    font-style: italic;\n}\n\n/* Traits section */\n.lumiverse-council-traits-section {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumiverse-council-traits-group {\n    display: flex;\n    flex-wrap: wrap;\n    align-items: flex-start;\n    gap: 6px;\n    font-size: 12px;\n}\n\n.lumiverse-council-traits-label {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    color: var(--lumiverse-text-muted);\n    flex-shrink: 0;\n}\n\n.lumiverse-council-traits-list {\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-council-traits-empty {\n    color: var(--lumiverse-text-dim);\n    font-style: italic;\n}\n\n.lumiverse-council-help-text {\n    margin: 12px 0 0;\n    padding: 10px;\n    background: rgba(147, 112, 219, 0.08);\n    border-radius: 6px;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n    line-height: 1.5;\n}\n\n/* Help text at bottom */\n.lumiverse-council-help {\n    padding: 10px;\n    background: rgba(30, 30, 46, 0.4);\n    border-radius: 8px;\n}\n\n.lumiverse-council-help p {\n    margin: 0;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n    line-height: 1.5;\n}\n\n.lumiverse-council-help code {\n    background: rgba(147, 112, 219, 0.15);\n    padding: 2px 5px;\n    border-radius: 3px;\n    font-size: 10px;\n    color: var(--lumiverse-primary);\n}\n\n/* ========================================\n   Council Select Modal\n   Mobile-friendly modal for selecting council members\n   ======================================== */\n\n.lumiverse-council-select-modal {\n    display: flex;\n    flex-direction: column;\n    height: 100%;\n    max-height: 80vh;\n}\n\n/* Header */\n.lumiverse-council-select-header {\n    display: flex;\n    align-items: flex-start;\n    gap: 12px;\n    padding: 16px 20px;\n    border-bottom: 1px solid var(--lumiverse-border);\n}\n\n.lumiverse-council-select-header-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 40px;\n    height: 40px;\n    background: linear-gradient(135deg, var(--lumiverse-primary), var(--lumiverse-primary-light));\n    border-radius: 10px;\n    color: white;\n    flex-shrink: 0;\n}\n\n.lumiverse-council-select-header-text h3 {\n    margin: 0 0 4px;\n    font-size: 16px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-council-select-header-text p {\n    margin: 0;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n    line-height: 1.4;\n}\n\n/* Sections */\n.lumiverse-council-select-section {\n    padding: 16px 20px;\n    border-bottom: 1px solid var(--lumiverse-border);\n    flex-shrink: 0;\n}\n\n/* Council Members section - constrained height with scrolling */\n.lumiverse-council-select-section:not(.lumiverse-council-select-section--available) {\n    max-height: 35vh;\n    display: flex;\n    flex-direction: column;\n}\n\n.lumiverse-council-select-section--available {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    min-height: 200px;\n    overflow: hidden;\n}\n\n.lumiverse-council-select-section-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    gap: 12px;\n    margin-bottom: 12px;\n    font-size: 12px;\n    font-weight: 600;\n    color: var(--lumiverse-text-muted);\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n.lumiverse-council-select-count {\n    padding: 2px 8px;\n    background: var(--lumiverse-primary);\n    border-radius: 10px;\n    font-size: 11px;\n    font-weight: 600;\n    color: white;\n}\n\n/* Search */\n.lumiverse-council-search-wrapper {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    padding: 6px 10px;\n    background: rgba(30, 30, 46, 0.6);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 8px;\n    flex: 1;\n    max-width: 200px;\n}\n\n.lumiverse-council-search-wrapper svg {\n    color: var(--lumiverse-text-muted);\n    flex-shrink: 0;\n}\n\n.lumiverse-council-search-input {\n    flex: 1;\n    min-width: 0;\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text);\n    font-size: 12px;\n}\n\n.lumiverse-council-search-input::placeholder {\n    color: var(--lumiverse-text-dim);\n}\n\n.lumiverse-council-search-input:focus {\n    outline: none;\n}\n\n.lumiverse-council-search-clear {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 18px;\n    height: 18px;\n    background: rgba(100, 100, 130, 0.3);\n    border: none;\n    border-radius: 50%;\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.lumiverse-council-search-clear:hover {\n    background: rgba(239, 68, 68, 0.3);\n    color: var(--lumiverse-danger);\n}\n\n/* Members list (horizontal scrolling on mobile) */\n.lumiverse-council-select-members {\n    min-height: 60px;\n    flex: 1;\n    overflow-y: auto;\n    scrollbar-width: thin;\n    scrollbar-color: rgba(147, 112, 219, 0.3) transparent;\n}\n\n.lumiverse-council-select-members::-webkit-scrollbar {\n    width: 6px;\n}\n\n.lumiverse-council-select-members::-webkit-scrollbar-track {\n    background: transparent;\n}\n\n.lumiverse-council-select-members::-webkit-scrollbar-thumb {\n    background: rgba(147, 112, 219, 0.3);\n    border-radius: 3px;\n}\n\n.lumiverse-council-select-members::-webkit-scrollbar-thumb:hover {\n    background: rgba(147, 112, 219, 0.5);\n}\n\n.lumiverse-council-member-list {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n/* Member card (in modal) */\n.lumiverse-council-member-card {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 10px 12px;\n    background: rgba(30, 30, 46, 0.6);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 10px;\n}\n\n.lumiverse-council-member-card-avatar {\n    width: 36px;\n    height: 36px;\n    border-radius: 8px;\n    overflow: hidden;\n    background: rgba(147, 112, 219, 0.15);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: var(--lumiverse-primary);\n    flex-shrink: 0;\n}\n\n.lumiverse-council-member-card-avatar img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n}\n\n.lumiverse-council-member-card-content {\n    flex: 1;\n    min-width: 0;\n}\n\n.lumiverse-council-member-card-name {\n    display: block;\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-council-member-card-meta {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    margin-top: 2px;\n}\n\n.lumiverse-council-member-card-role {\n    font-size: 11px;\n    color: var(--lumiverse-primary);\n    font-weight: 500;\n    cursor: pointer;\n}\n\n.lumiverse-council-member-card-role:hover {\n    text-decoration: underline;\n}\n\n.lumiverse-council-add-role-btn {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    padding: 0;\n    background: none;\n    border: none;\n    font-size: 10px;\n    color: var(--lumiverse-text-dim);\n    cursor: pointer;\n    transition: color 0.2s ease;\n}\n\n.lumiverse-council-add-role-btn:hover {\n    color: var(--lumiverse-primary);\n}\n\n.lumiverse-council-member-card-stats {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n}\n\n.lumiverse-council-member-card-stats span {\n    display: flex;\n    align-items: center;\n    gap: 3px;\n    font-size: 10px;\n    color: var(--lumiverse-text-dim);\n}\n\n/* Small buttons for modal */\n.lumiverse-council-btn-sm {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 24px;\n    height: 24px;\n    background: rgba(100, 100, 130, 0.2);\n    border: none;\n    border-radius: 6px;\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    transition: all 0.2s ease;\n    flex-shrink: 0;\n}\n\n.lumiverse-council-btn-sm:hover {\n    background: rgba(147, 112, 219, 0.2);\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-council-btn-sm--primary {\n    background: var(--lumiverse-primary);\n    color: white;\n}\n\n.lumiverse-council-btn-sm--primary:hover {\n    background: var(--lumiverse-primary-light);\n}\n\n.lumiverse-council-btn-sm--danger:hover {\n    background: rgba(239, 68, 68, 0.2);\n    color: var(--lumiverse-danger);\n}\n\n/* Role edit in modal */\n.lumiverse-council-member-role-edit {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    margin-top: 4px;\n}\n\n.lumiverse-council-input-sm {\n    flex: 1;\n    min-width: 0;\n    padding: 4px 8px;\n    background: var(--lumiverse-bg);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 4px;\n    color: var(--lumiverse-text);\n    font-size: 11px;\n}\n\n.lumiverse-council-input-sm:focus {\n    outline: none;\n    border-color: var(--lumiverse-primary);\n}\n\n/* Grid wrapper for available Lumias */\n.lumiverse-council-select-grid-wrapper {\n    flex: 1;\n    overflow-y: auto;\n    min-height: 150px;\n}\n\n/* Card grid for available Lumias */\n.lumiverse-council-select-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));\n    gap: 12px;\n    padding: 4px 0;\n}\n\n/* Selectable card - now a button for iOS touch compatibility */\n.lumiverse-council-select-card {\n    display: flex;\n    flex-direction: column;\n    background: rgba(30, 30, 46, 0.6);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: 10px;\n    overflow: hidden;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    /* Button reset */\n    padding: 0;\n    margin: 0;\n    font: inherit;\n    text-align: left;\n    /* Mobile touch fixes */\n    touch-action: manipulation;\n    -webkit-tap-highlight-color: rgba(147, 112, 219, 0.2);\n}\n\n.lumiverse-council-select-card:hover {\n    border-color: var(--lumiverse-primary);\n    transform: translateY(-2px);\n    box-shadow: 0 4px 12px rgba(147, 112, 219, 0.15);\n}\n\n.lumiverse-council-select-card:active {\n    transform: scale(0.98);\n    border-color: var(--lumiverse-primary);\n}\n\n.lumiverse-council-select-card-image {\n    position: relative;\n    aspect-ratio: 1;\n    background: rgba(147, 112, 219, 0.1);\n    pointer-events: none; /* Allow parent button to capture touch */\n}\n\n.lumiverse-council-select-card-image img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n}\n\n.lumiverse-council-select-card-placeholder {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 100%;\n    height: 100%;\n    color: var(--lumiverse-text-dim);\n}\n\n.lumiverse-council-select-card-add {\n    position: absolute;\n    bottom: 6px;\n    right: 6px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 24px;\n    height: 24px;\n    background: var(--lumiverse-primary);\n    border-radius: 50%;\n    color: white;\n    opacity: 0;\n    transform: scale(0.8);\n    transition: all 0.2s ease;\n}\n\n.lumiverse-council-select-card:hover .lumiverse-council-select-card-add {\n    opacity: 1;\n    transform: scale(1);\n}\n\n.lumiverse-council-select-card-info {\n    padding: 8px;\n    text-align: center;\n    pointer-events: none; /* Allow parent button to capture touch */\n}\n\n.lumiverse-council-select-card-name {\n    display: block;\n    font-size: 11px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-council-select-card-pack {\n    display: block;\n    font-size: 9px;\n    color: var(--lumiverse-text-dim);\n    margin-top: 2px;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n/* Empty states */\n.lumiverse-council-select-empty {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    padding: 24px;\n    text-align: center;\n    color: var(--lumiverse-primary);\n}\n\n.lumiverse-council-select-empty--muted {\n    color: var(--lumiverse-text-dim);\n}\n\n.lumiverse-council-select-empty span {\n    display: block;\n    margin-top: 8px;\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-council-select-empty p {\n    margin: 4px 0 0;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n    line-height: 1.4;\n}\n\n/* Footer */\n.lumiverse-council-select-footer {\n    display: flex;\n    justify-content: flex-end;\n    gap: 10px;\n    padding: 12px 20px;\n    border-top: 1px solid var(--lumiverse-border);\n    background: rgba(20, 20, 36, 0.4);\n}\n\n/* Mobile responsiveness */\n@media (max-width: 480px) {\n    .lumiverse-council-select-modal {\n        max-height: 90vh;\n    }\n\n    .lumiverse-council-select-header {\n        padding: 12px 16px;\n    }\n\n    .lumiverse-council-select-header-icon {\n        width: 36px;\n        height: 36px;\n    }\n\n    .lumiverse-council-select-header-text h3 {\n        font-size: 15px;\n    }\n\n    .lumiverse-council-select-section {\n        padding: 12px 16px;\n    }\n\n    .lumiverse-council-select-section-header {\n        flex-wrap: wrap;\n    }\n\n    .lumiverse-council-search-wrapper {\n        max-width: none;\n        width: 100%;\n        margin-top: 8px;\n        order: 1;\n    }\n\n    .lumiverse-council-member-list {\n        /* Horizontal scroll on mobile */\n        flex-direction: row;\n        overflow-x: auto;\n        padding-bottom: 8px;\n        gap: 10px;\n        scrollbar-width: thin;\n    }\n\n    .lumiverse-council-member-card {\n        flex-shrink: 0;\n        min-width: 200px;\n        max-width: 280px;\n    }\n\n    .lumiverse-council-select-grid {\n        grid-template-columns: repeat(3, 1fr);\n        gap: 8px;\n    }\n\n    .lumiverse-council-select-card-info {\n        padding: 6px;\n    }\n\n    .lumiverse-council-select-card-name {\n        font-size: 10px;\n    }\n\n    .lumiverse-council-select-card-pack {\n        display: none;\n    }\n\n    /* Always show plus icon on touch devices since hover doesn't work */\n    .lumiverse-council-select-card-add {\n        opacity: 1;\n        transform: scale(1);\n    }\n\n    .lumiverse-council-select-footer {\n        padding: 10px 16px;\n    }\n}\n\n/* ----------------------------------------\n   Collapsible Component - CSS Grid Based\n   High-performance alternative to height animations.\n   Uses grid-template-rows: 0fr -> 1fr which is GPU-accelerated\n   and doesn't trigger layout thrashing.\n   ---------------------------------------- */\n.lumiverse-collapsible {\n    display: grid;\n    grid-template-rows: 0fr;\n    transition: grid-template-rows var(--collapsible-duration, 200ms) ease-out;\n}\n\n.lumiverse-collapsible.is-open {\n    grid-template-rows: 1fr;\n}\n\n.lumiverse-collapsible-inner {\n    overflow: hidden;\n    /* Ensure content is properly hidden when collapsed */\n    min-height: 0;\n}\n\n/* Optional: Fade in content when opening */\n.lumiverse-collapsible .lumiverse-collapsible-inner > * {\n    opacity: 0;\n    transition: opacity calc(var(--collapsible-duration, 200ms) * 0.5) ease-out;\n    transition-delay: calc(var(--collapsible-duration, 200ms) * 0.25);\n}\n\n.lumiverse-collapsible.is-open .lumiverse-collapsible-inner > * {\n    opacity: 1;\n}\n\n/* Reduced motion: instant transitions for accessibility */\n@media (prefers-reduced-motion: reduce) {\n    .lumiverse-collapsible {\n        transition: none;\n    }\n\n    .lumiverse-collapsible .lumiverse-collapsible-inner > * {\n        transition: none;\n        opacity: 1;\n    }\n\n    .lumiverse-collapsible:not(.is-open) .lumiverse-collapsible-inner > * {\n        opacity: 0;\n    }\n}\n\n/* ========================================\n   Pack Detail Modal - Pack Contents Viewer\n   Centered modal for viewing pack contents\n   with quick-add actions\n   ======================================== */\n\n/* Backdrop */\n.lumiverse-pack-detail-backdrop {\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background: rgba(0, 0, 0, 0.7);\n    backdrop-filter: blur(4px);\n    z-index: 10000;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    padding: 20px;\n    animation: fadeIn 0.15s ease-out;\n}\n\n@keyframes fadeIn {\n    from { opacity: 0; }\n    to { opacity: 1; }\n}\n\n/* Pack detail modal - extends lumia-modal base class */\n.lumiverse-pack-detail-modal {\n    /* Override base modal width for pack details */\n    max-width: 650px;\n    /* Use Lumiverse theme colors */\n    background: var(--lumiverse-bg);\n    border-color: var(--lumiverse-border);\n    /* Custom animation */\n    animation: slideUp 0.2s ease-out;\n}\n\n@keyframes slideUp {\n    from {\n        opacity: 0;\n        transform: translateY(20px);\n    }\n    to {\n        opacity: 1;\n        transform: translateY(0);\n    }\n}\n\n/* Header */\n.lumiverse-pack-detail-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 16px 20px;\n    border-bottom: 1px solid var(--lumiverse-border);\n    background: var(--lumiverse-bg-elevated);\n    flex-shrink: 0;\n}\n\n.lumiverse-pack-detail-header-info {\n    display: flex;\n    align-items: center;\n    gap: 14px;\n    flex: 1;\n    min-width: 0;\n}\n\n.lumiverse-pack-detail-header-icon {\n    width: 48px;\n    height: 48px;\n    border-radius: var(--lumiverse-radius);\n    background: var(--lumiverse-bg-dark);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    flex-shrink: 0;\n    overflow: hidden;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-pack-detail-header-icon img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n}\n\n.lumiverse-pack-detail-header-text {\n    flex: 1;\n    min-width: 0;\n}\n\n.lumiverse-pack-detail-title {\n    margin: 0;\n    font-size: 18px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-pack-detail-stats {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 12px;\n    margin-top: 6px;\n}\n\n.lumiverse-pack-detail-stats > span {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-pack-detail-close {\n    width: 32px;\n    height: 32px;\n    border-radius: 50%;\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: all var(--lumiverse-transition-fast);\n    flex-shrink: 0;\n}\n\n.lumiverse-pack-detail-close:hover {\n    background: var(--lumiverse-bg-hover);\n    color: var(--lumiverse-text);\n}\n\n/* Content */\n.lumiverse-pack-detail-content {\n    flex: 1;\n    overflow-y: auto;\n    padding: 16px 20px;\n}\n\n/* Empty state */\n.lumiverse-pack-detail-empty {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    padding: 48px 20px;\n    text-align: center;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-pack-detail-empty svg {\n    opacity: 0.4;\n    margin-bottom: 12px;\n}\n\n.lumiverse-pack-detail-empty p {\n    margin: 0;\n    font-size: 14px;\n}\n\n/* Lumia list */\n.lumiverse-pack-detail-list {\n    display: flex;\n    flex-direction: column;\n    gap: 12px;\n}\n\n/* Lumia card */\n.lumiverse-pack-detail-lumia {\n    background: var(--lumiverse-bg-elevated);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    padding: 14px;\n    transition: border-color var(--lumiverse-transition-fast);\n}\n\n.lumiverse-pack-detail-lumia:hover {\n    border-color: var(--lumiverse-border-hover);\n}\n\n/* Lumia header */\n.lumiverse-pack-detail-lumia-header {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n    margin-bottom: 12px;\n}\n\n.lumiverse-pack-detail-lumia-avatar {\n    width: 44px;\n    height: 44px;\n    border-radius: var(--lumiverse-radius-sm);\n    background: var(--lumiverse-bg-dark);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    flex-shrink: 0;\n    overflow: hidden;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-pack-detail-lumia-avatar img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n}\n\n.lumiverse-pack-detail-lumia-info {\n    flex: 1;\n    min-width: 0;\n}\n\n.lumiverse-pack-detail-lumia-name {\n    margin: 0;\n    font-size: 15px;\n    font-weight: 600;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumiverse-pack-detail-lumia-author {\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n}\n\n/* Traits container */\n.lumiverse-pack-detail-traits {\n    display: flex;\n    flex-direction: column;\n    gap: 6px;\n    margin-bottom: 12px;\n}\n\n/* Trait preview */\n.lumiverse-pack-detail-trait {\n    background: var(--lumiverse-bg-dark);\n    border-radius: var(--lumiverse-radius-sm);\n    overflow: hidden;\n}\n\n.lumiverse-pack-detail-trait-header {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    width: 100%;\n    padding: 8px 12px;\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text);\n    cursor: pointer;\n    transition: background var(--lumiverse-transition-fast);\n    text-align: left;\n}\n\n.lumiverse-pack-detail-trait-header:hover {\n    background: rgba(255, 255, 255, 0.03);\n}\n\n.lumiverse-pack-detail-trait-header--open {\n    background: rgba(255, 255, 255, 0.02);\n}\n\n.lumiverse-pack-detail-trait-icon {\n    color: var(--lumiverse-text-muted);\n    display: flex;\n    align-items: center;\n}\n\n.lumiverse-pack-detail-trait-title {\n    flex: 1;\n    font-size: 13px;\n    font-weight: 500;\n}\n\n.lumiverse-pack-detail-trait-chevron {\n    color: var(--lumiverse-text-dim);\n    display: flex;\n    align-items: center;\n}\n\n.lumiverse-pack-detail-trait-content {\n    padding: 0 12px 12px;\n}\n\n.lumiverse-pack-detail-trait-content p {\n    margin: 0;\n    font-size: 12px;\n    line-height: 1.5;\n    color: var(--lumiverse-text-muted);\n    white-space: pre-wrap;\n    word-break: break-word;\n}\n\n/* Actions */\n.lumiverse-pack-detail-actions {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 8px;\n}\n\n.lumiverse-pack-detail-action {\n    display: flex;\n    align-items: center;\n    gap: 5px;\n    padding: 6px 10px;\n    background: var(--lumiverse-primary-light);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius-sm);\n    color: var(--lumiverse-text);\n    font-size: 12px;\n    font-weight: 500;\n    cursor: pointer;\n    transition: all var(--lumiverse-transition-fast);\n}\n\n.lumiverse-pack-detail-action:hover:not(:disabled) {\n    background: var(--lumiverse-primary);\n    border-color: var(--lumiverse-primary);\n    color: white;\n}\n\n.lumiverse-pack-detail-action:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n}\n\n.lumiverse-pack-detail-action--selected {\n    background: var(--lumiverse-success);\n    border-color: var(--lumiverse-success);\n    color: white;\n    cursor: default;\n}\n\n.lumiverse-pack-detail-action--selected:hover {\n    background: var(--lumiverse-success);\n    border-color: var(--lumiverse-success);\n}\n\n.lumiverse-pack-detail-action--enable-all {\n    background: transparent;\n    border-style: dashed;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-pack-detail-action--enable-all:hover {\n    background: var(--lumiverse-bg-hover);\n    border-color: var(--lumiverse-border-hover);\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-pack-detail-action--enable-all.all-enabled {\n    background: rgba(76, 175, 80, 0.15);\n    border-color: rgba(76, 175, 80, 0.6);\n    border-style: solid;\n    color: rgba(76, 175, 80, 1);\n}\n\n.lumiverse-pack-detail-action--enable-all.all-enabled:hover {\n    background: rgba(76, 175, 80, 0.25);\n    border-color: rgba(76, 175, 80, 0.8);\n}\n\n/* Pack browser - View button */\n.lumiverse-browser-pack-view-btn {\n    width: 28px;\n    height: 28px;\n    border-radius: var(--lumiverse-radius-sm);\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text-dim);\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: all var(--lumiverse-transition-fast);\n    flex-shrink: 0;\n    margin-left: auto;\n    margin-right: 8px;\n}\n\n.lumiverse-browser-pack-view-btn:hover {\n    background: var(--lumiverse-bg-hover);\n    color: var(--lumiverse-primary);\n}\n\n/* Downloaded Packs Section in Settings */\n.lumia-downloaded-packs {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumia-downloaded-pack-item {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n    padding: 10px 12px;\n    background: var(--lumiverse-bg-dark);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    transition: border-color var(--lumiverse-transition-fast);\n}\n\n.lumia-downloaded-pack-item:hover {\n    border-color: var(--lumiverse-border-hover);\n}\n\n.lumia-downloaded-pack-cover {\n    width: 36px;\n    height: 36px;\n    border-radius: var(--lumiverse-radius-sm);\n    object-fit: cover;\n    flex-shrink: 0;\n}\n\n.lumia-downloaded-pack-cover-placeholder {\n    width: 36px;\n    height: 36px;\n    border-radius: var(--lumiverse-radius-sm);\n    background: var(--lumiverse-bg-darker);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    flex-shrink: 0;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumia-downloaded-pack-cover-placeholder svg {\n    width: 18px;\n    height: 18px;\n}\n\n.lumia-downloaded-pack-info {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n    min-width: 0;\n}\n\n.lumia-downloaded-pack-name {\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumia-downloaded-pack-count {\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n}\n\n/* Downloaded Pack Actions */\n.lumia-downloaded-pack-actions {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    flex-shrink: 0;\n}\n\n/* Danger Icon Button */\n.lumia-btn-icon-danger {\n    color: var(--lumiverse-danger);\n    opacity: 0.6;\n}\n\n.lumia-btn-icon-danger:hover {\n    opacity: 1;\n    background: rgba(239, 68, 68, 0.15);\n}\n\n/* Loom Pack Detail Modal Additions */\n.lumiverse-loom-detail-modal {\n    /* Uses same base styles as pack detail modal */\n}\n\n.lumiverse-loom-detail-categories {\n    display: flex;\n    flex-direction: column;\n    gap: 16px;\n}\n\n/* Category section */\n.lumiverse-loom-detail-category {\n    background: var(--lumiverse-bg-elevated);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    overflow: hidden;\n}\n\n.lumiverse-loom-detail-category-header {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    width: 100%;\n    padding: 12px 14px;\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text);\n    cursor: pointer;\n    transition: background var(--lumiverse-transition-fast);\n    text-align: left;\n}\n\n.lumiverse-loom-detail-category-header:hover {\n    background: rgba(255, 255, 255, 0.03);\n}\n\n.lumiverse-loom-detail-category-header--expanded {\n    border-bottom: 1px solid var(--lumiverse-border);\n}\n\n.lumiverse-loom-detail-category-icon {\n    color: var(--lumiverse-primary);\n    display: flex;\n    align-items: center;\n}\n\n.lumiverse-loom-detail-category-title {\n    flex: 1;\n    font-size: 14px;\n    font-weight: 600;\n}\n\n.lumiverse-loom-detail-category-count {\n    font-size: 12px;\n    color: var(--lumiverse-text-muted);\n    background: var(--lumiverse-bg-dark);\n    padding: 2px 8px;\n    border-radius: 10px;\n}\n\n.lumiverse-loom-detail-category-chevron {\n    color: var(--lumiverse-text-dim);\n    display: flex;\n    align-items: center;\n}\n\n.lumiverse-loom-detail-category-items {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n    padding: 12px;\n}\n\n/* Loom item card */\n.lumiverse-loom-detail-item {\n    padding: 10px 12px;\n    border: 1px solid;\n    border-radius: var(--lumiverse-radius-sm);\n    transition: all var(--lumiverse-transition-fast);\n}\n\n.lumiverse-loom-detail-item:hover {\n    transform: translateY(-1px);\n}\n\n.lumiverse-loom-detail-item-header {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n}\n\n.lumiverse-loom-detail-item-icon {\n    color: var(--lumiverse-text-muted);\n    display: flex;\n    align-items: center;\n}\n\n.lumiverse-loom-detail-item-name {\n    flex: 1;\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n}\n\n.lumiverse-loom-detail-item-toggle {\n    width: 24px;\n    height: 24px;\n    border-radius: 50%;\n    background: var(--lumiverse-bg-dark);\n    border: 1px solid var(--lumiverse-border);\n    color: var(--lumiverse-text-muted);\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: all var(--lumiverse-transition-fast);\n}\n\n.lumiverse-loom-detail-item-toggle:hover {\n    background: var(--lumiverse-primary-light);\n    border-color: var(--lumiverse-primary);\n    color: var(--lumiverse-primary);\n}\n\n.lumiverse-loom-detail-item-toggle--selected {\n    background: var(--lumiverse-success);\n    border-color: var(--lumiverse-success);\n    color: white;\n}\n\n.lumiverse-loom-detail-item-toggle--selected:hover {\n    background: var(--lumiverse-danger);\n    border-color: var(--lumiverse-danger);\n}\n\n/* Content preview */\n.lumiverse-loom-detail-content-preview {\n    margin-top: 8px;\n}\n\n.lumiverse-loom-detail-content-toggle {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    padding: 4px 8px;\n    background: transparent;\n    border: none;\n    color: var(--lumiverse-text-dim);\n    font-size: 11px;\n    cursor: pointer;\n    transition: color var(--lumiverse-transition-fast);\n}\n\n.lumiverse-loom-detail-content-toggle:hover {\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-loom-detail-content-toggle--open {\n    color: var(--lumiverse-text-muted);\n}\n\n.lumiverse-loom-detail-content-chevron {\n    display: flex;\n    align-items: center;\n}\n\n.lumiverse-loom-detail-content-text {\n    padding: 8px 12px;\n    background: rgba(0, 0, 0, 0.15);\n    border-radius: var(--lumiverse-radius-sm);\n    margin-top: 6px;\n}\n\n.lumiverse-loom-detail-content-text p {\n    margin: 0;\n    font-size: 12px;\n    line-height: 1.5;\n    color: var(--lumiverse-text-muted);\n    white-space: pre-wrap;\n    word-break: break-word;\n}\n\n/* Loom Packs Section in Settings */\n.lumia-loom-packs {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.lumia-loom-pack-item {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n    padding: 10px 12px;\n    background: var(--lumiverse-bg-dark);\n    border: 1px solid var(--lumiverse-border);\n    border-radius: var(--lumiverse-radius);\n    transition: border-color var(--lumiverse-transition-fast);\n}\n\n.lumia-loom-pack-item:hover {\n    border-color: var(--lumiverse-border-hover);\n}\n\n.lumia-loom-pack-cover {\n    width: 36px;\n    height: 36px;\n    border-radius: var(--lumiverse-radius-sm);\n    object-fit: cover;\n    flex-shrink: 0;\n}\n\n.lumia-loom-pack-cover-placeholder {\n    width: 36px;\n    height: 36px;\n    border-radius: var(--lumiverse-radius-sm);\n    background: var(--lumiverse-bg-darker);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    flex-shrink: 0;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumia-loom-pack-cover-placeholder svg {\n    width: 18px;\n    height: 18px;\n}\n\n.lumia-loom-pack-info {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n    min-width: 0;\n}\n\n.lumia-loom-pack-name {\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--lumiverse-text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.lumia-loom-pack-stats {\n    display: flex;\n    gap: 10px;\n    font-size: 11px;\n    color: var(--lumiverse-text-muted);\n}\n\n.lumia-loom-pack-stats span {\n    display: flex;\n    align-items: center;\n    gap: 3px;\n}\n\n/* Loom Pack Actions */\n.lumia-loom-pack-actions {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    flex-shrink: 0;\n}\n\n/* Mobile responsive */\n@media (max-width: 600px) {\n    .lumiverse-pack-detail-modal {\n        /* Override max-width for mobile */\n        max-width: 94vw;\n    }\n\n    .lumiverse-pack-detail-header {\n        padding: 14px 16px;\n    }\n\n    .lumiverse-pack-detail-header-icon {\n        width: 40px;\n        height: 40px;\n    }\n\n    .lumiverse-pack-detail-title {\n        font-size: 16px;\n    }\n\n    .lumiverse-pack-detail-content {\n        padding: 14px 16px;\n    }\n\n    .lumiverse-pack-detail-lumia {\n        padding: 12px;\n    }\n\n    .lumiverse-pack-detail-lumia-avatar {\n        width: 38px;\n        height: 38px;\n    }\n\n    .lumiverse-pack-detail-lumia-name {\n        font-size: 14px;\n    }\n\n    .lumiverse-pack-detail-actions {\n        gap: 6px;\n    }\n\n    .lumiverse-pack-detail-action {\n        padding: 8px 12px;\n        font-size: 13px;\n    }\n}\n`,""]);const m=u},463(e,n){function t(e,n){var t=e.length;e.push(n);e:for(;0<t;){var i=t-1>>>1,r=e[i];if(!(0<a(r,n)))break e;e[i]=n,e[t]=r,t=i}}function i(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var n=e[0],t=e.pop();if(t!==n){e[0]=t;e:for(var i=0,r=e.length,o=r>>>1;i<o;){var s=2*(i+1)-1,l=e[s],c=s+1,u=e[c];if(0>a(l,t))c<r&&0>a(u,l)?(e[i]=u,e[c]=t,i=c):(e[i]=l,e[s]=t,i=s);else{if(!(c<r&&0>a(u,t)))break e;e[i]=u,e[c]=t,i=c}}}return n}function a(e,n){var t=e.sortIndex-n.sortIndex;return 0!==t?t:e.id-n.id}if("object"==typeof performance&&"function"==typeof performance.now){var o=performance;n.unstable_now=function(){return o.now()}}else{var s=Date,l=s.now();n.unstable_now=function(){return s.now()-l}}var c=[],u=[],d=1,m=null,p=3,h=!1,v=!1,f=!1,g="function"==typeof setTimeout?setTimeout:null,b="function"==typeof clearTimeout?clearTimeout:null,x="undefined"!=typeof setImmediate?setImmediate:null;function y(e){for(var n=i(u);null!==n;){if(null===n.callback)r(u);else{if(!(n.startTime<=e))break;r(u),n.sortIndex=n.expirationTime,t(c,n)}n=i(u)}}function k(e){if(f=!1,y(e),!v)if(null!==i(c))v=!0,D(w);else{var n=i(u);null!==n&&z(k,n.startTime-e)}}function w(e,t){v=!1,f&&(f=!1,b(N),N=-1),h=!0;var a=p;try{for(y(t),m=i(c);null!==m&&(!(m.expirationTime>t)||e&&!M());){var o=m.callback;if("function"==typeof o){m.callback=null,p=m.priorityLevel;var s=o(m.expirationTime<=t);t=n.unstable_now(),"function"==typeof s?m.callback=s:m===i(c)&&r(c),y(t)}else r(c);m=i(c)}if(null!==m)var l=!0;else{var d=i(u);null!==d&&z(k,d.startTime-t),l=!1}return l}finally{m=null,p=a,h=!1}}"undefined"!=typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var j,S=!1,C=null,N=-1,P=5,E=-1;function M(){return!(n.unstable_now()-E<P)}function L(){if(null!==C){var e=n.unstable_now();E=e;var t=!0;try{t=C(!0,e)}finally{t?j():(S=!1,C=null)}}else S=!1}if("function"==typeof x)j=function(){x(L)};else if("undefined"!=typeof MessageChannel){var O=new MessageChannel,T=O.port2;O.port1.onmessage=L,j=function(){T.postMessage(null)}}else j=function(){g(L,0)};function D(e){C=e,S||(S=!0,j())}function z(e,t){N=g(function(){e(n.unstable_now())},t)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(e){e.callback=null},n.unstable_continueExecution=function(){v||h||(v=!0,D(w))},n.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):P=0<e?Math.floor(1e3/e):5},n.unstable_getCurrentPriorityLevel=function(){return p},n.unstable_getFirstCallbackNode=function(){return i(c)},n.unstable_next=function(e){switch(p){case 1:case 2:case 3:var n=3;break;default:n=p}var t=p;p=n;try{return e()}finally{p=t}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(e,n){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var t=p;p=e;try{return n()}finally{p=t}},n.unstable_scheduleCallback=function(e,r,a){var o=n.unstable_now();switch("object"==typeof a&&null!==a?a="number"==typeof(a=a.delay)&&0<a?o+a:o:a=o,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:d++,callback:r,priorityLevel:e,startTime:a,expirationTime:s=a+s,sortIndex:-1},a>o?(e.sortIndex=a,t(u,e),null===i(c)&&e===i(u)&&(f?(b(N),N=-1):f=!0,z(k,a-o))):(e.sortIndex=s,t(c,e),v||h||(v=!0,D(w))),e},n.unstable_shouldYield=M,n.unstable_wrapCallback=function(e){var n=p;return function(){var t=p;p=n;try{return e.apply(this,arguments)}finally{p=t}}}},485(e,n,t){t.d(n,{E:()=>p,Iv:()=>f,Zq:()=>y,__:()=>g,dj:()=>u,tb:()=>k,x$:()=>v});var i=t(92),r=t(674),a=t(100);const o="loom_last_summarized_at";let s=null,l=null,c=!1;function u(){return c}function d(e){h();const n=document.getElementById("chat");if(!n)return;const t=n.querySelector(".mes:last-child");if(!t)return;const i=t.querySelector(".timestamp");if(!i)return;l=t;const r=document.createElement("span");r.className="loom-summary-indicator",r.id="loom-summary-indicator","loading"===e?(r.innerHTML='<span class="loom-summary-spinner"></span><span>Weaving summary...</span>',i.appendChild(r),s=r):"complete"===e?m(t,"complete"):"error"===e&&m(t,"error")}function m(e,n){if(!e)return;const t=e.querySelector(".timestamp");if(!t)return;const r=t.querySelector(".loom-summary-marker");r&&r.remove();const a=document.createElement("span");a.className="loom-summary-marker",a.setAttribute("data-summary-type",n),"complete"===n?(a.classList.add("loom-summary-marker-complete"),a.innerHTML='<svg class="loom-summary-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <ellipse cx="12" cy="12" rx="8" ry="10" stroke="currentColor" stroke-width="1.5" fill="none"/>\n  <ellipse cx="12" cy="12" rx="3" ry="10" stroke="currentColor" stroke-width="1.5" fill="none"/>\n  <line x1="4" y1="8" x2="20" y2="8" stroke="currentColor" stroke-width="1.5"/>\n  <line x1="4" y1="16" x2="20" y2="16" stroke="currentColor" stroke-width="1.5"/>\n  <circle cx="12" cy="12" r="2" fill="currentColor"/>\n</svg>',a.title="Summary woven up to this message"):"error"===n&&(a.classList.add("loom-summary-marker-error"),a.innerHTML='<svg class="loom-summary-icon loom-summary-icon-error" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="1.5" fill="none"/>\n  <path d="M15 9L9 15M9 9L15 15" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>\n</svg>',a.title="Summary generation failed at this message"),t.appendChild(a);const o=function(e){return(null==e?void 0:e.getAttribute("mesid"))||null}(e);o&&function(e,n){var t;const r=(0,i.SD)();if(null==r||!r.chatMetadata)return;r.chatMetadata.loom_summary_marker={mesId:e,type:n,timestamp:Date.now()},null===(t=r.saveMetadata)||void 0===t||t.call(r)}(o,n)}function p(){var e;const n=(0,i.SD)();if(null==n||null===(e=n.chatMetadata)||void 0===e||!e.loom_summary_marker)return;const t=n.chatMetadata.loom_summary_marker;if(!t.mesId)return;const r=(a=t.mesId)?document.querySelector('.mes[mesid="'.concat(a,'"]')):null;var a;r&&m(r,t.type)}function h(){s&&(s.remove(),s=null);const e=document.getElementById("loom-summary-indicator");e&&e.remove()}const v={openai:{name:"OpenAI",endpoint:"https://api.openai.com/v1/chat/completions",secretKey:"api_key_openai",placeholder:"gpt-4o-mini",format:"openai"},anthropic:{name:"Anthropic Claude",endpoint:"https://api.anthropic.com/v1/messages",secretKey:"api_key_claude",placeholder:"claude-sonnet-4-5-20250929",format:"anthropic"},openrouter:{name:"OpenRouter",endpoint:"https://openrouter.ai/api/v1/chat/completions",secretKey:"api_key_openrouter",placeholder:"openai/gpt-4o-mini",format:"openai"},google:{name:"Google AI Studio",endpoint:"https://generativelanguage.googleapis.com/v1beta/models",secretKey:"api_key_makersuite",placeholder:"gemini-2.0-flash",format:"google"},chutes:{name:"Chutes",endpoint:"https://llm.chutes.ai/v1/chat/completions",secretKey:"api_key_chutes",placeholder:"deepseek-ai/DeepSeek-V3",format:"openai"},electronhub:{name:"ElectronHub",endpoint:"https://api.electronhub.ai/v1/chat/completions",secretKey:"api_key_electronhub",placeholder:"gpt-4o-mini",format:"openai"},nanogpt:{name:"NanoGPT",endpoint:"https://nano-gpt.com/api/v1/chat/completions",secretKey:"api_key_nanogpt",placeholder:"chatgpt-4o-latest",format:"openai"},zai:{name:"Z.AI",endpoint:"https://api.z.ai/api/paas/v4/chat/completions",secretKey:"api_key_zai",placeholder:"gpt-4o-mini",format:"openai"},custom:{name:"Custom (OpenAI Compatible)",endpoint:"",secretKey:null,placeholder:"your-model-id",format:"openai"}};function f(e){return v[e]||v.custom}function g(e){const n=f(e);return{endpoint:n.endpoint,placeholder:n.placeholder}}function b(e){var n;const t=(0,i.SD)();if(!t||!t.chat)return null;const o=t.chat.slice(-e);if(0===o.length)return null;const s=(null===(n=t.chatMetadata)||void 0===n?void 0:n[r.zA])||"",l=(0,a.J3)(),c=(0,a.K$)(),u=(0,a.N4)(),d=c?(0,a.U3)():[];let m;if(c){const e=d.length>0?d.join(", "):"group members";m="Track evolving dynamics between characters (".concat(e,") and between characters and ").concat(l,". Trust, tension, affection, rivalry. (NEVER track ").concat(l,"'s internal state—only how characters perceive or relate to them.)")}else m="Track evolving dynamics between ".concat(u," and ").concat(l,", as well as any NPCs. Trust, tension, affection, rivalry. (NEVER track ").concat(l,"'s internal state—only how characters perceive or relate to them.)");let p="";o.forEach(e=>{const n=e.is_user?e.name||"User":e.name||"Character";let t=e.mes||e.content||"";t=t.replace(/<loom_sum>[\s\S]*?<\/loom_sum>/gi,"").trim(),t&&(p+="".concat(n,": ").concat(t,"\n\n"))});return{systemPrompt:"You are a Lucid Loom narrative archivist for interactive fiction and roleplay. Your task is to weave comprehensive story summaries that maintain narrative continuity while capturing the essence of the tale.\n\nYour summary MUST use this exact structured format with clear headers:\n\n**Completed Objectives** (MAX 7 items)\nStory beats and arcs that have already concluded. Plot points resolved, conflicts addressed, milestones reached.\n\n**Focused Objectives** (MAX 5 items)\nActive story threads requiring attention. These can shift or be deviated from at any time but represent current narrative focus.\n\n**Foreshadowing Beats** (MAX 5 items)\nEvents hinted at or seeded in recent story beats. Potential future complications, promises made, warnings given.\n\n**Character Developments** (MAX 7 items total)\nTrack meaningful changes in personality, beliefs, skills, or emotional state for each character (NEVER ".concat(l,").\n\n**Memorable Actions** (MAX 7 items)\nPhysical actions of significance—combat moves, gestures, gifts exchanged, locations visited. Details that may matter later.\n\n**Memorable Dialogues** (MAX 5 items)\nWords that left a mark. Confessions, promises, threats, revelations, or simply beautiful turns of phrase.\n\n**Relationships** (MAX 5 items)\n").concat(m,'\n\nCRITICAL GUIDELINES:\n- Use bullet points under each header for clarity—avoid walls of text\n- Be precise and detailed, never sacrifice important information\n- Be concise, never pad with redundant or obvious observations\n- If a category has no relevant content, write "None at present" rather than inventing filler\n- NEVER track or summarize ').concat(l,"'s thoughts, feelings, or internal state\n- RESPECT ITEM LIMITS: Each category has a maximum item count. When at capacity, remove the oldest or least relevant item to make room for new ones\n- PRESERVE IMPORTANT HISTORY: When removing items, prioritize keeping entries that have ongoing narrative relevance (active plot threads, unresolved tensions, recurring themes)\n- CONSOLIDATE when possible: Combine related items into single, more comprehensive bullet points rather than having many fragmented entries"),userPrompt:"".concat(s?"**PREVIOUS LOOM SUMMARY** (use this as your foundation—do NOT discard important information):\n".concat(s,"\n\n---\n\n**MERGE INSTRUCTIONS:**\n- Start with ALL existing entries from the previous summary\n- Add new developments from the recent events below\n- When a category exceeds its item limit, consolidate related items or remove the least narratively relevant\n- NEVER silently drop items that still have ongoing relevance (active conflicts, unresolved threads, important relationships)\n- If an item from the previous summary is still relevant but needs updating, modify it rather than removing it\n\n---\n\n"):"","**RECENT STORY EVENTS** to weave into the summary:\n\n").concat(p,"\n\nProvide an updated Loom Summary incorporating these new events. Use the exact structured format with all seven headers. Output ONLY the summary content—no meta-commentary or additional formatting.")}}async function x(e,n){const t=e.secondary||{},a=t.provider||"openai",o=t.model,s=t.temperature||.7,l=void 0!==t.topP?t.topP:1,c=t.maxTokens||8192;if(!o)throw new Error("No model specified for secondary LLM");const u=f(a);let d;if("custom"===a){if(d=t.apiKey,!d)throw new Error("No API key specified for custom provider")}else if(d=await async function(e){if(!e)return null;try{const n=await fetch("/api/secrets/find",{method:"POST",headers:(0,i.oO)(),body:JSON.stringify({key:e})});return n.ok?(await n.json()).value||null:(console.warn("[".concat(r.pW,"] Could not fetch secret key: ").concat(e," (status: ").concat(n.status,")")),null)}catch(e){return console.error("[".concat(r.pW,"] Error fetching secret key:"),e),null}}(u.secretKey),!d)throw new Error("No API key found for ".concat(u.name,". Please add your API key in SillyTavern's API settings."));const m=b(n);if(!m)throw new Error("No chat messages to summarize");const p="custom"===a?t.endpoint:u.endpoint;if(!p)throw new Error("No endpoint specified for secondary LLM");let h;if(console.log("[".concat(r.pW,"] Generating summary with ").concat(u.name,"...")),"anthropic"===u.format){const e=(0,r.mt)(),n=(0,r.X7)(),t={model:o,max_tokens:c,system:e.disableAnthropicCache?[{type:"text",text:m.systemPrompt,cache_control:{type:"ephemeral"}}]:m.systemPrompt,messages:[{role:"user",content:m.userPrompt}],temperature:s,metadata:{lumia_config_version:String(n)}};l>0&&l<1&&(t.top_p=l);const i={"Content-Type":"application/json","x-api-key":d,"anthropic-version":"2023-06-01"};if(e.disableAnthropicCache&&(i["anthropic-beta"]="prompt-caching-2024-07-31",console.log("[".concat(r.pW,"] Cache busting enabled for this request (Lumia config v").concat(n,")"))),h=await fetch(p,{method:"POST",headers:i,body:JSON.stringify(t)}),!h.ok){const e=await h.text().catch(()=>"Unable to read error");throw new Error("Anthropic API error: ".concat(h.status," - ").concat(e))}const a=await h.json();if(a.content&&Array.isArray(a.content)){const e=a.content.find(e=>"text"===e.type);return(null==e?void 0:e.text)||""}return""}if("google"===u.format){var v;const e="".concat(p,"/").concat(o,":generateContent"),n={safetySettings:[{category:"HARM_CATEGORY_HARASSMENT",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_HATE_SPEECH",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_SEXUALLY_EXPLICIT",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_DANGEROUS_CONTENT",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_CIVIC_INTEGRITY",threshold:"BLOCK_NONE"}],contents:[{role:"user",parts:[{text:"".concat(m.systemPrompt,"\n\n---\n\n").concat(m.userPrompt)}]}],generationConfig:{temperature:s,maxOutputTokens:c}};if(l>0&&l<1&&(n.generationConfig.topP=l),h=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json","x-goog-api-key":d},body:JSON.stringify(n)}),!h.ok){const e=await h.text().catch(()=>"Unable to read error");throw new Error("Google AI Studio API error: ".concat(h.status," - ").concat(e))}const t=await h.json();return null!==(v=t.candidates)&&void 0!==v&&null!==(v=v[0])&&void 0!==v&&null!==(v=v.content)&&void 0!==v&&null!==(v=v.parts)&&void 0!==v&&null!==(v=v[0])&&void 0!==v&&v.text?t.candidates[0].content.parts[0].text:""}{var g;const e={"Content-Type":"application/json",Authorization:"Bearer ".concat(d)};"openrouter"===a&&(e["HTTP-Referer"]=window.location.origin,e["X-Title"]="Lumia Injector");const n={model:o,messages:[{role:"system",content:m.systemPrompt},{role:"user",content:m.userPrompt}],temperature:s,max_tokens:c};if(l>0&&l<1&&(n.top_p=l),h=await fetch(p,{method:"POST",headers:e,body:JSON.stringify(n)}),!h.ok){const e=await h.text().catch(()=>"Unable to read error");throw new Error("".concat(u.name," API error: ").concat(h.status," - ").concat(e))}const t=await h.json();return null!==(g=t.choices)&&void 0!==g&&null!==(g=g[0])&&void 0!==g&&null!==(g=g.message)&&void 0!==g&&g.content?t.choices[0].message.content:""}}async function y(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const a=(0,r.mt)(),s=e||a.summarization;if(!s)return console.log("[".concat(r.pW,"] Summarization not configured")),null;const l=(0,i.SD)();if(!l||!l.chat||0===l.chat.length)return console.log("[".concat(r.pW,"] No chat to summarize")),null;const c=n?s.manualMessageContext||10:s.autoMessageContext||10;console.log("[".concat(r.pW,"] Using ").concat(n?"manual":"auto"," message context: ").concat(c," messages")),t&&d("loading");try{let e;if("main"===s.apiSource)e=await async function(e,n){const{generateRaw:t}=(0,i.SD)();if(!t)throw new Error("generateRaw not available - is SillyTavern properly loaded?");const a=b(n);if(!a)throw new Error("No chat messages to summarize");return console.log("[".concat(r.pW,"] Generating summary with Main API...")),await t({systemPrompt:a.systemPrompt,prompt:a.userPrompt,prefill:""})}(0,c);else{if("secondary"!==s.apiSource)throw t&&d("error","Invalid API source"),new Error("Unknown API source: ".concat(s.apiSource));e=await x(s,c)}return e&&e.trim()?(l.chatMetadata[r.zA]=e.trim(),function(e){const n=(0,i.SD)();null!=n&&n.chatMetadata&&(n.chatMetadata[o]={messageCount:e,timestamp:Date.now()})}(l.chat.length),await l.saveMetadata(),console.log("[".concat(r.pW,"] Summary saved to chat metadata at message ").concat(l.chat.length)),t&&d("complete"),e.trim()):(t&&h(),null)}catch(e){throw console.error("[".concat(r.pW,"] Summary generation failed:"),e),t&&d("error"),e}}function k(){if(c)return;const e=(0,r.mt)().summarization;if(!e||"auto"!==e.mode)return;const n=(0,i.SD)();if(!n||!n.chat)return;const a=e.autoInterval||10,s=n.chat.length,l=function(){var e;const n=(0,i.SD)();return null!=n&&null!==(e=n.chatMetadata)&&void 0!==e&&e[o]&&n.chatMetadata[o].messageCount||0}(),u=s-l;s>=a&&u>=a&&(console.log("[".concat(r.pW,"] Auto-summarization triggered: ").concat(u," messages since last summary (at ").concat(l,"), current count: ").concat(s)),c=!0,Promise.resolve().then(t.bind(t,932)).then(e=>{let{updateLoomSummaryButtonState:n}=e;n()}).catch(()=>{}),y(null,!1,!0).then(e=>{c=!1,Promise.resolve().then(t.bind(t,932)).then(e=>{let{updateLoomSummaryButtonState:n}=e;n()}).catch(()=>{}),e&&toastr.info("Loom summary updated automatically")}).catch(e=>{c=!1,Promise.resolve().then(t.bind(t,932)).then(e=>{let{updateLoomSummaryButtonState:n}=e;n()}).catch(()=>{}),console.error("[".concat(r.pW,"] Auto-summarization failed:"),e)}))}},540(e,n,t){e.exports=t(287)},551(e,n,t){var i=t(540),r=t(982);function a(e){for(var n="https://reactjs.org/docs/error-decoder.html?invariant="+e,t=1;t<arguments.length;t++)n+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+e+"; visit "+n+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,s={};function l(e,n){c(e,n),c(e+"Capture",n)}function c(e,n){for(s[e]=n,e=0;e<n.length;e++)o.add(n[e])}var u=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),d=Object.prototype.hasOwnProperty,m=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},h={};function v(e,n,t,i,r,a,o){this.acceptsBooleans=2===n||3===n||4===n,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=t,this.propertyName=e,this.type=n,this.sanitizeURL=a,this.removeEmptyString=o}var f={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){f[e]=new v(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var n=e[0];f[n]=new v(n,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){f[e]=new v(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){f[e]=new v(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){f[e]=new v(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){f[e]=new v(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){f[e]=new v(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){f[e]=new v(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){f[e]=new v(e,5,!1,e.toLowerCase(),null,!1,!1)});var g=/[\-:]([a-z])/g;function b(e){return e[1].toUpperCase()}function x(e,n,t,i){var r=f.hasOwnProperty(n)?f[n]:null;(null!==r?0!==r.type:i||!(2<n.length)||"o"!==n[0]&&"O"!==n[0]||"n"!==n[1]&&"N"!==n[1])&&(function(e,n,t,i){if(null==n||function(e,n,t,i){if(null!==t&&0===t.type)return!1;switch(typeof n){case"function":case"symbol":return!0;case"boolean":return!i&&(null!==t?!t.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,n,t,i))return!0;if(i)return!1;if(null!==t)switch(t.type){case 3:return!n;case 4:return!1===n;case 5:return isNaN(n);case 6:return isNaN(n)||1>n}return!1}(n,t,r,i)&&(t=null),i||null===r?function(e){return!!d.call(h,e)||!d.call(p,e)&&(m.test(e)?h[e]=!0:(p[e]=!0,!1))}(n)&&(null===t?e.removeAttribute(n):e.setAttribute(n,""+t)):r.mustUseProperty?e[r.propertyName]=null===t?3!==r.type&&"":t:(n=r.attributeName,i=r.attributeNamespace,null===t?e.removeAttribute(n):(t=3===(r=r.type)||4===r&&!0===t?"":""+t,i?e.setAttributeNS(i,n,t):e.setAttribute(n,t))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var n=e.replace(g,b);f[n]=new v(n,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var n=e.replace(g,b);f[n]=new v(n,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var n=e.replace(g,b);f[n]=new v(n,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){f[e]=new v(e,1,!1,e.toLowerCase(),null,!1,!1)}),f.xlinkHref=new v("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){f[e]=new v(e,1,!1,e.toLowerCase(),null,!0,!0)});var y=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,k=Symbol.for("react.element"),w=Symbol.for("react.portal"),j=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),C=Symbol.for("react.profiler"),N=Symbol.for("react.provider"),P=Symbol.for("react.context"),E=Symbol.for("react.forward_ref"),M=Symbol.for("react.suspense"),L=Symbol.for("react.suspense_list"),O=Symbol.for("react.memo"),T=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var D=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var z=Symbol.iterator;function I(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=z&&e[z]||e["@@iterator"])?e:null}var A,R=Object.assign;function B(e){if(void 0===A)try{throw Error()}catch(e){var n=e.stack.trim().match(/\n( *(at )?)/);A=n&&n[1]||""}return"\n"+A+e}var _=!1;function U(e,n){if(!e||_)return"";_=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(n)if(n=function(){throw Error()},Object.defineProperty(n.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(n,[])}catch(e){var i=e}Reflect.construct(e,[],n)}else{try{n.call()}catch(e){i=e}e.call(n.prototype)}else{try{throw Error()}catch(e){i=e}e()}}catch(n){if(n&&i&&"string"==typeof n.stack){for(var r=n.stack.split("\n"),a=i.stack.split("\n"),o=r.length-1,s=a.length-1;1<=o&&0<=s&&r[o]!==a[s];)s--;for(;1<=o&&0<=s;o--,s--)if(r[o]!==a[s]){if(1!==o||1!==s)do{if(o--,0>--s||r[o]!==a[s]){var l="\n"+r[o].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=o&&0<=s);break}}}finally{_=!1,Error.prepareStackTrace=t}return(e=e?e.displayName||e.name:"")?B(e):""}function F(e){switch(e.tag){case 5:return B(e.type);case 16:return B("Lazy");case 13:return B("Suspense");case 19:return B("SuspenseList");case 0:case 2:case 15:return e=U(e.type,!1);case 11:return e=U(e.type.render,!1);case 1:return e=U(e.type,!0);default:return""}}function V(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case j:return"Fragment";case w:return"Portal";case C:return"Profiler";case S:return"StrictMode";case M:return"Suspense";case L:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case P:return(e.displayName||"Context")+".Consumer";case N:return(e._context.displayName||"Context")+".Provider";case E:var n=e.render;return(e=e.displayName)||(e=""!==(e=n.displayName||n.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case O:return null!==(n=e.displayName||null)?n:V(e.type)||"Memo";case T:n=e._payload,e=e._init;try{return V(e(n))}catch(e){}}return null}function W(e){var n=e.type;switch(e.tag){case 24:return"Cache";case 9:return(n.displayName||"Context")+".Consumer";case 10:return(n._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=n.render).displayName||e.name||"",n.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return n;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return V(n);case 8:return n===S?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"==typeof n)return n.displayName||n.name||null;if("string"==typeof n)return n}return null}function H(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function $(e){var n=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===n||"radio"===n)}function q(e){e._valueTracker||(e._valueTracker=function(e){var n=$(e)?"checked":"value",t=Object.getOwnPropertyDescriptor(e.constructor.prototype,n),i=""+e[n];if(!e.hasOwnProperty(n)&&void 0!==t&&"function"==typeof t.get&&"function"==typeof t.set){var r=t.get,a=t.set;return Object.defineProperty(e,n,{configurable:!0,get:function(){return r.call(this)},set:function(e){i=""+e,a.call(this,e)}}),Object.defineProperty(e,n,{enumerable:t.enumerable}),{getValue:function(){return i},setValue:function(e){i=""+e},stopTracking:function(){e._valueTracker=null,delete e[n]}}}}(e))}function Y(e){if(!e)return!1;var n=e._valueTracker;if(!n)return!0;var t=n.getValue(),i="";return e&&(i=$(e)?e.checked?"true":"false":e.value),(e=i)!==t&&(n.setValue(e),!0)}function K(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(n){return e.body}}function G(e,n){var t=n.checked;return R({},n,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=t?t:e._wrapperState.initialChecked})}function Q(e,n){var t=null==n.defaultValue?"":n.defaultValue,i=null!=n.checked?n.checked:n.defaultChecked;t=H(null!=n.value?n.value:t),e._wrapperState={initialChecked:i,initialValue:t,controlled:"checkbox"===n.type||"radio"===n.type?null!=n.checked:null!=n.value}}function X(e,n){null!=(n=n.checked)&&x(e,"checked",n,!1)}function Z(e,n){X(e,n);var t=H(n.value),i=n.type;if(null!=t)"number"===i?(0===t&&""===e.value||e.value!=t)&&(e.value=""+t):e.value!==""+t&&(e.value=""+t);else if("submit"===i||"reset"===i)return void e.removeAttribute("value");n.hasOwnProperty("value")?ee(e,n.type,t):n.hasOwnProperty("defaultValue")&&ee(e,n.type,H(n.defaultValue)),null==n.checked&&null!=n.defaultChecked&&(e.defaultChecked=!!n.defaultChecked)}function J(e,n,t){if(n.hasOwnProperty("value")||n.hasOwnProperty("defaultValue")){var i=n.type;if(!("submit"!==i&&"reset"!==i||void 0!==n.value&&null!==n.value))return;n=""+e._wrapperState.initialValue,t||n===e.value||(e.value=n),e.defaultValue=n}""!==(t=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==t&&(e.name=t)}function ee(e,n,t){"number"===n&&K(e.ownerDocument)===e||(null==t?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+t&&(e.defaultValue=""+t))}var ne=Array.isArray;function te(e,n,t,i){if(e=e.options,n){n={};for(var r=0;r<t.length;r++)n["$"+t[r]]=!0;for(t=0;t<e.length;t++)r=n.hasOwnProperty("$"+e[t].value),e[t].selected!==r&&(e[t].selected=r),r&&i&&(e[t].defaultSelected=!0)}else{for(t=""+H(t),n=null,r=0;r<e.length;r++){if(e[r].value===t)return e[r].selected=!0,void(i&&(e[r].defaultSelected=!0));null!==n||e[r].disabled||(n=e[r])}null!==n&&(n.selected=!0)}}function ie(e,n){if(null!=n.dangerouslySetInnerHTML)throw Error(a(91));return R({},n,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function re(e,n){var t=n.value;if(null==t){if(t=n.children,n=n.defaultValue,null!=t){if(null!=n)throw Error(a(92));if(ne(t)){if(1<t.length)throw Error(a(93));t=t[0]}n=t}null==n&&(n=""),t=n}e._wrapperState={initialValue:H(t)}}function ae(e,n){var t=H(n.value),i=H(n.defaultValue);null!=t&&((t=""+t)!==e.value&&(e.value=t),null==n.defaultValue&&e.defaultValue!==t&&(e.defaultValue=t)),null!=i&&(e.defaultValue=""+i)}function oe(e){var n=e.textContent;n===e._wrapperState.initialValue&&""!==n&&null!==n&&(e.value=n)}function se(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function le(e,n){return null==e||"http://www.w3.org/1999/xhtml"===e?se(n):"http://www.w3.org/2000/svg"===e&&"foreignObject"===n?"http://www.w3.org/1999/xhtml":e}var ce,ue,de=(ue=function(e,n){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=n;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+n.valueOf().toString()+"</svg>",n=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;n.firstChild;)e.appendChild(n.firstChild)}},"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,n,t,i){MSApp.execUnsafeLocalFunction(function(){return ue(e,n)})}:ue);function me(e,n){if(n){var t=e.firstChild;if(t&&t===e.lastChild&&3===t.nodeType)return void(t.nodeValue=n)}e.textContent=n}var pe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},he=["Webkit","ms","Moz","O"];function ve(e,n,t){return null==n||"boolean"==typeof n||""===n?"":t||"number"!=typeof n||0===n||pe.hasOwnProperty(e)&&pe[e]?(""+n).trim():n+"px"}function fe(e,n){for(var t in e=e.style,n)if(n.hasOwnProperty(t)){var i=0===t.indexOf("--"),r=ve(t,n[t],i);"float"===t&&(t="cssFloat"),i?e.setProperty(t,r):e[t]=r}}Object.keys(pe).forEach(function(e){he.forEach(function(n){n=n+e.charAt(0).toUpperCase()+e.substring(1),pe[n]=pe[e]})});var ge=R({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function be(e,n){if(n){if(ge[e]&&(null!=n.children||null!=n.dangerouslySetInnerHTML))throw Error(a(137,e));if(null!=n.dangerouslySetInnerHTML){if(null!=n.children)throw Error(a(60));if("object"!=typeof n.dangerouslySetInnerHTML||!("__html"in n.dangerouslySetInnerHTML))throw Error(a(61))}if(null!=n.style&&"object"!=typeof n.style)throw Error(a(62))}}function xe(e,n){if(-1===e.indexOf("-"))return"string"==typeof n.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ye=null;function ke(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var we=null,je=null,Se=null;function Ce(e){if(e=xr(e)){if("function"!=typeof we)throw Error(a(280));var n=e.stateNode;n&&(n=kr(n),we(e.stateNode,e.type,n))}}function Ne(e){je?Se?Se.push(e):Se=[e]:je=e}function Pe(){if(je){var e=je,n=Se;if(Se=je=null,Ce(e),n)for(e=0;e<n.length;e++)Ce(n[e])}}function Ee(e,n){return e(n)}function Me(){}var Le=!1;function Oe(e,n,t){if(Le)return e(n,t);Le=!0;try{return Ee(e,n,t)}finally{Le=!1,(null!==je||null!==Se)&&(Me(),Pe())}}function Te(e,n){var t=e.stateNode;if(null===t)return null;var i=kr(t);if(null===i)return null;t=i[n];e:switch(n){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(i=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!i;break e;default:e=!1}if(e)return null;if(t&&"function"!=typeof t)throw Error(a(231,n,typeof t));return t}var De=!1;if(u)try{var ze={};Object.defineProperty(ze,"passive",{get:function(){De=!0}}),window.addEventListener("test",ze,ze),window.removeEventListener("test",ze,ze)}catch(ue){De=!1}function Ie(e,n,t,i,r,a,o,s,l){var c=Array.prototype.slice.call(arguments,3);try{n.apply(t,c)}catch(e){this.onError(e)}}var Ae=!1,Re=null,Be=!1,_e=null,Ue={onError:function(e){Ae=!0,Re=e}};function Fe(e,n,t,i,r,a,o,s,l){Ae=!1,Re=null,Ie.apply(Ue,arguments)}function Ve(e){var n=e,t=e;if(e.alternate)for(;n.return;)n=n.return;else{e=n;do{!!(4098&(n=e).flags)&&(t=n.return),e=n.return}while(e)}return 3===n.tag?t:null}function We(e){if(13===e.tag){var n=e.memoizedState;if(null===n&&(null!==(e=e.alternate)&&(n=e.memoizedState)),null!==n)return n.dehydrated}return null}function He(e){if(Ve(e)!==e)throw Error(a(188))}function $e(e){return null!==(e=function(e){var n=e.alternate;if(!n){if(null===(n=Ve(e)))throw Error(a(188));return n!==e?null:e}for(var t=e,i=n;;){var r=t.return;if(null===r)break;var o=r.alternate;if(null===o){if(null!==(i=r.return)){t=i;continue}break}if(r.child===o.child){for(o=r.child;o;){if(o===t)return He(r),e;if(o===i)return He(r),n;o=o.sibling}throw Error(a(188))}if(t.return!==i.return)t=r,i=o;else{for(var s=!1,l=r.child;l;){if(l===t){s=!0,t=r,i=o;break}if(l===i){s=!0,i=r,t=o;break}l=l.sibling}if(!s){for(l=o.child;l;){if(l===t){s=!0,t=o,i=r;break}if(l===i){s=!0,i=o,t=r;break}l=l.sibling}if(!s)throw Error(a(189))}}if(t.alternate!==i)throw Error(a(190))}if(3!==t.tag)throw Error(a(188));return t.stateNode.current===t?e:n}(e))?qe(e):null}function qe(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var n=qe(e);if(null!==n)return n;e=e.sibling}return null}var Ye=r.unstable_scheduleCallback,Ke=r.unstable_cancelCallback,Ge=r.unstable_shouldYield,Qe=r.unstable_requestPaint,Xe=r.unstable_now,Ze=r.unstable_getCurrentPriorityLevel,Je=r.unstable_ImmediatePriority,en=r.unstable_UserBlockingPriority,nn=r.unstable_NormalPriority,tn=r.unstable_LowPriority,rn=r.unstable_IdlePriority,an=null,on=null;var sn=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(ln(e)/cn|0)|0},ln=Math.log,cn=Math.LN2;var un=64,dn=4194304;function mn(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function pn(e,n){var t=e.pendingLanes;if(0===t)return 0;var i=0,r=e.suspendedLanes,a=e.pingedLanes,o=268435455&t;if(0!==o){var s=o&~r;0!==s?i=mn(s):0!==(a&=o)&&(i=mn(a))}else 0!==(o=t&~r)?i=mn(o):0!==a&&(i=mn(a));if(0===i)return 0;if(0!==n&&n!==i&&0===(n&r)&&((r=i&-i)>=(a=n&-n)||16===r&&4194240&a))return n;if(4&i&&(i|=16&t),0!==(n=e.entangledLanes))for(e=e.entanglements,n&=i;0<n;)r=1<<(t=31-sn(n)),i|=e[t],n&=~r;return i}function hn(e,n){switch(e){case 1:case 2:case 4:return n+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n+5e3;default:return-1}}function vn(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function fn(){var e=un;return!(4194240&(un<<=1))&&(un=64),e}function gn(e){for(var n=[],t=0;31>t;t++)n.push(e);return n}function bn(e,n,t){e.pendingLanes|=n,536870912!==n&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[n=31-sn(n)]=t}function xn(e,n){var t=e.entangledLanes|=n;for(e=e.entanglements;t;){var i=31-sn(t),r=1<<i;r&n|e[i]&n&&(e[i]|=n),t&=~r}}var yn=0;function kn(e){return 1<(e&=-e)?4<e?268435455&e?16:536870912:4:1}var wn,jn,Sn,Cn,Nn,Pn=!1,En=[],Mn=null,Ln=null,On=null,Tn=new Map,Dn=new Map,zn=[],In="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function An(e,n){switch(e){case"focusin":case"focusout":Mn=null;break;case"dragenter":case"dragleave":Ln=null;break;case"mouseover":case"mouseout":On=null;break;case"pointerover":case"pointerout":Tn.delete(n.pointerId);break;case"gotpointercapture":case"lostpointercapture":Dn.delete(n.pointerId)}}function Rn(e,n,t,i,r,a){return null===e||e.nativeEvent!==a?(e={blockedOn:n,domEventName:t,eventSystemFlags:i,nativeEvent:a,targetContainers:[r]},null!==n&&(null!==(n=xr(n))&&jn(n)),e):(e.eventSystemFlags|=i,n=e.targetContainers,null!==r&&-1===n.indexOf(r)&&n.push(r),e)}function Bn(e){var n=br(e.target);if(null!==n){var t=Ve(n);if(null!==t)if(13===(n=t.tag)){if(null!==(n=We(t)))return e.blockedOn=n,void Nn(e.priority,function(){Sn(t)})}else if(3===n&&t.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===t.tag?t.stateNode.containerInfo:null)}e.blockedOn=null}function _n(e){if(null!==e.blockedOn)return!1;for(var n=e.targetContainers;0<n.length;){var t=Qn(e.domEventName,e.eventSystemFlags,n[0],e.nativeEvent);if(null!==t)return null!==(n=xr(t))&&jn(n),e.blockedOn=t,!1;var i=new(t=e.nativeEvent).constructor(t.type,t);ye=i,t.target.dispatchEvent(i),ye=null,n.shift()}return!0}function Un(e,n,t){_n(e)&&t.delete(n)}function Fn(){Pn=!1,null!==Mn&&_n(Mn)&&(Mn=null),null!==Ln&&_n(Ln)&&(Ln=null),null!==On&&_n(On)&&(On=null),Tn.forEach(Un),Dn.forEach(Un)}function Vn(e,n){e.blockedOn===n&&(e.blockedOn=null,Pn||(Pn=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,Fn)))}function Wn(e){function n(n){return Vn(n,e)}if(0<En.length){Vn(En[0],e);for(var t=1;t<En.length;t++){var i=En[t];i.blockedOn===e&&(i.blockedOn=null)}}for(null!==Mn&&Vn(Mn,e),null!==Ln&&Vn(Ln,e),null!==On&&Vn(On,e),Tn.forEach(n),Dn.forEach(n),t=0;t<zn.length;t++)(i=zn[t]).blockedOn===e&&(i.blockedOn=null);for(;0<zn.length&&null===(t=zn[0]).blockedOn;)Bn(t),null===t.blockedOn&&zn.shift()}var Hn=y.ReactCurrentBatchConfig,$n=!0;function qn(e,n,t,i){var r=yn,a=Hn.transition;Hn.transition=null;try{yn=1,Kn(e,n,t,i)}finally{yn=r,Hn.transition=a}}function Yn(e,n,t,i){var r=yn,a=Hn.transition;Hn.transition=null;try{yn=4,Kn(e,n,t,i)}finally{yn=r,Hn.transition=a}}function Kn(e,n,t,i){if($n){var r=Qn(e,n,t,i);if(null===r)Hi(e,n,i,Gn,t),An(e,i);else if(function(e,n,t,i,r){switch(n){case"focusin":return Mn=Rn(Mn,e,n,t,i,r),!0;case"dragenter":return Ln=Rn(Ln,e,n,t,i,r),!0;case"mouseover":return On=Rn(On,e,n,t,i,r),!0;case"pointerover":var a=r.pointerId;return Tn.set(a,Rn(Tn.get(a)||null,e,n,t,i,r)),!0;case"gotpointercapture":return a=r.pointerId,Dn.set(a,Rn(Dn.get(a)||null,e,n,t,i,r)),!0}return!1}(r,e,n,t,i))i.stopPropagation();else if(An(e,i),4&n&&-1<In.indexOf(e)){for(;null!==r;){var a=xr(r);if(null!==a&&wn(a),null===(a=Qn(e,n,t,i))&&Hi(e,n,i,Gn,t),a===r)break;r=a}null!==r&&i.stopPropagation()}else Hi(e,n,i,null,t)}}var Gn=null;function Qn(e,n,t,i){if(Gn=null,null!==(e=br(e=ke(i))))if(null===(n=Ve(e)))e=null;else if(13===(t=n.tag)){if(null!==(e=We(n)))return e;e=null}else if(3===t){if(n.stateNode.current.memoizedState.isDehydrated)return 3===n.tag?n.stateNode.containerInfo:null;e=null}else n!==e&&(e=null);return Gn=e,null}function Xn(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ze()){case Je:return 1;case en:return 4;case nn:case tn:return 16;case rn:return 536870912;default:return 16}default:return 16}}var Zn=null,Jn=null,et=null;function nt(){if(et)return et;var e,n,t=Jn,i=t.length,r="value"in Zn?Zn.value:Zn.textContent,a=r.length;for(e=0;e<i&&t[e]===r[e];e++);var o=i-e;for(n=1;n<=o&&t[i-n]===r[a-n];n++);return et=r.slice(e,1<n?1-n:void 0)}function tt(e){var n=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===n&&(e=13):e=n,10===e&&(e=13),32<=e||13===e?e:0}function it(){return!0}function rt(){return!1}function at(e){function n(n,t,i,r,a){for(var o in this._reactName=n,this._targetInst=i,this.type=t,this.nativeEvent=r,this.target=a,this.currentTarget=null,e)e.hasOwnProperty(o)&&(n=e[o],this[o]=n?n(r):r[o]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?it:rt,this.isPropagationStopped=rt,this}return R(n.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=it)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=it)},persist:function(){},isPersistent:it}),n}var ot,st,lt,ct={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ut=at(ct),dt=R({},ct,{view:0,detail:0}),mt=at(dt),pt=R({},dt,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ct,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==lt&&(lt&&"mousemove"===e.type?(ot=e.screenX-lt.screenX,st=e.screenY-lt.screenY):st=ot=0,lt=e),ot)},movementY:function(e){return"movementY"in e?e.movementY:st}}),ht=at(pt),vt=at(R({},pt,{dataTransfer:0})),ft=at(R({},dt,{relatedTarget:0})),gt=at(R({},ct,{animationName:0,elapsedTime:0,pseudoElement:0})),bt=R({},ct,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),xt=at(bt),yt=at(R({},ct,{data:0})),kt={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},wt={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},jt={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function St(e){var n=this.nativeEvent;return n.getModifierState?n.getModifierState(e):!!(e=jt[e])&&!!n[e]}function Ct(){return St}var Nt=R({},dt,{key:function(e){if(e.key){var n=kt[e.key]||e.key;if("Unidentified"!==n)return n}return"keypress"===e.type?13===(e=tt(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?wt[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ct,charCode:function(e){return"keypress"===e.type?tt(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tt(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Pt=at(Nt),Et=at(R({},pt,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Mt=at(R({},dt,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ct})),Lt=at(R({},ct,{propertyName:0,elapsedTime:0,pseudoElement:0})),Ot=R({},pt,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Tt=at(Ot),Dt=[9,13,27,32],zt=u&&"CompositionEvent"in window,It=null;u&&"documentMode"in document&&(It=document.documentMode);var At=u&&"TextEvent"in window&&!It,Rt=u&&(!zt||It&&8<It&&11>=It),Bt=String.fromCharCode(32),_t=!1;function Ut(e,n){switch(e){case"keyup":return-1!==Dt.indexOf(n.keyCode);case"keydown":return 229!==n.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ft(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var Vt=!1;var Wt={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ht(e){var n=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===n?!!Wt[e.type]:"textarea"===n}function $t(e,n,t,i){Ne(i),0<(n=qi(n,"onChange")).length&&(t=new ut("onChange","change",null,t,i),e.push({event:t,listeners:n}))}var qt=null,Yt=null;function Kt(e){Bi(e,0)}function Gt(e){if(Y(yr(e)))return e}function Qt(e,n){if("change"===e)return n}var Xt=!1;if(u){var Zt;if(u){var Jt="oninput"in document;if(!Jt){var ei=document.createElement("div");ei.setAttribute("oninput","return;"),Jt="function"==typeof ei.oninput}Zt=Jt}else Zt=!1;Xt=Zt&&(!document.documentMode||9<document.documentMode)}function ni(){qt&&(qt.detachEvent("onpropertychange",ti),Yt=qt=null)}function ti(e){if("value"===e.propertyName&&Gt(Yt)){var n=[];$t(n,Yt,e,ke(e)),Oe(Kt,n)}}function ii(e,n,t){"focusin"===e?(ni(),Yt=t,(qt=n).attachEvent("onpropertychange",ti)):"focusout"===e&&ni()}function ri(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Gt(Yt)}function ai(e,n){if("click"===e)return Gt(n)}function oi(e,n){if("input"===e||"change"===e)return Gt(n)}var si="function"==typeof Object.is?Object.is:function(e,n){return e===n&&(0!==e||1/e==1/n)||e!=e&&n!=n};function li(e,n){if(si(e,n))return!0;if("object"!=typeof e||null===e||"object"!=typeof n||null===n)return!1;var t=Object.keys(e),i=Object.keys(n);if(t.length!==i.length)return!1;for(i=0;i<t.length;i++){var r=t[i];if(!d.call(n,r)||!si(e[r],n[r]))return!1}return!0}function ci(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ui(e,n){var t,i=ci(e);for(e=0;i;){if(3===i.nodeType){if(t=e+i.textContent.length,e<=n&&t>=n)return{node:i,offset:n-e};e=t}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=ci(i)}}function di(e,n){return!(!e||!n)&&(e===n||(!e||3!==e.nodeType)&&(n&&3===n.nodeType?di(e,n.parentNode):"contains"in e?e.contains(n):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(n))))}function mi(){for(var e=window,n=K();n instanceof e.HTMLIFrameElement;){try{var t="string"==typeof n.contentWindow.location.href}catch(e){t=!1}if(!t)break;n=K((e=n.contentWindow).document)}return n}function pi(e){var n=e&&e.nodeName&&e.nodeName.toLowerCase();return n&&("input"===n&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===n||"true"===e.contentEditable)}function hi(e){var n=mi(),t=e.focusedElem,i=e.selectionRange;if(n!==t&&t&&t.ownerDocument&&di(t.ownerDocument.documentElement,t)){if(null!==i&&pi(t))if(n=i.start,void 0===(e=i.end)&&(e=n),"selectionStart"in t)t.selectionStart=n,t.selectionEnd=Math.min(e,t.value.length);else if((e=(n=t.ownerDocument||document)&&n.defaultView||window).getSelection){e=e.getSelection();var r=t.textContent.length,a=Math.min(i.start,r);i=void 0===i.end?a:Math.min(i.end,r),!e.extend&&a>i&&(r=i,i=a,a=r),r=ui(t,a);var o=ui(t,i);r&&o&&(1!==e.rangeCount||e.anchorNode!==r.node||e.anchorOffset!==r.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&((n=n.createRange()).setStart(r.node,r.offset),e.removeAllRanges(),a>i?(e.addRange(n),e.extend(o.node,o.offset)):(n.setEnd(o.node,o.offset),e.addRange(n)))}for(n=[],e=t;e=e.parentNode;)1===e.nodeType&&n.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"==typeof t.focus&&t.focus(),t=0;t<n.length;t++)(e=n[t]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var vi=u&&"documentMode"in document&&11>=document.documentMode,fi=null,gi=null,bi=null,xi=!1;function yi(e,n,t){var i=t.window===t?t.document:9===t.nodeType?t:t.ownerDocument;xi||null==fi||fi!==K(i)||("selectionStart"in(i=fi)&&pi(i)?i={start:i.selectionStart,end:i.selectionEnd}:i={anchorNode:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset},bi&&li(bi,i)||(bi=i,0<(i=qi(gi,"onSelect")).length&&(n=new ut("onSelect","select",null,n,t),e.push({event:n,listeners:i}),n.target=fi)))}function ki(e,n){var t={};return t[e.toLowerCase()]=n.toLowerCase(),t["Webkit"+e]="webkit"+n,t["Moz"+e]="moz"+n,t}var wi={animationend:ki("Animation","AnimationEnd"),animationiteration:ki("Animation","AnimationIteration"),animationstart:ki("Animation","AnimationStart"),transitionend:ki("Transition","TransitionEnd")},ji={},Si={};function Ci(e){if(ji[e])return ji[e];if(!wi[e])return e;var n,t=wi[e];for(n in t)if(t.hasOwnProperty(n)&&n in Si)return ji[e]=t[n];return e}u&&(Si=document.createElement("div").style,"AnimationEvent"in window||(delete wi.animationend.animation,delete wi.animationiteration.animation,delete wi.animationstart.animation),"TransitionEvent"in window||delete wi.transitionend.transition);var Ni=Ci("animationend"),Pi=Ci("animationiteration"),Ei=Ci("animationstart"),Mi=Ci("transitionend"),Li=new Map,Oi="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ti(e,n){Li.set(e,n),l(n,[e])}for(var Di=0;Di<Oi.length;Di++){var zi=Oi[Di];Ti(zi.toLowerCase(),"on"+(zi[0].toUpperCase()+zi.slice(1)))}Ti(Ni,"onAnimationEnd"),Ti(Pi,"onAnimationIteration"),Ti(Ei,"onAnimationStart"),Ti("dblclick","onDoubleClick"),Ti("focusin","onFocus"),Ti("focusout","onBlur"),Ti(Mi,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ii="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ai=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ii));function Ri(e,n,t){var i=e.type||"unknown-event";e.currentTarget=t,function(e,n,t,i,r,o,s,l,c){if(Fe.apply(this,arguments),Ae){if(!Ae)throw Error(a(198));var u=Re;Ae=!1,Re=null,Be||(Be=!0,_e=u)}}(i,n,void 0,e),e.currentTarget=null}function Bi(e,n){n=!!(4&n);for(var t=0;t<e.length;t++){var i=e[t],r=i.event;i=i.listeners;e:{var a=void 0;if(n)for(var o=i.length-1;0<=o;o--){var s=i[o],l=s.instance,c=s.currentTarget;if(s=s.listener,l!==a&&r.isPropagationStopped())break e;Ri(r,s,c),a=l}else for(o=0;o<i.length;o++){if(l=(s=i[o]).instance,c=s.currentTarget,s=s.listener,l!==a&&r.isPropagationStopped())break e;Ri(r,s,c),a=l}}}if(Be)throw e=_e,Be=!1,_e=null,e}function _i(e,n){var t=n[vr];void 0===t&&(t=n[vr]=new Set);var i=e+"__bubble";t.has(i)||(Wi(n,e,2,!1),t.add(i))}function Ui(e,n,t){var i=0;n&&(i|=4),Wi(t,e,i,n)}var Fi="_reactListening"+Math.random().toString(36).slice(2);function Vi(e){if(!e[Fi]){e[Fi]=!0,o.forEach(function(n){"selectionchange"!==n&&(Ai.has(n)||Ui(n,!1,e),Ui(n,!0,e))});var n=9===e.nodeType?e:e.ownerDocument;null===n||n[Fi]||(n[Fi]=!0,Ui("selectionchange",!1,n))}}function Wi(e,n,t,i){switch(Xn(n)){case 1:var r=qn;break;case 4:r=Yn;break;default:r=Kn}t=r.bind(null,n,t,e),r=void 0,!De||"touchstart"!==n&&"touchmove"!==n&&"wheel"!==n||(r=!0),i?void 0!==r?e.addEventListener(n,t,{capture:!0,passive:r}):e.addEventListener(n,t,!0):void 0!==r?e.addEventListener(n,t,{passive:r}):e.addEventListener(n,t,!1)}function Hi(e,n,t,i,r){var a=i;if(!(1&n||2&n||null===i))e:for(;;){if(null===i)return;var o=i.tag;if(3===o||4===o){var s=i.stateNode.containerInfo;if(s===r||8===s.nodeType&&s.parentNode===r)break;if(4===o)for(o=i.return;null!==o;){var l=o.tag;if((3===l||4===l)&&((l=o.stateNode.containerInfo)===r||8===l.nodeType&&l.parentNode===r))return;o=o.return}for(;null!==s;){if(null===(o=br(s)))return;if(5===(l=o.tag)||6===l){i=a=o;continue e}s=s.parentNode}}i=i.return}Oe(function(){var i=a,r=ke(t),o=[];e:{var s=Li.get(e);if(void 0!==s){var l=ut,c=e;switch(e){case"keypress":if(0===tt(t))break e;case"keydown":case"keyup":l=Pt;break;case"focusin":c="focus",l=ft;break;case"focusout":c="blur",l=ft;break;case"beforeblur":case"afterblur":l=ft;break;case"click":if(2===t.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=ht;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=vt;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Mt;break;case Ni:case Pi:case Ei:l=gt;break;case Mi:l=Lt;break;case"scroll":l=mt;break;case"wheel":l=Tt;break;case"copy":case"cut":case"paste":l=xt;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=Et}var u=!!(4&n),d=!u&&"scroll"===e,m=u?null!==s?s+"Capture":null:s;u=[];for(var p,h=i;null!==h;){var v=(p=h).stateNode;if(5===p.tag&&null!==v&&(p=v,null!==m&&(null!=(v=Te(h,m))&&u.push($i(h,v,p)))),d)break;h=h.return}0<u.length&&(s=new l(s,c,null,t,r),o.push({event:s,listeners:u}))}}if(!(7&n)){if(l="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||t===ye||!(c=t.relatedTarget||t.fromElement)||!br(c)&&!c[hr])&&(l||s)&&(s=r.window===r?r:(s=r.ownerDocument)?s.defaultView||s.parentWindow:window,l?(l=i,null!==(c=(c=t.relatedTarget||t.toElement)?br(c):null)&&(c!==(d=Ve(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=i),l!==c)){if(u=ht,v="onMouseLeave",m="onMouseEnter",h="mouse","pointerout"!==e&&"pointerover"!==e||(u=Et,v="onPointerLeave",m="onPointerEnter",h="pointer"),d=null==l?s:yr(l),p=null==c?s:yr(c),(s=new u(v,h+"leave",l,t,r)).target=d,s.relatedTarget=p,v=null,br(r)===i&&((u=new u(m,h+"enter",c,t,r)).target=p,u.relatedTarget=d,v=u),d=v,l&&c)e:{for(m=c,h=0,p=u=l;p;p=Yi(p))h++;for(p=0,v=m;v;v=Yi(v))p++;for(;0<h-p;)u=Yi(u),h--;for(;0<p-h;)m=Yi(m),p--;for(;h--;){if(u===m||null!==m&&u===m.alternate)break e;u=Yi(u),m=Yi(m)}u=null}else u=null;null!==l&&Ki(o,s,l,u,!1),null!==c&&null!==d&&Ki(o,d,c,u,!0)}if("select"===(l=(s=i?yr(i):window).nodeName&&s.nodeName.toLowerCase())||"input"===l&&"file"===s.type)var f=Qt;else if(Ht(s))if(Xt)f=oi;else{f=ri;var g=ii}else(l=s.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(f=ai);switch(f&&(f=f(e,i))?$t(o,f,t,r):(g&&g(e,s,i),"focusout"===e&&(g=s._wrapperState)&&g.controlled&&"number"===s.type&&ee(s,"number",s.value)),g=i?yr(i):window,e){case"focusin":(Ht(g)||"true"===g.contentEditable)&&(fi=g,gi=i,bi=null);break;case"focusout":bi=gi=fi=null;break;case"mousedown":xi=!0;break;case"contextmenu":case"mouseup":case"dragend":xi=!1,yi(o,t,r);break;case"selectionchange":if(vi)break;case"keydown":case"keyup":yi(o,t,r)}var b;if(zt)e:{switch(e){case"compositionstart":var x="onCompositionStart";break e;case"compositionend":x="onCompositionEnd";break e;case"compositionupdate":x="onCompositionUpdate";break e}x=void 0}else Vt?Ut(e,t)&&(x="onCompositionEnd"):"keydown"===e&&229===t.keyCode&&(x="onCompositionStart");x&&(Rt&&"ko"!==t.locale&&(Vt||"onCompositionStart"!==x?"onCompositionEnd"===x&&Vt&&(b=nt()):(Jn="value"in(Zn=r)?Zn.value:Zn.textContent,Vt=!0)),0<(g=qi(i,x)).length&&(x=new yt(x,e,null,t,r),o.push({event:x,listeners:g}),b?x.data=b:null!==(b=Ft(t))&&(x.data=b))),(b=At?function(e,n){switch(e){case"compositionend":return Ft(n);case"keypress":return 32!==n.which?null:(_t=!0,Bt);case"textInput":return(e=n.data)===Bt&&_t?null:e;default:return null}}(e,t):function(e,n){if(Vt)return"compositionend"===e||!zt&&Ut(e,n)?(e=nt(),et=Jn=Zn=null,Vt=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(n.ctrlKey||n.altKey||n.metaKey)||n.ctrlKey&&n.altKey){if(n.char&&1<n.char.length)return n.char;if(n.which)return String.fromCharCode(n.which)}return null;case"compositionend":return Rt&&"ko"!==n.locale?null:n.data}}(e,t))&&(0<(i=qi(i,"onBeforeInput")).length&&(r=new yt("onBeforeInput","beforeinput",null,t,r),o.push({event:r,listeners:i}),r.data=b))}Bi(o,n)})}function $i(e,n,t){return{instance:e,listener:n,currentTarget:t}}function qi(e,n){for(var t=n+"Capture",i=[];null!==e;){var r=e,a=r.stateNode;5===r.tag&&null!==a&&(r=a,null!=(a=Te(e,t))&&i.unshift($i(e,a,r)),null!=(a=Te(e,n))&&i.push($i(e,a,r))),e=e.return}return i}function Yi(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Ki(e,n,t,i,r){for(var a=n._reactName,o=[];null!==t&&t!==i;){var s=t,l=s.alternate,c=s.stateNode;if(null!==l&&l===i)break;5===s.tag&&null!==c&&(s=c,r?null!=(l=Te(t,a))&&o.unshift($i(t,l,s)):r||null!=(l=Te(t,a))&&o.push($i(t,l,s))),t=t.return}0!==o.length&&e.push({event:n,listeners:o})}var Gi=/\r\n?/g,Qi=/\u0000|\uFFFD/g;function Xi(e){return("string"==typeof e?e:""+e).replace(Gi,"\n").replace(Qi,"")}function Zi(e,n,t){if(n=Xi(n),Xi(e)!==n&&t)throw Error(a(425))}function Ji(){}var er=null,nr=null;function tr(e,n){return"textarea"===e||"noscript"===e||"string"==typeof n.children||"number"==typeof n.children||"object"==typeof n.dangerouslySetInnerHTML&&null!==n.dangerouslySetInnerHTML&&null!=n.dangerouslySetInnerHTML.__html}var ir="function"==typeof setTimeout?setTimeout:void 0,rr="function"==typeof clearTimeout?clearTimeout:void 0,ar="function"==typeof Promise?Promise:void 0,or="function"==typeof queueMicrotask?queueMicrotask:void 0!==ar?function(e){return ar.resolve(null).then(e).catch(sr)}:ir;function sr(e){setTimeout(function(){throw e})}function lr(e,n){var t=n,i=0;do{var r=t.nextSibling;if(e.removeChild(t),r&&8===r.nodeType)if("/$"===(t=r.data)){if(0===i)return e.removeChild(r),void Wn(n);i--}else"$"!==t&&"$?"!==t&&"$!"!==t||i++;t=r}while(t);Wn(n)}function cr(e){for(;null!=e;e=e.nextSibling){var n=e.nodeType;if(1===n||3===n)break;if(8===n){if("$"===(n=e.data)||"$!"===n||"$?"===n)break;if("/$"===n)return null}}return e}function ur(e){e=e.previousSibling;for(var n=0;e;){if(8===e.nodeType){var t=e.data;if("$"===t||"$!"===t||"$?"===t){if(0===n)return e;n--}else"/$"===t&&n++}e=e.previousSibling}return null}var dr=Math.random().toString(36).slice(2),mr="__reactFiber$"+dr,pr="__reactProps$"+dr,hr="__reactContainer$"+dr,vr="__reactEvents$"+dr,fr="__reactListeners$"+dr,gr="__reactHandles$"+dr;function br(e){var n=e[mr];if(n)return n;for(var t=e.parentNode;t;){if(n=t[hr]||t[mr]){if(t=n.alternate,null!==n.child||null!==t&&null!==t.child)for(e=ur(e);null!==e;){if(t=e[mr])return t;e=ur(e)}return n}t=(e=t).parentNode}return null}function xr(e){return!(e=e[mr]||e[hr])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function yr(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(a(33))}function kr(e){return e[pr]||null}var wr=[],jr=-1;function Sr(e){return{current:e}}function Cr(e){0>jr||(e.current=wr[jr],wr[jr]=null,jr--)}function Nr(e,n){jr++,wr[jr]=e.current,e.current=n}var Pr={},Er=Sr(Pr),Mr=Sr(!1),Lr=Pr;function Or(e,n){var t=e.type.contextTypes;if(!t)return Pr;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===n)return i.__reactInternalMemoizedMaskedChildContext;var r,a={};for(r in t)a[r]=n[r];return i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=n,e.__reactInternalMemoizedMaskedChildContext=a),a}function Tr(e){return null!=(e=e.childContextTypes)}function Dr(){Cr(Mr),Cr(Er)}function zr(e,n,t){if(Er.current!==Pr)throw Error(a(168));Nr(Er,n),Nr(Mr,t)}function Ir(e,n,t){var i=e.stateNode;if(n=n.childContextTypes,"function"!=typeof i.getChildContext)return t;for(var r in i=i.getChildContext())if(!(r in n))throw Error(a(108,W(e)||"Unknown",r));return R({},t,i)}function Ar(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Pr,Lr=Er.current,Nr(Er,e),Nr(Mr,Mr.current),!0}function Rr(e,n,t){var i=e.stateNode;if(!i)throw Error(a(169));t?(e=Ir(e,n,Lr),i.__reactInternalMemoizedMergedChildContext=e,Cr(Mr),Cr(Er),Nr(Er,e)):Cr(Mr),Nr(Mr,t)}var Br=null,_r=!1,Ur=!1;function Fr(e){null===Br?Br=[e]:Br.push(e)}function Vr(){if(!Ur&&null!==Br){Ur=!0;var e=0,n=yn;try{var t=Br;for(yn=1;e<t.length;e++){var i=t[e];do{i=i(!0)}while(null!==i)}Br=null,_r=!1}catch(n){throw null!==Br&&(Br=Br.slice(e+1)),Ye(Je,Vr),n}finally{yn=n,Ur=!1}}return null}var Wr=[],Hr=0,$r=null,qr=0,Yr=[],Kr=0,Gr=null,Qr=1,Xr="";function Zr(e,n){Wr[Hr++]=qr,Wr[Hr++]=$r,$r=e,qr=n}function Jr(e,n,t){Yr[Kr++]=Qr,Yr[Kr++]=Xr,Yr[Kr++]=Gr,Gr=e;var i=Qr;e=Xr;var r=32-sn(i)-1;i&=~(1<<r),t+=1;var a=32-sn(n)+r;if(30<a){var o=r-r%5;a=(i&(1<<o)-1).toString(32),i>>=o,r-=o,Qr=1<<32-sn(n)+r|t<<r|i,Xr=a+e}else Qr=1<<a|t<<r|i,Xr=e}function ea(e){null!==e.return&&(Zr(e,1),Jr(e,1,0))}function na(e){for(;e===$r;)$r=Wr[--Hr],Wr[Hr]=null,qr=Wr[--Hr],Wr[Hr]=null;for(;e===Gr;)Gr=Yr[--Kr],Yr[Kr]=null,Xr=Yr[--Kr],Yr[Kr]=null,Qr=Yr[--Kr],Yr[Kr]=null}var ta=null,ia=null,ra=!1,aa=null;function oa(e,n){var t=Lc(5,null,null,0);t.elementType="DELETED",t.stateNode=n,t.return=e,null===(n=e.deletions)?(e.deletions=[t],e.flags|=16):n.push(t)}function sa(e,n){switch(e.tag){case 5:var t=e.type;return null!==(n=1!==n.nodeType||t.toLowerCase()!==n.nodeName.toLowerCase()?null:n)&&(e.stateNode=n,ta=e,ia=cr(n.firstChild),!0);case 6:return null!==(n=""===e.pendingProps||3!==n.nodeType?null:n)&&(e.stateNode=n,ta=e,ia=null,!0);case 13:return null!==(n=8!==n.nodeType?null:n)&&(t=null!==Gr?{id:Qr,overflow:Xr}:null,e.memoizedState={dehydrated:n,treeContext:t,retryLane:1073741824},(t=Lc(18,null,null,0)).stateNode=n,t.return=e,e.child=t,ta=e,ia=null,!0);default:return!1}}function la(e){return!(!(1&e.mode)||128&e.flags)}function ca(e){if(ra){var n=ia;if(n){var t=n;if(!sa(e,n)){if(la(e))throw Error(a(418));n=cr(t.nextSibling);var i=ta;n&&sa(e,n)?oa(i,t):(e.flags=-4097&e.flags|2,ra=!1,ta=e)}}else{if(la(e))throw Error(a(418));e.flags=-4097&e.flags|2,ra=!1,ta=e}}}function ua(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;ta=e}function da(e){if(e!==ta)return!1;if(!ra)return ua(e),ra=!0,!1;var n;if((n=3!==e.tag)&&!(n=5!==e.tag)&&(n="head"!==(n=e.type)&&"body"!==n&&!tr(e.type,e.memoizedProps)),n&&(n=ia)){if(la(e))throw ma(),Error(a(418));for(;n;)oa(e,n),n=cr(n.nextSibling)}if(ua(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(a(317));e:{for(e=e.nextSibling,n=0;e;){if(8===e.nodeType){var t=e.data;if("/$"===t){if(0===n){ia=cr(e.nextSibling);break e}n--}else"$"!==t&&"$!"!==t&&"$?"!==t||n++}e=e.nextSibling}ia=null}}else ia=ta?cr(e.stateNode.nextSibling):null;return!0}function ma(){for(var e=ia;e;)e=cr(e.nextSibling)}function pa(){ia=ta=null,ra=!1}function ha(e){null===aa?aa=[e]:aa.push(e)}var va=y.ReactCurrentBatchConfig;function fa(e,n,t){if(null!==(e=t.ref)&&"function"!=typeof e&&"object"!=typeof e){if(t._owner){if(t=t._owner){if(1!==t.tag)throw Error(a(309));var i=t.stateNode}if(!i)throw Error(a(147,e));var r=i,o=""+e;return null!==n&&null!==n.ref&&"function"==typeof n.ref&&n.ref._stringRef===o?n.ref:(n=function(e){var n=r.refs;null===e?delete n[o]:n[o]=e},n._stringRef=o,n)}if("string"!=typeof e)throw Error(a(284));if(!t._owner)throw Error(a(290,e))}return e}function ga(e,n){throw e=Object.prototype.toString.call(n),Error(a(31,"[object Object]"===e?"object with keys {"+Object.keys(n).join(", ")+"}":e))}function ba(e){return(0,e._init)(e._payload)}function xa(e){function n(n,t){if(e){var i=n.deletions;null===i?(n.deletions=[t],n.flags|=16):i.push(t)}}function t(t,i){if(!e)return null;for(;null!==i;)n(t,i),i=i.sibling;return null}function i(e,n){for(e=new Map;null!==n;)null!==n.key?e.set(n.key,n):e.set(n.index,n),n=n.sibling;return e}function r(e,n){return(e=Tc(e,n)).index=0,e.sibling=null,e}function o(n,t,i){return n.index=i,e?null!==(i=n.alternate)?(i=i.index)<t?(n.flags|=2,t):i:(n.flags|=2,t):(n.flags|=1048576,t)}function s(n){return e&&null===n.alternate&&(n.flags|=2),n}function l(e,n,t,i){return null===n||6!==n.tag?((n=Ac(t,e.mode,i)).return=e,n):((n=r(n,t)).return=e,n)}function c(e,n,t,i){var a=t.type;return a===j?d(e,n,t.props.children,i,t.key):null!==n&&(n.elementType===a||"object"==typeof a&&null!==a&&a.$$typeof===T&&ba(a)===n.type)?((i=r(n,t.props)).ref=fa(e,n,t),i.return=e,i):((i=Dc(t.type,t.key,t.props,null,e.mode,i)).ref=fa(e,n,t),i.return=e,i)}function u(e,n,t,i){return null===n||4!==n.tag||n.stateNode.containerInfo!==t.containerInfo||n.stateNode.implementation!==t.implementation?((n=Rc(t,e.mode,i)).return=e,n):((n=r(n,t.children||[])).return=e,n)}function d(e,n,t,i,a){return null===n||7!==n.tag?((n=zc(t,e.mode,i,a)).return=e,n):((n=r(n,t)).return=e,n)}function m(e,n,t){if("string"==typeof n&&""!==n||"number"==typeof n)return(n=Ac(""+n,e.mode,t)).return=e,n;if("object"==typeof n&&null!==n){switch(n.$$typeof){case k:return(t=Dc(n.type,n.key,n.props,null,e.mode,t)).ref=fa(e,null,n),t.return=e,t;case w:return(n=Rc(n,e.mode,t)).return=e,n;case T:return m(e,(0,n._init)(n._payload),t)}if(ne(n)||I(n))return(n=zc(n,e.mode,t,null)).return=e,n;ga(e,n)}return null}function p(e,n,t,i){var r=null!==n?n.key:null;if("string"==typeof t&&""!==t||"number"==typeof t)return null!==r?null:l(e,n,""+t,i);if("object"==typeof t&&null!==t){switch(t.$$typeof){case k:return t.key===r?c(e,n,t,i):null;case w:return t.key===r?u(e,n,t,i):null;case T:return p(e,n,(r=t._init)(t._payload),i)}if(ne(t)||I(t))return null!==r?null:d(e,n,t,i,null);ga(e,t)}return null}function h(e,n,t,i,r){if("string"==typeof i&&""!==i||"number"==typeof i)return l(n,e=e.get(t)||null,""+i,r);if("object"==typeof i&&null!==i){switch(i.$$typeof){case k:return c(n,e=e.get(null===i.key?t:i.key)||null,i,r);case w:return u(n,e=e.get(null===i.key?t:i.key)||null,i,r);case T:return h(e,n,t,(0,i._init)(i._payload),r)}if(ne(i)||I(i))return d(n,e=e.get(t)||null,i,r,null);ga(n,i)}return null}function v(r,a,s,l){for(var c=null,u=null,d=a,v=a=0,f=null;null!==d&&v<s.length;v++){d.index>v?(f=d,d=null):f=d.sibling;var g=p(r,d,s[v],l);if(null===g){null===d&&(d=f);break}e&&d&&null===g.alternate&&n(r,d),a=o(g,a,v),null===u?c=g:u.sibling=g,u=g,d=f}if(v===s.length)return t(r,d),ra&&Zr(r,v),c;if(null===d){for(;v<s.length;v++)null!==(d=m(r,s[v],l))&&(a=o(d,a,v),null===u?c=d:u.sibling=d,u=d);return ra&&Zr(r,v),c}for(d=i(r,d);v<s.length;v++)null!==(f=h(d,r,v,s[v],l))&&(e&&null!==f.alternate&&d.delete(null===f.key?v:f.key),a=o(f,a,v),null===u?c=f:u.sibling=f,u=f);return e&&d.forEach(function(e){return n(r,e)}),ra&&Zr(r,v),c}function f(r,s,l,c){var u=I(l);if("function"!=typeof u)throw Error(a(150));if(null==(l=u.call(l)))throw Error(a(151));for(var d=u=null,v=s,f=s=0,g=null,b=l.next();null!==v&&!b.done;f++,b=l.next()){v.index>f?(g=v,v=null):g=v.sibling;var x=p(r,v,b.value,c);if(null===x){null===v&&(v=g);break}e&&v&&null===x.alternate&&n(r,v),s=o(x,s,f),null===d?u=x:d.sibling=x,d=x,v=g}if(b.done)return t(r,v),ra&&Zr(r,f),u;if(null===v){for(;!b.done;f++,b=l.next())null!==(b=m(r,b.value,c))&&(s=o(b,s,f),null===d?u=b:d.sibling=b,d=b);return ra&&Zr(r,f),u}for(v=i(r,v);!b.done;f++,b=l.next())null!==(b=h(v,r,f,b.value,c))&&(e&&null!==b.alternate&&v.delete(null===b.key?f:b.key),s=o(b,s,f),null===d?u=b:d.sibling=b,d=b);return e&&v.forEach(function(e){return n(r,e)}),ra&&Zr(r,f),u}return function e(i,a,o,l){if("object"==typeof o&&null!==o&&o.type===j&&null===o.key&&(o=o.props.children),"object"==typeof o&&null!==o){switch(o.$$typeof){case k:e:{for(var c=o.key,u=a;null!==u;){if(u.key===c){if((c=o.type)===j){if(7===u.tag){t(i,u.sibling),(a=r(u,o.props.children)).return=i,i=a;break e}}else if(u.elementType===c||"object"==typeof c&&null!==c&&c.$$typeof===T&&ba(c)===u.type){t(i,u.sibling),(a=r(u,o.props)).ref=fa(i,u,o),a.return=i,i=a;break e}t(i,u);break}n(i,u),u=u.sibling}o.type===j?((a=zc(o.props.children,i.mode,l,o.key)).return=i,i=a):((l=Dc(o.type,o.key,o.props,null,i.mode,l)).ref=fa(i,a,o),l.return=i,i=l)}return s(i);case w:e:{for(u=o.key;null!==a;){if(a.key===u){if(4===a.tag&&a.stateNode.containerInfo===o.containerInfo&&a.stateNode.implementation===o.implementation){t(i,a.sibling),(a=r(a,o.children||[])).return=i,i=a;break e}t(i,a);break}n(i,a),a=a.sibling}(a=Rc(o,i.mode,l)).return=i,i=a}return s(i);case T:return e(i,a,(u=o._init)(o._payload),l)}if(ne(o))return v(i,a,o,l);if(I(o))return f(i,a,o,l);ga(i,o)}return"string"==typeof o&&""!==o||"number"==typeof o?(o=""+o,null!==a&&6===a.tag?(t(i,a.sibling),(a=r(a,o)).return=i,i=a):(t(i,a),(a=Ac(o,i.mode,l)).return=i,i=a),s(i)):t(i,a)}}var ya=xa(!0),ka=xa(!1),wa=Sr(null),ja=null,Sa=null,Ca=null;function Na(){Ca=Sa=ja=null}function Pa(e){var n=wa.current;Cr(wa),e._currentValue=n}function Ea(e,n,t){for(;null!==e;){var i=e.alternate;if((e.childLanes&n)!==n?(e.childLanes|=n,null!==i&&(i.childLanes|=n)):null!==i&&(i.childLanes&n)!==n&&(i.childLanes|=n),e===t)break;e=e.return}}function Ma(e,n){ja=e,Ca=Sa=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&n)&&(xs=!0),e.firstContext=null)}function La(e){var n=e._currentValue;if(Ca!==e)if(e={context:e,memoizedValue:n,next:null},null===Sa){if(null===ja)throw Error(a(308));Sa=e,ja.dependencies={lanes:0,firstContext:e}}else Sa=Sa.next=e;return n}var Oa=null;function Ta(e){null===Oa?Oa=[e]:Oa.push(e)}function Da(e,n,t,i){var r=n.interleaved;return null===r?(t.next=t,Ta(n)):(t.next=r.next,r.next=t),n.interleaved=t,za(e,i)}function za(e,n){e.lanes|=n;var t=e.alternate;for(null!==t&&(t.lanes|=n),t=e,e=e.return;null!==e;)e.childLanes|=n,null!==(t=e.alternate)&&(t.childLanes|=n),t=e,e=e.return;return 3===t.tag?t.stateNode:null}var Ia=!1;function Aa(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Ra(e,n){e=e.updateQueue,n.updateQueue===e&&(n.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Ba(e,n){return{eventTime:e,lane:n,tag:0,payload:null,callback:null,next:null}}function _a(e,n,t){var i=e.updateQueue;if(null===i)return null;if(i=i.shared,2&Pl){var r=i.pending;return null===r?n.next=n:(n.next=r.next,r.next=n),i.pending=n,za(e,t)}return null===(r=i.interleaved)?(n.next=n,Ta(i)):(n.next=r.next,r.next=n),i.interleaved=n,za(e,t)}function Ua(e,n,t){if(null!==(n=n.updateQueue)&&(n=n.shared,4194240&t)){var i=n.lanes;t|=i&=e.pendingLanes,n.lanes=t,xn(e,t)}}function Fa(e,n){var t=e.updateQueue,i=e.alternate;if(null!==i&&t===(i=i.updateQueue)){var r=null,a=null;if(null!==(t=t.firstBaseUpdate)){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};null===a?r=a=o:a=a.next=o,t=t.next}while(null!==t);null===a?r=a=n:a=a.next=n}else r=a=n;return t={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:a,shared:i.shared,effects:i.effects},void(e.updateQueue=t)}null===(e=t.lastBaseUpdate)?t.firstBaseUpdate=n:e.next=n,t.lastBaseUpdate=n}function Va(e,n,t,i){var r=e.updateQueue;Ia=!1;var a=r.firstBaseUpdate,o=r.lastBaseUpdate,s=r.shared.pending;if(null!==s){r.shared.pending=null;var l=s,c=l.next;l.next=null,null===o?a=c:o.next=c,o=l;var u=e.alternate;null!==u&&((s=(u=u.updateQueue).lastBaseUpdate)!==o&&(null===s?u.firstBaseUpdate=c:s.next=c,u.lastBaseUpdate=l))}if(null!==a){var d=r.baseState;for(o=0,u=c=l=null,s=a;;){var m=s.lane,p=s.eventTime;if((i&m)===m){null!==u&&(u=u.next={eventTime:p,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var h=e,v=s;switch(m=n,p=t,v.tag){case 1:if("function"==typeof(h=v.payload)){d=h.call(p,d,m);break e}d=h;break e;case 3:h.flags=-65537&h.flags|128;case 0:if(null==(m="function"==typeof(h=v.payload)?h.call(p,d,m):h))break e;d=R({},d,m);break e;case 2:Ia=!0}}null!==s.callback&&0!==s.lane&&(e.flags|=64,null===(m=r.effects)?r.effects=[s]:m.push(s))}else p={eventTime:p,lane:m,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===u?(c=u=p,l=d):u=u.next=p,o|=m;if(null===(s=s.next)){if(null===(s=r.shared.pending))break;s=(m=s).next,m.next=null,r.lastBaseUpdate=m,r.shared.pending=null}}if(null===u&&(l=d),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=u,null!==(n=r.shared.interleaved)){r=n;do{o|=r.lane,r=r.next}while(r!==n)}else null===a&&(r.shared.lanes=0);Il|=o,e.lanes=o,e.memoizedState=d}}function Wa(e,n,t){if(e=n.effects,n.effects=null,null!==e)for(n=0;n<e.length;n++){var i=e[n],r=i.callback;if(null!==r){if(i.callback=null,i=t,"function"!=typeof r)throw Error(a(191,r));r.call(i)}}}var Ha={},$a=Sr(Ha),qa=Sr(Ha),Ya=Sr(Ha);function Ka(e){if(e===Ha)throw Error(a(174));return e}function Ga(e,n){switch(Nr(Ya,n),Nr(qa,e),Nr($a,Ha),e=n.nodeType){case 9:case 11:n=(n=n.documentElement)?n.namespaceURI:le(null,"");break;default:n=le(n=(e=8===e?n.parentNode:n).namespaceURI||null,e=e.tagName)}Cr($a),Nr($a,n)}function Qa(){Cr($a),Cr(qa),Cr(Ya)}function Xa(e){Ka(Ya.current);var n=Ka($a.current),t=le(n,e.type);n!==t&&(Nr(qa,e),Nr($a,t))}function Za(e){qa.current===e&&(Cr($a),Cr(qa))}var Ja=Sr(0);function eo(e){for(var n=e;null!==n;){if(13===n.tag){var t=n.memoizedState;if(null!==t&&(null===(t=t.dehydrated)||"$?"===t.data||"$!"===t.data))return n}else if(19===n.tag&&void 0!==n.memoizedProps.revealOrder){if(128&n.flags)return n}else if(null!==n.child){n.child.return=n,n=n.child;continue}if(n===e)break;for(;null===n.sibling;){if(null===n.return||n.return===e)return null;n=n.return}n.sibling.return=n.return,n=n.sibling}return null}var no=[];function to(){for(var e=0;e<no.length;e++)no[e]._workInProgressVersionPrimary=null;no.length=0}var io=y.ReactCurrentDispatcher,ro=y.ReactCurrentBatchConfig,ao=0,oo=null,so=null,lo=null,co=!1,uo=!1,mo=0,po=0;function ho(){throw Error(a(321))}function vo(e,n){if(null===n)return!1;for(var t=0;t<n.length&&t<e.length;t++)if(!si(e[t],n[t]))return!1;return!0}function fo(e,n,t,i,r,o){if(ao=o,oo=n,n.memoizedState=null,n.updateQueue=null,n.lanes=0,io.current=null===e||null===e.memoizedState?Jo:es,e=t(i,r),uo){o=0;do{if(uo=!1,mo=0,25<=o)throw Error(a(301));o+=1,lo=so=null,n.updateQueue=null,io.current=ns,e=t(i,r)}while(uo)}if(io.current=Zo,n=null!==so&&null!==so.next,ao=0,lo=so=oo=null,co=!1,n)throw Error(a(300));return e}function go(){var e=0!==mo;return mo=0,e}function bo(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===lo?oo.memoizedState=lo=e:lo=lo.next=e,lo}function xo(){if(null===so){var e=oo.alternate;e=null!==e?e.memoizedState:null}else e=so.next;var n=null===lo?oo.memoizedState:lo.next;if(null!==n)lo=n,so=e;else{if(null===e)throw Error(a(310));e={memoizedState:(so=e).memoizedState,baseState:so.baseState,baseQueue:so.baseQueue,queue:so.queue,next:null},null===lo?oo.memoizedState=lo=e:lo=lo.next=e}return lo}function yo(e,n){return"function"==typeof n?n(e):n}function ko(e){var n=xo(),t=n.queue;if(null===t)throw Error(a(311));t.lastRenderedReducer=e;var i=so,r=i.baseQueue,o=t.pending;if(null!==o){if(null!==r){var s=r.next;r.next=o.next,o.next=s}i.baseQueue=r=o,t.pending=null}if(null!==r){o=r.next,i=i.baseState;var l=s=null,c=null,u=o;do{var d=u.lane;if((ao&d)===d)null!==c&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),i=u.hasEagerState?u.eagerState:e(i,u.action);else{var m={lane:d,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===c?(l=c=m,s=i):c=c.next=m,oo.lanes|=d,Il|=d}u=u.next}while(null!==u&&u!==o);null===c?s=i:c.next=l,si(i,n.memoizedState)||(xs=!0),n.memoizedState=i,n.baseState=s,n.baseQueue=c,t.lastRenderedState=i}if(null!==(e=t.interleaved)){r=e;do{o=r.lane,oo.lanes|=o,Il|=o,r=r.next}while(r!==e)}else null===r&&(t.lanes=0);return[n.memoizedState,t.dispatch]}function wo(e){var n=xo(),t=n.queue;if(null===t)throw Error(a(311));t.lastRenderedReducer=e;var i=t.dispatch,r=t.pending,o=n.memoizedState;if(null!==r){t.pending=null;var s=r=r.next;do{o=e(o,s.action),s=s.next}while(s!==r);si(o,n.memoizedState)||(xs=!0),n.memoizedState=o,null===n.baseQueue&&(n.baseState=o),t.lastRenderedState=o}return[o,i]}function jo(){}function So(e,n){var t=oo,i=xo(),r=n(),o=!si(i.memoizedState,r);if(o&&(i.memoizedState=r,xs=!0),i=i.queue,Ao(Po.bind(null,t,i,e),[e]),i.getSnapshot!==n||o||null!==lo&&1&lo.memoizedState.tag){if(t.flags|=2048,Oo(9,No.bind(null,t,i,r,n),void 0,null),null===El)throw Error(a(349));30&ao||Co(t,n,r)}return r}function Co(e,n,t){e.flags|=16384,e={getSnapshot:n,value:t},null===(n=oo.updateQueue)?(n={lastEffect:null,stores:null},oo.updateQueue=n,n.stores=[e]):null===(t=n.stores)?n.stores=[e]:t.push(e)}function No(e,n,t,i){n.value=t,n.getSnapshot=i,Eo(n)&&Mo(e)}function Po(e,n,t){return t(function(){Eo(n)&&Mo(e)})}function Eo(e){var n=e.getSnapshot;e=e.value;try{var t=n();return!si(e,t)}catch(e){return!0}}function Mo(e){var n=za(e,1);null!==n&&nc(n,e,1,-1)}function Lo(e){var n=bo();return"function"==typeof e&&(e=e()),n.memoizedState=n.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:yo,lastRenderedState:e},n.queue=e,e=e.dispatch=Ko.bind(null,oo,e),[n.memoizedState,e]}function Oo(e,n,t,i){return e={tag:e,create:n,destroy:t,deps:i,next:null},null===(n=oo.updateQueue)?(n={lastEffect:null,stores:null},oo.updateQueue=n,n.lastEffect=e.next=e):null===(t=n.lastEffect)?n.lastEffect=e.next=e:(i=t.next,t.next=e,e.next=i,n.lastEffect=e),e}function To(){return xo().memoizedState}function Do(e,n,t,i){var r=bo();oo.flags|=e,r.memoizedState=Oo(1|n,t,void 0,void 0===i?null:i)}function zo(e,n,t,i){var r=xo();i=void 0===i?null:i;var a=void 0;if(null!==so){var o=so.memoizedState;if(a=o.destroy,null!==i&&vo(i,o.deps))return void(r.memoizedState=Oo(n,t,a,i))}oo.flags|=e,r.memoizedState=Oo(1|n,t,a,i)}function Io(e,n){return Do(8390656,8,e,n)}function Ao(e,n){return zo(2048,8,e,n)}function Ro(e,n){return zo(4,2,e,n)}function Bo(e,n){return zo(4,4,e,n)}function _o(e,n){return"function"==typeof n?(e=e(),n(e),function(){n(null)}):null!=n?(e=e(),n.current=e,function(){n.current=null}):void 0}function Uo(e,n,t){return t=null!=t?t.concat([e]):null,zo(4,4,_o.bind(null,n,e),t)}function Fo(){}function Vo(e,n){var t=xo();n=void 0===n?null:n;var i=t.memoizedState;return null!==i&&null!==n&&vo(n,i[1])?i[0]:(t.memoizedState=[e,n],e)}function Wo(e,n){var t=xo();n=void 0===n?null:n;var i=t.memoizedState;return null!==i&&null!==n&&vo(n,i[1])?i[0]:(e=e(),t.memoizedState=[e,n],e)}function Ho(e,n,t){return 21&ao?(si(t,n)||(t=fn(),oo.lanes|=t,Il|=t,e.baseState=!0),n):(e.baseState&&(e.baseState=!1,xs=!0),e.memoizedState=t)}function $o(e,n){var t=yn;yn=0!==t&&4>t?t:4,e(!0);var i=ro.transition;ro.transition={};try{e(!1),n()}finally{yn=t,ro.transition=i}}function qo(){return xo().memoizedState}function Yo(e,n,t){var i=ec(e);if(t={lane:i,action:t,hasEagerState:!1,eagerState:null,next:null},Go(e))Qo(n,t);else if(null!==(t=Da(e,n,t,i))){nc(t,e,i,Jl()),Xo(t,n,i)}}function Ko(e,n,t){var i=ec(e),r={lane:i,action:t,hasEagerState:!1,eagerState:null,next:null};if(Go(e))Qo(n,r);else{var a=e.alternate;if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=n.lastRenderedReducer))try{var o=n.lastRenderedState,s=a(o,t);if(r.hasEagerState=!0,r.eagerState=s,si(s,o)){var l=n.interleaved;return null===l?(r.next=r,Ta(n)):(r.next=l.next,l.next=r),void(n.interleaved=r)}}catch(e){}null!==(t=Da(e,n,r,i))&&(nc(t,e,i,r=Jl()),Xo(t,n,i))}}function Go(e){var n=e.alternate;return e===oo||null!==n&&n===oo}function Qo(e,n){uo=co=!0;var t=e.pending;null===t?n.next=n:(n.next=t.next,t.next=n),e.pending=n}function Xo(e,n,t){if(4194240&t){var i=n.lanes;t|=i&=e.pendingLanes,n.lanes=t,xn(e,t)}}var Zo={readContext:La,useCallback:ho,useContext:ho,useEffect:ho,useImperativeHandle:ho,useInsertionEffect:ho,useLayoutEffect:ho,useMemo:ho,useReducer:ho,useRef:ho,useState:ho,useDebugValue:ho,useDeferredValue:ho,useTransition:ho,useMutableSource:ho,useSyncExternalStore:ho,useId:ho,unstable_isNewReconciler:!1},Jo={readContext:La,useCallback:function(e,n){return bo().memoizedState=[e,void 0===n?null:n],e},useContext:La,useEffect:Io,useImperativeHandle:function(e,n,t){return t=null!=t?t.concat([e]):null,Do(4194308,4,_o.bind(null,n,e),t)},useLayoutEffect:function(e,n){return Do(4194308,4,e,n)},useInsertionEffect:function(e,n){return Do(4,2,e,n)},useMemo:function(e,n){var t=bo();return n=void 0===n?null:n,e=e(),t.memoizedState=[e,n],e},useReducer:function(e,n,t){var i=bo();return n=void 0!==t?t(n):n,i.memoizedState=i.baseState=n,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:n},i.queue=e,e=e.dispatch=Yo.bind(null,oo,e),[i.memoizedState,e]},useRef:function(e){return e={current:e},bo().memoizedState=e},useState:Lo,useDebugValue:Fo,useDeferredValue:function(e){return bo().memoizedState=e},useTransition:function(){var e=Lo(!1),n=e[0];return e=$o.bind(null,e[1]),bo().memoizedState=e,[n,e]},useMutableSource:function(){},useSyncExternalStore:function(e,n,t){var i=oo,r=bo();if(ra){if(void 0===t)throw Error(a(407));t=t()}else{if(t=n(),null===El)throw Error(a(349));30&ao||Co(i,n,t)}r.memoizedState=t;var o={value:t,getSnapshot:n};return r.queue=o,Io(Po.bind(null,i,o,e),[e]),i.flags|=2048,Oo(9,No.bind(null,i,o,t,n),void 0,null),t},useId:function(){var e=bo(),n=El.identifierPrefix;if(ra){var t=Xr;n=":"+n+"R"+(t=(Qr&~(1<<32-sn(Qr)-1)).toString(32)+t),0<(t=mo++)&&(n+="H"+t.toString(32)),n+=":"}else n=":"+n+"r"+(t=po++).toString(32)+":";return e.memoizedState=n},unstable_isNewReconciler:!1},es={readContext:La,useCallback:Vo,useContext:La,useEffect:Ao,useImperativeHandle:Uo,useInsertionEffect:Ro,useLayoutEffect:Bo,useMemo:Wo,useReducer:ko,useRef:To,useState:function(){return ko(yo)},useDebugValue:Fo,useDeferredValue:function(e){return Ho(xo(),so.memoizedState,e)},useTransition:function(){return[ko(yo)[0],xo().memoizedState]},useMutableSource:jo,useSyncExternalStore:So,useId:qo,unstable_isNewReconciler:!1},ns={readContext:La,useCallback:Vo,useContext:La,useEffect:Ao,useImperativeHandle:Uo,useInsertionEffect:Ro,useLayoutEffect:Bo,useMemo:Wo,useReducer:wo,useRef:To,useState:function(){return wo(yo)},useDebugValue:Fo,useDeferredValue:function(e){var n=xo();return null===so?n.memoizedState=e:Ho(n,so.memoizedState,e)},useTransition:function(){return[wo(yo)[0],xo().memoizedState]},useMutableSource:jo,useSyncExternalStore:So,useId:qo,unstable_isNewReconciler:!1};function ts(e,n){if(e&&e.defaultProps){for(var t in n=R({},n),e=e.defaultProps)void 0===n[t]&&(n[t]=e[t]);return n}return n}function is(e,n,t,i){t=null==(t=t(i,n=e.memoizedState))?n:R({},n,t),e.memoizedState=t,0===e.lanes&&(e.updateQueue.baseState=t)}var rs={isMounted:function(e){return!!(e=e._reactInternals)&&Ve(e)===e},enqueueSetState:function(e,n,t){e=e._reactInternals;var i=Jl(),r=ec(e),a=Ba(i,r);a.payload=n,null!=t&&(a.callback=t),null!==(n=_a(e,a,r))&&(nc(n,e,r,i),Ua(n,e,r))},enqueueReplaceState:function(e,n,t){e=e._reactInternals;var i=Jl(),r=ec(e),a=Ba(i,r);a.tag=1,a.payload=n,null!=t&&(a.callback=t),null!==(n=_a(e,a,r))&&(nc(n,e,r,i),Ua(n,e,r))},enqueueForceUpdate:function(e,n){e=e._reactInternals;var t=Jl(),i=ec(e),r=Ba(t,i);r.tag=2,null!=n&&(r.callback=n),null!==(n=_a(e,r,i))&&(nc(n,e,i,t),Ua(n,e,i))}};function as(e,n,t,i,r,a,o){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(i,a,o):!n.prototype||!n.prototype.isPureReactComponent||(!li(t,i)||!li(r,a))}function os(e,n,t){var i=!1,r=Pr,a=n.contextType;return"object"==typeof a&&null!==a?a=La(a):(r=Tr(n)?Lr:Er.current,a=(i=null!=(i=n.contextTypes))?Or(e,r):Pr),n=new n(t,a),e.memoizedState=null!==n.state&&void 0!==n.state?n.state:null,n.updater=rs,e.stateNode=n,n._reactInternals=e,i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=a),n}function ss(e,n,t,i){e=n.state,"function"==typeof n.componentWillReceiveProps&&n.componentWillReceiveProps(t,i),"function"==typeof n.UNSAFE_componentWillReceiveProps&&n.UNSAFE_componentWillReceiveProps(t,i),n.state!==e&&rs.enqueueReplaceState(n,n.state,null)}function ls(e,n,t,i){var r=e.stateNode;r.props=t,r.state=e.memoizedState,r.refs={},Aa(e);var a=n.contextType;"object"==typeof a&&null!==a?r.context=La(a):(a=Tr(n)?Lr:Er.current,r.context=Or(e,a)),r.state=e.memoizedState,"function"==typeof(a=n.getDerivedStateFromProps)&&(is(e,n,a,t),r.state=e.memoizedState),"function"==typeof n.getDerivedStateFromProps||"function"==typeof r.getSnapshotBeforeUpdate||"function"!=typeof r.UNSAFE_componentWillMount&&"function"!=typeof r.componentWillMount||(n=r.state,"function"==typeof r.componentWillMount&&r.componentWillMount(),"function"==typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),n!==r.state&&rs.enqueueReplaceState(r,r.state,null),Va(e,t,r,i),r.state=e.memoizedState),"function"==typeof r.componentDidMount&&(e.flags|=4194308)}function cs(e,n){try{var t="",i=n;do{t+=F(i),i=i.return}while(i);var r=t}catch(e){r="\nError generating stack: "+e.message+"\n"+e.stack}return{value:e,source:n,stack:r,digest:null}}function us(e,n,t){return{value:e,source:null,stack:null!=t?t:null,digest:null!=n?n:null}}function ds(e,n){try{console.error(n.value)}catch(e){setTimeout(function(){throw e})}}var ms="function"==typeof WeakMap?WeakMap:Map;function ps(e,n,t){(t=Ba(-1,t)).tag=3,t.payload={element:null};var i=n.value;return t.callback=function(){Wl||(Wl=!0,Hl=i),ds(0,n)},t}function hs(e,n,t){(t=Ba(-1,t)).tag=3;var i=e.type.getDerivedStateFromError;if("function"==typeof i){var r=n.value;t.payload=function(){return i(r)},t.callback=function(){ds(0,n)}}var a=e.stateNode;return null!==a&&"function"==typeof a.componentDidCatch&&(t.callback=function(){ds(0,n),"function"!=typeof i&&(null===$l?$l=new Set([this]):$l.add(this));var e=n.stack;this.componentDidCatch(n.value,{componentStack:null!==e?e:""})}),t}function vs(e,n,t){var i=e.pingCache;if(null===i){i=e.pingCache=new ms;var r=new Set;i.set(n,r)}else void 0===(r=i.get(n))&&(r=new Set,i.set(n,r));r.has(t)||(r.add(t),e=Sc.bind(null,e,n,t),n.then(e,e))}function fs(e){do{var n;if((n=13===e.tag)&&(n=null===(n=e.memoizedState)||null!==n.dehydrated),n)return e;e=e.return}while(null!==e);return null}function gs(e,n,t,i,r){return 1&e.mode?(e.flags|=65536,e.lanes=r,e):(e===n?e.flags|=65536:(e.flags|=128,t.flags|=131072,t.flags&=-52805,1===t.tag&&(null===t.alternate?t.tag=17:((n=Ba(-1,1)).tag=2,_a(t,n,1))),t.lanes|=1),e)}var bs=y.ReactCurrentOwner,xs=!1;function ys(e,n,t,i){n.child=null===e?ka(n,null,t,i):ya(n,e.child,t,i)}function ks(e,n,t,i,r){t=t.render;var a=n.ref;return Ma(n,r),i=fo(e,n,t,i,a,r),t=go(),null===e||xs?(ra&&t&&ea(n),n.flags|=1,ys(e,n,i,r),n.child):(n.updateQueue=e.updateQueue,n.flags&=-2053,e.lanes&=~r,Ws(e,n,r))}function ws(e,n,t,i,r){if(null===e){var a=t.type;return"function"!=typeof a||Oc(a)||void 0!==a.defaultProps||null!==t.compare||void 0!==t.defaultProps?((e=Dc(t.type,null,i,n,n.mode,r)).ref=n.ref,e.return=n,n.child=e):(n.tag=15,n.type=a,js(e,n,a,i,r))}if(a=e.child,0===(e.lanes&r)){var o=a.memoizedProps;if((t=null!==(t=t.compare)?t:li)(o,i)&&e.ref===n.ref)return Ws(e,n,r)}return n.flags|=1,(e=Tc(a,i)).ref=n.ref,e.return=n,n.child=e}function js(e,n,t,i,r){if(null!==e){var a=e.memoizedProps;if(li(a,i)&&e.ref===n.ref){if(xs=!1,n.pendingProps=i=a,0===(e.lanes&r))return n.lanes=e.lanes,Ws(e,n,r);131072&e.flags&&(xs=!0)}}return Ns(e,n,t,i,r)}function Ss(e,n,t){var i=n.pendingProps,r=i.children,a=null!==e?e.memoizedState:null;if("hidden"===i.mode)if(1&n.mode){if(!(1073741824&t))return e=null!==a?a.baseLanes|t:t,n.lanes=n.childLanes=1073741824,n.memoizedState={baseLanes:e,cachePool:null,transitions:null},n.updateQueue=null,Nr(Tl,Ol),Ol|=e,null;n.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=null!==a?a.baseLanes:t,Nr(Tl,Ol),Ol|=i}else n.memoizedState={baseLanes:0,cachePool:null,transitions:null},Nr(Tl,Ol),Ol|=t;else null!==a?(i=a.baseLanes|t,n.memoizedState=null):i=t,Nr(Tl,Ol),Ol|=i;return ys(e,n,r,t),n.child}function Cs(e,n){var t=n.ref;(null===e&&null!==t||null!==e&&e.ref!==t)&&(n.flags|=512,n.flags|=2097152)}function Ns(e,n,t,i,r){var a=Tr(t)?Lr:Er.current;return a=Or(n,a),Ma(n,r),t=fo(e,n,t,i,a,r),i=go(),null===e||xs?(ra&&i&&ea(n),n.flags|=1,ys(e,n,t,r),n.child):(n.updateQueue=e.updateQueue,n.flags&=-2053,e.lanes&=~r,Ws(e,n,r))}function Ps(e,n,t,i,r){if(Tr(t)){var a=!0;Ar(n)}else a=!1;if(Ma(n,r),null===n.stateNode)Vs(e,n),os(n,t,i),ls(n,t,i,r),i=!0;else if(null===e){var o=n.stateNode,s=n.memoizedProps;o.props=s;var l=o.context,c=t.contextType;"object"==typeof c&&null!==c?c=La(c):c=Or(n,c=Tr(t)?Lr:Er.current);var u=t.getDerivedStateFromProps,d="function"==typeof u||"function"==typeof o.getSnapshotBeforeUpdate;d||"function"!=typeof o.UNSAFE_componentWillReceiveProps&&"function"!=typeof o.componentWillReceiveProps||(s!==i||l!==c)&&ss(n,o,i,c),Ia=!1;var m=n.memoizedState;o.state=m,Va(n,i,o,r),l=n.memoizedState,s!==i||m!==l||Mr.current||Ia?("function"==typeof u&&(is(n,t,u,i),l=n.memoizedState),(s=Ia||as(n,t,s,i,m,l,c))?(d||"function"!=typeof o.UNSAFE_componentWillMount&&"function"!=typeof o.componentWillMount||("function"==typeof o.componentWillMount&&o.componentWillMount(),"function"==typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"==typeof o.componentDidMount&&(n.flags|=4194308)):("function"==typeof o.componentDidMount&&(n.flags|=4194308),n.memoizedProps=i,n.memoizedState=l),o.props=i,o.state=l,o.context=c,i=s):("function"==typeof o.componentDidMount&&(n.flags|=4194308),i=!1)}else{o=n.stateNode,Ra(e,n),s=n.memoizedProps,c=n.type===n.elementType?s:ts(n.type,s),o.props=c,d=n.pendingProps,m=o.context,"object"==typeof(l=t.contextType)&&null!==l?l=La(l):l=Or(n,l=Tr(t)?Lr:Er.current);var p=t.getDerivedStateFromProps;(u="function"==typeof p||"function"==typeof o.getSnapshotBeforeUpdate)||"function"!=typeof o.UNSAFE_componentWillReceiveProps&&"function"!=typeof o.componentWillReceiveProps||(s!==d||m!==l)&&ss(n,o,i,l),Ia=!1,m=n.memoizedState,o.state=m,Va(n,i,o,r);var h=n.memoizedState;s!==d||m!==h||Mr.current||Ia?("function"==typeof p&&(is(n,t,p,i),h=n.memoizedState),(c=Ia||as(n,t,c,i,m,h,l)||!1)?(u||"function"!=typeof o.UNSAFE_componentWillUpdate&&"function"!=typeof o.componentWillUpdate||("function"==typeof o.componentWillUpdate&&o.componentWillUpdate(i,h,l),"function"==typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(i,h,l)),"function"==typeof o.componentDidUpdate&&(n.flags|=4),"function"==typeof o.getSnapshotBeforeUpdate&&(n.flags|=1024)):("function"!=typeof o.componentDidUpdate||s===e.memoizedProps&&m===e.memoizedState||(n.flags|=4),"function"!=typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&m===e.memoizedState||(n.flags|=1024),n.memoizedProps=i,n.memoizedState=h),o.props=i,o.state=h,o.context=l,i=c):("function"!=typeof o.componentDidUpdate||s===e.memoizedProps&&m===e.memoizedState||(n.flags|=4),"function"!=typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&m===e.memoizedState||(n.flags|=1024),i=!1)}return Es(e,n,t,i,a,r)}function Es(e,n,t,i,r,a){Cs(e,n);var o=!!(128&n.flags);if(!i&&!o)return r&&Rr(n,t,!1),Ws(e,n,a);i=n.stateNode,bs.current=n;var s=o&&"function"!=typeof t.getDerivedStateFromError?null:i.render();return n.flags|=1,null!==e&&o?(n.child=ya(n,e.child,null,a),n.child=ya(n,null,s,a)):ys(e,n,s,a),n.memoizedState=i.state,r&&Rr(n,t,!0),n.child}function Ms(e){var n=e.stateNode;n.pendingContext?zr(0,n.pendingContext,n.pendingContext!==n.context):n.context&&zr(0,n.context,!1),Ga(e,n.containerInfo)}function Ls(e,n,t,i,r){return pa(),ha(r),n.flags|=256,ys(e,n,t,i),n.child}var Os,Ts,Ds,zs={dehydrated:null,treeContext:null,retryLane:0};function Is(e){return{baseLanes:e,cachePool:null,transitions:null}}function As(e,n,t){var i,r=n.pendingProps,o=Ja.current,s=!1,l=!!(128&n.flags);if((i=l)||(i=(null===e||null!==e.memoizedState)&&!!(2&o)),i?(s=!0,n.flags&=-129):null!==e&&null===e.memoizedState||(o|=1),Nr(Ja,1&o),null===e)return ca(n),null!==(e=n.memoizedState)&&null!==(e=e.dehydrated)?(1&n.mode?"$!"===e.data?n.lanes=8:n.lanes=1073741824:n.lanes=1,null):(l=r.children,e=r.fallback,s?(r=n.mode,s=n.child,l={mode:"hidden",children:l},1&r||null===s?s=Ic(l,r,0,null):(s.childLanes=0,s.pendingProps=l),e=zc(e,r,t,null),s.return=n,e.return=n,s.sibling=e,n.child=s,n.child.memoizedState=Is(t),n.memoizedState=zs,e):Rs(n,l));if(null!==(o=e.memoizedState)&&null!==(i=o.dehydrated))return function(e,n,t,i,r,o,s){if(t)return 256&n.flags?(n.flags&=-257,Bs(e,n,s,i=us(Error(a(422))))):null!==n.memoizedState?(n.child=e.child,n.flags|=128,null):(o=i.fallback,r=n.mode,i=Ic({mode:"visible",children:i.children},r,0,null),(o=zc(o,r,s,null)).flags|=2,i.return=n,o.return=n,i.sibling=o,n.child=i,1&n.mode&&ya(n,e.child,null,s),n.child.memoizedState=Is(s),n.memoizedState=zs,o);if(!(1&n.mode))return Bs(e,n,s,null);if("$!"===r.data){if(i=r.nextSibling&&r.nextSibling.dataset)var l=i.dgst;return i=l,Bs(e,n,s,i=us(o=Error(a(419)),i,void 0))}if(l=0!==(s&e.childLanes),xs||l){if(null!==(i=El)){switch(s&-s){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}0!==(r=0!==(r&(i.suspendedLanes|s))?0:r)&&r!==o.retryLane&&(o.retryLane=r,za(e,r),nc(i,e,r,-1))}return hc(),Bs(e,n,s,i=us(Error(a(421))))}return"$?"===r.data?(n.flags|=128,n.child=e.child,n=Nc.bind(null,e),r._reactRetry=n,null):(e=o.treeContext,ia=cr(r.nextSibling),ta=n,ra=!0,aa=null,null!==e&&(Yr[Kr++]=Qr,Yr[Kr++]=Xr,Yr[Kr++]=Gr,Qr=e.id,Xr=e.overflow,Gr=n),n=Rs(n,i.children),n.flags|=4096,n)}(e,n,l,r,i,o,t);if(s){s=r.fallback,l=n.mode,i=(o=e.child).sibling;var c={mode:"hidden",children:r.children};return 1&l||n.child===o?(r=Tc(o,c)).subtreeFlags=14680064&o.subtreeFlags:((r=n.child).childLanes=0,r.pendingProps=c,n.deletions=null),null!==i?s=Tc(i,s):(s=zc(s,l,t,null)).flags|=2,s.return=n,r.return=n,r.sibling=s,n.child=r,r=s,s=n.child,l=null===(l=e.child.memoizedState)?Is(t):{baseLanes:l.baseLanes|t,cachePool:null,transitions:l.transitions},s.memoizedState=l,s.childLanes=e.childLanes&~t,n.memoizedState=zs,r}return e=(s=e.child).sibling,r=Tc(s,{mode:"visible",children:r.children}),!(1&n.mode)&&(r.lanes=t),r.return=n,r.sibling=null,null!==e&&(null===(t=n.deletions)?(n.deletions=[e],n.flags|=16):t.push(e)),n.child=r,n.memoizedState=null,r}function Rs(e,n){return(n=Ic({mode:"visible",children:n},e.mode,0,null)).return=e,e.child=n}function Bs(e,n,t,i){return null!==i&&ha(i),ya(n,e.child,null,t),(e=Rs(n,n.pendingProps.children)).flags|=2,n.memoizedState=null,e}function _s(e,n,t){e.lanes|=n;var i=e.alternate;null!==i&&(i.lanes|=n),Ea(e.return,n,t)}function Us(e,n,t,i,r){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:n,rendering:null,renderingStartTime:0,last:i,tail:t,tailMode:r}:(a.isBackwards=n,a.rendering=null,a.renderingStartTime=0,a.last=i,a.tail=t,a.tailMode=r)}function Fs(e,n,t){var i=n.pendingProps,r=i.revealOrder,a=i.tail;if(ys(e,n,i.children,t),2&(i=Ja.current))i=1&i|2,n.flags|=128;else{if(null!==e&&128&e.flags)e:for(e=n.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&_s(e,t,n);else if(19===e.tag)_s(e,t,n);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===n)break e;for(;null===e.sibling;){if(null===e.return||e.return===n)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}if(Nr(Ja,i),1&n.mode)switch(r){case"forwards":for(t=n.child,r=null;null!==t;)null!==(e=t.alternate)&&null===eo(e)&&(r=t),t=t.sibling;null===(t=r)?(r=n.child,n.child=null):(r=t.sibling,t.sibling=null),Us(n,!1,r,t,a);break;case"backwards":for(t=null,r=n.child,n.child=null;null!==r;){if(null!==(e=r.alternate)&&null===eo(e)){n.child=r;break}e=r.sibling,r.sibling=t,t=r,r=e}Us(n,!0,t,null,a);break;case"together":Us(n,!1,null,null,void 0);break;default:n.memoizedState=null}else n.memoizedState=null;return n.child}function Vs(e,n){!(1&n.mode)&&null!==e&&(e.alternate=null,n.alternate=null,n.flags|=2)}function Ws(e,n,t){if(null!==e&&(n.dependencies=e.dependencies),Il|=n.lanes,0===(t&n.childLanes))return null;if(null!==e&&n.child!==e.child)throw Error(a(153));if(null!==n.child){for(t=Tc(e=n.child,e.pendingProps),n.child=t,t.return=n;null!==e.sibling;)e=e.sibling,(t=t.sibling=Tc(e,e.pendingProps)).return=n;t.sibling=null}return n.child}function Hs(e,n){if(!ra)switch(e.tailMode){case"hidden":n=e.tail;for(var t=null;null!==n;)null!==n.alternate&&(t=n),n=n.sibling;null===t?e.tail=null:t.sibling=null;break;case"collapsed":t=e.tail;for(var i=null;null!==t;)null!==t.alternate&&(i=t),t=t.sibling;null===i?n||null===e.tail?e.tail=null:e.tail.sibling=null:i.sibling=null}}function $s(e){var n=null!==e.alternate&&e.alternate.child===e.child,t=0,i=0;if(n)for(var r=e.child;null!==r;)t|=r.lanes|r.childLanes,i|=14680064&r.subtreeFlags,i|=14680064&r.flags,r.return=e,r=r.sibling;else for(r=e.child;null!==r;)t|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=i,e.childLanes=t,n}function qs(e,n,t){var i=n.pendingProps;switch(na(n),n.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return $s(n),null;case 1:case 17:return Tr(n.type)&&Dr(),$s(n),null;case 3:return i=n.stateNode,Qa(),Cr(Mr),Cr(Er),to(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),null!==e&&null!==e.child||(da(n)?n.flags|=4:null===e||e.memoizedState.isDehydrated&&!(256&n.flags)||(n.flags|=1024,null!==aa&&(ac(aa),aa=null))),$s(n),null;case 5:Za(n);var r=Ka(Ya.current);if(t=n.type,null!==e&&null!=n.stateNode)Ts(e,n,t,i),e.ref!==n.ref&&(n.flags|=512,n.flags|=2097152);else{if(!i){if(null===n.stateNode)throw Error(a(166));return $s(n),null}if(e=Ka($a.current),da(n)){i=n.stateNode,t=n.type;var o=n.memoizedProps;switch(i[mr]=n,i[pr]=o,e=!!(1&n.mode),t){case"dialog":_i("cancel",i),_i("close",i);break;case"iframe":case"object":case"embed":_i("load",i);break;case"video":case"audio":for(r=0;r<Ii.length;r++)_i(Ii[r],i);break;case"source":_i("error",i);break;case"img":case"image":case"link":_i("error",i),_i("load",i);break;case"details":_i("toggle",i);break;case"input":Q(i,o),_i("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!o.multiple},_i("invalid",i);break;case"textarea":re(i,o),_i("invalid",i)}for(var l in be(t,o),r=null,o)if(o.hasOwnProperty(l)){var c=o[l];"children"===l?"string"==typeof c?i.textContent!==c&&(!0!==o.suppressHydrationWarning&&Zi(i.textContent,c,e),r=["children",c]):"number"==typeof c&&i.textContent!==""+c&&(!0!==o.suppressHydrationWarning&&Zi(i.textContent,c,e),r=["children",""+c]):s.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&_i("scroll",i)}switch(t){case"input":q(i),J(i,o,!0);break;case"textarea":q(i),oe(i);break;case"select":case"option":break;default:"function"==typeof o.onClick&&(i.onclick=Ji)}i=r,n.updateQueue=i,null!==i&&(n.flags|=4)}else{l=9===r.nodeType?r:r.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=se(t)),"http://www.w3.org/1999/xhtml"===e?"script"===t?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"==typeof i.is?e=l.createElement(t,{is:i.is}):(e=l.createElement(t),"select"===t&&(l=e,i.multiple?l.multiple=!0:i.size&&(l.size=i.size))):e=l.createElementNS(e,t),e[mr]=n,e[pr]=i,Os(e,n),n.stateNode=e;e:{switch(l=xe(t,i),t){case"dialog":_i("cancel",e),_i("close",e),r=i;break;case"iframe":case"object":case"embed":_i("load",e),r=i;break;case"video":case"audio":for(r=0;r<Ii.length;r++)_i(Ii[r],e);r=i;break;case"source":_i("error",e),r=i;break;case"img":case"image":case"link":_i("error",e),_i("load",e),r=i;break;case"details":_i("toggle",e),r=i;break;case"input":Q(e,i),r=G(e,i),_i("invalid",e);break;case"option":default:r=i;break;case"select":e._wrapperState={wasMultiple:!!i.multiple},r=R({},i,{value:void 0}),_i("invalid",e);break;case"textarea":re(e,i),r=ie(e,i),_i("invalid",e)}for(o in be(t,r),c=r)if(c.hasOwnProperty(o)){var u=c[o];"style"===o?fe(e,u):"dangerouslySetInnerHTML"===o?null!=(u=u?u.__html:void 0)&&de(e,u):"children"===o?"string"==typeof u?("textarea"!==t||""!==u)&&me(e,u):"number"==typeof u&&me(e,""+u):"suppressContentEditableWarning"!==o&&"suppressHydrationWarning"!==o&&"autoFocus"!==o&&(s.hasOwnProperty(o)?null!=u&&"onScroll"===o&&_i("scroll",e):null!=u&&x(e,o,u,l))}switch(t){case"input":q(e),J(e,i,!1);break;case"textarea":q(e),oe(e);break;case"option":null!=i.value&&e.setAttribute("value",""+H(i.value));break;case"select":e.multiple=!!i.multiple,null!=(o=i.value)?te(e,!!i.multiple,o,!1):null!=i.defaultValue&&te(e,!!i.multiple,i.defaultValue,!0);break;default:"function"==typeof r.onClick&&(e.onclick=Ji)}switch(t){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(n.flags|=4)}null!==n.ref&&(n.flags|=512,n.flags|=2097152)}return $s(n),null;case 6:if(e&&null!=n.stateNode)Ds(0,n,e.memoizedProps,i);else{if("string"!=typeof i&&null===n.stateNode)throw Error(a(166));if(t=Ka(Ya.current),Ka($a.current),da(n)){if(i=n.stateNode,t=n.memoizedProps,i[mr]=n,(o=i.nodeValue!==t)&&null!==(e=ta))switch(e.tag){case 3:Zi(i.nodeValue,t,!!(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Zi(i.nodeValue,t,!!(1&e.mode))}o&&(n.flags|=4)}else(i=(9===t.nodeType?t:t.ownerDocument).createTextNode(i))[mr]=n,n.stateNode=i}return $s(n),null;case 13:if(Cr(Ja),i=n.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(ra&&null!==ia&&1&n.mode&&!(128&n.flags))ma(),pa(),n.flags|=98560,o=!1;else if(o=da(n),null!==i&&null!==i.dehydrated){if(null===e){if(!o)throw Error(a(318));if(!(o=null!==(o=n.memoizedState)?o.dehydrated:null))throw Error(a(317));o[mr]=n}else pa(),!(128&n.flags)&&(n.memoizedState=null),n.flags|=4;$s(n),o=!1}else null!==aa&&(ac(aa),aa=null),o=!0;if(!o)return 65536&n.flags?n:null}return 128&n.flags?(n.lanes=t,n):((i=null!==i)!==(null!==e&&null!==e.memoizedState)&&i&&(n.child.flags|=8192,1&n.mode&&(null===e||1&Ja.current?0===Dl&&(Dl=3):hc())),null!==n.updateQueue&&(n.flags|=4),$s(n),null);case 4:return Qa(),null===e&&Vi(n.stateNode.containerInfo),$s(n),null;case 10:return Pa(n.type._context),$s(n),null;case 19:if(Cr(Ja),null===(o=n.memoizedState))return $s(n),null;if(i=!!(128&n.flags),null===(l=o.rendering))if(i)Hs(o,!1);else{if(0!==Dl||null!==e&&128&e.flags)for(e=n.child;null!==e;){if(null!==(l=eo(e))){for(n.flags|=128,Hs(o,!1),null!==(i=l.updateQueue)&&(n.updateQueue=i,n.flags|=4),n.subtreeFlags=0,i=t,t=n.child;null!==t;)e=i,(o=t).flags&=14680066,null===(l=o.alternate)?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=l.childLanes,o.lanes=l.lanes,o.child=l.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=l.memoizedProps,o.memoizedState=l.memoizedState,o.updateQueue=l.updateQueue,o.type=l.type,e=l.dependencies,o.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),t=t.sibling;return Nr(Ja,1&Ja.current|2),n.child}e=e.sibling}null!==o.tail&&Xe()>Fl&&(n.flags|=128,i=!0,Hs(o,!1),n.lanes=4194304)}else{if(!i)if(null!==(e=eo(l))){if(n.flags|=128,i=!0,null!==(t=e.updateQueue)&&(n.updateQueue=t,n.flags|=4),Hs(o,!0),null===o.tail&&"hidden"===o.tailMode&&!l.alternate&&!ra)return $s(n),null}else 2*Xe()-o.renderingStartTime>Fl&&1073741824!==t&&(n.flags|=128,i=!0,Hs(o,!1),n.lanes=4194304);o.isBackwards?(l.sibling=n.child,n.child=l):(null!==(t=o.last)?t.sibling=l:n.child=l,o.last=l)}return null!==o.tail?(n=o.tail,o.rendering=n,o.tail=n.sibling,o.renderingStartTime=Xe(),n.sibling=null,t=Ja.current,Nr(Ja,i?1&t|2:1&t),n):($s(n),null);case 22:case 23:return uc(),i=null!==n.memoizedState,null!==e&&null!==e.memoizedState!==i&&(n.flags|=8192),i&&1&n.mode?!!(1073741824&Ol)&&($s(n),6&n.subtreeFlags&&(n.flags|=8192)):$s(n),null;case 24:case 25:return null}throw Error(a(156,n.tag))}function Ys(e,n){switch(na(n),n.tag){case 1:return Tr(n.type)&&Dr(),65536&(e=n.flags)?(n.flags=-65537&e|128,n):null;case 3:return Qa(),Cr(Mr),Cr(Er),to(),65536&(e=n.flags)&&!(128&e)?(n.flags=-65537&e|128,n):null;case 5:return Za(n),null;case 13:if(Cr(Ja),null!==(e=n.memoizedState)&&null!==e.dehydrated){if(null===n.alternate)throw Error(a(340));pa()}return 65536&(e=n.flags)?(n.flags=-65537&e|128,n):null;case 19:return Cr(Ja),null;case 4:return Qa(),null;case 10:return Pa(n.type._context),null;case 22:case 23:return uc(),null;default:return null}}Os=function(e,n){for(var t=n.child;null!==t;){if(5===t.tag||6===t.tag)e.appendChild(t.stateNode);else if(4!==t.tag&&null!==t.child){t.child.return=t,t=t.child;continue}if(t===n)break;for(;null===t.sibling;){if(null===t.return||t.return===n)return;t=t.return}t.sibling.return=t.return,t=t.sibling}},Ts=function(e,n,t,i){var r=e.memoizedProps;if(r!==i){e=n.stateNode,Ka($a.current);var a,o=null;switch(t){case"input":r=G(e,r),i=G(e,i),o=[];break;case"select":r=R({},r,{value:void 0}),i=R({},i,{value:void 0}),o=[];break;case"textarea":r=ie(e,r),i=ie(e,i),o=[];break;default:"function"!=typeof r.onClick&&"function"==typeof i.onClick&&(e.onclick=Ji)}for(u in be(t,i),t=null,r)if(!i.hasOwnProperty(u)&&r.hasOwnProperty(u)&&null!=r[u])if("style"===u){var l=r[u];for(a in l)l.hasOwnProperty(a)&&(t||(t={}),t[a]="")}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(s.hasOwnProperty(u)?o||(o=[]):(o=o||[]).push(u,null));for(u in i){var c=i[u];if(l=null!=r?r[u]:void 0,i.hasOwnProperty(u)&&c!==l&&(null!=c||null!=l))if("style"===u)if(l){for(a in l)!l.hasOwnProperty(a)||c&&c.hasOwnProperty(a)||(t||(t={}),t[a]="");for(a in c)c.hasOwnProperty(a)&&l[a]!==c[a]&&(t||(t={}),t[a]=c[a])}else t||(o||(o=[]),o.push(u,t)),t=c;else"dangerouslySetInnerHTML"===u?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(o=o||[]).push(u,c)):"children"===u?"string"!=typeof c&&"number"!=typeof c||(o=o||[]).push(u,""+c):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(s.hasOwnProperty(u)?(null!=c&&"onScroll"===u&&_i("scroll",e),o||l===c||(o=[])):(o=o||[]).push(u,c))}t&&(o=o||[]).push("style",t);var u=o;(n.updateQueue=u)&&(n.flags|=4)}},Ds=function(e,n,t,i){t!==i&&(n.flags|=4)};var Ks=!1,Gs=!1,Qs="function"==typeof WeakSet?WeakSet:Set,Xs=null;function Zs(e,n){var t=e.ref;if(null!==t)if("function"==typeof t)try{t(null)}catch(t){jc(e,n,t)}else t.current=null}function Js(e,n,t){try{t()}catch(t){jc(e,n,t)}}var el=!1;function nl(e,n,t){var i=n.updateQueue;if(null!==(i=null!==i?i.lastEffect:null)){var r=i=i.next;do{if((r.tag&e)===e){var a=r.destroy;r.destroy=void 0,void 0!==a&&Js(n,t,a)}r=r.next}while(r!==i)}}function tl(e,n){if(null!==(n=null!==(n=n.updateQueue)?n.lastEffect:null)){var t=n=n.next;do{if((t.tag&e)===e){var i=t.create;t.destroy=i()}t=t.next}while(t!==n)}}function il(e){var n=e.ref;if(null!==n){var t=e.stateNode;e.tag,e=t,"function"==typeof n?n(e):n.current=e}}function rl(e){var n=e.alternate;null!==n&&(e.alternate=null,rl(n)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(n=e.stateNode)&&(delete n[mr],delete n[pr],delete n[vr],delete n[fr],delete n[gr])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function al(e){return 5===e.tag||3===e.tag||4===e.tag}function ol(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||al(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function sl(e,n,t){var i=e.tag;if(5===i||6===i)e=e.stateNode,n?8===t.nodeType?t.parentNode.insertBefore(e,n):t.insertBefore(e,n):(8===t.nodeType?(n=t.parentNode).insertBefore(e,t):(n=t).appendChild(e),null!=(t=t._reactRootContainer)||null!==n.onclick||(n.onclick=Ji));else if(4!==i&&null!==(e=e.child))for(sl(e,n,t),e=e.sibling;null!==e;)sl(e,n,t),e=e.sibling}function ll(e,n,t){var i=e.tag;if(5===i||6===i)e=e.stateNode,n?t.insertBefore(e,n):t.appendChild(e);else if(4!==i&&null!==(e=e.child))for(ll(e,n,t),e=e.sibling;null!==e;)ll(e,n,t),e=e.sibling}var cl=null,ul=!1;function dl(e,n,t){for(t=t.child;null!==t;)ml(e,n,t),t=t.sibling}function ml(e,n,t){if(on&&"function"==typeof on.onCommitFiberUnmount)try{on.onCommitFiberUnmount(an,t)}catch(e){}switch(t.tag){case 5:Gs||Zs(t,n);case 6:var i=cl,r=ul;cl=null,dl(e,n,t),ul=r,null!==(cl=i)&&(ul?(e=cl,t=t.stateNode,8===e.nodeType?e.parentNode.removeChild(t):e.removeChild(t)):cl.removeChild(t.stateNode));break;case 18:null!==cl&&(ul?(e=cl,t=t.stateNode,8===e.nodeType?lr(e.parentNode,t):1===e.nodeType&&lr(e,t),Wn(e)):lr(cl,t.stateNode));break;case 4:i=cl,r=ul,cl=t.stateNode.containerInfo,ul=!0,dl(e,n,t),cl=i,ul=r;break;case 0:case 11:case 14:case 15:if(!Gs&&(null!==(i=t.updateQueue)&&null!==(i=i.lastEffect))){r=i=i.next;do{var a=r,o=a.destroy;a=a.tag,void 0!==o&&(2&a||4&a)&&Js(t,n,o),r=r.next}while(r!==i)}dl(e,n,t);break;case 1:if(!Gs&&(Zs(t,n),"function"==typeof(i=t.stateNode).componentWillUnmount))try{i.props=t.memoizedProps,i.state=t.memoizedState,i.componentWillUnmount()}catch(e){jc(t,n,e)}dl(e,n,t);break;case 21:dl(e,n,t);break;case 22:1&t.mode?(Gs=(i=Gs)||null!==t.memoizedState,dl(e,n,t),Gs=i):dl(e,n,t);break;default:dl(e,n,t)}}function pl(e){var n=e.updateQueue;if(null!==n){e.updateQueue=null;var t=e.stateNode;null===t&&(t=e.stateNode=new Qs),n.forEach(function(n){var i=Pc.bind(null,e,n);t.has(n)||(t.add(n),n.then(i,i))})}}function hl(e,n){var t=n.deletions;if(null!==t)for(var i=0;i<t.length;i++){var r=t[i];try{var o=e,s=n,l=s;e:for(;null!==l;){switch(l.tag){case 5:cl=l.stateNode,ul=!1;break e;case 3:case 4:cl=l.stateNode.containerInfo,ul=!0;break e}l=l.return}if(null===cl)throw Error(a(160));ml(o,s,r),cl=null,ul=!1;var c=r.alternate;null!==c&&(c.return=null),r.return=null}catch(e){jc(r,n,e)}}if(12854&n.subtreeFlags)for(n=n.child;null!==n;)vl(n,e),n=n.sibling}function vl(e,n){var t=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(hl(n,e),fl(e),4&i){try{nl(3,e,e.return),tl(3,e)}catch(n){jc(e,e.return,n)}try{nl(5,e,e.return)}catch(n){jc(e,e.return,n)}}break;case 1:hl(n,e),fl(e),512&i&&null!==t&&Zs(t,t.return);break;case 5:if(hl(n,e),fl(e),512&i&&null!==t&&Zs(t,t.return),32&e.flags){var r=e.stateNode;try{me(r,"")}catch(n){jc(e,e.return,n)}}if(4&i&&null!=(r=e.stateNode)){var o=e.memoizedProps,s=null!==t?t.memoizedProps:o,l=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===l&&"radio"===o.type&&null!=o.name&&X(r,o),xe(l,s);var u=xe(l,o);for(s=0;s<c.length;s+=2){var d=c[s],m=c[s+1];"style"===d?fe(r,m):"dangerouslySetInnerHTML"===d?de(r,m):"children"===d?me(r,m):x(r,d,m,u)}switch(l){case"input":Z(r,o);break;case"textarea":ae(r,o);break;case"select":var p=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!o.multiple;var h=o.value;null!=h?te(r,!!o.multiple,h,!1):p!==!!o.multiple&&(null!=o.defaultValue?te(r,!!o.multiple,o.defaultValue,!0):te(r,!!o.multiple,o.multiple?[]:"",!1))}r[pr]=o}catch(n){jc(e,e.return,n)}}break;case 6:if(hl(n,e),fl(e),4&i){if(null===e.stateNode)throw Error(a(162));r=e.stateNode,o=e.memoizedProps;try{r.nodeValue=o}catch(n){jc(e,e.return,n)}}break;case 3:if(hl(n,e),fl(e),4&i&&null!==t&&t.memoizedState.isDehydrated)try{Wn(n.containerInfo)}catch(n){jc(e,e.return,n)}break;case 4:default:hl(n,e),fl(e);break;case 13:hl(n,e),fl(e),8192&(r=e.child).flags&&(o=null!==r.memoizedState,r.stateNode.isHidden=o,!o||null!==r.alternate&&null!==r.alternate.memoizedState||(Ul=Xe())),4&i&&pl(e);break;case 22:if(d=null!==t&&null!==t.memoizedState,1&e.mode?(Gs=(u=Gs)||d,hl(n,e),Gs=u):hl(n,e),fl(e),8192&i){if(u=null!==e.memoizedState,(e.stateNode.isHidden=u)&&!d&&1&e.mode)for(Xs=e,d=e.child;null!==d;){for(m=Xs=d;null!==Xs;){switch(h=(p=Xs).child,p.tag){case 0:case 11:case 14:case 15:nl(4,p,p.return);break;case 1:Zs(p,p.return);var v=p.stateNode;if("function"==typeof v.componentWillUnmount){i=p,t=p.return;try{n=i,v.props=n.memoizedProps,v.state=n.memoizedState,v.componentWillUnmount()}catch(e){jc(i,t,e)}}break;case 5:Zs(p,p.return);break;case 22:if(null!==p.memoizedState){yl(m);continue}}null!==h?(h.return=p,Xs=h):yl(m)}d=d.sibling}e:for(d=null,m=e;;){if(5===m.tag){if(null===d){d=m;try{r=m.stateNode,u?"function"==typeof(o=r.style).setProperty?o.setProperty("display","none","important"):o.display="none":(l=m.stateNode,s=null!=(c=m.memoizedProps.style)&&c.hasOwnProperty("display")?c.display:null,l.style.display=ve("display",s))}catch(n){jc(e,e.return,n)}}}else if(6===m.tag){if(null===d)try{m.stateNode.nodeValue=u?"":m.memoizedProps}catch(n){jc(e,e.return,n)}}else if((22!==m.tag&&23!==m.tag||null===m.memoizedState||m===e)&&null!==m.child){m.child.return=m,m=m.child;continue}if(m===e)break e;for(;null===m.sibling;){if(null===m.return||m.return===e)break e;d===m&&(d=null),m=m.return}d===m&&(d=null),m.sibling.return=m.return,m=m.sibling}}break;case 19:hl(n,e),fl(e),4&i&&pl(e);case 21:}}function fl(e){var n=e.flags;if(2&n){try{e:{for(var t=e.return;null!==t;){if(al(t)){var i=t;break e}t=t.return}throw Error(a(160))}switch(i.tag){case 5:var r=i.stateNode;32&i.flags&&(me(r,""),i.flags&=-33),ll(e,ol(e),r);break;case 3:case 4:var o=i.stateNode.containerInfo;sl(e,ol(e),o);break;default:throw Error(a(161))}}catch(n){jc(e,e.return,n)}e.flags&=-3}4096&n&&(e.flags&=-4097)}function gl(e,n,t){Xs=e,bl(e,n,t)}function bl(e,n,t){for(var i=!!(1&e.mode);null!==Xs;){var r=Xs,a=r.child;if(22===r.tag&&i){var o=null!==r.memoizedState||Ks;if(!o){var s=r.alternate,l=null!==s&&null!==s.memoizedState||Gs;s=Ks;var c=Gs;if(Ks=o,(Gs=l)&&!c)for(Xs=r;null!==Xs;)l=(o=Xs).child,22===o.tag&&null!==o.memoizedState?kl(r):null!==l?(l.return=o,Xs=l):kl(r);for(;null!==a;)Xs=a,bl(a,n,t),a=a.sibling;Xs=r,Ks=s,Gs=c}xl(e)}else 8772&r.subtreeFlags&&null!==a?(a.return=r,Xs=a):xl(e)}}function xl(e){for(;null!==Xs;){var n=Xs;if(8772&n.flags){var t=n.alternate;try{if(8772&n.flags)switch(n.tag){case 0:case 11:case 15:Gs||tl(5,n);break;case 1:var i=n.stateNode;if(4&n.flags&&!Gs)if(null===t)i.componentDidMount();else{var r=n.elementType===n.type?t.memoizedProps:ts(n.type,t.memoizedProps);i.componentDidUpdate(r,t.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var o=n.updateQueue;null!==o&&Wa(n,o,i);break;case 3:var s=n.updateQueue;if(null!==s){if(t=null,null!==n.child)switch(n.child.tag){case 5:case 1:t=n.child.stateNode}Wa(n,s,t)}break;case 5:var l=n.stateNode;if(null===t&&4&n.flags){t=l;var c=n.memoizedProps;switch(n.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&t.focus();break;case"img":c.src&&(t.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===n.memoizedState){var u=n.alternate;if(null!==u){var d=u.memoizedState;if(null!==d){var m=d.dehydrated;null!==m&&Wn(m)}}}break;default:throw Error(a(163))}Gs||512&n.flags&&il(n)}catch(e){jc(n,n.return,e)}}if(n===e){Xs=null;break}if(null!==(t=n.sibling)){t.return=n.return,Xs=t;break}Xs=n.return}}function yl(e){for(;null!==Xs;){var n=Xs;if(n===e){Xs=null;break}var t=n.sibling;if(null!==t){t.return=n.return,Xs=t;break}Xs=n.return}}function kl(e){for(;null!==Xs;){var n=Xs;try{switch(n.tag){case 0:case 11:case 15:var t=n.return;try{tl(4,n)}catch(e){jc(n,t,e)}break;case 1:var i=n.stateNode;if("function"==typeof i.componentDidMount){var r=n.return;try{i.componentDidMount()}catch(e){jc(n,r,e)}}var a=n.return;try{il(n)}catch(e){jc(n,a,e)}break;case 5:var o=n.return;try{il(n)}catch(e){jc(n,o,e)}}}catch(e){jc(n,n.return,e)}if(n===e){Xs=null;break}var s=n.sibling;if(null!==s){s.return=n.return,Xs=s;break}Xs=n.return}}var wl,jl=Math.ceil,Sl=y.ReactCurrentDispatcher,Cl=y.ReactCurrentOwner,Nl=y.ReactCurrentBatchConfig,Pl=0,El=null,Ml=null,Ll=0,Ol=0,Tl=Sr(0),Dl=0,zl=null,Il=0,Al=0,Rl=0,Bl=null,_l=null,Ul=0,Fl=1/0,Vl=null,Wl=!1,Hl=null,$l=null,ql=!1,Yl=null,Kl=0,Gl=0,Ql=null,Xl=-1,Zl=0;function Jl(){return 6&Pl?Xe():-1!==Xl?Xl:Xl=Xe()}function ec(e){return 1&e.mode?2&Pl&&0!==Ll?Ll&-Ll:null!==va.transition?(0===Zl&&(Zl=fn()),Zl):0!==(e=yn)?e:e=void 0===(e=window.event)?16:Xn(e.type):1}function nc(e,n,t,i){if(50<Gl)throw Gl=0,Ql=null,Error(a(185));bn(e,t,i),2&Pl&&e===El||(e===El&&(!(2&Pl)&&(Al|=t),4===Dl&&oc(e,Ll)),tc(e,i),1===t&&0===Pl&&!(1&n.mode)&&(Fl=Xe()+500,_r&&Vr()))}function tc(e,n){var t=e.callbackNode;!function(e,n){for(var t=e.suspendedLanes,i=e.pingedLanes,r=e.expirationTimes,a=e.pendingLanes;0<a;){var o=31-sn(a),s=1<<o,l=r[o];-1===l?0!==(s&t)&&0===(s&i)||(r[o]=hn(s,n)):l<=n&&(e.expiredLanes|=s),a&=~s}}(e,n);var i=pn(e,e===El?Ll:0);if(0===i)null!==t&&Ke(t),e.callbackNode=null,e.callbackPriority=0;else if(n=i&-i,e.callbackPriority!==n){if(null!=t&&Ke(t),1===n)0===e.tag?function(e){_r=!0,Fr(e)}(sc.bind(null,e)):Fr(sc.bind(null,e)),or(function(){!(6&Pl)&&Vr()}),t=null;else{switch(kn(i)){case 1:t=Je;break;case 4:t=en;break;case 16:default:t=nn;break;case 536870912:t=rn}t=Ec(t,ic.bind(null,e))}e.callbackPriority=n,e.callbackNode=t}}function ic(e,n){if(Xl=-1,Zl=0,6&Pl)throw Error(a(327));var t=e.callbackNode;if(kc()&&e.callbackNode!==t)return null;var i=pn(e,e===El?Ll:0);if(0===i)return null;if(30&i||0!==(i&e.expiredLanes)||n)n=vc(e,i);else{n=i;var r=Pl;Pl|=2;var o=pc();for(El===e&&Ll===n||(Vl=null,Fl=Xe()+500,dc(e,n));;)try{gc();break}catch(n){mc(e,n)}Na(),Sl.current=o,Pl=r,null!==Ml?n=0:(El=null,Ll=0,n=Dl)}if(0!==n){if(2===n&&(0!==(r=vn(e))&&(i=r,n=rc(e,r))),1===n)throw t=zl,dc(e,0),oc(e,i),tc(e,Xe()),t;if(6===n)oc(e,i);else{if(r=e.current.alternate,!(30&i||function(e){for(var n=e;;){if(16384&n.flags){var t=n.updateQueue;if(null!==t&&null!==(t=t.stores))for(var i=0;i<t.length;i++){var r=t[i],a=r.getSnapshot;r=r.value;try{if(!si(a(),r))return!1}catch(e){return!1}}}if(t=n.child,16384&n.subtreeFlags&&null!==t)t.return=n,n=t;else{if(n===e)break;for(;null===n.sibling;){if(null===n.return||n.return===e)return!0;n=n.return}n.sibling.return=n.return,n=n.sibling}}return!0}(r)||(n=vc(e,i),2===n&&(o=vn(e),0!==o&&(i=o,n=rc(e,o))),1!==n)))throw t=zl,dc(e,0),oc(e,i),tc(e,Xe()),t;switch(e.finishedWork=r,e.finishedLanes=i,n){case 0:case 1:throw Error(a(345));case 2:case 5:yc(e,_l,Vl);break;case 3:if(oc(e,i),(130023424&i)===i&&10<(n=Ul+500-Xe())){if(0!==pn(e,0))break;if(((r=e.suspendedLanes)&i)!==i){Jl(),e.pingedLanes|=e.suspendedLanes&r;break}e.timeoutHandle=ir(yc.bind(null,e,_l,Vl),n);break}yc(e,_l,Vl);break;case 4:if(oc(e,i),(4194240&i)===i)break;for(n=e.eventTimes,r=-1;0<i;){var s=31-sn(i);o=1<<s,(s=n[s])>r&&(r=s),i&=~o}if(i=r,10<(i=(120>(i=Xe()-i)?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*jl(i/1960))-i)){e.timeoutHandle=ir(yc.bind(null,e,_l,Vl),i);break}yc(e,_l,Vl);break;default:throw Error(a(329))}}}return tc(e,Xe()),e.callbackNode===t?ic.bind(null,e):null}function rc(e,n){var t=Bl;return e.current.memoizedState.isDehydrated&&(dc(e,n).flags|=256),2!==(e=vc(e,n))&&(n=_l,_l=t,null!==n&&ac(n)),e}function ac(e){null===_l?_l=e:_l.push.apply(_l,e)}function oc(e,n){for(n&=~Rl,n&=~Al,e.suspendedLanes|=n,e.pingedLanes&=~n,e=e.expirationTimes;0<n;){var t=31-sn(n),i=1<<t;e[t]=-1,n&=~i}}function sc(e){if(6&Pl)throw Error(a(327));kc();var n=pn(e,0);if(!(1&n))return tc(e,Xe()),null;var t=vc(e,n);if(0!==e.tag&&2===t){var i=vn(e);0!==i&&(n=i,t=rc(e,i))}if(1===t)throw t=zl,dc(e,0),oc(e,n),tc(e,Xe()),t;if(6===t)throw Error(a(345));return e.finishedWork=e.current.alternate,e.finishedLanes=n,yc(e,_l,Vl),tc(e,Xe()),null}function lc(e,n){var t=Pl;Pl|=1;try{return e(n)}finally{0===(Pl=t)&&(Fl=Xe()+500,_r&&Vr())}}function cc(e){null!==Yl&&0===Yl.tag&&!(6&Pl)&&kc();var n=Pl;Pl|=1;var t=Nl.transition,i=yn;try{if(Nl.transition=null,yn=1,e)return e()}finally{yn=i,Nl.transition=t,!(6&(Pl=n))&&Vr()}}function uc(){Ol=Tl.current,Cr(Tl)}function dc(e,n){e.finishedWork=null,e.finishedLanes=0;var t=e.timeoutHandle;if(-1!==t&&(e.timeoutHandle=-1,rr(t)),null!==Ml)for(t=Ml.return;null!==t;){var i=t;switch(na(i),i.tag){case 1:null!=(i=i.type.childContextTypes)&&Dr();break;case 3:Qa(),Cr(Mr),Cr(Er),to();break;case 5:Za(i);break;case 4:Qa();break;case 13:case 19:Cr(Ja);break;case 10:Pa(i.type._context);break;case 22:case 23:uc()}t=t.return}if(El=e,Ml=e=Tc(e.current,null),Ll=Ol=n,Dl=0,zl=null,Rl=Al=Il=0,_l=Bl=null,null!==Oa){for(n=0;n<Oa.length;n++)if(null!==(i=(t=Oa[n]).interleaved)){t.interleaved=null;var r=i.next,a=t.pending;if(null!==a){var o=a.next;a.next=r,i.next=o}t.pending=i}Oa=null}return e}function mc(e,n){for(;;){var t=Ml;try{if(Na(),io.current=Zo,co){for(var i=oo.memoizedState;null!==i;){var r=i.queue;null!==r&&(r.pending=null),i=i.next}co=!1}if(ao=0,lo=so=oo=null,uo=!1,mo=0,Cl.current=null,null===t||null===t.return){Dl=1,zl=n,Ml=null;break}e:{var o=e,s=t.return,l=t,c=n;if(n=Ll,l.flags|=32768,null!==c&&"object"==typeof c&&"function"==typeof c.then){var u=c,d=l,m=d.tag;if(!(1&d.mode||0!==m&&11!==m&&15!==m)){var p=d.alternate;p?(d.updateQueue=p.updateQueue,d.memoizedState=p.memoizedState,d.lanes=p.lanes):(d.updateQueue=null,d.memoizedState=null)}var h=fs(s);if(null!==h){h.flags&=-257,gs(h,s,l,0,n),1&h.mode&&vs(o,u,n),c=u;var v=(n=h).updateQueue;if(null===v){var f=new Set;f.add(c),n.updateQueue=f}else v.add(c);break e}if(!(1&n)){vs(o,u,n),hc();break e}c=Error(a(426))}else if(ra&&1&l.mode){var g=fs(s);if(null!==g){!(65536&g.flags)&&(g.flags|=256),gs(g,s,l,0,n),ha(cs(c,l));break e}}o=c=cs(c,l),4!==Dl&&(Dl=2),null===Bl?Bl=[o]:Bl.push(o),o=s;do{switch(o.tag){case 3:o.flags|=65536,n&=-n,o.lanes|=n,Fa(o,ps(0,c,n));break e;case 1:l=c;var b=o.type,x=o.stateNode;if(!(128&o.flags||"function"!=typeof b.getDerivedStateFromError&&(null===x||"function"!=typeof x.componentDidCatch||null!==$l&&$l.has(x)))){o.flags|=65536,n&=-n,o.lanes|=n,Fa(o,hs(o,l,n));break e}}o=o.return}while(null!==o)}xc(t)}catch(e){n=e,Ml===t&&null!==t&&(Ml=t=t.return);continue}break}}function pc(){var e=Sl.current;return Sl.current=Zo,null===e?Zo:e}function hc(){0!==Dl&&3!==Dl&&2!==Dl||(Dl=4),null===El||!(268435455&Il)&&!(268435455&Al)||oc(El,Ll)}function vc(e,n){var t=Pl;Pl|=2;var i=pc();for(El===e&&Ll===n||(Vl=null,dc(e,n));;)try{fc();break}catch(n){mc(e,n)}if(Na(),Pl=t,Sl.current=i,null!==Ml)throw Error(a(261));return El=null,Ll=0,Dl}function fc(){for(;null!==Ml;)bc(Ml)}function gc(){for(;null!==Ml&&!Ge();)bc(Ml)}function bc(e){var n=wl(e.alternate,e,Ol);e.memoizedProps=e.pendingProps,null===n?xc(e):Ml=n,Cl.current=null}function xc(e){var n=e;do{var t=n.alternate;if(e=n.return,32768&n.flags){if(null!==(t=Ys(t,n)))return t.flags&=32767,void(Ml=t);if(null===e)return Dl=6,void(Ml=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}else if(null!==(t=qs(t,n,Ol)))return void(Ml=t);if(null!==(n=n.sibling))return void(Ml=n);Ml=n=e}while(null!==n);0===Dl&&(Dl=5)}function yc(e,n,t){var i=yn,r=Nl.transition;try{Nl.transition=null,yn=1,function(e,n,t,i){do{kc()}while(null!==Yl);if(6&Pl)throw Error(a(327));t=e.finishedWork;var r=e.finishedLanes;if(null===t)return null;if(e.finishedWork=null,e.finishedLanes=0,t===e.current)throw Error(a(177));e.callbackNode=null,e.callbackPriority=0;var o=t.lanes|t.childLanes;if(function(e,n){var t=e.pendingLanes&~n;e.pendingLanes=n,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=n,e.mutableReadLanes&=n,e.entangledLanes&=n,n=e.entanglements;var i=e.eventTimes;for(e=e.expirationTimes;0<t;){var r=31-sn(t),a=1<<r;n[r]=0,i[r]=-1,e[r]=-1,t&=~a}}(e,o),e===El&&(Ml=El=null,Ll=0),!(2064&t.subtreeFlags)&&!(2064&t.flags)||ql||(ql=!0,Ec(nn,function(){return kc(),null})),o=!!(15990&t.flags),!!(15990&t.subtreeFlags)||o){o=Nl.transition,Nl.transition=null;var s=yn;yn=1;var l=Pl;Pl|=4,Cl.current=null,function(e,n){if(er=$n,pi(e=mi())){if("selectionStart"in e)var t={start:e.selectionStart,end:e.selectionEnd};else e:{var i=(t=(t=e.ownerDocument)&&t.defaultView||window).getSelection&&t.getSelection();if(i&&0!==i.rangeCount){t=i.anchorNode;var r=i.anchorOffset,o=i.focusNode;i=i.focusOffset;try{t.nodeType,o.nodeType}catch(e){t=null;break e}var s=0,l=-1,c=-1,u=0,d=0,m=e,p=null;n:for(;;){for(var h;m!==t||0!==r&&3!==m.nodeType||(l=s+r),m!==o||0!==i&&3!==m.nodeType||(c=s+i),3===m.nodeType&&(s+=m.nodeValue.length),null!==(h=m.firstChild);)p=m,m=h;for(;;){if(m===e)break n;if(p===t&&++u===r&&(l=s),p===o&&++d===i&&(c=s),null!==(h=m.nextSibling))break;p=(m=p).parentNode}m=h}t=-1===l||-1===c?null:{start:l,end:c}}else t=null}t=t||{start:0,end:0}}else t=null;for(nr={focusedElem:e,selectionRange:t},$n=!1,Xs=n;null!==Xs;)if(e=(n=Xs).child,1028&n.subtreeFlags&&null!==e)e.return=n,Xs=e;else for(;null!==Xs;){n=Xs;try{var v=n.alternate;if(1024&n.flags)switch(n.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==v){var f=v.memoizedProps,g=v.memoizedState,b=n.stateNode,x=b.getSnapshotBeforeUpdate(n.elementType===n.type?f:ts(n.type,f),g);b.__reactInternalSnapshotBeforeUpdate=x}break;case 3:var y=n.stateNode.containerInfo;1===y.nodeType?y.textContent="":9===y.nodeType&&y.documentElement&&y.removeChild(y.documentElement);break;default:throw Error(a(163))}}catch(e){jc(n,n.return,e)}if(null!==(e=n.sibling)){e.return=n.return,Xs=e;break}Xs=n.return}v=el,el=!1}(e,t),vl(t,e),hi(nr),$n=!!er,nr=er=null,e.current=t,gl(t,e,r),Qe(),Pl=l,yn=s,Nl.transition=o}else e.current=t;if(ql&&(ql=!1,Yl=e,Kl=r),o=e.pendingLanes,0===o&&($l=null),function(e){if(on&&"function"==typeof on.onCommitFiberRoot)try{on.onCommitFiberRoot(an,e,void 0,!(128&~e.current.flags))}catch(e){}}(t.stateNode),tc(e,Xe()),null!==n)for(i=e.onRecoverableError,t=0;t<n.length;t++)r=n[t],i(r.value,{componentStack:r.stack,digest:r.digest});if(Wl)throw Wl=!1,e=Hl,Hl=null,e;!!(1&Kl)&&0!==e.tag&&kc(),o=e.pendingLanes,1&o?e===Ql?Gl++:(Gl=0,Ql=e):Gl=0,Vr()}(e,n,t,i)}finally{Nl.transition=r,yn=i}return null}function kc(){if(null!==Yl){var e=kn(Kl),n=Nl.transition,t=yn;try{if(Nl.transition=null,yn=16>e?16:e,null===Yl)var i=!1;else{if(e=Yl,Yl=null,Kl=0,6&Pl)throw Error(a(331));var r=Pl;for(Pl|=4,Xs=e.current;null!==Xs;){var o=Xs,s=o.child;if(16&Xs.flags){var l=o.deletions;if(null!==l){for(var c=0;c<l.length;c++){var u=l[c];for(Xs=u;null!==Xs;){var d=Xs;switch(d.tag){case 0:case 11:case 15:nl(8,d,o)}var m=d.child;if(null!==m)m.return=d,Xs=m;else for(;null!==Xs;){var p=(d=Xs).sibling,h=d.return;if(rl(d),d===u){Xs=null;break}if(null!==p){p.return=h,Xs=p;break}Xs=h}}}var v=o.alternate;if(null!==v){var f=v.child;if(null!==f){v.child=null;do{var g=f.sibling;f.sibling=null,f=g}while(null!==f)}}Xs=o}}if(2064&o.subtreeFlags&&null!==s)s.return=o,Xs=s;else e:for(;null!==Xs;){if(2048&(o=Xs).flags)switch(o.tag){case 0:case 11:case 15:nl(9,o,o.return)}var b=o.sibling;if(null!==b){b.return=o.return,Xs=b;break e}Xs=o.return}}var x=e.current;for(Xs=x;null!==Xs;){var y=(s=Xs).child;if(2064&s.subtreeFlags&&null!==y)y.return=s,Xs=y;else e:for(s=x;null!==Xs;){if(2048&(l=Xs).flags)try{switch(l.tag){case 0:case 11:case 15:tl(9,l)}}catch(e){jc(l,l.return,e)}if(l===s){Xs=null;break e}var k=l.sibling;if(null!==k){k.return=l.return,Xs=k;break e}Xs=l.return}}if(Pl=r,Vr(),on&&"function"==typeof on.onPostCommitFiberRoot)try{on.onPostCommitFiberRoot(an,e)}catch(e){}i=!0}return i}finally{yn=t,Nl.transition=n}}return!1}function wc(e,n,t){e=_a(e,n=ps(0,n=cs(t,n),1),1),n=Jl(),null!==e&&(bn(e,1,n),tc(e,n))}function jc(e,n,t){if(3===e.tag)wc(e,e,t);else for(;null!==n;){if(3===n.tag){wc(n,e,t);break}if(1===n.tag){var i=n.stateNode;if("function"==typeof n.type.getDerivedStateFromError||"function"==typeof i.componentDidCatch&&(null===$l||!$l.has(i))){n=_a(n,e=hs(n,e=cs(t,e),1),1),e=Jl(),null!==n&&(bn(n,1,e),tc(n,e));break}}n=n.return}}function Sc(e,n,t){var i=e.pingCache;null!==i&&i.delete(n),n=Jl(),e.pingedLanes|=e.suspendedLanes&t,El===e&&(Ll&t)===t&&(4===Dl||3===Dl&&(130023424&Ll)===Ll&&500>Xe()-Ul?dc(e,0):Rl|=t),tc(e,n)}function Cc(e,n){0===n&&(1&e.mode?(n=dn,!(130023424&(dn<<=1))&&(dn=4194304)):n=1);var t=Jl();null!==(e=za(e,n))&&(bn(e,n,t),tc(e,t))}function Nc(e){var n=e.memoizedState,t=0;null!==n&&(t=n.retryLane),Cc(e,t)}function Pc(e,n){var t=0;switch(e.tag){case 13:var i=e.stateNode,r=e.memoizedState;null!==r&&(t=r.retryLane);break;case 19:i=e.stateNode;break;default:throw Error(a(314))}null!==i&&i.delete(n),Cc(e,t)}function Ec(e,n){return Ye(e,n)}function Mc(e,n,t,i){this.tag=e,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=n,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Lc(e,n,t,i){return new Mc(e,n,t,i)}function Oc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Tc(e,n){var t=e.alternate;return null===t?((t=Lc(e.tag,n,e.key,e.mode)).elementType=e.elementType,t.type=e.type,t.stateNode=e.stateNode,t.alternate=e,e.alternate=t):(t.pendingProps=n,t.type=e.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=14680064&e.flags,t.childLanes=e.childLanes,t.lanes=e.lanes,t.child=e.child,t.memoizedProps=e.memoizedProps,t.memoizedState=e.memoizedState,t.updateQueue=e.updateQueue,n=e.dependencies,t.dependencies=null===n?null:{lanes:n.lanes,firstContext:n.firstContext},t.sibling=e.sibling,t.index=e.index,t.ref=e.ref,t}function Dc(e,n,t,i,r,o){var s=2;if(i=e,"function"==typeof e)Oc(e)&&(s=1);else if("string"==typeof e)s=5;else e:switch(e){case j:return zc(t.children,r,o,n);case S:s=8,r|=8;break;case C:return(e=Lc(12,t,n,2|r)).elementType=C,e.lanes=o,e;case M:return(e=Lc(13,t,n,r)).elementType=M,e.lanes=o,e;case L:return(e=Lc(19,t,n,r)).elementType=L,e.lanes=o,e;case D:return Ic(t,r,o,n);default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case N:s=10;break e;case P:s=9;break e;case E:s=11;break e;case O:s=14;break e;case T:s=16,i=null;break e}throw Error(a(130,null==e?e:typeof e,""))}return(n=Lc(s,t,n,r)).elementType=e,n.type=i,n.lanes=o,n}function zc(e,n,t,i){return(e=Lc(7,e,i,n)).lanes=t,e}function Ic(e,n,t,i){return(e=Lc(22,e,i,n)).elementType=D,e.lanes=t,e.stateNode={isHidden:!1},e}function Ac(e,n,t){return(e=Lc(6,e,null,n)).lanes=t,e}function Rc(e,n,t){return(n=Lc(4,null!==e.children?e.children:[],e.key,n)).lanes=t,n.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},n}function Bc(e,n,t,i,r){this.tag=n,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gn(0),this.expirationTimes=gn(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gn(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function _c(e,n,t,i,r,a,o,s,l){return e=new Bc(e,n,t,s,l),1===n?(n=1,!0===a&&(n|=8)):n=0,a=Lc(3,null,null,n),e.current=a,a.stateNode=e,a.memoizedState={element:i,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},Aa(a),e}function Uc(e){if(!e)return Pr;e:{if(Ve(e=e._reactInternals)!==e||1!==e.tag)throw Error(a(170));var n=e;do{switch(n.tag){case 3:n=n.stateNode.context;break e;case 1:if(Tr(n.type)){n=n.stateNode.__reactInternalMemoizedMergedChildContext;break e}}n=n.return}while(null!==n);throw Error(a(171))}if(1===e.tag){var t=e.type;if(Tr(t))return Ir(e,t,n)}return n}function Fc(e,n,t,i,r,a,o,s,l){return(e=_c(t,i,!0,e,0,a,0,s,l)).context=Uc(null),t=e.current,(a=Ba(i=Jl(),r=ec(t))).callback=null!=n?n:null,_a(t,a,r),e.current.lanes=r,bn(e,r,i),tc(e,i),e}function Vc(e,n,t,i){var r=n.current,a=Jl(),o=ec(r);return t=Uc(t),null===n.context?n.context=t:n.pendingContext=t,(n=Ba(a,o)).payload={element:e},null!==(i=void 0===i?null:i)&&(n.callback=i),null!==(e=_a(r,n,o))&&(nc(e,r,o,a),Ua(e,r,o)),o}function Wc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Hc(e,n){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var t=e.retryLane;e.retryLane=0!==t&&t<n?t:n}}function $c(e,n){Hc(e,n),(e=e.alternate)&&Hc(e,n)}wl=function(e,n,t){if(null!==e)if(e.memoizedProps!==n.pendingProps||Mr.current)xs=!0;else{if(0===(e.lanes&t)&&!(128&n.flags))return xs=!1,function(e,n,t){switch(n.tag){case 3:Ms(n),pa();break;case 5:Xa(n);break;case 1:Tr(n.type)&&Ar(n);break;case 4:Ga(n,n.stateNode.containerInfo);break;case 10:var i=n.type._context,r=n.memoizedProps.value;Nr(wa,i._currentValue),i._currentValue=r;break;case 13:if(null!==(i=n.memoizedState))return null!==i.dehydrated?(Nr(Ja,1&Ja.current),n.flags|=128,null):0!==(t&n.child.childLanes)?As(e,n,t):(Nr(Ja,1&Ja.current),null!==(e=Ws(e,n,t))?e.sibling:null);Nr(Ja,1&Ja.current);break;case 19:if(i=0!==(t&n.childLanes),128&e.flags){if(i)return Fs(e,n,t);n.flags|=128}if(null!==(r=n.memoizedState)&&(r.rendering=null,r.tail=null,r.lastEffect=null),Nr(Ja,Ja.current),i)break;return null;case 22:case 23:return n.lanes=0,Ss(e,n,t)}return Ws(e,n,t)}(e,n,t);xs=!!(131072&e.flags)}else xs=!1,ra&&1048576&n.flags&&Jr(n,qr,n.index);switch(n.lanes=0,n.tag){case 2:var i=n.type;Vs(e,n),e=n.pendingProps;var r=Or(n,Er.current);Ma(n,t),r=fo(null,n,i,e,r,t);var o=go();return n.flags|=1,"object"==typeof r&&null!==r&&"function"==typeof r.render&&void 0===r.$$typeof?(n.tag=1,n.memoizedState=null,n.updateQueue=null,Tr(i)?(o=!0,Ar(n)):o=!1,n.memoizedState=null!==r.state&&void 0!==r.state?r.state:null,Aa(n),r.updater=rs,n.stateNode=r,r._reactInternals=n,ls(n,i,e,t),n=Es(null,n,i,!0,o,t)):(n.tag=0,ra&&o&&ea(n),ys(null,n,r,t),n=n.child),n;case 16:i=n.elementType;e:{switch(Vs(e,n),e=n.pendingProps,i=(r=i._init)(i._payload),n.type=i,r=n.tag=function(e){if("function"==typeof e)return Oc(e)?1:0;if(null!=e){if((e=e.$$typeof)===E)return 11;if(e===O)return 14}return 2}(i),e=ts(i,e),r){case 0:n=Ns(null,n,i,e,t);break e;case 1:n=Ps(null,n,i,e,t);break e;case 11:n=ks(null,n,i,e,t);break e;case 14:n=ws(null,n,i,ts(i.type,e),t);break e}throw Error(a(306,i,""))}return n;case 0:return i=n.type,r=n.pendingProps,Ns(e,n,i,r=n.elementType===i?r:ts(i,r),t);case 1:return i=n.type,r=n.pendingProps,Ps(e,n,i,r=n.elementType===i?r:ts(i,r),t);case 3:e:{if(Ms(n),null===e)throw Error(a(387));i=n.pendingProps,r=(o=n.memoizedState).element,Ra(e,n),Va(n,i,null,t);var s=n.memoizedState;if(i=s.element,o.isDehydrated){if(o={element:i,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},n.updateQueue.baseState=o,n.memoizedState=o,256&n.flags){n=Ls(e,n,i,t,r=cs(Error(a(423)),n));break e}if(i!==r){n=Ls(e,n,i,t,r=cs(Error(a(424)),n));break e}for(ia=cr(n.stateNode.containerInfo.firstChild),ta=n,ra=!0,aa=null,t=ka(n,null,i,t),n.child=t;t;)t.flags=-3&t.flags|4096,t=t.sibling}else{if(pa(),i===r){n=Ws(e,n,t);break e}ys(e,n,i,t)}n=n.child}return n;case 5:return Xa(n),null===e&&ca(n),i=n.type,r=n.pendingProps,o=null!==e?e.memoizedProps:null,s=r.children,tr(i,r)?s=null:null!==o&&tr(i,o)&&(n.flags|=32),Cs(e,n),ys(e,n,s,t),n.child;case 6:return null===e&&ca(n),null;case 13:return As(e,n,t);case 4:return Ga(n,n.stateNode.containerInfo),i=n.pendingProps,null===e?n.child=ya(n,null,i,t):ys(e,n,i,t),n.child;case 11:return i=n.type,r=n.pendingProps,ks(e,n,i,r=n.elementType===i?r:ts(i,r),t);case 7:return ys(e,n,n.pendingProps,t),n.child;case 8:case 12:return ys(e,n,n.pendingProps.children,t),n.child;case 10:e:{if(i=n.type._context,r=n.pendingProps,o=n.memoizedProps,s=r.value,Nr(wa,i._currentValue),i._currentValue=s,null!==o)if(si(o.value,s)){if(o.children===r.children&&!Mr.current){n=Ws(e,n,t);break e}}else for(null!==(o=n.child)&&(o.return=n);null!==o;){var l=o.dependencies;if(null!==l){s=o.child;for(var c=l.firstContext;null!==c;){if(c.context===i){if(1===o.tag){(c=Ba(-1,t&-t)).tag=2;var u=o.updateQueue;if(null!==u){var d=(u=u.shared).pending;null===d?c.next=c:(c.next=d.next,d.next=c),u.pending=c}}o.lanes|=t,null!==(c=o.alternate)&&(c.lanes|=t),Ea(o.return,t,n),l.lanes|=t;break}c=c.next}}else if(10===o.tag)s=o.type===n.type?null:o.child;else if(18===o.tag){if(null===(s=o.return))throw Error(a(341));s.lanes|=t,null!==(l=s.alternate)&&(l.lanes|=t),Ea(s,t,n),s=o.sibling}else s=o.child;if(null!==s)s.return=o;else for(s=o;null!==s;){if(s===n){s=null;break}if(null!==(o=s.sibling)){o.return=s.return,s=o;break}s=s.return}o=s}ys(e,n,r.children,t),n=n.child}return n;case 9:return r=n.type,i=n.pendingProps.children,Ma(n,t),i=i(r=La(r)),n.flags|=1,ys(e,n,i,t),n.child;case 14:return r=ts(i=n.type,n.pendingProps),ws(e,n,i,r=ts(i.type,r),t);case 15:return js(e,n,n.type,n.pendingProps,t);case 17:return i=n.type,r=n.pendingProps,r=n.elementType===i?r:ts(i,r),Vs(e,n),n.tag=1,Tr(i)?(e=!0,Ar(n)):e=!1,Ma(n,t),os(n,i,r),ls(n,i,r,t),Es(null,n,i,!0,e,t);case 19:return Fs(e,n,t);case 22:return Ss(e,n,t)}throw Error(a(156,n.tag))};var qc="function"==typeof reportError?reportError:function(e){console.error(e)};function Yc(e){this._internalRoot=e}function Kc(e){this._internalRoot=e}function Gc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Qc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Xc(){}function Zc(e,n,t,i,r){var a=t._reactRootContainer;if(a){var o=a;if("function"==typeof r){var s=r;r=function(){var e=Wc(o);s.call(e)}}Vc(n,o,e,r)}else o=function(e,n,t,i,r){if(r){if("function"==typeof i){var a=i;i=function(){var e=Wc(o);a.call(e)}}var o=Fc(n,i,e,0,null,!1,0,"",Xc);return e._reactRootContainer=o,e[hr]=o.current,Vi(8===e.nodeType?e.parentNode:e),cc(),o}for(;r=e.lastChild;)e.removeChild(r);if("function"==typeof i){var s=i;i=function(){var e=Wc(l);s.call(e)}}var l=_c(e,0,!1,null,0,!1,0,"",Xc);return e._reactRootContainer=l,e[hr]=l.current,Vi(8===e.nodeType?e.parentNode:e),cc(function(){Vc(n,l,t,i)}),l}(t,n,e,r,i);return Wc(o)}Kc.prototype.render=Yc.prototype.render=function(e){var n=this._internalRoot;if(null===n)throw Error(a(409));Vc(e,n,null,null)},Kc.prototype.unmount=Yc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var n=e.containerInfo;cc(function(){Vc(null,e,null,null)}),n[hr]=null}},Kc.prototype.unstable_scheduleHydration=function(e){if(e){var n=Cn();e={blockedOn:null,target:e,priority:n};for(var t=0;t<zn.length&&0!==n&&n<zn[t].priority;t++);zn.splice(t,0,e),0===t&&Bn(e)}},wn=function(e){switch(e.tag){case 3:var n=e.stateNode;if(n.current.memoizedState.isDehydrated){var t=mn(n.pendingLanes);0!==t&&(xn(n,1|t),tc(n,Xe()),!(6&Pl)&&(Fl=Xe()+500,Vr()))}break;case 13:cc(function(){var n=za(e,1);if(null!==n){var t=Jl();nc(n,e,1,t)}}),$c(e,1)}},jn=function(e){if(13===e.tag){var n=za(e,134217728);if(null!==n)nc(n,e,134217728,Jl());$c(e,134217728)}},Sn=function(e){if(13===e.tag){var n=ec(e),t=za(e,n);if(null!==t)nc(t,e,n,Jl());$c(e,n)}},Cn=function(){return yn},Nn=function(e,n){var t=yn;try{return yn=e,n()}finally{yn=t}},we=function(e,n,t){switch(n){case"input":if(Z(e,t),n=t.name,"radio"===t.type&&null!=n){for(t=e;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+n)+'][type="radio"]'),n=0;n<t.length;n++){var i=t[n];if(i!==e&&i.form===e.form){var r=kr(i);if(!r)throw Error(a(90));Y(i),Z(i,r)}}}break;case"textarea":ae(e,t);break;case"select":null!=(n=t.value)&&te(e,!!t.multiple,n,!1)}},Ee=lc,Me=cc;var Jc={usingClientEntryPoint:!1,Events:[xr,yr,kr,Ne,Pe,lc]},eu={findFiberByHostInstance:br,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},nu={bundleType:eu.bundleType,version:eu.version,rendererPackageName:eu.rendererPackageName,rendererConfig:eu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:y.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=$e(e))?null:e.stateNode},findFiberByHostInstance:eu.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var tu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!tu.isDisabled&&tu.supportsFiber)try{an=tu.inject(nu),on=tu}catch(ue){}}n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Jc,n.createPortal=function(e,n){var t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Gc(n))throw Error(a(200));return function(e,n,t){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:w,key:null==i?null:""+i,children:e,containerInfo:n,implementation:t}}(e,n,null,t)},n.createRoot=function(e,n){if(!Gc(e))throw Error(a(299));var t=!1,i="",r=qc;return null!=n&&(!0===n.unstable_strictMode&&(t=!0),void 0!==n.identifierPrefix&&(i=n.identifierPrefix),void 0!==n.onRecoverableError&&(r=n.onRecoverableError)),n=_c(e,1,!1,null,0,t,0,i,r),e[hr]=n.current,Vi(8===e.nodeType?e.parentNode:e),new Yc(n)},n.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var n=e._reactInternals;if(void 0===n){if("function"==typeof e.render)throw Error(a(188));throw e=Object.keys(e).join(","),Error(a(268,e))}return e=null===(e=$e(n))?null:e.stateNode},n.flushSync=function(e){return cc(e)},n.hydrate=function(e,n,t){if(!Qc(n))throw Error(a(200));return Zc(null,e,n,!0,t)},n.hydrateRoot=function(e,n,t){if(!Gc(e))throw Error(a(405));var i=null!=t&&t.hydratedSources||null,r=!1,o="",s=qc;if(null!=t&&(!0===t.unstable_strictMode&&(r=!0),void 0!==t.identifierPrefix&&(o=t.identifierPrefix),void 0!==t.onRecoverableError&&(s=t.onRecoverableError)),n=Fc(n,null,e,1,null!=t?t:null,r,0,o,s),e[hr]=n.current,Vi(e),i)for(e=0;e<i.length;e++)r=(r=(t=i[e])._getVersion)(t._source),null==n.mutableSourceEagerHydrationData?n.mutableSourceEagerHydrationData=[t,r]:n.mutableSourceEagerHydrationData.push(t,r);return new Kc(n)},n.render=function(e,n,t){if(!Qc(n))throw Error(a(200));return Zc(null,e,n,!1,t)},n.unmountComponentAtNode=function(e){if(!Qc(e))throw Error(a(40));return!!e._reactRootContainer&&(cc(function(){Zc(null,null,e,!1,function(){e._reactRootContainer=null,e[hr]=null})}),!0)},n.unstable_batchedUpdates=lc,n.unstable_renderSubtreeIntoContainer=function(e,n,t,i){if(!Qc(t))throw Error(a(200));if(null==e||void 0===e._reactInternals)throw Error(a(38));return Zc(e,n,t,!1,i)},n.version="18.3.1-next-f1338f8080-20240426"},601(e){e.exports=function(e){return e[1]}},659(e){var n={};e.exports=function(e,t){var i=function(e){if(void 0===n[e]){var t=document.querySelector(e);if(window.HTMLIFrameElement&&t instanceof window.HTMLIFrameElement)try{t=t.contentDocument.head}catch(e){t=null}n[e]=t}return n[e]}(e);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(t)}},674(e,n,t){t.d(n,{DZ:()=>w,HT:()=>h,JN:()=>S,Ll:()=>f,M5:()=>k,Wx:()=>N,X7:()=>j,ho:()=>v,mt:()=>p,pW:()=>s,sI:()=>C,zA:()=>c});var i=t(92);function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,i)}return t}function a(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach(function(n){o(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function o(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,n||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const s="lumia-injector",l="lumia_injector_settings",c="loom_summary",u=0;let d=a({},{schemaVersion:2,packs:{},selectedDefinition:null,selectedBehaviors:[],selectedPersonalities:[],dominantBehavior:null,dominantPersonality:null,selectedLoomStyle:[],selectedLoomUtils:[],selectedLoomRetrofits:[],presets:{},activePresetName:null,chimeraMode:!1,selectedDefinitions:[],councilMode:!1,councilMembers:[],lumiaOOCInterval:null,lumiaOOCStyle:"social",sovereignHand:{enabled:!1,excludeLastMessage:!0,includeMessageInPrompt:!0},contextFilters:{htmlTags:{enabled:!1,stripFonts:!1,fontKeepDepth:3},detailsBlocks:{enabled:!1,keepDepth:3},loomItems:{enabled:!1,keepDepth:5}},messageTruncation:{enabled:!1,keepCount:50},summarization:{mode:"disabled",apiSource:"main",autoInterval:10,autoMessageContext:10,manualMessageContext:10,secondary:{provider:"openai",model:"",endpoint:"",apiKey:"",temperature:.7,topP:1,maxTokens:8192}},lumiaConfigVersion:1,lastLumiaChangeTimestamp:null,disableAnthropicCache:!1,lumiaButtonPosition:{useDefault:!0,xPercent:1,yPercent:1}}),m=null;function p(){return d}function h(){return m}function v(e){m=e}function f(){m=null}function g(e){return{lumiaName:e.lumiaDefName,lumiaDefinition:e.lumiaDef||null,lumiaPersonality:e.lumia_personality||null,lumiaBehavior:e.lumia_behavior||null,avatarUrl:e.lumia_img||null,genderIdentity:u,authorName:e.defAuthor||null,version:1}}function b(e){return{loomName:e.loomName,loomContent:e.loomContent,loomCategory:e.loomCategory,authorName:null,version:1}}function x(e){const n=[],t=[];for(const i of e.items||[])i.lumiaDefName?n.push(g(i)):i.loomCategory&&t.push(b(i));return{packName:e.name||e.packName,packAuthor:e.author||e.packAuthor||null,coverUrl:e.coverUrl||null,version:1,packExtras:e.packExtras||[],lumiaItems:n,loomItems:t,isCustom:e.isCustom||!1,url:e.url||""}}function y(){let e=!1;if((d.lumiaLibrary||d.worldBookData)&&0===Object.keys(d.packs).length){console.log("Lumia Injector: Migrating legacy settings...");let n=d.lumiaLibrary||[];if(0===n.length&&d.worldBookData&&console.warn("Legacy worldBookData found but cannot be migrated automatically. Please re-import your world book."),n.length>0){const t="Default (Legacy)";d.packs[t]={name:t,items:n,url:d.worldBookUrl||"Legacy"};const i=e=>{var t;return null===(t=n[e])||void 0===t?void 0:t.lumiaDefName};if("number"==typeof d.selectedDefinition){const e=i(d.selectedDefinition);d.selectedDefinition=e?{packName:t,itemName:e}:null}Array.isArray(d.selectedBehaviors)&&d.selectedBehaviors.length>0&&"number"==typeof d.selectedBehaviors[0]?d.selectedBehaviors=d.selectedBehaviors.map(e=>{const n=i(e);return n?{packName:t,itemName:n}:null}).filter(e=>e):d.selectedBehaviors=[],Array.isArray(d.selectedPersonalities)&&d.selectedPersonalities.length>0&&"number"==typeof d.selectedPersonalities[0]?d.selectedPersonalities=d.selectedPersonalities.map(e=>{const n=i(e);return n?{packName:t,itemName:n}:null}).filter(e=>e):d.selectedPersonalities=[],delete d.lumiaLibrary,delete d.worldBookData,delete d.worldBookUrl,e=!0}}(function(){let e=!1;const n=d.schemaVersion||1;if(n>=2)return!1;console.log("[".concat(s,"] Migrating packs from schema v").concat(n," to v").concat(2,"..."));for(const n in d.packs){const t=d.packs[n];!t.items||t.lumiaItems||t.loomItems||(console.log("[".concat(s,"] Migrating pack: ").concat(n)),d.packs[n]=x(t),e=!0)}return d.schemaVersion=2,e&&console.log("[".concat(s,"] Pack migration complete")),e})()&&(e=!0);for(const n in d.packs){const t=d.packs[n];t.url?!0===t.isCustom&&(console.log("[".concat(s,"] Fixing isCustom flag for URL pack: ").concat(n)),t.isCustom=!1,e=!0):!0!==t.isCustom&&(console.log("[".concat(s,"] Fixing isCustom flag for local pack: ").concat(n)),t.isCustom=!0,e=!0)}return d.schemaVersion||(d.schemaVersion=2),d.packs||(d.packs={}),d.selectedBehaviors||(d.selectedBehaviors=[]),d.selectedPersonalities||(d.selectedPersonalities=[]),void 0===d.dominantBehavior&&(d.dominantBehavior=null),void 0===d.dominantPersonality&&(d.dominantPersonality=null),d.selectedLoomUtils||(d.selectedLoomUtils=[]),d.selectedLoomRetrofits||(d.selectedLoomRetrofits=[]),void 0===d.lumiaOOCInterval&&(d.lumiaOOCInterval=null),d.lumiaOOCStyle||(d.lumiaOOCStyle="social"),d.sovereignHand||(d.sovereignHand={enabled:!1,excludeLastMessage:!0,includeMessageInPrompt:!0}),void 0===d.sovereignHand.excludeLastMessage&&(d.sovereignHand.excludeLastMessage=!0),void 0===d.sovereignHand.includeMessageInPrompt&&(d.sovereignHand.includeMessageInPrompt=!0),d.contextFilters||(d.contextFilters={htmlTags:{enabled:!1,stripFonts:!1,fontKeepDepth:3},detailsBlocks:{enabled:!1,keepDepth:3},loomItems:{enabled:!1,keepDepth:5}}),d.contextFilters.htmlTags||(d.contextFilters.htmlTags={enabled:!1,stripFonts:!1,fontKeepDepth:3}),void 0===d.contextFilters.htmlTags.stripFonts&&(d.contextFilters.htmlTags.stripFonts=!1),void 0===d.contextFilters.htmlTags.fontKeepDepth&&(d.contextFilters.htmlTags.fontKeepDepth=3),d.contextFilters.detailsBlocks||(d.contextFilters.detailsBlocks={enabled:!1,keepDepth:3}),void 0===d.contextFilters.detailsBlocks.keepDepth&&(d.contextFilters.detailsBlocks.keepDepth=3),d.contextFilters.loomItems||(d.contextFilters.loomItems={enabled:!1,keepDepth:5}),void 0===d.contextFilters.loomItems.keepDepth&&(d.contextFilters.loomItems.keepDepth=5),d.messageTruncation||(d.messageTruncation={enabled:!1,keepCount:50}),void 0===d.messageTruncation.keepCount&&(d.messageTruncation.keepCount=50),d.summarization||(d.summarization={mode:"disabled",apiSource:"main",autoInterval:10,autoMessageContext:10,manualMessageContext:10,secondary:{provider:"openai",model:"",endpoint:"",apiKey:"",temperature:.7,topP:1,maxTokens:8192}}),void 0!==d.summarization.messageContext&&(d.summarization.autoMessageContext=d.summarization.messageContext,d.summarization.manualMessageContext=d.summarization.messageContext,delete d.summarization.messageContext,e=!0),void 0===d.summarization.autoMessageContext&&(d.summarization.autoMessageContext=10),void 0===d.summarization.manualMessageContext&&(d.summarization.manualMessageContext=10),d.summarization.secondary||(d.summarization.secondary={provider:"openai",model:"",endpoint:"",apiKey:"",temperature:.7,topP:1,maxTokens:8192}),void 0===d.summarization.secondary.topP&&(d.summarization.secondary.topP=1),(!d.summarization.secondary.maxTokens||d.summarization.secondary.maxTokens<256)&&(d.summarization.secondary.maxTokens=8192),d.presets||(d.presets={}),void 0===d.activePresetName&&(d.activePresetName=null),void 0===d.chimeraMode&&(d.chimeraMode=!1),d.selectedDefinitions||(d.selectedDefinitions=[]),void 0===d.councilMode&&(d.councilMode=!1),d.councilMembers||(d.councilMembers=[]),e}function k(){const e=(0,i.fJ)();e[l]?(d=a(a({},d),e[l]),y()&&w()):e[l]=d}function w(){const e=(0,i.fJ)(),n=(0,i.kL)();e[l]=d,n()}function j(){return d.lumiaConfigVersion||1}function S(){d.lumiaConfigVersion=(d.lumiaConfigVersion||0)+1,d.lastLumiaChangeTimestamp=Date.now(),w(),console.log("[".concat(s,"] Lumia config version bumped to ").concat(d.lumiaConfigVersion))}function C(){return d.lumiaConfigVersion=(d.lumiaConfigVersion||0)+1,d.lastLumiaChangeTimestamp=Date.now(),d.disableAnthropicCache=!0,w(),console.log("[".concat(s,"] Claude cache cleared - version now ").concat(d.lumiaConfigVersion)),setTimeout(()=>{d.disableAnthropicCache=!1,w()},5e3),d.lumiaConfigVersion}function N(){const e=(0,i.fJ)(),n=(0,i.kL)();console.log("[".concat(s,"] NUCLEAR RESET: Wiping all extension settings...")),delete e[l],n(),console.log("[".concat(s,"] Settings wiped. Page will reload...")),setTimeout(()=>{window.location.reload()},500)}},796(e){e.exports="data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%2712%27 height=%2712%27 viewBox=%270 0 24 24%27 fill=%27none%27 stroke=%27rgba%28255,255,255,0.5%29%27 stroke-width=%272%27 stroke-linecap=%27round%27 stroke-linejoin=%27round%27%3E%3Cpolyline points=%276 9 12 15 18 9%27%3E%3C/polyline%3E%3C/svg%3E"},825(e){e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var n=e.insertStyleElement(e);return{update:function(t){!function(e,n,t){var i="";t.supports&&(i+="@supports (".concat(t.supports,") {")),t.media&&(i+="@media ".concat(t.media," {"));var r=void 0!==t.layer;r&&(i+="@layer".concat(t.layer.length>0?" ".concat(t.layer):""," {")),i+=t.css,r&&(i+="}"),t.media&&(i+="}"),t.supports&&(i+="}");var a=t.sourceMap;a&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),n.styleTagTransform(i,e,n.options)}(n,e,t)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(n)}}}},848(e,n,t){e.exports=t(20)},932(e,n,t){t.d(n,{Cm:()=>S,Dz:()=>N,GM:()=>w,YR:()=>P,Zl:()=>u,e2:()=>C,mR:()=>j,ry:()=>k,updateLoomSummaryButtonState:()=>E,xx:()=>m});var i=t(92),r=t(674),a=t(154),o=t(485),s=t(199),l=t(200);let c=null;function u(e){c=e}let d=null;function m(e){d=e}function p(){d&&d()}const h='<svg viewBox="0 0 24 24"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>',v='<svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"></polyline></svg>',f='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>',g='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>',b='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>',x='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>';function y(e){const n=e[0];if(!n)return;const t=window.innerHeight||document.documentElement.clientHeight,i=(window.innerWidth||document.documentElement.clientWidth)<=600?24:48,r=t-i;n.style.maxHeight="".concat(r,"px");const a=e.find(".lumia-modal-header"),o=e.find(".lumia-modal-footer"),s=e.find(".lumia-modal-content");requestAnimationFrame(()=>{const e=a.length?a[0].offsetHeight:0,n=o.length?o[0].offsetHeight:0,t=r-e-n;s.length&&(s[0].style.maxHeight="".concat(t,"px"),s[0].style.overflowY="auto")});const l=()=>{const e=(window.innerHeight||document.documentElement.clientHeight)-i;n.style.maxHeight="".concat(e,"px");const t=e-(a.length?a[0].offsetHeight:0)-(o.length?o[0].offsetHeight:0);s.length&&(s[0].style.maxHeight="".concat(t,"px"))};window.addEventListener("resize",l),n._resizeCleanup=()=>window.removeEventListener("resize",l)}function k(e){const n=(0,r.mt)(),t=Object.values(n.packs);let i="",o="",l=!1,c=null,u="";"definition"===e?(i="Select Definition",o="Choose the physical form for your Lumia",l=!1,u='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>\n            <circle cx="12" cy="7" r="4"></circle>\n        </svg>'):"behavior"===e?(i="Select Behaviors",o="Choose behavioral traits (tap star for dominant)",l=!0,c="dominantBehavior",u='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n            <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path>\n        </svg>'):"personality"===e&&(i="Select Personalities",o="Choose personality traits (tap star for dominant)",l=!0,c="dominantPersonality",u='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n            <path d="M12 2a10 10 0 1 0 10 10H12V2z"></path>\n            <path d="M12 2a10 10 0 0 1 10 10"></path>\n            <circle cx="12" cy="12" r="6"></circle>\n        </svg>'),$("#lumia-selection-modal").remove();let d="";0===t.length?d='<div class="lumia-modal-empty">No Lumia Packs loaded. Add one in settings!</div>':t.forEach(t=>{const i=t.items;if(!i||0===i.length)return;const r=i.filter(e=>e.lumiaDefName);if(0===r.length)return;const o=(0,s.iY)(t.name),u=r.map(i=>{const r=i.lumiaDefName,s=(0,a.ZD)(t.name),u=(0,a.ZD)(r),d=i.lumia_img;let m=!1;if(l){m=("behavior"===e?n.selectedBehaviors:n.selectedPersonalities).some(e=>e.packName===t.name&&e.itemName===r)}else{const e=n.selectedDefinition;m=e&&e.packName===t.name&&e.itemName===r}let p=!1;c&&n[c]&&(p=n[c].packName===t.name&&n[c].itemName===r);const f=null!==c;return'\n                <div class="lumia-card lumia-card-appear '.concat("definition"===e?"definition-card":""," ").concat(m?"selected":"",'"\n                     data-pack="').concat(s,'"\n                     data-item="').concat(u,'">\n                    <div class="lumia-card-image">\n                        ').concat(d?'<img src="'.concat(d,'" alt="').concat(u,'" loading="lazy"><div class="lumia-img-spinner"></div>'):'<div class="lumia-card-placeholder">?</div>',"\n                        ").concat(f?'\n                        <div class="lumia-dominant-icon '.concat(p?"dominant":"",'"\n                             data-pack="').concat(s,'"\n                             data-item="').concat(u,'"\n                             title="').concat(p?"Remove as dominant":"Set as dominant trait",'">\n                            ').concat(h,"\n                        </div>\n                        "):"",'\n                        <div class="lumia-card-check">\n                            ').concat(v,"\n                        </div>\n                        ").concat(o?'\n                        <button class="lumia-card-edit-btn"\n                                data-pack="'.concat(s,'"\n                                data-item="').concat(u,'"\n                                title="Edit Lumia">\n                            ').concat(x,"\n                        </button>\n                        "):"",'\n                    </div>\n                    <div class="lumia-card-info">\n                        <div class="lumia-card-name">').concat(r||"Unknown","</div>\n                    </div>\n                </div>\n                ")}).join("");d+='\n            <div class="lumia-modal-panel lumia-collapsible lumia-pack-section">\n                <div class="lumia-modal-panel-header lumia-collapsible-trigger">\n                    <span class="lumia-panel-collapse-icon">\n                        '.concat(b,'\n                    </span>\n                    <span class="lumia-modal-panel-icon">\n                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                            <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>\n                        </svg>\n                    </span>\n                    <span class="lumia-modal-panel-title">').concat((0,a.ZD)(t.name),"</span>\n                    ").concat(o?'<span class="lumia-pack-badge-custom">Custom</span>':"",'\n                    <span class="lumia-modal-panel-count">').concat(r.length," items</span>\n                    ").concat(o?'<button class="lumia-pack-edit-btn" data-pack="'.concat((0,a.ZD)(t.name),'" title="Edit Pack">').concat(x,"</button>"):"",'\n                    <button class="lumia-icon-btn-sm lumia-remove-pack-btn" data-pack="').concat((0,a.ZD)(t.name),'" title="Remove Pack">\n                        ').concat(f,'\n                    </button>\n                </div>\n                <div class="lumia-modal-panel-content lumia-modal-panel-content-cards lumia-collapsible-content">\n                    <div class="lumia-card-grid">\n                        ').concat(u,"\n                    </div>\n                </div>\n            </div>\n            ")});const m='\n        <dialog id="lumia-selection-modal" class="popup popup--animation-fast lumia-modal lumia-modal-selection">\n            <div class="lumia-modal-header">\n                <div class="lumia-modal-header-icon">\n                    '.concat(u,'\n                </div>\n                <div class="lumia-modal-header-text">\n                    <h3 class="lumia-modal-title">').concat(i,'</h3>\n                    <p class="lumia-modal-subtitle">').concat(o,'</p>\n                </div>\n                <button class="lumia-clear-btn" title="Clear all selections">\n                    ').concat(g,'\n                    <span>Clear</span>\n                </button>\n            </div>\n            <div class="lumia-modal-content">\n                ').concat(d,'\n            </div>\n            <div class="lumia-modal-footer">\n                <button class="lumia-modal-btn lumia-modal-btn-secondary lumia-modal-close-btn">Close</button>\n                ').concat(l?'<button class="lumia-modal-btn lumia-modal-btn-primary lumia-modal-done">Done</button>':"","\n            </div>\n        </dialog>\n    ");$("body").append(m);const k=$("#lumia-selection-modal");y(k);const w=()=>{k[0]._resizeCleanup&&k[0]._resizeCleanup(),k[0].close(),k.remove(),p()};k.on("click mousedown mouseup",function(e){e.stopPropagation(),"click"===e.type&&e.target===this&&w()}),k.find(".lumia-modal-close-btn, .lumia-modal-done").click(w),k.on("keydown",function(e){"Escape"===e.key&&w()}),k.find(".lumia-collapsible-trigger").click(function(e){$(e.target).closest(".lumia-remove-pack-btn").length>0||$(this).closest(".lumia-collapsible").toggleClass("collapsed")}),k.find(".lumia-clear-btn").click(function(t){t.stopPropagation(),"definition"===e?n.selectedDefinition=null:"behavior"===e?(n.selectedBehaviors=[],n.dominantBehavior=null):"personality"===e&&(n.selectedPersonalities=[],n.dominantPersonality=null),(0,r.DZ)(),k.find(".lumia-card").removeClass("selected"),k.find(".lumia-dominant-icon").removeClass("dominant"),toastr.info("".concat(i.replace("Select ","")," cleared"))}),k.find(".lumia-remove-pack-btn").click(function(e){e.stopPropagation();const t=$(this).data("pack");confirm('Are you sure you want to remove the pack "'.concat(t,'"?'))&&(delete n.packs[t],n.selectedDefinition&&n.selectedDefinition.packName===t&&(n.selectedDefinition=null),n.selectedBehaviors=n.selectedBehaviors.filter(e=>e.packName!==t),n.selectedPersonalities=n.selectedPersonalities.filter(e=>e.packName!==t),n.dominantBehavior&&n.dominantBehavior.packName===t&&(n.dominantBehavior=null),n.dominantPersonality&&n.dominantPersonality.packName===t&&(n.dominantPersonality=null),(0,r.DZ)(),$(this).closest(".lumia-modal-panel").remove(),0===Object.keys(n.packs).length&&w())}),k.find(".lumia-pack-edit-btn").click(function(e){e.stopPropagation();const n=$(this).data("pack");w(),(0,s.H3)(n)}),k.find(".lumia-card-edit-btn").click(function(e){e.stopPropagation();const n=$(this).data("pack"),t=$(this).data("item"),i=(0,a.Br)(n,t);i&&(w(),(0,s.un)(i,n))}),c&&k.find(".lumia-dominant-icon").click(function(t){t.stopPropagation();const i=$(this).data("pack"),a=$(this).data("item"),o=$(this),s="behavior"===e?n.selectedBehaviors:n.selectedPersonalities;s.some(e=>e.packName===i&&e.itemName===a)||(s.push({packName:i,itemName:a}),"behavior"===e?n.selectedBehaviors=s:n.selectedPersonalities=s,o.closest(".lumia-card").addClass("selected"));const l=n[c];l&&l.packName===i&&l.itemName===a?(n[c]=null,o.removeClass("dominant")):(k.find(".lumia-dominant-icon").removeClass("dominant"),n[c]={packName:i,itemName:a},o.addClass("dominant")),(0,r.DZ)()}),k.find(".lumia-card").click(function(t){if($(t.target).closest(".lumia-dominant-icon").length>0||$(t.target).closest(".lumia-card-edit-btn").length>0)return;const i=$(this).data("pack"),a=$(this).data("item");if(l){const t=$(this);let o="behavior"===e?n.selectedBehaviors:n.selectedPersonalities;const s=o.findIndex(e=>e.packName===i&&e.itemName===a);-1!==s?(o.splice(s,1),t.removeClass("selected"),c&&n[c]&&n[c].packName===i&&n[c].itemName===a&&(n[c]=null,t.find(".lumia-dominant-icon").removeClass("dominant"))):(o.push({packName:i,itemName:a}),t.addClass("selected")),"behavior"===e?n.selectedBehaviors=o:n.selectedPersonalities=o,(0,r.DZ)()}else k.find(".lumia-card").removeClass("selected"),$(this).addClass("selected"),n.selectedDefinition={packName:i,itemName:a},(0,r.DZ)()}),k.find(".lumia-card-image img").each(function(){const e=$(this);this.complete&&0!==this.naturalHeight?e.addClass("lumia-img-loaded"):(e.on("load",function(){e.addClass("lumia-img-loaded")}),e.on("error",function(){e.addClass("lumia-img-loaded"),e.css("display","none"),e.parent().append('<div class="lumia-card-placeholder">?</div>')}))}),k[0].showModal()}function w(){const e=(0,r.mt)();$("#lumia-misc-modal").remove();const n=e.lumiaOOCInterval||"",t=e.lumiaOOCStyle||"social",i='\n        <dialog id="lumia-misc-modal" class="popup popup--animation-fast lumia-modal lumia-modal-settings">\n            <div class="lumia-modal-header">\n                <div class="lumia-modal-header-icon">\n                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>\n                    </svg>\n                </div>\n                <h3 class="lumia-modal-title">OOC Settings</h3>\n            </div>\n            <div class="lumia-modal-content">\n\n                <div class="lumia-modal-panel">\n                    <div class="lumia-modal-panel-header">\n                        <span class="lumia-modal-panel-icon">\n                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                                <circle cx="12" cy="12" r="10"></circle>\n                                <polyline points="12 6 12 12 16 14"></polyline>\n                            </svg>\n                        </span>\n                        <span class="lumia-modal-panel-title">Comment Trigger</span>\n                    </div>\n                    <div class="lumia-modal-panel-content">\n                        <p class="lumia-modal-description">Automatically inject OOC instructions at message intervals.</p>\n                        <div class="lumia-modal-field">\n                            <label class="lumia-modal-label" for="lumia-ooc-interval-input">Message Interval</label>\n                            <input type="number"\n                                   id="lumia-ooc-interval-input"\n                                   class="lumia-modal-input"\n                                   placeholder="e.g., 10 (empty = disabled)"\n                                   min="1"\n                                   value="'.concat((0,a.ZD)(n.toString()),'" />\n                            <span class="lumia-modal-hint">Triggers when message count is divisible by this number</span>\n                        </div>\n                    </div>\n                </div>\n\n                <div class="lumia-modal-panel">\n                    <div class="lumia-modal-panel-header">\n                        <span class="lumia-modal-panel-icon">\n                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>\n                                <line x1="3" y1="9" x2="21" y2="9"></line>\n                                <line x1="9" y1="21" x2="9" y2="9"></line>\n                            </svg>\n                        </span>\n                        <span class="lumia-modal-panel-title">Display Style</span>\n                    </div>\n                    <div class="lumia-modal-panel-content">\n                        <p class="lumia-modal-description">Choose how OOC comments appear in chat.</p>\n                        <div class="lumia-style-options">\n                            <label class="lumia-style-option ').concat("social"===t?"selected":"",'">\n                                <input type="radio" name="ooc-style" value="social" ').concat("social"===t?"checked":"",' />\n                                <div class="lumia-style-option-content">\n                                    <span class="lumia-style-option-icon">\n                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                                            <rect x="3" y="3" width="18" height="18" rx="2"></rect>\n                                            <circle cx="8.5" cy="8.5" r="1.5"></circle>\n                                            <path d="M21 15l-5-5L5 21"></path>\n                                        </svg>\n                                    </span>\n                                    <div class="lumia-style-option-text">\n                                        <span class="lumia-style-option-title">Social Card</span>\n                                        <span class="lumia-style-option-desc">Full card with avatar & animations</span>\n                                    </div>\n                                </div>\n                            </label>\n                            <label class="lumia-style-option ').concat("margin"===t?"selected":"",'">\n                                <input type="radio" name="ooc-style" value="margin" ').concat("margin"===t?"checked":"",' />\n                                <div class="lumia-style-option-content">\n                                    <span class="lumia-style-option-icon">\n                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>\n                                            <polyline points="14 2 14 8 20 8"></polyline>\n                                        </svg>\n                                    </span>\n                                    <div class="lumia-style-option-text">\n                                        <span class="lumia-style-option-title">Margin Note</span>\n                                        <span class="lumia-style-option-desc">Minimal hanging tag style</span>\n                                    </div>\n                                </div>\n                            </label>\n                            <label class="lumia-style-option ').concat("whisper"===t?"selected":"",'">\n                                <input type="radio" name="ooc-style" value="whisper" ').concat("whisper"===t?"checked":"",' />\n                                <div class="lumia-style-option-content">\n                                    <span class="lumia-style-option-icon">\n                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                                            <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path>\n                                        </svg>\n                                    </span>\n                                    <div class="lumia-style-option-text">\n                                        <span class="lumia-style-option-title">Whisper Bubble</span>\n                                        <span class="lumia-style-option-desc">Soft ethereal thought bubble</span>\n                                    </div>\n                                </div>\n                            </label>\n                        </div>\n                    </div>\n                </div>\n\n            </div>\n            <div class="lumia-modal-footer">\n                <button class="lumia-modal-btn lumia-modal-btn-secondary lumia-misc-cancel-btn">Cancel</button>\n                <button class="lumia-modal-btn lumia-modal-btn-primary lumia-misc-save-btn">Save Changes</button>\n            </div>\n        </dialog>\n    ');$("body").append(i);const o=$("#lumia-misc-modal");y(o);const s=()=>{o[0]._resizeCleanup&&o[0]._resizeCleanup(),o[0].close(),o.remove()};o.on("click mousedown mouseup",function(e){e.stopPropagation(),"click"===e.type&&e.target===this&&s()}),o.find('.lumia-style-option input[type="radio"]').change(function(){o.find(".lumia-style-option").removeClass("selected"),$(this).closest(".lumia-style-option").addClass("selected")}),o.find(".lumia-misc-save-btn").click(()=>{const n=$("#lumia-ooc-interval-input").val().trim(),t=o.find('input[name="ooc-style"]:checked').val(),i=e.lumiaOOCStyle;e.lumiaOOCInterval=n?parseInt(n,10):null,e.lumiaOOCStyle=t,(0,r.DZ)(),(0,l.TC)(),toastr.success("OOC settings saved!"),s(),i!==t&&c&&setTimeout(()=>c(!0),100)}),o.find(".lumia-misc-cancel-btn").click(s),o.on("keydown",function(e){"Escape"===e.key&&s()}),o[0].showModal()}function j(e){const n=(0,r.mt)(),t=Object.values(n.packs);let i="",o="",s=!1,l=null,c="";"Narrative Style"===e?(i="Select Narrative Styles",o="Choose how the story is told",s=!0,l="selectedLoomStyle",c='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n            <path d="M12 19l7-7 3 3-7 7-3-3z"></path>\n            <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"></path>\n            <path d="M2 2l7.586 7.586"></path>\n            <circle cx="11" cy="11" r="2"></circle>\n        </svg>'):"Loom Utilities"===e?(i="Select Loom Utilities",o="Toggle utilities to enhance generation",s=!0,l="selectedLoomUtils",c='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n            <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path>\n        </svg>'):"Retrofits"===e&&(i="Select Retrofits",o="Choose retrofit modifications",s=!0,l="selectedLoomRetrofits",c='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n            <circle cx="12" cy="12" r="3"></circle>\n            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"></path>\n        </svg>'),$("#loom-selection-modal").remove();let u="";0===t.length?u='<div class="lumia-modal-empty">No Packs loaded. Add one in settings!</div>':(t.forEach(t=>{const i=t.items;if(!i||0===i.length)return;const r=i.filter(n=>n.loomCategory===e);if(0===r.length)return;const o=r.map(e=>{let i=!1;const r=e.loomName;if(s){i=(Array.isArray(n[l])?n[l]:[]).some(e=>e.packName===t.name&&e.itemName===r)}else{const e=n[l];i=e&&e.packName===t.name&&e.itemName===r}const o=(0,a.ZD)(t.name),c=(0,a.ZD)(r);return'\n                <div class="lumia-list-item '.concat(i?"selected":"",'"\n                     data-pack="').concat(o,'"\n                     data-item="').concat(c,'">\n                    <div class="lumia-list-item-content">\n                        <span class="lumia-list-item-name">').concat(r||"Unknown",'</span>\n                    </div>\n                    <div class="lumia-list-item-toggle">\n                        ').concat(s?'\n                        <div class="lumia-toggle-switch">\n                            <div class="lumia-toggle-track">\n                                <div class="lumia-toggle-thumb"></div>\n                            </div>\n                        </div>\n                        ':'\n                        <div class="lumia-radio-indicator"></div>\n                        ',"\n                    </div>\n                </div>\n                ")}).join("");o&&(u+='\n                <div class="lumia-modal-panel lumia-collapsible">\n                    <div class="lumia-modal-panel-header lumia-collapsible-trigger">\n                        <span class="lumia-panel-collapse-icon">\n                            '.concat(b,'\n                        </span>\n                        <span class="lumia-modal-panel-icon">\n                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                                <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>\n                            </svg>\n                        </span>\n                        <span class="lumia-modal-panel-title">').concat(t.name,'</span>\n                        <span class="lumia-modal-panel-count">').concat(r.length,' items</span>\n                        <button class="lumia-icon-btn-sm lumia-remove-pack-btn" data-pack="').concat((0,a.ZD)(t.name),'" title="Remove Pack">\n                            ').concat(f,'\n                        </button>\n                    </div>\n                    <div class="lumia-modal-panel-content lumia-modal-panel-content-list lumia-collapsible-content">\n                        <div class="lumia-list-group">\n                            ').concat(o,"\n                        </div>\n                    </div>\n                </div>\n                "))}),u||(u='<div class="lumia-modal-empty">No "'.concat(e,'" items found in loaded packs.</div>')));const d='\n        <dialog id="loom-selection-modal" class="popup popup--animation-fast lumia-modal lumia-modal-selection">\n            <div class="lumia-modal-header">\n                <div class="lumia-modal-header-icon">\n                    '.concat(c,'\n                </div>\n                <div class="lumia-modal-header-text">\n                    <h3 class="lumia-modal-title">').concat(i,'</h3>\n                    <p class="lumia-modal-subtitle">').concat(o,'</p>\n                </div>\n                <button class="lumia-clear-btn" title="Clear selection">\n                    ').concat(g,'\n                    <span>Clear</span>\n                </button>\n            </div>\n            <div class="lumia-modal-content">\n                ').concat(u,'\n            </div>\n            <div class="lumia-modal-footer">\n                <button class="lumia-modal-btn lumia-modal-btn-secondary lumia-modal-close-btn">Close</button>\n                ').concat(s?'<button class="lumia-modal-btn lumia-modal-btn-primary lumia-modal-done">Done</button>':"","\n            </div>\n        </dialog>\n    ");$("body").append(d);const m=$("#loom-selection-modal");y(m);const h=()=>{m[0]._resizeCleanup&&m[0]._resizeCleanup(),m[0].close(),m.remove(),p()};m.on("click mousedown mouseup",function(e){e.stopPropagation(),"click"===e.type&&e.target===this&&h()}),m.find(".lumia-modal-close-btn, .lumia-modal-done").click(h),m.on("keydown",function(e){"Escape"===e.key&&h()}),m.find(".lumia-collapsible-trigger").click(function(e){$(e.target).closest(".lumia-list-item").length>0||$(e.target).closest(".lumia-remove-pack-btn").length>0||$(this).closest(".lumia-collapsible").toggleClass("collapsed")}),m.find(".lumia-clear-btn").click(function(e){e.stopPropagation(),n[l]=s?[]:null,(0,r.DZ)(),m.find(".lumia-list-item").removeClass("selected"),toastr.info("".concat(i.replace("Select ","")," cleared"))}),m.find(".lumia-remove-pack-btn").click(function(e){e.stopPropagation();const t=$(this).data("pack");confirm('Are you sure you want to remove the pack "'.concat(t,'"?'))&&(delete n.packs[t],n.selectedLoomStyle=(Array.isArray(n.selectedLoomStyle)?n.selectedLoomStyle:[]).filter(e=>e.packName!==t),n.selectedLoomUtils=n.selectedLoomUtils.filter(e=>e.packName!==t),n.selectedLoomRetrofits=n.selectedLoomRetrofits.filter(e=>e.packName!==t),n.selectedDefinition&&n.selectedDefinition.packName===t&&(n.selectedDefinition=null),n.selectedBehaviors=n.selectedBehaviors.filter(e=>e.packName!==t),n.selectedPersonalities=n.selectedPersonalities.filter(e=>e.packName!==t),n.dominantBehavior&&n.dominantBehavior.packName===t&&(n.dominantBehavior=null),n.dominantPersonality&&n.dominantPersonality.packName===t&&(n.dominantPersonality=null),(0,r.DZ)(),$(this).closest(".lumia-modal-panel").remove(),0===Object.keys(n.packs).length&&h())}),m.find(".lumia-list-item").click(function(){const e=$(this).data("pack"),t=$(this).data("item");if(s){const i=$(this);let a=n[l];const o=a.findIndex(n=>n.packName===e&&n.itemName===t);-1!==o?(a.splice(o,1),i.removeClass("selected")):(a.push({packName:e,itemName:t}),i.addClass("selected")),n[l]=a,(0,r.DZ)()}else m.find(".lumia-list-item").removeClass("selected"),$(this).addClass("selected"),n[l]={packName:e,itemName:t},(0,r.DZ)(),setTimeout(h,150)}),m[0].showModal()}function S(){var e;const n=(0,r.mt)(),t=(0,i.SD)();$("#lumia-summarization-modal").remove();const s=n.summarization||{},c=s.secondary||{},u=s.mode||"disabled",d=s.apiSource||"main",m=s.autoInterval||10,p=s.autoMessageContext||10,h=s.manualMessageContext||10,v=c.provider||"openai",f=c.model||"",g=c.endpoint||"",b=c.apiKey||"",x=c.temperature||.7,k=void 0!==c.topP?c.topP:1,w=c.maxTokens||8192,j=n.messageTruncation||{},S=j.enabled||!1,C=null!==(e=j.keepCount)&&void 0!==e?e:50,N=(null==t?void 0:t.chat)&&t.chat.length>0,P=(0,o.__)(v),E='\n        <dialog id="lumia-summarization-modal" class="popup popup--animation-fast lumia-modal lumia-modal-settings">\n            <div class="lumia-modal-header">\n                <div class="lumia-modal-header-icon">\n                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                        <line x1="21" y1="10" x2="3" y2="10"></line>\n                        <line x1="21" y1="6" x2="3" y2="6"></line>\n                        <line x1="21" y1="14" x2="3" y2="14"></line>\n                        <line x1="21" y1="18" x2="3" y2="18"></line>\n                    </svg>\n                </div>\n                <h3 class="lumia-modal-title">Summarization</h3>\n            </div>\n            <div class="lumia-modal-content">\n\n                \x3c!-- Mode Selection --\x3e\n                <div class="lumia-modal-panel">\n                    <div class="lumia-modal-panel-header">\n                        <span class="lumia-modal-panel-icon">\n                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                                <circle cx="12" cy="12" r="3"></circle>\n                                <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"></path>\n                            </svg>\n                        </span>\n                        <span class="lumia-modal-panel-title">Mode</span>\n                    </div>\n                    <div class="lumia-modal-panel-content">\n                        <div class="lumia-mode-options">\n                            <label class="lumia-mode-option '.concat("disabled"===u?"selected":"",'">\n                                <input type="radio" name="sum-mode" value="disabled" ').concat("disabled"===u?"checked":"",' />\n                                <span class="lumia-mode-option-label">Disabled</span>\n                            </label>\n                            <label class="lumia-mode-option ').concat("auto"===u?"selected":"",'">\n                                <input type="radio" name="sum-mode" value="auto" ').concat("auto"===u?"checked":"",' />\n                                <span class="lumia-mode-option-label">Automatic</span>\n                            </label>\n                            <label class="lumia-mode-option ').concat("manual"===u?"selected":"",'">\n                                <input type="radio" name="sum-mode" value="manual" ').concat("manual"===u?"checked":"",' />\n                                <span class="lumia-mode-option-label">Manual</span>\n                            </label>\n                        </div>\n                    </div>\n                </div>\n\n                \x3c!-- Auto Settings (conditional) --\x3e\n                <div class="lumia-modal-panel" id="lumia-sum-auto-section" style="').concat("auto"===u?"":"display: none;",'">\n                    <div class="lumia-modal-panel-header">\n                        <span class="lumia-modal-panel-icon">\n                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                                <circle cx="12" cy="12" r="10"></circle>\n                                <polyline points="12 6 12 12 16 14"></polyline>\n                            </svg>\n                        </span>\n                        <span class="lumia-modal-panel-title">Auto Settings</span>\n                    </div>\n                    <div class="lumia-modal-panel-content">\n                        <div class="lumia-modal-field-row">\n                            <div class="lumia-modal-field">\n                                <label class="lumia-modal-label" for="lumia-sum-interval-input">Interval</label>\n                                <input type="number" id="lumia-sum-interval-input" class="lumia-modal-input" min="1" value="').concat(m,'" />\n                                <span class="lumia-modal-hint">Every N messages</span>\n                            </div>\n                            <div class="lumia-modal-field">\n                                <label class="lumia-modal-label" for="lumia-sum-auto-context-input">Context</label>\n                                <input type="number" id="lumia-sum-auto-context-input" class="lumia-modal-input" min="1" max="100" value="').concat(p,'" />\n                                <span class="lumia-modal-hint">Messages to include</span>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                \x3c!-- Manual Context (conditional) --\x3e\n                <div class="lumia-modal-panel" id="lumia-sum-manual-section" style="').concat("manual"===u||"auto"===u?"":"display: none;",'">\n                    <div class="lumia-modal-panel-header">\n                        <span class="lumia-modal-panel-icon">\n                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>\n                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>\n                            </svg>\n                        </span>\n                        <span class="lumia-modal-panel-title">Manual Context</span>\n                    </div>\n                    <div class="lumia-modal-panel-content">\n                        <div class="lumia-modal-field">\n                            <label class="lumia-modal-label" for="lumia-sum-manual-context-input">Messages to include</label>\n                            <input type="number" id="lumia-sum-manual-context-input" class="lumia-modal-input" min="1" max="100" value="').concat(h,'" />\n                            <span class="lumia-modal-hint">When using /loom-summarize command</span>\n                        </div>\n                    </div>\n                </div>\n\n                \x3c!-- API Source --\x3e\n                <div class="lumia-modal-panel">\n                    <div class="lumia-modal-panel-header">\n                        <span class="lumia-modal-panel-icon">\n                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                                <path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"></path>\n                            </svg>\n                        </span>\n                        <span class="lumia-modal-panel-title">API Source</span>\n                    </div>\n                    <div class="lumia-modal-panel-content">\n                        <div class="lumia-mode-options">\n                            <label class="lumia-mode-option lumia-mode-option-wide ').concat("main"===d?"selected":"",'">\n                                <input type="radio" name="sum-source" value="main" ').concat("main"===d?"checked":"",' />\n                                <span class="lumia-mode-option-label">Main API</span>\n                            </label>\n                            <label class="lumia-mode-option lumia-mode-option-wide ').concat("secondary"===d?"selected":"",'">\n                                <input type="radio" name="sum-source" value="secondary" ').concat("secondary"===d?"checked":"",' />\n                                <span class="lumia-mode-option-label">Secondary LLM</span>\n                            </label>\n                        </div>\n                    </div>\n                </div>\n\n                \x3c!-- Secondary LLM Config (conditional) --\x3e\n                <div class="lumia-modal-panel" id="lumia-sum-secondary-section" style="').concat("secondary"===d?"":"display: none;",'">\n                    <div class="lumia-modal-panel-header">\n                        <span class="lumia-modal-panel-icon">\n                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                                <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>\n                                <line x1="8" y1="21" x2="16" y2="21"></line>\n                                <line x1="12" y1="17" x2="12" y2="21"></line>\n                            </svg>\n                        </span>\n                        <span class="lumia-modal-panel-title">Secondary LLM</span>\n                    </div>\n                    <div class="lumia-modal-panel-content">\n                        <div class="lumia-modal-field">\n                            <label class="lumia-modal-label" for="lumia-sum-provider-select">Provider</label>\n                            <select id="lumia-sum-provider-select" class="lumia-modal-select">\n                                ').concat(Object.entries(o.x$).map(e=>{let[n,t]=e;return'<option value="'.concat(n,'" ').concat(v===n?"selected":"",">").concat(t.name,"</option>")}).join(""),'\n                            </select>\n                            <span class="lumia-modal-hint lumia-sum-provider-hint ').concat("custom"===v?"lumia-hidden":"",'">\n                                Uses API key from SillyTavern settings\n                            </span>\n                        </div>\n\n                        <div class="lumia-modal-field-row">\n                            <div class="lumia-modal-field">\n                                <label class="lumia-modal-label" for="lumia-sum-model-input">Model</label>\n                                <input type="text" id="lumia-sum-model-input" class="lumia-modal-input"\n                                       placeholder="').concat(P.placeholder,'"\n                                       value="').concat((0,a.ZD)(f),'" />\n                            </div>\n                        </div>\n\n                        <div class="lumia-modal-field lumia-sum-custom-fields ').concat("custom"===v?"":"lumia-hidden",'">\n                            <label class="lumia-modal-label" for="lumia-sum-endpoint-input">Endpoint URL</label>\n                            <input type="text" id="lumia-sum-endpoint-input" class="lumia-modal-input"\n                                   placeholder="https://your-api.com/v1/chat/completions"\n                                   value="').concat((0,a.ZD)(g),'" />\n                        </div>\n\n                        <div class="lumia-modal-field lumia-sum-custom-fields ').concat("custom"===v?"":"lumia-hidden",'">\n                            <label class="lumia-modal-label" for="lumia-sum-apikey-input">API Key</label>\n                            <input type="password" id="lumia-sum-apikey-input" class="lumia-modal-input"\n                                   placeholder="Your API key"\n                                   value="').concat((0,a.ZD)(b),'" />\n                        </div>\n\n                        <div class="lumia-modal-field-row lumia-modal-field-row-3">\n                            <div class="lumia-modal-field">\n                                <label class="lumia-modal-label" for="lumia-sum-temp-input">Temp</label>\n                                <input type="number" id="lumia-sum-temp-input" class="lumia-modal-input"\n                                       min="0" max="2" step="0.1" value="').concat(x,'" />\n                            </div>\n                            <div class="lumia-modal-field">\n                                <label class="lumia-modal-label" for="lumia-sum-topp-input">Top-P</label>\n                                <input type="number" id="lumia-sum-topp-input" class="lumia-modal-input"\n                                       min="0" max="1" step="0.05" value="').concat(k,'" />\n                            </div>\n                            <div class="lumia-modal-field">\n                                <label class="lumia-modal-label" for="lumia-sum-maxtokens-input">Max Tokens</label>\n                                <input type="text" id="lumia-sum-maxtokens-input" class="lumia-modal-input"\n                                       value="').concat(w,'" />\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                \x3c!-- Test Section --\x3e\n                <div class="lumia-modal-panel lumia-modal-panel-accent">\n                    <div class="lumia-modal-panel-header">\n                        <span class="lumia-modal-panel-icon">\n                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                                <polygon points="5 3 19 12 5 21 5 3"></polygon>\n                            </svg>\n                        </span>\n                        <span class="lumia-modal-panel-title">Test</span>\n                    </div>\n                    <div class="lumia-modal-panel-content">\n                        <button id="lumia-sum-test-btn" class="lumia-modal-btn lumia-modal-btn-primary lumia-modal-btn-full ').concat(N?"":"lumia-btn-disabled",'" ').concat(N?"":"disabled",'>\n                            <span class="lumia-btn-icon">\n                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                                    <polyline points="20 6 9 17 4 12"></polyline>\n                                </svg>\n                            </span>\n                            <span class="lumia-btn-spinner lumia-hidden"></span>\n                            <span class="lumia-btn-text">').concat(N?"Generate Summary Now":"No Active Chat",'</span>\n                        </button>\n                        <div id="lumia-sum-test-result" class="lumia-test-result lumia-hidden"></div>\n                        ').concat(N?"":'<div class="lumia-test-hint">Open a chat to test summarization</div>','\n                    </div>\n                </div>\n\n                \x3c!-- Message Truncation Section --\x3e\n                <div class="lumia-modal-panel">\n                    <div class="lumia-modal-panel-header">\n                        <span class="lumia-modal-panel-icon">\n                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>\n                            </svg>\n                        </span>\n                        <span class="lumia-modal-panel-title">Save N Messages</span>\n                    </div>\n                    <div class="lumia-modal-panel-content">\n                        <div class="lumia-filter-item">\n                            <div class="lumia-toggle-row">\n                                <label class="lumia-toggle-label" for="lumia-trunc-toggle">\n                                    <span class="lumia-toggle-text">Limit Context Messages</span>\n                                    <span class="lumia-toggle-hint">Only send the last N messages to the AI</span>\n                                </label>\n                                <div class="lumia-toggle-switch-wrapper">\n                                    <input type="checkbox" id="lumia-trunc-toggle" class="lumia-toggle-input" ').concat(S?"checked":"",' />\n                                    <label for="lumia-trunc-toggle" class="lumia-toggle-switch-label">\n                                        <div class="lumia-toggle-track">\n                                            <div class="lumia-toggle-thumb"></div>\n                                        </div>\n                                    </label>\n                                </div>\n                            </div>\n                            <div class="lumia-filter-options ').concat(S?"":"lumia-filter-options-hidden",'">\n                                <label class="lumia-input-label">\n                                    <span>Messages to keep:</span>\n                                    <input type="number" id="lumia-trunc-count-input" class="lumia-input-number" value="').concat(C,'" min="5" max="500" />\n                                </label>\n                                <span class="lumia-input-hint">Number of recent messages to include in context</span>\n\n                                <div class="lumia-warning-box">\n                                    <div class="lumia-warning-box-icon">\n                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                                            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>\n                                            <line x1="12" y1="9" x2="12" y2="13"></line>\n                                            <line x1="12" y1="17" x2="12.01" y2="17"></line>\n                                        </svg>\n                                    </div>\n                                    <div class="lumia-warning-box-content">\n                                        <div class="lumia-warning-box-title">Memory Loss Warning</div>\n                                        <div class="lumia-warning-box-text">\n                                            Older messages beyond this limit will be excluded from the AI\'s context.\n                                            The AI will lose awareness of earlier events, character details, and plot points.\n                                            Consider using Loom summarization to preserve important memories.\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n            </div>\n            <div class="lumia-modal-footer">\n                <button class="lumia-modal-btn lumia-modal-btn-secondary lumia-sum-cancel-btn">Cancel</button>\n                <button class="lumia-modal-btn lumia-modal-btn-primary lumia-sum-save-btn">Save Changes</button>\n            </div>\n        </dialog>\n    ');$("body").append(E);const M=$("#lumia-summarization-modal");y(M);const L=()=>{M[0]._resizeCleanup&&M[0]._resizeCleanup(),M[0].close(),M.remove()};M.on("click mousedown mouseup",function(e){e.stopPropagation(),"click"===e.type&&e.target===this&&L()}),M.find('input[name="sum-mode"]').change(function(){M.find(".lumia-mode-option").each(function(){$(this).find('input[name="sum-mode"]').is(":checked")?$(this).addClass("selected"):$(this).removeClass("selected")});const e=$(this).val();"auto"===e?(M.find("#lumia-sum-auto-section").show(),M.find("#lumia-sum-manual-section").show()):"manual"===e?(M.find("#lumia-sum-auto-section").hide(),M.find("#lumia-sum-manual-section").show()):(M.find("#lumia-sum-auto-section").hide(),M.find("#lumia-sum-manual-section").hide())}),M.find('input[name="sum-source"]').change(function(){M.find(".lumia-mode-option").each(function(){const e=$(this).find('input[name="sum-source"]');e.length&&e.is(":checked")?$(this).addClass("selected"):$(this).find('input[name="sum-source"]').length&&$(this).removeClass("selected")});"secondary"===$(this).val()?M.find("#lumia-sum-secondary-section").show():M.find("#lumia-sum-secondary-section").hide()}),M.find("#lumia-sum-provider-select").change(function(){const e=$(this).val(),n=(0,o.Iv)(e);M.find("#lumia-sum-model-input").attr("placeholder",n.placeholder),"custom"===e?(M.find(".lumia-sum-custom-fields").removeClass("lumia-hidden"),M.find(".lumia-sum-provider-hint").addClass("lumia-hidden")):(M.find(".lumia-sum-custom-fields").addClass("lumia-hidden"),M.find(".lumia-sum-provider-hint").removeClass("lumia-hidden"))}),M.find("#lumia-trunc-toggle").change(function(){const e=$(this).closest(".lumia-filter-item").find(".lumia-filter-options");$(this).is(":checked")?e.removeClass("lumia-filter-options-hidden"):e.addClass("lumia-filter-options-hidden")});const O=e=>{const n=parseInt(e,10);return isNaN(n)||!/^\d+$/.test(String(e).trim())?8192:Math.max(256,n)};M.find("#lumia-sum-test-btn").click(async function(){const e=$(this),n=e.find(".lumia-btn-icon"),t=e.find(".lumia-btn-spinner"),i=e.find(".lumia-btn-text"),a=M.find("#lumia-sum-test-result");e.prop("disabled",!0),n.addClass("lumia-hidden"),t.removeClass("lumia-hidden"),i.text("Weaving summary..."),a.addClass("lumia-hidden").removeClass("lumia-test-result-success lumia-test-result-error");try{const r={mode:M.find('input[name="sum-mode"]:checked').val(),apiSource:M.find('input[name="sum-source"]:checked').val(),autoInterval:parseInt(M.find("#lumia-sum-interval-input").val())||10,autoMessageContext:parseInt(M.find("#lumia-sum-auto-context-input").val())||10,manualMessageContext:parseInt(M.find("#lumia-sum-manual-context-input").val())||10,secondary:{provider:M.find("#lumia-sum-provider-select").val(),model:M.find("#lumia-sum-model-input").val(),endpoint:M.find("#lumia-sum-endpoint-input").val(),apiKey:M.find("#lumia-sum-apikey-input").val(),temperature:parseFloat(M.find("#lumia-sum-temp-input").val())||.7,topP:parseFloat(M.find("#lumia-sum-topp-input").val())||1,maxTokens:O(M.find("#lumia-sum-maxtokens-input").val())}},s=await(0,o.Zq)(r,!0);e.prop("disabled",!1),t.addClass("lumia-hidden"),n.removeClass("lumia-hidden"),i.text("Generate Summary Now"),s?(a.removeClass("lumia-hidden").addClass("lumia-test-result-success").html('\n            <div class="lumia-test-result-icon">\n              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                <polyline points="20 6 9 17 4 12"></polyline>\n              </svg>\n            </div>\n            <div class="lumia-test-result-content">\n              <div class="lumia-test-result-title">Summary woven successfully!</div>\n              <div class="lumia-test-result-text">Saved to chat metadata.</div>\n            </div>\n          '),toastr.success("Summary generated and saved to chat metadata!")):a.removeClass("lumia-hidden").addClass("lumia-test-result-error").html('\n            <div class="lumia-test-result-icon">\n              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                <circle cx="12" cy="12" r="10"></circle>\n                <line x1="12" y1="8" x2="12" y2="12"></line>\n                <line x1="12" y1="16" x2="12.01" y2="16"></line>\n              </svg>\n            </div>\n            <div class="lumia-test-result-content">\n              <div class="lumia-test-result-title">No summary generated</div>\n              <div class="lumia-test-result-text">Check console for details.</div>\n            </div>\n          ')}catch(o){console.error("[".concat(r.pW,"] Summarization error:"),o),e.prop("disabled",!1),t.addClass("lumia-hidden"),n.removeClass("lumia-hidden"),i.text("Generate Summary Now"),a.removeClass("lumia-hidden").addClass("lumia-test-result-error").html('\n          <div class="lumia-test-result-icon">\n            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n              <circle cx="12" cy="12" r="10"></circle>\n              <path d="M15 9l-6 6M9 9l6 6"></path>\n            </svg>\n          </div>\n          <div class="lumia-test-result-content">\n            <div class="lumia-test-result-title">Error</div>\n            <div class="lumia-test-result-text">'.concat(o.message,"</div>\n          </div>\n        "))}}),M.find(".lumia-sum-save-btn").click(()=>{const e=O(M.find("#lumia-sum-maxtokens-input").val());M.find("#lumia-sum-maxtokens-input").val(e),n.summarization={mode:M.find('input[name="sum-mode"]:checked').val(),apiSource:M.find('input[name="sum-source"]:checked').val(),autoInterval:parseInt(M.find("#lumia-sum-interval-input").val())||10,autoMessageContext:parseInt(M.find("#lumia-sum-auto-context-input").val())||10,manualMessageContext:parseInt(M.find("#lumia-sum-manual-context-input").val())||10,secondary:{provider:M.find("#lumia-sum-provider-select").val(),model:M.find("#lumia-sum-model-input").val(),endpoint:M.find("#lumia-sum-endpoint-input").val(),apiKey:M.find("#lumia-sum-apikey-input").val(),temperature:parseFloat(M.find("#lumia-sum-temp-input").val())||.7,topP:parseFloat(M.find("#lumia-sum-topp-input").val())||1,maxTokens:e}},n.messageTruncation={enabled:M.find("#lumia-trunc-toggle").is(":checked"),keepCount:parseInt(M.find("#lumia-trunc-count-input").val())||50},(0,r.DZ)(),(0,l.TC)(),toastr.success("Summarization settings saved!"),L()}),M.find(".lumia-sum-cancel-btn").click(L),M.on("keydown",function(e){"Escape"===e.key&&L()}),M[0].showModal()}function C(){const e=(0,r.mt)();$("#lumia-prompt-settings-modal").remove();const n=e.sovereignHand||{},t=n.enabled||!1,i=!1!==n.excludeLastMessage,a=!1!==n.includeMessageInPrompt,o=e.contextFilters||{},s=o.htmlTags||{},c=o.detailsBlocks||{},u=o.loomItems||{},d='\n        <dialog id="lumia-prompt-settings-modal" class="popup popup--animation-fast lumia-modal lumia-modal-settings">\n            <div class="lumia-modal-header">\n                <div class="lumia-modal-header-icon">\n                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>\n                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>\n                    </svg>\n                </div>\n                <h3 class="lumia-modal-title">Prompt Settings</h3>\n            </div>\n            <div class="lumia-modal-content">\n\n                \x3c!-- Sovereign Hand Section --\x3e\n                <div class="lumia-modal-panel lumia-collapsible">\n                    <div class="lumia-modal-panel-header lumia-collapsible-trigger">\n                        <span class="lumia-panel-collapse-icon">\n                            '.concat(b,'\n                        </span>\n                        <span class="lumia-modal-panel-icon">\n                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                                <path d="M18 3a3 3 0 0 0-3 3v12a3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3H6a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3V6a3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3h12a3 3 0 0 0 3-3 3 3 0 0 0-3-3z"></path>\n                            </svg>\n                        </span>\n                        <span class="lumia-modal-panel-title">Sovereign Hand</span>\n                        <span class="lumia-panel-status ').concat(t?"lumia-panel-status-active":"",'">').concat(t?"Active":"Inactive",'</span>\n                    </div>\n                    <div class="lumia-modal-panel-content lumia-collapsible-content">\n                        <div class="lumia-panel-content-inner">\n                            <p class="lumia-modal-description">Enable Sovereign Hand integration to use advanced prompt manipulation features.</p>\n\n                            <div class="lumia-toggle-row">\n                                <label class="lumia-toggle-label" for="lumia-sovereign-hand-toggle">\n                                    <span class="lumia-toggle-text">Use Sovereign Hand Features</span>\n                                    <span class="lumia-toggle-hint">Enables Sovereign Hand macros for advanced prompt control</span>\n                                </label>\n                                <div class="lumia-toggle-switch-wrapper">\n                                    <input type="checkbox" id="lumia-sovereign-hand-toggle" class="lumia-toggle-input" ').concat(t?"checked":"",' />\n                                    <label for="lumia-sovereign-hand-toggle" class="lumia-toggle-switch-label">\n                                        <div class="lumia-toggle-track">\n                                            <div class="lumia-toggle-thumb"></div>\n                                        </div>\n                                    </label>\n                                </div>\n                            </div>\n\n                            <div class="lumia-toggle-row ').concat(t?"":"lumia-toggle-disabled",'">\n                                <label class="lumia-toggle-label" for="lumia-sovereign-exclude-toggle">\n                                    <span class="lumia-toggle-text">Exclude Last Message from Context</span>\n                                    <span class="lumia-toggle-hint">When enabled, removes the last user message from the outgoing context</span>\n                                </label>\n                                <div class="lumia-toggle-switch-wrapper">\n                                    <input type="checkbox" id="lumia-sovereign-exclude-toggle" class="lumia-toggle-input" ').concat(i?"checked":""," ").concat(t?"":"disabled",' />\n                                    <label for="lumia-sovereign-exclude-toggle" class="lumia-toggle-switch-label">\n                                        <div class="lumia-toggle-track">\n                                            <div class="lumia-toggle-thumb"></div>\n                                        </div>\n                                    </label>\n                                </div>\n                            </div>\n\n                            <div class="lumia-toggle-row ').concat(t?"":"lumia-toggle-disabled",'">\n                                <label class="lumia-toggle-label" for="lumia-sovereign-include-prompt-toggle">\n                                    <span class="lumia-toggle-text">Include Message in Master Prompt</span>\n                                    <span class="lumia-toggle-hint">When enabled, includes the user message in the {{loomSovHand}} macro output</span>\n                                </label>\n                                <div class="lumia-toggle-switch-wrapper">\n                                    <input type="checkbox" id="lumia-sovereign-include-prompt-toggle" class="lumia-toggle-input" ').concat(a?"checked":""," ").concat(t?"":"disabled",' />\n                                    <label for="lumia-sovereign-include-prompt-toggle" class="lumia-toggle-switch-label">\n                                        <div class="lumia-toggle-track">\n                                            <div class="lumia-toggle-thumb"></div>\n                                        </div>\n                                    </label>\n                                </div>\n                            </div>\n\n                            <div class="lumia-info-box lumia-info-box-sovereign ').concat(t?"":"lumia-info-box-muted",'">\n                                <div class="lumia-info-box-header">\n                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                                        <circle cx="12" cy="12" r="10"></circle>\n                                        <line x1="12" y1="16" x2="12" y2="12"></line>\n                                        <line x1="12" y1="8" x2="12.01" y2="8"></line>\n                                    </svg>\n                                    <span>Available macros:</span>\n                                </div>\n                                <ul class="lumia-info-box-list">\n                                    <li><code>{{loomLastUserMessage}}</code> returns the last user message content</li>\n                                    <li><code>{{loomLastCharMessage}}</code> returns the last character message content</li>\n                                    <li><code>{{lastMessageName}}</code> returns the name of whoever sent the last message</li>\n                                    <li><code>{{loomContinuePrompt}}</code> adds continuation instructions when character spoke last</li>\n                                </ul>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                \x3c!-- Context Filters Section --\x3e\n                <div class="lumia-modal-panel lumia-collapsible">\n                    <div class="lumia-modal-panel-header lumia-collapsible-trigger">\n                        <span class="lumia-panel-collapse-icon">\n                            ').concat(b,'\n                        </span>\n                        <span class="lumia-modal-panel-icon">\n                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                                <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>\n                            </svg>\n                        </span>\n                        <span class="lumia-modal-panel-title">Context Filters</span>\n                        <span class="lumia-panel-status ').concat(s.enabled||c.enabled||u.enabled?"lumia-panel-status-active":"",'">').concat(s.enabled||c.enabled||u.enabled?"Active":"Inactive",'</span>\n                    </div>\n                    <div class="lumia-modal-panel-content lumia-collapsible-content">\n                        <div class="lumia-panel-content-inner">\n                            <p class="lumia-modal-description">Filter out specific content from the chat context before sending to the AI. Helps reduce token usage and keep prompts clean.</p>\n\n                            \x3c!-- HTML Tags Filter --\x3e\n                            <div class="lumia-filter-item">\n                                <div class="lumia-toggle-row">\n                                    <label class="lumia-toggle-label" for="lumia-filter-html-toggle">\n                                        <span class="lumia-toggle-text">Strip HTML Tags</span>\n                                        <span class="lumia-toggle-hint">Removes formatting tags: &lt;div&gt;, &lt;span&gt;, &lt;b&gt;, &lt;i&gt;, &lt;u&gt;, &lt;em&gt;, &lt;strong&gt;</span>\n                                    </label>\n                                    <div class="lumia-toggle-switch-wrapper">\n                                        <input type="checkbox" id="lumia-filter-html-toggle" class="lumia-toggle-input" ').concat(s.enabled?"checked":"",' />\n                                        <label for="lumia-filter-html-toggle" class="lumia-toggle-switch-label">\n                                            <div class="lumia-toggle-track">\n                                                <div class="lumia-toggle-thumb"></div>\n                                            </div>\n                                        </label>\n                                    </div>\n                                </div>\n                                <div class="lumia-filter-options ').concat(s.enabled?"":"lumia-filter-options-hidden",'">\n                                    \x3c!-- Strip Fonts Sub-toggle --\x3e\n                                    <div class="lumia-filter-sub-item">\n                                        <div class="lumia-toggle-row">\n                                            <label class="lumia-toggle-label" for="lumia-filter-fonts-toggle">\n                                                <span class="lumia-toggle-text">Also Strip Fonts</span>\n                                                <span class="lumia-toggle-hint">Remove &lt;font&gt; tags (used by some presets for colored dialogue)</span>\n                                            </label>\n                                            <div class="lumia-toggle-switch-wrapper">\n                                                <input type="checkbox" id="lumia-filter-fonts-toggle" class="lumia-toggle-input" ').concat(s.stripFonts?"checked":"",' />\n                                                <label for="lumia-filter-fonts-toggle" class="lumia-toggle-switch-label">\n                                                    <div class="lumia-toggle-track">\n                                                        <div class="lumia-toggle-thumb"></div>\n                                                    </div>\n                                                </label>\n                                            </div>\n                                        </div>\n                                        <div class="lumia-filter-options lumia-filter-sub-options ').concat(s.stripFonts?"":"lumia-filter-options-hidden",'">\n                                            <label class="lumia-input-label">\n                                                <span>Keep fonts in last N messages:</span>\n                                                <input type="number" id="lumia-filter-fonts-depth" class="lumia-input-number" value="').concat(s.fontKeepDepth||3,'" min="0" max="100" />\n                                            </label>\n                                            <span class="lumia-input-hint">Font tags in older messages will be stripped to save tokens</span>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n\n                            \x3c!-- Details Blocks Filter --\x3e\n                            <div class="lumia-filter-item">\n                                <div class="lumia-toggle-row">\n                                    <label class="lumia-toggle-label" for="lumia-filter-details-toggle">\n                                        <span class="lumia-toggle-text">Filter Details Blocks</span>\n                                        <span class="lumia-toggle-hint">Removes &lt;details&gt; blocks from older messages to save context</span>\n                                    </label>\n                                    <div class="lumia-toggle-switch-wrapper">\n                                        <input type="checkbox" id="lumia-filter-details-toggle" class="lumia-toggle-input" ').concat(c.enabled?"checked":"",' />\n                                        <label for="lumia-filter-details-toggle" class="lumia-toggle-switch-label">\n                                            <div class="lumia-toggle-track">\n                                                <div class="lumia-toggle-thumb"></div>\n                                            </div>\n                                        </label>\n                                    </div>\n                                </div>\n                                <div class="lumia-filter-options ').concat(c.enabled?"":"lumia-filter-options-hidden",'">\n                                    <label class="lumia-input-label">\n                                        <span>Keep in last N messages:</span>\n                                        <input type="number" id="lumia-filter-details-depth" class="lumia-input-number" value="').concat(c.keepDepth||3,'" min="0" max="100" />\n                                    </label>\n                                    <span class="lumia-input-hint">Messages beyond this depth will have &lt;details&gt; blocks removed</span>\n                                </div>\n                            </div>\n\n                            \x3c!-- Loom Items Filter --\x3e\n                            <div class="lumia-filter-item">\n                                <div class="lumia-toggle-row">\n                                    <label class="lumia-toggle-label" for="lumia-filter-loom-toggle">\n                                        <span class="lumia-toggle-text">Filter Loom Tags</span>\n                                        <span class="lumia-toggle-hint">Removes Lucid Loom-related tags from older messages</span>\n                                    </label>\n                                    <div class="lumia-toggle-switch-wrapper">\n                                        <input type="checkbox" id="lumia-filter-loom-toggle" class="lumia-toggle-input" ').concat(u.enabled?"checked":"",' />\n                                        <label for="lumia-filter-loom-toggle" class="lumia-toggle-switch-label">\n                                            <div class="lumia-toggle-track">\n                                                <div class="lumia-toggle-thumb"></div>\n                                            </div>\n                                        </label>\n                                    </div>\n                                </div>\n                                <div class="lumia-filter-options ').concat(u.enabled?"":"lumia-filter-options-hidden",'">\n                                    <label class="lumia-input-label">\n                                        <span>Keep in last N messages:</span>\n                                        <input type="number" id="lumia-filter-loom-depth" class="lumia-input-number" value="').concat(u.keepDepth||5,'" min="0" max="100" />\n                                    </label>\n                                    <span class="lumia-input-hint">Loom tags in older messages will be stripped to save tokens</span>\n                                </div>\n                            </div>\n\n                        </div>\n                    </div>\n                </div>\n\n            </div>\n            <div class="lumia-modal-footer">\n                <button class="lumia-modal-btn lumia-modal-btn-secondary lumia-prompt-settings-cancel-btn">Cancel</button>\n                <button class="lumia-modal-btn lumia-modal-btn-primary lumia-prompt-settings-save-btn">Save Changes</button>\n            </div>\n        </dialog>\n    ');$("body").append(d);const m=$("#lumia-prompt-settings-modal");y(m);const p=()=>{m[0]._resizeCleanup&&m[0]._resizeCleanup(),m[0].close(),m.remove()};function h(){const e=m.find("#lumia-filter-html-toggle").is(":checked"),n=m.find("#lumia-filter-details-toggle").is(":checked"),t=m.find("#lumia-filter-loom-toggle").is(":checked"),i=m.find(".lumia-modal-panel").eq(1).find(".lumia-panel-status");e||n||t?i.addClass("lumia-panel-status-active").text("Active"):i.removeClass("lumia-panel-status-active").text("Inactive")}m.on("click mousedown mouseup",function(e){e.stopPropagation(),"click"===e.type&&e.target===this&&p()}),m.find(".lumia-collapsible-trigger").click(function(e){$(e.target).closest("input, label, .lumia-toggle-switch-wrapper").length>0||$(this).closest(".lumia-collapsible").toggleClass("collapsed")}),m.find("#lumia-sovereign-hand-toggle").change(function(){const e=$(this).is(":checked"),n=m.find(".lumia-info-box-sovereign"),t=$(this).closest(".lumia-collapsible").find(".lumia-panel-status"),i=m.find("#lumia-sovereign-exclude-toggle"),r=i.closest(".lumia-toggle-row"),a=m.find("#lumia-sovereign-include-prompt-toggle"),o=a.closest(".lumia-toggle-row");e?(n.removeClass("lumia-info-box-muted"),t.addClass("lumia-panel-status-active").text("Active"),i.prop("disabled",!1),r.removeClass("lumia-toggle-disabled"),a.prop("disabled",!1),o.removeClass("lumia-toggle-disabled")):(n.addClass("lumia-info-box-muted"),t.removeClass("lumia-panel-status-active").text("Inactive"),i.prop("disabled",!0),r.addClass("lumia-toggle-disabled"),a.prop("disabled",!0),o.addClass("lumia-toggle-disabled"))}),m.find("#lumia-filter-details-toggle").change(function(){const e=$(this).closest(".lumia-filter-item").find(".lumia-filter-options");$(this).is(":checked")?e.removeClass("lumia-filter-options-hidden"):e.addClass("lumia-filter-options-hidden"),h()}),m.find("#lumia-filter-loom-toggle").change(function(){const e=$(this).closest(".lumia-filter-item").find(".lumia-filter-options");$(this).is(":checked")?e.removeClass("lumia-filter-options-hidden"):e.addClass("lumia-filter-options-hidden"),h()}),m.find("#lumia-filter-html-toggle").change(function(){const e=$(this).closest(".lumia-filter-item").find("> .lumia-filter-options");$(this).is(":checked")?e.removeClass("lumia-filter-options-hidden"):e.addClass("lumia-filter-options-hidden"),h()}),m.find("#lumia-filter-fonts-toggle").change(function(){const e=$(this).closest(".lumia-filter-sub-item").find(".lumia-filter-sub-options");$(this).is(":checked")?e.removeClass("lumia-filter-options-hidden"):e.addClass("lumia-filter-options-hidden")}),m.find(".lumia-prompt-settings-save-btn").click(()=>{const n=m.find("#lumia-sovereign-hand-toggle").is(":checked"),t=m.find("#lumia-sovereign-exclude-toggle").is(":checked"),i=m.find("#lumia-sovereign-include-prompt-toggle").is(":checked");e.sovereignHand||(e.sovereignHand={}),e.sovereignHand.enabled=n,e.sovereignHand.excludeLastMessage=t,e.sovereignHand.includeMessageInPrompt=i,e.contextFilters||(e.contextFilters={}),e.contextFilters.htmlTags={enabled:m.find("#lumia-filter-html-toggle").is(":checked"),stripFonts:m.find("#lumia-filter-fonts-toggle").is(":checked"),fontKeepDepth:parseInt(m.find("#lumia-filter-fonts-depth").val())||3},e.contextFilters.detailsBlocks={enabled:m.find("#lumia-filter-details-toggle").is(":checked"),keepDepth:parseInt(m.find("#lumia-filter-details-depth").val())||3},e.contextFilters.loomItems={enabled:m.find("#lumia-filter-loom-toggle").is(":checked"),keepDepth:parseInt(m.find("#lumia-filter-loom-depth").val())||5},(0,r.DZ)(),(0,l.TC)(),toastr.success("Prompt settings saved!"),p()}),m.find(".lumia-prompt-settings-cancel-btn").click(p),m.on("keydown",function(e){"Escape"===e.key&&p()}),m[0].showModal()}async function N(){(0,r.mt)();$("#lucid-cards-modal").remove();$("body").append('\n        <dialog id="lucid-cards-modal" class="popup popup--animation-fast lumia-modal lumia-modal-lucid-cards">\n            <div class="lumia-modal-header">\n                <div class="lumia-modal-header-icon">\n                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                        <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>\n                        <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>\n                        <line x1="12" y1="22.08" x2="12" y2="12"></line>\n                    </svg>\n                </div>\n                <div class="lumia-modal-header-text">\n                    <h3 class="lumia-modal-title">Lucid Cards Browser</h3>\n                    <p class="lumia-modal-subtitle">Browse and import official Lumiverse content</p>\n                </div>\n            </div>\n            <div class="lucid-cards-tabs">\n                <button class="lucid-cards-tab active" data-category="Lumia DLCs">\n                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>\n                        <circle cx="12" cy="7" r="4"></circle>\n                    </svg>\n                    <span>Lumia DLCs</span>\n                </button>\n                <button class="lucid-cards-tab" data-category="Loom Utilities">\n                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                        <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path>\n                    </svg>\n                    <span>Utilities</span>\n                </button>\n                <button class="lucid-cards-tab" data-category="Loom Retrofits">\n                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                        <circle cx="12" cy="12" r="3"></circle>\n                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"></path>\n                    </svg>\n                    <span>Retrofits</span>\n                </button>\n                <button class="lucid-cards-tab" data-category="Loom Narratives">\n                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                        <path d="M12 19l7-7 3 3-7 7-3-3z"></path>\n                        <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"></path>\n                        <path d="M2 2l7.586 7.586"></path>\n                        <circle cx="11" cy="11" r="2"></circle>\n                    </svg>\n                    <span>Narratives</span>\n                </button>\n            </div>\n            <div class="lumia-modal-content">\n                <div class="lucid-cards-loading">\n                    <div class="lucid-cards-spinner"></div>\n                    <span>Loading content from Lucid.cards...</span>\n                </div>\n                <div class="lucid-cards-error" style="display: none;">\n                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                        <circle cx="12" cy="12" r="10"></circle>\n                        <line x1="15" y1="9" x2="9" y2="15"></line>\n                        <line x1="9" y1="9" x2="15" y2="15"></line>\n                    </svg>\n                    <span class="lucid-cards-error-message">Failed to load content</span>\n                    <button class="lumia-modal-btn lumia-modal-btn-secondary lucid-cards-retry-btn">Retry</button>\n                </div>\n                <div class="lucid-cards-content" style="display: none;"></div>\n            </div>\n            <div class="lumia-modal-footer lucid-cards-footer">\n                <button class="lumia-modal-btn lumia-modal-btn-secondary lucid-cards-close-btn">Close</button>\n                <div class="lucid-cards-selection-controls" style="display: none;">\n                    <button class="lumia-modal-btn lumia-modal-btn-text lucid-cards-select-all-btn">Select All</button>\n                    <button class="lumia-modal-btn lumia-modal-btn-text lucid-cards-clear-btn">Clear</button>\n                </div>\n                <div class="lucid-cards-selected-count" style="display: none;">\n                    <span class="lucid-cards-count-text">0 selected</span>\n                </div>\n                <button class="lumia-modal-btn lumia-modal-btn-primary lucid-cards-import-btn" style="display: none;">\n                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>\n                        <polyline points="7 10 12 15 17 10"></polyline>\n                        <line x1="12" y1="15" x2="12" y2="3"></line>\n                    </svg>\n                    <span class="lucid-cards-import-text">Import Packs</span>\n                </button>\n            </div>\n        </dialog>\n    ');const e=$("#lucid-cards-modal");let n="Lumia DLCs",i=[],o=null;const s=()=>{const n=i.length;0===n?(e.find(".lucid-cards-selection-controls").hide(),e.find(".lucid-cards-selected-count").hide(),e.find(".lucid-cards-import-btn").hide()):(e.find(".lucid-cards-selection-controls").show(),e.find(".lucid-cards-selected-count").show(),e.find(".lucid-cards-count-text").text("".concat(n," selected")),e.find(".lucid-cards-import-text").text(1===n?"Import Pack":"Import ".concat(n," Packs")),e.find(".lucid-cards-import-btn").show()),requestAnimationFrame(()=>c())},c=()=>{const n=e[0],t=(window.innerHeight||document.documentElement.clientHeight)-((window.innerWidth||document.documentElement.clientWidth)<=600?24:48);n.style.maxHeight="".concat(t,"px");const i=e.find(".lumia-modal-header"),r=e.find(".lucid-cards-tabs"),a=e.find(".lumia-modal-footer"),o=e.find(".lumia-modal-content");requestAnimationFrame(()=>{const e=i.length?i[0].offsetHeight:0,n=r.length?r[0].offsetHeight:0,s=a.length?a[0].offsetHeight:0,l=t-e-n-s;o.length&&(o[0].style.maxHeight="".concat(l,"px"),o[0].style.overflowY="auto")})};c();const u=()=>c();window.addEventListener("resize",u),e[0]._resizeCleanup=()=>window.removeEventListener("resize",u);const d=()=>{e[0]._resizeCleanup&&e[0]._resizeCleanup(),e[0].close(),e.remove(),p()};e.on("click mousedown mouseup",function(e){e.stopPropagation(),"click"===e.type&&e.target===this&&d()}),e.on("keydown",function(e){"Escape"===e.key&&d()});const m=async()=>{e.find(".lucid-cards-loading").show(),e.find(".lucid-cards-error").hide(),e.find(".lucid-cards-content").hide(),i=[],s();try{const e=await fetch("https://lucid.cards/api/lumia-dlc");if(!e.ok)throw new Error("HTTP error: ".concat(e.status));o=await e.json(),h()}catch(n){console.error("[".concat(r.pW,"] Failed to fetch Lucid.cards:"),n),e.find(".lucid-cards-loading").hide(),e.find(".lucid-cards-error-message").text("Failed to load: ".concat(n.message)),e.find(".lucid-cards-error").show()}},h=()=>{var t;const r=(null===(t=o)||void 0===t?void 0:t.packs)||[];if(!o||0===r.length)return e.find(".lucid-cards-loading").hide(),e.find(".lucid-cards-error-message").text("No content available"),void e.find(".lucid-cards-error").show();e.find(".lucid-cards-loading").hide(),e.find(".lucid-cards-error").hide();const l=e.find(".lucid-cards-content");let c;if(l.empty(),c="Lumia DLCs"===n?r.filter(e=>"lumia"===e.packType||e.lumiaCount&&e.lumiaCount>0):r.filter(e=>"loom"===e.packType||e.loomCount&&e.loomCount>0),0===c.length)return l.html('<div class="lucid-cards-empty">No items available in this category.</div>'),void l.show();const u=c.map(e=>{const n=e.packName||"Unknown",t=(0,a.ZD)(n),i=e.slug?"/api/lumia-dlc/".concat(e.slug):"",r=(0,a.ZD)(i),o=e.coverUrl||null,s=e.packAuthor||null,l=[];e.lumiaCount>0&&l.push("".concat(e.lumiaCount," Lumia")),e.loomCount>0&&l.push("".concat(e.loomCount," Loom")),e.extrasCount>0&&l.push("".concat(e.extrasCount," Extra"));const c=l.length>0?l.join(", "):"",u=o?'<img src="'.concat((0,a.ZD)(o),'" alt="" loading="lazy" class="lumia-img-loaded">'):'<div class="lucid-dlc-card-placeholder">\n                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">\n                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>\n                    <circle cx="8.5" cy="8.5" r="1.5"></circle>\n                    <polyline points="21 15 16 10 5 21"></polyline>\n                </svg>\n            </div>',d=s?(0,a.ZD)(s):"Unknown Author";return'\n                  <div class="lucid-dlc-card" data-path="'.concat(r,'" data-name="').concat(t,'"\n                       data-cover-img="').concat((0,a.ZD)(o||""),'" data-author="').concat((0,a.ZD)(s||""),'">\n                      <div class="lucid-dlc-card-image">\n                          ').concat(u,'\n                          <div class="lucid-dlc-card-check">\n                              ').concat(v,'\n                          </div>\n                      </div>\n                      <div class="lucid-dlc-card-info">\n                          <div class="lucid-dlc-card-title">').concat(t,'</div>\n                          <div class="lucid-dlc-card-author">').concat(d,"</div>\n                          ").concat(c?'<div class="lucid-dlc-card-counts">'.concat((0,a.ZD)(c),"</div>"):"","\n                      </div>\n                  </div>\n              ")}).join("");l.html('<div class="lucid-dlc-grid">'.concat(u,"</div>")),l.show(),i=[],e.find(".lucid-dlc-card").removeClass("selected"),s()};e.find(".lucid-cards-tab").click(function(){e.find(".lucid-cards-tab").removeClass("active"),$(this).addClass("active"),n=$(this).data("category"),i=[],e.find(".lucid-dlc-card").removeClass("selected"),s(),h()}),e.on("click",".lucid-dlc-card",function(){const e=$(this),n=e.data("path"),t=e.data("name"),r=e.data("author")||"Unknown Author",a=i.findIndex(e=>e.path===n);a>=0?(i.splice(a,1),e.removeClass("selected")):(i.push({path:n,name:t,author:r}),e.addClass("selected")),s()}),e.find(".lucid-cards-select-all-btn").click(function(){const n=e.find(".lucid-dlc-card");i=[],n.each(function(){const e=$(this);e.addClass("selected"),i.push({path:e.data("path"),name:e.data("name"),author:e.data("author")||"Unknown Author"})}),s()}),e.find(".lucid-cards-clear-btn").click(function(){i=[],e.find(".lucid-dlc-card").removeClass("selected"),s()}),e.find(".lucid-cards-close-btn").click(d),e.find(".lucid-cards-retry-btn").click(m),e.find(".lucid-cards-import-btn").click(async function(){if(0===i.length)return;const n=$(this),o=n.html(),c=i.length;let u=0,d=0,m=0;const p=(0,r.mt)(),{importPack:h}=await Promise.resolve().then(t.bind(t,154));n.prop("disabled",!0);for(let t=0;t<i.length;t++){const o=i[t];if(n.html('\n        <svg class="lucid-cards-btn-spinner" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n          <circle cx="12" cy="12" r="10"></circle>\n        </svg>\n        Importing '.concat(t+1," of ").concat(c,"...\n      ")),p.packs[o.name]){d++;const n=(0,a.ZD)(o.path);e.find('.lucid-dlc-card[data-path="'.concat(n,'"]')).addClass("already-imported");continue}try{const n=await fetch("https://lucid.cards".concat(o.path));if(!n.ok)throw new Error("HTTP error: ".concat(n.status));const t=await n.json();if(!1===t.success)throw new Error(t.error||"Failed to fetch pack");h(t.pack||t,o.name,!0),u++;const i=(0,a.ZD)(o.path);e.find('.lucid-dlc-card[data-path="'.concat(i,'"]')).addClass("imported")}catch(e){console.error("[".concat(r.pW,'] Import failed for "').concat(o.name,'":'),e),m++}}(0,l.TC)();const v=[];u>0&&v.push("".concat(u," imported")),d>0&&v.push("".concat(d," skipped (already exist)")),m>0&&v.push("".concat(m," failed")),u>0?toastr.success("Import complete: ".concat(v.join(", "))):d>0&&0===m?toastr.info("All ".concat(d," packs already exist")):toastr.error("Import failed: ".concat(v.join(", "))),i=[],e.find(".lucid-dlc-card").removeClass("selected"),s(),n.prop("disabled",!1).html(o)}),e[0].showModal(),m()}function P(){const e=(0,r.mt)(),n=document.getElementById("lumia-book-status"),t=Object.values(e.packs);if(t.length>0){if(n){const e=t.reduce((e,n)=>{var t,i,r;const a=(null===(t=n.lumiaItems)||void 0===t?void 0:t.length)||0,o=(null===(i=n.loomItems)||void 0===i?void 0:i.length)||0,s=(null===(r=n.items)||void 0===r?void 0:r.length)||0;return e+(a+o>0?a+o:s)},0);n.textContent="Loaded ".concat(t.length," packs (").concat(e," items total)")}const r=document.getElementById("lumia-current-definition");var i;if(r)if(e.chimeraMode&&(null===(i=e.selectedDefinitions)||void 0===i?void 0:i.length)>0){const n=e.selectedDefinitions.map(e=>{const n=(0,a.Br)(e.packName,e.itemName);return n?n.lumiaDefName:null}).filter(e=>e);r.textContent=n.length>0?"[Chimera] ".concat(n.join(" + ")):"No Chimera definitions selected"}else{const n=e.selectedDefinition;if(n){const e=(0,a.Br)(n.packName,n.itemName);r.textContent=e?"".concat(e.lumiaDefName," (").concat(n.packName,")"):"Item not found (Maybe pack removed?)"}else r.textContent="No definition selected"}const o=document.getElementById("lumia-current-behaviors");if(o){const n=e.selectedBehaviors.map(n=>{const t=(0,a.Br)(n.packName,n.itemName);if(!t)return null;const i=t.lumiaDefName;return e.dominantBehavior&&e.dominantBehavior.packName===n.packName&&e.dominantBehavior.itemName===n.itemName?"★ ".concat(i):i}).filter(e=>e);o.textContent=n.length>0?n.join(", "):"No behaviors selected"}const s=document.getElementById("lumia-current-personalities");if(s){const n=e.selectedPersonalities.map(n=>{const t=(0,a.Br)(n.packName,n.itemName);if(!t)return null;const i=t.lumiaDefName;return e.dominantPersonality&&e.dominantPersonality.packName===n.packName&&e.dominantPersonality.itemName===n.itemName?"★ ".concat(i):i}).filter(e=>e);s.textContent=n.length>0?n.join(", "):"No personalities selected"}const l=document.getElementById("loom-current-style");if(l){const n=(Array.isArray(e.selectedLoomStyle)?e.selectedLoomStyle:[]).map(e=>{const n=(0,a.Br)(e.packName,e.itemName);return n?n.loomName:null}).filter(e=>e);l.textContent=n.length>0?n.join(", "):"No styles selected"}const c=document.getElementById("loom-current-utils");if(c){const n=e.selectedLoomUtils.map(e=>{const n=(0,a.Br)(e.packName,e.itemName);return n?n.loomName:null}).filter(e=>e);c.textContent=n.length>0?n.join(", "):"No utilities selected"}const u=document.getElementById("loom-current-retrofits");if(u){const n=e.selectedLoomRetrofits.map(e=>{const n=(0,a.Br)(e.packName,e.itemName);return n?n.loomName:null}).filter(e=>e);u.textContent=n.length>0?n.join(", "):"No retrofits selected"}}else n&&(n.textContent="No Packs loaded"),["lumia-current-definition","lumia-current-behaviors","lumia-current-personalities","loom-current-style","loom-current-utils","loom-current-retrofits"].forEach(e=>{const n=document.getElementById(e);n&&(n.textContent="No selection possible (Load packs first)")})}function E(){var e;const n=document.getElementById("lumia-loom-summary-btn");if(!n)return;const t=(0,i.SD)(),a=null==t||null===(e=t.chatMetadata)||void 0===e?void 0:e[r.zA],s=(null==t?void 0:t.chat)&&t.chat.length>0,l=(0,o.dj)();n.classList.remove("lumia-loom-summary-btn-hidden","lumia-loom-summary-btn-empty","lumia-loom-summary-btn-active","lumia-loom-summary-btn-summarizing"),l?(n.classList.add("lumia-loom-summary-btn-summarizing"),n.title="Generating summary..."):s?a?(n.classList.add("lumia-loom-summary-btn-active"),n.title="View/Edit Loom Summary"):(n.classList.add("lumia-loom-summary-btn-empty"),n.title="No Loom Summary (click to create)"):(n.classList.add("lumia-loom-summary-btn-hidden"),n.title="No active chat")}},961(e,n,t){!function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(e){console.error(e)}}(),e.exports=t(551)},982(e,n,t){e.exports=t(463)}},n={};function t(i){var r=n[i];if(void 0!==r)return r.exports;var a=n[i]={id:i,exports:{}};return e[i](a,a.exports,t),a.exports}t.m=e,t.n=e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},t.d=(e,n)=>{for(var i in n)t.o(n,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:n[i]})},t.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),t.b="undefined"!=typeof document&&document.baseURI||self.location.href,t.nc=void 0;var i=t(92);const r={createElement(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const t=document.createElement(e),{attrs:i={},text:r,html:a,children:o=[],style:s={},data:l={}}=n;return Object.entries(i).forEach(e=>{let[n,i]=e;null!=i&&t.setAttribute(n,i)}),Object.entries(s).forEach(e=>{let[n,i]=e;t.style[n]=i}),Object.entries(l).forEach(e=>{let[n,i]=e;t.dataset[n]=i}),void 0!==r?t.textContent=r:void 0!==a&&(t.innerHTML=a),o.forEach(e=>{e instanceof HTMLElement&&t.appendChild(e)}),t},query(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:document).querySelector(e)},queryAll(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;return Array.from(n.querySelectorAll(e))},on(e,n,t,i){const r="string"==typeof e?this.query(e):e;if(!r)return console.warn("DOMUtils.on: Target element not found"),()=>{};if("string"==typeof t){const e=t,a=i,o=n=>{const t=n.target.closest(e);t&&r.contains(t)&&a.call(t,n)};return r.addEventListener(n,o),()=>r.removeEventListener(n,o)}const a=t;return r.addEventListener(n,a),()=>r.removeEventListener(n,a)},once(e,n,t){const i="string"==typeof e?this.query(e):e;if(!i)return console.warn("DOMUtils.once: Target element not found"),()=>{};const r=e=>{t(e),i.removeEventListener(n,r)};return i.addEventListener(n,r),()=>i.removeEventListener(n,r)},debounce(e,n){let t,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return function(){for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];const s=this,l=i&&!t;clearTimeout(t),t=setTimeout(()=>{t=null,i||e.apply(s,a)},n),l&&e.apply(s,a)}},throttle(e,n){let t;return function(){const i=this;if(!t){for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];e.apply(i,a),t=!0,setTimeout(()=>t=!1,n)}}},addClass(e){const n="string"==typeof e?this.query(e):e;if(n){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];n.classList.add(...i)}return n},removeClass(e){const n="string"==typeof e?this.query(e):e;if(n){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];n.classList.remove(...i)}return n},toggleClass(e,n,t){const i="string"==typeof e?this.query(e):e;return!!i&&i.classList.toggle(n,t)},hasClass(e,n){const t="string"==typeof e?this.query(e):e;return!!t&&t.classList.contains(n)},scrollTo(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{target:n,top:t,left:i,behavior:r="smooth",offset:a=0,container:o=window}=e;if(n){const e="string"==typeof n?this.query(n):n;if(e){const n=e.getBoundingClientRect(),t=o===window?window.pageYOffset:o.scrollTop;o.scrollTo({top:t+n.top+a,behavior:r})}}else o.scrollTo({top:void 0!==t?t:o.scrollY,left:void 0!==i?i:o.scrollX,behavior:r})},isVisible(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const t="string"==typeof e?this.query(e):e;if(!t)return Promise.resolve(!1);const{threshold:i=0,rootMargin:r="0px"}=n;if(!("IntersectionObserver"in window)){const e=t.getBoundingClientRect();return Promise.resolve(e.top>=0&&e.left>=0&&e.bottom<=window.innerHeight&&e.right<=window.innerWidth)}return new Promise(e=>{const n=new IntersectionObserver(t=>{e(t[0].isIntersecting),n.disconnect()},{threshold:i,rootMargin:r});n.observe(t)})},observeVisibility(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i="string"==typeof e?this.query(e):e;if(!i||!("IntersectionObserver"in window))return{disconnect:()=>{}};const{threshold:r=0,rootMargin:a="0px"}=t,o=new IntersectionObserver(e=>{e.forEach(e=>n(e.isIntersecting))},{threshold:r,rootMargin:a});return o.observe(i),o},getRect(e){const n="string"==typeof e?this.query(e):e;return n?n.getBoundingClientRect():null},getOffset(e){const n="string"==typeof e?this.query(e):e;if(!n)return null;const t=n.getBoundingClientRect();return{top:t.top+window.pageYOffset,left:t.left+window.pageXOffset}},setStyle(e,n){const t="string"==typeof e?this.query(e):e;return t&&Object.entries(n).forEach(e=>{let[n,i]=e;t.style[n]=i}),t},getStyle(e,n){const t="string"==typeof e?this.query(e):e;return t?window.getComputedStyle(t)[n]:""},show(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"block";const t="string"==typeof e?this.query(e):e;return t&&(t.style.display=n),t},hide(e){const n="string"==typeof e?this.query(e):e;return n&&(n.style.display="none"),n},toggle(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"block";const t="string"==typeof e?this.query(e):e;if(!t)return!1;const i="none"===window.getComputedStyle(t).display;return t.style.display=i?n:"none",i},remove(e){const n="string"==typeof e?this.query(e):e;return n&&n.parentNode&&n.parentNode.removeChild(n),n},empty(e){const n="string"==typeof e?this.query(e):e;if(n)for(;n.firstChild;)n.removeChild(n.firstChild);return n},attr(e,n,t){const i="string"==typeof e?this.query(e):e;return i?"string"==typeof n&&void 0===t?i.getAttribute(n):"string"==typeof n?(i.setAttribute(n,t),i):"object"==typeof n?(Object.entries(n).forEach(e=>{let[n,t]=e;i.setAttribute(n,t)}),i):null:null},removeAttr(e,n){const t="string"==typeof e?this.query(e):e;return t&&t.removeAttribute(n),t},ready(e){"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e()},createQueryCache(){const e=new Map;return{get(n){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;const i="".concat(n,":").concat(t);if(!e.has(i)){const r=t.querySelector(n);r&&e.set(i,r)}return e.get(i)||null},clear(){e.clear()}}},getDistanceToViewport(e){const n="string"==typeof e?this.query(e):e;if(!n)return null;const t=n.getBoundingClientRect(),i=window.innerWidth||document.documentElement.clientWidth,r=window.innerHeight||document.documentElement.clientHeight;return{top:t.top,right:i-t.right,bottom:r-t.bottom,left:t.left}},getDistanceBetween(e,n){const t="string"==typeof e?this.query(e):e,i="string"==typeof n?this.query(n):n;if(!t||!i)return null;const r=t.getBoundingClientRect(),a=i.getBoundingClientRect();let o,s;return o=r.right<a.left?a.left-r.right:a.right<r.left?r.left-a.right:0,s=r.bottom<a.top?a.top-r.bottom:a.bottom<r.top?r.top-a.bottom:0,{horizontal:o,vertical:s,diagonal:Math.sqrt(o*o+s*s)}},logElementMeasurements(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Element";const t="string"==typeof e?r.query(e):e;if(!t)return console.warn("DOMUtils.logElementMeasurements: Element not found"),null;const i=t.getBoundingClientRect(),a=window.getComputedStyle(t),o=r.getDistanceToViewport(t),s={selector:"string"==typeof e?e:t.tagName,dimensions:{width:i.width,height:i.height,computedWidth:a.width,computedHeight:a.height},position:{top:i.top,right:i.right,bottom:i.bottom,left:i.left,x:i.x,y:i.y},distanceToViewport:o,viewport:{width:window.innerWidth,height:window.innerHeight},padding:{top:a.paddingTop,right:a.paddingRight,bottom:a.paddingBottom,left:a.paddingLeft},margin:{top:a.marginTop,right:a.marginRight,bottom:a.marginBottom,left:a.marginLeft}};return console.group("📏 ".concat(n," Measurements")),console.log("Element:",t),console.log("Dimensions:",s.dimensions),console.log("Position:",s.position),console.log("Distance to Viewport Edges:",s.distanceToViewport),console.log("Viewport Size:",s.viewport),console.log("Padding:",s.padding),console.log("Margin:",s.margin),console.groupEnd(),s}},{createElement:a,query:o,queryAll:s,on:l,once:c,debounce:u,throttle:d,addClass:m,removeClass:p,toggleClass:h,hasClass:v,scrollTo:f,isVisible:g,observeVisibility:b,getRect:x,getOffset:y,setStyle:k,getStyle:w,show:j,hide:S,toggle:C,remove:N,empty:P,attr:E,removeAttr:M,ready:L,createQueryCache:O,getDistanceToViewport:T,getDistanceBetween:D,logElementMeasurements:z}=r;var I=t(674),A=t(154),R=t(932),B=t(485),_=t(389),U=t(100);const F=new Map;let V=null,W=null,H=!1,q=!0,Y=!1,K=!1;let G=0,Q=null,X=null;function Z(){if(q)return q=!1,void(null===V&&(V=requestAnimationFrame(J)));H?(null!==W&&clearTimeout(W),W=setTimeout(()=>{W=null;const e=performance.now()-G;if(e<50){setTimeout(()=>{null===V&&(V=requestAnimationFrame(J))},50-e)}else null===V&&(V=requestAnimationFrame(J))},100)):null===V&&(V=requestAnimationFrame(J))}function J(){V=null,G=performance.now();const e=F.size>0,n=Y;if(!e&&!n)return;const t=window.scrollY,i=n?"full":F.size;console.log("[".concat(I.pW,"] RAF: Flushing ").concat(i," update(s)"));const r=performance.now();try{if(n)X&&X(K),Y=!1,K=!1;else{const e=new Map(F);F.clear();for(const[,n]of e)Q&&Q(n.mesId,n.force)}}catch(e){console.error("[".concat(I.pW,"] RAF: Error during flush:"),e)}window.scrollTo(window.scrollX,t);const a=performance.now()-r;console.log("[".concat(I.pW,"] RAF: Flush completed in ").concat(a.toFixed(2),"ms"))}function ee(){null!==W&&(clearTimeout(W),W=null),null!==V&&(cancelAnimationFrame(V),V=null),J()}function ne(){F.clear(),Y=!1,K=!1,null!==W&&(clearTimeout(W),W=null),null!==V&&(cancelAnimationFrame(V),V=null),q=!0,console.log("[".concat(I.pW,"] RAF: State reset for fresh processing"))}const te="#9370db";let ie=null,re=null,ae=!1;function oe(e){ae=e,function(e){const n=H;H=e,e&&!n&&(q=!0,console.log("[".concat(I.pW,"] RAF: Streaming started, first render will be immediate"))),n&&!e&&(console.log("[".concat(I.pW,"] RAF: Streaming ended, flushing pending updates")),ee())}(e)}function se(e){if(!e)return"";let n=e.replace(/<\/?lumi[ao]_?ooc(?:\s+[^>]*)?>/gi,"");return n=n.replace(/<\/?lumi[ao]_[a-z_]+(?:\s+[^>]*)?>/gi,""),n=n.replace(/<\/?font(?:\s+[^>]*)?>/gi,""),n=n.replace(/<(p|div)>\s*<\/\1>/gi,""),n=n.replace(/<(p|div)(?:\s+[^>]*)?>/gi,""),n=n.replace(/<\/(p|div)>/gi,"<br>"),n=n.replace(/\s*<br\s*\/?>\s*/gi,"<br>"),n=n.replace(/(<br>){2,}/gi,"<br>"),n=n.replace(/(\n\s*){2,}/g,"\n"),n=n.replace(/^(\s|<br\s*\/?>)+/gi,""),n=n.replace(/(\s|<br\s*\/?>)+$/gi,""),n.trim()}function le(){const e=(0,I.mt)();if(e.selectedDefinition){const n=(0,A.Br)(e.selectedDefinition.packName,e.selectedDefinition.itemName),t=(null==n?void 0:n.avatarUrl)||(null==n?void 0:n.lumia_img);if(t)return t}return null}function ce(e){if(!e)return null;let n=e.trim();n=n.replace(/^lumi[ao]\s+/i,"");const t=n.toLowerCase();if((t.startsWith("lumia")||t.startsWith("lumio"))&&n.length>5){const e=n.substring(5);e[0]===e[0].toUpperCase()&&(n=e)}return n||null}function ue(e){return e?e.replace(/&quot;/g,'"').replace(/&#34;/g,'"').replace(/&apos;/g,"'").replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"):""}function de(e){if(!e)return null;let n=e.match(/name\s*=\s*"([^"]*)"/i);return n?ue(n[1]):(n=e.match(/name\s*=\s*'([^']*)'/i),n?ue(n[1]):(n=e.match(/name\s*=\s*&quot;([^&]*)&quot;/i),n?ue(n[1]):(n=e.match(/name\s*=\s*(\w+)/i),n?ue(n[1]):null)))}function me(e){if(!e)return"";let n=e;return n=n.replace(/\*\*\*(.+?)\*\*\*/g,"$1"),n=n.replace(/\*\*(.+?)\*\*/g,"$1"),n=n.replace(/\*(.+?)\*/g,"$1"),n=n.replace(/___(.+?)___/g,"$1"),n=n.replace(/__(.+?)__/g,"$1"),n=n.replace(/_(.+?)_/g,"$1"),n=n.replace(/^\*([^*]+)\*/g,"$1"),n=n.replace(/[""]/g,'"'),n=n.replace(/['']/g,"'"),n=n.replace(/…/g,"..."),n}const pe=new Map;function he(e){pe.delete(e)}function ve(){pe.clear()}function fe(e,n){const t=n.toLowerCase().trim();pe.has(e)||pe.set(e,new Set),pe.get(e).add(t)}function ge(e,n){if(!e||!n)return 0;const t=e.toLowerCase().trim(),i=n.toLowerCase().trim();if(t===i)return 100;const r=t.split(/\s+/).filter(e=>e.length>=2),a=i.split(/\s+/).filter(e=>e.length>=2);let o=0;for(const e of r)a.includes(e)&&o++;if(o>0){const e=o/r.length,n=o/a.length;return 50+Math.round((e+n)/2*40)}return 0}function be(e){var n,t;if(!e)return null;const i=ce(e);if(!i)return null;const r=(0,I.mt)();let a={score:0,avatar:null};const o=(e,n)=>{const t=(null==e?void 0:e.avatarUrl)||(null==e?void 0:e.lumia_img);if(!t)return;const r=ge(i,n);r>a.score&&(a={score:r,avatar:t})};if(r.councilMode&&null!==(n=r.councilMembers)&&void 0!==n&&n.length)for(const e of r.councilMembers){const n=(0,A.Br)(e.packName,e.itemName);if(!n)continue;if(o(n,n.lumiaName||n.lumiaDefName||e.itemName),o(n,e.itemName),100===a.score)return a.avatar}if(r.selectedDefinition){const e=(0,A.Br)(r.selectedDefinition.packName,r.selectedDefinition.itemName);if(e){if(o(e,e.lumiaName||e.lumiaDefName||r.selectedDefinition.itemName),o(e,r.selectedDefinition.itemName),100===a.score)return a.avatar}}if(r.chimeraMode&&null!==(t=r.selectedDefinitions)&&void 0!==t&&t.length)for(const e of r.selectedDefinitions){const n=(0,A.Br)(e.packName,e.itemName);if(!n)continue;if(o(n,n.lumiaName||n.lumiaDefName||e.itemName),o(n,e.itemName),100===a.score)return a.avatar}if(a.score>=50)return a.avatar;if(r.packs)for(const e of Object.values(r.packs))if(e.lumiaItems&&e.lumiaItems.length>0)for(const n of e.lumiaItems){if(o(n,n.lumiaName||n.lumiaDefName||""),100===a.score)return a.avatar}else if(e.items)for(const n of e.items){if(o(n,n.lumiaDefName||n.lumiaName||""),100===a.score)return a.avatar}return a.score>=50?a.avatar:null}function xe(e,n){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const i=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:0)%2==1;switch((0,I.mt)().lumiaOOCStyle||"social"){case"none":return function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const t=n||"Lumia",i=a("span",{attrs:{class:"lumia-ooc-raw","data-lumia-ooc":"true","data-lumia-speaker":t},html:e});return i}(e,t);case"margin":return function(e,n){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const r=i||"Lumia",o=(i||"Lumia").charAt(0).toUpperCase(),s=n?a("img",{attrs:{src:n,alt:o,class:"lumia-ooc-margin-tag-avatar"}}):a("span",{attrs:{class:"lumia-ooc-margin-tag-letter"},text:o}),l=a("div",{attrs:{class:"lumia-ooc-margin-tag"},children:[s]}),c=a("div",{attrs:{class:"lumia-ooc-margin-label"},text:r}),u=a("div",{attrs:{class:"lumia-ooc-margin-text"},html:e}),d=a("div",{attrs:{class:"lumia-ooc-margin-content-area"},children:[c,u]}),m=t?"lumia-ooc-margin lumia-ooc-alt":"lumia-ooc-margin";return a("div",{attrs:{class:m,"data-lumia-ooc":"true"},children:[l,d]})}(e,n,i,t);case"whisper":return function(e,n){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const r=i||"Lumia",o="".concat(r," whispers..."),s=(i||"Lumia").charAt(0).toUpperCase(),l=n?a("img",{attrs:{src:n,alt:r,class:"lumia-ooc-whisper-avatar"}}):a("div",{attrs:{class:"lumia-ooc-whisper-avatar-placeholder"},text:s}),c=a("div",{attrs:{class:"lumia-ooc-whisper-avatar-wrap"},children:[l]}),u=a("span",{attrs:{class:"lumia-ooc-whisper-name"},text:o}),d=a("div",{attrs:{class:"lumia-ooc-whisper-header"},children:[u]}),m=a("div",{attrs:{class:"lumia-ooc-whisper-text"},html:e}),p=a("div",{attrs:{class:"lumia-ooc-whisper-bubble"},children:[d,m]}),h=t?"lumia-ooc-whisper lumia-ooc-alt":"lumia-ooc-whisper";return a("div",{attrs:{class:h,"data-lumia-ooc":"true"},children:[c,p]})}(e,n,i,t);default:return function(e,n){var t;let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=(0,I.mt)(),o=r.councilMode&&(null===(t=r.councilMembers)||void 0===t?void 0:t.length)>0,s=i||"Lumia",l=o?"speaks from the Council":"weaving through the Loom",c=(i||"Lumia").charAt(0).toUpperCase(),u=n?a("img",{attrs:{src:n,alt:s,class:"lumia-ooc-avatar"}}):a("div",{attrs:{class:"lumia-ooc-avatar lumia-ooc-avatar-placeholder"},text:c}),d=a("div",{attrs:{class:"lumia-ooc-avatar-container"},children:[u]}),m=a("span",{attrs:{class:"lumia-ooc-name"},text:s}),p=a("span",{attrs:{class:"lumia-ooc-thread"},text:l}),h=a("div",{attrs:{class:"lumia-ooc-header-row"},children:[m,p]}),v=a("div",{attrs:{class:"lumia-ooc-content"},html:e}),f=a("div",{attrs:{class:"lumia-ooc-content-column"},children:[h,v]});return a("div",{attrs:{class:"lumia-ooc-comment-box","data-lumia-ooc":"true"},children:[d,f]})}(e,n,t)}}function ye(e){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{var t;const r=o('div[mesid="'.concat(e,'"] .mes_text'));if(!r)return;n&&he(e);const a=(0,i.SD)(),l=null==a||null===(t=a.chat)||void 0===t?void 0:t[e],c=function(e){if(!e)return[];const n=[],t=/<(lumi[ao]_?ooc)([^>]*)>([\s\S]*?)<\/\1>/gi;let i;for(;null!==(i=t.exec(e));){const e=i[1],t=i[2],r=i[3],a=de(t),o=ce(a);console.log("[".concat(I.pW,"] Extracted OOC: tag=").concat(e,', attrs="').concat(t.trim(),'", name="').concat(a,'" → "').concat(o,'", content length=').concat(r.length)),n.push({name:o,content:r.trim(),fullMatch:i[0]})}return n}((null==l?void 0:l.mes)||(null==l?void 0:l.content)||""),u=s("[data-lumia-ooc]",r);if(u.length>0&&u.length>=c.length&&!n)return;let d=0;c.length>0&&(console.log("[".concat(I.pW,"] Found ").concat(c.length," <lumia_ooc> tag(s) in raw content for message ").concat(e)),c.forEach((n,t)=>{const i=function(e){if(!e)return"";const n=document.createElement("div");n.innerHTML=e;let t=n.textContent||n.innerText||"";return t=me(t),t=t.replace(/\s+/g," ").trim(),t}(n.content);if(!i)return void console.log("[".concat(I.pW,"] Skipping OOC #").concat(t+1,": empty after text extraction"));if(function(e,n){const t=n.toLowerCase().trim(),i=pe.get(e);return(null==i?void 0:i.has(t))||!1}(e,i))return void console.log("[".concat(I.pW,"] Skipping OOC #").concat(t+1,": already processed"));console.log("[".concat(I.pW,"] Processing OOC #").concat(t+1).concat(n.name?" (".concat(n.name,")"):"",': "').concat(i.substring(0,60),'..."'));const a=n.name&&be(n.name)||le(),o=function(e,n,t){if(!e||!n)return null;const i=n.replace(/\s+/g," ").trim();if(!i)return null;const r=i.substring(0,Math.min(40,i.length)).toLowerCase(),a=i.length>20?i.substring(i.length-20).toLowerCase():i.toLowerCase(),o=document.createTreeWalker(e,NodeFilter.SHOW_TEXT);let s,l=null,c=0,u=null,d=0,m="";const p=[];let h=null;for(;s=o.nextNode();){var v,f;if(null!==(v=s.parentElement)&&void 0!==v&&v.closest("[data-lumia-ooc]"))continue;const e=null===(f=s.parentElement)||void 0===f?void 0:f.closest("p, div, li, blockquote, h1, h2, h3, h4, h5, h6");h&&e&&e!==h&&m.length>0&&!/\s$/.test(m)&&(m+=" "),h=e,p.push({node:s,start:m.length,text:s.nodeValue||""}),m+=s.nodeValue||""}const g=m.replace(/\s+/g," ").replace(/…/g,"...").replace(/[""]/g,'"').replace(/['']/g,"'").toLowerCase(),b=g.indexOf(r);if(-1===b)return console.log("[".concat(I.pW,'] findAndWrapOOCContent: Could not find prefix "').concat(r.substring(0,30),'..." in DOM text')),null;const x=b+i.length;if(i.length>40&&!g.substring(Math.max(b,x-20),x).includes(a.substring(0,10)))return console.log("[".concat(I.pW,"] findAndWrapOOCContent: Suffix mismatch, skipping false positive")),null;let y=-1,k=-1;for(let e=0;e<m.length;e++){const n=m.substring(0,e+1).replace(/\s+/g," ").replace(/…/g,"...").replace(/[""]/g,'"').replace(/['']/g,"'");if(n.length>=b+1&&-1===y&&(y=e),n.length>=x){k=e+1;break}}-1===y&&(y=0),-1===k&&(k=m.length);for(const e of p){const n=e.start+e.text.length;if(!l&&e.start<=y&&n>y&&(l=e.node,c=y-e.start),e.start<k&&n>=k){u=e.node,d=k-e.start;break}}if(!l||!u)return console.log("[".concat(I.pW,"] findAndWrapOOCContent: Could not map match to text nodes")),null;try{const e=document.createRange();e.setStart(l,Math.min(c,l.length)),e.setEnd(u,Math.min(d,u.length));const n=e.cloneContents(),i=document.createElement("div");i.appendChild(n);const r=i.innerHTML||e.toString();return e.deleteContents(),console.log("[".concat(I.pW,"] findAndWrapOOCContent: Successfully isolated OOC content (").concat(r.length," chars)")),{range:e,innerHTML:se(r)||se(t),wrapperCreated:!0}}catch(e){return console.error("[".concat(I.pW,"] findAndWrapOOCContent: Range error:"),e),null}}(r,i,n.content);if(o&&o.wrapperCreated){const r=xe(o.innerHTML,a,d,n.name);return o.range.insertNode(r),function(e){if(!e)return;let n=e,t=n.parentElement;for(;t&&(null===(i=t.classList)||void 0===i||!i.contains("mes_text"));){var i,r,a;const e=t.parentElement;if("FONT"===t.tagName){var o;const i=null===(o=t.getAttribute("color"))||void 0===o?void 0:o.toLowerCase();if(i===te||"rgb(147, 112, 219)"===i){var s;Array.from(t.childNodes).forEach(e=>{var t;e!==n&&(e.nodeType===Node.ELEMENT_NODE&&"BR"===e.tagName?e.remove():e.nodeType!==Node.TEXT_NODE||null!==(t=e.textContent)&&void 0!==t&&t.trim()||e.remove())}),t.parentNode&&(t.parentNode.insertBefore(n,t),null!==(s=t.textContent)&&void 0!==s&&s.trim()||t.querySelector("[data-lumia-ooc]")||t.remove()),t=e;continue}}if(null!==(r=(a=t).matches)&&void 0!==r&&r.call(a,"p, div")){const i=Array.from(t.childNodes).filter(e=>{var t;return e===n||!!(e.nodeType!==Node.TEXT_NODE||null!==(t=e.textContent)&&void 0!==t&&t.trim())&&(e.nodeType!==Node.ELEMENT_NODE||"BR"!==e.tagName)});if(1===i.length&&i[0]===n){t.parentNode&&(t.parentNode.insertBefore(n,t),t.remove()),t=e;continue}}n=t,t=e}if(t=e.parentElement,t){var l,c;const n=n=>{var t,i;n&&n!==e&&n.nodeType===Node.ELEMENT_NODE&&("BR"===n.tagName?n.remove():null===(t=n.matches)||void 0===t||!t.call(n,"p, div, font")||null!==(i=n.textContent)&&void 0!==i&&i.trim()||n.querySelector("img, [data-lumia-ooc]")||n.remove())};n(e.previousElementSibling),n(e.nextElementSibling);const t=e.previousSibling,i=e.nextSibling;(null==t?void 0:t.nodeType)!==Node.TEXT_NODE||null!==(l=t.textContent)&&void 0!==l&&l.trim()||t.remove(),(null==i?void 0:i.nodeType)!==Node.TEXT_NODE||null!==(c=i.textContent)&&void 0!==c&&c.trim()||i.remove()}}(r),fe(e,i),d++,void console.log("[".concat(I.pW,"] Replaced OOC #").concat(t+1," with styled box (surgical Range method)"))}const l=function(e,n){if(!e||!n)return null;const t=n.replace(/\s+/g," ").trim().toLowerCase();if(!t)return null;const i=t.substring(0,Math.min(50,t.length)),r=s("p",e);for(let e=0;e<r.length;e++){const n=r[e];if(n.closest("[data-lumia-ooc]"))continue;const a=me((n.textContent||"").replace(/\s+/g," ").replace(/…/g,"...").replace(/[""]/g,'"').replace(/['']/g,"'").trim()).toLowerCase();if(!a.includes(i))continue;const o=t.length/a.length;if(!(o<.7))return console.log("[".concat(I.pW,"] findMatchingElement: Matched paragraph ").concat(e," (").concat(Math.round(100*o),"% OOC content)")),{element:n,innerHTML:n.innerHTML};console.log("[".concat(I.pW,"] findMatchingElement: Skipping paragraph ").concat(e," - OOC is only ").concat(Math.round(100*o),"% of content"))}return null}(r,i);if(!l)return void console.log("[".concat(I.pW,"] Could not find OOC #").concat(t+1," text in DOM (tried surgical and element methods)"));const c=se(l.innerHTML);if(!c)return;const u=xe(c,a,d,n.name);l.element.parentNode&&(l.element.parentNode.replaceChild(u,l.element),fe(e,i),d++,console.log("[".concat(I.pW,"] Replaced OOC #").concat(t+1," with styled box (element fallback method)")))})),d>0&&(r.offsetHeight,console.log("[".concat(I.pW,"] Finished processing ").concat(d," OOC comment(s) in message ").concat(e)))}catch(e){console.error("[".concat(I.pW,"] Error processing OOC comments:"),e)}}function ke(e){!function(e){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const t="ooc-".concat(e),i=F.get(t);F.set(t,{mesId:e,force:n||(null==i?void 0:i.force)||!1}),Z()}(e,arguments.length>1&&void 0!==arguments[1]&&arguments[1])}function we(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const n=(0,i.SD)();if(n&&n.chat){if(console.log("[".concat(I.pW,"] Processing all OOC comments in chat (").concat(n.chat.length," messages)").concat(e?" [clearing existing]":"")),e){ve();s("[data-lumia-ooc]").forEach(e=>{let n="";const t=e.querySelector(".lumia-ooc-margin-text"),i=e.querySelector(".lumia-ooc-whisper-text"),r=e.querySelector(".lumia-ooc-content");t?n=t.innerHTML:i?n=i.innerHTML:r&&(n=r.innerHTML);const a=document.createElement("font");a.setAttribute("color","#9370DB"),a.innerHTML=n,e.parentNode&&e.parentNode.replaceChild(a,e)})}for(let e=0;e<n.chat.length;e++){const n=o('div[mesid="'.concat(e,'"] .mes_text'));n&&(0,U.vL)(n),ye(e)}}}function je(){!function(){Y=!0,K=arguments.length>0&&void 0!==arguments[0]&&arguments[0]||K,F.clear(),Z()}(arguments.length>0&&void 0!==arguments[0]&&arguments[0])}function Se(){ie&&clearTimeout(ie),re&&clearTimeout(re),ve();function e(){const e=Date.now();!function n(){var t;const r=document.getElementById("chat"),a=(0,i.SD)(),l=(null==a||null===(t=a.chat)||void 0===t?void 0:t.length)||0,c=(r?s(".mes_text",r):[]).length;if(Date.now()-e>2e3)return console.log("[".concat(I.pW,"] Max wait time reached (context: ").concat(l,", DOM: ").concat(c,"), processing OOCs now")),void je();if(0===l)return void console.log("[".concat(I.pW,"] Empty chat detected, no OOC processing needed"));if(0===c)return void(re=setTimeout(n,50));if(c>=Math.max(1,Math.floor(.8*l))){var u;const e=o('div[mesid="'.concat(l-1,'"] .mes_text'));if(e&&null!==(u=e.textContent)&&void 0!==u&&u.trim())return console.log("[".concat(I.pW,"] DOM ready with ").concat(c,"/").concat(l," messages, scheduling OOC processing")),void je()}re=setTimeout(n,50)}()}ie=setTimeout(()=>{requestAnimationFrame(e)},100)}function Ce(){console.log("[".concat(I.pW,"] Initializing RAF batch renderer for OOC comments")),Q=ye,X=we}var Ne=t(199),Pe=t(200),Ee=t(540),Me=t(338),Le=t(848);const Oe=["ui"],Te=["ui"];function De(e,n){if(null==e)return{};var t,i,r=function(e,n){if(null==e)return{};var t={};for(var i in e)if({}.hasOwnProperty.call(e,i)){if(-1!==n.indexOf(i))continue;t[i]=e[i]}return t}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)t=a[i],-1===n.indexOf(t)&&{}.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}function ze(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,i)}return t}function Ie(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?ze(Object(t),!0).forEach(function(n){Ae(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ze(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Ae(e,n,t){return(n=Re(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function Re(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,n||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}let Be=null;const _e=function(e){let n=e;const t=new Set;return{getState:()=>n,setState:e=>{const i="function"==typeof e?e(n):e;i!==n&&(n=Ie(Ie({},n),i),t.forEach(e=>e()))},subscribe:e=>(t.add(e),()=>t.delete(e))}}({packs:{},selectedDefinition:null,selectedBehaviors:[],selectedPersonalities:[],dominantBehavior:null,dominantPersonality:null,selectedLoomStyle:[],selectedLoomUtils:[],selectedLoomRetrofits:[],presets:{},activePresetName:null,chimeraMode:!1,selectedDefinitions:[],councilMode:!1,councilMembers:[],oocEnabled:!0,lumiaOOCStyle:"social",lumiaOOCInterval:null,messageTruncation:{enabled:!1,keepCount:50},contextFilters:{},sovereignHand:{enabled:!1,excludeLastMessage:!0,includeMessageInPrompt:!0},summarization:{},showLumiverseDrawer:!0,lumiaButtonPosition:{useDefault:!0,xPercent:1,yPercent:1},chatChangeCounter:0,ui:{activeModal:null,isLoading:!1,error:null,viewingPack:null,viewingLoomPack:null}});function Ue(e,n,t){const i=n.split("."),r=Ie({},e);let a=r;for(let e=0;e<i.length-1;e++)a[i[e]]=Ie({},a[i[e]]),a=a[i[e]];return a[i[i.length-1]]=t,r}function Fe(e,n){if(!e)return null;if(e.lumiaItems&&e.lumiaItems.length>0){const t=e.lumiaItems.find(e=>e.lumiaName===n||e.lumiaDefName===n);if(t)return t}return e.items&&e.items.length>0?e.items.find(e=>e.lumiaDefName===n):null}function Ve(e,n){if(!e)return null;const t={name:["lumiaName","lumiaDefName"],def:["lumiaDefinition","lumiaDef"],personality:["lumiaPersonality","lumia_personality"],behavior:["lumiaBehavior","lumia_behavior"],img:["avatarUrl","lumia_img"],author:["authorName","defAuthor"],gender:["genderIdentity"]}[n];if(!t)return null;for(const n of t)if(void 0!==e[n]&&null!==e[n])return e[n];return null}function We(e,n){if(!e||!n)return null;if(e[n])return e[n];for(const[t,i]of Object.entries(e))if(i.name===n||i.packName===n)return i;return null}const He={updateSettings:(e,n)=>{const t=_e.getState();_e.setState({settings:Ue(t.settings,e,n)})},setSettings:e=>{_e.setState({settings:e})},setPacks:e=>{_e.setState({packs:e})},setCustomPacks:e=>{const n=Ie({},_e.getState().packs);e.forEach(e=>{const t=e.packName||e.name;n[t]=Ie(Ie({},e),{},{isCustom:!0})}),_e.setState({packs:n})},addCustomPack:e=>{const n=_e.getState(),t=n.packs&&"object"==typeof n.packs?Ie({},n.packs):{};t[e.packName||e.name]=Ie(Ie({},e),{},{isCustom:!0}),_e.setState({packs:t})},updateCustomPack:(e,n)=>{const t=_e.getState(),i=t.packs&&"object"==typeof t.packs?Ie({},t.packs):{};let r=null;for(const[n,t]of Object.entries(i))if(t.id===e||t.name===e||t.packName===e||n===e){r=n;break}if(r){const e=i[r],t=n.packName||n.name||e.packName||e.name,a=Ie(Ie(Ie({},e),n),{},{isCustom:!0});t!==r?(delete i[r],i[t]=a):i[r]=a,_e.setState({packs:i})}},removeCustomPack:e=>{const n=_e.getState(),t=n.packs&&"object"==typeof n.packs?Ie({},n.packs):{};for(const[n,i]of Object.entries(t))if(i.id===e||i.name===e||i.packName===e||n===e){delete t[n];break}_e.setState({packs:t})},removePack:e=>{const n=_e.getState(),t=n.packs&&"object"==typeof n.packs?Ie({},n.packs):{};if(t[e])delete t[e];else for(const[n,i]of Object.entries(t))if(i.name===e||i.packName===e){delete t[n];break}_e.setState({packs:t})},_selectionsMatch:(e,n)=>!(!e||!n)&&(e.packName===n.packName&&e.itemName===n.itemName),setSelectedBehaviors:e=>{_e.setState({selectedBehaviors:e})},toggleBehavior:e=>{const n=_e.getState(),t=He._selectionsMatch,i=n.selectedBehaviors.findIndex(n=>t(n,e));if(i>=0){const r=[...n.selectedBehaviors];r.splice(i,1),_e.setState({selectedBehaviors:r,dominantBehavior:t(n.dominantBehavior,e)?null:n.dominantBehavior})}else _e.setState({selectedBehaviors:[...n.selectedBehaviors,e]})},setDominantBehavior:e=>{_e.setState({dominantBehavior:e})},setSelectedPersonalities:e=>{_e.setState({selectedPersonalities:e})},togglePersonality:e=>{const n=_e.getState(),t=He._selectionsMatch,i=n.selectedPersonalities.findIndex(n=>t(n,e));if(i>=0){const r=[...n.selectedPersonalities];r.splice(i,1),_e.setState({selectedPersonalities:r,dominantPersonality:t(n.dominantPersonality,e)?null:n.dominantPersonality})}else _e.setState({selectedPersonalities:[...n.selectedPersonalities,e]})},setDominantPersonality:e=>{_e.setState({dominantPersonality:e})},setSelectedDefinition:e=>{_e.setState({selectedDefinition:e})},clearSelections:()=>{_e.setState({selectedBehaviors:[],selectedPersonalities:[],selectedDefinition:null,dominantBehavior:null,dominantPersonality:null})},setSelectedLoomStyles:e=>{_e.setState({selectedLoomStyle:e})},toggleLoomStyle:e=>{const n=_e.getState(),t=He._selectionsMatch,i=n.selectedLoomStyle||[],r=i.findIndex(n=>t(n,e));if(r>=0){const e=[...i];e.splice(r,1),_e.setState({selectedLoomStyle:e})}else _e.setState({selectedLoomStyle:[...i,e]})},setSelectedLoomUtilities:e=>{_e.setState({selectedLoomUtils:e})},toggleLoomUtility:e=>{const n=_e.getState(),t=He._selectionsMatch,i=n.selectedLoomUtils||[],r=i.findIndex(n=>t(n,e));if(r>=0){const e=[...i];e.splice(r,1),_e.setState({selectedLoomUtils:e})}else _e.setState({selectedLoomUtils:[...i,e]})},setSelectedLoomRetrofits:e=>{_e.setState({selectedLoomRetrofits:e})},toggleLoomRetrofit:e=>{const n=_e.getState(),t=He._selectionsMatch,i=n.selectedLoomRetrofits||[],r=i.findIndex(n=>t(n,e));if(r>=0){const e=[...i];e.splice(r,1),_e.setState({selectedLoomRetrofits:e})}else _e.setState({selectedLoomRetrofits:[...i,e]})},clearLoomSelections:()=>{_e.setState({selectedLoomStyle:[],selectedLoomUtils:[],selectedLoomRetrofits:[]})},clearAllSelections:()=>{_e.setState({selectedBehaviors:[],selectedPersonalities:[],selectedDefinition:null,dominantBehavior:null,dominantPersonality:null,selectedLoomStyle:[],selectedLoomUtils:[],selectedLoomRetrofits:[]})},areAllTraitsEnabledForLumia:(e,n)=>{const t=_e.getState(),i=We(t.packs,e);if(!i)return!1;const r=Fe(i,n);if(!r)return!1;if(Ve(r,"def")){const i=t.selectedDefinition;if(!i||i.packName!==e||i.itemName!==n)return!1}if(Ve(r,"behavior")){if(!(t.selectedBehaviors||[]).some(t=>t.packName===e&&t.itemName===n))return!1}if(Ve(r,"personality")){if(!(t.selectedPersonalities||[]).some(t=>t.packName===e&&t.itemName===n))return!1}return!0},toggleAllTraitsForLumia:(e,n)=>{const t=_e.getState(),i=We(t.packs,e);if(!i)return!1;const r=Fe(i,n);if(!r)return!1;if(He.areAllTraitsEnabledForLumia(e,n)){const i={};if(Ve(r,"def")){const r=t.selectedDefinition;r&&r.packName===e&&r.itemName===n&&(i.selectedDefinition=null)}if(Ve(r,"behavior")){const r=t.selectedBehaviors||[];i.selectedBehaviors=r.filter(t=>!(t.packName===e&&t.itemName===n))}if(Ve(r,"personality")){const r=t.selectedPersonalities||[];i.selectedPersonalities=r.filter(t=>!(t.packName===e&&t.itemName===n))}return Object.keys(i).length>0&&_e.setState(i),!1}{const i={packName:e,itemName:n},a={};if(Ve(r,"def")&&(a.selectedDefinition=i),Ve(r,"behavior")){const r=t.selectedBehaviors||[];r.some(t=>t.packName===e&&t.itemName===n)||(a.selectedBehaviors=[...r,i])}if(Ve(r,"personality")){const r=t.selectedPersonalities||[];r.some(t=>t.packName===e&&t.itemName===n)||(a.selectedPersonalities=[...r,i])}return Object.keys(a).length>0&&_e.setState(a),!0}},enableAllTraitsForLumia:(e,n)=>{const t=_e.getState(),i=We(t.packs,e);if(!i)return;const r=Fe(i,n);if(!r)return;const a={packName:e,itemName:n},o={};if(Ve(r,"def")&&(o.selectedDefinition=a),Ve(r,"behavior")){const i=t.selectedBehaviors||[];i.some(t=>t.packName===e&&t.itemName===n)||(o.selectedBehaviors=[...i,a])}if(Ve(r,"personality")){const i=t.selectedPersonalities||[];i.some(t=>t.packName===e&&t.itemName===n)||(o.selectedPersonalities=[...i,a])}Object.keys(o).length>0&&_e.setState(o)},savePreset:e=>{const n=_e.getState(),t=Date.now(),i={name:e,createdAt:t,updatedAt:t,selectedDefinition:n.selectedDefinition,selectedBehaviors:[...n.selectedBehaviors||[]],selectedPersonalities:[...n.selectedPersonalities||[]],dominantBehavior:n.dominantBehavior,dominantPersonality:n.dominantPersonality,chimeraMode:n.chimeraMode||!1,selectedDefinitions:[...n.selectedDefinitions||[]],councilMode:n.councilMode||!1,councilMembers:JSON.parse(JSON.stringify(n.councilMembers||[]))};_e.setState({presets:Ie(Ie({},n.presets),{},{[e]:i}),activePresetName:e})},loadPreset:e=>{const n=_e.getState().presets[e];if(!n)return;const t={selectedDefinition:n.selectedDefinition,selectedBehaviors:n.selectedBehaviors||[],selectedPersonalities:n.selectedPersonalities||[],dominantBehavior:n.dominantBehavior,dominantPersonality:n.dominantPersonality,activePresetName:e};void 0!==n.chimeraMode&&(t.chimeraMode=n.chimeraMode,t.selectedDefinitions=n.selectedDefinitions||[]),void 0!==n.councilMode&&(t.councilMode=n.councilMode,t.councilMembers=n.councilMembers||[]),_e.setState(t)},deletePreset:e=>{const n=_e.getState(),t=n.presets,{[e]:i}=t,r=De(t,[e].map(Re));_e.setState({presets:r,activePresetName:n.activePresetName===e?null:n.activePresetName})},updatePreset:e=>{const n=_e.getState(),t=n.presets[e];if(!t)return;const i=Ie(Ie({},t),{},{updatedAt:Date.now(),selectedDefinition:n.selectedDefinition,selectedBehaviors:[...n.selectedBehaviors||[]],selectedPersonalities:[...n.selectedPersonalities||[]],dominantBehavior:n.dominantBehavior,dominantPersonality:n.dominantPersonality,chimeraMode:n.chimeraMode||!1,selectedDefinitions:[...n.selectedDefinitions||[]],councilMode:n.councilMode||!1,councilMembers:JSON.parse(JSON.stringify(n.councilMembers||[]))});_e.setState({presets:Ie(Ie({},n.presets),{},{[e]:i})})},clearActivePreset:()=>{_e.setState({activePresetName:null})},setChimeraMode:e=>{var n;const t=_e.getState();e&&t.councilMode&&_e.setState({councilMode:!1,councilMembers:[]}),e&&t.selectedDefinition?_e.setState({chimeraMode:!0,selectedDefinitions:[t.selectedDefinition],selectedDefinition:null}):!e&&(null===(n=t.selectedDefinitions)||void 0===n?void 0:n.length)>0?_e.setState({chimeraMode:!1,selectedDefinition:t.selectedDefinitions[0],selectedDefinitions:[]}):_e.setState({chimeraMode:e})},toggleChimeraDefinition:e=>{const n=_e.getState().selectedDefinitions||[],t=He._selectionsMatch,i=n.findIndex(n=>t(n,e));if(i>=0){const e=[...n];e.splice(i,1),_e.setState({selectedDefinitions:e})}else _e.setState({selectedDefinitions:[...n,e]})},clearChimeraDefinitions:()=>{_e.setState({selectedDefinitions:[]})},setCouncilMode:e=>{const n=_e.getState();e&&n.chimeraMode&&_e.setState({chimeraMode:!1,selectedDefinitions:[]}),_e.setState({councilMode:e})},addCouncilMember:e=>{const n=_e.getState(),t=Fe(We(n.packs,e.packName),e.itemName),i=[],r=[];Ve(t,"behavior")&&i.push({packName:e.packName,itemName:e.itemName}),Ve(t,"personality")&&r.push({packName:e.packName,itemName:e.itemName}),_e.setState({councilMembers:[...n.councilMembers,{id:crypto.randomUUID(),packName:e.packName,itemName:e.itemName,behaviors:i,personalities:r,dominantBehavior:null,dominantPersonality:null,role:""}]})},updateCouncilMember:(e,n)=>{const t=_e.getState();_e.setState({councilMembers:t.councilMembers.map(t=>t.id===e?Ie(Ie({},t),n):t)})},removeCouncilMember:e=>{const n=_e.getState();_e.setState({councilMembers:n.councilMembers.filter(n=>n.id!==e)})},clearCouncilMembers:()=>{_e.setState({councilMembers:[]})},openModal:function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_e.setState({ui:Ie(Ie({},_e.getState().ui),{},{activeModal:{name:e,props:n}})})},closeModal:()=>{_e.setState({ui:Ie(Ie({},_e.getState().ui),{},{activeModal:null})})},setLoading:e=>{_e.setState({ui:Ie(Ie({},_e.getState().ui),{},{isLoading:e})})},setError:e=>{_e.setState({ui:Ie(Ie({},_e.getState().ui),{},{error:e})})},clearError:()=>{_e.setState({ui:Ie(Ie({},_e.getState().ui),{},{error:null})})},openPackDetail:e=>{_e.setState({ui:Ie(Ie({},_e.getState().ui),{},{viewingPack:e})})},closePackDetail:()=>{_e.setState({ui:Ie(Ie({},_e.getState().ui),{},{viewingPack:null})})},openLoomPackDetail:e=>{_e.setState({ui:Ie(Ie({},_e.getState().ui),{},{viewingLoomPack:e})})},closeLoomPackDetail:()=>{_e.setState({ui:Ie(Ie({},_e.getState().ui),{},{viewingLoomPack:null})})}};function $e(e){var n;if(!e)return void console.warn("[LumiverseStore] syncFromExtension called with null settings");console.log("[LumiverseStore] syncFromExtension - received:",{packsType:typeof e.packs,packsKeys:e.packs?Object.keys(e.packs):[],selectedDefinition:e.selectedDefinition,selectedBehaviorsCount:(null===(n=e.selectedBehaviors)||void 0===n?void 0:n.length)||0});const t=_e.getState(),i=t.ui,r=t.chatChangeCounter||0;_e.setState(Ie(Ie({},e),{},{ui:i,chatChangeCounter:r+1})),console.log("[LumiverseStore] syncFromExtension - store updated:",{packsKeys:Object.keys(_e.getState().packs||{})})}function qe(){const e=_e.getState(),{ui:n}=e,t=De(e,Oe);return console.log("[LumiverseStore] exportForExtension:",{packsKeys:Object.keys(t.packs||{})}),t}function Ye(){!function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300;Be&&clearTimeout(Be),Be=setTimeout(e,n)}(()=>{if("undefined"!=typeof LumiverseBridge&&LumiverseBridge.saveSettings){const e=qe();LumiverseBridge.saveSettings(e),console.log("[LumiverseStore] Settings saved to extension")}})}function Ke(){if("undefined"!=typeof LumiverseBridge&&LumiverseBridge.saveSettings){const e=qe();LumiverseBridge.saveSettings(e),console.log("[LumiverseStore] Settings saved immediately")}}const Ge={getState:_e.getState,setState:_e.setState,subscribe:_e.subscribe,syncFromExtension:$e,exportForExtension:qe,saveToExtension:Ye};Ge.getState=_e.getState;const Qe=(0,Ee.createContext)(null);function Xe(e){let{children:n,initialSettings:t=null}=e;const i=(0,Ee.useRef)(!1);return(0,Ee.useEffect)(()=>{if(!i.current)if(i.current=!0,t)console.log("[LumiverseProvider] Using initialSettings from bridge"),$e(t);else if("undefined"!=typeof LumiverseBridge&&LumiverseBridge.getSettings){console.log("[LumiverseProvider] Fetching settings via LumiverseBridge");const e=LumiverseBridge.getSettings();e&&$e(e)}else console.warn("[LumiverseProvider] No settings source available")},[t]),(0,Le.jsx)(Qe.Provider,{value:_e,children:n})}function Ze(e){const n=(0,Ee.useRef)(e);n.current=e;const t=(0,Ee.useCallback)(()=>n.current(_e.getState()),[]);return(0,Ee.useSyncExternalStore)(_e.subscribe,t,t)}function Je(){return He}const en=e=>e.settings,nn=e=>e.ui,tn=()=>_e.getState().selectedBehaviors,rn=()=>_e.getState().selectedPersonalities,an=()=>_e.getState().selectedDefinition,on=()=>_e.getState().dominantBehavior,sn=()=>_e.getState().dominantPersonality,ln=[],cn=()=>_e.getState().selectedLoomStyle||ln,un=()=>_e.getState().selectedLoomUtils||ln,dn=()=>_e.getState().selectedLoomRetrofits||ln,mn=()=>_e.getState().packs;function pn(){return Ze(en)}function hn(){const e=(0,Ee.useSyncExternalStore)(_e.subscribe,tn,tn),n=(0,Ee.useSyncExternalStore)(_e.subscribe,rn,rn),t=(0,Ee.useSyncExternalStore)(_e.subscribe,an,an),i=(0,Ee.useSyncExternalStore)(_e.subscribe,on,on),r=(0,Ee.useSyncExternalStore)(_e.subscribe,sn,sn);return(0,Ee.useMemo)(()=>({behaviors:e,personalities:n,definition:t,dominantBehavior:i,dominantPersonality:r}),[e,n,t,i,r])}function vn(){const e=(0,Ee.useSyncExternalStore)(_e.subscribe,cn,cn),n=(0,Ee.useSyncExternalStore)(_e.subscribe,un,un),t=(0,Ee.useSyncExternalStore)(_e.subscribe,dn,dn);return(0,Ee.useMemo)(()=>({styles:e,utilities:n,retrofits:t}),[e,n,t])}function fn(){const e=(0,Ee.useSyncExternalStore)(_e.subscribe,mn,mn);return(0,Ee.useMemo)(()=>{let n=[];e&&(Array.isArray(e)?n=e:"object"==typeof e&&(n=Object.entries(e).map(e=>{let[n,t]=e;return Ie(Ie({},t),{},{name:t.name||t.packName||n})})));const t=n.filter(e=>!0===e.isCustom);return{packs:n.filter(e=>!e.isCustom),customPacks:t,allPacks:n}},[e])}function gn(){return Ze(nn)}function bn(e){const[n,t]=(0,Ee.useState)({objectPosition:"center center",isLoaded:!1,isPortrait:!1,isSquare:!1,isLandscape:!1}),i=(0,Ee.useRef)(e);return(0,Ee.useEffect)(()=>{if(i.current=e,!e)return void t({objectPosition:"center center",isLoaded:!1,isPortrait:!1,isSquare:!1,isLandscape:!1});const n=new Image;return n.onload=()=>{if(i.current!==e)return;const{naturalWidth:r,naturalHeight:a}=n,o=r/a,s=o<.9;let l="center center";s&&(l="center 20%"),t({objectPosition:l,isLoaded:!0,isPortrait:s,isSquare:o>=.9&&o<=1.1,isLandscape:o>1.1})},n.onerror=()=>{i.current===e&&t({objectPosition:"center center",isLoaded:!1,isPortrait:!1,isSquare:!1,isLandscape:!1})},n.src=e,()=>{n.onload=null,n.onerror=null}},[e]),n}"undefined"!=typeof window&&(window.debugLumiverseData=function(){const e=_e.getState();console.log("=".repeat(80)),console.log("LUMIVERSE DEBUG DATA DUMP"),console.log("=".repeat(80)),console.log("\n--- STORE STATE: packs ---"),console.log("Type:",typeof e.packs,Array.isArray(e.packs)?"(Array - WRONG!)":"(Object - correct)"),console.log("Pack names:",e.packs?Object.keys(e.packs):"null"),console.log("Packs:",JSON.stringify(e.packs,null,2)),console.log("\n--- CURRENT SELECTIONS ---"),console.log("selectedDefinition:",JSON.stringify(e.selectedDefinition,null,2)),console.log("selectedBehaviors:",JSON.stringify(e.selectedBehaviors,null,2)),console.log("selectedPersonalities:",JSON.stringify(e.selectedPersonalities,null,2)),console.log("dominantBehavior:",JSON.stringify(e.dominantBehavior,null,2)),console.log("dominantPersonality:",JSON.stringify(e.dominantPersonality,null,2)),console.log("\n--- LOOM SELECTIONS ---"),console.log("selectedLoomStyle:",JSON.stringify(e.selectedLoomStyle,null,2)),console.log("selectedLoomUtils:",JSON.stringify(e.selectedLoomUtils,null,2)),console.log("selectedLoomRetrofits:",JSON.stringify(e.selectedLoomRetrofits,null,2)),console.log("\n--- SETTINGS FROM LUMIVERSE BRIDGE ---");try{if("undefined"!=typeof LumiverseBridge&&LumiverseBridge.getSettings){const e=LumiverseBridge.getSettings();e?(console.log("Bridge packs type:",typeof e.packs,Array.isArray(e.packs)?"(Array)":"(Object)"),console.log("Bridge pack names:",e.packs?Object.keys(e.packs):"null"),console.log("Full bridge settings:",JSON.stringify(e,null,2))):console.log("LumiverseBridge.getSettings() returned null")}else console.log("LumiverseBridge not available")}catch(e){console.log("Error reading bridge settings:",e.message)}console.log("\n--- PACK STRUCTURE ANALYSIS ---");const n=e.packs||{},t=Object.entries(n);console.log("Total packs:",t.length),t.forEach(e=>{let[n,t]=e;console.log('\nPack "'.concat(n,'":')),console.log("  - Pack keys:",Object.keys(t));const i=!(!t.lumiaItems&&!t.loomItems);var r,a,o,s,l;console.log("  - Format:",i?"v2 (lumiaItems/loomItems)":"v1 (mixed items[])"),i?(console.log("  - lumiaItems count:",(null===(r=t.lumiaItems)||void 0===r?void 0:r.length)||0),console.log("  - loomItems count:",(null===(a=t.loomItems)||void 0===a?void 0:a.length)||0),(null===(o=t.lumiaItems)||void 0===o?void 0:o.length)>0&&(console.log("  - Lumia items:"),t.lumiaItems.forEach((e,n)=>{var t;const i=e.lumiaName||"NONE",r=e.lumiaDefinition?"YES":"NO",a=e.lumiaBehavior?"YES":"NO",o=e.lumiaPersonality?"YES":"NO",s=null!==(t=e.genderIdentity)&&void 0!==t?t:"NONE";console.log("    [".concat(n,'] lumiaName="').concat(i,'", hasDef=').concat(r,", hasBehavior=").concat(a,", hasPersonality=").concat(o,", gender=").concat(s))})),(null===(s=t.loomItems)||void 0===s?void 0:s.length)>0&&(console.log("  - Loom items:"),t.loomItems.forEach((e,n)=>{console.log("    [".concat(n,'] loomName="').concat(e.loomName,'", loomCategory="').concat(e.loomCategory,'"'))}))):(console.log("  - items count:",(null===(l=t.items)||void 0===l?void 0:l.length)||0),t.items&&t.items.length>0&&(console.log("  - First item keys:",Object.keys(t.items[0])),console.log("  - Items with lumiaDefName:",t.items.filter(e=>e.lumiaDefName).length),console.log("  - Items with loomCategory:",t.items.filter(e=>e.loomCategory).length),console.log("  - All items:"),t.items.forEach((e,n)=>{const t=e.lumiaDefName||"NONE",i=e.loomCategory||"NONE",r=e.lumiaDef?"YES":"NO",a=e.lumia_behavior?"YES":"NO",o=e.lumia_personality?"YES":"NO";console.log("    [".concat(n,'] lumiaDefName="').concat(t,'", loomCategory="').concat(i,'", hasDef=').concat(r,", hasBehavior=").concat(a,", hasPersonality=").concat(o))})))}),console.log("\n"+"=".repeat(80)),console.log("END DEBUG DUMP - Copy everything above for analysis"),console.log("=".repeat(80));const{ui:i}=e;return{storeState:De(e,Te)}});function xn(e){var n,t,i="";if("string"==typeof e||"number"==typeof e)i+=e;else if("object"==typeof e)if(Array.isArray(e)){var r=e.length;for(n=0;n<r;n++)e[n]&&(t=xn(e[n]))&&(i&&(i+=" "),i+=t)}else for(t in e)e[t]&&(i&&(i+=" "),i+=t);return i}const yn=function(){for(var e,n,t=0,i="",r=arguments.length;t<r;t++)(e=arguments[t])&&(n=xn(e))&&(i&&(i+=" "),i+=n);return i},kn=e=>{const n=(e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,n,t)=>t?t.toUpperCase():n.toLowerCase()))(e);return n.charAt(0).toUpperCase()+n.slice(1)},wn=(...e)=>e.filter((e,n,t)=>Boolean(e)&&""!==e.trim()&&t.indexOf(e)===n).join(" ").trim(),jn=e=>{for(const n in e)if(n.startsWith("aria-")||"role"===n||"title"===n)return!0};var Sn={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const Cn=(0,Ee.forwardRef)(({color:e="currentColor",size:n=24,strokeWidth:t=2,absoluteStrokeWidth:i,className:r="",children:a,iconNode:o,...s},l)=>(0,Ee.createElement)("svg",{ref:l,...Sn,width:n,height:n,stroke:e,strokeWidth:i?24*Number(t)/Number(n):t,className:wn("lucide",r),...!a&&!jn(s)&&{"aria-hidden":"true"},...s},[...o.map(([e,n])=>(0,Ee.createElement)(e,n)),...Array.isArray(a)?a:[a]])),Nn=(e,n)=>{const t=(0,Ee.forwardRef)(({className:t,...i},r)=>{return(0,Ee.createElement)(Cn,{ref:r,iconNode:n,className:wn(`lucide-${a=kn(e),a.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,t),...i});var a});return t.displayName=kn(e),t},Pn=Nn("package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]]),En=Nn("pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]),Mn=Nn("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]),Ln=Nn("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]);function On(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,i)}return t}function Tn(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?On(Object(t),!0).forEach(function(n){Dn(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):On(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Dn(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,n||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function zn(e){let{label:n,required:t,children:i,error:r,hint:a}=e;return(0,Le.jsxs)("div",{className:yn("lumiverse-form-field",r&&"lumiverse-form-field--error"),children:[(0,Le.jsxs)("label",{className:"lumiverse-form-label",children:[n,t&&(0,Le.jsx)("span",{className:"lumiverse-required",children:"*"})]}),i,a&&(0,Le.jsx)("span",{className:"lumiverse-form-hint",children:a}),r&&(0,Le.jsx)("span",{className:"lumiverse-form-error",children:r})]})}function In(e){let{value:n,onChange:t,placeholder:i,maxLength:r}=e;return(0,Le.jsx)("input",{type:"text",className:"lumiverse-input",value:n,onChange:e=>t(e.target.value),placeholder:i,maxLength:r})}function An(e){let{value:n,onChange:t,placeholder:i}=e;const[r,a]=(0,Ee.useState)(!1),{objectPosition:o}=bn(n);return(0,Le.jsxs)("div",{className:"lumiverse-image-input",children:[(0,Le.jsx)("input",{type:"text",className:"lumiverse-input",value:n,onChange:e=>{return n=e.target.value,a(!1),void t(n);var n},placeholder:i||"Enter image URL..."}),n&&!r&&(0,Le.jsx)("div",{className:"lumiverse-image-preview",children:(0,Le.jsx)("img",{src:n,alt:"Preview",style:{objectPosition:o},onError:()=>a(!0)})}),r&&(0,Le.jsx)("span",{className:"lumiverse-image-error",children:"Failed to load image"})]})}function Rn(e){const n=function(e){const n=e.packName||e.name||"Unnamed Pack",t=e.packAuthor||e.author||null,i=e.coverUrl||null,r=e.version||1;let a=[];e.lumiaItems&&e.lumiaItems.length>0?a=e.lumiaItems.map(e=>{var n;return{lumiaName:e.lumiaName||e.lumiaDefName||"Unknown",lumiaDefinition:e.lumiaDefinition||e.lumiaDef||"",lumiaPersonality:e.lumiaPersonality||e.lumia_personality||"",lumiaBehavior:e.lumiaBehavior||e.lumia_behavior||"",avatarUrl:e.avatarUrl||e.lumia_img||null,genderIdentity:null!==(n=e.genderIdentity)&&void 0!==n?n:0,authorName:e.authorName||t||null,version:e.version||1}}):e.items&&e.items.length>0&&(a=e.items.filter(e=>e.lumiaDefName||e.lumiaDef).map(e=>{var n;return{lumiaName:e.lumiaDefName||e.lumiaName||"Unknown",lumiaDefinition:e.lumiaDef||e.lumiaDefinition||"",lumiaPersonality:e.lumia_personality||e.lumiaPersonality||"",lumiaBehavior:e.lumia_behavior||e.lumiaBehavior||"",avatarUrl:e.lumia_img||e.avatarUrl||null,genderIdentity:null!==(n=e.genderIdentity)&&void 0!==n?n:0,authorName:e.authorName||t||null,version:e.version||1}}));let o=[];return e.loomItems&&e.loomItems.length>0?o=e.loomItems.map(e=>({loomName:e.loomName||e.name||"Unknown",loomContent:e.loomContent||e.content||"",loomCategory:e.loomCategory||e.category||"Loom Utilities",authorName:e.authorName||t||null,version:e.version||1})):e.items&&e.items.length>0&&(o=e.items.filter(e=>(e.loomCategory||e.loomName)&&!e.lumiaDefName&&!e.lumiaDef).map(e=>({loomName:e.loomName||e.name||"Unknown",loomContent:e.loomContent||e.content||"",loomCategory:e.loomCategory||e.category||"Loom Utilities",authorName:e.authorName||t||null,version:e.version||1}))),{packName:n,packAuthor:t,coverUrl:i,version:r,packExtras:e.packExtras||[],lumiaItems:a,loomItems:o}}(e),t=JSON.stringify(n,null,2),i=new Blob([t],{type:"application/json"}),r=URL.createObjectURL(i),a=e.packName||e.name||"pack",o=document.createElement("a");o.href=r,o.download="".concat(a.replace(/[^a-z0-9]/gi,"_"),"_lumiverse.json"),document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(r)}function Bn(e){return e.packName||e.name||""}function _n(e){return e.packAuthor||e.author||""}const Un=function(e){let{packId:n,onClose:t}=e;const{customPacks:i}=fn(),r=Je(),a=n?i.find(e=>e.id===n||e.name===n||e.packName===n):null,[o,s]=(0,Ee.useState)(()=>a?Tn(Tn({},a),{},{packName:a.packName||a.name||"",packAuthor:a.packAuthor||a.author||""}):{id:"pack_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),packName:"",name:"",packAuthor:"",coverUrl:"",url:"",isCustom:!0,version:1,packExtras:[],lumiaItems:[],loomItems:[]}),[l,c]=(0,Ee.useState)({}),u=(0,Ee.useCallback)((e,n)=>{s(t=>Tn(Tn({},t),{},{[e]:n})),l[e]&&c(n=>Tn(Tn({},n),{},{[e]:null}))},[l]),d=function(e){return e.lumiaItems&&e.lumiaItems.length>0?e.lumiaItems.length:e.items&&e.items.length>0?e.items.filter(e=>e.lumiaDefName||e.lumiaName||e.lumiaDef).length:0}(o),m=function(e){return e.loomItems&&e.loomItems.length>0?e.loomItems.length:e.items&&e.items.length>0?e.items.filter(e=>(e.loomCategory||e.loomName)&&!e.lumiaDefName&&!e.lumiaDef).length:0}(o);return(0,Le.jsxs)("div",{className:"lumiverse-pack-editor-modal",children:[(0,Le.jsxs)("div",{className:"lumiverse-pack-editor-content",children:[(0,Le.jsxs)("div",{className:"lumiverse-pack-metadata",children:[(0,Le.jsxs)("div",{className:"lumiverse-pack-editor-title",children:[(0,Le.jsx)(Pn,{size:20,strokeWidth:1.5}),(0,Le.jsx)("h3",{children:a?"Edit Pack":"New Pack"})]}),(0,Le.jsx)(zn,{label:"Pack Name",required:!0,error:l.packName,children:(0,Le.jsx)(In,{value:Bn(o),onChange:e=>{s(n=>Tn(Tn({},n),{},{packName:e,name:e})),l.packName&&c(e=>Tn(Tn({},e),{},{packName:null}))},placeholder:"My Custom Pack"})}),(0,Le.jsx)(zn,{label:"Author",children:(0,Le.jsx)(In,{value:_n(o),onChange:e=>{s(n=>Tn(Tn({},n),{},{packAuthor:e,author:e}))},placeholder:"Your name"})}),(0,Le.jsx)(zn,{label:"Cover Image",hint:"URL for pack cover image",children:(0,Le.jsx)(An,{value:o.coverUrl||"",onChange:e=>u("coverUrl",e)})})]}),(0,Le.jsxs)("div",{className:"lumiverse-pack-lumias-info",children:[(0,Le.jsx)("div",{className:"lumiverse-pack-lumias-header",children:(0,Le.jsxs)("span",{className:"lumiverse-pack-lumias-count",children:[d," Lumia",1!==d?"s":"",m>0?", ".concat(m," Loom item").concat(1!==m?"s":""):""," in this pack"]})}),(0,Le.jsx)("p",{className:"lumiverse-pack-lumias-hint",children:"Use the Pack Selector to add, edit, or remove individual items."}),(0,Le.jsxs)("button",{className:"lumiverse-btn lumiverse-btn--secondary lumiverse-btn--full",onClick:()=>{const e=Bn(o);if(e.trim()){const n=Tn(Tn({},o),{},{name:e});a?r.updateCustomPack(o.id||Bn(a),n):r.addCustomPack(n),Ye()}r.openModal("packSelector"),t()},type:"button",children:[(0,Le.jsx)(En,{size:14,strokeWidth:1.5}),"Manage Lumias"]})]})]}),(0,Le.jsxs)("div",{className:"lumiverse-pack-editor-footer",children:[(0,Le.jsxs)("div",{className:"lumiverse-pack-editor-footer-left",children:[a&&(0,Le.jsxs)("button",{className:"lumiverse-btn lumiverse-btn--danger",onClick:()=>{const e=Bn(o);window.confirm('Are you sure you want to delete "'.concat(e,'"? This will remove all Lumias in this pack.'))&&(r.removeCustomPack(o.id||e),Ye(),t())},type:"button",children:[(0,Le.jsx)(Mn,{size:14}),"Delete Pack"]}),(0,Le.jsxs)("button",{className:"lumiverse-btn lumiverse-btn--secondary",onClick:()=>{Bn(o).trim()?Rn(o):alert("Please enter a pack name before exporting.")},type:"button",title:"Export as Lumiverse Pack",children:[(0,Le.jsx)(Ln,{size:14}),"Export"]})]}),(0,Le.jsxs)("div",{className:"lumiverse-pack-editor-actions",children:[(0,Le.jsx)("button",{className:"lumiverse-btn lumiverse-btn--secondary",onClick:t,type:"button",children:"Cancel"}),(0,Le.jsx)("button",{className:"lumiverse-btn lumiverse-btn--primary",onClick:()=>{if(!(()=>{const e={};return Bn(o).trim()||(e.packName="Pack name is required"),c(e),0===Object.keys(e).length})())return;const e=Tn(Tn({},o),{},{name:Bn(o)});a?r.updateCustomPack(o.id||Bn(a),e):r.addCustomPack(e),Ye(),t()},type:"button",children:a?"Save Changes":"Create Pack"})]})]})]})},Fn=["isOpen","children","className","duration","initial","animate","exit","transition"];function Vn(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,i)}return t}function Wn(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Vn(Object(t),!0).forEach(function(n){Hn(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Vn(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Hn(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,n||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const $n=(0,Ee.forwardRef)(function(e,n){let{isOpen:t,children:i,className:r,duration:a=200,initial:o,animate:s,exit:l,transition:c}=e,u=function(e,n){if(null==e)return{};var t,i,r=function(e,n){if(null==e)return{};var t={};for(var i in e)if({}.hasOwnProperty.call(e,i)){if(-1!==n.indexOf(i))continue;t[i]=e[i]}return t}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)t=a[i],-1===n.indexOf(t)&&{}.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}(e,Fn);return(0,Le.jsx)("div",Wn(Wn({ref:n,className:yn("lumiverse-collapsible",r,{"is-open":t}),style:{"--collapsible-duration":"".concat(a,"ms")}},u),{},{children:(0,Le.jsx)("div",{className:"lumiverse-collapsible-inner",children:i})}))}),qn=(0,Ee.createContext)({});function Yn(e){const n=(0,Ee.useRef)(null);return null===n.current&&(n.current=e()),n.current}const Kn=(0,Ee.createContext)(null),Gn=(0,Ee.createContext)({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"});class Qn extends Ee.Component{getSnapshotBeforeUpdate(e){const n=this.props.childRef.current;if(n&&e.isPresent&&!this.props.isPresent){const e=this.props.sizeRef.current;e.height=n.offsetHeight||0,e.width=n.offsetWidth||0,e.top=n.offsetTop,e.left=n.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function Xn({children:e,isPresent:n}){const t=(0,Ee.useId)(),i=(0,Ee.useRef)(null),r=(0,Ee.useRef)({width:0,height:0,top:0,left:0}),{nonce:a}=(0,Ee.useContext)(Gn);return(0,Ee.useInsertionEffect)(()=>{const{width:e,height:o,top:s,left:l}=r.current;if(n||!i.current||!e||!o)return;i.current.dataset.motionPopId=t;const c=document.createElement("style");return a&&(c.nonce=a),document.head.appendChild(c),c.sheet&&c.sheet.insertRule(`\n          [data-motion-pop-id="${t}"] {\n            position: absolute !important;\n            width: ${e}px !important;\n            height: ${o}px !important;\n            top: ${s}px !important;\n            left: ${l}px !important;\n          }\n        `),()=>{document.head.removeChild(c)}},[n]),(0,Le.jsx)(Qn,{isPresent:n,childRef:i,sizeRef:r,children:Ee.cloneElement(e,{ref:i})})}const Zn=({children:e,initial:n,isPresent:t,onExitComplete:i,custom:r,presenceAffectsLayout:a,mode:o})=>{const s=Yn(Jn),l=(0,Ee.useId)(),c=(0,Ee.useCallback)(e=>{s.set(e,!0);for(const e of s.values())if(!e)return;i&&i()},[s,i]),u=(0,Ee.useMemo)(()=>({id:l,initial:n,isPresent:t,custom:r,onExitComplete:c,register:e=>(s.set(e,!1),()=>s.delete(e))}),a?[Math.random(),c]:[t,c]);return(0,Ee.useMemo)(()=>{s.forEach((e,n)=>s.set(n,!1))},[t]),Ee.useEffect(()=>{!t&&!s.size&&i&&i()},[t]),"popLayout"===o&&(e=(0,Le.jsx)(Xn,{isPresent:t,children:e})),(0,Le.jsx)(Kn.Provider,{value:u,children:e})};function Jn(){return new Map}function et(e=!0){const n=(0,Ee.useContext)(Kn);if(null===n)return[!0,null];const{isPresent:t,onExitComplete:i,register:r}=n,a=(0,Ee.useId)();(0,Ee.useEffect)(()=>{e&&r(a)},[e]);const o=(0,Ee.useCallback)(()=>e&&i&&i(a),[a,i,e]);return!t&&i?[!1,o]:[!0]}const nt=e=>e.key||"";function tt(e){const n=[];return Ee.Children.forEach(e,e=>{(0,Ee.isValidElement)(e)&&n.push(e)}),n}const it="undefined"!=typeof window,rt=it?Ee.useLayoutEffect:Ee.useEffect,at=({children:e,custom:n,initial:t=!0,onExitComplete:i,presenceAffectsLayout:r=!0,mode:a="sync",propagate:o=!1})=>{const[s,l]=et(o),c=(0,Ee.useMemo)(()=>tt(e),[e]),u=o&&!s?[]:c.map(nt),d=(0,Ee.useRef)(!0),m=(0,Ee.useRef)(c),p=Yn(()=>new Map),[h,v]=(0,Ee.useState)(c),[f,g]=(0,Ee.useState)(c);rt(()=>{d.current=!1,m.current=c;for(let e=0;e<f.length;e++){const n=nt(f[e]);u.includes(n)?p.delete(n):!0!==p.get(n)&&p.set(n,!1)}},[f,u.length,u.join("-")]);const b=[];if(c!==h){let e=[...c];for(let n=0;n<f.length;n++){const t=f[n],i=nt(t);u.includes(i)||(e.splice(n,0,t),b.push(t))}return"wait"===a&&b.length&&(e=b),g(tt(e)),void v(c)}const{forceRender:x}=(0,Ee.useContext)(qn);return(0,Le.jsx)(Le.Fragment,{children:f.map(e=>{const h=nt(e),v=!(o&&!s)&&(c===f||u.includes(h));return(0,Le.jsx)(Zn,{isPresent:v,initial:!(d.current&&!t)&&void 0,custom:v?void 0:n,presenceAffectsLayout:r,mode:a,onExitComplete:v?void 0:()=>{if(!p.has(h))return;p.set(h,!0);let e=!0;p.forEach(n=>{n||(e=!1)}),e&&(null==x||x(),g(m.current),o&&(null==l||l()),i&&i())},children:e},h)})})};function ot(e){if("undefined"==typeof Proxy)return e;const n=new Map;return new Proxy((...n)=>e(...n),{get:(t,i)=>"create"===i?e:(n.has(i)||n.set(i,e(i)),n.get(i))})}function st(e){return null!==e&&"object"==typeof e&&"function"==typeof e.start}const lt=e=>Array.isArray(e);function ct(e,n){if(!Array.isArray(n))return!1;const t=n.length;if(t!==e.length)return!1;for(let i=0;i<t;i++)if(n[i]!==e[i])return!1;return!0}function ut(e){return"string"==typeof e||Array.isArray(e)}function dt(e){const n=[{},{}];return null==e||e.values.forEach((e,t)=>{n[0][t]=e.get(),n[1][t]=e.getVelocity()}),n}function mt(e,n,t,i){if("function"==typeof n){const[r,a]=dt(i);n=n(void 0!==t?t:e.custom,r,a)}if("string"==typeof n&&(n=e.variants&&e.variants[n]),"function"==typeof n){const[r,a]=dt(i);n=n(void 0!==t?t:e.custom,r,a)}return n}function pt(e,n,t){const i=e.getProps();return mt(i,n,void 0!==t?t:i.custom,e)}const ht=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],vt=["initial",...ht];function ft(e,n){return e?e[n]||e.default||e:void 0}const gt=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],bt=new Set(gt),xt=new Set(["width","height","top","left","right","bottom",...gt]),yt=e=>lt(e)?e[e.length-1]||0:e,kt=!1,wt=!1,jt=e=>e;const St=["read","resolveKeyframes","update","preRender","render","postRender"];function Ct(e,n){let t=!1,i=!0;const r={delta:0,timestamp:0,isProcessing:!1},a=()=>t=!0,o=St.reduce((e,n)=>(e[n]=function(e){let n=new Set,t=new Set,i=!1,r=!1;const a=new WeakSet;let o={delta:0,timestamp:0,isProcessing:!1};function s(n){a.has(n)&&(l.schedule(n),e()),n(o)}const l={schedule:(e,r=!1,o=!1)=>{const s=o&&i?n:t;return r&&a.add(e),s.has(e)||s.add(e),e},cancel:e=>{t.delete(e),a.delete(e)},process:e=>{o=e,i?r=!0:(i=!0,[n,t]=[t,n],n.forEach(s),n.clear(),i=!1,r&&(r=!1,l.process(e)))}};return l}(a),e),{}),{read:s,resolveKeyframes:l,update:c,preRender:u,render:d,postRender:m}=o,p=()=>{const a=wt?r.timestamp:performance.now();t=!1,r.delta=i?1e3/60:Math.max(Math.min(a-r.timestamp,40),1),r.timestamp=a,r.isProcessing=!0,s.process(r),l.process(r),c.process(r),u.process(r),d.process(r),m.process(r),r.isProcessing=!1,t&&n&&(i=!1,e(p))};return{schedule:St.reduce((n,a)=>{const s=o[a];return n[a]=(n,a=!1,o=!1)=>(t||(t=!0,i=!0,r.isProcessing||e(p)),s.schedule(n,a,o)),n},{}),cancel:e=>{for(let n=0;n<St.length;n++)o[St[n]].cancel(e)},state:r,steps:o}}const{schedule:Nt,cancel:Pt,state:Et,steps:Mt}=Ct("undefined"!=typeof requestAnimationFrame?requestAnimationFrame:jt,!0);let Lt;function Ot(){Lt=void 0}const Tt={now:()=>(void 0===Lt&&Tt.set(Et.isProcessing||wt?Et.timestamp:performance.now()),Lt),set:e=>{Lt=e,queueMicrotask(Ot)}};function Dt(e,n){-1===e.indexOf(n)&&e.push(n)}function zt(e,n){const t=e.indexOf(n);t>-1&&e.splice(t,1)}class It{constructor(){this.subscriptions=[]}add(e){return Dt(this.subscriptions,e),()=>zt(this.subscriptions,e)}notify(e,n,t){const i=this.subscriptions.length;if(i)if(1===i)this.subscriptions[0](e,n,t);else for(let r=0;r<i;r++){const i=this.subscriptions[r];i&&i(e,n,t)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function At(e,n){return n?e*(1e3/n):0}const Rt={current:void 0};class Bt{constructor(e,n={}){this.version="11.18.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(e,n=!0)=>{const t=Tt.now();this.updatedAt!==t&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(e),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),n&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(e),this.owner=n.owner}setCurrent(e){var n;this.current=e,this.updatedAt=Tt.now(),null===this.canTrackVelocity&&void 0!==e&&(this.canTrackVelocity=(n=this.current,!isNaN(parseFloat(n))))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,n){this.events[e]||(this.events[e]=new It);const t=this.events[e].add(n);return"change"===e?()=>{t(),Nt.read(()=>{this.events.change.getSize()||this.stop()})}:t}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,n){this.passiveEffect=e,this.stopPassiveEffect=n}set(e,n=!0){n&&this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e,n)}setWithVelocity(e,n,t){this.set(n),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-t}jump(e,n=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,n&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return Rt.current&&Rt.current.push(this),this.current}getPrevious(){return this.prev}getVelocity(){const e=Tt.now();if(!this.canTrackVelocity||void 0===this.prevFrameValue||e-this.updatedAt>30)return 0;const n=Math.min(this.updatedAt-this.prevUpdatedAt,30);return At(parseFloat(this.current)-parseFloat(this.prevFrameValue),n)}start(e){return this.stop(),new Promise(n=>{this.hasAnimated=!0,this.animation=e(n),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function _t(e,n){return new Bt(e,n)}function Ut(e,n,t){e.hasValue(n)?e.getValue(n).set(t):e.addValue(n,_t(t))}const Ft=e=>Boolean(e&&e.getVelocity);function Vt(e,n){const t=e.getValue("willChange");if(i=t,Boolean(Ft(i)&&i.add))return t.add(n);var i}const Wt=e=>e.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),Ht="data-"+Wt("framerAppearId");function $t(e){return e.props[Ht]}function qt(e){let n;return()=>(void 0===n&&(n=e()),n)}const Yt=qt(()=>void 0!==window.ScrollTimeline);class Kt{constructor(e){this.stop=()=>this.runAll("stop"),this.animations=e.filter(Boolean)}get finished(){return Promise.all(this.animations.map(e=>"finished"in e?e.finished:e))}getAll(e){return this.animations[0][e]}setAll(e,n){for(let t=0;t<this.animations.length;t++)this.animations[t][e]=n}attachTimeline(e,n){const t=this.animations.map(t=>Yt()&&t.attachTimeline?t.attachTimeline(e):"function"==typeof n?n(t):void 0);return()=>{t.forEach((e,n)=>{e&&e(),this.animations[n].stop()})}}get time(){return this.getAll("time")}set time(e){this.setAll("time",e)}get speed(){return this.getAll("speed")}set speed(e){this.setAll("speed",e)}get startTime(){return this.getAll("startTime")}get duration(){let e=0;for(let n=0;n<this.animations.length;n++)e=Math.max(e,this.animations[n].duration);return e}runAll(e){this.animations.forEach(n=>n[e]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class Gt extends Kt{then(e,n){return Promise.all(this.animations).then(e).catch(n)}}const Qt=e=>1e3*e,Xt=e=>e/1e3,Zt=!1;function Jt(e){return"function"==typeof e}function ei(e,n){e.timeline=n,e.onfinish=null}const ni=e=>Array.isArray(e)&&"number"==typeof e[0],ti={linearEasing:void 0};function ii(e,n){const t=qt(e);return()=>{var e;return null!==(e=ti[n])&&void 0!==e?e:t()}}const ri=ii(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch(e){return!1}return!0},"linearEasing"),ai=(e,n,t)=>{const i=n-e;return 0===i?1:(t-e)/i},oi=(e,n,t=10)=>{let i="";const r=Math.max(Math.round(n/t),2);for(let n=0;n<r;n++)i+=e(ai(0,r-1,n))+", ";return`linear(${i.substring(0,i.length-2)})`};function si(e){return Boolean("function"==typeof e&&ri()||!e||"string"==typeof e&&(e in ci||ri())||ni(e)||Array.isArray(e)&&e.every(si))}const li=([e,n,t,i])=>`cubic-bezier(${e}, ${n}, ${t}, ${i})`,ci={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:li([0,.65,.55,1]),circOut:li([.55,0,1,.45]),backIn:li([.31,.01,.66,-.59]),backOut:li([.33,1.53,.69,.99])};function ui(e,n){return e?"function"==typeof e&&ri()?oi(e,n):ni(e)?li(e):Array.isArray(e)?e.map(e=>ui(e,n)||ci.easeOut):ci[e]:void 0}const di=(e,n,t)=>(((1-3*t+3*n)*e+(3*t-6*n))*e+3*n)*e;function mi(e,n,t,i){if(e===n&&t===i)return jt;const r=n=>function(e,n,t,i,r){let a,o,s=0;do{o=n+(t-n)/2,a=di(o,i,r)-e,a>0?t=o:n=o}while(Math.abs(a)>1e-7&&++s<12);return o}(n,0,1,e,t);return e=>0===e||1===e?e:di(r(e),n,i)}const pi=e=>n=>n<=.5?e(2*n)/2:(2-e(2*(1-n)))/2,hi=e=>n=>1-e(1-n),vi=mi(.33,1.53,.69,.99),fi=hi(vi),gi=pi(fi),bi=e=>(e*=2)<1?.5*fi(e):.5*(2-Math.pow(2,-10*(e-1))),xi=e=>1-Math.sin(Math.acos(e)),yi=hi(xi),ki=pi(xi),wi=e=>/^0[^.\s]+$/u.test(e);function ji(e){return"number"==typeof e?0===e:null===e||("none"===e||"0"===e||wi(e))}const Si=(e,n,t)=>t>n?n:t<e?e:t,Ci={test:e=>"number"==typeof e,parse:parseFloat,transform:e=>e},Ni={...Ci,transform:e=>Si(0,1,e)},Pi={...Ci,default:1},Ei=e=>Math.round(1e5*e)/1e5,Mi=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;const Li=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,Oi=(e,n)=>t=>Boolean("string"==typeof t&&Li.test(t)&&t.startsWith(e)||n&&!function(e){return null==e}(t)&&Object.prototype.hasOwnProperty.call(t,n)),Ti=(e,n,t)=>i=>{if("string"!=typeof i)return i;const[r,a,o,s]=i.match(Mi);return{[e]:parseFloat(r),[n]:parseFloat(a),[t]:parseFloat(o),alpha:void 0!==s?parseFloat(s):1}},Di={...Ci,transform:e=>Math.round((e=>Si(0,255,e))(e))},zi={test:Oi("rgb","red"),parse:Ti("red","green","blue"),transform:({red:e,green:n,blue:t,alpha:i=1})=>"rgba("+Di.transform(e)+", "+Di.transform(n)+", "+Di.transform(t)+", "+Ei(Ni.transform(i))+")"};const Ii={test:Oi("#"),parse:function(e){let n="",t="",i="",r="";return e.length>5?(n=e.substring(1,3),t=e.substring(3,5),i=e.substring(5,7),r=e.substring(7,9)):(n=e.substring(1,2),t=e.substring(2,3),i=e.substring(3,4),r=e.substring(4,5),n+=n,t+=t,i+=i,r+=r),{red:parseInt(n,16),green:parseInt(t,16),blue:parseInt(i,16),alpha:r?parseInt(r,16)/255:1}},transform:zi.transform},Ai=e=>({test:n=>"string"==typeof n&&n.endsWith(e)&&1===n.split(" ").length,parse:parseFloat,transform:n=>`${n}${e}`}),Ri=Ai("deg"),Bi=Ai("%"),_i=Ai("px"),Ui=Ai("vh"),Fi=Ai("vw"),Vi={...Bi,parse:e=>Bi.parse(e)/100,transform:e=>Bi.transform(100*e)},Wi={test:Oi("hsl","hue"),parse:Ti("hue","saturation","lightness"),transform:({hue:e,saturation:n,lightness:t,alpha:i=1})=>"hsla("+Math.round(e)+", "+Bi.transform(Ei(n))+", "+Bi.transform(Ei(t))+", "+Ei(Ni.transform(i))+")"},Hi={test:e=>zi.test(e)||Ii.test(e)||Wi.test(e),parse:e=>zi.test(e)?zi.parse(e):Wi.test(e)?Wi.parse(e):Ii.parse(e),transform:e=>"string"==typeof e?e:e.hasOwnProperty("red")?zi.transform(e):Wi.transform(e)},$i=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;const qi="number",Yi="color",Ki=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Gi(e){const n=e.toString(),t=[],i={color:[],number:[],var:[]},r=[];let a=0;const o=n.replace(Ki,e=>(Hi.test(e)?(i.color.push(a),r.push(Yi),t.push(Hi.parse(e))):e.startsWith("var(")?(i.var.push(a),r.push("var"),t.push(e)):(i.number.push(a),r.push(qi),t.push(parseFloat(e))),++a,"${}")).split("${}");return{values:t,split:o,indexes:i,types:r}}function Qi(e){return Gi(e).values}function Xi(e){const{split:n,types:t}=Gi(e),i=n.length;return e=>{let r="";for(let a=0;a<i;a++)if(r+=n[a],void 0!==e[a]){const n=t[a];r+=n===qi?Ei(e[a]):n===Yi?Hi.transform(e[a]):e[a]}return r}}const Zi=e=>"number"==typeof e?0:e;const Ji={test:function(e){var n,t;return isNaN(e)&&"string"==typeof e&&((null===(n=e.match(Mi))||void 0===n?void 0:n.length)||0)+((null===(t=e.match($i))||void 0===t?void 0:t.length)||0)>0},parse:Qi,createTransformer:Xi,getAnimatableNone:function(e){const n=Qi(e);return Xi(e)(n.map(Zi))}},er=new Set(["brightness","contrast","saturate","opacity"]);function nr(e){const[n,t]=e.slice(0,-1).split("(");if("drop-shadow"===n)return e;const[i]=t.match(Mi)||[];if(!i)return e;const r=t.replace(i,"");let a=er.has(n)?1:0;return i!==t&&(a*=100),n+"("+a+r+")"}const tr=/\b([a-z-]*)\(.*?\)/gu,ir={...Ji,getAnimatableNone:e=>{const n=e.match(tr);return n?n.map(nr).join(" "):e}},rr={borderWidth:_i,borderTopWidth:_i,borderRightWidth:_i,borderBottomWidth:_i,borderLeftWidth:_i,borderRadius:_i,radius:_i,borderTopLeftRadius:_i,borderTopRightRadius:_i,borderBottomRightRadius:_i,borderBottomLeftRadius:_i,width:_i,maxWidth:_i,height:_i,maxHeight:_i,top:_i,right:_i,bottom:_i,left:_i,padding:_i,paddingTop:_i,paddingRight:_i,paddingBottom:_i,paddingLeft:_i,margin:_i,marginTop:_i,marginRight:_i,marginBottom:_i,marginLeft:_i,backgroundPositionX:_i,backgroundPositionY:_i},ar={rotate:Ri,rotateX:Ri,rotateY:Ri,rotateZ:Ri,scale:Pi,scaleX:Pi,scaleY:Pi,scaleZ:Pi,skew:Ri,skewX:Ri,skewY:Ri,distance:_i,translateX:_i,translateY:_i,translateZ:_i,x:_i,y:_i,z:_i,perspective:_i,transformPerspective:_i,opacity:Ni,originX:Vi,originY:Vi,originZ:_i},or={...Ci,transform:Math.round},sr={...rr,...ar,zIndex:or,size:_i,fillOpacity:Ni,strokeOpacity:Ni,numOctaves:or},lr={...sr,color:Hi,backgroundColor:Hi,outlineColor:Hi,fill:Hi,stroke:Hi,borderColor:Hi,borderTopColor:Hi,borderRightColor:Hi,borderBottomColor:Hi,borderLeftColor:Hi,filter:ir,WebkitFilter:ir},cr=e=>lr[e];function ur(e,n){let t=cr(e);return t!==ir&&(t=Ji),t.getAnimatableNone?t.getAnimatableNone(n):void 0}const dr=new Set(["auto","none","0"]);const mr=e=>e===Ci||e===_i,pr=(e,n)=>parseFloat(e.split(", ")[n]),hr=(e,n)=>(t,{transform:i})=>{if("none"===i||!i)return 0;const r=i.match(/^matrix3d\((.+)\)$/u);if(r)return pr(r[1],n);{const n=i.match(/^matrix\((.+)\)$/u);return n?pr(n[1],e):0}},vr=new Set(["x","y","z"]),fr=gt.filter(e=>!vr.has(e));const gr={width:({x:e},{paddingLeft:n="0",paddingRight:t="0"})=>e.max-e.min-parseFloat(n)-parseFloat(t),height:({y:e},{paddingTop:n="0",paddingBottom:t="0"})=>e.max-e.min-parseFloat(n)-parseFloat(t),top:(e,{top:n})=>parseFloat(n),left:(e,{left:n})=>parseFloat(n),bottom:({y:e},{top:n})=>parseFloat(n)+(e.max-e.min),right:({x:e},{left:n})=>parseFloat(n)+(e.max-e.min),x:hr(4,13),y:hr(5,14)};gr.translateX=gr.x,gr.translateY=gr.y;const br=new Set;let xr=!1,yr=!1;function kr(){if(yr){const e=Array.from(br).filter(e=>e.needsMeasurement),n=new Set(e.map(e=>e.element)),t=new Map;n.forEach(e=>{const n=function(e){const n=[];return fr.forEach(t=>{const i=e.getValue(t);void 0!==i&&(n.push([t,i.get()]),i.set(t.startsWith("scale")?1:0))}),n}(e);n.length&&(t.set(e,n),e.render())}),e.forEach(e=>e.measureInitialState()),n.forEach(e=>{e.render();const n=t.get(e);n&&n.forEach(([n,t])=>{var i;null===(i=e.getValue(n))||void 0===i||i.set(t)})}),e.forEach(e=>e.measureEndState()),e.forEach(e=>{void 0!==e.suspendedScrollY&&window.scrollTo(0,e.suspendedScrollY)})}yr=!1,xr=!1,br.forEach(e=>e.complete()),br.clear()}function wr(){br.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(yr=!0)})}class jr{constructor(e,n,t,i,r,a=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...e],this.onComplete=n,this.name=t,this.motionValue=i,this.element=r,this.isAsync=a}scheduleResolve(){this.isScheduled=!0,this.isAsync?(br.add(this),xr||(xr=!0,Nt.read(wr),Nt.resolveKeyframes(kr))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:n,element:t,motionValue:i}=this;for(let r=0;r<e.length;r++)if(null===e[r])if(0===r){const r=null==i?void 0:i.get(),a=e[e.length-1];if(void 0!==r)e[0]=r;else if(t&&n){const i=t.readValue(n,a);null!=i&&(e[0]=i)}void 0===e[0]&&(e[0]=a),i&&void 0===r&&i.set(e[0])}else e[r]=e[r-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),br.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,br.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}let Sr=jt,Cr=jt;const Nr=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e),Pr=e=>n=>"string"==typeof n&&n.startsWith(e),Er=Pr("--"),Mr=Pr("var(--"),Lr=e=>!!Mr(e)&&Or.test(e.split("/*")[0].trim()),Or=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,Tr=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function Dr(e,n,t=1){Cr(t<=4,`Max CSS variable fallback depth detected in property "${e}". This may indicate a circular fallback dependency.`);const[i,r]=function(e){const n=Tr.exec(e);if(!n)return[,];const[,t,i,r]=n;return[`--${null!=t?t:i}`,r]}(e);if(!i)return;const a=window.getComputedStyle(n).getPropertyValue(i);if(a){const e=a.trim();return Nr(e)?parseFloat(e):e}return Lr(r)?Dr(r,n,t+1):r}const zr=e=>n=>n.test(e),Ir=[Ci,_i,Bi,Ri,Fi,Ui,{test:e=>"auto"===e,parse:e=>e}],Ar=e=>Ir.find(zr(e));class Rr extends jr{constructor(e,n,t,i,r){super(e,n,t,i,r,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:n,name:t}=this;if(!n||!n.current)return;super.readKeyframes();for(let t=0;t<e.length;t++){let i=e[t];if("string"==typeof i&&(i=i.trim(),Lr(i))){const r=Dr(i,n.current);void 0!==r&&(e[t]=r),t===e.length-1&&(this.finalKeyframe=i)}}if(this.resolveNoneKeyframes(),!xt.has(t)||2!==e.length)return;const[i,r]=e,a=Ar(i),o=Ar(r);if(a!==o)if(mr(a)&&mr(o))for(let n=0;n<e.length;n++){const t=e[n];"string"==typeof t&&(e[n]=parseFloat(t))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:n}=this,t=[];for(let n=0;n<e.length;n++)ji(e[n])&&t.push(n);t.length&&function(e,n,t){let i,r=0;for(;r<e.length&&!i;){const n=e[r];"string"==typeof n&&!dr.has(n)&&Gi(n).values.length&&(i=e[r]),r++}if(i&&t)for(const r of n)e[r]=ur(t,i)}(e,t,n)}measureInitialState(){const{element:e,unresolvedKeyframes:n,name:t}=this;if(!e||!e.current)return;"height"===t&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=gr[t](e.measureViewportBox(),window.getComputedStyle(e.current)),n[0]=this.measuredOrigin;const i=n[n.length-1];void 0!==i&&e.getValue(t,i).jump(i,!1)}measureEndState(){var e;const{element:n,name:t,unresolvedKeyframes:i}=this;if(!n||!n.current)return;const r=n.getValue(t);r&&r.jump(this.measuredOrigin,!1);const a=i.length-1,o=i[a];i[a]=gr[t](n.measureViewportBox(),window.getComputedStyle(n.current)),null!==o&&void 0===this.finalKeyframe&&(this.finalKeyframe=o),(null===(e=this.removedTransforms)||void 0===e?void 0:e.length)&&this.removedTransforms.forEach(([e,t])=>{n.getValue(e).set(t)}),this.resolveNoneKeyframes()}}const Br=(e,n)=>"zIndex"!==n&&(!("number"!=typeof e&&!Array.isArray(e))||!("string"!=typeof e||!Ji.test(e)&&"0"!==e||e.startsWith("url(")));function _r(e,n,t,i){const r=e[0];if(null===r)return!1;if("display"===n||"visibility"===n)return!0;const a=e[e.length-1],o=Br(r,n),s=Br(a,n);return Sr(o===s,`You are trying to animate ${n} from "${r}" to "${a}". ${r} is not an animatable value - to enable this animation set ${r} to a value animatable to ${a} via the \`style\` property.`),!(!o||!s)&&(function(e){const n=e[0];if(1===e.length)return!0;for(let t=0;t<e.length;t++)if(e[t]!==n)return!0}(e)||("spring"===t||Jt(t))&&i)}const Ur=e=>null!==e;function Fr(e,{repeat:n,repeatType:t="loop"},i){const r=e.filter(Ur),a=n&&"loop"!==t&&n%2==1?0:r.length-1;return a&&void 0!==i?i:r[a]}class Vr{constructor({autoplay:e=!0,delay:n=0,type:t="keyframes",repeat:i=0,repeatDelay:r=0,repeatType:a="loop",...o}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=Tt.now(),this.options={autoplay:e,delay:n,type:t,repeat:i,repeatDelay:r,repeatType:a,...o},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt&&this.resolvedAt-this.createdAt>40?this.resolvedAt:this.createdAt}get resolved(){return this._resolved||this.hasAttemptedResolve||(wr(),kr()),this._resolved}onKeyframesResolved(e,n){this.resolvedAt=Tt.now(),this.hasAttemptedResolve=!0;const{name:t,type:i,velocity:r,delay:a,onComplete:o,onUpdate:s,isGenerator:l}=this.options;if(!l&&!_r(e,t,i,r)){if(Zt||!a)return s&&s(Fr(e,this.options,n)),o&&o(),void this.resolveFinishedPromise();this.options.duration=0}const c=this.initPlayback(e,n);!1!==c&&(this._resolved={keyframes:e,finalKeyframe:n,...c},this.onPostResolved())}onPostResolved(){}then(e,n){return this.currentFinishedPromise.then(e,n)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(e=>{this.resolveFinishedPromise=e})}}const Wr=2e4;function Hr(e){let n=0;let t=e.next(n);for(;!t.done&&n<Wr;)n+=50,t=e.next(n);return n>=Wr?1/0:n}const $r=(e,n,t)=>e+(n-e)*t;function qr(e,n,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?e+6*(n-e)*t:t<.5?n:t<2/3?e+(n-e)*(2/3-t)*6:e}function Yr(e,n){return t=>t>0?n:e}const Kr=(e,n,t)=>{const i=e*e,r=t*(n*n-i)+i;return r<0?0:Math.sqrt(r)},Gr=[Ii,zi,Wi];function Qr(e){const n=(t=e,Gr.find(e=>e.test(t)));var t;if(Sr(Boolean(n),`'${e}' is not an animatable color. Use the equivalent color code instead.`),!Boolean(n))return!1;let i=n.parse(e);return n===Wi&&(i=function({hue:e,saturation:n,lightness:t,alpha:i}){e/=360,t/=100;let r=0,a=0,o=0;if(n/=100){const i=t<.5?t*(1+n):t+n-t*n,s=2*t-i;r=qr(s,i,e+1/3),a=qr(s,i,e),o=qr(s,i,e-1/3)}else r=a=o=t;return{red:Math.round(255*r),green:Math.round(255*a),blue:Math.round(255*o),alpha:i}}(i)),i}const Xr=(e,n)=>{const t=Qr(e),i=Qr(n);if(!t||!i)return Yr(e,n);const r={...t};return e=>(r.red=Kr(t.red,i.red,e),r.green=Kr(t.green,i.green,e),r.blue=Kr(t.blue,i.blue,e),r.alpha=$r(t.alpha,i.alpha,e),zi.transform(r))},Zr=(e,n)=>t=>n(e(t)),Jr=(...e)=>e.reduce(Zr),ea=new Set(["none","hidden"]);function na(e,n){return t=>$r(e,n,t)}function ta(e){return"number"==typeof e?na:"string"==typeof e?Lr(e)?Yr:Hi.test(e)?Xr:aa:Array.isArray(e)?ia:"object"==typeof e?Hi.test(e)?Xr:ra:Yr}function ia(e,n){const t=[...e],i=t.length,r=e.map((e,t)=>ta(e)(e,n[t]));return e=>{for(let n=0;n<i;n++)t[n]=r[n](e);return t}}function ra(e,n){const t={...e,...n},i={};for(const r in t)void 0!==e[r]&&void 0!==n[r]&&(i[r]=ta(e[r])(e[r],n[r]));return e=>{for(const n in i)t[n]=i[n](e);return t}}const aa=(e,n)=>{const t=Ji.createTransformer(n),i=Gi(e),r=Gi(n);return i.indexes.var.length===r.indexes.var.length&&i.indexes.color.length===r.indexes.color.length&&i.indexes.number.length>=r.indexes.number.length?ea.has(e)&&!r.values.length||ea.has(n)&&!i.values.length?function(e,n){return ea.has(e)?t=>t<=0?e:n:t=>t>=1?n:e}(e,n):Jr(ia(function(e,n){var t;const i=[],r={color:0,var:0,number:0};for(let a=0;a<n.values.length;a++){const o=n.types[a],s=e.indexes[o][r[o]],l=null!==(t=e.values[s])&&void 0!==t?t:0;i[a]=l,r[o]++}return i}(i,r),r.values),t):(Sr(!0,`Complex values '${e}' and '${n}' too different to mix. Ensure all colors are of the same type, and that each contains the same quantity of number and color values. Falling back to instant transition.`),Yr(e,n))};function oa(e,n,t){if("number"==typeof e&&"number"==typeof n&&"number"==typeof t)return $r(e,n,t);return ta(e)(e,n)}function sa(e,n,t){const i=Math.max(n-5,0);return At(t-e(i),n-i)}const la=100,ca=10,ua=1,da=0,ma=800,pa=.3,ha=.3,va={granular:.01,default:2},fa={granular:.005,default:.5},ga=.01,ba=10,xa=.05,ya=1,ka=.001;function wa({duration:e=ma,bounce:n=pa,velocity:t=da,mass:i=ua}){let r,a;Sr(e<=Qt(ba),"Spring duration must be 10 seconds or less");let o=1-n;o=Si(xa,ya,o),e=Si(ga,ba,Xt(e)),o<1?(r=n=>{const i=n*o,r=i*e,a=i-t,s=Sa(n,o),l=Math.exp(-r);return ka-a/s*l},a=n=>{const i=n*o*e,a=i*t+t,s=Math.pow(o,2)*Math.pow(n,2)*e,l=Math.exp(-i),c=Sa(Math.pow(n,2),o);return(-r(n)+ka>0?-1:1)*((a-s)*l)/c}):(r=n=>Math.exp(-n*e)*((n-t)*e+1)-.001,a=n=>Math.exp(-n*e)*(e*e*(t-n)));const s=function(e,n,t){let i=t;for(let t=1;t<ja;t++)i-=e(i)/n(i);return i}(r,a,5/e);if(e=Qt(e),isNaN(s))return{stiffness:la,damping:ca,duration:e};{const n=Math.pow(s,2)*i;return{stiffness:n,damping:2*o*Math.sqrt(i*n),duration:e}}}const ja=12;function Sa(e,n){return e*Math.sqrt(1-n*n)}const Ca=["duration","bounce"],Na=["stiffness","damping","mass"];function Pa(e,n){return n.some(n=>void 0!==e[n])}function Ea(e=ha,n=pa){const t="object"!=typeof e?{visualDuration:e,keyframes:[0,1],bounce:n}:e;let{restSpeed:i,restDelta:r}=t;const a=t.keyframes[0],o=t.keyframes[t.keyframes.length-1],s={done:!1,value:a},{stiffness:l,damping:c,mass:u,duration:d,velocity:m,isResolvedFromDuration:p}=function(e){let n={velocity:da,stiffness:la,damping:ca,mass:ua,isResolvedFromDuration:!1,...e};if(!Pa(e,Na)&&Pa(e,Ca))if(e.visualDuration){const t=e.visualDuration,i=2*Math.PI/(1.2*t),r=i*i,a=2*Si(.05,1,1-(e.bounce||0))*Math.sqrt(r);n={...n,mass:ua,stiffness:r,damping:a}}else{const t=wa(e);n={...n,...t,mass:ua},n.isResolvedFromDuration=!0}return n}({...t,velocity:-Xt(t.velocity||0)}),h=m||0,v=c/(2*Math.sqrt(l*u)),f=o-a,g=Xt(Math.sqrt(l/u)),b=Math.abs(f)<5;let x;if(i||(i=b?va.granular:va.default),r||(r=b?fa.granular:fa.default),v<1){const e=Sa(g,v);x=n=>{const t=Math.exp(-v*g*n);return o-t*((h+v*g*f)/e*Math.sin(e*n)+f*Math.cos(e*n))}}else if(1===v)x=e=>o-Math.exp(-g*e)*(f+(h+g*f)*e);else{const e=g*Math.sqrt(v*v-1);x=n=>{const t=Math.exp(-v*g*n),i=Math.min(e*n,300);return o-t*((h+v*g*f)*Math.sinh(i)+e*f*Math.cosh(i))/e}}const y={calculatedDuration:p&&d||null,next:e=>{const n=x(e);if(p)s.done=e>=d;else{let t=0;v<1&&(t=0===e?Qt(h):sa(x,e,n));const a=Math.abs(t)<=i,l=Math.abs(o-n)<=r;s.done=a&&l}return s.value=s.done?o:n,s},toString:()=>{const e=Math.min(Hr(y),Wr),n=oi(n=>y.next(e*n).value,e,30);return e+"ms "+n}};return y}function Ma({keyframes:e,velocity:n=0,power:t=.8,timeConstant:i=325,bounceDamping:r=10,bounceStiffness:a=500,modifyTarget:o,min:s,max:l,restDelta:c=.5,restSpeed:u}){const d=e[0],m={done:!1,value:d},p=e=>void 0===s?l:void 0===l||Math.abs(s-e)<Math.abs(l-e)?s:l;let h=t*n;const v=d+h,f=void 0===o?v:o(v);f!==v&&(h=f-d);const g=e=>-h*Math.exp(-e/i),b=e=>f+g(e),x=e=>{const n=g(e),t=b(e);m.done=Math.abs(n)<=c,m.value=m.done?f:t};let y,k;const w=e=>{var n;(n=m.value,void 0!==s&&n<s||void 0!==l&&n>l)&&(y=e,k=Ea({keyframes:[m.value,p(m.value)],velocity:sa(b,e,m.value),damping:r,stiffness:a,restDelta:c,restSpeed:u}))};return w(0),{calculatedDuration:null,next:e=>{let n=!1;return k||void 0!==y||(n=!0,x(e),w(e)),void 0!==y&&e>=y?k.next(e-y):(!n&&x(e),m)}}}const La=mi(.42,0,1,1),Oa=mi(0,0,.58,1),Ta=mi(.42,0,.58,1),Da={linear:jt,easeIn:La,easeInOut:Ta,easeOut:Oa,circIn:xi,circInOut:ki,circOut:yi,backIn:fi,backInOut:gi,backOut:vi,anticipate:bi},za=e=>{if(ni(e)){Cr(4===e.length,"Cubic bezier arrays must contain four numerical values.");const[n,t,i,r]=e;return mi(n,t,i,r)}return"string"==typeof e?(Cr(void 0!==Da[e],`Invalid easing type '${e}'`),Da[e]):e};function Ia(e,n,{clamp:t=!0,ease:i,mixer:r}={}){const a=e.length;if(Cr(a===n.length,"Both input and output ranges must be the same length"),1===a)return()=>n[0];if(2===a&&n[0]===n[1])return()=>n[1];const o=e[0]===e[1];e[0]>e[a-1]&&(e=[...e].reverse(),n=[...n].reverse());const s=function(e,n,t){const i=[],r=t||oa,a=e.length-1;for(let t=0;t<a;t++){let a=r(e[t],e[t+1]);if(n){const e=Array.isArray(n)?n[t]||jt:n;a=Jr(e,a)}i.push(a)}return i}(n,i,r),l=s.length,c=t=>{if(o&&t<e[0])return n[0];let i=0;if(l>1)for(;i<e.length-2&&!(t<e[i+1]);i++);const r=ai(e[i],e[i+1],t);return s[i](r)};return t?n=>c(Si(e[0],e[a-1],n)):c}function Aa(e){const n=[0];return function(e,n){const t=e[e.length-1];for(let i=1;i<=n;i++){const r=ai(0,n,i);e.push($r(t,1,r))}}(n,e.length-1),n}function Ra({duration:e=300,keyframes:n,times:t,ease:i="easeInOut"}){const r=(e=>Array.isArray(e)&&"number"!=typeof e[0])(i)?i.map(za):za(i),a={done:!1,value:n[0]},o=function(e,n){return e.map(e=>e*n)}(t&&t.length===n.length?t:Aa(n),e),s=Ia(o,n,{ease:Array.isArray(r)?r:(l=n,c=r,l.map(()=>c||Ta).splice(0,l.length-1))});var l,c;return{calculatedDuration:e,next:n=>(a.value=s(n),a.done=n>=e,a)}}const Ba=e=>{const n=({timestamp:n})=>e(n);return{start:()=>Nt.update(n,!0),stop:()=>Pt(n),now:()=>Et.isProcessing?Et.timestamp:Tt.now()}},_a={decay:Ma,inertia:Ma,tween:Ra,keyframes:Ra,spring:Ea},Ua=e=>e/100;class Fa extends Vr{constructor(e){super(e),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,"idle"===this.state)return;this.teardown();const{onStop:e}=this.options;e&&e()};const{name:n,motionValue:t,element:i,keyframes:r}=this.options,a=(null==i?void 0:i.KeyframeResolver)||jr;this.resolver=new a(r,(e,n)=>this.onKeyframesResolved(e,n),n,t,i),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(e){const{type:n="keyframes",repeat:t=0,repeatDelay:i=0,repeatType:r,velocity:a=0}=this.options,o=Jt(n)?n:_a[n]||Ra;let s,l;o!==Ra&&"number"!=typeof e[0]&&(s=Jr(Ua,oa(e[0],e[1])),e=[0,100]);const c=o({...this.options,keyframes:e});"mirror"===r&&(l=o({...this.options,keyframes:[...e].reverse(),velocity:-a})),null===c.calculatedDuration&&(c.calculatedDuration=Hr(c));const{calculatedDuration:u}=c,d=u+i;return{generator:c,mirroredGenerator:l,mapPercentToKeyframes:s,calculatedDuration:u,resolvedDuration:d,totalDuration:d*(t+1)-i}}onPostResolved(){const{autoplay:e=!0}=this.options;this.play(),"paused"!==this.pendingPlayState&&e?this.state=this.pendingPlayState:this.pause()}tick(e,n=!1){const{resolved:t}=this;if(!t){const{keyframes:e}=this.options;return{done:!0,value:e[e.length-1]}}const{finalKeyframe:i,generator:r,mirroredGenerator:a,mapPercentToKeyframes:o,keyframes:s,calculatedDuration:l,totalDuration:c,resolvedDuration:u}=t;if(null===this.startTime)return r.next(0);const{delay:d,repeat:m,repeatType:p,repeatDelay:h,onUpdate:v}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-c/this.speed,this.startTime)),n?this.currentTime=e:null!==this.holdTime?this.currentTime=this.holdTime:this.currentTime=Math.round(e-this.startTime)*this.speed;const f=this.currentTime-d*(this.speed>=0?1:-1),g=this.speed>=0?f<0:f>c;this.currentTime=Math.max(f,0),"finished"===this.state&&null===this.holdTime&&(this.currentTime=c);let b=this.currentTime,x=r;if(m){const e=Math.min(this.currentTime,c)/u;let n=Math.floor(e),t=e%1;!t&&e>=1&&(t=1),1===t&&n--,n=Math.min(n,m+1);Boolean(n%2)&&("reverse"===p?(t=1-t,h&&(t-=h/u)):"mirror"===p&&(x=a)),b=Si(0,1,t)*u}const y=g?{done:!1,value:s[0]}:x.next(b);o&&(y.value=o(y.value));let{done:k}=y;g||null===l||(k=this.speed>=0?this.currentTime>=c:this.currentTime<=0);const w=null===this.holdTime&&("finished"===this.state||"running"===this.state&&k);return w&&void 0!==i&&(y.value=Fr(s,this.options,i)),v&&v(y.value),w&&this.finish(),y}get duration(){const{resolved:e}=this;return e?Xt(e.calculatedDuration):0}get time(){return Xt(this.currentTime)}set time(e){e=Qt(e),this.currentTime=e,null!==this.holdTime||0===this.speed?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.speed)}get speed(){return this.playbackSpeed}set speed(e){const n=this.playbackSpeed!==e;this.playbackSpeed=e,n&&(this.time=Xt(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved)return void(this.pendingPlayState="running");if(this.isStopped)return;const{driver:e=Ba,onPlay:n,startTime:t}=this.options;this.driver||(this.driver=e(e=>this.tick(e))),n&&n();const i=this.driver.now();null!==this.holdTime?this.startTime=i-this.holdTime:this.startTime?"finished"===this.state&&(this.startTime=i):this.startTime=null!=t?t:this.calcStartTime(),"finished"===this.state&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var e;this._resolved?(this.state="paused",this.holdTime=null!==(e=this.currentTime)&&void 0!==e?e:0):this.pendingPlayState="paused"}complete(){"running"!==this.state&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:e}=this.options;e&&e()}cancel(){null!==this.cancelTime&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}}const Va=new Set(["opacity","clipPath","filter","transform"]);function Wa(e,n,t,{delay:i=0,duration:r=300,repeat:a=0,repeatType:o="loop",ease:s="easeInOut",times:l}={}){const c={[n]:t};l&&(c.offset=l);const u=ui(s,r);return Array.isArray(u)&&(c.easing=u),e.animate(c,{delay:i,duration:r,easing:Array.isArray(u)?"linear":u,fill:"both",iterations:a+1,direction:"reverse"===o?"alternate":"normal"})}const Ha=qt(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));const $a={anticipate:bi,backInOut:gi,circInOut:ki};class qa extends Vr{constructor(e){super(e);const{name:n,motionValue:t,element:i,keyframes:r}=this.options;this.resolver=new Rr(r,(e,n)=>this.onKeyframesResolved(e,n),n,t,i),this.resolver.scheduleResolve()}initPlayback(e,n){let{duration:t=300,times:i,ease:r,type:a,motionValue:o,name:s,startTime:l}=this.options;if(!o.owner||!o.owner.current)return!1;if("string"==typeof r&&ri()&&r in $a&&(r=$a[r]),function(e){return Jt(e.type)||"spring"===e.type||!si(e.ease)}(this.options)){const{onComplete:n,onUpdate:o,motionValue:s,element:l,...c}=this.options,u=function(e,n){const t=new Fa({...n,keyframes:e,repeat:0,delay:0,isGenerator:!0});let i={done:!1,value:e[0]};const r=[];let a=0;for(;!i.done&&a<2e4;)i=t.sample(a),r.push(i.value),a+=10;return{times:void 0,keyframes:r,duration:a-10,ease:"linear"}}(e,c);1===(e=u.keyframes).length&&(e[1]=e[0]),t=u.duration,i=u.times,r=u.ease,a="keyframes"}const c=Wa(o.owner.current,s,e,{...this.options,duration:t,times:i,ease:r});return c.startTime=null!=l?l:this.calcStartTime(),this.pendingTimeline?(ei(c,this.pendingTimeline),this.pendingTimeline=void 0):c.onfinish=()=>{const{onComplete:t}=this.options;o.set(Fr(e,this.options,n)),t&&t(),this.cancel(),this.resolveFinishedPromise()},{animation:c,duration:t,times:i,type:a,ease:r,keyframes:e}}get duration(){const{resolved:e}=this;if(!e)return 0;const{duration:n}=e;return Xt(n)}get time(){const{resolved:e}=this;if(!e)return 0;const{animation:n}=e;return Xt(n.currentTime||0)}set time(e){const{resolved:n}=this;if(!n)return;const{animation:t}=n;t.currentTime=Qt(e)}get speed(){const{resolved:e}=this;if(!e)return 1;const{animation:n}=e;return n.playbackRate}set speed(e){const{resolved:n}=this;if(!n)return;const{animation:t}=n;t.playbackRate=e}get state(){const{resolved:e}=this;if(!e)return"idle";const{animation:n}=e;return n.playState}get startTime(){const{resolved:e}=this;if(!e)return null;const{animation:n}=e;return n.startTime}attachTimeline(e){if(this._resolved){const{resolved:n}=this;if(!n)return jt;const{animation:t}=n;ei(t,e)}else this.pendingTimeline=e;return jt}play(){if(this.isStopped)return;const{resolved:e}=this;if(!e)return;const{animation:n}=e;"finished"===n.playState&&this.updateFinishedPromise(),n.play()}pause(){const{resolved:e}=this;if(!e)return;const{animation:n}=e;n.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,"idle"===this.state)return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:e}=this;if(!e)return;const{animation:n,keyframes:t,duration:i,type:r,ease:a,times:o}=e;if("idle"===n.playState||"finished"===n.playState)return;if(this.time){const{motionValue:e,onUpdate:n,onComplete:s,element:l,...c}=this.options,u=new Fa({...c,keyframes:t,duration:i,type:r,ease:a,times:o,isGenerator:!0}),d=Qt(this.time);e.setWithVelocity(u.sample(d-10).value,u.sample(d).value,10)}const{onStop:s}=this.options;s&&s(),this.cancel()}complete(){const{resolved:e}=this;e&&e.animation.finish()}cancel(){const{resolved:e}=this;e&&e.animation.cancel()}static supports(e){const{motionValue:n,name:t,repeatDelay:i,repeatType:r,damping:a,type:o}=e;if(!(n&&n.owner&&n.owner.current instanceof HTMLElement))return!1;const{onUpdate:s,transformTemplate:l}=n.owner.getProps();return Ha()&&t&&Va.has(t)&&!s&&!l&&!i&&"mirror"!==r&&0!==a&&"inertia"!==o}}const Ya={type:"spring",stiffness:500,damping:25,restSpeed:10},Ka={type:"keyframes",duration:.8},Ga={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},Qa=(e,{keyframes:n})=>n.length>2?Ka:bt.has(e)?e.startsWith("scale")?{type:"spring",stiffness:550,damping:0===n[1]?2*Math.sqrt(550):30,restSpeed:10}:Ya:Ga;const Xa=(e,n,t,i={},r,a)=>o=>{const s=ft(i,e)||{},l=s.delay||i.delay||0;let{elapsed:c=0}=i;c-=Qt(l);let u={keyframes:Array.isArray(t)?t:[null,t],ease:"easeOut",velocity:n.getVelocity(),...s,delay:-c,onUpdate:e=>{n.set(e),s.onUpdate&&s.onUpdate(e)},onComplete:()=>{o(),s.onComplete&&s.onComplete()},name:e,motionValue:n,element:a?void 0:r};(function({when:e,delay:n,delayChildren:t,staggerChildren:i,staggerDirection:r,repeat:a,repeatType:o,repeatDelay:s,from:l,elapsed:c,...u}){return!!Object.keys(u).length})(s)||(u={...u,...Qa(e,u)}),u.duration&&(u.duration=Qt(u.duration)),u.repeatDelay&&(u.repeatDelay=Qt(u.repeatDelay)),void 0!==u.from&&(u.keyframes[0]=u.from);let d=!1;if((!1===u.type||0===u.duration&&!u.repeatDelay)&&(u.duration=0,0===u.delay&&(d=!0)),(Zt||kt)&&(d=!0,u.duration=0,u.delay=0),d&&!a&&void 0!==n.get()){const e=Fr(u.keyframes,s);if(void 0!==e)return Nt.update(()=>{u.onUpdate(e),u.onComplete()}),new Gt([])}return!a&&qa.supports(u)?new qa(u):new Fa(u)};function Za({protectedKeys:e,needsAnimating:n},t){const i=e.hasOwnProperty(t)&&!0!==n[t];return n[t]=!1,i}function Ja(e,n,{delay:t=0,transitionOverride:i,type:r}={}){var a;let{transition:o=e.getDefaultTransition(),transitionEnd:s,...l}=n;i&&(o=i);const c=[],u=r&&e.animationState&&e.animationState.getState()[r];for(const n in l){const i=e.getValue(n,null!==(a=e.latestValues[n])&&void 0!==a?a:null),r=l[n];if(void 0===r||u&&Za(u,n))continue;const s={delay:t,...ft(o||{},n)};let d=!1;if(window.MotionHandoffAnimation){const t=$t(e);if(t){const e=window.MotionHandoffAnimation(t,n,Nt);null!==e&&(s.startTime=e,d=!0)}}Vt(e,n),i.start(Xa(n,i,r,e.shouldReduceMotion&&xt.has(n)?{type:!1}:s,e,d));const m=i.animation;m&&c.push(m)}return s&&Promise.all(c).then(()=>{Nt.update(()=>{s&&function(e,n){const t=pt(e,n);let{transitionEnd:i={},transition:r={},...a}=t||{};a={...a,...i};for(const n in a)Ut(e,n,yt(a[n]))}(e,s)})}),c}function eo(e,n,t={}){var i;const r=pt(e,n,"exit"===t.type?null===(i=e.presenceContext)||void 0===i?void 0:i.custom:void 0);let{transition:a=e.getDefaultTransition()||{}}=r||{};t.transitionOverride&&(a=t.transitionOverride);const o=r?()=>Promise.all(Ja(e,r,t)):()=>Promise.resolve(),s=e.variantChildren&&e.variantChildren.size?(i=0)=>{const{delayChildren:r=0,staggerChildren:o,staggerDirection:s}=a;return function(e,n,t=0,i=0,r=1,a){const o=[],s=(e.variantChildren.size-1)*i,l=1===r?(e=0)=>e*i:(e=0)=>s-e*i;return Array.from(e.variantChildren).sort(no).forEach((e,i)=>{e.notify("AnimationStart",n),o.push(eo(e,n,{...a,delay:t+l(i)}).then(()=>e.notify("AnimationComplete",n)))}),Promise.all(o)}(e,n,r+i,o,s,t)}:()=>Promise.resolve(),{when:l}=a;if(l){const[e,n]="beforeChildren"===l?[o,s]:[s,o];return e().then(()=>n())}return Promise.all([o(),s(t.delay)])}function no(e,n){return e.sortNodePosition(n)}const to=vt.length;function io(e){if(!e)return;if(!e.isControllingVariants){const n=e.parent&&io(e.parent)||{};return void 0!==e.props.initial&&(n.initial=e.props.initial),n}const n={};for(let t=0;t<to;t++){const i=vt[t],r=e.props[i];(ut(r)||!1===r)&&(n[i]=r)}return n}const ro=[...ht].reverse(),ao=ht.length;function oo(e){return n=>Promise.all(n.map(({animation:n,options:t})=>function(e,n,t={}){let i;if(e.notify("AnimationStart",n),Array.isArray(n)){const r=n.map(n=>eo(e,n,t));i=Promise.all(r)}else if("string"==typeof n)i=eo(e,n,t);else{const r="function"==typeof n?pt(e,n,t.custom):n;i=Promise.all(Ja(e,r,t))}return i.then(()=>{e.notify("AnimationComplete",n)})}(e,n,t)))}function so(e){let n=oo(e),t=uo(),i=!0;const r=n=>(t,i)=>{var r;const a=pt(e,i,"exit"===n?null===(r=e.presenceContext)||void 0===r?void 0:r.custom:void 0);if(a){const{transition:e,transitionEnd:n,...i}=a;t={...t,...i,...n}}return t};function a(a){const{props:o}=e,s=io(e.parent)||{},l=[],c=new Set;let u={},d=1/0;for(let n=0;n<ao;n++){const m=ro[n],p=t[m],h=void 0!==o[m]?o[m]:s[m],v=ut(h),f=m===a?p.isActive:null;!1===f&&(d=n);let g=h===s[m]&&h!==o[m]&&v;if(g&&i&&e.manuallyAnimateOnMount&&(g=!1),p.protectedKeys={...u},!p.isActive&&null===f||!h&&!p.prevProp||st(h)||"boolean"==typeof h)continue;const b=lo(p.prevProp,h);let x=b||m===a&&p.isActive&&!g&&v||n>d&&v,y=!1;const k=Array.isArray(h)?h:[h];let w=k.reduce(r(m),{});!1===f&&(w={});const{prevResolvedValues:j={}}=p,S={...j,...w},C=n=>{x=!0,c.has(n)&&(y=!0,c.delete(n)),p.needsAnimating[n]=!0;const t=e.getValue(n);t&&(t.liveStyle=!1)};for(const e in S){const n=w[e],t=j[e];if(u.hasOwnProperty(e))continue;let i=!1;i=lt(n)&&lt(t)?!ct(n,t):n!==t,i?null!=n?C(e):c.add(e):void 0!==n&&c.has(e)?C(e):p.protectedKeys[e]=!0}p.prevProp=h,p.prevResolvedValues=w,p.isActive&&(u={...u,...w}),i&&e.blockInitialAnimation&&(x=!1);x&&(!(g&&b)||y)&&l.push(...k.map(e=>({animation:e,options:{type:m}})))}if(c.size){const n={};c.forEach(t=>{const i=e.getBaseTarget(t),r=e.getValue(t);r&&(r.liveStyle=!0),n[t]=null!=i?i:null}),l.push({animation:n})}let m=Boolean(l.length);return!i||!1!==o.initial&&o.initial!==o.animate||e.manuallyAnimateOnMount||(m=!1),i=!1,m?n(l):Promise.resolve()}return{animateChanges:a,setActive:function(n,i){var r;if(t[n].isActive===i)return Promise.resolve();null===(r=e.variantChildren)||void 0===r||r.forEach(e=>{var t;return null===(t=e.animationState)||void 0===t?void 0:t.setActive(n,i)}),t[n].isActive=i;const o=a(n);for(const e in t)t[e].protectedKeys={};return o},setAnimateFunction:function(t){n=t(e)},getState:()=>t,reset:()=>{t=uo(),i=!0}}}function lo(e,n){return"string"==typeof n?n!==e:!!Array.isArray(n)&&!ct(n,e)}function co(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function uo(){return{animate:co(!0),whileInView:co(),whileHover:co(),whileTap:co(),whileDrag:co(),whileFocus:co(),exit:co()}}class mo{constructor(e){this.isMounted=!1,this.node=e}update(){}}let po=0;const ho={animation:{Feature:class extends mo{constructor(e){super(e),e.animationState||(e.animationState=so(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();st(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:n}=this.node.prevProps||{};e!==n&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),null===(e=this.unmountControls)||void 0===e||e.call(this)}}},exit:{Feature:class extends mo{constructor(){super(...arguments),this.id=po++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:n}=this.node.presenceContext,{isPresent:t}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===t)return;const i=this.node.animationState.setActive("exit",!e);n&&!e&&i.then(()=>n(this.id))}mount(){const{register:e}=this.node.presenceContext||{};e&&(this.unmount=e(this.id))}unmount(){}}}},vo={x:!1,y:!1};function fo(){return vo.x||vo.y}const go=e=>"mouse"===e.pointerType?"number"!=typeof e.button||e.button<=0:!1!==e.isPrimary;function bo(e,n,t,i={passive:!0}){return e.addEventListener(n,t,i),()=>e.removeEventListener(n,t)}function xo(e){return{point:{x:e.pageX,y:e.pageY}}}function yo(e,n,t,i){return bo(e,n,(e=>n=>go(n)&&e(n,xo(n)))(t),i)}const ko=(e,n)=>Math.abs(e-n);class wo{constructor(e,n,{transformPagePoint:t,contextWindow:i,dragSnapToOrigin:r=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!this.lastMoveEvent||!this.lastMoveEventInfo)return;const e=Co(this.lastMoveEventInfo,this.history),n=null!==this.startEvent,t=function(e,n){const t=ko(e.x,n.x),i=ko(e.y,n.y);return Math.sqrt(t**2+i**2)}(e.offset,{x:0,y:0})>=3;if(!n&&!t)return;const{point:i}=e,{timestamp:r}=Et;this.history.push({...i,timestamp:r});const{onStart:a,onMove:o}=this.handlers;n||(a&&a(this.lastMoveEvent,e),this.startEvent=this.lastMoveEvent),o&&o(this.lastMoveEvent,e)},this.handlePointerMove=(e,n)=>{this.lastMoveEvent=e,this.lastMoveEventInfo=jo(n,this.transformPagePoint),Nt.update(this.updatePoint,!0)},this.handlePointerUp=(e,n)=>{this.end();const{onEnd:t,onSessionEnd:i,resumeAnimation:r}=this.handlers;if(this.dragSnapToOrigin&&r&&r(),!this.lastMoveEvent||!this.lastMoveEventInfo)return;const a=Co("pointercancel"===e.type?this.lastMoveEventInfo:jo(n,this.transformPagePoint),this.history);this.startEvent&&t&&t(e,a),i&&i(e,a)},!go(e))return;this.dragSnapToOrigin=r,this.handlers=n,this.transformPagePoint=t,this.contextWindow=i||window;const a=jo(xo(e),this.transformPagePoint),{point:o}=a,{timestamp:s}=Et;this.history=[{...o,timestamp:s}];const{onSessionStart:l}=n;l&&l(e,Co(a,this.history)),this.removeListeners=Jr(yo(this.contextWindow,"pointermove",this.handlePointerMove),yo(this.contextWindow,"pointerup",this.handlePointerUp),yo(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),Pt(this.updatePoint)}}function jo(e,n){return n?{point:n(e.point)}:e}function So(e,n){return{x:e.x-n.x,y:e.y-n.y}}function Co({point:e},n){return{point:e,delta:So(e,Po(n)),offset:So(e,No(n)),velocity:Eo(n,.1)}}function No(e){return e[0]}function Po(e){return e[e.length-1]}function Eo(e,n){if(e.length<2)return{x:0,y:0};let t=e.length-1,i=null;const r=Po(e);for(;t>=0&&(i=e[t],!(r.timestamp-i.timestamp>Qt(n)));)t--;if(!i)return{x:0,y:0};const a=Xt(r.timestamp-i.timestamp);if(0===a)return{x:0,y:0};const o={x:(r.x-i.x)/a,y:(r.y-i.y)/a};return o.x===1/0&&(o.x=0),o.y===1/0&&(o.y=0),o}function Mo(e){return e&&"object"==typeof e&&Object.prototype.hasOwnProperty.call(e,"current")}function Lo(e){return e.max-e.min}function Oo(e,n,t,i=.5){e.origin=i,e.originPoint=$r(n.min,n.max,e.origin),e.scale=Lo(t)/Lo(n),e.translate=$r(t.min,t.max,e.origin)-e.originPoint,(e.scale>=.9999&&e.scale<=1.0001||isNaN(e.scale))&&(e.scale=1),(e.translate>=-.01&&e.translate<=.01||isNaN(e.translate))&&(e.translate=0)}function To(e,n,t,i){Oo(e.x,n.x,t.x,i?i.originX:void 0),Oo(e.y,n.y,t.y,i?i.originY:void 0)}function Do(e,n,t){e.min=t.min+n.min,e.max=e.min+Lo(n)}function zo(e,n,t){e.min=n.min-t.min,e.max=e.min+Lo(n)}function Io(e,n,t){zo(e.x,n.x,t.x),zo(e.y,n.y,t.y)}function Ao(e,n,t){return{min:void 0!==n?e.min+n:void 0,max:void 0!==t?e.max+t-(e.max-e.min):void 0}}function Ro(e,n){let t=n.min-e.min,i=n.max-e.max;return n.max-n.min<e.max-e.min&&([t,i]=[i,t]),{min:t,max:i}}const Bo=.35;function _o(e,n,t){return{min:Uo(e,n),max:Uo(e,t)}}function Uo(e,n){return"number"==typeof e?e:e[n]||0}const Fo=()=>({x:{min:0,max:0},y:{min:0,max:0}});function Vo(e){return[e("x"),e("y")]}function Wo({top:e,left:n,right:t,bottom:i}){return{x:{min:n,max:t},y:{min:e,max:i}}}function Ho(e){return void 0===e||1===e}function $o({scale:e,scaleX:n,scaleY:t}){return!Ho(e)||!Ho(n)||!Ho(t)}function qo(e){return $o(e)||Yo(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function Yo(e){return Ko(e.x)||Ko(e.y)}function Ko(e){return e&&"0%"!==e}function Go(e,n,t){return t+n*(e-t)}function Qo(e,n,t,i,r){return void 0!==r&&(e=Go(e,r,i)),Go(e,t,i)+n}function Xo(e,n=0,t=1,i,r){e.min=Qo(e.min,n,t,i,r),e.max=Qo(e.max,n,t,i,r)}function Zo(e,{x:n,y:t}){Xo(e.x,n.translate,n.scale,n.originPoint),Xo(e.y,t.translate,t.scale,t.originPoint)}const Jo=.999999999999,es=1.0000000000001;function ns(e,n){e.min=e.min+n,e.max=e.max+n}function ts(e,n,t,i,r=.5){Xo(e,n,t,$r(e.min,e.max,r),i)}function is(e,n){ts(e.x,n.x,n.scaleX,n.scale,n.originX),ts(e.y,n.y,n.scaleY,n.scale,n.originY)}function rs(e,n){return Wo(function(e,n){if(!n)return e;const t=n({x:e.left,y:e.top}),i=n({x:e.right,y:e.bottom});return{top:t.y,left:t.x,bottom:i.y,right:i.x}}(e.getBoundingClientRect(),n))}const as=({current:e})=>e?e.ownerDocument.defaultView:null,os=new WeakMap;class ss{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic={x:{min:0,max:0},y:{min:0,max:0}},this.visualElement=e}start(e,{snapToCursor:n=!1}={}){const{presenceContext:t}=this.visualElement;if(t&&!1===t.isPresent)return;const{dragSnapToOrigin:i}=this.getProps();this.panSession=new wo(e,{onSessionStart:e=>{const{dragSnapToOrigin:t}=this.getProps();t?this.pauseAnimation():this.stopAnimation(),n&&this.snapToCursor(xo(e).point)},onStart:(e,n)=>{const{drag:t,dragPropagation:i,onDragStart:r}=this.getProps();if(t&&!i&&(this.openDragLock&&this.openDragLock(),this.openDragLock="x"===(a=t)||"y"===a?vo[a]?null:(vo[a]=!0,()=>{vo[a]=!1}):vo.x||vo.y?null:(vo.x=vo.y=!0,()=>{vo.x=vo.y=!1}),!this.openDragLock))return;var a;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Vo(e=>{let n=this.getAxisMotionValue(e).get()||0;if(Bi.test(n)){const{projection:t}=this.visualElement;if(t&&t.layout){const i=t.layout.layoutBox[e];if(i){n=Lo(i)*(parseFloat(n)/100)}}}this.originPoint[e]=n}),r&&Nt.postRender(()=>r(e,n)),Vt(this.visualElement,"transform");const{animationState:o}=this.visualElement;o&&o.setActive("whileDrag",!0)},onMove:(e,n)=>{const{dragPropagation:t,dragDirectionLock:i,onDirectionLock:r,onDrag:a}=this.getProps();if(!t&&!this.openDragLock)return;const{offset:o}=n;if(i&&null===this.currentDirection)return this.currentDirection=function(e,n=10){let t=null;Math.abs(e.y)>n?t="y":Math.abs(e.x)>n&&(t="x");return t}(o),void(null!==this.currentDirection&&r&&r(this.currentDirection));this.updateAxis("x",n.point,o),this.updateAxis("y",n.point,o),this.visualElement.render(),a&&a(e,n)},onSessionEnd:(e,n)=>this.stop(e,n),resumeAnimation:()=>Vo(e=>{var n;return"paused"===this.getAnimationState(e)&&(null===(n=this.getAxisMotionValue(e).animation)||void 0===n?void 0:n.play())})},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:i,contextWindow:as(this.visualElement)})}stop(e,n){const t=this.isDragging;if(this.cancel(),!t)return;const{velocity:i}=n;this.startAnimation(i);const{onDragEnd:r}=this.getProps();r&&Nt.postRender(()=>r(e,n))}cancel(){this.isDragging=!1;const{projection:e,animationState:n}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:t}=this.getProps();!t&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),n&&n.setActive("whileDrag",!1)}updateAxis(e,n,t){const{drag:i}=this.getProps();if(!t||!ls(e,i,this.currentDirection))return;const r=this.getAxisMotionValue(e);let a=this.originPoint[e]+t[e];this.constraints&&this.constraints[e]&&(a=function(e,{min:n,max:t},i){return void 0!==n&&e<n?e=i?$r(n,e,i.min):Math.max(e,n):void 0!==t&&e>t&&(e=i?$r(t,e,i.max):Math.min(e,t)),e}(a,this.constraints[e],this.elastic[e])),r.set(a)}resolveConstraints(){var e;const{dragConstraints:n,dragElastic:t}=this.getProps(),i=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):null===(e=this.visualElement.projection)||void 0===e?void 0:e.layout,r=this.constraints;n&&Mo(n)?this.constraints||(this.constraints=this.resolveRefConstraints()):this.constraints=!(!n||!i)&&function(e,{top:n,left:t,bottom:i,right:r}){return{x:Ao(e.x,t,r),y:Ao(e.y,n,i)}}(i.layoutBox,n),this.elastic=function(e=Bo){return!1===e?e=0:!0===e&&(e=Bo),{x:_o(e,"left","right"),y:_o(e,"top","bottom")}}(t),r!==this.constraints&&i&&this.constraints&&!this.hasMutatedConstraints&&Vo(e=>{!1!==this.constraints&&this.getAxisMotionValue(e)&&(this.constraints[e]=function(e,n){const t={};return void 0!==n.min&&(t.min=n.min-e.min),void 0!==n.max&&(t.max=n.max-e.min),t}(i.layoutBox[e],this.constraints[e]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:n}=this.getProps();if(!e||!Mo(e))return!1;const t=e.current;Cr(null!==t,"If `dragConstraints` is set as a React ref, that ref must be passed to another component's `ref` prop.");const{projection:i}=this.visualElement;if(!i||!i.layout)return!1;const r=function(e,n,t){const i=rs(e,t),{scroll:r}=n;return r&&(ns(i.x,r.offset.x),ns(i.y,r.offset.y)),i}(t,i.root,this.visualElement.getTransformPagePoint());let a=function(e,n){return{x:Ro(e.x,n.x),y:Ro(e.y,n.y)}}(i.layout.layoutBox,r);if(n){const e=n(function({x:e,y:n}){return{top:n.min,right:e.max,bottom:n.max,left:e.min}}(a));this.hasMutatedConstraints=!!e,e&&(a=Wo(e))}return a}startAnimation(e){const{drag:n,dragMomentum:t,dragElastic:i,dragTransition:r,dragSnapToOrigin:a,onDragTransitionEnd:o}=this.getProps(),s=this.constraints||{},l=Vo(o=>{if(!ls(o,n,this.currentDirection))return;let l=s&&s[o]||{};a&&(l={min:0,max:0});const c=i?200:1e6,u=i?40:1e7,d={type:"inertia",velocity:t?e[o]:0,bounceStiffness:c,bounceDamping:u,timeConstant:750,restDelta:1,restSpeed:10,...r,...l};return this.startAxisValueAnimation(o,d)});return Promise.all(l).then(o)}startAxisValueAnimation(e,n){const t=this.getAxisMotionValue(e);return Vt(this.visualElement,e),t.start(Xa(e,t,0,n,this.visualElement,!1))}stopAnimation(){Vo(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){Vo(e=>{var n;return null===(n=this.getAxisMotionValue(e).animation)||void 0===n?void 0:n.pause()})}getAnimationState(e){var n;return null===(n=this.getAxisMotionValue(e).animation)||void 0===n?void 0:n.state}getAxisMotionValue(e){const n=`_drag${e.toUpperCase()}`,t=this.visualElement.getProps(),i=t[n];return i||this.visualElement.getValue(e,(t.initial?t.initial[e]:void 0)||0)}snapToCursor(e){Vo(n=>{const{drag:t}=this.getProps();if(!ls(n,t,this.currentDirection))return;const{projection:i}=this.visualElement,r=this.getAxisMotionValue(n);if(i&&i.layout){const{min:t,max:a}=i.layout.layoutBox[n];r.set(e[n]-$r(t,a,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:n}=this.getProps(),{projection:t}=this.visualElement;if(!Mo(n)||!t||!this.constraints)return;this.stopAnimation();const i={x:0,y:0};Vo(e=>{const n=this.getAxisMotionValue(e);if(n&&!1!==this.constraints){const t=n.get();i[e]=function(e,n){let t=.5;const i=Lo(e),r=Lo(n);return r>i?t=ai(n.min,n.max-i,e.min):i>r&&(t=ai(e.min,e.max-r,n.min)),Si(0,1,t)}({min:t,max:t},this.constraints[e])}});const{transformTemplate:r}=this.visualElement.getProps();this.visualElement.current.style.transform=r?r({},""):"none",t.root&&t.root.updateScroll(),t.updateLayout(),this.resolveConstraints(),Vo(n=>{if(!ls(n,e,null))return;const t=this.getAxisMotionValue(n),{min:r,max:a}=this.constraints[n];t.set($r(r,a,i[n]))})}addListeners(){if(!this.visualElement.current)return;os.set(this.visualElement,this);const e=yo(this.visualElement.current,"pointerdown",e=>{const{drag:n,dragListener:t=!0}=this.getProps();n&&t&&this.start(e)}),n=()=>{const{dragConstraints:e}=this.getProps();Mo(e)&&e.current&&(this.constraints=this.resolveRefConstraints())},{projection:t}=this.visualElement,i=t.addEventListener("measure",n);t&&!t.layout&&(t.root&&t.root.updateScroll(),t.updateLayout()),Nt.read(n);const r=bo(window,"resize",()=>this.scalePositionWithinConstraints()),a=t.addEventListener("didUpdate",({delta:e,hasLayoutChanged:n})=>{this.isDragging&&n&&(Vo(n=>{const t=this.getAxisMotionValue(n);t&&(this.originPoint[n]+=e[n].translate,t.set(t.get()+e[n].translate))}),this.visualElement.render())});return()=>{r(),e(),i(),a&&a()}}getProps(){const e=this.visualElement.getProps(),{drag:n=!1,dragDirectionLock:t=!1,dragPropagation:i=!1,dragConstraints:r=!1,dragElastic:a=Bo,dragMomentum:o=!0}=e;return{...e,drag:n,dragDirectionLock:t,dragPropagation:i,dragConstraints:r,dragElastic:a,dragMomentum:o}}}function ls(e,n,t){return!(!0!==n&&n!==e||null!==t&&t!==e)}const cs=e=>(n,t)=>{e&&Nt.postRender(()=>e(n,t))};const us=(0,Ee.createContext)({}),ds={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function ms(e,n){return n.max===n.min?0:e/(n.max-n.min)*100}const ps={correct:(e,n)=>{if(!n.target)return e;if("string"==typeof e){if(!_i.test(e))return e;e=parseFloat(e)}return`${ms(e,n.target.x)}% ${ms(e,n.target.y)}%`}},hs={correct:(e,{treeScale:n,projectionDelta:t})=>{const i=e,r=Ji.parse(e);if(r.length>5)return i;const a=Ji.createTransformer(e),o="number"!=typeof r[0]?1:0,s=t.x.scale*n.x,l=t.y.scale*n.y;r[0+o]/=s,r[1+o]/=l;const c=$r(s,l,.5);return"number"==typeof r[2+o]&&(r[2+o]/=c),"number"==typeof r[3+o]&&(r[3+o]/=c),a(r)}},vs={};const{schedule:fs,cancel:gs}=Ct(queueMicrotask,!1);class bs extends Ee.Component{componentDidMount(){const{visualElement:e,layoutGroup:n,switchLayoutGroup:t,layoutId:i}=this.props,{projection:r}=e;var a;a=ys,Object.assign(vs,a),r&&(n.group&&n.group.add(r),t&&t.register&&i&&t.register(r),r.root.didUpdate(),r.addEventListener("animationComplete",()=>{this.safeToRemove()}),r.setOptions({...r.options,onExitComplete:()=>this.safeToRemove()})),ds.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:n,visualElement:t,drag:i,isPresent:r}=this.props,a=t.projection;return a?(a.isPresent=r,i||e.layoutDependency!==n||void 0===n?a.willUpdate():this.safeToRemove(),e.isPresent!==r&&(r?a.promote():a.relegate()||Nt.postRender(()=>{const e=a.getStack();e&&e.members.length||this.safeToRemove()})),null):null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),fs.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:n,switchLayoutGroup:t}=this.props,{projection:i}=e;i&&(i.scheduleCheckAfterUnmount(),n&&n.group&&n.group.remove(i),t&&t.deregister&&t.deregister(i))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function xs(e){const[n,t]=et(),i=(0,Ee.useContext)(qn);return(0,Le.jsx)(bs,{...e,layoutGroup:i,switchLayoutGroup:(0,Ee.useContext)(us),isPresent:n,safeToRemove:t})}const ys={borderRadius:{...ps,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:ps,borderTopRightRadius:ps,borderBottomLeftRadius:ps,borderBottomRightRadius:ps,boxShadow:hs};const ks=(e,n)=>e.depth-n.depth;class ws{constructor(){this.children=[],this.isDirty=!1}add(e){Dt(this.children,e),this.isDirty=!0}remove(e){zt(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(ks),this.isDirty=!1,this.children.forEach(e)}}function js(e,n){const t=Tt.now(),i=({timestamp:r})=>{const a=r-t;a>=n&&(Pt(i),e(a-n))};return Nt.read(i,!0),()=>Pt(i)}function Ss(e){const n=Ft(e)?e.get():e;return t=n,Boolean(t&&"object"==typeof t&&t.mix&&t.toValue)?n.toValue():n;var t}const Cs=["TopLeft","TopRight","BottomLeft","BottomRight"],Ns=Cs.length,Ps=e=>"string"==typeof e?parseFloat(e):e,Es=e=>"number"==typeof e||_i.test(e);function Ms(e,n){return void 0!==e[n]?e[n]:e.borderRadius}const Ls=Ts(0,.5,yi),Os=Ts(.5,.95,jt);function Ts(e,n,t){return i=>i<e?0:i>n?1:t(ai(e,n,i))}function Ds(e,n){e.min=n.min,e.max=n.max}function zs(e,n){Ds(e.x,n.x),Ds(e.y,n.y)}function Is(e,n){e.translate=n.translate,e.scale=n.scale,e.originPoint=n.originPoint,e.origin=n.origin}function As(e,n,t,i,r){return e=Go(e-=n,1/t,i),void 0!==r&&(e=Go(e,1/r,i)),e}function Rs(e,n,[t,i,r],a,o){!function(e,n=0,t=1,i=.5,r,a=e,o=e){Bi.test(n)&&(n=parseFloat(n),n=$r(o.min,o.max,n/100)-o.min);if("number"!=typeof n)return;let s=$r(a.min,a.max,i);e===a&&(s-=n),e.min=As(e.min,n,t,s,r),e.max=As(e.max,n,t,s,r)}(e,n[t],n[i],n[r],n.scale,a,o)}const Bs=["x","scaleX","originX"],_s=["y","scaleY","originY"];function Us(e,n,t,i){Rs(e.x,n,Bs,t?t.x:void 0,i?i.x:void 0),Rs(e.y,n,_s,t?t.y:void 0,i?i.y:void 0)}function Fs(e){return 0===e.translate&&1===e.scale}function Vs(e){return Fs(e.x)&&Fs(e.y)}function Ws(e,n){return e.min===n.min&&e.max===n.max}function Hs(e,n){return Math.round(e.min)===Math.round(n.min)&&Math.round(e.max)===Math.round(n.max)}function $s(e,n){return Hs(e.x,n.x)&&Hs(e.y,n.y)}function qs(e){return Lo(e.x)/Lo(e.y)}function Ys(e,n){return e.translate===n.translate&&e.scale===n.scale&&e.originPoint===n.originPoint}class Ks{constructor(){this.members=[]}add(e){Dt(this.members,e),e.scheduleRender()}remove(e){if(zt(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const e=this.members[this.members.length-1];e&&this.promote(e)}}relegate(e){const n=this.members.findIndex(n=>e===n);if(0===n)return!1;let t;for(let e=n;e>=0;e--){const n=this.members[e];if(!1!==n.isPresent){t=n;break}}return!!t&&(this.promote(t),!0)}promote(e,n){const t=this.lead;if(e!==t&&(this.prevLead=t,this.lead=e,e.show(),t)){t.instance&&t.scheduleRender(),e.scheduleRender(),e.resumeFrom=t,n&&(e.resumeFrom.preserveOpacity=!0),t.snapshot&&(e.snapshot=t.snapshot,e.snapshot.latestValues=t.animationValues||t.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:i}=e.options;!1===i&&t.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:n,resumingFrom:t}=e;n.onExitComplete&&n.onExitComplete(),t&&t.options.onExitComplete&&t.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}const Gs={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},Qs="undefined"!=typeof window&&void 0!==window.MotionDebug,Xs=["","X","Y","Z"],Zs={visibility:"hidden"};let Js=0;function el(e,n,t,i){const{latestValues:r}=n;r[e]&&(t[e]=r[e],n.setStaticValue(e,0),i&&(i[e]=0))}function nl(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:n}=e.options;if(!n)return;const t=$t(n);if(window.MotionHasOptimisedAnimation(t,"transform")){const{layout:n,layoutId:i}=e.options;window.MotionCancelOptimisedAnimation(t,"transform",Nt,!(n||i))}const{parent:i}=e;i&&!i.hasCheckedOptimisedAppear&&nl(i)}function tl({attachResizeListener:e,defaultParent:n,measureScroll:t,checkIsScrollRoot:i,resetTransform:r}){return class{constructor(e={},t=(null==n?void 0:n())){this.id=Js++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,Qs&&(Gs.totalNodes=Gs.resolvedTargetDeltas=Gs.recalculatedProjection=0),this.nodes.forEach(al),this.nodes.forEach(ml),this.nodes.forEach(pl),this.nodes.forEach(ol),Qs&&window.MotionDebug.record(Gs)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=e,this.root=t?t.root||t:this,this.path=t?[...t.path,t]:[],this.parent=t,this.depth=t?t.depth+1:0;for(let e=0;e<this.path.length;e++)this.path[e].shouldResetTransform=!0;this.root===this&&(this.nodes=new ws)}addEventListener(e,n){return this.eventHandlers.has(e)||this.eventHandlers.set(e,new It),this.eventHandlers.get(e).add(n)}notifyListeners(e,...n){const t=this.eventHandlers.get(e);t&&t.notify(...n)}hasListeners(e){return this.eventHandlers.has(e)}mount(n,t=this.root.hasTreeAnimated){if(this.instance)return;var i;this.isSVG=(i=n)instanceof SVGElement&&"svg"!==i.tagName,this.instance=n;const{layoutId:r,layout:a,visualElement:o}=this.options;if(o&&!o.current&&o.mount(n),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),t&&(a||r)&&(this.isLayoutDirty=!0),e){let t;const i=()=>this.root.updateBlockedByResize=!1;e(n,()=>{this.root.updateBlockedByResize=!0,t&&t(),t=js(i,250),ds.hasAnimatedSinceResize&&(ds.hasAnimatedSinceResize=!1,this.nodes.forEach(dl))})}r&&this.root.registerSharedNode(r,this),!1!==this.options.animate&&o&&(r||a)&&this.addEventListener("didUpdate",({delta:e,hasLayoutChanged:n,hasRelativeTargetChanged:t,layout:i})=>{if(this.isTreeAnimationBlocked())return this.target=void 0,void(this.relativeTarget=void 0);const r=this.options.transition||o.getDefaultTransition()||xl,{onLayoutAnimationStart:a,onLayoutAnimationComplete:s}=o.getProps(),l=!this.targetLayout||!$s(this.targetLayout,i)||t,c=!n&&t;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||c||n&&(l||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(e,c);const n={...ft(r,"layout"),onPlay:a,onComplete:s};(o.shouldReduceMotion||this.options.layoutRoot)&&(n.delay=0,n.type=!1),this.startAnimation(n)}else n||dl(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=i})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const e=this.getStack();e&&e.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,Pt(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(hl),this.animationId++)}getTransformTemplate(){const{visualElement:e}=this.options;return e&&e.getProps().transformTemplate}willUpdate(e=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked())return void(this.options.onExitComplete&&this.options.onExitComplete());if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&nl(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let e=0;e<this.path.length;e++){const n=this.path[e];n.shouldResetTransform=!0,n.updateScroll("snapshot"),n.options.layoutRoot&&n.willUpdate(!1)}const{layoutId:n,layout:t}=this.options;if(void 0===n&&!t)return;const i=this.getTransformTemplate();this.prevTransformTemplateValue=i?i(this.latestValues,""):void 0,this.updateSnapshot(),e&&this.notifyListeners("willUpdate")}update(){this.updateScheduled=!1;if(this.isUpdateBlocked())return this.unblockUpdate(),this.clearAllSnapshots(),void this.nodes.forEach(ll);this.isUpdating||this.nodes.forEach(cl),this.isUpdating=!1,this.nodes.forEach(ul),this.nodes.forEach(il),this.nodes.forEach(rl),this.clearAllSnapshots();const e=Tt.now();Et.delta=Si(0,1e3/60,e-Et.timestamp),Et.timestamp=e,Et.isProcessing=!0,Mt.update.process(Et),Mt.preRender.process(Et),Mt.render.process(Et),Et.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,fs.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(sl),this.sharedNodes.forEach(vl)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Nt.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Nt.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){!this.snapshot&&this.instance&&(this.snapshot=this.measure())}updateLayout(){if(!this.instance)return;if(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead()||this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let e=0;e<this.path.length;e++){this.path[e].updateScroll()}const e=this.layout;this.layout=this.measure(!1),this.layoutCorrected={x:{min:0,max:0},y:{min:0,max:0}},this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:n}=this.options;n&&n.notify("LayoutMeasure",this.layout.layoutBox,e?e.layoutBox:void 0)}updateScroll(e="measure"){let n=Boolean(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===e&&(n=!1),n){const n=i(this.instance);this.scroll={animationId:this.root.animationId,phase:e,isRoot:n,offset:t(this.instance),wasRoot:this.scroll?this.scroll.isRoot:n}}}resetTransform(){if(!r)return;const e=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,n=this.projectionDelta&&!Vs(this.projectionDelta),t=this.getTransformTemplate(),i=t?t(this.latestValues,""):void 0,a=i!==this.prevTransformTemplateValue;e&&(n||qo(this.latestValues)||a)&&(r(this.instance,i),this.shouldResetTransform=!1,this.scheduleRender())}measure(e=!0){const n=this.measurePageBox();let t=this.removeElementScroll(n);var i;return e&&(t=this.removeTransform(t)),wl((i=t).x),wl(i.y),{animationId:this.root.animationId,measuredBox:n,layoutBox:t,latestValues:{},source:this.id}}measurePageBox(){var e;const{visualElement:n}=this.options;if(!n)return{x:{min:0,max:0},y:{min:0,max:0}};const t=n.measureViewportBox();if(!((null===(e=this.scroll)||void 0===e?void 0:e.wasRoot)||this.path.some(Sl))){const{scroll:e}=this.root;e&&(ns(t.x,e.offset.x),ns(t.y,e.offset.y))}return t}removeElementScroll(e){var n;const t={x:{min:0,max:0},y:{min:0,max:0}};if(zs(t,e),null===(n=this.scroll)||void 0===n?void 0:n.wasRoot)return t;for(let n=0;n<this.path.length;n++){const i=this.path[n],{scroll:r,options:a}=i;i!==this.root&&r&&a.layoutScroll&&(r.wasRoot&&zs(t,e),ns(t.x,r.offset.x),ns(t.y,r.offset.y))}return t}applyTransform(e,n=!1){const t={x:{min:0,max:0},y:{min:0,max:0}};zs(t,e);for(let e=0;e<this.path.length;e++){const i=this.path[e];!n&&i.options.layoutScroll&&i.scroll&&i!==i.root&&is(t,{x:-i.scroll.offset.x,y:-i.scroll.offset.y}),qo(i.latestValues)&&is(t,i.latestValues)}return qo(this.latestValues)&&is(t,this.latestValues),t}removeTransform(e){const n={x:{min:0,max:0},y:{min:0,max:0}};zs(n,e);for(let e=0;e<this.path.length;e++){const t=this.path[e];if(!t.instance)continue;if(!qo(t.latestValues))continue;$o(t.latestValues)&&t.updateSnapshot();const i=Fo();zs(i,t.measurePageBox()),Us(n,t.latestValues,t.snapshot?t.snapshot.layoutBox:void 0,i)}return qo(this.latestValues)&&Us(n,this.latestValues),n}setTargetDelta(e){this.targetDelta=e,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(e){this.options={...this.options,...e,crossfade:void 0===e.crossfade||e.crossfade}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Et.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(e=!1){var n;const t=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=t.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=t.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=t.isSharedProjectionDirty);const i=Boolean(this.resumingFrom)||this!==t;if(!(e||i&&this.isSharedProjectionDirty||this.isProjectionDirty||(null===(n=this.parent)||void 0===n?void 0:n.isProjectionDirty)||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:r,layoutId:a}=this.options;if(this.layout&&(r||a)){if(this.resolvedRelativeTargetAt=Et.timestamp,!this.targetDelta&&!this.relativeTarget){const e=this.getClosestProjectingParent();e&&e.layout&&1!==this.animationProgress?(this.relativeParent=e,this.forceRelativeParentToResolveTarget(),this.relativeTarget={x:{min:0,max:0},y:{min:0,max:0}},this.relativeTargetOrigin={x:{min:0,max:0},y:{min:0,max:0}},Io(this.relativeTargetOrigin,this.layout.layoutBox,e.layout.layoutBox),zs(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(this.relativeTarget||this.targetDelta){var o,s,l;if(this.target||(this.target={x:{min:0,max:0},y:{min:0,max:0}},this.targetWithTransforms={x:{min:0,max:0},y:{min:0,max:0}}),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),o=this.target,s=this.relativeTarget,l=this.relativeParent.target,Do(o.x,s.x,l.x),Do(o.y,s.y,l.y)):this.targetDelta?(Boolean(this.resumingFrom)?this.target=this.applyTransform(this.layout.layoutBox):zs(this.target,this.layout.layoutBox),Zo(this.target,this.targetDelta)):zs(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const e=this.getClosestProjectingParent();e&&Boolean(e.resumingFrom)===Boolean(this.resumingFrom)&&!e.options.layoutScroll&&e.target&&1!==this.animationProgress?(this.relativeParent=e,this.forceRelativeParentToResolveTarget(),this.relativeTarget={x:{min:0,max:0},y:{min:0,max:0}},this.relativeTargetOrigin={x:{min:0,max:0},y:{min:0,max:0}},Io(this.relativeTargetOrigin,this.target,e.target),zs(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}Qs&&Gs.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(this.parent&&!$o(this.parent.latestValues)&&!Yo(this.parent.latestValues))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return Boolean((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var e;const n=this.getLead(),t=Boolean(this.resumingFrom)||this!==n;let i=!0;if((this.isProjectionDirty||(null===(e=this.parent)||void 0===e?void 0:e.isProjectionDirty))&&(i=!1),t&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(i=!1),this.resolvedRelativeTargetAt===Et.timestamp&&(i=!1),i)return;const{layout:r,layoutId:a}=this.options;if(this.isTreeAnimating=Boolean(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!r&&!a)return;zs(this.layoutCorrected,this.layout.layoutBox);const o=this.treeScale.x,s=this.treeScale.y;!function(e,n,t,i=!1){const r=t.length;if(!r)return;let a,o;n.x=n.y=1;for(let s=0;s<r;s++){a=t[s],o=a.projectionDelta;const{visualElement:r}=a.options;r&&r.props.style&&"contents"===r.props.style.display||(i&&a.options.layoutScroll&&a.scroll&&a!==a.root&&is(e,{x:-a.scroll.offset.x,y:-a.scroll.offset.y}),o&&(n.x*=o.x.scale,n.y*=o.y.scale,Zo(e,o)),i&&qo(a.latestValues)&&is(e,a.latestValues))}n.x<es&&n.x>Jo&&(n.x=1),n.y<es&&n.y>Jo&&(n.y=1)}(this.layoutCorrected,this.treeScale,this.path,t),!n.layout||n.target||1===this.treeScale.x&&1===this.treeScale.y||(n.target=n.layout.layoutBox,n.targetWithTransforms={x:{min:0,max:0},y:{min:0,max:0}});const{target:l}=n;l?(this.projectionDelta&&this.prevProjectionDelta?(Is(this.prevProjectionDelta.x,this.projectionDelta.x),Is(this.prevProjectionDelta.y,this.projectionDelta.y)):this.createProjectionDeltas(),To(this.projectionDelta,this.layoutCorrected,l,this.latestValues),this.treeScale.x===o&&this.treeScale.y===s&&Ys(this.projectionDelta.x,this.prevProjectionDelta.x)&&Ys(this.projectionDelta.y,this.prevProjectionDelta.y)||(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",l)),Qs&&Gs.recalculatedProjection++):this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender())}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(e=!0){var n;if(null===(n=this.options.visualElement)||void 0===n||n.scheduleRender(),e){const e=this.getStack();e&&e.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}},this.projectionDelta={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}},this.projectionDeltaWithTransform={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}}}setAnimationOrigin(e,n=!1){const t=this.snapshot,i=t?t.latestValues:{},r={...this.latestValues},a={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};this.relativeParent&&this.relativeParent.options.layoutRoot||(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!n;const o={x:{min:0,max:0},y:{min:0,max:0}},s=(t?t.source:void 0)!==(this.layout?this.layout.source:void 0),l=this.getStack(),c=!l||l.members.length<=1,u=Boolean(s&&!c&&!0===this.options.crossfade&&!this.path.some(bl));let d;this.animationProgress=0,this.mixTargetDelta=n=>{const t=n/1e3;var l,m,p,h,v,f;fl(a.x,e.x,t),fl(a.y,e.y,t),this.setTargetDelta(a),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Io(o,this.layout.layoutBox,this.relativeParent.layout.layoutBox),p=this.relativeTarget,h=this.relativeTargetOrigin,v=o,f=t,gl(p.x,h.x,v.x,f),gl(p.y,h.y,v.y,f),d&&(l=this.relativeTarget,m=d,Ws(l.x,m.x)&&Ws(l.y,m.y))&&(this.isProjectionDirty=!1),d||(d={x:{min:0,max:0},y:{min:0,max:0}}),zs(d,this.relativeTarget)),s&&(this.animationValues=r,function(e,n,t,i,r,a){r?(e.opacity=$r(0,void 0!==t.opacity?t.opacity:1,Ls(i)),e.opacityExit=$r(void 0!==n.opacity?n.opacity:1,0,Os(i))):a&&(e.opacity=$r(void 0!==n.opacity?n.opacity:1,void 0!==t.opacity?t.opacity:1,i));for(let r=0;r<Ns;r++){const a=`border${Cs[r]}Radius`;let o=Ms(n,a),s=Ms(t,a);void 0===o&&void 0===s||(o||(o=0),s||(s=0),0===o||0===s||Es(o)===Es(s)?(e[a]=Math.max($r(Ps(o),Ps(s),i),0),(Bi.test(s)||Bi.test(o))&&(e[a]+="%")):e[a]=s)}(n.rotate||t.rotate)&&(e.rotate=$r(n.rotate||0,t.rotate||0,i))}(r,i,this.latestValues,t,u,c)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=t},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(e){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(Pt(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Nt.update(()=>{ds.hasAnimatedSinceResize=!0,this.currentAnimation=function(e,n,t){const i=Ft(e)?e:_t(e);return i.start(Xa("",i,n,t)),i.animation}(0,1e3,{...e,onUpdate:n=>{this.mixTargetDelta(n),e.onUpdate&&e.onUpdate(n)},onComplete:()=>{e.onComplete&&e.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const e=this.getStack();e&&e.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(1e3),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const e=this.getLead();let{targetWithTransforms:n,target:t,layout:i,latestValues:r}=e;if(n&&t&&i){if(this!==e&&this.layout&&i&&jl(this.options.animationType,this.layout.layoutBox,i.layoutBox)){t=this.target||{x:{min:0,max:0},y:{min:0,max:0}};const n=Lo(this.layout.layoutBox.x);t.x.min=e.target.x.min,t.x.max=t.x.min+n;const i=Lo(this.layout.layoutBox.y);t.y.min=e.target.y.min,t.y.max=t.y.min+i}zs(n,t),is(n,r),To(this.projectionDeltaWithTransform,this.layoutCorrected,n,r)}}registerSharedNode(e,n){this.sharedNodes.has(e)||this.sharedNodes.set(e,new Ks);this.sharedNodes.get(e).add(n);const t=n.options.initialPromotionConfig;n.promote({transition:t?t.transition:void 0,preserveFollowOpacity:t&&t.shouldPreserveFollowOpacity?t.shouldPreserveFollowOpacity(n):void 0})}isLead(){const e=this.getStack();return!e||e.lead===this}getLead(){var e;const{layoutId:n}=this.options;return n&&(null===(e=this.getStack())||void 0===e?void 0:e.lead)||this}getPrevLead(){var e;const{layoutId:n}=this.options;return n?null===(e=this.getStack())||void 0===e?void 0:e.prevLead:void 0}getStack(){const{layoutId:e}=this.options;if(e)return this.root.sharedNodes.get(e)}promote({needsReset:e,transition:n,preserveFollowOpacity:t}={}){const i=this.getStack();i&&i.promote(this,t),e&&(this.projectionDelta=void 0,this.needsReset=!0),n&&this.setOptions({transition:n})}relegate(){const e=this.getStack();return!!e&&e.relegate(this)}resetSkewAndRotation(){const{visualElement:e}=this.options;if(!e)return;let n=!1;const{latestValues:t}=e;if((t.z||t.rotate||t.rotateX||t.rotateY||t.rotateZ||t.skewX||t.skewY)&&(n=!0),!n)return;const i={};t.z&&el("z",e,i,this.animationValues);for(let n=0;n<Xs.length;n++)el(`rotate${Xs[n]}`,e,i,this.animationValues),el(`skew${Xs[n]}`,e,i,this.animationValues);e.render();for(const n in i)e.setStaticValue(n,i[n]),this.animationValues&&(this.animationValues[n]=i[n]);e.scheduleRender()}getProjectionStyles(e){var n,t;if(!this.instance||this.isSVG)return;if(!this.isVisible)return Zs;const i={visibility:""},r=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,i.opacity="",i.pointerEvents=Ss(null==e?void 0:e.pointerEvents)||"",i.transform=r?r(this.latestValues,""):"none",i;const a=this.getLead();if(!this.projectionDelta||!this.layout||!a.target){const n={};return this.options.layoutId&&(n.opacity=void 0!==this.latestValues.opacity?this.latestValues.opacity:1,n.pointerEvents=Ss(null==e?void 0:e.pointerEvents)||""),this.hasProjected&&!qo(this.latestValues)&&(n.transform=r?r({},""):"none",this.hasProjected=!1),n}const o=a.animationValues||a.latestValues;this.applyTransformsToTarget(),i.transform=function(e,n,t){let i="";const r=e.x.translate/n.x,a=e.y.translate/n.y,o=(null==t?void 0:t.z)||0;if((r||a||o)&&(i=`translate3d(${r}px, ${a}px, ${o}px) `),1===n.x&&1===n.y||(i+=`scale(${1/n.x}, ${1/n.y}) `),t){const{transformPerspective:e,rotate:n,rotateX:r,rotateY:a,skewX:o,skewY:s}=t;e&&(i=`perspective(${e}px) ${i}`),n&&(i+=`rotate(${n}deg) `),r&&(i+=`rotateX(${r}deg) `),a&&(i+=`rotateY(${a}deg) `),o&&(i+=`skewX(${o}deg) `),s&&(i+=`skewY(${s}deg) `)}const s=e.x.scale*n.x,l=e.y.scale*n.y;return 1===s&&1===l||(i+=`scale(${s}, ${l})`),i||"none"}(this.projectionDeltaWithTransform,this.treeScale,o),r&&(i.transform=r(o,i.transform));const{x:s,y:l}=this.projectionDelta;i.transformOrigin=`${100*s.origin}% ${100*l.origin}% 0`,a.animationValues?i.opacity=a===this?null!==(t=null!==(n=o.opacity)&&void 0!==n?n:this.latestValues.opacity)&&void 0!==t?t:1:this.preserveOpacity?this.latestValues.opacity:o.opacityExit:i.opacity=a===this?void 0!==o.opacity?o.opacity:"":void 0!==o.opacityExit?o.opacityExit:0;for(const e in vs){if(void 0===o[e])continue;const{correct:n,applyTo:t}=vs[e],r="none"===i.transform?o[e]:n(o[e],a);if(t){const e=t.length;for(let n=0;n<e;n++)i[t[n]]=r}else i[e]=r}return this.options.layoutId&&(i.pointerEvents=a===this?Ss(null==e?void 0:e.pointerEvents)||"":"none"),i}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(e=>{var n;return null===(n=e.currentAnimation)||void 0===n?void 0:n.stop()}),this.root.nodes.forEach(ll),this.root.sharedNodes.clear()}}}function il(e){e.updateLayout()}function rl(e){var n;const t=(null===(n=e.resumeFrom)||void 0===n?void 0:n.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&t&&e.hasListeners("didUpdate")){const{layoutBox:n,measuredBox:i}=e.layout,{animationType:r}=e.options,a=t.source!==e.layout.source;"size"===r?Vo(e=>{const i=a?t.measuredBox[e]:t.layoutBox[e],r=Lo(i);i.min=n[e].min,i.max=i.min+r}):jl(r,t.layoutBox,n)&&Vo(i=>{const r=a?t.measuredBox[i]:t.layoutBox[i],o=Lo(n[i]);r.max=r.min+o,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[i].max=e.relativeTarget[i].min+o)});const o={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};To(o,n,t.layoutBox);const s={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};a?To(s,e.applyTransform(i,!0),t.measuredBox):To(s,n,t.layoutBox);const l=!Vs(o);let c=!1;if(!e.resumeFrom){const i=e.getClosestProjectingParent();if(i&&!i.resumeFrom){const{snapshot:r,layout:a}=i;if(r&&a){const o={x:{min:0,max:0},y:{min:0,max:0}};Io(o,t.layoutBox,r.layoutBox);const s={x:{min:0,max:0},y:{min:0,max:0}};Io(s,n,a.layoutBox),$s(o,s)||(c=!0),i.options.layoutRoot&&(e.relativeTarget=s,e.relativeTargetOrigin=o,e.relativeParent=i)}}}e.notifyListeners("didUpdate",{layout:n,snapshot:t,delta:s,layoutDelta:o,hasLayoutChanged:l,hasRelativeTargetChanged:c})}else if(e.isLead()){const{onExitComplete:n}=e.options;n&&n()}e.options.transition=void 0}function al(e){Qs&&Gs.totalNodes++,e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=Boolean(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function ol(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function sl(e){e.clearSnapshot()}function ll(e){e.clearMeasurements()}function cl(e){e.isLayoutDirty=!1}function ul(e){const{visualElement:n}=e.options;n&&n.getProps().onBeforeLayoutMeasure&&n.notify("BeforeLayoutMeasure"),e.resetTransform()}function dl(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function ml(e){e.resolveTargetDelta()}function pl(e){e.calcProjection()}function hl(e){e.resetSkewAndRotation()}function vl(e){e.removeLeadSnapshot()}function fl(e,n,t){e.translate=$r(n.translate,0,t),e.scale=$r(n.scale,1,t),e.origin=n.origin,e.originPoint=n.originPoint}function gl(e,n,t,i){e.min=$r(n.min,t.min,i),e.max=$r(n.max,t.max,i)}function bl(e){return e.animationValues&&void 0!==e.animationValues.opacityExit}const xl={duration:.45,ease:[.4,0,.1,1]},yl=e=>"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),kl=yl("applewebkit/")&&!yl("chrome/")?Math.round:jt;function wl(e){e.min=kl(e.min),e.max=kl(e.max)}function jl(e,n,t){return"position"===e||"preserve-aspect"===e&&(i=qs(n),r=qs(t),a=.2,!(Math.abs(i-r)<=a));var i,r,a}function Sl(e){var n;return e!==e.root&&(null===(n=e.scroll)||void 0===n?void 0:n.wasRoot)}const Cl=tl({attachResizeListener:(e,n)=>bo(e,"resize",n),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),Nl={current:void 0},Pl=tl({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!Nl.current){const e=new Cl({});e.mount(window),e.setOptions({layoutScroll:!0}),Nl.current=e}return Nl.current},resetTransform:(e,n)=>{e.style.transform=void 0!==n?n:"none"},checkIsScrollRoot:e=>Boolean("fixed"===window.getComputedStyle(e).position)}),El={pan:{Feature:class extends mo{constructor(){super(...arguments),this.removePointerDownListener=jt}onPointerDown(e){this.session=new wo(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:as(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:n,onPan:t,onPanEnd:i}=this.node.getProps();return{onSessionStart:cs(e),onStart:cs(n),onMove:t,onEnd:(e,n)=>{delete this.session,i&&Nt.postRender(()=>i(e,n))}}}mount(){this.removePointerDownListener=yo(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}},drag:{Feature:class extends mo{constructor(e){super(e),this.removeGroupControls=jt,this.removeListeners=jt,this.controls=new ss(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||jt}unmount(){this.removeGroupControls(),this.removeListeners()}},ProjectionNode:Pl,MeasureLayout:xs}};function Ml(e,n){const t=function(e,n,t){var i;if(e instanceof Element)return[e];if("string"==typeof e){let r=document;n&&(r=n.current);const a=null!==(i=null==t?void 0:t[e])&&void 0!==i?i:r.querySelectorAll(e);return a?Array.from(a):[]}return Array.from(e)}(e),i=new AbortController;return[t,{passive:!0,...n,signal:i.signal},()=>i.abort()]}function Ll(e){return n=>{"touch"===n.pointerType||fo()||e(n)}}function Ol(e,n,t){const{props:i}=e;e.animationState&&i.whileHover&&e.animationState.setActive("whileHover","Start"===t);const r=i["onHover"+t];r&&Nt.postRender(()=>r(n,xo(n)))}const Tl=(e,n)=>!!n&&(e===n||Tl(e,n.parentElement)),Dl=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);const zl=new WeakSet;function Il(e){return n=>{"Enter"===n.key&&e(n)}}function Al(e,n){e.dispatchEvent(new PointerEvent("pointer"+n,{isPrimary:!0,bubbles:!0}))}function Rl(e){return go(e)&&!fo()}function Bl(e,n,t={}){const[i,r,a]=Ml(e,t),o=e=>{const i=e.currentTarget;if(!Rl(e)||zl.has(i))return;zl.add(i);const a=n(e),o=(e,n)=>{window.removeEventListener("pointerup",s),window.removeEventListener("pointercancel",l),Rl(e)&&zl.has(i)&&(zl.delete(i),"function"==typeof a&&a(e,{success:n}))},s=e=>{o(e,t.useGlobalTarget||Tl(i,e.target))},l=e=>{o(e,!1)};window.addEventListener("pointerup",s,r),window.addEventListener("pointercancel",l,r)};return i.forEach(e=>{(function(e){return Dl.has(e.tagName)||-1!==e.tabIndex})(e)||null!==e.getAttribute("tabindex")||(e.tabIndex=0);(t.useGlobalTarget?window:e).addEventListener("pointerdown",o,r),e.addEventListener("focus",e=>((e,n)=>{const t=e.currentTarget;if(!t)return;const i=Il(()=>{if(zl.has(t))return;Al(t,"down");const e=Il(()=>{Al(t,"up")});t.addEventListener("keyup",e,n),t.addEventListener("blur",()=>Al(t,"cancel"),n)});t.addEventListener("keydown",i,n),t.addEventListener("blur",()=>t.removeEventListener("keydown",i),n)})(e,r),r)}),a}function _l(e,n,t){const{props:i}=e;e.animationState&&i.whileTap&&e.animationState.setActive("whileTap","Start"===t);const r=i["onTap"+("End"===t?"":t)];r&&Nt.postRender(()=>r(n,xo(n)))}const Ul=new WeakMap,Fl=new WeakMap,Vl=e=>{const n=Ul.get(e.target);n&&n(e)},Wl=e=>{e.forEach(Vl)};function Hl(e,n,t){const i=function({root:e,...n}){const t=e||document;Fl.has(t)||Fl.set(t,{});const i=Fl.get(t),r=JSON.stringify(n);return i[r]||(i[r]=new IntersectionObserver(Wl,{root:e,...n})),i[r]}(n);return Ul.set(e,t),i.observe(e),()=>{Ul.delete(e),i.unobserve(e)}}const $l={some:0,all:1};const ql={inView:{Feature:class extends mo{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:n,margin:t,amount:i="some",once:r}=e,a={root:n?n.current:void 0,rootMargin:t,threshold:"number"==typeof i?i:$l[i]};return Hl(this.node.current,a,e=>{const{isIntersecting:n}=e;if(this.isInView===n)return;if(this.isInView=n,r&&!n&&this.hasEnteredView)return;n&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",n);const{onViewportEnter:t,onViewportLeave:i}=this.node.getProps(),a=n?t:i;a&&a(e)})}mount(){this.startObserver()}update(){if("undefined"==typeof IntersectionObserver)return;const{props:e,prevProps:n}=this.node;["amount","margin","root"].some(function({viewport:e={}},{viewport:n={}}={}){return t=>e[t]!==n[t]}(e,n))&&this.startObserver()}unmount(){}}},tap:{Feature:class extends mo{mount(){const{current:e}=this.node;e&&(this.unmount=Bl(e,e=>(_l(this.node,e,"Start"),(e,{success:n})=>_l(this.node,e,n?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}},focus:{Feature:class extends mo{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch(n){e=!0}e&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){this.isActive&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Jr(bo(this.node.current,"focus",()=>this.onFocus()),bo(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}},hover:{Feature:class extends mo{mount(){const{current:e}=this.node;e&&(this.unmount=function(e,n,t={}){const[i,r,a]=Ml(e,t),o=Ll(e=>{const{target:t}=e,i=n(e);if("function"!=typeof i||!t)return;const a=Ll(e=>{i(e),t.removeEventListener("pointerleave",a)});t.addEventListener("pointerleave",a,r)});return i.forEach(e=>{e.addEventListener("pointerenter",o,r)}),a}(e,e=>(Ol(this.node,e,"Start"),e=>Ol(this.node,e,"End"))))}unmount(){}}}},Yl={layout:{ProjectionNode:Pl,MeasureLayout:xs}},Kl=(0,Ee.createContext)({strict:!1}),Gl=(0,Ee.createContext)({});function Ql(e){return st(e.animate)||vt.some(n=>ut(e[n]))}function Xl(e){return Boolean(Ql(e)||e.variants)}function Zl(e){const{initial:n,animate:t}=function(e,n){if(Ql(e)){const{initial:n,animate:t}=e;return{initial:!1===n||ut(n)?n:void 0,animate:ut(t)?t:void 0}}return!1!==e.inherit?n:{}}(e,(0,Ee.useContext)(Gl));return(0,Ee.useMemo)(()=>({initial:n,animate:t}),[Jl(n),Jl(t)])}function Jl(e){return Array.isArray(e)?e.join(" "):e}const ec={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},nc={};for(const e in ec)nc[e]={isEnabled:n=>ec[e].some(e=>!!n[e])};const tc=Symbol.for("motionComponentSymbol");function ic(e,n,t){return(0,Ee.useCallback)(i=>{i&&e.onMount&&e.onMount(i),n&&(i?n.mount(i):n.unmount()),t&&("function"==typeof t?t(i):Mo(t)&&(t.current=i))},[n])}function rc(e,n,t,i,r){var a,o;const{visualElement:s}=(0,Ee.useContext)(Gl),l=(0,Ee.useContext)(Kl),c=(0,Ee.useContext)(Kn),u=(0,Ee.useContext)(Gn).reducedMotion,d=(0,Ee.useRef)(null);i=i||l.renderer,!d.current&&i&&(d.current=i(e,{visualState:n,parent:s,props:t,presenceContext:c,blockInitialAnimation:!!c&&!1===c.initial,reducedMotionConfig:u}));const m=d.current,p=(0,Ee.useContext)(us);!m||m.projection||!r||"html"!==m.type&&"svg"!==m.type||function(e,n,t,i){const{layoutId:r,layout:a,drag:o,dragConstraints:s,layoutScroll:l,layoutRoot:c}=n;e.projection=new t(e.latestValues,n["data-framer-portal-id"]?void 0:ac(e.parent)),e.projection.setOptions({layoutId:r,layout:a,alwaysMeasureLayout:Boolean(o)||s&&Mo(s),visualElement:e,animationType:"string"==typeof a?a:"both",initialPromotionConfig:i,layoutScroll:l,layoutRoot:c})}(d.current,t,r,p);const h=(0,Ee.useRef)(!1);(0,Ee.useInsertionEffect)(()=>{m&&h.current&&m.update(t,c)});const v=t[Ht],f=(0,Ee.useRef)(Boolean(v)&&!(null===(a=window.MotionHandoffIsComplete)||void 0===a?void 0:a.call(window,v))&&(null===(o=window.MotionHasOptimisedAnimation)||void 0===o?void 0:o.call(window,v)));return rt(()=>{m&&(h.current=!0,window.MotionIsMounted=!0,m.updateFeatures(),fs.render(m.render),f.current&&m.animationState&&m.animationState.animateChanges())}),(0,Ee.useEffect)(()=>{m&&(!f.current&&m.animationState&&m.animationState.animateChanges(),f.current&&(queueMicrotask(()=>{var e;null===(e=window.MotionHandoffMarkAsComplete)||void 0===e||e.call(window,v)}),f.current=!1))}),m}function ac(e){if(e)return!1!==e.options.allowProjection?e.projection:ac(e.parent)}function oc({preloadedFeatures:e,createVisualElement:n,useRender:t,useVisualState:i,Component:r}){var a,o;function s(e,a){let o;const s={...(0,Ee.useContext)(Gn),...e,layoutId:sc(e)},{isStatic:l}=s,c=Zl(e),u=i(e,l);if(!l&&it){!function(){(0,Ee.useContext)(Kl).strict;0}();const e=function(e){const{drag:n,layout:t}=nc;if(!n&&!t)return{};const i={...n,...t};return{MeasureLayout:(null==n?void 0:n.isEnabled(e))||(null==t?void 0:t.isEnabled(e))?i.MeasureLayout:void 0,ProjectionNode:i.ProjectionNode}}(s);o=e.MeasureLayout,c.visualElement=rc(r,u,s,n,e.ProjectionNode)}return(0,Le.jsxs)(Gl.Provider,{value:c,children:[o&&c.visualElement?(0,Le.jsx)(o,{visualElement:c.visualElement,...s}):null,t(r,e,ic(u,c.visualElement,a),u,l,c.visualElement)]})}e&&function(e){for(const n in e)nc[n]={...nc[n],...e[n]}}(e),s.displayName=`motion.${"string"==typeof r?r:`create(${null!==(o=null!==(a=r.displayName)&&void 0!==a?a:r.name)&&void 0!==o?o:""})`}`;const l=(0,Ee.forwardRef)(s);return l[tc]=r,l}function sc({layoutId:e}){const n=(0,Ee.useContext)(qn).id;return n&&void 0!==e?n+"-"+e:e}const lc=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function cc(e){return"string"==typeof e&&!e.includes("-")&&!!(lc.indexOf(e)>-1||/[A-Z]/u.test(e))}const uc=e=>(n,t)=>{const i=(0,Ee.useContext)(Gl),r=(0,Ee.useContext)(Kn),a=()=>function({scrapeMotionValuesFromProps:e,createRenderState:n,onUpdate:t},i,r,a){const o={latestValues:dc(i,r,a,e),renderState:n()};return t&&(o.onMount=e=>t({props:i,current:e,...o}),o.onUpdate=e=>t(e)),o}(e,n,i,r);return t?a():Yn(a)};function dc(e,n,t,i){const r={},a=i(e,{});for(const e in a)r[e]=Ss(a[e]);let{initial:o,animate:s}=e;const l=Ql(e),c=Xl(e);n&&c&&!l&&!1!==e.inherit&&(void 0===o&&(o=n.initial),void 0===s&&(s=n.animate));let u=!!t&&!1===t.initial;u=u||!1===o;const d=u?s:o;if(d&&"boolean"!=typeof d&&!st(d)){const n=Array.isArray(d)?d:[d];for(let t=0;t<n.length;t++){const i=mt(e,n[t]);if(i){const{transitionEnd:e,transition:n,...t}=i;for(const e in t){let n=t[e];if(Array.isArray(n)){n=n[u?n.length-1:0]}null!==n&&(r[e]=n)}for(const n in e)r[n]=e[n]}}}return r}const mc=(e,n)=>n&&"number"==typeof e?n.transform(e):e,pc={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},hc=gt.length;function vc(e,n,t){const{style:i,vars:r,transformOrigin:a}=e;let o=!1,s=!1;for(const e in n){const t=n[e];if(bt.has(e))o=!0;else if(Er(e))r[e]=t;else{const n=mc(t,sr[e]);e.startsWith("origin")?(s=!0,a[e]=n):i[e]=n}}if(n.transform||(o||t?i.transform=function(e,n,t){let i="",r=!0;for(let a=0;a<hc;a++){const o=gt[a],s=e[o];if(void 0===s)continue;let l=!0;if(l="number"==typeof s?s===(o.startsWith("scale")?1:0):0===parseFloat(s),!l||t){const e=mc(s,sr[o]);l||(r=!1,i+=`${pc[o]||o}(${e}) `),t&&(n[o]=e)}}return i=i.trim(),t?i=t(n,r?"":i):r&&(i="none"),i}(n,e.transform,t):i.transform&&(i.transform="none")),s){const{originX:e="50%",originY:n="50%",originZ:t=0}=a;i.transformOrigin=`${e} ${n} ${t}`}}const fc={offset:"stroke-dashoffset",array:"stroke-dasharray"},gc={offset:"strokeDashoffset",array:"strokeDasharray"};function bc(e,n,t){return"string"==typeof e?e:_i.transform(n+t*e)}function xc(e,{attrX:n,attrY:t,attrScale:i,originX:r,originY:a,pathLength:o,pathSpacing:s=1,pathOffset:l=0,...c},u,d){if(vc(e,c,d),u)return void(e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox));e.attrs=e.style,e.style={};const{attrs:m,style:p,dimensions:h}=e;m.transform&&(h&&(p.transform=m.transform),delete m.transform),h&&(void 0!==r||void 0!==a||p.transform)&&(p.transformOrigin=function(e,n,t){return`${bc(n,e.x,e.width)} ${bc(t,e.y,e.height)}`}(h,void 0!==r?r:.5,void 0!==a?a:.5)),void 0!==n&&(m.x=n),void 0!==t&&(m.y=t),void 0!==i&&(m.scale=i),void 0!==o&&function(e,n,t=1,i=0,r=!0){e.pathLength=1;const a=r?fc:gc;e[a.offset]=_i.transform(-i);const o=_i.transform(n),s=_i.transform(t);e[a.array]=`${o} ${s}`}(m,o,s,l,!1)}const yc=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),kc=()=>({style:{},transform:{},transformOrigin:{},vars:{},attrs:{}}),wc=e=>"string"==typeof e&&"svg"===e.toLowerCase();function jc(e,{style:n,vars:t},i,r){Object.assign(e.style,n,r&&r.getProjectionStyles(i));for(const n in t)e.style.setProperty(n,t[n])}const Sc=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function Cc(e,n,t,i){jc(e,n,void 0,i);for(const t in n.attrs)e.setAttribute(Sc.has(t)?t:Wt(t),n.attrs[t])}function Nc(e,{layout:n,layoutId:t}){return bt.has(e)||e.startsWith("origin")||(n||void 0!==t)&&(!!vs[e]||"opacity"===e)}function Pc(e,n,t){var i;const{style:r}=e,a={};for(const o in r)(Ft(r[o])||n.style&&Ft(n.style[o])||Nc(o,e)||void 0!==(null===(i=null==t?void 0:t.getValue(o))||void 0===i?void 0:i.liveStyle))&&(a[o]=r[o]);return a}function Ec(e,n,t){const i=Pc(e,n,t);for(const t in e)if(Ft(e[t])||Ft(n[t])){i[-1!==gt.indexOf(t)?"attr"+t.charAt(0).toUpperCase()+t.substring(1):t]=e[t]}return i}const Mc=["x","y","width","height","cx","cy","r"],Lc={useVisualState:uc({scrapeMotionValuesFromProps:Ec,createRenderState:kc,onUpdate:({props:e,prevProps:n,current:t,renderState:i,latestValues:r})=>{if(!t)return;let a=!!e.drag;if(!a)for(const e in r)if(bt.has(e)){a=!0;break}if(!a)return;let o=!n;if(n)for(let t=0;t<Mc.length;t++){const i=Mc[t];e[i]!==n[i]&&(o=!0)}o&&Nt.read(()=>{!function(e,n){try{n.dimensions="function"==typeof e.getBBox?e.getBBox():e.getBoundingClientRect()}catch(e){n.dimensions={x:0,y:0,width:0,height:0}}}(t,i),Nt.render(()=>{xc(i,r,wc(t.tagName),e.transformTemplate),Cc(t,i)})})}})},Oc={useVisualState:uc({scrapeMotionValuesFromProps:Pc,createRenderState:yc})};function Tc(e,n,t){for(const i in n)Ft(n[i])||Nc(i,t)||(e[i]=n[i])}function Dc(e,n){const t={};return Tc(t,e.style||{},e),Object.assign(t,function({transformTemplate:e},n){return(0,Ee.useMemo)(()=>{const t={style:{},transform:{},transformOrigin:{},vars:{}};return vc(t,n,e),Object.assign({},t.vars,t.style)},[n])}(e,n)),t}function zc(e,n){const t={},i=Dc(e,n);return e.drag&&!1!==e.dragListener&&(t.draggable=!1,i.userSelect=i.WebkitUserSelect=i.WebkitTouchCallout="none",i.touchAction=!0===e.drag?"none":"pan-"+("x"===e.drag?"y":"x")),void 0===e.tabIndex&&(e.onTap||e.onTapStart||e.whileTap)&&(t.tabIndex=0),t.style=i,t}const Ic=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Ac(e){return e.startsWith("while")||e.startsWith("drag")&&"draggable"!==e||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||Ic.has(e)}let Rc=e=>!Ac(e);try{(Bc=require("@emotion/is-prop-valid").default)&&(Rc=e=>e.startsWith("on")?!Ac(e):Bc(e))}catch(e){}var Bc;function _c(e,n,t,i){const r=(0,Ee.useMemo)(()=>{const t={style:{},transform:{},transformOrigin:{},vars:{},attrs:{}};return xc(t,n,wc(i),e.transformTemplate),{...t.attrs,style:{...t.style}}},[n]);if(e.style){const n={};Tc(n,e.style,e),r.style={...n,...r.style}}return r}function Uc(e=!1){return(n,t,i,{latestValues:r},a)=>{const o=(cc(n)?_c:zc)(t,r,a,n),s=function(e,n,t){const i={};for(const r in e)"values"===r&&"object"==typeof e.values||(Rc(r)||!0===t&&Ac(r)||!n&&!Ac(r)||e.draggable&&r.startsWith("onDrag"))&&(i[r]=e[r]);return i}(t,"string"==typeof n,e),l=n!==Ee.Fragment?{...s,...o,ref:i}:{},{children:c}=t,u=(0,Ee.useMemo)(()=>Ft(c)?c.get():c,[c]);return(0,Ee.createElement)(n,{...l,children:u})}}function Fc(e,n){return function(t,{forwardMotionProps:i}={forwardMotionProps:!1}){return oc({...cc(t)?Lc:Oc,preloadedFeatures:e,useRender:Uc(i),createVisualElement:n,Component:t})}}const Vc={current:null},Wc={current:!1};const Hc=[...Ir,Hi,Ji],$c=new WeakMap;const qc=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class Yc{scrapeMotionValuesFromProps(e,n,t){return{}}constructor({parent:e,props:n,presenceContext:t,reducedMotionConfig:i,blockInitialAnimation:r,visualState:a},o={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=jr,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const e=Tt.now();this.renderScheduledAt<e&&(this.renderScheduledAt=e,Nt.render(this.render,!1,!0))};const{latestValues:s,renderState:l,onUpdate:c}=a;this.onUpdate=c,this.latestValues=s,this.baseTarget={...s},this.initialValues=n.initial?{...s}:{},this.renderState=l,this.parent=e,this.props=n,this.presenceContext=t,this.depth=e?e.depth+1:0,this.reducedMotionConfig=i,this.options=o,this.blockInitialAnimation=Boolean(r),this.isControllingVariants=Ql(n),this.isVariantNode=Xl(n),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=Boolean(e&&e.current);const{willChange:u,...d}=this.scrapeMotionValuesFromProps(n,{},this);for(const e in d){const n=d[e];void 0!==s[e]&&Ft(n)&&n.set(s[e],!1)}}mount(e){this.current=e,$c.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((e,n)=>this.bindToMotionValue(n,e)),Wc.current||function(){if(Wc.current=!0,it)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),n=()=>Vc.current=e.matches;e.addListener(n),n()}else Vc.current=!1}(),this.shouldReduceMotion="never"!==this.reducedMotionConfig&&("always"===this.reducedMotionConfig||Vc.current),this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){$c.delete(this.current),this.projection&&this.projection.unmount(),Pt(this.notifyUpdate),Pt(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const n=this.features[e];n&&(n.unmount(),n.isMounted=!1)}this.current=null}bindToMotionValue(e,n){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const t=bt.has(e),i=n.on("change",n=>{this.latestValues[e]=n,this.props.onUpdate&&Nt.preRender(this.notifyUpdate),t&&this.projection&&(this.projection.isTransformDirty=!0)}),r=n.on("renderRequest",this.scheduleRender);let a;window.MotionCheckAppearSync&&(a=window.MotionCheckAppearSync(this,e,n)),this.valueSubscriptions.set(e,()=>{i(),r(),a&&a(),n.owner&&n.stop()})}sortNodePosition(e){return this.current&&this.sortInstanceNodePosition&&this.type===e.type?this.sortInstanceNodePosition(this.current,e.current):0}updateFeatures(){let e="animation";for(e in nc){const n=nc[e];if(!n)continue;const{isEnabled:t,Feature:i}=n;if(!this.features[e]&&i&&t(this.props)&&(this.features[e]=new i(this)),this.features[e]){const n=this.features[e];n.isMounted?n.update():(n.mount(),n.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):{x:{min:0,max:0},y:{min:0,max:0}}}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,n){this.latestValues[e]=n}update(e,n){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=n;for(let n=0;n<qc.length;n++){const t=qc[n];this.propEventSubscriptions[t]&&(this.propEventSubscriptions[t](),delete this.propEventSubscriptions[t]);const i=e["on"+t];i&&(this.propEventSubscriptions[t]=this.on(t,i))}this.prevMotionValues=function(e,n,t){for(const i in n){const r=n[i],a=t[i];if(Ft(r))e.addValue(i,r);else if(Ft(a))e.addValue(i,_t(r,{owner:e}));else if(a!==r)if(e.hasValue(i)){const n=e.getValue(i);!0===n.liveStyle?n.jump(r):n.hasAnimated||n.set(r)}else{const n=e.getStaticValue(i);e.addValue(i,_t(void 0!==n?n:r,{owner:e}))}}for(const i in t)void 0===n[i]&&e.removeValue(i);return n}(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const n=this.getClosestVariantNode();if(n)return n.variantChildren&&n.variantChildren.add(e),()=>n.variantChildren.delete(e)}addValue(e,n){const t=this.values.get(e);n!==t&&(t&&this.removeValue(e),this.bindToMotionValue(e,n),this.values.set(e,n),this.latestValues[e]=n.get())}removeValue(e){this.values.delete(e);const n=this.valueSubscriptions.get(e);n&&(n(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,n){if(this.props.values&&this.props.values[e])return this.props.values[e];let t=this.values.get(e);return void 0===t&&void 0!==n&&(t=_t(null===n?void 0:n,{owner:this}),this.addValue(e,t)),t}readValue(e,n){var t;let i=void 0===this.latestValues[e]&&this.current?null!==(t=this.getBaseTargetFromProps(this.props,e))&&void 0!==t?t:this.readValueFromInstance(this.current,e,this.options):this.latestValues[e];var r;return null!=i&&("string"==typeof i&&(Nr(i)||wi(i))?i=parseFloat(i):(r=i,!Hc.find(zr(r))&&Ji.test(n)&&(i=ur(e,n))),this.setBaseTarget(e,Ft(i)?i.get():i)),Ft(i)?i.get():i}setBaseTarget(e,n){this.baseTarget[e]=n}getBaseTarget(e){var n;const{initial:t}=this.props;let i;if("string"==typeof t||"object"==typeof t){const r=mt(this.props,t,null===(n=this.presenceContext)||void 0===n?void 0:n.custom);r&&(i=r[e])}if(t&&void 0!==i)return i;const r=this.getBaseTargetFromProps(this.props,e);return void 0===r||Ft(r)?void 0!==this.initialValues[e]&&void 0===i?void 0:this.baseTarget[e]:r}on(e,n){return this.events[e]||(this.events[e]=new It),this.events[e].add(n)}notify(e,...n){this.events[e]&&this.events[e].notify(...n)}}class Kc extends Yc{constructor(){super(...arguments),this.KeyframeResolver=Rr}sortInstanceNodePosition(e,n){return 2&e.compareDocumentPosition(n)?1:-1}getBaseTargetFromProps(e,n){return e.style?e.style[n]:void 0}removeValueFromRenderState(e,{vars:n,style:t}){delete n[e],delete t[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;Ft(e)&&(this.childSubscription=e.on("change",e=>{this.current&&(this.current.textContent=`${e}`)}))}}class Gc extends Kc{constructor(){super(...arguments),this.type="html",this.renderInstance=jc}readValueFromInstance(e,n){if(bt.has(n)){const e=cr(n);return e&&e.default||0}{const i=(t=e,window.getComputedStyle(t)),r=(Er(n)?i.getPropertyValue(n):i[n])||0;return"string"==typeof r?r.trim():r}var t}measureInstanceViewportBox(e,{transformPagePoint:n}){return rs(e,n)}build(e,n,t){vc(e,n,t.transformTemplate)}scrapeMotionValuesFromProps(e,n,t){return Pc(e,n,t)}}class Qc extends Kc{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Fo}getBaseTargetFromProps(e,n){return e[n]}readValueFromInstance(e,n){if(bt.has(n)){const e=cr(n);return e&&e.default||0}return n=Sc.has(n)?n:Wt(n),e.getAttribute(n)}scrapeMotionValuesFromProps(e,n,t){return Ec(e,n,t)}build(e,n,t){xc(e,n,this.isSVGTag,t.transformTemplate)}renderInstance(e,n,t,i){Cc(e,n,0,i)}mount(e){this.isSVGTag=wc(e.tagName),super.mount(e)}}const Xc=(e,n)=>cc(e)?new Qc(n):new Gc(n,{allowProjection:e!==Ee.Fragment}),Zc=ot(Fc({...ho,...ql,...El,...Yl},Xc)),Jc=Nn("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]),eu=Nn("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),nu=Nn("bookmark",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]]),tu=Nn("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),iu=Nn("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),ru=Nn("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),au=Nn("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),ou=Nn("sparkles",[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]]),su=Nn("wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.106-3.105c.32-.322.863-.22.983.218a6 6 0 0 1-8.259 7.057l-7.91 7.91a1 1 0 0 1-2.999-3l7.91-7.91a6 6 0 0 1 7.057-8.259c.438.12.54.662.219.984z",key:"1ngwbx"}]]),lu=Nn("layers",[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]]),cu=Nn("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);function uu(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,i)}return t}function du(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?uu(Object(t),!0).forEach(function(n){mu(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):uu(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function mu(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,n||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const pu=Ge,hu=[],vu={},fu={useDefault:!0,xPercent:1,yPercent:1},gu=()=>pu.getState().presets||vu,bu=()=>pu.getState().activePresetName,xu=()=>pu.getState().chimeraMode||!1,yu=()=>pu.getState().councilMode||!1,ku=()=>pu.getState().councilMembers||hu,wu=()=>pu.getState().selectedDefinitions||hu,ju=()=>{var e;return null===(e=pu.getState().showLumiverseDrawer)||void 0===e||e},Su=()=>{var e;return null!==(e=pu.getState().lumiaButtonPosition)&&void 0!==e?e:fu},Cu={chimera:(0,Le.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,Le.jsx)("path",{d:"M12 2L2 7l10 5 10-5-10-5z"}),(0,Le.jsx)("path",{d:"M2 17l10 5 10-5"}),(0,Le.jsx)("path",{d:"M2 12l10 5 10-5"})]}),council:(0,Le.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,Le.jsx)("path",{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),(0,Le.jsx)("circle",{cx:"9",cy:"7",r:"4"}),(0,Le.jsx)("path",{d:"M23 21v-2a4 4 0 0 0-3-3.87"}),(0,Le.jsx)("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]})},Nu={book:(0,Le.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,Le.jsx)("path",{d:"M4 19.5A2.5 2.5 0 0 1 6.5 17H20"}),(0,Le.jsx)("path",{d:"M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"})]}),settings:(0,Le.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,Le.jsx)("circle",{cx:"12",cy:"12",r:"3"}),(0,Le.jsx)("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]}),layers:(0,Le.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,Le.jsx)("path",{d:"M12 2L2 7l10 5 10-5-10-5z"}),(0,Le.jsx)("path",{d:"M2 17l10 5 10-5"}),(0,Le.jsx)("path",{d:"M2 12l10 5 10-5"})]}),tools:(0,Le.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,Le.jsx)("path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"})}),terminal:(0,Le.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,Le.jsx)("polyline",{points:"4 17 10 11 4 5"}),(0,Le.jsx)("line",{x1:"12",y1:"19",x2:"20",y2:"19"})]}),upload:(0,Le.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,Le.jsx)("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),(0,Le.jsx)("polyline",{points:"17 8 12 3 7 8"}),(0,Le.jsx)("line",{x1:"12",y1:"3",x2:"12",y2:"15"})]}),box:(0,Le.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,Le.jsx)("path",{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"}),(0,Le.jsx)("polyline",{points:"3.27 6.96 12 12.01 20.73 6.96"}),(0,Le.jsx)("line",{x1:"12",y1:"22.08",x2:"12",y2:"12"})]}),plus:(0,Le.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,Le.jsx)("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),(0,Le.jsx)("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),dots:(0,Le.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,Le.jsx)("circle",{cx:"12",cy:"12",r:"1"}),(0,Le.jsx)("circle",{cx:"19",cy:"12",r:"1"}),(0,Le.jsx)("circle",{cx:"5",cy:"12",r:"1"})]}),lines:(0,Le.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,Le.jsx)("line",{x1:"21",y1:"10",x2:"3",y2:"10"}),(0,Le.jsx)("line",{x1:"21",y1:"6",x2:"3",y2:"6"}),(0,Le.jsx)("line",{x1:"21",y1:"14",x2:"3",y2:"14"}),(0,Le.jsx)("line",{x1:"21",y1:"18",x2:"3",y2:"18"})]}),edit:(0,Le.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,Le.jsx)("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),(0,Le.jsx)("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]}),chevronDown:(0,Le.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,Le.jsx)("polyline",{points:"6 9 12 15 18 9"})}),package:(0,Le.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,Le.jsx)("line",{x1:"16.5",y1:"9.4",x2:"7.5",y2:"4.21"}),(0,Le.jsx)("path",{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"}),(0,Le.jsx)("polyline",{points:"3.27 6.96 12 12.01 20.73 6.96"}),(0,Le.jsx)("line",{x1:"12",y1:"22.08",x2:"12",y2:"12"})]}),download:(0,Le.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,Le.jsx)("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),(0,Le.jsx)("polyline",{points:"7 10 12 15 17 10"}),(0,Le.jsx)("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]})};function Pu(e){let{item:n,packName:t,onEdit:i,editIcon:r}=e;const a=n.avatarUrl||n.lumia_img,o=n.lumiaName||n.lumiaDefName,{objectPosition:s}=bn(a);return(0,Le.jsxs)("div",{className:"lumia-pack-lumia-item",children:[a&&(0,Le.jsx)("img",{src:a,alt:"",className:"lumia-pack-lumia-avatar",style:{objectPosition:s},onError:e=>{e.target.style.display="none"}}),(0,Le.jsx)("span",{className:"lumia-pack-lumia-name",children:o}),(0,Le.jsx)("button",{className:"lumia-btn lumia-btn-icon lumia-btn-icon-sm",onClick:()=>i(t,n),title:"Edit Lumia",type:"button",children:r})]})}function Eu(e){let{title:n,icon:t,action:i,collapsible:r,collapsed:a,onToggle:o,children:s}=e;const l=void 0!==a,[c,u]=(0,Ee.useState)(!1),d=l?a:c,m=(0,Ee.useCallback)(()=>{l&&o?o():u(e=>!e)},[l,o]);return(0,Le.jsxs)("div",{className:yn("lumia-panel",r&&d&&"lumia-panel--collapsed"),children:[(0,Le.jsxs)("div",{className:yn("lumia-panel-header",r&&"lumia-panel-header-clickable"),onClick:r?m:void 0,children:[(0,Le.jsx)("span",{className:"lumia-panel-icon",children:t}),(0,Le.jsx)("span",{className:"lumia-panel-title",children:n}),i&&(0,Le.jsx)("span",{className:"lumia-panel-action",onClick:e=>e.stopPropagation(),children:i}),r&&(0,Le.jsx)("span",{className:yn("lumia-panel-chevron",!d&&"lumia-panel-chevron--expanded"),children:Nu.chevronDown})]}),r?(0,Le.jsx)($n,{isOpen:!d,className:"lumia-panel-content",duration:200,children:s}):(0,Le.jsx)("div",{className:"lumia-panel-content",children:s})]})}function Mu(e){let{title:n,icon:t,children:i}=e;const[r,a]=(0,Ee.useState)(!1);return(0,Le.jsxs)("details",{className:"lumia-panel lumia-panel-collapsible",open:r,onToggle:e=>a(e.target.open),children:[(0,Le.jsxs)("summary",{className:"lumia-panel-header lumia-panel-header-clickable",children:[(0,Le.jsx)("span",{className:"lumia-panel-icon",children:t}),(0,Le.jsx)("span",{className:"lumia-panel-title",children:n}),(0,Le.jsx)("span",{className:"lumia-panel-chevron",children:Nu.chevronDown})]}),(0,Le.jsx)("div",{className:"lumia-panel-content lumia-macro-reference",children:i})]})}function Lu(e){let{label:n,hint:t,selections:i,dominant:r,modalName:a}=e;const o=Je(),s=(null==i?void 0:i.length)||0,l=(0,Ee.useMemo)(()=>{if(0===s)return"No ".concat(n.toLowerCase()," selected");const e=null==r?void 0:r.id,t=(null==r?void 0:r.name)||(null==r?void 0:r.itemName)||(null==r?void 0:r.lumiaDefName);return i.map(n=>{const i=(null==n?void 0:n.name)||(null==n?void 0:n.itemName)||(null==n?void 0:n.lumiaDefName)||"Unknown",a=null==n?void 0:n.id;return r&&(e&&a&&e===a||t&&i&&t===i)?"★ ".concat(i):i}).join(", ")},[s,i,n,r]);return(0,Le.jsxs)("div",{className:"lumia-selector",children:[(0,Le.jsxs)("div",{className:"lumia-selector-header",children:[(0,Le.jsx)("span",{className:"lumia-selector-label",children:n}),(0,Le.jsx)("span",{className:"lumia-selector-hint",children:t})]}),(0,Le.jsxs)("div",{className:"lumia-selector-row",children:[(0,Le.jsx)("div",{className:"lumia-selector-value",children:l}),(0,Le.jsx)("button",{className:"lumia-btn lumia-btn-sm",onClick:()=>o.openModal(a),type:"button",children:"Select"})]})]})}function Ou(e){let{icon:n,label:t,onClick:i,accent:r=!1}=e;return(0,Le.jsxs)("button",{className:yn("lumia-tool-btn",r&&"lumia-tool-btn-accent"),onClick:i,type:"button",children:[n,(0,Le.jsx)("span",{children:t})]})}function Tu(e){let{icon:n,label:t,description:i,checked:r,onChange:a,disabled:o}=e;return(0,Le.jsxs)("label",{className:yn("lumiverse-mode-toggle",o&&"lumiverse-mode-toggle--disabled"),children:[(0,Le.jsx)("span",{className:"lumiverse-mode-toggle-icon",children:n}),(0,Le.jsxs)("div",{className:"lumiverse-mode-toggle-text",children:[(0,Le.jsx)("span",{className:"lumiverse-mode-toggle-label",children:t}),(0,Le.jsx)("span",{className:"lumiverse-mode-toggle-description",children:i})]}),(0,Le.jsxs)("div",{className:yn("lumiverse-toggle lumiverse-toggle--sm",r&&"lumiverse-toggle--on"),children:[(0,Le.jsx)("input",{type:"checkbox",className:"lumiverse-toggle-input",checked:r,onChange:e=>a(e.target.checked),disabled:o}),(0,Le.jsx)("span",{className:"lumiverse-toggle-slider"})]})]})}function Du(e){let{code:n,description:t}=e;const[i,r]=(0,Ee.useState)(!1),a=(0,Ee.useCallback)(()=>{navigator.clipboard.writeText(n),r(!0),setTimeout(()=>r(!1),1500)},[n]);return(0,Le.jsxs)("div",{className:yn("lumia-macro",i&&"lumia-macro--copied"),onClick:a,title:"Click to copy",children:[(0,Le.jsx)("code",{children:n}),(0,Le.jsx)("span",{children:i?"Copied!":t})]})}function zu(e){let{councilMode:n,councilMembers:t,onOpenCouncil:i,actions:r}=e;const[a,o]=(0,Ee.useState)(!1),[s,l]=(0,Ee.useState)(""),[c,u]=(0,Ee.useState)(!1),d=(0,Ee.useSyncExternalStore)(pu.subscribe,gu,gu),m=(0,Ee.useSyncExternalStore)(pu.subscribe,bu,bu),p=(0,Ee.useMemo)(()=>Object.values(d).sort((e,n)=>{const t=e.updatedAt||e.createdAt||0;return(n.updatedAt||n.createdAt||0)-t}),[d]),h=(0,Ee.useCallback)(()=>{const e=s.trim();e&&(d[e]?"undefined"!=typeof toastr&&toastr.warning('Preset "'.concat(e,'" already exists')):(r.savePreset(e),Ye(),l(""),o(!1),"undefined"!=typeof toastr&&toastr.success('Preset "'.concat(e,'" saved'))))},[s,d,r]),v=(0,Ee.useCallback)(e=>{r.loadPreset(e),Ye(),u(!1),"undefined"!=typeof toastr&&toastr.info('Loaded preset "'.concat(e,'"'))},[r]);return(0,Le.jsxs)("div",{className:"lumia-quick-actions",children:[(0,Le.jsxs)("button",{className:yn("lumia-quick-action-btn","lumia-quick-action-btn--council",!n&&"lumia-quick-action-btn--disabled"),onClick:n?i:void 0,disabled:!n,type:"button",title:n?"Configure council members":"Enable Council Mode first",children:[(0,Le.jsx)(Jc,{size:14,strokeWidth:1.5}),(0,Le.jsx)("span",{className:"lumia-quick-action-text",children:n?t.length>0?"".concat(t.length," member").concat(1!==t.length?"s":""):"Configure":"Council"})]}),(0,Le.jsx)("div",{className:"lumia-quick-action-group",children:a?(0,Le.jsxs)("div",{className:"lumia-quick-action-form",children:[(0,Le.jsx)("input",{type:"text",className:"lumia-quick-action-input",placeholder:"Preset name...",value:s,onChange:e=>l(e.target.value),onKeyDown:e=>{"Enter"===e.key&&h(),"Escape"===e.key&&(o(!1),l(""))},autoFocus:!0}),(0,Le.jsx)("button",{className:"lumia-quick-action-btn lumia-quick-action-btn--primary",onClick:h,disabled:!s.trim(),type:"button",title:"Save preset",children:(0,Le.jsx)(iu,{size:14,strokeWidth:2})}),(0,Le.jsx)("button",{className:"lumia-quick-action-btn",onClick:()=>{o(!1),l("")},type:"button",title:"Cancel",children:(0,Le.jsx)(ru,{size:14,strokeWidth:2})})]}):(0,Le.jsxs)(Le.Fragment,{children:[(0,Le.jsx)("button",{className:"lumia-quick-action-btn lumia-quick-action-btn--primary",onClick:()=>o(!0),title:"Save current configuration as preset",type:"button",children:(0,Le.jsx)(eu,{size:14,strokeWidth:2})}),(0,Le.jsxs)("div",{className:"lumia-quick-action-dropdown-wrapper",children:[(0,Le.jsxs)("button",{className:yn("lumia-quick-action-btn",m&&"lumia-quick-action-btn--active"),onClick:()=>u(!c),title:m?"Active: ".concat(m):"Load preset",type:"button",children:[(0,Le.jsx)(nu,{size:14,strokeWidth:1.5}),(0,Le.jsx)("span",{className:"lumia-quick-action-text",children:m||"Presets"}),(0,Le.jsx)(tu,{size:12,strokeWidth:2,className:yn("lumia-quick-action-chevron",c&&"lumia-quick-action-chevron--open")})]}),(0,Le.jsx)(at,{children:c&&(0,Le.jsx)(Zc.div,{className:"lumia-quick-action-dropdown",initial:{opacity:0,y:-8},animate:{opacity:1,y:0},exit:{opacity:0,y:-8},transition:{duration:.15},children:0===p.length?(0,Le.jsx)("div",{className:"lumia-quick-action-dropdown-empty",children:"No presets saved"}):p.map(e=>(0,Le.jsxs)("button",{className:yn("lumia-quick-action-dropdown-item",m===e.name&&"lumia-quick-action-dropdown-item--active"),onClick:()=>v(e.name),type:"button",children:[(0,Le.jsx)("span",{children:e.name}),m===e.name&&(0,Le.jsx)(iu,{size:12,strokeWidth:2})]},e.name))})})]})]})})]})}const Iu=function(){pn();const e=hn(),n=vn(),t=Je(),{packs:i,customPacks:r,allPacks:a}=fn(),[o,s]=(0,Ee.useState)(null),[l,c]=(0,Ee.useState)({customPacks:!1,downloadedPacks:!1,loomPacks:!1}),u=(0,Ee.useCallback)(e=>{c(n=>du(du({},n),{},{[e]:!n[e]}))},[]),d=(0,Ee.useSyncExternalStore)(pu.subscribe,xu,xu),m=(0,Ee.useSyncExternalStore)(pu.subscribe,yu,yu),p=(0,Ee.useSyncExternalStore)(pu.subscribe,ku,ku),h=(0,Ee.useSyncExternalStore)(pu.subscribe,wu,wu),v=m&&p.length>0,f=(0,Ee.useCallback)(e=>{t.setChimeraMode(e),Ye()},[t]),g=(0,Ee.useCallback)(e=>{t.setCouncilMode(e),Ye()},[t]),b=(0,Ee.useCallback)(()=>{t.clearSelections(),Ye(),"undefined"!=typeof toastr&&toastr.info("All Lumia selections cleared")},[t]),x=(0,Ee.useCallback)(e=>{confirm('Are you sure you want to delete "'.concat(e,'"?'))&&(t.removePack(e),Ye(),"undefined"!=typeof toastr&&toastr.success('Pack "'.concat(e,'" deleted')))},[t]),y=(0,Ee.useCallback)(e=>{s(n=>n===e?null:e)},[]),k=a.length,w=(0,Ee.useMemo)(()=>a.reduce((e,n)=>{var t,i,r;const a=(null===(t=n.lumiaItems)||void 0===t?void 0:t.length)||0,o=(null===(i=n.loomItems)||void 0===i?void 0:i.length)||0,s=(null===(r=n.items)||void 0===r?void 0:r.length)||0;return e+(a+o>0?a+o:s)},0),[a]),j=(0,Ee.useMemo)(()=>i.filter(e=>{var n,t,i,r,a;return(null===(n=e.loomItems)||void 0===n?void 0:n.length)>0||((null===(t=e.loomStyles)||void 0===t?void 0:t.length)>0||((null===(i=e.loomUtils)||void 0===i?void 0:i.length)>0||((null===(r=e.loomRetrofits)||void 0===r?void 0:r.length)>0||!(null===(a=e.items)||void 0===a||!a.some(e=>e.loomCategory)))))}),[i]),S=(0,Ee.useCallback)(function(e){if("undefined"!=typeof LumiverseBridge){const r=LumiverseBridge.getCallbacks();if(r&&r[e]){for(var n=arguments.length,t=new Array(n>1?n-1:0),i=1;i<n;i++)t[i-1]=arguments[i];r[e](...t)}}},[]),C=(0,Ee.useCallback)(e=>{var n;const t=null===(n=e.target.files)||void 0===n?void 0:n[0];if(!t)return;console.log("[SettingsPanel] File selected for upload:",t.name);const i=new FileReader;i.onload=e=>{try{const n=JSON.parse(e.target.result);if(console.log("[SettingsPanel] JSON parsed successfully, entries:",n.entries?Object.keys(n.entries).length:"no entries field"),"undefined"!=typeof LumiverseBridge){const e=LumiverseBridge.getCallbacks();console.log("[SettingsPanel] Available callbacks:",e?Object.keys(e).filter(n=>e[n]):"none"),e&&e.handleNewBook?(console.log("[SettingsPanel] Calling handleNewBook..."),e.handleNewBook(n,t.name,!1),e.refreshUIDisplay&&e.refreshUIDisplay(),console.log("[SettingsPanel] Import complete")):(console.error("[SettingsPanel] handleNewBook callback not registered"),"undefined"!=typeof toastr&&toastr.error("Import function not available. Please reload the page."))}else console.error("[SettingsPanel] LumiverseBridge not available"),"undefined"!=typeof toastr&&toastr.error("Bridge not available. Please reload the page.")}catch(e){console.error("[SettingsPanel] Failed to parse JSON:",e),"undefined"!=typeof toastr&&toastr.error("Failed to parse JSON: "+e.message)}},i.onerror=()=>{console.error("[SettingsPanel] Failed to read file"),"undefined"!=typeof toastr&&toastr.error("Failed to read file")},i.readAsText(t),e.target.value=""},[]),N=(0,Ee.useSyncExternalStore)(pu.subscribe,ju,ju),P=(0,Ee.useSyncExternalStore)(pu.subscribe,Su,Su),E=(0,Ee.useCallback)(e=>{pu.setState({showLumiverseDrawer:e}),Ye()},[]),M=(0,Ee.useCallback)(()=>{window.confirm("WARNING: This will completely reset ALL Lumiverse Helper settings to defaults.\n\nThis includes:\n- All downloaded packs\n- All custom packs\n- All Lumia and Loom selections\n- All presets\n- All advanced settings\n\nThe page will reload after reset.\n\nAre you sure you want to continue?")&&("undefined"!=typeof LumiverseBridge&&LumiverseBridge.resetAllSettings?("undefined"!=typeof toastr&&toastr.warning("Resetting all settings..."),LumiverseBridge.resetAllSettings()):(console.error("[SettingsPanel] resetAllSettings not available on bridge"),"undefined"!=typeof toastr&&toastr.error("Reset function not available. Please reload the page.")))},[]),L=(0,Ee.useCallback)(e=>{pu.setState({lumiaButtonPosition:du(du({},pu.getState().lumiaButtonPosition),{},{useDefault:e})}),Ye()},[]),O=(0,Ee.useCallback)(e=>{const n=Math.max(0,Math.min(100,parseInt(e,10)||0));pu.setState({lumiaButtonPosition:du(du({},pu.getState().lumiaButtonPosition),{},{xPercent:n})}),Ye()},[]),T=(0,Ee.useCallback)(e=>{const n=Math.max(0,Math.min(100,parseInt(e,10)||0));pu.setState({lumiaButtonPosition:du(du({},pu.getState().lumiaButtonPosition),{},{yPercent:n})}),Ye()},[]);return(0,Le.jsxs)("div",{className:"lumia-injector-settings",children:[(0,Le.jsx)("div",{className:"lumia-drawer-toggle-container",children:(0,Le.jsxs)("label",{className:"lumiverse-toggle-wrapper",children:[(0,Le.jsxs)("div",{className:"lumiverse-toggle-text",children:[(0,Le.jsx)("span",{className:"lumiverse-toggle-label",children:"Show Lumiverse Drawer"}),(0,Le.jsx)("span",{className:"lumiverse-toggle-description",children:"Access quick settings from a slide-out panel"})]}),(0,Le.jsxs)("div",{className:yn("lumiverse-toggle",N&&"lumiverse-toggle--on"),children:[(0,Le.jsx)("input",{type:"checkbox",className:"lumiverse-toggle-input",checked:N,onChange:e=>E(e.target.checked)}),(0,Le.jsx)("span",{className:"lumiverse-toggle-slider"})]})]})}),N&&(0,Le.jsxs)("div",{className:"lumia-button-position-container",children:[(0,Le.jsxs)("label",{className:"lumiverse-toggle-wrapper",children:[(0,Le.jsxs)("div",{className:"lumiverse-toggle-text",children:[(0,Le.jsx)("span",{className:"lumiverse-toggle-label",children:"Custom Button Position"}),(0,Le.jsx)("span",{className:"lumiverse-toggle-description",children:"Position the Lumia button anywhere on screen"})]}),(0,Le.jsxs)("div",{className:yn("lumiverse-toggle",!P.useDefault&&"lumiverse-toggle--on"),children:[(0,Le.jsx)("input",{type:"checkbox",className:"lumiverse-toggle-input",checked:!P.useDefault,onChange:e=>L(!e.target.checked)}),(0,Le.jsx)("span",{className:"lumiverse-toggle-slider"})]})]}),!P.useDefault&&(0,Le.jsxs)("div",{className:"lumia-button-position-inputs",children:[(0,Le.jsxs)("div",{className:"lumia-position-field",children:[(0,Le.jsx)("label",{htmlFor:"lumia-btn-x",children:"X (% from right)"}),(0,Le.jsx)("input",{type:"number",id:"lumia-btn-x",className:"lumia-input lumia-input-sm",value:P.xPercent,onChange:e=>O(e.target.value),min:"0",max:"100"})]}),(0,Le.jsxs)("div",{className:"lumia-position-field",children:[(0,Le.jsx)("label",{htmlFor:"lumia-btn-y",children:"Y (% from top)"}),(0,Le.jsx)("input",{type:"number",id:"lumia-btn-y",className:"lumia-input lumia-input-sm",value:P.yPercent,onChange:e=>T(e.target.value),min:"0",max:"100"})]}),(0,Le.jsx)("span",{className:"lumia-position-hint",children:"Slide-out animation is disabled with custom positioning"})]})]}),(0,Le.jsxs)(Eu,{title:"World Book Source",icon:Nu.book,children:[(0,Le.jsx)("div",{className:"lumia-status-badge",children:k>0?"".concat(k," pack").concat(1!==k?"s":""," loaded (").concat(w," items)"):"No packs loaded"}),(0,Le.jsxs)("div",{className:"lumia-input-row",children:[(0,Le.jsx)("input",{type:"text",className:"lumia-input",placeholder:"Enter World Book URL (JSON)",id:"lumia-url-input-react"}),(0,Le.jsx)("button",{className:"lumia-btn lumia-btn-primary",onClick:()=>S("fetchWorldBook"),type:"button",children:"Fetch"})]}),(0,Le.jsxs)("div",{className:"lumia-source-actions",children:[(0,Le.jsx)("div",{className:"lumia-divider-text",children:"or"}),(0,Le.jsxs)("button",{className:"lumia-btn lumia-btn-secondary lumia-btn-full",onClick:()=>{var e;return null===(e=document.getElementById("lumia-file-input-react"))||void 0===e?void 0:e.click()},type:"button",children:[Nu.upload,"Upload JSON File"]}),(0,Le.jsx)("input",{type:"file",id:"lumia-file-input-react",accept:".json",style:{display:"none"},onChange:C}),(0,Le.jsx)("div",{className:"lumia-divider-text",children:"or"}),(0,Le.jsxs)("button",{className:"lumia-btn lumia-btn-primary lumia-btn-full",onClick:()=>S("showLucidCardsModal"),type:"button",children:[Nu.box,"Browse Lucid Cards"]})]})]}),(0,Le.jsxs)(Eu,{title:"Lumia Configuration",icon:Nu.settings,action:(0,Le.jsxs)("button",{className:"lumia-clear-all-btn",onClick:b,title:"Clear all Lumia selections",type:"button",children:[(0,Le.jsx)(Mn,{size:14,strokeWidth:1.5}),"Clear All"]}),children:[(0,Le.jsxs)("div",{className:"lumia-mode-toggles",children:[(0,Le.jsx)(Tu,{icon:Cu.chimera,label:"Chimera Mode",description:"Fuse multiple physical definitions",checked:d,onChange:f,disabled:m}),(0,Le.jsx)(Tu,{icon:Cu.council,label:"Council Mode",description:"Multiple independent Lumias",checked:m,onChange:g,disabled:d})]}),(0,Le.jsx)(zu,{councilMode:m,councilMembers:p,onOpenCouncil:()=>t.openModal("councilSelect"),actions:t}),(0,Le.jsxs)("div",{className:yn("lumia-selector-group",v&&"lumia-selector-group--disabled"),children:[(0,Le.jsx)(Lu,{label:d?"Chimera Definitions":"Definition",hint:d?"Select Multiple":"Select One",selections:d?h:e.definition?[e.definition]:[],modalName:"definitions"}),(0,Le.jsx)(Lu,{label:"Behaviors",hint:"Select Multiple",selections:e.behaviors,dominant:e.dominantBehavior,modalName:"behaviors"}),(0,Le.jsx)(Lu,{label:"Personalities",hint:"Select Multiple",selections:e.personalities,dominant:e.dominantPersonality,modalName:"personalities"})]})]}),(0,Le.jsx)(Eu,{title:"Loom Configuration",icon:Nu.layers,children:(0,Le.jsxs)("div",{className:"lumia-selector-group",children:[(0,Le.jsx)(Lu,{label:"Narrative Style",hint:"Select Multiple",selections:n.styles,modalName:"loomStyles"}),(0,Le.jsx)(Lu,{label:"Loom Utilities",hint:"Select Multiple",selections:n.utilities,modalName:"loomUtilities"}),(0,Le.jsx)(Lu,{label:"Retrofits",hint:"Select Multiple",selections:n.retrofits,modalName:"loomRetrofits"})]})}),(0,Le.jsx)(Eu,{title:"Tools",icon:Nu.tools,children:(0,Le.jsxs)("div",{className:"lumia-tools-row",children:[(0,Le.jsx)(Ou,{icon:Nu.plus,label:"Lumia Editor",onClick:()=>t.openModal("packSelector"),accent:!0}),(0,Le.jsx)(Ou,{icon:Nu.dots,label:"OOC Settings",onClick:()=>S("showMiscFeaturesModal")}),(0,Le.jsx)(Ou,{icon:Nu.lines,label:"Summarization",onClick:()=>S("showSummarizationModal")}),(0,Le.jsx)(Ou,{icon:Nu.edit,label:"Prompt Settings",onClick:()=>S("showPromptSettingsModal")})]})}),(0,Le.jsxs)(Mu,{title:"Macro Reference",icon:Nu.terminal,children:[(0,Le.jsxs)("div",{className:"lumia-macro-group",children:[(0,Le.jsx)("div",{className:"lumia-macro-group-title",children:"Lumia Content"}),(0,Le.jsxs)("div",{className:"lumia-macro-list",children:[(0,Le.jsx)(Du,{code:"{{lumiaDef}}",description:"Physical Definition"}),(0,Le.jsx)(Du,{code:"{{lumiaBehavior}}",description:"Behavior(s)"}),(0,Le.jsx)(Du,{code:"{{lumiaPersonality}}",description:"Personality(s)"}),(0,Le.jsx)(Du,{code:"{{lumiaCouncilModeActive}}",description:"Yes/No status indicator, (conditional ready)"})]})]}),(0,Le.jsxs)("div",{className:"lumia-macro-group",children:[(0,Le.jsx)("div",{className:"lumia-macro-group-title",children:"Loom Content"}),(0,Le.jsxs)("div",{className:"lumia-macro-list",children:[(0,Le.jsx)(Du,{code:"{{loomStyle}}",description:"Narrative Style"}),(0,Le.jsx)(Du,{code:"{{loomUtils}}",description:"Loom Utilities"}),(0,Le.jsx)(Du,{code:"{{loomRetrofits}}",description:"Retrofits"})]})]}),(0,Le.jsxs)("div",{className:"lumia-macro-group",children:[(0,Le.jsx)("div",{className:"lumia-macro-group-title",children:"Random Lumia"}),(0,Le.jsxs)("div",{className:"lumia-macro-list",children:[(0,Le.jsx)(Du,{code:"{{randomLumia}}",description:"Random definition"}),(0,Le.jsx)(Du,{code:"{{randomLumia.pers}}",description:"Random personality"}),(0,Le.jsx)(Du,{code:"{{randomLumia.behav}}",description:"Random behavior"}),(0,Le.jsx)(Du,{code:"{{randomLumia.name}}",description:"Random name"})]})]}),(0,Le.jsxs)("div",{className:"lumia-macro-group",children:[(0,Le.jsx)("div",{className:"lumia-macro-group-title",children:"Tracking & OOC"}),(0,Le.jsxs)("div",{className:"lumia-macro-list",children:[(0,Le.jsx)(Du,{code:"{{lumiaMessageCount}}",description:"Message count"}),(0,Le.jsx)(Du,{code:"{{lumiaOOCTrigger}}",description:"OOC trigger/countdown"})]})]}),(0,Le.jsxs)("div",{className:"lumia-macro-group",children:[(0,Le.jsx)("div",{className:"lumia-macro-group-title",children:"Summarization"}),(0,Le.jsxs)("div",{className:"lumia-macro-list",children:[(0,Le.jsx)(Du,{code:"{{loomSummary}}",description:"Stored summary"}),(0,Le.jsx)(Du,{code:"{{loomSummaryPrompt}}",description:"Summary directive"}),(0,Le.jsx)(Du,{code:"/loom-summarize",description:"Manual trigger"})]})]}),(0,Le.jsxs)("div",{className:"lumia-macro-group",children:[(0,Le.jsx)("div",{className:"lumia-macro-group-title",children:"Sovereign Hand"}),(0,Le.jsxs)("div",{className:"lumia-macro-list",children:[(0,Le.jsx)(Du,{code:"{{loomSovHand}}",description:"Full Sovereign Hand prompt (with user message)"}),(0,Le.jsx)(Du,{code:"{{loomSovHandActive}}",description:"Yes/No status indicator (conditional ready)"}),(0,Le.jsx)(Du,{code:"{{loomLastUserMessage}}",description:"Last user message content"}),(0,Le.jsx)(Du,{code:"{{loomLastCharMessage}}",description:"Last character message content"}),(0,Le.jsx)(Du,{code:"{{lastMessageName}}",description:"Name of whoever sent the last message"}),(0,Le.jsx)(Du,{code:"{{loomContinuePrompt}}",description:"Continue-scene prompt when character spoke last"})]})]})]}),r.length>0&&(0,Le.jsx)(Eu,{title:"Custom Packs",icon:Nu.package,collapsible:!0,collapsed:l.customPacks,onToggle:()=>u("customPacks"),children:(0,Le.jsx)("div",{className:"lumia-custom-packs",children:r.map(e=>{var n,i;const r=e.id||e.name,a=o===r,s=(null===(n=e.lumiaItems)||void 0===n?void 0:n.length)>0?e.lumiaItems:(null===(i=e.items)||void 0===i?void 0:i.filter(e=>e.lumiaDefName))||[];return(0,Le.jsxs)(Zc.div,{className:yn("lumia-pack-item-container",a&&"lumia-pack-item-container--expanded"),initial:{opacity:0,y:-10},animate:{opacity:1,y:0},children:[(0,Le.jsxs)("div",{className:"lumia-pack-item",children:[(0,Le.jsx)("button",{className:"lumia-pack-expand-btn",onClick:()=>y(r),type:"button",title:a?"Collapse":"Expand to see Lumias",children:(0,Le.jsx)("span",{className:yn("lumia-pack-chevron",a&&"lumia-pack-chevron--expanded"),children:Nu.chevronDown})}),(0,Le.jsx)("span",{className:"lumia-pack-name",onClick:()=>y(r),style:{cursor:"pointer"},children:e.name}),(0,Le.jsxs)("span",{className:"lumia-pack-count",children:[s.length," Lumia",1!==s.length?"s":""]}),(0,Le.jsx)("button",{className:"lumia-btn lumia-btn-icon",onClick:()=>Rn(e),title:"Export as Lumiverse Pack",type:"button",children:Nu.download}),(0,Le.jsx)("button",{className:"lumia-btn lumia-btn-icon",onClick:()=>t.openModal("packEditor",{packId:r}),title:"Edit pack",type:"button",children:Nu.edit})]}),(0,Le.jsx)($n,{isOpen:a&&s.length>0,className:"lumia-pack-items-list",duration:200,children:s.map((n,i)=>(0,Le.jsx)(Pu,{item:n,packName:e.name,onEdit:(e,n)=>t.openModal("lumiaEditor",{packName:e,editingItem:n}),editIcon:Nu.edit},n.lumiaDefName||i))}),(0,Le.jsx)($n,{isOpen:a&&0===s.length,className:"lumia-pack-items-empty",duration:200,children:(0,Le.jsx)("span",{children:"No Lumias in this pack yet"})})]},r)})})}),i.length>0&&(0,Le.jsx)(Eu,{title:"Downloaded Packs",icon:Nu.box,collapsible:!0,collapsed:l.downloadedPacks,onToggle:()=>u("downloadedPacks"),children:(0,Le.jsx)("div",{className:"lumia-downloaded-packs",children:i.map(e=>{var n,i;const r=e.name||e.packName||"Unknown Pack",a=(null===(n=e.lumiaItems)||void 0===n?void 0:n.length)>0?e.lumiaItems:(null===(i=e.items)||void 0===i?void 0:i.filter(e=>e.lumiaDefName&&e.lumiaDef))||[],o=e.coverUrl||e.packCover;return(0,Le.jsxs)("div",{className:"lumia-downloaded-pack-item",children:[o?(0,Le.jsx)("img",{src:o,alt:r,className:"lumia-downloaded-pack-cover"}):(0,Le.jsx)("div",{className:"lumia-downloaded-pack-cover-placeholder",children:Nu.package}),(0,Le.jsxs)("div",{className:"lumia-downloaded-pack-info",children:[(0,Le.jsx)("span",{className:"lumia-downloaded-pack-name",children:r}),(0,Le.jsxs)("span",{className:"lumia-downloaded-pack-count",children:[a.length," Lumia",1!==a.length?"s":""]})]}),(0,Le.jsxs)("div",{className:"lumia-downloaded-pack-actions",children:[(0,Le.jsx)("button",{className:"lumia-btn lumia-btn-icon",onClick:()=>t.openPackDetail(r),title:"View pack contents",type:"button",children:(0,Le.jsx)(au,{size:16,strokeWidth:1.5})}),(0,Le.jsx)("button",{className:"lumia-btn lumia-btn-icon lumia-btn-icon-danger",onClick:()=>x(r),title:"Delete pack",type:"button",children:(0,Le.jsx)(Mn,{size:16,strokeWidth:1.5})})]})]},r)})})}),j.length>0&&(0,Le.jsx)(Eu,{title:"Loom Packs",icon:Nu.layers,collapsible:!0,collapsed:l.loomPacks,onToggle:()=>u("loomPacks"),children:(0,Le.jsx)("div",{className:"lumia-loom-packs",children:j.map(e=>{var n,i,r;const a=e.name||e.packName||"Unknown Pack";let o=(null===(n=e.loomStyles)||void 0===n?void 0:n.length)||0,s=(null===(i=e.loomUtils)||void 0===i?void 0:i.length)||0,l=(null===(r=e.loomRetrofits)||void 0===r?void 0:r.length)||0;const c=e=>{const n=e.loomCategory||e.category;"Narrative Style"===n||"loomStyles"===n?o++:"Loom Utilities"===n||"loomUtils"===n?s++:"Retrofits"!==n&&"loomRetrofits"!==n||l++};return e.loomItems&&e.loomItems.forEach(c),e.items&&e.items.forEach(e=>{(e.loomCategory||e.category)&&c(e)}),(0,Le.jsxs)("div",{className:"lumia-loom-pack-item",children:[e.packCover?(0,Le.jsx)("img",{src:e.packCover,alt:a,className:"lumia-loom-pack-cover"}):(0,Le.jsx)("div",{className:"lumia-loom-pack-cover-placeholder",children:Nu.layers}),(0,Le.jsxs)("div",{className:"lumia-loom-pack-info",children:[(0,Le.jsx)("span",{className:"lumia-loom-pack-name",children:a}),(0,Le.jsxs)("div",{className:"lumia-loom-pack-stats",children:[o>0&&(0,Le.jsxs)("span",{children:[(0,Le.jsx)(ou,{size:10})," ",o]}),s>0&&(0,Le.jsxs)("span",{children:[(0,Le.jsx)(su,{size:10})," ",s]}),l>0&&(0,Le.jsxs)("span",{children:[(0,Le.jsx)(lu,{size:10})," ",l]})]})]}),(0,Le.jsxs)("div",{className:"lumia-loom-pack-actions",children:[(0,Le.jsx)("button",{className:"lumia-btn lumia-btn-icon",onClick:()=>t.openLoomPackDetail(a),title:"View loom contents",type:"button",children:(0,Le.jsx)(au,{size:16,strokeWidth:1.5})}),(0,Le.jsx)("button",{className:"lumia-btn lumia-btn-icon lumia-btn-icon-danger",onClick:()=>x(a),title:"Delete pack",type:"button",children:(0,Le.jsx)(Mn,{size:16,strokeWidth:1.5})})]})]},a)})})}),(0,Le.jsx)(Mu,{title:"Danger Zone",icon:(0,Le.jsx)(cu,{size:16,strokeWidth:1.5}),children:(0,Le.jsxs)("div",{className:"lumia-danger-zone",children:[(0,Le.jsx)("p",{className:"lumia-danger-zone-description",children:"If you're experiencing issues with the extension, you can reset all settings to their defaults. This will remove all packs, selections, and configurations."}),(0,Le.jsxs)("button",{className:"lumia-btn lumia-btn-danger lumia-btn-full",onClick:M,type:"button",children:[(0,Le.jsx)(cu,{size:16,strokeWidth:1.5}),"Reset All Settings"]})]})})]})};var Au=t(961);function Ru(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,i)}return t}function Bu(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Ru(Object(t),!0).forEach(function(n){_u(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Ru(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function _u(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,n||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const Uu=Ge,Fu=[],Vu=()=>Uu.getState().chimeraMode||!1,Wu=()=>Uu.getState().selectedDefinitions||Fu,Hu={star:'<svg viewBox="0 0 24 24"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>',check:'<svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"></polyline></svg>',trash:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>',clear:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>',chevron:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>',chevronDown:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>',chevronUp:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="18 15 12 9 6 15"></polyline></svg>',edit:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>',folder:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>',definition:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>',behavior:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path></svg>',personality:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a10 10 0 1 0 10 10H12V2z"></path><path d="M12 2a10 10 0 0 1 10 10"></path><circle cx="12" cy="12" r="6"></circle></svg>',sort:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" y1="6" x2="14" y2="6"></line><line x1="4" y1="12" x2="11" y2="12"></line><line x1="4" y1="18" x2="8" y2="18"></line><polyline points="15 15 18 18 21 15"></polyline><line x1="18" y1="9" x2="18" y2="18"></line></svg>',sparkles:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M19 17v4"/><path d="M3 5h4"/><path d="M17 19h4"/></svg>'};function $u(e){let{name:n,className:t}=e;const i=Hu[n];return i?(0,Le.jsx)("span",{className:t,dangerouslySetInnerHTML:{__html:i}}):null}function qu(e,n){if(!e)return null;const t={name:["lumiaName","lumiaDefName"],def:["lumiaDefinition","lumiaDef"],personality:["lumiaPersonality","lumia_personality"],behavior:["lumiaBehavior","lumia_behavior"],img:["avatarUrl","lumia_img"]}[n];if(!t)return null;for(const n of t)if(void 0!==e[n]&&null!==e[n])return e[n];return null}function Yu(e){let{item:n,packName:t,isSelected:i,isDominant:r,onSelect:a,onSetDominant:o,showDominant:s,isDefinition:l,animationIndex:c,isEditable:u,onEdit:d}=e;const[m,p]=(0,Ee.useState)(!1),[h,v]=(0,Ee.useState)(!1),f=Je(),g=qu(n,"name")||"Unknown",b=qu(n,"img"),x=function(e){return[!!qu(e,"def"),!!qu(e,"behavior"),!!qu(e,"personality")].filter(Boolean).length>1}(n),y=x&&f.areAllTraitsEnabledForLumia(t,g),{objectPosition:k}=bn(b),w=Math.min(30*c,300);return(0,Le.jsxs)("div",{className:yn("lumia-card","lumia-card-appear",l&&"definition-card",i&&"selected"),style:{animationDelay:"".concat(w,"ms")},onClick:e=>{e.target.closest(".lumia-dominant-icon")||e.target.closest(".lumia-edit-icon")||e.target.closest(".lumia-enable-all-icon")||a(n)},"data-pack":t,"data-item":g,children:[(0,Le.jsxs)("div",{className:"lumia-card-image",children:[b&&!h?(0,Le.jsxs)(Le.Fragment,{children:[(0,Le.jsx)("img",{src:b,alt:g,loading:"lazy",className:m?"lumia-img-loaded":"",style:{objectPosition:k},onLoad:()=>p(!0),onError:()=>v(!0)}),!m&&(0,Le.jsx)("div",{className:"lumia-img-spinner"})]}):(0,Le.jsx)("div",{className:"lumia-card-placeholder",children:"?"}),x&&(0,Le.jsx)("div",{className:yn("lumia-enable-all-icon",y&&"all-enabled"),onClick:e=>{e.stopPropagation();f.toggleAllTraitsForLumia(t,g);Ye()},title:y?"Disable all traits for this Lumia":"Enable all traits for this Lumia",children:(0,Le.jsx)($u,{name:"sparkles"})}),u&&d&&(0,Le.jsx)("div",{className:"lumia-edit-icon",onClick:e=>{e.stopPropagation(),d&&d(n)},title:"Edit this Lumia",children:(0,Le.jsx)($u,{name:"edit"})}),s&&(0,Le.jsx)("div",{className:yn("lumia-dominant-icon",r&&"dominant"),onClick:e=>{e.stopPropagation(),o(n)},title:r?"Remove as dominant":"Set as dominant trait",children:(0,Le.jsx)($u,{name:"star"})}),(0,Le.jsx)("div",{className:"lumia-card-check",children:(0,Le.jsx)($u,{name:"check"})})]}),(0,Le.jsx)("div",{className:"lumia-card-info",children:(0,Le.jsx)("div",{className:"lumia-card-name",children:g})})]})}function Ku(e){let{pack:n,items:t,isEditable:i,type:r,isSelected:a,isDominant:o,onSelect:s,onSetDominant:l,showDominant:c,onRemovePack:u,onEditItem:d,isCollapsed:m,onToggleCollapse:p}=e;const[h,v]=(0,Ee.useState)(!1),f=void 0!==m,g=f?m:h,b=n.name||n.packName||"Unknown Pack";return(0,Le.jsxs)("div",{className:yn("lumia-modal-panel","lumia-collapsible","lumia-pack-section",g&&"collapsed"),children:[(0,Le.jsxs)("div",{className:"lumia-modal-panel-header lumia-collapsible-trigger",onClick:e=>{e.target.closest(".lumia-remove-pack-btn")||(f&&p?p(b):v(!h))},children:[(0,Le.jsx)("span",{className:"lumia-panel-collapse-icon",children:(0,Le.jsx)($u,{name:"chevron"})}),(0,Le.jsx)("span",{className:"lumia-modal-panel-icon",children:(0,Le.jsx)($u,{name:"folder"})}),(0,Le.jsx)("span",{className:"lumia-modal-panel-title",children:b}),i&&(0,Le.jsx)("span",{className:"lumia-pack-badge-custom",children:"Custom"}),(0,Le.jsxs)("span",{className:"lumia-modal-panel-count",children:[t.length," items"]}),(0,Le.jsx)("button",{className:"lumia-icon-btn-sm lumia-remove-pack-btn",onClick:e=>{e.stopPropagation(),u(b)},title:"Remove Pack",children:(0,Le.jsx)($u,{name:"trash"})})]}),(0,Le.jsx)("div",{className:"lumia-modal-panel-content lumia-modal-panel-content-cards lumia-collapsible-content",children:(0,Le.jsx)("div",{className:"lumia-card-grid",children:t.map((e,n)=>(0,Le.jsx)(Yu,{item:e,packName:b,isSelected:a(e,b),isDominant:o(e,b),onSelect:e=>s(e,b),onSetDominant:e=>l(e,b),showDominant:c,isDefinition:"definitions"===r,animationIndex:n,isEditable:i,onEdit:i?e=>d(e,b):void 0},qu(e,"name")||e.id||n))})})]})}const Gu=function(e){let{type:n,multiSelect:t=!0,allowDominant:i=!1,onClose:r}=e;const{allPacks:a}=fn(),o=hn(),s=Je(),l=(0,Ee.useSyncExternalStore)(Uu.subscribe,Vu,Vu),c=(0,Ee.useSyncExternalStore)(Uu.subscribe,Wu,Wu),u=function(e){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];switch(e){case"definitions":return n?{title:"Select Chimera Forms",subtitle:"Choose multiple physical forms to fuse into a Chimera",isMulti:!0,dominantKey:null}:{title:"Select Definition",subtitle:"Choose the physical form for your Lumia",isMulti:!1,dominantKey:null};case"behaviors":return{title:"Select Behaviors",subtitle:"Choose behavioral traits (tap star for dominant)",isMulti:!0,dominantKey:"dominantBehavior"};case"personalities":return{title:"Select Personalities",subtitle:"Choose personality traits (tap star for dominant)",isMulti:!0,dominantKey:"dominantPersonality"};default:return{title:"Select Items",subtitle:"",isMulti:!0,dominantKey:null}}}(n,l),d=function(e){switch(e){case"definitions":default:return"definition";case"behaviors":return"behavior";case"personalities":return"personality"}}(n),m=(0,Ee.useMemo)(()=>{switch(n){case"behaviors":return{selectedItems:o.behaviors||[],dominantItem:o.dominantBehavior,toggleAction:s.toggleBehavior,setDominantAction:s.setDominantBehavior,clearAction:()=>{s.setSelectedBehaviors([]),s.setDominantBehavior(null)}};case"personalities":return{selectedItems:o.personalities||[],dominantItem:o.dominantPersonality,toggleAction:s.togglePersonality,setDominantAction:s.setDominantPersonality,clearAction:()=>{s.setSelectedPersonalities([]),s.setDominantPersonality(null)}};case"definitions":return l?{selectedItems:c,dominantItem:null,toggleAction:s.toggleChimeraDefinition,setDominantAction:null,clearAction:s.clearChimeraDefinitions}:{selectedItems:o.definition?[o.definition]:[],dominantItem:null,toggleAction:e=>{const n=o.definition;n&&n.packName===e.packName&&n.itemName===e.itemName?s.setSelectedDefinition(null):s.setSelectedDefinition(e)},setDominantAction:null,clearAction:()=>s.setSelectedDefinition(null)};default:return{selectedItems:[],dominantItem:null,toggleAction:()=>{},setDominantAction:null,clearAction:()=>{}}}},[n,o,s,l,c]),{selectedItems:p,dominantItem:h,toggleAction:v,setDominantAction:f,clearAction:g}=m;(0,Ee.useEffect)(()=>{const e=setTimeout(()=>{Ye()},100);return()=>clearTimeout(e)},[p,h]);const[b,x]=(0,Ee.useState)(new Set),[y,k]=(0,Ee.useState)("default"),w=(0,Ee.useMemo)(()=>a.map(e=>{const n=function(e){return e.lumiaItems&&Array.isArray(e.lumiaItems)?e.lumiaItems:(e.items||[]).filter(e=>!e.loomCategory&&!!e.lumiaDefName)}(e);return Bu(Bu({},e),{},{lumiaItems:n,isEditable:e.isCustom||e.isEditable||!1})}).filter(e=>e.lumiaItems.length>0),[a,n]),j=(0,Ee.useMemo)(()=>"default"===y?w:[...w].sort((e,n)=>{if("name"===y){const t=(e.name||e.packName||"").toLowerCase(),i=(n.name||n.packName||"").toLowerCase();return t.localeCompare(i)}if("author"===y){const t=(e.author||"").toLowerCase(),i=(n.author||"").toLowerCase();return t.localeCompare(i)}return 0}),[w,y]),S=(0,Ee.useCallback)(e=>{x(n=>{const t=new Set(n);return t.has(e)?t.delete(e):t.add(e),t})},[]),C=(0,Ee.useCallback)(e=>b.has(e),[b]),N=(0,Ee.useCallback)((e,n)=>{const t=qu(e,"name");return p.some(e=>e.packName===n&&e.itemName===t)},[p]),P=(0,Ee.useCallback)((e,n)=>{if(!h)return!1;const t=qu(e,"name");return h.packName===n&&h.itemName===t},[h]),E=(0,Ee.useCallback)((e,n)=>{const t={packName:n,itemName:qu(e,"name")};v(t)},[v]),M=(0,Ee.useCallback)((e,n)=>{if(!f)return;const t={packName:n,itemName:qu(e,"name")};N(e,n)||v(t),P(e,n)?f(null):f(t)},[f,v,N,P]),L=(0,Ee.useCallback)(()=>{g()},[g]),O=(0,Ee.useCallback)(e=>{window.confirm('Delete pack "'.concat(e,'"? This action cannot be undone.'))&&(s.removeCustomPack(e),Ye())},[s]),T=(0,Ee.useCallback)((e,n)=>{s.openModal("lumiaEditor",{packName:n,editingItem:e})},[s]);return(0,Le.jsxs)("div",{className:"lumia-modal-selection-content",children:[(0,Le.jsxs)("div",{className:"lumia-modal-header-inner",children:[(0,Le.jsx)("div",{className:"lumia-modal-header-icon",children:(0,Le.jsx)($u,{name:d})}),(0,Le.jsxs)("div",{className:"lumia-modal-header-text",children:[(0,Le.jsx)("h3",{className:"lumia-modal-title",children:u.title}),(0,Le.jsx)("p",{className:"lumia-modal-subtitle",children:u.subtitle})]}),(0,Le.jsxs)("button",{className:"lumia-clear-btn",onClick:L,title:"Clear all selections",children:[(0,Le.jsx)($u,{name:"clear"}),(0,Le.jsx)("span",{children:"Clear"})]})]}),j.length>0&&(0,Le.jsxs)("div",{className:"lumia-modal-controls",children:[(0,Le.jsxs)("div",{className:"lumia-modal-controls-group",children:[(0,Le.jsxs)("button",{className:"lumia-modal-control-btn",onClick:()=>{x(new Set)},title:"Expand all packs",type:"button",children:[(0,Le.jsx)($u,{name:"chevronDown",className:"lumia-control-icon"}),(0,Le.jsx)("span",{children:"Expand All"})]}),(0,Le.jsxs)("button",{className:"lumia-modal-control-btn",onClick:()=>{const e=w.map(e=>e.name||e.packName);x(new Set(e))},title:"Collapse all packs",type:"button",children:[(0,Le.jsx)($u,{name:"chevronUp",className:"lumia-control-icon"}),(0,Le.jsx)("span",{children:"Collapse All"})]})]}),(0,Le.jsxs)("div",{className:"lumia-modal-sort",children:[(0,Le.jsx)($u,{name:"sort",className:"lumia-sort-icon"}),(0,Le.jsx)("span",{className:"lumia-modal-sort-label",children:"Sort:"}),(0,Le.jsxs)("select",{className:"lumia-select",value:y,onChange:e=>k(e.target.value),children:[(0,Le.jsx)("option",{value:"default",children:"Default"}),(0,Le.jsx)("option",{value:"name",children:"Pack Name"}),(0,Le.jsx)("option",{value:"author",children:"Author"})]})]})]}),(0,Le.jsx)("div",{className:"lumia-modal-content",children:0===j.length?(0,Le.jsx)("div",{className:"lumia-modal-empty",children:"No Lumia Packs loaded. Add one in settings!"}):j.map(e=>{const t=e.name||e.packName;return(0,Le.jsx)(Ku,{pack:e,items:e.lumiaItems,isEditable:e.isEditable,type:n,isSelected:N,isDominant:P,onSelect:E,onSetDominant:M,showDominant:i&&u.isMulti,onRemovePack:O,onEditItem:T,isCollapsed:C(t),onToggleCollapse:S},e.id||t)})}),(0,Le.jsxs)("div",{className:"lumia-modal-footer",children:[(0,Le.jsx)("button",{className:"lumia-modal-btn lumia-modal-btn-secondary lumia-modal-close-btn",onClick:r,children:"Close"}),u.isMulti&&(0,Le.jsx)("button",{className:"lumia-modal-btn lumia-modal-btn-primary lumia-modal-done",onClick:r,children:"Done"})]})]})};function Qu(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,i)}return t}function Xu(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Qu(Object(t),!0).forEach(function(n){Zu(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Qu(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Zu(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,n||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const Ju={trash:'<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>',chevronDown:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>',chevronUp:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="18 15 12 9 6 15"></polyline></svg>',chevron:'<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>',folder:'<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>',search:'<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>',sort:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" y1="6" x2="14" y2="6"></line><line x1="4" y1="12" x2="11" y2="12"></line><line x1="4" y1="18" x2="8" y2="18"></line><polyline points="15 15 18 18 21 15"></polyline><line x1="18" y1="9" x2="18" y2="18"></line></svg>',clear:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>',edit:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>'};function ed(e){let{name:n,className:t}=e;const i=Ju[n];return i?(0,Le.jsx)("span",{className:t,dangerouslySetInnerHTML:{__html:i}}):null}const nd={loomStyles:{category:"Narrative Style",packField:"loomStyles",storeField:"styles",toggleAction:"toggleLoomStyle",isMulti:!0},loomUtilities:{category:"Loom Utilities",packField:"loomUtils",storeField:"utilities",toggleAction:"toggleLoomUtility",isMulti:!0},loomRetrofits:{category:"Retrofits",packField:"loomRetrofits",storeField:"retrofits",toggleAction:"toggleLoomRetrofit",isMulti:!0}};function td(e){let{value:n,onChange:t,placeholder:i}=e;return(0,Le.jsxs)("div",{className:"lumia-search-box",children:[(0,Le.jsx)(ed,{name:"search",className:"lumia-search-icon"}),(0,Le.jsx)("input",{type:"text",className:"lumia-search-input",value:n,onChange:e=>t(e.target.value),placeholder:i}),n&&(0,Le.jsx)("button",{className:"lumia-search-clear",onClick:()=>t(""),type:"button","aria-label":"Clear search",children:(0,Le.jsx)(ed,{name:"clear",className:"lumia-search-clear-icon"})})]})}function id(e){let{item:n,packName:t,isSelected:i,onToggle:r,isMulti:a,isEditable:o,onEdit:s}=e;const l=n.loomName||n.itemName||n.name||"Unknown";return(0,Le.jsxs)("div",{className:yn("lumiverse-loom-item",i&&"lumiverse-loom-item--selected"),onClick:()=>r(t,l),role:"button",tabIndex:0,onKeyDown:e=>"Enter"===e.key&&r(t,l),children:[(0,Le.jsx)("div",{className:"lumiverse-loom-item-content",children:(0,Le.jsx)("span",{className:"lumiverse-loom-item-name",children:l})}),(0,Le.jsxs)("div",{className:"lumiverse-loom-item-actions",children:[o&&s&&(0,Le.jsx)("button",{className:"lumiverse-loom-item-edit",onClick:e=>{e.stopPropagation(),s&&s(t,n)},title:"Edit this Loom item",type:"button",children:(0,Le.jsx)(ed,{name:"edit"})}),(0,Le.jsx)("div",{className:"lumiverse-loom-item-toggle",children:a?(0,Le.jsx)("div",{className:yn("lumiverse-toggle-switch",i&&"checked"),children:(0,Le.jsx)("div",{className:"lumiverse-toggle-track",children:(0,Le.jsx)("div",{className:"lumiverse-toggle-thumb"})})}):(0,Le.jsx)("span",{className:yn("lumiverse-radio-dot",i&&"checked")})})]})]})}function rd(e){let{pack:n,children:t,defaultOpen:i=!0,isEditable:r,onRemovePack:a,isCollapsed:o,onToggleCollapse:s}=e;const[l,c]=(0,Ee.useState)(i),u=Ee.Children.count(t),d=n.name||n.packName||"Unknown Pack",m=void 0!==o,p=m?!o:l;if(0===u)return null;return(0,Le.jsxs)("div",{className:yn("lumia-modal-panel","lumia-collapsible","lumia-pack-section",!p&&"collapsed"),children:[(0,Le.jsxs)("div",{className:"lumia-modal-panel-header lumia-collapsible-trigger",onClick:e=>{e.target.closest(".lumiverse-remove-pack-btn")||(m&&s?s(d):c(!l))},children:[(0,Le.jsx)("span",{className:"lumia-panel-collapse-icon",children:(0,Le.jsx)(ed,{name:"chevron"})}),(0,Le.jsx)("span",{className:"lumia-modal-panel-icon",children:(0,Le.jsx)(ed,{name:"folder"})}),(0,Le.jsx)("span",{className:"lumia-modal-panel-title",children:d}),r&&(0,Le.jsx)("span",{className:"lumia-pack-badge-custom",children:"Custom"}),(0,Le.jsxs)("span",{className:"lumia-modal-panel-count",children:[u," items"]}),(0,Le.jsx)("button",{className:"lumia-icon-btn-sm lumia-remove-pack-btn",onClick:e=>{e.stopPropagation(),a(d)},title:"Remove Pack",type:"button",children:(0,Le.jsx)(ed,{name:"trash"})})]}),p&&(0,Le.jsx)("div",{className:"lumia-modal-panel-content lumia-loom-items lumia-collapsible-content",children:t})]})}const ad=function(e){let{type:n,onClose:t}=e;const[i,r]=(0,Ee.useState)(""),[a,o]=(0,Ee.useState)(new Set),[s,l]=(0,Ee.useState)("default"),{allPacks:c}=fn(),u=Je(),d=vn(),m=nd[n];if(!m)return(0,Le.jsxs)("div",{className:"lumiverse-error",children:["Unknown Loom type: ",n]});const{category:p,storeField:h,toggleAction:v,isMulti:f}=m,g=(0,Ee.useMemo)(()=>{const e=d[h];return e?Array.isArray(e)?e:[e]:[]},[d,h]),b=(0,Ee.useCallback)((e,n)=>g.some(t=>t.packName===e&&t.itemName===n),[g]),x=(0,Ee.useCallback)((e,n)=>{const t={packName:e,itemName:n};u[v]?(u[v](t),Ye()):console.error("[LoomSelectionModal] Unknown toggle action: ".concat(v))},[u,v]),y=(0,Ee.useCallback)(()=>{const e={styles:"setSelectedLoomStyles",utilities:"setSelectedLoomUtilities",retrofits:"setSelectedLoomRetrofits"}[h];u[e]&&(u[e]([]),Ye())},[u,h]),k=(0,Ee.useMemo)(()=>{const e=i.toLowerCase().trim();return c.map(n=>{const t=function(e,n){const t=[],{category:i,packField:r}=n;return e.loomItems&&Array.isArray(e.loomItems)&&e.loomItems.forEach(e=>{e.loomCategory===i&&t.push(Xu(Xu({},e),{},{loomName:e.loomName||e.itemName||e.name}))}),e[r]&&Array.isArray(e[r])&&e[r].forEach(e=>{t.push(Xu(Xu({},e),{},{loomName:e.loomName||e.itemName||e.name}))}),e.items&&Array.isArray(e.items)&&e.items.forEach(e=>{const n=e.loomCategory||e.category||e.type;n!==i&&n!==r||t.push(Xu(Xu({},e),{},{loomName:e.loomName||e.itemName||e.name}))}),t}(n,m),i=e?t.filter(n=>(n.loomName||n.itemName||n.name||"").toLowerCase().includes(e)):t;return Xu(Xu({},n),{},{loomItems:i,isEditable:n.isCustom||n.isEditable||!1})}).filter(e=>e.loomItems.length>0)},[c,m,i]),w=(0,Ee.useMemo)(()=>"default"===s?k:[...k].sort((e,n)=>{if("name"===s){const t=(e.name||e.packName||"").toLowerCase(),i=(n.name||n.packName||"").toLowerCase();return t.localeCompare(i)}if("author"===s){const t=(e.author||"").toLowerCase(),i=(n.author||"").toLowerCase();return t.localeCompare(i)}return 0}),[k,s]),j=(0,Ee.useCallback)(()=>{const e=k.map(e=>e.name||e.packName);o(new Set(e))},[k]),S=(0,Ee.useCallback)(()=>{o(new Set)},[]),C=(0,Ee.useCallback)(e=>{o(n=>{const t=new Set(n);return t.has(e)?t.delete(e):t.add(e),t})},[]),N=e=>a.has(e),P=(0,Ee.useCallback)(e=>{window.confirm('Delete pack "'.concat(e,'"? This action cannot be undone.'))&&(u.removeCustomPack(e),Ye())},[u]),E=(0,Ee.useCallback)((e,n)=>{u.openModal("loomEditor",{packName:e,editingItem:n})},[u]),M=w.reduce((e,n)=>e+n.loomItems.length,0),L=g.length;return(0,Le.jsxs)("div",{className:"lumia-modal-selection-content",children:[(0,Le.jsxs)("div",{className:"lumia-modal-header-inner",children:[(0,Le.jsx)(td,{value:i,onChange:r,placeholder:"Search ".concat(p,"...")}),(0,Le.jsxs)("div",{className:"lumia-selection-actions",children:[(0,Le.jsxs)("span",{className:"lumia-selection-count",children:[L," selected"]}),L>0&&(0,Le.jsxs)("button",{className:"lumia-clear-btn",onClick:y,title:"Clear all selections",children:[(0,Le.jsx)(ed,{name:"clear"}),(0,Le.jsx)("span",{children:"Clear"})]})]})]}),w.length>0&&(0,Le.jsxs)("div",{className:"lumia-modal-controls",children:[(0,Le.jsxs)("div",{className:"lumia-modal-controls-group",children:[(0,Le.jsxs)("button",{className:"lumia-modal-control-btn",onClick:S,title:"Expand all packs",type:"button",children:[(0,Le.jsx)(ed,{name:"chevronDown",className:"lumia-control-icon"}),(0,Le.jsx)("span",{children:"Expand All"})]}),(0,Le.jsxs)("button",{className:"lumia-modal-control-btn",onClick:j,title:"Collapse all packs",type:"button",children:[(0,Le.jsx)(ed,{name:"chevronUp",className:"lumia-control-icon"}),(0,Le.jsx)("span",{children:"Collapse All"})]})]}),(0,Le.jsxs)("div",{className:"lumia-modal-sort",children:[(0,Le.jsx)(ed,{name:"sort",className:"lumia-sort-icon"}),(0,Le.jsx)("span",{className:"lumia-modal-sort-label",children:"Sort:"}),(0,Le.jsxs)("select",{className:"lumia-select",value:s,onChange:e=>l(e.target.value),children:[(0,Le.jsx)("option",{value:"default",children:"Default"}),(0,Le.jsx)("option",{value:"name",children:"Pack Name"}),(0,Le.jsx)("option",{value:"author",children:"Author"})]})]})]}),(0,Le.jsx)("div",{className:"lumia-modal-content",children:0===M?(0,Le.jsxs)("div",{className:"lumia-modal-empty",children:['No "',p,'" items found in loaded packs.',i&&(0,Le.jsx)("button",{className:"lumia-modal-btn lumia-modal-btn-secondary",onClick:()=>r(""),type:"button",style:{marginTop:"12px"},children:"Clear search"})]}):w.map(e=>{const n=(e=>e.name||e.packName||"Unknown Pack")(e);return(0,Le.jsx)(rd,{pack:e,isEditable:e.isEditable,onRemovePack:P,isCollapsed:N(n),onToggleCollapse:C,children:e.loomItems.map(t=>{const i=t.loomName||t.itemName||t.name;return(0,Le.jsx)(id,{item:t,packName:n,isSelected:b(n,i),onToggle:x,isMulti:f,isEditable:e.isEditable,onEdit:E},"".concat(n,"-").concat(i))})},e.id||n)})}),(0,Le.jsx)("div",{className:"lumia-modal-footer",children:(0,Le.jsx)("button",{className:"lumia-modal-btn lumia-modal-btn-primary lumia-modal-done",onClick:t,children:"Done"})})]})},od=Nn("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),sd=Nn("scroll-text",[["path",{d:"M15 12h-5",key:"r7krc0"}],["path",{d:"M15 8h-5",key:"1khuty"}],["path",{d:"M19 17V5a2 2 0 0 0-2-2H4",key:"zz82l3"}],["path",{d:"M8 21h12a2 2 0 0 0 2-2v-1a1 1 0 0 0-1-1H11a1 1 0 0 0-1 1v1a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v2a1 1 0 0 0 1 1h3",key:"1ph1d7"}]]),ld=Nn("folder",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]),cd=Nn("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),ud=Nn("folder-plus",[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]);function dd(e){return e.packName||e.name||"Unknown Pack"}function md(e){return e.lumiaName||e.lumiaDefName||"Unknown"}function pd(e){return e.loomName||e.itemName||e.name||"Unknown"}function hd(e){let{item:n,packName:t,onEdit:i}=e;const r=function(e){return e.avatarUrl||e.lumia_img||null}(n),{objectPosition:a}=bn(r),o=md(n);return(0,Le.jsxs)("div",{className:"lumiverse-pack-selector-item-row",children:[(0,Le.jsx)("div",{className:"lumiverse-pack-selector-item-icon-sm lumiverse-pack-selector-item-icon--lumia",children:r?(0,Le.jsx)("img",{src:r,alt:"",className:"lumiverse-pack-selector-item-avatar",style:{objectPosition:a},onError:e=>{e.target.style.display="none"}}):(0,Le.jsx)(od,{size:14,strokeWidth:1.5})}),(0,Le.jsx)("span",{className:"lumiverse-pack-selector-item-name",children:o}),(0,Le.jsx)("span",{className:"lumiverse-pack-selector-item-type",children:"Lumia"}),(0,Le.jsx)("button",{className:"lumiverse-pack-selector-item-edit",onClick:()=>i(t,n,"lumia"),title:"Edit this Lumia",type:"button",children:(0,Le.jsx)(En,{size:14,strokeWidth:1.5})})]})}function vd(e){let{item:n,packName:t,onEdit:i}=e;const r=pd(n),a=n.loomCategory||n.category||"Unknown",o="Narrative Style"===a?"Style":"Loom Utilities"===a?"Utility":"Retrofits"===a?"Retrofit":a;return(0,Le.jsxs)("div",{className:"lumiverse-pack-selector-item-row lumiverse-pack-selector-item-row--loom",children:[(0,Le.jsx)("div",{className:"lumiverse-pack-selector-item-icon-sm lumiverse-pack-selector-item-icon--loom",children:(0,Le.jsx)(sd,{size:14,strokeWidth:1.5})}),(0,Le.jsx)("span",{className:"lumiverse-pack-selector-item-name",children:r}),(0,Le.jsx)("span",{className:"lumiverse-pack-selector-item-type lumiverse-pack-selector-item-type--loom",children:o}),(0,Le.jsx)("button",{className:"lumiverse-pack-selector-item-edit",onClick:()=>i(t,n,"loom"),title:"Edit this Loom item",type:"button",children:(0,Le.jsx)(En,{size:14,strokeWidth:1.5})})]})}const fd=function(e){let{onSelect:n,onClose:t}=e;const{customPacks:i,allPacks:r}=fn(),a=Je(),[o,s]=(0,Ee.useState)(null),[l,c]=(0,Ee.useState)(!1),[u,d]=(0,Ee.useState)(""),[m,p]=(0,Ee.useState)(""),[h,v]=(0,Ee.useState)(""),[f,g]=(0,Ee.useState)(""),b=r.filter(e=>e.isCustom||!e.url),x=(0,Ee.useCallback)(e=>{const n=dd(e);s(e=>e===n?null:n)},[]),y=(0,Ee.useCallback)(e=>{a.openModal("itemTypeSelector",{packName:e})},[a]),k=(0,Ee.useCallback)((e,n,t)=>{"loom"===t?a.openModal("loomEditor",{packName:e,editingItem:n}):a.openModal("lumiaEditor",{packName:e,editingItem:n})},[a]),w=(0,Ee.useCallback)(()=>{const e=u.trim();if(!e)return void g("Pack name is required");if(r.some(n=>n.name===e))return void g('Pack "'.concat(e,'" already exists'));const n={id:"pack_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),packName:e,name:e,packAuthor:m.trim()||null,coverUrl:h.trim()||null,url:"",isCustom:!0,version:1,packExtras:[],lumiaItems:[],loomItems:[]};a.addCustomPack(n),Ye(),c(!1),d(""),p(""),v(""),g(""),s(e)},[u,m,h,r,a]),j=e=>e.lumiaItems&&e.lumiaItems.length>0?e.lumiaItems:e.items?e.items.filter(e=>e.lumiaDefName||e.lumiaName):[],S=e=>e.loomItems&&e.loomItems.length>0?e.loomItems:[];return(0,Le.jsxs)("div",{className:"lumiverse-pack-selector-modal",children:[(0,Le.jsxs)("div",{className:"lumiverse-pack-selector-content",children:[(0,Le.jsxs)("div",{className:"lumiverse-pack-selector-section",children:[(0,Le.jsx)("h4",{className:"lumiverse-pack-selector-heading",children:"Select a Pack"}),0===b.length?(0,Le.jsx)("div",{className:"lumiverse-pack-selector-empty",children:(0,Le.jsx)("p",{children:"No custom packs yet. Create your first one below!"})}):(0,Le.jsx)("div",{className:"lumiverse-pack-selector-list",children:b.map(e=>{const n=dd(e),t=function(e){return e.packAuthor||e.author||null}(e),i=o===n,r=j(e),a=S(e),s=(e=>{const n=j(e).length,t=S(e).length;return{lumiaCount:n,loomCount:t,total:n+t}})(e);return(0,Le.jsxs)("div",{className:yn("lumiverse-pack-selector-item-wrapper",i&&"lumiverse-pack-selector-item-wrapper--expanded"),children:[(0,Le.jsxs)("button",{className:"lumiverse-pack-selector-item",onClick:()=>x(e),type:"button",children:[(0,Le.jsx)("div",{className:"lumiverse-pack-selector-item-icon",children:(0,Le.jsx)(ld,{size:20,strokeWidth:1.5})}),(0,Le.jsxs)("div",{className:"lumiverse-pack-selector-item-info",children:[(0,Le.jsx)("span",{className:"lumiverse-pack-selector-pack-name",children:n}),(0,Le.jsxs)("span",{className:"lumiverse-pack-selector-item-meta",children:[s.lumiaCount>0&&"".concat(s.lumiaCount," Lumia").concat(1!==s.lumiaCount?"s":""),s.lumiaCount>0&&s.loomCount>0&&" • ",s.loomCount>0&&"".concat(s.loomCount," Loom").concat(1!==s.loomCount?"s":""),0===s.total&&"Empty",t&&" • by ".concat(t)]})]}),i?(0,Le.jsx)(tu,{size:16,className:"lumiverse-pack-selector-item-arrow"}):(0,Le.jsx)(cd,{size:16,className:"lumiverse-pack-selector-item-arrow"})]}),i&&(0,Le.jsxs)("div",{className:"lumiverse-pack-selector-items",children:[(0,Le.jsxs)("button",{className:"lumiverse-pack-selector-add-item",onClick:()=>y(n),type:"button",children:[(0,Le.jsx)(eu,{size:14,strokeWidth:2}),(0,Le.jsx)("span",{children:"Add New Item"})]}),r.length>0||a.length>0?(0,Le.jsxs)("div",{className:"lumiverse-pack-selector-item-list",children:[r.map((e,t)=>(0,Le.jsx)(hd,{item:e,packName:n,onEdit:k},md(e)||"lumia-".concat(t))),a.map((e,t)=>(0,Le.jsx)(vd,{item:e,packName:n,onEdit:k},pd(e)||"loom-".concat(t)))]}):(0,Le.jsx)("div",{className:"lumiverse-pack-selector-items-empty",children:"No items yet. Add your first one!"})]})]},e.id||n)})})]}),(0,Le.jsx)("div",{className:"lumiverse-pack-selector-divider",children:(0,Le.jsx)("span",{children:"or"})}),(0,Le.jsx)("div",{className:"lumiverse-pack-selector-section",children:l?(0,Le.jsxs)("div",{className:"lumiverse-pack-selector-form",children:[(0,Le.jsxs)("h4",{className:"lumiverse-pack-selector-heading",children:[(0,Le.jsx)(ud,{size:16,strokeWidth:1.5}),"Create New Pack"]}),(0,Le.jsx)("div",{className:"lumiverse-pack-selector-field",children:(0,Le.jsx)("input",{type:"text",className:"lumiverse-input",placeholder:"Pack name (required)",value:u,onChange:e=>{d(e.target.value),g("")},autoFocus:!0})}),(0,Le.jsx)("div",{className:"lumiverse-pack-selector-field",children:(0,Le.jsx)("input",{type:"text",className:"lumiverse-input",placeholder:"Author name (optional)",value:m,onChange:e=>p(e.target.value)})}),(0,Le.jsx)("div",{className:"lumiverse-pack-selector-field",children:(0,Le.jsx)("input",{type:"text",className:"lumiverse-input",placeholder:"Cover image URL (optional)",value:h,onChange:e=>v(e.target.value)})}),f&&(0,Le.jsx)("div",{className:"lumiverse-pack-selector-error",children:f}),(0,Le.jsxs)("div",{className:"lumiverse-pack-selector-form-actions",children:[(0,Le.jsx)("button",{className:"lumiverse-btn lumiverse-btn--secondary",onClick:()=>{c(!1),d(""),p(""),v(""),g("")},type:"button",children:"Cancel"}),(0,Le.jsxs)("button",{className:"lumiverse-btn lumiverse-btn--primary",onClick:w,type:"button",children:[(0,Le.jsx)(ud,{size:14}),"Create & Continue"]})]})]}):(0,Le.jsxs)("button",{className:"lumiverse-pack-selector-create-btn",onClick:()=>c(!0),type:"button",children:[(0,Le.jsx)(ud,{size:18,strokeWidth:1.5}),(0,Le.jsx)("span",{children:"Create New Pack"})]})})]}),(0,Le.jsx)("div",{className:"lumiverse-pack-selector-footer",children:(0,Le.jsx)("button",{className:"lumiverse-btn lumiverse-btn--secondary",onClick:t,type:"button",children:"Cancel"})})]})},gd=Nn("smile",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]);function bd(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,i)}return t}function xd(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?bd(Object(t),!0).forEach(function(n){yd(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):bd(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function yd(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,n||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const kd=0,wd=[{value:kd,label:"She/Her"},{value:1,label:"He/Him"},{value:2,label:"They/Them"}];function jd(e,n){if(!e)return null;const t={name:["lumiaName","lumiaDefName"],def:["lumiaDefinition","lumiaDef"],personality:["lumiaPersonality","lumia_personality"],behavior:["lumiaBehavior","lumia_behavior"],img:["avatarUrl","lumia_img"],author:["authorName","defAuthor"],gender:["genderIdentity"]}[n];if(!t)return null;for(const n of t)if(void 0!==e[n]&&null!==e[n])return e[n];return null}function Sd(e){let{label:n,required:t,hint:i,children:r,error:a}=e;return(0,Le.jsxs)("div",{className:yn("lumiverse-editor-field",a&&"lumiverse-editor-field--error"),children:[(0,Le.jsxs)("label",{className:"lumiverse-editor-label",children:[n,t&&(0,Le.jsx)("span",{className:"lumiverse-required",children:"*"})]}),r,i&&(0,Le.jsx)("span",{className:"lumiverse-editor-hint",children:i}),a&&(0,Le.jsx)("span",{className:"lumiverse-editor-error",children:a})]})}function Cd(e){let{Icon:n,title:t,children:i}=e;return(0,Le.jsxs)("div",{className:"lumiverse-editor-section",children:[(0,Le.jsxs)("div",{className:"lumiverse-editor-section-header",children:[(0,Le.jsx)(n,{size:16,strokeWidth:1.5}),(0,Le.jsx)("span",{children:t})]}),(0,Le.jsx)("div",{className:"lumiverse-editor-section-content",children:i})]})}function Nd(e){let{url:n}=e;const[t,i]=(0,Ee.useState)(!1),[r,a]=(0,Ee.useState)(!1),{objectPosition:o}=bn(n);return(0,Ee.useEffect)(()=>{i(!1),a(!1)},[n]),!n||t?null:(0,Le.jsxs)("div",{className:yn("lumiverse-editor-avatar-preview",r&&"loaded"),children:[(0,Le.jsx)("img",{src:n,alt:"Avatar preview",style:{objectPosition:o},onLoad:()=>a(!0),onError:()=>i(!0)}),!r&&(0,Le.jsx)("div",{className:"lumiverse-editor-avatar-spinner"})]})}const Pd=function(e){var n;let{packName:t,editingItem:i=null,onClose:r,onSaved:a}=e;const{allPacks:o}=fn(),s=Je(),l=null!==i,c=o.find(e=>(e.name||e.packName)===t),[u,d]=(0,Ee.useState)(jd(i,"name")||""),[m,p]=(0,Ee.useState)(jd(i,"img")||""),[h,v]=(0,Ee.useState)(jd(i,"author")||""),[f,g]=(0,Ee.useState)(jd(i,"def")||""),[b,x]=(0,Ee.useState)(jd(i,"personality")||""),[y,k]=(0,Ee.useState)(jd(i,"behavior")||""),[w,j]=(0,Ee.useState)(null!==(n=jd(i,"gender"))&&void 0!==n?n:kd),[S,C]=(0,Ee.useState)({}),N=(0,Ee.useCallback)(()=>{const e={};if(u.trim()||(e.name="Lumia name is required"),c&&u.trim()){const n=c.lumiaItems||c.items||[],t=jd(i,"name");n.find(e=>{const n=jd(e,"name");return n===u.trim()&&(!l||n!==t)})&&(e.name='A Lumia named "'.concat(u.trim(),'" already exists in this pack'))}return C(e),0===Object.keys(e).length},[u,c,l,i]),P=(0,Ee.useCallback)(()=>{if(!N())return;const e={lumiaName:u.trim(),avatarUrl:m.trim()||null,authorName:h.trim()||null,lumiaDefinition:f.trim()||null,lumiaPersonality:b.trim()||null,lumiaBehavior:y.trim()||null,genderIdentity:w,version:1};if(c){const n=[...c.lumiaItems||c.items||[]],r=jd(i,"name");if(l){const t=n.findIndex(e=>jd(e,"name")===r);t>=0?n[t]=e:n.push(e)}else n.push(e);const o=xd(xd({},c),{},{lumiaItems:n,items:void 0}),u=c.id||c.name||c.packName;c.isCustom?s.updateCustomPack(u,o):s.updateCustomPack(u,xd(xd({},o),{},{isCustom:!0})),Ye(),a&&a(e,t)}r()},[N,u,m,h,f,b,y,w,c,l,i,s,t,r,a]),E=(0,Ee.useCallback)(()=>{if(!l||!i)return;const e=jd(i,"name");if(window.confirm('Are you sure you want to delete "'.concat(e,'"? This cannot be undone.'))){if(c){const n=(c.lumiaItems||c.items||[]).filter(n=>jd(n,"name")!==e),t=xd(xd({},c),{},{lumiaItems:n,items:void 0}),i=c.id||c.name||c.packName;c.isCustom?s.updateCustomPack(i,t):s.updateCustomPack(i,xd(xd({},t),{},{isCustom:!0})),Ye()}r()}},[l,i,c,s,r]);return c?(0,Le.jsxs)("div",{className:"lumiverse-editor-modal",children:[(0,Le.jsxs)("div",{className:"lumiverse-editor-content",children:[(0,Le.jsxs)(Cd,{Icon:od,title:"Basic Info",children:[(0,Le.jsxs)(Sd,{label:"Lumia Name",required:!0,error:S.name,children:[(0,Le.jsx)("input",{type:"text",className:"lumiverse-input",value:u,onChange:e=>{d(e.target.value),S.name&&C(e=>xd(xd({},e),{},{name:null}))},placeholder:"e.g., Aria, Luna, Sage",autoFocus:!0}),(0,Le.jsxs)("span",{className:"lumiverse-editor-hint",children:['Will be referenced as "Lumia (',u||"Name",')" in World Books']})]}),(0,Le.jsxs)("div",{className:"lumiverse-editor-row",children:[(0,Le.jsx)(Sd,{label:"Avatar URL",children:(0,Le.jsx)("input",{type:"text",className:"lumiverse-input",value:m,onChange:e=>p(e.target.value),placeholder:"https://..."})}),(0,Le.jsx)(Sd,{label:"Author",children:(0,Le.jsx)("input",{type:"text",className:"lumiverse-input",value:h,onChange:e=>v(e.target.value),placeholder:"Your name"})})]}),(0,Le.jsx)("div",{className:"lumiverse-editor-row",children:(0,Le.jsx)(Sd,{label:"Gender Identity",hint:"Used for pronoun macros like {{lumiaPn subject}}",children:(0,Le.jsx)("select",{className:"lumiverse-input lumiverse-select",value:w,onChange:e=>j(Number(e.target.value)),children:wd.map(e=>(0,Le.jsx)("option",{value:e.value,children:e.label},e.value))})})}),(0,Le.jsx)(Nd,{url:m})]}),(0,Le.jsx)(Cd,{Icon:od,title:"Lumia Physicality",children:(0,Le.jsx)(Sd,{label:"Physical Definition",hint:"Injected via {{lumiaDef}} macro",children:(0,Le.jsx)("textarea",{className:"lumiverse-textarea",value:f,onChange:e=>g(e.target.value),placeholder:"Describe Lumia's physical appearance, form, and presence...",rows:5})})}),(0,Le.jsx)(Cd,{Icon:gd,title:"Lumia Personality",children:(0,Le.jsx)(Sd,{label:"Personality Traits",hint:"Injected via {{lumiaPersonality}} macro",children:(0,Le.jsx)("textarea",{className:"lumiverse-textarea",value:b,onChange:e=>x(e.target.value),placeholder:"Describe Lumia's personality, disposition, and inner nature...",rows:5})})}),(0,Le.jsx)(Cd,{Icon:su,title:"Lumia Behavior Traits",children:(0,Le.jsx)(Sd,{label:"Behavioral Patterns",hint:"Injected via {{lumiaBehavior}} macro",children:(0,Le.jsx)("textarea",{className:"lumiverse-textarea",value:y,onChange:e=>k(e.target.value),placeholder:"Describe Lumia's behavioral patterns, habits, and tendencies...",rows:5})})})]}),(0,Le.jsxs)("div",{className:"lumiverse-editor-footer",children:[l&&(0,Le.jsxs)("button",{className:"lumiverse-btn lumiverse-btn--danger",onClick:E,type:"button",children:[(0,Le.jsx)(Mn,{size:14}),"Delete"]}),(0,Le.jsx)("div",{className:"lumiverse-editor-footer-spacer"}),(0,Le.jsx)("button",{className:"lumiverse-btn lumiverse-btn--secondary",onClick:r,type:"button",children:"Cancel"}),(0,Le.jsx)("button",{className:"lumiverse-btn lumiverse-btn--primary",onClick:P,type:"button",children:l?"Save Changes":"Create Lumia"})]})]}):(0,Le.jsxs)("div",{className:"lumiverse-editor-modal lumiverse-editor-error",children:[(0,Le.jsxs)("p",{children:['Pack "',t,'" not found.']}),(0,Le.jsx)("button",{className:"lumiverse-btn lumiverse-btn--secondary",onClick:r,children:"Close"})]})},Ed=Nn("palette",[["path",{d:"M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z",key:"e79jfc"}],["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}]]),Md=Nn("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);function Ld(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,i)}return t}function Od(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Ld(Object(t),!0).forEach(function(n){Td(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Ld(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Td(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,n||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const Dd=[{value:"Narrative Style",label:"Narrative Style",description:"Writing style and prose guidance",Icon:Ed},{value:"Loom Utilities",label:"Utility",description:"Helper functions and techniques",Icon:su},{value:"Retrofits",label:"Retrofit",description:"System modifications and enhancements",Icon:Md}];function zd(e,n){if(!e)return null;const t={name:["loomName","itemName","name"],content:["loomContent","content"],category:["loomCategory","category","type"],author:["authorName","author"]}[n];if(!t)return null;for(const n of t)if(void 0!==e[n]&&null!==e[n])return e[n];return null}function Id(e){let{label:n,required:t,hint:i,children:r,error:a}=e;return(0,Le.jsxs)("div",{className:yn("lumiverse-editor-field",a&&"lumiverse-editor-field--error"),children:[(0,Le.jsxs)("label",{className:"lumiverse-editor-label",children:[n,t&&(0,Le.jsx)("span",{className:"lumiverse-required",children:"*"})]}),r,i&&(0,Le.jsx)("span",{className:"lumiverse-editor-hint",children:i}),a&&(0,Le.jsx)("span",{className:"lumiverse-editor-error",children:a})]})}function Ad(e){let{Icon:n,title:t,children:i}=e;return(0,Le.jsxs)("div",{className:"lumiverse-editor-section",children:[(0,Le.jsxs)("div",{className:"lumiverse-editor-section-header",children:[(0,Le.jsx)(n,{size:16,strokeWidth:1.5}),(0,Le.jsx)("span",{children:t})]}),(0,Le.jsx)("div",{className:"lumiverse-editor-section-content",children:i})]})}function Rd(e){switch(e){case"Narrative Style":return"Injected via {{loomStyle}} macro. Describe prose style, tone, and writing approach.";case"Loom Utilities":return"Injected via {{loomUtils}} macro. Define helper techniques or utility functions.";case"Retrofits":return"Injected via {{loomRetrofits}} macro. System modifications and enhancements.";default:return""}}function Bd(e){switch(e){case"Narrative Style":return"Write in a dark, atmospheric style. Use vivid sensory descriptions emphasizing shadows, decay, and unease...";case"Loom Utilities":return"When transitioning between scenes, use a brief temporal or spatial marker followed by sensory grounding...";case"Retrofits":return"Track and reference previous conversations, character states, and plot points. Maintain consistency...";default:return"Enter the content for this Loom item..."}}const _d=function(e){var n;let{packName:t,editingItem:i=null,onClose:r,onSaved:a}=e;const{allPacks:o}=fn(),s=Je(),l=null!==i,c=o.find(e=>(e.name||e.packName)===t),[u,d]=(0,Ee.useState)(zd(i,"name")||""),[m,p]=(0,Ee.useState)(zd(i,"content")||""),[h,v]=(0,Ee.useState)(zd(i,"category")||"Narrative Style"),[f,g]=(0,Ee.useState)(zd(i,"author")||""),[b,x]=(0,Ee.useState)({}),y=(0,Ee.useCallback)(()=>{const e={};if(u.trim()||(e.name="Loom name is required"),m.trim()||(e.content="Content is required"),c&&u.trim()){const n=c.loomItems||[],t=zd(i,"name");n.find(e=>{const n=zd(e,"name");return n===u.trim()&&(!l||n!==t)})&&(e.name='A Loom item named "'.concat(u.trim(),'" already exists in this pack'))}return x(e),0===Object.keys(e).length},[u,m,c,l,i]),k=(0,Ee.useCallback)(()=>{if(!y())return;const e={loomName:u.trim(),loomContent:m.trim(),loomCategory:h,authorName:f.trim()||null,version:1};if(c){const n=[...c.loomItems||[]],r=zd(i,"name");if(l){const t=n.findIndex(e=>zd(e,"name")===r);t>=0?n[t]=e:n.push(e)}else n.push(e);const o=Od(Od({},c),{},{loomItems:n}),u=c.id||c.name||c.packName;c.isCustom?s.updateCustomPack(u,o):s.updateCustomPack(u,Od(Od({},o),{},{isCustom:!0})),Ye(),a&&a(e,t)}r()},[y,u,m,h,f,c,l,i,s,t,r,a]),w=(0,Ee.useCallback)(()=>{if(!l||!i)return;const e=zd(i,"name");if(window.confirm('Are you sure you want to delete "'.concat(e,'"? This cannot be undone.'))){if(c){const n=(c.loomItems||[]).filter(n=>zd(n,"name")!==e),t=Od(Od({},c),{},{loomItems:n}),i=c.id||c.name||c.packName;c.isCustom?s.updateCustomPack(i,t):s.updateCustomPack(i,Od(Od({},t),{},{isCustom:!0})),Ye()}r()}},[l,i,c,s,r]);return c?(0,Le.jsxs)("div",{className:"lumiverse-loom-editor",children:[(0,Le.jsxs)("div",{className:"lumiverse-loom-editor-content",children:[(0,Le.jsxs)(Ad,{Icon:sd,title:"Loom Details",children:[(0,Le.jsx)(Id,{label:"Loom Name",required:!0,error:b.name,children:(0,Le.jsx)("input",{type:"text",className:"lumiverse-input",value:u,onChange:e=>{d(e.target.value),b.name&&x(e=>Od(Od({},e),{},{name:null}))},placeholder:"e.g., Gothic Horror, Scene Helper",autoFocus:!0})}),(0,Le.jsx)(Id,{label:"Author",children:(0,Le.jsx)("input",{type:"text",className:"lumiverse-input",value:f,onChange:e=>g(e.target.value),placeholder:"Your name"})}),(0,Le.jsx)(Id,{label:"Category",required:!0,children:(0,Le.jsx)("div",{className:"lumiverse-loom-category-options",children:Dd.map(e=>(0,Le.jsxs)("button",{type:"button",className:yn("lumiverse-loom-category-btn",h===e.value&&"lumiverse-loom-category-btn--selected"),onClick:()=>v(e.value),title:e.description,children:[(0,Le.jsx)(e.Icon,{size:14,strokeWidth:1.5}),e.label]},e.value))})})]}),(0,Le.jsx)(Ad,{Icon:(null===(n=Dd.find(e=>e.value===h))||void 0===n?void 0:n.Icon)||sd,title:"Content",children:(0,Le.jsx)(Id,{label:"Loom Content",required:!0,error:b.content,hint:Rd(h),children:(0,Le.jsx)("textarea",{className:"lumiverse-textarea",value:m,onChange:e=>{p(e.target.value),b.content&&x(e=>Od(Od({},e),{},{content:null}))},placeholder:Bd(h),rows:8})})})]}),(0,Le.jsxs)("div",{className:"lumiverse-editor-footer",children:[l&&(0,Le.jsxs)("button",{className:"lumiverse-btn lumiverse-btn--danger",onClick:w,type:"button",children:[(0,Le.jsx)(Mn,{size:14}),"Delete"]}),(0,Le.jsx)("div",{className:"lumiverse-editor-footer-spacer"}),(0,Le.jsx)("button",{className:"lumiverse-btn lumiverse-btn--secondary",onClick:r,type:"button",children:"Cancel"}),(0,Le.jsx)("button",{className:"lumiverse-btn lumiverse-btn--primary",onClick:k,type:"button",children:l?"Save Changes":"Create Loom"})]})]}):(0,Le.jsxs)("div",{className:"lumiverse-loom-editor lumiverse-editor-error",children:[(0,Le.jsxs)("p",{children:['Pack "',t,'" not found.']}),(0,Le.jsx)("button",{className:"lumiverse-btn lumiverse-btn--secondary",onClick:r,children:"Close"})]})},Ud=Nn("arrow-right",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);const Fd=function(e){let{packName:n,onSelectLumia:t,onSelectLoom:i,onBack:r}=e;const[a,o]=(0,Ee.useState)(null);return(0,Le.jsxs)("div",{className:"lumiverse-type-selector",children:[(0,Le.jsxs)("div",{className:"lumiverse-type-selector-header",children:[(0,Le.jsxs)("h3",{className:"lumiverse-type-selector-title",children:["Add to ",n]}),(0,Le.jsx)("p",{className:"lumiverse-type-selector-subtitle",children:"Choose what you'd like to create"})]}),(0,Le.jsxs)("div",{className:"lumiverse-type-selector-options",children:[(0,Le.jsxs)("button",{className:yn("lumiverse-type-option","lumiverse-type-option--lumia","lumia"===a&&"lumiverse-type-option--hovered"),onClick:t,onMouseEnter:()=>o("lumia"),onMouseLeave:()=>o(null),type:"button",children:[(0,Le.jsx)("div",{className:"lumiverse-type-option-icon",children:(0,Le.jsx)(od,{size:28,strokeWidth:1.5})}),(0,Le.jsxs)("div",{className:"lumiverse-type-option-content",children:[(0,Le.jsx)("span",{className:"lumiverse-type-option-label",children:"Lumia"}),(0,Le.jsx)("span",{className:"lumiverse-type-option-desc",children:"Character definition with physicality, personality, and behavior"})]}),(0,Le.jsx)("div",{className:"lumiverse-type-option-arrow",children:(0,Le.jsx)(Ud,{size:18,strokeWidth:2})})]}),(0,Le.jsxs)("button",{className:yn("lumiverse-type-option","lumiverse-type-option--loom","loom"===a&&"lumiverse-type-option--hovered"),onClick:i,onMouseEnter:()=>o("loom"),onMouseLeave:()=>o(null),type:"button",children:[(0,Le.jsx)("div",{className:"lumiverse-type-option-icon",children:(0,Le.jsx)(sd,{size:28,strokeWidth:1.5})}),(0,Le.jsxs)("div",{className:"lumiverse-type-option-content",children:[(0,Le.jsx)("span",{className:"lumiverse-type-option-label",children:"Loom"}),(0,Le.jsx)("span",{className:"lumiverse-type-option-desc",children:"Narrative style, utility, or retrofit modifier"})]}),(0,Le.jsx)("div",{className:"lumiverse-type-option-arrow",children:(0,Le.jsx)(Ud,{size:18,strokeWidth:2})})]})]}),r&&(0,Le.jsx)("div",{className:"lumiverse-type-selector-footer",children:(0,Le.jsx)("button",{className:"lumiverse-btn lumiverse-btn--secondary",onClick:r,type:"button",children:"Back"})})]})},Vd=Nn("zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),Wd=Nn("heart",[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]]),Hd=Nn("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);function $d(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,i)}return t}function qd(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?$d(Object(t),!0).forEach(function(n){Yd(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):$d(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Yd(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,n||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const Kd=Ge,Gd=[],Qd=()=>Kd.getState().councilMembers||Gd;function Xd(e,n){return e?e.lumiaItems&&e.lumiaItems.length>0?e.lumiaItems.find(e=>e.lumiaName===n||e.lumiaDefName===n):e.items?e.items.find(e=>e.lumiaDefName===n):null:null}function Zd(e,n){if(!e)return null;const t={name:["lumiaName","lumiaDefName"],def:["lumiaDefinition","lumiaDef"],img:["avatarUrl","lumia_img"]}[n];if(!t)return null;for(const n of t)if(void 0!==e[n]&&null!==e[n])return e[n];return null}function Jd(e){let{item:n,packName:t,onAdd:i,animationIndex:r}=e;const a=Zd(n,"img"),o=Zd(n,"name")||"Unknown",{objectPosition:s}=bn(a),[l,c]=(0,Ee.useState)(!1),[u,d]=(0,Ee.useState)(!1),m=Math.min(30*r,300);return(0,Le.jsxs)("button",{type:"button",className:"lumiverse-council-select-card lumia-card-appear",style:{animationDelay:"".concat(m,"ms")},onClick:()=>i({packName:t,itemName:o}),children:[(0,Le.jsxs)("div",{className:"lumiverse-council-select-card-image",children:[a&&!u?(0,Le.jsxs)(Le.Fragment,{children:[(0,Le.jsx)("img",{src:a,alt:o,loading:"lazy",className:l?"lumia-img-loaded":"",style:{objectPosition:s},onLoad:()=>c(!0),onError:()=>d(!0)}),!l&&(0,Le.jsx)("div",{className:"lumia-img-spinner"})]}):(0,Le.jsx)("div",{className:"lumiverse-council-select-card-placeholder",children:(0,Le.jsx)(Jc,{size:24,strokeWidth:1.5})}),(0,Le.jsx)("div",{className:"lumiverse-council-select-card-add",children:(0,Le.jsx)(eu,{size:16,strokeWidth:2})})]}),(0,Le.jsxs)("div",{className:"lumiverse-council-select-card-info",children:[(0,Le.jsx)("span",{className:"lumiverse-council-select-card-name",children:o}),(0,Le.jsx)("span",{className:"lumiverse-council-select-card-pack",children:t})]})]})}function em(e){var n,t;let{member:i,packs:r,onRemove:a,onUpdateRole:o}=e;const[s,l]=(0,Ee.useState)(!1),[c,u]=(0,Ee.useState)(i.role||""),d=function(e,n,t){const i=(Array.isArray(e)?e.reduce((e,n)=>qd(qd({},e),{},{[n.name||n.packName]:n}),{}):e)[n];if(!i)return t;const r=Xd(i,t);return(null==r?void 0:r.lumiaName)||(null==r?void 0:r.lumiaDefName)||t}(r,i.packName,i.itemName),m=function(e,n,t){const i=(Array.isArray(e)?e.reduce((e,n)=>qd(qd({},e),{},{[n.name||n.packName]:n}),{}):e)[n];if(!i)return null;const r=Xd(i,t);return(null==r?void 0:r.avatarUrl)||(null==r?void 0:r.lumia_img)||null}(r,i.packName,i.itemName),{objectPosition:p}=bn(m),h=()=>{o(i.id,{role:c}),l(!1)},v=(null===(n=i.behaviors)||void 0===n?void 0:n.length)||0,f=(null===(t=i.personalities)||void 0===t?void 0:t.length)||0;return(0,Le.jsxs)("div",{className:"lumiverse-council-member-card",children:[(0,Le.jsx)("div",{className:"lumiverse-council-member-card-avatar",children:m?(0,Le.jsx)("img",{src:m,alt:d,style:{objectPosition:p}}):(0,Le.jsx)(Jc,{size:20,strokeWidth:1.5})}),(0,Le.jsxs)("div",{className:"lumiverse-council-member-card-content",children:[(0,Le.jsx)("span",{className:"lumiverse-council-member-card-name",children:d}),s?(0,Le.jsxs)("div",{className:"lumiverse-council-member-role-edit",children:[(0,Le.jsx)("input",{type:"text",className:"lumiverse-council-input-sm",placeholder:"Role/title...",value:c,onChange:e=>u(e.target.value),onKeyDown:e=>{"Enter"===e.key&&h(),"Escape"===e.key&&(u(i.role||""),l(!1))},autoFocus:!0}),(0,Le.jsx)("button",{className:"lumiverse-council-btn-sm lumiverse-council-btn-sm--primary",onClick:h,type:"button",children:(0,Le.jsx)(iu,{size:12,strokeWidth:2})}),(0,Le.jsx)("button",{className:"lumiverse-council-btn-sm",onClick:()=>{u(i.role||""),l(!1)},type:"button",children:(0,Le.jsx)(ru,{size:12,strokeWidth:2})})]}):(0,Le.jsxs)("div",{className:"lumiverse-council-member-card-meta",children:[i.role?(0,Le.jsx)("span",{className:"lumiverse-council-member-card-role",onClick:()=>l(!0),title:"Click to edit role",children:i.role}):(0,Le.jsxs)("button",{className:"lumiverse-council-add-role-btn",onClick:()=>l(!0),type:"button",children:[(0,Le.jsx)(En,{size:10})," Add role"]}),(0,Le.jsxs)("span",{className:"lumiverse-council-member-card-stats",children:[(0,Le.jsxs)("span",{title:"Behaviors",children:[(0,Le.jsx)(Vd,{size:10})," ",v]}),(0,Le.jsxs)("span",{title:"Personalities",children:[(0,Le.jsx)(Wd,{size:10})," ",f]})]})]})]}),(0,Le.jsx)("button",{className:"lumiverse-council-btn-sm lumiverse-council-btn-sm--danger",onClick:()=>a(i.id),title:"Remove from council",type:"button",children:(0,Le.jsx)(Mn,{size:14,strokeWidth:1.5})})]})}function nm(){return(0,Le.jsxs)("div",{className:"lumiverse-council-select-empty",children:[(0,Le.jsx)(Jc,{size:24,strokeWidth:1.5}),(0,Le.jsx)("span",{children:"No council members yet"}),(0,Le.jsx)("p",{children:"Select Lumias from below to add them to your council."})]})}function tm(e){let{hasSearch:n}=e;return(0,Le.jsx)("div",{className:"lumiverse-council-select-empty lumiverse-council-select-empty--muted",children:n?(0,Le.jsxs)(Le.Fragment,{children:[(0,Le.jsx)(Hd,{size:24,strokeWidth:1.5}),(0,Le.jsx)("span",{children:"No matching Lumias"}),(0,Le.jsx)("p",{children:"Try a different search term."})]}):(0,Le.jsxs)(Le.Fragment,{children:[(0,Le.jsx)(Jc,{size:24,strokeWidth:1.5}),(0,Le.jsx)("span",{children:"No Lumias available"}),(0,Le.jsx)("p",{children:"All Lumias are already in the council, or no packs are loaded."})]})})}const im=function(e){let{onClose:n}=e;const t=Je(),{allPacks:i}=fn(),[r,a]=(0,Ee.useState)(""),o=(0,Ee.useSyncExternalStore)(Kd.subscribe,Qd,Qd),s=(0,Ee.useMemo)(()=>Array.isArray(i)?i.reduce((e,n)=>qd(qd({},e),{},{[n.name||n.packName]:n}),{}):i||{},[i]),l=(0,Ee.useMemo)(()=>{const e=new Set(o.map(e=>"".concat(e.packName,":").concat(e.itemName))),n=[];if((Array.isArray(i)?i:Object.values(i||{})).forEach(t=>{const i=t.name||t.packName;t.lumiaItems&&t.lumiaItems.length>0?t.lumiaItems.forEach(t=>{const r=t.lumiaName||t.lumiaDefName,a=t.lumiaDefinition||t.lumiaDef;if(!r||!a)return;const o="".concat(i,":").concat(r);e.has(o)||n.push({packName:i,item:t})}):t.items&&t.items.forEach(t=>{if(!t.lumiaDefName||!t.lumiaDef)return;const r="".concat(i,":").concat(t.lumiaDefName);e.has(r)||n.push({packName:i,item:t})})}),r.trim()){const e=r.toLowerCase();return n.filter(n=>{let{item:t,packName:i}=n;return(Zd(t,"name")||"").toLowerCase().includes(e)||i.toLowerCase().includes(e)})}return n},[i,o,r]),c=(0,Ee.useCallback)(e=>{t.addCouncilMember(e),Ye()},[t]),u=(0,Ee.useCallback)(e=>{t.removeCouncilMember(e),Ye()},[t]),d=(0,Ee.useCallback)((e,n)=>{t.updateCouncilMember(e,n),Ye()},[t]);return(0,Le.jsxs)("div",{className:"lumiverse-council-select-modal",children:[(0,Le.jsxs)("div",{className:"lumiverse-council-select-header",children:[(0,Le.jsx)("div",{className:"lumiverse-council-select-header-icon",children:(0,Le.jsx)(Jc,{size:20,strokeWidth:1.5})}),(0,Le.jsxs)("div",{className:"lumiverse-council-select-header-text",children:[(0,Le.jsx)("h3",{children:"Configure Council"}),(0,Le.jsx)("p",{children:"Select Lumias to join your council of independent characters."})]})]}),(0,Le.jsxs)("div",{className:"lumiverse-council-select-section",children:[(0,Le.jsxs)("div",{className:"lumiverse-council-select-section-header",children:[(0,Le.jsx)("span",{children:"Council Members"}),(0,Le.jsx)("span",{className:"lumiverse-council-select-count",children:o.length})]}),(0,Le.jsx)("div",{className:"lumiverse-council-select-members",children:0===o.length?(0,Le.jsx)(nm,{}):(0,Le.jsx)("div",{className:"lumiverse-council-member-list",children:o.map(e=>(0,Le.jsx)(em,{member:e,packs:s,onRemove:u,onUpdateRole:d},e.id))})})]}),(0,Le.jsxs)("div",{className:"lumiverse-council-select-section lumiverse-council-select-section--available",children:[(0,Le.jsxs)("div",{className:"lumiverse-council-select-section-header",children:[(0,Le.jsx)("span",{children:"Add Lumias"}),(0,Le.jsxs)("div",{className:"lumiverse-council-search-wrapper",children:[(0,Le.jsx)(Hd,{size:14,strokeWidth:1.5}),(0,Le.jsx)("input",{type:"text",className:"lumiverse-council-search-input",placeholder:"Search...",value:r,onChange:e=>a(e.target.value)}),r&&(0,Le.jsx)("button",{className:"lumiverse-council-search-clear",onClick:()=>a(""),type:"button",children:(0,Le.jsx)(ru,{size:12,strokeWidth:2})})]})]}),(0,Le.jsx)("div",{className:"lumiverse-council-select-grid-wrapper",children:0===l.length?(0,Le.jsx)(tm,{hasSearch:!!r.trim()}):(0,Le.jsx)("div",{className:"lumiverse-council-select-grid",children:l.map((e,n)=>{let{item:t,packName:i}=e;return(0,Le.jsx)(Jd,{item:t,packName:i,onAdd:c,animationIndex:n},"".concat(i,":").concat(Zd(t,"name")))})})})]}),(0,Le.jsx)("div",{className:"lumiverse-council-select-footer",children:(0,Le.jsx)("button",{className:"lumia-modal-btn lumia-modal-btn-primary",onClick:n,type:"button",children:"Done"})})]})};function rm(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,i)}return t}function am(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?rm(Object(t),!0).forEach(function(n){om(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):rm(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function om(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,n||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function sm(e){let{children:n,onClose:t,modalType:i,size:r="medium",hasCustomHeader:a=!1}=e;const o=(0,Ee.useCallback)(e=>{"Escape"===e.key&&t()},[t]);(0,Ee.useEffect)(()=>(document.addEventListener("keydown",o),document.body.style.overflow="hidden",()=>{document.removeEventListener("keydown",o),document.body.style.overflow=""}),[o]);const s=e=>{e.stopPropagation()},l=yn("lumia-modal","selection"===i&&"lumia-modal-selection","settings"===i&&"lumia-modal-settings","editor"===i&&"lumia-modal-editor","pack-editor"===i&&"lumia-modal-pack-editor","pack-selector"===i&&"lumia-modal-pack-selector","lumia-editor"===i&&"lumia-modal-lumia-editor","loom-editor"===i&&"lumia-modal-loom-editor","type-selector"===i&&"lumia-modal-type-selector");return(0,Le.jsx)("div",{className:"lumia-modal-backdrop",onClick:e=>{e.target===e.currentTarget&&t()},onMouseDown:s,onMouseUp:s,children:(0,Le.jsx)("div",{className:l,role:"dialog","aria-modal":"true",onClick:s,children:n})})}const lm={behaviors:{component:Gu,modalType:"selection",size:"large",hasCustomHeader:!0,props:{type:"behaviors",multiSelect:!0,allowDominant:!0}},personalities:{component:Gu,modalType:"selection",size:"large",hasCustomHeader:!0,props:{type:"personalities",multiSelect:!0,allowDominant:!0}},definitions:{component:Gu,modalType:"selection",size:"large",hasCustomHeader:!0,props:{type:"definitions",multiSelect:!1,allowDominant:!1}},packEditor:{component:Un,modalType:"pack-editor",size:"large",hasCustomHeader:!0,props:{}},importPack:{component:()=>(0,Le.jsx)("div",{className:"lumia-modal-empty",children:"Import Pack Modal (TODO)"}),modalType:"settings",size:"medium",hasCustomHeader:!1,props:{}},loomStyles:{component:ad,modalType:"selection",size:"large",hasCustomHeader:!0,props:{type:"loomStyles"}},loomUtilities:{component:ad,modalType:"selection",size:"large",hasCustomHeader:!0,props:{type:"loomUtilities"}},loomRetrofits:{component:ad,modalType:"selection",size:"large",hasCustomHeader:!0,props:{type:"loomRetrofits"}},packSelector:{component:fd,modalType:"pack-selector",size:"medium",hasCustomHeader:!0,props:{}},lumiaEditor:{component:Pd,modalType:"lumia-editor",size:"large",hasCustomHeader:!0,props:{}},loomEditor:{component:_d,modalType:"loom-editor",size:"large",hasCustomHeader:!0,props:{}},itemTypeSelector:{component:function(e){let{packName:n,onClose:t}=e;const i=Je();return(0,Le.jsx)(Fd,{packName:n,onSelectLumia:()=>{i.openModal("lumiaEditor",{packName:n})},onSelectLoom:()=>{i.openModal("loomEditor",{packName:n})},onBack:t})},modalType:"type-selector",size:"medium",hasCustomHeader:!0,props:{}},councilSelect:{component:im,modalType:"selection",size:"large",hasCustomHeader:!0,props:{}}};const cm=function(){const e=gn(),n=Je();if(!e.activeModal)return null;const{name:t,props:i}=e.activeModal,r=lm[t];if(!r)return console.warn("[LumiverseUI] Unknown modal: ".concat(t)),null;const{component:a,modalType:o,size:s,hasCustomHeader:l,props:c}=r;return(0,Au.createPortal)((0,Le.jsx)(sm,{modalType:o,size:s,hasCustomHeader:l,onClose:n.closeModal,children:(0,Le.jsx)(a,am(am(am({},c),i),{},{onClose:n.closeModal}))}),document.body)},um=Nn("chevron-up",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),dm=Nn("file-text",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]),mm=Ge,pm={},hm=()=>{var e;return null===(e=mm.getState().ui)||void 0===e?void 0:e.viewingPack},vm=()=>mm.getState().packs||pm;function fm(e,n){if(!e)return null;const t={name:["lumiaName","lumiaDefName"],def:["lumiaDefinition","lumiaDef"],personality:["lumiaPersonality","lumia_personality"],behavior:["lumiaBehavior","lumia_behavior"],img:["avatarUrl","lumia_img"],author:["authorName","defAuthor"]}[n];if(!t)return null;for(const n of t)if(void 0!==e[n]&&null!==e[n])return e[n];return null}function gm(e){return e.lumiaItems&&Array.isArray(e.lumiaItems)?e.lumiaItems:e.items&&Array.isArray(e.items)?e.items.filter(e=>!e.loomCategory&&!!e.lumiaDefName):[]}function bm(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;return!e||e.length<=n?e:e.slice(0,n)+"..."}function xm(e){let{title:n,Icon:t,content:i,defaultOpen:r=!1}=e;const[a,o]=(0,Ee.useState)(r);return i?(0,Le.jsxs)("div",{className:"lumiverse-pack-detail-trait",children:[(0,Le.jsxs)("button",{className:yn("lumiverse-pack-detail-trait-header",a&&"lumiverse-pack-detail-trait-header--open"),onClick:()=>o(!a),type:"button",children:[(0,Le.jsx)("span",{className:"lumiverse-pack-detail-trait-icon",children:(0,Le.jsx)(t,{size:14,strokeWidth:1.5})}),(0,Le.jsx)("span",{className:"lumiverse-pack-detail-trait-title",children:n}),(0,Le.jsx)("span",{className:"lumiverse-pack-detail-trait-chevron",children:a?(0,Le.jsx)(um,{size:14}):(0,Le.jsx)(tu,{size:14})})]}),a&&(0,Le.jsx)("div",{className:"lumiverse-pack-detail-trait-content",children:(0,Le.jsx)("p",{children:bm(i,500)})})]}):null}function ym(e){let{label:n,Icon:t,isSelected:i,onClick:r,disabled:a}=e;return(0,Le.jsxs)("button",{className:yn("lumiverse-pack-detail-action",i&&"lumiverse-pack-detail-action--selected"),onClick:r,disabled:a,title:i?"Already selected":n,type:"button",children:[i?(0,Le.jsx)(iu,{size:12,strokeWidth:2}):(0,Le.jsx)(eu,{size:12,strokeWidth:2}),(0,Le.jsx)("span",{children:n})]})}function km(e){let{item:n,packName:t,selections:i,actions:r}=e;const a=fm(n,"name"),o=fm(n,"img"),s=fm(n,"def"),l=fm(n,"behavior"),c=fm(n,"personality"),u=fm(n,"author"),{objectPosition:d}=bn(o),m=(0,Ee.useMemo)(()=>!!i.definition&&(i.definition.packName===t&&i.definition.itemName===a),[i.definition,t,a]),p=(0,Ee.useMemo)(()=>(i.behaviors||[]).some(e=>e.packName===t&&e.itemName===a),[i.behaviors,t,a]),h=(0,Ee.useMemo)(()=>(i.personalities||[]).some(e=>e.packName===t&&e.itemName===a),[i.personalities,t,a]),v=(0,Ee.useCallback)(()=>{m||(r.setSelectedDefinition({packName:t,itemName:a}),Ye(),"undefined"!=typeof toastr&&toastr.success('Set "'.concat(a,'" as definition')))},[m,r,t,a]),f=(0,Ee.useCallback)(()=>{p||(r.toggleBehavior({packName:t,itemName:a}),Ye(),"undefined"!=typeof toastr&&toastr.success('Added "'.concat(a,'" behavior')))},[p,r,t,a]),g=(0,Ee.useCallback)(()=>{h||(r.togglePersonality({packName:t,itemName:a}),Ye(),"undefined"!=typeof toastr&&toastr.success('Added "'.concat(a,'" personality')))},[h,r,t,a]),b=!!s,x=!!l,y=!!c,k=[b,x,y].filter(Boolean).length>1,w=k&&r.areAllTraitsEnabledForLumia(t,a),j=(0,Ee.useCallback)(()=>{const e=r.toggleAllTraitsForLumia(t,a);Ye(),"undefined"!=typeof toastr&&(e?toastr.success('Enabled all traits for "'.concat(a,'"')):toastr.info('Disabled all traits for "'.concat(a,'"')))},[r,t,a]);return(0,Le.jsxs)("div",{className:"lumiverse-pack-detail-lumia",children:[(0,Le.jsxs)("div",{className:"lumiverse-pack-detail-lumia-header",children:[(0,Le.jsx)("div",{className:"lumiverse-pack-detail-lumia-avatar",children:o?(0,Le.jsx)("img",{src:o,alt:a,style:{objectPosition:d}}):(0,Le.jsx)(od,{size:24,strokeWidth:1.5})}),(0,Le.jsxs)("div",{className:"lumiverse-pack-detail-lumia-info",children:[(0,Le.jsx)("h4",{className:"lumiverse-pack-detail-lumia-name",children:a}),u&&(0,Le.jsxs)("span",{className:"lumiverse-pack-detail-lumia-author",children:["by ",u]})]})]}),(0,Le.jsxs)("div",{className:"lumiverse-pack-detail-traits",children:[(0,Le.jsx)(xm,{title:"Definition",Icon:dm,content:s,defaultOpen:!1}),(0,Le.jsx)(xm,{title:"Behavior",Icon:Vd,content:l,defaultOpen:!1}),(0,Le.jsx)(xm,{title:"Personality",Icon:Wd,content:c,defaultOpen:!1})]}),(0,Le.jsxs)("div",{className:"lumiverse-pack-detail-actions",children:[b&&(0,Le.jsx)(ym,{label:"Set Def",Icon:dm,isSelected:m,onClick:v}),x&&(0,Le.jsx)(ym,{label:"Add Behavior",Icon:Vd,isSelected:p,onClick:f}),y&&(0,Le.jsx)(ym,{label:"Add Personality",Icon:Wd,isSelected:h,onClick:g}),k&&(0,Le.jsx)("button",{className:"lumiverse-pack-detail-action lumiverse-pack-detail-action--enable-all".concat(w?" all-enabled":""),onClick:j,title:w?"Disable all traits for this Lumia":"Enable all traits for this Lumia",type:"button",children:w?"Disable All":"Enable All"})]})]})}const wm=function(){const e=Je(),n=hn(),t=(0,Ee.useSyncExternalStore)(mm.subscribe,hm,hm),i=(0,Ee.useSyncExternalStore)(mm.subscribe,vm,vm),r=(0,Ee.useMemo)(()=>t&&i[t]||null,[t,i]),a=(0,Ee.useMemo)(()=>{if(!r)return[];return gm(r).filter(e=>fm(e,"def"))},[r]),o=(0,Ee.useMemo)(()=>{if(!r)return{lumias:0,behaviors:0,personalities:0};const e=gm(r);return{lumias:e.filter(e=>fm(e,"def")).length,behaviors:e.filter(e=>fm(e,"behavior")).length,personalities:e.filter(e=>fm(e,"personality")).length}},[r]),s=(0,Ee.useCallback)(()=>{e.closePackDetail()},[e]);(0,Ee.useEffect)(()=>{if(!t||!r)return;const e=e=>{"Escape"===e.key&&s()};return document.addEventListener("keydown",e),document.body.style.overflow="hidden",()=>{document.removeEventListener("keydown",e),document.body.style.overflow=""}},[t,r,s]);const l=(0,Ee.useCallback)(e=>{e.target===e.currentTarget&&s()},[s]),c=(0,Ee.useCallback)(e=>{e.stopPropagation()},[]);return t&&r?(0,Au.createPortal)((0,Le.jsx)("div",{className:"lumia-modal-backdrop",onClick:l,onMouseDown:c,onMouseUp:c,children:(0,Le.jsxs)("div",{className:"lumia-modal lumiverse-pack-detail-modal",onClick:c,role:"dialog","aria-modal":"true",children:[(0,Le.jsxs)("div",{className:"lumiverse-pack-detail-header",children:[(0,Le.jsxs)("div",{className:"lumiverse-pack-detail-header-info",children:[(0,Le.jsx)("span",{className:"lumiverse-pack-detail-header-icon",children:r.packCover?(0,Le.jsx)("img",{src:r.packCover,alt:t}):(0,Le.jsx)(Pn,{size:24,strokeWidth:1.5})}),(0,Le.jsxs)("div",{className:"lumiverse-pack-detail-header-text",children:[(0,Le.jsx)("h3",{className:"lumiverse-pack-detail-title",children:t}),(0,Le.jsxs)("div",{className:"lumiverse-pack-detail-stats",children:[(0,Le.jsxs)("span",{children:[(0,Le.jsx)(dm,{size:12})," ",o.lumias," Lumia",1!==o.lumias?"s":""]}),(0,Le.jsxs)("span",{children:[(0,Le.jsx)(Vd,{size:12})," ",o.behaviors," Behavior",1!==o.behaviors?"s":""]}),(0,Le.jsxs)("span",{children:[(0,Le.jsx)(Wd,{size:12})," ",o.personalities," Personalit",1!==o.personalities?"ies":"y"]})]})]})]}),(0,Le.jsx)("button",{className:"lumiverse-pack-detail-close",onClick:s,title:"Close",type:"button",children:(0,Le.jsx)(ru,{size:20,strokeWidth:2})})]}),(0,Le.jsx)("div",{className:"lumiverse-pack-detail-content",children:0===a.length?(0,Le.jsxs)("div",{className:"lumiverse-pack-detail-empty",children:[(0,Le.jsx)(Pn,{size:32,strokeWidth:1.5}),(0,Le.jsx)("p",{children:"No Lumias found in this pack"})]}):(0,Le.jsx)("div",{className:"lumiverse-pack-detail-list",children:a.map((i,r)=>(0,Le.jsx)(km,{item:i,packName:t,selections:n,actions:e},fm(i,"name")||r))})})]})}),document.body):null},jm=Ge,Sm={},Cm=()=>{var e;return null===(e=jm.getState().ui)||void 0===e?void 0:e.viewingLoomPack},Nm=()=>jm.getState().packs||Sm,Pm={"Narrative Style":{Icon:ou,color:"rgba(147, 112, 219, 0.15)",border:"rgba(147, 112, 219, 0.3)",storeField:"styles",toggleAction:"toggleLoomStyle"},"Loom Utilities":{Icon:su,color:"rgba(100, 200, 255, 0.15)",border:"rgba(100, 200, 255, 0.3)",storeField:"utilities",toggleAction:"toggleLoomUtility"},Retrofits:{Icon:lu,color:"rgba(255, 180, 100, 0.15)",border:"rgba(255, 180, 100, 0.3)",storeField:"retrofits",toggleAction:"toggleLoomRetrofit"}};function Em(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;return!e||e.length<=n?e:e.slice(0,n)+"..."}function Mm(e){let{content:n,defaultOpen:t=!1}=e;const[i,r]=(0,Ee.useState)(t);return n?(0,Le.jsxs)("div",{className:"lumiverse-loom-detail-content-preview",children:[(0,Le.jsxs)("button",{className:yn("lumiverse-loom-detail-content-toggle",i&&"lumiverse-loom-detail-content-toggle--open"),onClick:()=>r(!i),type:"button",children:[(0,Le.jsx)("span",{children:"Preview"}),(0,Le.jsx)("span",{className:"lumiverse-loom-detail-content-chevron",children:i?(0,Le.jsx)(um,{size:12}):(0,Le.jsx)(tu,{size:12})})]}),i&&(0,Le.jsx)("div",{className:"lumiverse-loom-detail-content-text",children:(0,Le.jsx)("p",{children:Em(n,500)})})]}):null}function Lm(e){let{item:n,packName:t,category:i,isSelected:r,onToggle:a}=e;const o=Pm[i]||Pm["Narrative Style"],{Icon:s}=o,l=n.loomName||n.itemName||n.name||"Unknown";return(0,Le.jsxs)("div",{className:yn("lumiverse-loom-detail-item",r&&"lumiverse-loom-detail-item--selected"),style:{background:r?o.color.replace("0.15","0.25"):o.color,borderColor:r?o.border.replace("0.3","0.6"):o.border},children:[(0,Le.jsxs)("div",{className:"lumiverse-loom-detail-item-header",children:[(0,Le.jsx)("span",{className:"lumiverse-loom-detail-item-icon",children:(0,Le.jsx)(s,{size:14,strokeWidth:1.5})}),(0,Le.jsx)("span",{className:"lumiverse-loom-detail-item-name",children:l}),(0,Le.jsx)("button",{className:yn("lumiverse-loom-detail-item-toggle",r&&"lumiverse-loom-detail-item-toggle--selected"),onClick:()=>a(t,l),title:r?"Remove from selection":"Add to selection",type:"button",children:r?(0,Le.jsx)(iu,{size:12,strokeWidth:2}):(0,Le.jsx)(eu,{size:12,strokeWidth:2})})]}),(0,Le.jsx)(Mm,{content:n.loomContent||n.content})]})}function Om(e){let{category:n,items:t,packName:i,selections:r,actions:a}=e;const[o,s]=(0,Ee.useState)(!0),l=Pm[n],{Icon:c,storeField:u,toggleAction:d}=l,m=(0,Ee.useCallback)(e=>(r[u]||[]).some(n=>n.packName===i&&n.itemName===e),[r,u,i]),p=(0,Ee.useCallback)((e,n)=>{if(a[d]&&(a[d]({packName:e,itemName:n}),Ye(),"undefined"!=typeof toastr)){const e=m(n);toastr.success(e?'Removed "'.concat(n,'"'):'Added "'.concat(n,'"'))}},[a,d,m]);return t&&0!==t.length?(0,Le.jsxs)("div",{className:"lumiverse-loom-detail-category",children:[(0,Le.jsxs)("button",{className:yn("lumiverse-loom-detail-category-header",o&&"lumiverse-loom-detail-category-header--expanded"),onClick:()=>s(!o),type:"button",children:[(0,Le.jsx)("span",{className:"lumiverse-loom-detail-category-icon",children:(0,Le.jsx)(c,{size:16,strokeWidth:1.5})}),(0,Le.jsx)("span",{className:"lumiverse-loom-detail-category-title",children:n}),(0,Le.jsx)("span",{className:"lumiverse-loom-detail-category-count",children:t.length}),(0,Le.jsx)("span",{className:"lumiverse-loom-detail-category-chevron",children:o?(0,Le.jsx)(um,{size:14}):(0,Le.jsx)(tu,{size:14})})]}),o&&(0,Le.jsx)("div",{className:"lumiverse-loom-detail-category-items",children:t.map((e,t)=>{const r=e.loomName||e.itemName||e.name;return(0,Le.jsx)(Lm,{item:e,packName:i,category:n,isSelected:m(r),onToggle:p},r||t)})})]}):null}const Tm=function(){const e=Je(),n=vn(),t=(0,Ee.useSyncExternalStore)(jm.subscribe,Cm,Cm),i=(0,Ee.useSyncExternalStore)(jm.subscribe,Nm,Nm),r=(0,Ee.useMemo)(()=>t&&i[t]||null,[t,i]),a=(0,Ee.useMemo)(()=>r?function(e){const n={"Narrative Style":[],"Loom Utilities":[],Retrofits:[]},t=e=>{const t=e.loomCategory||e.category;"Narrative Style"===t||"loomStyles"===t?n["Narrative Style"].push(e):"Loom Utilities"===t||"loomUtils"===t?n["Loom Utilities"].push(e):"Retrofits"!==t&&"loomRetrofits"!==t||n.Retrofits.push(e)};return e.loomItems&&Array.isArray(e.loomItems)&&e.loomItems.forEach(t),e.loomStyles&&Array.isArray(e.loomStyles)&&n["Narrative Style"].push(...e.loomStyles),e.loomUtils&&Array.isArray(e.loomUtils)&&n["Loom Utilities"].push(...e.loomUtils),e.loomRetrofits&&Array.isArray(e.loomRetrofits)&&n.Retrofits.push(...e.loomRetrofits),e.items&&Array.isArray(e.items)&&e.items.forEach(e=>{(e.loomCategory||e.category)&&t(e)}),n}(r):null,[r]),o=(0,Ee.useMemo)(()=>a?{styles:a["Narrative Style"].length,utilities:a["Loom Utilities"].length,retrofits:a.Retrofits.length}:{styles:0,utilities:0,retrofits:0},[a]),s=o.styles+o.utilities+o.retrofits,l=(0,Ee.useCallback)(()=>{e.closeLoomPackDetail()},[e]);(0,Ee.useEffect)(()=>{if(!t||!r)return;const e=e=>{"Escape"===e.key&&l()};return document.addEventListener("keydown",e),document.body.style.overflow="hidden",()=>{document.removeEventListener("keydown",e),document.body.style.overflow=""}},[t,r,l]);const c=(0,Ee.useCallback)(e=>{e.target===e.currentTarget&&l()},[l]),u=(0,Ee.useCallback)(e=>{e.stopPropagation()},[]);return t&&r?(0,Au.createPortal)((0,Le.jsx)("div",{className:"lumia-modal-backdrop",onClick:c,onMouseDown:u,onMouseUp:u,children:(0,Le.jsxs)("div",{className:"lumia-modal lumiverse-pack-detail-modal lumiverse-loom-detail-modal",onClick:u,role:"dialog","aria-modal":"true",children:[(0,Le.jsxs)("div",{className:"lumiverse-pack-detail-header",children:[(0,Le.jsxs)("div",{className:"lumiverse-pack-detail-header-info",children:[(0,Le.jsx)("span",{className:"lumiverse-pack-detail-header-icon",children:r.packCover?(0,Le.jsx)("img",{src:r.packCover,alt:t}):(0,Le.jsx)(lu,{size:24,strokeWidth:1.5})}),(0,Le.jsxs)("div",{className:"lumiverse-pack-detail-header-text",children:[(0,Le.jsx)("h3",{className:"lumiverse-pack-detail-title",children:t}),(0,Le.jsxs)("div",{className:"lumiverse-pack-detail-stats",children:[(0,Le.jsxs)("span",{children:[(0,Le.jsx)(ou,{size:12})," ",o.styles," Style",1!==o.styles?"s":""]}),(0,Le.jsxs)("span",{children:[(0,Le.jsx)(su,{size:12})," ",o.utilities," Utilit",1!==o.utilities?"ies":"y"]}),(0,Le.jsxs)("span",{children:[(0,Le.jsx)(lu,{size:12})," ",o.retrofits," Retrofit",1!==o.retrofits?"s":""]})]})]})]}),(0,Le.jsx)("button",{className:"lumiverse-pack-detail-close",onClick:l,title:"Close",type:"button",children:(0,Le.jsx)(ru,{size:20,strokeWidth:2})})]}),(0,Le.jsx)("div",{className:"lumiverse-pack-detail-content",children:0===s?(0,Le.jsxs)("div",{className:"lumiverse-pack-detail-empty",children:[(0,Le.jsx)(lu,{size:32,strokeWidth:1.5}),(0,Le.jsx)("p",{children:"No Loom items found in this pack"})]}):(0,Le.jsxs)("div",{className:"lumiverse-loom-detail-categories",children:[(0,Le.jsx)(Om,{category:"Narrative Style",items:a["Narrative Style"],packName:t,selections:n,actions:e}),(0,Le.jsx)(Om,{category:"Loom Utilities",items:a["Loom Utilities"],packName:t,selections:n,actions:e}),(0,Le.jsx)(Om,{category:"Retrofits",items:a.Retrofits,packName:t,selections:n,actions:e})]})})]})}),document.body):null};const Dm=function(){pn();const e=Je(),n=gn();return(0,Le.jsxs)("div",{className:"lumiverse-app",children:[(0,Le.jsx)(Iu,{}),(0,Le.jsx)(cm,{}),(0,Le.jsx)(wm,{}),(0,Le.jsx)(Tm,{}),n.isLoading&&(0,Le.jsx)("div",{className:"lumiverse-loading-overlay",children:(0,Le.jsx)("div",{className:"lumiverse-spinner"})}),n.error&&(0,Le.jsxs)("div",{className:"lumiverse-error-toast",onClick:e.clearError,children:[(0,Le.jsx)("span",{children:n.error}),(0,Le.jsx)("button",{className:"lumiverse-error-dismiss",children:"Dismiss"})]})]})},zm=Nn("message-square",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]]),Im=Nn("sliders-vertical",[["path",{d:"M10 8h4",key:"1sr2af"}],["path",{d:"M12 21v-9",key:"17s77i"}],["path",{d:"M12 8V3",key:"13r4qs"}],["path",{d:"M17 16h4",key:"h1uq16"}],["path",{d:"M19 12V3",key:"o1uvq1"}],["path",{d:"M19 21v-5",key:"qua636"}],["path",{d:"M3 14h4",key:"bcjad9"}],["path",{d:"M5 10V3",key:"cb8scm"}],["path",{d:"M5 21v-7",key:"1w1uti"}]]),Am=Ge,Rm={useDefault:!0,xPercent:1,yPercent:1},Bm=()=>{var e;return null!==(e=Am.getState().lumiaButtonPosition)&&void 0!==e?e:Rm};function _m(e){let{isVisible:n,onClick:t}=e;return(0,Le.jsxs)("button",{className:yn("lumiverse-panel-toggle",n&&"lumiverse-panel-toggle--active"),onClick:t,title:n?"Hide Lumiverse Panel":"Show Lumiverse Panel",type:"button",children:[(0,Le.jsx)("span",{className:"lumiverse-panel-toggle-icon",children:(0,Le.jsx)(ou,{size:18,strokeWidth:2})}),(0,Le.jsx)("span",{className:"lumiverse-panel-toggle-label",children:"Lumia"})]})}function Um(e){let{id:n,Icon:t,label:i,isActive:r,onClick:a}=e;return(0,Le.jsxs)("button",{className:yn("lumiverse-vp-tab",r&&"lumiverse-vp-tab--active"),onClick:()=>a(n),title:i,type:"button",children:[(0,Le.jsx)("span",{className:"lumiverse-vp-tab-icon",children:(0,Le.jsx)(t,{size:20,strokeWidth:1.5})}),(0,Le.jsx)("span",{className:"lumiverse-vp-tab-label",children:i})]})}function Fm(e){let{isCollapsed:n,onClick:t}=e;return(0,Le.jsx)("button",{className:"lumiverse-vp-collapse-btn",onClick:t,title:n?"Expand panel":"Collapse panel",type:"button",children:(0,Le.jsx)("span",{className:yn("lumiverse-vp-collapse-icon",n&&"lumiverse-vp-collapse-icon--rotated"),children:(0,Le.jsx)(cd,{size:18,strokeWidth:2})})})}function Vm(e){let{title:n,Icon:t,onClose:i}=e;return(0,Le.jsxs)("div",{className:"lumiverse-vp-header",children:[(0,Le.jsx)("span",{className:"lumiverse-vp-header-icon",children:(0,Le.jsx)(t,{size:18,strokeWidth:1.5})}),(0,Le.jsx)("span",{className:"lumiverse-vp-header-title",children:n}),(0,Le.jsx)("button",{className:"lumiverse-vp-close-btn",onClick:i,title:"Close panel",type:"button",children:(0,Le.jsx)(ru,{size:16,strokeWidth:2})})]})}const Wm=[{id:"profile",Icon:od,label:"Profile",title:"Character Lumia Profile"},{id:"presets",Icon:nu,label:"Presets",title:"Lumia Presets"},{id:"browser",Icon:Pn,label:"Packs",title:"Pack Browser"},{id:"ooc",Icon:zm,label:"OOC",title:"OOC Settings"},{id:"prompt",Icon:Im,label:"Prompt",title:"Prompt Settings"},{id:"council",Icon:Jc,label:"Council",title:"Council of Lumiae"},{id:"summary",Icon:dm,label:"Summary",title:"Summary Editor"}];function Hm(e){let{tab:n}=e;const t={profile:{Icon:od,title:"Character Lumia Profile",description:"View and manage Lumia traits for the current character"},presets:{Icon:nu,title:"Lumia Presets",description:"Save and load preset configurations for quick switching"},browser:{Icon:Pn,title:"Pack Browser",description:"Browse and search through all loaded packs with previews"},ooc:{Icon:zm,title:"OOC Settings",description:"Configure out-of-character comment behavior and triggers"},prompt:{Icon:Im,title:"Prompt Settings",description:"Configure prompt injection and formatting options"},council:{Icon:Jc,title:"Council of Lumiae",description:"Manage multiple independent Lumias that collaborate as a council"},summary:{Icon:dm,title:"Summary Editor",description:"View and edit the current conversation summary"}}[n]||{},{Icon:i}=t;return(0,Le.jsxs)("div",{className:"lumiverse-vp-placeholder",children:[i&&(0,Le.jsx)("span",{className:"lumiverse-vp-placeholder-icon",children:(0,Le.jsx)(i,{size:32,strokeWidth:1.5})}),(0,Le.jsx)("h3",{children:t.title}),(0,Le.jsx)("p",{children:t.description}),(0,Le.jsx)("span",{className:"lumiverse-vp-placeholder-badge",children:"Coming Soon"})]})}const $m=function(e){let{isVisible:n,onToggle:t,onClose:i,defaultTab:r="profile",ProfileContent:a,PresetsContent:o,BrowserContent:s,OOCContent:l,PromptContent:c,CouncilContent:u,SummaryContent:d}=e;const[m,p]=(0,Ee.useState)(r),[h,v]=(0,Ee.useState)(!1),f=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:600;const[n,t]=(0,Ee.useState)("undefined"!=typeof window&&window.innerWidth<=e);return(0,Ee.useEffect)(()=>{const n=()=>{const n=window.innerWidth<=e;t(e=>e!==n?n:e)};return window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[e]),n}(),g=(0,Ee.useSyncExternalStore)(Am.subscribe,Bm,Bm),b=!g.useDefault,x=f?window.innerWidth:376,y=f?window.innerWidth-56:320,k=(0,Ee.useCallback)(e=>{h&&v(!1),p(e)},[h]),w=(0,Ee.useCallback)(()=>{v(e=>!e)},[]),j=Wm.find(e=>e.id===m),S=(0,Ee.useMemo)(()=>({profile:a?(0,Le.jsx)(a,{onTabChange:k}):(0,Le.jsx)(Hm,{tab:"profile"}),presets:o?(0,Le.jsx)(o,{}):(0,Le.jsx)(Hm,{tab:"presets"}),browser:s?(0,Le.jsx)(s,{}):(0,Le.jsx)(Hm,{tab:"browser"}),ooc:l?(0,Le.jsx)(l,{}):(0,Le.jsx)(Hm,{tab:"ooc"}),prompt:c?(0,Le.jsx)(c,{}):(0,Le.jsx)(Hm,{tab:"prompt"}),council:u?(0,Le.jsx)(u,{}):(0,Le.jsx)(Hm,{tab:"council"}),summary:d?(0,Le.jsx)(d,{}):(0,Le.jsx)(Hm,{tab:"summary"})}),[a,o,s,l,c,u,d,k]);return(0,Le.jsxs)(Le.Fragment,{children:[(0,Le.jsx)("div",{className:yn("lumiverse-toggle-container",b&&"lumiverse-toggle-container--custom"),style:b?{position:"fixed",top:0,right:"".concat(g.xPercent,"%"),marginTop:"".concat(g.yPercent,"vh"),marginRight:0,zIndex:9997,pointerEvents:"auto",display:f&&n?"none":"block"}:{position:"fixed",top:12,right:n?h?68:x+12:12,zIndex:9997,pointerEvents:"auto",transition:"right 0.25s cubic-bezier(0.4, 0, 0.2, 1)",display:f&&n?"none":"block"},children:(0,Le.jsx)(_m,{isVisible:n,onClick:t})}),(0,Le.jsx)("div",{className:"lumiverse-viewport-wrapper",style:{position:"fixed",top:0,right:0,bottom:0,width:x,zIndex:9998,transform:"translateX(".concat(n?0:x,"px)"),transition:"transform 0.25s cubic-bezier(0.4, 0, 0.2, 1)",pointerEvents:"none"},children:(0,Le.jsxs)("div",{className:yn("lumiverse-viewport-panel",h&&"lumiverse-viewport-panel--collapsed"),style:{transform:h?"translateX(".concat(y,"px)"):"translateX(0)",transition:"transform 0.2s ease"},children:[(0,Le.jsxs)("div",{className:"lumiverse-vp-tabs",children:[Wm.map(e=>(0,Le.jsx)(Um,{id:e.id,Icon:e.Icon,label:e.label,isActive:m===e.id,onClick:k},e.id)),(0,Le.jsx)("div",{className:"lumiverse-vp-tabs-spacer"}),(0,Le.jsx)(Fm,{isCollapsed:h,onClick:w})]}),(0,Le.jsxs)("div",{className:"lumiverse-vp-main",style:{width:y,opacity:h?0:1,transition:"opacity 0.2s ease"},children:[(0,Le.jsx)(Vm,{title:(null==j?void 0:j.title)||"Panel",Icon:(null==j?void 0:j.Icon)||od,onClose:i}),(0,Le.jsx)("div",{className:"lumiverse-vp-content",children:Wm.map(e=>(0,Le.jsx)("div",{className:yn("lumiverse-vp-tab-content",m===e.id&&"lumiverse-vp-tab-content--active"),"aria-hidden":m!==e.id,children:S[e.id]},e.id))})]})]})})]})},qm=Nn("star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]),Ym=Ge,Km=[],Gm=()=>Ym.getState().chatChangeCounter||0,Qm=()=>Ym.getState().chimeraMode||!1,Xm=()=>Ym.getState().selectedDefinitions||Km,Zm=()=>Ym.getState().councilMode||!1,Jm=()=>Ym.getState().councilMembers||Km;function ep(e){return(null==e?void 0:e.id)||(null==e?void 0:e.itemName)||(null==e?void 0:e.lumiaDefName)||null}function np(e,n){if(!e||!n)return!1;const t=ep(e),i=ep(n);return t&&i&&t===i}const tp=(0,Ee.forwardRef)(function(e,n){let{trait:t,type:i,isDominant:r,onRemove:a}=e;const o={definition:{bg:"rgba(100, 200, 255, 0.15)",border:"rgba(100, 200, 255, 0.3)",Icon:dm},behavior:{bg:"rgba(255, 180, 100, 0.15)",border:"rgba(255, 180, 100, 0.3)",Icon:Vd},personality:{bg:"rgba(200, 100, 255, 0.15)",border:"rgba(200, 100, 255, 0.3)",Icon:Wd}},s=o[i]||o.definition,{Icon:l}=s;return(0,Le.jsxs)(Zc.div,{ref:n,className:yn("lumiverse-trait-card",r&&"lumiverse-trait-card--dominant"),style:{background:s.bg,borderColor:s.border},initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.1},children:[(0,Le.jsx)("span",{className:"lumiverse-trait-icon",children:(0,Le.jsx)(l,{size:16,strokeWidth:1.5})}),(0,Le.jsxs)("div",{className:"lumiverse-trait-info",children:[(0,Le.jsx)("span",{className:"lumiverse-trait-name",children:t.name||t.itemName||t.lumiaDefName||"Unknown"}),r&&(0,Le.jsxs)("span",{className:"lumiverse-trait-dominant-badge",children:[(0,Le.jsx)(qm,{size:12,strokeWidth:2})," Dominant"]})]}),a&&(0,Le.jsx)("button",{className:"lumiverse-trait-remove",onClick:()=>a(t),title:"Remove trait",type:"button",children:(0,Le.jsx)(ru,{size:14,strokeWidth:2})})]})});function ip(e){let{Icon:n,title:t,count:i}=e;return(0,Le.jsxs)("div",{className:"lumiverse-profile-section-header",children:[(0,Le.jsx)("span",{className:"lumiverse-profile-section-icon",children:(0,Le.jsx)(n,{size:16,strokeWidth:1.5})}),(0,Le.jsx)("span",{className:"lumiverse-profile-section-title",children:t}),void 0!==i&&(0,Le.jsx)("span",{className:"lumiverse-profile-section-count",children:i})]})}function rp(e){let{message:n}=e;return(0,Le.jsx)("div",{className:"lumiverse-profile-empty",children:(0,Le.jsx)("span",{children:n})})}function ap(e){let{councilMembers:n,allPacks:t,onManageCouncil:i}=e;const r=n.length,a=n.reduce((e,n)=>{var t;return e+((null===(t=n.behaviors)||void 0===t?void 0:t.length)||0)},0),o=n.reduce((e,n)=>{var t;return e+((null===(t=n.personalities)||void 0===t?void 0:t.length)||0)},0),s=n.slice(0,4),l=r-4;return(0,Le.jsxs)("div",{className:"lumiverse-council-banner",children:[(0,Le.jsx)("div",{className:"lumiverse-council-banner-icon",children:(0,Le.jsx)(Jc,{size:28,strokeWidth:1.5})}),(0,Le.jsxs)("div",{className:"lumiverse-council-banner-content",children:[(0,Le.jsx)("h4",{className:"lumiverse-council-banner-title",children:"Council of Lumiae Active"}),(0,Le.jsxs)("div",{className:"lumiverse-council-banner-stats",children:[(0,Le.jsxs)("span",{className:"lumiverse-council-banner-stat",children:[(0,Le.jsx)(Jc,{size:14})," ",r," member",1!==r?"s":""]}),(0,Le.jsxs)("span",{className:"lumiverse-council-banner-stat",children:[(0,Le.jsx)(Vd,{size:14})," ",a," behavior",1!==a?"s":""]}),(0,Le.jsxs)("span",{className:"lumiverse-council-banner-stat",children:[(0,Le.jsx)(Wd,{size:14})," ",o," personalit",1!==o?"ies":"y"]})]}),s.length>0&&(0,Le.jsxs)("div",{className:"lumiverse-council-banner-avatars",children:[s.map((e,n)=>{const i=function(e,n,t){var i;const r=(Array.isArray(e)?e:Object.values(e||{})).find(e=>(e.name||e.packName)===n);if(!r)return null;if(r.lumiaItems&&r.lumiaItems.length>0){const e=r.lumiaItems.find(e=>e.lumiaName===t||e.lumiaDefName===t);return(null==e?void 0:e.avatarUrl)||(null==e?void 0:e.lumia_img)||null}const a=null===(i=r.items)||void 0===i?void 0:i.find(e=>e.lumiaDefName===t);return(null==a?void 0:a.lumia_img)||null}(t,e.packName,e.itemName);return(0,Le.jsx)("div",{className:"lumiverse-council-banner-avatar",style:{zIndex:s.length-n},title:e.itemName,children:i?(0,Le.jsx)("img",{src:i,alt:e.itemName}):(0,Le.jsx)(Jc,{size:14})},e.id)}),l>0&&(0,Le.jsxs)("div",{className:"lumiverse-council-banner-more",children:["+",l]})]})]}),i&&(0,Le.jsxs)("button",{className:"lumiverse-council-banner-btn",onClick:i,type:"button",children:["Manage Council ",(0,Le.jsx)(Ud,{size:16})]})]})}function op(){const e=vn(),{styles:n,utilities:t,retrofits:i}=e;return n.length>0||t.length>0||i.length>0?(0,Le.jsxs)("div",{className:"lumiverse-profile-section",children:[(0,Le.jsx)(ip,{Icon:ou,title:"Loom Configuration"}),(0,Le.jsxs)("div",{className:"lumiverse-loom-summary",children:[n.length>0&&(0,Le.jsxs)("div",{className:"lumiverse-loom-group",children:[(0,Le.jsx)("span",{className:"lumiverse-loom-label",children:"Styles:"}),(0,Le.jsx)("span",{className:"lumiverse-loom-items",children:n.map(e=>e.name||e.itemName||"Unknown").join(", ")})]}),t.length>0&&(0,Le.jsxs)("div",{className:"lumiverse-loom-group",children:[(0,Le.jsx)("span",{className:"lumiverse-loom-label",children:"Utilities:"}),(0,Le.jsx)("span",{className:"lumiverse-loom-items",children:t.map(e=>e.name||e.itemName||"Unknown").join(", ")})]}),i.length>0&&(0,Le.jsxs)("div",{className:"lumiverse-loom-group",children:[(0,Le.jsx)("span",{className:"lumiverse-loom-label",children:"Retrofits:"}),(0,Le.jsx)("span",{className:"lumiverse-loom-items",children:i.map(e=>e.name||e.itemName||"Unknown").join(", ")})]})]})]}):(0,Le.jsxs)("div",{className:"lumiverse-profile-section",children:[(0,Le.jsx)(ip,{Icon:ou,title:"Loom Configuration"}),(0,Le.jsx)(rp,{message:"No Loom items selected"})]})}const sp=function(e){var n,t;let{onTabChange:i}=e;const r=function(){const e=(0,Ee.useSyncExternalStore)(Ym.subscribe,Gm,()=>0);return(0,Ee.useMemo)(()=>{if("undefined"!=typeof SillyTavern)try{const e=SillyTavern.getContext();if(null!=e&&e.characters&&void 0!==(null==e?void 0:e.characterId)){const n=e.characters[e.characterId];return{name:(null==n?void 0:n.name)||"Unknown",avatar:null!=n&&n.avatar?"/characters/".concat(encodeURIComponent(n.avatar)):null,description:(null==n?void 0:n.description)||""}}}catch(e){console.warn("[LumiverseUI] Could not get character:",e)}return{name:"No Character",avatar:null,description:""}},[e])}(),a=hn(),{allPacks:o}=fn(),s=(0,Ee.useSyncExternalStore)(Ym.subscribe,Qm,Qm),l=(0,Ee.useSyncExternalStore)(Ym.subscribe,Xm,Xm),c=(0,Ee.useSyncExternalStore)(Ym.subscribe,Zm,Zm),u=(0,Ee.useSyncExternalStore)(Ym.subscribe,Jm,Jm),d=c&&u.length>0,m=s?l.length:a.definition?1:0,p=(0,Ee.useMemo)(()=>{var e,n;return{behaviors:(null===(e=a.behaviors)||void 0===e?void 0:e.length)||0,personalities:(null===(n=a.personalities)||void 0===n?void 0:n.length)||0,hasDefinition:!!a.definition,definitionCount:m,totalPacks:o.length}},[a,o,m]);return(0,Le.jsxs)("div",{className:"lumiverse-character-profile",children:[(0,Le.jsxs)("div",{className:"lumiverse-profile-header",children:[(0,Le.jsx)("div",{className:"lumiverse-profile-avatar",children:r.avatar?(0,Le.jsx)("img",{src:r.avatar,alt:r.name}):(0,Le.jsx)("span",{className:"lumiverse-profile-avatar-placeholder",children:(0,Le.jsx)(od,{size:32,strokeWidth:1.5})})}),(0,Le.jsxs)("div",{className:"lumiverse-profile-info",children:[(0,Le.jsx)("h3",{className:"lumiverse-profile-name",children:r.name}),(0,Le.jsxs)("div",{className:"lumiverse-profile-stats",children:[(0,Le.jsxs)("span",{className:"lumiverse-stat",title:"Behaviors",children:[(0,Le.jsx)(Vd,{size:14,strokeWidth:1.5,className:"lumiverse-stat-icon"}),(0,Le.jsx)("span",{className:"lumiverse-stat-value",children:p.behaviors})]}),(0,Le.jsxs)("span",{className:"lumiverse-stat",title:"Personalities",children:[(0,Le.jsx)(Wd,{size:14,strokeWidth:1.5,className:"lumiverse-stat-icon"}),(0,Le.jsx)("span",{className:"lumiverse-stat-value",children:p.personalities})]}),(0,Le.jsxs)("span",{className:"lumiverse-stat",title:"Packs",children:[(0,Le.jsx)(Pn,{size:14,strokeWidth:1.5,className:"lumiverse-stat-icon"}),(0,Le.jsx)("span",{className:"lumiverse-stat-value",children:p.totalPacks})]})]})]})]}),d?(0,Le.jsx)(ap,{councilMembers:u,allPacks:o,onManageCouncil:()=>{i&&i("council")}}):(0,Le.jsxs)(Le.Fragment,{children:[(0,Le.jsxs)("div",{className:"lumiverse-profile-section",children:[(0,Le.jsx)(ip,{Icon:s?lu:dm,title:s?"Chimera Definitions":"Definition",count:p.definitionCount}),(0,Le.jsx)("div",{className:"lumiverse-traits-list",children:(0,Le.jsx)(at,{initial:!1,children:s?l.length>0?l.map((e,n)=>(0,Le.jsx)(tp,{trait:e,type:"definition"},ep(e)||"def-".concat(n))):(0,Le.jsx)(rp,{message:"No Chimera forms selected"}):a.definition?(0,Le.jsx)(tp,{trait:a.definition,type:"definition"},ep(a.definition)||"def"):(0,Le.jsx)(rp,{message:"No definition selected"})})})]}),(0,Le.jsxs)("div",{className:"lumiverse-profile-section",children:[(0,Le.jsx)(ip,{Icon:Vd,title:"Behaviors",count:p.behaviors}),(0,Le.jsx)("div",{className:"lumiverse-traits-list",children:(0,Le.jsx)(at,{initial:!1,children:(null===(n=a.behaviors)||void 0===n?void 0:n.length)>0?a.behaviors.map(e=>(0,Le.jsx)(tp,{trait:e,type:"behavior",isDominant:np(a.dominantBehavior,e)},ep(e))):(0,Le.jsx)(rp,{message:"No behaviors selected"})})})]}),(0,Le.jsxs)("div",{className:"lumiverse-profile-section",children:[(0,Le.jsx)(ip,{Icon:Wd,title:"Personalities",count:p.personalities}),(0,Le.jsx)("div",{className:"lumiverse-traits-list",children:(0,Le.jsx)(at,{initial:!1,children:(null===(t=a.personalities)||void 0===t?void 0:t.length)>0?a.personalities.map(e=>(0,Le.jsx)(tp,{trait:e,type:"personality",isDominant:np(a.dominantPersonality,e)},ep(e))):(0,Le.jsx)(rp,{message:"No personalities selected"})})})]})]}),(0,Le.jsx)(op,{})]})},lp=Nn("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),cp=Nn("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),up=Ge,dp={},mp=()=>up.getState().presets||dp,pp=()=>up.getState().activePresetName;function hp(e){if(!e)return"";const n=Date.now()-e,t=Math.floor(n/6e4);if(t<1)return"Just now";if(t<60)return"".concat(t,"m ago");const i=Math.floor(t/60);if(i<24)return"".concat(i,"h ago");const r=Math.floor(i/24);return r<7?"".concat(r,"d ago"):new Date(e).toLocaleDateString()}function vp(e){let{preset:n,isActive:t,onLoad:i,onUpdate:r,onDelete:a}=e;const[o,s]=(0,Ee.useState)(!1),l=(0,Ee.useMemo)(()=>{var e,t,i,r,a,o;if(n.councilMode&&(null===(e=n.councilMembers)||void 0===e?void 0:e.length)>0){return{isCouncil:!0,members:n.councilMembers.length,behaviors:n.councilMembers.reduce((e,n)=>{var t;return e+((null===(t=n.behaviors)||void 0===t?void 0:t.length)||0)},0),personalities:n.councilMembers.reduce((e,n)=>{var t;return e+((null===(t=n.personalities)||void 0===t?void 0:t.length)||0)},0)}}return n.chimeraMode&&(null===(t=n.selectedDefinitions)||void 0===t?void 0:t.length)>0?{isChimera:!0,definitions:n.selectedDefinitions.length,behaviors:(null===(i=n.selectedBehaviors)||void 0===i?void 0:i.length)||0,personalities:(null===(r=n.selectedPersonalities)||void 0===r?void 0:r.length)||0}:{definitions:n.selectedDefinition?1:0,behaviors:(null===(a=n.selectedBehaviors)||void 0===a?void 0:a.length)||0,personalities:(null===(o=n.selectedPersonalities)||void 0===o?void 0:o.length)||0}},[n]);return(0,Le.jsxs)("div",{className:yn("lumiverse-preset-card",t&&"lumiverse-preset-card--active"),children:[(0,Le.jsxs)("div",{className:"lumiverse-preset-card-header",children:[(0,Le.jsx)("span",{className:"lumiverse-preset-card-icon",children:(0,Le.jsx)(nu,{size:16,strokeWidth:1.5})}),(0,Le.jsx)("span",{className:"lumiverse-preset-card-name",children:n.name}),t&&(0,Le.jsxs)("span",{className:"lumiverse-preset-card-active-badge",children:[(0,Le.jsx)(iu,{size:12,strokeWidth:2})," Active"]})]}),(0,Le.jsxs)("div",{className:"lumiverse-preset-card-meta",children:[(0,Le.jsx)("div",{className:"lumiverse-preset-stats",children:l.isCouncil?(0,Le.jsxs)(Le.Fragment,{children:[(0,Le.jsxs)("span",{className:"lumiverse-preset-stat lumiverse-preset-stat--council",children:[(0,Le.jsx)(Jc,{size:12,strokeWidth:1.5})," ",l.members]}),(0,Le.jsxs)("span",{className:"lumiverse-preset-stat",children:[(0,Le.jsx)(Vd,{size:12,strokeWidth:1.5})," ",l.behaviors]}),(0,Le.jsxs)("span",{className:"lumiverse-preset-stat",children:[(0,Le.jsx)(Wd,{size:12,strokeWidth:1.5})," ",l.personalities]})]}):(0,Le.jsxs)(Le.Fragment,{children:[(0,Le.jsxs)("span",{className:yn("lumiverse-preset-stat",l.isChimera&&"lumiverse-preset-stat--chimera"),children:[(0,Le.jsx)(dm,{size:12,strokeWidth:1.5})," ",l.definitions]}),(0,Le.jsxs)("span",{className:"lumiverse-preset-stat",children:[(0,Le.jsx)(Vd,{size:12,strokeWidth:1.5})," ",l.behaviors]}),(0,Le.jsxs)("span",{className:"lumiverse-preset-stat",children:[(0,Le.jsx)(Wd,{size:12,strokeWidth:1.5})," ",l.personalities]})]})}),n.chimeraMode&&(0,Le.jsx)("span",{className:"lumiverse-preset-card-mode",children:"Chimera"}),n.councilMode&&(0,Le.jsx)("span",{className:"lumiverse-preset-card-mode",children:"Council"}),(0,Le.jsxs)("span",{className:"lumiverse-preset-card-time",children:[(0,Le.jsx)(lp,{size:12,strokeWidth:1.5}),hp(n.updatedAt||n.createdAt)]})]}),(0,Le.jsxs)("div",{className:"lumiverse-preset-card-actions",children:[(0,Le.jsx)("button",{className:"lumiverse-preset-btn lumiverse-preset-btn--primary",onClick:()=>i(n.name),title:"Load this preset",type:"button",children:"Load"}),(0,Le.jsx)("button",{className:"lumiverse-preset-btn",onClick:()=>r(n.name),title:"Update preset with current selections",type:"button",children:(0,Le.jsx)(cp,{size:14,strokeWidth:1.5})}),(0,Le.jsx)("button",{className:yn("lumiverse-preset-btn lumiverse-preset-btn--danger",o&&"lumiverse-preset-btn--confirming"),onClick:()=>{o?(a(n.name),s(!1)):(s(!0),setTimeout(()=>s(!1),3e3))},title:o?"Click again to confirm":"Delete preset",type:"button",children:o?(0,Le.jsx)(ru,{size:14,strokeWidth:2}):(0,Le.jsx)(Mn,{size:14,strokeWidth:1.5})})]})]})}function fp(){return(0,Le.jsxs)("div",{className:"lumiverse-preset-empty",children:[(0,Le.jsx)("span",{className:"lumiverse-preset-empty-icon",children:(0,Le.jsx)(nu,{size:32,strokeWidth:1.5})}),(0,Le.jsx)("h4",{children:"No Presets Saved"}),(0,Le.jsx)("p",{children:"Save your current Lumia configuration as a preset to quickly switch between setups."})]})}const gp=function(){const e=Je(),[n,t]=(0,Ee.useState)(""),[i,r]=(0,Ee.useState)(!1),a=(0,Ee.useSyncExternalStore)(up.subscribe,mp,mp),o=(0,Ee.useSyncExternalStore)(up.subscribe,pp,pp),s=(0,Ee.useMemo)(()=>Object.values(a).sort((e,n)=>{const t=e.updatedAt||e.createdAt||0;return(n.updatedAt||n.createdAt||0)-t}),[a]),l=(0,Ee.useCallback)(n=>{e.loadPreset(n),Ye()},[e]),c=(0,Ee.useCallback)(n=>{e.updatePreset(n),Ye()},[e]),u=(0,Ee.useCallback)(n=>{e.deletePreset(n),Ye()},[e]),d=(0,Ee.useCallback)(()=>{const i=n.trim();i&&(a[i]||(e.savePreset(i),Ye(),t(""),r(!1)))},[n,a,e]);return(0,Le.jsxs)("div",{className:"lumiverse-preset-manager",children:[(0,Le.jsxs)("div",{className:"lumiverse-preset-header",children:[(0,Le.jsx)("h3",{className:"lumiverse-preset-title",children:"Lumia Presets"}),i?(0,Le.jsxs)("div",{className:"lumiverse-preset-create-form",children:[(0,Le.jsx)("input",{type:"text",className:"lumiverse-preset-input",placeholder:"Preset name...",value:n,onChange:e=>t(e.target.value),onKeyDown:e=>{"Enter"===e.key?d():"Escape"===e.key&&(r(!1),t(""))},autoFocus:!0}),(0,Le.jsx)("button",{className:"lumiverse-preset-btn lumiverse-preset-btn--primary",onClick:d,disabled:!n.trim(),type:"button",children:(0,Le.jsx)(iu,{size:14,strokeWidth:2})}),(0,Le.jsx)("button",{className:"lumiverse-preset-btn",onClick:()=>{r(!1),t("")},type:"button",children:(0,Le.jsx)(ru,{size:14,strokeWidth:2})})]}):(0,Le.jsxs)("button",{className:"lumiverse-preset-create-btn",onClick:()=>r(!0),title:"Save current configuration as preset",type:"button",children:[(0,Le.jsx)(eu,{size:16,strokeWidth:2}),(0,Le.jsx)("span",{children:"New Preset"})]})]}),(0,Le.jsx)("div",{className:"lumiverse-preset-list",children:0===s.length?(0,Le.jsx)(fp,{}):s.map(e=>(0,Le.jsx)(vp,{preset:e,isActive:o===e.name,onLoad:l,onUpdate:c,onDelete:u},e.name))}),s.length>0&&(0,Le.jsx)("div",{className:"lumiverse-preset-help",children:(0,Le.jsx)("p",{children:"Presets save your Lumia selections (definition, behaviors, personalities) and mode settings."})})]})};function bp(e,n,t){let i,r=t.initialDeps??[],a=!0;function o(){var o,s,l;let c;t.key&&(null==(o=t.debug)?void 0:o.call(t))&&(c=Date.now());const u=e();if(!(u.length!==r.length||u.some((e,n)=>r[n]!==e)))return i;let d;if(r=u,t.key&&(null==(s=t.debug)?void 0:s.call(t))&&(d=Date.now()),i=n(...u),t.key&&(null==(l=t.debug)?void 0:l.call(t))){const e=Math.round(100*(Date.now()-c))/100,n=Math.round(100*(Date.now()-d))/100,i=n/16,r=(e,n)=>{for(e=String(e);e.length<n;)e=" "+e;return e};console.info(`%c⏱ ${r(n,5)} /${r(e,5)} ms`,`\n            font-size: .6rem;\n            font-weight: bold;\n            color: hsl(${Math.max(0,Math.min(120-120*i,120))}deg 100% 31%);`,null==t?void 0:t.key)}return!(null==t?void 0:t.onChange)||a&&t.skipInitialOnChange||t.onChange(i),a=!1,i}return o.updateDeps=e=>{r=e},o}function xp(e,n){if(void 0===e)throw new Error("Unexpected undefined"+(n?`: ${n}`:""));return e}const yp=(e,n,t)=>{let i;return function(...r){e.clearTimeout(i),i=e.setTimeout(()=>n.apply(this,r),t)}},kp=e=>{const{offsetWidth:n,offsetHeight:t}=e;return{width:n,height:t}},wp=e=>e,jp=e=>{const n=Math.max(e.startIndex-e.overscan,0),t=Math.min(e.endIndex+e.overscan,e.count-1),i=[];for(let e=n;e<=t;e++)i.push(e);return i},Sp=(e,n)=>{const t=e.scrollElement;if(!t)return;const i=e.targetWindow;if(!i)return;const r=e=>{const{width:t,height:i}=e;n({width:Math.round(t),height:Math.round(i)})};if(r(kp(t)),!i.ResizeObserver)return()=>{};const a=new i.ResizeObserver(n=>{const i=()=>{const e=n[0];if(null==e?void 0:e.borderBoxSize){const n=e.borderBoxSize[0];if(n)return void r({width:n.inlineSize,height:n.blockSize})}r(kp(t))};e.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(i):i()});return a.observe(t,{box:"border-box"}),()=>{a.unobserve(t)}},Cp={passive:!0},Np="undefined"==typeof window||"onscrollend"in window,Pp=(e,n)=>{const t=e.scrollElement;if(!t)return;const i=e.targetWindow;if(!i)return;let r=0;const a=e.options.useScrollendEvent&&Np?()=>{}:yp(i,()=>{n(r,!1)},e.options.isScrollingResetDelay),o=i=>()=>{const{horizontal:o,isRtl:s}=e.options;r=o?t.scrollLeft*(s?-1:1):t.scrollTop,a(),n(r,i)},s=o(!0),l=o(!1);l(),t.addEventListener("scroll",s,Cp);const c=e.options.useScrollendEvent&&Np;return c&&t.addEventListener("scrollend",l,Cp),()=>{t.removeEventListener("scroll",s),c&&t.removeEventListener("scrollend",l)}},Ep=(e,n,t)=>{if(null==n?void 0:n.borderBoxSize){const e=n.borderBoxSize[0];if(e){return Math.round(e[t.options.horizontal?"inlineSize":"blockSize"])}}return e[t.options.horizontal?"offsetWidth":"offsetHeight"]},Mp=(e,{adjustments:n=0,behavior:t},i)=>{var r,a;const o=e+n;null==(a=null==(r=i.scrollElement)?void 0:r.scrollTo)||a.call(r,{[i.options.horizontal?"left":"top"]:o,behavior:t})};class Lp{constructor(e){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.measurementsCache=[],this.itemSizeCache=new Map,this.laneAssignments=new Map,this.pendingMeasuredCacheIndexes=[],this.prevLanes=void 0,this.lanesChangedFlag=!1,this.lanesSettling=!1,this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let e=null;const n=()=>e||(this.targetWindow&&this.targetWindow.ResizeObserver?e=new this.targetWindow.ResizeObserver(e=>{e.forEach(e=>{const n=()=>{this._measureElement(e.target,e)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(n):n()})}):null);return{disconnect:()=>{var t;null==(t=n())||t.disconnect(),e=null},observe:e=>{var t;return null==(t=n())?void 0:t.observe(e,{box:"border-box"})},unobserve:e=>{var t;return null==(t=n())?void 0:t.unobserve(e)}}})(),this.range=null,this.setOptions=e=>{Object.entries(e).forEach(([n,t])=>{void 0===t&&delete e[n]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:wp,rangeExtractor:jp,onChange:()=>{},measureElement:Ep,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...e}},this.notify=e=>{var n,t;null==(t=(n=this.options).onChange)||t.call(n,this,e)},this.maybeNotify=bp(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),e=>{this.notify(e)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(e=>e()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var e;const n=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==n){if(this.cleanup(),!n)return void this.maybeNotify();this.scrollElement=n,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=(null==(e=this.scrollElement)?void 0:e.window)??null,this.elementsCache.forEach(e=>{this.observer.observe(e)}),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,e=>{this.scrollRect=e,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(e,n)=>{this.scrollAdjustments=0,this.scrollDirection=n?this.getScrollOffset()<e?"forward":"backward":null,this.scrollOffset=e,this.isScrolling=n,this.maybeNotify()}))}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??("function"==typeof this.options.initialOffset?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(e,n)=>{const t=new Map,i=new Map;for(let r=n-1;r>=0;r--){const n=e[r];if(t.has(n.lane))continue;const a=i.get(n.lane);if(null==a||n.end>a.end?i.set(n.lane,n):n.end<a.end&&t.set(n.lane,!0),t.size===this.options.lanes)break}return i.size===this.options.lanes?Array.from(i.values()).sort((e,n)=>e.end===n.end?e.index-n.index:e.end-n.end)[0]:void 0},this.getMeasurementOptions=bp(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled,this.options.lanes],(e,n,t,i,r,a)=>(void 0!==this.prevLanes&&this.prevLanes!==a&&(this.lanesChangedFlag=!0),this.prevLanes=a,this.pendingMeasuredCacheIndexes=[],{count:e,paddingStart:n,scrollMargin:t,getItemKey:i,enabled:r,lanes:a}),{key:!1,skipInitialOnChange:!0,onChange:()=>{this.notify(this.isScrolling)}}),this.getMeasurements=bp(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:e,paddingStart:n,scrollMargin:t,getItemKey:i,enabled:r,lanes:a},o)=>{if(!r)return this.measurementsCache=[],this.itemSizeCache.clear(),this.laneAssignments.clear(),[];if(this.laneAssignments.size>e)for(const n of this.laneAssignments.keys())n>=e&&this.laneAssignments.delete(n);this.lanesChangedFlag&&(this.lanesChangedFlag=!1,this.lanesSettling=!0,this.measurementsCache=[],this.itemSizeCache.clear(),this.laneAssignments.clear(),this.pendingMeasuredCacheIndexes=[]),0===this.measurementsCache.length&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(e=>{this.itemSizeCache.set(e.key,e.size)}));const s=this.lanesSettling?0:this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[],this.lanesSettling&&this.measurementsCache.length===e&&(this.lanesSettling=!1);const l=this.measurementsCache.slice(0,s),c=new Array(a).fill(void 0);for(let e=0;e<s;e++){const n=l[e];n&&(c[n.lane]=e)}for(let r=s;r<e;r++){const e=i(r),a=this.laneAssignments.get(r);let s,u;if(void 0!==a&&this.options.lanes>1){s=a;const e=c[s],i=void 0!==e?l[e]:void 0;u=i?i.end+this.options.gap:n+t}else{const e=1===this.options.lanes?l[r-1]:this.getFurthestMeasurement(l,r);u=e?e.end+this.options.gap:n+t,s=e?e.lane:r%this.options.lanes,this.options.lanes>1&&this.laneAssignments.set(r,s)}const d=o.get(e),m="number"==typeof d?d:this.options.estimateSize(r),p=u+m;l[r]={index:r,start:u,size:m,end:p,key:e,lane:s},c[s]=r}return this.measurementsCache=l,l},{key:!1,debug:()=>this.options.debug}),this.calculateRange=bp(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(e,n,t,i)=>this.range=e.length>0&&n>0?function({measurements:e,outerSize:n,scrollOffset:t,lanes:i}){const r=e.length-1,a=n=>e[n].start;if(e.length<=i)return{startIndex:0,endIndex:r};let o=Op(0,r,a,t),s=o;if(1===i)for(;s<r&&e[s].end<t+n;)s++;else if(i>1){const a=Array(i).fill(0);for(;s<r&&a.some(e=>e<t+n);){const n=e[s];a[n.lane]=n.end,s++}const l=Array(i).fill(t+n);for(;o>=0&&l.some(e=>e>=t);){const n=e[o];l[n.lane]=n.start,o--}o=Math.max(0,o-o%i),s=Math.min(r,s+(i-1-s%i))}return{startIndex:o,endIndex:s}}({measurements:e,outerSize:n,scrollOffset:t,lanes:i}):null,{key:!1,debug:()=>this.options.debug}),this.getVirtualIndexes=bp(()=>{let e=null,n=null;const t=this.calculateRange();return t&&(e=t.startIndex,n=t.endIndex),this.maybeNotify.updateDeps([this.isScrolling,e,n]),[this.options.rangeExtractor,this.options.overscan,this.options.count,e,n]},(e,n,t,i,r)=>null===i||null===r?[]:e({startIndex:i,endIndex:r,overscan:n,count:t}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=e=>{const n=this.options.indexAttribute,t=e.getAttribute(n);return t?parseInt(t,10):(console.warn(`Missing attribute name '${n}={index}' on measured element.`),-1)},this._measureElement=(e,n)=>{const t=this.indexFromElement(e),i=this.measurementsCache[t];if(!i)return;const r=i.key,a=this.elementsCache.get(r);a!==e&&(a&&this.observer.unobserve(a),this.observer.observe(e),this.elementsCache.set(r,e)),e.isConnected&&this.resizeItem(t,this.options.measureElement(e,n,this))},this.resizeItem=(e,n)=>{const t=this.measurementsCache[e];if(!t)return;const i=n-(this.itemSizeCache.get(t.key)??t.size);0!==i&&((void 0!==this.shouldAdjustScrollPositionOnItemSizeChange?this.shouldAdjustScrollPositionOnItemSizeChange(t,i,this):t.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=i,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(t.index),this.itemSizeCache=new Map(this.itemSizeCache.set(t.key,n)),this.notify(!1))},this.measureElement=e=>{e?this._measureElement(e,void 0):this.elementsCache.forEach((e,n)=>{e.isConnected||(this.observer.unobserve(e),this.elementsCache.delete(n))})},this.getVirtualItems=bp(()=>[this.getVirtualIndexes(),this.getMeasurements()],(e,n)=>{const t=[];for(let i=0,r=e.length;i<r;i++){const r=n[e[i]];t.push(r)}return t},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=e=>{const n=this.getMeasurements();if(0!==n.length)return xp(n[Op(0,n.length-1,e=>xp(n[e]).start,e)])},this.getOffsetForAlignment=(e,n,t=0)=>{const i=this.getSize(),r=this.getScrollOffset();"auto"===n&&(n=e>=r+i?"end":"start"),"center"===n?e+=(t-i)/2:"end"===n&&(e-=i);const a=this.getTotalSize()+this.options.scrollMargin-i;return Math.max(Math.min(a,e),0)},this.getOffsetForIndex=(e,n="auto")=>{e=Math.max(0,Math.min(e,this.options.count-1));const t=this.measurementsCache[e];if(!t)return;const i=this.getSize(),r=this.getScrollOffset();if("auto"===n)if(t.end>=r+i-this.options.scrollPaddingEnd)n="end";else{if(!(t.start<=r+this.options.scrollPaddingStart))return[r,n];n="start"}const a="end"===n?t.end+this.options.scrollPaddingEnd:t.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(a,n,t.size),n]},this.isDynamicMode=()=>this.elementsCache.size>0,this.scrollToOffset=(e,{align:n="start",behavior:t}={})=>{"smooth"===t&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(e,n),{adjustments:void 0,behavior:t})},this.scrollToIndex=(e,{align:n="auto",behavior:t}={})=>{"smooth"===t&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),e=Math.max(0,Math.min(e,this.options.count-1));let i=0;const r=n=>{if(!this.targetWindow)return;const i=this.getOffsetForIndex(e,n);if(!i)return void console.warn("Failed to get offset for index:",e);const[r,o]=i;this._scrollToOffset(r,{adjustments:void 0,behavior:t}),this.targetWindow.requestAnimationFrame(()=>{const n=this.getScrollOffset(),t=this.getOffsetForIndex(e,o);var i,r;t?(i=t[0],r=n,Math.abs(i-r)<1.01||a(o)):console.warn("Failed to get offset for index:",e)})},a=n=>{this.targetWindow&&(i++,i<10?this.targetWindow.requestAnimationFrame(()=>r(n)):console.warn(`Failed to scroll to index ${e} after 10 attempts.`))};r(n)},this.scrollBy=(e,{behavior:n}={})=>{"smooth"===n&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+e,{adjustments:void 0,behavior:n})},this.getTotalSize=()=>{var e;const n=this.getMeasurements();let t;if(0===n.length)t=this.options.paddingStart;else if(1===this.options.lanes)t=(null==(e=n[n.length-1])?void 0:e.end)??0;else{const e=Array(this.options.lanes).fill(null);let i=n.length-1;for(;i>=0&&e.some(e=>null===e);){const t=n[i];null===e[t.lane]&&(e[t.lane]=t.end),i--}t=Math.max(...e.filter(e=>null!==e))}return Math.max(t-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(e,{adjustments:n,behavior:t})=>{this.options.scrollToFn(e,{behavior:t,adjustments:n},this)},this.measure=()=>{this.itemSizeCache=new Map,this.laneAssignments=new Map,this.notify(!1)},this.setOptions(e)}}const Op=(e,n,t,i)=>{for(;e<=n;){const r=(e+n)/2|0,a=t(r);if(a<i)e=r+1;else{if(!(a>i))return r;n=r-1}}return e>0?e-1:0};const Tp="undefined"!=typeof document?Ee.useLayoutEffect:Ee.useEffect;function Dp(e){const n=Ee.useReducer(()=>({}),{})[1],t={...e,onChange:(t,i)=>{var r;i?(0,Au.flushSync)(n):n(),null==(r=e.onChange)||r.call(e,t,i)}},[i]=Ee.useState(()=>new Lp(t));return i.setOptions(t),Tp(()=>i._didMount(),[]),Tp(()=>i._willUpdate()),i}const zp=Nn("funnel",[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]]);function Ip(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,i)}return t}function Ap(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Ip(Object(t),!0).forEach(function(n){Rp(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Ip(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Rp(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,n||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function Bp(e,n){if(!e)return null;const t={name:["lumiaName","lumiaDefName"],def:["lumiaDefinition","lumiaDef"],personality:["lumiaPersonality","lumia_personality"],behavior:["lumiaBehavior","lumia_behavior"],img:["avatarUrl","lumia_img"],author:["authorName","defAuthor"]}[n];if(!t)return null;for(const n of t)if(void 0!==e[n]&&null!==e[n])return e[n];return null}function _p(e){let{value:n,onChange:t,placeholder:i}=e;return(0,Le.jsxs)("div",{className:"lumiverse-pack-search",children:[(0,Le.jsx)("span",{className:"lumiverse-pack-search-icon",children:(0,Le.jsx)(Hd,{size:16,strokeWidth:1.5})}),(0,Le.jsx)("input",{type:"text",className:"lumiverse-pack-search-input",placeholder:i,value:n,onChange:e=>t(e.target.value)}),n&&(0,Le.jsx)("button",{className:"lumiverse-pack-search-clear",onClick:()=>t(""),type:"button",children:(0,Le.jsx)(ru,{size:14,strokeWidth:2})})]})}function Up(e){let{activeFilter:n,onFilterChange:t,showSelectedOnly:i,onToggleSelectedOnly:r,selectedCount:a}=e;const o=[{id:"all",label:"All",Icon:Pn},{id:"definition",label:"Definitions",Icon:dm},{id:"behavior",label:"Behaviors",Icon:Vd},{id:"personality",label:"Personalities",Icon:Wd}];return(0,Le.jsxs)("div",{className:"lumiverse-pack-filters-container",children:[(0,Le.jsx)("div",{className:"lumiverse-pack-filters",children:o.map(e=>{const{Icon:i}=e;return(0,Le.jsx)("button",{className:yn("lumiverse-pack-filter",n===e.id&&"lumiverse-pack-filter--active"),onClick:()=>t(e.id),title:e.label,type:"button",children:(0,Le.jsx)(i,{size:16,strokeWidth:1.5})},e.id)})}),(0,Le.jsxs)("button",{className:yn("lumiverse-pack-filter-selected-toggle",i&&"lumiverse-pack-filter-selected-toggle--active"),onClick:r,title:i?"Show all items":"Show selected only",type:"button",children:[(0,Le.jsx)(zp,{size:14,strokeWidth:1.5}),a>0&&(0,Le.jsx)("span",{className:"lumiverse-pack-filter-selected-count",children:a})]})]})}function Fp(e){let{pack:n,isExpanded:t,onToggle:i,onViewPack:r,itemCount:a}=e;const o=n.name||n.packName||"Unknown Pack";return(0,Le.jsxs)("button",{className:yn("lumiverse-browser-pack-header",t&&"lumiverse-browser-pack-header--expanded"),onClick:i,type:"button",children:[n.packCover?(0,Le.jsx)("img",{src:n.packCover,alt:o,className:"lumiverse-browser-pack-cover"}):(0,Le.jsx)("div",{className:"lumiverse-browser-pack-cover-placeholder",children:n.isCustom?(0,Le.jsx)(ou,{size:20,strokeWidth:1.5}):(0,Le.jsx)(Pn,{size:20,strokeWidth:1.5})}),(0,Le.jsxs)("div",{className:"lumiverse-browser-pack-info",children:[(0,Le.jsx)("span",{className:"lumiverse-browser-pack-name",children:o}),(0,Le.jsxs)("span",{className:"lumiverse-browser-pack-meta",children:[a," items",n.isCustom&&(0,Le.jsx)("span",{className:"lumiverse-browser-pack-custom-badge",children:"Custom"})]})]}),(0,Le.jsx)("span",{className:"lumiverse-browser-pack-view-btn",onClick:e=>{e.stopPropagation(),null==r||r(o)},title:"View pack contents",role:"button",tabIndex:0,children:(0,Le.jsx)(au,{size:16,strokeWidth:1.5})}),(0,Le.jsx)("span",{className:yn("lumiverse-browser-pack-chevron",t&&"lumiverse-browser-pack-chevron--rotated"),children:(0,Le.jsx)(tu,{size:16,strokeWidth:2})})]})}function Vp(e){let{item:n,type:t,onSelect:i,isSelected:r}=e;const a={definition:{Icon:dm,color:"rgba(100, 200, 255, 0.15)",border:"rgba(100, 200, 255, 0.3)",selectedBorder:"rgba(100, 200, 255, 0.7)"},behavior:{Icon:Vd,color:"rgba(255, 180, 100, 0.15)",border:"rgba(255, 180, 100, 0.3)",selectedBorder:"rgba(255, 180, 100, 0.7)"},personality:{Icon:Wd,color:"rgba(200, 100, 255, 0.15)",border:"rgba(200, 100, 255, 0.3)",selectedBorder:"rgba(200, 100, 255, 0.7)"}},o=Bp(n,"img"),s=Bp(n,"name")||"Unknown",{objectPosition:l}=bn(o),c=a[t]||a.definition,{Icon:u}=c,d=(()=>{if("definition"===t){const e=Bp(n,"def");return e?e.slice(0,100):""}if("behavior"===t){const e=Bp(n,"behavior");return e?e.slice(0,100):""}if("personality"===t){const e=Bp(n,"personality");return e?e.slice(0,100):""}return""})();return(0,Le.jsxs)(Zc.div,{className:yn("lumiverse-browser-item",r&&"lumiverse-browser-item--selected"),style:{background:r?c.color.replace("0.15","0.25"):c.color,borderColor:r?c.selectedBorder:c.border},onClick:()=>null==i?void 0:i(n,t),initial:{opacity:0,y:10},animate:{opacity:1,y:0},whileHover:{scale:1.02},whileTap:{scale:.98},children:[o&&(0,Le.jsx)("img",{src:o,alt:s,className:"lumiverse-browser-item-image",style:{objectPosition:l}}),(0,Le.jsxs)("div",{className:"lumiverse-browser-item-content",children:[(0,Le.jsxs)("div",{className:"lumiverse-browser-item-header",children:[(0,Le.jsx)("span",{className:"lumiverse-browser-item-icon",children:(0,Le.jsx)(u,{size:14,strokeWidth:1.5})}),(0,Le.jsx)("span",{className:"lumiverse-browser-item-name",children:s}),r&&(0,Le.jsx)("span",{className:"lumiverse-browser-item-check",children:(0,Le.jsx)(iu,{size:14,strokeWidth:2.5})})]}),d&&(0,Le.jsx)("p",{className:"lumiverse-browser-item-desc",children:d})]})]})}function Wp(e,n,t){const i=Bp(e,"name"),r=e.packName;if("definition"===n){const e=t.definition;return(null==e?void 0:e.itemName)===i&&(null==e?void 0:e.packName)===r}var a,o,s,l;return"behavior"===n?null!==(a=null===(o=t.behaviors)||void 0===o?void 0:o.some(e=>e.itemName===i&&e.packName===r))&&void 0!==a&&a:"personality"===n&&(null!==(s=null===(l=t.personalities)||void 0===l?void 0:l.some(e=>e.itemName===i&&e.packName===r))&&void 0!==s&&s)}function Hp(e){let{items:n,filter:t,onSelectItem:i,selections:r}=e;const a=(0,Ee.useRef)(null),o=(0,Ee.useMemo)(()=>"all"===t?n:n.filter(e=>e.type===t),[n,t]),s=function(e){return Dp({observeElementRect:Sp,observeElementOffset:Pp,scrollToFn:Mp,...e})}({count:o.length,getScrollElement:()=>a.current,estimateSize:()=>80,overscan:5});return 0===o.length?(0,Le.jsx)("div",{className:"lumiverse-browser-empty-items",children:"No items match the current filter"}):(0,Le.jsx)("div",{ref:a,className:"lumiverse-browser-items-container",style:{maxHeight:"300px",overflow:"auto"},children:(0,Le.jsx)("div",{style:{height:"".concat(s.getTotalSize(),"px"),width:"100%",position:"relative"},children:s.getVirtualItems().map(e=>{const n=o[e.index];return(0,Le.jsx)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"".concat(e.size,"px"),transform:"translateY(".concat(e.start,"px)"),padding:"4px 0"},children:(0,Le.jsx)(Vp,{item:n,type:n.type,onSelect:i,isSelected:Wp(n,n.type,r)})},e.key)})})})}function $p(e){let{pack:n,filter:t,searchQuery:i,showSelectedOnly:r,onSelectItem:a,onViewPack:o,selections:s}=e;const[l,c]=(0,Ee.useState)(!1),u=n.name||n.packName||"Unknown Pack",d=(0,Ee.useMemo)(()=>{const e=[];return(n.lumiaItems&&n.lumiaItems.length>0?n.lumiaItems:(n.items||[]).filter(e=>!e.loomCategory&&(e.lumiaDefName||e.lumiaName))).forEach((n,t)=>{const i=(e=>e.lumiaName||e.lumiaDefName)(n);if(!i)return;const r=!!(e=>e.lumiaDefinition||e.lumiaDef)(n),a=!!(e=>e.lumiaBehavior||e.lumia_behavior)(n),o=!!(e=>e.lumiaPersonality||e.lumia_personality)(n);r&&e.push(Ap(Ap({},n),{},{lumiaDefName:i,type:"definition",packName:u,id:"def-".concat(u,"-").concat(i,"-").concat(t)})),a&&e.push(Ap(Ap({},n),{},{lumiaDefName:i,type:"behavior",packName:u,id:"beh-".concat(u,"-").concat(i,"-").concat(t)})),o&&e.push(Ap(Ap({},n),{},{lumiaDefName:i,type:"personality",packName:u,id:"per-".concat(u,"-").concat(i,"-").concat(t)}))}),e},[n,u]),m=(0,Ee.useMemo)(()=>{let e=d;if("all"!==t&&(e=e.filter(e=>e.type===t)),i){const n=i.toLowerCase();e=e.filter(e=>{const t=(Bp(e,"name")||"").toLowerCase(),i=(Bp(e,"def")||"").toLowerCase(),r=(Bp(e,"behavior")||"").toLowerCase(),a=(Bp(e,"personality")||"").toLowerCase();return t.includes(n)||i.includes(n)||r.includes(n)||a.includes(n)})}return r&&(e=e.filter(e=>Wp(e,e.type,s))),e},[d,t,i,r,s]);return 0===m.length?null:(0,Le.jsxs)("div",{className:"lumiverse-browser-pack",children:[(0,Le.jsx)(Fp,{pack:n,isExpanded:l,onToggle:()=>c(!l),onViewPack:o,itemCount:m.length}),(0,Le.jsx)($n,{isOpen:l,className:"lumiverse-browser-pack-items",duration:200,children:(0,Le.jsx)(Hp,{items:m,filter:t,onSelectItem:a,selections:s})})]})}function qp(e){let{packs:n,customPacks:t}=e;const i=(0,Ee.useMemo)(()=>{let e=0,i=0,r=0;return[...n,...t].forEach(n=>{(n.lumiaItems&&n.lumiaItems.length>0?n.lumiaItems:(n.items||[]).filter(e=>!e.loomCategory)).forEach(n=>{(n.lumiaName||n.lumiaDefName)&&((n.lumiaDefinition||n.lumiaDef)&&e++,(n.lumiaBehavior||n.lumia_behavior)&&i++,(n.lumiaPersonality||n.lumia_personality)&&r++)})}),{definitions:e,behaviors:i,personalities:r,total:n.length+t.length}},[n,t]);return(0,Le.jsxs)("div",{className:"lumiverse-browser-stats",children:[(0,Le.jsxs)("div",{className:"lumiverse-browser-stat",children:[(0,Le.jsx)("span",{className:"lumiverse-browser-stat-value",children:i.total}),(0,Le.jsx)("span",{className:"lumiverse-browser-stat-label",children:"PACKS"})]}),(0,Le.jsxs)("div",{className:"lumiverse-browser-stat",children:[(0,Le.jsx)("span",{className:"lumiverse-browser-stat-value",children:i.definitions}),(0,Le.jsx)("span",{className:"lumiverse-browser-stat-label",children:"DEFS"})]}),(0,Le.jsxs)("div",{className:"lumiverse-browser-stat",children:[(0,Le.jsx)("span",{className:"lumiverse-browser-stat-value",children:i.behaviors}),(0,Le.jsx)("span",{className:"lumiverse-browser-stat-label",children:"BEHAV"})]}),(0,Le.jsxs)("div",{className:"lumiverse-browser-stat",children:[(0,Le.jsx)("span",{className:"lumiverse-browser-stat-value",children:i.personalities}),(0,Le.jsx)("span",{className:"lumiverse-browser-stat-label",children:"PERS"})]})]})}const Yp=function(){const{packs:e,customPacks:n}=fn(),t=hn(),i=Je(),[r,a]=(0,Ee.useState)(""),[o,s]=(0,Ee.useState)("all"),[l,c]=(0,Ee.useState)(!1),u=(0,Ee.useMemo)(()=>{let e=0;return t.definition&&(e+=1),e+=(t.behaviors||[]).length,e+=(t.personalities||[]).length,e},[t]),d=(0,Ee.useMemo)(()=>[...e.map(e=>Ap(Ap({},e),{},{isCustom:!1})),...n.map(e=>Ap(Ap({},e),{},{isCustom:!0}))],[e,n]),m=(0,Ee.useCallback)((e,n)=>{console.log("[PackBrowser] Selected item:",e,n);const t={packName:e.packName,itemName:Bp(e,"name")};"definition"===n?i.setSelectedDefinition(t):"behavior"===n?i.toggleBehavior(t):"personality"===n&&i.togglePersonality(t),Ye()},[i]),p=(0,Ee.useCallback)(e=>{i.openPackDetail(e)},[i]);return(0,Le.jsxs)("div",{className:"lumiverse-pack-browser",children:[(0,Le.jsx)(qp,{packs:e,customPacks:n}),(0,Le.jsx)(_p,{value:r,onChange:a,placeholder:"Search packs and items..."}),(0,Le.jsx)(Up,{activeFilter:o,onFilterChange:s,showSelectedOnly:l,onToggleSelectedOnly:()=>c(!l),selectedCount:u}),(0,Le.jsx)("div",{className:"lumiverse-browser-packs",children:0===d.length?(0,Le.jsxs)("div",{className:"lumiverse-browser-empty",children:[(0,Le.jsx)("span",{className:"lumiverse-browser-empty-icon",children:(0,Le.jsx)(Pn,{size:32,strokeWidth:1.5})}),(0,Le.jsx)("p",{children:"No packs loaded"}),(0,Le.jsx)("span",{className:"lumiverse-browser-empty-hint",children:"Add packs in the Settings panel"})]}):l&&0===u?(0,Le.jsxs)("div",{className:"lumiverse-browser-empty",children:[(0,Le.jsx)("span",{className:"lumiverse-browser-empty-icon",children:(0,Le.jsx)(zp,{size:32,strokeWidth:1.5})}),(0,Le.jsx)("p",{children:"No items selected"}),(0,Le.jsx)("span",{className:"lumiverse-browser-empty-hint",children:"Select items to see them here, or disable the filter"})]}):d.map((e,n)=>(0,Le.jsx)($p,{pack:e,filter:o,searchQuery:r,showSelectedOnly:l,onSelectItem:m,onViewPack:p,selections:t},e.name||e.packName||"pack-".concat(n)))})]})},Kp=Nn("type",[["path",{d:"M12 4v16",key:"1654pz"}],["path",{d:"M4 7V5a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v2",key:"e0r10z"}],["path",{d:"M9 20h6",key:"s66wpe"}]]),Gp=Nn("layout-grid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]),Qp=Nn("quote",[["path",{d:"M16 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z",key:"rib7q0"}],["path",{d:"M5 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z",key:"1ymkrd"}]]),Xp=Nn("message-circle",[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]]);function Zp(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,i)}return t}function Jp(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Zp(Object(t),!0).forEach(function(n){eh(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Zp(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function eh(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,n||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const nh=Ge;function th(e){let{id:n,Icon:t,title:i,description:r,selected:a,onChange:o}=e;return(0,Le.jsxs)("label",{className:yn("lumiverse-vp-style-option",a&&"lumiverse-vp-style-option--selected"),children:[(0,Le.jsx)("input",{type:"radio",name:"ooc-style",value:n,checked:a,onChange:()=>o(n)}),(0,Le.jsx)("span",{className:"lumiverse-vp-style-option-icon",children:(0,Le.jsx)(t,{size:20,strokeWidth:1.5})}),(0,Le.jsxs)("div",{className:"lumiverse-vp-style-option-text",children:[(0,Le.jsx)("span",{className:"lumiverse-vp-style-option-title",children:i}),(0,Le.jsx)("span",{className:"lumiverse-vp-style-option-desc",children:r})]})]})}function ih(e){let{id:n,label:t,hint:i,value:r,onChange:a,placeholder:o,min:s=1}=e;return(0,Le.jsxs)("div",{className:"lumiverse-vp-field",children:[(0,Le.jsx)("label",{className:"lumiverse-vp-field-label",htmlFor:n,children:t}),(0,Le.jsx)("input",{type:"number",id:n,className:"lumiverse-vp-field-input",value:r,onChange:e=>a(e.target.value),placeholder:o,min:s}),i&&(0,Le.jsx)("span",{className:"lumiverse-vp-field-hint",children:i})]})}const rh=function(){Je();const e=(0,Ee.useSyncExternalStore)(nh.subscribe,()=>nh.getState().lumiaOOCInterval,()=>nh.getState().lumiaOOCInterval),n=(0,Ee.useSyncExternalStore)(nh.subscribe,()=>nh.getState().lumiaOOCStyle||"social",()=>nh.getState().lumiaOOCStyle||"social"),t=(0,Ee.useCallback)(e=>{const n=e?parseInt(e,10):null;nh.setState({lumiaOOCInterval:n}),Ke()},[]),i=(0,Ee.useCallback)(e=>{if(nh.setState({lumiaOOCStyle:e}),Ke(),"undefined"!=typeof LumiverseBridge){const e=LumiverseBridge.getCallbacks();null!=e&&e.refreshOOCComments&&e.refreshOOCComments(!0)}},[]),r=[{id:"none",Icon:Kp,title:"None",description:"Raw text with no formatting"},{id:"social",Icon:Gp,title:"Social Card",description:"Full card with avatar & animations"},{id:"margin",Icon:dm,title:"Margin Note",description:"Minimal hanging tag style"},{id:"whisper",Icon:Qp,title:"Whisper Bubble",description:"Soft ethereal thought bubble"}];return(0,Le.jsxs)("div",{className:"lumiverse-vp-settings-panel",children:[(0,Le.jsxs)("div",{className:"lumiverse-vp-settings-section",children:[(0,Le.jsxs)("div",{className:"lumiverse-vp-settings-section-header",children:[(0,Le.jsx)(lp,{size:16,strokeWidth:1.5}),(0,Le.jsx)("span",{children:"Comment Trigger"})]}),(0,Le.jsx)("p",{className:"lumiverse-vp-settings-desc",children:"Automatically inject OOC instructions at message intervals."}),(0,Le.jsx)(ih,{id:"ooc-interval",label:"Message Interval",hint:"Triggers when message count is divisible by this number",value:(null==e?void 0:e.toString())||"",onChange:t,placeholder:"e.g., 10 (empty = disabled)"})]}),(0,Le.jsxs)("div",{className:"lumiverse-vp-settings-section",children:[(0,Le.jsxs)("div",{className:"lumiverse-vp-settings-section-header",children:[(0,Le.jsx)(Xp,{size:16,strokeWidth:1.5}),(0,Le.jsx)("span",{children:"Display Style"})]}),(0,Le.jsx)("p",{className:"lumiverse-vp-settings-desc",children:"Choose how OOC comments appear in chat."}),(0,Le.jsx)("div",{className:"lumiverse-vp-style-options",children:r.map(e=>(0,Le.jsx)(th,Jp(Jp({},e),{},{selected:n===e.id,onChange:i}),e.id))})]})]})},ah=Nn("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),oh=Nn("hand",[["path",{d:"M18 11V6a2 2 0 0 0-2-2a2 2 0 0 0-2 2",key:"1fvzgz"}],["path",{d:"M14 10V4a2 2 0 0 0-2-2a2 2 0 0 0-2 2v2",key:"1kc0my"}],["path",{d:"M10 10.5V6a2 2 0 0 0-2-2a2 2 0 0 0-2 2v8",key:"10h0bg"}],["path",{d:"M18 8a2 2 0 1 1 4 0v6a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15",key:"1s1gnw"}]]);function sh(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,i)}return t}function lh(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?sh(Object(t),!0).forEach(function(n){ch(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):sh(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function ch(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,n||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const uh=Ge,dh={},mh={enabled:!1,excludeLastMessage:!0,includeMessageInPrompt:!0},ph=()=>uh.getState().sovereignHand||mh,hh=()=>uh.getState().contextFilters||dh,vh=()=>uh.getState().chimeraMode||!1,fh=()=>uh.getState().councilMode||!1,gh=()=>{var e;return(null===(e=uh.getState().selectedDefinitions)||void 0===e?void 0:e.length)||0},bh=()=>{var e;return(null===(e=uh.getState().councilMembers)||void 0===e?void 0:e.length)||0};function xh(e){let{id:n,checked:t,onChange:i,label:r,hint:a,disabled:o=!1}=e;return(0,Le.jsxs)("div",{className:yn("lumiverse-vp-toggle-row",o&&"lumiverse-vp-toggle-row--disabled"),children:[(0,Le.jsxs)("label",{className:"lumiverse-vp-toggle-label",htmlFor:n,children:[(0,Le.jsx)("span",{className:"lumiverse-vp-toggle-text",children:r}),a&&(0,Le.jsx)("span",{className:"lumiverse-vp-toggle-hint",children:a})]}),(0,Le.jsxs)("div",{className:"lumiverse-vp-toggle-switch-wrapper",children:[(0,Le.jsx)("input",{type:"checkbox",id:n,className:"lumiverse-vp-toggle-input",checked:t,onChange:e=>i(e.target.checked),disabled:o}),(0,Le.jsx)("label",{htmlFor:n,className:"lumiverse-vp-toggle-switch-label",children:(0,Le.jsx)("div",{className:yn("lumiverse-vp-toggle-track",t&&"lumiverse-vp-toggle-track--on",o&&"lumiverse-vp-toggle-track--disabled"),children:(0,Le.jsx)("div",{className:"lumiverse-vp-toggle-thumb"})})})]})]})}function yh(e){let{id:n,label:t,hint:i,value:r,onChange:a,min:o=0,max:s=100}=e;return(0,Le.jsxs)("div",{className:"lumiverse-vp-field lumiverse-vp-field--inline",children:[(0,Le.jsx)("label",{className:"lumiverse-vp-field-label",htmlFor:n,children:t}),(0,Le.jsx)("input",{type:"number",id:n,className:"lumiverse-vp-field-input lumiverse-vp-field-input--small",value:r,onChange:e=>a(parseInt(e.target.value,10)||0),min:o,max:s}),i&&(0,Le.jsx)("span",{className:"lumiverse-vp-field-hint",children:i})]})}function kh(e){let{Icon:n,title:t,status:i,children:r,defaultOpen:a=!1}=e;const[o,s]=(0,Ee.useState)(a);return(0,Le.jsxs)("div",{className:yn("lumiverse-vp-collapsible",o&&"lumiverse-vp-collapsible--open"),children:[(0,Le.jsxs)("button",{className:"lumiverse-vp-collapsible-header",onClick:()=>s(!o),type:"button",children:[(0,Le.jsx)("span",{className:yn("lumiverse-vp-collapsible-chevron",o&&"lumiverse-vp-collapsible-chevron--open"),children:(0,Le.jsx)(tu,{size:14,strokeWidth:2})}),(0,Le.jsx)("span",{className:"lumiverse-vp-collapsible-icon",children:(0,Le.jsx)(n,{size:16,strokeWidth:1.5})}),(0,Le.jsx)("span",{className:"lumiverse-vp-collapsible-title",children:t}),void 0!==i&&(0,Le.jsx)("span",{className:yn("lumiverse-vp-collapsible-status",i&&"lumiverse-vp-collapsible-status--active"),children:i?"Active":"Inactive"})]}),(0,Le.jsx)($n,{isOpen:o,className:"lumiverse-vp-collapsible-content",duration:200,children:(0,Le.jsx)("div",{className:"lumiverse-vp-collapsible-inner",children:r})})]})}function wh(e){let{items:n,muted:t=!1}=e;return(0,Le.jsxs)("div",{className:yn("lumiverse-vp-info-box",t&&"lumiverse-vp-info-box--muted"),children:[(0,Le.jsxs)("div",{className:"lumiverse-vp-info-box-header",children:[(0,Le.jsx)(ah,{size:14,strokeWidth:2}),(0,Le.jsx)("span",{children:"When enabled:"})]}),(0,Le.jsx)("ul",{className:"lumiverse-vp-info-box-list",children:n.map((e,n)=>(0,Le.jsx)("li",{children:e},n))})]})}function jh(e){let{id:n,label:t,hint:i,enabled:r,onToggle:a,depthValue:o,onDepthChange:s,depthLabel:l,depthHint:c}=e;return(0,Le.jsxs)("div",{className:"lumiverse-vp-filter-item",children:[(0,Le.jsx)(xh,{id:n,checked:r,onChange:a,label:t,hint:i}),(0,Le.jsx)($n,{isOpen:r&&void 0!==o,className:"lumiverse-vp-filter-options",duration:150,children:(0,Le.jsx)(yh,{id:"".concat(n,"-depth"),label:l||"Keep in last N messages",hint:c,value:o,onChange:s})})]})}const Sh=function(){var e,n,t,i,r,a,o,s,l,c,u,d,m,p,h,v,f;const g=Je(),b=(0,Ee.useSyncExternalStore)(uh.subscribe,ph,ph),x=(0,Ee.useSyncExternalStore)(uh.subscribe,hh,hh),y=(0,Ee.useSyncExternalStore)(uh.subscribe,vh,vh),k=(0,Ee.useSyncExternalStore)(uh.subscribe,fh,fh),w=(0,Ee.useSyncExternalStore)(uh.subscribe,gh,gh),j=(0,Ee.useSyncExternalStore)(uh.subscribe,bh,bh),S=null!==(e=b.enabled)&&void 0!==e&&e,C=null!==(n=null===(t=x.htmlTags)||void 0===t?void 0:t.enabled)&&void 0!==n&&n,N=null!==(i=null===(r=x.htmlTags)||void 0===r?void 0:r.stripFonts)&&void 0!==i&&i,P=null!==(a=null===(o=x.htmlTags)||void 0===o?void 0:o.fontKeepDepth)&&void 0!==a?a:3,E=null!==(s=null===(l=x.detailsBlocks)||void 0===l?void 0:l.enabled)&&void 0!==s&&s,M=null!==(c=null===(u=x.detailsBlocks)||void 0===u?void 0:u.keepDepth)&&void 0!==c?c:3,L=null!==(d=null===(m=x.loomItems)||void 0===m?void 0:m.enabled)&&void 0!==d&&d,O=null!==(p=null===(h=x.loomItems)||void 0===h?void 0:h.keepDepth)&&void 0!==p?p:5,T=(0,Ee.useCallback)((e,n)=>{const t=uh.getState(),i=e.split(".");if("sovereignHand"===i[0])uh.setState({sovereignHand:lh(lh({},t.sovereignHand),{},{[i[1]]:n})});else if("contextFilters"===i[0]){var r;const e=i[1],a=i[2];uh.setState({contextFilters:lh(lh({},t.contextFilters),{},{[e]:lh(lh({},(null===(r=t.contextFilters)||void 0===r?void 0:r[e])||{}),{},{[a]:n})})})}Ye()},[]),D=C||E||L,z=(0,Ee.useCallback)(e=>{g.setChimeraMode(e),Ye()},[g]),I=(0,Ee.useCallback)(e=>{g.setCouncilMode(e),Ye()},[g]),A=y||k;return(0,Le.jsxs)("div",{className:"lumiverse-vp-settings-panel",children:[(0,Le.jsxs)(kh,{Icon:lu,title:"Lumia Modes",status:A,defaultOpen:!0,children:[(0,Le.jsx)("p",{className:"lumiverse-vp-settings-desc",children:"Configure special Lumia modes for unique character setups. These modes are mutually exclusive."}),(0,Le.jsxs)("div",{className:"lumiverse-vp-mode-option",children:[(0,Le.jsx)(xh,{id:"chimera-mode-toggle",checked:y,onChange:z,label:"Chimera Mode",hint:"Fuse multiple physical definitions into one hybrid form"}),(0,Le.jsx)($n,{isOpen:y,className:"lumiverse-vp-mode-details",duration:150,children:(0,Le.jsx)(wh,{items:["Select multiple definitions in the Definition modal","All selected forms will be fused into one Chimera","Currently ".concat(w," definition").concat(1!==w?"s":""," selected")]})})]}),(0,Le.jsxs)("div",{className:"lumiverse-vp-mode-option",children:[(0,Le.jsx)(xh,{id:"council-mode-toggle",checked:k,onChange:I,label:"Council Mode",hint:"Multiple independent Lumias that collaborate"}),(0,Le.jsxs)($n,{isOpen:k,className:"lumiverse-vp-mode-details",duration:150,children:[(0,Le.jsx)(wh,{items:["Each council member has independent traits","Members can converse and collaborate","Currently ".concat(j," council member").concat(1!==j?"s":"")]}),(0,Le.jsx)("p",{className:"lumiverse-vp-mode-note",children:"Configure council members in the Council tab."})]})]})]}),(0,Le.jsxs)(kh,{Icon:oh,title:"Sovereign Hand",status:S,defaultOpen:!0,children:[(0,Le.jsx)("p",{className:"lumiverse-vp-settings-desc",children:"Enable Sovereign Hand integration to use advanced prompt manipulation features."}),(0,Le.jsx)(xh,{id:"sovereign-hand-toggle",checked:S,onChange:e=>T("sovereignHand.enabled",e),label:"Use Sovereign Hand Features",hint:"Enables Sovereign Hand macros for advanced prompt control"}),(0,Le.jsx)(xh,{id:"sovereign-hand-exclude-toggle",checked:null===(v=b.excludeLastMessage)||void 0===v||v,onChange:e=>T("sovereignHand.excludeLastMessage",e),label:"Exclude Last Message from Context",hint:"When enabled, removes the last user message from the outgoing context",disabled:!S}),(0,Le.jsx)(xh,{id:"sovereign-hand-include-in-prompt-toggle",checked:null===(f=b.includeMessageInPrompt)||void 0===f||f,onChange:e=>T("sovereignHand.includeMessageInPrompt",e),label:"Include Message in Master Prompt",hint:"When enabled, includes the user message in the {{loomSovHand}} macro output",disabled:!S}),(0,Le.jsx)(wh,{muted:!S,items:[(0,Le.jsxs)(Le.Fragment,{children:[(0,Le.jsx)("code",{children:"{{loomLastUserMessage}}"})," returns the last user message"]}),(0,Le.jsxs)(Le.Fragment,{children:[(0,Le.jsx)("code",{children:"{{loomLastCharMessage}}"})," returns the last character message"]}),(0,Le.jsxs)(Le.Fragment,{children:[(0,Le.jsx)("code",{children:"{{lastMessageName}}"})," returns the name of whoever sent the last message"]}),(0,Le.jsxs)(Le.Fragment,{children:[(0,Le.jsx)("code",{children:"{{loomContinuePrompt}}"})," adds continuation instructions when character spoke last"]})]})]}),(0,Le.jsxs)(kh,{Icon:zp,title:"Context Filters",status:D,children:[(0,Le.jsx)("p",{className:"lumiverse-vp-settings-desc",children:"Filter out specific content from the chat context before sending to the AI."}),(0,Le.jsx)(jh,{id:"filter-html",label:"Strip HTML Tags",hint:"Removes formatting tags: <div>, <span>, <b>, <i>, etc.",enabled:C,onToggle:e=>T("contextFilters.htmlTags.enabled",e)}),(0,Le.jsx)($n,{isOpen:C,className:"lumiverse-vp-filter-sub",duration:200,children:(0,Le.jsx)(jh,{id:"filter-fonts",label:"Also Strip Fonts",hint:"Remove <font> tags (used by some presets)",enabled:N,onToggle:e=>T("contextFilters.htmlTags.stripFonts",e),depthValue:P,onDepthChange:e=>T("contextFilters.htmlTags.fontKeepDepth",e),depthLabel:"Keep fonts in last N messages",depthHint:"Font tags in older messages will be stripped"})}),(0,Le.jsx)(jh,{id:"filter-details",label:"Filter Details Blocks",hint:"Removes <details> blocks from older messages",enabled:E,onToggle:e=>T("contextFilters.detailsBlocks.enabled",e),depthValue:M,onDepthChange:e=>T("contextFilters.detailsBlocks.keepDepth",e),depthHint:"Messages beyond this depth will have <details> removed"}),(0,Le.jsx)(jh,{id:"filter-loom",label:"Filter Loom Tags",hint:"Removes Lucid Loom-related tags from older messages",enabled:L,onToggle:e=>T("contextFilters.loomItems.enabled",e),depthValue:O,onDepthChange:e=>T("contextFilters.loomItems.keepDepth",e),depthHint:"Loom tags in older messages will be stripped"})]})]})};function Ch(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,i)}return t}function Nh(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Ch(Object(t),!0).forEach(function(n){Ph(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Ch(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Ph(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,n||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const Eh=Ge,Mh=[],Lh=()=>Eh.getState().councilMode||!1,Oh=()=>Eh.getState().councilMembers||Mh;function Th(e,n){return e?e.lumiaItems&&e.lumiaItems.length>0?e.lumiaItems.find(e=>e.lumiaName===n||e.lumiaDefName===n):e.items?e.items.find(e=>e.lumiaDefName===n):null:null}function Dh(e,n,t){const i=(Array.isArray(e)?e.reduce((e,n)=>Nh(Nh({},e),{},{[n.name||n.packName]:n}),{}):e)[n];if(!i)return t;const r=Th(i,t);return(null==r?void 0:r.lumiaName)||(null==r?void 0:r.lumiaDefName)||t}function zh(e){var n,t;let{member:i,packs:r,onUpdate:a,onRemove:o}=e;const[s,l]=(0,Ee.useState)(!1),[c,u]=(0,Ee.useState)(!1),[d,m]=(0,Ee.useState)(i.role||""),p=Dh(r,i.packName,i.itemName),h=function(e,n,t){const i=(Array.isArray(e)?e.reduce((e,n)=>Nh(Nh({},e),{},{[n.name||n.packName]:n}),{}):e)[n];if(!i)return null;const r=Th(i,t);return(null==r?void 0:r.avatarUrl)||(null==r?void 0:r.lumia_img)||null}(r,i.packName,i.itemName),v=()=>{a(i.id,{role:d}),u(!1)},f=(null===(n=i.behaviors)||void 0===n?void 0:n.length)||0,g=(null===(t=i.personalities)||void 0===t?void 0:t.length)||0;return(0,Le.jsxs)("div",{className:"lumiverse-council-member",children:[(0,Le.jsxs)("div",{className:"lumiverse-council-member-header",onClick:()=>l(!s),children:[(0,Le.jsx)("div",{className:"lumiverse-council-member-avatar",children:h?(0,Le.jsx)("img",{src:h,alt:p}):(0,Le.jsx)(Jc,{size:20,strokeWidth:1.5})}),(0,Le.jsxs)("div",{className:"lumiverse-council-member-info",children:[(0,Le.jsx)("span",{className:"lumiverse-council-member-name",children:p}),i.role&&!c&&(0,Le.jsx)("span",{className:"lumiverse-council-member-role",children:i.role}),(0,Le.jsxs)("div",{className:"lumiverse-council-member-stats",children:[(0,Le.jsxs)("span",{className:"lumiverse-council-stat",children:[(0,Le.jsx)(Vd,{size:12})," ",f]}),(0,Le.jsxs)("span",{className:"lumiverse-council-stat",children:[(0,Le.jsx)(Wd,{size:12})," ",g]})]})]}),(0,Le.jsxs)("div",{className:"lumiverse-council-member-actions",children:[(0,Le.jsx)("button",{className:"lumiverse-council-btn",onClick:e=>{e.stopPropagation(),u(!0),l(!0)},title:"Edit role",type:"button",children:(0,Le.jsx)(En,{size:14,strokeWidth:1.5})}),(0,Le.jsx)("button",{className:"lumiverse-council-btn lumiverse-council-btn--danger",onClick:e=>{e.stopPropagation(),o(i.id)},title:"Remove from council",type:"button",children:(0,Le.jsx)(Mn,{size:14,strokeWidth:1.5})}),(0,Le.jsx)("span",{className:yn("lumiverse-council-expand",s&&"lumiverse-council-expand--open"),children:(0,Le.jsx)(tu,{size:16,strokeWidth:2})})]})]}),s&&(0,Le.jsxs)("div",{className:"lumiverse-council-member-body",children:[c?(0,Le.jsxs)("div",{className:"lumiverse-council-role-edit",children:[(0,Le.jsx)("label",{children:"Role/Title:"}),(0,Le.jsxs)("div",{className:"lumiverse-council-role-input-row",children:[(0,Le.jsx)("input",{type:"text",className:"lumiverse-council-input",placeholder:"e.g., Leader, Advisor, Wildcard...",value:d,onChange:e=>m(e.target.value),onKeyDown:e=>{"Enter"===e.key&&v(),"Escape"===e.key&&(m(i.role||""),u(!1))},autoFocus:!0}),(0,Le.jsx)("button",{className:"lumiverse-council-btn lumiverse-council-btn--primary",onClick:v,type:"button",children:(0,Le.jsx)(iu,{size:14,strokeWidth:2})}),(0,Le.jsx)("button",{className:"lumiverse-council-btn",onClick:()=>{m(i.role||""),u(!1)},type:"button",children:(0,Le.jsx)(ru,{size:14,strokeWidth:2})})]})]}):(0,Le.jsxs)("div",{className:"lumiverse-council-role-display",children:[(0,Le.jsx)("span",{className:"lumiverse-council-role-label",children:"Role:"}),(0,Le.jsx)("span",{className:"lumiverse-council-role-value",children:i.role||(0,Le.jsx)("em",{children:"No role set"})})]}),(0,Le.jsxs)("div",{className:"lumiverse-council-traits-section",children:[(0,Le.jsxs)("div",{className:"lumiverse-council-traits-group",children:[(0,Le.jsxs)("span",{className:"lumiverse-council-traits-label",children:[(0,Le.jsx)(Vd,{size:14,strokeWidth:1.5})," Behaviors:"]}),f>0?(0,Le.jsx)("span",{className:"lumiverse-council-traits-list",children:i.behaviors.map(e=>Dh(r,e.packName,e.itemName)).join(", ")}):(0,Le.jsx)("span",{className:"lumiverse-council-traits-empty",children:"None selected"})]}),(0,Le.jsxs)("div",{className:"lumiverse-council-traits-group",children:[(0,Le.jsxs)("span",{className:"lumiverse-council-traits-label",children:[(0,Le.jsx)(Wd,{size:14,strokeWidth:1.5})," Personalities:"]}),g>0?(0,Le.jsx)("span",{className:"lumiverse-council-traits-list",children:i.personalities.map(e=>Dh(r,e.packName,e.itemName)).join(", ")}):(0,Le.jsx)("span",{className:"lumiverse-council-traits-empty",children:"None selected"})]})]}),(0,Le.jsx)("p",{className:"lumiverse-council-help-text",children:"Each member's inherent traits are auto-attached when added. Additional trait configuration coming soon."})]})]})}function Ih(e){let{packs:n,existingMembers:t,onAdd:i,onClose:r}=e;const[a,o]=(0,Ee.useState)(""),s=(0,Ee.useMemo)(()=>{const e=new Set(t.map(e=>"".concat(e.packName,":").concat(e.itemName))),i=[];if((Array.isArray(n)?n:Object.values(n||{})).forEach(n=>{const t=n.name||n.packName;n.lumiaItems&&n.lumiaItems.length>0?n.lumiaItems.forEach(n=>{const r=n.lumiaName||n.lumiaDefName,a=n.lumiaDefinition||n.lumiaDef;if(!r||!a)return;const o="".concat(t,":").concat(r);e.has(o)||i.push({packName:t,itemName:r,displayName:r,image:n.avatarUrl||n.lumia_img})}):n.items&&n.items.forEach(n=>{if(!n.lumiaDefName||!n.lumiaDef)return;const r="".concat(t,":").concat(n.lumiaDefName);e.has(r)||i.push({packName:t,itemName:n.lumiaDefName,displayName:n.lumiaDefName,image:n.lumia_img})})}),a.trim()){const e=a.toLowerCase();return i.filter(n=>n.displayName.toLowerCase().includes(e)||n.packName.toLowerCase().includes(e))}return i},[n,t,a]);return(0,Le.jsxs)("div",{className:"lumiverse-council-add-dropdown",children:[(0,Le.jsxs)("div",{className:"lumiverse-council-add-header",children:[(0,Le.jsx)("input",{type:"text",className:"lumiverse-council-search",placeholder:"Search Lumias...",value:a,onChange:e=>o(e.target.value),autoFocus:!0}),(0,Le.jsx)("button",{className:"lumiverse-council-btn",onClick:r,title:"Close",type:"button",children:(0,Le.jsx)(ru,{size:16,strokeWidth:2})})]}),(0,Le.jsx)("div",{className:"lumiverse-council-add-list",children:0===s.length?(0,Le.jsx)("div",{className:"lumiverse-council-add-empty",children:a?"No matching Lumias found":"All Lumias are already in the council"}):s.map((e,n)=>(0,Le.jsxs)("button",{className:"lumiverse-council-add-item",onClick:()=>{i({packName:e.packName,itemName:e.itemName}),r()},type:"button",children:[(0,Le.jsx)("div",{className:"lumiverse-council-add-item-avatar",children:e.image?(0,Le.jsx)("img",{src:e.image,alt:e.displayName}):(0,Le.jsx)(Jc,{size:16})}),(0,Le.jsxs)("div",{className:"lumiverse-council-add-item-info",children:[(0,Le.jsx)("span",{className:"lumiverse-council-add-item-name",children:e.displayName}),(0,Le.jsx)("span",{className:"lumiverse-council-add-item-pack",children:e.packName})]})]},"".concat(e.packName,":").concat(e.itemName)))})]})}function Ah(){return(0,Le.jsxs)("div",{className:"lumiverse-council-empty",children:[(0,Le.jsx)("span",{className:"lumiverse-council-empty-icon",children:(0,Le.jsx)(Jc,{size:32,strokeWidth:1.5})}),(0,Le.jsx)("h4",{children:"No Council Members"}),(0,Le.jsx)("p",{children:"Add Lumias to your council to create a collaborative group of independent characters."})]})}const Rh=function(){const e=Je(),{allPacks:n}=fn(),[t,i]=(0,Ee.useState)(!1),r=(0,Ee.useSyncExternalStore)(Eh.subscribe,Lh,Lh),a=(0,Ee.useSyncExternalStore)(Eh.subscribe,Oh,Oh),o=(0,Ee.useCallback)(n=>{e.addCouncilMember(n),Ye()},[e]),s=(0,Ee.useCallback)((n,t)=>{e.updateCouncilMember(n,t),Ye()},[e]),l=(0,Ee.useCallback)(n=>{e.removeCouncilMember(n),Ye()},[e]),c=(0,Ee.useCallback)(n=>{e.setCouncilMode(n),Ye()},[e]),u=(0,Ee.useMemo)(()=>Array.isArray(n)?n.reduce((e,n)=>Nh(Nh({},e),{},{[n.name||n.packName]:n}),{}):n||{},[n]);return(0,Le.jsxs)("div",{className:"lumiverse-council-manager",children:[(0,Le.jsxs)("div",{className:"lumiverse-council-header",children:[(0,Le.jsxs)("h3",{className:"lumiverse-council-title",children:[(0,Le.jsx)(Jc,{size:18,strokeWidth:1.5}),"Council of Lumiae"]}),(0,Le.jsxs)("label",{className:"lumiverse-council-mode-toggle",children:[(0,Le.jsx)("input",{type:"checkbox",checked:r,onChange:e=>c(e.target.checked)}),(0,Le.jsx)("span",{className:yn("lumiverse-council-mode-switch",r&&"lumiverse-council-mode-switch--on"),children:(0,Le.jsx)("span",{className:"lumiverse-council-mode-thumb"})}),(0,Le.jsx)("span",{className:"lumiverse-council-mode-label",children:r?"Active":"Inactive"})]})]}),(0,Le.jsx)("p",{className:"lumiverse-council-desc",children:"Create a council of independent Lumias that collaborate, each with their own identity, behaviors, and personalities."}),(0,Le.jsx)("div",{className:"lumiverse-council-add-section",children:t?(0,Le.jsx)(Ih,{packs:u,existingMembers:a,onAdd:o,onClose:()=>i(!1)}):(0,Le.jsxs)("button",{className:"lumiverse-council-add-btn",onClick:()=>i(!0),disabled:!r,title:r?"Add a council member":"Enable Council Mode first",type:"button",children:[(0,Le.jsx)(eu,{size:16,strokeWidth:2}),(0,Le.jsx)("span",{children:"Add Council Member"})]})}),(0,Le.jsx)("div",{className:"lumiverse-council-members",children:0===a.length?(0,Le.jsx)(Ah,{}):a.map(e=>(0,Le.jsx)(zh,{member:e,packs:u,onUpdate:s,onRemove:l},e.id))}),a.length>0&&(0,Le.jsx)("div",{className:"lumiverse-council-help",children:(0,Le.jsxs)("p",{children:["Council members will each appear with their definition in the ",(0,Le.jsx)("code",{children:"{{lumiaDef}}"})," macro output. Their behaviors and personalities will be grouped per member."]})})]})},Bh=Nn("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),_h=Nn("cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]),Uh=Nn("cpu",[["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M17 20v2",key:"1rnc9c"}],["path",{d:"M17 2v2",key:"11trls"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M2 17h2",key:"7oei6x"}],["path",{d:"M2 7h2",key:"asdhe0"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"M20 17h2",key:"1fpfkl"}],["path",{d:"M20 7h2",key:"1o8tra"}],["path",{d:"M7 20v2",key:"4gnj0m"}],["path",{d:"M7 2v2",key:"1i4yhu"}],["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"8",y:"8",width:"8",height:"8",rx:"1",key:"z9xiuo"}]]),Fh=Nn("refresh-ccw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]),Vh=Nn("scissors",[["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M8.12 8.12 12 12",key:"1alkpv"}],["path",{d:"M20 4 8.12 15.88",key:"xgtan2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M14.8 14.8 20 20",key:"ptml3r"}]]),Wh=Nn("play",[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]]),Hh=Nn("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);function $h(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,i)}return t}function qh(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?$h(Object(t),!0).forEach(function(n){Yh(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):$h(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Yh(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,n||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const Kh=Ge,Gh={},Qh={enabled:!1,keepCount:50},Xh=()=>Kh.getState().summarization||Gh,Zh=()=>Kh.getState().messageTruncation||Qh,Jh=()=>Kh.getState().chatChangeCounter||0,ev="loom_summary",nv={openai:{name:"OpenAI",placeholder:"gpt-4o-mini"},anthropic:{name:"Anthropic",placeholder:"claude-3-haiku-20240307"},google:{name:"Google AI",placeholder:"gemini-1.5-flash"},openrouter:{name:"OpenRouter",placeholder:"openai/gpt-4o-mini"},custom:{name:"Custom",placeholder:"your-model-name"}};function tv(e){let{Icon:n,title:t,children:i,defaultOpen:r=!1,status:a}=e;const[o,s]=(0,Ee.useState)(r);return(0,Le.jsxs)("div",{className:yn("lumiverse-vp-collapsible",o&&"lumiverse-vp-collapsible--open"),children:[(0,Le.jsxs)("button",{className:"lumiverse-vp-collapsible-header",onClick:()=>s(!o),type:"button",children:[(0,Le.jsx)("span",{className:yn("lumiverse-vp-collapsible-chevron",o&&"lumiverse-vp-collapsible-chevron--open"),children:(0,Le.jsx)(tu,{size:14,strokeWidth:2})}),(0,Le.jsx)("span",{className:"lumiverse-vp-collapsible-icon",children:(0,Le.jsx)(n,{size:16,strokeWidth:1.5})}),(0,Le.jsx)("span",{className:"lumiverse-vp-collapsible-title",children:t}),void 0!==a&&(0,Le.jsx)("span",{className:yn("lumiverse-vp-collapsible-status",a&&"lumiverse-vp-collapsible-status--active"),children:a?"Active":"Off"})]}),(0,Le.jsx)($n,{isOpen:o,className:"lumiverse-vp-collapsible-content",duration:200,children:(0,Le.jsx)("div",{className:"lumiverse-vp-collapsible-inner",children:i})})]})}function iv(e){let{id:n,checked:t,onChange:i,label:r,hint:a}=e;return(0,Le.jsxs)("div",{className:"lumiverse-vp-toggle-row",children:[(0,Le.jsxs)("label",{className:"lumiverse-vp-toggle-label",htmlFor:n,children:[(0,Le.jsx)("span",{className:"lumiverse-vp-toggle-text",children:r}),a&&(0,Le.jsx)("span",{className:"lumiverse-vp-toggle-hint",children:a})]}),(0,Le.jsxs)("div",{className:"lumiverse-vp-toggle-switch-wrapper",children:[(0,Le.jsx)("input",{type:"checkbox",id:n,className:"lumiverse-vp-toggle-input",checked:t,onChange:e=>i(e.target.checked)}),(0,Le.jsx)("label",{htmlFor:n,className:"lumiverse-vp-toggle-switch-label",children:(0,Le.jsx)("div",{className:yn("lumiverse-vp-toggle-track",t&&"lumiverse-vp-toggle-track--on"),children:(0,Le.jsx)("div",{className:"lumiverse-vp-toggle-thumb"})})})]})]})}function rv(e){let{name:n,value:t,checked:i,onChange:r,label:a}=e;return(0,Le.jsxs)("label",{className:yn("lumiverse-vp-radio-option",i&&"lumiverse-vp-radio-option--selected"),children:[(0,Le.jsx)("input",{type:"radio",name:n,value:t,checked:i,onChange:()=>r(t)}),(0,Le.jsx)("span",{className:"lumiverse-vp-radio-option-label",children:a})]})}function av(e){let{id:n,label:t,hint:i,value:r,onChange:a,min:o,max:s,step:l=1}=e;return(0,Le.jsxs)("div",{className:"lumiverse-vp-field",children:[(0,Le.jsx)("label",{className:"lumiverse-vp-field-label",htmlFor:n,children:t}),(0,Le.jsx)("input",{type:"number",id:n,className:"lumiverse-vp-field-input lumiverse-vp-field-input--small",value:r,onChange:e=>a(parseFloat(e.target.value)||0),min:o,max:s,step:l}),i&&(0,Le.jsx)("span",{className:"lumiverse-vp-field-hint",children:i})]})}function ov(e){let{id:n,label:t,hint:i,value:r,onChange:a,placeholder:o,type:s="text"}=e;return(0,Le.jsxs)("div",{className:"lumiverse-vp-field",children:[(0,Le.jsx)("label",{className:"lumiverse-vp-field-label",htmlFor:n,children:t}),(0,Le.jsx)("input",{type:s,id:n,className:"lumiverse-vp-field-input",value:r,onChange:e=>a(e.target.value),placeholder:o}),i&&(0,Le.jsx)("span",{className:"lumiverse-vp-field-hint",children:i})]})}function sv(e){let{id:n,label:t,hint:i,value:r,onChange:a,options:o}=e;return(0,Le.jsxs)("div",{className:"lumiverse-vp-field",children:[(0,Le.jsx)("label",{className:"lumiverse-vp-field-label",htmlFor:n,children:t}),(0,Le.jsx)("select",{id:n,className:"lumiverse-vp-field-select",value:r,onChange:e=>a(e.target.value),children:o.map(e=>(0,Le.jsx)("option",{value:e.value,children:e.label},e.value))}),i&&(0,Le.jsx)("span",{className:"lumiverse-vp-field-hint",children:i})]})}function lv(e){let{hasContent:n,hasChat:t}=e;return t?n?(0,Le.jsxs)("div",{className:"lumiverse-vp-summary-status lumiverse-vp-summary-status--exists",children:[(0,Le.jsx)(iu,{size:16,strokeWidth:2}),(0,Le.jsx)("span",{children:"Summary exists for this chat"})]}):(0,Le.jsxs)("div",{className:"lumiverse-vp-summary-status lumiverse-vp-summary-status--empty",children:[(0,Le.jsx)(Bh,{size:16,strokeWidth:2}),(0,Le.jsx)("span",{children:"No summary yet"})]}):(0,Le.jsxs)("div",{className:"lumiverse-vp-summary-status lumiverse-vp-summary-status--no-chat",children:[(0,Le.jsx)(Bh,{size:16,strokeWidth:2}),(0,Le.jsx)("span",{children:"No active chat"})]})}function cv(e){let{Icon:n,label:t,onClick:i,disabled:r,variant:a="secondary",loading:o=!1,iconOnly:s=!1}=e;return(0,Le.jsxs)(Zc.button,{className:yn("lumiverse-vp-action-btn","lumiverse-vp-action-btn--".concat(a),r&&"lumiverse-vp-action-btn--disabled",s&&"lumiverse-vp-action-btn--icon-only"),onClick:i,disabled:r||o,whileHover:r?{}:{scale:1.05},whileTap:r?{}:{scale:.95},type:"button",title:t,children:[o?(0,Le.jsx)("span",{className:"lumiverse-vp-action-btn-spinner"}):(0,Le.jsx)(n,{size:s?16:14,strokeWidth:2}),!s&&(0,Le.jsx)("span",{children:t})]})}function uv(){var e,n,t,i;const r=(0,Ee.useSyncExternalStore)(Kh.subscribe,Xh,Xh),a=(0,Ee.useSyncExternalStore)(Kh.subscribe,Zh,Zh),o=r.mode||"disabled",s=r.apiSource||"main",l=r.autoInterval||10,c=r.autoMessageContext||10,u=r.manualMessageContext||10,d=r.secondary||{},m=(0,Ee.useCallback)(e=>{const n=Kh.getState().summarization||{};Kh.setState({summarization:qh(qh({},n),e)}),Ye()},[]),p=(0,Ee.useCallback)(e=>{const n=Kh.getState().summarization||{},t=n.secondary||{};Kh.setState({summarization:qh(qh({},n),{},{secondary:qh(qh({},t),e)})}),Ye()},[]),h=(0,Ee.useCallback)(e=>{const n=Kh.getState().messageTruncation||{};Kh.setState({messageTruncation:qh(qh({},n),e)}),Ye()},[]),v=Object.entries(nv).map(e=>{let[n,t]=e;return{value:n,label:t.name}});return(0,Le.jsxs)("div",{className:"lumiverse-vp-summary-config",children:[(0,Le.jsxs)(tv,{Icon:Md,title:"Summarization Mode",status:"disabled"!==o,defaultOpen:!0,children:[(0,Le.jsxs)("div",{className:"lumiverse-vp-radio-group",children:[(0,Le.jsx)(rv,{name:"sum-mode",value:"disabled",checked:"disabled"===o,onChange:e=>m({mode:e}),label:"Disabled"}),(0,Le.jsx)(rv,{name:"sum-mode",value:"auto",checked:"auto"===o,onChange:e=>m({mode:e}),label:"Automatic"}),(0,Le.jsx)(rv,{name:"sum-mode",value:"manual",checked:"manual"===o,onChange:e=>m({mode:e}),label:"Manual"})]}),(0,Le.jsxs)("p",{className:"lumiverse-vp-settings-desc",children:["disabled"===o&&"Summarization is turned off.","auto"===o&&"Summaries are generated automatically at set intervals.","manual"===o&&"Use /loom-summarize command to generate summaries."]})]}),(0,Le.jsx)($n,{isOpen:"auto"===o,duration:200,children:(0,Le.jsx)(tv,{Icon:lp,title:"Auto Settings",defaultOpen:!0,children:(0,Le.jsxs)("div",{className:"lumiverse-vp-field-row",children:[(0,Le.jsx)(av,{id:"sum-interval",label:"Interval",hint:"Every N messages",value:l,onChange:e=>m({autoInterval:e}),min:1}),(0,Le.jsx)(av,{id:"sum-auto-context",label:"Context",hint:"Messages to include",value:c,onChange:e=>m({autoMessageContext:e}),min:1,max:100})]})})}),(0,Le.jsx)($n,{isOpen:"manual"===o||"auto"===o,duration:200,children:(0,Le.jsx)(tv,{Icon:dm,title:"Manual Context",defaultOpen:"manual"===o,children:(0,Le.jsx)(av,{id:"sum-manual-context",label:"Messages to include",hint:"When using /loom-summarize command",value:u,onChange:e=>m({manualMessageContext:e}),min:1,max:100})})}),(0,Le.jsx)($n,{isOpen:"disabled"!==o,duration:200,children:(0,Le.jsx)(tv,{Icon:_h,title:"API Source",defaultOpen:!1,children:(0,Le.jsxs)("div",{className:"lumiverse-vp-radio-group lumiverse-vp-radio-group--wide",children:[(0,Le.jsx)(rv,{name:"sum-source",value:"main",checked:"main"===s,onChange:e=>m({apiSource:e}),label:"Main API"}),(0,Le.jsx)(rv,{name:"sum-source",value:"secondary",checked:"secondary"===s,onChange:e=>m({apiSource:e}),label:"Secondary LLM"})]})})}),(0,Le.jsx)($n,{isOpen:"disabled"!==o&&"secondary"===s,duration:200,children:(0,Le.jsxs)(tv,{Icon:Uh,title:"Secondary LLM",defaultOpen:!0,children:[(0,Le.jsx)(sv,{id:"sum-provider",label:"Provider",value:d.provider||"openai",onChange:e=>p({provider:e}),options:v,hint:"custom"!==d.provider?"Uses API key from SillyTavern settings":void 0}),(0,Le.jsx)(ov,{id:"sum-model",label:"Model",value:d.model||"",onChange:e=>p({model:e}),placeholder:null===(e=nv[d.provider||"openai"])||void 0===e?void 0:e.placeholder}),(0,Le.jsxs)($n,{isOpen:"custom"===d.provider,duration:200,children:[(0,Le.jsx)(ov,{id:"sum-endpoint",label:"Endpoint URL",value:d.endpoint||"",onChange:e=>p({endpoint:e}),placeholder:"https://your-api.com/v1/chat/completions"}),(0,Le.jsx)(ov,{id:"sum-apikey",label:"API Key",type:"password",value:d.apiKey||"",onChange:e=>p({apiKey:e}),placeholder:"Your API key"})]}),(0,Le.jsxs)("div",{className:"lumiverse-vp-field-row lumiverse-vp-field-row--3",children:[(0,Le.jsx)(av,{id:"sum-temp",label:"Temp",value:null!==(n=d.temperature)&&void 0!==n?n:.7,onChange:e=>p({temperature:e}),min:0,max:2,step:.1}),(0,Le.jsx)(av,{id:"sum-topp",label:"Top-P",value:null!==(t=d.topP)&&void 0!==t?t:1,onChange:e=>p({topP:e}),min:0,max:1,step:.05}),(0,Le.jsx)(av,{id:"sum-maxtokens",label:"Max Tokens",value:d.maxTokens||8192,onChange:e=>p({maxTokens:e}),min:100,max:128e3})]})]})}),(0,Le.jsx)($n,{isOpen:"disabled"!==o&&("main"===s||"anthropic"===d.provider),duration:200,children:(0,Le.jsxs)(tv,{Icon:Fh,title:"Claude Cache",defaultOpen:!1,children:[(0,Le.jsx)("p",{className:"lumiverse-vp-settings-desc",children:"If Claude seems to ignore changes to your Lumia definitions, clearing the cache will force fresh responses on the next summarization."}),(0,Le.jsx)(cv,{Icon:Fh,label:"Clear Claude Cache",onClick:()=>{"undefined"!=typeof LumiverseBridge&&LumiverseBridge.clearClaudeCache?(LumiverseBridge.clearClaudeCache(),"undefined"!=typeof toastr&&toastr.success("Claude cache cleared! Next request will use fresh definitions.")):(console.warn("[SummaryEditor] clearClaudeCache not available"),"undefined"!=typeof toastr&&toastr.error("Cache clear function not available"))},variant:"secondary"})]})}),(0,Le.jsxs)(tv,{Icon:Vh,title:"Message Limit",status:a.enabled,children:[(0,Le.jsx)(iv,{id:"trunc-toggle",checked:a.enabled,onChange:e=>h({enabled:e}),label:"Limit Context Messages",hint:"Only send the last N messages to the AI"}),(0,Le.jsxs)($n,{isOpen:a.enabled,duration:200,children:[(0,Le.jsx)(av,{id:"trunc-count",label:"Messages to keep",hint:"Number of recent messages to include",value:null!==(i=a.keepCount)&&void 0!==i?i:50,onChange:e=>h({keepCount:e}),min:5,max:500}),(0,Le.jsxs)("div",{className:"lumiverse-vp-warning-box",children:[(0,Le.jsx)(Bh,{size:14,strokeWidth:2}),(0,Le.jsx)("span",{children:"Older messages will be excluded. Consider using summarization to preserve memories."})]})]})]})]})}function dv(){const[e,n]=(0,Ee.useState)(""),[t,i]=(0,Ee.useState)(""),[r,a]=(0,Ee.useState)(!1),[o,s]=(0,Ee.useState)(!1),[l,c]=(0,Ee.useState)(!1),u=(0,Ee.useRef)(null),d=(0,Ee.useSyncExternalStore)(Kh.subscribe,Jh,()=>0),m=e!==t,p=(e.trim().length,(0,Ee.useCallback)(()=>{try{if("undefined"!=typeof SillyTavern){const e=SillyTavern.getContext(),t=(null==e?void 0:e.chat)&&e.chat.length>0;if(a(t),t&&e.chatMetadata){const t=e.chatMetadata[ev]||"";n(t),i(t)}else n(""),i("")}else a(!0),n(""),i("")}catch(e){console.warn("[SummaryEditor] Error loading summary:",e)}},[]));(0,Ee.useEffect)(()=>{p()},[d]);const h=(0,Ee.useCallback)(e=>{n(e.target.value)},[]),v=(0,Ee.useCallback)(()=>{try{if("undefined"!=typeof SillyTavern){var n;const t=SillyTavern.getContext();t.chatMetadata||(t.chatMetadata={});const r=e.trim();r?t.chatMetadata[ev]=r:delete t.chatMetadata[ev],null===(n=t.saveMetadata)||void 0===n||n.call(t),"undefined"!=typeof LumiverseBridge&&LumiverseBridge.updateSummaryButtonState&&LumiverseBridge.updateSummaryButtonState(),i(r),s(!0),setTimeout(()=>s(!1),1500)}}catch(e){console.error("[SummaryEditor] Error saving summary:",e)}},[e]),f=(0,Ee.useCallback)(()=>{if(confirm("Are you sure you want to clear the summary?")){n("");try{if("undefined"!=typeof SillyTavern){const n=SillyTavern.getContext();var e;if(n.chatMetadata)delete n.chatMetadata[ev],null===(e=n.saveMetadata)||void 0===e||e.call(n),"undefined"!=typeof LumiverseBridge&&LumiverseBridge.updateSummaryButtonState&&LumiverseBridge.updateSummaryButtonState()}i("")}catch(e){console.error("[SummaryEditor] Error clearing summary:",e)}}},[]),g=(0,Ee.useCallback)(()=>{p()},[p]),b=(0,Ee.useCallback)(async()=>{if(r&&!l){c(!0);try{if(void 0===window.LumiverseBridge)return console.error("[SummaryEditor] LumiverseBridge not available"),void("undefined"!=typeof toastr&&toastr.error("Summary bridge not available. Try refreshing the page."));if("function"!=typeof window.LumiverseBridge.getCallbacks)return console.error("[SummaryEditor] getCallbacks is not a function"),void("undefined"!=typeof toastr&&toastr.error("Summary callbacks not configured."));const e=window.LumiverseBridge.getCallbacks();if(!e.generateSummary)return console.error("[SummaryEditor] generateSummary callback not registered"),void("undefined"!=typeof toastr&&toastr.error("Summary generation not configured."));console.log("[SummaryEditor] Calling generateSummary callback...");const t=await e.generateSummary();console.log("[SummaryEditor] generateSummary returned:",t?"success":"no result"),t?(n(t),i(t),"undefined"!=typeof toastr&&toastr.success("Summary generated successfully!")):"undefined"!=typeof toastr&&toastr.warning("No summary was generated. Check your settings.")}catch(e){console.error("[SummaryEditor] Error generating summary:",e),"undefined"!=typeof toastr&&toastr.error("Summary generation failed: ".concat(e.message||"Unknown error"))}finally{c(!1)}}},[r,l]);return(0,Le.jsxs)(tv,{Icon:dm,title:"Summary Text",defaultOpen:!0,children:[(0,Le.jsx)(lv,{hasContent:t.length>0,hasChat:r}),(0,Le.jsx)("div",{className:"lumiverse-vp-summary-textarea-wrapper",children:(0,Le.jsx)("textarea",{ref:u,className:"lumiverse-vp-summary-textarea",value:e,onChange:h,placeholder:"Write or paste your Loom summary here...\n\nUse the structured format:\n**Completed Objectives**\n- ...\n\n**Focused Objectives**\n- ...\n\n**Foreshadowing Beats**\n- ...\n\n**Character States**\n- ...\n\n**World State**\n- ...\n\n**Tone & Atmosphere**\n- ...\n\n**Threads to Weave**\n- ...",disabled:!r})}),(0,Le.jsxs)("div",{className:"lumiverse-vp-summary-actions",children:[(0,Le.jsx)(cv,{Icon:Wh,label:l?"Generating...":"Generate",onClick:b,disabled:!r,loading:l,variant:"primary",iconOnly:!0}),(0,Le.jsx)(cv,{Icon:cp,label:"Refresh",onClick:g,disabled:!r,iconOnly:!0}),(0,Le.jsx)(cv,{Icon:Mn,label:"Clear",onClick:f,disabled:!r||!t,variant:"danger",iconOnly:!0}),(0,Le.jsx)(cv,{Icon:o?iu:Hh,label:o?"Saved!":"Save",onClick:v,disabled:!r||!m,variant:"primary",iconOnly:!0})]}),(0,Le.jsx)(at,{children:m&&(0,Le.jsx)(Zc.div,{className:"lumiverse-vp-summary-unsaved",initial:{opacity:0,y:5},animate:{opacity:1,y:0},exit:{opacity:0,y:5},children:(0,Le.jsx)("span",{children:"You have unsaved changes"})})})]})}const mv=function(){return(0,Le.jsxs)("div",{className:"lumiverse-vp-summary-editor",children:[(0,Le.jsx)(dv,{}),(0,Le.jsx)(uv,{})]})},pv=Ge;const hv=function(){const[e,n]=(0,Ee.useState)(!1),t=(0,Ee.useSyncExternalStore)(pv.subscribe,()=>{var e;return null===(e=pv.getState().showLumiverseDrawer)||void 0===e||e},()=>{var e;return null===(e=pv.getState().showLumiverseDrawer)||void 0===e||e}),i=(0,Ee.useCallback)(()=>{n(e=>!e)},[]),r=(0,Ee.useCallback)(()=>{n(!1)},[]);return t?(0,Le.jsxs)(Le.Fragment,{children:[(0,Le.jsx)($m,{isVisible:e,onToggle:i,onClose:r,defaultTab:"profile",ProfileContent:sp,PresetsContent:gp,BrowserContent:Yp,OOCContent:rh,PromptContent:Sh,CouncilContent:Rh,SummaryContent:mv}),(0,Le.jsx)(wm,{}),(0,Le.jsx)(Tm,{})]}):null};var vv=t(72),fv=t.n(vv),gv=t(825),bv=t.n(gv),xv=t(659),yv=t.n(xv),kv=t(56),wv=t.n(kv),jv=t(159),Sv=t.n(jv),Cv=t(113),Nv=t.n(Cv),Pv=t(456),Ev={};Ev.styleTagTransform=Nv(),Ev.setAttributes=wv(),Ev.insert=yv().bind(null,"head"),Ev.domAPI=bv(),Ev.insertStyleElement=Sv();fv()(Pv.A,Ev);Pv.A&&Pv.A.locals&&Pv.A.locals;function Mv(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,i)}return t}function Lv(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Mv(Object(t),!0).forEach(function(n){Ov(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Mv(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Ov(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,n||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}"undefined"==typeof window||!window.React||window.React===Ee||console.warn('[LumiverseUI] Warning: Multiple React instances detected. This may cause "Invalid hook call" errors (Error #158). The extension bundles its own React to ensure compatibility.');const Tv=new Map;let Dv=null;function zv(e){const n=Tv.get(e);n&&(n.root.unmount(),n.element.remove(),Tv.delete(e),console.log("[LumiverseUI] Unmounted ".concat(e)))}const Iv={mountSettingsPanel:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"lumiverse-settings-root",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(n&&(Dv=n,Ge.syncFromExtension(n)),document.getElementById(e))return console.warn("[LumiverseUI] Settings panel already mounted"),()=>zv(e);const t=document.getElementById("extensions_settings");if(!t)return console.error("[LumiverseUI] Could not find #extensions_settings container"),null;const i=document.createElement("div");i.className="lumia-injector-settings";const r=document.createElement("div");r.className="inline-drawer";const a=document.createElement("div");a.className="inline-drawer-toggle inline-drawer-header",a.innerHTML='\n        <b>Lumiverse Helper</b>\n        <div class="inline-drawer-icon fa-solid fa-circle-chevron-down down"></div>\n    ';const o=document.createElement("div");o.className="inline-drawer-content";const s=document.createElement("div");s.id=e,o.appendChild(s),r.appendChild(a),r.appendChild(o),i.appendChild(r),t.appendChild(i);const l=Me.createRoot(s),c=Ee.Fragment;return l.render((0,Le.jsx)(c,{children:(0,Le.jsx)(Xe,{initialSettings:Dv,children:(0,Le.jsx)(Dm,{})})})),Tv.set(e,{root:l,element:i}),console.log("[LumiverseUI] Settings panel mounted with inline-drawer accordion"),()=>zv(e)},mountViewportPanel:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const n="lumiverse-viewport-root",t=document.getElementById(n);t&&(t.remove(),Tv.delete(n)),e&&Ge.syncFromExtension(e);const i=document.createElement("div");i.id=n,i.className="lumiverse-react-root lumiverse-viewport-container",i.style.position="fixed",i.style.top="0",i.style.right="0",i.style.bottom="0",i.style.left="auto",i.style.zIndex="9998",i.style.pointerEvents="none",document.body.appendChild(i);const r=Me.createRoot(i),a=Ee.Fragment;return r.render((0,Le.jsx)(a,{children:(0,Le.jsx)(Xe,{initialSettings:e,children:(0,Le.jsx)(hv,{})})})),Tv.set(n,{root:r,element:i}),console.log("[LumiverseUI] Viewport panel mounted with inline positioning"),()=>zv(n)},mountComponent:function(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=(arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)||"lumiverse-mount-".concat(Date.now());if(Tv.has(i))return console.warn("[LumiverseUI] Component ".concat(i," already mounted")),()=>zv(i);const r=document.createElement("div");r.id=i,r.className="lumiverse-react-root",n.appendChild(r);const a=Me.createRoot(r),o=Ee.Fragment;return a.render((0,Le.jsx)(o,{children:(0,Le.jsx)(Xe,{children:(0,Le.jsx)(e,Lv({},t))})})),Tv.set(i,{root:a,element:r}),()=>zv(i)},unmount:zv,unmountAll:function(){for(const[e]of Tv)zv(e)},syncSettings:function(e){if(e){var n,t,i,r,a,o;console.log("[LumiverseUI] syncSettings called with:",{packsCount:(null===(n=e.packs)||void 0===n?void 0:n.length)||0,customPacksCount:(null===(t=e.customPacks)||void 0===t?void 0:t.length)||0,firstPackItems:(null===(i=e.packs)||void 0===i||null===(i=i[0])||void 0===i||null===(i=i.items)||void 0===i?void 0:i.length)||0}),Ge.syncFromExtension(e);const s=Ge.getState();console.log("[LumiverseUI] After sync, store has:",{packsCount:(null===(r=s.packs)||void 0===r?void 0:r.length)||0,customPacksCount:(null===(a=s.customPacks)||void 0===a?void 0:a.length)||0,firstPackItems:(null===(o=s.packs)||void 0===o||null===(o=o[0])||void 0===o||null===(o=o.items)||void 0===o?void 0:o.length)||0})}else console.warn("[LumiverseUI] syncSettings called with null/undefined settings")},getState:function(){return Ge.exportForExtension()},subscribe:function(e){return Ge.subscribe(e)},getStore:function(){return Ge},getSTContext:function(){return"undefined"!=typeof SillyTavern?SillyTavern.getContext():(console.warn("[LumiverseUI] SillyTavern context not available"),null)}};console.log("[LumiverseUI] Bundle loaded, API available:",Object.keys(Iv)),"undefined"!=typeof window&&(window.LumiverseUI=Iv);function Av(e){if(!e)return e;let n=e;n=function(e){if(!e)return e;let n,t=e;do{n=t,t=t.replace(/<div[^>]*style\s*=\s*["'][^"']*display\s*:\s*none[^"']*["'][^>]*>(\s*```[\s\S]*?```\s*)<\/div>/gi,"$1"),t=t.replace(/<div(?:\s[^>]*)?>([\s\S]*?)<\/div>/gi,"")}while(t!==n);return t=t.replace(/<\/div>/gi,""),t}(n);const t=["span","b","i","u","em","strong","s","strike","sub","sup","mark","small","big"];for(const e of t){const t=new RegExp("<".concat(e,"(?:\\s[^>]*)?>"),"gi"),i=new RegExp("</".concat(e,">"),"gi");n=n.replace(t,""),n=n.replace(i,"")}return n}function Rv(e){if(!e)return e;let n=e;return n=n.replace(/<font(?:\s[^>]*)?>/gi,""),n=n.replace(/<\/font>/gi,""),n}function Bv(e){if(!e)return e;let n,t=e;do{n=t,t=t.replace(/<details(?:\s[^>]*)?>([\s\S]*?)<\/details>/gi,"")}while(t!==n);return t}function _v(e){if(!e)return e;const n=["loom_sum","loom_if","loom_else","loom_endif","lumia_ooc","lumiaooc","lumio_ooc","lumioooc","loom_state","loom_memory","loom_context","loom_inject","loom_var","loom_set","loom_get","loom_record","loomrecord","loom_ledger","loomledger"];let t=e;for(const e of n){const n=new RegExp("<".concat(e,"(?:\\s[^>]*)?>([\\s\\S]*?)</").concat(e,">"),"gi"),i=new RegExp("<".concat(e,"(?:\\s[^>]*)?\\/?>"),"gi");t=t.replace(n,""),t=t.replace(i,"")}return t}function Uv(e){if(!e||"string"!=typeof e)return e;let n=e.replace(/\n{3,}/g,"\n\n");return n=n.replace(/\n[ \t]*\n[ \t]*\n/g,"\n\n"),n}globalThis.lumiverseHelperGenInterceptor=async function(e,n,t,i){var r,a,o,s,l,c,u,d,m,p,h,v;console.log("[".concat(I.pW,"] Generation interceptor called with type: ").concat(i)),(0,I.Ll)();const f=(0,I.mt)(),g=(null===(r=f.sovereignHand)||void 0===r?void 0:r.enabled)||!1,b=f.contextFilters||{},x=f.messageTruncation||{};if(x.enabled&&x.keepCount>0){const n=x.keepCount;if(e.length>n){const t=e.length-n;e.splice(0,t),console.log("[".concat(I.pW,"] Message Truncation: Removed ").concat(t," older messages, keeping last ").concat(n))}}const y=!1!==(null===(a=f.sovereignHand)||void 0===a?void 0:a.excludeLastMessage);if(g){let n=-1;for(let t=e.length-1;t>=0;t--)if(e[t]&&e[t].is_user){n=t;break}if(-1!==n){const t=e[n],i=t.mes||t.content||"";(0,U.a4)(i),(0,U.l5)(!0),console.log("[".concat(I.pW,"] Sovereign Hand: Captured last user message at index ").concat(n)),y&&(e.splice(n,1),console.log("[".concat(I.pW,"] Sovereign Hand: Removed last user message from context array")))}else(0,U.a4)(""),(0,U.l5)(!1),console.log("[".concat(I.pW,"] Sovereign Hand: No user message found (continuation mode)"))}else(0,U.a4)(""),(0,U.l5)(!1);const k=null!==(o=null===(s=b.detailsBlocks)||void 0===s?void 0:s.keepDepth)&&void 0!==o?o:3,w=null!==(l=null===(c=b.loomItems)||void 0===c?void 0:c.keepDepth)&&void 0!==l?l:5,j=null!==(u=null===(d=b.htmlTags)||void 0===d?void 0:d.fontKeepDepth)&&void 0!==u?u:3,S=(null===(m=b.htmlTags)||void 0===m?void 0:m.enabled)||!1,C=(null===(p=b.htmlTags)||void 0===p?void 0:p.stripFonts)||!1,N=(null===(h=b.detailsBlocks)||void 0===h?void 0:h.enabled)||!1,P=(null===(v=b.loomItems)||void 0===v?void 0:v.enabled)||!1,E=S||C||N||P;for(let n=0;n<e.length;n++){const t=e.length-1-n,i=e=>{if(!e||"string"!=typeof e)return e;let n=e;return S&&(n=Av(n)),S&&C&&t>=j&&(n=Rv(n)),N&&t>=k&&(n=Bv(n)),P&&t>=w&&(n=_v(n)),n};e[n]&&"string"==typeof e[n].content&&(e[n].content=(0,U.US)(e[n].content),E&&(e[n].content=i(e[n].content)),e[n].content=Uv(e[n].content)),e[n]&&"string"==typeof e[n].mes&&(e[n].mes=(0,U.US)(e[n].mes),E&&(e[n].mes=i(e[n].mes)),e[n].mes=Uv(e[n].mes))}return{chat:e,contextSize:n,abort:t}},jQuery(async()=>{console.log("[".concat(I.pW,"] jQuery initialization starting...")),console.log("[".concat(I.pW,"] window.LumiverseUI available:"),!!window.LumiverseUI);const e=(0,i.cj)(),n=(0,i.G1)();e&&n||console.error("[".concat(I.pW,"] ST APIs not available - extension may not work correctly")),(0,I.M5)(),function(){const e=(0,i.zX)();e?((0,_.bP)(e),(0,U.MN)(e),e.registerMacro("lumiaMessageCount",{handler:()=>{const e=(0,i.SD)();return e&&e.chat?e.chat.length.toString():"0"},description:"Returns the current chat message count.",returns:"Number of messages as a string",returnType:"integer",exampleUsage:["{{lumiaMessageCount}}"]}),e.registerMacro("lumiaOOCTrigger",{handler:()=>(0,_.XN)(),description:"Returns OOC trigger countdown or activation message based on message count and interval setting.",returns:"Countdown text or 'OOC Commentary Time!' activation message",returnType:"string",exampleUsage:["{{lumiaOOCTrigger}}"]}),console.log("[".concat(I.pW,"] Macros registered successfully (Macros 2.0 format)"))):console.warn("[".concat(I.pW,"] MacrosParser not available - macros will not be registered"))}(),Ce(),(0,R.xx)(R.YR),(0,R.Zl)(je),(0,Ne.Go)(R.YR),(0,Pe.rq)("showSelectionModal",R.ry),(0,Pe.rq)("showLoomSelectionModal",R.mR),(0,Pe.rq)("showMiscFeaturesModal",R.GM),(0,Pe.rq)("showSummarizationModal",R.Cm),(0,Pe.rq)("showPromptSettingsModal",R.e2),(0,Pe.rq)("showLumiaEditorModal",Ne.un),(0,Pe.rq)("showLucidCardsModal",R.Dz),(0,Pe.rq)("fetchWorldBook",()=>{const e=jQuery("#lumia-url-input-react").val()||jQuery("#lumia-url-input").val();(0,A.wn)(e).then(()=>{(0,R.YR)(),(0,Pe.TC)()})}),(0,Pe.rq)("handleNewBook",(e,n)=>{(0,A.importPack)(e,n,!1),(0,R.YR)(),(0,Pe.TC)()}),(0,Pe.rq)("refreshUIDisplay",()=>{(0,R.YR)(),(0,Pe.TC)()}),(0,Pe.rq)("refreshOOCComments",function(){je(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])}),(0,Pe.rq)("generateSummary",async()=>await(0,B.Zq)(null,!0,!0)),console.log("[".concat(I.pW,"] About to initialize React UI..."));const t=document.getElementById("extensions_settings");if(console.log("[".concat(I.pW,"] extensions_settings container:"),t),t){await(0,Pe.A5)(t)?console.log("[".concat(I.pW,"] React UI initialized successfully")):console.error("[".concat(I.pW,"] React UI failed to initialize - check console for errors"))}(0,R.YR)(),jQuery("#lumia-fetch-btn").on("click",()=>{const e=jQuery("#lumia-url-input").val();(0,A.wn)(e).then(()=>{(0,R.YR)(),(0,Pe.TC)()})}),jQuery("#lumia-open-definitions-btn").on("click",()=>(0,R.ry)("definition")),jQuery("#lumia-open-behaviors-btn").on("click",()=>(0,R.ry)("behavior")),jQuery("#lumia-open-personalities-btn").on("click",()=>(0,R.ry)("personality")),jQuery("#lumia-open-misc-btn").on("click",()=>(0,R.GM)()),jQuery("#lumia-open-summarization-btn").on("click",()=>(0,R.Cm)()),jQuery("#lumia-open-prompt-settings-btn").on("click",()=>(0,R.e2)()),jQuery("#loom-open-style-btn").on("click",()=>(0,R.mR)("Narrative Style")),jQuery("#loom-open-utils-btn").on("click",()=>(0,R.mR)("Loom Utilities")),jQuery("#loom-open-retrofits-btn").on("click",()=>(0,R.mR)("Retrofits")),jQuery("#lumia-browse-lucid-btn").on("click",()=>(0,R.Dz)()),jQuery("#lumia-create-lumia-btn").on("click",()=>(0,Ne.un)()),jQuery("#lumia-upload-btn").on("click",()=>jQuery("#lumia-file-input").trigger("click")),jQuery("#lumia-file-input").on("change",e=>{const n=e.target.files[0];if(!n)return;const t=new FileReader;t.onload=e=>{try{const t=JSON.parse(e.target.result);(0,A.importPack)(t,n.name,!1),(0,R.YR)(),(0,Pe.TC)()}catch(e){console.error("Lumia Injector Error:",e),toastr.error("Failed to parse: "+e.message)}},t.readAsText(n),e.target.value=""}),e&&n&&(e.on(n.CHARACTER_MESSAGE_RENDERED,e=>{console.log("[".concat(I.pW,"] CHARACTER_MESSAGE_RENDERED event for mesId ").concat(e)),oe(!1),(0,U.SE)(),(0,B.tb)();const n=o('div[mesid="'.concat(e,'"] .mes_text'));if(n){var t;(0,U.vL)(n),function(e){const n=e.closest("div[mesid]");n&&ke(parseInt(n.getAttribute("mesid"),10))}(n);const r=(0,i.SD)(),a=null==r||null===(t=r.chat)||void 0===t?void 0:t[e],o=(null==a?void 0:a.mes)||(null==a?void 0:a.content)||"";/<lumi[ao]_?ooc[^>]*>/i.test(o)&&(console.log("[".concat(I.pW,"] Found OOC tags in raw content, scheduling OOC processing for message ").concat(e)),ke(e))}}),e.on(n.MESSAGE_EDITED,e=>{console.log("[".concat(I.pW,"] MESSAGE_EDITED event for mesId ").concat(e)),he(e);const n=o('div[mesid="'.concat(e,'"] .mes_text'));if(n){s("[data-lumia-ooc]",n).forEach(e=>e.remove())}ke(e,!0)}),e.on(n.MESSAGE_SWIPED,e=>{console.log("[".concat(I.pW,"] MESSAGE_SWIPED event for mesId ").concat(e)),he(e);const n=o('div[mesid="'.concat(e,'"] .mes_text'));if(n){s("[data-lumia-ooc]",n).forEach(e=>e.remove())}ke(e,!0)}),e.on(n.CHAT_CHANGED,()=>{console.log("[".concat(I.pW,"] CHAT_CHANGED event - resetting state and scheduling OOC reprocessing")),ne(),(0,U.SE)(),Se(),requestAnimationFrame(()=>{(0,B.E)(),(0,R.updateLoomSummaryButtonState)()})}),e.on(n.GENERATION_STARTED,()=>{console.log("[".concat(I.pW,"] GENERATION_STARTED - disabling OOC observer processing")),oe(!0)}),e.on(n.GENERATION_ENDED,()=>{console.log("[".concat(I.pW,"] GENERATION_ENDED (error case) - resetting state and flushing updates")),oe(!1),ee()}),e.on(n.GENERATION_STOPPED,()=>{console.log("[".concat(I.pW,"] GENERATION_STOPPED (user cancel) - resetting state and flushing updates")),oe(!1),ee()})),function(){const e=document.getElementById("chat"),n=new MutationObserver(e=>{e.forEach(e=>{if(e.addedNodes.forEach(e=>{if(e.nodeType!==Node.ELEMENT_NODE)return;let n=[];if(e.classList&&e.classList.contains("mes_text")?n=[e]:e.querySelectorAll&&(n=Array.from(e.querySelectorAll(".mes_text"))),e.nodeType===Node.TEXT_NODE||e.innerHTML&&(e.innerHTML.includes("<loom_sum>")||e.innerHTML.includes("&lt;loom_sum&gt;"))){const t=e.closest?e.closest(".mes_text"):null;t&&!n.includes(t)&&n.push(t)}n.forEach(e=>{var n;if((0,U.vL)(e),ae)return;if(s("[data-lumia-ooc]",e).length>0)return;const t=e.closest("div[mesid]");if(!t)return;const r=parseInt(t.getAttribute("mesid"),10),a=(0,i.SD)(),o=null==a||null===(n=a.chat)||void 0===n?void 0:n[r],l=(null==o?void 0:o.mes)||(null==o?void 0:o.content)||"";/<lumi[ao]_?ooc[^>]*>/i.test(l)&&(console.log("[".concat(I.pW,"] Observer: Processing OOC tags in message ").concat(r)),ke(r))})}),"characterData"===e.type){var n;const t=null===(n=e.target.parentElement)||void 0===n?void 0:n.closest(".mes_text");t&&(0,U.vL)(t)}})}),t=e||document.body;n.observe(t,{childList:!0,subtree:!0,characterData:!0}),console.log("[".concat(I.pW,"] OOC observer started on ").concat(e?"chat element":"body (fallback)"))}(),console.log("[".concat(I.pW,"] Initial load - scheduling OOC processing")),Se();const r=(0,i.ej)(),a=(0,i.Dr)();r&&a&&r.addCommandObject(a.fromProps({name:"loom-summarize",callback:async()=>{const e=(0,I.mt)().summarization;if(!e||"disabled"===e.mode)return toastr.warning("Summarization is disabled. Enable it in Lumia Injector settings."),"Summarization is disabled.";try{toastr.info("Generating loom summary...");return await(0,B.Zq)(null,!0)?(toastr.success("Loom summary generated and saved!"),"Summary generated successfully."):(toastr.warning("No summary generated. Check if there are messages to summarize."),"No summary generated.")}catch(e){return toastr.error("Summarization failed: ".concat(e.message)),"Error: ".concat(e.message)}},aliases:["loom-sum","summarize"],helpString:"Manually generate a loom summary of the current chat using your configured summarization settings (uses Manual Message Context)."})),console.log("".concat(I.pW," initialized"))})})();
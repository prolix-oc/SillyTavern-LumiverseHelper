<div class="lumia-injector-settings">
    <div class="inline-drawer">
        <div class="inline-drawer-toggle inline-drawer-header">
            <b>Lumia Injector</b>
            <div class="inline-drawer-icon fa-solid fa-circle-chevron-down down"></div>
        </div>
        <div class="inline-drawer-content">

            <!-- Source Section -->
            <div class="lumia-panel">
                <div class="lumia-panel-header">
                    <span class="lumia-panel-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                            <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
                        </svg>
                    </span>
                    <span class="lumia-panel-title">World Book Source</span>
                </div>
                <div class="lumia-panel-content">
                    <div class="lumia-status-badge" id="lumia-book-status">No packs loaded</div>
                    <div class="lumia-input-row">
                        <input type="text" id="lumia-url-input" class="lumia-input" placeholder="Enter World Book URL (JSON)" />
                        <button id="lumia-fetch-btn" class="lumia-btn lumia-btn-primary">Fetch</button>
                    </div>
                    <div class="lumia-divider-text">or</div>
                    <button id="lumia-upload-btn" class="lumia-btn lumia-btn-secondary lumia-btn-full">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="17 8 12 3 7 8"></polyline>
                            <line x1="12" y1="3" x2="12" y2="15"></line>
                        </svg>
                        Upload JSON File
                    </button>
                    <input type="file" id="lumia-file-input" accept=".json" style="display: none;" />
                </div>
            </div>

            <!-- Lumia Configuration Section -->
            <div class="lumia-panel">
                <div class="lumia-panel-header">
                    <span class="lumia-panel-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="3"></circle>
                            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                        </svg>
                    </span>
                    <span class="lumia-panel-title">Lumia Configuration</span>
                </div>
                <div class="lumia-panel-content">
                    <div class="lumia-selector-group">
                        <div class="lumia-selector">
                            <div class="lumia-selector-header">
                                <span class="lumia-selector-label">Definition</span>
                                <span class="lumia-selector-hint">Select One</span>
                            </div>
                            <div class="lumia-selector-row">
                                <div class="lumia-selector-value" id="lumia-current-definition">No definition selected</div>
                                <button id="lumia-open-definitions-btn" class="lumia-btn lumia-btn-sm">Select</button>
                            </div>
                        </div>

                        <div class="lumia-selector">
                            <div class="lumia-selector-header">
                                <span class="lumia-selector-label">Behaviors</span>
                                <span class="lumia-selector-hint">Select Multiple</span>
                            </div>
                            <div class="lumia-selector-row">
                                <div class="lumia-selector-value" id="lumia-current-behaviors">No behaviors selected</div>
                                <button id="lumia-open-behaviors-btn" class="lumia-btn lumia-btn-sm">Select</button>
                            </div>
                        </div>

                        <div class="lumia-selector">
                            <div class="lumia-selector-header">
                                <span class="lumia-selector-label">Personalities</span>
                                <span class="lumia-selector-hint">Select Multiple</span>
                            </div>
                            <div class="lumia-selector-row">
                                <div class="lumia-selector-value" id="lumia-current-personalities">No personalities selected</div>
                                <button id="lumia-open-personalities-btn" class="lumia-btn lumia-btn-sm">Select</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Loom Configuration Section -->
            <div class="lumia-panel">
                <div class="lumia-panel-header">
                    <span class="lumia-panel-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                            <path d="M2 17l10 5 10-5"></path>
                            <path d="M2 12l10 5 10-5"></path>
                        </svg>
                    </span>
                    <span class="lumia-panel-title">Loom Configuration</span>
                </div>
                <div class="lumia-panel-content">
                    <div class="lumia-selector-group">
                        <div class="lumia-selector">
                            <div class="lumia-selector-header">
                                <span class="lumia-selector-label">Narrative Style</span>
                                <span class="lumia-selector-hint">Select One</span>
                            </div>
                            <div class="lumia-selector-row">
                                <div class="lumia-selector-value" id="loom-current-style">No style selected</div>
                                <button id="loom-open-style-btn" class="lumia-btn lumia-btn-sm">Select</button>
                            </div>
                        </div>

                        <div class="lumia-selector">
                            <div class="lumia-selector-header">
                                <span class="lumia-selector-label">Loom Utilities</span>
                                <span class="lumia-selector-hint">Select Multiple</span>
                            </div>
                            <div class="lumia-selector-row">
                                <div class="lumia-selector-value" id="loom-current-utils">No utilities selected</div>
                                <button id="loom-open-utils-btn" class="lumia-btn lumia-btn-sm">Select</button>
                            </div>
                        </div>

                        <div class="lumia-selector">
                            <div class="lumia-selector-header">
                                <span class="lumia-selector-label">Retrofits</span>
                                <span class="lumia-selector-hint">Select Multiple</span>
                            </div>
                            <div class="lumia-selector-row">
                                <div class="lumia-selector-value" id="loom-current-retrofits">No retrofits selected</div>
                                <button id="loom-open-retrofits-btn" class="lumia-btn lumia-btn-sm">Select</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tools Section -->
            <div class="lumia-panel">
                <div class="lumia-panel-header">
                    <span class="lumia-panel-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path>
                        </svg>
                    </span>
                    <span class="lumia-panel-title">Tools</span>
                </div>
                <div class="lumia-panel-content">
                    <div class="lumia-tools-row">
                        <button id="lumia-open-misc-btn" class="lumia-tool-btn">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="1"></circle>
                                <circle cx="19" cy="12" r="1"></circle>
                                <circle cx="5" cy="12" r="1"></circle>
                            </svg>
                            <span>OOC Settings</span>
                        </button>
                        <button id="lumia-open-summarization-btn" class="lumia-tool-btn">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="21" y1="10" x2="3" y2="10"></line>
                                <line x1="21" y1="6" x2="3" y2="6"></line>
                                <line x1="21" y1="14" x2="3" y2="14"></line>
                                <line x1="21" y1="18" x2="3" y2="18"></line>
                            </svg>
                            <span>Summarization</span>
                        </button>
                        <button id="lumia-open-prompt-settings-btn" class="lumia-tool-btn">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                            </svg>
                            <span>Prompt Settings</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Macros Reference (Collapsible) -->
            <details class="lumia-panel lumia-panel-collapsible">
                <summary class="lumia-panel-header lumia-panel-header-clickable">
                    <span class="lumia-panel-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="4 17 10 11 4 5"></polyline>
                            <line x1="12" y1="19" x2="20" y2="19"></line>
                        </svg>
                    </span>
                    <span class="lumia-panel-title">Macro Reference</span>
                    <span class="lumia-panel-chevron">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </span>
                </summary>
                <div class="lumia-panel-content lumia-macro-reference">
                    <div class="lumia-macro-group">
                        <div class="lumia-macro-group-title">Lumia Content</div>
                        <div class="lumia-macro-list">
                            <div class="lumia-macro"><code>{{lumiaDef}}</code><span>Physical Definition</span></div>
                            <div class="lumia-macro"><code>{{lumiaBehavior}}</code><span>Behavior(s)</span></div>
                            <div class="lumia-macro"><code>{{lumiaPersonality}}</code><span>Personality(s)</span></div>
                        </div>
                    </div>
                    <div class="lumia-macro-group">
                        <div class="lumia-macro-group-title">Loom Content</div>
                        <div class="lumia-macro-list">
                            <div class="lumia-macro"><code>{{loomStyle}}</code><span>Narrative Style</span></div>
                            <div class="lumia-macro"><code>{{loomUtils}}</code><span>Loom Utilities</span></div>
                            <div class="lumia-macro"><code>{{loomRetrofits}}</code><span>Retrofits</span></div>
                        </div>
                    </div>
                    <div class="lumia-macro-group">
                        <div class="lumia-macro-group-title">Random Lumia</div>
                        <div class="lumia-macro-list">
                            <div class="lumia-macro"><code>{{randomLumia}}</code><span>Random definition</span></div>
                            <div class="lumia-macro"><code>{{randomLumia.pers}}</code><span>Random personality</span></div>
                            <div class="lumia-macro"><code>{{randomLumia.behav}}</code><span>Random behavior</span></div>
                            <div class="lumia-macro"><code>{{randomLumia.name}}</code><span>Random name</span></div>
                        </div>
                    </div>
                    <div class="lumia-macro-group">
                        <div class="lumia-macro-group-title">Tracking & OOC</div>
                        <div class="lumia-macro-list">
                            <div class="lumia-macro"><code>{{lumiaMessageCount}}</code><span>Message count</span></div>
                            <div class="lumia-macro"><code>{{lumiaOOCTrigger}}</code><span>OOC trigger/countdown</span></div>
                        </div>
                    </div>
                    <div class="lumia-macro-group">
                        <div class="lumia-macro-group-title">Summarization</div>
                        <div class="lumia-macro-list">
                            <div class="lumia-macro"><code>{{loomSummary}}</code><span>Stored summary</span></div>
                            <div class="lumia-macro"><code>{{loomSummaryPrompt}}</code><span>Summary directive</span></div>
                            <div class="lumia-macro"><code>/loom-summarize</code><span>Manual trigger</span></div>
                        </div>
                    </div>
                    <div class="lumia-macro-group">
                        <div class="lumia-macro-group-title">Sovereign Hand</div>
                        <div class="lumia-macro-list">
                            <div class="lumia-macro"><code>{{loomSovHand}}</code><span>Full Sovereign Hand prompt (with user message)</span></div>
                            <div class="lumia-macro"><code>{{loomSovHandActive}}</code><span>Yes/No status indicator</span></div>
                            <div class="lumia-macro"><code>{{loomLastUserMessage}}</code><span>Last user message (excluded from context)</span></div>
                        </div>
                    </div>
                </div>
            </details>

        </div>
    </div>
</div>

<div class="lumia-injector-settings">
    <div class="inline-drawer">
        <div class="inline-drawer-toggle inline-drawer-header">
            <b>Lumia Injector Settings</b>
            <div class="inline-drawer-icon fa-solid fa-circle-chevron-down down"></div>
        </div>
        <div class="inline-drawer-content">
            
            <!-- Source Section -->
            <div class="lumia-section">
                <h3>World Book Source</h3>
                <div class="lumia-status" id="lumia-book-status">No World Book loaded</div>
                <div class="lumia-input-group">
                    <input type="text" id="lumia-url-input" class="text_pole" placeholder="Enter World Book URL (JSON)" />
                    <button id="lumia-fetch-btn" class="menu_button">Fetch</button>
                </div>
                <div style="text-align: center; margin: 10px 0;">- OR -</div>
                <div class="lumia-input-group" style="justify-content: center;">
                    <button id="lumia-upload-btn" class="menu_button">Upload JSON File</button>
                    <input type="file" id="lumia-file-input" accept=".json" style="display: none;" />
                </div>
            </div>

            <!-- Configuration Section -->
            <div class="lumia-section">
                <h3>Lumia Configuration</h3>

                <h4>Definitions (Select One)</h4>
                <div class="lumia-definition-selector">
                    <div id="lumia-current-definition">No definition selected</div>
                    <button id="lumia-open-definitions-btn" class="menu_button">Select Definition</button>
                </div>

                <h4>Behaviors (Select Multiple)</h4>
                <div class="lumia-definition-selector">
                    <div id="lumia-current-behaviors">No behaviors selected</div>
                    <button id="lumia-open-behaviors-btn" class="menu_button">Select Behaviors</button>
                </div>

                <h4>Personalities (Select Multiple)</h4>
                <div class="lumia-definition-selector">
                    <div id="lumia-current-personalities">No personalities selected</div>
                    <button id="lumia-open-personalities-btn" class="menu_button">Select Personalities</button>
                </div>
            </div>

            <!-- Loom Configuration Section -->
            <div class="lumia-section">
                <h3>Loom Configuration</h3>

                <h4>Narrative Style (Select One)</h4>
                <div class="lumia-definition-selector">
                    <div id="loom-current-style">No style selected</div>
                    <button id="loom-open-style-btn" class="menu_button">Select Style</button>
                </div>

                <h4>Loom Utilities (Select Multiple)</h4>
                <div class="lumia-definition-selector">
                    <div id="loom-current-utils">No utilities selected</div>
                    <button id="loom-open-utils-btn" class="menu_button">Select Utilities</button>
                </div>

                <h4>Retrofits (Select Multiple)</h4>
                <div class="lumia-definition-selector">
                    <div id="loom-current-retrofits">No retrofits selected</div>
                    <button id="loom-open-retrofits-btn" class="menu_button">Select Retrofits</button>
                </div>
            </div>

            <div class="lumia-section">
                <h3>Usage</h3>
                <p>Use the following macros in your prompts or character cards:</p>
                <h4>Lumia Content Macros</h4>
                <ul>
                    <li><code>{{lumiaDef}}</code> - Inserts the selected Physical Definition.</li>
                    <li><code>{{lumiaBehavior}}</code> - Inserts the selected Behavior(s).</li>
                    <li><code>{{lumiaPersonality}}</code> - Inserts the selected Personality(s).</li>
                </ul>
                <h4>Loom Content Macros</h4>
                <ul>
                    <li><code>{{loomStyle}}</code> - Inserts the selected Narrative Style.</li>
                    <li><code>{{loomUtils}}</code> - Inserts the selected Loom Utilities.</li>
                    <li><code>{{loomRetrofits}}</code> - Inserts the selected Retrofits.</li>
                </ul>
                <h4>Random Lumia Macros</h4>
                <ul>
                    <li><code>{{randomLumia}}</code> or <code>{{randomLumia.phys}}</code> - Random Lumia definition.</li>
                    <li><code>{{randomLumia.pers}}</code> - Random Lumia personality.</li>
                    <li><code>{{randomLumia.behav}}</code> - Random Lumia behavior.</li>
                    <li><code>{{randomLumia.name}}</code> - Random Lumia name.</li>
                </ul>
                <h4>Message Tracking & OOC Macros</h4>
                <ul>
                    <li><code>{{lumiaMessageCount}}</code> - Current message count in the chat.</li>
                    <li><code>{{lumiaOOCTrigger}}</code> - Shows countdown to next OOC trigger, or injects OOC instruction when interval is reached (configure in Misc Features).</li>
                </ul>
                <h4>Summarization Macros & Commands</h4>
                <ul>
                    <li><code>{{loomSummary}}</code> - Inserts the stored loom summary from chat metadata.</li>
                    <li><code>{{loomSummaryPrompt}}</code> - Inserts the summarization directive for LLM-generated summaries.</li>
                    <li><code>/loom-summarize</code> or <code>/loom-sum</code> - Slash command to manually trigger summarization.</li>
                </ul>
            </div>

            <div class="lumia-section">
                <h3>Miscellaneous Features</h3>
                <p>Additional features and tools for Lumia interaction:</p>
                <button id="lumia-open-misc-btn" class="menu_button">Configure Miscellaneous Features</button>
            </div>

            <div class="lumia-section">
                <h3>Auto-Summarization</h3>
                <p>Configure automatic or manual story summarization using LLM generation:</p>
                <button id="lumia-open-summarization-btn" class="menu_button">Configure Summarization</button>
            </div>

        </div>
    </div>
</div>
